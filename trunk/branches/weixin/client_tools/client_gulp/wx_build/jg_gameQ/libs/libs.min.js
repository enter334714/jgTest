var Laya=window.Laya=function(qb,qS){var qH={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(qS,q_){return 1==arguments.length?qH.__presubstr.call(this,qS):qH.__presubstr.call(this,qS,0<q_?q_:this.length+q_)},__init:function(qS){qS.forEach(function(qS){qS.__init$&&qS.__init$()})},__isClass:function(qS){return qS&&(qS.__isclass||qS==Object||qS==String||qS==Array)},__newvec:function(qS,q_){var qa=[];qa.length=qS;for(var qR=0;qR<qS;qR++)qa[qR]=q_;return qa},__extend:function(qS,q_){for(var qa in q_)if(q_.hasOwnProperty(qa)){var qR=Object.getOwnPropertyDescriptor(q_,qa),qJ=qR.get,qV=qR.set;qJ||qV?qJ&&qV?Object.defineProperty(qS,qa,qR):(qJ&&Object.defineProperty(qS,qa,qJ),qV&&Object.defineProperty(qS,qa,qV)):qS[qa]=q_[qa]}function qW(){qH.un(this,"constructor",qS)}qW.prototype=q_.prototype,qS.prototype=new qW,qH.un(qS.prototype,"__imps",qH.__copy({},q_.prototype.__imps))},__copy:function(qS,q_){if(!q_)return null;for(var qa in qS=qS||{},q_)qS[qa]=q_[qa];return qS},__package:function(qS,q_){if(!qH.__packages[qS]){qH.__packages[qS]=!0;var qa=qb,qR=qS.split(".");if(1<qR.length)for(var qJ=0,qV=qR.length-1;qJ<qV;qJ++){var qW=qa[qR[qJ]];qa=qW||(qa[qR[qJ]]={})}qa[qR[qR.length-1]]||(qa[qR[qR.length-1]]=q_||{})}},__hasOwnProperty:function(qS,q_){return q_=q_||this,Object.hasOwnProperty.call(q_,qS)||function qS(q_,qa){if(Object.hasOwnProperty.call(qa.prototype,q_))return!0;var qR=qa.prototype.__super;return null==qR?null:qS(q_,qR)}(qS,q_.__class)},__typeof:function(qS,q_){if(!qS||!q_)return!1;if(q_===String)return"string"==typeof qS;if(q_===Number)return"number"==typeof qS;if(q_.__interface__)q_=q_.__interface__;else if("string"!=typeof q_)return qS instanceof q_;return qS.__imps&&qS.__imps[q_]||qS.__class==q_},__as:function(qS,q_){return this.__typeof(qS,q_)?qS:null},__int:function(qS){return qS?parseInt(qS):0},interface:function(qS,q_){qH.__package(qS,{});var qa=qH.__internals,qR=qa[qS]=qa[qS]||{self:qS};if(q_){var qJ=q_.split(",");qR.extend=[];for(var qV=0;qV<qJ.length;qV++){var qW=qJ[qV];qa[qW]=qa[qW]||{self:qW},qR.extend.push(qa[qW])}}var qk=qb,qz=qS.split(".");for(qV=0;qV<qz.length-1;qV++)qk=qk[qz[qV]];qk[qz[qz.length-1]]={__interface__:qS}},class:function(qS,q_,qa,qR){if(qa&&qH.__extend(qS,qa),q_)if(qH.__package(q_,qS),qH.__classmap[q_]=qS,0<q_.indexOf(".")){if(0==q_.indexOf("laya.")){var qJ=q_.split(".");qR=qR||qJ[qJ.length-1],qH[qR]&&console.log("Warning!,this class["+qR+"] already exist:",qH[qR]),qH[qR]=qS}}else"Main"==q_?qb.Main=qS:"MainWX"==q_?qb.MainWX=qS:(qH[q_]&&console.log("Error!,this class["+q_+"] already exist:",qH[q_]),qH[q_]=qS);var qV=qH.un,qW=qS.prototype;qV(qW,"hasOwnProperty",qH.__hasOwnProperty),qV(qW,"__class",qS),qV(qW,"__super",qa),qV(qW,"__className",q_),qV(qS,"__super",qa),qV(qS,"__className",q_),qV(qS,"__isclass",!0),qV(qS,"super",function(qS){this.__super.call(qS)})},imps:function(qS,q_){if(!q_)return null;var qJ=qS.__imps||qH.un(qS,"__imps",{});function qV(qS){var q_,qa;if((q_=qH.__internals[qS])&&(qJ[qS]=!0,qa=q_.extend))for(var qR=0;qR<qa.length;qR++)qV(qa[qR].self)}for(var qa in q_)qV(qa)},superSet:function(qS,q_,qa,qR){var qJ=qS.prototype["_$set_"+qa];qJ&&qJ.call(q_,qR)},superGet:function(qS,q_,qa){var qR=qS.prototype["_$get_"+qa];return qR?qR.call(q_):null},getset:function(qS,q_,qa,qR,qJ){qS?(qR&&(q_["_$GET_"+qa]=qR),qJ&&(q_["_$SET_"+qa]=qJ)):(qR&&qH.un(q_,"_$get_"+qa,qR),qJ&&qH.un(q_,"_$set_"+qa,qJ)),qR&&qJ?Object.defineProperty(q_,qa,{get:qR,set:qJ,enumerable:!1,configurable:!0}):(qR&&Object.defineProperty(q_,qa,{get:qR,enumerable:!1,configurable:!0}),qJ&&Object.defineProperty(q_,qa,{set:qJ,enumerable:!1,configurable:!0}))},static:function(qa,qR){for(var qJ=0,qS=qR.length;qJ<qS;qJ+=2)if("length"==qR[qJ])qa.length=qR[qJ+1].call(qa);else{function q_(){var q_=qR[qJ],qS=qR[qJ+1];Object.defineProperty(qa,q_,{get:function(){return delete this[q_],this[q_]=qS.call(this)},set:function(qS){delete this[q_],this[q_]=qS},enumerable:!0,configurable:!0})}q_()}},un:function(qS,q_,qa){return qa||(qa=qS[q_]),qH.__propun.value=qa,Object.defineProperty(qS,q_,qH.__propun),qa},uns:function(q_,qS){qS.forEach(function(qS){qH.un(q_,qS)})}};return qb.console=qb.console||{log:function(){}},qb.trace=qb.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),qH}(window,document);!function(qS,q_,qa){qa.un,qa.uns,qa.static,qa.class,qa.getset,qa.__newvec}(window,document,Laya),function(qW,q_,qq){qq.un,qq.uns;var qz=qq.static,qo=qq.class,qH=qq.getset;qq.__newvec;qq.interface("laya.runtime.IMarket"),qq.interface("laya.filters.IFilter"),qq.interface("laya.display.ILayout"),qq.interface("laya.resource.IDispose"),qq.interface("laya.runtime.IPlatform"),qq.interface("laya.resource.IDestroy"),qq.interface("laya.runtime.IConchNode"),qq.interface("laya.filters.IFilterAction"),qq.interface("laya.runtime.ICPlatformClass"),qq.interface("laya.resource.ICreateResource"),qq.interface("laya.runtime.IConchRenderObject"),qq.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var qA=function(){function qV(){}return qo(qV,"laya.utils.RunDriver"),qV.FILTER_ACTIONS=[],qV.pixelRatio=-1,qV._charSizeTestDiv=null,qV.now=function(){return Date.now()},qV.getWindow=function(){return qW},qV.getPixelRatio=function(){if(qV.pixelRatio<0){var qS=qg.context,q_=qS.backingStorePixelRatio||qS.webkitBackingStorePixelRatio||qS.mozBackingStorePixelRatio||qS.msBackingStorePixelRatio||qS.oBackingStorePixelRatio||qS.backingStorePixelRatio||1;(qV.pixelRatio=(qg.window.devicePixelRatio||1)/q_)<1&&(qV.pixelRatio=1)}return qV.pixelRatio},qV.getIncludeStr=function(qS){return null},qV.createShaderCondition=function(qS){var q_="(function() {return "+qS+";})";return qq._runScript(q_)},qV.fontMap=[],qV.measureText=function(qS,q_){var qa=qV.hanzi.test(qS);if(qa&&qV.fontMap[q_])return qV.fontMap[q_];var qR=qg.context;qR.font=q_;var qJ=qR.measureText(qS);return qa&&(qV.fontMap[q_]=qJ),qJ},qV.getWebGLContext=function(qS){},qV.beginFlush=function(){},qV.endFinish=function(){},qV.addToAtlas=null,qV.flashFlushImage=function(qS){},qV.drawToCanvas=function(qS,q_,qa,qR,qJ,qV){var qW=qDS.create("2D"),qk=new qP(qa,qR,qW);return qM.renders[q_]._fun(qS,qk,qJ,qV),qW},qV.createParticleTemplate2D=null,qV.createGLTextur=null,qV.createWebGLContext2D=null,qV.changeWebGLSize=function(qS,q_){},qV.createRenderSprite=function(qS,q_){return new qM(qS,q_)},qV.createFilterAction=function(qS){return new qD},qV.createGraphics=function(){return new qC},qV.clear=function(qS){qK._context.ctx.clear()},qV.cancelLoadByUrl=function(qS){},qV.clearAtlas=function(qS){},qV.isAtlas=function(qS){return!1},qV.addTextureToAtlas=function(qS){},qV.getTexturePixels=function(qS,q_,qa,qR,qJ){return null},qV.skinAniSprite=function(){return null},qV.update3DLoop=function(){},qz(qV,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),qV}(),qR=(qH(1,qq,"alertGlobalError",null,function(qS){var qV=0;qg.window.onerror=qS?function(qS,q_,qa,qR,qJ){qV++<5&&qJ&&alert(qJ.stack||qJ)}:null}),qq.init=function(qS,q_,qa){for(var qR=[],qJ=2,qV=arguments.length;qJ<qV;qJ++)qR.push(arguments[qJ]);if(!qq._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=qq._arrayBufferSlice),qq._isinit=!0,qg.__init__(),qr.__init__(),qC.__init__(),qq.timer=new qy,qq.scaleTimer=new qy,qq.loader=new qzS,qv.__init__(),qJ=0;for(var qW=qR.length;qJ<qW;qJ++)qR[qJ].enable&&qR[qJ].enable();return qG.__init__(),qk.__init__(),qe.__init__(),qs.beginCheck(),qq._currentStage=qq.stage=new qFS,qq.stage.conchModel&&qq.stage.conchModel.setRootNode(),qq._getUrlPath(),qq.render=new qK(0,0),qq.stage.size(qS,q_),qM.__init__(),qL.__init__(),qt.instance.__init__(qq.stage,qK.canvas),qQS.__init__(),qI.autoStopMusic=!0,ql.__init__(),qK.canvas}},qq._getUrlPath=function(){var qS=qg.window.location,q_=qS.pathname;q_=q_&&":"==q_.charAt(2)?q_.substring(1):q_,qu.rootPath=qu.basePath=qu.getPath("file:"==qS.protocol?q_:qS.protocol+"//"+qS.host+qS.pathname)},qq._arrayBufferSlice=function(qS,q_){var qa=new Uint8Array(this,qS,q_-qS),qR=new Uint8Array(qa.length);return qR.set(qa),qR.buffer},qq._runScript=function(qS){return qg.window[qq._evcode](qS)},qq.stage=null,qq.timer=null,qq.scaleTimer=null,qq.loader=null,qq.version="1.8.6",qq.render=null,qq._currentStage=null,qq._isinit=!1,qq.isDebug=!1,qq.MiniAdpter={init:function(){qW.navigator&&qW.navigator.userAgent&&-1<qW.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},qz(qq,["conchMarket",function(){return this.conchMarket=qW.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=qW.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function qS(){}return qo(qS,"Config"),qS.WebGLTextCacheCount=500,qS.atlasEnable=!1,qS.showCanvasMark=!1,qS.animationInterval=50,qS.isAntialias=!1,qS.isAlpha=!1,qS.premultipliedAlpha=!0,qS.isStencil=!0,qS.preserveDrawingBuffer=!1,qS}()),qb=function(){function qb(){this._events=null}qo(qb,"laya.events.EventDispatcher");var qS=qb.prototype;return qS.hasListener=function(qS){return!!(this._events&&this._events[qS])},qS.event=function(qS,q_){if(!this._events||!this._events[qS])return!1;var qa=this._events[qS];if(qa.lock)qa.queue||(qa.queue=[]),qa.queue.push(q_);else{var qR;for(qa.lock=!0,qa.cursor=qa.head;qa.cursor;)qR=qa.cursor,qa.cursor=qR.next,qR.once&&qb.delNode(qa,qR),null!=q_?qR.args?qR.method.apply(qR.caller,qR.args.concat(q_)):q_ instanceof Array?qR.method.apply(qR.caller,q_):qR.method.call(qR.caller,q_):qR.method.apply(qR.caller,qR.args),qR.once&&qb.recoverHandler(qR);qa.lock=!1,!qa.head&&this._events&&this._events[qS]==qa&&delete this._events[qS],qa.queue&&qa.queue.length&&this.event(qS,qa.queue.shift())}return!0},qS.on=function(qS,q_,qa,qR){return this._createListener(qS,q_,qa,qR,!1)},qS.once=function(qS,q_,qa,qR){return this._createListener(qS,q_,qa,qR,!0)},qS._createListener=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=!0),qV&&this.off(qS,q_,qa,qJ);var qW=qb.createHandler(q_||this,qa,qR,qJ);this._events||(this._events={});var qk=this._events,qz=qk[qS];return qz?qz.tail?(qW.prev=qz.tail,qz.tail.next=qW,qz.tail=qW):qz.head=qz.tail=qW:qk[qS]={head:qW,tail:qW,cursor:null,lock:!1},this},qS.off=function(qS,q_,qa,qR){if(void 0===qR&&(qR=!1),!this._events||!this._events[qS])return this;for(var qJ=this._events[qS],qV=qJ.head;qV;){if((!q_||qV.caller===q_)&&qV.method===qa&&(!qR||qV.once)){qb.delNode(qJ,qV),qJ.cursor==qV&&(qJ.cursor=qV.next),qb.recoverHandler(qV);break}qV=qV.next}return this},qS.offAll=function(qS){var q_=this._events;if(!q_)return this;if(qS)this._recoverHandlers(q_[qS]),delete q_[qS];else{for(var qa in q_)this._recoverHandlers(q_[qa]);this._events=null}return this},qS._recoverHandlers=function(qS){if(qS){for(var q_=qS.head;q_;){qb.delNode(qS,q_);var qa=q_.next;qb.recoverHandler(q_),q_=qa}qS.cursor=null}},qS.isMouseEvent=function(qS){return qb.MOUSE_EVENTS[qS]},qb.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},qb.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},qb.delNode=function(qS,q_){q_.prev?q_.prev.next=q_.next:qS.head=q_.next,q_.next?q_.next.prev=q_.prev:qS.tail=q_.prev},qb.createHandler=function(qS,q_,qa,qR){var qJ=qb._freeHandler;return qJ?(qb._freeCount--,qb._freeHandler=qJ.next,qJ.caller=qS,qJ.method=q_,qJ.args=qa,qJ.once=qR):qJ={caller:qS,method:q_,args:qa,once:qR},qJ.prev=qJ.next=null,qJ},qb.recoverHandler=function(qS){qS.caller=qS.method=qS.args=qS.prev=null,qS.next=qb._freeHandler,qb._freeHandler=qS,qb._freeCount++},qb._freeHandler=null,qb._freeCount=0,qb}(),qT=function(){function qJ(qS,q_,qa,qR){this.once=!1,void(this._id=0)===qR&&(qR=!1),this.setTo(qS,q_,qa,qR)}qo(qJ,"laya.utils.Handler");var qS=qJ.prototype;return qS.setTo=function(qS,q_,qa,qR){return this._id=qJ._gid++,this.caller=qS,this.method=q_,this.args=qa,this.once=qR,this},qS.run=function(){if(null==this.method)return null;var qS=this._id,q_=this.method.apply(this.caller,this.args);return this._id===qS&&this.once&&this.recover(),q_},qS.runWith=function(qS){if(null==this.method)return null;var q_=this._id;if(null==qS)var qa=this.method.apply(this.caller,this.args);else qa=this.args||qS.unshift?this.args?this.method.apply(this.caller,this.args.concat(qS)):this.method.apply(this.caller,qS):this.method.call(this.caller,qS);return this._id===q_&&this.once&&this.recover(),qa},qS.clear=function(){return this.caller=null,this.method=null,this.args=null,this},qS.recover=function(){0<this._id&&(this._id=0,this.clear())},qJ.create=function(qS,q_,qa,qR){return void 0===qR&&(qR=!0),new qJ(qS,q_,qa,qR)},qJ._gid=1,qJ}(),qB=function(){function qS(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}qo(qS,"laya.display.BitmapFont");var q_=qS.prototype;return q_.loadFont=function(qS,q_){this._path=qS,this._complete=q_,qq.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],qT.create(this,this.onLoaded))},q_.onLoaded=function(){this.parseFont(qkS.getRes(this._path),qkS.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},q_.parseFont=function(qS,q_){if(null!=qS&&null!=q_){this._texture=q_;var qa=qS.getElementsByTagName("info");if(!qa[0].getAttributeNode)return this.parseFont2(qS,q_);this.fontSize=parseInt(qa[0].getAttributeNode("size").nodeValue);var qR,qJ=qa[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(qJ[0]),parseInt(qJ[1]),parseInt(qJ[2]),parseInt(qJ[3])],qR=qS.getElementsByTagName("char");var qV=0;for(qV=0;qV<qR.length;qV++){var qW=qR[qV],qk=parseInt(qW.getAttributeNode("id").nodeValue),qz=parseInt(qW.getAttributeNode("xoffset").nodeValue)/1,qb=parseInt(qW.getAttributeNode("yoffset").nodeValue)/1,qH=parseInt(qW.getAttributeNode("xadvance").nodeValue)/1,qL=new qn;qL.x=parseInt(qW.getAttributeNode("x").nodeValue),qL.y=parseInt(qW.getAttributeNode("y").nodeValue),qL.width=parseInt(qW.getAttributeNode("width").nodeValue),qL.height=parseInt(qW.getAttributeNode("height").nodeValue);var qC=qHS.create(q_,qL.x,qL.y,qL.width,qL.height,qz,qb);this._maxWidth=Math.max(this._maxWidth,qH+this.letterSpacing),this._fontCharDic[qk]=qC,this._fontWidthMap[qk]=qH}}},q_.parseFont2=function(qS,q_){if(null!=qS&&null!=q_){this._texture=q_;var qa=qS.getElementsByTagName("info");this.fontSize=parseInt(qa[0].attributes.size.nodeValue);var qR=qa[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(qR[0]),parseInt(qR[1]),parseInt(qR[2]),parseInt(qR[3])];var qJ=qS.getElementsByTagName("char"),qV=0;for(qV=0;qV<qJ.length;qV++){var qW=qJ[qV].attributes,qk=parseInt(qW.id.nodeValue),qz=parseInt(qW.xoffset.nodeValue)/1,qb=parseInt(qW.yoffset.nodeValue)/1,qH=parseInt(qW.xadvance.nodeValue)/1,qL=new qn;qL.x=parseInt(qW.x.nodeValue),qL.y=parseInt(qW.y.nodeValue),qL.width=parseInt(qW.width.nodeValue),qL.height=parseInt(qW.height.nodeValue);var qC=qHS.create(q_,qL.x,qL.y,qL.width,qL.height,qz,qb);this._maxWidth=Math.max(this._maxWidth,qH+this.letterSpacing),this._fontCharDic[qk]=qC,this._fontWidthMap[qk]=qH}}},q_.getCharTexture=function(qS){return this._fontCharDic[qS.charCodeAt(0)]},q_.destroy=function(){if(this._texture){for(var qS in this._fontCharDic){var q_=this._fontCharDic[qS];q_&&q_.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},q_.setSpaceWidth=function(qS){this._spaceWidth=qS},q_.getCharWidth=function(qS){var q_=qS.charCodeAt(0);return this._fontWidthMap[q_]?this._fontWidthMap[q_]+this.letterSpacing:" "==qS?this._spaceWidth+this.letterSpacing:0},q_.getTextWidth=function(qS){for(var q_=0,qa=0,qR=qS.length;qa<qR;qa++)q_+=this.getCharWidth(qS.charAt(qa));return q_},q_.getMaxWidth=function(){return this._maxWidth},q_.getMaxHeight=function(){return this.fontSize},q_.drawText=function(qS,q_,qa,qR,qJ,qV){var qW,qk=this.getTextWidth(qS),qz=0;"center"===qJ&&(qz=(qV-qk)/2),"right"===qJ&&(qz=qV-qk);for(var qb=0,qH=0,qL=qS.length;qH<qL;qH++)(qW=this.getCharTexture(qS.charAt(qH)))&&(q_.graphics.drawTexture(qW,qa+qb+qz,qR),qb+=this.getCharWidth(qS.charAt(qH)))},qS}(),qk=function(){function qa(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=qa._TF_EMPTY}qo(qa,"laya.display.css.Style");var qS=qa.prototype;return qS.getTransform=function(){return this._tf},qS.setTransform=function(qS){this._tf="none"!==qS&&qS?qS:qa._TF_EMPTY},qS.setTranslateX=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.translateX=qS},qS.setTranslateY=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.translateY=qS},qS.setScaleX=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.scaleX=qS},qS.setScale=function(qS,q_){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.scaleX=qS,this._tf.scaleY=q_},qS.setScaleY=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.scaleY=qS},qS.setRotate=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.rotate=qS},qS.setSkewX=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.skewX=qS},qS.setSkewY=function(qS){this._tf===qa._TF_EMPTY&&(this._tf=new qJ),this._tf.skewY=qS},qS.destroy=function(){this.scrollRect=null},qS.render=function(qS,q_,qa,qR){},qS.getCSSStyle=function(){return q_S.EMPTY},qS._enableLayout=function(){return!1},qH(0,qS,"scaleX",function(){return this._tf.scaleX},function(qS){this.setScaleX(qS)}),qH(0,qS,"transform",function(){return this.getTransform()},function(qS){this.setTransform(qS)}),qH(0,qS,"translateX",function(){return this._tf.translateX},function(qS){this.setTranslateX(qS)}),qH(0,qS,"translateY",function(){return this._tf.translateY},function(qS){this.setTranslateY(qS)}),qH(0,qS,"scaleY",function(){return this._tf.scaleY},function(qS){this.setScaleY(qS)}),qH(0,qS,"block",function(){return 0!=(1&this._type)}),qH(0,qS,"skewY",function(){return this._tf.skewY},function(qS){this.setSkewY(qS)}),qH(0,qS,"rotate",function(){return this._tf.rotate},function(qS){this.setRotate(qS)}),qH(0,qS,"skewX",function(){return this._tf.skewX},function(qS){this.setSkewX(qS)}),qH(0,qS,"paddingLeft",function(){return 0}),qH(0,qS,"paddingTop",function(){return 0}),qH(0,qS,"absolute",function(){return!0}),qa.__init__=function(){qa._TF_EMPTY=new qJ,qa.EMPTY=new qa},qa.EMPTY=null,qa._TF_EMPTY=null,qa}(),qG=function(){function q_(qS){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=qf.create(q_.defaultColor),this.family=q_.defaultFamily,this.stroke=q_._STROKE,this.size=q_.defaultSize,qS&&qS!==q_.EMPTY&&qS.copyTo(this)}qo(q_,"laya.display.css.Font");var qS=q_.prototype;return qS.set=function(qS){this._text=null;for(var q_=qS.split(" "),qa=0,qR=q_.length;qa<qR;qa++){var qJ=q_[qa];switch(qJ){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<qJ.indexOf("px")&&(this.size=parseInt(qJ),this.family=q_[qa+1],qa++)}},qS.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},qS.copyTo=function(qS){qS._type=this._type,qS._text=this._text,qS._weight=this._weight,qS._color=this._color,qS.family=this.family,qS.stroke=this.stroke!=q_._STROKE?this.stroke.slice():q_._STROKE,qS.indent=this.indent,qS.size=this.size},qH(0,qS,"password",function(){return 0!=(1024&this._type)},function(qS){qS?this._type|=1024:this._type&=-1025}),qH(0,qS,"color",function(){return this._color.strColor},function(qS){this._color=qf.create(qS)}),qH(0,qS,"italic",function(){return 0!=(512&this._type)},function(qS){qS?this._type|=512:this._type&=-513}),qH(0,qS,"bold",function(){return 0!=(2048&this._type)},function(qS){qS?this._type|=2048:this._type&=-2049}),qH(0,qS,"weight",function(){return""+this._weight},function(qS){var q_=0;switch(qS){case"normal":break;case"bold":this.bold=!0,q_=700;break;case"bolder":q_=800;break;case"lighter":q_=100;break;default:q_=parseInt(qS)}this._weight=q_,this._text=null}),qH(0,qS,"decoration",function(){return this._decoration?this._decoration.value:null},function(qS){var q_=qS.split(" ");switch(this._decoration||(this._decoration={}),q_[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=q_[0]}q_[1]&&(this._decoration.color=qf.create(q_)),this._decoration.value=qS}),q_.__init__=function(){q_.EMPTY=new q_(null)},q_.EMPTY=null,q_.defaultColor="#000000",q_.defaultSize=12,q_.defaultFamily="Arial",q_.defaultFont="12px Arial",q_._STROKE=[0,"#000000"],q_._ITALIC=512,q_._PASSWORD=1024,q_._BOLD=2048,q_}(),qJ=function(){function qS(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return qo(qS,"laya.display.css.TransformInfo"),qS}(),qC=function(){function qL(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,qK.isConchNode){this._nativeObj=new qW._conchGraphics,this.id=this._nativeObj.conchID}}qo(qL,"laya.display.Graphics");var qS=qL.prototype;return qS.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},qS.clear=function(qS){void 0===qS&&(qS=!1);var q_=0,qa=0;if(qS){var qR=this._one;if(this._cmds){for(qa=this._cmds.length,q_=0;q_<qa;q_++)!(qR=this._cmds[q_])||qR.callee!==qK._context._drawTexture&&qR.callee!==qK._context._drawTextureWithTransform||(qR[0]=null,qL._cache.push(qR));this._cmds.length=0}else qR&&(!qR||qR.callee!==qK._context._drawTexture&&qR.callee!==qK._context._drawTextureWithTransform||(qR[0]=null,qL._cache.push(qR)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(q_=0,qa=this._vectorgraphArray.length;q_<qa;q_++)qw.getInstance().deleteShape(this._vectorgraphArray[q_]);this._vectorgraphArray.length=0}},qS._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},qS._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new qa,this._graphicBounds._graphics=this)},qS._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},qS._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},qS.getBounds=function(qS){return void 0===qS&&(qS=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(qS)},qS.getBoundPoints=function(qS){return void 0===qS&&(qS=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(qS)},qS._addCmd=function(qS){this._cmds=this._cmds||[],qS.callee=qS.shift(),this._cmds.push(qS)},qS.setFilters=function(qS){this._saveToCmd(qK._context._setFilters,qS)},qS.drawTexture=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qW&&(qW=1),!qS||qW<.01)return null;qR||(qR=qS.sourceWidth),qJ||(qJ=qS.sourceHeight),qW=qW<0?0:1<qW?1:qW;var qk,qz=!qK.isWebGL&&(qg.onFirefox||qg.onEdge||qg.onIE||qg.onSafari)?.5:0,qb=qR/qS.sourceWidth,qH=qJ/qS.sourceHeight;return qR=qS.width*qb,qJ=qS.height*qH,qS.loaded&&(qR<=0||qJ<=0)?null:(q_+=qS.offsetX*qb,qa+=qS.offsetY*qH,this._sp&&(this._sp._renderType|=512),q_-=qz,qa-=qz,qR+=2*qz,qJ+=2*qz,qL._cache.length?((qk=qL._cache.pop())[0]=qS,qk[1]=q_,qk[2]=qa,qk[3]=qR,qk[4]=qJ,qk[5]=qV,qk[6]=qW):qk=[qS,q_,qa,qR,qJ,qV,qW],qk.callee=qV||1!=qW?qK._context._drawTextureWithTransform:qK._context._drawTexture,null!=this._one||qV||1!=qW?this._saveToCmd(qk.callee,qk):(this._one=qk,this._render=this._renderOneImg),qS.loaded||qS.once("loaded",this,this._textureLoaded,[qS,qk]),this._repaint(),qk)},qS.cleanByTexture=function(qS,q_,qa,qR,qJ){if(void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),!qS)return this.clear();if(this._one&&this._render===this._renderOneImg){qR||(qR=qS.sourceWidth),qJ||(qJ=qS.sourceHeight);var qV=qR/qS.sourceWidth,qW=qJ/qS.sourceHeight;qR=qS.width*qV,qJ=qS.height*qW,q_+=qS.offsetX*qV,qa+=qS.offsetY*qW,this._one[0]=qS,this._one[1]=q_,this._one[2]=qa,this._one[3]=qR,this._one[4]=qJ,this._repaint()}else this.clear(),qS&&this.drawTexture(qS,q_,qa,qR,qJ)},qS.drawTextures=function(qS,q_){qS&&this._saveToCmd(qK._context._drawTextures,[qS,q_])},qS.fillTexture=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qV&&(qV="repeat"),qS){var qk=[qS,q_,qa,qR,qJ,qV,qW||qN.EMPTY,{}];qS.loaded||qS.once("loaded",this,this._textureLoaded,[qS,qk]),this._saveToCmd(qK._context._fillTexture,qk)}},qS._textureLoaded=function(qS,q_){q_[3]=q_[3]||qS.width,q_[4]=q_[4]||qS.height,this._repaint()},qS.fillCircle=function(qS,q_,qa,qR,qJ,qV,qW){qa.bitmap.enableMerageInAtlas=!1;var qk=new Float32Array(2*(qW+1)),qz=new Float32Array(2*(qW+1)),qb=new Uint16Array(3*qW),qH=2*Math.PI/qW,qL=0;qk[0]=qR,qk[1]=qJ,qz[0]=qR/qa.width,qz[1]=qJ/qa.height;for(var qC=2,qG=0;qG<qW;qG++){var qt=qV*Math.cos(qL)+qR,qo=qV*Math.sin(qL)+qJ;qk[qC]=qt,qk[qC+1]=qo,qz[qC]=qt/qa.width,qz[qC+1]=qo/qa.height,qL+=qH,qC+=2}for(qG=qC=0;qG<qW;qG++)qb[qC++]=0,qb[qC++]=qG+1,qb[qC++]=qW+1<=qG+2?1:qG+2;this.drawTriangles(qa,qS,q_,qk,qz,qb)},qS.drawTriangles=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){void 0===qk&&(qk=1),this._saveToCmd(qK._context.drawTriangles,[qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb])},qS._saveToCmd=function(qS,q_){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=q_,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(q_)),q_.callee=qS,this._repaint(),q_},qS.clipRect=function(qS,q_,qa,qR){this._saveToCmd(qK._context._clipRect,[qS,q_,qa,qR])},qS.fillText=function(qS,q_,qa,qR,qJ,qV,qW){void 0===qW&&(qW=0),this._saveToCmd(qK._context._fillText,[qS,q_,qa,qR||qG.defaultFont,qJ,qV])},qS.fillBorderText=function(qS,q_,qa,qR,qJ,qV,qW,qk){this._saveToCmd(qK._context._fillBorderText,[qS,q_,qa,qR||qG.defaultFont,qJ,qV,qW,qk])},qS.strokeText=function(qS,q_,qa,qR,qJ,qV,qW){this._saveToCmd(qK._context._strokeText,[qS,q_,qa,qR||qG.defaultFont,qJ,qV,qW])},qS.alpha=function(qS){qS=qS<0?0:1<qS?1:qS,this._saveToCmd(qK._context._alpha,[qS])},qS.setAlpha=function(qS){qS=qS<0?0:1<qS?1:qS,this._saveToCmd(qK._context._setAlpha,[qS])},qS.transform=function(qS,q_,qa){void 0===q_&&(q_=0),void 0===qa&&(qa=0),this._saveToCmd(qK._context._transform,[qS,q_,qa])},qS.rotate=function(qS,q_,qa){void 0===q_&&(q_=0),void 0===qa&&(qa=0),this._saveToCmd(qK._context._rotate,[qS,q_,qa])},qS.scale=function(qS,q_,qa,qR){void 0===qa&&(qa=0),void 0===qR&&(qR=0),this._saveToCmd(qK._context._scale,[qS,q_,qa,qR])},qS.translate=function(qS,q_){this._saveToCmd(qK._context._translate,[qS,q_])},qS.save=function(){this._saveToCmd(qK._context._save,[])},qS.restore=function(){this._saveToCmd(qK._context._restore,[])},qS.replaceText=function(qS){this._repaint();var q_=this._cmds;if(q_){for(var qa=q_.length-1;-1<qa;qa--)if(this._isTextCmd(q_[qa].callee))return q_[qa][0].toUpperCase?q_[qa][0]=qS:q_[qa][0].setText(qS),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=qS:this._one[0].setText(qS),!0;return!1},qS._isTextCmd=function(qS){return qS===qK._context._fillText||qS===qK._context._fillBorderText||qS===qK._context._strokeText},qS.replaceTextColor=function(qS){this._repaint();var q_=this._cmds;if(q_)for(var qa=q_.length-1;-1<qa;qa--)this._isTextCmd(q_[qa].callee)&&(q_[qa][4]=qS,q_[qa][0].toUpperCase||(q_[qa][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=qS,this._one[0].toUpperCase||(this._one[0].changed=!0))},qS.loadImage=function(qS,q_,qa,qR,qJ,qV){var qW=this;void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0);var qk=qkS.getRes(qS);function qz(qS){qS&&(qW.drawTexture(qS,q_,qa,qR,qJ),null!=qV&&qV.call(qW._sp,qS))}qk?qz(qk):qq.loader.load(qS,qT.create(null,qz),null,"image")},qS._renderEmpty=function(qS,q_,qa,qR){},qS._renderAll=function(qS,q_,qa,qR){for(var qJ,qV=this._cmds,qW=0,qk=qV.length;qW<qk;qW++)(qJ=qV[qW]).callee.call(q_,qa,qR,qJ)},qS._renderOne=function(qS,q_,qa,qR){this._one.callee.call(q_,qa,qR,this._one)},qS._renderOneImg=function(qS,q_,qa,qR){this._one.callee.call(q_,qa,qR,this._one),2305!==qS._renderType&&(qS._renderType|=1)},qS.drawLine=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=1);var qW=0;qK.isWebGL&&(qW=qw.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(qW));var qk=qV%2==0?0:.5,qz=[qS+qk,q_+qk,qa+qk,qR+qk,qJ,qV,qW];this._saveToCmd(qK._context._drawLine,qz)},qS.drawLines=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=1);var qV=0;if(qa&&!(qa.length<4)){qK.isWebGL&&(qV=qw.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(qV));var qW=qJ%2==0?0:.5,qk=[qS+qW,q_+qW,qa,qR,qJ,qV];this._saveToCmd(qK._context._drawLines,qk)}},qS.drawCurves=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=1);var qV=[qS,q_,qa,qR,qJ];this._saveToCmd(qK._context._drawCurves,qV)},qS.drawRect=function(qS,q_,qa,qR,qJ,qV,qW){void 0===qW&&(qW=1);var qk=qV?qW/2:0,qz=qV?qW:0,qb=[qS+qk,q_+qk,qa-qz,qR-qz,qJ,qV,qW];this._saveToCmd(qK._context._drawRect,qb)},qS.drawCircle=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=1);var qW=qJ?qV/2:0,qk=0;qK.isWebGL&&(qk=qw.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(qk));var qz=[qS,q_,qa-qW,qR,qJ,qV,qk];this._saveToCmd(qK._context._drawCircle,qz)},qS.drawPie=function(qS,q_,qa,qR,qJ,qV,qW,qk){void 0===qk&&(qk=1);var qz=qW?qk/2:0,qb=qW?qk:0,qH=0;qK.isWebGL&&(qH=qw.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(qH));var qL=[qS+qz,q_+qz,qa-qb,qR,qJ,qV,qW,qk,qH];qL[3]=qO.toRadian(qR),qL[4]=qO.toRadian(qJ),this._saveToCmd(qK._context._drawPie,qL)},qS.drawPoly=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=1);var qW=0,qk=!1;qK.isWebGL&&(qW=qw.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(qW),qk=!(6<qa.length));var qz=qJ?qV%2==0?0:.5:0,qb=[qS+qz,q_+qz,qa,qR,qJ,qV,qW,qk];this._saveToCmd(qK._context._drawPoly,qb)},qS.drawPath=function(qS,q_,qa,qR,qJ){var qV=[qS,q_,qa,qR,qJ];this._saveToCmd(qK._context._drawPath,qV)},qH(0,qS,"cmds",function(){return this._cmds},function(qS){this._sp&&(this._sp._renderType|=512),this._cmds=qS,this._render=this._renderAll,this._repaint()}),qL.__init__=function(){if(qK.isConchNode){for(var qS=laya.display.Graphics.prototype,q_=qg.window.ConchGraphics.prototype,qa=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],qR=0,qJ=qa.length;qR<=qJ;qR++){var qV=qa[qR];qS[qV]=q_[qV]}qS._saveToCmd=null,q_.drawImageS&&(qS.drawTextures=function(qS,q_){if(qS&&qS.loaded&&qS.bitmap&&qS.source){var qa=qS.uv,qR=qS.bitmap.width,qJ=qS.bitmap.height;this.drawImageS(qS.bitmap.source,qa[0]*qR,qa[1]*qJ,(qa[2]-qa[0])*qR,(qa[5]-qa[3])*qJ,qS.offsetX,qS.offsetY,qS.width,qS.height,q_)}}),qS.drawTexture=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qW&&(qW=1),qS)if(qS.loaded){if(qS.loaded&&qS.bitmap&&qS.source&&(qR||(qR=qS.sourceWidth),qJ||(qJ=qS.sourceHeight),qW=qW<0?0:1<qW?1:qW,qR=qR-qS.sourceWidth+qS.width,qJ=qJ-qS.sourceHeight+qS.height,!(qR<=0||qJ<=0))){q_+=qS.offsetX,qa+=qS.offsetY;var qk=qS.uv,qz=qS.bitmap.width,qb=qS.bitmap.height;qk[4]<qk[0]&&qk[5]<qk[1]?this.drawImageM(qS.bitmap.source,qk[4]*qz,qk[5]*qb,(qk[0]-qk[4])*qz,(qk[1]-qk[5])*qb,q_,qa,qR,qJ,qV,qW):this.drawImageM(qS.bitmap.source,qk[0]*qz,qk[1]*qb,(qk[2]-qk[0])*qz,(qk[5]-qk[3])*qb,q_,qa,qR,qJ,qV,qW),this._repaint()}}else qS.once("loaded",this,function(){this.drawTexture(qS,q_,qa,qR,qJ,qV)})},qS.fillTexture=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qV&&(qV="repeat"),qS&&qS.loaded){var qk,qz=qK._context.ctx,qb=qS.bitmap.width,qH=qS.bitmap.height,qL=qS.uv;qk=qS.uv!=qHS.DEF_UV?qz.createPattern(qS.bitmap.source,qV,qL[0]*qb,qL[1]*qH,(qL[2]-qL[0])*qb,(qL[5]-qL[3])*qH):qz.createPattern(qS.bitmap.source,qV);var qC=0,qG=0;qW&&(q_+=qW.x%qS.width,qa+=qW.y%qS.height,qC-=qW.x%qS.width,qG-=qW.y%qS.height),this._fillImage(qk,q_,qa,qC,qG,qR,qJ)}}}},qL._cache=[],qL}(),qa=function(){function qD(){this._cacheBoundsType=!1}qo(qD,"laya.display.GraphicsBounds");var qS=qD.prototype;return qS.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},qS.reset=function(){this._temp&&(this._temp.length=0)},qS.getBounds=function(qS){return void 0===qS&&(qS=!1),(!this._bounds||!this._temp||this._temp.length<1||qS!=this._cacheBoundsType)&&(this._bounds=qn._getWrapRec(this.getBoundPoints(qS),this._bounds)),this._cacheBoundsType=qS,this._bounds},qS.getBoundPoints=function(qS){return void 0===qS&&(qS=!1),(!this._temp||this._temp.length<1||qS!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(qS)),this._cacheBoundsType=qS,this._rstBoundPoints=qO.copyArray(this._rstBoundPoints,this._temp)},qS._getCmdPoints=function(qS){void 0===qS&&(qS=!1);var q_,qa,qR=qK._context,qJ=this._graphics.cmds;if((q_=this._temp||(this._temp=[])).length=0,qJ||null==this._graphics._one||(qD._tempCmds.length=0,qD._tempCmds.push(this._graphics._one),qJ=qD._tempCmds),!qJ)return q_;(qa=qD._tempMatrixArrays).length=0;var qV=qD._initMatrix;qV.identity();for(var qW,qk,qz=qD._tempMatrix,qb=NaN,qH=NaN,qL=NaN,qC=NaN,qG=NaN,qt=NaN,qo=0,q$=qJ.length;qo<q$;qo++)if((qW=qJ[qo]).callee)switch(qW.callee){case qR._save:case 7:qa.push(qV),qV=qV.clone();break;case qR._restore:case 8:qV=qa.pop();break;case qR._scale:case 5:qz.identity(),qz.translate(-qW[2],-qW[3]),qz.scale(qW[0],qW[1]),qz.translate(qW[2],qW[3]),this._switchMatrix(qV,qz);break;case qR._rotate:case 3:qz.identity(),qz.translate(-qW[1],-qW[2]),qz.rotate(qW[0]),qz.translate(qW[1],qW[2]),this._switchMatrix(qV,qz);break;case qR._translate:case 6:qz.identity(),qz.translate(qW[0],qW[1]),this._switchMatrix(qV,qz);break;case qR._transform:case 4:qz.identity(),qz.translate(-qW[1],-qW[2]),qz.concat(qW[0]),qz.translate(qW[1],qW[2]),this._switchMatrix(qV,qz);break;case 16:case 24:qD._addPointArrToRst(q_,qn._getBoundPointS(qW[0],qW[1],qW[2],qW[3]),qV);break;case 17:qV.copyTo(qz),qz.concat(qW[4]),qD._addPointArrToRst(q_,qn._getBoundPointS(qW[0],qW[1],qW[2],qW[3]),qz);break;case qR._drawTexture:qk=qW[0],qS?qW[3]&&qW[4]?qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qW[3],qW[4]),qV):(qk=qW[0],qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qk.width,qk.height),qV)):(qb=(qW[3]||qk.sourceWidth)/qk.width,qH=(qW[4]||qk.sourceHeight)/qk.height,qL=qb*qk.sourceWidth,qC=qH*qk.sourceHeight,qG=0<qk.offsetX?qk.offsetX:0,qt=0<qk.offsetY?qk.offsetY:0,qG*=qb,qt*=qH,qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1]-qG,qW[2]-qt,qL,qC),qV));break;case qR._fillTexture:qW[3]&&qW[4]?qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qW[3],qW[4]),qV):(qk=qW[0],qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qk.width,qk.height),qV));break;case qR._drawTextureWithTransform:var qF;qF=qW[5]?(qV.copyTo(qz),qz.concat(qW[5]),qz):qV,qS?qW[3]&&qW[4]?qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qW[3],qW[4]),qF):(qk=qW[0],qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1],qW[2],qk.width,qk.height),qF)):(qk=qW[0],qb=(qW[3]||qk.sourceWidth)/qk.width,qH=(qW[4]||qk.sourceHeight)/qk.height,qL=qb*qk.sourceWidth,qC=qH*qk.sourceHeight,qG=0<qk.offsetX?qk.offsetX:0,qt=0<qk.offsetY?qk.offsetY:0,qG*=qb,qt*=qH,qD._addPointArrToRst(q_,qn._getBoundPointS(qW[1]-qG,qW[2]-qt,qL,qC),qF));break;case qR._drawRect:case 13:qD._addPointArrToRst(q_,qn._getBoundPointS(qW[0],qW[1],qW[2],qW[3]),qV);break;case qR._drawCircle:case qR._fillCircle:case 14:qD._addPointArrToRst(q_,qn._getBoundPointS(qW[0]-qW[2],qW[1]-qW[2],qW[2]+qW[2],qW[2]+qW[2]),qV);break;case qR._drawLine:case 20:qD._tempPoints.length=0;var qT;qT=.5*qW[5],qW[0]==qW[2]?qD._tempPoints.push(qW[0]+qT,qW[1],qW[2]+qT,qW[3],qW[0]-qT,qW[1],qW[2]-qT,qW[3]):qW[1]==qW[3]?qD._tempPoints.push(qW[0],qW[1]+qT,qW[2],qW[3]+qT,qW[0],qW[1]-qT,qW[2],qW[3]-qT):qD._tempPoints.push(qW[0],qW[1],qW[2],qW[3]),qD._addPointArrToRst(q_,qD._tempPoints,qV);break;case qR._drawCurves:case 22:qD._addPointArrToRst(q_,qj.I.getBezierPoints(qW[2]),qV,qW[0],qW[1]);break;case qR._drawPoly:case qR._drawLines:case 18:qD._addPointArrToRst(q_,qW[2],qV,qW[0],qW[1]);break;case qR._drawPath:case 19:qD._addPointArrToRst(q_,this._getPathPoints(qW[2]),qV,qW[0],qW[1]);break;case qR._drawPie:case 15:qD._addPointArrToRst(q_,this._getPiePoints(qW[0],qW[1],qW[2],qW[3],qW[4]),qV)}return 200<q_.length?q_=qO.copyArray(q_,qn._getWrapRec(q_)._getBoundPoints()):8<q_.length&&(q_=qQ.scanPList(q_)),q_},qS._switchMatrix=function(qS,q_){q_.concat(qS),q_.copyTo(qS)},qS._getPiePoints=function(qS,q_,qa,qR,qJ){var qV=qD._tempPoints;qD._tempPoints.length=0,qV.push(qS,q_);var qW=(qJ-qR)%(2*Math.PI)/10,qk=NaN,qz=qR;for(qk=0;qk<=10;qk++)qV.push(qS+qa*Math.cos(qz),q_+qa*Math.sin(qz)),qz+=qW;return qV},qS._getPathPoints=function(qS){var q_,qa,qR=0,qJ=qD._tempPoints;for(qJ.length=0,q_=qS.length,qR=0;qR<q_;qR++)1<(qa=qS[qR]).length&&(qJ.push(qa[1],qa[2]),3<qa.length&&qJ.push(qa[3],qa[4]));return qJ},qD._addPointArrToRst=function(qS,q_,qa,qR,qJ){void 0===qR&&(qR=0),void 0===qJ&&(qJ=0);var qV,qW=0;for(qV=q_.length,qW=0;qW<qV;qW+=2)qD._addPointToRst(qS,q_[qW]+qR,q_[qW+1]+qJ,qa)},qD._addPointToRst=function(qS,q_,qa,qR){var qJ=qN.TEMP;qJ.setTo(q_||0,qa||0),qR.transformPoint(qJ),qS.push(qJ.x,qJ.y)},qD._tempPoints=[],qD._tempMatrixArrays=[],qD._tempCmds=[],qz(qD,["_tempMatrix",function(){return this._tempMatrix=new qX},"_initMatrix",function(){return this._initMatrix=new qX}]),qD}(),qV=function(){function qS(){}qo(qS,"laya.events.Event");var q_=qS.prototype;return q_.setTo=function(qS,q_,qa){return this.type=qS,this.currentTarget=q_,this.target=qa,this},q_.stopPropagation=function(){this._stoped=!0},qH(0,q_,"stageY",function(){return qq.stage.mouseY}),qH(0,q_,"charCode",function(){return this.nativeEvent.charCode}),qH(0,q_,"touches",function(){var qS=this.nativeEvent.touches;if(qS)for(var q_=qq.stage,qa=0,qR=qS.length;qa<qR;qa++){var qJ=qS[qa],qV=qN.TEMP;qV.setTo(qJ.clientX,qJ.clientY),q_._canvasTransform.invertTransformPoint(qV),q_.transform.invertTransformPoint(qV),qJ.stageX=qV.x,qJ.stageY=qV.y}return qS}),qH(0,q_,"keyLocation",function(){return this.nativeEvent.keyLocation}),qH(0,q_,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),qH(0,q_,"altKey",function(){return this.nativeEvent.altKey}),qH(0,q_,"shiftKey",function(){return this.nativeEvent.shiftKey}),qH(0,q_,"stageX",function(){return qq.stage.mouseX}),qS.EMPTY=new qS,qS.MOUSE_DOWN="mousedown",qS.MOUSE_UP="mouseup",qS.CLICK="click",qS.RIGHT_MOUSE_DOWN="rightmousedown",qS.RIGHT_MOUSE_UP="rightmouseup",qS.RIGHT_CLICK="rightclick",qS.MOUSE_MOVE="mousemove",qS.MOUSE_OVER="mouseover",qS.MOUSE_OUT="mouseout",qS.MOUSE_WHEEL="mousewheel",qS.ROLL_OVER="mouseover",qS.ROLL_OUT="mouseout",qS.DOUBLE_CLICK="doubleclick",qS.CHANGE="change",qS.CHANGED="changed",qS.RESIZE="resize",qS.ADDED="added",qS.REMOVED="removed",qS.DISPLAY="display",qS.UNDISPLAY="undisplay",qS.ERROR="error",qS.COMPLETE="complete",qS.LOADED="loaded",qS.INITED="inited",qS.PROGRESS="progress",qS.INPUT="input",qS.RENDER="render",qS.OPEN="open",qS.MESSAGE="message",qS.CLOSE="close",qS.KEY_DOWN="keydown",qS.KEY_PRESS="keypress",qS.KEY_UP="keyup",qS.FRAME="enterframe",qS.DRAG_START="dragstart",qS.DRAG_MOVE="dragmove",qS.DRAG_END="dragend",qS.ENTER="enter",qS.SELECT="select",qS.BLUR="blur",qS.FOCUS="focus",qS.VISIBILITY_CHANGE="visibilitychange",qS.FOCUS_CHANGE="focuschange",qS.PLAYED="played",qS.PAUSED="paused",qS.STOPPED="stopped",qS.START="start",qS.END="end",qS.ENABLE_CHANGED="enablechanged",qS.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",qS.COMPONENT_ADDED="componentadded",qS.COMPONENT_REMOVED="componentremoved",qS.LAYER_CHANGED="layerchanged",qS.HIERARCHY_LOADED="hierarchyloaded",qS.RECOVERED="recovered",qS.RELEASED="released",qS.LINK="link",qS.LABEL="label",qS.FULL_SCREEN_CHANGE="fullscreenchange",qS.DEVICE_LOST="devicelost",qS.MESH_CHANGED="meshchanged",qS.MATERIAL_CHANGED="materialchanged",qS.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",qS.ANIMATION_CHANGED="animationchanged",qS.TRIGGER_ENTER="triggerenter",qS.TRIGGER_STAY="triggerstay",qS.TRIGGER_EXIT="triggerexit",qS.TRAIL_FILTER_CHANGE="trailfilterchange",qS.DOMINO_FILTER_CHANGE="dominofilterchange",qS}(),qL=(function(){function qS(){}qo(qS,"laya.events.Keyboard"),qS.NUMBER_0=48,qS.NUMBER_1=49,qS.NUMBER_2=50,qS.NUMBER_3=51,qS.NUMBER_4=52,qS.NUMBER_5=53,qS.NUMBER_6=54,qS.NUMBER_7=55,qS.NUMBER_8=56,qS.NUMBER_9=57,qS.A=65,qS.B=66,qS.C=67,qS.D=68,qS.E=69,qS.F=70,qS.G=71,qS.H=72,qS.I=73,qS.J=74,qS.K=75,qS.L=76,qS.M=77,qS.N=78,qS.O=79,qS.P=80,qS.Q=81,qS.R=82,qS.S=83,qS.T=84,qS.U=85,qS.V=86,qS.W=87,qS.X=88,qS.Y=89,qS.Z=90,qS.F1=112,qS.F2=113,qS.F3=114,qS.F4=115,qS.F5=116,qS.F6=117,qS.F7=118,qS.F8=119,qS.F9=120,qS.F10=121,qS.F11=122,qS.F12=123,qS.F13=124,qS.F14=125,qS.F15=126,qS.NUMPAD=21,qS.NUMPAD_0=96,qS.NUMPAD_1=97,qS.NUMPAD_2=98,qS.NUMPAD_3=99,qS.NUMPAD_4=100,qS.NUMPAD_5=101,qS.NUMPAD_6=102,qS.NUMPAD_7=103,qS.NUMPAD_8=104,qS.NUMPAD_9=105,qS.NUMPAD_ADD=107,qS.NUMPAD_DECIMAL=110,qS.NUMPAD_DIVIDE=111,qS.NUMPAD_ENTER=108,qS.NUMPAD_MULTIPLY=106,qS.NUMPAD_SUBTRACT=109,qS.SEMICOLON=186,qS.EQUAL=187,qS.COMMA=188,qS.MINUS=189,qS.PERIOD=190,qS.SLASH=191,qS.BACKQUOTE=192,qS.LEFTBRACKET=219,qS.BACKSLASH=220,qS.RIGHTBRACKET=221,qS.QUOTE=222,qS.ALTERNATE=18,qS.BACKSPACE=8,qS.CAPS_LOCK=20,qS.COMMAND=15,qS.CONTROL=17,qS.DELETE=46,qS.ENTER=13,qS.ESCAPE=27,qS.PAGE_UP=33,qS.PAGE_DOWN=34,qS.END=35,qS.HOME=36,qS.LEFT=37,qS.UP=38,qS.RIGHT=39,qS.DOWN=40,qS.SHIFT=16,qS.SPACE=32,qS.TAB=9,qS.INSERT=45}(),function(){function qJ(){}return qo(qJ,"laya.events.KeyBoardManager"),qJ.__init__=function(){qJ._addEvent("keydown"),qJ._addEvent("keypress"),qJ._addEvent("keyup")},qJ._addEvent=function(q_){qg.document.addEventListener(q_,function(qS){laya.events.KeyBoardManager._dispatch(qS,q_)},!0)},qJ._dispatch=function(qS,q_){if(qJ.enabled){qJ._event._stoped=!1,qJ._event.nativeEvent=qS,qJ._event.keyCode=qS.keyCode||qS.which||qS.charCode,"keydown"===q_?qJ._pressKeys[qJ._event.keyCode]=!0:"keyup"===q_&&(qJ._pressKeys[qJ._event.keyCode]=null);for(var qa=qq.stage.focus&&null!=qq.stage.focus.event&&qq.stage.focus.displayedInStage?qq.stage.focus:qq.stage,qR=qa;qR;)qR.event(q_,qJ._event.setTo(q_,qR,qa)),qR=qR.parent}},qJ.hasKeyDown=function(qS){return qJ._pressKeys[qS]},qJ._pressKeys={},qJ.enabled=!0,qz(qJ,["_event",function(){return this._event=new qV}]),qJ}()),qt=(function(){function qS(){}qo(qS,"laya.events.KeyLocation"),qS.STANDARD=0,qS.LEFT=1,qS.RIGHT=2,qS.NUM_PAD=3}(),function(){function qH(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=qg.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new qV,this._matrix=new qX,this._point=new qN,this._rect=new qn,this._prePoint=new qN,this._curTouchID=NaN}qo(qH,"laya.events.MouseManager");var qS=qH.prototype;return qS.__init__=function(qS,q_){var qa=this;this._stage=qS;var qR=this,qJ=this._eventList;q_.oncontextmenu=function(qS){if(qH.enabled)return!1},q_.addEventListener("mousedown",function(qS){qH.enabled&&(qg.onIE||qS.preventDefault(),qJ.push(qS),qR.mouseDownTime=qg.now())}),q_.addEventListener("mouseup",function(qS){qH.enabled&&(qS.preventDefault(),qJ.push(qS),qR.mouseDownTime=-qg.now())},!0),q_.addEventListener("mousemove",function(qS){if(qH.enabled){qS.preventDefault();var q_=qg.now();if(q_-qR._lastMoveTimer<10)return;qR._lastMoveTimer=q_,qJ.push(qS)}},!0),q_.addEventListener("mouseout",function(qS){qH.enabled&&qJ.push(qS)}),q_.addEventListener("mouseover",function(qS){qH.enabled&&qJ.push(qS)}),q_.addEventListener("touchstart",function(qS){qH.enabled&&(qJ.push(qS),qH._isFirstTouch||qQS.isInputting||qS.preventDefault(),qR.mouseDownTime=qg.now())}),q_.addEventListener("touchend",function(qS){qH.enabled?(qH._isFirstTouch||qQS.isInputting||qS.preventDefault(),qH._isFirstTouch=!1,qJ.push(qS),qR.mouseDownTime=-qg.now()):qa._curTouchID=NaN},!0),q_.addEventListener("touchmove",function(qS){qH.enabled&&(qS.preventDefault(),qJ.push(qS))},!0),q_.addEventListener("touchcancel",function(qS){qH.enabled?(qS.preventDefault(),qJ.push(qS)):qa._curTouchID=NaN},!0),q_.addEventListener("mousewheel",function(qS){qH.enabled&&qJ.push(qS)}),q_.addEventListener("DOMMouseScroll",function(qS){qH.enabled&&qJ.push(qS)})},qS.initEvent=function(qS,q_){var qa;this._event._stoped=!1,this._event.nativeEvent=q_||qS,this._target=null,this._point.setTo(qS.pageX||qS.clientX,qS.pageY||qS.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=qS.identifier||0,this._tTouchID=this._event.touchId,(qa=q$.I._event)._stoped=!1,qa.nativeEvent=this._event.nativeEvent,qa.touchId=this._event.touchId},qS.checkMouseWheel=function(qS){this._event.delta=qS.wheelDelta?.025*qS.wheelDelta:-qS.detail;for(var q_=q$.I.getLastOvers(),qa=0,qR=q_.length;qa<qR;qa++){var qJ=q_[qa];qJ.event("mousewheel",this._event.setTo("mousewheel",qJ,this._target))}},qS.onMouseMove=function(qS){q$.I.onMouseMove(qS,this._tTouchID)},qS.onMouseDown=function(qS){if(qQS.isInputting&&qq.stage.focus&&qq.stage.focus.focus&&!qq.stage.focus.contains(this._target)){var q_=qq.stage.focus._tf||qq.stage.focus,qa=qS._tf||qS;qa instanceof laya.display.Input&&qa.multiline==q_.multiline?q_._focusOut():q_.focus=!1}q$.I.onMouseDown(qS,this._tTouchID,this._isLeftMouse)},qS.onMouseUp=function(qS){q$.I.onMouseUp(qS,this._tTouchID,this._isLeftMouse)},qS.check=function(qS,q_,qa,qR){this._point.setTo(q_,qa),qS.fromParentPoint(this._point),q_=this._point.x,qa=this._point.y;var qJ=qS.scrollRect;if(qJ&&(this._rect.setTo(qJ.x,qJ.y,qJ.width,qJ.height),!this._rect.contains(q_,qa)))return!1;if(!this.disableMouseEvent){if(qS.hitTestPrior&&!qS.mouseThrough&&!this.hitTest(qS,q_,qa))return!1;for(var qV=qS._childs.length-1;-1<qV;qV--){var qW=qS._childs[qV];if(!qW.destroyed&&qW.mouseEnabled&&qW.visible&&this.check(qW,q_,qa,qR))return!0}}var qk=!(!qS.hitTestPrior||qS.mouseThrough||this.disableMouseEvent)||this.hitTest(qS,q_,qa);return qk?(this._target=qS,qR.call(this,qS)):qR===this.onMouseUp&&qS===this._stage&&(this._target=this._stage,qR.call(this,this._target)),qk},qS.hitTest=function(qS,q_,qa){var qR=!1;if(qS.scrollRect&&(q_-=qS.scrollRect.x,qa-=qS.scrollRect.y),qS.hitArea instanceof laya.utils.HitArea)return qS.hitArea.isHit(q_,qa);if(0<qS.width&&0<qS.height||qS.mouseThrough||qS.hitArea)if(qS.mouseThrough)qR=qS.getGraphicBounds().contains(q_,qa);else{var qJ=this._rect;qS.hitArea?qJ=qS.hitArea:qJ.setTo(0,0,qS.width,qS.height),qR=qJ.contains(q_,qa)}return qR},qS.runEvent=function(){var qS=this._eventList.length;if(qS){var q_=this;q_.mouseEventTime=qg.now();var qa,qR=0,qJ=0,qV=0;try{for(;qR<qS;){var qW=this._eventList[qR];switch("mousemove"!==qW.type&&(this._prePoint.x=this._prePoint.y=-1e6),qW.type){case"mousedown":this._touchIDs[0]=this._id++,qH._isTouchRespond?qH._isTouchRespond=!1:(q_._isLeftMouse=0===qW.button,q_.initEvent(qW),q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseDown));break;case"mouseup":q_._isLeftMouse=0===qW.button,q_.initEvent(qW),q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-qW.clientX)+Math.abs(this._prePoint.y-qW.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=qW.clientX,this._prePoint.y=qW.clientY,q_.initEvent(qW),q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseMove));break;case"touchstart":qH._isTouchRespond=!0,q_._isLeftMouse=!0;var qk=qW.changedTouches;for(qJ=0,qV=qk.length;qJ<qV;qJ++)qa=qk[qJ],(qH.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=qa.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[qa.identifier]=this._id++,q_.initEvent(qa,qW),q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseDown));break;case"touchend":case"touchcancel":qH._isTouchRespond=!0,q_._isLeftMouse=!0;var qz=qW.changedTouches;for(qJ=0,qV=qz.length;qJ<qV;qJ++)if(qa=qz[qJ],qH.multiTouchEnabled||qa.identifier==this._curTouchID){this._curTouchID=NaN,q_.initEvent(qa,qW);q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseUp)||q_.onMouseUp(null)}break;case"touchmove":var qb=qW.changedTouches;for(qJ=0,qV=qb.length;qJ<qV;qJ++)qa=qb[qJ],(qH.multiTouchEnabled||qa.identifier==this._curTouchID)&&(q_.initEvent(qa,qW),q_.check(q_._stage,q_.mouseX,q_.mouseY,q_.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":q_.checkMouseWheel(qW);break;case"mouseout":q$.I.stageMouseOut();break;case"mouseover":q_._stage.event("mouseover",q_._event.setTo("mouseover",q_._stage,q_._stage))}qR++}}catch(qS){throw this._eventList.length=0,qS}this._eventList.length=0}},qH.enabled=!0,qH.multiTouchEnabled=!0,qH._isTouchRespond=!1,qH._isFirstTouch=!0,qz(qH,["instance",function(){return this.instance=new qH}]),qH}()),q$=function(){function qt(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new qV}qo(qt,"laya.events.TouchManager");var qS=qt.prototype;return qS._clearTempArrs=function(){qt._oldArr.length=0,qt._newArr.length=0,qt._tEleArr.length=0},qS.getTouchFromArr=function(qS,q_){var qa,qR,qJ=0;for(qa=q_.length,qJ=0;qJ<qa;qJ++)if((qR=q_[qJ]).id==qS)return qR;return null},qS.removeTouchFromArr=function(qS,q_){var qa=0;for(qa=q_.length-1;0<=qa;qa--)q_[qa].id==qS&&q_.splice(qa,1)},qS.createTouchO=function(qS,q_){var qa;return(qa=qp.getItem("TouchData")||{}).id=q_,qa.tar=qS,qa},qS.onMouseDown=function(qS,q_,qa){var qR,qJ,qV,qW;(void 0===qa&&(qa=!1),this.enable)&&(qR=this.getTouchFromArr(q_,this.preOvers),qV=this.getEles(qS,null,qt._tEleArr),qR?qR.tar=qS:(qJ=this.createTouchO(qS,q_),this.preOvers.push(qJ)),qg.onMobile&&this.sendEvents(qV,"mouseover",q_),qW=qa?this.preDowns:this.preRightDowns,(qR=this.getTouchFromArr(q_,qW))?qR.tar=qS:(qJ=this.createTouchO(qS,q_),qW.push(qJ)),this.sendEvents(qV,qa?"mousedown":"rightmousedown",q_),this._clearTempArrs())},qS.sendEvents=function(qS,q_,qa){void 0===qa&&(qa=0);var qR,qJ,qV,qW=0;for(qR=qS.length,this._event._stoped=!1,qJ=qS[0],qW=0;qW<qR;qW++){if((qV=qS[qW]).destroyed)return;if(qV.event(q_,this._event.setTo(q_,qV,qJ)),this._event._stoped)break}},qS.getEles=function(qS,q_,qa){for(qa?qa.length=0:qa=[];qS&&qS!=q_;)qa.push(qS),qS=qS.parent;return qa},qS.checkMouseOutAndOverOfMove=function(qS,q_,qa){if(void 0===qa&&(qa=0),q_!=qS){var qR,qJ,qV=0,qW=0;if(q_.contains(qS))qJ=this.getEles(qS,q_,qt._tEleArr),this.sendEvents(qJ,"mouseover",qa);else if(qS.contains(q_))qJ=this.getEles(q_,qS,qt._tEleArr),this.sendEvents(qJ,"mouseout",qa);else{var qk,qz;(qJ=qt._tEleArr).length=0,qk=this.getEles(q_,null,qt._oldArr),qz=this.getEles(qS,null,qt._newArr),qW=qk.length;var qb=0;for(qV=0;qV<qW;qV++){if(qR=qk[qV],0<=(qb=qz.indexOf(qR))){qz.splice(qb,qz.length-qb);break}qJ.push(qR)}0<qJ.length&&this.sendEvents(qJ,"mouseout",qa),0<qz.length&&this.sendEvents(qz,"mouseover",qa)}}},qS.onMouseMove=function(qS,q_){var qa,qR;this.enable&&((qa=this.getTouchFromArr(q_,this.preOvers))?(this.checkMouseOutAndOverOfMove(qS,qa.tar),qa.tar=qS,qR=this.getEles(qS,null,qt._tEleArr)):(qR=this.getEles(qS,null,qt._tEleArr),this.sendEvents(qR,"mouseover",q_),this.preOvers.push(this.createTouchO(qS,q_))),this.sendEvents(qR,"mousemove",q_),this._clearTempArrs())},qS.getLastOvers=function(){return(qt._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,qt._tEleArr):(qt._tEleArr.push(qq.stage),qt._tEleArr)},qS.stageMouseOut=function(){var qS;qS=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(qS,"mouseout",0)},qS.onMouseUp=function(qS,q_,qa){if(void 0===qa&&(qa=!1),this.enable){var qR,qJ,qV,qW,qk,qz,qb=0,qH=0,qL=qg.onMobile;if(qJ=this.getEles(qS,null,qt._tEleArr),this.sendEvents(qJ,qa?"mouseup":"rightmouseup",q_),qz=qa?this.preDowns:this.preRightDowns,qR=this.getTouchFromArr(q_,qz)){var qC,qG=qg.now();if(qC=qG-this._lastClickTime<300,this._lastClickTime=qG,qS==qR.tar)qk=qJ;else for(qV=this.getEles(qR.tar,null,qt._oldArr),(qk=qt._newArr).length=0,qH=qV.length,qb=0;qb<qH;qb++)qW=qV[qb],0<=qJ.indexOf(qW)&&qk.push(qW);0<qk.length&&this.sendEvents(qk,qa?"click":"rightclick",q_),qa&&qC&&this.sendEvents(qk,"doubleclick",q_),this.removeTouchFromArr(q_,qz),qR.tar=null,qp.recover("TouchData",qR)}else;(qR=this.getTouchFromArr(q_,this.preOvers))&&qL&&((qk=this.getEles(qR.tar,null,qk))&&0<qk.length&&this.sendEvents(qk,"mouseout",q_),this.removeTouchFromArr(q_,this.preOvers),qR.tar=null,qp.recover("TouchData",qR)),this._clearTempArrs()}},qt._oldArr=[],qt._newArr=[],qt._tEleArr=[],qz(qt,["I",function(){return this.I=new qt}]),qt}(),qF=function(){function qS(){this._action=null}qo(qS,"laya.filters.Filter");var q_=qS.prototype;return qq.imps(q_,{"laya.filters.IFilter":!0}),q_.callNative=function(qS){},qH(0,q_,"type",function(){return-1}),qH(0,q_,"action",function(){return this._action}),qS.BLUR=16,qS.COLOR=32,qS.GLOW=8,qS._filterStart=null,qS._filterEnd=null,qS._EndTarget=null,qS._recycleScope=null,qS._filter=null,qS._useSrc=null,qS._endSrc=null,qS._useOut=null,qS._endOut=null,qS}(),qD=function(){function qS(){this.data=null}qo(qS,"laya.filters.ColorFilterAction");var q_=qS.prototype;return qq.imps(q_,{"laya.filters.IFilterAction":!0}),q_.apply=function(qS){var q_=qS.ctx.ctx,qa=qS.ctx.ctx.canvas;if(0==qa.width||0==qa.height)return qa;for(var qR,qJ=q_.getImageData(0,0,qa.width,qa.height),qV=qJ.data,qW=0,qk=qV.length;qW<qk;qW+=4)qR=this.getColor(qV[qW],qV[qW+1],qV[qW+2],qV[qW+3]),0!=qV[qW+3]&&(qV[qW]=qR[0],qV[qW+1]=qR[1],qV[qW+2]=qR[2],qV[qW+3]=qR[3]);return q_.putImageData(qJ,0,0),qS},q_.getColor=function(qS,q_,qa,qR){var qJ=[];if(this.data._mat&&this.data._alpha){var qV=this.data._mat,qW=this.data._alpha;qJ[0]=qV[0]*qS+qV[1]*q_+qV[2]*qa+qV[3]*qR+qW[0],qJ[1]=qV[4]*qS+qV[5]*q_+qV[6]*qa+qV[7]*qR+qW[1],qJ[2]=qV[8]*qS+qV[9]*q_+qV[10]*qa+qV[11]*qR+qW[2],qJ[3]=qV[12]*qS+qV[13]*q_+qV[14]*qa+qV[15]*qR+qW[3]}return qJ},qS}(),qj=(function(){function qS(){}qo(qS,"laya.maths.Arith"),qS.formatR=function(qS){return qS>Math.PI&&(qS-=2*Math.PI),qS<-Math.PI&&(qS+=2*Math.PI),qS},qS.isPOT=function(qS,q_){return 0<qS&&0==(qS&qS-1)&&0<q_&&0==(q_&q_-1)},qS.setMatToArray=function(qS,q_){qS.a,qS.b,qS.c,qS.d,qS.tx,qS.ty,q_[0]=qS.a,q_[1]=qS.b,q_[4]=qS.c,q_[5]=qS.d,q_[12]=qS.tx,q_[13]=qS.ty}}(),function(){function qS(){this._controlPoints=[new qN,new qN,new qN],this._calFun=this.getPoint2}qo(qS,"laya.maths.Bezier");var q_=qS.prototype;return q_._switchPoint=function(qS,q_){var qa=this._controlPoints.shift();qa.setTo(qS,q_),this._controlPoints.push(qa)},q_.getPoint2=function(qS,q_){var qa=this._controlPoints[0],qR=this._controlPoints[1],qJ=this._controlPoints[2],qV=Math.pow(1-qS,2)*qa.x+2*qS*(1-qS)*qR.x+Math.pow(qS,2)*qJ.x,qW=Math.pow(1-qS,2)*qa.y+2*qS*(1-qS)*qR.y+Math.pow(qS,2)*qJ.y;q_.push(qV,qW)},q_.getPoint3=function(qS,q_){var qa=this._controlPoints[0],qR=this._controlPoints[1],qJ=this._controlPoints[2],qV=this._controlPoints[3],qW=Math.pow(1-qS,3)*qa.x+3*qR.x*qS*(1-qS)*(1-qS)+3*qJ.x*qS*qS*(1-qS)+qV.x*Math.pow(qS,3),qk=Math.pow(1-qS,3)*qa.y+3*qR.y*qS*(1-qS)*(1-qS)+3*qJ.y*qS*qS*(1-qS)+qV.y*Math.pow(qS,3);q_.push(qW,qk)},q_.insertPoints=function(qS,q_){var qa,qR=NaN;for(qa=1/(qS=0<qS?qS:5),qR=0;qR<=1;qR+=qa)this._calFun(qR,q_)},q_.getBezierPoints=function(qS,q_,qa){void 0===q_&&(q_=5),void 0===qa&&(qa=2);var qR,qJ,qV=0;if((qR=qS.length)<2*(qa+1))return[];switch(qJ=[],qa){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=qa;)this._controlPoints.push(new qN);for(qV=0;qV<2*qa;qV+=2)this._switchPoint(qS[qV],qS[qV+1]);for(qV=2*qa;qV<qR;qV+=2)this._switchPoint(qS[qV],qS[qV+1]),qV/2%qa==0&&this.insertPoints(q_,qJ);return qJ},qz(qS,["I",function(){return this.I=new qS}]),qS}()),qQ=function(){function qb(){}return qo(qb,"laya.maths.GrahamScan"),qb.multiply=function(qS,q_,qa){return(qS.x-qa.x)*(q_.y-qa.y)-(q_.x-qa.x)*(qS.y-qa.y)},qb.dis=function(qS,q_){return(qS.x-q_.x)*(qS.x-q_.x)+(qS.y-q_.y)*(qS.y-q_.y)},qb._getPoints=function(qS,q_,qa){for(void 0===q_&&(q_=!1),qb._mPointList||(qb._mPointList=[]);qb._mPointList.length<qS;)qb._mPointList.push(new qN);return qa||(qa=[]),qa.length=0,q_?qb.getFrom(qa,qb._mPointList,qS):qb.getFromR(qa,qb._mPointList,qS),qa},qb.getFrom=function(qS,q_,qa){var qR=0;for(qR=0;qR<qa;qR++)qS.push(q_[qR]);return qS},qb.getFromR=function(qS,q_,qa){var qR=0;for(qR=0;qR<qa;qR++)qS.push(q_.pop());return qS},qb.pListToPointList=function(qS,q_){void 0===q_&&(q_=!1);var qa=0,qR=qS.length/2,qJ=qb._getPoints(qR,q_,qb._tempPointList);for(qa=0;qa<qR;qa++)qJ[qa].setTo(qS[qa+qa],qS[qa+qa+1]);return qJ},qb.pointListToPlist=function(qS){var q_,qa=0,qR=qS.length,qJ=qb._temPList;for(qa=qJ.length=0;qa<qR;qa++)q_=qS[qa],qJ.push(q_.x,q_.y);return qJ},qb.scanPList=function(qS){return qO.copyArray(qS,qb.pointListToPlist(qb.scan(qb.pListToPointList(qS,!0))))},qb.scan=function(qS){var q_,qa,qR,qJ=0,qV=0,qW=0,qk=qS.length,qz={};for((qa=qb._temArr).length=0,qJ=(qk=qS.length)-1;0<=qJ;qJ--)qR=(q_=qS[qJ]).x+"_"+q_.y,qz.hasOwnProperty(qR)||(qz[qR]=!0,qa.push(q_));for(qk=qa.length,qO.copyArray(qS,qa),qJ=1;qJ<qk;qJ++)(qS[qJ].y<qS[qW].y||qS[qJ].y==qS[qW].y&&qS[qJ].x<qS[qW].x)&&(qW=qJ);for(q_=qS[0],qS[0]=qS[qW],qS[qW]=q_,qJ=1;qJ<qk-1;qJ++){for(qV=(qW=qJ)+1;qV<qk;qV++)(0<qb.multiply(qS[qV],qS[qW],qS[0])||0==qb.multiply(qS[qV],qS[qW],qS[0])&&qb.dis(qS[0],qS[qV])<qb.dis(qS[0],qS[qW]))&&(qW=qV);q_=qS[qJ],qS[qJ]=qS[qW],qS[qW]=q_}if((qa=qb._temArr).length=0,qS.length<3)return qO.copyArray(qa,qS);for(qa.push(qS[0],qS[1],qS[2]),qJ=3;qJ<qk;qJ++){for(;2<=qa.length&&0<=qb.multiply(qS[qJ],qa[qa.length-1],qa[qa.length-2]);)qa.pop();qS[qJ]&&qa.push(qS[qJ])}return qa},qb._mPointList=null,qb._tempPointList=[],qb._temPList=[],qb._temArr=[],qb}(),qm=function(){function qJ(){}return qo(qJ,"laya.maths.MathUtil"),qJ.subtractVector3=function(qS,q_,qa){qa[0]=qS[0]-q_[0],qa[1]=qS[1]-q_[1],qa[2]=qS[2]-q_[2]},qJ.lerp=function(qS,q_,qa){return qS*(1-qa)+q_*qa},qJ.scaleVector3=function(qS,q_,qa){qa[0]=qS[0]*q_,qa[1]=qS[1]*q_,qa[2]=qS[2]*q_},qJ.lerpVector3=function(qS,q_,qa,qR){var qJ=qS[0],qV=qS[1],qW=qS[2];qR[0]=qJ+qa*(q_[0]-qJ),qR[1]=qV+qa*(q_[1]-qV),qR[2]=qW+qa*(q_[2]-qW)},qJ.lerpVector4=function(qS,q_,qa,qR){var qJ=qS[0],qV=qS[1],qW=qS[2],qk=qS[3];qR[0]=qJ+qa*(q_[0]-qJ),qR[1]=qV+qa*(q_[1]-qV),qR[2]=qW+qa*(q_[2]-qW),qR[3]=qk+qa*(q_[3]-qk)},qJ.slerpQuaternionArray=function(qS,q_,qa,qR,qJ,qV,qW){var qk,qz,qb,qH,qL,qC=qS[q_+0],qG=qS[q_+1],qt=qS[q_+2],qo=qS[q_+3],q$=qa[qR+0],qF=qa[qR+1],qT=qa[qR+2],qD=qa[qR+3];return(qz=qC*q$+qG*qF+qt*qT+qo*qD)<0&&(qz=-qz,q$=-q$,qF=-qF,qT=-qT,qD=-qD),qL=1e-6<1-qz?(qk=Math.acos(qz),qb=Math.sin(qk),qH=Math.sin((1-qJ)*qk)/qb,Math.sin(qJ*qk)/qb):(qH=1-qJ,qJ),qV[qW+0]=qH*qC+qL*q$,qV[qW+1]=qH*qG+qL*qF,qV[qW+2]=qH*qt+qL*qT,qV[qW+3]=qH*qo+qL*qD,qV},qJ.getRotation=function(qS,q_,qa,qR){return Math.atan2(qR-q_,qa-qS)/Math.PI*180},qJ.sortBigFirst=function(qS,q_){return qS==q_?0:qS<q_?1:-1},qJ.sortSmallFirst=function(qS,q_){return qS==q_?0:qS<q_?-1:1},qJ.sortNumBigFirst=function(qS,q_){return parseFloat(q_)-parseFloat(qS)},qJ.sortNumSmallFirst=function(qS,q_){return parseFloat(qS)-parseFloat(q_)},qJ.sortByKey=function(qa,qS,q_){var qR;return void 0===qS&&(qS=!1),void 0===q_&&(q_=!0),qR=qS?q_?qJ.sortNumBigFirst:qJ.sortBigFirst:q_?qJ.sortNumSmallFirst:qJ.sortSmallFirst,function(qS,q_){return qR(qS[qa],q_[qa])}},qJ}(),qX=function(){function qa(qS,q_,qa,qR,qJ,qV){this.inPool=!1,this.bTransform=!1,void 0===qS&&(qS=1),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=1),void 0===qJ&&(qJ=0),void 0===qV&&(qV=0),this.a=qS,this.b=q_,this.c=qa,this.d=qR,this.tx=qJ,this.ty=qV,this._checkTransform()}qo(qa,"laya.maths.Matrix");var qS=qa.prototype;return qS.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},qS._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},qS.setTranslate=function(qS,q_){return this.tx=qS,this.ty=q_,this},qS.translate=function(qS,q_){return this.tx+=qS,this.ty+=q_,this},qS.scale=function(qS,q_){this.a*=qS,this.d*=q_,this.c*=qS,this.b*=q_,this.tx*=qS,this.ty*=q_,this.bTransform=!0},qS.rotate=function(qS){var q_=Math.cos(qS),qa=Math.sin(qS),qR=this.a,qJ=this.c,qV=this.tx;this.a=qR*q_-this.b*qa,this.b=qR*qa+this.b*q_,this.c=qJ*q_-this.d*qa,this.d=qJ*qa+this.d*q_,this.tx=qV*q_-this.ty*qa,this.ty=qV*qa+this.ty*q_,this.bTransform=!0},qS.skew=function(qS,q_){var qa=Math.tan(qS),qR=Math.tan(q_),qJ=this.a,qV=this.b;return this.a+=qR*this.c,this.b+=qR*this.d,this.c+=qa*qJ,this.d+=qa*qV,this},qS.invertTransformPoint=function(qS){var q_=this.a,qa=this.b,qR=this.c,qJ=this.d,qV=this.tx,qW=q_*qJ-qa*qR,qk=qJ/qW,qz=-qa/qW,qb=-qR/qW,qH=q_/qW,qL=(qR*this.ty-qJ*qV)/qW,qC=-(q_*this.ty-qa*qV)/qW;return qS.setTo(qk*qS.x+qb*qS.y+qL,qz*qS.x+qH*qS.y+qC)},qS.transformPoint=function(qS){return qS.setTo(this.a*qS.x+this.c*qS.y+this.tx,this.b*qS.x+this.d*qS.y+this.ty)},qS.transformPointN=function(qS){return qS.setTo(this.a*qS.x+this.c*qS.y,this.b*qS.x+this.d*qS.y)},qS.transformPointArray=function(qS,q_){for(var qa=qS.length,qR=0;qR<qa;qR+=2){var qJ=qS[qR],qV=qS[qR+1];q_[qR]=this.a*qJ+this.c*qV+this.tx,q_[qR+1]=this.b*qJ+this.d*qV+this.ty}return q_},qS.transformPointArrayScale=function(qS,q_){for(var qa=qS.length,qR=0;qR<qa;qR+=2){var qJ=qS[qR],qV=qS[qR+1];q_[qR]=this.a*qJ+this.c*qV,q_[qR+1]=this.b*qJ+this.d*qV}return q_},qS.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},qS.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},qS.invert=function(){var qS=this.a,q_=this.b,qa=this.c,qR=this.d,qJ=this.tx,qV=qS*qR-q_*qa;return this.a=qR/qV,this.b=-q_/qV,this.c=-qa/qV,this.d=qS/qV,this.tx=(qa*this.ty-qR*qJ)/qV,this.ty=-(qS*this.ty-q_*qJ)/qV,this},qS.setTo=function(qS,q_,qa,qR,qJ,qV){return this.a=qS,this.b=q_,this.c=qa,this.d=qR,this.tx=qJ,this.ty=qV,this},qS.concat=function(qS){var q_=this.a,qa=this.c,qR=this.tx;return this.a=q_*qS.a+this.b*qS.c,this.b=q_*qS.b+this.b*qS.d,this.c=qa*qS.a+this.d*qS.c,this.d=qa*qS.b+this.d*qS.d,this.tx=qR*qS.a+this.ty*qS.c+qS.tx,this.ty=qR*qS.b+this.ty*qS.d+qS.ty,this},qS.scaleEx=function(qS,q_){var qa=this.a,qR=this.b,qJ=this.c,qV=this.d;0!==qR||0!==qJ?(this.a=qS*qa,this.b=qS*qR,this.c=q_*qJ):(this.a=qS*qa,this.b=0*qV,this.c=0*qa),this.d=q_*qV,this.bTransform=!0},qS.rotateEx=function(qS){var q_=Math.cos(qS),qa=Math.sin(qS),qR=this.a,qJ=this.b,qV=this.c,qW=this.d;0!==qJ||0!==qV?(this.a=q_*qR+qa*qV,this.b=q_*qJ+qa*qW,this.c=-qa*qR+q_*qV,this.d=-qa*qJ+q_*qW):(this.a=q_*qR,this.b=qa*qW,this.c=-qa*qR,this.d=q_*qW),this.bTransform=!0},qS.clone=function(){var qS=qa.create();return qS.a=this.a,qS.b=this.b,qS.c=this.c,qS.d=this.d,qS.tx=this.tx,qS.ty=this.ty,qS.bTransform=this.bTransform,qS},qS.copyTo=function(qS){return qS.a=this.a,qS.b=this.b,qS.c=this.c,qS.d=this.d,qS.tx=this.tx,qS.ty=this.ty,qS.bTransform=this.bTransform,qS},qS.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},qS.destroy=function(){if(!this.inPool){var qS=qa._cache;this.inPool=!0,qS._length||(qS._length=0),(qS[qS._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},qa.mul=function(qS,q_,qa){var qR=qS.a,qJ=qS.b,qV=qS.c,qW=qS.d,qk=qS.tx,qz=qS.ty,qb=q_.a,qH=q_.b,qL=q_.c,qC=q_.d,qG=q_.tx,qt=q_.ty;return 0!==qH||0!==qL?(qa.a=qR*qb+qJ*qL,qa.b=qR*qH+qJ*qC,qa.c=qV*qb+qW*qL,qa.d=qV*qH+qW*qC,qa.tx=qb*qk+qL*qz+qG,qa.ty=qH*qk+qC*qz+qt):(qa.a=qR*qb,qa.b=qJ*qC,qa.c=qV*qb,qa.d=qW*qC,qa.tx=qb*qk+qG,qa.ty=qC*qz+qt),qa},qa.mul16=function(qS,q_,qa){var qR=qS.a,qJ=qS.b,qV=qS.c,qW=qS.d,qk=qS.tx,qz=qS.ty,qb=q_.a,qH=q_.b,qL=q_.c,qC=q_.d,qG=q_.tx,qt=q_.ty;return 0!==qH||0!==qL?(qa[0]=qR*qb+qJ*qL,qa[1]=qR*qH+qJ*qC,qa[4]=qV*qb+qW*qL,qa[5]=qV*qH+qW*qC,qa[12]=qb*qk+qL*qz+qG,qa[13]=qH*qk+qC*qz+qt):(qa[0]=qR*qb,qa[1]=qJ*qC,qa[4]=qV*qb,qa[5]=qW*qC,qa[12]=qb*qk+qG,qa[13]=qC*qz+qt),qa},qa.mulPre=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=qS.a,qb=qS.b,qH=qS.c,qL=qS.d,qC=qS.tx,qG=qS.ty;return 0!==qa||0!==qR?(qk.a=qz*q_+qb*qR,qk.b=qz*qa+qb*qJ,qk.c=qH*q_+qL*qR,qk.d=qH*qa+qL*qJ,qk.tx=q_*qC+qR*qG+qV,qk.ty=qa*qC+qJ*qG+qW):(qk.a=qz*q_,qk.b=qb*qJ,qk.c=qH*q_,qk.d=qL*qJ,qk.tx=q_*qC+qV,qk.ty=qJ*qG+qW),qk},qa.mulPos=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=qS.a,qb=qS.b,qH=qS.c,qL=qS.d,qC=qS.tx,qG=qS.ty;return 0!==qb||0!==qH?(qk.a=q_*qz+qa*qH,qk.b=q_*qb+qa*qL,qk.c=qR*qz+qJ*qH,qk.d=qR*qb+qJ*qL,qk.tx=qz*qV+qH*qW+qC,qk.ty=qb*qV+qL*qW+qG):(qk.a=q_*qz,qk.b=qa*qL,qk.c=qR*qz,qk.d=qJ*qL,qk.tx=qz*qV+qC,qk.ty=qL*qW+qG),qk},qa.preMul=function(qS,q_,qa){var qR=qS.a,qJ=qS.b,qV=qS.c,qW=qS.d,qk=q_.a,qz=q_.b,qb=q_.c,qH=q_.d,qL=q_.tx,qC=q_.ty;return qa.a=qk*qR,qa.b=qa.c=0,qa.d=qH*qW,qa.tx=qL*qR+qS.tx,qa.ty=qC*qW+qS.ty,0===qz&&0===qb&&0===qJ&&0===qV||(qa.a+=qz*qV,qa.d+=qb*qJ,qa.b+=qk*qJ+qz*qW,qa.c+=qb*qR+qH*qV,qa.tx+=qC*qV,qa.ty+=qL*qJ),qa},qa.preMulXY=function(qS,q_,qa,qR){var qJ=qS.a,qV=qS.b,qW=qS.c,qk=qS.d;return qR.a=qJ,qR.b=qV,qR.c=qW,qR.d=qk,qR.tx=q_*qJ+qS.tx+qa*qW,qR.ty=qa*qk+qS.ty+q_*qV,qR},qa.create=function(){var qS=qa._cache,q_=qS._length?qS[--qS._length]:new qa;return q_.inPool=!1,q_},qa.EMPTY=new qa,qa.TEMP=new qa,qa._cache=[],qa}(),qN=function(){function qS(qS,q_){void 0===qS&&(qS=0),void 0===q_&&(q_=0),this.x=qS,this.y=q_}qo(qS,"laya.maths.Point");var q_=qS.prototype;return q_.setTo=function(qS,q_){return this.x=qS,this.y=q_,this},q_.distance=function(qS,q_){return Math.sqrt((this.x-qS)*(this.x-qS)+(this.y-q_)*(this.y-q_))},q_.toString=function(){return this.x+","+this.y},q_.normalize=function(){var qS=Math.sqrt(this.x*this.x+this.y*this.y);if(0<qS){var q_=1/qS;this.x*=q_,this.y*=q_}},qS.TEMP=new qS,qS.EMPTY=new qS,qS}(),qn=function(){function qb(qS,q_,qa,qR){void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),this.x=qS,this.y=q_,this.width=qa,this.height=qR}qo(qb,"laya.maths.Rectangle");var qS=qb.prototype;return qS.setTo=function(qS,q_,qa,qR){return this.x=qS,this.y=q_,this.width=qa,this.height=qR,this},qS.copyFrom=function(qS){return this.x=qS.x,this.y=qS.y,this.width=qS.width,this.height=qS.height,this},qS.contains=function(qS,q_){return!(this.width<=0||this.height<=0)&&(qS>=this.x&&qS<this.right&&q_>=this.y&&q_<this.bottom)},qS.intersects=function(qS){return!(qS.x>this.x+this.width||qS.x+qS.width<this.x||qS.y>this.y+this.height||qS.y+qS.height<this.y)},qS.intersection=function(qS,q_){return this.intersects(qS)?(q_||(q_=new qb),q_.x=Math.max(this.x,qS.x),q_.y=Math.max(this.y,qS.y),q_.width=Math.min(this.right,qS.right)-q_.x,q_.height=Math.min(this.bottom,qS.bottom)-q_.y,q_):null},qS.union=function(qS,q_){return q_||(q_=new qb),this.clone(q_),qS.width<=0||qS.height<=0?q_:(q_.addPoint(qS.x,qS.y),q_.addPoint(qS.right,qS.bottom),this)},qS.clone=function(qS){return qS||(qS=new qb),qS.x=this.x,qS.y=this.y,qS.width=this.width,qS.height=this.height,qS},qS.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},qS.equals=function(qS){return!(!qS||qS.x!==this.x||qS.y!==this.y||qS.width!==this.width||qS.height!==this.height)},qS.addPoint=function(qS,q_){return this.x>qS&&(this.width+=this.x-qS,this.x=qS),this.y>q_&&(this.height+=this.y-q_,this.y=q_),this.width<qS-this.x&&(this.width=qS-this.x),this.height<q_-this.y&&(this.height=q_-this.y),this},qS._getBoundPoints=function(){var qS=qb._temB;return(qS.length=0)==this.width||0==this.height||qS.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),qS},qS.isEmpty=function(){return this.width<=0||this.height<=0},qH(0,qS,"right",function(){return this.x+this.width}),qH(0,qS,"bottom",function(){return this.y+this.height}),qb._getBoundPointS=function(qS,q_,qa,qR){var qJ=qb._temA;return(qJ.length=0)==qa||0==qR||qJ.push(qS,q_,qS+qa,q_,qS,q_+qR,qS+qa,q_+qR),qJ},qb._getWrapRec=function(qS,q_){if(!qS||qS.length<1)return q_?q_.setTo(0,0,0,0):qb.TEMP.setTo(0,0,0,0);q_=q_||new qb;var qa,qR,qJ,qV,qW,qk=qS.length,qz=qN.TEMP;for(qJ=qW=-(qR=qV=99999),qa=0;qa<qk;qa+=2)qz.x=qS[qa],qz.y=qS[qa+1],qR=qR<qz.x?qR:qz.x,qV=qV<qz.y?qV:qz.y,qJ=qJ>qz.x?qJ:qz.x,qW=qW>qz.y?qW:qz.y;return q_.setTo(qR,qV,qJ-qR,qW-qV)},qb.EMPTY=new qb,qb.TEMP=new qb,qb._temB=[],qb._temA=[],qb}(),qI=function(){function qz(){}return qo(qz,"laya.media.SoundManager"),qH(1,qz,"useAudioMusic",function(){return qz._useAudioMusic},function(qS){qz._useAudioMusic=qS,qz._musicClass=qS?qaS:null}),qH(1,qz,"autoStopMusic",function(){return qz._autoStopMusic},function(qS){qq.stage.off("blur",null,qz._stageOnBlur),qq.stage.off("focus",null,qz._stageOnFocus),qq.stage.off("visibilitychange",null,qz._visibilityChange),(qz._autoStopMusic=qS)&&(qq.stage.on("blur",null,qz._stageOnBlur),qq.stage.on("focus",null,qz._stageOnFocus),qq.stage.on("visibilitychange",null,qz._visibilityChange))}),qH(1,qz,"muted",function(){return qz._muted},function(qS){qS!=qz._muted&&(qS&&qz.stopAllSound(),qz.musicMuted=qS,qz._muted=qS)}),qH(1,qz,"musicMuted",function(){return qz._musicMuted},function(qS){qS!=qz._musicMuted&&(qS?(qz._tMusic&&qz._musicChannel&&!qz._musicChannel.isStopped?qz._musicChannel.pause():qz._musicChannel=null,qz._musicMuted=qS):(qz._musicMuted=qS,qz._tMusic&&qz._musicChannel&&qz._musicChannel.resume()))}),qH(1,qz,"soundMuted",function(){return qz._soundMuted},function(qS){qz._soundMuted=qS}),qz.addChannel=function(qS){0<=qz._channels.indexOf(qS)||(qz._channels.push(qS),qz.autoReleaseSound&&0!=qz._notUsedCount&&qz._notUsedUrls[qS.url]&&(delete qz._notUsedUrls[qS.url],0==--qz._notUsedCount&&qq.timer.clear(qz,qz.disposeSoundIfNotUsed)))},qz.removeChannel=function(qS){var q_=qz._channels,qa=q_.indexOf(qS);if(-1!=qa&&(q_.splice(qa,1),qz.autoReleaseSound)){var qR=qS.url,qJ=qz.defaultIntervals[qR]||2e4;if(0<qJ){var qV=!0;for(qa=q_.length-1;0<=qa;qa--)if(q_[qa].url==qR){qV=!1;break}qV&&(qz._notUsedUrls[qR]=Date.now()+qJ,0==qz._notUsedCount++&&qq.timer.loop(1e4,qz,qz.disposeSoundIfNotUsed))}}},qz.disposeSoundIfNotUsed=function(){var qS=qz._notUsedUrls;if(0!=qz._notUsedCount){var q_=Date.now();for(var qa in qS)q_>=qS[qa]&&(delete qS[qa],--qz._notUsedCount,qz.destroySound(qa));if(0!=qz._notUsedCount)return}qq.timer.clear(qz,qz.disposeSoundIfNotUsed)},qz._visibilityChange=function(){qq.stage.isVisibility?qz._stageOnFocus():qz._stageOnBlur()},qz._stageOnBlur=function(){qz._isActive=!1,qz._musicChannel&&(qz._musicChannel.isStopped||(qz._blurPaused=!0,qz._musicChannel.pause())),qz.stopAllSound(),qq.stage.once("mousedown",null,qz._stageOnFocus)},qz._recoverWebAudio=function(){qVS.ctx&&"running"!=qVS.ctx.state&&qVS.ctx.resume&&qVS.ctx.resume()},qz._stageOnFocus=function(){if(qz._isActive=!0,qz._recoverWebAudio(),qq.stage.off("mousedown",null,qz._stageOnFocus),qz._blurPaused){var qS=qz._musicChannel;qS&&qz._music&&qS.isStopped&&(qz._blurPaused=!1,qz._music._disposed?qz.playMusic(qS.url,qS.loops,qS.startHandler,qS.completeHandler,qS.startTime):qS.audioBuffer?qS.resume():qz._music.play(qS.startTime,qS.loops,qS.startHandler,qS))}},qz.playSound=function(qS,q_,qa,qR,qJ,qV){if(void 0===q_&&(q_=1),void 0===qV&&(qV=0),!qS)return null;if(qz._muted)return null;if(qz._recoverWebAudio(),qS==qz._tMusic){if(qz._musicMuted)return null}else{if(!qz._isActive)return null;if(qz._soundMuted)return null}var qW,qk=qz._pool[qS];return qJ||(qJ=qz._soundClass),qk||((qk=new qJ).load(qS),qz._pool[qS]=qk),(qW=qk.play(qV,q_,qa))?(qS==qz._tMusic&&(qz._music=qk,qz._isActive||(qz._blurPaused=!0,qW.pause())),qW.url=qS,qW.volume=qS==qz._tMusic?qz.musicVolume:qz.soundVolume,qW.completeHandler=qR,qW):null},qz.destroySound=function(qS){var q_=qz._pool[qS];q_&&(delete qz._pool[qS],q_.dispose())},qz.playMusic=function(qS,q_,qa,qR,qJ){return void 0===q_&&(q_=0),void 0===qJ&&(qJ=0),qz._tMusic=qS,qz._musicChannel&&qz._musicChannel.stop(),qz._musicChannel=qz.playSound(qS,q_,qa,qR,null,qJ)},qz.stopSound=function(qS){for(var q_,qa=qz._channels.length-1;0<=qa;qa--)(q_=qz._channels[qa]).url==qS&&q_.stop()},qz.stopAll=function(){qz._tMusic=null;var qS=0;for(qS=qz._channels.length-1;0<=qS;qS--)qz._channels[qS].stop()},qz.stopAllSound=function(){var qS,q_=0;for(q_=qz._channels.length-1;0<=q_;q_--)(qS=qz._channels[q_]).url!=qz._tMusic&&qS.stop()},qz.stopMusic=function(){qz._musicChannel&&qz._musicChannel.stop(),qz._tMusic=null},qz.setSoundVolume=function(qS,q_){if(q_)qz._setVolume(q_,qS);else{qz.soundVolume=qS;var qa,qR=0;for(qR=qz._channels.length-1;0<=qR;qR--)(qa=qz._channels[qR]).url!=qz._tMusic&&(qa.volume=qS)}},qz.setMusicVolume=function(qS){qz.musicVolume=qS,qz._setVolume(qz._tMusic,qS)},qz._setVolume=function(qS,q_){for(var qa,qR=qz._channels.length-1;0<=qR;qR--)(qa=qz._channels[qR]).url==qS&&(qa.volume=q_)},qz.musicVolume=1,qz.soundVolume=1,qz.playbackRate=1,qz._useAudioMusic=!0,qz._muted=!1,qz._soundMuted=!1,qz._musicMuted=!1,qz._tMusic=null,qz._musicChannel=null,qz._music=null,qz._channels=[],qz._autoStopMusic=!1,qz._blurPaused=!1,qz._isActive=!0,qz._soundClass=null,qz._musicClass=null,qz.autoReleaseSound=!0,qz._pool={},qz.defaultIntervals={},qz._notUsedUrls={},qz._notUsedCount=0,qz}(),ql=function(){var qS;function qa(){}return qo(qa,"laya.net.LocalStorage"),qa.__init__=function(){qa._baseClass||(qa._baseClass=qS).init(),qa.items=qa._baseClass.items,qa.support=qa._baseClass.support},qa.setItem=function(qS,q_){qa._baseClass.setItem(qS,q_)},qa.getItem=function(qS){return qa._baseClass.getItem(qS)},qa.setJSON=function(qS,q_){qa._baseClass.setJSON(qS,q_)},qa.getJSON=function(qS){return qa._baseClass.getJSON(qS)},qa.removeItem=function(qS){qa._baseClass.removeItem(qS)},qa.clear=function(){qa._baseClass.clear()},qa._baseClass=null,qa.items=null,qa.support=!1,qa.__init$=function(){qS=function(){function qa(){}return qo(qa,""),qa.init=function(){try{qa.support=!0,qa.items=qW.localStorage,qa.setItem("laya","1"),qa.removeItem("laya")}catch(qS){qa.support=!1}qa.support||console.log("LocalStorage is not supprot or browser is private mode.")},qa.setItem=function(qS,q_){try{qa.support&&qa.items.setItem(qS,q_)}catch(qS){console.warn("set localStorage failed",qS)}},qa.getItem=function(qS){return qa.support?qa.items.getItem(qS):null},qa.setJSON=function(qS,q_){try{qa.support&&qa.items.setItem(qS,JSON.stringify(q_))}catch(qS){console.warn("set localStorage failed",qS)}},qa.getJSON=function(qS){return JSON.parse(qa.support?qa.items.getItem(qS):null)},qa.removeItem=function(qS){qa.support&&qa.items.removeItem(qS)},qa.clear=function(){qa.support&&qa.items.clear()},qa.items=null,qa.support=!1,qa}()},qa}(),qh=(function(){function qR(){}qo(qR,"laya.net.ResourceVersion"),qR.enable=function(qS,q_,qa){void 0===qa&&(qa=2),laya.net.ResourceVersion.type=qa,qq.loader.load(qS,qT.create(null,qR.onManifestLoaded,[q_]),null,"json"),qu.customFormat=qR.addVersionPrefix},qR.onManifestLoaded=function(qS,q_){qR.manifest=q_,qS.run(),q_||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},qR.addVersionPrefix=function(qS){return qR.manifest&&qR.manifest[qS]?2==qR.type?qR.manifest[qS]:qR.manifest[qS]+"/"+qS:qS},qR.FOLDER_VERSION=1,qR.FILENAME_VERSION=2,qR.manifest=null,qR.type=1}(),function(){function qS(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}qo(qS,"laya.net.TTFLoader");var q_=qS.prototype;return q_.load=function(qS){var q_=(this._url=qS).split(".ttf")[0].split("/");this.fontName=q_[q_.length-1],qg.window.conch?this._loadConch():qg.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},q_._loadConch=function(){this._http=new qWS,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},q_._onHttpLoaded=function(qS){qg.window.conch.setFontFaceFromBuffer(this.fontName,qS),this._clearHttp(),this._complete()},q_._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},q_._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},q_._complete=function(){qq.timer.clear(this,this._complete),qq.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},q_._checkComplete=function(){qA.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},q_._loadWithFontFace=function(){var qS=new qg.window.FontFace(this.fontName,"url('"+this._url+"')");qg.window.document.fonts.add(qS);var q_=this;qS.loaded.then(function(){q_._complete()}),qS.load()},q_._createDiv=function(){this._div=qg.createElement("div"),this._div.innerHTML="laya";var qS=this._div.style;qS.fontFamily=this.fontName,qS.position="absolute",qS.left="-100px",qS.top="-100px",qg.document.body.appendChild(this._div)},q_._loadWithCSS=function(){var qS=this,q_=qg.createElement("style");q_.type="text/css",qg.document.body.appendChild(q_),q_.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=qA.measureText("LayaTTFFont",this._fontTxt).width;var qa=this;q_.onload=function(){qq.timer.once(1e4,qa,qS._complete)},qq.timer.loop(20,this,this._checkComplete),this._createDiv()},qS._testString="LayaTTFFont",qS}()),qu=function(){function qR(qS){this._url=null,this._path=null,this._url=qR.formatURL(qS),this._path=qR.getPath(qS)}qo(qR,"laya.net.URL");var qS=qR.prototype;return qH(0,qS,"path",function(){return this._path}),qH(0,qS,"url",function(){return this._url}),qR.formatURL=function(qS,q_){if(!qS)return"null path";if(0<qS.indexOf(":"))return qS;null!=qR.customFormat&&(qS=qR.customFormat(qS,q_));var qa=qS.charAt(0);if("."===qa)return qR.formatRelativePath((q_||qR.basePath)+qS);if("~"===qa)return qR.rootPath+qS.substring(1);if("d"===qa){if(0===qS.indexOf("data:image"))return qS}else if("/"===qa)return qS;return(q_||qR.basePath)+qS},qR.formatRelativePath=function(qS){for(var q_=qS.split("/"),qa=0,qR=q_.length;qa<qR;qa++)".."==q_[qa]&&(q_.splice(qa-1,2),qa-=2);return q_.join("/")},qR.isAbsolute=function(qS){return 0<qS.indexOf(":")||"/"==qS.charAt(0)},qR.getPath=function(qS){var q_=qS.lastIndexOf("/");return 0<q_?qS.substr(0,q_+1):""},qR.getFileName=function(qS){var q_=qS.lastIndexOf("/");return 0<q_?qS.substr(q_+1):qS},qR.version={},qR.basePath="",qR.rootPath="",qR.customFormat=function(qS){var q_=qR.version[qS];return!qK.isConchApp&&q_&&(qS+="?v="+q_),qS},qR}(),qK=function(){function qJ(qS,q_){this._timeId=0;var qa=qJ._mainCanvas.source.style;qa.position="absolute",qa.top=qa.left="0px",qa.background="#000000",qJ._mainCanvas.source.id="layaCanvas";var qR=laya.renders.Render.isWebGL;qJ._mainCanvas.source.width=qS,qJ._mainCanvas.source.height=q_,qR&&qJ.WebGL.init(qJ._mainCanvas,qS,q_),qg.container.appendChild(qJ._mainCanvas.source),(qJ._context=new qP(qS,q_,qR?null:qJ._mainCanvas)).ctx.setIsMainContext(),qg.window.requestAnimationFrame(function qS(q_){qg.window.requestAnimationFrame(qS);qq.stage._loop()}),qq.stage.on("visibilitychange",this,this._onVisibilitychange)}qo(qJ,"laya.renders.Render");var qS=qJ.prototype;return qS._onVisibilitychange=function(){qq.stage.isVisibility?0!=this._timeId&&qg.window.clearInterval(this._timeId):this._timeId=qg.window.setInterval(this._enterFrame,1e3)},qS._enterFrame=function(qS){qq.stage._loop()},qH(1,qJ,"context",function(){return qJ._context}),qH(1,qJ,"canvas",function(){return qJ._mainCanvas.source}),qJ._context=null,qJ._mainCanvas=null,qJ.WebGL=null,qJ.isConchNode=!1,qJ.isConchApp=!1,qJ.isConchWebGL=!1,qJ.isWebGL=!1,qJ.is3DMode=!1,qJ.optimizeTextureMemory=function(qS,q_){return!0},qJ.__init$=function(){qW.ConchRenderType=qW.ConchRenderType||1,qW.ConchRenderType|=qW.conch?4:0,qJ.isConchNode=5==(5&qW.ConchRenderType),qJ.isConchApp=4==(4&qW.ConchRenderType),qJ.isConchWebGL=6==qW.ConchRenderType},qJ}(),qP=function(){function qW(qS,q_,qa){this.x=0,this.y=0,this._drawTexture=function(qS,q_,qa){qa[0].loaded&&this.ctx.drawTexture(qa[0],qa[1],qa[2],qa[3],qa[4],qS,q_)},this._fillTexture=function(qS,q_,qa){qa[0].loaded&&this.ctx.fillTexture(qa[0],qa[1]+qS,qa[2]+q_,qa[3],qa[4],qa[5],qa[6],qa[7])},this._drawTextureWithTransform=function(qS,q_,qa){qa[0].loaded&&this.ctx.drawTextureWithTransform(qa[0],qa[1],qa[2],qa[3],qa[4],qa[5],qS,q_,qa[6])},this._fillQuadrangle=function(qS,q_,qa){this.ctx.fillQuadrangle(qa[0],qa[1],qa[2],qa[3],qa[4])},this._drawRect=function(qS,q_,qa){var qR=this.ctx;null!=qa[4]&&(qR.fillStyle=qa[4],qR.fillRect(qS+qa[0],q_+qa[1],qa[2],qa[3],null)),null!=qa[5]&&(qR.strokeStyle=qa[5],qR.lineWidth=qa[6],qR.strokeRect(qS+qa[0],q_+qa[1],qa[2],qa[3],qa[6]))},this._drawPie=function(qS,q_,qa){var qR=this.ctx;qK.isWebGL&&qR.setPathId(qa[8]),qR.beginPath(),qK.isWebGL?(qR.movePath(qa[0]+qS,qa[1]+q_),qR.moveTo(0,0)):qR.moveTo(qS+qa[0],q_+qa[1]),qR.arc(qS+qa[0],q_+qa[1],qa[2],qa[3],qa[4]),qR.closePath(),this._fillAndStroke(qa[5],qa[6],qa[7],!0)},this._clipRect=function(qS,q_,qa){this.ctx.clipRect(qS+qa[0],q_+qa[1],qa[2],qa[3])},this._fillRect=function(qS,q_,qa){this.ctx.fillRect(qS+qa[0],q_+qa[1],qa[2],qa[3],qa[4])},this._drawCircle=function(qS,q_,qa){var qR=this.ctx;qK.isWebGL&&qR.setPathId(qa[6]),qc.drawCall++,qR.beginPath(),qK.isWebGL&&qR.movePath(qa[0]+qS,qa[1]+q_),qR.arc(qa[0]+qS,qa[1]+q_,qa[2],0,qW.PI2),qR.closePath(),this._fillAndStroke(qa[3],qa[4],qa[5],!0)},this._fillCircle=function(qS,q_,qa){qc.drawCall++;var qR=this.ctx;qR.beginPath(),qR.fillStyle=qa[3],qR.arc(qa[0]+qS,qa[1]+q_,qa[2],0,qW.PI2),qR.fill()},this._setShader=function(qS,q_,qa){this.ctx.setShader(qa[0])},this._drawLine=function(qS,q_,qa){var qR=this.ctx;qK.isWebGL&&qR.setPathId(qa[6]),qR.beginPath(),qR.strokeStyle=qa[4],qR.lineWidth=qa[5],qK.isWebGL?(qR.movePath(qS,q_),qR.moveTo(qa[0],qa[1]),qR.lineTo(qa[2],qa[3])):(qR.moveTo(qS+qa[0],q_+qa[1]),qR.lineTo(qS+qa[2],q_+qa[3])),qR.stroke()},this._drawLines=function(qS,q_,qa){var qR=this.ctx;qK.isWebGL&&qR.setPathId(qa[5]),qR.beginPath(),qS+=qa[0],q_+=qa[1],qK.isWebGL&&qR.movePath(qS,q_),qR.strokeStyle=qa[3],qR.lineWidth=qa[4];var qJ=qa[2],qV=2,qW=qJ.length;if(qK.isWebGL)for(qR.moveTo(qJ[0],qJ[1]);qV<qW;)qR.lineTo(qJ[qV++],qJ[qV++]);else for(qR.moveTo(qS+qJ[0],q_+qJ[1]);qV<qW;)qR.lineTo(qS+qJ[qV++],q_+qJ[qV++]);qR.stroke()},this._drawLinesWebGL=function(qS,q_,qa){this.ctx.drawLines(qS+this.x+qa[0],q_+this.y+qa[1],qa[2],qa[3],qa[4])},this._drawCurves=function(qS,q_,qa){this.ctx.drawCurves(qS,q_,qa)},this._draw=function(qS,q_,qa){qa[0].call(null,this,qS,q_)},this._transformByMatrix=function(qS,q_,qa){this.ctx.transformByMatrix(qa[0])},this._setTransform=function(qS,q_,qa){this.ctx.setTransform(qa[0],qa[1],qa[2],qa[3],qa[4],qa[5])},this._setTransformByMatrix=function(qS,q_,qa){this.ctx.setTransformByMatrix(qa[0])},this._save=function(qS,q_,qa){this.ctx.save()},this._restore=function(qS,q_,qa){this.ctx.restore()},this._translate=function(qS,q_,qa){this.ctx.translate(qa[0],qa[1])},this._transform=function(qS,q_,qa){this.ctx.translate(qa[1]+qS,qa[2]+q_);var qR=qa[0];this.ctx.transform(qR.a,qR.b,qR.c,qR.d,qR.tx,qR.ty),this.ctx.translate(-qS-qa[1],-q_-qa[2])},this._rotate=function(qS,q_,qa){this.ctx.translate(qa[1]+qS,qa[2]+q_),this.ctx.rotate(qa[0]),this.ctx.translate(-qS-qa[1],-q_-qa[2])},this._scale=function(qS,q_,qa){this.ctx.translate(qa[2]+qS,qa[3]+q_),this.ctx.scale(qa[0],qa[1]),this.ctx.translate(-qS-qa[2],-q_-qa[3])},this._alpha=function(qS,q_,qa){this.ctx.globalAlpha*=qa[0]},this._setAlpha=function(qS,q_,qa){this.ctx.globalAlpha=qa[0]},this._fillText=function(qS,q_,qa){this.ctx.fillText(qa[0],qa[1]+qS,qa[2]+q_,qa[3],qa[4],qa[5])},this._strokeText=function(qS,q_,qa){this.ctx.strokeText(qa[0],qa[1]+qS,qa[2]+q_,qa[3],qa[4],qa[5],qa[6])},this._fillBorderText=function(qS,q_,qa){this.ctx.fillBorderText(qa[0],qa[1]+qS,qa[2]+q_,qa[3],qa[4],qa[5],qa[6],qa[7])},this._blendMode=function(qS,q_,qa){this.ctx.globalCompositeOperation=qa[0]},this._beginClip=function(qS,q_,qa){this.ctx.beginClip&&this.ctx.beginClip(qS+qa[0],q_+qa[1],qa[2],qa[3])},this._setIBVB=function(qS,q_,qa){this.ctx.setIBVB(qa[0]+qS,qa[1]+q_,qa[2],qa[3],qa[4],qa[5],qa[6],qa[7])},this._fillTrangles=function(qS,q_,qa){this.ctx.fillTrangles(qa[0],qa[1]+qS,qa[2]+q_,qa[3],qa[4])},this._drawPath=function(qS,q_,qa){var qR=this.ctx;qK.isWebGL&&qR.setPathId(-1),qR.beginPath(),qS+=qa[0],q_+=qa[1],qK.isWebGL&&qR.movePath(qS,q_);for(var qJ=qa[2],qV=0,qW=qJ.length;qV<qW;qV++){var qk=qJ[qV];switch(qk[0]){case"moveTo":qK.isWebGL?qR.moveTo(qk[1],qk[2]):qR.moveTo(qS+qk[1],q_+qk[2]);break;case"lineTo":qK.isWebGL?qR.lineTo(qk[1],qk[2]):qR.lineTo(qS+qk[1],q_+qk[2]);break;case"arcTo":qK.isWebGL?qR.arcTo(qk[1],qk[2],qk[3],qk[4],qk[5]):qR.arcTo(qS+qk[1],q_+qk[2],qS+qk[3],q_+qk[4],qk[5]);break;case"closePath":qR.closePath()}}var qz=qa[3];null!=qz&&(qR.fillStyle=qz.fillStyle,qR.fill());var qb=qa[4];null!=qb&&(qR.strokeStyle=qb.strokeStyle,qR.lineWidth=qb.lineWidth||1,qR.lineJoin=qb.lineJoin,qR.lineCap=qb.lineCap,qR.miterLimit=qb.miterLimit,qR.stroke())},this.drawPoly=function(qS,q_,qa){this.ctx.drawPoly(qS+this.x+qa[0],q_+this.y+qa[1],qa[2],qa[3],qa[4],qa[5],qa[6])},this._drawPoly=function(qS,q_,qa){var qR=this.ctx,qJ=qa[2],qV=2,qW=qJ.length;if(qK.isWebGL)for(qR.setPathId(qa[6]),qR.beginPath(),qS+=qa[0],q_+=qa[1],qR.movePath(qS,q_),qR.moveTo(qJ[0],qJ[1]);qV<qW;)qR.lineTo(qJ[qV++],qJ[qV++]);else for(qR.beginPath(),qS+=qa[0],q_+=qa[1],qR.moveTo(qS+qJ[0],q_+qJ[1]);qV<qW;)qR.lineTo(qS+qJ[qV++],q_+qJ[qV++]);qR.closePath(),this._fillAndStroke(qa[3],qa[4],qa[5],qa[7])},this._drawSkin=function(qS,q_,qa){var qR=qa[0];if(qR){var qJ=this.ctx;qR.render(qJ,qS,q_)}},this._drawParticle=function(qS,q_,qa){this.ctx.drawParticle(qS+this.x,q_+this.y,qa[0])},this._setFilters=function(qS,q_,qa){this.ctx.setFilters(qa)},qa?this.ctx=qa.getContext("2d"):(qa=qDS.create("3D"),this.ctx=qA.createWebGLContext2D(qa),qa._setContext(this.ctx)),qa.size(qS,q_),this.canvas=qa}qo(qW,"laya.renders.RenderContext");var qS=qW.prototype;return qS.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},qS.drawTexture=function(qS,q_,qa,qR,qJ){qS.loaded&&this.ctx.drawTexture(qS,q_,qa,qR,qJ,this.x,this.y)},qS._drawTextures=function(qS,q_,qa){qa[0].loaded&&this.ctx.drawTextures(qa[0],qa[1],qS+this.x,q_+this.y)},qS.drawTextureWithTransform=function(qS,q_,qa,qR,qJ,qV,qW){qS.loaded&&this.ctx.drawTextureWithTransform(qS,q_,qa,qR,qJ,qV,this.x,this.y,qW)},qS.fillQuadrangle=function(qS,q_,qa,qR,qJ){this.ctx.fillQuadrangle(qS,q_,qa,qR,qJ)},qS.drawCanvas=function(qS,q_,qa,qR,qJ){this.ctx.drawCanvas(qS,q_+this.x,qa+this.y,qR,qJ)},qS.drawRect=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=1);var qW=this.ctx;qW.strokeStyle=qJ,qW.lineWidth=qV,qW.strokeRect(qS+this.x,q_+this.y,qa,qR,qV)},qS._fillAndStroke=function(qS,q_,qa,qR){void 0===qR&&(qR=!1);var qJ=this.ctx;null!=qS&&(qJ.fillStyle=qS,qK.isWebGL?qJ.fill(qR):qJ.fill()),null!=q_&&0<qa&&(qJ.strokeStyle=q_,qJ.lineWidth=qa,qJ.stroke())},qS.clipRect=function(qS,q_,qa,qR){this.ctx.clipRect(qS+this.x,q_+this.y,qa,qR)},qS.fillRect=function(qS,q_,qa,qR,qJ){this.ctx.fillRect(qS+this.x,q_+this.y,qa,qR,qJ)},qS.drawCircle=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=1),qc.drawCall++;var qV=this.ctx;qV.beginPath(),qV.strokeStyle=qR,qV.lineWidth=qJ,qV.arc(qS+this.x,q_+this.y,qa,0,qW.PI2),qV.stroke()},qS.drawTriangles=function(qS,q_,qa){if(qK.isWebGL)this.ctx.drawTriangles(qa[0],qS+qa[1],q_+qa[2],qa[3],qa[4],qa[5],qa[6],qa[7],qa[8],qa[9]);else{var qR=qa[5],qJ=0,qV=qR.length,qW=this.ctx;for(qJ=0;qJ<qV;qJ+=3){var qk=2*qR[qJ],qz=2*qR[qJ+1],qb=2*qR[qJ+2];qW.drawTriangle(qa[0],qa[3],qa[4],qk,qz,qb,qa[6],!0)}}},qS.fillCircle=function(qS,q_,qa,qR){qc.drawCall++;var qJ=this.ctx;qJ.beginPath(),qJ.fillStyle=qR,qJ.arc(qS+this.x,q_+this.y,qa,0,qW.PI2),qJ.fill()},qS.setShader=function(qS){this.ctx.setShader(qS)},qS.drawLine=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=1);var qW=this.ctx;qW.beginPath(),qW.strokeStyle=qJ,qW.lineWidth=qV,qW.moveTo(this.x+qS,this.y+q_),qW.lineTo(this.x+qa,this.y+qR),qW.stroke()},qS.clear=function(){this.ctx.clear()},qS.transformByMatrix=function(qS){this.ctx.transformByMatrix(qS)},qS.setTransform=function(qS,q_,qa,qR,qJ,qV){this.ctx.setTransform(qS,q_,qa,qR,qJ,qV)},qS.setTransformByMatrix=function(qS){this.ctx.setTransformByMatrix(qS)},qS.save=function(){this.ctx.save()},qS.restore=function(){this.ctx.restore()},qS.translate=function(qS,q_){this.ctx.translate(qS,q_)},qS.transform=function(qS,q_,qa,qR,qJ,qV){this.ctx.transform(qS,q_,qa,qR,qJ,qV)},qS.rotate=function(qS){this.ctx.rotate(qS)},qS.scale=function(qS,q_){this.ctx.scale(qS,q_)},qS.alpha=function(qS){this.ctx.globalAlpha*=qS},qS.setAlpha=function(qS){this.ctx.globalAlpha=qS},qS.fillWords=function(qS,q_,qa,qR,qJ,qV){void 0===qV&&(qV=0),this.ctx.fillWords(qS,q_,qa,qR,qJ,qV)},qS.fillBorderWords=function(qS,q_,qa,qR,qJ,qV,qW){this.ctx.fillBorderWords(qS,q_,qa,qR,qJ,qV,qW)},qS.fillText=function(qS,q_,qa,qR,qJ,qV){this.ctx.fillText(qS,q_+this.x,qa+this.y,qR,qJ,qV)},qS.strokeText=function(qS,q_,qa,qR,qJ,qV,qW){this.ctx.strokeText(qS,q_+this.x,qa+this.y,qR,qJ,qV,qW)},qS.blendMode=function(qS){this.ctx.globalCompositeOperation=qS},qS.flush=function(){this.ctx.flush&&this.ctx.flush()},qS.addRenderObject=function(qS){this.ctx.addRenderObject(qS)},qS.beginClip=function(qS,q_,qa,qR){this.ctx.beginClip&&this.ctx.beginClip(qS,q_,qa,qR)},qS.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},qS.fillTrangles=function(qS,q_,qa){this.ctx.fillTrangles(qa[0],qa[1],qa[2],qa[3],4<qa.length?qa[4]:null)},qW.PI2=2*Math.PI,qW}(),qM=function(){function qW(qS,q_){switch(this._next=q_||qW.NORENDER,qS){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=qF._filter);case 69905:return void(this._fun=qW._initRenderFun)}this.onCreate(qS)}qo(qW,"laya.renders.RenderSprite");var qS=qW.prototype;return qS.onCreate=function(qS){},qS._style=function(qS,q_,qa,qR){qS._style.render(qS,q_,qa,qR);var qJ=this._next;qJ._fun.call(qJ,qS,q_,qa,qR)},qS._no=function(qS,q_,qa,qR){},qS._custom=function(qS,q_,qa,qR){qS.customRender(q_,qa,qR);var qJ=qS._style._tf;this._next._fun.call(this._next,qS,q_,qa-qJ.translateX,qR-qJ.translateY)},qS._clip=function(qS,q_,qa,qR){var qJ=this._next;if(qJ!=qW.NORENDER){var qV=qS._style.scrollRect;q_.ctx.save(),q_.ctx.clipRect(qa,qR,qV.width,qV.height),qJ._fun.call(qJ,qS,q_,qa-qV.x,qR-qV.y),q_.ctx.restore()}},qS._blend=function(qS,q_,qa,qR){var qJ=qS._style;qJ.blendMode&&(q_.ctx.globalCompositeOperation=qJ.blendMode);var qV=this._next;qV._fun.call(qV,qS,q_,qa,qR),q_.ctx.globalCompositeOperation="source-over"},qS._mask=function(qS,q_,qa,qR){var qJ=this._next;qJ._fun.call(qJ,qS,q_,qa,qR);var qV=qS.mask;qV&&(q_.ctx.globalCompositeOperation="destination-in",(0<qV.numChildren||!qV.graphics._isOnlyOne())&&(qV.cacheAsBitmap=!0),qV.render(q_,qa-qS.pivotX,qR-qS.pivotY)),q_.ctx.globalCompositeOperation="source-over"},qS._graphics=function(qS,q_,qa,qR){var qJ=qS._style._tf;qS._graphics&&qS._graphics._render(qS,q_,qa-qJ.translateX,qR-qJ.translateY);var qV=this._next;qV._fun.call(qV,qS,q_,qa,qR)},qS._image=function(qS,q_,qa,qR){var qJ=qS._style;q_.ctx.drawTexture2(qa,qR,qJ._tf.translateX,qJ._tf.translateY,qS.transform,qJ.alpha,qJ.blendMode,qS._graphics._one)},qS._image2=function(qS,q_,qa,qR){var qJ=qS._style._tf;q_.ctx.drawTexture2(qa,qR,qJ.translateX,qJ.translateY,qS.transform,1,null,qS._graphics._one)},qS._alpha=function(qS,q_,qa,qR){var qJ;if(.01<(qJ=qS._style.alpha)||qS._needRepaint()){var qV=q_.ctx.globalAlpha;q_.ctx.globalAlpha*=qJ;var qW=this._next;qW._fun.call(qW,qS,q_,qa,qR),q_.ctx.globalAlpha=qV}},qS._transform=function(qS,q_,qa,qR){var qJ=qS.transform,qV=this._next;qJ&&qV!=qW.NORENDER?(q_.save(),q_.transform(qJ.a,qJ.b,qJ.c,qJ.d,qJ.tx+qa,qJ.ty+qR),qV._fun.call(qV,qS,q_,0,0),q_.restore()):qV._fun.call(qV,qS,q_,qa,qR)},qS._childs=function(qS,q_,qa,qR){var qJ=qS._style,qV=qJ._tf;if(qa=qa-qV.translateX+qJ.paddingLeft,qR=qR-qV.translateY+qJ.paddingTop,qJ._calculation){var qW=qS._getWords();if(qW){var qk=qJ;qk&&(qk.stroke?q_.fillBorderWords(qW,qa,qR,qk.font,qk.color,qk.strokeColor,qk.stroke):q_.fillWords(qW,qa,qR,qk.font,qk.color,"none"!=qk.textDecoration&&qk.underLine?1:0))}}var qz,qb=qS._childs,qH=qb.length;if(qS.viewport||qS.optimizeScrollRect&&qS._style.scrollRect){var qL=qS.viewport||qS._style.scrollRect,qC=qL.x,qG=qL.y,qt=qL.right,qo=qL.bottom,q$=NaN,qF=NaN;for(qT=0;qT<qH;++qT)(qz=qb[qT]).visible&&(q$=qz._x)<qt&&q$+qz.width>qC&&(qF=qz._y)<qo&&qF+qz.height>qG&&qz.render(q_,qa,qR)}else for(var qT=0;qT<qH;++qT)(qz=qb[qT])._style.visible&&qz.render(q_,qa,qR)},qS._canvas=function(qS,q_,qa,qR){var qJ=qS._$P.cacheCanvas;if(qJ){"bitmap"===qJ.type?qc.canvasBitmap++:qc.canvasNormal++;var qV=qJ.ctx;if(qS._needRepaint()||!qV)this._canvas_repaint(qS,q_,qa,qR);else{var qW=qJ._cacheRec;q_.drawCanvas(qV.canvas,qa+qW.x,qR+qW.y,qW.width,qW.height)}}else this._next._fun.call(this._next,qS,q_,qa,qR)},qS._canvas_repaint=function(qS,q_,qa,qR){var qJ=qS._$P.cacheCanvas,qV=this._next;if(qJ){var qW,qk,qz,qb,qH=qJ.ctx,qL=qS._needRepaint()||!qH,qC=qJ.type;if("bitmap"===qC?qc.canvasBitmap++:qc.canvasNormal++,qL){var qG,qt;qJ._cacheRec||(qJ._cacheRec=new qn),qK.isWebGL&&"bitmap"!==qC?qJ._cacheRec.setTo(-qS.pivotX,-qS.pivotY,1,1):((qb=qS.getSelfBounds()).x=qb.x-qS.pivotX,qb.y=qb.y-qS.pivotY,qb.x=qb.x-16,qb.y=qb.y-16,qb.width=qb.width+32,qb.height=qb.height+32,qb.x=Math.floor(qb.x+qa)-qa,qb.y=Math.floor(qb.y+qR)-qR,qb.width=Math.floor(qb.width),qb.height=Math.floor(qb.height),qJ._cacheRec.copyFrom(qb)),qb=qJ._cacheRec;var qo,q$=qK.isWebGL?1:qg.pixelRatio*qq.stage.clientScaleX,qF=qK.isWebGL?1:qg.pixelRatio*qq.stage.clientScaleY;if(!qK.isWebGL){var qT,qD=1,qj=1;for(qT=qS;qT&&qT!=qq.stage;)qD*=qT.scaleX,qj*=qT.scaleY,qT=qT.parent;qK.isWebGL?(qD<1&&(q$*=qD),qj<1&&(qF*=qj)):(1<qD&&(q$*=qD),1<qj&&(qF*=qj))}if(qS.scrollRect){var qQ=qS.scrollRect;qb.x-=qQ.x,qb.y-=qQ.y}if(qG=qb.width*q$,qt=qb.height*qF,qk=qb.x,qz=qb.y,qK.isWebGL&&"bitmap"===qC&&(2048<qG||2048<qt))return console.warn("cache bitmap size larger than 2048,cache ignored"),qJ.ctx&&(qp.recover("RenderContext",qJ.ctx),qJ.ctx.canvas.size(0,0),qJ.ctx=null),void qV._fun.call(qV,qS,q_,qa,qR);if(qH||(qH=qJ.ctx=qp.getItem("RenderContext")||new qP(qG,qt,qDS.create("AUTO"))),qH.ctx.sprite=qS,(qW=qH.canvas).clear(),(qW.width!=qG||qW.height!=qt)&&qW.size(qG,qt),"bitmap"===qC?qW.context.asBitmap=!0:"normal"===qC&&(qW.context.asBitmap=!1),1!=q$||1!=qF){var qm=qH.ctx;qm.save(),qm.scale(q$,qF),!qK.isConchWebGL&&qK.isConchApp&&(qo=qS._$P.cf)&&qm.setFilterMatrix&&qm.setFilterMatrix(qo._mat,qo._alpha),qV._fun.call(qV,qS,qH,-qk,-qz),qm.restore(),qK.isConchApp&&!qK.isConchWebGL||qS._applyFilters()}else qm=qH.ctx,!qK.isConchWebGL&&qK.isConchApp&&(qo=qS._$P.cf)&&qm.setFilterMatrix&&qm.setFilterMatrix(qo._mat,qo._alpha),qV._fun.call(qV,qS,qH,-qk,-qz),qK.isConchApp&&!qK.isConchWebGL||qS._applyFilters();qS._$P.staticCache&&(qJ.reCache=!1),qc.canvasReCache++}else qk=(qb=qJ._cacheRec).x,qz=qb.y,qW=qH.canvas;q_.drawCanvas(qW,qa+qk,qR+qz,qb.width,qb.height)}else qV._fun.call(qV,qS,qH,qa,qR)},qW.__init__=function(){var qS,q_,qa=0;for(q_=qA.createRenderSprite(69905,null),qS=qW.renders.length=4096,qa=0;qa<qS;qa++)qW.renders[qa]=q_;qW.renders[0]=qA.createRenderSprite(0,null),function(qS,q_){for(var qa=0,qR=0;qR<qS.length;qR++)qa|=qS[qR],qW.renders[qa]=q_}([1,512,4,2],new qW(1,null)),qW.renders[513]=qA.createRenderSprite(513,null),qW.renders[517]=new qW(517,null)},qW._initRenderFun=function(qS,q_,qa,qR){var qJ=qS._renderType;(qW.renders[qJ]=qW._getTypeRender(qJ))._fun(qS,q_,qa,qR)},qW._getTypeRender=function(qS){for(var q_=null,qa=2048;1<qa;)qa&qS&&(q_=qA.createRenderSprite(qa,q_)),qa>>=1;return q_},qW.IMAGE=1,qW.ALPHA=2,qW.TRANSFORM=4,qW.BLEND=8,qW.CANVAS=16,qW.FILTERS=32,qW.MASK=64,qW.CLIP=128,qW.STYLE=256,qW.GRAPHICS=512,qW.CUSTOM=1024,qW.CHILDS=2048,qW.INIT=69905,qW.renders=[],qW.NORENDER=new qW(0,null),qW}(),qr=function(){function qk(){this._repaint=!1}qo(qk,"laya.resource.Context");var qS=qk.prototype;return qS.replaceReset=function(){var qS,q_,qa=0;for(qS=qk.replaceKeys.length,qa=0;qa<qS;qa++)q_=qk.replaceKeys[qa],this[qk.newKeys[qa]]=this[q_]},qS.replaceResotre=function(){this.__restore(),this.__reset()},qS.setIsMainContext=function(){},qS.drawTextures=function(qS,q_,qa,qR){qc.drawCall+=q_.length/2;for(var qJ=qS.width,qV=qS.height,qW=0,qk=q_.length;qW<qk;qW+=2)this.drawTexture(qS,q_[qW],q_[qW+1],qJ,qV,qa,qR)},qS.drawCanvas=function(qS,q_,qa,qR,qJ){qc.drawCall++,this.drawImage(qS.source,q_,qa,qR,qJ)},qS.fillRect=function(qS,q_,qa,qR,qJ){qc.drawCall++,qJ&&(this.fillStyle=qJ),this.__fillRect(qS,q_,qa,qR)},qS.fillText=function(qS,q_,qa,qR,qJ,qV){qc.drawCall++,3<arguments.length&&null!=qR&&(this.font=qR,this.fillStyle=qJ,this.textAlign=qV,this.textBaseline="top"),this.__fillText(qS,q_,qa)},qS.fillBorderText=function(qS,q_,qa,qR,qJ,qV,qW,qk){qc.drawCall++,this.font=qR,this.fillStyle=qJ,this.textBaseline="top",this.strokeStyle=qV,this.lineWidth=qW,this.textAlign=qk,this.__strokeText(qS,q_,qa),this.__fillText(qS,q_,qa)},qS.strokeText=function(qS,q_,qa,qR,qJ,qV,qW){qc.drawCall++,3<arguments.length&&null!=qR&&(this.font=qR,this.strokeStyle=qJ,this.lineWidth=qV,this.textAlign=qW,this.textBaseline="top"),this.__strokeText(qS,q_,qa)},qS.transformByMatrix=function(qS){this.transform(qS.a,qS.b,qS.c,qS.d,qS.tx,qS.ty)},qS.setTransformByMatrix=function(qS){this.setTransform(qS.a,qS.b,qS.c,qS.d,qS.tx,qS.ty)},qS.clipRect=function(qS,q_,qa,qR){qc.drawCall++,this.beginPath(),this.rect(qS,q_,qa,qR),this.clip()},qS.drawTexture=function(qS,q_,qa,qR,qJ,qV,qW){qc.drawCall++;var qk=qS.uv,qz=qS.bitmap.width,qb=qS.bitmap.height;this.drawImage(qS.source,qk[0]*qz,qk[1]*qb,(qk[2]-qk[0])*qz,(qk[5]-qk[3])*qb,q_+qV,qa+qW,qR,qJ)},qS.drawTextureWithTransform=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){qc.drawCall++;var qb=qS.uv,qH=qS.bitmap.width,qL=qS.bitmap.height;this.save(),1!=qz&&(this.globalAlpha*=qz),qV?(this.transform(qV.a,qV.b,qV.c,qV.d,qV.tx+qW,qV.ty+qk),this.drawImage(qS.source,qb[0]*qH,qb[1]*qL,(qb[2]-qb[0])*qH,(qb[5]-qb[3])*qL,q_,qa,qR,qJ)):this.drawImage(qS.source,qb[0]*qH,qb[1]*qL,(qb[2]-qb[0])*qH,(qb[5]-qb[3])*qL,q_+qW,qa+qk,qR,qJ),this.restore()},qS.drawTexture2=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=qk[0];if(qz.loaded&&qz.bitmap&&qz.source){qc.drawCall++;var qb=1!==qV;if(qb){var qH=this.globalAlpha;this.globalAlpha*=qV}var qL=qz.uv,qC=qz.bitmap.width,qG=qz.bitmap.height;qJ?(this.save(),this.transform(qJ.a,qJ.b,qJ.c,qJ.d,qJ.tx+qS,qJ.ty+q_),this.drawImage(qz.source,qL[0]*qC,qL[1]*qG,(qL[2]-qL[0])*qC,(qL[5]-qL[3])*qG,qk[1]-qa,qk[2]-qR,qk[3],qk[4]),this.restore()):this.drawImage(qz.source,qL[0]*qC,qL[1]*qG,(qL[2]-qL[0])*qC,(qL[5]-qL[3])*qG,qk[1]-qa+qS,qk[2]-qR+q_,qk[3],qk[4]),qb&&(this.globalAlpha=qH)}},qS.fillTexture=function(qS,q_,qa,qR,qJ,qV,qW,qk){if(!qk.pat){if(qS.uv!=qHS.DEF_UV){var qz=new qDS("2D");qz.getContext("2d"),qz.size(qS.width,qS.height),qz.context.drawTexture(qS,0,0,qS.width,qS.height,0,0),qS=new qHS(qz)}qk.pat=this.createPattern(qS.bitmap.source,qV)}var qb=q_,qH=qa,qL=0,qC=0;qW&&(qb+=qW.x%qS.width,qH+=qW.y%qS.height,qL-=qW.x%qS.width,qC-=qW.y%qS.height),this.translate(qb,qH),this.fillRect(qL,qC,qR,qJ,qk.pat),this.translate(-qb,-qH)},qS.drawTriangle=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=qS.bitmap,qb=qz.source,qH=qS.width,qL=qS.height,qC=qz.width,qG=qz.height,qt=qa[qR]*qC,qo=qa[qJ]*qC,q$=qa[qV]*qC,qF=qa[qR+1]*qG,qT=qa[qJ+1]*qG,qD=qa[qV+1]*qG,qj=q_[qR],qQ=q_[qJ],qm=q_[qV],qq=q_[qR+1],qN=q_[qJ+1],qn=q_[qV+1];if(qk){var ql=(qj+qQ+qm)/3,qB=(qq+qN+qn)/3,qI=qj-ql,qA=qq-qB,qX=Math.sqrt(qI*qI+qA*qA);qj=ql+qI/qX*(qX+1),qq=qB+qA/qX*(qX+1),qA=qN-qB,qQ=ql+(qI=qQ-ql)/(qX=Math.sqrt(qI*qI+qA*qA))*(qX+1),qN=qB+qA/qX*(qX+1),qA=qn-qB,qm=ql+(qI=qm-ql)/(qX=Math.sqrt(qI*qI+qA*qA))*(qX+1),qn=qB+qA/qX*(qX+1)}this.save(),qW&&this.transform(qW.a,qW.b,qW.c,qW.d,qW.tx,qW.ty),this.beginPath(),this.moveTo(qj,qq),this.lineTo(qQ,qN),this.lineTo(qm,qn),this.closePath(),this.clip();var qh=1/(qt*qT+qF*q$+qo*qD-qT*q$-qF*qo-qt*qD),qu=qj*qT+qF*qm+qQ*qD-qT*qm-qF*qQ-qj*qD,qK=qt*qQ+qj*q$+qo*qm-qQ*q$-qj*qo-qt*qm,qP=qt*qT*qm+qF*qQ*q$+qj*qo*qD-qj*qT*q$-qF*qo*qm-qt*qQ*qD,qM=qq*qT+qF*qn+qN*qD-qT*qn-qF*qN-qq*qD,qr=qt*qN+qq*q$+qo*qn-qN*q$-qq*qo-qt*qn,qe=qt*qT*qn+qF*qN*q$+qq*qo*qD-qq*qT*q$-qF*qo*qn-qt*qN*qD;this.transform(qu*qh,qM*qh,qK*qh,qr*qh,qP*qh,qe*qh),this.drawImage(qb,qS.uv[0]*qC,qS.uv[1]*qG,qH,qL,qS.uv[0]*qC,qS.uv[1]*qG,qH,qL),this.restore()},qS.flush=function(){return 0},qS.fillWords=function(qS,q_,qa,qR,qJ,qV){qR&&(this.font=qR),qJ&&(this.fillStyle=qJ);this.textBaseline="top",this.textAlign="left";for(var qW=0,qk=qS.length;qW<qk;qW++){var qz=qS[qW];if(this.__fillText(qz.char,qz.x+q_,qz.y+qa),1===qV){var qb=qz.height,qH=.5*qz.style.letterSpacing;qH||(qH=0),this.beginPath(),this.strokeStyle=qJ,this.lineWidth=1,this.moveTo(q_+qz.x-qH+.5,qa+qz.y+qb+.5),this.lineTo(q_+qz.x+qz.width+qH+.5,qa+qz.y+qb+.5),this.stroke()}}},qS.fillBorderWords=function(qS,q_,qa,qR,qJ,qV,qW){qR&&(this.font=qR),qJ&&(this.fillStyle=qJ),this.textBaseline="top",this.lineWidth=qW,this.textAlign="left",this.strokeStyle=qV;for(var qk=0,qz=qS.length;qk<qz;qk++){var qb=qS[qk];this.__strokeText(qb.char,qb.x+q_,qb.y+qa),this.__fillText(qb.char,qb.x+q_,qb.y+qa)}},qS.destroy=function(){this.canvas.width=this.canvas.height=0},qS.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},qS.drawCurves=function(qS,q_,qa){this.beginPath(),this.strokeStyle=qa[3],this.lineWidth=qa[4];var qR=qa[2];qS+=qa[0],q_+=qa[1],this.moveTo(qS+qR[0],q_+qR[1]);for(var qJ=2,qV=qR.length;qJ<qV;)this.quadraticCurveTo(qS+qR[qJ++],q_+qR[qJ++],qS+qR[qJ++],q_+qR[qJ++]);this.stroke()},qk.__init__=function(q_){var qa=laya.resource.Context.prototype;if(!(q_=q_||CanvasRenderingContext2D.prototype).inited){q_.inited=!0,q_.__fillText=q_.fillText,q_.__fillRect=q_.fillRect,q_.__strokeText=q_.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(qS){q_[qS]=qa[qS]})}},qk.replaceCanvasGetSet=function(qS,q_){var qa=Object.getOwnPropertyDescriptor(qS,q_);if(!qa||!qa.configurable)return!1;var qR,qJ={};for(qR in qa)"set"!=qR&&(qJ[qR]=qa[qR]);var qV=qa.set;return qJ.set=function(qS){qV.call(this,qS);var q_=this.getContext("2d");q_&&"__reset"in q_&&q_.__reset()},Object.defineProperty(qS,q_,qJ),!0},qk.replaceGetSet=function(qS,q_){var qa=Object.getOwnPropertyDescriptor(qS,q_);if(!qa||!qa.configurable)return!1;var qR,qJ={};for(qR in qa)"set"!=qR&&(qJ[qR]=qa[qR]);var qV=qa.set,qW="___"+q_+"__";return qk.newKeys.push(qW),qJ.set=function(qS){qS!=this[qW]&&(this[qW]=qS,qV.call(this,qS))},Object.defineProperty(qS,q_,qJ),!0},qk._default=new qk,qk.newKeys=[],qz(qk,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),qk}(),qe=function(){function qV(qS){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++qV._uniqueIDCounter,this._name=qS||"Content Manager",qV._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,qV._resourceManagers.push(this),this._resources=[],this._records={}}qo(qV,"laya.resource.ResourceManager");var qS=qV.prototype;return qq.imps(qS,{"laya.resource.IDispose":!0}),qS.getResourceByIndex=function(qS){return this._resources[qS]},qS.getResourcesLength=function(){return this._resources.length},qS.addResource=function(qS){return qS.resourceManager&&qS.resourceManager.removeResource(qS),-1===this._resources.indexOf(qS)&&((qS._resourceManager=this)._resources.push(qS),this.addRecord(qS.uri,qS.__className,qS.memorySize),this.addSize(qS.memorySize),!0)},qS.removeResource=function(qS){var q_=this._resources.indexOf(qS);return-1!==q_&&(this._resources.splice(q_,1),qS._resourceManager=null,this._memorySize-=qS.memorySize,this.addRecord(qS.uri,qS.__className,-qS.memorySize),!0)},qS.unload=function(){for(var qS=this._resources.slice(0,this._resources.length),q_=0;q_<qS.length;q_++){qS[q_].destroy()}qS.length=0},qS.dispose=function(){if(this===qV._systemResourceManager)throw new Error("systemResourceManager不能被释放！");qV._resourceManagers.splice(qV._resourceManagers.indexOf(this),1),qV._isResourceManagersSorted=!1;for(var qS=this._resources.slice(0,this._resources.length),q_=0;q_<qS.length;q_++){var qa=qS[q_];qa.resourceManager.removeResource(qa),qa.destroy()}qS.length=0},qS.addSize=function(qS){qS&&(this.autoRelease&&0<qS&&this._memorySize+qS>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=qS)},qS.addRecord=function(qS,q_,qa){DEBUG&&qa&&!qS&&console.error(qS,q_,qa),qS&&(this._records.hasOwnProperty(q_+"|"+qS)||(this._records[q_+"|"+qS]=0),this._records[q_+"|"+qS]+=qa,DEBUG&&this._records[q_+"|"+qS]<0&&console.error(qS,q_,this._records[q_+"|"+qS]))},qS.garbageCollection=function(qS){var q_=this._resources;(q_=q_.slice()).sort(function(qS,q_){if(!qS||!q_)throw new Error("a或b不能为空！");return qS.released&&q_.released?0:qS.released?1:q_.released?-1:qS._lastUseFrameCount-q_._lastUseFrameCount});for(var qa=qc.loopCount,qR=0,qJ=q_.length;qR<qJ;qR++){var qV=q_[qR];if(!(1<qa-qV._lastUseFrameCount))return void(this._memorySize>=qS&&(this._isOverflow=!0));if(qV.releaseResource(),this._memorySize<qS)return void(this._isOverflow=!1)}},qH(0,qS,"id",function(){return this._id}),qH(0,qS,"name",function(){return this._name},function(qS){!qS&&""===qS||this._name===qS||(this._name=qS,qV._isResourceManagersSorted=!1)}),qH(0,qS,"memorySize",function(){return this._memorySize}),qH(0,qS,"records",function(){return this._records}),qH(1,qV,"systemResourceManager",function(){return qV._systemResourceManager}),qV.__init__=function(){qV.currentResourceManager=qV.systemResourceManager},qV.getLoadedResourceManagerByIndex=function(qS){return qV._resourceManagers[qS]},qV.getLoadedResourceManagersCount=function(){return qV._resourceManagers.length},qV.recreateContentManagers=function(qS){void 0===qS&&(qS=!1);for(var q_=qV.currentResourceManager,qa=0;qa<qV._resourceManagers.length;qa++){qV.currentResourceManager=qV._resourceManagers[qa];for(var qR=0;qR<qV.currentResourceManager._resources.length;qR++)qV.currentResourceManager._resources[qR].releaseResource(qS),qV.currentResourceManager._resources[qR].activeResource(qS)}qV.currentResourceManager=q_},qV.releaseContentManagers=function(qS){void 0===qS&&(qS=!1);for(var q_=qV.currentResourceManager,qa=0;qa<qV._resourceManagers.length;qa++){qV.currentResourceManager=qV._resourceManagers[qa];for(var qR=0;qR<qV.currentResourceManager._resources.length;qR++){var qJ=qV.currentResourceManager._resources[qR];!qJ.released&&qJ.releaseResource(qS)}}qV.currentResourceManager=q_},qV._uniqueIDCounter=0,qV._isResourceManagersSorted=!1,qV._resourceManagers=[],qz(qV,["_systemResourceManager",function(){return this._systemResourceManager=new qV("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=qV._systemResourceManager}]),qV}(),qg=(function(){function qS(){}qo(qS,"laya.system.System"),qS.changeDefinition=function(qS,q_){qq[qS]=q_;var qa=qS+"=classObj";qq._runScript(qa)},qS.__init__=function(){qK.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function qa(){}return qo(qa,"laya.utils.Browser"),qH(1,qa,"pixelRatio",function(){return qa.__init__(),-1<qa.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:qA.getPixelRatio()}),qH(1,qa,"height",function(){return qa.__init__(),(qq.stage&&qq.stage.canvasRotation?qa.clientWidth:qa.clientHeight)*qa.pixelRatio}),qH(1,qa,"clientWidth",function(){return qa.__init__(),qa.window.innerWidth||qa.document.body.clientWidth}),qH(1,qa,"window",function(){return qa.__init__(),qa._window}),qH(1,qa,"clientHeight",function(){return qa.__init__(),qa.window.innerHeight||qa.document.body.clientHeight||qa.document.documentElement.clientHeight}),qH(1,qa,"width",function(){return qa.__init__(),(qq.stage&&qq.stage.canvasRotation?qa.clientHeight:qa.clientWidth)*qa.pixelRatio}),qH(1,qa,"container",function(){return qa.__init__(),qa._container||((qa._container=qa.createElement("div")).id="layaContainer",qa.document.body.appendChild(qa._container)),qa._container},function(qS){qa._container=qS}),qH(1,qa,"document",function(){return qa.__init__(),qa._document}),qa.__init__=function(){if(!qa._window){qa._window=qA.getWindow(),qa._document=qa.window.document,qa._window.addEventListener("message",function(qS){laya.utils.Browser._onMessage(qS)},!1),qa.document.__createElement=qa.document.createElement,qW.requestAnimationFrame=qW.requestAnimationFrame||qW.webkitRequestAnimationFrame||qW.mozRequestAnimationFrame||qW.oRequestAnimationFrame||qW.msRequestAnimationFrame||function(qS){return qW.setTimeout(qS,1e3/60)};var qS=qW.document.body.style;qS["-webkit-user-select"]="none",qS["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",qa.userAgent=qa.window.navigator.userAgent,qa.onIOS=!!(qa.u=qa.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),qa.onMobile=-1<qa.u.indexOf("Mobile"),qa.onIPhone=-1<qa.u.indexOf("iPhone"),qa.onMac=-1<qa.u.indexOf("Mac OS X"),qa.onIPad=-1<qa.u.indexOf("iPad"),qa.onAndroid=-1<qa.u.indexOf("Android")||-1<qa.u.indexOf("Adr"),qa.onWP=-1<qa.u.indexOf("Windows Phone"),qa.onQQBrowser=-1<qa.u.indexOf("QQBrowser"),qa.onMQQBrowser=-1<qa.u.indexOf("MQQBrowser")||-1<qa.u.indexOf("Mobile")&&-1<qa.u.indexOf("QQ"),qa.onIE=!!qa.window.ActiveXObject||"ActiveXObject"in qa.window,qa.onWeiXin=-1<qa.u.indexOf("MicroMessenger"),qa.onPC=!qa.onMobile,qa.onSafari=-1<qa.u.indexOf("Safari"),qa.onFirefox=-1<qa.u.indexOf("Firefox"),qa.onEdge=-1<qa.u.indexOf("Edge"),qa.onMiniGame=-1<qa.u.indexOf("MiniGame"),qa.onLimixiu=-1<qa.u.indexOf("limixiu"),qa.httpProtocol="http:"==qa.window.location.protocol,qa.onMiniGame&&null==qa.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),qa.webAudioEnabled=!!(qa.window.AudioContext||qa.window.webkitAudioContext||qa.window.mozAudioContext),qa.soundType=qa.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",qJS=qa.webAudioEnabled?qVS:qaS,qa.webAudioEnabled&&qVS.initWebAudio(),qaS._initMusicAudio(),qa.enableTouch="ontouchstart"in qW||qW.DocumentTouch&&q_ instanceof DocumentTouch,qW.focus(),qI._soundClass=qJS,qI._musicClass=qaS,qK._mainCanvas=qK._mainCanvas||qDS.create("2D"),qa.canvas||(qa.canvas=qDS.create("2D"),qa.context=qa.canvas.getContext("2d"))}},qa._onMessage=function(qS){if(qS.data&&"size"==qS.data.name){if(qa.window.innerWidth=qS.data.width,qa.window.innerHeight=qS.data.height,qa.window.__innerHeight=qS.data.clientHeight,!qa.document.createEvent)return void console.warn("no document.createEvent");var q_=qa.document.createEvent("HTMLEvents");return q_.initEvent("resize",!1,!1),void qa.window.dispatchEvent(q_)}},qa.createElement=function(qS){return qa.__init__(),qa.document.__createElement(qS)},qa.getElementById=function(qS){return qa.__init__(),qa.document.getElementById(qS)},qa.removeElement=function(qS){qS&&qS.parentNode&&qS.parentNode.removeChild(qS)},qa.now=function(){return qA.now()},qa._window=null,qa._document=null,qa._container=null,qa.userAgent=null,qa.u=null,qa.onIOS=!1,qa.onMac=!1,qa.onMobile=!1,qa.onIPhone=!1,qa.onIPad=!1,qa.onAndroid=!1,qa.onWP=!1,qa.onQQBrowser=!1,qa.onMQQBrowser=!1,qa.onSafari=!1,qa.onFirefox=!1,qa.onEdge=!1,qa.onIE=!1,qa.onWeiXin=!1,qa.onMiniGame=!1,qa.onLimixiu=!1,qa.onPC=!1,qa.httpProtocol=!1,qa.webAudioEnabled=!1,qa.soundType=null,qa.enableTouch=!1,qa.canvas=null,qa.context=null,qa.__init$=function(){},qa}()),qx=function(){function q_(qS){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,qS?(this._u8d_=new Uint8Array(qS),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}qo(q_,"laya.utils.Byte");var qS=q_.prototype;return qS.___resizeBuffer=function(q_){try{var qS=new Uint8Array(q_);null!=this._u8d_&&(this._u8d_.length<=q_?qS.set(this._u8d_):qS.set(this._u8d_.subarray(0,q_))),this._u8d_=qS,this._d_=new DataView(qS.buffer)}catch(qS){throw"___resizeBuffer err:"+q_}},qS.getString=function(){return this.rUTF(this.getUint16())},qS.getFloat32Array=function(qS,q_){var qa=qS+q_;qa=qa>this._length?this._length:qa;var qR=new Float32Array(this._d_.buffer.slice(qS,qa));return this._pos_=qa,qR},qS.getUint8Array=function(qS,q_){var qa=qS+q_;qa=qa>this._length?this._length:qa;var qR=new Uint8Array(this._d_.buffer.slice(qS,qa));return this._pos_=qa,qR},qS.getInt16Array=function(qS,q_){var qa=qS+q_;qa=qa>this._length?this._length:qa;var qR=new Int16Array(this._d_.buffer.slice(qS,qa));return this._pos_=qa,qR},qS.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var qS=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,qS},qS.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var qS=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,qS},qS.writeFloat32=function(qS){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,qS,this._xd_),this._pos_+=4},qS.writeFloat64=function(qS){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,qS,this._xd_),this._pos_+=8},qS.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var qS=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,qS},qS.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var qS=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,qS},qS.writeInt32=function(qS){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,qS,this._xd_),this._pos_+=4},qS.writeUint32=function(qS){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,qS,this._xd_),this._pos_+=4},qS.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var qS=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,qS},qS.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var qS=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,qS},qS.writeUint16=function(qS){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,qS,this._xd_),this._pos_+=2},qS.writeInt16=function(qS){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,qS,this._xd_),this._pos_+=2},qS.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},qS.writeUint8=function(qS){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,qS),this._pos_++},qS._getUInt8=function(qS){return this._d_.getUint8(qS)},qS._getUint16=function(qS){return this._d_.getUint16(qS,this._xd_)},qS._getMatrix=function(){return new qX(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},qS.rUTF=function(qS){for(var q_=[],qa=this._pos_+qS,qR=0,qJ=0,qV=0,qW=String.fromCharCode,qk=this._u8d_;this._pos_<qa;)(qR=qk[this._pos_++])<128?0!=qR&&q_.push(qW(qR)):qR<224?q_.push(qW((63&qR)<<6|127&qk[this._pos_++])):qR<240?(qJ=qk[this._pos_++],q_.push(qW((31&qR)<<12|(127&qJ)<<6|127&qk[this._pos_++]))):(qJ=qk[this._pos_++],qV=qk[this._pos_++],q_.push(qW((15&qR)<<18|(127&qJ)<<12|qV<<6&127|127&qk[this._pos_++]))),0;return q_.join("")},qS.getCustomString=function(qS){for(var q_=[],qa=0,qR=0,qJ=0,qV=String.fromCharCode,qW=this._u8d_;0<qS;)if((qR=qW[this._pos_])<128)q_.push(qV(qR)),this._pos_++,qS--;else for(qa=qR-128,this._pos_++,qS-=qa;0<qa;)qR=qW[this._pos_++],qJ=qW[this._pos_++],q_.push(qV(qJ<<8|qR)),qa--;return q_.join("")},qS.clear=function(){this._pos_=0,this.length=0},qS.__getBuffer=function(){return this._d_.buffer},qS.writeUTFBytes=function(qS){for(var q_=0,qa=(qS+="").length;q_<qa;q_++){var qR=qS.charCodeAt(q_);qR<=127?this.writeByte(qR):qR<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|qR>>6,128|63&qR],this._pos_),this._pos_+=2):qR<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|qR>>12,128|qR>>6&63,128|63&qR],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|qR>>18,128|qR>>12&63,128|qR>>6&63,128|63&qR],this._pos_),this._pos_+=4)}},qS.writeUTFString=function(qS){var q_=this.pos;this.writeUint16(1),this.writeUTFBytes(qS);var qa=this.pos-q_-2;if(65536<=qa)throw"writeUTFString byte len more than 65536";this._d_.setUint16(q_,qa,this._xd_)},qS.readUTFString=function(){return this.readUTFBytes(this.getUint16())},qS.getUTFString=function(){return this.readUTFString()},qS.readUTFBytes=function(qS){if(void 0===qS&&(qS=-1),0==qS)return"";var q_=this.bytesAvailable;if(q_<qS)throw"readUTFBytes error - Out of bounds";return qS=0<qS?qS:q_,this.rUTF(qS)},qS.getUTFBytes=function(qS){return void 0===qS&&(qS=-1),this.readUTFBytes(qS)},qS.writeByte=function(qS){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,qS),this._pos_+=1},qS.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},qS.getByte=function(){return this.readByte()},qS.ensureWrite=function(qS){this._length<qS&&(this._length=qS),this._allocated_<qS&&(this.length=qS)},qS.writeArrayBuffer=function(qS,q_,qa){if(void 0===q_&&(q_=0),void 0===qa&&(qa=0),q_<0||qa<0)throw"writeArrayBuffer error - Out of bounds";0==qa&&(qa=qS.byteLength-q_),this.ensureWrite(this._pos_+qa);var qR=new Uint8Array(qS);this._u8d_.set(qR.subarray(q_,q_+qa),this._pos_),this._pos_+=qa},qH(0,qS,"buffer",function(){var qS=this._d_.buffer;return qS.byteLength==this.length?qS:qS.slice(0,this.length)}),qH(0,qS,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(qS){this._xd_="littleEndian"==qS}),qH(0,qS,"length",function(){return this._length},function(qS){this._allocated_<qS?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(qS,2*this._allocated_))):this._allocated_>qS&&this.___resizeBuffer(this._allocated_=qS),this._length=qS}),qH(0,qS,"pos",function(){return this._pos_},function(qS){this._pos_=qS}),qH(0,qS,"bytesAvailable",function(){return this._length-this._pos_}),q_.getSystemEndian=function(){if(!q_._sysEndian){var qS=new ArrayBuffer(2);new DataView(qS).setInt16(0,256,!0),q_._sysEndian=256===new Int16Array(qS)[0]?"littleEndian":"bigEndian"}return q_._sysEndian},q_.BIG_ENDIAN="bigEndian",q_.LITTLE_ENDIAN="littleEndian",q_._sysEndian=null,q_}(),qs=function(){function qJ(){}return qo(qJ,"laya.utils.CacheManager"),qJ.regCacheByFunction=function(qS,q_){var qa;qJ.unRegCacheByFunction(qS,q_),qa={tryDispose:qS,getCacheList:q_},qJ._cacheList.push(qa)},qJ.unRegCacheByFunction=function(qS,q_){var qa,qR=0;for(qa=qJ._cacheList.length,qR=0;qR<qa;qR++)if(qJ._cacheList[qR].tryDispose==qS&&qJ._cacheList[qR].getCacheList==q_)return void qJ._cacheList.splice(qR,1)},qJ.forceDispose=function(){var qS=0,q_=qJ._cacheList.length;for(qS=0;qS<q_;qS++)qJ._cacheList[qS].tryDispose(!0)},qJ.beginCheck=function(qS){void 0===qS&&(qS=15e3),qq.timer.loop(qS,null,qJ._checkLoop)},qJ.stopCheck=function(){qq.timer.clear(null,qJ._checkLoop)},qJ._checkLoop=function(){var qS=qJ._cacheList;if(!(qS.length<1)){var q_,qa=qg.now(),qR=0;for(q_=qR=qS.length;0<qR&&(qS[qJ._index=++qJ._index%q_].tryDispose(!1),!(qg.now()-qa>qJ.loopTimeLimit));)qR--}},qJ.loopTimeLimit=2,qJ._cacheList=[],qJ._index=0,qJ}(),qU=function(){function qG(){}return qo(qG,"laya.utils.ClassUtils"),qG.regClass=function(qS,q_){qG._classMap[qS]=q_},qG.getRegClass=function(qS){return qG._classMap[qS]},qG.getInstance=function(qS){var q_=qG.getClass(qS);return q_?new q_:(console.warn("[error] Undefined class:",qS),null)},qG.createByJson=function(qS,q_,qa,qR,qJ){"string"==typeof qS&&(qS=JSON.parse(qS));var qV=qS.props;if(!q_&&!(q_=qJ?qJ.runWith(qS):qG.getInstance(qV.runtime||qS.type)))return null;var qW=qS.child;if(qW)for(var qk=0,qz=qW.length;qk<qz;qk++){var qb=qW[qk];if("render"!==qb.props.name&&"render"!==qb.props.renderType||!q_._$set_itemRender)if("Graphic"==qb.type)qG.addGraphicsToSprite(qb,q_);else if(qG.isDrawType(qb.type))qG.addGraphicToSprite(qb,q_,!0);else{var qH=qG.createByJson(qb,null,qa,qR,qJ);"Script"==qb.type?qH.hasOwnProperty("owner")?qH.owner=q_:qH.hasOwnProperty("target")&&(qH.target=q_):"mask"==qb.props.renderType?q_.mask=qH:q_.addChild(qH)}else q_.itemRender=qb}if(qV)for(var qL in qV){var qC=qV[qL];"var"===qL&&qa?qa[qC]=q_:qC instanceof Array&&"function"==typeof q_[qL]?q_[qL].apply(q_,qC):q_[qL]=qC}return qR&&qS.customProps&&qR.runWith([q_,qS]),q_.created&&q_.created(),q_},qG.addGraphicsToSprite=function(qS,q_){var qa;if((qa=qS.child)&&!(qa.length<1)){var qR;qR=qG._getGraphicsFromSprite(qS,q_);var qJ=0,qV=0;qS.props&&(qJ=qG._getObjVar(qS.props,"x",0),qV=qG._getObjVar(qS.props,"y",0)),0!=qJ&&0!=qV&&qR.translate(qJ,qV);var qW,qk=0;for(qW=qa.length,qk=0;qk<qW;qk++)qG._addGraphicToGraphics(qa[qk],qR);0!=qJ&&0!=qV&&qR.translate(-qJ,-qV)}},qG.addGraphicToSprite=function(qS,q_,qa){var qR;void 0===qa&&(qa=!1),qR=qa?qG._getGraphicsFromSprite(qS,q_):q_.graphics,qG._addGraphicToGraphics(qS,qR)},qG._getGraphicsFromSprite=function(qS,q_){var qa,qR;if(!qS||!qS.props)return q_.graphics;switch(qR=qS.props.renderType){case"hit":case"unHit":var qJ;q_.hitArea||(q_.hitArea=new qZ),(qJ=q_.hitArea)[qR]||(qJ[qR]=new qC),qa=qJ[qR]}return qa||(qa=q_.graphics),qa},qG._getTransformData=function(qS){var q_;(qS.hasOwnProperty("pivotX")||qS.hasOwnProperty("pivotY"))&&(q_=q_||new qX).translate(-qG._getObjVar(qS,"pivotX",0),-qG._getObjVar(qS,"pivotY",0));var qa=qG._getObjVar(qS,"scaleX",1),qR=qG._getObjVar(qS,"scaleY",1),qJ=qG._getObjVar(qS,"rotation",0);qG._getObjVar(qS,"skewX",0),qG._getObjVar(qS,"skewY",0);return 1==qa&&1==qR&&0==qJ||((q_=q_||new qX).scale(qa,qR),q_.rotate(.0174532922222222*qJ)),q_},qG._addGraphicToGraphics=function(qS,q_){var qa,qR;if((qa=qS.props)&&(qR=qG.DrawTypeDic[qS.type])){var qJ,qV;qJ=q_;var qW=qG._getParams(qa,qR[1],qR[2],qR[3]);((qV=qG._tM)||1!=qG._alpha)&&(qJ.save(),qV&&qJ.transform(qV),1!=qG._alpha&&qJ.alpha(qG._alpha)),qJ[qR[0]].apply(qJ,qW),(qV||1!=qG._alpha)&&qJ.restore()}},qG._adptLineData=function(qS){return qS[2]=parseFloat(qS[0])+parseFloat(qS[2]),qS[3]=parseFloat(qS[1])+parseFloat(qS[3]),qS},qG._adptTextureData=function(qS){return qS[0]=qkS.getRes(qS[0]),qS},qG._adptLinesData=function(qS){return qS[2]=qG._getPointListByStr(qS[2]),qS},qG.isDrawType=function(qS){return"Image"!=qS&&qG.DrawTypeDic.hasOwnProperty(qS)},qG._getParams=function(qS,q_,qa,qR){var qJ;void 0===qa&&(qa=0),(qJ=qG._temParam).length=q_.length;var qV,qW,qk=0;for(qV=q_.length,qk=0;qk<qV;qk++)qJ[qk]=qG._getObjVar(qS,q_[qk][0],q_[qk][1]);return qG._alpha=qG._getObjVar(qS,"alpha",1),qW=qG._getTransformData(qS),qG._tM=qW?(qa||(qa=0),qW.translate(qJ[qa],qJ[qa+1]),qJ[qa]=qJ[qa+1]=0,qW):null,qR&&qG[qR]&&(qJ=qG[qR](qJ)),qJ},qG._getPointListByStr=function(qS){var q_,qa,qR=0;for(qa=(q_=qS.split(",")).length,qR=0;qR<qa;qR++)q_[qR]=parseFloat(q_[qR]);return q_},qG._getObjVar=function(qS,q_,qa){return qS.hasOwnProperty(q_)?qS[q_]:qa},qG._temParam=[],qG._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},qG.getClass=function(qS){var q_=qG._classMap[qS]||qS;return"string"==typeof q_?qq.__classmap[q_]:q_},qG._tM=null,qG._alpha=NaN,qz(qG,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),qG}(),qf=function(){function qV(qS){if(this._color=[],"string"==typeof qS){null===(this.strColor=qS)&&(qS="#000000"),"#"==qS.charAt(0)&&(qS=qS.substr(1));var q_=qS.length;if(3==q_||4==q_){for(var qa="",qR=0;qR<q_;qR++)qa+=qS[qR]+qS[qR];qS=qa}var qJ=this.numColor=parseInt(qS,16);if(8==qS.length)return void(this._color=[parseInt(qS.substr(0,2),16)/255,((16711680&qJ)>>16)/255,((65280&qJ)>>8)/255,(255&qJ)/255])}else qJ=this.numColor=qS,this.strColor=qO.toHexColor(qJ);this._color=[((16711680&qJ)>>16)/255,((65280&qJ)>>8)/255,(255&qJ)/255,1],this._color.__id=++qV._COLODID}return qo(qV,"laya.utils.Color"),qV._initDefault=function(){for(var qS in qV._DEFAULT={},qV._COLOR_MAP)qV._SAVE[qS]=qV._DEFAULT[qS]=new qV(qV._COLOR_MAP[qS]);return qV._DEFAULT},qV._initSaveMap=function(){for(var qS in qV._SAVE_SIZE=0,qV._SAVE={},qV._DEFAULT)qV._SAVE[qS]=qV._DEFAULT[qS]},qV.create=function(qS){var q_=qV._SAVE[qS+""];return null!=q_?q_:(qV._SAVE_SIZE<1e3||qV._initSaveMap(),qV._SAVE[qS+""]=new qV(qS))},qV._SAVE={},qV._SAVE_SIZE=0,qV._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},qV._DEFAULT=qV._initDefault(),qV._COLODID=1,qV}(),qY=(function(){function qS(){this._values=[],this._keys=[]}qo(qS,"laya.utils.Dictionary");var q_=qS.prototype;q_.set=function(qS,q_){var qa=this.indexOf(qS);0<=qa?this._values[qa]=q_:(this._keys.push(qS),this._values.push(q_))},q_.indexOf=function(qS){var q_=this._keys.indexOf(qS);return 0<=q_?q_:(qS="string"==typeof qS?Number(qS):"number"==typeof qS?qS.toString():qS,this._keys.indexOf(qS))},q_.get=function(qS){var q_=this.indexOf(qS);return q_<0?null:this._values[q_]},q_.remove=function(qS){var q_=this.indexOf(qS);return 0<=q_&&(this._keys.splice(q_,1),this._values.splice(q_,1),!0)},q_.clear=function(){this._values.length=0,this._keys.length=0},qH(0,q_,"values",function(){return this._values}),qH(0,q_,"keys",function(){return this._keys})}(),function(){function qS(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}qo(qS,"laya.utils.Dragging");var q_=qS.prototype;return q_.start=function(qS,q_,qa,qR,qJ,qV,qW,qk){void 0===qk&&(qk=.92),this.clearTimer(),this.target=qS,this.area=q_,this.hasInertia=qa,this.elasticDistance=q_?qR:0,this.elasticBackTime=qJ,this.data=qV,this._disableMouseEvent=qW,this.ratio=qk,1!=qS.globalScaleX||1!=qS.globalScaleY?this._parent=qS.parent:this._parent=qq.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,qq.stage.on("mouseup",this,this.onStageMouseUp),qq.stage.on("mouseout",this,this.onStageMouseUp),qq.timer.frameLoop(1,this,this.loop)},q_.clearTimer=function(){qq.timer.clear(this,this.loop),qq.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},q_.stop=function(){this._dragging&&(qt.instance.disableMouseEvent=!1,qq.stage.off("mouseup",this,this.onStageMouseUp),qq.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},q_.loop=function(){var qS=this._parent.getMousePoint(),q_=qS.x,qa=qS.y,qR=q_-this._lastX,qJ=qa-this._lastY;if(this._clickOnly){if(!(1<Math.abs(qR*qq.stage._canvasTransform.getScaleX())||1<Math.abs(qJ*qq.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),qt.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(qR,qJ);0==qR&&0==qJ||(this._lastX=q_,this._lastY=qa,this.target.x+=qR*this._elasticRateX,this.target.y+=qJ*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},q_.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var qS=this.area.x-this.target.x;else qS=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-qS/this.elasticDistance),this.target.y<this.area.y)var q_=this.area.y-this.target.y;else q_=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-q_/this.elasticDistance)}},q_.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},q_.onStageMouseUp=function(qS){if(qt.instance.disableMouseEvent=!1,qq.stage.off("mouseup",this,this.onStageMouseUp),qq.stage.off("mouseout",this,this.onStageMouseUp),qq.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var q_=this._offsets.length,qa=Math.min(q_,6),qR=this._offsets.length-qa,qJ=q_-1;qR<qJ;qJ--)this._offsetY+=this._offsets[qJ--],this._offsetX+=this._offsets[qJ];this._offsetX=this._offsetX/qa*2,this._offsetY=this._offsetY/qa*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),qq.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},q_.checkElastic=function(){var qS=NaN,q_=NaN;if(this.target.x<this.area.x?qS=this.area.x:this.target.x>this.area.x+this.area.width&&(qS=this.area.x+this.area.width),this.target.y<this.area.y?q_=this.area.y:this.target.y>this.area.y+this.area.height&&(q_=this.area.y+this.area.height),isNaN(qS)&&isNaN(q_))this.clear();else{var qa={};isNaN(qS)||(qa.x=qS),isNaN(q_)||(qa.y=q_),this._tween=qE.to(this.target,qa,this.elasticBackTime,qi.sineOut,qT.create(this,this.clear),0,!1,!1)}},q_.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(qq.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},q_.clear=function(){if(this.target){this.clearTimer();var qS=this.target;this.target=null,this._parent=null,qS.event("dragend",this.data)}},qS}()),qi=function(){function qk(){}return qo(qk,"laya.utils.Ease"),qk.linearNone=function(qS,q_,qa,qR){return qa*qS/qR+q_},qk.linearIn=function(qS,q_,qa,qR){return qa*qS/qR+q_},qk.linearInOut=function(qS,q_,qa,qR){return qa*qS/qR+q_},qk.linearOut=function(qS,q_,qa,qR){return qa*qS/qR+q_},qk.bounceIn=function(qS,q_,qa,qR){return qa-qk.bounceOut(qR-qS,0,qa,qR)+q_},qk.bounceInOut=function(qS,q_,qa,qR){return qS<.5*qR?.5*qk.bounceIn(2*qS,0,qa,qR)+q_:.5*qk.bounceOut(2*qS-qR,0,qa,qR)+.5*qa+q_},qk.bounceOut=function(qS,q_,qa,qR){return(qS/=qR)<1/2.75?qa*(7.5625*qS*qS)+q_:qS<2/2.75?qa*(7.5625*(qS-=1.5/2.75)*qS+.75)+q_:qS<2.5/2.75?qa*(7.5625*(qS-=2.25/2.75)*qS+.9375)+q_:qa*(7.5625*(qS-=2.625/2.75)*qS+.984375)+q_},qk.backIn=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=1.70158),qa*(qS/=qR)*qS*((qJ+1)*qS-qJ)+q_},qk.backInOut=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=1.70158),(qS/=.5*qR)<1?.5*qa*(qS*qS*((1+(qJ*=1.525))*qS-qJ))+q_:qa/2*((qS-=2)*qS*((1+(qJ*=1.525))*qS+qJ)+2)+q_},qk.backOut=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=1.70158),qa*((qS=qS/qR-1)*qS*((qJ+1)*qS+qJ)+1)+q_},qk.elasticIn=function(qS,q_,qa,qR,qJ,qV){var qW;return void 0===qJ&&(qJ=0),void 0===qV&&(qV=0),0==qS?q_:1==(qS/=qR)?q_+qa:(qV||(qV=.3*qR),qW=!qJ||0<qa&&qJ<qa||qa<0&&qJ<-qa?(qJ=qa,qV/4):qV/qk.PI2*Math.asin(qa/qJ),-qJ*Math.pow(2,10*(qS-=1))*Math.sin((qS*qR-qW)*qk.PI2/qV)+q_)},qk.elasticInOut=function(qS,q_,qa,qR,qJ,qV){var qW;return void 0===qJ&&(qJ=0),void 0===qV&&(qV=0),0==qS?q_:2==(qS/=.5*qR)?q_+qa:(qV||(qV=qR*(.3*1.5)),qW=!qJ||0<qa&&qJ<qa||qa<0&&qJ<-qa?(qJ=qa,qV/4):qV/qk.PI2*Math.asin(qa/qJ),qS<1?qJ*Math.pow(2,10*(qS-=1))*Math.sin((qS*qR-qW)*qk.PI2/qV)*-.5+q_:qJ*Math.pow(2,-10*(qS-=1))*Math.sin((qS*qR-qW)*qk.PI2/qV)*.5+qa+q_)},qk.elasticOut=function(qS,q_,qa,qR,qJ,qV){var qW;return void 0===qJ&&(qJ=0),void 0===qV&&(qV=0),0==qS?q_:1==(qS/=qR)?q_+qa:(qV||(qV=.3*qR),qW=!qJ||0<qa&&qJ<qa||qa<0&&qJ<-qa?(qJ=qa,qV/4):qV/qk.PI2*Math.asin(qa/qJ),qJ*Math.pow(2,-10*qS)*Math.sin((qS*qR-qW)*qk.PI2/qV)+qa+q_)},qk.strongIn=function(qS,q_,qa,qR){return qa*(qS/=qR)*qS*qS*qS*qS+q_},qk.strongInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*qa*qS*qS*qS*qS*qS+q_:.5*qa*((qS-=2)*qS*qS*qS*qS+2)+q_},qk.strongOut=function(qS,q_,qa,qR){return qa*((qS=qS/qR-1)*qS*qS*qS*qS+1)+q_},qk.sineInOut=function(qS,q_,qa,qR){return.5*-qa*(Math.cos(Math.PI*qS/qR)-1)+q_},qk.sineIn=function(qS,q_,qa,qR){return-qa*Math.cos(qS/qR*qk.HALF_PI)+qa+q_},qk.sineOut=function(qS,q_,qa,qR){return qa*Math.sin(qS/qR*qk.HALF_PI)+q_},qk.quintIn=function(qS,q_,qa,qR){return qa*(qS/=qR)*qS*qS*qS*qS+q_},qk.quintInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*qa*qS*qS*qS*qS*qS+q_:.5*qa*((qS-=2)*qS*qS*qS*qS+2)+q_},qk.quintOut=function(qS,q_,qa,qR){return qa*((qS=qS/qR-1)*qS*qS*qS*qS+1)+q_},qk.quartIn=function(qS,q_,qa,qR){return qa*(qS/=qR)*qS*qS*qS+q_},qk.quartInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*qa*qS*qS*qS*qS+q_:.5*-qa*((qS-=2)*qS*qS*qS-2)+q_},qk.quartOut=function(qS,q_,qa,qR){return-qa*((qS=qS/qR-1)*qS*qS*qS-1)+q_},qk.cubicIn=function(qS,q_,qa,qR){return qa*(qS/=qR)*qS*qS+q_},qk.cubicInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*qa*qS*qS*qS+q_:.5*qa*((qS-=2)*qS*qS+2)+q_},qk.cubicOut=function(qS,q_,qa,qR){return qa*((qS=qS/qR-1)*qS*qS+1)+q_},qk.quadIn=function(qS,q_,qa,qR){return qa*(qS/=qR)*qS+q_},qk.quadInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*qa*qS*qS+q_:.5*-qa*(--qS*(qS-2)-1)+q_},qk.quadOut=function(qS,q_,qa,qR){return-qa*(qS/=qR)*(qS-2)+q_},qk.expoIn=function(qS,q_,qa,qR){return 0==qS?q_:qa*Math.pow(2,10*(qS/qR-1))+q_-.001*qa},qk.expoInOut=function(qS,q_,qa,qR){return 0==qS?q_:qS==qR?q_+qa:(qS/=.5*qR)<1?.5*qa*Math.pow(2,10*(qS-1))+q_:.5*qa*(2-Math.pow(2,-10*--qS))+q_},qk.expoOut=function(qS,q_,qa,qR){return qS==qR?q_+qa:qa*(1-Math.pow(2,-10*qS/qR))+q_},qk.circIn=function(qS,q_,qa,qR){return-qa*(Math.sqrt(1-(qS/=qR)*qS)-1)+q_},qk.circInOut=function(qS,q_,qa,qR){return(qS/=.5*qR)<1?.5*-qa*(Math.sqrt(1-qS*qS)-1)+q_:.5*qa*(Math.sqrt(1-(qS-=2)*qS)+1)+q_},qk.circOut=function(qS,q_,qa,qR){return qa*Math.sqrt(1-(qS=qS/qR-1)*qS)+q_},qk.HALF_PI=.5*Math.PI,qk.PI2=2*Math.PI,qk}(),qZ=function(){function qL(){this._hit=null,this._unHit=null}qo(qL,"laya.utils.HitArea");var qS=qL.prototype;return qS.isHit=function(qS,q_){return!!qL.isHitGraphic(qS,q_,this.hit)&&!qL.isHitGraphic(qS,q_,this.unHit)},qS.contains=function(qS,q_){return this.isHit(qS,q_)},qH(0,qS,"hit",function(){return this._hit||(this._hit=new qC),this._hit},function(qS){this._hit=qS}),qH(0,qS,"unHit",function(){return this._unHit||(this._unHit=new qC),this._unHit},function(qS){this._unHit=qS}),qL.isHitGraphic=function(qS,q_,qa){if(!qa)return!1;var qR;if(!(qR=qa.cmds)&&qa._one&&((qR=qL._cmds).length=1,qR[0]=qa._one),!qR)return!1;var qJ,qV,qW=0;for(qJ=qR.length,qW=0;qW<qJ;qW++)if(qV=qR[qW]){var qk=qK._context;switch(qV.callee){case qk._translate:case 6:qS-=qV[0],q_-=qV[1]}if(qL.isHitCmd(qS,q_,qV))return!0}return!1},qL.isHitCmd=function(qS,q_,qa){if(!qa)return!1;var qR=qK._context,qJ=!1;switch(qa.callee){case qR._drawRect:case 13:qL._rec.setTo(qa[0],qa[1],qa[2],qa[3]),qJ=qL._rec.contains(qS,q_);break;case qR._drawCircle:case qR._fillCircle:case 14:qJ=(qS-=qa[0])*qS+(q_-=qa[1])*q_<qa[2]*qa[2];break;case qR._drawPoly:case 18:qS-=qa[0],q_-=qa[1],qJ=qL.ptInPolygon(qS,q_,qa[2])}return qJ},qL.ptInPolygon=function(qS,q_,qa){var qR;(qR=qL._ptPoint).setTo(qS,q_);var qJ,qV=0,qW=NaN,qk=NaN,qz=NaN,qb=NaN;qJ=qa.length;for(var qH=0;qH<qJ;qH+=2){if(qW=qa[qH],qk=qa[qH+1],qz=qa[(qH+2)%qJ],qk!=(qb=qa[(qH+3)%qJ]))if(!(qR.y<Math.min(qk,qb)))if(!(qR.y>=Math.max(qk,qb)))(qR.y-qk)*(qz-qW)/(qb-qk)+qW>qR.x&&qV++}return qV%2==1},qL._cmds=[],qz(qL,["_rec",function(){return this._rec=new qn},"_ptPoint",function(){return this._ptPoint=new qN}]),qL}(),qp=(function(){function qJ(qS,q_,qa,qR){this.char=qS,this.charNum=qS.charCodeAt(0),this._x=this._y=0,this.width=q_,this.height=qa,this.style=qR,this.isWord=!qJ._isWordRegExp.test(qS)}qo(qJ,"laya.utils.HTMLChar");var qS=qJ.prototype;qq.imps(qS,{"laya.display.ILayout":!0}),qS.setSprite=function(qS){this._sprite=qS},qS.getSprite=function(){return this._sprite},qS._isChar=function(){return!0},qS._getCSSStyle=function(){return this.style},qH(0,qS,"width",function(){return this._w},function(qS){this._w=qS}),qH(0,qS,"x",function(){return this._x},function(qS){this._sprite&&(this._sprite.x=qS),this._x=qS}),qH(0,qS,"y",function(){return this._y},function(qS){this._sprite&&(this._sprite.y=qS),this._y=qS}),qH(0,qS,"height",function(){return this._h},function(qS){this._h=qS}),qJ._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function q_(){}qo(q_,"laya.utils.Log"),q_.enable=function(){q_._logdiv||(q_._logdiv=qg.window.document.createElement("div"),qg.window.document.body.appendChild(q_._logdiv),q_._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},q_.toggle=function(){var qS=q_._logdiv.style;"1px"==qS.width?qS.width=qS.height="50%":qS.width=qS.height="1px"},q_.print=function(qS){q_._logdiv&&(q_.maxCount<=q_._count&&q_.clear(),q_._count++,q_._logdiv.innerText+=qS+"\n",q_._logdiv.scrollTop=q_._logdiv.scrollHeight)},q_.clear=function(){q_._logdiv.innerText="",q_._count=0},q_._logdiv=null,q_._count=0,q_.maxCount=20}(),function(){function q_(){}qo(q_,"laya.utils.Mouse"),qH(1,q_,"cursor",function(){return q_._style.cursor},function(qS){q_._style.cursor=qS}),q_.hide=function(){"none"!=q_.cursor&&(q_._preCursor=q_.cursor,q_.cursor="none")},q_.show=function(){"none"==q_.cursor&&(q_.cursor=q_._preCursor?q_._preCursor:"auto")},q_._preCursor=null,qz(q_,["_style",function(){return this._style=qg.document.body.style}])}(),function(){function qV(){}return qo(qV,"laya.utils.Pool"),qV.getPoolBySign=function(qS){return qV._poolDic[qS]||(qV._poolDic[qS]=[])},qV.clearBySign=function(qS){qV._poolDic[qS]&&(qV._poolDic[qS].length=0)},qV.recover=function(qS,q_){q_.__InPool||(q_.__InPool=!0,qV.getPoolBySign(qS).push(q_))},qV.getItemByClass=function(qS,q_){var qa=qV.getPoolBySign(qS),qR=qa.length?qa.pop():new q_;return qR.__InPool=!1,qR},qV.getItemByCreateFun=function(qS,q_,qa){var qR=qV.getPoolBySign(qS),qJ=qR.length?qR.pop():q_.call(qa);return qJ.__InPool=!1,qJ},qV.getItem=function(qS){var q_=qV.getPoolBySign(qS),qa=q_.length?q_.pop():null;return qa&&(qa.__InPool=!1),qa},qV._poolDic={},qV.InPoolSign="__InPool",qV}()),qc=function(){function qz(){}return qo(qz,"laya.utils.Stat"),qH(1,qz,"onclick",null,function(qS){qz._sp&&qz._sp.on("click",qz._sp,qS),qz._canvas&&(qz._canvas.source.onclick=qS,qz._canvas.source.style.pointerEvents="")}),qz.show=function(qS,q_,qa){if(void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),!qK.isConchApp||qK.isConchWebGL){if(qK.isConchWebGL||qg.onMiniGame||qg.onLimixiu||(qz._useCanvas=!0),qz._show=!0,qz._fpsData.length=60,qz._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},qz._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},qz._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},qz._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},qK.isWebGL)if(qz._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},qK.is3DMode){if(qz._view[0].title="FPS(3D)",qz._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},qz._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},qz._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==qa){var qR=8;qz._view[qR++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},qz._view[qR++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},qz._view[qR++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==qa){qR=8;qz._view[qR++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},qz._view[qR++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},qz._view[qR++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},qz._view[qR++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},qz._view[qR++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},qz._view[qR++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},qz._view[qR++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else qz._view[0].title="FPS(WebGL)",qz._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else qz._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};qz._useCanvas?qz.createUIPre(qS,q_):qz.createUI(qS,q_),qz.enable()}else qg.window.conch.showFPS&&qg.window.conch.showFPS(qS,q_)},qz.createUIPre=function(qS,q_){var qa=qg.pixelRatio;qz._width=170*qa,qz._vx=75*qa,qz._height=qa*(12*qz._view.length+3*qa)+4,qz._fontSize=12*qa;for(var qR=0;qR<qz._view.length;qR++)qz._view[qR].x=4,qz._view[qR].y=qR*qz._fontSize+2*qa;qz._canvas||((qz._canvas=new qDS("2D")).size(qz._width,qz._height),(qz._ctx=qz._canvas.getContext("2d")).textBaseline="top",qz._ctx.font=qz._fontSize+"px Sans-serif",qz._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+qS+"px;top:"+q_+"px;width:"+qz._width/qa+"px;height:"+qz._height/qa+"px;"),qz._first=!0,qz.loop(),qz._first=!1,qg.container.appendChild(qz._canvas.source)},qz.createUI=function(qS,q_){var qa=qz._sp,qR=qg.pixelRatio;qa||(qa=new qLS,(qz._leftText=new q$S).pos(5,5),qz._leftText.color="#ffffff",qa.addChild(qz._leftText),(qz._txt=new q$S).pos(80*qR,5),qz._txt.color="#ffffff",qa.addChild(qz._txt),qz._sp=qa),qa.pos(qS,q_);for(var qJ="",qV=0;qV<qz._view.length;qV++){qJ+=qz._view[qV].title+"\n"}qz._leftText.text=qJ;var qW=170*qR,qk=qR*(12*qz._view.length+3*qR)+4;qz._txt.fontSize=qz._fontSize*qR,qz._leftText.fontSize=qz._fontSize*qR,qa.size(qW,qk),qa.graphics.clear(),qa.graphics.setAlpha(.5),qa.graphics.drawRect(0,0,qW,qk,"#999999"),qa.graphics.setAlpha(1),qz.loop()},qz.enable=function(){qq.timer.frameLoop(1,qz,qz.loop)},qz.hide=function(){qz._show=!1,qq.timer.clear(qz,qz.loop),qz._canvas&&qg.removeElement(qz._canvas.source)},qz.clear=function(){qz.trianglesFaces=qz.drawCall=qz.shaderCall=qz.spriteCount=qz.spriteRenderUseCacheCount=qz.treeNodeCollision=qz.treeSpriteCollision=qz.canvasNormal=qz.canvasBitmap=qz.canvasReCache=0},qz.loop=function(){qz._count++;var qS=qg.now();if(!(qS-qz._timer<1e3)){var q_=qz._count;if(qz.FPS=Math.round(1e3*q_/(qS-qz._timer)),qz._show){qz.trianglesFaces=Math.round(qz.trianglesFaces/q_),qz.spriteCount=qz._useCanvas?(qz.drawCall=Math.round(qz.drawCall/q_)-2,qz.shaderCall=Math.round(qz.shaderCall/q_),Math.round(qz.spriteCount/q_)-1):(qz.drawCall=Math.round(qz.drawCall/q_)-2,qz.shaderCall=Math.round(qz.shaderCall/q_)-4,Math.round(qz.spriteCount/q_)-4),qz.spriteRenderUseCacheCount=Math.round(qz.spriteRenderUseCacheCount/q_),qz.canvasNormal=Math.round(qz.canvasNormal/q_),qz.canvasBitmap=Math.round(qz.canvasBitmap/q_),qz.canvasReCache=Math.ceil(qz.canvasReCache/q_),qz.treeNodeCollision=Math.round(qz.treeNodeCollision/q_),qz.treeSpriteCollision=Math.round(qz.treeSpriteCollision/q_);var qa=0<qz.FPS?Math.floor(1e3/qz.FPS).toString():" ";qz._fpsStr=qz.FPS+(qz.renderSlow?" slow":"")+" "+qa,qz._spriteStr=qz.spriteCount+(qz.spriteRenderUseCacheCount?"/"+qz.spriteRenderUseCacheCount:""),qz._canvasStr=qz.canvasReCache+"/"+qz.canvasNormal+"/"+qz.canvasBitmap,qz.currentMemorySize=qe.systemResourceManager.memorySize,qz._useCanvas?qz.renderInfoPre():qz.renderInfo(),qz.clear()}qz._count=0,qz._timer=qS}},qz.renderInfoPre=function(){if(qz._canvas){var qS=qz._ctx;qS.clearRect(qz._first?0:qz._vx,0,qz._width,qz._height);for(var q_=qK.WebGL.mainContext,qa=0;qa<qz._view.length;qa++){var qR=qz._view[qa];qz._first&&(qS.fillStyle="white",qS.fillText(qR.title,qR.x,qR.y,null,null,null)),qS.fillStyle=qR.color;var qJ=-1;if((qR=qz._view[qa]).varying){if(q_)switch(qR.varying){case 1:qJ=q_.getParameter(q_[qR.value]);break;case 2:qJ=q_.getExtension(qR.value)}}else qJ=qz[qR.value];"M"==qR.units&&(qJ=Math.floor(qJ/1048576*100)/100+" M"),"K"==qR.units&&(qJ=Math.floor(qJ/1024*100)/100+" K"),"string"==qR.units&&(qJ=qJ.match(/\d+\.?\d/i)),qS.fillText(qJ+"",qR.x+qz._vx,qR.y,null,null,null)}}},qz.renderInfo=function(){for(var qS="",q_=qK.WebGL.mainContext,qa=0;qa<qz._view.length;qa++){var qR=qz._view[qa],qJ=-1;if(qR.varying){if(q_)switch(qR.varying){case 1:qJ=q_.getParameter(q_[qR.value]);break;case 2:qJ=q_.getExtension(qR.value)}}else qJ=qz[qR.value];"M"==qR.units&&(qJ=Math.floor(qJ/1048576*100)/100+" M"),"K"==qR.units&&(qJ=Math.floor(qJ/1024*100)/100+" K"),"string"==qR.units&&(qJ=qJ.match(/\d+\.?\d/i)),qS+=qJ+"\n"}qz._txt.text=qS},qz.FPS=0,qz.loopCount=0,qz.shaderCall=0,qz.drawCall=0,qz.trianglesFaces=0,qz.spriteCount=0,qz.spriteRenderUseCacheCount=0,qz.treeNodeCollision=0,qz.treeSpriteCollision=0,qz.canvasNormal=0,qz.canvasBitmap=0,qz.canvasReCache=0,qz.renderSlow=!1,qz.currentMemorySize=0,qz._fpsStr=null,qz._canvasStr=null,qz._spriteStr=null,qz._fpsData=[],qz._timer=0,qz._count=0,qz._view=[],qz._fontSize=12,qz._txt=null,qz._leftText=null,qz._sp=null,qz._show=!1,qz._useCanvas=!1,qz._canvas=null,qz._ctx=null,qz._first=!1,qz._vx=NaN,qz._width=0,qz._height=100,qz}(),qy=(function(){function qS(){this._strsToID={},this._idToStrs=[],this._length=0}qo(qS,"laya.utils.StringKey");var q_=qS.prototype;q_.add=function(qS){var q_=this._strsToID[qS];return null!=q_?q_:(this._idToStrs[this._length]=qS,this._strsToID[qS]=this._length++)},q_.getID=function(qS){var q_=this._strsToID[qS];return null==q_?-1:q_},q_.getName=function(qS){var q_=this._idToStrs[qS];return null==q_?void 0:q_}}(),function(){var qb;function qS(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}qo(qS,"laya.utils.Timer");var q_=qS.prototype;return q_._init=function(){qq.timer&&qq.timer.frameLoop(1,this,this._update)},q_._now=function(){return Date.now()},q_._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var qS=this.currFrame=this.currFrame+this.scale,q_=this._now();this._delta=(q_-this._lastTimer)*this.scale;var qa=this.currTimer=this.currTimer+this._delta;qq.isDebug&&6e4<Math.abs(q_-this._lastTimer)&&console.error("系统时间错误！"+(q_-this._lastTimer)),this._lastTimer=q_;var qR=this._handlers;for(qW=this._count=0,qk=qR.length;qW<qk;qW++)if(null!==(qz=qR[qW]).method){var qJ=qz.userFrame?qS:qa;if(qJ>=qz.exeTime)if(qz.repeat)if(qz.jumpFrame)for(;qJ>=qz.exeTime;)qz.exeTime+=qz.delay,qz.run(!1);else qz.exeTime+=qz.delay,qz.run(!1),qJ>qz.exeTime&&(qz.exeTime+=Math.ceil((qJ-qz.exeTime)/qz.delay)*qz.delay);else qz.run(!0)}else this._count++;(30<this._count||qS%200==0)&&this._clearHandlers();for(var qV=this._laters,qW=0,qk=qV.length-1;qW<=qk;qW++){var qz=qV[qW];this._isIgnoreRecover(qz)||(null!==qz.method&&(delete this._map[qz.key],qz.run(!1)),this._recoverHandler(qz)),qW===qk&&(qk=qV.length-1)}qV.length=0}},q_._clearHandlers=function(){for(var qS=this._handlers,q_=0,qa=qS.length;q_<qa;q_++){var qR=qS[q_];null!==qR.method?this._temp.push(qR):this._isIgnoreRecover(qR)?this._temp.push(qR):this._recoverHandler(qR)}this._handlers=this._temp,this._temp=qS,this._temp.length=0},q_._recoverHandler=function(qS){this._map[qS.key]==qS&&delete this._map[qS.key],qS.recover()},q_._create=function(qS,q_,qa,qR,qJ,qV,qW,qk){if(!qa)return qJ.apply(qR,qV),null;if(qW){var qz=this._getHandler(qR,qJ);if(qz)return qz.repeat=q_,qz.userFrame=qS,qz.delay=qa,qz.ignoreRecover=qk,qz.caller=qR,qz.method=qJ,qz.args=qV,qz.exeTime=qa+(qS?this.currFrame:this.currTimer+this._now()-this._lastTimer),qz}return(qz=qb.create()).repeat=q_,qz.userFrame=qS,qz.delay=qa,qz.ignoreRecover=qk,qz.caller=qR,qz.method=qJ,qz.args=qV,qz.exeTime=qa+(qS?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(qz),this._handlers.push(qz),qz},q_._indexHandler=function(qS){var q_=qS.caller,qa=qS.method,qR=q_?q_.$_GID||(q_.$_GID=qO.getGID()):0,qJ=qa.$_TID||(qa.$_TID=this._mid++);qS.key=qR+"_"+qJ,this._map[qS.key]=qS},q_.once=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=!0),this._create(!1,!1,qS,q_,qa,qR,qJ,!1)},q_.loop=function(qS,q_,qa,qR,qJ,qV,qW){void 0===qJ&&(qJ=!0),void 0===qV&&(qV=!1),void 0===qW&&(qW=!1);var qk=this._create(!1,!0,qS,q_,qa,qR,qJ,qW);qk&&(qk.jumpFrame=qV)},q_.frameOnce=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=!0),this._create(!0,!1,qS,q_,qa,qR,qJ,!1)},q_.frameLoop=function(qS,q_,qa,qR,qJ,qV){void 0===qJ&&(qJ=!0),void 0===qV&&(qV=!1),this._create(!0,!0,qS,q_,qa,qR,qJ,qV)},q_.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+qb._freeCount},q_.clear=function(qS,q_){var qa=this._getHandler(qS,q_);return!(!qa||this._isIgnoreRecover(qa))&&(delete this._map[qa.key],qa.key=null,qa.clear(),!0)},q_.clearAll=function(qS){if(qS)for(var q_=0,qa=this._handlers.length;q_<qa;q_++){var qR=this._handlers[q_];qR.caller===qS&&(this._isIgnoreRecover(qR)||(delete this._map[qR.key],qR.key=null,qR.clear()))}},q_._getHandler=function(qS,q_){var qa=qS?qS.$_GID||(qS.$_GID=qO.getGID()):0,qR=q_.$_TID||(q_.$_TID=this._mid++);return this._map[qa+"_"+qR]},q_._isIgnoreRecover=function(qS){if(qS.ignoreRecover||qS.caller&&"IgnoreRecover"==qS.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var q_="";try{arguments.propertyIsEnumerable.caller}catch(qS){q_=qS.stack}qq.recordError("报错：核心定时器销毁忽略  "+q_)}return!0}return!1},q_.hasHandler=function(qS,q_){return this._map[qS.$_GID+"_"+q_.$_TID]},q_.callLater=function(qS,q_,qa){if(null==this._getHandler(qS,q_)){var qR=qb.create();qR.caller=qS,qR.method=q_,qR.args=qa,this._indexHandler(qR),this._laters.push(qR)}},q_.runCallLater=function(qS,q_){var qa=this._getHandler(qS,q_);qa&&null!=qa.method&&(this._isIgnoreRecover(qa)||(delete this._map[qa.key],qa.run(!0)))},q_.runTimer=function(qS,q_){this.runCallLater(qS,q_)},qH(0,q_,"delta",function(){return this._delta}),qS.__init$=function(){qb=function(){function q_(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}qo(q_,"");var qS=q_.prototype;return qS.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},qS.recover=function(){this.clear(),this.args=q_._freeHandler,q_._freeHandler=this,q_._freeCount++},qS.run=function(qS){var q_=this.caller;if(q_&&q_.destroyed)return this.clear();var qa=this.method,qR=this.args;qS&&this.clear(),null!=qa&&(qR?qa.apply(q_,qR):qa.call(q_))},q_._freeHandler=null,q_._freeCount=0,q_.create=function(){var qS=q_._freeHandler;return qS?(q_._freeHandler=qS.args,--q_._freeCount,qS.args=null,qS):new q_},q_}()},qS}()),qE=function(){function qL(){this.gid=0}qo(qL,"laya.utils.Tween");var qS=qL.prototype;return qS.to=function(qS,q_,qa,qR,qJ,qV,qW){return void 0===qV&&(qV=0),void 0===qW&&(qW=!1),this._create(qS,q_,qa,qR,qJ,qV,qW,!0,!1,!0)},qS.from=function(qS,q_,qa,qR,qJ,qV,qW){return void 0===qV&&(qV=0),void 0===qW&&(qW=!1),this._create(qS,q_,qa,qR,qJ,qV,qW,!1,!1,!0)},qS._create=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){if(!qS)throw new Error("Tween:target is null");this._target=qS,this._duration=qa,this._ease=qR||q_.ease||qL.easeNone,this._complete=qJ||q_.complete,this._delay=qV,this._props=[],this._usedTimer=0,this._startTimer=qg.now(),this._usedPool=qz,this._delayParam=null,this.update=q_.update;var qH=qS.$_GID||(qS.$_GID=qO.getGID());return qL.tweenMap[qH]?(qW&&qL.clearTween(qS),qL.tweenMap[qH].push(this)):qL.tweenMap[qH]=[this],qb?qV<=0?this.firstStart(qS,q_,qk):(this._delayParam=[qS,q_,qk],qq.scaleTimer.once(qV,this,this.firstStart,this._delayParam)):this._initProps(qS,q_,qk),this},qS.firstStart=function(qS,q_,qa){this._delayParam=null,qS.destroyed?this.clear():(this._initProps(qS,q_,qa),this._beginLoop())},qS._initProps=function(qS,q_,qa){for(var qR in q_)if("number"==typeof qS[qR]){var qJ=qa?qS[qR]:q_[qR],qV=qa?q_[qR]:qS[qR];this._props.push([qR,qJ,qV-qJ]),qa||(qS[qR]=qJ)}},qS._beginLoop=function(){qq.scaleTimer.frameLoop(1,this,this._doEase)},qS._doEase=function(){this._updateEase(qg.now())},qS._updateEase=function(qS){var q_=this._target;if(q_){if(q_.destroyed)return qL.clearTween(q_);var qa=this._usedTimer=qS-this._startTimer-this._delay;if(!(qa<0)){if(qa>=this._duration)return this.complete();for(var qR=0<qa?this._ease(qa,0,1,this._duration):0,qJ=this._props,qV=0,qW=qJ.length;qV<qW;qV++){var qk=qJ[qV];q_[qk[0]]=qk[1]+qR*qk[2]}this.update&&this.update.run()}}},qS.complete=function(){if(this._target){qq.scaleTimer.runTimer(this,this.firstStart);for(var qS=this._target,q_=this._props,qa=this._complete,qR=0,qJ=q_.length;qR<qJ;qR++){var qV=q_[qR];qS[qV[0]]=qV[1]+qV[2]}this.update&&this.update.run(),this.clear(),qa&&qa.run()}},qS.pause=function(){qq.scaleTimer.clear(this,this._beginLoop),qq.scaleTimer.clear(this,this._doEase),qq.scaleTimer.clear(this,this.firstStart);var qS;(qS=qg.now()-this._startTimer-this._delay)<0&&(this._usedTimer=qS)},qS.setStartTime=function(qS){this._startTimer=qS},qS.clear=function(){this._target&&(this._remove(),this._clear())},qS._clear=function(){this.pause(),qq.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,qp.recover("tween",this))},qS.recover=function(){this._usedPool=!0,this._clear()},qS._remove=function(){var qS=qL.tweenMap[this._target.$_GID];if(qS)for(var q_=0,qa=qS.length;q_<qa;q_++)if(qS[q_]===this){qS.splice(q_,1);break}},qS.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=qg.now(),this._delayParam)qq.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var qS=this._props,q_=0,qa=qS.length;q_<qa;q_++){var qR=qS[q_];this._target[qR[0]]=qR[1]}qq.scaleTimer.once(this._delay,this,this._beginLoop)}},qS.resume=function(){this._usedTimer>=this._duration||(this._startTimer=qg.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?qq.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},qH(0,qS,"progress",null,function(qS){var q_=qS*this._duration;this._startTimer=qg.now()-this._delay-q_}),qL.to=function(qS,q_,qa,qR,qJ,qV,qW,qk){return void 0===qV&&(qV=0),void 0===qW&&(qW=!1),void 0===qk&&(qk=!0),qp.getItemByClass("tween",qL)._create(qS,q_,qa,qR,qJ,qV,qW,!0,qk,!0)},qL.from=function(qS,q_,qa,qR,qJ,qV,qW,qk){return void 0===qV&&(qV=0),void 0===qW&&(qW=!1),void 0===qk&&(qk=!0),qp.getItemByClass("tween",qL)._create(qS,q_,qa,qR,qJ,qV,qW,!1,qk,!0)},qL.clearAll=function(qS){if(qS&&qS.$_GID){var q_=qL.tweenMap[qS.$_GID];if(q_){for(var qa=0,qR=q_.length;qa<qR;qa++)q_[qa]._clear();q_.length=0}}},qL.clear=function(qS){qS.clear()},qL.clearTween=function(qS){qL.clearAll(qS)},qL.easeNone=function(qS,q_,qa,qR){return qa*qS/qR+q_},qL.tweenMap={},qL}(),qO=function(){function qk(){}return qo(qk,"laya.utils.Utils"),qk.toRadian=function(qS){return qS*qk._pi2},qk.toAngle=function(qS){return qS*qk._pi},qk.toHexColor=function(qS){if(qS<0||isNaN(qS))return null;for(var q_=qS.toString(16);q_.length<6;)q_="0"+q_;return"#"+q_},qk.getGID=function(){return qk._gid++},qk.concatArray=function(qS,q_){if(!q_)return qS;if(!qS)return q_;var qa=0,qR=q_.length;for(qa=0;qa<qR;qa++)qS.push(q_[qa]);return qS},qk.clearArray=function(qS){return qS&&(qS.length=0),qS},qk.copyArray=function(qS,q_){if(qS||(qS=[]),!q_)return qS;qS.length=q_.length;var qa=0,qR=q_.length;for(qa=0;qa<qR;qa++)qS[qa]=q_[qa];return qS},qk.getGlobalRecByPoints=function(qS,q_,qa,qR,qJ){var qV,qW;return qV=new qN(q_,qa),qV=qS.localToGlobal(qV),qW=new qN(qR,qJ),qW=qS.localToGlobal(qW),qn._getWrapRec([qV.x,qV.y,qW.x,qW.y])},qk.getGlobalPosAndScale=function(qS){return qk.getGlobalRecByPoints(qS,0,0,1,1)},qk.bind=function(qS,q_){return qS.bind(q_)},qk.measureText=function(qS,q_){return qA.measureText(qS,q_)},qk.updateOrder=function(qS){if(!qS||qS.length<2)return!1;for(var q_,qa=1,qR=0,qJ=qS.length,qV=NaN;qa<qJ;){for(q_=qS[qR=qa],qV=qS[qR]._zOrder;-1<--qR&&qS[qR]._zOrder>qV;)qS[qR+1]=qS[qR];qS[qR+1]=q_,qa++}var qW=q_.parent.conchModel;if(qW)if(null!=qW.updateZOrder)qW.updateZOrder();else{for(qa=0;qa<qJ;qa++)qW.removeChild(qS[qa].conchModel);for(qa=0;qa<qJ;qa++)qW.addChildAt(qS[qa].conchModel,qa)}return!0},qk.transPointList=function(qS,q_,qa){var qR=0,qJ=qS.length;for(qR=0;qR<qJ;qR+=2)qS[qR]+=q_,qS[qR+1]+=qa},qk.parseInt=function(qS,q_){void 0===q_&&(q_=0);var qa=qg.window.parseInt(qS,q_);return isNaN(qa)?0:qa},qk.getFileExtension=function(qS){qk._extReg.lastIndex=qS.lastIndexOf(".");var q_=qk._extReg.exec(qS);return q_&&1<q_.length?q_[1].toLowerCase():null},qk.getTransformRelativeToWindow=function(qS,q_,qa){var qR=qq.stage,qJ=laya.utils.Utils.getGlobalPosAndScale(qS),qV=qR._canvasTransform.clone(),qW=qV.tx,qk=qV.ty;qV.rotate(-Math.PI/180*qq.stage.canvasDegree),qV.scale(qq.stage.clientScaleX,qq.stage.clientScaleY);var qz=qq.stage.canvasDegree%180!=0,qb=NaN,qH=NaN;qz?(qb=qa+qJ.y,qH=q_+qJ.x,qb*=qV.d,qH*=qV.a,90==qq.stage.canvasDegree?(qb=qW-qb,qH+=qk):(qb+=qW,qH=qk-qH)):(qb=q_+qJ.x,qH=qa+qJ.y,qb*=qV.a,qH*=qV.d,qb+=qW,qH+=qk);var qL=NaN,qC=NaN;return qC=qz?(qL=qV.d*qJ.height,qV.a*qJ.width):(qL=qV.a*qJ.width,qV.d*qJ.height),{x:qb,y:qH,scaleX:qL,scaleY:qC}},qk.fitDOMElementInArea=function(qS,q_,qa,qR,qJ,qV){qS._fitLayaAirInitialized||(qS._fitLayaAirInitialized=!0,qS.style.transformOrigin=qS.style.webKittransformOrigin="left top",qS.style.position="absolute");var qW=qk.getTransformRelativeToWindow(q_,qa,qR);qS.style.transform=qS.style.webkitTransform="scale("+qW.scaleX+","+qW.scaleY+") rotate("+qq.stage.canvasDegree+"deg)",qS.style.width=qJ+"px",qS.style.height=qV+"px",qS.style.left=qW.x+"px",qS.style.top=qW.y+"px"},qk.isOkTextureList=function(qS){if(!qS)return!1;var q_,qa=0,qR=qS.length;for(qa=0;qa<qR;qa++)if(!(q_=qS[qa])||!q_.source)return!1;return!0},qk.isOKCmdList=function(qS){if(!qS)return!1;var q_,qa,qR=0,qJ=qS.length,qV=qK._context;for(qR=0;qR<qJ;qR++)switch((q_=qS[qR]).callee){case qV._drawTexture:case qV._fillTexture:case qV._drawTextureWithTransform:if(!(qa=q_[0])||!qa.source)return!1}return!0},qk._gid=1,qk._pi=180/Math.PI,qk._pi2=Math.PI/180,qk._extReg=/\.(\w+)\??/g,qk.parseXMLFromString=function(qS){var q_;if(qS=qS.replace(/>\s+</g,"><"),-1<(q_=(new DOMParser).parseFromString(qS,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(q_.firstChild.firstChild.textContent);return q_},qk}(),qw=function(){function qS(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],qK.isWebGL&&qs.regCacheByFunction(qO.bind(this.startDispose,this),qO.bind(this.getCacheList,this))}qo(qS,"laya.utils.VectorGraphManager");var q_=qS.prototype;return q_.getId=function(){return this._id++},q_.addShape=function(qS,q_){this.shapeDic[qS]=q_,this.useDic[qS]||(this.useDic[qS]=!0)},q_.addLine=function(qS,q_){this.shapeLineDic[qS]=q_,this.shapeLineDic[qS]||(this.shapeLineDic[qS]=!0)},q_.getShape=function(qS){this._checkKey&&null!=this.useDic[qS]&&(this.useDic[qS]=!0)},q_.deleteShape=function(qS){this.shapeDic[qS]&&(this.shapeDic[qS]=null,delete this.shapeDic[qS]),this.shapeLineDic[qS]&&(this.shapeLineDic[qS]=null,delete this.shapeLineDic[qS]),null!=this.useDic[qS]&&delete this.useDic[qS]},q_.getCacheList=function(){var qS,q_=[];for(qS in this.shapeDic)q_.push(this.shapeDic[qS]);for(qS in this.shapeLineDic)q_.push(this.shapeLineDic[qS]);return q_},q_.startDispose=function(qS){var q_;for(q_ in this.useDic)this.useDic[q_]=!1;this._checkKey=!0},q_.endDispose=function(){if(this._checkKey){var qS;for(qS in this.useDic)this.useDic[qS]||this.deleteShape(qS);this._checkKey=!1}},qS.getInstance=function(){return qS.instance=qS.instance||new qS},qS.instance=null,qS}(),qv=function(){function qR(){this._obj=null,this._obj=qR.supportWeakMap?new qg.window.WeakMap:{},qR.supportWeakMap||qR._maps.push(this)}qo(qR,"laya.utils.WeakObject");var qS=qR.prototype;return qS.set=function(qS,q_){if(null!=qS)if(qR.supportWeakMap){var qa=qS;"string"!=typeof qS&&"number"!=typeof qS||(qa=qR._keys[qS])||(qa=qR._keys[qS]={k:qS}),this._obj.set(qa,q_)}else"string"==typeof qS||"number"==typeof qS?this._obj[qS]=q_:(qS.$_GID||(qS.$_GID=qO.getGID()),this._obj[qS.$_GID]=q_)},qS.get=function(qS){if(null==qS)return null;if(qR.supportWeakMap){var q_="string"==typeof qS||"number"==typeof qS?qR._keys[qS]:qS;return q_?this._obj.get(q_):null}return"string"==typeof qS||"number"==typeof qS?this._obj[qS]:this._obj[qS.$_GID]},qS.del=function(qS){if(null!=qS)if(qR.supportWeakMap){var q_="string"==typeof qS||"number"==typeof qS?qR._keys[qS]:qS;if(!q_)return;this._obj.delete(q_)}else"string"==typeof qS||"number"==typeof qS?delete this._obj[qS]:delete this._obj[this._obj.$_GID]},qS.has=function(qS){if(null==qS)return!1;if(qR.supportWeakMap){var q_="string"==typeof qS||"number"==typeof qS?qR._keys[qS]:qS;return this._obj.has(q_)}return"string"==typeof qS||"number"==typeof qS?null!=this._obj[qS]:null!=this._obj[this._obj.$_GID]},qR.__init__=function(){(qR.supportWeakMap=null!=qg.window.WeakMap)||qq.timer.loop(qR.delInterval,null,qR.clearCache)},qR.clearCache=function(){for(var qS=0,q_=qR._maps.length;qS<q_;qS++){qR._maps[qS]._obj={}}},qR.supportWeakMap=!1,qR.delInterval=3e5,qR._keys={},qR._maps=[],qz(qR,["I",function(){return this.I=new qR}]),qR}(),qd=function(){function qS(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}qo(qS,"laya.utils.WordText");var q_=qS.prototype;return q_.setText=function(qS){this.changed=!0,this._text=qS},q_.toString=function(){return this._text},q_.charCodeAt=function(qS){return this._text?this._text.charCodeAt(qS):NaN},q_.charAt=function(qS){return this._text?this._text.charAt(qS):null},qH(0,q_,"length",function(){return this._text?this._text.length:0}),qS}(),qSS=function(qS){function qW(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,qW.__super.call(this),this._childs=qW.ARRAY_EMPTY,this._$P=qW.PROP_EMPTY,this.timer=qq.scaleTimer,this.conchModel=qK.isConchNode?this.createConchModel():null}qo(qW,"laya.display.Node",qb);var q_=qW.prototype;return q_._setBit=function(qS,q_){1==qS&&(this._getBit(qS)!=q_&&this._updateDisplayedInstage());q_?this._bits|=qS:this._bits&=~qS},q_._getBit=function(qS){return 0!=(this._bits&qS)},q_._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},q_._setUpNoticeType=function(qS){var q_=this;for(q_._setBit(qS,!0),q_=q_.parent;q_;){if(q_._getBit(qS))return;q_._setBit(qS,!0),q_=q_.parent}},q_.on=function(qS,q_,qa,qR){return"display"!==qS&&"undisplay"!==qS||this._getBit(1)||this._setUpNoticeType(1),this._createListener(qS,q_,qa,qR,!1)},q_.once=function(qS,q_,qa,qR){return"display"!==qS&&"undisplay"!==qS||this._getBit(1)||this._setUpNoticeType(1),this._createListener(qS,q_,qa,qR,!0)},q_.createConchModel=function(){return null},q_.destroy=function(qS){void 0===qS&&(qS=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(qS?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},q_.destroyChildren=function(){if(this._childs)for(var qS=this._childs.length-1;-1<qS;qS--)this._childs[qS].destroy(!0)},q_.addChild=function(qS){if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),qS._parent===this){var q_=this.getChildIndex(qS);q_!==this._childs.length-1&&(this._childs.splice(q_,1),this._childs.push(qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,this._childs.length-1)),this._childChanged())}else qS.parent&&qS.parent.removeChild(qS),this._childs===qW.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,this._childs.length-1),(qS.parent=this)._childChanged();return qS},q_.addChildren=function(qS){for(var q_=arguments,qa=0,qR=q_.length;qa<qR;)this.addChild(q_[qa++])},q_.addChildAt=function(qS,q_){if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),0<=q_&&q_<=this._childs.length){if(qS._parent===this){var qa=this.getChildIndex(qS);this._childs.splice(qa,1),this._childs.splice(q_,0,qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,q_)),this._childChanged()}else qS.parent&&qS.parent.removeChild(qS),this._childs===qW.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(q_,0,qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,q_),qS.parent=this;return qS}throw new Error("appendChildAt:The index is out of bounds")},q_.getChildIndex=function(qS){return this._childs.indexOf(qS)},q_.getChildByName=function(qS){var q_=this._childs;if(q_)for(var qa=0,qR=q_.length;qa<qR;qa++){var qJ=q_[qa];if(qJ.name===qS)return qJ}return null},q_._get$P=function(qS){return this._$P[qS]},q_._set$P=function(qS,q_){return this.destroyed||(this._$P===qW.PROP_EMPTY&&(this._$P={}),this._$P[qS]=q_),q_},q_.getChildAt=function(qS){return this._childs[qS]},q_.setChildIndex=function(qS,q_){var qa=this._childs;if(q_<0||q_>=qa.length)throw new Error("setChildIndex:The index is out of bounds.");var qR=this.getChildIndex(qS);if(qR<0)throw new Error("setChildIndex:node is must child of this object.");return qa.splice(qR,1),qa.splice(q_,0,qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,q_)),this._childChanged(),qS},q_._childChanged=function(qS){},q_.removeChild=function(qS){if(!this._childs)return qS;var q_=this._childs.indexOf(qS);return this.removeChildAt(q_)},q_.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},q_.removeChildByName=function(qS){var q_=this.getChildByName(qS);return q_&&this.removeChild(q_),q_},q_.removeChildAt=function(qS){var q_=this.getChildAt(qS);if(q_){for(var qa=this._childs.length-1,qR=qS;qR<qa;++qR)this._childs[qR]=this._childs[qR+1];this._childs.length=qa,this.conchModel&&this.conchModel.removeChild(q_.conchModel),q_.parent=null}return q_},q_.removeChildren=function(qS,q_){if(void 0===qS&&(qS=0),void 0===q_&&(q_=2147483647),this._childs&&0<this._childs.length){var qa=this._childs;if(0===qS&&qV<=q_){var qR=qa;this._childs=qW.ARRAY_EMPTY}else qR=qa.splice(qS,q_-qS);for(var qJ=0,qV=qR.length;qJ<qV;qJ++)qR[qJ].parent=null,this.conchModel&&this.conchModel.removeChild(qR[qJ].conchModel)}return this},q_.replaceChild=function(qS,q_){var qa=this._childs.indexOf(q_);return-1<qa?(this._childs.splice(qa,1,qS),this.conchModel&&(this.conchModel.removeChild(q_.conchModel),this.conchModel.addChildAt(qS.conchModel,qa)),q_.parent=null,qS.parent=this,qS):null},q_._updateDisplayedInstage=function(){var qS;qS=this;var q_=qq.stage;for(this._displayedInStage=!1;qS;){if(qS._getBit(1)){this._displayedInStage=qS._displayedInStage;break}if(qS==q_||qS._displayedInStage){this._displayedInStage=!0;break}qS=qS.parent}},q_._setDisplay=function(qS){this._displayedInStage!==qS&&((this._displayedInStage=qS)?this.event("display"):this.event("undisplay"))},q_._displayChild=function(qS,q_){var qa=qS._childs;if(qa)for(var qR=0;qR<qa.length;qR++){var qJ=qa[qR];qJ&&qJ._getBit(1)&&(0<qJ._childs.length?this._displayChild(qJ,q_):qJ._setDisplay(q_))}qS._setDisplay(q_)},q_.contains=function(qS){if(qS===this)return!0;for(;qS;){if(qS.parent===this)return!0;qS=qS.parent}return!1},q_.timerLoop=function(qS,q_,qa,qR,qJ,qV){void 0===qJ&&(qJ=!0),void 0===qV&&(qV=!1),this.timer.loop(qS,q_,qa,qR,qJ,qV)},q_.timerOnce=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=!0),this.timer._create(!1,!1,qS,q_,qa,qR,qJ)},q_.frameLoop=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=!0),this.timer._create(!0,!0,qS,q_,qa,qR,qJ)},q_.frameOnce=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=!0),this.timer._create(!0,!1,qS,q_,qa,qR,qJ)},q_.clearTimer=function(qS,q_){this.timer.clear(qS,q_)},qH(0,q_,"numChildren",function(){return this._childs.length}),qH(0,q_,"destroyed",function(){return this._destroyed}),qH(0,q_,"parent",function(){return this._parent},function(qS){this._parent!==qS&&(qS?(this._parent=qS,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),qS.displayedInStage&&this._displayChild(this,!0)),qS._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=qS))}),qH(0,q_,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),qW.ARRAY_EMPTY=[],qW.PROP_EMPTY={},qW.NOTICE_DISPLAY=1,qW.MOUSEENABLE=2,qW}(),q_S=function(qS){function qC(qS){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,qC.__super.call(this),this._padding=qC._PADDING,this._spacing=qC._SPACING,this._aligns=qC._ALIGNS,this._font=qG.EMPTY,this._ower=qS}qo(qC,"laya.display.css.CSSStyle",qS);var q_=qC.prototype;return q_.destroy=function(){this._ower=null,this._font=null,this._rect=null},q_.inherit=function(qS){this._font=qS._font,this._spacing=qS._spacing===qC._SPACING?qC._SPACING:qS._spacing.slice(),this.lineHeight=qS.lineHeight},q_._widthAuto=function(){return 0!=(262144&this._type)},q_.widthed=function(qS){return 0!=(8&this._type)},q_._calculation=function(qS,q_){if(q_.indexOf("%")<0)return!1;var qR=this._ower,qJ=qR.parent,qV=this._rect;function qW(qS,q_,qa){return qS*qa[0]+q_*qa[1]+qa[2]}function qa(qS){var q_=qJ.width,qa=qR.width;qV.width&&(qR.width=qW(q_,qa,qV.width)),qV.height&&(qR.height=qW(q_,qa,qV.height)),qV.left&&(qR.x=qW(q_,qa,qV.left)),qV.top&&(qR.y=qW(q_,qa,qV.top))}null===qV&&(qJ._getCSSStyle()._type|=524288,qJ.on("resize",this,qa),this._rect=qV={input:{}});var qk=q_.split(" ");return qk[0]=parseFloat(qk[0])/100,1==qk.length?qk[1]=qk[2]=0:(qk[1]=parseFloat(qk[1])/100,qk[2]=parseFloat(qk[2])),qV[qS]=qk,qV.input[qS]=q_,qa(),!0},q_.heighted=function(qS){return 0!=(8192&this._type)},q_.size=function(qS,q_){var qa=this._ower,qR=!1;-1!==qS&&qS!=this._ower.width&&(this._type|=8,this._ower.width=qS,qR=!0),-1!==q_&&q_!=this._ower.height&&(this._type|=8192,this._ower.height=q_,qR=!0),qR&&(qa._layoutLater(),524288&this._type&&qa.event("resize",this))},q_._getAlign=function(){return this._aligns[0]},q_._getValign=function(){return this._aligns[1]},q_._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},q_._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new qG(this._font))},q_.render=function(qS,q_,qa,qR){var qJ=qS.width,qV=qS.height;qa-=qS.pivotX,qR-=qS.pivotY,this._bgground&&null!=this._bgground.color&&q_.ctx.fillRect(qa,qR,qJ,qV,this._bgground.color),this._border&&this._border.color&&q_.drawRect(qa,qR,qJ,qV,this._border.color.strColor,this._border.size)},q_.getCSSStyle=function(){return this},q_.cssText=function(qS){this.attrs(qC.parseOneCSS(qS,";"))},q_.attrs=function(qS){if(qS)for(var q_=0,qa=qS.length;q_<qa;q_++){var qR=qS[q_];this[qR[0]]=qR[1]}},q_.setTransform=function(qS){"none"===qS?this._tf=qk._TF_EMPTY:this.attrs(qC.parseOneCSS(qS,","))},q_.translate=function(qS,q_){this._tf===qk._TF_EMPTY&&(this._tf=new qJ),this._tf.translateX=qS,this._tf.translateY=q_},q_.scale=function(qS,q_){this._tf===qk._TF_EMPTY&&(this._tf=new qJ),this._tf.scaleX=qS,this._tf.scaleY=q_},q_._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},qH(0,q_,"block",qS.prototype._$get_block,function(qS){qS?this._type|=1:this._type&=-2}),qH(0,q_,"valign",function(){return qC._valigndef[this._aligns[1]]},function(qS){this._aligns===qC._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=qC._valigndef[qS]}),qH(0,q_,"height",null,function(qS){if(this._type|=8192,"string"==typeof qS){if(this._calculation("height",qS))return;qS=parseInt(qS)}this.size(-1,qS)}),qH(0,q_,"width",null,function(qS){if(this._type|=8,"string"==typeof qS){var q_=qS.indexOf("auto");if(0<=q_&&(this._type|=262144,qS=qS.substr(0,q_)),this._calculation("width",qS))return;qS=parseInt(qS)}this.size(qS,-1)}),qH(0,q_,"fontWeight",function(){return this._font.weight},function(qS){this._createFont().weight=qS}),qH(0,q_,"left",null,function(qS){var q_=this._ower;if("string"==typeof qS){if("center"===qS?qS="50% -50% 0":"right"===qS&&(qS="100% -100% 0"),this._calculation("left",qS))return;qS=parseInt(qS)}q_.x=qS}),qH(0,q_,"_translate",null,function(qS){this.translate(qS[0],qS[1])}),qH(0,q_,"absolute",function(){return 0!=(4&this._type)}),qH(0,q_,"top",null,function(qS){var q_=this._ower;if("string"==typeof qS){if("middle"===qS?qS="50% -50% 0":"bottom"===qS&&(qS="100% -100% 0"),this._calculation("top",qS))return;qS=parseInt(qS)}q_.y=qS}),qH(0,q_,"align",function(){return qC._aligndef[this._aligns[0]]},function(qS){this._aligns===qC._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=qC._aligndef[qS]}),qH(0,q_,"bold",function(){return this._font.bold},function(qS){this._createFont().bold=qS}),qH(0,q_,"padding",function(){return this._padding},function(qS){this._padding=qS}),qH(0,q_,"leading",function(){return this._spacing[1]},function(qS){"string"==typeof qS&&(qS=parseInt(qS+"")),this._spacing===qC._SPACING&&(this._spacing=[0,0]),this._spacing[1]=qS}),qH(0,q_,"lineElement",function(){return 0!=(65536&this._type)},function(qS){qS?this._type|=65536:this._type&=-65537}),qH(0,q_,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(qS){this.lineElement=!1,"right"===qS?this._type|=32768:this._type&=-32769}),qH(0,q_,"textDecoration",function(){return this._font.decoration},function(qS){this._createFont().decoration=qS}),qH(0,q_,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(qS){"nowrap"===qS&&(this._type|=131072),"none"===qS&&(this._type&=-131073)}),qH(0,q_,"background",null,function(qS){qS?(this._bgground||(this._bgground={}),this._bgground.color=qS,this._ower.conchModel&&this._ower.conchModel.bgColor(qS),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),qH(0,q_,"wordWrap",function(){return 0==(131072&this._type)},function(qS){qS?this._type&=-131073:this._type|=131072}),qH(0,q_,"color",function(){return this._font.color},function(qS){this._createFont().color=qS}),qH(0,q_,"password",function(){return this._font.password},function(qS){this._createFont().password=qS}),qH(0,q_,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(qS){"none"===qS?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=qS),this._ower.conchModel&&this._ower.conchModel.bgColor(qS),this._ower._renderType|=256}),qH(0,q_,"font",function(){return this._font.toString()},function(qS){this._createFont().set(qS)}),qH(0,q_,"weight",null,function(qS){this._createFont().weight=qS}),qH(0,q_,"letterSpacing",function(){return this._spacing[0]},function(qS){"string"==typeof qS&&(qS=parseInt(qS+"")),this._spacing===qC._SPACING&&(this._spacing=[0,0]),this._spacing[0]=qS}),qH(0,q_,"fontSize",function(){return this._font.size},function(qS){this._createFont().size=qS}),qH(0,q_,"italic",function(){return this._font.italic},function(qS){this._createFont().italic=qS}),qH(0,q_,"fontFamily",function(){return this._font.family},function(qS){this._createFont().family=qS}),qH(0,q_,"stroke",function(){return this._font.stroke[0]},function(qS){this._createFont().stroke===qG._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=qS}),qH(0,q_,"strokeColor",function(){return this._font.stroke[1]},function(qS){this._createFont().stroke===qG._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=qS}),qH(0,q_,"border",function(){return this._border?this._border.value:""},function(qS){if("none"!=qS){this._border||(this._border={});var q_=(this._border.value=qS).split(" ");if(this._border.color=qf.create(q_[q_.length-1]),1==q_.length)return this._border.size=1,void(this._border.type="solid");var qa=0;0<q_[0].indexOf("px")?(this._border.size=parseInt(q_[0]),qa++):this._border.size=1,this._border.type=q_[qa],this._ower._renderType|=256}else this._border=null}),qH(0,q_,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(qS){qS?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==qS?null:qf.create(qS),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),qH(0,q_,"position",function(){return 4&this._type?"absolute":""},function(qS){"absolute"==qS?this._type|=4:this._type&=-5}),qH(0,q_,"display",null,function(qS){switch(qS){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),qH(0,q_,"paddingLeft",function(){return this.padding[3]}),qH(0,q_,"paddingTop",function(){return this.padding[0]}),qH(0,q_,"_scale",null,function(qS){this._ower.scale(qS[0],qS[1])}),qH(0,q_,"_rotate",null,function(qS){this._ower.rotation=qS}),qC.parseOneCSS=function(qS,q_){for(var qa,qR=[],qJ=qS.split(q_),qV=0,qW=qJ.length;qV<qW;qV++){var qk=qJ[qV],qz=qk.indexOf(":"),qb=qk.substr(0,qz).replace(/^\s+|\s+$/g,"");if(0!=qb.length){var qH=qk.substr(qz+1).replace(/^\s+|\s+$/g,""),qL=[qb,qH];switch(qb){case"italic":case"bold":qL[1]="true"==qH;break;case"line-height":qL[0]="lineHeight",qL[1]=parseInt(qH);break;case"font-size":qL[0]="fontSize",qL[1]=parseInt(qH);break;case"padding":1<(qa=qH.split(" ")).length||(qa[1]=qa[2]=qa[3]=qa[0]),qL[1]=[parseInt(qa[0]),parseInt(qa[1]),parseInt(qa[2]),parseInt(qa[3])];break;case"rotate":qL[0]="_rotate",qL[1]=parseFloat(qH);break;case"scale":qa=qH.split(" "),qL[0]="_scale",qL[1]=[parseFloat(qa[0]),parseFloat(qa[1])];break;case"translate":qa=qH.split(" "),qL[0]="_translate",qL[1]=[parseInt(qa[0]),parseInt(qa[1])];break;default:(qL[0]=qC._CSSTOVALUE[qb])||(qL[0]=qb)}qR.push(qL)}}return qR},qC.parseCSS=function(qS,q_){for(var qa;null!=(qa=qC._parseCSSRegExp.exec(qS));)qC.styleSheets[qa[1]]=qC.parseOneCSS(qa[2],";")},qC.EMPTY=new qC(null),qC._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},qC._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),qC._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},qC._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},qC.styleSheets={},qC.ALIGN_CENTER=1,qC.ALIGN_RIGHT=2,qC.VALIGN_MIDDLE=1,qC.VALIGN_BOTTOM=2,qC._CSS_BLOCK=1,qC._DISPLAY_NONE=2,qC._ABSOLUTE=4,qC._WIDTH_SET=8,qC._PADDING=[0,0,0,0],qC._RECT=[-1,-1,-1,-1],qC._SPACING=[0,0],qC._ALIGNS=[0,0,0],qC.ADDLAYOUTED=512,qC._NEWFONT=4096,qC._HEIGHT_SET=8192,qC._BACKGROUND_SET=16384,qC._FLOAT_RIGHT=32768,qC._LINE_ELEMENT=65536,qC._NOWARP=131072,qC._WIDTHAUTO=262144,qC._LISTERRESZIE=524288,qC}(qk),qaS=function(qS){function qW(){this.url=null,this.audio=null,this.loaded=!1,qW.__super.call(this)}qo(qW,"laya.media.h5audio.AudioSound",qb);var q_=qW.prototype;return q_.dispose=function(){var qS=qW._audioCache[this.url];qS&&(qS.src="",delete qW._audioCache[this.url])},q_.load=function(qS){var q_;if(qS=qu.formatURL(qS),(this.url=qS)==qI._tMusic?(qW._initMusicAudio(),(q_=qW._musicAudio).src!=qS&&(qW._audioCache[q_.src]=null,q_=null)):q_=qW._audioCache[qS],q_&&2<=q_.readyState)this.event("complete");else{q_||(q_=qS==qI._tMusic?(qW._initMusicAudio(),qW._musicAudio):qg.createElement("audio"),(qW._audioCache[qS]=q_).src=qS),q_.addEventListener("canplaythrough",qR),q_.addEventListener("error",qJ);var qa=this;(this.audio=q_).load?q_.load():qJ()}function qR(){qV(),qa.loaded=!0,qa.event("complete")}function qJ(){q_.load=null,qV(),qa.event("error")}function qV(){q_.removeEventListener("canplaythrough",qR),q_.removeEventListener("error",qJ)}},q_.play=function(qS,q_,qa){if(void 0===qS&&(qS=0),void 0===q_&&(q_=0),!this.url)return null;var qR,qJ;if(!(qR=this.url==qI._tMusic?qW._musicAudio:qW._audioCache[this.url]))return null;qJ=qp.getItem("audio:"+this.url),qK.isConchApp?qJ||((qJ=qg.createElement("audio")).src=this.url):this.url==qI._tMusic?(qW._initMusicAudio(),(qJ=qW._musicAudio).src=this.url):qJ=qJ||qR.cloneNode(!0);var qV=new qCS(qJ);return qV.url=this.url,qV.loops=q_,qV.startTime=qS,qV.startHandler=qa,qV.play(!1),qI.addChannel(qV),qV},qH(0,q_,"duration",function(){var qS;return(qS=qW._audioCache[this.url])?qS.duration:0}),qW._initMusicAudio=function(){qW._musicAudio||(qW._musicAudio||(qW._musicAudio=qg.createElement("audio")),qK.isConchApp||qg.document.addEventListener("mousedown",qW._makeMusicOK))},qW._makeMusicOK=function(){qg.document.removeEventListener("mousedown",qW._makeMusicOK),qW._musicAudio.src?qW._musicAudio.play():(qW._musicAudio.src="",qW._musicAudio.load())},qW._audioCache={},qW._musicAudio=null,qW}(),qRS=function(qS){function q_(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,q_.__super.call(this)}qo(q_,"laya.media.SoundChannel",qb);var qa=q_.prototype;return qa.play=function(){},qa.stop=function(){},qa.pause=function(){},qa.resume=function(){},qa.__runComplete=function(qS){qS&&qS.run()},qH(0,qa,"volume",function(){return 1},function(qS){}),qH(0,qa,"position",function(){return 0}),qH(0,qa,"duration",function(){return 0}),q_}(),qJS=function(qS){function q_(){q_.__super.call(this)}qo(q_,"laya.media.Sound",qb);var qa=q_.prototype;return qa.load=function(qS){},qa.play=function(qS,q_,qa){return void 0===qS&&(qS=0),void 0===q_&&(q_=0),null},qa.dispose=function(){},qH(0,qa,"duration",function(){return 0}),q_}(),qVS=function(qS){function qJ(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,qJ.__super.call(this)}qo(qJ,"laya.media.webaudio.WebAudioSound",qb);var q_=qJ.prototype;return q_.load=function(qS){this.url=qS,this.audioBuffer=qJ._dataCache[qS],this.audioBuffer?this._loaded(this.audioBuffer):(qJ.e.on("loaded:"+qS,this,this._loaded),qJ.e.on("err:"+qS,this,this._err),qJ.__loadingSound[qS]||(qJ.__loadingSound[qS]=!0,qq.loader.load(qS,qT.create(this,this.onloaded),null,qkS.BUFFER,4,!1,null,!0)))},q_.onloaded=function(qS){qS||this._err(),this._disposed?this._removeLoadEvents():(this.data=qS,qJ.buffs.push({buffer:this.data,url:this.url}),qJ.decode())},q_._err=function(){if(this._removeLoadEvents(),qJ.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var qS,q_,qa,qR=0;for(qS=(q_=this.__toPlays).length,qR=0;qR<qS;qR++)(qa=q_[qR])[3]&&!qa[3].isStopped&&qa[3].event("error");this.__toPlays.length=0}},q_._loaded=function(qS){this._removeLoadEvents(),this._disposed||(this.audioBuffer=qS,this.loaded=!0,this.event("complete"))},q_._removeLoadEvents=function(){qJ.e.off("loaded:"+this.url,this,this._loaded),qJ.e.off("err:"+this.url,this,this._err)},q_.__playAfterLoaded=function(){if(this.__toPlays){var qS,q_,qa,qR=0;for(qS=(q_=this.__toPlays).length,qR=0;qR<qS;qR++)(qa=q_[qR])[3]&&!qa[3].isStopped&&this.play(qa[0],qa[1],qa[2],qa[3]);this.__toPlays.length=0}},q_.play=function(qS,q_,qa,qR){return void 0===qS&&(qS=0),void 0===q_&&(q_=0),qR=qR||new qGS,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([qS,q_,qa,qR]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),qR.url=this.url,qR.loops=q_,qR.audioBuffer=this.audioBuffer,qR.startTime=qS,qR.startHandler=qa,qR.play(!1),qI.addChannel(qR),qR},q_.dispose=function(){this._disposed=!0,delete qJ._dataCache[this.url],delete qJ.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},qH(0,q_,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),qJ.decode=function(){if(!(qJ.buffs.length<=0||qJ.isDecoding))if(qJ.isDecoding=!0,(qJ.tInfo=qJ.buffs.shift())&&qJ.tInfo.buffer&&qJ.tInfo.buffer.byteLength)try{qJ.ctx.decodeAudioData(qJ.tInfo.buffer,qJ._done,qJ._fail)}catch(qS){console.error("decodeAudioData error  byteLength:"+qJ.tInfo.buffer.byteLength+"  url:"+qJ.tInfo.url)}else qJ._fail()},qJ._done=function(qS){qJ.e.event("loaded:"+qJ.tInfo.url,qS),qJ._dataCache[qJ.tInfo.url]=qS,qJ.isDecoding=!1,qJ.decode()},qJ._fail=function(){qJ.e.event("err:"+qJ.tInfo.url,null),qJ.isDecoding=!1,qJ.decode()},qJ._playEmptySound=function(){if(null!=qJ.ctx){if(qJ._emptySource&&(qJ._emptySource.stop(),qJ._emptySource.disconnect(0),!qGS._tryCleanFailed))try{qJ._emptySource.buffer=null}catch(qS){qGS._tryCleanFailed=!0}var qS=qJ.ctx.createBufferSource();qS.buffer=qJ._miniBuffer,qS.connect(qJ.ctx.destination),qS.start(0,0,0),qJ._emptySource=qS}},qJ._unlock=function(){qJ._unlocked||(qJ._playEmptySound(),"running"==qJ.ctx.state?(qg.document.removeEventListener("mousedown",qJ._unlock,!0),qg.document.removeEventListener("touchend",qJ._unlock,!0),qg.document.removeEventListener("touchstart",qJ._unlock,!0),qJ._unlocked=!0):"suspended"==qJ.ctx.state&&qI._recoverWebAudio())},qJ.initWebAudio=function(){"running"!=qJ.ctx.state&&(qJ._unlock(),qg.document.addEventListener("mousedown",qJ._unlock,!0),qg.document.addEventListener("touchend",qJ._unlock,!0),qg.document.addEventListener("touchstart",qJ._unlock,!0))},qJ._emptySource=null,qJ._dataCache={},qJ.buffs=[],qJ.isDecoding=!1,qJ._unlocked=!1,qJ.tInfo=null,qJ.__loadingSound={},qz(qJ,["window",function(){return this.window=qg.window},"webAudioEnabled",function(){return this.webAudioEnabled=qJ.window.AudioContext||qJ.window.webkitAudioContext||qJ.window.mozAudioContext},"ctx",function(){return this.ctx=qJ.webAudioEnabled?new(qJ.window.AudioContext||qJ.window.webkitAudioContext||qJ.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=qJ.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new qb}]),qJ}(),qWS=function(qS){function q_(){this._responseType=null,this._data=null,q_.__super.call(this),this._http=new qg.window.XMLHttpRequest}qo(q_,"laya.net.HttpRequest",qb);var qa=q_.prototype;return qa.send=function(qS,q_,qa,qR,qJ){void 0===qa&&(qa="get"),void 0===qR&&(qR="text"),this._responseType=qR,this._data=null;var qV=this,qW=this._http;if(qW.open(qa,qS,!0),qJ)for(var qk=0;qk<qJ.length;qk++)qW.setRequestHeader(qJ[qk++],qJ[qk]);else qK.isConchApp||(q_&&"string"!=typeof q_?qW.setRequestHeader("Content-Type","application/json"):qW.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));qW.responseType="arraybuffer"!==qR?"text":"arraybuffer",qW.onerror=function(qS){qV._onError(qS)},qW.onabort=function(qS){qV._onAbort(qS)},qW.onprogress=function(qS){qV._onProgress(qS)},qW.onload=function(qS){qV._onLoad(qS)},qW.send(q_)},qa._onProgress=function(qS){qS&&qS.lengthComputable&&this.event("progress",qS.loaded/qS.total)},qa._onAbort=function(qS){this.error("Request was aborted by user")},qa._onError=function(qS){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},qa._onLoad=function(qS){var q_=this._http,qa=void 0!==q_.status?q_.status:200;200===qa||204===qa||0===qa?this.complete():this.error("["+q_.status+"]"+q_.statusText+":"+q_.responseURL)},qa.error=function(qS){this.clear(),this.event("error",qS)},qa.complete=function(){this.clear();var q_=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=qO.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(qS){q_=!1,this.error(qS.message)}q_&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},qa.clear=function(){var qS=this._http;qS.onerror=qS.onabort=qS.onprogress=qS.onload=null},qH(0,qa,"url",function(){return this._http.responseURL}),qH(0,qa,"http",function(){return this._http}),qH(0,qa,"data",function(){return this._data}),q_}(),qkS=function(qS){function ql(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,ql.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}qo(ql,"laya.net.Loader",qb);var q_=ql.prototype;return q_.load=function(qS,q_,qa,qR,qJ){if(qS&&""!=qS||console.error("Loader 加载的url不合法 "+qS),void 0===qa&&(qa=!0),void 0===qJ&&(qJ=!1),0===(this._url=qS).indexOf("data:image")?this._type=q_="image":this._type=q_||(q_=this.getTypeFromUrl(qS)),this._cache=qa,this._data=null,!qJ&&ql.loadedMap[qS])return this._data=ql.loadedMap[qS],this.event("progress",1),void this.event("complete",this._data);if(qR&&ql.setGroup(qS,qR),null!=ql.parserMap[q_])return this._customParse=!0,void(ql.parserMap[q_]instanceof laya.utils.Handler?ql.parserMap[q_].runWith(this):ql.parserMap[q_].call(null,this));if("image"===q_||"htmlimage"===q_||"nativeimage"===q_)return this._loadImage(qS);if("ttf"===q_)return this._loadTTF(qS);switch(q_){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:q_}ql.preLoadedMap[qS]?this.onLoaded(ql.preLoadedMap[qS]):qW.resMgrLoad(qS,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},q_.getTypeFromUrl=function(qS){var q_=qO.getFileExtension(qS);return q_?ql.typeMap[q_]:(console.warn("Not recognize the resources suffix",qS),"text")},q_._loadTTF=function(qS){qS=qu.formatURL(qS);var q_=new qh;q_.complete=qT.create(this,this.onLoaded),q_.load(qS)},q_._loadImage=function(qS){qW.imgMgrLoad(qS,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},q_._loadImageComplete=function(qS,q_,qa){if(null!=qa)if(qa instanceof ArrayBuffer){var qR=new DataView(qa),qJ=new laya.webgl.resource.WebGLImage(new Uint8Array(qa,8),qS,0,!1,qR.getUint32(0),qR.getUint32(4));this.onLoaded(qJ)}else if(qa instanceof qHS)ql.imgMgrSet[qS]=q_,qW.imgMgrLock(qS,ql.imgMgrSet[qS]),this._url=qS,this.complete(qa);else{var qV=-1!=qS.indexOf(".png",qS.length-4)?6408:6407;qJ=new laya.webgl.resource.WebGLImage(qa,qS,qV,!1,qa.width,qa.height);this.onLoaded(qJ)}else this.event("error","Load image failed")},q_._loadSound=function(qS){var q_=new qI._soundClass,qa=this;function qR(){q_.offAll()}q_.on("complete",this,function(){qR(),qa.onLoaded(q_)}),q_.on("error",this,function(){qR(),q_.dispose(),qa.event("error","Load sound failed")}),q_.load(qS)},q_.onProgress=function(qS){"atlas"===this._type?this.event("progress",.3*qS):this.event("progress",qS)},q_.onError=function(qS){this.event("error",qS)},q_._loadedComplete=function(qS,q_,qa){if(null!=qa)switch(this._type){case"atlas":case"plf":case"json":var qR=new qx(qa);this.onLoaded(JSON.parse(qR.readUTFBytes()));break;case"font":qR=new qx(qa);this.onLoaded(qO.parseXMLFromString(qR.readUTFBytes()));break;default:this.onLoaded(qa)}else this.event("error",qS)},q_.onLoaded=function(qS){var q_=this._type;if("plf"==q_)this.parsePLFData(qS),this.complete(qS);else if("image"===q_){var qa=new qHS(qS);qa.url=this._url,this.complete(qa)}else if("sound"===q_||"htmlimage"===q_||"nativeimage"===q_)this.complete(qS);else if("atlas"===q_){if(!qS.src&&!qS._setContext){if(!this._data){if((this._data=qS).meta&&qS.meta.image)for(var qR=qS.meta.image.split(","),qJ=0<=this._url.indexOf("/")?"/":"\\",qV=this._url.lastIndexOf(qJ),qW=0<=qV?this._url.substr(0,qV+1):"",qk=0,qz=qR.length;qk<qz;qk++)qR[qk]=qW+qR[qk];else qR=[this._url.replace(".json",".png")];qR.reverse(),qS.toLoads=qR,qS.pics=[]}return this.event("progress",.3+1/qR.length*.6),this._loadImage(qR.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(qS),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var qb=this._data.frames,qH=this._url.split("?")[0],qL=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:qH.substring(0,qH.lastIndexOf("."))+"/",qC=this._data.pics,qG=qu.formatURL(this._url),qt=ql.atlasMap[qG]||(ql.atlasMap[qG]=[]);qt.dir=qL;var qo=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var q$ in qo=parseFloat(this._data.meta.scale),qb){var qF,qT=qb[q$],qD=qC[qT.frame.idx?qT.frame.idx:0],qj=qu.formatURL(qL+q$);qD.scaleRate=qo,qF=qHS.create(qD,qT.frame.x,qT.frame.y,qT.frame.w,qT.frame.h,qT.spriteSourceSize.x,qT.spriteSourceSize.y,qT.sourceSize.w,qT.sourceSize.h),ql.cacheRes(qj,qF),ql.keepCache(this._url,qL+q$),qF.url=qj,qt.push(qj)}else for(q$ in qb)qD=qC[(qT=qb[q$]).frame.idx?qT.frame.idx:0],qj=qu.formatURL(qL+q$),ql.cacheRes(qj,qHS.create(qD,qT.frame.x,qT.frame.y,qT.frame.w,qT.frame.h,qT.spriteSourceSize.x,qT.spriteSourceSize.y,qT.sourceSize.w,qT.sourceSize.h)),ql.loadedMap[qj].url=qj,ql.keepCache(this._url,qL+q$),qt.push(qj);delete this._data.pics,this.complete(this._data)}else if("font"==q_){if(!qS.src)return this._data=qS,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var qQ=new qB;qQ.parseFont(this._data,qS);var qm=this._url.split(".fnt")[0].split("/"),qq=qm[qm.length-1];q$S.registerBitmapFont(qq,qQ),this._data=qQ,this.complete(this._data)}else if("pkm"==q_){var qN=qmS.create(qS,this._url),qn=new qHS(qN);qn.url=this._url,this.complete(qn)}else this.complete(qS)},q_.parsePLFData=function(qS){var q_,qa,qR;for(q_ in qS)switch(qR=qS[q_],q_){case"json":case"text":for(qa in qR)ql.preLoadedMap[qu.formatURL(qa)]=qR[qa];break;default:for(qa in qR)ql.preLoadedMap[qu.formatURL(qa)]=qR[qa]}},q_.complete=function(qS){this._data=qS,this._customParse?this.event("loaded",qS instanceof Array?[qS]:qS):(ql._loaders.push(this),ql._isWorking||ql.checkNext())},q_.endLoad=function(qS){qS&&(this._data=qS),this._cache&&ql.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},qH(0,q_,"url",function(){return this._url}),qH(0,q_,"data",function(){return this._data}),qH(0,q_,"cache",function(){return this._cache}),qH(0,q_,"type",function(){return this._type}),ql.checkNext=function(){ql._isWorking=!0;for(var qS=qg.now();ql._startIndex<ql._loaders.length;)if(qg.now(),ql._loaders[ql._startIndex].endLoad(),ql._startIndex++,qg.now()-qS>ql.maxTimeOut)return console.warn("loader callback cost a long time:"+(qg.now()-qS)+" url="+ql._loaders[ql._startIndex-1].url),void qq.timer.frameOnce(1,null,ql.checkNext);ql._loaders.length=0,ql._startIndex=0,ql._isWorking=!1},ql.clearRes=function(qS,q_){if(null!=qS){void 0===q_&&(q_=!1),qS=qu.formatURL(qS);var qa=ql.getAtlas(qS);if(qa){for(var qR=0,qJ=qa.length;qR<qJ;qR++){var qV=qa[qR],qW=ql.getRes(qV);delete ql.loadedMap[qV],ql.clearCache(qS.substring(qu.basePath.length),qV.substring(qu.basePath.length)),qW&&qW.destroy(q_)}qa.length=0,delete ql.atlasMap[qS],delete ql.loadedMap[qS]}else{var qk=ql.loadedMap[qS];qk&&(delete ql.loadedMap[qS],qk instanceof laya.resource.Texture&&qk.bitmap&&qk.destroy(q_))}}},ql.clearTextureRes=function(qS){qS=qu.formatURL(qS);var q_=laya.net.Loader.getAtlas(qS),qa=q_&&0<q_.length?laya.net.Loader.getRes(q_[0]):laya.net.Loader.getRes(qS);qa&&qa.bitmap&&(qK.isConchApp&&!qK.isConchWebGL?qa.bitmap.source.releaseTexture&&qa.bitmap.source.releaseTexture():null==qa.bitmap._atlaser&&qa.bitmap.releaseResource(!0))},ql.getRes=function(qS){return ql.loadedMap[qu.formatURL(qS)]},ql.getAtlas=function(qS){return ql.atlasMap[qu.formatURL(qS)]},ql.cacheRes=function(qS,q_){qS=qu.formatURL(qS),null!=ql.loadedMap[qS]?console.warn("Resources already exist,is repeated loading:",qS):ql.loadedMap[qS]=q_},ql.setGroup=function(qS,q_){ql.groupMap[q_]||(ql.groupMap[q_]=[]),ql.groupMap[q_].push(qS)},ql.clearResByGroup=function(qS){if(ql.groupMap[qS]){var q_=ql.groupMap[qS],qa=0,qR=q_.length;for(qa=0;qa<qR;qa++)ql.clearRes(q_[qa]);q_.length=0}},ql.keepCache=function(qS,q_){if(qS&&q_){var qa=ql.cacheSet[q_];qa?-1==qa.indexOf(qS)&&qa.push(qS):ql.cacheSet[q_]=[qS]}},ql.clearCache=function(qS,q_){if(qS&&q_){var qa=ql.cacheSet[q_];if(qa){var qR=qa.indexOf(qS);if(-1!==qR){var qJ=qa.length-1;0==qJ?(delete ql.cacheSet[q_],0<ql.imgMgrSet[q_]?qW.imgMgrFree(q_,ql.imgMgrSet[q_]):ql.clearRes(q_,!0)):(qa[qR]=qa[qJ],qa.length=qJ)}}}},ql.saveObject=function(qS,q_,qa){if(q_&&qS){var qR=ql.objectSet[qS];qR?(console.warn("Loader.saveObject: "+qS),qR[0]=q_,qR[1]=qa):ql.objectSet[qS]=[q_,qa,[]]}},ql.findObject=function(qS){if(qS){var q_=ql.objectSet[qS];if(q_)return q_[0]}return null},ql.keepObject=function(qS,q_){if(qS&&q_){var qa=ql.objectSet[q_];qa&&-1===qa[2].indexOf(qS)&&qa[2].push(qS)}},ql.clearObject=function(qS,q_){if(qS&&q_){var qa=ql.objectSet[q_];if(qa){var qR=qa[2],qJ=qR.indexOf(qS);if(-1!==qJ){var qV=qR.length-1;0==qV?(delete ql.objectSet[q_],qa[1]&&qa[1].call(null,qa[0])):(qR[qJ]=qR[qV],qR.length=qV)}}}},ql.TEXT="text",ql.JSON="json",ql.XML="xml",ql.BUFFER="arraybuffer",ql.IMAGE="image",ql.SOUND="sound",ql.ATLAS="atlas",ql.FONT="font",ql.TTF="ttf",ql.PLF="plf",ql.PKM="pkm",ql.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},ql.parserMap={},ql.groupMap={},ql.maxTimeOut=100,ql.loadedMap={},ql.preLoadedMap={},ql.atlasMap={},ql._loaders=[],ql._isWorking=!1,ql._startIndex=0,ql.imgCache={},ql.cacheSet={},ql.objectSet={},ql.imgMgrSet={},ql}(),qzS=function(qS){var qC;function qG(){this.retryNum=3,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},qG.__super.call(this);for(var qS=0;qS<this._maxPriority;qS++)this._resInfos[qS]=[]}qo(qG,"laya.net.LoaderManager",qb);var q_=qG.prototype;return q_.create=function(qS,qa,q_,qR,qJ,qV,qW,qk){if(null==qV&&(qV=2),null==qW&&(qW=!0),qS instanceof Array){var qz=qS,qb=qz.length,qH=0;if(q_)var qL=qT.create(q_.caller,q_.method,q_.args,!1);for(var qC=0;qC<qb;qC++){var qG=qz[qC];"string"==typeof qG&&(qG=qz[qC]={url:qG}),qG.progress=0}for(qC=0;qC<qb;qC++){qG=qz[qC];var qt=q_?qT.create(null,qF,[qG],!1):null,qo=q_||qa?qT.create(null,q$,[qG]):null;this._create(qG.url,qo,qt,qG.clas||qR,qG.params||qJ,null!=qG.priority&&0<=qG.priority?qG.priority:qV,qW,qG.group||qk)}function q$(qS,q_){qH++,qS.progress=1,qH===qb&&qa&&qa.run()}function qF(qS,q_){qS.progress=q_;for(var qa=0,qR=0;qR<qb;qR++){qa+=qz[qR].progress}var qJ=qa/qb;qL.runWith(qJ)}return!0}return this._create(qS,qa,q_,qR,qJ,qV,qW,qk)},q_._create=function(q_,qa,qS,qR,qJ,qV,qW,qk){q_&&""!=q_||console.error("加载的url不合法 "+q_),null==qV&&(qV=2),null==qW&&(qW=!0);var qz=qu.formatURL(q_),qb=this.getRes(qz);if(qb)!qb.hasOwnProperty("loaded")||qb.loaded?(qS&&qS.runWith(1),qa&&qa.run()):qa&&qq.loader._createListener(q_,qa.caller,qa.method,qa.args,!0,!1);else{var qH=qO.getFileExtension(q_),qL=qG.createMap[qH];if(!qL)throw new Error("LoaderManager:unknown file("+q_+") extension with: "+qH+".");qR||(qR=qL[0]);var qC=qL[1];if("atlas"==qH)this.load(q_,qa,qS,qC,qV,qW);else{qR===qHS&&(qC="htmlimage"),(qb=qR?new qR:null).hasOwnProperty("_loaded")&&(qb._loaded=!1),qb._setUrl(q_),qk&&qb._setGroup(qk),this._createLoad(qb,q_,qT.create(null,function(qS){qb&&!qb.destroyed&&qS&&qb.onAsynLoaded.call(qb,q_,qS,qJ),qa&&qa.run();qq.loader.event(q_)}),qS,qC,qV,!1,qk,!0),qW&&this.cacheRes(qz,qb)}}return qb},q_.load=function(qS,q_,qa,qR,qJ,qV,qW,qk){qS&&""!=qS||console.error("加载的url不合法 "+qS);var qz=this;if(null==qJ&&(qJ=2),null==qV&&(qV=!0),void 0===qk&&(qk=!1),qS instanceof Array)return this._loadAssets(qS,q_,qa,qR,qJ,qV,qW);var qb=qkS.getRes(qS);if(null!=qb)qq.timer.frameOnce(1,null,function(){qa&&qa.runWith(1),q_&&q_.runWith(qb),qz._loaderCount||qz.event("complete")});else{var qH=qG._resMap[qS];qH?(q_&&qH._createListener("complete",q_.caller,q_.method,q_.args,!1,!1),qa&&qH._createListener("progress",qa.caller,qa.method,qa.args,!1,!1)):((qH=this._infoPool.length?this._infoPool.pop():new qC).url=qS,qH.type=qR,qH.cache=qV,qH.group=qW,qH.ignoreCache=qk,qH.priority=qJ,q_&&qH.on("complete",q_.caller,q_.method,q_.args),qa&&qH.on("progress",qa.caller,qa.method,qa.args),qG._resMap[qS]=qH,qJ=qJ<this._maxPriority?0<=qJ?qJ:0:this._maxPriority-1,this._resInfos[qJ].push(qH),this._next())}return this},q_._createLoad=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){var qb=this;if(null==qV&&(qV=2),null==qW&&(qW=!0),void 0===qz&&(qz=!1),q_ instanceof Array)return this._loadAssets(q_,qa,qR,qJ,qV,qW,qk);var qH=qkS.getRes(q_);if(null!=qH)qq.timer.frameOnce(1,null,function(){qR&&qR.runWith(1),qa&&qa.runWith(qH),qb._loaderCount||qb.event("complete")});else{var qL=qG._resMap[q_];qL?(qa&&qL._createListener("complete",qa.caller,qa.method,qa.args,!1,!1),qR&&qL._createListener("progress",qR.caller,qR.method,qR.args,!1,!1)):((qL=this._infoPool.length?this._infoPool.pop():new qC).url=q_,qL.clas=qS,qL.type=qJ,qL.cache=qW,qL.group=qk,qL.ignoreCache=qz,qL.priority=qV,qa&&qL.on("complete",qa.caller,qa.method,qa.args),qR&&qL.on("progress",qR.caller,qR.method,qR.args),qG._resMap[q_]=qL,qV=qV<this._maxPriority?0<=qV?qV:0:this._maxPriority-1,this._resInfos[qV].push(qL),this._next())}return this},q_._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var qS=0;qS<this._maxPriority;qS++)for(var q_=this._resInfos[qS];0<q_.length;){var qa=q_.shift();if(qa)return this._doLoad(qa)}this._loaderCount||this.event("complete")}},q_._doLoad=function(q_){this._loaderCount++;var qa=this._loaders.length?this._loaders.pop():new qkS;qa.on("complete",null,qJ),qa.on("progress",null,function(qS){q_.event("progress",qS)}),qa.on("error",null,function(qS){qJ(null)});var qR=this;function qJ(qS){qa.offAll(),qa._data=null,qa._customParse=!1,qR._loaders.push(qa),qR._endLoad(q_,qS instanceof Array?[qS]:qS),qR._loaderCount--,qR._next()}qa._class=q_.clas,1<=q_.priority?(qa.priority=q_.priority,qa.realTime=!1):(qa.priority=0,qa.realTime=!0),qa.load(q_.url,q_.type,q_.cache,q_.group,q_.ignoreCache)},q_._endLoad=function(qS,q_){var qa=qS.url;if(null==q_){var qR=this._failRes[qa]||0;if(qR<this.retryNum)return console.warn("[warn]Retry to load:",qa),this._failRes[qa]=qR+1,void qq.timer.once(this.retryDelay,this,this._addReTry,[qS],!1);console.warn("[error]Failed to load:",qa),this.event("error",qa)}this._failRes[qa]&&(this._failRes[qa]=0),delete qG._resMap[qa],qS.event("complete",q_),qS.offAll(),this._infoPool.push(qS)},q_._addReTry=function(qS){this._resInfos[this._maxPriority-1].push(qS),this._next()},q_.clearRes=function(qS,q_){void 0===q_&&(q_=!1),qkS.clearRes(qS,q_)},q_.getRes=function(qS){return qkS.getRes(qS)},q_.cacheRes=function(qS,q_){qkS.cacheRes(qS,q_)},q_.clearTextureRes=function(qS){qkS.clearTextureRes(qS)},q_.setGroup=function(qS,q_){qkS.setGroup(qS,q_)},q_.clearResByGroup=function(qS){qkS.clearResByGroup(qS)},q_.clearUnLoaded=function(){for(var qS=0;qS<this._maxPriority;qS++){for(var q_=this._resInfos[qS],qa=q_.length-1;-1<qa;qa--){var qR=q_[qa];qR&&(qR.offAll(),this._infoPool.push(qR))}q_.length=0}this._loaderCount=0,qG._resMap={}},q_.cancelLoadByUrls=function(qS){if(qS)for(var q_=0,qa=qS.length;q_<qa;q_++)this.cancelLoadByUrl(qS[q_])},q_.cancelLoadByUrl=function(qS){for(var q_=0;q_<this._maxPriority;q_++)for(var qa=this._resInfos[q_],qR=qa.length-1;-1<qR;qR--){var qJ=qa[qR];qJ&&qJ.url===qS&&(qa[qR]=null,qJ.offAll(),this._infoPool.push(qJ))}qG._resMap[qS]&&delete qG._resMap[qS]},q_._loadAssets=function(qS,qa,qW,q_,qR,qJ,qV){null==qR&&(qR=2),null==qJ&&(qJ=!0);for(var qk=qS.length,qz=0,qb=0,qH=[],qL=!0,qC=0;qC<qk;qC++){var qG=qS[qC];if(!qG)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+qS);"string"==typeof qG&&(qG={url:qG,type:q_,size:1,priority:qR}),qG.size||(qG.size=1),qG.progress=0,qb+=qG.size,qH.push(qG);var qt=qW?qT.create(null,qF,[qG],!1):null,qo=qa||qW?qT.create(null,q$,[qG]):null;this.load(qG.url,qo,qt,qG.type,null!=qG.priority&&0<=qG.priority?qG.priority:2,qJ,qG.group||qV)}function q$(qS,q_){qz++,qS.progress=1,q_||(qL=!1),qz===qk&&qa&&qa.runWith(qL)}function qF(qS,q_){if(null!=qW){qS.progress=q_;for(var qa=0,qR=0;qR<qH.length;qR++){var qJ=qH[qR];qa+=qJ.size*qJ.progress}var qV=qa/qb;qW.runWith(qV)}}return this},qG.cacheRes=function(qS,q_){qkS.cacheRes(qS,q_)},qG._resMap={},qz(qG,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),qG.__init$=function(){qC=function(qS){function q_(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.priority=-1,q_.__super.call(this)}return qo(q_,"",qb),q_}()},qG}(),qbS=(function(qS){function qJ(qS){qJ.__super.call(this),qS||(qS=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var q_=0,qa=0,qR=0;qR<20;qR++)qR%5!=4?this._mat[q_++]=qS[qR]:this._alpha[qa++]=qS[qR];this._action=qA.createFilterAction(32),this._action.data=this}qo(qJ,"laya.filters.ColorFilter",qF);var q_=qJ.prototype;qq.imps(q_,{"laya.filters.IFilter":!0}),q_.callNative=function(qS){qS._$P.cf=this;qS.conchModel&&qS.conchModel.setFilterMatrix&&qS.conchModel.setFilterMatrix(this._mat,this._alpha)},qH(0,q_,"type",function(){return 32}),qH(0,q_,"action",function(){return this._action})}(),function(qS){function qR(qS,q_,qa){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===q_&&(q_=0),qR.__super.call(this),this._byteClass=qa||qx,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,qS&&0<q_&&q_<65535&&this.connect(qS,q_)}qo(qR,"laya.net.Socket",qb);var q_=qR.prototype;q_.connect=function(qS,q_){var qa="ws://"+qS+":"+q_;qa="https:"==qg.window.location.protocol?"wss://"+qS+":"+q_:"ws://"+qS+":"+q_,this.connectByUrl(qa)},q_.connectByUrl=function(qS){var q_=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new qg.window.WebSocket(qS,this.protocols):this._socket=new qg.window.WebSocket(qS),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(qS){q_._onOpen(qS)},this._socket.onmessage=function(qS){q_._onMessage(qS)},this._socket.onclose=function(qS){q_._onClose(qS)},this._socket.onerror=function(qS){q_._onError(qS)}},q_.cleanSocket=function(){try{this._socket.close()}catch(qS){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},q_.close=function(){if(null!=this._socket)try{this._socket.close()}catch(qS){}},q_._onOpen=function(qS){this._connected=!0,this.event("open",qS)},q_._onMessage=function(qS){if(qS&&qS.data){var q_=qS.data;if(this.disableInput&&q_)this.event("message",q_);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var qa=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,q_&&("string"==typeof q_?this._input.writeUTFBytes(q_):this._input.writeArrayBuffer(q_),this._addInputPosition=this._input.pos,this._input.pos=qa),this.event("message",q_)}}},q_._onClose=function(qS){this._connected=!1,this.event("close",qS)},q_._onError=function(qS){this.event("error",qS)},q_.send=function(qS){this._socket.send(qS)},q_.flush=function(){if(this._output&&0<this._output.length){var q_;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(qS){q_=qS}this._output.endian=this.endian,this._output.clear(),q_&&this.event("error",q_)}},qH(0,q_,"input",function(){return this._input}),qH(0,q_,"output",function(){return this._output}),qH(0,q_,"connected",function(){return this._connected}),qH(0,q_,"endian",function(){return this._endian},function(qS){this._endian=qS,null!=this._input&&(this._input.endian=qS),null!=this._output&&(this._output.endian=qS)}),qR.LITTLE_ENDIAN="littleEndian",qR.BIG_ENDIAN="bigEndian"}(),function(qS){function qk(){qk.__super.call(this),this._$1__id=++qk._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(qk._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,qe.currentResourceManager&&qe.currentResourceManager.addResource(this)}qo(qk,"laya.resource.Resource",qb);var q_=qk.prototype;return qq.imps(q_,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),q_._setUrl=function(qS){var q_;this._url!==qS&&(this._url&&((q_=qk._urlResourcesMap[this._url]).splice(q_.indexOf(this),1),0===q_.length&&delete qk._urlResourcesMap[this._url]),qS&&((q_=qk._urlResourcesMap[qS])||(qk._urlResourcesMap[qS]=q_=[]),q_.push(this)),this._url=qS)},q_._getGroup=function(){return this._group},q_._setGroup=function(qS){var q_;this._group!==qS&&(this._group&&((q_=qk._groupResourcesMap[this._group]).splice(q_.indexOf(this),1),0===q_.length&&delete qk._groupResourcesMap[this._group]),qS&&((q_=qk._groupResourcesMap[qS])||(qk._groupResourcesMap[qS]=q_=[]),q_.push(this)),this._group=qS)},q_._addReference=function(){this._referenceCount++},q_._removeReference=function(){this._referenceCount--},q_._clearReference=function(){this._referenceCount=0},q_._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},q_.recreateResource=function(){this.completeCreate()},q_.disposeResource=function(){},q_.activeResource=function(qS){void 0===qS&&(qS=!1),this._lastUseFrameCount=qc.loopCount,!this._destroyed&&this.__loaded&&(this._released||qS)&&this.recreateResource()},q_.releaseResource=function(qS){return void 0===qS&&(qS=!0),!(!qS&&this.lock)&&(!(this._released&&!qS)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},q_.onAsynLoaded=function(qS,q_,qa){throw new Error("Resource: must override this function!")},q_.destroy=function(){var qS;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete qk._idResourcesMap[this.id],this._url&&((qS=qk._urlResourcesMap[this._url])&&(qS.splice(qS.indexOf(this),1),0===qS.length&&delete qk._urlResourcesMap[this.url]),qkS.clearRes(this._url),this.__loaded||qA.cancelLoadByUrl(this._url)),this._group&&((qS=qk._groupResourcesMap[this._group]).splice(qS.indexOf(this),1),0===qS.length&&delete qk._groupResourcesMap[this.url]))},q_.completeCreate=function(){this._released=!1,this.event("recovered",this)},q_.dispose=function(){this.destroy()},qH(0,q_,"memorySize",function(){return this._memorySize},function(qS){var q_=qS-this._memorySize;this._memorySize=qS,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,q_),this.resourceManager&&this.resourceManager.addSize(q_)}),qH(0,q_,"_loaded",null,function(qS){this.__loaded=qS}),qH(0,q_,"loaded",function(){return this.__loaded}),qH(0,q_,"id",function(){return this._$1__id}),qH(0,q_,"destroyed",function(){return this._destroyed}),qH(0,q_,"group",function(){return this._getGroup()},function(qS){this._setGroup(qS)}),qH(0,q_,"resourceManager",function(){return this._resourceManager}),qH(0,q_,"url",function(){return this._url}),qH(0,q_,"released",function(){return this._released}),qH(0,q_,"referenceCount",function(){return this._referenceCount}),qk.getResourceByID=function(qS){return qk._idResourcesMap[qS]},qk.getResourceByURL=function(qS,q_){return void 0===q_&&(q_=0),null==qk._urlResourcesMap[qS]?null:qk._urlResourcesMap[qS][q_]},qk.getResourceCountByURL=function(qS){return qk._urlResourcesMap[qS].length},qk.destroyUnusedResources=function(qS){var q_;if(qS){var qa=qk._groupResourcesMap[qS];if(qa)for(var qR=qa.slice(),qJ=0,qV=qR.length;qJ<qV;qJ++)(q_=qR[qJ]).lock||0!==q_._referenceCount||q_.destroy()}else for(var qW in qk._idResourcesMap)(q_=qk._idResourcesMap[qW]).lock||0!==q_._referenceCount||q_.destroy()},qk._uniqueIDCounter=0,qk._idResourcesMap={},qk._urlResourcesMap={},qk._groupResourcesMap={},qk}()),qHS=function(qS){function ql(qS,q_){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,ql.__super.call(this),qS&&null!=qS._addReference&&qS._addReference(),this.setTo(qS,q_)}qo(ql,"laya.resource.Texture",qb);var q_=ql.prototype;return q_._setUrl=function(qS){this.url=qS},q_.setTo=function(qS,q_){if(qS instanceof qW.HTMLElement){var qa=qDS.create("2D",qS);this.bitmap=qa}else this.bitmap=qS;if(this.uv=q_||ql.DEF_UV,qS){this._w=qS.width,this._h=qS.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var qR=this;if(this._loaded)qA.addToAtlas&&qA.addToAtlas(qR);else{var qJ=qS;qJ instanceof laya.resource.HTMLImage&&qJ.image&&qJ.image.addEventListener("load",function(qS){qA.addToAtlas&&qA.addToAtlas(qR)},!1)}}},q_.active=function(){this.bitmap&&this.bitmap.activeResource()},q_.destroy=function(qS){if(void 0===qS&&(qS=!1),this.alphaTexture&&(this.alphaTexture.destroy(qS),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var q_=this.bitmap;qS?(qK.isConchApp&&q_.source&&q_.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,q_.dispose(),q_._clearReference()):(q_._removeReference(),0==q_.referenceCount&&(qK.isConchApp&&q_.source&&q_.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,q_.dispose())),this.url&&this===qq.loader.getRes(this.url)&&qq.loader.clearRes(this.url,qS),this._loaded=!1}},q_.load=function(qS){var q_=this;this._loaded=!1,qS=qu.customFormat(qS);var qa=this.bitmap||(this.bitmap=qmS.create(qS));qa.uri=qS,qa&&qa._addReference();var qR=this;qa.onload=function(){qa.onload=null,qR._loaded=!0,q_.sourceWidth=q_._w=qa.width,q_.sourceHeight=q_._h=qa.height,qR.event("loaded",this),qA.addToAtlas&&qA.addToAtlas(qR)}},q_.addTextureToAtlas=function(qS){qA.addTextureToAtlas(this)},q_.getPixels=function(qS,q_,qa,qR){if(qK.isConchApp){var qJ=this.bitmap;if(qJ.source&&qJ.source.getImageData){var qV=qJ.source.getImageData(qS,q_,qa,qR),qW=new Uint8Array(qV);return Array.from(qW)}return null}return qK.isWebGL?qA.getTexturePixels(this,qS,q_,qa,qR):(qg.canvas.size(qa,qR),qg.canvas.clear(),qg.context.drawTexture(this,-qS,-q_,this.width,this.height,0,0),qg.context.getImageData(0,0,qa,qR).data)},q_.onAsynLoaded=function(qS,q_){if(q_){if("function"!=typeof q_._addReference)throw new Error("bitmap._addReference is not a function. "+q_.className+" "+typeof q_._addReference+" "+q_.constructor);q_._addReference()}this.setTo(q_,this.uv),this._loaded&&this.event("loaded",this)},qH(0,q_,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),qH(0,q_,"loaded",function(){return this._loaded}),qH(0,q_,"released",function(){return!this.bitmap||this.bitmap.released}),qH(0,q_,"width",function(){return this._w?this._w:this.uv&&this.uv!==ql.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(qS){this._w=qS,this.sourceWidth||(this.sourceWidth=qS)}),qH(0,q_,"repeat",function(){return!qK.isWebGL||!this.bitmap||this.bitmap.repeat},function(qS){qS&&qK.isWebGL&&this.bitmap&&(this.bitmap.repeat=qS)&&(this.bitmap.enableMerageInAtlas=!1)}),qH(0,q_,"height",function(){return this._h?this._h:this.uv&&this.uv!==ql.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(qS){this._h=qS,this.sourceHeight||(this.sourceHeight=qS)}),qH(0,q_,"isLinearSampling",function(){return!qK.isWebGL||9728!=this.bitmap.minFifter},function(qS){!qS&&qK.isWebGL&&(qS||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),ql.moveUV=function(qS,q_,qa){for(var qR=0;qR<8;qR+=2)qa[qR]+=qS,qa[qR+1]+=q_;return qa},ql.create=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){void 0===qV&&(qV=0),void 0===qW&&(qW=0),void 0===qk&&(qk=0),void 0===qz&&(qz=0);var qb=qS instanceof laya.resource.Texture,qH=qb?qS.uv:ql.DEF_UV,qL=qb?qS.bitmap:qS,qC=qA.isAtlas(qL);if(qC){var qG=qL._atlaser,qt=qS._atlasID;if(-1==qt)throw new Error("create texture error");qL=qG._inAtlasTextureBitmapValue[qt],qH=qG._inAtlasTextureOriUVValue[qt]}var qo=new ql(qL,null);qL.width&&q_+qR>qL.width&&(qR=qL.width-q_),qL.height&&qa+qJ>qL.height&&(qJ=qL.height-qa),qo.width=qR,qo.height=qJ,qo.offsetX=qV,qo.offsetY=qW,qo.sourceWidth=qk||qR,qo.sourceHeight=qz||qJ;var q$=1/qL.width,qF=1/qL.height;q_*=q$,qa*=qF,qR*=q$,qJ*=qF;var qT=qo.uv[0],qD=qo.uv[1],qj=qo.uv[4],qQ=qo.uv[5],qm=qj-qT,qq=qQ-qD,qN=ql.moveUV(qH[0],qH[1],[q_,qa,q_+qR,qa,q_+qR,qa+qJ,q_,qa+qJ]);qo.uv=[qT+qN[0]*qm,qD+qN[1]*qq,qj-(1-qN[2])*qm,qD+qN[3]*qq,qj-(1-qN[4])*qm,qQ-(1-qN[5])*qq,qT+qN[6]*qm,qQ-(1-qN[7])*qq],qC&&qo.addTextureToAtlas();var qn=qL.scaleRate;return qn&&1!=qn?(qo.sourceWidth/=qn,qo.sourceHeight/=qn,qo.width/=qn,qo.height/=qn,qo.scaleRate=qn,qo.offsetX/=qn,qo.offsetY/=qn):qo.scaleRate=1,qo},ql.createFromTexture=function(qS,q_,qa,qR,qJ){var qV=qS.scaleRate;1!=qV&&(q_*=qV,qa*=qV,qR*=qV,qJ*=qV);var qW=qn.TEMP.setTo(q_-qS.offsetX,qa-qS.offsetY,qR,qJ),qk=qW.intersection(ql._rect1.setTo(0,0,qS.width,qS.height),ql._rect2);if(!qk)return null;var qz=ql.create(qS,qk.x,qk.y,qk.width,qk.height,qk.x-qW.x,qk.y-qW.y,qR,qJ);if(qz.bitmap&&qz.bitmap._removeReference)return qz.bitmap._removeReference(),qz;var qb="bitmap:"+(qz.bitmap?qz.bitmap.constructor?qz.bitmap.constructor.name:qz.bitmap.__className:"")+", url:"+(qS.url+" | "+(qz.bitmap?qz.bitmap.url:qS.url))+", x="+q_+",y="+qa+",width="+qR+",height="+qJ+", result="+(qk?qk.x+","+qk.y+","+qk.width+","+qk.height:"null")+", rect="+qW.x+","+qW.y+","+qW.width+","+qW.height;throw new Error("报错：bitmap._removeReference is not a function  "+qb)},ql.DEF_UV=[0,0,1,0,1,1,0,1],ql.INV_UV=[0,1,1,1,1,0,0,0],ql._rect1=new qn,ql._rect2=new qn,ql}(),qS=function(qS){var qk;function qV(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,qV.__super.call(this)}qo(qV,"laya.utils.TimeLine",qb);var q_=qV.prototype;return q_.to=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=0),this._create(qS,q_,qa,qR,qJ,!0)},q_.from=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=0),this._create(qS,q_,qa,qR,qJ,!1)},q_._create=function(qS,q_,qa,qR,qJ,qV){var qW=qp.getItemByClass("tweenData",qk);return qW.isTo=qV,qW.type=0,qW.target=qS,qW.duration=qa,qW.data=q_,qW.startTime=this._startTime+qJ,qW.endTime=qW.startTime+qW.duration,qW.ease=qR,this._startTime=Math.max(qW.endTime,this._startTime),this._tweenDataList.push(qW),this._startTimeSort=!0,this._endTimeSort=!0,this},q_.addLabel=function(qS,q_){var qa=qp.getItemByClass("tweenData",qk);return qa.type=1,qa.data=qS,qa.endTime=qa.startTime=this._startTime+q_,this._labelDic||(this._labelDic={}),this._labelDic[qS]=qa,this._tweenDataList.push(qa),this},q_.removeLabel=function(qS){if(this._labelDic&&this._labelDic[qS]){var q_=this._labelDic[qS];if(q_){var qa=this._tweenDataList.indexOf(q_);-1<qa&&this._tweenDataList.splice(qa,1)}delete this._labelDic[qS]}},q_.gotoTime=function(qS){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var q_,qa,qR,qJ;for(var qV in this._firstTweenDic)if(qa=this._firstTweenDic[qV])for(var qW in qa)qa.diyTarget.hasOwnProperty(qW)&&(qa.diyTarget[qW]=qa[qW]);for(qV in this._tweenDic)(q_=this._tweenDic[qV]).clear(),delete this._tweenDic[qV];if(this._index=0,this._gidIndex=0,this._currTime=qS,this._lastTime=qg.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=qR=this._tweenDataList.concat(),qR.sort(function(qS,q_){return qS.endTime>q_.endTime?1:qS.endTime<q_.endTime?-1:0})}else qR=this._endTweenDataList;for(var qk=0,qz=qR.length;qk<qz;qk++)if(0==(qJ=qR[qk]).type){if(!(qS>=qJ.endTime))break;this._index=Math.max(this._index,qk+1);var qb=qJ.data;if(qJ.isTo)for(var qH in qb)qJ.target[qH]=qb[qH]}for(qk=0,qz=this._tweenDataList.length;qk<qz;qk++)0==(qJ=this._tweenDataList[qk]).type&&qS>=qJ.startTime&&qS<qJ.endTime&&(this._index=Math.max(this._index,qk+1),this._gidIndex++,(q_=qp.getItemByClass("tween",qE))._create(qJ.target,qJ.data,qJ.duration,qJ.ease,qT.create(this,this._animComplete,[this._gidIndex]),0,!1,qJ.isTo,!0,!1),q_.setStartTime(this._currTime-(qS-qJ.startTime)),q_._updateEase(this._currTime),q_.gid=this._gidIndex,this._tweenDic[this._gidIndex]=q_)}},q_.gotoLabel=function(qS){if(null!=this._labelDic){var q_=this._labelDic[qS];q_&&this.gotoTime(q_.startTime)}},q_.pause=function(){qq.timer.clear(this,this._update)},q_.resume=function(){this.play(this._currTime,this._loopKey)},q_.play=function(qS,q_){if(void 0===qS&&(qS=0),void 0===q_&&(q_=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(qS,q_){return qS.startTime>q_.startTime?1:qS.startTime<q_.startTime?-1:0});for(var qa=0,qR=this._tweenDataList.length;qa<qR;qa++){var qJ=this._tweenDataList[qa];if(null!=qJ&&0==qJ.type){var qV=qJ.target,qW=qV.$_GID||(qV.$_GID=qO.getGID()),qk=null;for(var qz in null==this._firstTweenDic[qW]?((qk={}).diyTarget=qV,this._firstTweenDic[qW]=qk):qk=this._firstTweenDic[qW],qJ.data)null==qk[qz]&&(qk[qz]=qV[qz])}}}"string"==typeof qS?this.gotoLabel(qS):this.gotoTime(qS),this._loopKey=q_,this._lastTime=qg.now(),qq.timer.frameLoop(1,this,this._update)}},q_._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var qS in this._tweenDic)(q_=this._tweenDic[qS]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var q_,qa=qg.now(),qR=qa-this._lastTime,qJ=this._currTime+=qR*this.scale;for(qS in this._lastTime=qa,this._tweenDic)(q_=this._tweenDic[qS])._updateEase(qJ);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var qV=this._tweenDataList[this._index];qJ>=qV.startTime&&(this._index++,0==qV.type?(this._gidIndex++,(q_=qp.getItemByClass("tween",qE))._create(qV.target,qV.data,qV.duration,qV.ease,qT.create(this,this._animComplete,[this._gidIndex]),0,!1,qV.isTo,!0,!1),q_.setStartTime(qJ),q_.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=q_)._updateEase(qJ)):this.event("label",qV.data))}},q_._animComplete=function(qS){this._tweenDic[qS]&&delete this._tweenDic[qS]},q_._complete=function(){this.event("complete")},q_.reset=function(){var qS;if(this._labelDic)for(qS in this._labelDic)delete this._labelDic[qS];for(qS in this._tweenDic)this._tweenDic[qS].clear(),delete this._tweenDic[qS];for(qS in this._firstTweenDic)delete this._firstTweenDic[qS];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var q_,qa=0;for(q_=this._tweenDataList.length,qa=0;qa<q_;qa++)this._tweenDataList[qa]&&this._tweenDataList[qa].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,qq.timer.clear(this,this._update)},q_.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},qH(0,q_,"index",function(){return this._frameIndex},function(qS){this._frameIndex=qS,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),qH(0,q_,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),qV.to=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=0),(new qV).to(qS,q_,qa,qR,qJ)},qV.from=function(qS,q_,qa,qR,qJ){return void 0===qJ&&(qJ=0),(new qV).from(qS,q_,qa,qR,qJ)},qV.__init$=function(){qk=function(){function qS(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return qo(qS,""),qS.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,qp.recover("tweenData",this)},qS}()},qV}(),qLS=function(qJ){function qa(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,qa.__super.call(this),this._style=qk.EMPTY}qo(qa,"laya.display.Sprite",qJ);var qS=qa.prototype;return qq.imps(qS,{"laya.display.ILayout":!0}),qS.createConchModel=function(){return new ConchNode},qS.destroy=function(qS){if(void 0===qS&&(qS=!0),this._releaseMem(),!this._destroyed){this.filters=null;var q_=this.mask;q_&&(this.mask=null,q_.destroy(qS))}qJ.prototype.destroy.call(this,qS),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},qS.updateZOrder=function(){qO.updateOrder(this._childs)&&this.repaint()},qS.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},qS.setBounds=function(qS){this._set$P("uBounds",qS)},qS.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new qn),qn._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},qS.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new qn),qn._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},qS._boundPointsToParent=function(qS){void 0===qS&&(qS=!1);var q_=0,qa=0;this._style&&(q_=this._style._tf.translateX,qa=this._style._tf.translateY,qS=qS||0!==this._style._tf.rotate,this._style.scrollRect&&(q_+=this._style.scrollRect.x,qa+=this._style.scrollRect.y));var qR=this._getBoundPointsM(qS);if(!qR||qR.length<1)return qR;if(8!=qR.length&&(qR=qS?qQ.scanPList(qR):qn._getWrapRec(qR,qn.TEMP)._getBoundPoints()),!this.transform)return qO.transPointList(qR,this._x-q_,this._y-qa),qR;var qJ=qN.TEMP,qV=0,qW=qR.length;for(qV=0;qV<qW;qV+=2)qJ.x=qR[qV],qJ.y=qR[qV+1],this.toParentPoint(qJ),qR[qV]=qJ.x,qR[qV+1]=qJ.y;return qR},qS.getGraphicBounds=function(qS){return void 0===qS&&(qS=!1),this._graphics?this._graphics.getBounds(qS):qn.TEMP.setTo(0,0,0,0)},qS._getBoundPointsM=function(qS){if(void 0===qS&&(qS=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var q_=qO.clearArray(this._$P.temBM),qa=qn.TEMP;return qa.copyFrom(this.scrollRect),qO.concatArray(q_,qa._getBoundPoints()),q_}for(var qR,qJ,qV,qW=this._graphics?this._graphics.getBoundPoints():qO.clearArray(this._$P.temBM),qk=0,qz=(qV=this._childs).length;qk<qz;qk++)(qR=qV[qk])instanceof laya.display.Sprite&&1==qR.visible&&(qJ=qR._boundPointsToParent(qS))&&(qW=qW?qO.concatArray(qW,qJ):qJ);return qW},qS.getStyle=function(){return this._style===qk.EMPTY&&(this._style=new qk),this._style},qS.setStyle=function(qS){this._style=qS},qS._adjustTransform=function(){this._tfChanged=!1;var qS,q_=this._style._tf,qa=q_.scaleX,qR=q_.scaleY;if(q_.rotate||1!==qa||1!==qR||q_.skewX||q_.skewY){(qS=this._transform||(this._transform=qX.create())).bTransform=!0;var qJ=.0174532922222222*(q_.rotate-q_.skewX),qV=.0174532922222222*(q_.rotate+q_.skewY),qW=Math.cos(qV),qk=Math.sin(qV),qz=Math.sin(qJ),qb=Math.cos(qJ);return qS.a=qa*qW,qS.b=qa*qk,qS.c=-qR*qz,qS.d=qR*qb,qS.tx=qS.ty=0,qS}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,qS},qS.pos=function(qS,q_,qa){if(void 0===qa&&(qa=!1),this._x!==qS||this._y!==q_){if(this.destroyed)return this;if(qa){this._x=qS,this._y=q_,this.conchModel&&this.conchModel.pos(this._x,this._y);var qR=this._parent;qR&&0===qR._repaint&&(qR._repaint=1,qR.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=qS,this.y=q_}return this},qS.pivot=function(qS,q_){return this.pivotX=qS,this.pivotY=q_,this},qS.size=function(qS,q_){return this.width=qS,this.height=q_,this},qS.scale=function(qS,q_,qa){void 0===qa&&(qa=!1);var qR=this.getStyle(),qJ=qR._tf;if(qJ.scaleX!=qS||qJ.scaleY!=q_){if(this.destroyed)return this;if(qa){qR.setScale(qS,q_),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(qS,q_),this._renderType|=4;var qV=this._parent;qV&&0===qV._repaint&&(qV._repaint=1,qV.parentRepaint())}else this.scaleX=qS,this.scaleY=q_}return this},qS.skew=function(qS,q_){return this.skewX=qS,this.skewY=q_,this},qS.render=function(qS,q_,qa){qc.spriteCount++,qM.renders[this._renderType]._fun(this,qS,q_+this._x,qa+this._y),this._repaint=0},qS.drawToCanvas=function(qS,q_,qa,qR){if(qK.isConchNode){var qJ=qDS.create("2D");return new qP(qS,q_,qJ).ctx.setCanvasType(1),this.conchModel.drawToCanvas(qJ.source,qa,qR),qJ}return qA.drawToCanvas(this,this._renderType,qS,q_,qa,qR)},qS.customRender=function(qS,q_,qa){this._renderType|=1024},qS._applyFilters=function(){var qS;if(!qK.isWebGL&&((qS=this._$P.filters)&&!(qS.length<1)))for(var q_=0,qa=qS.length;q_<qa;q_++)qS[q_].action.apply(this._$P.cacheCanvas)},qS._isHaveGlowFilter=function(){var qS,q_=0;if(this.filters)for(q_=0;q_<this.filters.length;q_++)if(8==this.filters[q_].type)return!0;for(q_=0,qS=this._childs.length;q_<qS;q_++)if(this._childs[q_]._isHaveGlowFilter())return!0;return!1},qS.localToGlobal=function(qS,q_){void 0===q_&&(q_=!1),!0===q_&&(qS=new qN(qS.x,qS.y));for(var qa=this;qa&&qa!=qq.stage;)qS=qa.toParentPoint(qS),qa=qa.parent;return qS},qS.globalToLocal=function(qS,q_){void 0===q_&&(q_=!1),q_&&(qS=new qN(qS.x,qS.y));for(var qa=this,qR=[];qa&&qa!=qq.stage;)qR.push(qa),qa=qa.parent;for(var qJ=qR.length-1;0<=qJ;)qS=(qa=qR[qJ]).fromParentPoint(qS),qJ--;return qS},qS.toParentPoint=function(qS){if(!qS)return qS;qS.x-=this.pivotX,qS.y-=this.pivotY,this.transform&&this._transform.transformPoint(qS),qS.x+=this._x,qS.y+=this._y;var q_=this._style.scrollRect;return q_&&(qS.x-=q_.x,qS.y-=q_.y),qS},qS.fromParentPoint=function(qS){if(!qS)return qS;qS.x-=this._x,qS.y-=this._y;var q_=this._style.scrollRect;return q_&&(qS.x+=q_.x,qS.y+=q_.y),this.transform&&this._transform.invertTransformPoint(qS),qS.x+=this.pivotX,qS.y+=this.pivotY,qS},qS.on=function(qS,q_,qa,qR){return 1!==this._mouseEnableState&&this.isMouseEvent(qS)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(qS,q_,qa,qR,!1)):qJ.prototype.on.call(this,qS,q_,qa,qR)},qS.once=function(qS,q_,qa,qR){return 1!==this._mouseEnableState&&this.isMouseEvent(qS)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(qS,q_,qa,qR,!0)):qJ.prototype.once.call(this,qS,q_,qa,qR)},qS._$2__onDisplay=function(){if(1!==this._mouseEnableState){var qS=this;for(qS=qS.parent;qS&&1!==qS._mouseEnableState&&!qS._getBit(2);)qS.mouseEnabled=!0,qS._setBit(2,!0),qS=qS.parent}},qS.loadImage=function(qS,q_,qa,qR,qJ,qV){var qW=this;return void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),this.graphics.loadImage(qS,q_,qa,qR,qJ,function(qS){qW.destroyed||(qW.size(q_+(qR||qS.width),qa+(qJ||qS.height)),qW.repaint(),qV&&qV.runWith(qS))}),this},qS.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},qS._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},qS._childChanged=function(qS){this._childs.length?this._renderType|=2048:this._renderType&=-2049,qS&&this._get$P("hasZorder")&&qq.timer.callLater(this,this.updateZOrder),this.repaint()},qS.parentRepaint=function(){var qS=this._parent;qS&&0===qS._repaint&&(qS._repaint=1,qS.parentRepaint())},qS.startDrag=function(qS,q_,qa,qR,qJ,qV,qW){void 0===q_&&(q_=!1),void 0===qa&&(qa=0),void 0===qR&&(qR=300),void 0===qV&&(qV=!1),void 0===qW&&(qW=.92),this._$P.dragging||this._set$P("dragging",new qY),this._$P.dragging.start(this,qS,q_,qa,qR,qJ,qV,qW)},qS.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},qS._releaseMem=function(){if(this._$P){var qS=this._$P.cacheCanvas;qS&&qS.ctx&&(qp.recover("RenderContext",qS.ctx),qS.ctx.canvas.size(0,0),qS.ctx=null);var q_=this._$P._filterCache;q_&&(q_.destroy(),q_.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},qS._setDisplay=function(qS){qS||this._releaseMem(),qJ.prototype._setDisplay.call(this,qS)},qS.hitTestPoint=function(qS,q_){var qa=this.globalToLocal(qN.TEMP.setTo(qS,q_));return qS=qa.x,q_=qa.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?qn.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(qS,q_)},qS.getMousePoint=function(){return this.globalToLocal(qN.TEMP.setTo(qq.stage.mouseX,qq.stage.mouseY))},qS._getWords=function(){return null},qS._addChildsToLayout=function(qS){var q_=this._getWords();if(null==q_&&0==this._childs.length)return!1;if(q_)for(var qa=0,qR=q_.length;qa<qR;qa++)qS.push(q_[qa]);qa=0;for(var qJ=this._childs.length;qa<qJ;++qa){var qV=this._childs[qa];qV._style._enableLayout()&&qV._addToLayout(qS)}return!0},qS._addToLayout=function(qS){this._style.absolute||(this._style.block?qS.push(this):this._addChildsToLayout(qS)&&(this.x=this.y=0))},qS._isChar=function(){return!1},qS._getCSSStyle=function(){return this._style.getCSSStyle()},qS._setAttributes=function(qS,q_){switch(qS){case"x":this.x=parseFloat(q_);break;case"y":this.y=parseFloat(q_);break;case"width":this.width=parseFloat(q_);break;case"height":this.height=parseFloat(q_);break;default:this[qS]=q_}},qS._layoutLater=function(){this.parent&&this.parent._layoutLater()},qH(0,qS,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(qS){this._optimizeScrollRect!=qS&&(this._optimizeScrollRect=qS,this.conchModel&&this.conchModel.optimizeScrollRect(qS))}),qH(0,qS,"customRenderEnable",null,function(qS){if(qS&&(this._renderType|=1024,qK.isConchNode)){qa.CustomList.push(this);var q_=new qDS("2d");q_._setContext(new CanvasRenderingContext2D),this.customContext=new qP(0,0,q_),q_.context.setCanvasType&&q_.context.setCanvasType(2),this.conchModel.custom(q_.context)}}),qH(0,qS,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(qS){this.cacheAs=qS?this._$P.hasFilter?"none":"normal":"none"}),qH(0,qS,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(qS){var q_=this._$P.cacheCanvas;if(qS!==(q_?q_.type:"none")){if("none"!==qS)this._getBit(1)||this._setUpNoticeType(1),q_||(q_=this._set$P("cacheCanvas",qp.getItemByClass("cacheCanvas",Object))),q_.type=qS,q_.reCache=!0,this._renderType|=16,"bitmap"==qS&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(q_){var qa=q_;qa&&qa.ctx&&(qp.recover("RenderContext",qa.ctx),qa.ctx.canvas.size(0,0),qa.ctx=null),qp.recover("cacheCanvas",q_)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),qH(0,qS,"zOrder",function(){return this._zOrder},function(qS){this._zOrder!=qS&&(this._zOrder=qS,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(qS),this._parent&&(qS&&this._parent._set$P("hasZorder",!0),qq.timer.callLater(this._parent,this.updateZOrder)))}),qH(0,qS,"rotation",function(){return this._style._tf.rotate},function(qS){var q_=this.getStyle();if(q_._tf.rotate!==qS){q_.setRotate(qS),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(qS),this._renderType|=4;var qa=this._parent;qa&&0===qa._repaint&&(qa._repaint=1,qa.parentRepaint())}}),qH(0,qS,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(qS){this._width!==qS&&(this._width=qS,this.conchModel&&this.conchModel.size(qS,this._height),this.repaint())}),qH(0,qS,"x",function(){return this._x},function(qS){if(this._x!==qS){if(this.destroyed)return;this._x=qS,this.conchModel&&this.conchModel.pos(qS,this._y);var q_=this._parent;q_&&0===q_._repaint&&(q_._repaint=1,q_.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),qH(0,qS,"globalScaleY",function(){for(var qS=1,q_=this;q_&&q_!==qq.stage;)qS*=q_.scaleY,q_=q_.parent;return qS}),qH(0,qS,"hitArea",function(){return this._$P.hitArea},function(qS){this._set$P("hitArea",qS)}),qH(0,qS,"staticCache",function(){return this._$P.staticCache},function(qS){this._set$P("staticCache",qS),qS||this.reCache()}),qH(0,qS,"texture",function(){return this._texture},function(qS){this._texture!=qS&&(this._texture=qS,this.graphics.cleanByTexture(qS,0,0))}),qH(0,qS,"y",function(){return this._y},function(qS){if(this._y!==qS){if(this.destroyed)return;this._y=qS,this.conchModel&&this.conchModel.pos(this._x,qS);var q_=this._parent;q_&&0===q_._repaint&&(q_._repaint=1,q_.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),qH(0,qS,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(qS){this._height!==qS&&(this._height=qS,this.conchModel&&this.conchModel.size(this._width,qS),this.repaint())}),qH(0,qS,"blendMode",function(){return this._style.blendMode},function(qS){this.getStyle().blendMode=qS,this.conchModel&&this.conchModel.blendMode(qS),qS&&"source-over"!=qS?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),qH(0,qS,"scaleX",function(){return this._style._tf.scaleX},function(qS){var q_=this.getStyle();if(q_._tf.scaleX!==qS){q_.setScaleX(qS),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(qS,q_._tf.scaleY),this._renderType|=4;var qa=this._parent;qa&&0===qa._repaint&&(qa._repaint=1,qa.parentRepaint())}}),qH(0,qS,"scaleY",function(){return this._style._tf.scaleY},function(qS){var q_=this.getStyle();if(q_._tf.scaleY!==qS){q_.setScaleY(qS),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(q_._tf.scaleX,qS),this._renderType|=4;var qa=this._parent;qa&&0===qa._repaint&&(qa._repaint=1,qa.parentRepaint())}}),qH(0,qS,"stage",function(){return qq.stage}),qH(0,qS,"skewX",function(){return this._style._tf.skewX},function(qS){var q_=this.getStyle();if(q_._tf.skewX!==qS){q_.setSkewX(qS),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(qS,q_._tf.skewY),this._renderType|=4;var qa=this._parent;qa&&0===qa._repaint&&(qa._repaint=1,qa.parentRepaint())}}),qH(0,qS,"scrollRect",function(){return this._style.scrollRect},function(qS){this.getStyle().scrollRect=qS,this.repaint(),qS?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(qS.x,qS.y,qS.width,qS.height)):(this._renderType&=-129,this.conchModel&&(qa.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),qH(0,qS,"skewY",function(){return this._style._tf.skewY},function(qS){var q_=this.getStyle();if(q_._tf.skewY!==qS){q_.setSkewY(qS),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(q_._tf.skewX,qS),this._renderType|=4;var qa=this._parent;qa&&0===qa._repaint&&(qa._repaint=1,qa.parentRepaint())}}),qH(0,qS,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(qS){this._tfChanged=!1,(this._transform=qS)&&(this._x=qS.tx,this._y=qS.ty,qS.tx=qS.ty=0,this.conchModel&&this.conchModel.transform(qS.a,qS.b,qS.c,qS.d,this._x,this._y)),qS?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),qH(0,qS,"pivotX",function(){return this._style._tf.translateX},function(qS){this.getStyle().setTranslateX(qS),this.conchModel&&this.conchModel.pivot(qS,this._style._tf.translateY),this.repaint()}),qH(0,qS,"pivotY",function(){return this._style._tf.translateY},function(qS){this.getStyle().setTranslateY(qS),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,qS),this.repaint()}),qH(0,qS,"alpha",function(){return this._style.alpha},function(qS){this._style&&this._style.alpha!==qS&&(qS=qS<0?0:1<qS?1:qS,this.getStyle().alpha=qS,this.conchModel&&this.conchModel.alpha(qS),1!==qS?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),qH(0,qS,"visible",function(){return this._style.visible},function(qS){this._style&&this._style.visible!==qS&&(this.getStyle().visible=qS,this.conchModel&&this.conchModel.visible(qS),this.parentRepaint())}),qH(0,qS,"graphics",function(){return this._graphics||(this.graphics=qA.createGraphics())},function(qS){this._graphics&&(this._graphics._sp=null),(this._graphics=qS)?(this._renderType&=-2,this._renderType|=512,(qS._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(qa.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),qH(0,qS,"filters",function(){return this._$P.filters},function(qS){qS&&0===qS.length&&(qS=null),this._$P.filters!=qS&&(this._set$P("filters",qS?qS.slice():null),qK.isConchApp&&(this.conchModel&&(qa.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),qK.isWebGL&&(qS&&qS.length?this._renderType|=32:this._renderType&=-33),qS&&0<qS.length?(this._getBit(1)||this._setUpNoticeType(1),qK.isWebGL&&1==qS.length&&qS[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(qK.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),qH(0,qS,"parent",qJ.prototype._$get_parent,function(qS){qq.superSet(qSS,this,"parent",qS),qS&&this._getBit(2)&&this._$2__onDisplay()}),qH(0,qS,"mask",function(){return this._$P._mask},function(qS){qS&&this.mask&&this.mask._$P.maskParent||(qS?(this.cacheAs="bitmap",this._set$P("_mask",qS),qS._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",qS),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(qS?qS.conchModel:null),this._renderType|=64,this.parentRepaint())}),qH(0,qS,"mouseEnabled",function(){return 1<this._mouseEnableState},function(qS){this._mouseEnableState=qS?2:1}),qH(0,qS,"globalScaleX",function(){for(var qS=1,q_=this;q_&&q_!==qq.stage;)qS*=q_.scaleX,q_=q_.parent;return qS}),qH(0,qS,"mouseX",function(){return this.getMousePoint().x}),qH(0,qS,"mouseY",function(){return this.getMousePoint().y}),qa.fromImage=function(qS){return(new qa).loadImage(qS)},qa._cachePool=[],qa.CustomList=[],qz(qa,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=qW.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),qa}(qSS),qCS=function(qS){function q_(qS){this._audio=null,this._onEnd=null,this._resumePlay=null,q_.__super.call(this),this._onEnd=qO.bind(this.__onEnd,this),this._resumePlay=qO.bind(this.__resumePlay,this),qS.addEventListener("ended",this._onEnd),this._audio=qS}qo(q_,"laya.media.h5audio.AudioSoundChannel",qRS);var qa=q_.prototype;return qa.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(qq.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},qa.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,qg.container.appendChild(this._audio),this._audio.play()}catch(qS){this.event("error")}},qa.play=function(qS){this.isStopped=!1;try{this._audio.playbackRate=qI.playbackRate,this._audio.currentTime=this.startTime}catch(qS){return void this._audio.addEventListener("canplay",this._resumePlay)}qI.addChannel(this),qg.container.appendChild(this._audio),!qS&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},qa.stop=function(){this.isStopped=!0,qI.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&qK.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),qg.onIE||this._audio!=qaS._musicAudio&&qp.recover("audio:"+this.url,this._audio),qg.removeElement(this._audio),this._audio=null)},qa.pause=function(){this.isStopped=!0,qI.removeChannel(this),"pause"in this._audio&&this._audio.pause()},qa.resume=function(){this._audio&&(this.isStopped=!1,qI.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},qH(0,qa,"position",function(){return this._audio?this._audio.currentTime:0}),qH(0,qa,"duration",function(){return this._audio?this._audio.duration:0}),qH(0,qa,"volume",function(){return this._audio?this._audio.volume:1},function(qS){this._audio&&(this._audio.volume=qS)}),q_}(),qGS=function(qS){function q_(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=qVS.ctx,q_.__super.call(this),this._onPlayEnd=qO.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}qo(q_,"laya.media.webaudio.WebAudioSoundChannel",qRS);var qa=q_.prototype;return qa.play=function(qS){if(qI.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var q_=this.context,qa=this.gain,qR=q_.createBufferSource();(this.bufferSource=qR).buffer=this.audioBuffer,qR.connect(qa),qa&&qa.disconnect(),qa.connect(q_.destination),qR.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=qg.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(qR.loop=!0),qR.playbackRate.setTargetAtTime?qR.playbackRate.setTargetAtTime(qI.playbackRate,this.context.currentTime,.1):qR.playbackRate.value=qI.playbackRate,qR.start(0,this.startTime),!qS&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},qa.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(qq.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},qa._clearBufferSource=function(){if(this.bufferSource){var qS=this.bufferSource;qS.stop?qS.stop(0):qS.noteOff(0),qS.disconnect(0),qS.onended=null,q_._tryCleanFailed||this._tryClearBuffer(qS),this.bufferSource=null}},qa._tryClearBuffer=function(qS){try{qS.buffer=null}catch(qS){q_._tryCleanFailed=!0}},qa.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,qI.removeChannel(this),this.startHandler=null,this.completeHandler=null},qa.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,qI.removeChannel(this)},qa.resume=function(){this.startTime=this._pauseTime,this.play(!1)},qH(0,qa,"position",function(){return this.bufferSource?(qg.now()-this._startTime)/1e3+this.startTime:0}),qH(0,qa,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),qH(0,qa,"volume",function(){return this._volume},function(qS){this.isStopped||(this._volume=qS,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(qS,this.context.currentTime,.1):this.gain.gain.value=qS)}),q_._tryCleanFailed=!1,q_}(),qtS=function(qS){function q_(){q_.__super.call(this),this._w=0,this._h=0}qo(q_,"laya.resource.Bitmap",qbS);var qa=q_.prototype;return qH(0,qa,"width",function(){return this._w}),qH(0,qa,"height",function(){return this._h}),qH(0,qa,"source",function(){return this._source}),q_}(),qoS=function(q_){function qS(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,qS.__super.call(this),this._interval=qR.animationInterval,this._setUpNoticeType(1)}qo(qS,"laya.display.AnimationPlayerBase",q_);var qa=qS.prototype;return qa.play=function(qS,q_,qa,qR){void 0===qS&&(qS=0),void 0===q_&&(q_=!0),void 0===qa&&(qa=""),void 0===qR&&(qR=!0),this._isPlaying=!0,this.index="string"==typeof qS?this._getFrameByLabel(qS):qS,this.loop=q_,this._actionName=qa,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},qa._getFrameByLabel=function(qS){var q_=0;for(q_=0;q_<this._count;q_++)if(this._labels[q_]&&0<=this._labels[q_].indexOf(qS))return q_;return 0},qa._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},qa._setControlNode=function(qS){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=qS)&&qS!=this&&(qS.on("display",this,this._checkResumePlaying),qS.on("undisplay",this,this._checkResumePlaying))},qa._setDisplay=function(qS){q_.prototype._setDisplay.call(this,qS),this._checkResumePlaying()},qa._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},qa.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},qa.addLabel=function(qS,q_){this._labels||(this._labels={}),this._labels[q_]||(this._labels[q_]=[]),this._labels[q_].push(qS)},qa.removeLabel=function(qS){if(qS){if(this._labels)for(var q_ in this._labels)this._removeLabelFromLabelList(this._labels[q_],qS)}else this._labels=null},qa._removeLabelFromLabelList=function(qS,q_){if(qS)for(var qa=qS.length-1;0<=qa;qa--)qS[qa]==q_&&qS.splice(qa,1)},qa.gotoAndStop=function(qS){this.index="string"==typeof qS?this._getFrameByLabel(qS):qS,this.stop()},qa._displayToIndex=function(qS){},qa.clear=function(){this.stop(),this._labels=null},qH(0,qa,"interval",function(){return this._interval},function(qS){this._interval!=qS&&(this._frameRateChanged=!0,this._interval=qS,this._isPlaying&&0<qS&&this.timerLoop(qS,this,this._frameLoop,null,!0,!0))}),qH(0,qa,"isPlaying",function(){return this._isPlaying}),qH(0,qa,"index",function(){return this._index},function(qS){if(this._index=qS,this._displayToIndex(qS),this._labels&&this._labels[qS])for(var q_=this._labels[qS],qa=0,qR=q_.length;qa<qR;qa++)this.event("label",q_[qa])}),qH(0,qa,"count",function(){return this._count}),qS.WRAP_POSITIVE=0,qS.WRAP_REVERSE=1,qS.WRAP_PINGPONG=2,qS}(qLS),q$S=function(q_){function qG(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,qG.__super.call(this),this.overflow=qG.VISIBLE,this._style=new q_S(this),this._style.wordWrap=!1}qo(qG,"laya.display.Text",q_);var qS=qG.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._lines=null,this._words&&(this._words.length=0,this._words=null)},qS._getBoundPointsM=function(qS){void 0===qS&&(qS=!1);var q_=qn.TEMP;return q_.setTo(0,0,this.width,this.height),q_._getBoundPoints()},qS.getGraphicBounds=function(qS){void 0===qS&&(qS=!1);var q_=qn.TEMP;return q_.setTo(0,0,this.width,this.height),q_},qS._getCSSStyle=function(){return this._style},qS.lang=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH){if(qS=qG.langPacks&&qG.langPacks[qS]?qG.langPacks[qS]:qS,arguments.length<2)this._text=qS;else{for(var qL=0,qC=arguments.length;qL<qC;qL++)qS=qS.replace("{"+qL+"}",arguments[qL+1]);this._text=qS}},qS._isPassWordMode=function(){var qS=this._style.password;return"prompt"in this&&this.prompt==this._text&&(qS=!1),qS},qS._getPassWordTxt=function(qS){var q_;q_="";for(var qa=qS.length;0<qa;qa--)q_+="●";return q_},qS.renderText=function(qS,q_){var qa=this.graphics;qa.clear(!0);var qR=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(qg.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);qg.context.font=qR;var qJ=this.padding,qV=qJ[3],qW="left",qk=this._lines,qz=this.leading+this._charSize.height,qb=this._currBitmapFont;qb&&(qz=this.leading+qb.getMaxHeight());var qH=qJ[0];if(!qb&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(qW="right",qV=this._width-qJ[1]):"center"==this.align&&(qW="center",qV=.5*this._width+qJ[3]-qJ[1])),0<this._height){var qL=this._textHeight>this._height?"top":this.valign;"middle"===qL?qH=.5*(this._height-q_*qz)+qJ[0]-qJ[2]:"bottom"===qL&&(qH=this._height-q_*qz-qJ[2])}var qC=this._style;if(qb&&qb.autoScaleSize)var qG=qb.fontSize/this.fontSize;if(this._clipPoint)if(qa.save(),qb&&qb.autoScaleSize){var qt=0,qo=0;qt=this._width?this._width-qJ[3]-qJ[1]:this._textWidth,qo=this._height?this._height-qJ[0]-qJ[2]:this._textHeight,qt*=qG,qo*=qG,qa.clipRect(qJ[3],qJ[0],qt,qo)}else qa.clipRect(qJ[3],qJ[0],this._width?this._width-qJ[3]-qJ[1]:this._textWidth,this._height?this._height-qJ[0]-qJ[2]:this._textHeight);var q$=qC.password;"prompt"in this&&this.prompt==this._text&&(q$=!1);for(var qF=0,qT=0,qD=Math.min(this._lines.length,q_+qS)||1,qj=qS;qj<qD;qj++){var qQ,qm=qk[qj];if(q$){var qq=qm.length;qm="";for(var qN=qq;0<qN;qN--)qm+="●"}if(qF=qV-(this._clipPoint?this._clipPoint.x:0),qT=qH+qz*qj-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(qW,qF,qT,qj),qb){var qn=this.width;qb.autoScaleSize&&(qn=this.width*qG),qb.drawText(qm,this,qF,qT,this.align,qn)}else qK.isWebGL?(this._words||(this._words=[]),(qQ=this._words.length>qj-qS?this._words[qj-qS]:new qd).setText(qm)):qQ=qm,qC.stroke?qa.fillBorderText(qQ,qF,qT,qR,this.color,qC.strokeColor,qC.stroke,qW):qa.fillText(qQ,qF,qT,qR,this.color,qW)}if(qb&&qb.autoScaleSize){var ql=1/qG;this.scale(ql,ql)}this._clipPoint&&qa.restore(),this._startX=qV,this._startY=qH},qS.drawUnderline=function(qS,q_,qa,qR){var qJ=this._lineWidths[qR];switch(qS){case"center":q_-=qJ/2;break;case"right":q_-=qJ}qa+=this._charSize.height,this._graphics.drawLine(q_,qa,q_+qJ,qa,this.underlineColor||this.color,1)},qS.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);qg.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new qN(0,0)):this._clipPoint=null;var qS=this._lines.length;if(this.overflow!=qG.VISIBLE){var q_=this.overflow==qG.HIDDEN?Math.floor:Math.ceil;qS=Math.min(qS,q_((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var qa=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(qa,qS),this.repaint()},qS.evalTextSize=function(){var qS,q_=NaN;qS=Math.max.apply(this,this._lineWidths),q_=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],qS==this._textWidth&&q_==this._textHeight||(this._textWidth=qS,this._textHeight=q_,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},qS.checkEnabledViewportOrNot=function(){return this.overflow==qG.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},qS.changeText=function(qS){this._text!==qS&&(this.lang(qS+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},qS.parseLines=function(qS){var q_=this.wordWrap||this.overflow==qG.HIDDEN;if(q_)var qa=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var qR=qg.context.measureText(qG._testWord);qK.isConchApp&&0===qR.width&&0===qR.height&&(qR=qg.context.measureText("W")),this._charSize.width=qR.width,this._charSize.height=qR.height||this.fontSize}for(var qJ=qS.replace(/\r\n/g,"\n").split("\n"),qV=0,qW=qJ.length;qV<qW;qV++){var qk=qJ[qV];q_?this.parseLine(qk,qa):(this._lineWidths.push(this.getTextWidth(qk)),this._lines.push(qk))}},qS.parseLine=function(qS,q_){qg.context;var qa,qR=this._lines,qJ=0,qV=NaN,qW=NaN,qk=0;if((qV=this.getTextWidth(qS))<=q_)return qR.push(qS),void this._lineWidths.push(qV);qV=this._charSize.width,0==(qJ=Math.floor(q_/qV))&&(qJ=1),qW=qV=this.getTextWidth(qS.substring(0,qJ));for(var qz=qJ,qb=qS.length;qz<qb;qz++)if(q_<(qW+=qV=this.getTextWidth(qS.charAt(qz))))if(this.wordWrap){var qH=qS.substring(qk,qz);if(qH.charCodeAt(qH.length-1)<255?(qa=/(?:\w|-)+$/.exec(qH))&&(qz=qa.index+qk,0==qa.index?qz+=qH.length:qH=qS.substring(qk,qz)):qG.RightToLeft&&(qa=/([\u0600-\u06FF])+$/.exec(qH))&&(qz=qa.index+qk,0==qa.index?qz+=qH.length:qH=qS.substring(qk,qz)),qR.push(qH),this._lineWidths.push(qW-qV),!((qk=qz)+qJ<qb)){qR.push(qS.substring(qk,qb)),this._lineWidths.push(this.getTextWidth(qR[qR.length-1])),qk=-1;break}qz+=qJ,qW=qV=this.getTextWidth(qS.substring(qk,qz)),qz--}else if(this.overflow==qG.HIDDEN)return qR.push(qS.substring(0,qz)),void this._lineWidths.push(this.getTextWidth(qR[qR.length-1]));this.wordWrap&&-1!=qk&&(qR.push(qS.substring(qk,qb)),this._lineWidths.push(this.getTextWidth(qR[qR.length-1])))},qS.getTextWidth=function(qS){return this._currBitmapFont?this._currBitmapFont.getTextWidth(qS):qg.context.measureText(qS).width},qS.getWordWrapWidth=function(){var qS=this.padding,q_=NaN;return(q_=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(q_=this.wordWrap?100:qg.width),q_<=0&&(q_=100),q_-qS[3]-qS[1]},qS.getCharPoint=function(qS,q_){this._isChanged&&qq.timer.runCallLater(this,this.typeset);for(var qa=0,qR=this._lines,qJ=0,qV=0,qW=qR.length;qV<qW;qV++){if(qS<(qa+=qR[qV].length)){var qk=qV;break}qJ=qa}var qz=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;qg.context.font=qz;var qb=this.getTextWidth(this._text.substring(qJ,qS));return(q_||new qN).setTo(this._startX+qb-(this._clipPoint?this._clipPoint.x:0),this._startY+qk*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},qH(0,qS,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(qS){qS!=this._width&&(qq.superSet(qLS,this,"width",qS),this.isChanged=!0)}),qH(0,qS,"textWidth",function(){return this._isChanged&&qq.timer.runCallLater(this,this.typeset),this._textWidth}),qH(0,qS,"height",function(){return this._height?this._height:this.textHeight},function(qS){qS!=this._height&&(qq.superSet(qLS,this,"height",qS),this.isChanged=!0)}),qH(0,qS,"textHeight",function(){return this._isChanged&&qq.timer.runCallLater(this,this.typeset),this._textHeight}),qH(0,qS,"padding",function(){return this._getCSSStyle().padding},function(qS){this._getCSSStyle().padding=qS,this.isChanged=!0}),qH(0,qS,"bold",function(){return this._getCSSStyle().bold},function(qS){this._getCSSStyle().bold=qS,this.isChanged=!0}),qH(0,qS,"text",function(){return this._text||""},function(qS){this._text!==qS&&(this.lang(qS+""),this.isChanged=!0,this.event("change"))}),qH(0,qS,"color",function(){return this._getCSSStyle().color},function(qS){this._getCSSStyle().color!=qS&&(this._getCSSStyle().color=qS,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),qH(0,qS,"font",function(){return this._getCSSStyle().fontFamily},function(qS){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),qG._bitmapFonts&&qG._bitmapFonts[qS]&&(this._currBitmapFont=qG._bitmapFonts[qS]),this._getCSSStyle().fontFamily=qS,this.isChanged=!0}),qH(0,qS,"fontSize",function(){return this._getCSSStyle().fontSize},function(qS){this._getCSSStyle().fontSize=qS,this.isChanged=!0}),qH(0,qS,"italic",function(){return this._getCSSStyle().italic},function(qS){this._getCSSStyle().italic=qS,this.isChanged=!0}),qH(0,qS,"align",function(){return this._getCSSStyle().align},function(qS){this._getCSSStyle().align=qS,this.isChanged=!0}),qH(0,qS,"valign",function(){return this._getCSSStyle().valign},function(qS){this._getCSSStyle().valign=qS,this.isChanged=!0}),qH(0,qS,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(qS){this._getCSSStyle().wordWrap=qS,this.isChanged=!0}),qH(0,qS,"leading",function(){return this._getCSSStyle().leading},function(qS){this._getCSSStyle().leading=qS,this.isChanged=!0}),qH(0,qS,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(qS){this._getCSSStyle().backgroundColor=qS,this.isChanged=!0}),qH(0,qS,"borderColor",function(){return this._getCSSStyle().borderColor},function(qS){this._getCSSStyle().borderColor=qS,this.isChanged=!0}),qH(0,qS,"stroke",function(){return this._getCSSStyle().stroke},function(qS){this._getCSSStyle().stroke=qS,this.isChanged=!0}),qH(0,qS,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(qS){this._getCSSStyle().strokeColor=qS,this.isChanged=!0}),qH(0,qS,"isChanged",null,function(qS){this._isChanged!==qS&&(this._isChanged=qS)&&qq.timer.callLater(this,this.typeset)}),qH(0,qS,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(qS){if(!(this.overflow!=qG.SCROLL||this.textWidth<this._width)&&this._clipPoint){qS=qS<this.padding[3]?this.padding[3]:qS;var q_=this._textWidth-this._width;qS=q_<qS?q_:qS;var qa=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=qS,this.renderText(this._lastVisibleLineIndex,qa)}}),qH(0,qS,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(qS){if(!(this.overflow!=qG.SCROLL||this.textHeight<this._height)&&this._clipPoint){qS=qS<this.padding[0]?this.padding[0]:qS;var q_=this._textHeight-this._height,qa=(qS=q_<qS?q_:qS)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=qa;var qR=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=qS,this.renderText(qa,qR)}}),qH(0,qS,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),qH(0,qS,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),qH(0,qS,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),qH(0,qS,"underlineColor",function(){return this._underlineColor},function(qS){this._underlineColor=qS,this._isChanged=!0,this.typeset()}),qG.registerBitmapFont=function(qS,q_){qG._bitmapFonts||(qG._bitmapFonts={}),qG._bitmapFonts[qS]=q_},qG.unregisterBitmapFont=function(qS,q_){if(void 0===q_&&(q_=!0),qG._bitmapFonts&&qG._bitmapFonts[qS]){var qa=qG._bitmapFonts[qS];q_&&qa.destroy(),delete qG._bitmapFonts[qS]}},qG.setTextRightToLeft=function(){var qS;(qS=qg.canvas.source.style).display="none",qS.position="absolute",qS.direction="rtl",qK._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,qg.document.body.appendChild(qg.canvas.source)},qG.supportFont=function(qS){qg.context.font="10px sans-serif";var q_=qg.context.measureText("abcji").width;qg.context.font="10px "+qS;var qa=qg.context.measureText("abcji").width;return console.log(q_,qa),q_!==qa},qG._testWord="游",qG.langPacks=null,qG.VISIBLE="visible",qG.SCROLL="scroll",qG.HIDDEN="hidden",qG.CharacterCache=!0,qG.RightToLeft=!1,qG._bitmapFonts=null,qz(qG,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),qG}(qLS),qFS=function(qL){function qW(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",qW.__super.call(this),this.offset=new qN,this._canvasTransform=new qX,this._previousOrientation=qg.window.orientation;var q_=this;this.transform=qX.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var qS=qg.window,qa=this;qS.addEventListener("focus",function(){q_._isFocused=!0,qa.event("focus"),qa.event("focuschange")}),qS.addEventListener("blur",function(){q_._isFocused=!1,qa.event("blur"),qa.event("focuschange"),qa._isInputting()&&(qQS.inputElement.target.focus=!1)});var qR="visibilityState",qJ="visibilitychange",qV=qS.document;void 0!==qV.hidden?(qJ="visibilitychange",qR="visibilityState"):void 0!==qV.mozHidden?(qJ="mozvisibilitychange",qR="mozVisibilityState"):void 0!==qV.msHidden?(qJ="msvisibilitychange",qR="msVisibilityState"):void 0!==qV.webkitHidden&&(qJ="webkitvisibilitychange",qR="webkitVisibilityState"),qS.document.addEventListener(qJ,function(){"hidden"==qg.document[qR]?qa._setStageVisible(!1):qa._setStageVisible(!0)}),qS.document.addEventListener("qbrowserVisibilityChange",function(qS){qa._setStageVisible(!qS.hidden)}),qS.addEventListener("resize",function(){var qS=qg.window.orientation;null!=qS&&qS!=q_._previousOrientation&&qa._isInputting()&&(qQS.inputElement.target.focus=!1),q_._previousOrientation=qS,qa._isInputting()||qa._resetCanvas()}),qS.addEventListener("orientationchange",function(qS){qa._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),qg.onMobile&&this.on("mousedown",this,this._onmouseMove)}qo(qW,"laya.display.Stage",qL);var qS=qW.prototype;return qS._setStageVisible=function(qS){this._isVisibility!=qS&&(this._isVisibility=qS,this._isVisibility||this._isInputting()&&(qQS.inputElement.target.focus=!1),this.event("visibilitychange"))},qS._isInputting=function(){return qg.onMobile&&qQS.isInputting},qS._changeCanvasSize=function(){this.setScreenSize(qg.clientWidth*qg.pixelRatio,qg.clientHeight*qg.pixelRatio)},qS._resetCanvas=function(){if(this.screenAdaptationEnabled){var qS=qK._mainCanvas;qS.source.style;qS.size(1,1),qq.timer.once(100,this,this._changeCanvasSize)}},qS.setScreenSize=function(qS,q_){var qa=!1;if("none"!==this._screenMode&&(qa=(qS/q_<1?"vertical":"horizontal")!==this._screenMode)){var qR=q_;q_=qS,qS=qR}this.canvasRotation=qa;var qJ=qK._mainCanvas,qV=qJ.source.style,qW=this._canvasTransform.identity(),qk=this._scaleMode,qz=qS/this.designWidth,qb=q_/this.designHeight,qH=this.designWidth,qL=this.designHeight,qC=qS,qG=q_,qt=qg.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,qk){case"noscale":qz=qb=1,qC=this.designWidth,qG=this.designHeight;break;case"showall":qz=qb=Math.min(qz,qb),qH=qC=Math.round(this.designWidth*qz),qL=qG=Math.round(this.designHeight*qb);break;case"noborder":qz=qb=Math.max(qz,qb),qC=Math.round(this.designWidth*qz),qG=Math.round(this.designHeight*qb);break;case"full":qz=qb=1,this._width=qH=qS,this._height=qL=q_;break;case"fixedwidth":qb=qz,this._height=qL=Math.round(q_/qz);break;case"fixedheight":qz=qb,this._width=qH=Math.round(qS/qb);break;case"fixedauto":qS/q_<this.designWidth/this.designHeight?(qb=qz,this._height=qL=Math.round(q_/qz)):(qz=qb,this._width=qH=Math.round(qS/qb))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,qH=qH+1&2147483646,qL=qL+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),qz*=this.scaleX,qb*=this.scaleY,1===qz&&1===qb?this.transform.identity():(this.transform.a=this._formatData(qz/(qC/qH)),this.transform.d=this._formatData(qb/(qG/qL)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),qJ.size(qH,qL),qA.changeWebGLSize(qH,qL),qW.scale(qC/qH/qt,qG/qL/qt),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(qS-qC)/qt:this.offset.x=.5*(qS-qC)/qt,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(q_-qG)/qt:this.offset.y=.5*(q_-qG)/qt,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),qW.translate(this.offset.x,this.offset.y),this.canvasDegree=0,qa&&("horizontal"===this._screenMode?(qW.rotate(Math.PI/2),qW.translate(q_/qt,0),this.canvasDegree=90):(qW.rotate(-Math.PI/2),qW.translate(0,qS/qt),this.canvasDegree=-90)),qW.a=this._formatData(qW.a),qW.d=this._formatData(qW.d),qW.tx=this._formatData(qW.tx),qW.ty=this._formatData(qW.ty),qV.transformOrigin=qV.webkitTransformOrigin=qV.msTransformOrigin=qV.mozTransformOrigin=qV.oTransformOrigin="0px 0px 0px",qV.transform=qV.webkitTransform=qV.msTransform=qV.mozTransform=qV.oTransform="matrix("+qW.toString()+")",qW.translate(parseInt(qV.left)||0,parseInt(qV.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},qS._formatData=function(qS){return Math.abs(qS)<1e-6?0:Math.abs(1-qS)<.001?0<qS?1:-1:qS},qS.getMousePoint=function(){return qN.TEMP.setTo(this.mouseX,this.mouseY)},qS.repaint=function(){this._repaint=1},qS.parentRepaint=function(){},qS._loop=function(){return this.render(qK.context,0,0),!0},qS._onmouseMove=function(qS){this._mouseMoveTime=qg.now()},qS.getTimeFromFrameStart=function(){return qg.now()-this._frameStartTime},qS.render=function(qS,q_,qa){if("sleep"===this._frameRate&&!qK.isConchApp){var qR=qg.now();if(!(1e3<=qR-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(qc.loopCount++,qt.instance.runEvent(),qq.timer._update()));this._frameStartTime=qR}if(this._renderCount++,qK.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=qg.now();var qJ="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),qV=this._renderCount%2==0;if(qc.renderSlow=!qJ,qJ||qV||qK.isConchApp){var qW;qc.loopCount++,qt.instance.runEvent(),qq.timer._update(),qA.update3DLoop();var qk=0,qz=0;if(qK.isConchNode)for(qk=0,qz=this._scenes.length;qk<qz;qk++)(qW=this._scenes[qk])&&qW._updateSceneConch();else for(qk=0,qz=this._scenes.length;qk<qz;qk++)(qW=this._scenes[qk])&&qW._updateScene();if(qK.isConchNode){var qb=qLS.CustomList;for(qk=0,qz=qb.length;qk<qz;qk++){var qH=qb[qk];qH.customRender(qH.customContext,0,0)}return}}qK.isConchNode||this.renderingEnabled&&(qJ||!qV||qK.isConchWebGL)&&(qK.isWebGL?qK.WebGL.mainContext&&!qK.WebGL.mainContext.isContextLost()&&(qS.clear(),qL.prototype.render.call(this,qS,q_,qa),qc._show&&qc._sp&&qc._sp.render(qS,q_,qa),qA.clear(this._bgColor),qA.beginFlush(),qS.flush(),qA.endFinish(),qw.instance&&qw.getInstance().endDispose()):(qA.clear(this._bgColor),qL.prototype.render.call(this,qS,q_,qa),qc._show&&qc._sp&&qc._sp.render(qS,q_,qa)))}else this._renderCount%5==0&&(qc.loopCount++,qt.instance.runEvent(),qq.timer._update())},qS._requestFullscreen=function(){var qS=qg.document.documentElement;qS.requestFullscreen?qS.requestFullscreen():qS.mozRequestFullScreen?qS.mozRequestFullScreen():qS.webkitRequestFullscreen?qS.webkitRequestFullscreen():qS.msRequestFullscreen&&qS.msRequestFullscreen()},qS._fullScreenChanged=function(){qq.stage.event("fullscreenchange")},qS.exitFullscreen=function(){var qS=qg.document;qS.exitFullscreen?qS.exitFullscreen():qS.mozCancelFullScreen?qS.mozCancelFullScreen():qS.webkitExitFullscreen&&qS.webkitExitFullscreen()},qH(0,qS,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),qH(0,qS,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),qH(0,qS,"frameRate",function(){return this._frameRate},function(qS){if(this._frameRate=qS,qK.isConchApp)switch(this._frameRate){case"slow":qg.window.conch&&qg.window.conchConfig.setSlowFrame&&qg.window.conchConfig.setSlowFrame(!0);break;case"fast":qg.window.conch&&qg.window.conchConfig.setSlowFrame&&qg.window.conchConfig.setSlowFrame(!1);break;case"mouse":qg.window.conch&&qg.window.conchConfig.setMouseFrame&&qg.window.conchConfig.setMouseFrame(2e3);break;case"sleep":qg.window.conch&&qg.window.conchConfig.setLimitFPS&&qg.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),qH(0,qS,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),qH(0,qS,"width",qL.prototype._$get_width,function(qS){this.designWidth=qS,qq.superSet(qLS,this,"width",qS),qq.timer.callLater(this,this._changeCanvasSize)}),qH(0,qS,"alignH",function(){return this._alignH},function(qS){this._alignH=qS,qq.timer.callLater(this,this._changeCanvasSize)}),qH(0,qS,"isFocused",function(){return this._isFocused}),qH(0,qS,"height",qL.prototype._$get_height,function(qS){this.designHeight=qS,qq.superSet(qLS,this,"height",qS),qq.timer.callLater(this,this._changeCanvasSize)}),qH(0,qS,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||qX.create()},qL.prototype._$set_transform),qH(0,qS,"isVisibility",function(){return this._isVisibility}),qH(0,qS,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),qH(0,qS,"scaleMode",function(){return this._scaleMode},function(qS){this._scaleMode=qS,qq.timer.callLater(this,this._changeCanvasSize)}),qH(0,qS,"alignV",function(){return this._alignV},function(qS){this._alignV=qS,qq.timer.callLater(this,this._changeCanvasSize)}),qH(0,qS,"bgColor",function(){return this._bgColor},function(qS){this._bgColor=qS,this.conchModel&&this.conchModel.bgColor(qS),qK.isWebGL&&(qS?qW._wgColor=qf.create(qS)._color:qg.onMiniGame||(qW._wgColor=null)),qg.onLimixiu?qW._wgColor=qf.create(qS)._color:qK.canvas.style.background=qS||"none"}),qH(0,qS,"mouseX",function(){return Math.round(qt.instance.mouseX/this.clientScaleX)}),qH(0,qS,"mouseY",function(){return Math.round(qt.instance.mouseY/this.clientScaleY)}),qH(0,qS,"screenMode",function(){return this._screenMode},function(qS){this._screenMode=qS}),qH(0,qS,"visible",qL.prototype._$get_visible,function(qS){this.visible!==qS&&(qq.superSet(qLS,this,"visible",qS),qK._mainCanvas.source.style.visibility=qS?"visible":"hidden")}),qH(0,qS,"fullScreenEnabled",null,function(qS){var q_=qg.document,qa=qK.canvas;qS?(qa.addEventListener("mousedown",this._requestFullscreen),qa.addEventListener("touchstart",this._requestFullscreen),q_.addEventListener("fullscreenchange",this._fullScreenChanged),q_.addEventListener("mozfullscreenchange",this._fullScreenChanged),q_.addEventListener("webkitfullscreenchange",this._fullScreenChanged),q_.addEventListener("msfullscreenchange",this._fullScreenChanged)):(qa.removeEventListener("mousedown",this._requestFullscreen),qa.removeEventListener("touchstart",this._requestFullscreen),q_.removeEventListener("fullscreenchange",this._fullScreenChanged),q_.removeEventListener("mozfullscreenchange",this._fullScreenChanged),q_.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),q_.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),qW.SCALE_NOSCALE="noscale",qW.SCALE_EXACTFIT="exactfit",qW.SCALE_SHOWALL="showall",qW.SCALE_NOBORDER="noborder",qW.SCALE_FULL="full",qW.SCALE_FIXED_WIDTH="fixedwidth",qW.SCALE_FIXED_HEIGHT="fixedheight",qW.SCALE_FIXED_AUTO="fixedauto",qW.ALIGN_LEFT="left",qW.ALIGN_RIGHT="right",qW.ALIGN_CENTER="center",qW.ALIGN_TOP="top",qW.ALIGN_MIDDLE="middle",qW.ALIGN_BOTTOM="bottom",qW.SCREEN_NONE="none",qW.SCREEN_HORIZONTAL="horizontal",qW.SCREEN_VERTICAL="vertical",qW.FRAME_FAST="fast",qW.FRAME_SLOW="slow",qW.FRAME_MOUSE="mouse",qW.FRAME_SLEEP="sleep",qW.FRAME_MOUSE_THREDHOLD=2e3,qz(qW,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),qW}(qLS),qTS=(function(qS){function q_(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,q_.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}qo(q_,"laya.media.SoundNode",qLS);var qa=q_.prototype;qa._onParentChange=function(){this.target=this.parent},qa.play=function(qS,q_){void 0===qS&&(qS=1),isNaN(qS)&&(qS=1),this.url&&(this.stop(),this._channel=qI.playSound(this.url,qS,null,q_))},qa.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},qa._setPlayAction=function(qS,q_,qa,qR){void 0===qR&&(qR=!0),this[qa]&&qS&&(qR?qS.on(q_,this,this[qa]):qS.off(q_,this,this[qa]))},qa._setPlayActions=function(qS,q_,qa,qR){if(void 0===qR&&(qR=!0),qS&&q_){var qJ,qV=q_.split(","),qW=0;for(qJ=qV.length,qW=0;qW<qJ;qW++)this._setPlayAction(qS,qV[qW],qa,qR)}},qH(0,qa,"playEvent",null,function(qS){(this._playEvents=qS)&&this._tar&&this._setPlayActions(this._tar,qS,"play")}),qH(0,qa,"target",null,function(qS){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=qS,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),qH(0,qa,"stopEvent",null,function(qS){(this._stopEvents=qS)&&this._tar&&this._setPlayActions(this._tar,qS,"stop")})}(),function(qS){function q_(){this._src=null,this._onload=null,this._onerror=null,q_.__super.call(this)}qo(q_,"laya.resource.FileBitmap",qtS);var qa=q_.prototype;return qH(0,qa,"src",function(){return this._src},function(qS){this._src=qS}),qH(0,qa,"onload",null,function(qS){}),qH(0,qa,"onerror",null,function(qS){}),q_}()),qDS=function(qS){function qa(qS,q_){this._is2D=!1,qa.__super.call(this);var qR=this;if(this._source=this,"2D"===qS||"AUTO"===qS&&!qK.isWebGL){this._is2D=!0,this._source=q_||qg.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var qJ=this;qJ.getContext=function(qS,q_){if(qR._ctx)return qR._ctx;var qa=qR._ctx=qR._source.getContext(qS,q_);return qa&&(qa._canvas=qJ,qK.isFlash||qg.onLimixiu||(qa.size=function(qS,q_){})),qa}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}qo(qa,"laya.resource.HTMLCanvas",qtS);var q_=qa.prototype;return q_.clear=function(){this._ctx&&this._ctx.clear()},q_.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},q_.release=function(){},q_._setContext=function(qS){this._ctx=qS},q_.getContext=function(qS,q_){return this._ctx?this._ctx:this._ctx=qa._createContext(this)},q_.getMemSize=function(){return 0},q_.size=function(qS,q_){(this._w!=qS||this._h!=q_||this._source&&(this._source.width!=qS||this._source.height!=q_))&&(this._w=qS,this._h=q_,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(qS,q_),this._source&&(this._source.height=q_,this._source.width=qS))},q_.getCanvas=function(){return this._source},q_.toBase64=function(qS,q_,qa){if(this._source)if(qK.isConchApp&&this._source.toBase64)this._source.toBase64(qS,q_,qa);else{var qR=this._source.toDataURL(qS,q_);qa.call(this,qR)}},qH(0,q_,"context",function(){return this._ctx}),qH(0,q_,"asBitmap",null,function(qS){}),qa.create=function(qS,q_){return new qa(qS,q_)},qa.TYPE2D="2D",qa.TYPE3D="3D",qa.TYPEAUTO="AUTO",qa._createContext=null,qa}(),qjS=(function(qS){function qz(qS,q_,qa,qR,qJ,qV,qW,qk){throw qz.__super.call(this),new Error("不允许new！")}qo(qz,"laya.resource.HTMLSubImage",qtS),qz.create=function(qS,q_,qa,qR,qJ,qV,qW,qk){return void 0===qk&&(qk=!1),new qz(qS,q_,qa,qR,qJ,qV,qW,qk)}}(),function(qS){function qL(){this._frames=null,this._url=null,qL.__super.call(this),this._setControlNode(this)}qo(qL,"laya.display.Animation",qS);var q_=qL.prototype;q_.destroy=function(qS){void 0===qS&&(qS=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,qS),this._frames=null,this._labels=null},q_.play=function(qS,q_,qa,qR){void 0===qS&&(qS=0),void 0===q_&&(q_=!0),void 0===qa&&(qa=""),void 0===qR&&(qR=!0),qa&&this._setFramesFromCache(qa,qR),this._isPlaying=!0,this.index="string"==typeof qS?this._getFrameByLabel(qS):qS,this.loop=q_,this._actionName=qa,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},q_._setFramesFromCache=function(qS,q_){var qa;return void 0===q_&&(q_=!1),this._url&&(qS=this._url+"#"+qS),qS&&qL.framesMap[qS]?((qa=qL.framesMap[qS])instanceof Array?(this._frames=qL.framesMap[qS],this._count=this._frames.length):(qa.nodeRoot&&(qL.framesMap[qS]=this._parseGraphicAnimationByData(qa),qa=qL.framesMap[qS]),this._frames=qa.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=qa.interval),this._labels=this._copyLabels(qa.labels)),!0):(q_&&console.log("ani not found:",qS),!1)},q_._copyLabels=function(qS){if(!qS)return null;var q_,qa;for(qa in q_={},qS)q_[qa]=qO.copyArray([],qS[qa]);return q_},q_._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&qS.prototype._frameLoop.call(this)},q_._displayToIndex=function(qS){this._frames&&(this.graphics=this._frames[qS])},q_.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},q_.loadImages=function(qS,q_){return void 0===q_&&(q_=""),this._url="",this._setFramesFromCache(q_)||(this.frames=qL.framesMap[q_]?qL.framesMap[q_]:qL.createFrames(qS,q_)),this},q_.loadAtlas=function(q_,qa,qR){void 0===qR&&(qR=""),this._url="";var qJ=this;function qS(qS){q_===qS&&(qJ.frames=qL.framesMap[qR]?qL.framesMap[qR]:qL.createFrames(q_,qR),qa&&qa.run())}return qJ._setFramesFromCache(qR)||(qkS.getAtlas(q_)?qS(q_):qq.loader.load(q_,qT.create(null,qS,[q_]),null,"atlas")),this},q_.loadAnimation=function(qS,q_,qa){this._url=qS;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,q_&&q_.run()):!qa||qkS.getAtlas(qa)?this._loadAnimationData(qS,q_,qa):qq.loader.load(qa,qT.create(this,this._loadAnimationData,[qS,q_,qa]),null,"atlas"),this},q_._loadAnimationData=function(qk,qz,qS){var qb=this;if(!qS||qkS.getAtlas(qS)){var qH=this;qkS.getRes(qk)?q_(qk):qq.loader.load(qk,qT.create(null,q_,[qk]),null,"json"),qkS.clearRes(qk)}else console.warn("atlas load fail:"+qS);function q_(qS){if(qkS.getRes(qS)&&qk===qS){var q_;if(qL.framesMap[qk+"#"])qH._setFramesFromCache(qb._actionName,!0),qb.index=0,qb._checkResumePlaying();else{var qa=qH._parseGraphicAnimation(qkS.getRes(qk));if(!qa)return;var qR,qJ=qa.animationList,qV=0,qW=qJ.length;for(qV=0;qV<qW;qV++)q_=qJ[qV],qL.framesMap[qk+"#"+q_.name]=q_,qR||(qR=q_);qR&&(qL.framesMap[qk+"#"]=qR,qH._setFramesFromCache(qb._actionName,!0),qb.index=0),qb._checkResumePlaying()}qz&&qz.run()}}},q_._parseGraphicAnimation=function(qS){return qqS.parseAnimationData(qS)},q_._parseGraphicAnimationByData=function(qS){return qqS.parseAnimationByData(qS)},qH(0,q_,"frames",function(){return this._frames},function(qS){(this._frames=qS)&&(this._count=qS.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),qH(0,q_,"autoPlay",null,function(qS){qS?this.play():this.stop()}),qH(0,q_,"source",null,function(qS){-1<qS.indexOf(".ani")?this.loadAnimation(qS):-1<qS.indexOf(".json")||-1<qS.indexOf("als")||-1<qS.indexOf("atlas")?this.loadAtlas(qS):this.loadImages(qS.split(","))}),qH(0,q_,"autoAnimation",null,function(qS){this.play(0,!0,qS,!1)}),qL.createFrames=function(qS,q_){var qa,qR,qJ=0,qV=0;if("string"==typeof qS){var qW=qkS.getAtlas(qS);if(qW&&qW.length)for(qa=[],qJ=0,qV=qW.length;qJ<qV;qJ++)(qR=new qA.createGraphics).drawTexture(qkS.getRes(qW[qJ]),0,0),qa.push(qR)}else if(qS instanceof Array)for(qa=[],qJ=0,qV=qS.length;qJ<qV;qJ++)(qR=new qA.createGraphics).loadImage(qS[qJ],0,0),qa.push(qR);return q_&&(qL.framesMap[q_]=qa),qa},qL.clearCache=function(qS){var q_,qa=qL.framesMap,qR=qS+"#";for(q_ in qa)q_!==qS&&0!=q_.indexOf(qR)||delete qL.framesMap[q_]},qL.framesMap={}}(qoS),function(qS){function qV(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,qV.__super.call(this),null==qV._sortIndexFun&&(qV._sortIndexFun=qm.sortByKey("index",!1,!0))}qo(qV,"laya.display.FrameAnimation",qS);var q_=qV.prototype;return q_._setUp=function(qS,q_){this._labels=null,this._animationNewFrames=null,this._targetDic=qS,this._animationData=q_,this.interval=1e3/q_.frameRate,q_.parsed?(this._count=q_.count,this._labels=q_.labels,this._animationNewFrames=q_.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),q_.parsed=!0,q_.labels=this._labels,q_.count=this._count,q_.animationNewFrames=this._animationNewFrames},q_.clear=function(){qS.prototype.clear.call(this),this._targetDic=null,this._animationData=null},q_._displayToIndex=function(qS){if(this._animationData){qS<0&&(qS=0),qS>this._count&&(qS=this._count);var q_=this._animationData.nodes,qa=0,qR=q_.length;for(qa=0;qa<qR;qa++)this._displayNodeToFrame(q_[qa],qS)}},q_._displayNodeToFrame=function(qS,q_,qa){qa||(qa=this._targetDic);var qR=qa[qS.target];if(qR){var qJ,qV,qW,qk=qS.frames,qz=qS.keys,qb=0,qH=qz.length;for(qb=0;qb<qH;qb++)qW=(qV=qk[qJ=qz[qb]]).length>q_?qV[q_]:qV[qV.length-1],qR[qJ]=qW}},q_._calculateDatas=function(){if(this._animationData){var qS,q_=this._animationData.nodes,qa=0,qR=q_.length;for(qa=this._count=0;qa<qR;qa++)qS=q_[qa],this._calculateNodeKeyFrames(qS);this._count+=1}},q_._calculateNodeKeyFrames=function(qS){var q_,qa,qR=qS.keyframes,qJ=qS.target;for(q_ in qS.frames||(qS.frames={}),qS.keys?qS.keys.length=0:qS.keys=[],qS.initValues||(qS.initValues={}),qR)qa=qR[q_],qS.frames[q_]||(qS.frames[q_]=[]),this._targetDic&&this._targetDic[qJ]&&(qS.initValues[q_]=this._targetDic[qJ][q_]),qa.sort(qV._sortIndexFun),qS.keys.push(q_),this._calculateNodePropFrames(qa,qS.frames[q_],q_,qJ)},q_.resetToInitState=function(){if(this._targetDic&&this._animationData){var qS,q_,qa=this._animationData.nodes,qR=0,qJ=qa.length;for(qR=0;qR<qJ;qR++)if(q_=(qS=qa[qR]).initValues){var qV,qW=this._targetDic[qS.target];if(qW)for(qV in q_)qW[qV]=q_[qV]}}},q_._calculateNodePropFrames=function(qS,q_,qa,qR){var qJ=0,qV=qS.length-1;if(0<qV){for(q_.length=qS[qV].index+1,qJ=0;qJ<qV;qJ++)this._dealKeyFrame(qS[qJ]),this._calculateFrameValues(qS[qJ],qS[qJ+1],q_);this._dealKeyFrame(qS[qJ])}0==qV&&(q_[qS[0].index]=qS[0].value,this._animationNewFrames&&(this._animationNewFrames[qS[0].index]=!0))},q_._dealKeyFrame=function(qS){qS.label&&""!=qS.label&&this.addLabel(qS.label,qS.index)},q_._calculateFrameValues=function(qS,q_,qa){var qR,qJ=0,qV=qS.index,qW=q_.index,qk=qS.value,qz=q_.value-qS.value,qb=qW-qV;if(qW>this._count&&(this._count=qW),qS.tween)for(null==(qR=qi[qS.tweenMethod])&&(qR=qi.linearNone),qJ=qV;qJ<qW;qJ++)qa[qJ]=qR(qJ-qV,qk,qz,qb),this._animationNewFrames&&(this._animationNewFrames[qJ]=!0);else for(qJ=qV;qJ<qW;qJ++)qa[qJ]=qk;this._animationNewFrames&&(this._animationNewFrames[qS.index]=!0,this._animationNewFrames[q_.index]=!0),qa[q_.index]=q_.value},qV._sortIndexFun=null,qV}(qoS)),qQS=function(q_){function qJ(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",qJ.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=q$S.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}qo(qJ,"laya.display.Input",q_);var qS=qJ.prototype;return qS.setSelection=function(qS,q_){this.focus=!0,laya.display.Input.inputElement.selectionStart=qS,laya.display.Input.inputElement.selectionEnd=q_},qS._onUnDisplay=function(qS){this.focus=!1},qS._onMouseDown=function(qS){this.focus=!0},qS._syncInputTransform=function(){var qS=this.nativeInput,q_=qO.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),qa=this._width-this.padding[1]-this.padding[3],qR=this._height-this.padding[0]-this.padding[2];qK.isConchApp?(qS.setScale(q_.scaleX,q_.scaleY),qS.setSize(qa,qR),qS.setPos(q_.x,q_.y)):(qJ.inputContainer.style.transform=qJ.inputContainer.style.webkitTransform="scale("+q_.scaleX+","+q_.scaleY+") rotate("+qq.stage.canvasDegree+"deg)",qS.style.width=qa+"px",qS.style.height=qR+"px",qJ.inputContainer.style.left=q_.x+"px",qJ.inputContainer.style.top=q_.y+"px")},qS.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},qS._setInputMethod=function(){qJ.input.parentElement&&qJ.inputContainer.removeChild(qJ.input),qJ.area.parentElement&&qJ.inputContainer.removeChild(qJ.area),qJ.inputElement=this._multiline?qJ.area:qJ.input,qJ.inputContainer.appendChild(qJ.inputElement),q$S.RightToLeft&&(qJ.inputElement.style.direction="rtl")},qS._focusIn=function(){laya.display.Input.isInputting=!0;var qS=this.nativeInput;this._focus=!0;var q_=qS.style;q_.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),qS.readOnly=!this._editable,qK.isConchApp&&(qS.setType(this._type),qS.setForbidEdit(!this._editable)),qS.maxLength=this._maxChars;this.padding;if(qS.type=this._type,qS.value=this._content,qS.placeholder=this._prompt,qq.stage.off("keydown",this,this._onKeyDown),qq.stage.on("keydown",this,this._onKeyDown),(qq.stage.focus=this).event("focus"),qg.onPC&&qS.focus(),!qg.onMiniGame){this._text;this._text=null}this.typeset(),qS.setColor(this._originColor),qS.setFontSize(this.fontSize),qS.setFontFace(qg.onIPhone&&q$S._fontFamilyMap[this.font]||this.font),qK.isConchApp&&qS.setMultiAble&&qS.setMultiAble(this._multiline),q_.lineHeight=this.leading+this.fontSize+"px",q_.fontStyle=this.italic?"italic":"normal",q_.fontWeight=this.bold?"bold":"normal",q_.textAlign=this.align,q_.padding="0 0",this._syncInputTransform(),!qK.isConchApp&&qg.onPC&&qq.timer.frameLoop(1,this,this._syncInputTransform)},qS._setPromptColor=function(){(qJ.promptStyleDOM=qg.getElementById("promptStyle"))||((qJ.promptStyleDOM=qg.createElement("style")).setAttribute("id","promptStyle"),qg.document.head.appendChild(qJ.promptStyleDOM)),qJ.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},qS._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(qq.superSet(q$S,this,"text",this._content),qq.superSet(q$S,this,"color",this._originColor)):(qq.superSet(q$S,this,"text",this._prompt),qq.superSet(q$S,this,"color",this._promptColor)),qq.stage.off("keydown",this,this._onKeyDown),qq.stage.focus=null,this.event("blur"),qK.isConchApp&&this.nativeInput.blur(),qg.onPC&&qq.timer.clear(this,this._syncInputTransform)},qS._onKeyDown=function(qS){13===qS.keyCode&&(qg.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},qS.changeText=function(qS){this._content=qS,this._focus?(this.nativeInput.value=qS||"",this.event("change")):q_.prototype.changeText.call(this,qS)},qH(0,qS,"color",q_.prototype._$get_color,function(qS){this._focus&&this.nativeInput.setColor(qS),qq.superSet(q$S,this,"color",this._content?qS:this._promptColor),this._originColor=qS}),qH(0,qS,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(qS){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),qH(0,qS,"multiline",function(){return this._multiline},function(qS){this._multiline=qS,this.valign=qS?"top":"middle"}),qH(0,qS,"maxChars",function(){return this._maxChars},function(qS){qS<=0&&(qS=1e5),this._maxChars=qS}),qH(0,qS,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(qS){qq.superSet(q$S,this,"color",this._originColor),qS+="",this._focus?(this.nativeInput.value=qS||"",this.event("change")):(this._multiline||(qS=qS.replace(/\r?\n/g,"")),(this._content=qS)?qq.superSet(q$S,this,"text",qS):(qq.superSet(q$S,this,"text",this._prompt),qq.superSet(q$S,this,"color",this.promptColor)))}),qH(0,qS,"nativeInput",function(){return this._multiline?qJ.area:qJ.input}),qH(0,qS,"prompt",function(){return this._prompt},function(qS){!this._text&&qS&&qq.superSet(q$S,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?qq.superSet(q$S,this,"text",this._text==this._prompt?qS:this._text):qq.superSet(q$S,this,"text",qS),this._prompt=q$S.langPacks&&q$S.langPacks[qS]?q$S.langPacks[qS]:qS}),qH(0,qS,"focus",function(){return this._focus},function(qS){var q_=this.nativeInput;this._focus!==qS&&(qS?(q_.target?q_.target._focusOut():this._setInputMethod(),(q_.target=this)._focusIn()):(q_.target=null,this._focusOut(),qg.document.body.scrollTop=0,q_.blur(),qK.isConchApp?q_.setPos(-1e4,-1e4):qJ.inputContainer.contains(q_)&&qJ.inputContainer.removeChild(q_)))}),qH(0,qS,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(qS){qS?(-1<(qS="[^"+qS+"]").indexOf("^^")&&(qS=qS.replace("^^","")),this._restrictPattern=new RegExp(qS,"g")):this._restrictPattern=null}),qH(0,qS,"editable",function(){return this._editable},function(qS){this._editable=qS,qK.isConchApp&&qJ.input.setForbidEdit(!qS)}),qH(0,qS,"promptColor",function(){return this._promptColor},function(qS){this._promptColor=qS,this._content||qq.superSet(q$S,this,"color",qS)}),qH(0,qS,"type",function(){return this._type},function(qS){this._getCSSStyle().password="password"==qS,this._type=qS,qK.isConchApp&&this.nativeInput.setType(qS)}),qH(0,qS,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(qS){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),qH(0,qS,"asPassword",function(){return this._getCSSStyle().password},function(qS){this._getCSSStyle().password=qS,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),qJ.__init__=function(){qJ._createInputElement(),qg.onMobile&&qK.canvas.addEventListener(qJ.IOS_IFRAME?qg.onMiniGame?"touchend":"click":"touchend",qJ._popupInputMethod)},qJ._popupInputMethod=function(qS){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},qJ._createInputElement=function(){qJ._initInput(qJ.area=qg.createElement("textarea")),qJ._initInput(qJ.input=qg.createElement("input")),(qJ.inputContainer=qg.createElement("div")).style.position="absolute",qJ.inputContainer.style.zIndex=1e5,qg.container.appendChild(qJ.inputContainer),qJ.inputContainer.setPos=function(qS,q_){qJ.inputContainer.style.left=qS+"px",qJ.inputContainer.style.top=q_+"px"}},qJ._initInput=function(q_){var qS=q_.style;qS.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",qS.resize="none",qS.backgroundColor="transparent",qS.border="none",qS.outline="none",qS.zIndex=1,q_.addEventListener("input",qJ._processInputting),q_.addEventListener("mousemove",qJ._stopEvent),q_.addEventListener("mousedown",qJ._stopEvent),q_.addEventListener("touchmove",qJ._stopEvent),q_.setFontFace=function(qS){q_.style.fontFamily=qS},qK.isConchApp||(q_.setColor=function(qS){q_.style.color=qS},q_.setFontSize=function(qS){q_.style.fontSize=qS+"px"})},qJ._processInputting=function(qS){var q_=laya.display.Input.inputElement.target;if(q_){var qa=laya.display.Input.inputElement.value;q_._restrictPattern&&(qa=qa.replace(/\u2006|\x27/g,""),q_._restrictPattern.test(qa)&&(qa=qa.replace(q_._restrictPattern,""),laya.display.Input.inputElement.value=qa)),q_._text=qa,q_.event("input")}},qJ._stopEvent=function(qS){"touchmove"==qS.type&&qS.preventDefault(),qS.stopPropagation&&qS.stopPropagation()},qJ.TYPE_TEXT="text",qJ.TYPE_PASSWORD="password",qJ.TYPE_EMAIL="email",qJ.TYPE_URL="url",qJ.TYPE_NUMBER="number",qJ.TYPE_RANGE="range",qJ.TYPE_DATE="date",qJ.TYPE_MONTH="month",qJ.TYPE_WEEK="week",qJ.TYPE_TIME="time",qJ.TYPE_DATE_TIME="datetime",qJ.TYPE_DATE_TIME_LOCAL="datetime-local",qJ.TYPE_SEARCH="search",qJ.input=null,qJ.area=null,qJ.inputElement=null,qJ.inputContainer=null,qJ.confirmButton=null,qJ.promptStyleDOM=null,qJ.inputHeight=45,qJ.isInputting=!1,qJ.stageMatrix=null,qz(qJ,["IOS_IFRAME",function(){return this.IOS_IFRAME=qg.onIOS&&qg.window.top!=qg.window.self}]),qJ}(q$S),qmS=function(qS){function qa(qS,q_){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,qa.__super.call(this),qS&&this._init_(qS,q_)}qo(qa,"laya.resource.HTMLImage",qTS);var q_=qa.prototype;return q_._init_=function(qS,q_){this._src=qS,this._source=new qg.window.Image,q_&&(q_.onload&&(this.onload=q_.onload),q_.onerror&&(this.onerror=q_.onerror),q_.onCreate&&q_.onCreate(this)),0!=qS.indexOf("data:image")&&(this._source.crossOrigin=""),qS&&(this._source.src=qS)},q_.recreateResource=function(){var qS=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var q_=this;this._source=new qg.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(q_._needReleaseAgain)return q_._needReleaseAgain=!1,q_._source.onload=null,void(q_._source=null);q_._source.onload=null,q_.memorySize=qS._w*qS._h*4,q_._recreateLock=!1,q_.completeCreate()},this._source.src=this._src}},q_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},q_.onresize=function(){this._w=this._source.width,this._h=this._source.height},qH(0,q_,"onload",null,function(qS){var q_=this;this._onload=qS,this._source&&(this._source.onload=null!=this._onload?function(){q_.onresize(),q_._onload()}:null)}),qH(0,q_,"onerror",null,function(qS){var q_=this;this._onerror=qS,this._source&&(this._source.onerror=null!=this._onerror?function(){q_._onerror()}:null)}),qH(0,q_,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(qS){this._enableMerageInAtlas=qS,qK.isConchApp&&this._source&&(this._source.enableMerageInAtlas=qS)}),qa.create=function(qS,q_){return new qa(qS,q_)},qa}(),qqS=(function(qV){function qS(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,qS.__super.call(this)}qo(qS,"laya.display.EffectAnimation",qV);var q_=qS.prototype;q_._onOtherBegin=function(qS){qS!=this&&this.stop()},q_.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},q_._onPlayAction=function(){this.play(0,!1)},q_.play=function(qS,q_,qa,qR){void 0===qS&&(qS=0),void 0===q_&&(q_=!0),void 0===qa&&(qa=""),void 0===qR&&(qR=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,qS,q_,qa,qR))},q_._recordInitData=function(){if(this._aniKeys){var qS,q_,qa=0;for(qS=this._aniKeys.length,qa=0;qa<qS;qa++)q_=this._aniKeys[qa],this._initData[q_]=this._target[q_]}},q_._displayToIndex=function(qS){if(this._animationData){qS<0&&(qS=0),qS>this._count&&(qS=this._count);var q_=this._animationData.nodes,qa=0,qR=q_.length;for(qR=1<qR?1:qR,qa=0;qa<qR;qa++)this._displayNodeToFrame(q_[qa],qS)}},q_._displayNodeToFrame=function(qS,q_,qa){if(this._target){var qR;qR=this._target;var qJ,qV,qW,qk,qz=qS.frames,qb=qS.keys,qH=0,qL=qb.length;qk=qS.secondFrames;var qC,qG,qt,qo,q$=0;for(qH=0;qH<qL;qH++)qV=qz[qJ=qb[qH]],qW=-1==(q$=qk[qJ])?this._initData[qJ]:q_<q$?(qt=(qG=qS.keyframes[qJ])[0]).tween?(null==(qC=qi[qt.tweenMethod])&&(qC=qi.linearNone),qo=qG[1],qC(q_,this._initData[qJ],qo.value-this._initData[qJ],qo.index)):this._initData[qJ]:qV.length>q_?qV[q_]:qV[qV.length-1],qR[qJ]=qW}},q_._calculateNodeKeyFrames=function(qS){qV.prototype._calculateNodeKeyFrames.call(this,qS);var q_,qa,qR,qJ=qS.keyframes;qS.target;for(q_ in qR={},qS.secondFrames=qR,qJ)(qa=qJ[q_]).length<=1?qR[q_]=-1:qR[q_]=qa[1].index},qH(0,q_,"target",function(){return this._target},function(qS){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=qS,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),qH(0,q_,"playEvent",null,function(qS){(this._playEvents=qS)&&this.addEvent()}),qH(0,q_,"effectData",null,function(qS){var q_;qS&&((q_=qS.animations)&&q_[0]&&(this._setUp({},q_[0]),q_[0].nodes&&q_[0].nodes[0]&&(this._aniKeys=q_[0].nodes[0].keys)))}),qH(0,q_,"effectClass",null,function(qS){var q_,qa;(this._effectClass=qU.getClass(qS),this._effectClass)&&((q_=this._effectClass.uiView)&&(qa=q_.animations)&&qa[0]&&(this._setUp({},qa[0]),qa[0].nodes&&qa[0].nodes[0]&&(this._aniKeys=qa[0].nodes[0].keys)))}),qS.EffectAnimationBegin="effectanimationbegin"}(qjS),function(q_){var qB;function qI(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,qI.__super.call(this)}qo(qI,"laya.utils.GraphicAnimation",q_);var qS=qI.prototype;return qS._parseNodeList=function(qS){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[qS.compId]=qS.props,qS.compId&&this._nodeList.push(qS.compId);var q_=qS.child;if(q_){var qa=0,qR=q_.length;for(qa=0;qa<qR;qa++)this._parseNodeList(q_[qa])}},qS._calGraphicData=function(qS){var q_;if(this._setUp(null,qS),this._createGraphicData(),this._nodeIDAniDic)for(q_ in this._nodeIDAniDic)this._nodeIDAniDic[q_]=null},qS._createGraphicData=function(){var qS,q_=[],qa=0,qR=this.count,qJ=this._animationNewFrames;for(qJ||(qJ=[]),qa=0;qa<qR;qa++)!qJ[qa]&&qS||(qS=this._createFrameGraphic(qa)),q_.push(qS);this._gList=q_},qS._createFrameGraphic=function(qS){var q_=qA.createGraphics();return qI._rootMatrix||(qI._rootMatrix=new qX),this._updateNodeGraphic(this._rootNode,qS,qI._rootMatrix,q_),q_},qS._updateNodeGraphic=function(qS,q_,qa,qR,qJ){var qV;void 0===qJ&&(qJ=1);var qW,qk,qz,qb=(qV=this._nodeGDic[qS.compId]=this._getNodeGraphicData(qS.compId,q_,this._nodeGDic[qS.compId])).alpha*qJ;if(!(qb<.01)&&(qV.resultTransform||(qV.resultTransform=qX.create()),qW=qV.resultTransform,qX.mul(qV.transform,qa,qW),qV.skin&&(qk=this._getTextureByUrl(qV.skin))&&(qW._checkTransform()?(qR.drawTexture(qk,0,0,qV.width,qV.height,qW,qb),qV.resultTransform=null):qR.drawTexture(qk,qW.tx,qW.ty,qV.width,qV.height,null,qb)),qz=qS.child)){var qH,qL=0;for(qH=qz.length,qL=0;qL<qH;qL++)this._updateNodeGraphic(qz[qL],q_,qW,qR,qb)}},qS._updateNoChilds=function(qS,q_){if(qS.skin){var qa=this._getTextureByUrl(qS.skin);if(qa){var qR=qS.transform;qR._checkTransform();!qR.bTransform?q_.drawTexture(qa,qR.tx,qR.ty,qS.width,qS.height,null,qS.alpha):q_.drawTexture(qa,0,0,qS.width,qS.height,qR.clone(),qS.alpha)}}},qS._updateNodeGraphic2=function(qS,q_,qa){var qR;if(qR=this._nodeGDic[qS.compId]=this._getNodeGraphicData(qS.compId,q_,this._nodeGDic[qS.compId]),qS.child){var qJ=qR.transform;qJ._checkTransform();var qV,qW;qW=(qV=!qJ.bTransform)&&(0!=qJ.tx||0!=qJ.ty);var qk,qz,qb;if((qk=qJ.bTransform||1!=qR.alpha)&&qa.save(),1!=qR.alpha&&qa.alpha(qR.alpha),qV?qW&&qa.translate(qJ.tx,qJ.ty):qa.transform(qJ.clone()),qz=qS.child,qR.skin&&(qb=this._getTextureByUrl(qR.skin))&&qa.drawTexture(qb,0,0,qR.width,qR.height),qz){var qH,qL=0;for(qH=qz.length,qL=0;qL<qH;qL++)this._updateNodeGraphic2(qz[qL],q_,qa)}qk?qa.restore():qV?qW&&qa.translate(-qJ.tx,-qJ.ty):qa.transform(qJ.clone().invert())}else this._updateNoChilds(qR,qa)},qS._calculateNodeKeyFrames=function(qS){q_.prototype._calculateNodeKeyFrames.call(this,qS),this._nodeIDAniDic[qS.target]=qS},qS.getNodeDataByID=function(qS){return this._nodeIDAniDic[qS]},qS._getParams=function(qS,q_,qa,qR){var qJ=qI._temParam;qJ.length=q_.length;var qV=0,qW=q_.length;for(qV=0;qV<qW;qV++)qJ[qV]=this._getObjVar(qS,q_[qV][0],qa,q_[qV][1],qR);return qJ},qS._getObjVar=function(qS,q_,qa,qR,qJ){if(qS.hasOwnProperty(q_)){var qV=qS[q_];if(qa>=qV.length&&(qa=qV.length-1),null!=qS[q_][qa])return qS[q_][qa]}return qJ.hasOwnProperty(q_)?qJ[q_]:qR},qS._getNodeGraphicData=function(qS,q_,qa){qa||(qa=qB.create()),qa.transform?qa.transform.identity():qa.transform=qX.create();var qR=this.getNodeDataByID(qS);if(!qR)return qa;var qJ,qV,qW=qR.frames,qk=this._getParams(qW,qI._drawTextureCmd,q_,this._nodeDefaultProps[qS]),qz=qk[0],qb=NaN,qH=NaN,qL=qk[5],qC=qk[6],qG=qk[13],qt=qk[14],qo=qk[7],q$=qk[8],qF=qk[9],qT=qk[11],qD=qk[12];qb=qk[3],qH=qk[4],0!=qb&&0!=qH||(qz=null),-1==qb&&(qb=0),-1==qH&&(qH=0),qa.skin=qz,qa.width=qb,qa.height=qH,qz&&((qJ=this._getTextureByUrl(qz))?(qb||(qb=qJ.sourceWidth),qH||(qH=qJ.sourceHeight)):console.warn("lost skin:",qz,",you may load pics first")),qa.alpha=qk[10],qV=qa.transform,0!=qG&&(qL=qG*qb),0!=qt&&(qC=qt*qH),0==qL&&0==qC||qV.translate(-qL,-qC);var qj=null;if(qF||1!==qo||1!==q$||qT||qD){(qj=qI._tempMt).identity(),qj.bTransform=!0;var qQ=.0174532922222222*(qF-qT),qm=.0174532922222222*(qF+qD),qq=Math.cos(qm),qN=Math.sin(qm),qn=Math.sin(qQ),ql=Math.cos(qQ);qj.a=qo*qq,qj.b=qo*qN,qj.c=-q$*qn,qj.d=q$*ql,qj.tx=qj.ty=0}return qj&&(qV=qX.mul(qV,qj,qV)),qV.translate(qk[1],qk[2]),qa},qS._getTextureByUrl=function(qS){return qkS.getRes(qS)},qS.setAniData=function(qS,q_){if(qS.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=qS,this._parseNodeList(qS);var qa,qR={},qJ=[],qV=qS.animations,qW=0,qk=qV.length;for(qW=0;qW<qk;qW++)if(qa=qV[qW],this._labels=null,(!q_||q_==qa.name)&&qa){try{this._calGraphicData(qa)}catch(qS){console.warn("parse animation fail:"+qa.name+",empty animation created"),this._gList=[]}var qz={};qz.interval=1e3/qa.frameRate,qz.frames=this._gList,qz.labels=this._labels,qz.name=qa.name,qJ.push(qz),qR[qa.name]=qz}this.animationList=qJ,this.animationDic=qR}qI._temParam.length=0},qS.parseByData=function(qS){var q_,qa;q_=qS.nodeRoot,qa=qS.aniO,delete qS.nodeRoot,delete qS.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=q_,this._parseNodeList(q_),this._labels=null;try{this._calGraphicData(qa)}catch(qS){console.warn("parse animation fail:"+qa.name+",empty animation created"),this._gList=[]}var qR=qS;return qR.interval=1e3/qa.frameRate,qR.frames=this._gList,qR.labels=this._labels,qR.name=qa.name,qR},qS.setUpAniData=function(qS){if(qS.animations){var q_,qa={},qR=[],qJ=qS.animations,qV=0,qW=qJ.length;for(qV=0;qV<qW;qV++)if(q_=qJ[qV]){var qk={};qk.name=q_.name,qk.aniO=q_,qk.nodeRoot=qS,qR.push(qk),qa[q_.name]=qk}this.animationList=qR,this.animationDic=qa}},qS._clear=function(){var qS,q_;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(qS in this._nodeGDic)(q_=this._nodeGDic[qS])&&q_.recover();this._nodeGDic=null},qI.parseAnimationByData=function(qS){var q_;return qI._I||(qI._I=new qI),q_=qI._I.parseByData(qS),qI._I._clear(),q_},qI.parseAnimationData=function(qS){var q_;return qI._I||(qI._I=new qI),qI._I.setUpAniData(qS),(q_={}).animationList=qI._I.animationList,q_.animationDic=qI._I.animationDic,qI._I._clear(),q_},qI._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],qI._temParam=[],qI._I=null,qI._rootMatrix=null,qz(qI,["_tempMt",function(){return this._tempMt=new qX}]),qI.__init$=function(){qB=function(){function qS(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return qo(qS,""),qS.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),qp.recover("GraphicNode",this)},qS.create=function(){return qp.getItemByClass("GraphicNode",qS)},qS}()},qI}(qjS));qq.__init([qb,qzS,qK,qg,qy,ql,qS,qqS])}(window,document,Laya),function(qS,q_,qa){qa.un,qa.uns,qa.static;var qR=qa.class;qa.getset,qa.__newvec;new(function(){function qS(){}return qR(qS,"LayaMain"),qS}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}}),function(qS,q_,qm){qm.un,qm.uns;var qW=qm.static,qC=qm.class,qR=qm.getset,qV=qm.__newvec,qH=laya.maths.Arith,qL=laya.maths.Bezier,qa=laya.resource.Bitmap,qG=laya.utils.Browser,qz=laya.utils.Byte,qt=laya.utils.Color,qq=(laya.filters.ColorFilter,qm.Config),qJ=laya.resource.Context,qN=(laya.events.Event,laya.filters.Filter),qk=laya.display.Graphics,qb=laya.resource.HTMLCanvas,qo=(laya.utils.HTMLChar,laya.resource.HTMLImage),q$=laya.resource.HTMLSubImage,qn=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),ql=laya.maths.Point,qB=laya.maths.Rectangle,qF=laya.renders.Render,qT=(laya.renders.RenderContext,laya.renders.RenderSprite),qD=laya.resource.Resource,qj=laya.resource.ResourceManager,qQ=laya.utils.RunDriver,qI=laya.display.Sprite,qA=laya.display.Stage,qX=laya.utils.Stat,qh=laya.utils.StringKey,qu=(laya.display.css.Style,laya.system.System),qK=laya.display.Text,qP=laya.resource.Texture,qM=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),qr=laya.utils.VectorGraphManager;laya.utils.WordText;qm.interface("laya.webgl.shapes.IShape"),qm.interface("laya.webgl.submit.ISubmit"),qm.interface("laya.webgl.text.ICharSegment"),qm.interface("laya.webgl.canvas.save.ISaveData"),qm.interface("laya.webgl.resource.IMergeAtlasBitmap"),qm.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var qe=function(){function qS(){}qC(qS,"laya.filters.webgl.FilterActionGL");var q_=qS.prototype;return qm.imps(q_,{"laya.filters.IFilterActionGL":!0}),q_.setValue=function(qS){},q_.setValueMix=function(qS){},q_.apply3d=function(qS,q_,qa,qR,qJ){return null},q_.apply=function(qS){return null},qR(0,q_,"typeMix",function(){return 0}),qS}(),qg=function(){function qS(){}return qC(qS,"laya.webgl.shader.ShaderValue"),qS}(),qx=function(){var qR,qJ;function qS(qS,q_,qa){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new qJ,void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),this._cells=null,this._rowInfo=null,this._init(qS,q_),this._atlasID=qa}qC(qS,"laya.webgl.atlas.AtlasGrid");var q_=qS.prototype;return q_.getAltasID=function(){return this._atlasID},q_.setAltasID=function(qS){0<=qS&&(this._atlasID=qS)},q_.addTex=function(qS,q_,qa){var qR=this._get(q_,qa);return 0==qR.ret||(this._fill(qR.x,qR.y,q_,qa,qS),this._texCount++),qR},q_._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},q_._init=function(qS,q_){if(this._width=qS,this._height=q_,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=qV(this._height);for(var qa=0;qa<this._height;qa++)this._rowInfo[qa]=new qR;return this._clear(),!0},q_._get=function(qS,q_){var qa=new qU;if(qS>=this._failSize.width&&q_>=this._failSize.height)return qa;for(var qR=-1,qJ=-1,qV=this._width,qW=this._height,qk=this._cells,qz=0;qz<qW;qz++)if(!(this._rowInfo[qz].spaceCount<qS))for(var qb=0;qb<qV;){var qH=3*(qz*qV+qb);if(0!=qk[qH]||qk[1+qH]<qS||qk[2+qH]<q_)qb+=qk[1+qH];else{qR=qb,qJ=qz;for(var qL=0;qL<qS;qL++)if(qk[3*qL+qH+2]<q_){qR=-1;break}if(!(qR<0))return qa.ret=!0,qa.x=qR,qa.y=qJ,qa;qb+=qk[1+qH]}}return qa},q_._fill=function(qS,q_,qa,qR,qJ){var qV=this._width,qW=this._height;this._check(qS+qa<=qV&&q_+qR<=qW);for(var qk=q_;qk<qR+q_;++qk){this._check(this._rowInfo[qk].spaceCount>=qa),this._rowInfo[qk].spaceCount-=qa;for(var qz=0;qz<qa;qz++){var qb=3*(qS+qk*qV+qz);this._check(0==this._cells[qb]),this._cells[qb]=qJ,this._cells[1+qb]=qa,this._cells[2+qb]=qR}}if(0<qS)for(qk=0;qk<qR;++qk){var qH=0;for(qz=qS-1;0<=qz&&0==this._cells[3*((q_+qk)*qV+qz)];--qz,++qH);for(qz=qH;0<qz;--qz)this._cells[3*((q_+qk)*qV+qS-qz)+1]=qz,this._check(0<qz)}if(0<q_)for(qz=qS;qz<qS+qa;++qz){for(qH=0,qk=q_-1;0<=qk&&0==this._cells[3*(qz+qk*qV)];--qk,qH++);for(qk=qH;0<qk;--qk)this._cells[3*(qz+(q_-qk)*qV)+2]=qk,this._check(0<qk)}},q_._check=function(qS){0==qS&&console.log("xtexMerger 错误啦")},q_._clear=function(){for(var qS=this._texCount=0;qS<this._height;qS++)this._rowInfo[qS].spaceCount=this._width;for(var q_=0;q_<this._height;q_++)for(var qa=0;qa<this._width;qa++){var qR=3*(q_*this._width+qa);this._cells[qR]=0,this._cells[1+qR]=this._width-qa,this._cells[2+qR]=this._width-q_}this._failSize.width=this._width+1,this._failSize.height=this._height+1},qS.__init$=function(){qR=function(){function qS(){this.spaceCount=0}return qC(qS,""),qS}(),qJ=function(){function qS(){this.width=0,this.height=0}return qC(qS,""),qS}()},qS}(),qs=function(){function qF(qS,q_,qa,qR){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=qS,this._height=q_,this._gridSize=qa,this._maxAtlaserCount=qR,this._gridNumX=qS/qa,this._gridNumY=q_/qa,this._curAtlasIndex=0,this._atlaserArray=[]}qC(qF,"laya.webgl.atlas.AtlasResourceManager");var qS=qF.prototype;return qS.setAtlasParam=function(qS,q_,qa,qR){if(1==this._setAtlasParam)return qF._sid_=0,this._width=qS,this._height=q_,this._gridSize=qa,this._maxAtlaserCount=qR,this._gridNumX=qS/qa,this._gridNumY=q_/qa,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},qS.pushData=function(qS){var q_,qa=qS.bitmap,qR=-1,qJ=null,qV=0,qW=0;for(qV=0,q_=this._atlaserArray.length;qV<q_&&(qW=(this._curAtlasIndex+qV)%q_,-1==(qR=(qJ=this._atlaserArray[qW]).findBitmapIsExist(qa)));qV++);if(-1!=qR){var qk=qJ.InAtlasWebGLImagesOffsetValue[qR];return qt=qk[0],qo=qk[1],qJ.addToAtlas(qS,qt,qo),!0}this._setAtlasParam=!1;for(var qz=Math.ceil((qS.bitmap.width+2)/this._gridSize),qb=Math.ceil((qS.bitmap.height+2)/this._gridSize),qH=!1,qL=0;qL<2;qL++){var qC=this._maxAtlaserCount;for(qV=0;qV<qC;qV++){qW=(this._curAtlasIndex+qV)%qC,this._atlaserArray.length-1>=qW||this._atlaserArray.push(new qBS(this._gridNumX,this._gridNumY,this._width,this._height,qF._sid_++));var qG=this._atlaserArray[qW],qt=0,qo=0,q$=qG.addTex(1,qz,qb);if(q$.ret){qt=q$.x*this._gridSize+1,qo=q$.y*this._gridSize+1,qa.lock=!0,qG.addToAtlasTexture(qa,qt,qo),qG.addToAtlas(qS,qt,qo),qH=!0,this._curAtlasIndex=qW;break}}if(qH)break;this._atlaserArray.push(new qBS(this._gridNumX,this._gridNumY,this._width,this._height,qF._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return qH||console.log(">>>AtlasManager pushData error"),qH},qS.addToAtlas=function(qS){laya.webgl.atlas.AtlasResourceManager.instance.pushData(qS)},qS.garbageCollection=function(){if(!0===this._needGC){for(var qS=this._atlaserArray.length-this._maxAtlaserCount,q_=0;q_<qS;q_++)this._atlaserArray[q_].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+qS),this._atlaserArray.splice(0,qS),this._needGC=!1}return!0},qS.freeAll=function(){for(var qS=0,q_=this._atlaserArray.length;qS<q_;qS++)this._atlaserArray[qS].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},qS.getAtlaserCount=function(){return this._atlaserArray.length},qS.getAtlaserByIndex=function(qS){return this._atlaserArray[qS]},qR(1,qF,"instance",function(){return qF._Instance||(qF._Instance=new qF(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),qF._Instance}),qR(1,qF,"enabled",function(){return qq.atlasEnable}),qR(1,qF,"atlasLimitWidth",function(){return qF._atlasLimitWidth},function(qS){qF._atlasLimitWidth=qS}),qR(1,qF,"atlasLimitHeight",function(){return qF._atlasLimitHeight},function(qS){qF._atlasLimitHeight=qS}),qF._enable=function(){qq.atlasEnable=!0},qF._disable=function(){qq.atlasEnable=!1},qF.__init__=function(){qF.atlasTextureWidth=2048,qF.atlasTextureHeight=2048,qF.maxTextureCount=6,qF.atlasLimitWidth=512,qF.atlasLimitHeight=512},qF._atlasLimitWidth=0,qF._atlasLimitHeight=0,qF.gridSize=16,qF.atlasTextureWidth=0,qF.atlasTextureHeight=0,qF.maxTextureCount=0,qF._atlasRestore=0,qF.BOARDER_TYPE_NO=0,qF.BOARDER_TYPE_RIGHT=1,qF.BOARDER_TYPE_LEFT=2,qF.BOARDER_TYPE_BOTTOM=4,qF.BOARDER_TYPE_TOP=8,qF.BOARDER_TYPE_ALL=15,qF._sid_=0,qF._Instance=null,qF}(),qU=function(){function qS(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return qC(qS,"laya.webgl.atlas.MergeFillInfo"),qS}(),qf=function(){function q_(){}return qC(q_,"laya.webgl.canvas.BlendMode"),q_._init_=function(qS){q_.fns=[q_.BlendNormal,q_.BlendAdd,q_.BlendMultiply,q_.BlendScreen,q_.BlendOverlay,q_.BlendLight,q_.BlendMask,q_.BlendDestinationOut],q_.targetFns=[q_.BlendNormalTarget,q_.BlendAddTarget,q_.BlendMultiplyTarget,q_.BlendScreenTarget,q_.BlendOverlayTarget,q_.BlendLightTarget,q_.BlendMask,q_.BlendDestinationOut]},q_.BlendNormal=function(qS){qS.blendFunc(1,771)},q_.BlendAdd=function(qS){qS.blendFunc(1,772)},q_.BlendMultiply=function(qS){qS.blendFunc(774,771)},q_.BlendScreen=function(qS){qS.blendFunc(1,1)},q_.BlendOverlay=function(qS){qS.blendFunc(1,769)},q_.BlendLight=function(qS){qS.blendFunc(1,1)},q_.BlendNormalTarget=function(qS){qS.blendFunc(1,771)},q_.BlendAddTarget=function(qS){qS.blendFunc(1,772)},q_.BlendMultiplyTarget=function(qS){qS.blendFunc(774,771)},q_.BlendScreenTarget=function(qS){qS.blendFunc(1,1)},q_.BlendOverlayTarget=function(qS){qS.blendFunc(1,769)},q_.BlendLightTarget=function(qS){qS.blendFunc(1,1)},q_.BlendMask=function(qS){qS.blendFunc(0,770)},q_.BlendDestinationOut=function(qS){qS.blendFunc(0,0)},q_.activeBlendFunction=null,q_.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],q_.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},q_.NORMAL="normal",q_.ADD="add",q_.MULTIPLY="multiply",q_.SCREEN="screen",q_.LIGHT="light",q_.OVERLAY="overlay",q_.DESTINATIONOUT="destination-out",q_.fns=[],q_.targetFns=[],q_}(),qY=function(){function qa(qS){this._color=qt.create("black"),this.setValue(qS)}qC(qa,"laya.webgl.canvas.DrawStyle");var qS=qa.prototype;return qS.setValue=function(qS){if(qS){if("string"==typeof qS)return void(this._color=qt.create(qS));if(qS instanceof laya.utils.Color)return void(this._color=qS)}},qS.reset=function(){this._color=qt.create("black")},qS.equal=function(qS){return"string"==typeof qS?this._color.strColor===qS:qS instanceof laya.utils.Color&&this._color.numColor===qS.numColor},qS.toColorStr=function(){return this._color.strColor},qa.create=function(qS){var q_;if(qS&&("string"==typeof qS?q_=qt.create(qS):qS instanceof laya.utils.Color&&(q_=qS),q_))return q_._drawStyle||(q_._drawStyle=new qa(qS));return laya.webgl.canvas.DrawStyle.DEFAULT},qW(qa,["DEFAULT",function(){return this.DEFAULT=new qa("#000000")}]),qa}(),qi=function(){function qS(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];qjS.mainContext;this.ib=qvS.create(35048),this.vb=qdS.create(5)}qC(qS,"laya.webgl.canvas.Path");var q_=qS.prototype;return q_.addPoint=function(qS,q_){this.tempArray.push(qS,q_)},q_.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},q_.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},q_.polygon=function(qS,q_,qa,qR,qJ,qV){var qW;return this.geomatrys.push(this._curGeomatry=qW=new qhS(qS,q_,qa,qR,qJ,qV)),qR||(qW.fill=!1),null==qV&&(qW.borderWidth=0),qW},q_.setGeomtry=function(qS){this.geomatrys.push(this._curGeomatry=qS)},q_.drawLine=function(qS,q_,qa,qR,qJ){var qV;return this.closePath?this.geomatrys.push(this._curGeomatry=qV=new qXS(qS,q_,qa,qR,qJ)):this.geomatrys.push(this._curGeomatry=qV=new qAS(qS,q_,qa,qR,qJ)),qV.fill=!1,qV},q_.update=function(){var qS=this.ib._byteLength,q_=this.geomatrys.length;this.offset=qS;for(var qa=this.geoStart;qa<q_;qa++)this.geomatrys[qa].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=q_,this.count=(this.ib._byteLength-qS)/qoS.BYTES_PIDX},q_.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},q_.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},qS}(),qZ=function(){function qk(){}qC(qk,"laya.webgl.canvas.save.SaveBase");var qS=qk.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!1},qS.restore=function(qS){this._dataObj[this._valueName]=this._value,(qk._cache[qk._cache._length++]=this)._newSubmit&&(qS._curSubmit=qVS.RENDERBASE,qS._renderKey=0)},qk._createArray=function(){var qS=[];return qS._length=0,qS},qk._init=function(){var qS=qk._namemap={};return qS[1]="ALPHA",qS[2]="fillStyle",qS[8]="font",qS[256]="lineWidth",qS[512]="strokeStyle",qS[8192]="_mergeID",qS[1024]=qS[2048]=qS[4096]=[],qS[16384]="textBaseline",qS[32768]="textAlign",qS[65536]="_nBlendType",qS[1048576]="shader",qS[2097152]="filters",qS},qk.save=function(qS,q_,qa,qR){if((qS._saveMark._saveuse&q_)!==q_){qS._saveMark._saveuse|=q_;var qJ=qk._cache,qV=0<qJ._length?qJ[--qJ._length]:new qk;qV._value=qa[qV._valueName=qk._namemap[q_]],qV._dataObj=qa,qV._newSubmit=qR;var qW=qS._save;qW[qW._length++]=qV}},qk._cache=laya.webgl.canvas.save.SaveBase._createArray(),qk._namemap=qk._init(),qk}(),qp=function(){function qV(){this._clipRect=new qB}qC(qV,"laya.webgl.canvas.save.SaveClipRect");var qS=qV.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!1},qS.restore=function(qS){qS._clipRect=this._clipSaveRect,(qV._cache[qV._cache._length++]=this)._submitScissor.submitLength=qS._submits._length-this._submitScissor.submitIndex,qS._curSubmit=qVS.RENDERBASE,qS._renderKey=0},qV.save=function(qS,q_){if(131072!=(131072&qS._saveMark._saveuse)){qS._saveMark._saveuse|=131072;var qa=qV._cache,qR=0<qa._length?qa[--qa._length]:new qV;qR._clipSaveRect=qS._clipRect,qS._clipRect=qR._clipRect.copyFrom(qS._clipRect),qR._submitScissor=q_;var qJ=qS._save;qJ[qJ._length++]=qR}},qW(qV,["_cache",function(){return this._cache=qZ._createArray()}]),qV}(),qc=function(){function qG(){this._contextX=0,this._contextY=0,this._clipRect=new qB,this._rect=new qB,this._matrix=new qn}qC(qG,"laya.webgl.canvas.save.SaveClipRectStencil");var qS=qG.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!1},qS.restore=function(qS){qHS.restore(qS,this._rect,this._saveMatrix,this._contextX,this._contextY),qS._clipRect=this._clipSaveRect,qS._curMat=this._saveMatrix,qS._x=this._contextX,qS._y=this._contextY,qG._cache[qG._cache._length++]=this,qS._curSubmit=qVS.RENDERBASE},qG.save=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){if(262144!=(262144&qS._saveMark._saveuse)){qS._saveMark._saveuse|=262144;var qH=qG._cache,qL=0<qH._length?qH[--qH._length]:new qG;qL._clipSaveRect=qS._clipRect,qL._clipRect.setTo(qW,qk,qz,qb),qS._clipRect=qL._clipRect,qL._rect.x=qa,qL._rect.y=qR,qL._rect.width=qJ,qL._rect.height=qV,qL._contextX=qS._x,qL._contextY=qS._y,qL._saveMatrix=qS._curMat,qS._curMat.copyTo(qL._matrix),qS._curMat=qL._matrix,qL._submitStencil=q_;var qC=qS._save;qC[qC._length++]=qL}},qW(qG,["_cache",function(){return this._cache=qZ._createArray()}]),qG}(),qy=function(){function qR(){this._saveuse=0}qC(qR,"laya.webgl.canvas.save.SaveMark");var qS=qR.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!0},qS.restore=function(qS){qS._saveMark=this._preSaveMark,qR._no[qR._no._length++]=this},qR.Create=function(qS){var q_=qR._no,qa=0<q_._length?q_[--q_._length]:new qR;return qa._saveuse=0,qa._preSaveMark=qS._saveMark,qS._saveMark=qa},qW(qR,["_no",function(){return this._no=qZ._createArray()}]),qR}(),qE=function(){function qV(){this._matrix=new qn}qC(qV,"laya.webgl.canvas.save.SaveTransform");var qS=qV.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!1},qS.restore=function(qS){qS._curMat=this._savematrix,qV._no[qV._no._length++]=this},qV.save=function(qS){var q_=qS._saveMark;if(2048!=(2048&q_._saveuse)){q_._saveuse|=2048;var qa=qV._no,qR=0<qa._length?qa[--qa._length]:new qV;qR._savematrix=qS._curMat,qS._curMat=qS._curMat.copyTo(qR._matrix);var qJ=qS._save;qJ[qJ._length++]=qR}},qW(qV,["_no",function(){return this._no=qZ._createArray()}]),qV}(),qO=function(){function qJ(){}qC(qJ,"laya.webgl.canvas.save.SaveTranslate");var qS=qJ.prototype;return qm.imps(qS,{"laya.webgl.canvas.save.ISaveData":!0}),qS.isSaveMark=function(){return!1},qS.restore=function(qS){qS._curMat;qS._x=this._x,qS._y=this._y,qJ._no[qJ._no._length++]=this},qJ.save=function(qS){var q_=qJ._no,qa=0<q_._length?q_[--q_._length]:new qJ;qa._x=qS._x,qa._y=qS._y;var qR=qS._save;qR[qR._length++]=qa},qW(qJ,["_no",function(){return this._no=qZ._createArray()}]),qJ}(),qw=function(){function qS(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new qB}qC(qS,"laya.webgl.resource.RenderTargetMAX");var q_=qS.prototype;return q_.setSP=function(qS){this._sp=qS},q_.size=function(qS,q_){var qa=this;this._width!==qS||this._height!==q_?(this.repaint=!0,this._width=qS,this._height=q_,this.target?this.target.size(qS,q_):this.target=qrS.create(qS,q_),this.target.hasListener("recovered")||this.target.on("recovered",this,function(qS){qm.timer.callLater(qa._sp,qa._sp.repaint)})):this.target.size(qS,q_)},q_._flushToTarget=function(qS,q_){if(!q_._destroy){var qa=qTS.worldScissorTest,qR=qTS.worldClipRect;qTS.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,qTS.worldScissorTest=!1,qjS.mainContext.disable(3089);var qJ=qTS.worldAlpha,qV=qTS.worldMatrix4,qW=qTS.worldMatrix,qk=qTS.worldFilters,qz=qTS.worldShaderDefines;if(qTS.worldMatrix=qn.EMPTY,qTS.restoreTempArray(),qTS.worldMatrix4=qTS.TEMPMAT4_ARRAY,qTS.worldAlpha=1,qTS.worldFilters=null,qTS.worldShaderDefines=null,qMS.activeShader=null,q_.start(),qq.showCanvasMark?q_.clear(0,1,0,.3):q_.clear(0,0,0,0),qS.flush(),q_.end(),qMS.activeShader=null,qTS.worldAlpha=qJ,qTS.worldMatrix4=qV,qTS.worldMatrix=qW,qTS.worldFilters=qk,qTS.worldShaderDefines=qz,qTS.worldScissorTest=qa){var qb=qTS.height-qR.y-qR.height;qjS.mainContext.scissor(qR.x,qb,qR.width,qR.height),qjS.mainContext.enable(3089)}qTS.worldClipRect=qR}},q_.flush=function(qS){this.repaint&&(this._flushToTarget(qS,this.target),this.repaint=!1)},q_.drawTo=function(qS,q_,qa,qR,qJ){qS.drawTexture(this.target.getTexture(),q_,qa,qR,qJ,0,0)},q_.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},qS}(),qv=function(){function qS(){this.ALPHA=1,this.shaderType=0,this.defines=new qIS}return qC(qS,"laya.webgl.shader.d2.Shader2D"),qS.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},qS.__init__=function(){var qS,q_;qyS.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),qyS.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),qyS.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),qyS.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),qyS.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),qyS.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),qyS.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),qyS.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),qS="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",q_='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',qyS.preCompile2D(0,1,qS,q_,null),qS="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",q_='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',qyS.preCompile2D(0,2,qS,q_,null),qS="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",q_="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",qyS.preCompile2D(0,4,qS,q_,null),qS="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",q_='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',qyS.preCompile2D(0,256,qS,q_,null),qS="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",q_="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",qyS.preCompile2D(0,512,qS,q_,null)},qS}(),qd=function(){function q_(qS,q_,qa){this._value=0,this._name2int=qS,this._int2name=q_,this._int2nameMap=qa}qC(q_,"laya.webgl.shader.ShaderDefines");var qS=q_.prototype;return qS.add=function(qS){return"string"==typeof qS&&(qS=this._name2int[qS]),this._value|=qS,this._value},qS.addInt=function(qS){return this._value|=qS,this._value},qS.remove=function(qS){return"string"==typeof qS&&(qS=this._name2int[qS]),this._value&=~qS,this._value},qS.isDefine=function(qS){return(this._value&qS)===qS},qS.getValue=function(){return this._value},qS.setValue=function(qS){this._value=qS},qS.toNameDic=function(){var qS=this._int2nameMap[this._value];return qS||q_._toText(this._value,this._int2name,this._int2nameMap)},q_._reg=function(qS,q_,qa,qR){qR[qa[qS]=q_]=qS},q_._toText=function(qS,q_,qa){var qR=qa[qS];if(qR)return qR;for(var qJ={},qV=1,qW=0;qW<32&&!(qS<(qV=1<<qW));qW++)if(qS&qV){var qk=q_[qV];qk&&(qJ[qk]="")}return qa[qS]=qJ},q_._toInt=function(qS,q_){for(var qa=qS.split("."),qR=0,qJ=0,qV=qa.length;qJ<qV;qJ++){var qW=q_[qa[qJ]];if(!qW)throw new Error("Defines to int err:"+qS+"/"+qa[qJ]);qR|=qW}return qR},q_}(),qSS=function(){function qW(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new qn}qC(qW,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var qS=qW.prototype;return qS.init=function(qS,q_,qa){if(q_)this._vs=q_;else{this._vs=[];var qR=qS.width,qJ=qS.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(qR,0,1,0,1,1,1,1),this._vs.push(qR,qJ,1,1,1,1,1,1),this._vs.push(0,qJ,0,1,1,1,1,1)}qa?this._ps=qa:(qW._defaultPS||(qW._defaultPS=[]).push(0,1,3,3,1,2),this._ps=qW._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=qS},qS.init2=function(qS,q_,qa,qR,qJ){this.transform&&(this.transform=null),qa?this._ps=qa:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=qR,this._uvs=qJ,this.mEleNum=this._ps.length,this.mTexture=qS,(qF.isConchNode||qF.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},qS._initMyData=function(){var qS=0,q_=0,qa=4*this._verticles.length;this._vs=qW._tempVS;var qR=!1;if(qF.isConchNode||qF.isConchApp?(this._vs.length=qa,qR=!0):this._vs.length<qa&&(this._vs.length=qa,qR=!0),qW._tVSLen=qa,qR)for(;qS<qa;)this._vs[qS]=this._verticles[q_],this._vs[qS+1]=this._verticles[q_+1],this._vs[qS+2]=this._uvs[q_],this._vs[qS+3]=this._uvs[q_+1],this._vs[qS+4]=1,this._vs[qS+5]=1,this._vs[qS+6]=1,this._vs[qS+7]=1,qS+=8,q_+=2;else for(;qS<qa;)this._vs[qS]=this._verticles[q_],this._vs[qS+1]=this._verticles[q_+1],this._vs[qS+2]=this._uvs[q_],this._vs[qS+3]=this._uvs[q_+1],qS+=8,q_+=2},qS.getData2=function(qS,q_,qa){var qR;this.mVBBuffer=qS,this.mIBBuffer=q_,this._initMyData(),qS.appendEx2(this._vs,Float32Array,qW._tVSLen,4),this._indexStart=q_._byteLength,(qR=qW._tempIB).length<this._ps.length&&(qR.length=this._ps.length);for(var qJ=0,qV=this._ps.length;qJ<qV;qJ++)qR[qJ]=this._ps[qJ]+qa;q_.appendEx2(qR,Uint16Array,this._ps.length,2)},qS.getData=function(qS,q_,qa){if(this.mVBBuffer=qS,this.mIBBuffer=q_,qS.append(this.mVBData),this._indexStart=q_._byteLength,this.mIBData.start!=qa){for(var qR=0,qJ=this._ps.length;qR<qJ;qR++)this.mIBData[qR]=this._ps[qR]+qa;this.mIBData.start=qa}q_.append(this.mIBData)},qS.render=function(qS,q_,qa){if(qF.isWebGL&&this.mTexture){qS._renderKey=0,qS._shader2D.glTexture=null,q_S.getInstance().addSkinMesh(this);var qR=qVS.createShape(qS,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,qNS.create(512,0));this.transform||(this.transform=qn.EMPTY),this.transform.translate(q_,qa),qn.mul(this.transform,qS._curMat,this._tempMatrix),this.transform.translate(-q_,-qa);var qJ=qR.shaderValue,qV=qJ.u_mmat2||qTS.getMatrArray();qTS.mat2MatArray(this._tempMatrix,qV),qJ.textureHost=this.mTexture,qJ.offsetX=0,qJ.offsetY=0,qJ.u_mmat2=qV,qJ.ALPHA=qS._shader2D.ALPHA,qS._submits[qS._submits._length++]=qR}else qF.isConchApp&&this.mTexture&&(this.transform||(this.transform=qn.EMPTY),qS.setSkinMesh&&qS.setSkinMesh(q_,qa,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},qW._tempVS=[],qW._tempIB=[],qW._defaultPS=null,qW._tVSLen=0,qW}(),q_S=function(){function qS(){this.ib=null,this.vb=null;qjS.mainContext;this.ib=qvS.create(35048),this.vb=qdS.create(8)}qC(qS,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var q_=qS.prototype;return q_.addSkinMesh=function(qS){qS.getData2(this.vb,this.ib,this.vb._byteLength/32)},q_.reset=function(){this.vb.clear(),this.ib.clear()},qS.getInstance=function(){return qS.instance=qS.instance||new qS},qS.instance=null,qS}(),qaS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk,qz){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===qz&&(qz=0),this.x=qS,this.y=q_,this.width=qa,this.height=qR,this.edges=qJ,this.color=qV,this.borderWidth=qW,this.borderColor=qk}qC(qS,"laya.webgl.shapes.BasePoly");var q_=qS.prototype;return qm.imps(q_,{"laya.webgl.shapes.IShape":!0}),q_.getData=function(qS,q_,qa){},q_.rebuild=function(qS){},q_.setMatrix=function(qS){},q_.needUpdate=function(qS){return!0},q_.sector=function(qS,q_,qa){var qR=this.x,qJ=this.y,qV=this.edges,qW=(this.r1-this.r0)/qV,qk=this.width,qz=this.height,qb=this.color,qH=(qb>>16&255)/255,qL=(qb>>8&255)/255,qC=(255&qb)/255;qS.push(qR,qJ,qH,qL,qC);for(var qG=0;qG<qV+1;qG++)qS.push(qR+Math.sin(qW*qG+this.r0)*qk,qJ+Math.cos(qW*qG+this.r0)*qz),qS.push(qH,qL,qC);for(qG=0;qG<qV;qG++)q_.push(qa,qa+qG+1,qa+qG+2)},q_.createLine2=function(qS,q_,qa,qR,qJ,qV){var qW,qk,qz,qb,qH,qL,qC,qG,qt,qo,q$,qF,qT,qD,qj,qQ,qm,qq,qN,qn,ql=qS.concat(),qB=qJ,qI=this.borderColor,qA=(qI>>16&255)/255,qX=(qI>>8&255)/255,qh=(255&qI)/255,qu=ql.length/2,qK=qR,qP=qa/2;qz=ql[0],qb=ql[1],qo=qz-(qH=ql[2]),qt=(qt=-(qb-(qL=ql[3])))/(qn=Math.sqrt(qt*qt+qo*qo))*qP,qo=qo/qn*qP,qB.push(qz-qt+this.x,qb-qo+this.y,qA,qX,qh,qz+qt+this.x,qb+qo+this.y,qA,qX,qh);for(var qM=1;qM<qu-1;qM++)qz=ql[2*(qM-1)],qb=ql[2*(qM-1)+1],qH=ql[2*qM],qL=ql[2*qM+1],qC=ql[2*(qM+1)],qG=ql[2*(qM+1)+1],qo=qz-qH,qF=qH-qC,qj=(-(qt=(qt=-(qb-qL))/(qn=Math.sqrt(qt*qt+qo*qo))*qP)+qz)*(-(qo=qo/qn*qP)+qL)-(-qt+qH)*(-qo+qb),qq=(-(q$=(q$=-(qL-qG))/(qn=Math.sqrt(q$*q$+qF*qF))*qP)+qC)*(-(qF=qF/qn*qP)+qL)-(-q$+qH)*(-qF+qG),qN=(qT=-qo+qb-(-qo+qL))*(qm=-q$+qH-(-q$+qC))-(qQ=-qF+qG-(-qF+qL))*(qD=-qt+qH-(-qt+qz)),Math.abs(qN)<.1?(qN+=10.1,qB.push(qH-qt+this.x,qL-qo+this.y,qA,qX,qh,qH+qt+this.x,qL+qo+this.y,qA,qX,qh)):(((qW=(qD*qq-qm*qj)/qN)-qH)*(qW-qH)+((qk=(qQ*qj-qT*qq)/qN)-qL)+(qk-qL),qB.push(qW+this.x,qk+this.y,qA,qX,qh,qH-(qW-qH)+this.x,qL-(qk-qL)+this.y,qA,qX,qh));qz=ql[ql.length-4],qb=ql[ql.length-3],qo=qz-(qH=ql[ql.length-2]),qt=(qt=-(qb-(qL=ql[ql.length-1])))/(qn=Math.sqrt(qt*qt+qo*qo))*qP,qo=qo/qn*qP,qB.push(qH-qt+this.x,qL-qo+this.y,qA,qX,qh,qH+qt+this.x,qL+qo+this.y,qA,qX,qh);var qr=qV;for(qM=1;qM<qr;qM++)q_.push(qK+2*(qM-1),qK+2*(qM-1)+1,qK+2*qM+1,qK+2*qM+1,qK+2*qM,qK+2*(qM-1));return qB},q_.createLine=function(qS,q_,qa,qR){var qJ=qS.concat(),qV=qS,qW=this.borderColor,qk=(qW>>16&255)/255,qz=(qW>>8&255)/255,qb=(255&qW)/255;qJ.splice(0,5);var qH,qL,qC,qG,qt,qo,q$,qF,qT,qD,qj,qQ,qm,qq,qN,qn,ql,qB,qI,qA,qX=qJ.length/5,qh=qR,qu=qa/2;qC=qJ[0],qG=qJ[1],qD=qC-(qt=qJ[5]),qT=(qT=-(qG-(qo=qJ[6])))/(qA=Math.sqrt(qT*qT+qD*qD))*qu,qD=qD/qA*qu,qV.push(qC-qT,qG-qD,qk,qz,qb,qC+qT,qG+qD,qk,qz,qb);for(var qK=1;qK<qX-1;qK++)qC=qJ[5*(qK-1)],qG=qJ[5*(qK-1)+1],qt=qJ[5*qK],qo=qJ[5*qK+1],q$=qJ[5*(qK+1)],qF=qJ[5*(qK+1)+1],qD=qC-qt,qQ=qt-q$,qN=(-(qT=(qT=-(qG-qo))/(qA=Math.sqrt(qT*qT+qD*qD))*qu)+qC)*(-(qD=qD/qA*qu)+qo)-(-qT+qt)*(-qD+qG),qB=(-(qj=(qj=-(qo-qF))/(qA=Math.sqrt(qj*qj+qQ*qQ))*qu)+q$)*(-(qQ=qQ/qA*qu)+qo)-(-qj+qt)*(-qQ+qF),qI=(qm=-qD+qG-(-qD+qo))*(ql=-qj+qt-(-qj+q$))-(qn=-qQ+qF-(-qQ+qo))*(qq=-qT+qt-(-qT+qC)),Math.abs(qI)<.1?(qI+=10.1,qV.push(qt-qT,qo-qD,qk,qz,qb,qt+qT,qo+qD,qk,qz,qb)):(((qH=(qq*qB-ql*qN)/qI)-qt)*(qH-qt)+((qL=(qn*qN-qm*qB)/qI)-qo)+(qL-qo),qV.push(qH,qL,qk,qz,qb,qt-(qH-qt),qo-(qL-qo),qk,qz,qb));qC=qJ[qJ.length-10],qG=qJ[qJ.length-9],qD=qC-(qt=qJ[qJ.length-5]),qT=(qT=-(qG-(qo=qJ[qJ.length-4])))/(qA=Math.sqrt(qT*qT+qD*qD))*qu,qD=qD/qA*qu,qV.push(qt-qT,qo-qD,qk,qz,qb,qt+qT,qo+qD,qk,qz,qb);var qP=this.edges+1;for(qK=1;qK<qP;qK++)q_.push(qh+2*(qK-1),qh+2*(qK-1)+1,qh+2*qK+1,qh+2*qK+1,qh+2*qK,qh+2*(qK-1));return qV},q_.createLoopLine=function(qS,q_,qa,qR,qJ,qV){var qW=qS.concat(),qk=qJ||qS,qz=this.borderColor,qb=(qz>>16&255)/255,qH=(qz>>8&255)/255,qL=(255&qz)/255;qW.splice(0,5);var qC=[qW[0],qW[1]],qG=[qW[qW.length-5],qW[qW.length-4]],qt=qG[0]+.5*(qC[0]-qG[0]),qo=qG[1]+.5*(qC[1]-qG[1]);qW.unshift(qt,qo,0,0,0),qW.push(qt,qo,0,0,0);var q$,qF,qT,qD,qj,qQ,qm,qq,qN,qn,ql,qB,qI,qA,qX,qh,qu,qK,qP,qM,qr=qW.length/5,qe=qR,qg=qa/2;qT=qW[0],qD=qW[1],qn=qT-(qj=qW[5]),qN=(qN=-(qD-(qQ=qW[6])))/(qM=Math.sqrt(qN*qN+qn*qn))*qg,qn=qn/qM*qg,qk.push(qT-qN,qD-qn,qb,qH,qL,qT+qN,qD+qn,qb,qH,qL);for(var qx=1;qx<qr-1;qx++)qT=qW[5*(qx-1)],qD=qW[5*(qx-1)+1],qj=qW[5*qx],qQ=qW[5*qx+1],qm=qW[5*(qx+1)],qq=qW[5*(qx+1)+1],qn=qT-qj,qB=qj-qm,qX=(-(qN=(qN=-(qD-qQ))/(qM=Math.sqrt(qN*qN+qn*qn))*qg)+qT)*(-(qn=qn/qM*qg)+qQ)-(-qN+qj)*(-qn+qD),qK=(-(ql=(ql=-(qQ-qq))/(qM=Math.sqrt(ql*ql+qB*qB))*qg)+qm)*(-(qB=qB/qM*qg)+qQ)-(-ql+qj)*(-qB+qq),qP=(qI=-qn+qD-(-qn+qQ))*(qu=-ql+qj-(-ql+qm))-(qh=-qB+qq-(-qB+qQ))*(qA=-qN+qj-(-qN+qT)),Math.abs(qP)<.1?(qP+=10.1,qk.push(qj-qN,qQ-qn,qb,qH,qL,qj+qN,qQ+qn,qb,qH,qL)):(((q$=(qA*qK-qu*qX)/qP)-qj)*(q$-qj)+((qF=(qh*qX-qI*qK)/qP)-qQ)+(qF-qQ),qk.push(q$,qF,qb,qH,qL,qj-(q$-qj),qQ-(qF-qQ),qb,qH,qL));qV&&(q_=qV);var qs=this.edges+1;for(qx=1;qx<qs;qx++)q_.push(qe+2*(qx-1),qe+2*(qx-1)+1,qe+2*qx+1,qe+2*qx+1,qe+2*qx,qe+2*(qx-1));return q_.push(qe+2*(qx-1),qe+2*(qx-1)+1,qe+1,qe+1,qe,qe+2*(qx-1)),qk},qS}(),qRS=function(){function qo(){}return qC(qo,"laya.webgl.shapes.Earcut"),qo.earcut=function(qS,q_,qa){qa=qa||2;var qR,qJ,qV,qW,qk,qz,qb,qH=q_&&q_.length,qL=qH?q_[0]*qa:qS.length,qC=qo.linkedList(qS,0,qL,qa,!0),qG=[];if(!qC)return qG;if(qH&&(qC=qo.eliminateHoles(qS,q_,qC,qa)),qS.length>80*qa){qR=qV=qS[0],qJ=qW=qS[1];for(var qt=qa;qt<qL;qt+=qa)(qk=qS[qt])<qR&&(qR=qk),(qz=qS[qt+1])<qJ&&(qJ=qz),qV<qk&&(qV=qk),qW<qz&&(qW=qz);qb=0!==(qb=Math.max(qV-qR,qW-qJ))?1/qb:0}return qo.earcutLinked(qC,qG,qa,qR,qJ,qb),qG},qo.linkedList=function(qS,q_,qa,qR,qJ){var qV,qW;if(qJ===0<qo.signedArea(qS,q_,qa,qR))for(qV=q_;qV<qa;qV+=qR)qW=qo.insertNode(qV,qS[qV],qS[qV+1],qW);else for(qV=qa-qR;q_<=qV;qV-=qR)qW=qo.insertNode(qV,qS[qV],qS[qV+1],qW);return qW&&qo.equals(qW,qW.next)&&(qo.removeNode(qW),qW=qW.next),qW},qo.filterPoints=function(qS,q_){if(!qS)return qS;q_||(q_=qS);var qa,qR=qS;do{if(qa=!1,qR.steiner||!qo.equals(qR,qR.next)&&0!==qo.area(qR.prev,qR,qR.next))qR=qR.next;else{if(qo.removeNode(qR),(qR=q_=qR.prev)===qR.next)break;qa=!0}}while(qa||qR!==q_);return q_},qo.earcutLinked=function(qS,q_,qa,qR,qJ,qV,qW){if(qS){!qW&&qV&&qo.indexCurve(qS,qR,qJ,qV);for(var qk,qz,qb=qS;qS.prev!==qS.next;)if(qk=qS.prev,qz=qS.next,qV?qo.isEarHashed(qS,qR,qJ,qV):qo.isEar(qS))q_.push(qk.i/qa),q_.push(qS.i/qa),q_.push(qz.i/qa),qo.removeNode(qS),qS=qz.next,qb=qz.next;else if((qS=qz)===qb){qW?1===qW?(qS=qo.cureLocalIntersections(qS,q_,qa),qo.earcutLinked(qS,q_,qa,qR,qJ,qV,2)):2===qW&&qo.splitEarcut(qS,q_,qa,qR,qJ,qV):qo.earcutLinked(qo.filterPoints(qS,null),q_,qa,qR,qJ,qV,1);break}}},qo.isEar=function(qS){var q_=qS.prev,qa=qS,qR=qS.next;if(0<=qo.area(q_,qa,qR))return!1;for(var qJ=qS.next.next;qJ!==qS.prev;){if(qo.pointInTriangle(q_.x,q_.y,qa.x,qa.y,qR.x,qR.y,qJ.x,qJ.y)&&0<=qo.area(qJ.prev,qJ,qJ.next))return!1;qJ=qJ.next}return!0},qo.isEarHashed=function(qS,q_,qa,qR){var qJ=qS.prev,qV=qS,qW=qS.next;if(0<=qo.area(qJ,qV,qW))return!1;for(var qk=qJ.x<qV.x?qJ.x<qW.x?qJ.x:qW.x:qV.x<qW.x?qV.x:qW.x,qz=qJ.y<qV.y?qJ.y<qW.y?qJ.y:qW.y:qV.y<qW.y?qV.y:qW.y,qb=qJ.x>qV.x?qJ.x>qW.x?qJ.x:qW.x:qV.x>qW.x?qV.x:qW.x,qH=qJ.y>qV.y?qJ.y>qW.y?qJ.y:qW.y:qV.y>qW.y?qV.y:qW.y,qL=qo.zOrder(qk,qz,q_,qa,qR),qC=qo.zOrder(qb,qH,q_,qa,qR),qG=qS.nextZ;qG&&qG.z<=qC;){if(qG!==qS.prev&&qG!==qS.next&&qo.pointInTriangle(qJ.x,qJ.y,qV.x,qV.y,qW.x,qW.y,qG.x,qG.y)&&0<=qo.area(qG.prev,qG,qG.next))return!1;qG=qG.nextZ}for(qG=qS.prevZ;qG&&qG.z>=qL;){if(qG!==qS.prev&&qG!==qS.next&&qo.pointInTriangle(qJ.x,qJ.y,qV.x,qV.y,qW.x,qW.y,qG.x,qG.y)&&0<=qo.area(qG.prev,qG,qG.next))return!1;qG=qG.prevZ}return!0},qo.cureLocalIntersections=function(qS,q_,qa){var qR=qS;do{var qJ=qR.prev,qV=qR.next.next;!qo.equals(qJ,qV)&&qo.intersects(qJ,qR,qR.next,qV)&&qo.locallyInside(qJ,qV)&&qo.locallyInside(qV,qJ)&&(q_.push(qJ.i/qa),q_.push(qR.i/qa),q_.push(qV.i/qa),qo.removeNode(qR),qo.removeNode(qR.next),qR=qS=qV),qR=qR.next}while(qR!==qS);return qR},qo.splitEarcut=function(qS,q_,qa,qR,qJ,qV){var qW=qS;do{for(var qk=qW.next.next;qk!==qW.prev;){if(qW.i!==qk.i&&qo.isValidDiagonal(qW,qk)){var qz=qo.splitPolygon(qW,qk);return qW=qo.filterPoints(qW,qW.next),qz=qo.filterPoints(qz,qz.next),qo.earcutLinked(qW,q_,qa,qR,qJ,qV),void qo.earcutLinked(qz,q_,qa,qR,qJ,qV)}qk=qk.next}qW=qW.next}while(qW!==qS)},qo.eliminateHoles=function(qS,q_,qa,qR){var qJ,qV,qW,qk,qz,qb=[];for(qJ=0,qV=q_.length;qJ<qV;qJ++)qW=q_[qJ]*qR,qk=qJ<qV-1?q_[qJ+1]*qR:qS.length,(qz=qo.linkedList(qS,qW,qk,qR,!1))===qz.next&&(qz.steiner=!0),qb.push(qo.getLeftmost(qz));for(qb.sort(qo.compareX),qJ=0;qJ<qb.length;qJ++)qo.eliminateHole(qb[qJ],qa),qa=qo.filterPoints(qa,qa.next);return qa},qo.compareX=function(qS,q_){return qS.x-q_.x},qo.eliminateHole=function(qS,q_){if(q_=qo.findHoleBridge(qS,q_)){var qa=qo.splitPolygon(q_,qS);qo.filterPoints(qa,qa.next)}},qo.findHoleBridge=function(qS,q_){var qa,qR=q_,qJ=qS.x,qV=qS.y,qW=-1/0;do{if(qV<=qR.y&&qV>=qR.next.y&&qR.next.y!==qR.y){var qk=qR.x+(qV-qR.y)*(qR.next.x-qR.x)/(qR.next.y-qR.y);if(qk<=qJ&&qW<qk){if((qW=qk)===qJ){if(qV===qR.y)return qR;if(qV===qR.next.y)return qR.next}qa=qR.x<qR.next.x?qR:qR.next}}qR=qR.next}while(qR!==q_);if(!qa)return null;if(qJ===qW)return qa.prev;var qz,qb=qa,qH=qa.x,qL=qa.y,qC=1/0;for(qR=qa.next;qR!==qb;)qJ>=qR.x&&qR.x>=qH&&qJ!==qR.x&&qo.pointInTriangle(qV<qL?qJ:qW,qV,qH,qL,qV<qL?qW:qJ,qV,qR.x,qR.y)&&((qz=Math.abs(qV-qR.y)/(qJ-qR.x))<qC||qz===qC&&qR.x>qa.x)&&qo.locallyInside(qR,qS)&&(qa=qR,qC=qz),qR=qR.next;return qa},qo.indexCurve=function(qS,q_,qa,qR){for(var qJ=qS;null===qJ.z&&(qJ.z=qo.zOrder(qJ.x,qJ.y,q_,qa,qR)),qJ.prevZ=qJ.prev,qJ.nextZ=qJ.next,(qJ=qJ.next)!==qS;);qJ.prevZ.nextZ=null,qJ.prevZ=null,qo.sortLinked(qJ)},qo.sortLinked=function(qS){var q_,qa,qR,qJ,qV,qW,qk,qz,qb=1;do{for(qa=qS,qV=qS=null,qW=0;qa;){for(qW++,qR=qa,q_=qk=0;q_<qb&&(qk++,qR=qR.nextZ);q_++);for(qz=qb;0<qk||0<qz&&qR;)0!==qk&&(0===qz||!qR||qa.z<=qR.z)?(qa=(qJ=qa).nextZ,qk--):(qR=(qJ=qR).nextZ,qz--),qV?qV.nextZ=qJ:qS=qJ,qJ.prevZ=qV,qV=qJ;qa=qR}qV.nextZ=null,qb*=2}while(1<qW);return qS},qo.zOrder=function(qS,q_,qa,qR,qJ){return(qS=1431655765&((qS=858993459&((qS=252645135&((qS=16711935&((qS=32767*(qS-qa)*qJ)|qS<<8))|qS<<4))|qS<<2))|qS<<1))|(q_=1431655765&((q_=858993459&((q_=252645135&((q_=16711935&((q_=32767*(q_-qR)*qJ)|q_<<8))|q_<<4))|q_<<2))|q_<<1))<<1},qo.getLeftmost=function(qS){for(var q_=qS,qa=qS;q_.x<qa.x&&(qa=q_),(q_=q_.next)!==qS;);return qa},qo.pointInTriangle=function(qS,q_,qa,qR,qJ,qV,qW,qk){return 0<=(qJ-qW)*(q_-qk)-(qS-qW)*(qV-qk)&&0<=(qS-qW)*(qR-qk)-(qa-qW)*(q_-qk)&&0<=(qa-qW)*(qV-qk)-(qJ-qW)*(qR-qk)},qo.isValidDiagonal=function(qS,q_){return qS.next.i!==q_.i&&qS.prev.i!==q_.i&&!qo.intersectsPolygon(qS,q_)&&qo.locallyInside(qS,q_)&&qo.locallyInside(q_,qS)&&qo.middleInside(qS,q_)},qo.area=function(qS,q_,qa){return(q_.y-qS.y)*(qa.x-q_.x)-(q_.x-qS.x)*(qa.y-q_.y)},qo.equals=function(qS,q_){return qS.x===q_.x&&qS.y===q_.y},qo.intersects=function(qS,q_,qa,qR){return!!(qo.equals(qS,q_)&&qo.equals(qa,qR)||qo.equals(qS,qR)&&qo.equals(qa,q_))||0<qo.area(qS,q_,qa)!=0<qo.area(qS,q_,qR)&&0<qo.area(qa,qR,qS)!=0<qo.area(qa,qR,q_)},qo.intersectsPolygon=function(qS,q_){var qa=qS;do{if(qa.i!==qS.i&&qa.next.i!==qS.i&&qa.i!==q_.i&&qa.next.i!==q_.i&&qo.intersects(qa,qa.next,qS,q_))return!0;qa=qa.next}while(qa!==qS);return!1},qo.locallyInside=function(qS,q_){return qo.area(qS.prev,qS,qS.next)<0?0<=qo.area(qS,q_,qS.next)&&0<=qo.area(qS,qS.prev,q_):qo.area(qS,q_,qS.prev)<0||qo.area(qS,qS.next,q_)<0},qo.middleInside=function(qS,q_){for(var qa=qS,qR=!1,qJ=(qS.x+q_.x)/2,qV=(qS.y+q_.y)/2;qa.y>qV!=qa.next.y>qV&&qa.next.y!==qa.y&&qJ<(qa.next.x-qa.x)*(qV-qa.y)/(qa.next.y-qa.y)+qa.x&&(qR=!qR),(qa=qa.next)!==qS;);return qR},qo.splitPolygon=function(qS,q_){var qa=new qJS(qS.i,qS.x,qS.y),qR=new qJS(q_.i,q_.x,q_.y),qJ=qS.next,qV=q_.prev;return(qS.next=q_).prev=qS,(qa.next=qJ).prev=qa,(qR.next=qa).prev=qR,(qV.next=qR).prev=qV,qR},qo.insertNode=function(qS,q_,qa,qR){var qJ=new qJS(qS,q_,qa);return qR?(qJ.next=qR.next,(qJ.prev=qR).next.prev=qJ,qR.next=qJ):(qJ.prev=qJ).next=qJ,qJ},qo.removeNode=function(qS){qS.next.prev=qS.prev,qS.prev.next=qS.next,qS.prevZ&&(qS.prevZ.nextZ=qS.nextZ),qS.nextZ&&(qS.nextZ.prevZ=qS.prevZ)},qo.signedArea=function(qS,q_,qa,qR){for(var qJ=0,qV=q_,qW=qa-qR;qV<qa;qV+=qR)qJ+=(qS[qW]-qS[qV])*(qS[qV+1]+qS[qW+1]),qW=qV;return qJ},qo}(),qJS=function(){function qS(qS,q_,qa){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=qS,this.x=q_,this.y=qa,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return qC(qS,"laya.webgl.shapes.EarcutNode"),qS}(),qVS=(function(){function qS(qS,q_,qa,qR,qJ,qV,qW){this.lineWidth=qS,this.lineColor=q_,this.lineAlpha=qa,this.fillColor=qR,this.fillAlpha=qJ,this.shape=qW,this.fill=qV}qC(qS,"laya.webgl.shapes.GeometryData");var q_=qS.prototype;q_.clone=function(){return new qS(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},q_.getIndexData=function(){return null},q_.getVertexData=function(){return null},q_.destroy=function(){this.shape=null}}(),function(){function qS(qS){if(qS instanceof Float32Array)this.points=qS;else if(qS instanceof Array){qS.length;this.points=new Float32Array(qS)}}qC(qS,"laya.webgl.shapes.Vertex");var q_=qS.prototype;qm.imps(q_,{"laya.webgl.shapes.IShape":!0}),q_.getData=function(qS,q_,qa){},q_.needUpdate=function(qS){return!1},q_.rebuild=function(qS){},q_.setMatrix=function(qS){}}(),function(){function qz(qS){void 0===qS&&(qS=1e4),this._renderType=qS}qC(qz,"laya.webgl.submit.Submit");var qS=qz.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS.releaseRender=function(){var qS=qz._cache;(qS[qS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},qS.getRenderType=function(){return this._renderType},qS.renderSubmit=function(){if(0===this._numEle)return 1;var qS=this.shaderValue.textureHost;if(qS){var q_=qS.source;if(!qS.bitmap||!q_)return 1;this.shaderValue.texture=q_,qS.alphaTexture&&qS.alphaTexture.source&&(this.shaderValue.texture1=qS.alphaTexture.source)}this._vb.bind_upload(this._ib);var qa=qjS.mainContext;return this.shaderValue.upload(),qf.activeBlendFunction!==this._blendFn&&(qa.enable(3042),this._blendFn(qa),qf.activeBlendFunction=this._blendFn),qX.drawCall++,qX.trianglesFaces+=this._numEle/3,qa.drawElements(4,this._numEle,5123,this._startIdx),1},qz.__init__=function(){var qS=qz.RENDERBASE=new qz(-1);qS.shaderValue=new qNS(0,0),qS.shaderValue.ALPHA=-1234},qz.createSubmit=function(qS,q_,qa,qR,qJ){var qV=qz._cache._length?qz._cache[--qz._cache._length]:new qz;null==qa&&((qa=qV._selfVb||(qV._selfVb=qdS.create(-1))).clear(),qR=0),qV._ib=q_,qV._vb=qa,qV._startIdx=qR*qoS.BYTES_PIDX,qV._numEle=0;var qW=qS._nBlendType;qV._blendFn=qS._targets?qf.targetFns[qW]:qf.fns[qW],qV.shaderValue=qJ,qV.shaderValue.setValue(qS._shader2D);var qk=qS._shader2D.filters;return qk&&qV.shaderValue.setFilters(qk),qV},qz.createShape=function(qS,q_,qa,qR,qJ,qV){var qW=qz._cache._length?qz._cache[--qz._cache._length]:new qz;qW._ib=q_,qW._vb=qa,qW._numEle=qR,qW._startIdx=qJ,qW.shaderValue=qV,qW.shaderValue.setValue(qS._shader2D);var qk=qS._nBlendType;return qW._blendFn=qS._targets?qf.targetFns[qk]:qf.fns[qk],qW},qz.TYPE_2D=1e4,qz.TYPE_CANVAS=10003,qz.TYPE_CMDSETRT=10004,qz.TYPE_CUSTOM=10005,qz.TYPE_BLURRT=10006,qz.TYPE_CMDDESTORYPRERT=10007,qz.TYPE_DISABLESTENCIL=10008,qz.TYPE_OTHERIBVB=10009,qz.TYPE_PRIMITIVE=10010,qz.TYPE_RT=10011,qz.TYPE_BLUR_RT=10012,qz.TYPE_TARGET=10013,qz.TYPE_CHANGE_VALUE=10014,qz.TYPE_SHAPE=10015,qz.TYPE_TEXTURE=10016,qz.TYPE_FILLTEXTURE=10017,qz.RENDERBASE=null,qz._cache=((qz._cache=[])._length=0,qz._cache),qz}()),qWS=function(){function qR(){this.fun=null,this.args=null}qC(qR,"laya.webgl.submit.SubmitCMD");var qS=qR.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS.renderSubmit=function(){return this.fun.apply(null,this.args),1},qS.getRenderType=function(){return 0},qS.releaseRender=function(){var qS=qR._cache;qS[qS._length++]=this},qR.create=function(qS,q_){var qa=qR._cache._length?qR._cache[--qR._cache._length]:new qR;return qa.fun=q_,qa.args=qS,qa},qR._cache=((qR._cache=[])._length=0,qR._cache),qR}(),qkS=function(){function q_(){this.variables={}}qC(q_,"laya.webgl.submit.SubmitCMDScope");var qS=q_.prototype;return qS.getValue=function(qS){return this.variables[qS]},qS.addValue=function(qS,q_){return this.variables[qS]=q_},qS.setValue=function(qS,q_){return this.variables.hasOwnProperty(qS)?this.variables[qS]=q_:null},qS.clear=function(){for(var qS in this.variables)delete this.variables[qS]},qS.recycle=function(){this.clear(),q_.POOL.push(this)},q_.create=function(){var qS=q_.POOL.pop();return qS||(qS=new q_),qS},q_.POOL=[],q_}(),qzS=function(){function qL(){this.offset=0,this.startIndex=0,this._mat=qn.create()}qC(qL,"laya.webgl.submit.SubmitOtherIBVB");var qS=qL.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS.releaseRender=function(){var qS=qL._cache;(qS[qS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},qS.getRenderType=function(){return 10009},qS.renderSubmit=function(){var qS=this._shaderValue.textureHost;if(qS){var q_=qS.source;if(!qS.bitmap||!q_)return 1;this._shaderValue.texture=q_}this._vb.bind_upload(this._ib);var qa=qTS.worldMatrix4,qR=qn.TEMP;qn.mulPre(this._mat,qa[0],qa[1],qa[4],qa[5],qa[12],qa[13],qR);var qJ=qTS.worldMatrix4=qL.tempMatrix4;qJ[0]=qR.a,qJ[1]=qR.b,qJ[4]=qR.c,qJ[5]=qR.d,qJ[12]=qR.tx,qJ[13]=qR.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var qV=qjS.mainContext;return qf.activeBlendFunction!==this._blendFn&&(qV.enable(3042),this._blendFn(qV),qf.activeBlendFunction=this._blendFn),qX.drawCall++,qX.trianglesFaces+=this._numEle/3,qV.drawElements(4,this._numEle,5123,this.startIndex),qTS.worldMatrix4=qa,qMS.activeShader=null,1},qL.create=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){void 0===qz&&(qz=0);var qb=qL._cache._length?qL._cache[--qL._cache._length]:new qL;qb._ib=qa,qb._vb=q_,qb._numEle=qR,qb._shader=qJ,qb._shaderValue=qV;var qH=qS._nBlendType;switch(qb._blendFn=qS._targets?qf.targetFns[qH]:qf.fns[qH],qz){case 0:qb.offset=0,qb.startIndex=qk/(qoS.BYTES_PE*q_.vertexStride)*1.5,qb.startIndex*=qoS.BYTES_PIDX;break;case 1:qb.startIndex=qW,qb.offset=qk}return qb},qL._cache=((qL._cache=[])._length=0,qL._cache),qL.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qL}(),qbS=function(){function qa(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new qB,this.screenRect=new qB}qC(qa,"laya.webgl.submit.SubmitScissor");var qS=qa.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS._scissor=function(qS,q_,qa,qR){var qJ=qTS.worldMatrix4,qV=qJ[0],qW=qJ[5],qk=qJ[12],qz=qJ[13];if(qR*=qW,(qa*=qV)<1||qR<1)return!1;var qb=(qS=qS*qV+qk)+qa,qH=(q_=q_*qW+qz)+qR;qS<0&&(qa=qb-(qS=0)),q_<0&&(qR=qH-(q_=0));var qL=qTS.worldClipRect;if(qS=Math.max(qS,qL.x),q_=Math.max(q_,qL.y),qa=Math.min(qb,qL.right)-qS,qR=Math.min(qH,qL.bottom)-q_,qa<1||qR<1)return!1;var qC=qTS.worldScissorTest;return this.screenRect.copyFrom(qL),qL.x=qS,qL.y=q_,qL.width=qa,qL.height=qR,qTS.worldScissorTest=!0,q_=qTS.height-q_-qR,qjS.mainContext.scissor(qS,q_,qa,qR),qjS.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),qC?(q_=qTS.height-this.screenRect.y-this.screenRect.height,qjS.mainContext.scissor(this.screenRect.x,q_,this.screenRect.width,this.screenRect.height),qjS.mainContext.enable(3089)):(qjS.mainContext.disable(3089),qTS.worldScissorTest=!1),qL.copyFrom(this.screenRect),!0},qS._scissorWithTagart=function(qS,q_,qa,qR){if(qa<1||qR<1)return!1;var qJ=qS+qa,qV=q_+qR;qS<0&&(qa=qJ-(qS=0)),q_<0&&(qR=qV-(q_=0));var qW=qTS.worldClipRect;if(qS=Math.max(qS,qW.x),q_=Math.max(q_,qW.y),qa=Math.min(qJ,qW.right)-qS,qR=Math.min(qV,qW.bottom)-q_,qa<1||qR<1)return!1;var qk=qTS.worldScissorTest;return this.screenRect.copyFrom(qW),qTS.worldScissorTest=!0,qW.x=qS,qW.y=q_,qW.width=qa,qW.height=qR,q_=qTS.height-q_-qR,qjS.mainContext.scissor(qS,q_,qa,qR),qjS.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),qk?(q_=qTS.height-this.screenRect.y-this.screenRect.height,qjS.mainContext.scissor(this.screenRect.x,q_,this.screenRect.width,this.screenRect.height),qjS.mainContext.enable(3089)):(qjS.mainContext.disable(3089),qTS.worldScissorTest=!1),qW.copyFrom(this.screenRect),!0},qS.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},qS.getRenderType=function(){return 0},qS.releaseRender=function(){var qS=qa._cache;(qS[qS._length++]=this).context=null},qa.create=function(qS){var q_=qa._cache._length?qa._cache[--qa._cache._length]:new qa;return q_.context=qS,q_},qa._cache=((qa._cache=[])._length=0,qa._cache),qa}(),qHS=function(){function qz(){this.step=0,this.blendMode=null,this.level=0}qC(qz,"laya.webgl.submit.SubmitStencil");var qS=qz.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},qS.getRenderType=function(){return 0},qS.releaseRender=function(){var qS=qz._cache;qS[qS._length++]=this},qS.do1=function(){var qS=qjS.mainContext;qS.enable(2960),qS.clear(1024),qS.colorMask(!1,!1,!1,!1),qS.stencilFunc(514,this.level,255),qS.stencilOp(7680,7680,7682)},qS.do2=function(){var qS=qjS.mainContext;qS.stencilFunc(514,this.level+1,255),qS.colorMask(!0,!0,!0,!0),qS.stencilOp(7680,7680,7680)},qS.do3=function(){var qS=qjS.mainContext;qS.colorMask(!0,!0,!0,!0),qS.stencilOp(7680,7680,7680),qS.clear(1024),qS.disable(2960)},qS.do4=function(){var qS=qjS.mainContext;0==this.level&&(qS.enable(2960),qS.clear(1024)),qS.colorMask(!1,!1,!1,!1),qS.stencilFunc(519,0,255),qS.stencilOp(7680,7680,7682)},qS.do5=function(){var qS=qjS.mainContext;qS.stencilFunc(514,this.level,255),qS.colorMask(!0,!0,!0,!0),qS.stencilOp(7680,7680,7680)},qS.do6=function(){var qS=qjS.mainContext;qf.targetFns[qf.TOINT[this.blendMode]](qS)},qS.do7=function(){var qS=qjS.mainContext;qS.colorMask(!1,!1,!1,!1),qS.stencilOp(7680,7680,7683)},qS.do8=function(){var qS=qjS.mainContext;qS.colorMask(!0,!0,!0,!0),qS.stencilFunc(514,this.level,255),qS.stencilOp(7680,7680,7680)},qz.restore=function(qS,q_,qa,qR,qJ){var qV;if((qS._renderKey=0)<qz._mask&&qz._mask--,0==qz._mask)qV=laya.webgl.submit.SubmitStencil.create(3),qS.addRenderObject(qV),qS._curSubmit=qVS.RENDERBASE;else{qV=laya.webgl.submit.SubmitStencil.create(7),qS.addRenderObject(qV);var qW=qS._vb;qW._byteLength;if(q$S.fillRectImgVb(qW,null,q_.x,q_.y,q_.width,q_.height,qP.DEF_UV,qa,qR,qJ,0,0)){qS._shader2D.glTexture=null;var qk=qS._curSubmit=qVS.createSubmit(qS,qS._ib,qW,(qW._byteLength-64)/32*3,qNS.create(2,0));qk.shaderValue.ALPHA=1,qS._submits[qS._submits._length++]=qk,qS._curSubmit._numEle+=6,qS._curSubmit=qVS.RENDERBASE}else alert("clipRect calc stencil rect error");qV=laya.webgl.submit.SubmitStencil.create(8),qS.addRenderObject(qV)}},qz.restore2=function(qS,q_){var qa;(qS._renderKey=0)<qz._mask&&qz._mask--,0==qz._mask?(qa=laya.webgl.submit.SubmitStencil.create(3),qS.addRenderObject(qa),qS._curSubmit=qVS.RENDERBASE):(qa=laya.webgl.submit.SubmitStencil.create(7),qS.addRenderObject(qa),qS._submits[qS._submits._length++]=q_,qa=laya.webgl.submit.SubmitStencil.create(8),qS.addRenderObject(qa))},qz.create=function(qS){var q_=qz._cache._length?qz._cache[--qz._cache._length]:new qz;return 5==(q_.step=qS)&&++qz._mask,q_.level=qz._mask,q_},qz._cache=((qz._cache=[])._length=0,qz._cache),qz._mask=0,qz}(),qLS=function(){function qk(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}qC(qk,"laya.webgl.submit.SubmitTarget");var qS=qk.prototype;return qm.imps(qS,{"laya.webgl.submit.ISubmit":!0}),qS.renderSubmit=function(){this._vb.bind_upload(this._ib);var qS=this.scope.getValue(this.proName);return qS&&(this.shaderValue.texture=qS.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[qS.width,qS.height]),this.shaderValue.upload(),this.blend(),qX.drawCall++,qX.trianglesFaces+=this._numEle/3,qjS.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},qS.blend=function(){if(qf.activeBlendFunction!==qf.fns[this.blendType]){var qS=qjS.mainContext;qS.enable(3042),qf.fns[this.blendType](qS),qf.activeBlendFunction=qf.fns[this.blendType]}},qS.getRenderType=function(){return 0},qS.releaseRender=function(){var qS=qk._cache;(qS[qS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},qk.create=function(qS,q_,qa,qR,qJ,qV){var qW=qk._cache._length?qk._cache[--qk._cache._length]:new qk;return qW._ib=q_,qW._vb=qa,qW.proName=qV,qW._startIdx=qR*qoS.BYTES_PIDX,qW._numEle=0,qW.blendType=qS._nBlendType,qW.shaderValue=qJ,qW.shaderValue.setValue(qS._shader2D),qW},qk._cache=((qk._cache=[])._length=0,qk._cache),qk}(),qCS=function(){function qS(){this._sourceStr=null}qC(qS,"laya.webgl.text.CharSegment");var q_=qS.prototype;return qm.imps(q_,{"laya.webgl.text.ICharSegment":!0}),q_.textToSpit=function(qS){this._sourceStr=qS},q_.getChar=function(qS){return this._sourceStr.charAt(qS)},q_.getCharCode=function(qS){return this._sourceStr.charCodeAt(qS)},q_.length=function(){return this._sourceStr.length},qS}(),qGS=function(){var qS;function qX(){}return qC(qX,"laya.webgl.text.DrawText"),qX.__init__=function(){qX._charsTemp=new Array,qX._drawValue=new qS,qX._charSeg=new qCS},qX.customCharSeg=function(qS){qX._charSeg=qS},qX.getChar=function(qS,q_,qa){var qR=qZS.createOneChar(qS,qa);return-1!=q_&&(qX._charsCache[q_]=qR),qR},qX._drawSlow=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL,qC,qG,qt){var qo,q$,qF=qX._drawValue.value(qV,qk,qz,qb,qC,qG,qt),qT=0,qD=0,qj=qX._charsTemp,qQ=0,qm=NaN;if(qR)for(qj.length=qR.length,qT=0,qD=qR.length;qT<qD;qT++)(q$=qR[qT])&&(qm=q$.charNum+qF.txtID,qj[qT]=qo=qX._charsCache[qm]||qX.getChar(q$.char,qm,qF),qo.active());else{var qq=qa instanceof laya.utils.WordText?qa.toString():qa;if(qK.CharacterCache){qX._charSeg.textToSpit(qq);var qN=qX._charSeg.length();for(qT=0,qD=qj.length=qN;qT<qD;qT++)qm=qX._charSeg.getCharCode(qT)+qF.txtID,qj[qT]=qo=qX._charsCache[qm]||qX.getChar(qX._charSeg.getChar(qT),qm,qF),qo.active(),qQ+=qo.cw}else qj.length=0,(qo=qX.getChar(qq,-1,qF)).active(),qQ+=qo.cw,qj[0]=qo}var qn=0;null!==qW&&"left"!==qW&&(qn=-("center"==qW?qQ/2:qQ));var ql,qB,qI=NaN,qA=0;if(qR)for(qT=0,qD=qj.length;qT<qD;qT++)qo=qj[qT],q$=qR[qT],qo&&q$&&!qo.isSpace&&(qI=qo.borderSize,ql=qo.texture,q_._drawText(ql,qH+qn+q$.x*qC-qI,qL+q$.y*qG-qI,ql.width,ql.height,qJ,0,0,0,0));else{for(qT=0,qD=qj.length;qT<qD;qT++)(qo=qj[qT])&&!qo.isSpace&&(qI=qo.borderSize,ql=qo.texture,q_._drawText(ql,qH+qn-qI,qL-qI,ql.width,ql.height,qJ,0,0,0,0),qS&&((qB=qS[qA++])||(qB=qS[qA-1]=[]),qB[0]=ql,qB[1]=qn-qI,qB[2]=-qI)),qn+=qo.cw;qS&&(qS.length=qA)}},qX._drawFast=function(qS,q_,qa,qR,qJ){for(var qV,qW,qk=0,qz=qS.length;qk<qz;qk++)(qV=(qW=qS[qk])[0]).active(),q_._drawText(qV,qR+qW[1],qJ+qW[2],qV.width,qV.height,qa,0,0,0,0)},qX.drawText=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL){if(void 0===qL&&(qL=0),!(q_&&0===q_.length||qa&&0===qa.length)){var qC=qR.a,qG=qR.d;(0!==qR.b||0!==qR.c)&&(qC=qG=1);var qt=1!==qC||1!==qG;if(qt&&qm.stage.transform){var qo=qm.stage.transform;qt=qo.a===qC&&qo.d===qG}else qt=!1;if(qt){var q$=(qR=qR.copyTo(qqS._tmpMatrix)).tx,qF=qR.ty;qR.scale(1/qC,1/qG),qR._checkTransform(),qb*=qC,qH*=qG,qb+=q$-qR.tx,qH+=qF-qR.ty}else qC=qG=1;if(qa)qX._drawSlow(null,qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qC,qG,qL);else{if(null===q_.toUpperCase){var qT=qC+1e5*qG,qD=q_;return void(qD.changed||qD.id!==qT?(qD.id=qT,qD.changed=!1,qX._drawSlow(qD.save,qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qC,qG,qL)):qX._drawFast(qD.save,qS,qR,qb,qH))}var qj=q_+qJ.toString()+qW+qk+qz+qC+qG+qV,qQ=qX._textsCache[qj];qK.CharacterCache?qQ?qX._drawFast(qQ,qS,qR,qb,qH):(qX._textsCache.__length||(qX._textsCache.__length=0),qX._textsCache.__length>qq.WebGLTextCacheCount&&((qX._textsCache={}).__length=0,qX._curPoolIndex=0),qX._textCachesPool[qX._curPoolIndex]?(qQ=qX._textsCache[qj]=qX._textCachesPool[qX._curPoolIndex]).length=0:qX._textCachesPool[qX._curPoolIndex]=qQ=qX._textsCache[qj]=[],qX._textsCache.__length++,qX._curPoolIndex++,qX._drawSlow(qQ,qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qC,qG,qL)):qX._drawSlow(qQ,qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qC,qG,qL)}}},qX._charsTemp=null,qX._textCachesPool=[],qX._curPoolIndex=0,qX._charsCache={},qX._textsCache={},qX._drawValue=null,qX.d=[],qX._charSeg=null,qX.__init$=function(){qS=function(){function qz(){}return qC(qz,""),qz.prototype.value=function(qS,q_,qa,qR,qJ,qV,qW){this.font=qS,this.fillColor=q_,this.borderColor=qa,this.lineWidth=qR,this.scaleX=qJ,this.scaleY=qV,this.underLine=qW;var qk=qS.toString()+qJ+qV+qR+(q_?q_.toLowerCase():" ")+(qa?qa.toLowerCase():" ")+qW;return this.txtID=qz._keymap[qk],this.txtID||(this.txtID=1e-7*++qz._keymapCount,qz._keymap[qk]=this.txtID),this},qz.clear=function(){qz._keymap={},qz._keymapCount=1},qz._keymap={},qz._keymapCount=1,qz}()},qX}(),qtS=function(){function qJ(qS){this._index=0,this._size=14,this._italic=-2,qJ._cache2=qJ._cache2||[],this.setFont(qS||"14px Arial")}qC(qJ,"laya.webgl.text.FontInContext");var qS=qJ.prototype;return qS.setFont=function(qS){var q_=qJ._cache2[qS];if(q_)this._words=q_[0],this._size=q_[1];else{this._words=qS.split(" ");for(var qa=0,qR=this._words.length;qa<qR;qa++)if(0<this._words[qa].indexOf("px")){this._index=qa;break}this._size=parseInt(this._words[this._index]),qJ._cache2[qS]=[this._words,this._size]}this._text=null,this._italic=-2},qS.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},qS.hasType=function(qS){for(var q_=0,qa=this._words.length;q_<qa;q_++)if(this._words[q_]===qS)return q_;return-1},qS.removeType=function(qS){for(var q_=0,qa=this._words.length;q_<qa;q_++)if(this._words[q_]===qS){this._words.splice(q_,1),this._index>q_&&this._index--;break}this._text=null,this._italic=-2},qS.copyTo=function(qS){return qS._text=this._text,qS._size=this._size,qS._index=this._index,qS._words=this._words.slice(),qS._italic=-2,qS},qS.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},qR(0,qS,"size",function(){return this._size},function(qS){this._size=qS,this._words[this._index]=qS+"px",this._text=null}),qJ.create=function(qS){var q_=qJ._cache[qS];return q_||(q_=qJ._cache[qS]=new qJ(qS))},qJ.EMPTY=new qJ,qJ._cache={},qJ._cache2=null,qJ}(),qoS=function(){function qS(){}return qC(qS,"laya.webgl.utils.CONST3D2D"),qS.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qS.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],qS.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],qS._TMPARRAY=[],qS._OFFSETX=0,qS._OFFSETY=0,qW(qS,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),qS}(),q$S=function(){function qt(){}return qC(qt,"laya.webgl.utils.GlUtils"),qt.make2DProjection=function(qS,q_,qa){return[2/qS,0,0,0,0,-2/q_,0,0,0,0,2/qa,0,-1,1,0,1]},qt.fillIBQuadrangle=function(qS,q_){if(65535/4<q_)throw Error("IBQuadrangle count:"+q_+" must<:"+Math.floor(65535/4));q_=Math.floor(q_),qS._resizeBuffer(6*(q_+1)*2,!1),qS.byteLength=qS.bufferLength;for(var qa=qS.getUint16Array(),qR=0,qJ=0;qJ<q_;qJ++)qa[qR++]=4*qJ,qa[qR++]=4*qJ+2,qa[qR++]=4*qJ+1,qa[qR++]=4*qJ,qa[qR++]=4*qJ+3,qa[qR++]=4*qJ+2;return qS.setNeedUpload(),!0},qt.expandIBQuadrangle=function(qS,q_){qS.bufferLength>=6*q_*2||qt.fillIBQuadrangle(qS,q_)},qt.mathCeilPowerOfTwo=function(qS){return qS--,qS|=qS>>1,qS|=qS>>2,qS|=qS>>4,qS|=qS>>8,qS|=qS>>16,++qS},qt.fillQuadrangleImgVb=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=16+(qS._byteLength>>2);qS.byteLength=qz<<2;var qb=qS.getFloat32Array();qb[(qz-=16)+2]=qJ[0],qb[qz+3]=qJ[1],qb[qz+6]=qJ[2],qb[qz+7]=qJ[3],qb[qz+10]=qJ[4],qb[qz+11]=qJ[5],qb[qz+14]=qJ[6],qb[qz+15]=qJ[7];var qH=qV.a,qL=qV.b,qC=qV.c,qG=qV.d;if(1!==qH||0!==qL||0!==qC||1!==qG){qV.bTransform=!0;var qt=qV.tx+qW,qo=qV.ty+qk;qb[qz]=(qR[0]+q_)*qH+(qR[1]+qa)*qC+qt,qb[qz+1]=(qR[0]+q_)*qL+(qR[1]+qa)*qG+qo,qb[qz+4]=(qR[2]+q_)*qH+(qR[3]+qa)*qC+qt,qb[qz+5]=(qR[2]+q_)*qL+(qR[3]+qa)*qG+qo,qb[qz+8]=(qR[4]+q_)*qH+(qR[5]+qa)*qC+qt,qb[qz+9]=(qR[4]+q_)*qL+(qR[5]+qa)*qG+qo,qb[qz+12]=(qR[6]+q_)*qH+(qR[7]+qa)*qC+qt,qb[qz+13]=(qR[6]+q_)*qL+(qR[7]+qa)*qG+qo}else qV.bTransform=!1,q_+=qV.tx+qW,qa+=qV.ty+qk,qb[qz]=q_+qR[0],qb[qz+1]=qa+qR[1],qb[qz+4]=q_+qR[2],qb[qz+5]=qa+qR[3],qb[qz+8]=q_+qR[4],qb[qz+9]=qa+qR[5],qb[qz+12]=q_+qR[6],qb[qz+13]=qa+qR[7];return qS._upload=!0},qt.fillTranglesVB=function(qS,q_,qa,qR,qJ,qV,qW){var qk=(qS._byteLength>>2)+qR.length;qS.byteLength=qk<<2;var qz=qS.getFloat32Array();qk-=qR.length;for(var qb=qR.length,qH=qJ.a,qL=qJ.b,qC=qJ.c,qG=qJ.d,qt=0;qt<qb;qt+=4)if(qz[qk+qt+2]=qR[qt+2],qz[qk+qt+3]=qR[qt+3],1!==qH||0!==qL||0!==qC||1!==qG){qJ.bTransform=!0;var qo=qJ.tx+qV,q$=qJ.ty+qW;qz[qk+qt]=(qR[qt]+q_)*qH+(qR[qt+1]+qa)*qC+qo,qz[qk+qt+1]=(qR[qt]+q_)*qL+(qR[qt+1]+qa)*qG+q$}else qJ.bTransform=!1,q_+=qJ.tx+qV,qa+=qJ.ty+qW,qz[qk+qt]=q_+qR[qt],qz[qk+qt+1]=qa+qR[qt+1];return qS._upload=!0},qt.copyPreImgVb=function(qS,q_,qa){var qR=qS._byteLength>>2;qS.byteLength=qR+16<<2;for(var qJ=qS.getFloat32Array(),qV=0,qW=qR-16;qV<4;qV++)qJ[qR]=qJ[qW]+q_,++qW,qJ[++qR]=qJ[qW]+qa,++qW,qJ[++qR]=qJ[qW],++qW,qJ[++qR]=qJ[qW],++qR,++qW;qS._upload=!0},qt.fillRectImgVb=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL,qC){void 0===qC&&(qC=!1);var qG,qt,qo,q$,qF,qT,qD,qj,qQ,qm,qq,qN,qn,ql,qB,qI,qA=1,qX=qk.a,qh=qk.b,qu=qk.c,qK=qk.d,qP=q_&&q_.width<99999999;if(1!==qX||0!==qh||0!==qu||1!==qK?(qk.bTransform=!0,0===qh&&0===qu&&(qA=23,qQ=qJ+qa,qm=qV+qR,qG=qX*qa+(qq=qk.tx+qz),qo=qX*qQ+qq,qt=qK*qR+(qN=qk.ty+qb),q$=qK*qm+qN)):(qA=23,qk.bTransform=!1,qo=(qG=qa+qk.tx+qz)+qJ,q$=(qt=qR+qk.ty+qb)+qV),qP&&(qF=q_.x,qT=q_.y,qD=q_.width+qF,qj=q_.height+qT),1!==qA){if(Math.min(qG,qo)>=qD)return!1;if(Math.min(qt,q$)>=qj)return!1;if(Math.max(qo,qG)<=qF)return!1;if(Math.max(q$,qt)<=qT)return!1}var qM=qS._byteLength>>2;qS.byteLength=16+qM<<2;var qr=qS.getFloat32Array();switch(qr[2+qM]=qW[0],qr[3+qM]=qW[1],qr[6+qM]=qW[2],qr[7+qM]=qW[3],qr[10+qM]=qW[4],qr[11+qM]=qW[5],qr[14+qM]=qW[6],qr[15+qM]=qW[7],qA){case 1:qq=qk.tx+qz,qN=qk.ty+qb;var qe=qX*qa,qg=qu*qR,qx=qK*qR,qs=qh*qa,qU=qX*(qQ=qJ+qa),qf=qu*(qm=qV+qR),qY=qK*qm,qi=qh*qQ;qC?(qn=qe+qg+qq,qB=Math.round(qn)-qn,ql=qx+qs+qN,qI=Math.round(ql)-ql,qr[qM]=qn+qB,qr[1+qM]=ql+qI,qr[4+qM]=qU+qg+qq+qB,qr[5+qM]=qx+qi+qN+qI,qr[8+qM]=qU+qf+qq+qB,qr[9+qM]=qY+qi+qN+qI,qr[12+qM]=qe+qf+qq+qB,qr[13+qM]=qY+qs+qN+qI):(qr[qM]=qe+qg+qq,qr[1+qM]=qx+qs+qN,qr[4+qM]=qU+qg+qq,qr[5+qM]=qx+qi+qN,qr[8+qM]=qU+qf+qq,qr[9+qM]=qY+qi+qN,qr[12+qM]=qe+qf+qq,qr[13+qM]=qY+qs+qN);break;case 23:qC?(qn=qG+qH,qB=Math.round(qn)-qn,ql=qt,qI=Math.round(ql)-ql,qr[qM]=qn+qB,qr[1+qM]=ql+qI,qr[4+qM]=qo+qH+qB,qr[5+qM]=qt+qI,qr[8+qM]=qo+qB,qr[9+qM]=q$+qI,qr[12+qM]=qG+qB,qr[13+qM]=q$+qI):(qr[qM]=qG+qH,qr[1+qM]=qt,qr[4+qM]=qo+qH,qr[5+qM]=qt,qr[8+qM]=qo,qr[9+qM]=q$,qr[12+qM]=qG,qr[13+qM]=q$)}return qS._upload=!0},qt.fillLineVb=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=.5*qW,qb=qt._fillLineArray,qH=-(qR-qV),qL=qa-qJ,qC=Math.sqrt(qH*qH+qL*qL);qH/=qC,qL/=qC,qH*=qz,qL*=qz,qb[0]=qa-qH,qb[1]=qR-qL,qb[4]=qa+qH,qb[5]=qR+qL,qb[8]=qJ+qH,qb[9]=qV+qL,qb[12]=qJ-qH,qb[13]=qV-qL,qk&&qk.transformPointArray(qb,qb);var qG=16+(qS._byteLength>>2);return qS.byteLength=qG<<2,qS.insertData(qb,qG-16),!0},qt._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],qt}(),qFS=(function(){function qz(){}qC(qz,"laya.webgl.utils.MatirxArray"),qz.ArrayMul=function(qS,q_,qa){if(qS)if(q_)for(var qR=NaN,qJ=NaN,qV=NaN,qW=NaN,qk=0;qk<4;qk++)qR=qS[qk],qJ=qS[qk+4],qV=qS[qk+8],qW=qS[qk+12],qa[qk]=qR*q_[0]+qJ*q_[1]+qV*q_[2]+qW*q_[3],qa[qk+4]=qR*q_[4]+qJ*q_[5]+qV*q_[6]+qW*q_[7],qa[qk+8]=qR*q_[8]+qJ*q_[9]+qV*q_[10]+qW*q_[11],qa[qk+12]=qR*q_[12]+qJ*q_[13]+qV*q_[14]+qW*q_[15];else qz.copyArray(qS,qa);else qz.copyArray(q_,qa)},qz.copyArray=function(qS,q_){if(qS&&q_)for(var qa=0;qa<qS.length;qa++)q_[qa]=qS[qa]}}(),function(){function q_(qS,q_,qa){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=qS,this._vb=new qdS(qS,35048),q_&&this._vb._resizeBuffer(q_,!1),this._ib=new qvS,qa&&this._ib._resizeBuffer(qa,!1)}qC(q_,"laya.webgl.utils.Mesh2D");var qS=q_.prototype;return qS.cloneWithNewVB=function(){var qS=new q_(this._stride,0,0);return qS._ib=this._ib,qS._quadNum=this._quadNum,qS._attribInfo=this._attribInfo,qS},qS.cloneWithNewVBIB=function(){var qS=new q_(this._stride,0,0);return qS._attribInfo=this._attribInfo,qS},qS.getVBW=function(){return this._vb.setNeedUpload(),this._vb},qS.getVBR=function(){return this._vb},qS.getIBR=function(){return this._ib},qS.getIBW=function(){return this._ib.setNeedUpload(),this._ib},qS.createQuadIB=function(qS){this._quadNum=qS,this._ib._resizeBuffer(6*qS*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var q_=this._ib.getUint16Array(),qa=0,qR=0,qJ=0;qJ<qS;qJ++)q_[qa++]=qR,q_[qa++]=qR+2,q_[qa++]=qR+1,q_[qa++]=qR,q_[qa++]=qR+3,q_[qa++]=qR+2,qR+=4;this._ib.setNeedUpload()},qS.setAttributes=function(qS){if(this._attribInfo=qS,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},qS.getEleNum=function(){return this._ib.getBuffer().byteLength/2},qS.releaseMesh=function(){},qS.destroy=function(){},qS.clearVB=function(){this._vb.clear()},q_._gvaoid=0,q_}()),qTS=function(){function qJ(){}return qC(qJ,"laya.webgl.utils.RenderState2D"),qJ.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},qJ.mat2MatArray=function(qS,q_){var qa=qS,qR=q_;return qR[0]=qa.a,qR[1]=qa.b,qR[2]=qJ.EMPTYMAT4_ARRAY[2],qR[3]=qJ.EMPTYMAT4_ARRAY[3],qR[4]=qa.c,qR[5]=qa.d,qR[6]=qJ.EMPTYMAT4_ARRAY[6],qR[7]=qJ.EMPTYMAT4_ARRAY[7],qR[8]=qJ.EMPTYMAT4_ARRAY[8],qR[9]=qJ.EMPTYMAT4_ARRAY[9],qR[10]=qJ.EMPTYMAT4_ARRAY[10],qR[11]=qJ.EMPTYMAT4_ARRAY[11],qR[12]=qa.tx,qR[13]=qa.ty,qR[14]=qJ.EMPTYMAT4_ARRAY[14],qR[15]=qJ.EMPTYMAT4_ARRAY[15],q_},qJ.restoreTempArray=function(){qJ.TEMPMAT4_ARRAY[0]=1,qJ.TEMPMAT4_ARRAY[1]=0,qJ.TEMPMAT4_ARRAY[4]=0,qJ.TEMPMAT4_ARRAY[5]=1,qJ.TEMPMAT4_ARRAY[12]=0,qJ.TEMPMAT4_ARRAY[13]=0},qJ.clear=function(){qJ.worldScissorTest=!1,qJ.worldShaderDefines=null,qJ.worldFilters=null,qJ.worldAlpha=1,qJ.worldClipRect.x=qJ.worldClipRect.y=0,qJ.worldClipRect.width=qJ.width,qJ.worldClipRect.height=qJ.height,qJ.curRenderTarget=null},qJ._MAXSIZE=99999999,qJ.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qJ.worldMatrix4=qJ.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qJ.worldAlpha=1,qJ.worldScissorTest=!1,qJ.worldFilters=null,qJ.worldShaderDefines=null,qJ.curRenderTarget=null,qJ.width=0,qJ.height=0,qW(qJ,["worldMatrix",function(){return this.worldMatrix=new qn},"worldClipRect",function(){return this.worldClipRect=new qB(0,0,99999999,99999999)}]),qJ}(),qDS=function(){var qT,qa;function qD(qS,q_,qa,qR,qJ){var qV=this;function qW(qS){var q_=[],qa=new qT(q_);return qV._compileToTree(qa,qS.split("\n"),0,q_,qJ),qa}var qk=qG.now();this._VS=qW(q_),this._PS=qW(qa),this._nameMap=qR,2<qG.now()-qk&&console.log("ShaderCompile use time:"+(qG.now()-qk)+"  size:"+q_.length+"/"+qa.length)}qC(qD,"laya.webgl.utils.ShaderCompile");var qS=qD.prototype;return qS._compileToTree=function(qS,q_,qa,qR,qJ){var qV,qW,qk,qz,qb,qH,qL,qC=0,qG=0,qt=0,qo=0;for(qG=qa;qG<q_.length;qG++)if(!((qk=q_[qG]).length<1)&&0!==(qC=qk.indexOf("//"))){if(0<=qC&&(qk=qk.substr(0,qC)),qV=qL||new qT(qR),qL=null,qV.text=qk,qV.noCompile=!0,0<=(qC=qk.indexOf("#"))){for(qz="#",qo=qC+1,qt=qk.length;qo<qt;qo++){var q$=qk.charAt(qo);if(" "===q$||"\t"===q$||"\r"===q$||"\n"===q$||"?"===q$)break;qz+=q$}switch(qV.name=qz){case"#ifdef":case"#ifndef":if(qV.src=qk,qV.noCompile=null!=qk.match(/[!&|()=<>]/),qV.noCompile?console.log("function():Boolean{return "+qk.substr(qC+qV.name.length)+"}"):(qH=qk.replace(/^\s*/,"").split(/\s+/),qV.setCondition(qH[1],"#ifdef"===qz?1:2),qV.text="//"+qV.text),qV.setParent(qS),qS=qV,qJ)for(qH=qk.substr(qo).split(qD._splitToWordExps3),qo=0;qo<qH.length;qo++)(qk=qH[qo]).length&&(qJ[qk]=!0);continue;case"#if":if(qV.src=qk,qV.noCompile=!0,qV.setParent(qS),qS=qV,qJ)for(qH=qk.substr(qo).split(qD._splitToWordExps3),qo=0;qo<qH.length;qo++)(qk=qH[qo]).length&&"defined"!=qk&&(qJ[qk]=!0);continue;case"#else":qV.src=qk,qW=(qS=qS.parent).childs[qS.childs.length-1],qV.noCompile=qW.noCompile,qV.noCompile||(qV.condition=qW.condition,qV.conditionType=1==qW.conditionType?2:1,qV.text="//"+qV.text+" "+qW.text+" "+qV.conditionType),qV.setParent(qS),qS=qV;continue;case"#endif":qW=(qS=qS.parent).childs[qS.childs.length-1],qV.noCompile=qW.noCompile,qV.noCompile||(qV.text="//"+qV.text),qV.setParent(qS);continue;case"#include":qH=qD.splitToWords(qk,null);var qF=qD.includes[qH[1]];if(!qF)throw"ShaderCompile error no this include file:"+qH[1];if((qC=qH[0].indexOf("?"))<0){qV.setParent(qS),qk=qF.getWith("with"==qH[2]?qH[3]:null),this._compileToTree(qV,qk.split("\n"),0,qR,qJ),qV.text="";continue}qV.setCondition(qH[0].substr(qC+1),1),qV.text=qF.getWith("with"==qH[2]?qH[3]:null);break;case"#import":qb=(qH=qD.splitToWords(qk,null))[1],qR.push({node:qV,file:qD.includes[qb],ofs:qV.text.length});continue}}else{if((qW=qS.childs[qS.childs.length-1])&&!qW.name){0<qR.length&&qD.splitToWords(qk,qW),qL=qV,qW.text+="\n"+qk;continue}0<qR.length&&qD.splitToWords(qk,qV)}qV.setParent(qS)}},qS.createShader=function(qS,q_,qa){var qR={},qJ="";if(qS)for(var qV in qS)qJ+="#define "+qV+"\n",qR[qV]=!0;var qW=this._VS.toscript(qR,[]),qk=this._PS.toscript(qR,[]);return(qa||qyS.create)(qJ+qW.join("\n"),qJ+qk.join("\n"),q_,this._nameMap)},qD._parseOne=function(qS,q_,qa,qR,qJ,qV){var qW={type:qD.shaderParamsMap[qa[qR+1]],name:qa[qR+2],size:isNaN(parseInt(qa[qR+3]))?1:parseInt(qa[qR+3])};return qV&&("attribute"==qJ?qS.push(qW):q_.push(qW)),":"==qa[qR+3]&&(qW.type=qa[qR+4],qR+=2),qR+=2},qD.addInclude=function(qS,q_){if(!q_||0===q_.length)throw new Error("add shader include file err:"+qS);if(qD.includes[qS])throw new Error("add shader include file err, has add:"+qS);qD.includes[qS]=new qa(q_)},qD.preGetParams=function(qS,q_){var qa=[qS,q_],qR={},qJ=[],qV=[],qW={},qk=[];qR.attributes=qJ,qR.uniforms=qV,qR.defines=qW;for(var qz=0,qb=0,qH=0;qH<2;qH++){qa[qH]=qa[qH].replace(qD._removeAnnotation,"");var qL,qC=qa[qH].match(qD._reg);for(qz=0,qb=qC.length;qz<qb;qz++){var qG=qC[qz];if("attribute"==qG||"uniform"==qG)qz=qD._parseOne(qJ,qV,qC,qz,qG,!0);else{if("#define"==qG){qk[qG=qC[++qz]]=1;continue}if("#ifdef"==qG){qW[qL=qC[++qz]]=qW[qL]||[];for(qz++;qz<qb;qz++)if("attribute"==(qG=qC[qz])||"uniform"==qG)qz=qD._parseOne(qJ,qV,qC,qz,qG,qk[qL]);else if("#else"==qG)for(qz++;qz<qb;qz++)if("attribute"==(qG=qC[qz])||"uniform"==qG)qz=qD._parseOne(qJ,qV,qC,qz,qG,!qk[qL]);else if("#endif"==qG)break}}}}return qR},qD.splitToWords=function(qS,q_){for(var qa,qR,qJ=[],qV=-1,qW=0,qk=qS.length;qW<qk;qW++)if(qa=qS.charAt(qW),0<=" \t=+-*/&%!<>()'\",;".indexOf(qa)){if(0<=qV&&1<qW-qV&&(qR=qS.substr(qV,qW-qV),qJ.push(qR)),'"'==qa||"'"==qa){var qz=qS.indexOf(qa,qW+1);if(qz<0)throw"Sharder err:"+qS;qJ.push(qS.substr(qW+1,qz-qW-1)),qW=qz,qV=-1;continue}"("==qa&&q_&&0<qJ.length&&(qR=qJ[qJ.length-1]+";","vec4;main;".indexOf(qR)<0&&(q_.useFuns+=qR)),qV=-1}else qV<0&&(qV=qW);return qV<qk&&1<qk-qV&&(qR=qS.substr(qV,qk-qV),qJ.push(qR)),qJ},qD.IFDEF_NO=0,qD.IFDEF_YES=1,qD.IFDEF_ELSE=2,qD.IFDEF_PARENT=3,qD._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),qD._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),qD._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),qD.includes={},qW(qD,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),qD.__init$=function(){qT=function(){function qa(qS){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=qS}qC(qa,"");var qS=qa.prototype;return qS.setParent=function(qS){qS.childs.push(this),this.z=qS.z+1,this.parent=qS},qS.setCondition=function(qS,q_){qS&&(this.conditionType=q_,qS=qS.replace(/(\s*$)/g,""),this.condition=function(){return this[qS]},this.condition.__condition=qS)},qS.toscript=function(qS,q_){return this._toscript(qS,q_,++qa.__id)},qS._toscript=function(qR,qJ,qV){if(this.childs.length<1&&!this.text)return qJ;qJ.length;if(this.condition){var qS=!!this.condition.call(qR);if(2===this.conditionType&&(qS=!qS),!qS)return qJ}if(this.text&&qJ.push(this.text),0<this.childs.length&&this.childs.forEach(function(qS,q_,qa){qS._toscript(qR,qJ,qV)}),0<this.includefiles.length&&0<this.useFuns.length)for(var q_,qa=0,qW=this.includefiles.length;qa<qW;qa++)this.includefiles[qa].curUseID!=qV&&0<(q_=this.includefiles[qa].file.getFunsScript(this.useFuns)).length&&(this.includefiles[qa].curUseID=qV,qJ[0]=q_+qJ[0]);return qJ},qa.__id=1,qa}(),qa=function(){function qS(qS){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=qS;for(var q_=0,qa=0,qR=0;!((q_=qS.indexOf("#begin",q_))<0);){for(qR=q_+5;!((qR=qS.indexOf("#end",qR))<0)&&"i"===qS.charAt(qR+4);)qR+=5;if(qR<0)throw"add include err,no #end:"+qS;qa=qS.indexOf("\n",q_);var qJ=qD.splitToWords(qS.substr(q_,qa-q_),null);"code"==qJ[1]?this.codes[qJ[2]]=qS.substr(qa+1,qR-qa-1):"function"==qJ[1]&&(qa=qS.indexOf("function",q_),qa+="function".length,this.funs[qJ[3]]=qS.substr(qa+1,qR-qa-1),this.funnames+=qJ[3]+";"),q_=qR+1}}qC(qS,"");var q_=qS.prototype;return q_.getWith=function(qS){var q_=qS?this.codes[qS]:this.script;if(!q_)throw"get with error:"+qS;return q_},q_.getFunsScript=function(qS){var q_="";for(var qa in this.funs)0<=qS.indexOf(qa+";")&&(q_+=this.funs[qa]);return q_},qS}()},qD}(),qjS=function(){function qW(){}return qC(qW,"laya.webgl.WebGL"),qW._uint8ArraySlice=function(){for(var qS=this.length,q_=new Uint8Array(this.length),qa=0;qa<qS;qa++)q_[qa]=this[qa];return q_},qW._float32ArraySlice=function(){for(var qS=this.length,q_=new Float32Array(this.length),qa=0;qa<qS;qa++)q_[qa]=this[qa];return q_},qW._uint16ArraySlice=function(qS){var q_,qa=arguments,qR=0,qJ=0;if(0===qa.length)for(qR=this.length,q_=new Uint16Array(qR),qJ=0;qJ<qR;qJ++)q_[qJ]=this[qJ];else if(2===qa.length){var qV=qa[0],qW=qa[1];if(qV<qW)for(qR=qW-qV,q_=new Uint16Array(qR),qJ=qV;qJ<qW;qJ++)q_[qJ-qV]=this[qJ];else q_=new Uint16Array(0)}return q_},qW.expandContext=function(){var qS=qJ.prototype,q_=CanvasRenderingContext2D.prototype;q_.fillTrangles=qS.fillTrangles,qES.__int__(null),q_.setIBVB=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){void 0===qz&&(qz=0),void 0===qb&&(qb=0),null===qa&&(this._ib=this._ib||qvS.QuadrangleIB,qa=this._ib,q$S.expandIBQuadrangle(qa,qR._byteLength/64+8)),this._setIBVB(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb)},q_.fillTrangles=function(qS,q_,qa,qR,qJ){this._curMat=this._curMat||qn.create(),this._vb=this._vb||qdS.create(),this._ib||(this._ib=qvS.create(),q$S.fillIBQuadrangle(this._ib,qW/4));var qV=this._vb,qW=qR.length>>4;q$S.fillTranglesVB(qV,q_,qa,qR,qJ||this._curMat,0,0),q$S.expandIBQuadrangle(this._ib,qV._byteLength/64+8);var qk=new qNS(1,0);qk.textureHost=qS;var qz=new qwS("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");qV._vertType=3,this._setIBVB(q_,qa,this._ib,qV,6*qW,qJ,qz,qk,0,0)}},qW.enable=function(){if(qG.__init__(),qF.isConchApp&&!qF.isConchWebGL)return qQ.skinAniSprite=function(){return new qSS},qW.expandContext(),!1;if(qQ.getWebGLContext=function(qS){for(var q_,qa=["webgl","experimental-webgl","webkit-3d","moz-webgl"],qR=0;qR<qa.length;qR++){try{q_=qS.getContext(qa[qR],{stencil:qq.isStencil,alpha:qq.isAlpha,antialias:qq.isAntialias,premultipliedAlpha:qq.premultipliedAlpha,preserveDrawingBuffer:qq.preserveDrawingBuffer})}catch(qS){}if(q_)return q_}return null},null==(qW.mainContext=qQ.getWebGLContext(qF._mainCanvas)))return!1;if(qF.isWebGL)return!0;qo.create=function(qS,q_){return new qS_(qS,q_)},q$.create=function(qS,q_,qa,qR,qJ,qV,qW){return new qcS(qS,q_,qa,qR,qJ,qV,qW)},qF.WebGL=qW,qF.isWebGL=!0,qGS.__init__(),qQ.createRenderSprite=function(qS,q_){return new qnS(qS,q_)},qQ.createWebGLContext2D=function(qS){return new qqS(qS)},qQ.changeWebGLSize=function(qS,q_){laya.webgl.WebGL.onStageResize(qS,q_)},qQ.createGraphics=function(){return new qmS};var qS=qQ.createFilterAction;return qQ.createFilterAction=qS||function(qS){return new qlS},qQ.clear=function(qS){qTS.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var q_=qF.context.ctx,qa=0==q_._submits._length||qq.preserveDrawingBuffer?qt.create(qS)._color:qA._wgColor;qa&&q_.clearBG(qa[0],qa[1],qa[2],qa[3]),qTS.clear()},qQ.addToAtlas=function(qS,q_){void 0===q_&&(q_=!1);var qa=qS.bitmap;qF.optimizeTextureMemory(qS.url,qS)?qm.__typeof(qa,"laya.webgl.resource.IMergeAtlasBitmap")&&qa.allowMerageInAtlas&&qa.on("recovered",qS,qS.addTextureToAtlas):qa.enableMerageInAtlas=!1},qQ.isAtlas=function(qS){return qS instanceof laya.webgl.atlas.AtlasWebGLCanvas},qs._enable(),qQ.beginFlush=function(){for(var qS=qs.instance,q_=qS.getAtlaserCount(),qa=0;qa<q_;qa++){var qR=qS.getAtlaserByIndex(qa).texture;qR._flashCacheImageNeedFlush&&qQ.flashFlushImage(qR)}},qQ.drawToCanvas=function(qS,q_,qa,qR,qJ,qV){(qa<=0||qR<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),qa|=0,qR|=0,qJ|=0,qV|=0;var qW=qrS.create(qa,qR,6408,5121,0,!1);qW.start(),qW.clear(0,0,0,0),qF.context.clear(),qT.renders[q_]._fun(qS,qF.context,qJ,qTS.height-qR+qV),qF.context.flush(),qW.end();var qk=qW.getData(0,0,qa,qR);if(qW.recycle(),qk.byteLength==qa*qR*4){var qz=new qiS;qz._canvas=qG.createElement("canvas"),qz.size(qa,qR);var qb=qz._canvas.getContext("2d");qG.canvas.size(qa,qR);var qH=qG.context,qL=qH.createImageData(qa,qR);return qL.data.set(new Uint8ClampedArray(qk.buffer)),qz._imgData=qL,qH.putImageData(qL,0,0),qb.save(),qb.translate(0,qR),qb.scale(1,-1),qb.drawImage(qG.canvas.source,0,0),qb.restore(),qz}console.log("drawToCanvas error: w:"+qa+",h:"+qR+",datalen:"+qk.byteLength)},qQ.createFilterAction=function(qS){var q_;switch(qS){case 32:q_=new qlS}return q_},qQ.addTextureToAtlas=function(qS){qS._uvID++,qs._atlasRestore++,qS.bitmap.enableMerageInAtlas&&qs.instance.addToAtlas(qS)},qQ.getTexturePixels=function(qS,q_,qa,qR,qJ){qF.context.ctx.clear();var qV=new qI;qV.graphics.drawTexture(qS,-q_,-qa);var qW=qrS.create(qR,qJ);qW.start(),qW.clear(0,0,0,0),qV.render(qF.context,0,0),qF.context.ctx.flush(),qW.end();for(var qk=qW.getData(0,0,qR,qJ),qz=[],qb=0,qH=qJ-1;0<=qH;qH--)for(var qL=0;qL<qR;qL++)qb=4*(qH*qR+qL),qz.push(qk[qb]),qz.push(qk[qb+1]),qz.push(qk[qb+2]),qz.push(qk[qb+3]);return qz},qQ.skinAniSprite=function(){return new qSS},qb.create=function(qS,q_){var qa=new qiS;return qa._imgData=q_,qa.flipY=!1,qa},qN._filterStart=function(qS,q_,qa,qR,qJ){var qV=qS.getValue("bounds"),qW=qrS.create(qV.width,qV.height);if(qW.start(),qW.clear(0,0,0,0),qS.addValue("src",qW),qS.addValue("ScissorTest",qTS.worldScissorTest),qTS.worldScissorTest){var qk=new qB;qk.copyFrom(qa.ctx._clipRect),qS.addValue("clipRect",qk),qTS.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},qN._filterEnd=function(qS,q_,qa,qR,qJ){var qV=qS.getValue("bounds");qS.getValue("src").end();var qW=qrS.create(qV.width,qV.height);qW.start(),qW.clear(0,0,0,0),qS.addValue("out",qW),q_._set$P("_filterCache",qW),q_._set$P("_isHaveGlowFilter",qS.getValue("_isHaveGlowFilter"))},qN._EndTarget=function(qS,q_){if(qS.getValue("src").recycle(),qS.getValue("out").end(),qS.getValue("ScissorTest")){qTS.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),q_.ctx.save();var qa=qS.getValue("clipRect");q_.ctx.clipRect(qa.x,qa.y,qa.width,qa.height)}},qN._useSrc=function(qS){var q_=qS.getValue("out");q_.end(),(q_=qS.getValue("src")).start(),q_.clear(0,0,0,0)},qN._endSrc=function(qS){qS.getValue("src").end()},qN._useOut=function(qS){var q_=qS.getValue("src");q_.end(),(q_=qS.getValue("out")).start(),q_.clear(0,0,0,0)},qN._endOut=function(qS){qS.getValue("out").end()},qN._recycleScope=function(qS){qS.recycle()},qN._filter=function(qS,q_,qa,qR){var qJ=this._next;if(qJ){var qV,qW,qk=qS.filters,qz=qk.length;if(1==qz&&32==qk[0].type)return q_.ctx.save(),q_.ctx.setFilters([qk[0]]),qJ._fun.call(qJ,qS,q_,qa,qR),void q_.ctx.restore();var qb=qkS.create(),qH=ql.TEMP,qL=q_.ctx._getTransformMatrix(),qC=qn.create();qL.copyTo(qC);var qG=0,qt=0,qo=!1,q$=qS._$P._filterCache?qS._$P._filterCache:null;if(!q$||qS._repaint){qo=qS._isHaveGlowFilter(),qb.addValue("_isHaveGlowFilter",qo),qo&&(qG=50,qt=25),(qW=new qB).copyFrom(qS.getSelfBounds()),qW.x+=qS.x,qW.y+=qS.y,qW.x-=qS.pivotX+4,qW.y-=qS.pivotY+4;var qF=qW.x,qT=qW.y;if(qW.width+=qG+8,qW.height+=qG+8,qH.x=qW.x*qC.a+qW.y*qC.c,qH.y=qW.y*qC.d+qW.x*qC.b,qW.x=qH.x,qW.y=qH.y,qH.x=qW.width*qC.a+qW.height*qC.c,qH.y=qW.height*qC.d+qW.width*qC.b,qW.width=qH.x,qW.height=qH.y,qW.width<=0||qW.height<=0)return;q$&&q$.recycle(),qb.addValue("bounds",qW);var qD=qWS.create([qb,qS,q_,0,0],qN._filterStart);q_.addRenderObject(qD),q_.ctx._renderKey=0,q_.ctx._shader2D.glTexture=null;var qj=qS.x-qF+qt,qQ=qS.y-qT+qt;qJ._fun.call(qJ,qS,q_,qj,qQ),qD=qWS.create([qb,qS,q_,0,0],qN._filterEnd),q_.addRenderObject(qD);for(var qm=0;qm<qz;qm++){0!=qm&&(qD=qWS.create([qb],qN._useSrc),q_.addRenderObject(qD),qV=qNS.create(1,0),qn.TEMP.identity(),q_.ctx.drawTarget(qb,0,0,qW.width,qW.height,qn.TEMP,"out",qV,null,qf.TOINT.overlay),qD=qWS.create([qb],qN._useOut),q_.addRenderObject(qD)),qk[qm].action.apply3d(qb,qS,q_,0,0)}qD=qWS.create([qb,q_],qN._EndTarget),q_.addRenderObject(qD)}else{if((qo=!!qS._$P._isHaveGlowFilter&&qS._$P._isHaveGlowFilter)&&(qG=50,qt=25),(qW=qS.getBounds()).width<=0||qW.height<=0)return;qW.width+=qG,qW.height+=qG,qH.x=qW.x*qC.a+qW.y*qC.c,qH.y=qW.y*qC.d+qW.x*qC.b,qW.x=qH.x,qW.y=qH.y,qH.x=qW.width*qC.a+qW.height*qC.c,qH.y=qW.height*qC.d+qW.width*qC.b,qW.width=qH.x,qW.height=qH.y,qb.addValue("out",q$)}qa=qa-qt-qS.x,qR=qR-qt-qS.y,qH.setTo(qa,qR),qC.transformPoint(qH),qa=qH.x+qW.x,qR=qH.y+qW.y,qV=qNS.create(1,0),qn.TEMP.identity(),q_.ctx.drawTarget(qb,qa,qR,qW.width,qW.height,qn.TEMP,"out",qV,null,qf.TOINT.overlay),qD=qWS.create([qb],qN._recycleScope),q_.addRenderObject(qD),qC.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=qW._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=qW._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=qW._uint8ArraySlice),!0},qW.onStageResize=function(qS,q_){null!=qW.mainContext&&(qW.mainContext.viewport(0,0,qS,q_),qTS.width=qS,qTS.height=q_)},qW.onInvalidGLRes=function(){qs.instance.freeAll(),qj.releaseContentManagers(!0),qW.doNodeRepaint(qm.stage),qW.mainContext.viewport(0,0,qTS.width,qTS.height),qm.stage.event("devicelost")},qW.doNodeRepaint=function(qS){0==qS.numChildren&&qS.repaint();for(var q_=0;q_<qS.numChildren;q_++)qW.doNodeRepaint(qS.getChildAt(q_))},qW.init=function(qS,q_,qa){qW.mainCanvas=qS,qb._createContext=function(qS){return new qqS(qS)},qiS._createContext=function(qS){return new qqS(qS)};var qR=laya.webgl.WebGL.mainContext;if(null!=qR.getShaderPrecisionFormat){var qJ=qR.getShaderPrecisionFormat(35633,36338),qV=qR.getShaderPrecisionFormat(35632,36338);qW.shaderHighPrecision=!(!qJ.precision||!qV.precision)}else qW.shaderHighPrecision=!1;if(qR.deleteTexture1=qR.deleteTexture,qR.deleteTexture=function(qS){qS==qQS.curBindTexValue&&(qQS.curBindTexValue=null),qR.deleteTexture1(qS)},qW.onStageResize(q_,qa),null==qW.mainContext)throw new Error("webGL getContext err!");qu.__init__(),qs.__init__(),qIS.__init__(),qVS.__init__(),qqS.__init__(),qNS.__init__(),qv.__init__(),qES.__int__(qR),qf._init_(qR),qF.isConchApp&&conch.setOnInvalidGLRes(qW.onInvalidGLRes)},qW.mainCanvas=null,qW.mainContext=null,qW.antialias=!0,qW.shaderHighPrecision=!1,qW._bg_null=[0,0,0,0],qW}(),qQS=function(){function qR(){}return qC(qR,"laya.webgl.WebGLContext"),qR.UseProgram=function(qS){return qR._useProgram!==qS&&(qjS.mainContext.useProgram(qS),qR._useProgram=qS,!0)},qR.setDepthTest=function(qS,q_){q_!==qR._depthTest&&((qR._depthTest=q_)?qS.enable(2929):qS.disable(2929))},qR.setDepthMask=function(qS,q_){q_!==qR._depthMask&&(qR._depthMask=q_,qS.depthMask(q_))},qR.setDepthFunc=function(qS,q_){q_!==qR._depthFunc&&(qR._depthFunc=q_,qS.depthFunc(q_))},qR.setBlend=function(qS,q_){q_!==qR._blend&&((qR._blend=q_)?qS.enable(3042):qS.disable(3042))},qR.setBlendFunc=function(qS,q_,qa){(q_!==qR._sFactor||qa!==qR._dFactor)&&(qR._sFactor=q_,qR._dFactor=qa,qS.blendFunc(q_,qa))},qR.setCullFace=function(qS,q_){q_!==qR._cullFace&&((qR._cullFace=q_)?qS.enable(2884):qS.disable(2884))},qR.setFrontFace=function(qS,q_){q_!==qR._frontFace&&(qR._frontFace=q_,qS.frontFace(q_))},qR.bindTexture=function(qS,q_,qa){qS.bindTexture(q_,qa),qR.curBindTexTarget=q_,qR.curBindTexValue=qa},qR.DEPTH_BUFFER_BIT=256,qR.STENCIL_BUFFER_BIT=1024,qR.COLOR_BUFFER_BIT=16384,qR.POINTS=0,qR.LINES=1,qR.LINE_LOOP=2,qR.LINE_STRIP=3,qR.TRIANGLES=4,qR.TRIANGLE_STRIP=5,qR.TRIANGLE_FAN=6,qR.ZERO=0,qR.ONE=1,qR.SRC_COLOR=768,qR.ONE_MINUS_SRC_COLOR=769,qR.SRC_ALPHA=770,qR.ONE_MINUS_SRC_ALPHA=771,qR.DST_ALPHA=772,qR.ONE_MINUS_DST_ALPHA=773,qR.DST_COLOR=774,qR.ONE_MINUS_DST_COLOR=775,qR.SRC_ALPHA_SATURATE=776,qR.FUNC_ADD=32774,qR.BLEND_EQUATION=32777,qR.BLEND_EQUATION_RGB=32777,qR.BLEND_EQUATION_ALPHA=34877,qR.FUNC_SUBTRACT=32778,qR.FUNC_REVERSE_SUBTRACT=32779,qR.BLEND_DST_RGB=32968,qR.BLEND_SRC_RGB=32969,qR.BLEND_DST_ALPHA=32970,qR.BLEND_SRC_ALPHA=32971,qR.CONSTANT_COLOR=32769,qR.ONE_MINUS_CONSTANT_COLOR=32770,qR.CONSTANT_ALPHA=32771,qR.ONE_MINUS_CONSTANT_ALPHA=32772,qR.BLEND_COLOR=32773,qR.ARRAY_BUFFER=34962,qR.ELEMENT_ARRAY_BUFFER=34963,qR.ARRAY_BUFFER_BINDING=34964,qR.ELEMENT_ARRAY_BUFFER_BINDING=34965,qR.STREAM_DRAW=35040,qR.STATIC_DRAW=35044,qR.DYNAMIC_DRAW=35048,qR.BUFFER_SIZE=34660,qR.BUFFER_USAGE=34661,qR.CURRENT_VERTEX_ATTRIB=34342,qR.FRONT=1028,qR.BACK=1029,qR.CULL_FACE=2884,qR.FRONT_AND_BACK=1032,qR.BLEND=3042,qR.DITHER=3024,qR.STENCIL_TEST=2960,qR.DEPTH_TEST=2929,qR.SCISSOR_TEST=3089,qR.POLYGON_OFFSET_FILL=32823,qR.SAMPLE_ALPHA_TO_COVERAGE=32926,qR.SAMPLE_COVERAGE=32928,qR.NO_ERROR=0,qR.INVALID_ENUM=1280,qR.INVALID_VALUE=1281,qR.INVALID_OPERATION=1282,qR.OUT_OF_MEMORY=1285,qR.CW=2304,qR.CCW=2305,qR.LINE_WIDTH=2849,qR.ALIASED_POINT_SIZE_RANGE=33901,qR.ALIASED_LINE_WIDTH_RANGE=33902,qR.CULL_FACE_MODE=2885,qR.FRONT_FACE=2886,qR.DEPTH_RANGE=2928,qR.DEPTH_WRITEMASK=2930,qR.DEPTH_CLEAR_VALUE=2931,qR.DEPTH_FUNC=2932,qR.STENCIL_CLEAR_VALUE=2961,qR.STENCIL_FUNC=2962,qR.STENCIL_FAIL=2964,qR.STENCIL_PASS_DEPTH_FAIL=2965,qR.STENCIL_PASS_DEPTH_PASS=2966,qR.STENCIL_REF=2967,qR.STENCIL_VALUE_MASK=2963,qR.STENCIL_WRITEMASK=2968,qR.STENCIL_BACK_FUNC=34816,qR.STENCIL_BACK_FAIL=34817,qR.STENCIL_BACK_PASS_DEPTH_FAIL=34818,qR.STENCIL_BACK_PASS_DEPTH_PASS=34819,qR.STENCIL_BACK_REF=36003,qR.STENCIL_BACK_VALUE_MASK=36004,qR.STENCIL_BACK_WRITEMASK=36005,qR.VIEWPORT=2978,qR.SCISSOR_BOX=3088,qR.COLOR_CLEAR_VALUE=3106,qR.COLOR_WRITEMASK=3107,qR.UNPACK_ALIGNMENT=3317,qR.PACK_ALIGNMENT=3333,qR.MAX_TEXTURE_SIZE=3379,qR.MAX_VIEWPORT_DIMS=3386,qR.SUBPIXEL_BITS=3408,qR.RED_BITS=3410,qR.GREEN_BITS=3411,qR.BLUE_BITS=3412,qR.ALPHA_BITS=3413,qR.DEPTH_BITS=3414,qR.STENCIL_BITS=3415,qR.POLYGON_OFFSET_UNITS=10752,qR.POLYGON_OFFSET_FACTOR=32824,qR.TEXTURE_BINDING_2D=32873,qR.SAMPLE_BUFFERS=32936,qR.SAMPLES=32937,qR.SAMPLE_COVERAGE_VALUE=32938,qR.SAMPLE_COVERAGE_INVERT=32939,qR.NUM_COMPRESSED_TEXTURE_FORMATS=34466,qR.COMPRESSED_TEXTURE_FORMATS=34467,qR.DONT_CARE=4352,qR.FASTEST=4353,qR.NICEST=4354,qR.GENERATE_MIPMAP_HINT=33170,qR.BYTE=5120,qR.UNSIGNED_BYTE=5121,qR.SHORT=5122,qR.UNSIGNED_SHORT=5123,qR.INT=5124,qR.UNSIGNED_INT=5125,qR.FLOAT=5126,qR.DEPTH_COMPONENT=6402,qR.ALPHA=6406,qR.RGB=6407,qR.RGBA=6408,qR.LUMINANCE=6409,qR.LUMINANCE_ALPHA=6410,qR.UNSIGNED_SHORT_4_4_4_4=32819,qR.UNSIGNED_SHORT_5_5_5_1=32820,qR.UNSIGNED_SHORT_5_6_5=33635,qR.FRAGMENT_SHADER=35632,qR.VERTEX_SHADER=35633,qR.MAX_VERTEX_ATTRIBS=34921,qR.MAX_VERTEX_UNIFORM_VECTORS=36347,qR.MAX_VARYING_VECTORS=36348,qR.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,qR.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,qR.MAX_TEXTURE_IMAGE_UNITS=34930,qR.MAX_FRAGMENT_UNIFORM_VECTORS=36349,qR.SHADER_TYPE=35663,qR.DELETE_STATUS=35712,qR.LINK_STATUS=35714,qR.VALIDATE_STATUS=35715,qR.ATTACHED_SHADERS=35717,qR.ACTIVE_UNIFORMS=35718,qR.ACTIVE_ATTRIBUTES=35721,qR.SHADING_LANGUAGE_VERSION=35724,qR.CURRENT_PROGRAM=35725,qR.NEVER=512,qR.LESS=513,qR.EQUAL=514,qR.LEQUAL=515,qR.GREATER=516,qR.NOTEQUAL=517,qR.GEQUAL=518,qR.ALWAYS=519,qR.KEEP=7680,qR.REPLACE=7681,qR.INCR=7682,qR.DECR=7683,qR.INVERT=5386,qR.INCR_WRAP=34055,qR.DECR_WRAP=34056,qR.VENDOR=7936,qR.RENDERER=7937,qR.VERSION=7938,qR.NEAREST=9728,qR.LINEAR=9729,qR.NEAREST_MIPMAP_NEAREST=9984,qR.LINEAR_MIPMAP_NEAREST=9985,qR.NEAREST_MIPMAP_LINEAR=9986,qR.LINEAR_MIPMAP_LINEAR=9987,qR.TEXTURE_MAG_FILTER=10240,qR.TEXTURE_MIN_FILTER=10241,qR.TEXTURE_WRAP_S=10242,qR.TEXTURE_WRAP_T=10243,qR.TEXTURE_2D=3553,qR.TEXTURE=5890,qR.TEXTURE_CUBE_MAP=34067,qR.TEXTURE_BINDING_CUBE_MAP=34068,qR.TEXTURE_CUBE_MAP_POSITIVE_X=34069,qR.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,qR.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,qR.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,qR.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,qR.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,qR.MAX_CUBE_MAP_TEXTURE_SIZE=34076,qR.TEXTURE0=33984,qR.TEXTURE1=33985,qR.TEXTURE2=33986,qR.TEXTURE3=33987,qR.TEXTURE4=33988,qR.TEXTURE5=33989,qR.TEXTURE6=33990,qR.TEXTURE7=33991,qR.TEXTURE8=33992,qR.TEXTURE9=33993,qR.TEXTURE10=33994,qR.TEXTURE11=33995,qR.TEXTURE12=33996,qR.TEXTURE13=33997,qR.TEXTURE14=33998,qR.TEXTURE15=33999,qR.TEXTURE16=34e3,qR.TEXTURE17=34001,qR.TEXTURE18=34002,qR.TEXTURE19=34003,qR.TEXTURE20=34004,qR.TEXTURE21=34005,qR.TEXTURE22=34006,qR.TEXTURE23=34007,qR.TEXTURE24=34008,qR.TEXTURE25=34009,qR.TEXTURE26=34010,qR.TEXTURE27=34011,qR.TEXTURE28=34012,qR.TEXTURE29=34013,qR.TEXTURE30=34014,qR.TEXTURE31=34015,qR.ACTIVE_TEXTURE=34016,qR.REPEAT=10497,qR.CLAMP_TO_EDGE=33071,qR.MIRRORED_REPEAT=33648,qR.FLOAT_VEC2=35664,qR.FLOAT_VEC3=35665,qR.FLOAT_VEC4=35666,qR.INT_VEC2=35667,qR.INT_VEC3=35668,qR.INT_VEC4=35669,qR.BOOL=35670,qR.BOOL_VEC2=35671,qR.BOOL_VEC3=35672,qR.BOOL_VEC4=35673,qR.FLOAT_MAT2=35674,qR.FLOAT_MAT3=35675,qR.FLOAT_MAT4=35676,qR.SAMPLER_2D=35678,qR.SAMPLER_CUBE=35680,qR.VERTEX_ATTRIB_ARRAY_ENABLED=34338,qR.VERTEX_ATTRIB_ARRAY_SIZE=34339,qR.VERTEX_ATTRIB_ARRAY_STRIDE=34340,qR.VERTEX_ATTRIB_ARRAY_TYPE=34341,qR.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,qR.VERTEX_ATTRIB_ARRAY_POINTER=34373,qR.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,qR.COMPILE_STATUS=35713,qR.LOW_FLOAT=36336,qR.MEDIUM_FLOAT=36337,qR.HIGH_FLOAT=36338,qR.LOW_INT=36339,qR.MEDIUM_INT=36340,qR.HIGH_INT=36341,qR.FRAMEBUFFER=36160,qR.RENDERBUFFER=36161,qR.RGBA4=32854,qR.RGB5_A1=32855,qR.RGB565=36194,qR.DEPTH_COMPONENT16=33189,qR.STENCIL_INDEX=6401,qR.STENCIL_INDEX8=36168,qR.DEPTH_STENCIL=34041,qR.RENDERBUFFER_WIDTH=36162,qR.RENDERBUFFER_HEIGHT=36163,qR.RENDERBUFFER_INTERNAL_FORMAT=36164,qR.RENDERBUFFER_RED_SIZE=36176,qR.RENDERBUFFER_GREEN_SIZE=36177,qR.RENDERBUFFER_BLUE_SIZE=36178,qR.RENDERBUFFER_ALPHA_SIZE=36179,qR.RENDERBUFFER_DEPTH_SIZE=36180,qR.RENDERBUFFER_STENCIL_SIZE=36181,qR.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,qR.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,qR.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,qR.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,qR.COLOR_ATTACHMENT0=36064,qR.DEPTH_ATTACHMENT=36096,qR.STENCIL_ATTACHMENT=36128,qR.DEPTH_STENCIL_ATTACHMENT=33306,qR.NONE=0,qR.FRAMEBUFFER_COMPLETE=36053,qR.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,qR.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,qR.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,qR.FRAMEBUFFER_UNSUPPORTED=36061,qR.FRAMEBUFFER_BINDING=36006,qR.RENDERBUFFER_BINDING=36007,qR.MAX_RENDERBUFFER_SIZE=34024,qR.INVALID_FRAMEBUFFER_OPERATION=1286,qR.UNPACK_FLIP_Y_WEBGL=37440,qR.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,qR.CONTEXT_LOST_WEBGL=37442,qR.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,qR.BROWSER_DEFAULT_WEBGL=37444,qR._useProgram=null,qR._depthTest=!0,qR._depthMask=!0,qR._blend=!1,qR._cullFace=!1,qR.curBindTexTarget=null,qR.curBindTexValue=null,qW(qR,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),qR}(),qmS=function(qS){function q_(){q_.__super.call(this)}qC(q_,"laya.webgl.display.GraphicsGL",qk);var qa=q_.prototype;return qa.setShader=function(qS){this._saveToCmd(qF.context._setShader,[qS])},qa.setIBVB=function(qS,q_,qa,qR,qJ,qV){this._saveToCmd(qF.context._setIBVB,[qS,q_,qa,qR,qJ,qV])},qa.drawParticle=function(qS,q_,qa){var qR=qQ.createParticleTemplate2D(qa);qR.x=qS,qR.y=q_,this._saveToCmd(qF.context._drawParticle,[qR])},q_}(),qqS=function(qS){var qa;function qx(qS){this._x=0,this._y=0,this._id=++qx._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,qx.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=qx.MAXCLIPRECT,this.mOutPoint,this._canvas=qS,this._canvas._addReference(),qx._contextcount++,qF.isFlash?(this._ib=qvS.create(35044),q$S.fillIBQuadrangle(this._ib,16)):this._ib=qvS.QuadrangleIB,this.clear()}qC(qx,"laya.webgl.canvas.WebGLContext2D",qJ);var q_=qx.prototype;return q_.setIsMainContext=function(){this._isMain=!0},q_.clearBG=function(qS,q_,qa,qR){var qJ=qjS.mainContext;qJ.clearColor(qS,q_,qa,qR),qJ.clear(16384)},q_._getSubmits=function(){return this._submits},q_._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var qS=0,q_=this._submits._length;qS<q_;qS++)this._submits[qS].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},q_.destroy=function(){--qx._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=qvS.QuadrangleIB&&this._ib.releaseResource()},q_.clear=function(){this._submits||(this._other=qa.DEFAULT,this._curMat=qn.create(),this._vb=qdS.create(-1),this._submits=[],this._save=[qy.Create(this)],this._save.length=10,this._shader2D=new qv,this._triangleMesh=qPS.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=qa.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=qx.MAXCLIPRECT,this._curSubmit=qVS.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=qY.DEFAULT;for(var qS=0,q_=this._submits._length;qS<q_;qS++)this._submits[qS].releaseRender(),this._submits[qS]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},q_.size=function(qS,q_){if(this._width!=qS||this._height!=q_)if(0==qS||0==q_){0!=this._vb._byteLength&&(this._width=qS,this._height=q_,this._vb.clear(),this._vb.upload());for(var qa=0,qR=this._submits._length;qa<qR;qa++)this._submits[qa].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=qS,this._height=q_,this._targets&&this._targets.size(qS,q_),this._canvas.memorySize-=this._canvas.memorySize;0===qS&&0===q_&&this._releaseMem()},q_._getTransformMatrix=function(){return this._curMat},q_.translate=function(qS,q_){0===qS&&0===q_||(qO.save(this),this._curMat.bTransform&&(qE.save(this),this._curMat.transformPointN(ql.TEMP.setTo(qS,q_)),qS=ql.TEMP.x,q_=ql.TEMP.y),this._x+=qS,this._y+=q_)},q_.save=function(){this._save[this._save._length++]=qy.Create(this)},q_.restore=function(){var qS=this._save._length;if(!(qS<1))for(var q_=qS-1;0<=q_;q_--){var qa=this._save[q_];if(qa.restore(this),qa.isSaveMark())return void(this._save._length=q_)}},q_._fillText=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){void 0===qb&&(qb=0);var qH=this._shader2D,qL=this._curSubmit.shaderValue,qC=qJ?qtS.create(qJ):this._other.font;if(qs.enabled)qH.ALPHA!==qL.ALPHA&&(qH.glTexture=null),qGS.drawText(this,qS,q_,this._curMat,qC,qz||this._other.textAlign,qV,qW,qk,qa,qR,qb);else{this._shader2D.defines.getValue();var qG=qV?qt.create(qV)._color:qH.colorAdd;qH.ALPHA===qL.ALPHA&&qG===qH.colorAdd&&qL.colorAdd===qH.colorAdd||(qH.glTexture=null,qH.colorAdd=qG),qGS.drawText(this,qS,q_,this._curMat,qC,qz||this._other.textAlign,qV,qW,qk,qa,qR,qb)}},q_.fillWords=function(qS,q_,qa,qR,qJ,qV){this._fillText(null,qS,q_,qa,qR,qJ,null,-1,null,qV)},q_.fillBorderWords=function(qS,q_,qa,qR,qJ,qV,qW){this._fillBorderText(null,qS,q_,qa,qR,qJ,qV,qW,null)},q_.fillText=function(qS,q_,qa,qR,qJ,qV){this._fillText(qS,null,q_,qa,qR,qJ,null,-1,qV)},q_.strokeText=function(qS,q_,qa,qR,qJ,qV,qW){this._fillText(qS,null,q_,qa,qR,null,qJ,qV||1,qW)},q_.fillBorderText=function(qS,q_,qa,qR,qJ,qV,qW,qk){this._fillBorderText(qS,null,q_,qa,qR,qJ,qV,qW,qk)},q_._fillBorderText=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){if(!qs.enabled)return this._fillText(qS,q_,qa,qR,qJ,null,qW,qk||1,qz),void this._fillText(qS,q_,qa,qR,qJ,qV,null,-1,qz);var qb=this._shader2D,qH=this._curSubmit.shaderValue;qb.ALPHA!==qH.ALPHA&&(qb.glTexture=null);var qL=qJ?(qx._fontTemp.setFont(qJ),qx._fontTemp):this._other.font;qGS.drawText(this,qS,q_,this._curMat,qL,qz||this._other.textAlign,qV,qW,qk||1,qa,qR,0)},q_.fillRect=function(qS,q_,qa,qR,qJ){var qV=this._vb;if(q$S.fillRectImgVb(qV,this._clipRect,qS,q_,qa,qR,qP.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var qW=this._shader2D.fillStyle;qJ&&(this._shader2D.fillStyle=qY.create(qJ));var qk=this._shader2D,qz=this._curSubmit.shaderValue;if(qk.fillStyle!==qz.fillStyle||qk.ALPHA!==qz.ALPHA){qk.glTexture=null;var qb=this._curSubmit=qVS.createSubmit(this,this._ib,qV,(qV._byteLength-64)/32*3,qNS.create(2,0));qb.shaderValue.color=qk.fillStyle._color._color,qb.shaderValue.ALPHA=qk.ALPHA,this._submits[this._submits._length++]=qb}this._curSubmit._numEle+=6,this._shader2D.fillStyle=qW}},q_.fillTexture=function(qS,q_,qa,qR,qJ,qV,qW,qk){if(qS.loaded&&qS.bitmap&&qS.source){var qz=this._vb,qb=qS.bitmap.width,qH=qS.bitmap.height,qL=qS.uv,qC=qW.x%qS.width,qG=qW.y%qS.height;if(qb!=qk.w||qH!=qk.h){if(!qk.w&&!qk.h)switch(qk.oy=qk.ox=0,qV){case"repeat":qk.width=qR,qk.height=qJ;break;case"repeat-x":qk.width=qR,qG<0?qS.height+qG>qJ?qk.height=qJ:qk.height=qS.height+qG:(qk.oy=qG,qS.height+qG>qJ?qk.height=qJ-qG:qk.height=qS.height);break;case"repeat-y":qC<0?qS.width+qC>qR?qk.width=qR:qk.width=qS.width+qC:(qk.ox=qC,qS.width+qC>qR?qk.width=qR-qC:qk.width=qS.width),qk.height=qJ;break;case"no-repeat":qC<0?qS.width+qC>qR?qk.width=qR:qk.width=qS.width+qC:(qk.ox=qC,qS.width+qC>qR?qk.width=qR-qC:qk.width=qS.width),qG<0?qS.height+qG>qJ?qk.height=qJ:qk.height=qS.height+qG:(qk.oy=qG,qS.height+qG>qJ?qk.height=qJ-qG:qk.height=qS.height);break;default:qk.width=qR,qk.height=qJ}qk.w=qb,qk.h=qH,qk.uv=[0,0,qk.width/qb,0,qk.width/qb,qk.height/qH,0,qk.height/qH]}if(q_+=qk.ox,qa+=qk.oy,qC-=qk.ox,qG-=qk.oy,q$S.fillRectImgVb(qz,this._clipRect,q_,qa,qk.width,qk.height,qk.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var qt=qKS.create(this,this._ib,qz,(qz._byteLength-64)/32*3,qNS.create(256,0)),qo=(this._submits[this._submits._length++]=qt).shaderValue;qo.textureHost=qS;var q$=qL[0]*qb,qF=qL[1]*qH,qT=(qL[2]-qL[0])*qb,qD=(qL[5]-qL[3])*qH,qj=-qC/qb,qQ=-qG/qH;qo.u_TexRange[0]=q$/qb,qo.u_TexRange[1]=qT/qb,qo.u_TexRange[2]=qF/qH,qo.u_TexRange[3]=qD/qH,qo.u_offset[0]=qj,qo.u_offset[1]=qQ,qs.enabled&&!this._isMain&&qt.addTexture(qS,(qz._byteLength>>2)-16),(this._curSubmit=qt)._renderType=10017,qt._numEle+=6}}else this.sprite&&qm.timer.callLater(this,this._repaintSprite)},q_.setShader=function(qS){qZ.save(this,1048576,this._shader2D,!0),this._shader2D.shader=qS},q_.setFilters=function(qS){qZ.save(this,2097152,this._shader2D,!0),this._shader2D.filters=qS,this._curSubmit=qVS.RENDERBASE,this._renderKey=0,this._drawCount++},q_.drawTexture=function(qS,q_,qa,qR,qJ,qV,qW){this._drawTextureM(qS,q_,qa,qR,qJ,qV,qW,null,1)},q_.addTextureVb=function(qS,q_,qa){var qR=this._curSubmit._vb||this._vb,qJ=qR._byteLength>>2;qR.byteLength=qJ+16<<2;for(var qV=qR.getFloat32Array(),qW=0;qW<16;qW+=4)qV[qJ++]=qS[qW]+q_,qV[qJ++]=qS[qW+1]+qa,qV[qJ++]=qS[qW+2],qV[qJ++]=qS[qW+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),qR._upload=!0},q_.willDrawTexture=function(qS,q_){if(!(qS.loaded&&qS.bitmap&&qS.source))return this.sprite&&qm.timer.callLater(this,this._repaintSprite),0;var qa=qS.bitmap,qR=qa.id+this._shader2D.ALPHA*q_+10016;if(qR==this._renderKey)return qR;var qJ=this._shader2D,qV=qJ.ALPHA,qW=this._curSubmit.shaderValue;qJ.ALPHA*=q_,this._renderKey=qR,this._drawCount++,qJ.glTexture=qa;var qk=this._vb,qz=null,qb=qk._byteLength/32*3,qH=qW.textureHost&&qW.textureHost==qS&&qW.textureHost.alphaTexture==qS.alphaTexture;return qz=qKS.create(this,this._ib,qk,qb,qNS.create(1,0)),(this._submits[this._submits._length++]=qz).shaderValue.textureHost=qS,qz._renderType=10016,qz._preIsSameTextureShader=10016===this._curSubmit._renderType&&qJ.ALPHA===qW.ALPHA&&qH,this._curSubmit=qz,qJ.ALPHA=qV,qR},q_.drawTextures=function(qS,q_,qa,qR){if(qS.loaded&&qS.bitmap&&qS.source){var qJ=this._clipRect;if(this._clipRect=qx.MAXCLIPRECT,this._drawTextureM(qS,q_[0],q_[1],qS.width,qS.height,qa,qR,null,1)){if(this._clipRect=qJ,qX.drawCall++,!(q_.length<4)){for(var qV=this._curSubmit._vb||this._vb,qW=this._curMat.a,qk=this._curMat.d,qz=2,qb=q_.length;qz<qb;qz+=2)q$S.copyPreImgVb(qV,(q_[qz]-q_[qz-2])*qW,(q_[qz+1]-q_[qz-1])*qk),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&qm.timer.callLater(this,this._repaintSprite)},q_._drawTextureM=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){if(!qS.loaded||!qS.source)return this.sprite&&qm.timer.callLater(this,this._repaintSprite),!1;var qb=this._curSubmit._vb||this._vb,qH=qS.bitmap;q_+=qV,qa+=qW,this._drawCount++;var qL=qH.id+this._shader2D.ALPHA*qz+10016;if(qL!=this._renderKey){this._renderKey=qL;var qC=this._curSubmit.shaderValue,qG=this._shader2D,qt=qG.ALPHA;qG.ALPHA*=qz,qG.glTexture=qH;var qo=this._vb,q$=null,qF=qo._byteLength/32*3,qT=qC.textureHost&&qC.textureHost==qS&&qC.textureHost.alphaTexture==qS.alphaTexture;q$=qKS.create(this,this._ib,qo,qF,qNS.create(1,0)),(this._submits[this._submits._length++]=q$).shaderValue.textureHost=qS,q$._renderType=10016,q$._preIsSameTextureShader=10016===this._curSubmit._renderType&&qG.ALPHA===qC.ALPHA&&qT,this._curSubmit=q$,qb=this._curSubmit._vb||this._vb,qG.ALPHA=qt}return!!q$S.fillRectImgVb(qb,this._clipRect,q_,qa,qR||qS.width,qJ||qS.height,qS.uv,qk||this._curMat,this._x,this._y,0,0)&&(qs.enabled&&!this._isMain&&this._curSubmit.addTexture(qS,(qb._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},q_._repaintSprite=function(){this.sprite&&this.sprite.repaint()},q_._drawText=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){var qH=qS.bitmap;this._drawCount++;var qL=qH.id+this._shader2D.ALPHA+10016;if(qL!=this._renderKey){this._renderKey=qL;var qC=this._curSubmit.shaderValue,qG=this._shader2D;qG.glTexture=qH;var qt=this._vb,qo=null,q$=qt._byteLength/32*3,qF=qC.textureHost&&qC.textureHost==qS&&qC.textureHost.alphaTexture==qS.alphaTexture;(qo=qs.enabled?qKS.create(this,this._ib,qt,q$,qNS.create(1,0)):qKS.create(this,this._ib,qt,q$,qOS.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&qG.ALPHA===qC.ALPHA&&qF,(this._submits[this._submits._length++]=qo).shaderValue.textureHost=qS,qo._renderType=10016,this._curSubmit=qo}qS.active();var qT=this._curSubmit._vb||this._vb;q$S.fillRectImgVb(qT,this._clipRect,q_+qW,qa+qk,qR||qS.width,qJ||qS.height,qS.uv,qV||this._curMat,this._x,this._y,qz,qb,!0)&&(qs.enabled&&!this._isMain&&this._curSubmit.addTexture(qS,(qT._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},q_.drawTextureWithTransform=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){if(qV){var qb=this._curMat,qH=this._x,qL=this._y;(0!==qW||0!==qk)&&(this._x=qW*qb.a+qk*qb.c,this._y=qk*qb.d+qW*qb.b),qV&&qb.bTransform?(qn.mul(qV,qb,qx._tmpMatrix),(qV=qx._tmpMatrix)._checkTransform()):(this._x+=qb.tx,this._y+=qb.ty),this._drawTextureM(qS,q_,qa,qR,qJ,0,0,qV,qz),this._x=qH,this._y=qL}else this._drawTextureM(qS,q_,qa,qR,qJ,qW,qk,null,qz)},q_.fillQuadrangle=function(qS,q_,qa,qR,qJ){var qV=this._curSubmit,qW=this._vb,qk=this._shader2D,qz=qV.shaderValue;if(this._renderKey=0,qS.bitmap){var qb=qS.bitmap;qk.glTexture==qb&&qk.ALPHA===qz.ALPHA||(qk.glTexture=qb,(qV=this._curSubmit=qVS.createSubmit(this,this._ib,qW,qW._byteLength/32*3,qNS.create(1,0))).shaderValue.glTexture=qb,this._submits[this._submits._length++]=qV),q$S.fillQuadrangleImgVb(qW,q_,qa,qR,qS.uv,qJ||this._curMat,this._x,this._y)}else qV.shaderValue.fillStyle&&qV.shaderValue.fillStyle.equal(qS)&&qk.ALPHA===qz.ALPHA||(qk.glTexture=null,(qV=this._curSubmit=qVS.createSubmit(this,this._ib,qW,qW._byteLength/32*3,qNS.create(2,0))).shaderValue.defines.add(2),qV.shaderValue.fillStyle=qY.create(qS),this._submits[this._submits._length++]=qV),q$S.fillQuadrangleImgVb(qW,q_,qa,qR,qP.DEF_UV,qJ||this._curMat,this._x,this._y);qV._numEle+=6},q_.drawTexture2=function(qS,q_,qa,qR,qJ,qV,qW,qk){if(0!=qV){var qz=this._curMat;if(this._x=qS*qz.a+q_*qz.c,this._y=q_*qz.d+qS*qz.b,qJ&&(qJ=qz.bTransform||qJ.bTransform?(qn.mul(qJ,qz,qx._tmpMatrix),qx._tmpMatrix):(this._x+=qJ.tx+qz.tx,this._y+=qJ.ty+qz.ty,qn.EMPTY)),1!==qV||qW){var qb=this._shader2D.ALPHA,qH=this._nBlendType;this._shader2D.ALPHA=qV,qW&&(this._nBlendType=qf.TOINT(qW)),this._drawTextureM(qk[0],qk[1]-qa,qk[2]-qR,qk[3],qk[4],0,0,qJ,1),this._shader2D.ALPHA=qb,this._nBlendType=qH}else this._drawTextureM(qk[0],qk[1]-qa,qk[2]-qR,qk[3],qk[4],0,0,qJ,1);this._x=this._y=0}},q_.drawCanvas=function(qS,q_,qa,qR,qJ){var qV=qS.context;if(this._renderKey=0,qV._targets)this._submits[this._submits._length++]=quS.create(qV,0,null),this._curSubmit=qVS.RENDERBASE,qV._targets.drawTo(this,q_,qa,qR,qJ);else{var qW=this._submits[this._submits._length++]=quS.create(qV,this._shader2D.ALPHA,this._shader2D.filters),qk=qR/qS.width,qz=qJ/qS.height,qb=qW._matrix;this._curMat.copyTo(qb),1!=qk&&1!=qz&&qb.scale(qk,qz);var qH=qb.tx,qL=qb.ty;qb.tx=qb.ty=0,qb.transformPoint(ql.TEMP.setTo(q_,qa)),qb.translate(ql.TEMP.x+qH,ql.TEMP.y+qL),this._curSubmit=qVS.RENDERBASE}qq.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=qV._targets?"yellow":"green",this.strokeRect(q_-1,qa-1,qR+2,qJ+2,1),this.strokeRect(q_,qa,qR,qJ,1),this.restore())},q_.drawTarget=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){void 0===qb&&(qb=-1);var qH=this._vb;if(q$S.fillRectImgVb(qH,this._clipRect,q_,qa,qR,qJ,qz||qP.DEF_UV,qV||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var qL=this._curSubmit=qLS.create(this,this._ib,qH,(qH._byteLength-64)/32*3,qk,qW);qL.blendType=-1==qb?this._nBlendType:qb,qL.scope=qS,this._submits[this._submits._length++]=qL,this._curSubmit._numEle+=6}},q_.mixRGBandAlpha=function(qS){return this._mixRGBandAlpha(qS,this._shader2D.ALPHA)},q_._mixRGBandAlpha=function(qS,q_){var qa=(4278190080&qS)>>>24;return 0!=qa?qa*=q_:qa=255*q_,16777215&qS|qa<<24},q_.drawTriangles=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){if(!qS.loaded||!qS.source)return this.sprite&&qm.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;qS.bitmap;var qH=this._mixRGBandAlpha(4294967295,qk),qL=(qR.length,qV.length);this._renderKey=-1;var qC=this._curSubmit=qKS.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,qNS.create(1,0));return qC.shaderValue.textureHost=qS,qC._renderType=10016,this._submits[this._submits._length++]=qC,qW?(qx._tmpMatrix.a=qW.a,qx._tmpMatrix.b=qW.b,qx._tmpMatrix.c=qW.c,qx._tmpMatrix.d=qW.d,qx._tmpMatrix.tx=qW.tx+q_,qx._tmpMatrix.ty=qW.ty+qa,qn.mul(qx._tmpMatrix,this._curMat,qx._tmpMatrix)):(qx._tmpMatrix.a=this._curMat.a,qx._tmpMatrix.b=this._curMat.b,qx._tmpMatrix.c=this._curMat.c,qx._tmpMatrix.d=this._curMat.d,qx._tmpMatrix.tx=this._curMat.tx+q_,qx._tmpMatrix.ty=this._curMat.ty+qa),this._triangleMesh.addData(qR,qJ,qV,qx._tmpMatrix,qH,this),this._curSubmit._numEle+=qL,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},q_.transform=function(qS,q_,qa,qR,qJ,qV){qE.save(this),qn.mul(qn.TEMP.setTo(qS,q_,qa,qR,qJ,qV),this._curMat,this._curMat),this._curMat._checkTransform()},q_.setTransformByMatrix=function(qS){qS.copyTo(this._curMat)},q_.transformByMatrix=function(qS){qE.save(this),qn.mul(qS,this._curMat,this._curMat),this._curMat._checkTransform()},q_.rotate=function(qS){qE.save(this),this._curMat.rotateEx(qS)},q_.scale=function(qS,q_){qE.save(this),this._curMat.scaleEx(qS,q_)},q_.clipRect=function(qS,q_,qa,qR){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var qJ=qHS.create(4);this.addRenderObject(qJ);var qV=this._vb,qW=qV._byteLength>>2;if(q$S.fillRectImgVb(qV,null,qS,q_,qa,qR,qP.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var qk=this._curSubmit=qVS.createSubmit(this,this._ib,qV,(qV._byteLength-64)/32*3,qNS.create(2,0));qk.shaderValue.ALPHA=1,this._submits[this._submits._length++]=qk,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var qz=qHS.create(5);this.addRenderObject(qz);var qb=qV.getFloat32Array(),qH=Math.min(Math.min(Math.min(qb[0+qW],qb[4+qW]),qb[8+qW]),qb[12+qW]),qL=Math.max(Math.max(Math.max(qb[0+qW],qb[4+qW]),qb[8+qW]),qb[12+qW]),qC=Math.min(Math.min(Math.min(qb[1+qW],qb[5+qW]),qb[9+qW]),qb[13+qW]),qG=Math.max(Math.max(Math.max(qb[1+qW],qb[5+qW]),qb[9+qW]),qb[13+qW]);qc.save(this,qz,qS,q_,qa,qR,qH,qC,qL-qH,qG-qC),this._curSubmit=qVS.RENDERBASE}else{qa*=this._curMat.a,qR*=this._curMat.d;var qt=ql.TEMP;this._curMat.transformPoint(qt.setTo(qS,q_)),qa<0&&(qt.x=qt.x+qa,qa=-qa),qR<0&&(qt.y=qt.y+qR,qR=-qR),this._renderKey=0;var qo=this._curSubmit=qbS.create(this);(this._submits[this._submits._length++]=qo).submitIndex=this._submits._length,qo.submitLength=9999999,qp.save(this,qo);var q$=this._clipRect,qF=q$.x,qT=q$.y,qD=qt.x+qa,qj=qt.y+qR;qF<qt.x&&(q$.x=qt.x),qT<qt.y&&(q$.y=qt.y),q$.width=Math.min(qD,qF+q$.width)-q$.x,q$.height=Math.min(qj,qT+q$.height)-q$.y,this._shader2D.glTexture=null,qo.clipRect.copyFrom(q$),this._curSubmit=qVS.RENDERBASE}},q_.setIBVB=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH){if(void 0===qz&&(qz=0),void 0===qb&&(qb=0),void 0===qH&&(qH=0),null===qa){if(qF.isFlash){var qL=qR;qL._selfIB||(qL._selfIB=qvS.create(35044)),qL._selfIB.clear(),qa=qL._selfIB}else qa=this._ib;q$S.expandIBQuadrangle(qa,qR._byteLength/(4*qR.vertexStride*4))}if(!qk||!qW)throw Error("setIBVB must input:shader shaderValues");var qC=qzS.create(this,qR,qa,qJ,qW,qk,qz,qb,qH);qV||(qV=qn.EMPTY),qV.translate(qS,q_),qn.mul(qV,this._curMat,qC._mat),qV.translate(-qS,-q_),this._submits[this._submits._length++]=qC,this._curSubmit=qVS.RENDERBASE,this._renderKey=0},q_.addRenderObject=function(qS){this._submits[this._submits._length++]=qS},q_.fillTrangles=function(qS,q_,qa,qR,qJ){var qV=this._curSubmit,qW=this._vb,qk=this._shader2D,qz=qV.shaderValue,qb=qR.length>>4,qH=qS.bitmap;this._renderKey=0,qk.glTexture==qH&&qk.ALPHA===qz.ALPHA||((qV=this._curSubmit=qVS.createSubmit(this,this._ib,qW,qW._byteLength/32*3,qNS.create(1,0))).shaderValue.textureHost=qS,this._submits[this._submits._length++]=qV),q$S.fillTranglesVB(qW,q_,qa,qR,qJ||this._curMat,this._x,this._y),qV._numEle+=6*qb},q_.submitElement=function(qS,q_){var qa=this._submits;for(q_<0&&(q_=qa._length);qS<q_;)qS+=qa[qS].renderSubmit()},q_.finish=function(){qjS.mainContext.finish()},q_.flush=function(){var qS=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(qS>this._ib.bufferLength/12&&q$S.expandIBQuadrangle(this._ib,qS),!this._isMain&&qs.enabled&&qs._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=qs._atlasRestore;for(var q_=this._submits,qa=0,qR=q_._length;qa<qR;qa++){var qJ=q_[qa];10016===qJ.getRenderType()&&qJ.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),q_S.instance&&q_S.getInstance().reset();var qV;for(qa=0,qV=this.meshlist.length;qa<qV;qa++){var qW=this.meshlist[qa];qW.canReuse?qW.releaseMesh():qW.destroy()}return this.meshlist.length=0,this._curSubmit=qVS.RENDERBASE,this._renderKey=0,this._triangleMesh=qPS.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},q_.setPathId=function(qS){if(this.mId=qS,-1!=this.mId){this.mHaveKey=!1;var q_=qr.getInstance();q_.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,q_.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},q_.movePath=function(qS,q_){var qa=qS,qR=q_;qS=this._curMat.a*qa+this._curMat.c*qR+this._curMat.tx,q_=this._curMat.b*qa+this._curMat.d*qR+this._curMat.ty,this.mX+=qS,this.mY+=q_},q_.beginPath=function(){var qS=this._getPath();qS.tempArray.length=0,qS.closePath=!1,this.mX=0,this.mY=0},q_.closePath=function(){this._path.closePath=!0},q_.fill=function(qS){void 0===qS&&(qS=!1);var q_=this._getPath();this.drawPoly(0,0,q_.tempArray,this.fillStyle._color.numColor,0,0,qS)},q_.stroke=function(){var qS=this._getPath();if(0<this.lineWidth){if(-1==this.mId)qS.drawLine(0,0,qS.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var q_=qr.getInstance().shapeLineDic[this.mId];q_.rebuild(qS.tempArray),qS.setGeomtry(q_)}else qr.getInstance().addLine(this.mId,qS.drawLine(0,0,qS.tempArray,this.lineWidth,this.strokeStyle._color.numColor));qS.update();var qa=[this.mX,this.mY],qR=qVS.createShape(this,qS.ib,qS.vb,qS.count,qS.offset,qNS.create(4,0));qR.shaderValue.ALPHA=this._shader2D.ALPHA,qR.shaderValue.u_pos=qa,qR.shaderValue.u_mmat2=qTS.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=qR,this._renderKey=-1}},q_.line=function(qS,q_,qa,qR,qJ,qV){var qW=this._curSubmit,qk=this._vb;if(q$S.fillLineVb(qk,this._clipRect,qS,q_,qa,qR,qJ,qV)){this._renderKey=0;var qz=this._shader2D,qb=qW.shaderValue;qz.strokeStyle===qb.strokeStyle&&qz.ALPHA===qb.ALPHA||(qz.glTexture=null,(qW=this._curSubmit=qVS.createSubmit(this,this._ib,qk,(qk._byteLength-64)/32*3,qNS.create(2,0))).shaderValue.strokeStyle=qz.strokeStyle,qW.shaderValue.mainID=2,qW.shaderValue.ALPHA=qz.ALPHA,this._submits[this._submits._length++]=qW),qW._numEle+=6}},q_.moveTo=function(qS,q_,qa){void 0===qa&&(qa=!0);var qR=this._getPath();if(qa){var qJ=qS,qV=q_;qS=this._curMat.a*qJ+this._curMat.c*qV,q_=this._curMat.b*qJ+this._curMat.d*qV}qR.addPoint(qS,q_)},q_.lineTo=function(qS,q_,qa){void 0===qa&&(qa=!0);var qR=this._getPath();if(qa){var qJ=qS,qV=q_;qS=this._curMat.a*qJ+this._curMat.c*qV,q_=this._curMat.b*qJ+this._curMat.d*qV}qR.addPoint(qS,q_)},q_.drawCurves=function(qS,q_,qa){this.setPathId(-1),this.beginPath(),this.strokeStyle=qa[3],this.lineWidth=qa[4];var qR=qa[2];qS+=qa[0],q_+=qa[1],this.movePath(qS,q_),this.moveTo(qR[0],qR[1]);for(var qJ=2,qV=qR.length;qJ<qV;)this.quadraticCurveTo(qR[qJ++],qR[qJ++],qR[qJ++],qR[qJ++]);this.stroke()},q_.arcTo=function(qS,q_,qa,qR,qJ){if(-1==this.mId||!this.mHaveKey){var qV=0,qW=0,qk=0,qz=this._getPath();this._curMat.copyTo(qx._tmpMatrix),qx._tmpMatrix.tx=qx._tmpMatrix.ty=0,qx._tempPoint.setTo(qz.getEndPointX(),qz.getEndPointY()),qx._tmpMatrix.invertTransformPoint(qx._tempPoint);var qb=qx._tempPoint.x-qS,qH=qx._tempPoint.y-q_,qL=Math.sqrt(qb*qb+qH*qH);if(!(qL<=1e-6)){var qC=qb/qL,qG=qH/qL,qt=qa-qS,qo=qR-q_,q$=qt*qt+qo*qo,qF=Math.sqrt(q$);if(!(qF<=1e-6)){var qT=qt/qF,qD=qo/qF,qj=qC+qT,qQ=qG+qD,qm=Math.sqrt(qj*qj+qQ*qQ);if(!(qm<=1e-6)){var qq=qj/qm,qN=qQ/qm,qn=Math.acos(qq*qC+qN*qG),ql=Math.PI/2-qn,qB=(qL=qJ/Math.tan(ql))*qC+qS,qI=qL*qG+q_,qA=Math.sqrt(qL*qL+qJ*qJ),qX=qS+qq*qA,qh=q_+qN*qA,qu=0,qK=0;if(0<=qC*qD-qG*qT){var qP=2*ql/qx.SEGNUM;qu=Math.sin(qP),qK=Math.cos(qP)}else qP=2*-ql/qx.SEGNUM,qu=Math.sin(qP),qK=Math.cos(qP);qW=this._curMat.a*qB+this._curMat.c*qI,qk=this._curMat.b*qB+this._curMat.d*qI,qW==this._path.getEndPointX()&&qk==this._path.getEndPointY()||qz.addPoint(qW,qk);var qM=qB-qX,qr=qI-qh;for(qV=0;qV<qx.SEGNUM;qV++){var qe=qM*qK+qr*qu,qg=-qM*qu+qr*qK;qW=qe+qX,qk=qg+qh,qS=this._curMat.a*qW+this._curMat.c*qk,qk=q_=this._curMat.b*qW+this._curMat.d*qk,(qW=qS)==this._path.getEndPointX()&&qk==this._path.getEndPointY()||qz.addPoint(qW,qk),qM=qe,qr=qg}}}}}},q_.arc=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===qV&&(qV=!1),void 0===qW&&(qW=!0),-1!=this.mId){var qk=qr.getInstance().shapeDic[this.mId];if(qk&&this.mHaveKey&&!qk.needUpdate(this._curMat))return;q_=qS=0}var qz,qb=0,qH=0,qL=0,qC=0,qG=0,qt=0,qo=0;if(qH=qJ-qR,qV)if(Math.abs(qH)>=2*Math.PI)qH=2*-Math.PI;else for(;0<qH;)qH-=2*Math.PI;else if(Math.abs(qH)>=2*Math.PI)qH=2*Math.PI;else for(;qH<0;)qH+=2*Math.PI;qz=qH/(qo=qa<101?Math.max(10,qH*qa/5):qa<201?Math.max(10,qH*qa/20):Math.max(10,qH*qa/40))/2,qL=Math.abs(4/3*(1-Math.cos(qz))/Math.sin(qz)),qV&&(qL=-qL);var q$=this._getPath(),qF=NaN,qT=NaN;for(qt=0;qt<=qo;qt++)qb=qR+qH*(qt/qo),qC=qS+Math.cos(qb)*qa,qG=q_+Math.sin(qb)*qa,qW&&(qF=qC,qT=qG,qC=this._curMat.a*qF+this._curMat.c*qT,qG=this._curMat.b*qF+this._curMat.d*qT),qC==this._path.getEndPointX()&&qG==this._path.getEndPointY()||q$.addPoint(qC,qG);qC=qS+Math.cos(qJ)*qa,qG=q_+Math.sin(qJ)*qa,qW&&(qF=qC,qT=qG,qC=this._curMat.a*qF+this._curMat.c*qT,qG=this._curMat.b*qF+this._curMat.d*qT),qC==this._path.getEndPointX()&&qG==this._path.getEndPointY()||q$.addPoint(qC,qG)},q_.quadraticCurveTo=function(qS,q_,qa,qR){var qJ=qL.I,qV=qa,qW=qR;qa=this._curMat.a*qV+this._curMat.c*qW,qR=this._curMat.b*qV+this._curMat.d*qW,qV=qS,qW=q_,qS=this._curMat.a*qV+this._curMat.c*qW,q_=this._curMat.b*qV+this._curMat.d*qW;for(var qk=qJ.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),qS,q_,qa,qR],30,2),qz=0,qb=qk.length/2;qz<qb;qz++)this.lineTo(qk[2*qz],qk[2*qz+1],!1);this.lineTo(qa,qR,!1)},q_.rect=function(qS,q_,qa,qR){this._other=this._other.make(),this._other.path||(this._other.path=new qi),this._other.path.rect(qS,q_,qa,qR)},q_.strokeRect=function(qS,q_,qa,qR,qJ){var qV=.5*qJ;this.line(qS-qV,q_,qS+qa+qV,q_,qJ,this._curMat),this.line(qS+qa,q_,qS+qa,q_+qR,qJ,this._curMat),this.line(qS,q_,qS,q_+qR,qJ,this._curMat),this.line(qS-qV,q_+qR,qS+qa+qV,q_+qR,qJ,this._curMat)},q_.clip=function(){},q_.drawPoly=function(qS,q_,qa,qR,qJ,qV,qW){void 0===qW&&(qW=!1),this._renderKey=0,this._shader2D.glTexture=null;var qk=this._getPath();if(-1==this.mId)qk.polygon(qS,q_,qa,qR,qJ||1,qV);else if(this.mHaveKey){var qz=qr.getInstance().shapeDic[this.mId];qz.setMatrix(this._curMat),qz.rebuild(qk.tempArray),qk.setGeomtry(qz)}else{var qb=qk.polygon(qS,q_,qa,qR,qJ||1,qV);qr.getInstance().addShape(this.mId,qb),qb.setMatrix(this._curMat)}qk.update();var qH,qL=[this.mX,this.mY];if((qH=qVS.createShape(this,qk.ib,qk.vb,qk.count,qk.offset,qNS.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,qH.shaderValue.u_pos=qL,qH.shaderValue.u_mmat2=qTS.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=qH,0<qJ){if(this.mHaveLineKey){var qC=qr.getInstance().shapeLineDic[this.mId];qC.rebuild(qk.tempArray),qk.setGeomtry(qC)}else qr.getInstance().addShape(this.mId,qk.drawLine(qS,q_,qa,qJ,qV));qk.update(),(qH=qVS.createShape(this,qk.ib,qk.vb,qk.count,qk.offset,qNS.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,qH.shaderValue.u_mmat2=qTS.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=qH}},q_.drawParticle=function(qS,q_,qa){qa.x=qS,qa.y=q_,this._submits[this._submits._length++]=qa},q_._getPath=function(){return this._path||(this._path=new qi)},qR(0,q_,"globalCompositeOperation",function(){return qf.NAMES[this._nBlendType]},function(qS){var q_=qf.TOINT[qS];null==q_||this._nBlendType===q_||(qZ.save(this,65536,this,!0),this._curSubmit=qVS.RENDERBASE,this._renderKey=0,this._nBlendType=q_)}),qR(0,q_,"strokeStyle",function(){return this._shader2D.strokeStyle},function(qS){this._shader2D.strokeStyle.equal(qS)||(qZ.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=qY.create(qS))}),qR(0,q_,"globalAlpha",function(){return this._shader2D.ALPHA},function(qS){(qS=Math.floor(1e3*qS)/1e3)!=this._shader2D.ALPHA&&(qZ.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=qS)}),qR(0,q_,"asBitmap",null,function(qS){if(qS){if(this._targets||(this._targets=new qw),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),qR(0,q_,"fillStyle",function(){return this._shader2D.fillStyle},function(qS){this._shader2D.fillStyle.equal(qS)||(qZ.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=qY.create(qS))}),qR(0,q_,"textAlign",function(){return this._other.textAlign},function(qS){this._other.textAlign===qS||(this._other=this._other.make(),qZ.save(this,32768,this._other,!1),this._other.textAlign=qS)}),qR(0,q_,"lineWidth",function(){return this._other.lineWidth},function(qS){this._other.lineWidth===qS||(this._other=this._other.make(),qZ.save(this,256,this._other,!1),this._other.lineWidth=qS)}),qR(0,q_,"textBaseline",function(){return this._other.textBaseline},function(qS){this._other.textBaseline===qS||(this._other=this._other.make(),qZ.save(this,16384,this._other,!1),this._other.textBaseline=qS)}),qR(0,q_,"font",null,function(qS){qS!=this._other.font.toString()&&(this._other=this._other.make(),qZ.save(this,8,this._other,!1),this._other.font===qtS.EMPTY?this._other.font=new qtS(qS):this._other.font.setFont(qS))}),qx.__init__=function(){qa.DEFAULT=new qa},qx._tempPoint=new ql,qx._SUBMITVBSIZE=32e3,qx._MAXSIZE=99999999,qx._RECTVBSIZE=16,qx.MAXCLIPRECT=new qB(0,0,99999999,99999999),qx._COUNT=0,qx._tmpMatrix=new qn,qx.SEGNUM=32,qx._contextcount=0,qW(qx,["_fontTemp",function(){return this._fontTemp=new qtS},"_drawStyleTemp",function(){return this._drawStyleTemp=new qY(null)}]),qx.__init$=function(){qa=function(){function qS(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=qtS.EMPTY}qC(qS,"");var q_=qS.prototype;return q_.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=qtS.EMPTY},q_.make=function(){return this===qS.DEFAULT?new qS:this},qS.DEFAULT=null,qS}()},qx}(),qNS=function(qS){function qR(qS,q_){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,qR.__super.call(this),this.defines=new qIS,this.position=qR._POSITION,this.mainID=qS,this.subID=q_,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=qS|q_,this._inClassCache=qR._cache[this._cacheID],0<qS&&!this._inClassCache&&(this._inClassCache=qR._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}qC(qR,"laya.webgl.shader.d2.value.Value2D",qg);var q_=qR.prototype;return q_.setValue=function(qS){},q_.refresh=function(){var qS=this.size;return qS[0]=qTS.width,qS[1]=qTS.height,this.alpha=this.ALPHA*qTS.worldAlpha,this.mmat=qTS.worldMatrix4,this},q_._ShaderWithCompile=function(){return qyS.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,qwS.create)},q_._withWorldShaderDefines=function(){var qS=qTS.worldShaderDefines,q_=qyS.sharders[this.mainID|this.defines._value|qS.getValue()];if(!q_){var qa,qR={};for(qa in this.defines.toNameDic())qR[qa]="";for(qa in qS.toNameDic())qR[qa]="";q_=qyS.withCompile2D(0,this.mainID,qR,this.mainID|this.defines._value|qS.getValue(),qwS.create)}var qJ=qTS.worldFilters;if(!qJ)return q_;for(var qV,qW=qJ.length,qk=0;qk<qW;qk++)(qV=qJ[qk])&&qV.action.setValue(this);return q_},q_.upload=function(){var qS=qTS;this.alpha=this.ALPHA*qS.worldAlpha,qTS.worldMatrix4!==qTS.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),qjS.shaderHighPrecision&&this.defines.add(1024);var q_,qa=qS.worldShaderDefines?this._withWorldShaderDefines():qyS.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=qS.width,this.size[1]=qS.height,this.mmat=qS.worldMatrix4,qMS.activeShader!==qa?qa._shaderValueWidth!==qS.width||qa._shaderValueHeight!==qS.height?(qa._shaderValueWidth=qS.width,qa._shaderValueHeight=qS.height):q_=qa._params2dQuick2||qa._make2dQuick2():qa._shaderValueWidth!==qS.width||qa._shaderValueHeight!==qS.height?(qa._shaderValueWidth=qS.width,qa._shaderValueHeight=qS.height):q_=qa._params2dQuick1||qa._make2dQuick1(),qa.upload(this,q_)},q_.setFilters=function(qS){if(this.filters=qS)for(var q_,qa=qS.length,qR=0;qR<qa;qR++)(q_=qS[qR])&&(this.defines.add(q_.type),q_.action.setValue(this))},q_.clear=function(){this.defines.setValue(this.subID)},q_.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},qR._initone=function(qS,q_){qR._typeClass[qS]=q_,qR._cache[qS]=[],qR._cache[qS]._length=0},qR.__init__=function(){qR._POSITION=[2,5126,!1,4*qoS.BYTES_PE,0],qR._TEXCOORD=[2,5126,!1,4*qoS.BYTES_PE,2*qoS.BYTES_PE],qR._initone(2,qxS),qR._initone(4,qfS),qR._initone(256,qsS),qR._initone(512,qgS),qR._initone(1,qUS),qR._initone(65,qOS),qR._initone(9,qUS)},qR.create=function(qS,q_){var qa=qR._cache[qS|q_];return qa._length?qa[--qa._length]:new qR._typeClass[qS|q_](q_)},qR._POSITION=null,qR._TEXCOORD=null,qR._cache=[],qR._typeClass=[],qR.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qR}(),qnS=function(qS){function q$(qS,q_){q$.__super.call(this,qS,q_)}qC(q$,"laya.webgl.utils.RenderSprite3D",qT);var q_=q$.prototype;return q_.onCreate=function(qS){switch(qS){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},q_._mask=function(qS,q_,qa,qR){var qJ,qV,qW=this._next,qk=qS.mask;if(qk){q_.ctx.save();var qz=q_.ctx.globalCompositeOperation,qb=new qB;if(qb.copyFrom(qk.getBounds()),qb.width=Math.round(qb.width),qb.height=Math.round(qb.height),qb.x=Math.round(qb.x),qb.y=Math.round(qb.y),0<qb.width&&0<qb.height){var qH=qS._style._tf,qL=qkS.create();qL.addValue("bounds",qb),qJ=qWS.create([qL,q_],laya.webgl.utils.RenderSprite3D.tmpTarget),q_.addRenderObject(qJ),qk.render(q_,-qb.x,-qb.y),qJ=qWS.create([qL],laya.webgl.utils.RenderSprite3D.endTmpTarget),q_.addRenderObject(qJ),q_.ctx.save(),q_.clipRect(qa-qH.translateX+qb.x,qR-qH.translateY+qb.y,qb.width,qb.height),qW._fun.call(qW,qS,q_,qa,qR),q_.ctx.restore(),qV=qHS.create(6),qz=q_.ctx.globalCompositeOperation,qV.blendMode="mask",q_.addRenderObject(qV),qn.TEMP.identity();var qC=qNS.create(1,0),qG=qP.INV_UV,qt=qb.width,qo=qb.height;(qb.width<32||qb.height<32)&&((qG=q$.tempUV)[0]=0,qG[1]=0,qG[2]=32<=qb.width?1:qb.width/32,qG[3]=0,qG[4]=32<=qb.width?1:qb.width/32,qG[5]=32<=qb.height?1:qb.height/32,qG[6]=0,qG[7]=32<=qb.height?1:qb.height/32,qb.width=32<=qb.width?qb.width:32,qb.height=32<=qb.height?qb.height:32,qG[1]*=-1,qG[3]*=-1,qG[5]*=-1,qG[7]*=-1,qG[1]+=1,qG[3]+=1,qG[5]+=1,qG[7]+=1),q_.ctx.drawTarget(qL,qa+qb.x-qH.translateX,qR+qb.y-qH.translateY,qt,qo,qn.TEMP,"tmpTarget",qC,qG,6),qJ=qWS.create([qL],laya.webgl.utils.RenderSprite3D.recycleTarget),q_.addRenderObject(qJ),(qV=qHS.create(6)).blendMode=qz,q_.addRenderObject(qV)}q_.ctx.restore()}else qW._fun.call(qW,qS,q_,qa,qR)},q_._blend=function(qS,q_,qa,qR){var qJ=qS._style,qV=this._next;qJ.blendMode?(q_.ctx.save(),q_.ctx.globalCompositeOperation=qJ.blendMode,qV._fun.call(qV,qS,q_,qa,qR),q_.ctx.restore()):qV._fun.call(qV,qS,q_,qa,qR)},q_._transform=function(qS,q_,qa,qR){var qJ=qS.transform,qV=this._next;if(qJ&&qV!=qT.NORENDER){var qW=q_.ctx;qS._style;qJ.tx=qa,qJ.ty=qR;var qk=qW._getTransformMatrix(),qz=qk.clone();qn.mul(qJ,qk,qk),qk._checkTransform(),qJ.tx=qJ.ty=0,qV._fun.call(qV,qS,q_,0,0),qz.copyTo(qk),qz.destroy()}else qV._fun.call(qV,qS,q_,qa,qR)},q$.tmpTarget=function(qS,q_){var qa=qS.getValue("bounds"),qR=qrS.create(qa.width,qa.height);qR.start(),qR.clear(0,0,0,0),qS.addValue("tmpTarget",qR)},q$.endTmpTarget=function(qS){qS.getValue("tmpTarget").end()},q$.recycleTarget=function(qS){qS.getValue("tmpTarget").recycle(),qS.recycle()},qW(q$,["tempUV",function(){return this.tempUV=new Array(8)}]),q$}(),qlS=function(qS){function q_(){this.data=null,q_.__super.call(this)}qC(q_,"laya.filters.webgl.ColorFilterActionGL",qe);var qa=q_.prototype;return qm.imps(qa,{"laya.filters.IFilterActionGL":!0}),qa.setValue=function(qS){qS.colorMat=this.data._mat,qS.colorAlpha=this.data._alpha},qa.apply3d=function(qS,q_,qa,qR,qJ){var qV=qS.getValue("bounds"),qW=qNS.create(1,0);qW.setFilters([this.data]);var qk=qn.TEMP;qk.identity(),qa.ctx.drawTarget(qS,0,0,qV.width,qV.height,qk,"src",qW)},q_}(),qBS=function(qS){function qV(qS,q_,qa,qR,qJ){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,qV.__super.call(this,qS,q_,qJ),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new qYS,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=qa,this._atlasCanvas.height=qR,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}qC(qV,"laya.webgl.atlas.Atlaser",qx);var q_=qV.prototype;return q_.computeUVinAtlasTexture=function(qS,q_,qa,qR){var qJ=qs.atlasTextureWidth,qV=qs.atlasTextureHeight,qW=qa/qJ,qk=qR/qV,qz=(qa+qS.bitmap.width)/qJ,qb=(qR+qS.bitmap.height)/qV,qH=qS.bitmap.width/qJ,qL=qS.bitmap.height/qV;qS.uv=[qW+q_[0]*qH,qk+q_[1]*qL,qz-(1-q_[2])*qH,qk+q_[3]*qL,qz-(1-q_[4])*qH,qb-(1-q_[5])*qL,qW+q_[6]*qH,qb-(1-q_[7])*qL]},q_.findBitmapIsExist=function(qS){if(qS instanceof laya.webgl.resource.WebGLImage){var q_=qS,qa=q_.url,qR=this._InAtlasWebGLImagesKey[qa||q_.id];if(qR)return qR.offsetInfoID}return-1},q_.addToAtlasTexture=function(qS,q_,qa){if(qS instanceof laya.webgl.resource.WebGLImage){var qR=qS,qJ=qR.url;this._InAtlasWebGLImagesKey[qJ||qR.id]={bitmap:qS,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([q_,qa])}this._atlasCanvas.texSubImage2D(q_,qa,qS.atlasSource),qS.clearAtlasSource()},q_.addToAtlas=function(qS,q_,qa){qS._atlasID=this._inAtlasTextureKey.length;var qR=qS.uv.slice(),qJ=qS.bitmap;this._inAtlasTextureKey.push(qS),this._inAtlasTextureOriUVValue.push(qR),this._inAtlasTextureBitmapValue.push(qJ),this.computeUVinAtlasTexture(qS,qR,q_,qa),qS.bitmap=this._atlasCanvas},q_.clear=function(){for(var qS=0,q_=this._inAtlasTextureKey.length;qS<q_;qS++)this._inAtlasTextureKey[qS].bitmap=this._inAtlasTextureBitmapValue[qS],this._inAtlasTextureKey[qS].uv=this._inAtlasTextureOriUVValue[qS],this._inAtlasTextureKey[qS]._atlasID=-1,this._inAtlasTextureKey[qS].bitmap.lock=!1,this._inAtlasTextureKey[qS].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},q_.dispose=function(){this.clear(),this._atlasCanvas.destroy()},qR(0,q_,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),qR(0,q_,"texture",function(){return this._atlasCanvas}),qR(0,q_,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),qV}(),qIS=function(qS){function qa(){qa.__super.call(this,qa.__name2int,qa.__int2name,qa.__int2nameMap)}return qC(qa,"laya.webgl.shader.d2.ShaderDefines2D",qd),qa.__init__=function(){qa.reg("TEXTURE2D",1),qa.reg("COLOR2D",2),qa.reg("PRIMITIVE",4),qa.reg("GLOW_FILTER",8),qa.reg("BLUR_FILTER",16),qa.reg("COLOR_FILTER",32),qa.reg("COLOR_ADD",64),qa.reg("WORLDMAT",128),qa.reg("FILLTEXTURE",256),qa.reg("FSHIGHPRECISION",1024),qa.reg("TXTALPHA",2048),qa.reg("TXTCOMPRESS",4096)},qa.reg=function(qS,q_){qd._reg(qS,q_,qa.__name2int,qa.__int2name)},qa.toText=function(qS,q_,qa){return qd._toText(qS,q_,qa)},qa.toInt=function(qS){return qd._toInt(qS,qa.__name2int)},qa.TEXTURE2D=1,qa.COLOR2D=2,qa.PRIMITIVE=4,qa.FILTERGLOW=8,qa.FILTERBLUR=16,qa.FILTERCOLOR=32,qa.COLORADD=64,qa.WORLDMAT=128,qa.FILLTEXTURE=256,qa.SKINMESH=512,qa.SHADERDEFINE_FSHIGHPRECISION=1024,qa.TXTALPHA=2048,qa.TXTCOMPRESS=4096,qa.__name2int={},qa.__int2name=[],qa.__int2nameMap=[],qa}(),qAS=(function(qS){function qk(qS,q_,qa,qR,qJ,qV,qW){qk.__super.call(this,qS,q_,qa,qR,40,qJ,qV,qW)}qC(qk,"laya.webgl.shapes.Ellipse",qaS)}(),function(qS){function qV(qS,q_,qa,qR,qJ){this._points=[],this.rebuild(qa),qV.__super.call(this,qS,q_,0,0,0,qJ,qR,qJ,0)}qC(qV,"laya.webgl.shapes.Line",qaS);var q_=qV.prototype;return q_.rebuild=function(qS){var q_=qS.length;q_!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(q_/2-1)),this.mFloat32Array=new Float32Array(5*q_)),this._points.length=0;for(var qa=NaN,qR=NaN,qJ=-1,qV=-1,qW=qS.length/2,qk=0;qk<qW;qk++)qa=qS[2*qk],qR=qS[2*qk+1],(.01<Math.abs(qJ-qa)||.01<Math.abs(qV-qR))&&this._points.push(qa,qR),qJ=qa,qV=qR},q_.getData=function(qS,q_,qa){var qR=[],qJ=[];0<this.borderWidth&&this.createLine2(this._points,qR,this.borderWidth,qa,qJ,this._points.length/2),this.mUint16Array.set(qR,0),this.mFloat32Array.set(qJ,0),qS.append(this.mUint16Array),q_.append(this.mFloat32Array)},qV}()),qXS=function(qS){function qL(qS,q_,qa,qR,qJ){this._points=[];for(var qV=NaN,qW=NaN,qk=-1,qz=-1,qb=qa.length/2-1,qH=0;qH<qb;qH++)qV=qa[2*qH],qW=qa[2*qH+1],(.01<Math.abs(qk-qV)||.01<Math.abs(qz-qW))&&this._points.push(qV,qW),qk=qV,qz=qW;qV=qa[2*qb],qW=qa[2*qb+1],qk=this._points[0],qz=this._points[1],(.01<Math.abs(qk-qV)||.01<Math.abs(qz-qW))&&this._points.push(qV,qW),qL.__super.call(this,qS,q_,0,0,this._points.length/2,0,qR,qJ)}qC(qL,"laya.webgl.shapes.LoopLine",qaS);var q_=qL.prototype;return q_.getData=function(qS,q_,qa){if(0<this.borderWidth){for(var qR=this.color,qJ=(qR>>16&255)/255,qV=(qR>>8&255)/255,qW=(255&qR)/255,qk=[],qz=0,qb=0,qH=[],qL=Math.floor(this._points.length/2),qC=0;qC<qL;qC++)qz=this._points[2*qC],qb=this._points[2*qC+1],qk.push(this.x+qz,this.y+qb,qJ,qV,qW);this.createLoopLine(qk,qH,this.borderWidth,qa+qk.length/5),qS.append(new Uint16Array(qH)),q_.append(new Float32Array(qk))}},q_.createLoopLine=function(qS,q_,qa,qR,qJ,qV){qS.length;var qW=qS.concat(),qk=qJ||qS,qz=this.borderColor,qb=(qz>>16&255)/255,qH=(qz>>8&255)/255,qL=(255&qz)/255,qC=[qW[0],qW[1]],qG=[qW[qW.length-5],qW[qW.length-4]],qt=qG[0]+.5*(qC[0]-qG[0]),qo=qG[1]+.5*(qC[1]-qG[1]);qW.unshift(qt,qo,0,0,0),qW.push(qt,qo,0,0,0);var q$,qF,qT,qD,qj,qQ,qm,qq,qN,qn,ql,qB,qI,qA,qX,qh,qu,qK,qP,qM,qr=qW.length/5,qe=qR,qg=qa/2;qT=qW[0],qD=qW[1],qn=qT-(qj=qW[5]),qN=(qN=-(qD-(qQ=qW[6])))/(qM=Math.sqrt(qN*qN+qn*qn))*qg,qn=qn/qM*qg,qk.push(qT-qN,qD-qn,qb,qH,qL,qT+qN,qD+qn,qb,qH,qL);for(var qx=1;qx<qr-1;qx++)qT=qW[5*(qx-1)],qD=qW[5*(qx-1)+1],qj=qW[5*qx],qQ=qW[5*qx+1],qm=qW[5*(qx+1)],qq=qW[5*(qx+1)+1],qn=qT-qj,qB=qj-qm,qX=(-(qN=(qN=-(qD-qQ))/(qM=Math.sqrt(qN*qN+qn*qn))*qg)+qT)*(-(qn=qn/qM*qg)+qQ)-(-qN+qj)*(-qn+qD),qK=(-(ql=(ql=-(qQ-qq))/(qM=Math.sqrt(ql*ql+qB*qB))*qg)+qm)*(-(qB=qB/qM*qg)+qQ)-(-ql+qj)*(-qB+qq),qP=(qI=-qn+qD-(-qn+qQ))*(qu=-ql+qj-(-ql+qm))-(qh=-qB+qq-(-qB+qQ))*(qA=-qN+qj-(-qN+qT)),Math.abs(qP)<.1?(qP+=10.1,qk.push(qj-qN,qQ-qn,qb,qH,qL,qj+qN,qQ+qn,qb,qH,qL)):(((q$=(qA*qK-qu*qX)/qP)-qj)*(q$-qj)+((qF=(qh*qX-qI*qK)/qP)-qQ)+(qF-qQ),qk.push(q$,qF,qb,qH,qL,qj-(q$-qj),qQ-(qF-qQ),qb,qH,qL));qV&&(q_=qV);var qs=this.edges+1;for(qx=1;qx<qs;qx++)q_.push(qe+2*(qx-1),qe+2*(qx-1)+1,qe+2*qx+1,qe+2*qx+1,qe+2*qx,qe+2*(qx-1));return q_.push(qe+2*(qx-1),qe+2*(qx-1)+1,qe+1,qe+1,qe,qe+2*(qx-1)),qk},qL}(),qhS=function(qS){function qW(qS,q_,qa,qR,qJ,qV){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=qn.create(),this._points=qa.slice(0,qa.length),qW.__super.call(this,qS,q_,0,0,this._points.length/2,qR,qJ,qV)}qC(qW,"laya.webgl.shapes.Polygon",qaS);var q_=qW.prototype;return q_.rebuild=function(qS){this._repaint||(this._points.length=0,this._points=this._points.concat(qS))},q_.setMatrix=function(qS){qS.copyTo(this._mat)},q_.needUpdate=function(qS){return this._repaint=this._mat.a==qS.a&&this._mat.b==qS.b&&this._mat.c==qS.c&&this._mat.d==qS.d&&this._mat.tx==qS.tx&&this._mat.ty==qS.ty,!this._repaint},q_.getData=function(qS,q_,qa){var qR,qJ=0,qV=this._points,qW=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=qa){for(this._start=qa,qR=[],qW=this.earcutTriangles.length,qJ=0;qJ<qW;qJ++)qR.push(this.earcutTriangles[qJ]+qa);this.mUint16Array=new Uint16Array(qR)}}else{this._start=qa,qR=[];var qk=[],qz=[],qb=this.color,qH=(qb>>16&255)/255,qL=(qb>>8&255)/255,qC=(255&qb)/255;for(qW=Math.floor(qV.length/2),qJ=0;qJ<qW;qJ++)qk.push(this.x+qV[2*qJ],this.y+qV[2*qJ+1],qH,qL,qC),qz.push(this.x+qV[2*qJ],this.y+qV[2*qJ+1]);for(this.earcutTriangles=qRS.earcut(qz,null,2),qW=this.earcutTriangles.length,qJ=0;qJ<qW;qJ++)qR.push(this.earcutTriangles[qJ]+qa);this.mUint16Array=new Uint16Array(qR),this.mFloat32Array=new Float32Array(qk)}qS.append(this.mUint16Array),q_.append(this.mFloat32Array)},qW}(),quS=function(qS){function qV(){this._matrix=new qn,this._matrix4=qoS.defaultMatrix4.concat(),qV.__super.call(this,1e4),this.shaderValue=new qNS(0,0)}qC(qV,"laya.webgl.submit.SubmitCanvas",qVS);var q_=qV.prototype;return q_.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var qS=qTS.worldAlpha,q_=qTS.worldMatrix4,qa=qTS.worldMatrix,qR=qTS.worldFilters,qJ=qTS.worldShaderDefines,qV=this.shaderValue,qW=this._matrix,qk=this._matrix4,qz=qn.TEMP;return qn.mul(qW,qa,qz),qk[0]=qz.a,qk[1]=qz.b,qk[4]=qz.c,qk[5]=qz.d,qk[12]=qz.tx,qk[13]=qz.ty,qTS.worldMatrix=qz.clone(),qTS.worldMatrix4=qk,qTS.worldAlpha=qTS.worldAlpha*qV.alpha,qV.filters&&qV.filters.length&&(qTS.worldFilters=qV.filters,qTS.worldShaderDefines=qV.defines),this._ctx_src.flush(),qTS.worldAlpha=qS,qTS.worldMatrix4=q_,qTS.worldMatrix.destroy(),qTS.worldMatrix=qa,qTS.worldFilters=qR,qTS.worldShaderDefines=qJ,1},q_.releaseRender=function(){var qS=qV._cache;this._ctx_src=null,qS[qS._length++]=this},q_.getRenderType=function(){return 10003},qV.create=function(qS,q_,qa){var qR=qV._cache._length?qV._cache[--qV._cache._length]:new qV;qR._ctx_src=qS;var qJ=qR.shaderValue;return qJ.alpha=q_,qJ.defines.setValue(0),qa&&qa.length&&qJ.setFilters(qa),qR},qV._cache=((qV._cache=[])._length=0,qV._cache),qV}(),qKS=function(qS){function qb(qS){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===qS&&(qS=1e4),qb.__super.call(this,qS)}qC(qb,"laya.webgl.submit.SubmitTexture",qVS);var q_=qb.prototype;return q_.releaseRender=function(){var qS=qb._cache;(qS[qS._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},q_.addTexture=function(qS,q_){this._texsID[this._texs.length]=qS._uvID,this._texs.push(qS),this._vbPos.push(q_)},q_.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var qS=this.shaderValue.textureHost.bitmap;if(null!==qS)for(var q_=this._vb.getFloat32Array(),qa=0,qR=this._texs.length;qa<qR;qa++){var qJ=this._texs[qa];qJ.active();var qV=qJ.uv;if(this._texsID[qa]!==qJ._uvID){this._texsID[qa]=qJ._uvID;var qW=this._vbPos[qa];q_[qW+2]=qV[0],q_[qW+3]=qV[1],q_[qW+6]=qV[2],q_[qW+7]=qV[3],q_[qW+10]=qV[4],q_[qW+11]=qV[5],q_[qW+14]=qV[6],q_[qW+15]=qV[7],this._vb.setNeedUpload()}qJ.bitmap!==qS&&(this._isSameTexture=!1)}}},q_.renderSubmit=function(){if(0===this._numEle)return qb._shaderSet=!1,1;var qS=this.shaderValue.textureHost;if(qS){var q_=qS.source;if(!qS.bitmap||!q_)return qb._shaderSet=!1,1;this.shaderValue.texture=q_,qS.alphaTexture&&qS.alphaTexture.source&&(this.shaderValue.texture1=qS.alphaTexture.source)}this._vb.bind_upload(this._ib);var qa=qjS.mainContext;if(qf.activeBlendFunction!==this._blendFn&&(qa.enable(3042),this._blendFn(qa),qf.activeBlendFunction=this._blendFn),qX.drawCall++,qX.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&qMS.activeShader&&qb._shaderSet?(qMS.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&qMS.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),qb._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var qR=qS.bitmap,qJ=0,qV=qMS.activeShader,qW=0,qk=this._texs.length;qW<qk;qW++){var qz=this._texs[qW];qz.bitmap===qR&&qW+1!==qk||(qV.uploadTexture2D(qz.source),qa.drawElements(4,6*(qW-qJ+1),5123,this._startIdx+6*qJ*qoS.BYTES_PIDX),qR=qz.bitmap,qJ=qW)}else qa.drawElements(4,this._numEle,5123,this._startIdx);return 1},qb.create=function(qS,q_,qa,qR,qJ){var qV=qb._cache._length?qb._cache[--qb._cache._length]:new qb;null==qa&&((qa=qV._selfVb||(qV._selfVb=qdS.create(-1))).clear(),qR=0),qV._ib=q_,qV._vb=qa,qV._startIdx=qR*qoS.BYTES_PIDX,qV._numEle=0;var qW=qS._nBlendType;qV._blendFn=qS._targets?qf.targetFns[qW]:qf.fns[qW],qV.shaderValue=qJ,qV.shaderValue.setValue(qS._shader2D);var qk=qS._shader2D.filters;return qk&&qV.shaderValue.setFilters(qk),qV},qb._cache=((qb._cache=[])._length=0,qb._cache),qb._shaderSet=!0,qb}(),qPS=function(qS){function qF(){qF.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}qC(qF,"laya.webgl.utils.MeshTexture",qFS);var q_=qF.prototype;return q_.addData=function(qS,q_,qa,qR,qJ,qV){for(var qW=qS.length/2,qk=this._vb.needSize(qW*qF.const_stride)>>2,qz=this._vb.getFloat32Array(),qb=0,qH=0;qH<qW;qH++){var qL=qS[qb],qC=qS[qb+1],qG=qL*qR.a+qC*qR.c+qR.tx,qt=qL*qR.b+qC*qR.d+qR.ty;qz[qk++]=qG,qz[qk++]=qt,qz[qk++]=q_[qb],qz[qk++]=q_[qb+1],qb+=2}this._vb.setNeedUpload();var qo=this.vertNum;if(0<qo){(qW=qa.length)>qF.tmpIdx.length&&(qF.tmpIdx=new Uint16Array(qW));for(var q$=0;q$<qW;q$++)qF.tmpIdx[q$]=qa[q$]+qo;this._ib.appendU16Array(qF.tmpIdx,qa.length)}else this._ib.append(qa);this._ib.setNeedUpload(),this.vertNum+=qW,this.indexNum+=qa.length},q_.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},q_.destroy=function(){this._ib.destroy(),this._vb.destroy()},qF.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new qF},qF.const_stride=16,qF._POOL=[],qW(qF,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),qF}(),qMS=function(qS){function q_(){q_.__super.call(this),this.lock=!0}return qC(q_,"laya.webgl.shader.BaseShader",qD),q_.activeShader=null,q_.bindShader=null,q_}(),qrS=function(q_){function qH(qS,q_,qa,qR,qJ,qV,qW,qk,qz){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===qa&&(qa=6408),void 0===qR&&(qR=5121),void 0===qJ&&(qJ=34041),void 0===qV&&(qV=!1),void 0===qW&&(qW=!1),void 0===qk&&(qk=-1),void 0===qz&&(qz=-1),this._type=1,this._w=qS,this._h=q_,this._surfaceFormat=qa,this._surfaceType=qR,this._depthStencilFormat=qJ,qF.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=qV,this._repeat=qW,this._minFifter=qk,this._magFifter=qz,this._createWebGLRenderTarget(),this.bitmap.lock=!0,qH.__super.call(this,this.bitmap,qP.INV_UV)}qC(qH,"laya.webgl.resource.RenderTarget2D",q_);var qS=qH.prototype;return qm.imps(qS,{"laya.resource.IDispose":!0}),qS.getType=function(){return this._type},qS.getTexture=function(){return this},qS.size=function(qS,q_){this._w==qS&&this._h==q_||(this._w=qS,this._h=q_,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},qS.release=function(){this.destroy()},qS.recycle=function(){qH.POOL.push(this)},qS.start=function(){var qS=qjS.mainContext;return this._preRenderTarget=qTS.curRenderTarget,qTS.curRenderTarget=this,qS.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(qS.viewport(0,0,this._w,this._h),this._svWidth=qTS.width,this._svHeight=qTS.height,qTS.width=this._w,qTS.height=this._h,qMS.activeShader=null),this},qS.clear=function(qS,q_,qa,qR){void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=1);var qJ=qjS.mainContext;qJ.clearColor(qS,q_,qa,qR);var qV=16384;switch(this._depthStencilFormat){case 33189:qV|=256;break;case 36168:qV|=1024;break;case 34041:qV|=256,qV|=1024}qJ.clear(qV)},qS.end=function(){var qS=qjS.mainContext;qS.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,qTS.curRenderTarget=this._preRenderTarget,1==this._type?(qS.viewport(0,0,this._svWidth,this._svHeight),qTS.width=this._svWidth,qTS.height=this._svHeight,qMS.activeShader=null):qS.viewport(0,0,qm.stage.width,qm.stage.height)},qS.getData=function(qS,q_,qa,qR){var qJ=qjS.mainContext;if(qJ.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===qJ.checkFramebufferStatus(36160)))return qJ.bindFramebuffer(36160,null),null;var qV=new Uint8Array(this._w*this._h*4);return qJ.readPixels(qS,q_,qa,qR,this._surfaceFormat,this._surfaceType,qV),qJ.bindFramebuffer(36160,null),qV},qS.destroy=function(qS){void 0===qS&&(qS=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,q_.prototype.destroy.call(this))},qS.dispose=function(){},qS._createWebGLRenderTarget=function(){this.bitmap=new qpS(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(qS){this.event("recovered")})},qR(0,qS,"surfaceFormat",function(){return this._surfaceFormat}),qR(0,qS,"magFifter",function(){return this._magFifter}),qR(0,qS,"surfaceType",function(){return this._surfaceType}),qR(0,qS,"mipMap",function(){return this._mipMap}),qR(0,qS,"depthStencilFormat",function(){return this._depthStencilFormat}),qR(0,qS,"minFifter",function(){return this._minFifter}),qR(0,qS,"source",function(){return this._alreadyResolved?qm.superGet(qP,this,"source"):null}),qH.create=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){void 0===qa&&(qa=6408),void 0===qR&&(qR=5121),void 0===qJ&&(qJ=34041),void 0===qV&&(qV=!1),void 0===qW&&(qW=!1),void 0===qk&&(qk=-1),void 0===qz&&(qz=-1);var qb=qH.POOL.pop();return qb||(qb=new qH(qS,q_)),qb.bitmap&&qb._w==qS&&qb._h==q_&&qb._surfaceFormat==qa&&qb._surfaceType==qR&&qb._depthStencilFormat==qJ&&qb._mipMap==qV&&qb._repeat==qW&&qb._minFifter==qk&&qb._magFifter==qz||(qb._w=qS,qb._h=q_,qb._surfaceFormat=qa,qb._surfaceType=qR,qb._depthStencilFormat=qJ,qF.isConchWebGL&&34041===qb._depthStencilFormat&&(qb._depthStencilFormat=33189),qb._mipMap=qV,qb._repeat=qW,qb._minFifter=qk,qb._magFifter=qz,qb.release(),qb._createWebGLRenderTarget()),qb},qH.TYPE2D=1,qH.TYPE3D=2,qH.POOL=[],qH}(qP),qeS=function(qS){function q_(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,q_.__super.call(this),q_._gl=qjS.mainContext}qC(q_,"laya.webgl.utils.Buffer",qD);var qa=q_.prototype;return qa._bind=function(){this.activeResource(),q_._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(q_._bindVertexBuffer=this._glBuffer),q_._gl.bindBuffer(this._bufferType,q_._bindActive[this._bufferType]=this._glBuffer),qMS.activeShader=null)},qa.recreateResource=function(){this._glBuffer||(this._glBuffer=q_._gl.createBuffer()),this.completeCreate()},qa.disposeResource=function(){this._glBuffer&&(qjS.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},qR(0,qa,"bufferUsage",function(){return this._bufferUsage}),q_._gl=null,q_._bindActive={},q_._bindVertexBuffer=null,q_._enableAtributes=[],q_}(),qgS=function(qS){function qa(qS){this.texcoord=null,this.offsetX=300,this.offsetY=0,qa.__super.call(this,512,0);var q_=8*qoS.BYTES_PE;this.position=[2,5126,!1,q_,0],this.texcoord=[2,5126,!1,q_,2*qoS.BYTES_PE],this.color=[4,5126,!1,q_,4*qoS.BYTES_PE]}return qC(qa,"laya.webgl.shader.d2.skinAnishader.SkinSV",qNS),qa}(),qxS=function(qS){function q_(qS){q_.__super.call(this,2,0),this.color=[]}return qC(q_,"laya.webgl.shader.d2.value.Color2dSV",qNS),q_.prototype.setValue=function(qS){qS.fillStyle&&(this.color=qS.fillStyle._color._color),qS.strokeStyle&&(this.color=qS.strokeStyle._color._color)},q_}(),qsS=function(qS){function q_(qS){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=qNS._TEXCOORD,q_.__super.call(this,256,0)}qC(q_,"laya.webgl.shader.d2.value.FillTextureSV",qNS);var qa=q_.prototype;return qa.setValue=function(qS){this.ALPHA=qS.ALPHA,qS.filters&&this.setFilters(qS.filters)},qa.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},q_}(),qUS=function(qS){function q_(qS){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=qNS._TEXCOORD,void 0===qS&&(qS=0),q_.__super.call(this,1,qS)}qC(q_,"laya.webgl.shader.d2.value.TextureSV",qNS);var qa=q_.prototype;return qa.setValue=function(qS){this.ALPHA=qS.ALPHA,qS.filters&&this.setFilters(qS.filters)},qa.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},q_}(),qfS=function(qS){function q_(qS){this.a_color=null,this.u_pos=[0,0],q_.__super.call(this,4,0),this.position=[2,5126,!1,5*qoS.BYTES_PE,0],this.a_color=[3,5126,!1,5*qoS.BYTES_PE,2*qoS.BYTES_PE]}return qC(q_,"laya.webgl.shader.d2.value.PrimitiveSV",qNS),q_}(),qYS=function(qS){function q_(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,q_.__super.call(this)}qC(q_,"laya.webgl.atlas.AtlasWebGLCanvas",qS);var qa=q_.prototype;return qa.recreateResource=function(){var qS=qjS.mainContext,q_=this._source=qS.createTexture(),qa=qQS.curBindTexTarget,qR=qQS.curBindTexValue;qQS.bindTexture(qS,3553,q_),qS.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),qS.texParameteri(3553,10241,9729),qS.texParameteri(3553,10240,9729),qS.texParameteri(3553,10242,33071),qS.texParameteri(3553,10243,33071),qa&&qR&&qQS.bindTexture(qS,qa,qR),this.memorySize=this._w*this._h*4,this.completeCreate()},qa.disposeResource=function(){this._source&&(qjS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},qa.texSubImage2D=function(qS,q_,qa){if(qF.isFlash){this._flashCacheImage||(this._flashCacheImage=qo.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var qR=qa.bitmapdata;this._flashCacheImage._image.copyPixels(qR,0,0,qR.width,qR.height,qS,q_),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var qJ=qjS.mainContext,qV=qQS.curBindTexTarget,qW=qQS.curBindTexValue;qQS.bindTexture(qJ,3553,this._source),qJ.pixelStorei(37441,!0),0<=qS-1&&qJ.texSubImage2D(3553,0,qS-1,q_,6408,5121,qa),qS+1<=this._w&&qJ.texSubImage2D(3553,0,qS+1,q_,6408,5121,qa),0<=q_-1&&qJ.texSubImage2D(3553,0,qS,q_-1,6408,5121,qa),q_+1<=this._h&&qJ.texSubImage2D(3553,0,qS,q_+1,6408,5121,qa),qJ.texSubImage2D(3553,0,qS,q_,6408,5121,qa),qJ.pixelStorei(37441,!1),qV&&qW&&qQS.bindTexture(qJ,qV,qW)}},qa.texSubImage2DPixel=function(qS,q_,qa,qR,qJ){var qV=qjS.mainContext,qW=qQS.curBindTexTarget,qk=qQS.curBindTexValue;qQS.bindTexture(qV,3553,this._source);var qz=new Uint8Array(qJ.data);qV.pixelStorei(37441,!0),qV.texSubImage2D(3553,0,qS,q_,qa,qR,6408,5121,qz),qV.pixelStorei(37441,!1),qW&&qk&&qQS.bindTexture(qV,qW,qk)},qR(0,qa,"width",qS.prototype._$get_width,function(qS){this._w=qS}),qR(0,qa,"height",qS.prototype._$get_height,function(qS){this._h=qS}),q_}(qa),qiS=function(qS){function qJ(){this.flipY=!0,this.alwaysChange=!1,qJ.__super.call(this)}qC(qJ,"laya.webgl.resource.WebGLCanvas",qa);var q_=qJ.prototype;return q_.getCanvas=function(){return this._canvas},q_.clear=function(){this._ctx&&this._ctx.clear()},q_.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},q_._setContext=function(qS){this._ctx=qS},q_.getContext=function(qS,q_){return this._ctx?this._ctx:this._ctx=qJ._createContext(this)},q_.size=function(qS,q_){this._w==qS&&this._h==q_||(this._w=qS,this._h=q_,this._ctx&&this._ctx.size(qS,q_),this._canvas&&(this._canvas.height=q_,this._canvas.width=qS))},q_.activeResource=function(qS){void 0===qS&&(qS=!1),this._source||this.recreateResource()},q_.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},q_.disposeResource=function(){this._source&&!this.iscpuSource&&(qjS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},q_.createWebGlTexture=function(){var qS=qjS.mainContext;this._canvas;var q_=this._source=qS.createTexture();this.iscpuSource=!1;var qa=qQS.curBindTexTarget,qR=qQS.curBindTexValue;qQS.bindTexture(qS,3553,q_),qS.pixelStorei(37440,this.flipY?1:0),qJ.premulAlpha&&qS.pixelStorei(37441,!0),qS.texImage2D(3553,0,6408,6408,5121,this._imgData),qJ.premulAlpha&&qS.pixelStorei(37441,!1),qS.texParameteri(3553,10240,9729),qS.texParameteri(3553,10241,9729),qS.texParameteri(3553,10242,33071),qS.texParameteri(3553,10243,33071),qS.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,qa&&qR&&qQS.bindTexture(qS,qa,qR)},q_.reloadCanvasData=function(){var qS=qjS.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var q_=qQS.curBindTexTarget,qa=qQS.curBindTexValue;qQS.bindTexture(qS,3553,this._source),qJ.premulAlpha&&qS.pixelStorei(37441,!0),qS.texImage2D(3553,0,6408,6408,5121,this._imgData),qJ.premulAlpha&&qS.pixelStorei(37441,!1),qS.pixelStorei(37440,0),q_&&qa&&qQS.bindTexture(qS,q_,qa)},q_.texSubImage2D=function(qS,q_,qa){var qR=qjS.mainContext,qJ=qQS.curBindTexTarget,qV=qQS.curBindTexValue;qQS.bindTexture(qR,3553,this._source),qR.pixelStorei(37441,!0),qR.texSubImage2D(3553,0,q_,qa,6408,5121,qS._source),qR.pixelStorei(37441,!1),qJ&&qV&&qQS.bindTexture(qR,qJ,qV)},q_.toBase64=function(qS,q_,qa){var qR=null;this._canvas&&(qR=this._canvas.toDataURL(qS,q_)),qa.call(this,qR)},qR(0,q_,"context",function(){return this._ctx}),qR(0,q_,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),qR(0,q_,"asBitmap",null,function(qS){this._ctx&&(this._ctx.asBitmap=qS)}),qJ._createContext=null,qJ.premulAlpha=!1,qJ}(),qZS=function(qS){function qV(qS,q_){this.CborderSize=12,qV.__super.call(this),this.char=qS,this.isSpace=" "===qS,this.xs=q_.scaleX,this.ys=q_.scaleY,this.font=q_.font.toString(),this.fontSize=q_.font.size,this.fillColor=q_.fillColor,this.borderColor=q_.borderColor,this.lineWidth=q_.lineWidth,this.underLine=q_.underLine;var qa,qR=qF.isConchApp;qR?((qa=ConchTextCanvas)._source=ConchTextCanvas,qa._source.canvas=ConchTextCanvas):qa=qG.canvas.source,this.canvas=qa,this._enableMerageInAtlas=!0,this._ctx=qR?qa:this.canvas.getContext("2d",void 0);var qJ=qM.measureText(this.char,this.font);this.cw=qJ.width*this.xs,this.ch=(qJ.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new qP(this)}qC(qV,"laya.webgl.resource.WebGLCharImage",qa);var q_=qV.prototype;return qm.imps(q_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),q_.active=function(){this.texture.active()},q_.recreateResource=function(){var qS=qF.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),qS){var q_=this.fontSize;1==this.xs&&1==this.ys||(q_=parseInt(q_*(this.xs>this.ys?this.xs:this.ys)+""));var qa="normal 100 "+this.font;qa=qa.replace(qV._fontSizeReg,q_),this.borderColor&&(qa+=" 1 "+this.borderColor),this._ctx.font=qa,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,qK.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var qR=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(qR,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},q_.onresize=function(qS,q_){this._w=qS,this._h=q_,this._allowMerageInAtlas=!0},q_.clearAtlasSource=function(){},qR(0,q_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),qR(0,q_,"atlasSource",function(){return this.canvas}),qR(0,q_,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(qS){this._enableMerageInAtlas=qS}),qV.createOneChar=function(qS,q_){return new qV(qS,q_)},qV._fontSizeReg=new RegExp("\\d+(?=px)","g"),qV}(),qpS=function(qS){function qb(qS,q_,qa,qR,qJ,qV,qW,qk,qz){void 0===qa&&(qa=6408),void 0===qR&&(qR=5121),void 0===qJ&&(qJ=34041),void 0===qV&&(qV=!1),void 0===qW&&(qW=!1),void 0===qk&&(qk=-1),void 0===qz&&(qz=1),qb.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=qS,this._h=q_,this._surfaceFormat=qa,this._surfaceType=qR,this._depthStencilFormat=qJ,this._mipMap=qV,this._repeat=qW,this._minFifter=qk,this._magFifter=qz}qC(qb,"laya.webgl.resource.WebGLRenderTarget",qa);var q_=qb.prototype;return q_.recreateResource=function(){var qS=qjS.mainContext;this._frameBuffer||(this._frameBuffer=qS.createFramebuffer()),this._source||(this._source=qS.createTexture());var q_=qQS.curBindTexTarget,qa=qQS.curBindTexValue;qQS.bindTexture(qS,3553,this._source),qS.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var qR=this._minFifter,qJ=this._magFifter,qV=this._repeat?10497:33071,qW=qH.isPOT(this._w,this._h);if(qW?(this._mipMap?-1!==qR||(qR=9987):-1!==qR||(qR=9729),-1!==qJ||(qJ=9729),qS.texParameteri(3553,10241,qR),qS.texParameteri(3553,10240,qJ),qS.texParameteri(3553,10242,qV),qS.texParameteri(3553,10243,qV),this._mipMap&&qS.generateMipmap(3553)):(-1!==qR||(qR=9729),-1!==qJ||(qJ=9729),qS.texParameteri(3553,10241,qR),qS.texParameteri(3553,10240,qJ),qS.texParameteri(3553,10242,33071),qS.texParameteri(3553,10243,33071)),qS.bindFramebuffer(36160,this._frameBuffer),qS.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=qS.createRenderbuffer()),qS.bindRenderbuffer(36161,this._depthStencilBuffer),qS.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:qS.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:qS.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:qS.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}qS.bindFramebuffer(36160,null),q_&&qa&&qQS.bindTexture(qS,q_,qa),qS.bindRenderbuffer(36161,null),qW&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},q_.disposeResource=function(){this._frameBuffer&&(qjS.mainContext.deleteTexture(this._source),qjS.mainContext.deleteFramebuffer(this._frameBuffer),qjS.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},qR(0,q_,"depthStencilBuffer",function(){return this._depthStencilBuffer}),qR(0,q_,"frameBuffer",function(){return this._frameBuffer}),qb}(),qcS=function(qS){function qk(qS,q_,qa,qR,qJ,qV,qW){this.offsetX=0,this.offsetY=0,qk.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=qV,this.canvas=qS,this._ctx=qS.getContext("2d",void 0),this._w=qR,this._h=qJ,this.offsetX=q_,this.offsetY=qa,this.src=qW,this._enableMerageInAtlas=!0,qs.enabled&&this._w<qs.atlasLimitWidth&&this._h<qs.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}qC(qk,"laya.webgl.resource.WebGLSubImage",qa);var q_=qk.prototype;return qm.imps(q_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),q_.size=function(qS,q_){this._w=qS,this._h=q_,this._ctx&&this._ctx.size(qS,q_),this.canvas&&(this.canvas.height=q_,this.canvas.width=qS)},q_.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},q_.createWebGlTexture=function(){var qS=qjS.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var q_=this._source=qS.createTexture(),qa=qQS.curBindTexTarget,qR=qQS.curBindTexValue;qQS.bindTexture(qS,3553,q_),qS.pixelStorei(37441,!0),qS.texImage2D(3553,0,6408,6408,5121,this.canvas),qS.pixelStorei(37441,!1);var qJ=this.minFifter,qV=this.magFifter,qW=this.repeat?10497:33071,qk=qH.isPOT(this.width,this.height);qk?(this.mipmap?-1!==qJ||(qJ=9987):-1!==qJ||(qJ=9729),-1!==qV||(qV=9729),qS.texParameteri(3553,10240,qV),qS.texParameteri(3553,10241,qJ),qS.texParameteri(3553,10242,qW),qS.texParameteri(3553,10243,qW),this.mipmap&&qS.generateMipmap(3553)):(-1!==qJ||(qJ=9729),-1!==qV||(qV=9729),qS.texParameteri(3553,10241,qJ),qS.texParameteri(3553,10240,qV),qS.texParameteri(3553,10242,33071),qS.texParameteri(3553,10243,33071)),qa&&qR&&qQS.bindTexture(qS,qa,qR),this.canvas=null,qk&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},q_.disposeResource=function(){qs.enabled&&this._allowMerageInAtlas||!this._source||(qjS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},q_.clearAtlasSource=function(){},qR(0,q_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),qR(0,q_,"atlasSource",function(){return this.canvas}),qR(0,q_,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(qS){this._allowMerageInAtlas=qS}),qk}(),qyS=function(qS){function qb(qS,q_,qa,qR){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,qb.__super.call(this),!qS||!q_)throw"Shader Error";this._id=++qb._count,this._vs=qS,this._ps=q_,this._nameMap=qR||{},null!=qa&&(qb.sharders[qa]=this)}qC(qb,"laya.webgl.shader.Shader",qMS);var q_=qb.prototype;return q_.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},q_.disposeResource=function(){qjS.mainContext.deleteShader(this._vshader),qjS.mainContext.deleteShader(this._pshader),qjS.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},q_._compile=function(){if(!qjS.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var qS=[this._vs,this._ps],q_=qjS.mainContext;if(this._program=q_.createProgram(),this._vshader=qb._createShader(q_,qS[0],35633),this._pshader=qb._createShader(q_,qS[1],35632),q_.attachShader(this._program,this._vshader),q_.attachShader(this._program,this._pshader),q_.linkProgram(this._program),!qF.isConchApp&&!q_.getProgramParameter(this._program,35714))throw q_.getProgramInfoLog(this._program);var qa,qR,qJ=0,qV=0;for(qV=qF.isConchApp?q_.getProgramParameterEx(this._vs,this._ps,"",35721):q_.getProgramParameter(this._program,35721),qJ=0;qJ<qV;qJ++){var qW=null;qa={vartype:"attribute",glfun:null,ivartype:0,attrib:qW=qF.isConchApp?q_.getActiveAttribEx(this._vs,this._ps,"",qJ):q_.getActiveAttrib(this._program,qJ),location:q_.getAttribLocation(this._program,qW.name),name:qW.name,type:qW.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(qa)}var qk=0;for(qk=qF.isConchApp?q_.getProgramParameterEx(this._vs,this._ps,"",35718):q_.getProgramParameter(this._program,35718),qJ=0;qJ<qk;qJ++){var qz=null;qz=qF.isConchApp?q_.getActiveUniformEx(this._vs,this._ps,"",qJ):q_.getActiveUniform(this._program,qJ),0<(qa={vartype:"uniform",glfun:null,ivartype:1,attrib:qW,location:q_.getUniformLocation(this._program,qz.name),name:qz.name,type:qz.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(qa.name=qa.name.substr(0,qa.name.length-3),qa.isArray=!0,qa.location=q_.getUniformLocation(this._program,qa.name)),this._params.push(qa)}for(qJ=0,qR=this._params.length;qJ<qR;qJ++)if((qa=this._params[qJ]).indexOfParams=qJ,qa.index=1,qa.value=[qa.location,null],qa.codename=qa.name,qa.name=this._nameMap[qa.codename]?this._nameMap[qa.codename]:qa.codename,(this._paramsMap[qa.name]=qa)._this=this,qa.uploadedValue=[],"attribute"!==qa.vartype)switch(qa.type){case 5124:qa.fun=qa.isArray?this._uniform1iv:this._uniform1i;break;case 5126:qa.fun=qa.isArray?this._uniform1fv:this._uniform1f;break;case 35664:qa.fun=qa.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:qa.fun=qa.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:qa.fun=qa.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:qa.fun=this._uniform_sampler2D;break;case 35680:qa.fun=this._uniform_samplerCube;break;case 35676:qa.glfun=q_.uniformMatrix4fv,qa.fun=this._uniformMatrix4fv;break;case 35670:qa.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else qa.fun=this._attribute}},q_.getUniform=function(qS){return this._paramsMap[qS]},q_._attribute=function(qS,q_){var qa=qjS.mainContext,qR=qeS._enableAtributes,qJ=qS.location;return qR[qJ]||qa.enableVertexAttribArray(qJ),qa.vertexAttribPointer(qJ,q_[0],q_[1],q_[2],q_[3],q_[4]+this._offset),qR[qJ]=qeS._bindVertexBuffer,1},q_._uniform1f=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_?(qjS.mainContext.uniform1f(qS.location,qa[0]=q_),1):0},q_._uniform1fv=function(qS,q_){if(q_.length<4){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qjS.mainContext.uniform1fv(qS.location,q_),qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3],1):0}return qjS.mainContext.uniform1fv(qS.location,q_),1},q_._uniform_vec2=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]?(qjS.mainContext.uniform2f(qS.location,qa[0]=q_[0],qa[1]=q_[1]),1):0},q_._uniform_vec2v=function(qS,q_){if(q_.length<2){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qjS.mainContext.uniform2fv(qS.location,q_),qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3],1):0}return qjS.mainContext.uniform2fv(qS.location,q_),1},q_._uniform_vec3=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]?(qjS.mainContext.uniform3f(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2]),1):0},q_._uniform_vec3v=function(qS,q_){return qjS.mainContext.uniform3fv(qS.location,q_),1},q_._uniform_vec4=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qjS.mainContext.uniform4f(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3]),1):0},q_._uniform_vec4v=function(qS,q_){return qjS.mainContext.uniform4fv(qS.location,q_),1},q_._uniformMatrix2fv=function(qS,q_){return qjS.mainContext.uniformMatrix2fv(qS.location,!1,q_),1},q_._uniformMatrix3fv=function(qS,q_){return qjS.mainContext.uniformMatrix3fv(qS.location,!1,q_),1},q_._uniformMatrix4fv=function(qS,q_){return qjS.mainContext.uniformMatrix4fv(qS.location,!1,q_),1},q_._uniform1i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_?(qjS.mainContext.uniform1i(qS.location,qa[0]=q_),1):0},q_._uniform1iv=function(qS,q_){return qjS.mainContext.uniform1iv(qS.location,q_),1},q_._uniform_ivec2=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]?(qjS.mainContext.uniform2i(qS.location,qa[0]=q_[0],qa[1]=q_[1]),1):0},q_._uniform_ivec2v=function(qS,q_){return qjS.mainContext.uniform2iv(qS.location,q_),1},q_._uniform_vec3i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]?(qjS.mainContext.uniform3i(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2]),1):0},q_._uniform_vec3vi=function(qS,q_){return qjS.mainContext.uniform3iv(qS.location,q_),1},q_._uniform_vec4i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qjS.mainContext.uniform4i(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3]),1):0},q_._uniform_vec4vi=function(qS,q_){return qjS.mainContext.uniform4iv(qS.location,q_),1},q_._uniform_sampler2D=function(qS,q_){var qa=qjS.mainContext,qR=qS.uploadedValue;return null==qR[0]?(qR[0]=this._curActTexIndex,qa.uniform1i(qS.location,this._curActTexIndex),qa.activeTexture(qb._TEXTURES[this._curActTexIndex]),qQS.bindTexture(qa,3553,q_),this._curActTexIndex++,1):(qa.activeTexture(qb._TEXTURES[qR[0]]),qQS.bindTexture(qa,3553,q_),0)},q_._uniform_samplerCube=function(qS,q_){var qa=qjS.mainContext,qR=qS.uploadedValue;return null==qR[0]?(qR[0]=this._curActTexIndex,qa.uniform1i(qS.location,this._curActTexIndex),qa.activeTexture(qb._TEXTURES[this._curActTexIndex]),qQS.bindTexture(qa,34067,q_),this._curActTexIndex++,1):(qa.activeTexture(qb._TEXTURES[qR[0]]),qQS.bindTexture(qa,34067,q_),0)},q_._noSetValue=function(qS){console.log("no....:"+qS.name)},q_.uploadOne=function(qS,q_){this.activeResource(),qQS.UseProgram(this._program);var qa=this._paramsMap[qS];qa.fun.call(this,qa,q_)},q_.uploadTexture2D=function(qS){qX.shaderCall++;var q_=qjS.mainContext;q_.activeTexture(33984),qQS.bindTexture(q_,3553,qS)},q_.uploadTexture2D1=function(qS){qX.shaderCall++;var q_=qjS.mainContext;q_.activeTexture(33985),qQS.bindTexture(q_,3553,qS)},q_.upload=function(qS,q_){qMS.activeShader=qMS.bindShader=this,this._lastUseFrameCount===qX.loopCount||this.activeResource(),qQS.UseProgram(this._program),this._reCompile?(q_=this._params,this._reCompile=!1):q_=q_||this._params;qjS.mainContext;for(var qa,qR,qJ=q_.length,qV=0,qW=0;qW<qJ;qW++)null!==(qR=qS[(qa=q_[qW]).name])&&(qV+=qa.fun.call(this,qa,qR));qX.shaderCall+=qV},q_.uploadArray=function(qS,q_,qa){qMS.activeShader=this,(qMS.bindShader=this).activeResource(),qQS.UseProgram(this._program);this._params;for(var qR,qJ,qV=0,qW=q_-2;0<=qW;qW-=2)(qJ=this._paramsMap[qS[qW]])&&null!=(qR=qS[qW+1])&&(qa&&qa[qJ.name]&&qa[qJ.name].bind(),qV+=qJ.fun.call(this,qJ,qR));qX.shaderCall+=qV},q_.getParams=function(){return this._params},qb.getShader=function(qS){return qb.sharders[qS]},qb.create=function(qS,q_,qa,qR){return new qb(qS,q_,qa,qR)},qb.withCompile=function(qS,q_,qa,qR){if(qa&&qb.sharders[qa])return qb.sharders[qa];var qJ=qb._preCompileShader[2e-4*qS];if(!qJ)throw new Error("withCompile shader err!"+qS);return qJ.createShader(q_,qa,qR)},qb.withCompile2D=function(qS,q_,qa,qR,qJ){if(qR&&qb.sharders[qR])return qb.sharders[qR];var qV=qb._preCompileShader[2e-4*qS+q_];if(!qV)throw new Error("withCompile shader err!"+qS+" "+q_);return qV.createShader(qa,qR,qJ)},qb.addInclude=function(qS,q_){qDS.addInclude(qS,q_)},qb.preCompile=function(qS,q_,qa,qR){var qJ=2e-4*qS;qb._preCompileShader[qJ]=new qDS(qJ,q_,qa,qR)},qb.preCompile2D=function(qS,q_,qa,qR,qJ){var qV=2e-4*qS+q_;qb._preCompileShader[qV]=new qDS(qV,qa,qR,qJ)},qb._createShader=function(qS,q_,qa){var qR=qS.createShader(qa);return qS.shaderSource(qR,q_),qS.compileShader(qR),qR},qb._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],qb._count=0,qb._preCompileShader={},qb.SHADERNAME2ID=2e-4,qb.sharders=((qb.sharders=[]).length=32,qb.sharders),qW(qb,["nameKey",function(){return this.nameKey=new qh}]),qb}(),qES=function(qS){function q_(){this._maxsize=0,this._upload=!0,this._uploadSize=0,q_.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}qC(q_,"laya.webgl.utils.Buffer2D",qS);var qa=q_.prototype;return qa.needSize=function(qS){var q_=this._byteLength;if(qS){var qa=this._byteLength+qS;qa<=this._buffer.byteLength||this._resizeBuffer(qa<<1,!0),this._byteLength=qa}return q_},qa._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),qX.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,qeS._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),qeS._gl.bufferSubData(this._bufferType,0,this._buffer)},qa._bufferSubData=function(qS,q_,qa){if(void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),this._maxsize=Math.max(this._maxsize,this._byteLength),qX.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,qeS._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),q_||qa){var qR=this._buffer.slice(q_,qa);qeS._gl.bufferSubData(this._bufferType,qS,qR)}else qeS._gl.bufferSubData(this._bufferType,qS,this._buffer)},qa._checkArrayUse=function(){},qa._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},qa._bind_subUpload=function(qS,q_,qa){return void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(qS,q_,qa),!0)},qa._resizeBuffer=function(qS,q_){if(qS<this._buffer.byteLength)return this;if(this.memorySize=qS,q_&&this._buffer&&0<this._buffer.byteLength){var qa=new ArrayBuffer(qS);new Uint8Array(qa).set(new Uint8Array(this._buffer),0),this._buffer=qa}else this._buffer=new ArrayBuffer(qS);return this._checkArrayUse(),this._upload=!0,this},qa.append=function(qS){this._upload=!0;var q_,qa;q_=qS.byteLength,qS instanceof Uint8Array?(this._resizeBuffer(this._byteLength+q_,!0),qa=new Uint8Array(this._buffer,this._byteLength)):qS instanceof Uint16Array?(this._resizeBuffer(this._byteLength+q_,!0),qa=new Uint16Array(this._buffer,this._byteLength)):qS instanceof Float32Array&&(this._resizeBuffer(this._byteLength+q_,!0),qa=new Float32Array(this._buffer,this._byteLength)),qa.set(qS,0),this._byteLength+=q_,this._checkArrayUse()},qa.appendU16Array=function(qS,q_){this._resizeBuffer(this._byteLength+2*q_,!0);for(var qa=new Uint16Array(this._buffer,this._byteLength,q_),qR=0;qR<q_;qR++)qa[qR]=qS[qR];this._byteLength+=2*q_,this._checkArrayUse()},qa.appendEx=function(qS,q_){this._upload=!0;var qa;qa=qS.byteLength,this._resizeBuffer(this._byteLength+qa,!0),new q_(this._buffer,this._byteLength).set(qS,0),this._byteLength+=qa,this._checkArrayUse()},qa.appendEx2=function(qS,q_,qa,qR){void 0===qR&&(qR=1),this._upload=!0;var qJ,qV;qJ=qa*qR,this._resizeBuffer(this._byteLength+qJ,!0),qV=new q_(this._buffer,this._byteLength);var qW=0;for(qW=0;qW<qa;qW++)qV[qW]=qS[qW];this._byteLength+=qJ,this._checkArrayUse()},qa.getBuffer=function(){return this._buffer},qa.setNeedUpload=function(){this._upload=!0},qa.getNeedUpload=function(){return this._upload},qa.upload=function(){var qS=this._bind_upload();return qeS._gl.bindBuffer(this._bufferType,null),qeS._bindActive[this._bufferType]=null,qMS.activeShader=null,qS},qa.subUpload=function(qS,q_,qa){void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0);var qR=this._bind_subUpload();return qeS._gl.bindBuffer(this._bufferType,null),qeS._bindActive[this._bufferType]=null,qMS.activeShader=null,qR},qa.disposeResource=function(){qS.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},qa.clear=function(){this._byteLength=0,this._upload=!0},qR(0,qa,"bufferLength",function(){return this._buffer.byteLength}),qR(0,qa,"byteLength",null,function(qS){this._byteLength!==qS&&(qS<=this._buffer.byteLength||this._resizeBuffer(2*qS+256,!0),this._byteLength=qS)}),q_.__int__=function(qS){qvS.QuadrangleIB=qvS.create(35044),q$S.fillIBQuadrangle(qvS.QuadrangleIB,16)},q_.FLOAT32=4,q_.SHORT=2,q_}(qeS),qOS=(function(q_){function qa(qS){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,qa.__super.call(this,9)}qC(qa,"laya.webgl.shader.d2.value.GlowSV",q_);var qS=qa.prototype;qS.setValue=function(qS){q_.prototype.setValue.call(this,qS)},qS.clear=function(){q_.prototype.clear.call(this)}}(qUS),function(qS){function q_(qS){q_.__super.call(this,64),this.defines.add(64)}qC(q_,"laya.webgl.shader.d2.value.TextSV",qS);var qa=q_.prototype;return qa.release=function(){(q_.pool[q_._length++]=this).clear()},qa.clear=function(){qS.prototype.clear.call(this)},q_.create=function(){return q_._length?q_.pool[--q_._length]:new q_(null)},q_.pool=[],q_._length=0,q_}(qUS)),qwS=function(qS){function qJ(qS,q_,qa,qR){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,qJ.__super.call(this,qS,q_,qa,qR)}qC(qJ,"laya.webgl.shader.d2.Shader2X",qS);var q_=qJ.prototype;return q_.upload2dQuick1=function(qS){this.upload(qS,this._params2dQuick1||this._make2dQuick1())},q_._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var qS,q_=this._params,qa=0,qR=q_.length;qa<qR;qa++)qS=q_[qa],(qF.isFlash||"size"!==qS.name&&"position"!==qS.name&&"texcoord"!==qS.name)&&this._params2dQuick1.push(qS)}return this._params2dQuick1},q_.disposeResource=function(){qS.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},q_.upload2dQuick2=function(qS){this.upload(qS,this._params2dQuick2||this._make2dQuick2())},q_._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var qS,q_=this._params,qa=0,qR=q_.length;qa<qR;qa++)qS=q_[qa],(qF.isFlash||"size"!==qS.name)&&this._params2dQuick2.push(qS)}return this._params2dQuick2},qJ.create=function(qS,q_,qa,qR){return new qJ(qS,q_,qa,qR)},qJ}(qyS),qvS=function(qS){function q_(qS){this._uint8Array=null,this._uint16Array=null,void 0===qS&&(qS=35044),q_.__super.call(this),this._bufferUsage=qS,this._bufferType=34963,qF.isFlash||(this._buffer=new ArrayBuffer(8))}qC(q_,"laya.webgl.utils.IndexBuffer2D",qES);var qa=q_.prototype;return qa._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},qa.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},qa.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},qa.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},q_.QuadrangleIB=null,q_.create=function(qS){return void 0===qS&&(qS=35044),new q_(qS)},q_}(),qdS=function(qS){function qa(qS,q_){this._floatArray32=null,this._vertexStride=0,qa.__super.call(this),this._vertexStride=qS,this._bufferUsage=q_,this._bufferType=34962,qF.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}qC(qa,"laya.webgl.utils.VertexBuffer2D",qS);var q_=qa.prototype;return q_.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},q_.bind=function(qS){qS&&qS._bind(),this._bind()},q_.insertData=function(qS,q_){this.getFloat32Array().set(qS,q_),this._upload=!0},q_.bind_upload=function(qS){qS._bind_upload()||qS._bind(),this._bind_upload()||this._bind()},q_._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},q_.disposeResource=function(){qS.prototype.disposeResource.call(this)},q_.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},qR(0,q_,"vertexStride",function(){return this._vertexStride}),qa.create=function(qS,q_){return void 0===q_&&(q_=35048),new qa(qS,q_)},qa}(qES),qS_=function(qS){function qk(qS,q_,qa,qR,qJ,qV){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===qa&&(qa=6408),void 0===qR&&(qR=!0),qk.__super.call(this,qS,q_),qS){if(this._format=qa,this._mipmap=qR,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof qS)this._url=qS,this._src=qS,this._image=new qG.window.Image,q_&&(q_.onload&&(this.onload=q_.onload),q_.onerror&&(this.onerror=q_.onerror),q_.onCreate&&q_.onCreate(this)),this._image.crossOrigin=qS&&0==qS.indexOf("data:")?null:"",qS&&(this._image.src=qS);else if(qS instanceof ArrayBuffer){this._src=q_,this._url=this._src;var qW=new qz(qS);qW.readUTFBytes(4),qW.readUTFBytes(2),qW.getInt16();qW.endian="bigEndian",this._w=qW.getInt16(),this._h=qW.getInt16();qW.getInt16(),qW.getInt16();this._image=new Uint8Array(qS,qW.pos),this._format=qjS.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,qs.enabled&&this._w<qs.atlasLimitWidth&&this._h<qs.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(qS instanceof Uint8Array))return this._src=q_,this._url=this._src,this._image=qS.source||qS,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=q_,this._url=this._src,this._w=qJ,this._h=qV,this._image=qS,this._format=0===qa?qS.byteLength/(qJ*qV)==4?6408:6407:qa}this._$5__enableMerageInAtlas=!0}}qC(qk,"laya.webgl.resource.WebGLImage",qo);var q_=qk.prototype;return qm.imps(q_,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),q_._init_=function(qS,q_){},q_._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var qS=qjS.mainContext,q_=this._source=qS.createTexture(),qa=qQS.curBindTexTarget,qR=qQS.curBindTexValue;qQS.bindTexture(qS,3553,q_);var qJ=this.minFifter,qV=this.magFifter,qW=this.repeat?10497:33071,qk=qH.isPOT(this._w,this._h),qz=!1;switch(qk?(this.mipmap?-1!==qJ||(qJ=9987):-1!==qJ||(qJ=9729),-1!==qV||(qV=9729),qS.texParameteri(3553,10241,qJ),qS.texParameteri(3553,10240,qV),qS.texParameteri(3553,10242,qW),qS.texParameteri(3553,10243,qW),this.mipmap&&qS.generateMipmap(3553)):(-1!==qJ||(qJ=9729),-1!==qV||(qV=9729),qS.texParameteri(3553,10241,qJ),qS.texParameteri(3553,10240,qV),qS.texParameteri(3553,10242,33071),qS.texParameteri(3553,10243,33071)),qS.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&qS.pixelStorei(qS.UNPACK_ALIGNMENT,1),qS.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&qS.pixelStorei(qS.UNPACK_ALIGNMENT,1),qS.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:qz=!0,qS.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case qjS.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:qz=!0,qS.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}qS.pixelStorei(37441,!1),qa&&qR&&qQS.bindTexture(qS,qa,qR),this.uri||(this.uri=this._url),qz?this.memorySize=this._image.length:qk&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},q_.recreateResource=function(){var qS=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var q_=this;this._image=new qG.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(q_._needReleaseAgain)return q_._needReleaseAgain=!1,q_._image.onload=null,void(q_._image=null);q_._allowMerageInAtlas&&q_._enableMerageInAtlas?(qS.memorySize=0,qS._recreateLock=!1):q_._createWebGlTexture(),q_.completeCreate()},this._image.src=this._src}},q_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&qjS.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},q_.onresize=function(){this._w=this._image.width,this._h=this._image.height,qs.enabled&&this._w<qs.atlasLimitWidth&&this._h<qs.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},q_.clearAtlasSource=function(){this._image=null},qR(0,q_,"format",function(){return this._format}),qR(0,q_,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(qS){this._$5__enableMerageInAtlas=qS}),qR(0,q_,"mipmap",function(){return this._mipmap}),qR(0,q_,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),qR(0,q_,"atlasSource",function(){return this._image}),qR(0,q_,"onload",null,function(qS){var q_=this;this._onload=qS,this._image&&(this._image.onload=null!=this._onload?function(){q_.onresize(),q_._onload()}:null)}),qR(0,q_,"onerror",null,function(qS){var q_=this;this._onerror=qS,this._image&&(this._image.onerror=null!=this._onerror?function(){q_._onerror()}:null)}),qk}();qm.__init([qGS,qx,qqS,qDS])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}}),function(qV,qS,qR){qR.un,qR.uns;var qJ=qR.static,qW=qR.class,qk=qR.getset,qz=(qR.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),qt=laya.utils.ClassUtils,qL=(laya.events.Event,laya.utils.HTMLChar),qb=laya.net.Loader,qH=(laya.display.Node,laya.maths.Rectangle),qC=laya.renders.Render,qG=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),qo=laya.utils.Stat,qM=laya.display.Text,q$=laya.resource.Texture,qF=laya.net.URL,qT=laya.utils.Utils,qD=function(){function qG(){}return qW(qG,"laya.html.utils.HTMLParse"),qG.parse=function(qS,q_,qa){q_=(q_="<root>"+(q_=q_.replace(/<br>/g,"<br/>"))+"</root>").replace(qG.spacePattern,qG.char255);var qR=qT.parseXMLFromString(q_);qG._parseXML(qS,qR.childNodes[0].childNodes,qa)},qG._parseXML=function(qS,q_,qa,qR){var qJ=0,qV=0;if(q_.join||q_.item)for(qJ=0,qV=q_.length;qJ<qV;++qJ)qG._parseXML(qS,q_[qJ],qa,qR);else{var qW,qk,qz;if(3==q_.nodeType)return void(qS instanceof laya.html.dom.HTMLDivElement?(null==q_.nodeName&&(q_.nodeName="#text"),qk=q_.nodeName.toLowerCase(),0<(qz=q_.textContent.replace(/^\s+|\s+$/g,"")).length&&(qW=qt.getInstance(qk))&&(qS.addChild(qW),qW.innerTEXT=qz.replace(qG.char255AndOneSpacePattern," "))):0<(qz=q_.textContent.replace(/^\s+|\s+$/g,"")).length&&(qS.innerTEXT=qz.replace(qG.char255AndOneSpacePattern," ")));if("#comment"==(qk=q_.nodeName.toLowerCase()))return;if(qW=qt.getInstance(qk)){(qW=qS.addChild(qW)).URI=qa,qW.href=qR;var qb=q_.attributes;if(qb&&0<qb.length)for(qJ=0,qV=qb.length;qJ<qV;++qJ){var qH=qb[qJ],qL=qH.nodeName,qC=qH.value;qW._setAttributes(qL,qC)}qG._parseXML(qW,q_.childNodes,qa,qW.href)}else qG._parseXML(qS,q_.childNodes,qa,qR)}},qG.char255=String.fromCharCode(255),qG.spacePattern=/&nbsp;|&#160;/g,qG.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),qG}(),qj=function(){function qP(){}return qW(qP,"laya.html.utils.Layout"),qP.later=function(qS){null==qP._will&&(qP._will=[],qR.stage.frameLoop(1,null,function(){if(!(qP._will.length<1)){for(var qS=0;qS<qP._will.length;qS++)laya.html.utils.Layout.layout(qP._will[qS]);qP._will.length=0}})),qP._will.push(qS)},qP.layout=function(qS){if(!qS||!qS._style)return null;if(0==(512&qS._style._type))return null;qS.getStyle()._type&=-513;var q_=qP._multiLineLayout(qS);return qC.isConchApp&&qS.layaoutCallNative&&qS.layaoutCallNative(),q_},qP._multiLineLayout=function(qS){if(qM.RightToLeft)return qP._multiLineLayout2(qS);var q_=new Array;qS._addChildsToLayout(q_);var qa,qR,qJ,qV,qW,qk=0,qz=q_.length,qb=qS._getCSSStyle(),qH=qb.letterSpacing,qL=qb.leading,qC=qb.lineHeight,qG=qb._widthAuto()||!qb.wordWrap,qt=qG?999999:qS.width,qo=(qS.height,0),q$=qb.italic?qb.fontSize/3:0,qF=qb._getAlign(),qT=qb._getValign(),qD=0!==qT||0!==qF||0!=qC,qj=0,qQ=0,qm=0,qq=0,qN=new Array,qn=qN[0]=new qr,ql=!1,qB=!1;qn.h=0,qb.italic&&(qt-=qb.fontSize/3);var qI=0,qA=!0;function qX(){qn.y=qQ,qQ+=qn.h+qL,0==qn.h&&(qQ+=qC),qn.mWidth=qI,qI=0,qn=new qr,qN.push(qn),qn.h=0,ql=!(qA=!(qj=0))}for(qk=0;qk<qz;qk++)if(null!=(qa=q_[qk]))if(qA=!1,qa instanceof laya.html.dom.HTMLBrElement)qX(),qn.y=qQ;else{if(qa._isChar()){if((qV=qa).isWord)ql=qB||"\n"===qV.char,qn.wordStartIndex=qn.elements.length;else{if(qm=qV.width+qV.style.letterSpacin,0<qN.length&&qt<qj+qm&&0<qn.wordStartIndex){var qh;qh=qn.elements.length-qn.wordStartIndex+1,qn.elements.length=qn.wordStartIndex,qk-=qh,qX();continue}ql=!1,qI+=qV.width}qm=qV.width+qH,qq=qV.height,qB=!1,(ql=ql||qt<qj+qm)&&qX(),qn.minTextHeight=Math.min(qn.minTextHeight,qa.height)}else qR=qa._getCSSStyle(),qW=qa,qJ=qR.padding,0===qR._getCssFloat()||(qD=!0),ql=qB||qR.lineElement,qm=qW.width*qW._style._tf.scaleX+qJ[1]+qJ[3]+qH,qq=qW.height*qW._style._tf.scaleY+qJ[0]+qJ[2],qB=qR.lineElement,(ql=ql||qt<qj+qm&&qR.wordWrap)&&qX();qn.elements.push(qa),qn.h=Math.max(qn.h,qq),qa.x=qj,qa.y=qQ,qj+=qm,qn.w=qj-qH,qn.y=qQ,qo=Math.max(qj+q$,qo)}else qA||(qj+=qP.DIV_ELEMENT_PADDING),qn.wordStartIndex=qn.elements.length;if(qQ=qn.y+qn.h,qD){var qu=0,qK=qt;for(qG&&0<qS.width&&(qK=qS.width),qk=0,qz=qN.length;qk<qz;qk++)qN[qk].updatePos(0,qK,qk,qu,qF,qT,qC),qu+=Math.max(qC,qN[qk].h+qL);qQ=qu}return qG&&(qS.width=qo),qQ>qS.height&&(qS.height=qQ),[qo,qQ]},qP._multiLineLayout2=function(qS){var q_=new Array;qS._addChildsToLayout(q_);var qa,qR,qJ,qV,qW,qk=0,qz=q_.length,qb=qS._getCSSStyle(),qH=qb.letterSpacing,qL=qb.leading,qC=qb.lineHeight,qG=qb._widthAuto()||!qb.wordWrap,qt=qG?999999:qS.width,qo=(qS.height,0),q$=qb.italic?qb.fontSize/3:0,qF=2-qb._getAlign(),qT=qb._getValign(),qD=0!==qT||0!=qF||0!=qC,qj=0,qQ=0,qm=0,qq=0,qN=new Array,qn=qN[0]=new qr,ql=!1,qB=!1;qn.h=0,qb.italic&&(qt-=qb.fontSize/3);var qI=0,qA=!0;function qX(){qn.y=qQ,qQ+=qn.h+qL,0==qn.h&&(qQ+=qC),qn.mWidth=qI,qI=0,qn=new qr,qN.push(qn),qn.h=0,ql=!(qA=!(qj=0))}for(qk=0;qk<qz;qk++)if(null!=(qa=q_[qk]))if(qA=!1,qa instanceof laya.html.dom.HTMLBrElement)qX(),qn.y=qQ;else{if(qa._isChar()){if((qV=qa).isWord)ql=qB||"\n"===qV.char,qn.wordStartIndex=qn.elements.length;else{if(0<qN.length&&qt<qj+qm&&0<qn.wordStartIndex){var qh;qh=qn.elements.length-qn.wordStartIndex+1,qn.elements.length=qn.wordStartIndex,qk-=qh,qX();continue}ql=!1,qI+=qV.width}qm=qV.width+qH,qq=qV.height,qB=!1,(ql=ql||qt<qj+qm)&&qX(),qn.minTextHeight=Math.min(qn.minTextHeight,qa.height)}else qR=qa._getCSSStyle(),qW=qa,qJ=qR.padding,0===qR._getCssFloat()||(qD=!0),ql=qB||qR.lineElement,qm=qW.width*qW._style._tf.scaleX+qJ[1]+qJ[3]+qH,qq=qW.height*qW._style._tf.scaleY+qJ[0]+qJ[2],qB=qR.lineElement,(ql=ql||qt<qj+qm&&qR.wordWrap)&&qX();qn.elements.push(qa),qn.h=Math.max(qn.h,qq),qa.x=qj,qa.y=qQ,qj+=qm,qn.w=qj-qH,qn.y=qQ,qo=Math.max(qj+q$,qo)}else qA||(qj+=qP.DIV_ELEMENT_PADDING),qn.wordStartIndex=qn.elements.length;if(qQ=qn.y+qn.h,qD){var qu=0,qK=qt;for(qk=0,qz=qN.length;qk<qz;qk++)qN[qk].updatePos(0,qK,qk,qu,qF,qT,qC),qu+=Math.max(qC,qN[qk].h+qL);qQ=qu}for(qG&&(qS.width=qo),qQ>qS.height&&(qS.height=qQ),qk=0,qz=qN.length;qk<qz;qk++)qN[qk].revertOrder(qt);return[qo,qQ]},qP._will=null,qP.DIV_ELEMENT_PADDING=0,qP}(),qr=function(){function qS(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}qW(qS,"laya.html.utils.LayoutLine");var q_=qS.prototype;return q_.updatePos=function(qS,q_,qa,qR,qJ,qV,qW){var qk,qz=0;0<this.elements.length&&(qz=(qk=this.elements[this.elements.length-1]).x+qk.width-this.elements[0].x);var qb=0,qH=NaN;1===qJ&&(qb=(q_-qz)/2),2===qJ&&(qb=q_-qz),0===qW||0!=qV||(qV=1);for(var qL=0,qC=this.elements.length;qL<qC;qL++){var qG=(qk=this.elements[qL])._getCSSStyle();switch(0!==qb&&(qk.x+=qb),qG._getValign()){case 0:qk.y=qR;break;case 1:var qt=0;99999!=this.minTextHeight&&(qt=this.minTextHeight);var qo=(qt+qW)/2;qo=Math.max(qo,this.h),qH=(laya.html.dom.HTMLImageElement,qR+qo-qk.height),qk.y=qH;break;case 2:qk.y=qR+(qW-qk.height)}}},q_.revertOrder=function(qS){var q_;if(0<this.elements.length){var qa,qR=0;for(qa=this.elements.length,qR=0;qR<qa;qR++)(q_=this.elements[qR]).x=qS-q_.x-q_.width}},qS}(),qQ=function(qa){function q_(){this.URI=null,this._href=null,q_.__super.call(this),this._text=q_._EMPTYTEXT,this.setStyle(new qz(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}qW(q_,"laya.html.dom.HTMLElement",qa);var qS=q_.prototype;return qS.layaoutCallNative=function(){var qS=0;if(this._childs&&0<(qS=this._childs.length))for(var q_=0;q_<qS;q_++)this._childs[q_].layaoutCallNative&&this._childs[q_].layaoutCallNative();var qa=this._getWords();qa?laya.html.dom.HTMLElement.fillWords(this,qa,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},qS.appendChild=function(qS){return this.addChild(qS)},qS._getWords2=function(){var qS=this._text.text;if(!qS||0===qS.length)return null;var q_,qa,qR=0,qJ=0;if(this._text.drawWords)qa=this._text.drawWords;else{for(qJ=(q_=qS.split(" ")).length-1,qa=[],qR=0;qR<qJ;qR++)qa.push(q_[qR]," ");0<=qJ&&qa.push(q_[qJ]),this._text.drawWords=qa}var qV,qW=this._text.words;if(qW&&qW.length===qa.length)return qW;null===qW&&(this._text.words=qW=[]),qW.length=qa.length;var qk=this.style,qz=qk.font;for(qR=0,qJ=qa.length;qR<qJ;qR++){qV=qT.measureText(qa[qR],qz);var qb=qW[qR]=new qL(qa[qR],qV.width,qV.height||qk.fontSize,qk);if(1<qb.char.length&&(qb.charNum=qb.char),this.href){var qH=new qG;this.addChild(qH),qb.setSprite(qH)}}return qW},qS._getWords=function(){if(!qM.CharacterCache)return this._getWords2();var qS=this._text.text;if(!qS||0===qS.length)return null;var q_,qa=this._text.words;if(qa&&qa.length===qS.length)return qa;null===qa&&(this._text.words=qa=[]),qa.length=qS.length;for(var qR=this.style,qJ=qR.font,qV=0,qW=qS.length;qV<qW;qV++)if(q_=qT.measureText(qS.charAt(qV),qJ)){var qk=qa[qV]=new qL(qS.charAt(qV),q_.width,q_.height||qR.fontSize,qR);if(this.href){var qz=new qG;this.addChild(qz),qk.setSprite(qz)}}else console.warn("_getWords size is null"+qS.charAt(qV),qJ);return qa},qS.showLinkSprite=function(){var qS=this._text.words;if(qS)for(var q_,qa,qR=[],qJ=0;qJ<qS.length;qJ++)qa=qS[qJ],(q_=new qG).graphics.drawRect(0,0,qa.width,qa.height,"#ff0000"),q_.width=qa.width,q_.height=qa.height,this.addChild(q_),qR.push(q_)},qS._layoutLater=function(){var qS=this.style;512&qS._type||(qS.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&qS.block?(qj.later(this),qS._type|=512):this.parent&&this.parent._layoutLater())},qS._setAttributes=function(qS,q_){switch(qS){case"style":return void this.style.cssText(q_);case"class":return void(this.className=q_)}qa.prototype._setAttributes.call(this,qS,q_)},qS.updateHref=function(){if(null!=this._href){var qS=this._getWords();if(qS)for(var q_,qa,qR=0;qR<qS.length;qR++)(qa=(q_=qS[qR]).getSprite())&&(qa.size(q_.width,q_.height),qa.on("click",this,this.onLinkHandler))}},qS.onLinkHandler=function(qS){switch(qS.type){case"click":for(var q_=this;q_;)q_.event("link",[this.href]),q_=q_.parent}},qS.formatURL=function(qS){return this.URI?qF.formatURL(qS,this.URI?this.URI.path:null):qS},qk(0,qS,"href",function(){return this._href},function(qS){null!=(this._href=qS)&&(this._getCSSStyle().underLine=1,this.updateHref())}),qk(0,qS,"color",null,function(qS){this.style.color=qS}),qk(0,qS,"onClick",null,function(qS){qR._runScript("fn=function(event){"+qS+";}"),this.on("click",this,void 0)}),qk(0,qS,"id",null,function(qS){qm.document.setElementById(qS,this)}),qk(0,qS,"innerTEXT",function(){return this._text.text},function(qS){this.text=qS}),qk(0,qS,"style",function(){return this._style}),qk(0,qS,"text",function(){return this._text.text},function(qS){this._text==q_._EMPTYTEXT?this._text={text:qS,words:null}:(this._text.text=qS,this._text.words&&(this._text.words.length=0)),qC.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),qk(0,qS,"parent",qa.prototype._$get_parent,function(qS){if(qS instanceof laya.html.dom.HTMLElement){var q_=qS;this.URI||(this.URI=q_.URI),this.style.inherit(q_.style)}qR.superSet(qG,this,"parent",qS)}),qk(0,qS,"className",null,function(qS){this.style.attrs(qm.document.styleSheets["."+qS])}),q_.fillWords=function(qS,q_,qa,qR,qJ,qV,qW){qS.graphics.clear();for(var qk=0,qz=q_.length;qk<qz;qk++){var qb=q_[qk];qS.graphics.fillText(qb.char,qb.x+qa,qb.y+qR,qJ,qV,"left",qW)}},q_._EMPTYTEXT={text:null,words:null},q_}(qG),q_=(function(qS){function q_(){q_.__super.call(this),this.style.lineElement=!0,this.style.block=!0}qW(q_,"laya.html.dom.HTMLBrElement",qQ)}(),function(qS){function q_(){this.contextHeight=NaN,this.contextWidth=NaN,q_.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}qW(q_,"laya.html.dom.HTMLDivElement",qS);var qa=q_.prototype;return qa.appendHTML=function(qS){qD.parse(this,qS,this.URI),this.layout()},qa._addChildsToLayout=function(q_){var qS=this._getWords();if(null==qS&&0==this._childs.length)return!1;qS&&qS.forEach(function(qS){q_.push(qS)});for(var qa=!0,qR=0,qJ=this._childs.length;qR<qJ;qR++){var qV=this._childs[qR];qa?qa=!1:q_.push(null),qV._addToLayout(q_)}return!0},qa._addToLayout=function(qS){this.layout()},qa.layout=function(){if(this.style){this.style._type|=512;var qS=qj.layout(this);if(qS){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new qH);var q_=this._$P.mHtmlBounds;q_.x=q_.y=0,q_.width=this.contextWidth=qS[0],q_.height=this.contextHeight=qS[1],this.setBounds(q_)}}},qk(0,qa,"height",function(){return this._height?this._height:this.contextHeight},qS.prototype._$set_height),qk(0,qa,"innerHTML",null,function(qS){this.destroyChildren(),this.appendHTML(qS)}),qk(0,qa,"width",function(){return this._width?this._width:this.contextWidth},function(qS){var q_=!1;q_=0===qS?qS!=this._width:qS!=this.width,qR.superSet(qQ,this,"width",qS),q_&&this.layout()}),q_}(qQ)),qm=function(qS){function q_(){this.all=new Array,this.styleSheets=qz.styleSheets,q_.__super.call(this)}qW(q_,"laya.html.dom.HTMLDocument",qQ);var qa=q_.prototype;return qa.getElementById=function(qS){return this.all[qS]},qa.setElementById=function(qS,q_){this.all[qS]=q_},qJ(q_,["document",function(){return this.document=new q_}]),q_}();(function(qS){function q_(){this._tex=null,this._url=null,this._renderArgs=[],q_.__super.call(this),this.style.block=!0}qW(q_,"laya.html.dom.HTMLImageElement",qQ);var qa=q_.prototype;qa._addToLayout=function(qS){!this._style.absolute&&qS.push(this)},qa.render=function(qS,q_,qa){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(qo.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,qS.ctx.drawTexture2(q_,qa,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},qa.layaoutCallNative=function(){var qS=0;if(this._childs&&0<(qS=this._childs.length))for(var q_=0;q_<qS;q_++)this._childs[q_].layaoutCallNative&&this._childs[q_].layaoutCallNative()},qk(0,qa,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(qS){this._width!==qS&&(this._width=qS,this._style.width=qS,this.repaint())}),qk(0,qa,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(qS){this._height!==qS&&(this._height=qS,this._style.height=qS,this.repaint())}),qa.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),qb.clearCache(this,this._url),this._tex=null),qQ.prototype.destroy.call(this)},qa.onloaded=function(){var qS=this._style;qS&&!qS.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),qS&&!qS.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),qC.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},qa._loadImageComplete=function(qS,q_,qa){if(!this._destroyed)if(null!=qa)if(qa instanceof ArrayBuffer){var qR=new DataView(qa);new laya.webgl.resource.WebGLImage(new Uint8Array(qa,8),qS,0,!1,qR.getUint32(0),qR.getUint32(4));this.onloaded()}else if(qa instanceof q$)qb.imgMgrSet[qS]=q_,qV.imgMgrLock(qS,qb.imgMgrSet[qS]),this._url=qS,this._tex=qa,qb.keepCache(this,qS),qb.cacheRes(qS,this._tex),this.onloaded();else{var qJ=-1!=qS.indexOf(".png",qS.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(qa,qS,qJ,!1,qa.width,qa.height);this.onloaded()}else this.event("error","Load image failed")},qk(0,qa,"src",null,function(qS){(qS=this.formatURL(qS),this._url!=qS)&&(null!=this._tex&&(qb.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=qS,(this._tex=qb.getRes(qS))?(qb.keepCache(this,qS),this.onloaded()):qV.imgMgrLoad(qS,this._loadImageComplete.bind(this),2,!1))})})(),function(qS){function q_(){this.type=null,q_.__super.call(this),this.visible=!1}qW(q_,"laya.html.dom.HTMLLinkElement",qS);var qa=q_.prototype;qa._onload=function(qS){switch(this.type){case"text/css":qz.parseCSS(qS,this.URI)}},qk(0,qa,"href",qS.prototype._$get_href,function(qS){var q_=this;qS=this.formatURL(qS),this.URI=new qF(qS);var qa=new qb;qa.once("complete",null,function(qS){q_._onload(qS)}),qa.load(qS,"text")}),q_._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(qQ),function(qS){function q_(){q_.__super.call(this),this.visible=!1}qW(q_,"laya.html.dom.HTMLStyleElement",qS),qk(0,q_.prototype,"text",qS.prototype._$get_text,function(qS){qz.parseCSS(qS,null)})}(qQ),function(qS){function q_(){q_.__super.call(this),this._getCSSStyle().valign="middle"}qW(q_,"laya.html.dom.HTMLIframeElement",qS),qk(0,q_.prototype,"href",qS.prototype._$get_href,function(qa){var qR=this;qa=this.formatURL(qa);var qS=new qb;qS.once("complete",null,function(qS){var q_=qR.URI;qR.URI=new qF(qa),qR.innerHTML=qS,!q_||(qR.URI=q_)}),qS.load(qa,"text")})}(q_)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}}),function(qS,q_,qo){qo.un,qo.uns;var qR=qo.static,qV=qo.class,qJ=qo.getset,qa=(qo.__newvec,laya.display.Animation),q$=(laya.utils.Browser,laya.utils.ClassUtils),qW=laya.filters.ColorFilter,qk=laya.utils.Ease,qz=laya.events.Event,qb=(laya.events.EventDispatcher,laya.display.css.Font),qH=laya.display.FrameAnimation,qL=laya.display.Graphics,qC=laya.utils.Handler,qG=laya.display.Input,qT=laya.net.Loader,qt=(laya.display.Node,laya.maths.Point),qF=laya.maths.Rectangle,qD=laya.renders.Render,qj=laya.display.Sprite,qQ=laya.display.Text,qm=laya.resource.Texture,qq=laya.utils.Tween,qN=laya.utils.Utils,qn=laya.utils.WeakObject;qo.interface("laya.ui.IItem"),qo.interface("laya.ui.ISelect"),qo.interface("laya.ui.IRender"),qo.interface("laya.ui.IComponent"),qo.interface("laya.ui.IBox","IComponent");var ql=function(){function qS(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return qV(qS,"laya.ui.LayoutStyle"),qR(qS,["EMPTY",function(){return this.EMPTY=new qS}]),qS}(),qB=function(){function qS(){}return qV(qS,"laya.ui.Styles"),qS.labelColor="#000000",qS.buttonStateNum=3,qS.scrollBarMinNum=15,qS.scrollBarDelayTime=500,qR(qS,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),qS}(),qI=function(){function qJ(){}return qV(qJ,"laya.ui.UIUtils"),qJ.fillArray=function(qS,q_,qa){var qR=qS.concat();if(q_)for(var qJ=q_.split(","),qV=0,qW=Math.min(qR.length,qJ.length);qV<qW;qV++){var qk=qJ[qV];qR[qV]="true"==qk||"false"!=qk&&qk,null!=qa&&(qR[qV]=qa(qk))}return qR},qJ.toColor=function(qS){return qN.toHexColor(qS)},qJ.gray=function(qS,q_){void 0===q_&&(q_=!0),q_?qJ.addFilter(qS,qJ.grayFilter):qJ.clearFilter(qS,qW)},qJ.addFilter=function(qS,q_){var qa=qS.filters||[];qa.push(q_),qS.filters=qa},qJ.clearFilter=function(qS,q_){var qa=qS.filters;if(null!=qa&&0<qa.length){for(var qR=qa.length-1;-1<qR;qR--){var qJ=qa[qR];qo.__typeof(qJ,q_)&&qa.splice(qR,1)}qS.filters=qa}},qJ._getReplaceStr=function(qS){return qJ.escapeSequence[qS]},qJ.adptString=function(qS){return qS.replace(/\\(\w)/g,qJ._getReplaceStr)},qJ.getBindFun=function(qS){var q_=qJ._funMap.get(qS);if(null==q_){var qa='"'+qS+'"',qR="(function(data){if(data==null)return;with(data){try{\nreturn "+(qa=qa.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";q_=qo._runScript(qR),qJ._funMap.set(qS,q_)}return q_},qR(qJ,["grayFilter",function(){return this.grayFilter=new qW([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new qn}]),qJ}(),qA=function(){function qS(){}return qV(qS,"UIConfig"),qS.touchScrollEnable=!0,qS.mouseWheelEnable=!0,qS.showButtons=!0,qS.popupBgColor="#000000",qS.popupBgAlpha=.5,qS.closeDialogOnSide=!0,qS}(),qX=function(qa){function qF(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,qF.__super.call(this),this._weakKeys=[]}qV(qF,"laya.ui.AutoBitmap",qa);var qS=qF.prototype;return qS.destroy=function(){if(qT.clearObject(this,this._weakKey),this._weakKeys){for(var qS=0,q_=this._weakKeys.length;qS<q_;++qS)qT.clearObject(this,this._weakKeys[qS]);this._weakKeys=null}qa.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},qS._setChanged=function(){this._isChanged||(this._isChanged=!0,qo.timer.callLater(this,this.changeSource))},qS.changeSource=function(){this._isChanged=!1;var qS=this._source;if(qS&&qS.bitmap){var q_=this.width,qa=this.height,qR=this._sizeGrid,qJ=qS.sourceWidth,qV=qS.sourceHeight;if(!qR||qJ===q_&&qV===qa)this.cleanByTexture(qS,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,q_,qa);else{qT.clearObject(this,this._weakKey),qS.$_GID||(qS.$_GID=qN.getGID());var qW=qS.$_GID+"."+q_+"."+qa+"."+qR.join("."),qk=qT.findObject(qW);if(qN.isOKCmdList(qk))return this._weakKey=qW,qT.keepObject(this,this._weakKey),void(this.cmds=qk);this.clear();var qz,qb,qH=qR[0],qL=qR[1],qC=qR[2],qG=qR[3],qt=qR[4],qo=!1;if(q_==qJ&&(qG=qL=0),qa==qV&&(qH=qC=0),q_<qG+qL){var q$=q_;qo=!0,q_=qG+qL,this.save(),this.clipRect(0,0,q$,qa)}qG&&qH&&(qz=qF.getTexture(qS,0,0,qG,qH),qb=this._weakKeys[0],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[0]=qz.weakKey),this.drawTexture(qz,0,0,qG,qH)):(qT.clearObject(this,qb),this._weakKeys[0]="")),qL&&qH&&(qz=qF.getTexture(qS,qJ-qL,0,qL,qH),qb=this._weakKeys[1],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[1]=qz.weakKey),this.drawTexture(qz,q_-qL,0,qL,qH)):(qT.clearObject(this,qb),this._weakKeys[1]="")),qG&&qC&&(qz=qF.getTexture(qS,0,qV-qC,qG,qC),qb=this._weakKeys[2],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[2]=qz.weakKey),this.drawTexture(qz,0,qa-qC,qG,qC)):(qT.clearObject(this,qb),this._weakKeys[2]="")),qL&&qC&&(qz=qF.getTexture(qS,qJ-qL,qV-qC,qL,qC),qb=this._weakKeys[3],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[3]=qz.weakKey),this.drawTexture(qz,q_-qL,qa-qC,qL,qC)):(qT.clearObject(this,qb),this._weakKeys[3]="")),qH&&(qz=qF.getTexture(qS,qG,0,qJ-qG-qL,qH),qb=this._weakKeys[4],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[4]=qz.weakKey),this.drawBitmap(qt,qz,qG,0,q_-qG-qL,qH)):(qT.clearObject(this,qb),this._weakKeys[4]="")),qC&&(qz=qF.getTexture(qS,qG,qV-qC,qJ-qG-qL,qC),qb=this._weakKeys[5],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[5]=qz.weakKey),this.drawBitmap(qt,qz,qG,qa-qC,q_-qG-qL,qC)):(qT.clearObject(this,qb),this._weakKeys[5]="")),qG&&(qz=qF.getTexture(qS,0,qH,qG,qV-qH-qC),qb=this._weakKeys[6],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[6]=qz.weakKey),this.drawBitmap(qt,qz,0,qH,qG,qa-qH-qC)):(qT.clearObject(this,qb),this._weakKeys[6]="")),qL&&(qz=qF.getTexture(qS,qJ-qL,qH,qL,qV-qH-qC),qb=this._weakKeys[7],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[7]=qz.weakKey),this.drawBitmap(qt,qz,q_-qL,qH,qL,qa-qH-qC)):(qT.clearObject(this,qb),this._weakKeys[7]="")),qz=qF.getTexture(qS,qG,qH,qJ-qG-qL,qV-qH-qC),qb=this._weakKeys[8],qz?(qb!=qz.weakKey&&(qT.clearObject(this,qb),qT.keepObject(this,qz.weakKey),this._weakKeys[8]=qz.weakKey),this.drawBitmap(qt,qz,qG,qH,q_-qG-qL,qa-qH-qC)):(qT.clearObject(this,qb),this._weakKeys[8]=""),qo&&this.restore(),this.autoCacheCmd&&!qD.isConchApp&&(qT.saveObject(qW,this.cmds,null),this._weakKey=qW,qT.keepObject(this,this._weakKey))}this._repaint()}},qS.drawBitmap=function(qS,q_,qa,qR,qJ,qV){void 0===qJ&&(qJ=0),void 0===qV&&(qV=0),qJ<.1||qV<.1||(!qS||q_.width==qJ&&q_.height==qV?this.drawTexture(q_,qa,qR,qJ,qV):this.fillTexture(q_,qa,qR,qJ,qV))},qS.clear=function(qS){void 0===qS&&(qS=!0),qa.prototype.clear.call(this,!1)},qJ(0,qS,"sizeGrid",function(){return this._sizeGrid},function(qS){this._sizeGrid=qS,this._setChanged()}),qJ(0,qS,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(qS){this._width!=qS&&(this._width=qS,this._setChanged())}),qJ(0,qS,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(qS){this._height!=qS&&(this._height=qS,this._setChanged())}),qJ(0,qS,"source",function(){return this._source},function(qS){qS?(this._source=qS,this._setChanged()):(this._source=null,this.clear())}),qF.getTexture=function(qS,q_,qa,qR,qJ){qR<=0&&(qR=1),qJ<=0&&(qJ=1),qS.$_GID||(qS.$_GID=qN.getGID());var qV=qS.$_GID+"."+q_+"."+qa+"."+qR+"."+qJ,qW=qT.findObject(qV);if((!qW||!qW.source)&&(qW=qm.createFromTexture(qS,q_,qa,qR,qJ))){if(qS.alphaTexture){var qk=qS.width/qS.alphaTexture.width;qW.alphaTexture=qm.createFromTexture(qS.alphaTexture,q_/qk,qa/qk,qR/qk,qJ/qk)}qT.saveObject(qV,qW),qW.weakKey=qV}return qW},qF}(qL),qh=(function(qS){function q_(){q_.__super.call(this)}qV(q_,"laya.ui.UIEvent",qz),q_.SHOW_TIP="showtip",q_.HIDE_TIP="hidetip"}(),function(q_){function qS(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,qS.__super.call(this),this._layout=ql.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}qV(qS,"laya.ui.Component",q_);var qa=qS.prototype;return qo.imps(qa,{"laya.ui.IComponent":!0}),qa.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},qa.preinitialize=function(){},qa.createChildren=function(){},qa.initialize=function(){},qa.callLater=function(qS,q_){qo.timer.callLater(this,qS,q_)},qa.runCallLater=function(qS){qo.timer.runCallLater(this,qS)},qa.commitMeasure=function(){},qa.changeSize=function(){this.event("resize")},qa.getLayout=function(){return this._layout===ql.EMPTY&&(this._layout=new ql),this._layout},qa._setLayoutEnabled=function(qS){this._layout&&this._layout.enable!=qS&&(this._layout.enable=qS,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},qa.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},qa.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},qa.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},qa.resetLayoutX=function(){var qS=this._layout;if(isNaN(qS.anchorX)||(this.pivotX=qS.anchorX*this.width),this.layoutEnabled){var q_=this.parent;q_&&(isNaN(qS.centerX)?isNaN(qS.left)?isNaN(qS.right)||(this.x=Math.round(q_.width-this.displayWidth-qS.right+this.pivotX*this.scaleX)):(this.x=Math.round(qS.left+this.pivotX*this.scaleX),isNaN(qS.right)||(this.width=(q_._width-qS.left-qS.right)/(this.scaleX||.01))):this.x=Math.round(.5*(q_.width-this.displayWidth)+qS.centerX+this.pivotX*this.scaleX))}},qa.resetLayoutY=function(){var qS=this._layout;if(isNaN(qS.anchorY)||(this.pivotY=qS.anchorY*this.height),this.layoutEnabled){var q_=this.parent;q_&&(isNaN(qS.centerY)?isNaN(qS.top)?isNaN(qS.bottom)||(this.y=Math.round(q_.height-this.displayHeight-qS.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(qS.top+this.pivotY*this.scaleY),isNaN(qS.bottom)||(this.height=(q_._height-qS.top-qS.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(q_.height-this.displayHeight)+qS.centerY+this.pivotY*this.scaleY))}},qa.onMouseOver=function(qS){qo.stage.event("showtip",this._toolTip)},qa.onMouseOut=function(qS){qo.stage.event("hidetip",this._toolTip)},qJ(0,qa,"displayWidth",function(){return this.width*this.scaleX}),qJ(0,qa,"width",function(){return this._width?this._width:this.measureWidth},function(qS){this._width!=qS&&(this._width=qS,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),qJ(0,qa,"measureWidth",function(){var qS=0;this.commitMeasure();for(var q_=this.numChildren-1;-1<q_;q_--){var qa=this.getChildAt(q_);qa.visible&&(qS=Math.max(qa.x+qa.width*qa.scaleX,qS))}return qS}),qJ(0,qa,"displayHeight",function(){return this.height*this.scaleY}),qJ(0,qa,"height",function(){return this._height?this._height:this.measureHeight},function(qS){this._height!=qS&&(this._height=qS,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),qJ(0,qa,"dataSource",function(){return this._dataSource},function(qS){for(var q_ in this._dataSource=qS,this._dataSource)this.hasOwnProperty(q_)&&"function"!=typeof this[q_]&&(this[q_]=this._dataSource[q_])}),qJ(0,qa,"scaleY",q_.prototype._$get_scaleY,function(qS){qo.superGet(qj,this,"scaleY")!=qS&&(qo.superSet(qj,this,"scaleY",qS),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),qJ(0,qa,"measureHeight",function(){var qS=0;this.commitMeasure();for(var q_=this.numChildren-1;-1<q_;q_--){var qa=this.getChildAt(q_);qa.visible&&(qS=Math.max(qa.y+qa.height*qa.scaleY,qS))}return qS}),qJ(0,qa,"scaleX",q_.prototype._$get_scaleX,function(qS){qo.superGet(qj,this,"scaleX")!=qS&&(qo.superSet(qj,this,"scaleX",qS),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),qJ(0,qa,"top",function(){return this._layout.top},function(qS){qS!=this._layout.top&&(this.getLayout().top=qS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),qJ(0,qa,"bottom",function(){return this._layout.bottom},function(qS){qS!=this._layout.bottom&&(this.getLayout().bottom=qS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),qJ(0,qa,"left",function(){return this._layout.left},function(qS){qS!=this._layout.left&&(this.getLayout().left=qS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),qJ(0,qa,"right",function(){return this._layout.right},function(qS){qS!=this._layout.right&&(this.getLayout().right=qS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),qJ(0,qa,"centerX",function(){return this._layout.centerX},function(qS){qS!=this._layout.centerX&&(this.getLayout().centerX=qS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),qJ(0,qa,"centerY",function(){return this._layout.centerY},function(qS){qS!=this._layout.centerY&&(this.getLayout().centerY=qS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),qJ(0,qa,"anchorX",function(){return this._layout.anchorX},function(qS){qS!=this._layout.anchorX&&(this.getLayout().anchorX=qS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),qJ(0,qa,"anchorY",function(){return this._layout.anchorY},function(qS){qS!=this._layout.anchorY&&(this.getLayout().anchorY=qS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),qJ(0,qa,"tag",function(){return this._tag},function(qS){this._tag=qS}),qJ(0,qa,"toolTip",function(){return this._toolTip},function(qS){this._toolTip!=qS&&(null!=(this._toolTip=qS)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),qJ(0,qa,"comXml",function(){return this._comXml},function(qS){this._comXml=qS}),qJ(0,qa,"gray",function(){return this._gray},function(qS){qS!==this._gray&&(this._gray=qS,qI.gray(this,qS))}),qJ(0,qa,"disabled",function(){return this._disabled},function(qS){qS!==this._disabled&&(this.gray=this._disabled=qS,this.mouseEnabled=!qS)}),qS}(qj)),qu=function(qS){function q_(){this.lockLayer=null,this.popupEffect=function(qS){qS.scale(1,1),qq.from(qS,{x:qo.stage.width/2,y:qo.stage.height/2,scaleX:0,scaleY:0},300,qk.backOut,qC.create(this,this.doOpen,[qS]))},this.closeEffect=function(qS,q_){qq.to(qS,{x:qo.stage.width/2,y:qo.stage.height/2,scaleX:0,scaleY:0},300,qk.strongOut,qC.create(this,this.doClose,[qS,q_]))},q_.__super.call(this),this.maskLayer=new qj,this.popupEffectHandler=qC.create(this,this.popupEffect,null,!1),this.closeEffectHandler=qC.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,qo.stage.addChild(this),qo.stage.on("resize",this,this._onResize),qA.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}qV(q_,"laya.ui.DialogManager",qj);var qa=q_.prototype;return qa._closeOnSide=function(){var qS=this.getChildAt(this.numChildren-1);qS instanceof laya.ui.Dialog&&qS.close("side")},qa.setLockView=function(qS){this.lockLayer||(this.lockLayer=new qK,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(qo.stage.width,qo.stage.height)),this.lockLayer.removeChildren(),qS&&(qS.centerX=qS.centerY=0,this.lockLayer.addChild(qS))},qa._onResize=function(qS){var q_=this.maskLayer.width=qo.stage.width,qa=this.maskLayer.height=qo.stage.height;this.lockLayer&&this.lockLayer.size(q_,qa),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,q_,qa,qA.popupBgColor),this.maskLayer.alpha=qA.popupBgAlpha;for(var qR=this.numChildren-1;-1<qR;qR--){var qJ=this.getChildAt(qR);qJ.popupCenter&&this._centerDialog(qJ)}},qa._centerDialog=function(qS){qS.x=Math.round((qo.stage.width-qS.width>>1)+qS.pivotX),qS.y=Math.round((qo.stage.height-qS.height>>1)+qS.pivotY)},qa.open=function(qS,q_,qa){void 0===q_&&(q_=!1),void 0===qa&&(qa=!1),q_&&this._closeAll(),qS.popupCenter&&this._centerDialog(qS),this.addChild(qS),(qS.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),qa&&null!=qS.popupEffect?qS.popupEffect.runWith(qS):this.doOpen(qS),this.event("open")},qa.doOpen=function(qS){qS.onOpened()},qa.lock=function(qS){this.lockLayer&&(qS?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},qa.close=function(qS,q_,qa){void 0===qa&&(qa=!1),qa&&null!=qS.closeEffect?qS.closeEffect.runWith([qS,q_]):this.doClose(qS,q_),this.event("close")},qa.doClose=function(qS,q_){qS.removeSelf(),qS.isModal&&this._checkMask(),qS.closeHandler&&qS.closeHandler.runWith(q_),qS.onClosed(q_)},qa.closeAll=function(){this._closeAll(),this.event("close")},qa._closeAll=function(){for(var qS=this.numChildren-1;-1<qS;qS--){var q_=this.getChildAt(qS);q_&&null!=q_.close&&this.doClose(q_)}},qa.getDialogsByGroup=function(qS){for(var q_=[],qa=this.numChildren-1;-1<qa;qa--){var qR=this.getChildAt(qa);qR&&qR.group===qS&&q_.push(qR)}return q_},qa.closeByGroup=function(qS){for(var q_=[],qa=this.numChildren-1;-1<qa;qa--){var qR=this.getChildAt(qa);qR&&qR.group===qS&&(qR.close(),q_.push(qR))}return q_},qa._checkMask=function(){this.maskLayer.removeSelf();for(var qS=this.numChildren-1;-1<qS;qS--){var q_=this.getChildAt(qS);if(q_&&q_.isModal)return void this.addChildAt(this.maskLayer,qS)}},q_}(),qK=function(qS){function q_(){q_.__super.call(this)}qV(q_,"laya.ui.Box",qS);var qa=q_.prototype;return qo.imps(qa,{"laya.ui.IBox":!0}),qJ(0,qa,"dataSource",qS.prototype._$get_dataSource,function(qS){for(var q_ in this._dataSource=qS){var qa=this.getChildByName(q_);qa?qa.dataSource=qS[q_]:this.hasOwnProperty(q_)&&"function"!=typeof this[q_]&&(this[q_]=qS[q_])}}),q_}(qh),qP=function(q_){function qa(qS,q_){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,qa.__super.call(this),this._labelColors=qB.buttonLabelColors,this._stateNum=qB.buttonStateNum,void 0===q_&&(q_=""),this.skin=qS,this.label=q_}qV(qa,"laya.ui.Button",q_);var qS=qa.prototype;return qo.imps(qS,{"laya.ui.ISelect":!0}),qS.destroy=function(qS){qT.clearCache(this,this._skin),qT.clearObject(this,this._weakKey),void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(qS),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},qS.createChildren=function(){this.graphics=this._bitmap=new qX},qS.createText=function(){this._text||(this._text=new qQ,this._text.overflow=qQ.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},qS.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},qS.onMouse=function(qS){if(!1!==this.toggle||!this._selected)return"click"===qS.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=qa.stateMap[qS.type]))},qS.changeClips=function(){var qS=qT.getRes(this._skin);if(qS&&this._skin&&""!=this._skin){qT.clearObject(this,this._weakKey);var q_=qS.sourceWidth,qa=qS.sourceHeight/this._stateNum;qS.$_GID||(qS.$_GID=qN.getGID());var qR=qS.$_GID+"-"+this._stateNum,qJ=qT.findObject(qR);if(qN.isOkTextureList(qJ)||(qJ=null),qJ)this._weakKey=qR,qT.keepObject(this,this._weakKey),this._sources=qJ;else{if(this._sources=[],1===this._stateNum)this._sources.push(qS);else for(var qV=0;qV<this._stateNum;qV++){var qW=qm.createFromTexture(qS,0,qa*qV,q_,qa);if(qS.alphaTexture){var qk=qS.width/qS.alphaTexture.width;qW.alphaTexture=qm.createFromTexture(qS.alphaTexture,0/qk,qa*qV/qk,q_/qk,qa/qk)}this._sources.push(qW)}qT.saveObject(qR,this._sources),this._weakKey=qR,qT.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||q_,this._bitmap.height=this._height||qa,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=q_)}else console.warn("lose skin ",this._skin,this.name,this.__className)},qS.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var qS=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[qS]),this.label&&(this._text.color=this._labelColors[qS],this._strokeColors&&(this._text.strokeColor=this._strokeColors[qS]))},qS._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},qJ(0,qS,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(qS){this.createText(),this._text.strokeColor=qS}),qJ(0,qS,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),qJ(0,qS,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(qT.clearCache(this,this._skin),this._skin=qS,qT.keepCache(this,this._skin),this.callLater(this.changeClips),this._setStateChanged())}),qJ(0,qS,"state",function(){return this._state},function(qS){this._state!=qS&&(this._state=qS,this._setStateChanged())}),qJ(0,qS,"text",function(){return this.createText(),this._text}),qJ(0,qS,"stateNum",function(){return this._stateNum},function(qS){"string"==typeof qS&&(qS=parseInt(qS)),this._stateNum!=qS&&(this._stateNum=qS<1?1:3<qS?3:qS,this.callLater(this.changeClips))}),qJ(0,qS,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(qS){this._strokeColors=qI.fillArray(qB.buttonLabelColors,qS,String),this._setStateChanged()}),qJ(0,qS,"labelColors",function(){return this._labelColors.join(",")},function(qS){this._labelColors=qI.fillArray(qB.buttonLabelColors,qS,String),this._setStateChanged()}),qJ(0,qS,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),qJ(0,qS,"label",function(){return this._text?this._text.text:null},function(qS){(this._text||qS)&&(this.createText(),this._text.text!=qS&&(qS&&!this._text.parent&&this.addChild(this._text),this._text.text=(qS+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),qJ(0,qS,"selected",function(){return this._selected},function(qS){this._selected!=qS&&(this._selected=qS,this.state=this._selected?2:0,this.event("change"))}),qJ(0,qS,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(qS){this.createText(),this._text.padding=qI.fillArray(qB.labelPadding,qS,Number)}),qJ(0,qS,"labelSize",function(){return this.createText(),this._text.fontSize},function(qS){this.createText(),this._text.fontSize=qS}),qJ(0,qS,"labelStroke",function(){return this.createText(),this._text.stroke},function(qS){this.createText(),this._text.stroke=qS}),qJ(0,qS,"labelBold",function(){return this.createText(),this._text.bold},function(qS){this.createText(),this._text.bold=qS}),qJ(0,qS,"labelFont",function(){return this.createText(),this._text.font},function(qS){this.createText(),this._text.font=qS}),qJ(0,qS,"labelAlign",function(){return this.createText(),this._text.align},function(qS){this.createText(),this._text.align=qS}),qJ(0,qS,"clickHandler",function(){return this._clickHandler},function(qS){this._clickHandler=qS}),qJ(0,qS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(qS){this._bitmap.sizeGrid=qI.fillArray(qB.defaultSizeGrid,qS,Number)}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qh,this,"width",qS),this._autoSize&&(this._bitmap.width=qS,this._text&&(this._text.width=qS))}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qh,this,"height",qS),this._autoSize&&(this._bitmap.height=qS,this._text&&(this._text.height=qS))}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)||"string"==typeof qS?this.label=qS+"":qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(qS){this._bitmap._offset=qS?qI.fillArray([1,1],qS,Number):[]}),qR(qa,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),qa}(qh),qM=function(q_){function qR(qS,q_,qa){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,qR.__super.call(this),void 0===q_&&(q_=1),void 0===qa&&(qa=1),this._clipX=q_,this._clipY=qa,this.skin=qS}qV(qR,"laya.ui.Clip",q_);var qS=qR.prototype;return qS.destroy=function(qS){qT.clearCache(this,this._skin),qT.clearObject(this,this._weakKey),void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},qS.dispose=function(){this.destroy(!0),qo.loader.clearRes(this._skin)},qS.createChildren=function(){this.graphics=this._bitmap=new qX},qS._onDisplay=function(qS){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},qS.changeClip=function(){if(this._clipChanged=!1,this._skin){var qS=qT.getRes(this._skin);qS?this.loadComplete(this._skin,qS):qo.loader.load(this._skin,qC.create(this,this.loadComplete,[this._skin]))}},qS.loadComplete=function(qS,q_){if(qS===this._skin&&q_){qT.clearObject(this,this._weakKey);var qa=this._clipWidth||Math.ceil(q_.sourceWidth/this._clipX),qR=this._clipHeight||Math.ceil(q_.sourceHeight/this._clipY),qJ=this._skin+qa+qR,qV=qT.findObject(qJ);if(qN.isOkTextureList(qV)||(qV=null),qV)this._weakKey=qJ,qT.keepObject(this,this._weakKey),this._sources=qV;else{this._sources=[];for(var qW=0;qW<this._clipY;qW++)for(var qk=0;qk<this._clipX;qk++){var qz=qm.createFromTexture(q_,qa*qk,qR*qW,qa,qR);if(q_.alphaTexture){var qb=q_.width/q_.alphaTexture.width;qz.alphaTexture=qm.createFromTexture(q_.alphaTexture,qa*qk/qb,qR*qW/qb,qa/qb,qR/qb)}this._sources.push(qz)}qT.saveObject(qJ,this._sources),this._weakKey=qJ,qT.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},qS.play=function(qS,q_){void 0===qS&&(qS=0),void 0===q_&&(q_=-1),this._isPlaying=!0,this.index=qS,this._toIndex=q_,this._index++,qo.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},qS._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},qS.stop=function(){this._isPlaying=!1,qo.timer.clear(this,this._loop),this.event("complete")},qS._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},qJ(0,qS,"interval",function(){return this._interval},function(qS){this._interval!=qS&&(this._interval=qS,this._isPlaying&&this.play())}),qJ(0,qS,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(qT.clearCache(this,this._skin),(this._skin=qS)?(qT.keepCache(this,this._skin),this._setClipChanged()):this._bitmap.source=null)}),qJ(0,qS,"sources",function(){return this._sources},function(qS){this._sources=qS,this.index=this._index,this.event("loaded")}),qJ(0,qS,"clipX",function(){return this._clipX},function(qS){this._clipX=qS||1,this._setClipChanged()}),qJ(0,qS,"clipY",function(){return this._clipY},function(qS){this._clipY=qS||1,this._setClipChanged()}),qJ(0,qS,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),qJ(0,qS,"clipWidth",function(){return this._clipWidth},function(qS){this._clipWidth=qS,this._setClipChanged()}),qJ(0,qS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(qS){this._bitmap.sizeGrid=qI.fillArray(qB.defaultSizeGrid,qS,Number)}),qJ(0,qS,"group",function(){return this._group},function(qS){qS&&this._skin&&qT.setGroup(this._skin,qS),this._group=qS}),qJ(0,qS,"clipHeight",function(){return this._clipHeight},function(qS){this._clipHeight=qS,this._setClipChanged()}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qh,this,"width",qS),this._bitmap.width=qS}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qh,this,"height",qS),this._bitmap.height=qS}),qJ(0,qS,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),qJ(0,qS,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),qJ(0,qS,"index",function(){return this._index},function(qS){this._index=qS,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[qS]),this.event("change")}),qJ(0,qS,"autoPlay",function(){return this._autoPlay},function(qS){this._autoPlay!=qS&&((this._autoPlay=qS)?this.play():this.stop())}),qJ(0,qS,"isPlaying",function(){return this._isPlaying},function(qS){this._isPlaying=qS}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)&&Math.floor(qS)==qS||"string"==typeof qS?this.index=parseInt(qS):qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"bitmap",function(){return this._bitmap}),qR}(qh),qr=function(q_){function qS(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,qS.__super.call(this)}qV(qS,"laya.ui.ColorPicker",q_);var qa=qS.prototype;return qa.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._colorPanel&&this._colorPanel.destroy(qS),this._colorButton&&this._colorButton.destroy(qS),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},qa.createChildren=function(){this.addChild(this._colorButton=new qP),this._colorPanel=new qK,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new qj),this._colorPanel.addChild(this._colorBlock=new qj),this._colorPanel.addChild(this._colorInput=new qG)},qa.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},qa.onPanelMouseDown=function(qS){qS.stopPropagation()},qa.changePanel=function(){this._panelChanged=!1;var qS=this._colorPanel.graphics;qS.clear(),qS.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(qS=this._colorTiles.graphics).clear();for(var q_=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],qa=0;qa<12;qa++)for(var qR=0;qR<20;qR++){var qJ=0;qJ=0===qR?q_[qa]:1===qR?0:51*(((3*qa+qR/6)%3<<0)+3*(qa/6<<0))<<16|qR%6*51<<8|(qa<<0)%6*51;var qV=qI.toColor(qJ);this._colors.push(qV);var qW=qR*this._gridSize,qk=qa*this._gridSize;qS.drawRect(qW,qk,this._gridSize,this._gridSize,qV,"#000000")}},qa.onColorButtonClick=function(qS){this._colorPanel.parent?this.close():this.open()},qa.open=function(){var qS=this.localToGlobal(new qt),q_=qS.x+this._colorPanel.width<=qo.stage.width?qS.x:qo.stage.width-this._colorPanel.width,qa=qS.y+this._colorButton.height;qa=qa+this._colorPanel.height<=qo.stage.height?qa:qS.y-this._colorPanel.height,this._colorPanel.pos(q_,qa),this._colorPanel.zOrder=1001,qo._currentStage.addChild(this._colorPanel),qo.stage.on("mousedown",this,this.removeColorBox)},qa.close=function(){qo.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},qa.removeColorBox=function(qS){this.close()},qa.onColorFieldKeyDown=function(qS){13==qS.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),qS.stopPropagation())},qa.onColorInputChange=function(qS){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},qa.onColorTilesClick=function(qS){this.selectedColor=this.getColorByMouse(),this.close()},qa.onColorTilesMouseMove=function(qS){this._colorInput.focus=!1;var q_=this.getColorByMouse();this._colorInput.text=q_,this.drawBlock(q_)},qa.getColorByMouse=function(){var qS=this._colorTiles.getMousePoint(),q_=Math.floor(qS.x/this._gridSize),qa=Math.floor(qS.y/this._gridSize);return this._colors[20*qa+q_]},qa.drawBlock=function(qS){var q_=this._colorBlock.graphics;q_.clear();var qa=qS||"#ffffff";q_.drawRect(0,0,50,20,qa,this._borderColor),qS||q_.drawLine(0,0,50,20,"#ff0000")},qa.changeColor=function(){var qS=this.graphics;qS.clear();var q_=this._selectedColor||"#000000";qS.drawRect(0,0,this._colorButton.width,this._colorButton.height,q_)},qa._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},qJ(0,qa,"inputBgColor",function(){return this._inputBgColor},function(qS){this._inputBgColor=qS,this._setPanelChanged()}),qJ(0,qa,"selectedColor",function(){return this._selectedColor},function(qS){this._selectedColor!=qS&&(this._selectedColor=this._colorInput.text=qS,this.drawBlock(qS),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",qz.EMPTY.setTo("change",this,this)))}),qJ(0,qa,"skin",function(){return this._colorButton.skin},function(qS){this._colorButton.skin=qS,this.changeColor()}),qJ(0,qa,"bgColor",function(){return this._bgColor},function(qS){this._bgColor=qS,this._setPanelChanged()}),qJ(0,qa,"borderColor",function(){return this._borderColor},function(qS){this._borderColor=qS,this._setPanelChanged()}),qJ(0,qa,"inputColor",function(){return this._inputColor},function(qS){this._inputColor=qS,this._setPanelChanged()}),qS}(qh),qe=function(q_){function qa(qS,q_){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,qa.__super.call(this),this._itemColors=qB.comboBoxItemColors,this.skin=qS,this.labels=q_}qV(qa,"laya.ui.ComboBox",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._button&&this._button.destroy(qS),this._list&&this._list.destroy(qS),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},qS.createChildren=function(){this.addChild(this._button=new qP),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},qS._createList=function(){this._list=new qc,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},qS._setListEvent=function(qS){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=qC.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},qS.onListDown=function(qS){qS.stopPropagation()},qS.onScrollBarDown=function(qS){qS.stopPropagation()},qS.onButtonMouseDown=function(qS){this.callLater(this.switchTo,[!this._isOpen])},qS.changeList=function(){this._listChanged=!1;var qS=this.width-2,q_=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:qS,height:this._itemHeight,fontSize:this._itemSize,color:q_}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},qS.onlistItemMouse=function(qS,q_){var qa=qS.type;if("mouseover"===qa||"mouseout"===qa){if(this._isCustomList)return;var qR=this._list.getCell(q_);if(!qR)return;var qJ=qR.getChildByName("label");qJ&&("mouseover"===qa?(qJ.bgColor=this._itemColors[0],qJ.color=this._itemColors[1]):(qJ.bgColor=null,qJ.color=this._itemColors[2]))}else"click"===qa&&(this.selectedIndex=q_,this.isOpen=!1)},qS.switchTo=function(qS){this.isOpen=qS},qS.changeOpen=function(){this.isOpen=!this._isOpen},qS.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var qS=this._list.graphics;qS.clear(),qS.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var q_=this._list.array||[],qa=q_.length=0,qR=this._labels.length;qa<qR;qa++)q_.push({label:this._labels[qa]});this._list.height=this._listHeight,this._list.array=q_},qS.changeSelected=function(){this._button.label=this.selectedLabel},qS._onStageMouseWheel=function(qS){this._list&&!this._list.contains(qS.target)&&this.removeList(null)},qS.removeList=function(qS){qo.stage.off("mousedown",this,this.removeList),qo.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},qJ(0,qS,"selectedIndex",function(){return this._selectedIndex},function(qS){this._selectedIndex!=qS&&(this._selectedIndex=qS,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[qz.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),qJ(0,qS,"measureHeight",function(){return this._button.height}),qJ(0,qS,"skin",function(){return this._button.skin},function(qS){this._button.skin!=qS&&(this._button.skin=qS,this._listChanged=!0)}),qJ(0,qS,"measureWidth",function(){return this._button.width}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qh,this,"width",qS),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),qJ(0,qS,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(qS){this.selectedIndex=this._labels.indexOf(qS)}),qJ(0,qS,"labels",function(){return this._labels.join(",")},function(qS){0<this._labels.length&&(this.selectedIndex=-1),qS?this._labels=qS.split(","):this._labels.length=0,this._itemChanged=!0}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qh,this,"height",qS),this._button.height=this._height}),qJ(0,qS,"selectHandler",function(){return this._selectHandler},function(qS){this._selectHandler=qS}),qJ(0,qS,"visibleNum",function(){return this._visibleNum},function(qS){this._visibleNum=qS,this._listChanged=!0}),qJ(0,qS,"labelBold",function(){return this._button.text.bold},function(qS){this._button.text.bold=qS}),qJ(0,qS,"itemColors",function(){return String(this._itemColors)},function(qS){this._itemColors=qI.fillArray(this._itemColors,qS,String),this._listChanged=!0}),qJ(0,qS,"itemSize",function(){return this._itemSize},function(qS){this._itemSize=qS,this._listChanged=!0}),qJ(0,qS,"scrollBar",function(){return this.list.scrollBar}),qJ(0,qS,"isOpen",function(){return this._isOpen},function(qS){if(this._isOpen!=qS)if(this._isOpen=qS,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var q_=this.localToGlobal(qt.TEMP.setTo(0,0)),qa=q_.y+this._button.height;qa=qa+this._listHeight<=qo.stage.height?qa:q_.y-this._listHeight,this._list.pos(q_.x,qa),this._list.zOrder=1001,qo._currentStage.addChild(this._list),qo.stage.once("mousedown",this,this.removeList),qo.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),qJ(0,qS,"scrollBarSkin",function(){return this._scrollBarSkin},function(qS){this._scrollBarSkin=qS}),qJ(0,qS,"sizeGrid",function(){return this._button.sizeGrid},function(qS){this._button.sizeGrid=qS}),qJ(0,qS,"button",function(){return this._button}),qJ(0,qS,"list",function(){return this._list||this._createList(),this._list},function(qS){qS&&(qS.removeSelf(),this._isCustomList=!0,this._list=qS,this._setListEvent(qS),this._itemHeight=qS.getCell(0).height+qS.spaceY)}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)&&Math.floor(qS)==qS||"string"==typeof qS?this.selectedIndex=parseInt(qS):qS instanceof Array?this.labels=qS.join(","):qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"labelColors",function(){return this._button.labelColors},function(qS){this._button.labelColors!=qS&&(this._button.labelColors=qS)}),qJ(0,qS,"labelPadding",function(){return this._button.text.padding.join(",")},function(qS){this._button.text.padding=qI.fillArray(qB.labelPadding,qS,Number)}),qJ(0,qS,"labelSize",function(){return this._button.text.fontSize},function(qS){this._button.text.fontSize=qS}),qJ(0,qS,"labelFont",function(){return this._button.text.font},function(qS){this._button.text.font=qS}),qJ(0,qS,"stateNum",function(){return this._button.stateNum},function(qS){this._button.stateNum=qS}),qa}(qh),qg=function(q_){function qa(qS){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,qa.__super.call(this),this._showButtons=qA.showButtons,this._touchScrollEnable=qA.touchScrollEnable,this._mouseWheelEnable=qA.mouseWheelEnable,this.skin=qS,this.max=1}qV(qa,"laya.ui.ScrollBar",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),this.stopScroll(),this.target=null,q_.prototype.destroy.call(this,qS),this.upButton&&this.upButton.destroy(qS),this.downButton&&this.downButton.destroy(qS),this.slider&&this.slider.destroy(qS),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},qS.createChildren=function(){this.addChild(this.slider=new qx),this.addChild(this.upButton=new qP),this.addChild(this.downButton=new qP)},qS.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},qS.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},qS.onButtonMouseDown=function(qS){var q_=qS.currentTarget===this.upButton;this.slide(q_),qo.timer.once(qB.scrollBarDelayTime,this,this.startLoop,[q_]),qo.stage.once("mouseup",this,this.onStageMouseUp)},qS.startLoop=function(qS){qo.timer.frameLoop(1,this,this.slide,[qS])},qS.slide=function(qS){qS?this.value-=this._scrollSize:this.value+=this._scrollSize},qS.onStageMouseUp=function(qS){qo.timer.clear(this,this.startLoop),qo.timer.clear(this,this.slide)},qS.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},qS.changeSize=function(){q_.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},qS.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},qS.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},qS.setScroll=function(qS,q_,qa){this.runCallLater(this.changeSize),this.slider.setSlider(qS,q_,qa),this.slider.bar.visible=0<q_,!this._hide&&this.autoHide&&(this.visible=!1)},qS.onTargetMouseWheel=function(qS){this.value-=qS.delta*this._scrollSize,this.target=this._target},qS.onTargetMouseDown=function(qS){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new qt),this._lastPoint.setTo(qo.stage.mouseX,qo.stage.mouseY),qo.timer.clear(this,this.tweenMove),qq.clearTween(this),qo.stage.once("mouseup",this,this.onStageMouseUp2),qo.stage.once("mouseout",this,this.onStageMouseUp2),qo.timer.frameLoop(1,this,this.loop)},qS.loop=function(){var qS=qo.stage.mouseY,q_=qo.stage.mouseX;if(this._lastOffset=this.isVertical?qS-this._lastPoint.y:q_-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?qo.stage._canvasTransform.getScaleY():qo.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=q_,this._lastPoint.y=qS,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},qS.onStageMouseUp2=function(qS){if(qo.stage.off("mouseup",this,this.onStageMouseUp2),qo.stage.off("mouseout",this,this.onStageMouseUp2),qo.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?qq.to(this,{value:this.min},this.elasticBackTime,qk.sineOut,qC.create(this,this.elasticOver)):this._value>this.max&&qq.to(this,{value:this.max},this.elasticBackTime,qk.sineOut,qC.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?qo.stage.mouseY-this._lastPoint.y:qo.stage.mouseX-this._lastPoint.x);for(var q_=0,qa=Math.min(this._offsets.length,3),qR=0;qR<qa;qR++)q_+=this._offsets[this._offsets.length-1-qR];if(this._lastOffset=q_/qa,(q_=Math.abs(this._lastOffset))<2)return void this.event("end");60<q_&&(this._lastOffset=0<this._lastOffset?60:-60);var qJ=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));qo.timer.frameLoop(1,this,this.tweenMove,[qJ])}},qS.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&qq.to(this,{alpha:0},500),this.event("end")},qS.tweenMove=function(qS){this._lastOffset*=this.rollRatio;var q_=NaN;if(0<qS&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,q_=.5*-(this.min-qS-this.value),this._lastOffset>q_&&(this._lastOffset=q_)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,q_=.5*-(this.max+qS-this.value),this._lastOffset<q_&&(this._lastOffset=q_))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(qo.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?qq.to(this,{value:this.min},this.elasticBackTime,qk.sineOut,qC.create(this,this.elasticOver)):this._value>this.max?qq.to(this,{value:this.max},this.elasticBackTime,qk.sineOut,qC.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&qq.to(this,{alpha:0},500)}},qS.stopScroll=function(){this.onStageMouseUp2(null),qo.timer.clear(this,this.tweenMove),qq.clearTween(this)},qJ(0,qS,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),qJ(0,qS,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(this._skin=qS,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),qJ(0,qS,"max",function(){return this.slider.max},function(qS){this.slider.max=qS}),qJ(0,qS,"showButtons",function(){return this._showButtons},function(qS){this._showButtons=qS,this.callLater(this.changeScrollBar)}),qJ(0,qS,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),qJ(0,qS,"min",function(){return this.slider.min},function(qS){this.slider.min=qS}),qJ(0,qS,"value",function(){return this._value},function(qS){qS!==this._value&&(this._value=qS,this._isElastic||(this.slider._value!=qS&&(this.slider._value=qS,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),qJ(0,qS,"isVertical",function(){return this.slider.isVertical},function(qS){this.slider.isVertical=qS}),qJ(0,qS,"sizeGrid",function(){return this.slider.sizeGrid},function(qS){this.slider.sizeGrid=qS}),qJ(0,qS,"scrollSize",function(){return this._scrollSize},function(qS){this._scrollSize=qS}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)||"string"==typeof qS?this.value=Number(qS):qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"thumbPercent",function(){return this._thumbPercent},function(qS){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),qS=1<=qS?.99:qS,this._thumbPercent=qS,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*qS,qB.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*qS,qB.scrollBarMinNum))}),qJ(0,qS,"target",function(){return this._target},function(qS){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=qS)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),qJ(0,qS,"hide",function(){return this._hide},function(qS){this._hide=qS,this.visible=!qS}),qJ(0,qS,"touchScrollEnable",function(){return this._touchScrollEnable},function(qS){this._touchScrollEnable=qS,this.target=this._target}),qJ(0,qS,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(qS){this._mouseWheelEnable=qS,this.target=this._target}),qJ(0,qS,"tick",function(){return this.slider.tick},function(qS){this.slider.tick=qS}),qa}(qh),qx=function(q_){function qa(qS){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,qa.__super.call(this),this.skin=qS}qV(qa,"laya.ui.Slider",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._bg&&this._bg.destroy(qS),this._bar&&this._bar.destroy(qS),this._progress&&this._progress.destroy(qS),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},qS.createChildren=function(){this.addChild(this._bg=new qs),this.addChild(this._bar=new qP)},qS.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},qS.onBarMouseDown=function(qS){this._globalSacle||(this._globalSacle=new qt),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=qo.stage.mouseX,this._ty=qo.stage.mouseY,qo.stage.on("mousemove",this,this.mouseMove),qo.stage.once("mouseup",this,this.mouseUp),qo.stage.once("mouseout",this,this.mouseUp),this.showValueText()},qS.showValueText=function(){if(this.showLabel){var qS=laya.ui.Slider.label;this.addChild(qS),qS.textField.changeText(this._value+""),this.isVertical?(qS.x=this._bar.x+20,qS.y=.5*(this._bar.height-qS.height)+this._bar.y):(qS.y=this._bar.y-20,qS.x=.5*(this._bar.width-qS.width)+this._bar.x)}},qS.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},qS.mouseUp=function(qS){qo.stage.off("mousemove",this,this.mouseMove),qo.stage.off("mouseup",this,this.mouseUp),qo.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},qS.mouseMove=function(qS){var q_=this._value;this.isVertical?(this._bar.y+=(qo.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(qo.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=qo.stage.mouseX,this._ty=qo.stage.mouseY;var qa=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*qa)/qa,this._value!=q_&&this.sendChangeEvent(),this.showValueText()},qS.sendChangeEvent=function(qS){void 0===qS&&(qS="change"),this.event(qS),this.changeHandler&&this.changeHandler.runWith(this._value)},qS.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},qS.changeSize=function(){q_.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},qS.setSlider=function(qS,q_,qa){this._value=-1,this._min=qS,this._max=qS<q_?q_:qS,this.value=qa<qS?qS:q_<qa?q_:qa},qS.changeValue=function(){var qS=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*qS)/qS,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var q_=this._max-this._min;0===q_&&(q_=1),this.isVertical?(this._bar.y=(this._value-this._min)/q_*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/q_*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},qS.onBgMouseDown=function(qS){var q_=this._bg.getMousePoint();this.isVertical?this.value=q_.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=q_.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},qJ(0,qS,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),qJ(0,qS,"skin",function(){return this._skin},function(qS){if(this._skin!=qS){this._skin=qS,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var q_=this._skin.replace(".png","$progress.png");qT.getRes(q_)&&(this._progress||(this.addChild(this._progress=new qs),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=q_),this.setBarPoint(),this.callLater(this.changeValue)}}),qJ(0,qS,"allowClickBack",function(){return this._allowClickBack},function(qS){this._allowClickBack!=qS&&((this._allowClickBack=qS)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),qJ(0,qS,"max",function(){return this._max},function(qS){this._max!=qS&&(this._max=qS,this.callLater(this.changeValue))}),qJ(0,qS,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),qJ(0,qS,"tick",function(){return this._tick},function(qS){this._tick!=qS&&(this._tick=qS,this.callLater(this.changeValue))}),qJ(0,qS,"sizeGrid",function(){return this._bg.sizeGrid},function(qS){this._bg.sizeGrid=qS,this._bar.sizeGrid=qS,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),qJ(0,qS,"min",function(){return this._min},function(qS){this._min!=qS&&(this._min=qS,this.callLater(this.changeValue))}),qJ(0,qS,"value",function(){return this._value},function(qS){if(this._value!=qS){var q_=this._value;this._value=qS,this.changeValue(),this._value!=q_&&this.sendChangeEvent()}}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)||"string"==typeof qS?this.value=Number(qS):qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"bar",function(){return this._bar}),qR(qa,["label",function(){return this.label=new qU}]),qa}(qh),qs=function(q_){function qa(qS){this._bitmap=null,this._skin=null,this._group=null,qa.__super.call(this),this.skin=qS}qV(qa,"laya.ui.Image",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,qT.clearCache(this,this._skin)},qS.dispose=function(){this.destroy(!0),qT.clearCache(this,this._skin)},qS.createChildren=function(){this.graphics=this._bitmap=new qX},qS.setSource=function(qS,q_){qS===this._skin&&q_&&(this.source=q_,this.onCompResize())},qJ(0,qS,"source",function(){return this._bitmap.source},function(qS){this._bitmap&&(this._bitmap.source=qS,this.event("loaded"),this.repaint())}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"string"==typeof(this._dataSource=qS)?this.skin=qS:qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"measureHeight",function(){return this._bitmap.height}),qJ(0,qS,"skin",function(){return this._skin},function(qS){if(this._skin!=qS)if(qT.clearCache(this,this._skin),this._skin=qS){qT.keepCache(this,this._skin);var q_=qT.getRes(qS);q_?(this.source=q_,this.onCompResize()):qo.loader.load(this._skin,qC.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),qJ(0,qS,"group",function(){return this._group},function(qS){qS&&this._skin&&qT.setGroup(this._skin,qS),this._group=qS}),qJ(0,qS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(qS){this._bitmap.sizeGrid=qI.fillArray(qB.defaultSizeGrid,qS,Number)}),qJ(0,qS,"measureWidth",function(){return this._bitmap.width}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qh,this,"width",qS),this._bitmap.width=0==qS?1e-7:qS}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qh,this,"height",qS),this._bitmap.height=0==qS?1e-7:qS}),qa}(qh),qU=function(q_){function qa(qS){this._tf=null,qa.__super.call(this),void 0===qS&&(qS=""),qb.defaultColor=qB.labelColor,this.text=qS}qV(qa,"laya.ui.Label",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._tf=null},qS.createChildren=function(){this.addChild(this._tf=new qQ)},qS.changeText=function(qS){this._tf.changeText(qS)},qJ(0,qS,"padding",function(){return this._tf.padding.join(",")},function(qS){this._tf.padding=qI.fillArray(qB.labelPadding,qS,Number)}),qJ(0,qS,"bold",function(){return this._tf.bold},function(qS){this._tf.bold=qS}),qJ(0,qS,"align",function(){return this._tf.align},function(qS){this._tf.align=qS}),qJ(0,qS,"text",function(){return this._tf.text},function(qS){this._tf.text!=qS&&(qS&&(qS=qI.adptString(qS+"")),this._tf.text=qS,this.event("change"),this._width&&this._height||this.onCompResize())}),qJ(0,qS,"italic",function(){return this._tf.italic},function(qS){this._tf.italic=qS}),qJ(0,qS,"wordWrap",function(){return this._tf.wordWrap},function(qS){this._tf.wordWrap=qS}),qJ(0,qS,"font",function(){return this._tf.font},function(qS){this._tf.font=qS}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)||"string"==typeof qS?this.text=qS+"":qo.superSet(qh,this,"dataSource",qS)}),qJ(0,qS,"color",function(){return this._tf.color},function(qS){this._tf.color=qS}),qJ(0,qS,"valign",function(){return this._tf.valign},function(qS){this._tf.valign=qS}),qJ(0,qS,"leading",function(){return this._tf.leading},function(qS){this._tf.leading=qS}),qJ(0,qS,"fontSize",function(){return this._tf.fontSize},function(qS){this._tf.fontSize=qS}),qJ(0,qS,"bgColor",function(){return this._tf.bgColor},function(qS){this._tf.bgColor=qS}),qJ(0,qS,"borderColor",function(){return this._tf.borderColor},function(qS){this._tf.borderColor=qS}),qJ(0,qS,"stroke",function(){return this._tf.stroke},function(qS){this._tf.stroke=qS}),qJ(0,qS,"strokeColor",function(){return this._tf.strokeColor},function(qS){this._tf.strokeColor=qS}),qJ(0,qS,"textField",function(){return this._tf}),qJ(0,qS,"measureWidth",function(){return this._tf.width}),qJ(0,qS,"measureHeight",function(){return this._tf.height}),qJ(0,qS,"width",function(){return this._width||this._tf.text?qo.superGet(qh,this,"width"):0},function(qS){qo.superSet(qh,this,"width",qS),this._tf.width=qS}),qJ(0,qS,"height",function(){return this._height||this._tf.text?qo.superGet(qh,this,"height"):0},function(qS){qo.superSet(qh,this,"height",qS),this._tf.height=qS}),qJ(0,qS,"overflow",function(){return this._tf.overflow},function(qS){this._tf.overflow=qS}),qJ(0,qS,"underline",function(){return this._tf.underline},function(qS){this._tf.underline=qS}),qJ(0,qS,"underlineColor",function(){return this._tf.underlineColor},function(qS){this._tf.underlineColor=qS}),qa}(qh),qf=function(q_){function qa(qS){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,qa.__super.call(this),this.skin=qS}qV(qa,"laya.ui.ProgressBar",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._bg&&this._bg.destroy(qS),this._bar&&this._bar.destroy(qS),this._bg=this._bar=null,this.changeHandler=null},qS.createChildren=function(){this.addChild(this._bg=new qs),this.addChild(this._bar=new qs)},qS.changeValue=function(){if(this.sizeGrid){var qS=this.sizeGrid.split(","),q_=Number(qS[3]),qa=Number(qS[1]),qR=(this.width-q_-qa)*this._value;this._bar.width=q_+qa+qR,this._bar.visible=this._bar.width>q_+qa}else this._bar.width=this.width*this._value},qJ(0,qS,"measureHeight",function(){return this._bg.height}),qJ(0,qS,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(this._skin=qS,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),qJ(0,qS,"measureWidth",function(){return this._bg.width}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qh,this,"height",qS),this._bg.height=this._height,this._bar.height=this._height}),qJ(0,qS,"bar",function(){return this._bar}),qJ(0,qS,"value",function(){return this._value},function(qS){this._value!=qS&&(qS=1<qS?1:qS<0?0:qS,this._value=qS,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(qS))}),qJ(0,qS,"bg",function(){return this._bg}),qJ(0,qS,"sizeGrid",function(){return this._bg.sizeGrid},function(qS){this._bg.sizeGrid=this._bar.sizeGrid=qS}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qh,this,"width",qS),this._bg.width=this._width,this.callLater(this.changeValue)}),qJ(0,qS,"dataSource",q_.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)||"string"==typeof qS?this.value=Number(qS):qo.superSet(qh,this,"dataSource",qS)}),qa}(qh),qY=(function(qS){function qa(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,qa.__super.call(this),this._tipBox=new qh,this._tipBox.addChild(this._tipText=new qQ),this._tipText.x=this._tipText.y=5,this._tipText.color=qa.tipTextColor,this._defaultTipHandler=this._showDefaultTip,qo.stage.on("showtip",this,this._onStageShowTip),qo.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}qV(qa,"laya.ui.TipManager",qh);var q_=qa.prototype;q_._onStageHideTip=function(qS){qo.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},q_._onStageShowTip=function(qS){qo.timer.once(qa.tipDelay,this,this._showTip,[qS],!0)},q_._showTip=function(qS){if("string"==typeof qS){var q_=String(qS);Boolean(q_)&&this._defaultTipHandler(q_)}else qS instanceof laya.utils.Handler?qS.run():"function"==typeof qS&&qS.apply();qo.stage.on("mousemove",this,this._onStageMouseMove),qo.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},q_._onStageMouseDown=function(qS){this.closeAll()},q_._onStageMouseMove=function(qS){this._showToStage(this,qa.offsetX,qa.offsetY)},q_._showToStage=function(qS,q_,qa){void 0===q_&&(q_=0),void 0===qa&&(qa=0);var qR=qS.getBounds();qS.x=qo.stage.mouseX+q_,qS.y=qo.stage.mouseY+qa,qS.x+qR.width>qo.stage.width&&(qS.x-=qR.width+q_),qS.y+qR.height>qo.stage.height&&(qS.y-=qR.height+qa)},q_.closeAll=function(){qo.timer.clear(this,this._showTip),qo.stage.off("mousemove",this,this._onStageMouseMove),qo.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},q_.showDislayTip=function(qS){this.addChild(qS),this._showToStage(this),qo._currentStage.addChild(this)},q_._showDefaultTip=function(qS){this._tipText.text=qS;var q_=this._tipBox.graphics;q_.clear(),q_.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,qa.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),qo._currentStage.addChild(this)},qJ(0,q_,"defaultTipHandler",function(){return this._defaultTipHandler},function(qS){this._defaultTipHandler=qS}),qa.offsetX=10,qa.offsetY=15,qa.tipTextColor="#ffffff",qa.tipBackColor="#111111",qa.tipDelay=200}(),function(qS){var qG;function qt(){this._idMap=null,this._aniList=null,this._watchMap={},qt.__super.call(this)}qV(qt,"laya.ui.View",qK);var q_=qt.prototype;return q_.createView=function(qS){if(qS.animations&&!this._idMap&&(this._idMap={}),qt.createComp(qS,this,this),qS.animations){var q_,qa,qR=[],qJ=qS.animations,qV=0,qW=qJ.length;for(qV=0;qV<qW;qV++){switch(q_=new qH,qa=qJ[qV],q_._setUp(this._idMap,qa),(this[qa.name]=q_)._setControlNode(this),qa.action){case 1:q_.play(0,!1);break;case 2:q_.play(0,!0)}qR.push(q_)}this._aniList=qR}0<this._width&&null==qS.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},q_.onEvent=function(qS,q_){},q_.loadUI=function(qS){var q_=qt.uiMap[qS];q_&&this.createView(q_)},q_.destroy=function(qS){void 0===qS&&(qS=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,qS)},q_.changeData=function(qS){var q_=this._watchMap[qS];if(q_){console.log("change",qS);for(var qa=0,qR=q_.length;qa<qR;qa++){q_[qa].exe(this)}}},qt._regs=function(){for(var qS in qt.uiClassMap)q$.regClass(qS,qt.uiClassMap[qS])},qt.createComp=function(qS,q_,qa,qR){if(!(q_=q_||qt.getCompInstance(qS)))return console.warn("can not create:"+qS.type),null;var qJ=qS.child;if(qJ)for(var qV=q_ instanceof laya.ui.List,qW=0,qk=qJ.length;qW<qk;qW++){var qz=qJ[qW];if(!q_.hasOwnProperty("itemRender")||"render"!=qz.props.name&&"render"!==qz.props.renderType)if("Graphic"==qz.type)q$.addGraphicsToSprite(qz,q_);else if(q$.isDrawType(qz.type))q$.addGraphicToSprite(qz,q_,!0);else{if(qV){var qb=[],qH=qt.createComp(qz,null,qa,qb);qb.length&&(qH._$bindData=qb)}else qH=qt.createComp(qz,null,qa,qR);"Script"==qz.type?"owner"in qH?qH.owner=q_:"target"in qH&&(qH.target=q_):"mask"==qz.props.renderType||"mask"==qz.props.name?q_.mask=qH:qH instanceof laya.display.Sprite&&q_.addChild(qH)}else q_.itemRender=qz}var qL=qS.props;for(var qC in qL){var qG=qL[qC];qt.eventDic[qC]?qG&&qa&&q_.on(qC,qa,qa.onEvent,[qG]):qt.setCompValue(q_,qC,qG,qa,qR)}return qo.__typeof(q_,"laya.ui.IItem")&&q_.initItems(),qS.compId&&qa&&qa._idMap&&(qa._idMap[qS.compId]=q_),q_},qt.setCompValue=function(qS,q_,qa,qR,qJ){if("string"==typeof qa&&-1<qa.indexOf("${")){if(qt._sheet||(qt._sheet=q$.getClass("laya.data.Table")),!qt._sheet)return void console.warn("Can not find class Sheet");if(qJ)qJ.push(qS,q_,qa);else if(qR){-1==qa.indexOf("].")&&(qa=qa.replace(".","[0]."));var qV,qW,qk=new qG(qS,q_,qa);qk.exe(qR);for(var qz=qa.replace(/\[.*?\]\./g,".");null!=(qV=qt._parseWatchData.exec(qz));){for(var qb=qV[1];null!=(qW=qt._parseKeyWord.exec(qb));){var qH=qW[0],qL=qR._watchMap[qH]||(qR._watchMap[qH]=[]);qL.push(qk),qt._sheet.I.notifer.on(qH,qR,qR.changeData,[qH])}(qL=qR._watchMap[qb]||(qR._watchMap[qb]=[])).push(qk),qt._sheet.I.notifer.on(qb,qR,qR.changeData,[qb])}}}else if("var"===q_&&qR)qR[qa]=qS;else if("onClick"==q_){var qC=qo._runScript("(function(){"+qa+"})");qS.on("click",qR,qC)}else qS[q_]="true"===qa||"false"!==qa&&qa},qt.getCompInstance=function(qS){var q_,qa=qS.props?qS.props.runtime:null;return q_=qa?qt.viewClassMap[qa]||qt.uiClassMap[qa]||qo.__classmap[qa]:qt.uiClassMap[qS.type],qS.props&&qS.props.hasOwnProperty("renderType")&&"instance"==qS.props.renderType?q_.instance:q_?new q_:null},qt.regComponent=function(qS,q_){qt.uiClassMap[qS]=q_,q$.regClass(qS,q_)},qt.regViewRuntime=function(qS,q_){qt.viewClassMap[qS]=q_},qt.uiMap={},qt.viewClassMap={},qt._sheet=null,qR(qt,["uiClassMap",function(){return this.uiClassMap={ViewStack:qSS,LinkButton:qP,TextArea:qbS,ColorPicker:qr,Box:qK,Button:qP,CheckBox:qi,Clip:qM,ComboBox:qe,Component:qh,HScrollBar:qy,HSlider:qO,Image:qs,Label:qU,List:qc,Panel:qE,ProgressBar:qf,Radio:qv,RadioGroup:qkS,ScrollBar:qg,Slider:qx,Tab:qzS,TextInput:qaS,View:qt,VScrollBar:q_S,VSlider:qRS,Tree:qd,HBox:qVS,VBox:qWS,Sprite:qj,Animation:qa,Text:qQ,FontClip:qp}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),qt.__init$=function(){qt._regs(),qG=function(){function qS(qS,q_,qa){this.comp=null,this.prop=null,this.value=null,this.comp=qS,this.prop=q_,this.value=qa}return qV(qS,""),qS.prototype.exe=function(qS){var q_=qI.getBindFun(this.value);this.comp[this.prop]=q_.call(this,qS)},qS}()},qt}()),qi=function(qS){function qa(qS,q_){void 0===q_&&(q_=""),qa.__super.call(this,qS,q_)}qV(qa,"laya.ui.CheckBox",qS);var q_=qa.prototype;return q_.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},q_.initialize=function(){qS.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},qJ(0,q_,"dataSource",qS.prototype._$get_dataSource,function(qS){"boolean"==typeof(this._dataSource=qS)?this.selected=qS:"string"==typeof qS?this.selected="true"===qS:qo.superSet(qP,this,"dataSource",qS)}),qa}(qP),qZ=function(qS){function q_(){this._space=0,this._align="none",this._itemChanged=!1,q_.__super.call(this)}qV(q_,"laya.ui.LayoutBox",qK);var qa=q_.prototype;return qa.addChild=function(qS){return qS.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,qS)},qa.onResize=function(qS){this._setItemChanged()},qa.addChildAt=function(qS,q_){return qS.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,qS,q_)},qa.removeChild=function(qS){return qS.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,qS)},qa.removeChildAt=function(qS){return this.getChildAt(qS).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,qS)},qa.refresh=function(){this._setItemChanged()},qa.changeItems=function(){this._itemChanged=!1},qa.sortItem=function(qS){qS&&qS.sort(function(qS,q_){return qS.y-q_.y})},qa._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},qJ(0,qa,"space",function(){return this._space},function(qS){this._space=qS,this._setItemChanged()}),qJ(0,qa,"align",function(){return this._align},function(qS){this._align=qS,this._setItemChanged()}),q_}(),qp=function(q_){function qa(qS,q_){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,qa.__super.call(this),qS&&(this.skin=qS),q_&&(this.sheet=q_)}qV(qa,"laya.ui.FontClip",q_);var qS=qa.prototype;return qS.createChildren=function(){this._bitmap=new qX,this.on("loaded",this,this._onClipLoaded)},qS._onClipLoaded=function(){this.callLater(this.changeValue)},qS.changeValue=function(){var qS;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),qS=this._sources[0]))){var q_="horizontal"===this._direction;q_?(this._wordsW=this._valueArr.length*(qS.sourceWidth+this.spaceX),this._wordsH=qS.sourceHeight):(this._wordsW=qS.sourceWidth,this._wordsH=(qS.sourceHeight+this.spaceY)*this._valueArr.length);var qa=0;if(this._width)switch(this._align){case"center":qa=.5*(this._width-this._wordsW);break;case"right":qa=this._width-this._wordsW;break;default:qa=0}for(var qR=0,qJ=this._valueArr.length;qR<qJ;qR++){var qV=this._indexMap[this._valueArr.charAt(qR)];this.sources[qV]&&(qS=this.sources[qV],q_?this.graphics.drawTexture(qS,qa+qR*(qS.sourceWidth+this.spaceX),0,qS.sourceWidth,qS.sourceHeight):this.graphics.drawTexture(qS,0+qa,qR*(qS.sourceHeight+this.spaceY),qS.sourceWidth,qS.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},qS.destroy=function(qS){void 0===qS&&(qS=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),q_.prototype.destroy.call(this,qS)},qJ(0,qS,"sheet",function(){return this._sheet},function(qS){qS+="";var q_=(this._sheet=qS).split(" ");this._clipX=String(q_[0]).length,this.clipY=q_.length,this._indexMap={};for(var qa=0;qa<this._clipY;qa++)for(var qR=q_[qa].split(""),qJ=0,qV=qR.length;qJ<qV;qJ++)this._indexMap[qR[qJ]]=qa*this._clipX+qJ}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qM,this,"height",qS),this.callLater(this.changeValue)}),qJ(0,qS,"direction",function(){return this._direction},function(qS){this._direction=qS,this.callLater(this.changeValue)}),qJ(0,qS,"value",function(){return this._valueArr?this._valueArr:""},function(qS){qS+="",this._valueArr=qS,this.callLater(this.changeValue)}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qM,this,"width",qS),this.callLater(this.changeValue)}),qJ(0,qS,"spaceX",function(){return this._spaceX},function(qS){this._spaceX=qS,"horizontal"===this._direction&&this.callLater(this.changeValue)}),qJ(0,qS,"spaceY",function(){return this._spaceY},function(qS){this._spaceY=qS,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),qJ(0,qS,"align",function(){return this._align},function(qS){this._align=qS,this.callLater(this.changeValue)}),qJ(0,qS,"measureWidth",function(){return this._wordsW}),qJ(0,qS,"measureHeight",function(){return this._wordsH}),qa}(qM),qc=function(qS){function q_(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new qt,q_.__super.call(this)}qV(q_,"laya.ui.List",qS);var qa=q_.prototype;return qo.imps(qa,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),qa.destroy=function(qS){void 0===qS&&(qS=!0),this._content&&this._content.destroy(qS),this._scrollBar&&this._scrollBar.destroy(qS),laya.ui.Component.prototype.destroy.call(this,qS),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},qa.createChildren=function(){this.addChild(this._content=new qK)},qa.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=qo.superGet(qK,this,"cacheAs")),qo.superSet(qK,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},qa.onScrollEnd=function(){qo.superSet(qK,this,"cacheAs",this._$P.cacheAs)},qa._removePreScrollBar=function(){var qS=this.removeChildByName("scrollBar");qS&&qS.destroy(!0)},qa.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var qS=this._getOneCell(),q_=qS.width+this._spaceX||1,qa=qS.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/q_):Math.ceil(this._width/q_)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/qa):Math.round(this._height/qa));var qR=this._width?this._width:q_*this.repeatX-this._spaceX,qJ=this._height?this._height:qa*this.repeatY-this._spaceY;this._cellSize=this._isVertical?qa:q_,this._cellOffset=this._isVertical?qa*Math.max(this._repeatY2,this._repeatY)-qJ-this._spaceY:q_*Math.max(this._repeatX2,this._repeatX)-qR-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=qJ:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=qR),this.setContentSize(qR,qJ);var qV=this._isVertical?this.repeatX:this.repeatY,qW=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,qV,qW),this._createdLine=qW,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},qa._getOneCell=function(){if(0===this._cells.length){var qS=this.createItem();if(this._offset.setTo(qS.x,qS.y),this.cacheContent)return qS;this._cells.push(qS)}return this._cells[0]},qa._createItems=function(qS,q_,qa){var qR=this._content,qJ=this._getOneCell(),qV=qJ.width+this._spaceX,qW=qJ.height+this._spaceY;if(this.cacheContent){var qk=new qK;qk.cacheAsBitmap=!0,qk.pos((this._isVertical?0:qS)*qV,(this._isVertical?qS:0)*qW),this._content.addChild(qk),this._content.optimizeScrollRect=!0,qR=qk}else{for(var qz=[],qb=this._cells.length-1;-1<qb;qb--){var qH=this._cells[qb];qH.removeSelf(),qz.push(qH)}this._cells.length=0}for(var qL=qS;qL<qa;qL++)for(var qC=0;qC<q_;qC++)(qJ=qz&&qz.length?qz.pop():this.createItem()).x=(this._isVertical?qC:qL)*qV-qR.x,qJ.y=(this._isVertical?qL:qC)*qW-qR.y,qJ.name="item"+(qL*q_+qC),qR.addChild(qJ),this.addCell(qJ)},qa.createItem=function(){var qS=[];if("function"==typeof this._itemRender)var q_=new this._itemRender;else q_=qY.createComp(this._itemRender,null,null,qS);if(0==qS.length&&q_._watchMap){var qa=q_._watchMap;for(var qR in qa)for(var qJ=qa[qR],qV=0;qV<qJ.length;qV++){var qW=qJ[qV];qS.push(qW.comp,qW.prop,qW.value)}}return qS.length&&(q_._$bindData=qS),q_},qa.addCell=function(qS){qS.on("click",this,this.onCellMouse),qS.on("rightclick",this,this.onCellMouse),qS.on("mouseover",this,this.onCellMouse),qS.on("mouseout",this,this.onCellMouse),qS.on("mousedown",this,this.onCellMouse),qS.on("mouseup",this,this.onCellMouse),this._cells.push(qS)},qa.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var qS=0,q_=qS=0;q_<1e4;q_++){var qa=this.getChildByName("item"+q_);if(!qa)break;this.addCell(qa),qS++}this.repeatY=qS}},qa.setContentSize=function(qS,q_){this._content.width=qS,this._content.height=q_,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new qF),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,qS,q_),this._content.scrollRect=this._content.scrollRect),this.event("resize")},qa.onCellMouse=function(qS){"mousedown"===qS.type&&(this._isMoved=!1);var q_=qS.currentTarget,qa=this._startIndex+this._cells.indexOf(q_);qa<0||("click"===qS.type||"rightclick"===qS.type?this.selectEnable&&!this._isMoved?this.selectedIndex=qa:this.changeCellState(q_,!0,0):"mouseover"!==qS.type&&"mouseout"!==qS.type||this._selectedIndex===qa||this.changeCellState(q_,"mouseover"===qS.type,0),this.mouseHandler&&this.mouseHandler.runWith([qS,qa]))},qa.changeCellState=function(qS,q_,qa){var qR=qS.getChildByName("selectBox");qR&&(this.selectEnable=!0,qR.visible=q_,qR.index=qa)},qa.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},qa.onScrollBarChange=function(qS){this.runCallLater(this.changeCells);var q_=this._scrollBar.value,qa=this._isVertical?this.repeatX:this.repeatY,qR=this._isVertical?this.repeatY:this.repeatX,qJ=Math.floor(q_/this._cellSize);if(this.cacheContent)qW=qR+1,this._createdLine-qJ<qW&&(this._createItems(this._createdLine,qa,this._createdLine+qW),this.renderItems(this._createdLine*qa,0),this._createdLine+=qW);else{var qV=qJ*qa,qW=0;if(qV>this._startIndex){qW=qV-this._startIndex;var qk=!0,qz=this._startIndex+qa*(qR+1);this._isMoved=!0}else qV<this._startIndex&&(qW=this._startIndex-qV,qk=!1,qz=this._startIndex-1,this._isMoved=!0);for(var qb=0;qb<qW;qb++){if(qk){var qH=this._cells.shift();this._cells[this._cells.length]=qH;var qL=qz+qb}else qH=this._cells.pop(),this._cells.unshift(qH),qL=qz-qb;var qC=Math.floor(qL/qa)*this._cellSize;this._isVertical?qH.y=qC:qH.x=qC,this.renderItem(qH,qL)}this._startIndex=qV,this.changeSelectStatus()}var qG=this._content.scrollRect;this._isVertical?(qG.y=q_-this._offset.y,qG.x=-this._offset.x):(qG.y=-this._offset.y,qG.x=q_-this._offset.x),this._content.scrollRect=qG},qa.posCell=function(qS,q_){if(this._scrollBar){var qa=this._isVertical?this.repeatX:this.repeatY,qR=(this._isVertical?this.repeatY:this.repeatX,Math.floor(q_/qa)*this._cellSize);this._isVertical?qS.y=qR:qS.x=qR}},qa.changeSelectStatus=function(){for(var qS=0,q_=this._cells.length;qS<q_;qS++)this.changeCellState(this._cells[qS],this._selectedIndex===this._startIndex+qS,1)},qa.renderItems=function(qS,q_){void 0===qS&&(qS=0),void 0===q_&&(q_=0);for(var qa=qS,qR=q_||this._cells.length;qa<qR;qa++)this.renderItem(this._cells[qa],this._startIndex+qa);this.changeSelectStatus()},qa.renderItem=function(qS,q_){this._array&&0<=q_&&q_<this._array.length?(qS.visible=!0,qS._$bindData?(qS._dataSource=this._array[q_],this._bindData(qS,this._array[q_])):qS.dataSource=this._array[q_],this.cacheContent||this.posCell(qS,q_),this.hasListener("render")&&this.event("render",[qS,q_]),this.renderHandler&&this.renderHandler.runWith([qS,q_])):(qS.visible=!1,qS.dataSource=null)},qa._bindData=function(qS,q_){for(var qa=qS._$bindData,qR=0,qJ=qa.length;qR<qJ;qR++){var qV=qa[qR++],qW=qa[qR++],qk=qa[qR],qz=qI.getBindFun(qk);qV[qW]=qz.call(this,q_)}},qa.refresh=function(){this.array=this._array},qa.getItem=function(qS){return-1<qS&&qS<this._array.length?this._array[qS]:null},qa.changeItem=function(qS,q_){-1<qS&&qS<this._array.length&&(this._array[qS]=q_,qS>=this._startIndex&&qS<this._startIndex+this._cells.length&&this.renderItem(this.getCell(qS),qS))},qa.setItem=function(qS,q_){this.changeItem(qS,q_)},qa.addItem=function(qS){this._array.push(qS),this.array=this._array},qa.addItemAt=function(qS,q_){this._array.splice(q_,0,qS),this.array=this._array},qa.deleteItem=function(qS){this._array.splice(qS,1),this.array=this._array},qa.getCell=function(qS){return this.runCallLater(this.changeCells),-1<qS&&this._cells?this._cells[(qS-this._startIndex)%this._cells.length]:null},qa.scrollTo=function(qS){if(this._scrollBar){var q_=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(qS/q_)*this._cellSize}else this.startIndex=qS},qa.tweenTo=function(qS,q_,qa){if(void 0===q_&&(q_=200),this._scrollBar){var qR=this._isVertical?this.repeatX:this.repeatY;qq.to(this._scrollBar,{value:Math.floor(qS/qR)*this._cellSize},q_,null,qa,0,!0)}else this.startIndex=qS,qa&&qa.run()},qa._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},qa.commitMeasure=function(){this.runCallLater(this.changeCells)},qJ(0,qa,"cacheAs",qS.prototype._$get_cacheAs,function(qS){qo.superSet(qK,this,"cacheAs",qS),this._scrollBar&&(this._$P.cacheAs=null,"none"!==qS?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),qJ(0,qa,"content",function(){return this._content}),qJ(0,qa,"height",qS.prototype._$get_height,function(qS){qS!=this._height&&(qo.superSet(qK,this,"height",qS),this._setCellChanged())}),qJ(0,qa,"itemRender",function(){return this._itemRender},function(qS){if(this._itemRender!=qS){this._itemRender=qS;for(var q_=this._cells.length-1;-1<q_;q_--)this._cells[q_].destroy();this._cells.length=0,this._setCellChanged()}}),qJ(0,qa,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(qS){this._removePreScrollBar();var q_=new q_S;q_.name="scrollBar",q_.right=0,qS&&" "!=qS&&(q_.skin=qS),this.scrollBar=q_,this.addChild(q_),this._setCellChanged()}),qJ(0,qa,"page",function(){return this._page},function(qS){this._page=qS,this._array&&(this._page=0<qS?qS:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),qJ(0,qa,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(qS){this._removePreScrollBar();var q_=new qy;q_.name="scrollBar",q_.bottom=0,qS&&" "!=qS&&(q_.skin=qS),this.scrollBar=q_,this.addChild(q_),this._setCellChanged()}),qJ(0,qa,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(qS){this._repeatX=qS,this._setCellChanged()}),qJ(0,qa,"scrollBar",function(){return this._scrollBar},function(qS){this._scrollBar!=qS&&(this._scrollBar=qS)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),qJ(0,qa,"width",qS.prototype._$get_width,function(qS){qS!=this._width&&(qo.superSet(qK,this,"width",qS),this._setCellChanged())}),qJ(0,qa,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(qS){this._repeatY=qS,this._setCellChanged()}),qJ(0,qa,"spaceX",function(){return this._spaceX},function(qS){this._spaceX=qS,this._setCellChanged()}),qJ(0,qa,"spaceY",function(){return this._spaceY},function(qS){this._spaceY=qS,this._setCellChanged()}),qJ(0,qa,"selectedIndex",function(){return this._selectedIndex},function(qS){this._selectedIndex!=qS&&(this._selectedIndex=qS,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(qS),this.startIndex=this._startIndex)}),qJ(0,qa,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(qS){this.selectedIndex=this._array.indexOf(qS)}),qJ(0,qa,"length",function(){return this._array?this._array.length:0}),qJ(0,qa,"selection",function(){return this.getCell(this._selectedIndex)},function(qS){this.selectedIndex=this._startIndex+this._cells.indexOf(qS)}),qJ(0,qa,"startIndex",function(){return this._startIndex},function(qS){this._startIndex=0<qS?qS:0,this.callLater(this.renderItems)}),qJ(0,qa,"array",function(){return this._array},function(qS){this.runCallLater(this.changeCells),this._array=qS||[];var q_=this._array.length;if(this.totalPage=Math.ceil(q_/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<q_?this._selectedIndex:q_-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var qa=this._isVertical?this.repeatX:this.repeatY,qR=this._isVertical?this.repeatY:this.repeatX,qJ=Math.ceil(q_/qa);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=qR/qJ,this._scrollBar.setScroll(0,(qJ-qR)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),qJ(0,qa,"dataSource",qS.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)&&Math.floor(qS)==qS||"string"==typeof qS?this.selectedIndex=parseInt(qS):qS instanceof Array?this.array=qS:qo.superSet(qK,this,"dataSource",qS)}),qJ(0,qa,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),q_}(qK),qy=function(qS){function q_(){q_.__super.call(this)}return qV(q_,"laya.ui.HScrollBar",qS),q_.prototype.initialize=function(){qS.prototype.initialize.call(this),this.slider.isVertical=!1},q_}(qg),qE=function(qS){function q_(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,q_.__super.call(this),this.width=this.height=100}qV(q_,"laya.ui.Panel",qS);var qa=q_.prototype;return qa.destroy=function(qS){void 0===qS&&(qS=!0),laya.ui.Component.prototype.destroy.call(this,qS),this._content&&this._content.destroy(qS),this._vScrollBar&&this._vScrollBar.destroy(qS),this._hScrollBar&&this._hScrollBar.destroy(qS),this._vScrollBar=null,this._hScrollBar=null,this._content=null},qa.destroyChildren=function(){this._content.destroyChildren()},qa.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new qK)},qa.addChild=function(qS){return qS.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(qS)},qa.onResize=function(){this._setScrollChanged()},qa.addChildAt=function(qS,q_){return qS.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(qS,q_)},qa.removeChild=function(qS){return qS.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(qS)},qa.removeChildAt=function(qS){return this.getChildAt(qS).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(qS)},qa.removeChildren=function(qS,q_){return void 0===qS&&(qS=0),void 0===q_&&(q_=2147483647),this._content.removeChildren(qS,q_),this._setScrollChanged(),this},qa.getChildAt=function(qS){return this._content.getChildAt(qS)},qa.getChildByName=function(qS){return this._content.getChildByName(qS)},qa.getChildIndex=function(qS){return this._content.getChildIndex(qS)},qa.changeScroll=function(){this._scrollChanged=!1;var qS=this.contentWidth||1,q_=this.contentHeight||1,qa=this._vScrollBar,qR=this._hScrollBar,qJ=qa&&q_>this._height,qV=qR&&qS>this._width,qW=qJ?this._width-qa.width:this._width,qk=qV?this._height-qR.height:this._height;qa&&(qa.x=this._width-qa.width,qa.y=0,qa.height=this._height-(qV?qR.height:0),qa.scrollSize=Math.max(.033*this._height,1),qa.thumbPercent=qk/q_,qa.setScroll(0,q_-qk,qa.value)),qR&&(qR.x=0,qR.y=this._height-qR.height,qR.width=this._width-(qJ?qa.width:0),qR.scrollSize=Math.max(.033*this._width,1),qR.thumbPercent=qW/qS,qR.setScroll(0,qS-qW,qR.value))},qa.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},qa.setContentSize=function(qS,q_){var qa=this._content;qa.width=qS,qa.height=q_,qa.scrollRect||(qa.scrollRect=new qF),qa.scrollRect.setTo(0,0,qS,q_),qa.scrollRect=qa.scrollRect},qa.onScrollBarChange=function(qS){var q_=this._content.scrollRect;if(q_){var qa=Math.round(qS.value);qS.isVertical?q_.y=qa:q_.x=qa,this._content.scrollRect=q_}},qa.scrollTo=function(qS,q_){void 0===qS&&(qS=0),void 0===q_&&(q_=0),this.vScrollBar&&(this.vScrollBar.value=q_),this.hScrollBar&&(this.hScrollBar.value=qS)},qa.refresh=function(){this.changeScroll()},qa.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=qo.superGet(qK,this,"cacheAs")),qo.superSet(qK,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},qa.onScrollEnd=function(){qo.superSet(qK,this,"cacheAs",this._$P.cacheAs)},qa._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},qJ(0,qa,"numChildren",function(){return this._content.numChildren}),qJ(0,qa,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(qS){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new qy),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=qS}),qJ(0,qa,"contentWidth",function(){for(var qS=0,q_=this._content.numChildren-1;-1<q_;q_--){var qa=this._content.getChildAt(q_);qS=Math.max(qa.x+qa.width*qa.scaleX,qS)}return qS}),qJ(0,qa,"contentHeight",function(){for(var qS=0,q_=this._content.numChildren-1;-1<q_;q_--){var qa=this._content.getChildAt(q_);qS=Math.max(qa.y+qa.height*qa.scaleY,qS)}return qS}),qJ(0,qa,"width",qS.prototype._$get_width,function(qS){qo.superSet(qK,this,"width",qS),this._setScrollChanged()}),qJ(0,qa,"hScrollBar",function(){return this._hScrollBar}),qJ(0,qa,"content",function(){return this._content}),qJ(0,qa,"height",qS.prototype._$get_height,function(qS){qo.superSet(qK,this,"height",qS),this._setScrollChanged()}),qJ(0,qa,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(qS){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new q_S),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=qS}),qJ(0,qa,"vScrollBar",function(){return this._vScrollBar}),qJ(0,qa,"cacheAs",qS.prototype._$get_cacheAs,function(qS){qo.superSet(qK,this,"cacheAs",qS),this._$P.cacheAs=null,"none"!==qS?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),q_}(qK),qO=function(qS){function q_(qS){q_.__super.call(this,qS),this.isVertical=!1}return qV(q_,"laya.ui.HSlider",qx),q_}(),qw=function(qS){function qa(qS,q_){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,qa.__super.call(this),this.skin=q_,this.labels=qS}qV(qa,"laya.ui.UIGroup",qS);var q_=qa.prototype;return qo.imps(q_,{"laya.ui.IItem":!0}),q_.preinitialize=function(){this.mouseEnabled=!0},q_.destroy=function(qS){void 0===qS&&(qS=!0),laya.ui.Component.prototype.destroy.call(this,qS),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},q_.addItem=function(qS,q_){void 0===q_&&(q_=!0);var qa=qS,qR=this._items.length;if(qa.name="item"+qR,this.addChild(qa),this.initItems(),q_&&0<qR){var qJ=this._items[qR-1];"horizontal"==this._direction?qa.x=qJ.x+qJ.width+this._space:qa.y=qJ.y+qJ.height+this._space}else q_&&(qa.x=0,qa.y=0);return qR},q_.delItem=function(qS,q_){void 0===q_&&(q_=!0);var qa=this._items.indexOf(qS);if(-1!=qa){var qR=qS;this.removeChild(qR);for(var qJ=qa+1,qV=this._items.length;qJ<qV;qJ++){var qW=this._items[qJ];qW.name="item"+(qJ-1),q_&&("horizontal"==this._direction?qW.x-=qR.width+this._space:qW.y-=qR.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var qk;qk=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=qk}}},q_.initItems=function(){this._items||(this._items=[]);for(var qS=this._items.length=0;qS<1e4;qS++){var q_=this.getChildByName("item"+qS);if(null==q_)break;this._items.push(q_),q_.selected=qS===this._selectedIndex,q_.clickHandler=qC.create(this,this.itemClick,[qS],!1)}},q_.itemClick=function(qS){this.selectedIndex=qS},q_.setSelect=function(qS,q_){this._items&&-1<qS&&qS<this._items.length&&(this._items[qS].selected=q_)},q_.createItem=function(qS,q_){return null},q_.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var qS=0,q_=0,qa=this._items.length;q_<qa;q_++){var qR=this._items[q_];this._skin&&(qR.skin=this._skin),this._labelColors&&(qR.labelColors=this._labelColors),this._labelSize&&(qR.labelSize=this._labelSize),this._labelStroke&&(qR.labelStroke=this._labelStroke),this._labelStrokeColor&&(qR.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(qR.strokeColors=this._strokeColors),this._labelBold&&(qR.labelBold=this._labelBold),this._labelPadding&&(qR.labelPadding=this._labelPadding),this._labelAlign&&(qR.labelAlign=this._labelAlign),this._stateNum&&(qR.stateNum=this._stateNum),this._labelFont&&(qR.labelFont=this._labelFont),"horizontal"===this._direction?(qR.y=0,qR.x=qS,qS+=qR.width+this._space):(qR.x=0,qR.y=qS,qS+=qR.height+this._space)}this.changeSize()},q_.commitMeasure=function(){this.runCallLater(this.changeLabels)},q_._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},qJ(0,q_,"labelStrokeColor",function(){return this._labelStrokeColor},function(qS){this._labelStrokeColor!=qS&&(this._labelStrokeColor=qS,this._setLabelChanged())}),qJ(0,q_,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(this._skin=qS,this._setLabelChanged())}),qJ(0,q_,"selectedIndex",function(){return this._selectedIndex},function(qS){this._selectedIndex!=qS&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=qS,this.setSelect(qS,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),qJ(0,q_,"labels",function(){return this._labels},function(qS){if(this._labels!=qS){if(this._labels=qS,this.removeChildren(),this._setLabelChanged(),this._labels)for(var q_=this._labels.split(","),qa=0,qR=q_.length;qa<qR;qa++){var qJ=this.createItem(this._skin,q_[qa]);qJ.name="item"+qa,this.addChild(qJ)}this.initItems()}}),qJ(0,q_,"strokeColors",function(){return this._strokeColors},function(qS){this._strokeColors!=qS&&(this._strokeColors=qS,this._setLabelChanged())}),qJ(0,q_,"labelColors",function(){return this._labelColors},function(qS){this._labelColors!=qS&&(this._labelColors=qS,this._setLabelChanged())}),qJ(0,q_,"labelStroke",function(){return this._labelStroke},function(qS){this._labelStroke!=qS&&(this._labelStroke=qS,this._setLabelChanged())}),qJ(0,q_,"labelSize",function(){return this._labelSize},function(qS){this._labelSize!=qS&&(this._labelSize=qS,this._setLabelChanged())}),qJ(0,q_,"stateNum",function(){return this._stateNum},function(qS){this._stateNum!=qS&&(this._stateNum=qS,this._setLabelChanged())}),qJ(0,q_,"labelBold",function(){return this._labelBold},function(qS){this._labelBold!=qS&&(this._labelBold=qS,this._setLabelChanged())}),qJ(0,q_,"labelFont",function(){return this._labelFont},function(qS){this._labelFont!=qS&&(this._labelFont=qS,this._setLabelChanged())}),qJ(0,q_,"labelPadding",function(){return this._labelPadding},function(qS){this._labelPadding!=qS&&(this._labelPadding=qS,this._setLabelChanged())}),qJ(0,q_,"direction",function(){return this._direction},function(qS){this._direction=qS,this._setLabelChanged()}),qJ(0,q_,"space",function(){return this._space},function(qS){this._space=qS,this._setLabelChanged()}),qJ(0,q_,"items",function(){return this._items}),qJ(0,q_,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(qS){this.selectedIndex=this._items.indexOf(qS)}),qJ(0,q_,"dataSource",qS.prototype._$get_dataSource,function(qS){"number"==typeof(this._dataSource=qS)&&Math.floor(qS)==qS||"string"==typeof qS?this.selectedIndex=parseInt(qS):qS instanceof Array?this.labels=qS.join(","):qo.superSet(qK,this,"dataSource",qS)}),qa}(qK),qv=function(q_){function qa(qS,q_){this._value=null,void 0===q_&&(q_=""),qa.__super.call(this,qS,q_)}qV(qa,"laya.ui.Radio",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._value=null},qS.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},qS.initialize=function(){q_.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},qS.onClick=function(qS){this.selected=!0},qJ(0,qS,"value",function(){return null!=this._value?this._value:this.label},function(qS){this._value=qS}),qa}(qP),qd=function(qS){function q_(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,q_.__super.call(this),this.width=this.height=200}qV(q_,"laya.ui.Tree",qS);var qa=q_.prototype;return qo.imps(qa,{"laya.ui.IRender":!0}),qa.destroy=function(qS){void 0===qS&&(qS=!0),laya.ui.Component.prototype.destroy.call(this,qS),this._list&&this._list.destroy(qS),this._list=null,this._source=null,this._renderHandler=null},qa.createChildren=function(){this.addChild(this._list=new qc),this._list.renderHandler=qC.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},qa.onListChange=function(qS){this.event("change")},qa.getArray=function(){var qS,q_=[];for(var qa in this._source)qS=this._source[qa],this.getParentOpenStatus(qS)&&(qS.x=this._spaceLeft*this.getDepth(qS),q_.push(qS));return q_},qa.getDepth=function(qS,q_){return void 0===q_&&(q_=0),null==qS.nodeParent?q_:this.getDepth(qS.nodeParent,q_+1)},qa.getParentOpenStatus=function(qS){var q_=qS.nodeParent;return null==q_||!!q_.isOpen&&(null==q_.nodeParent||this.getParentOpenStatus(q_))},qa.renderItem=function(qS,q_){var qa=qS.dataSource;if(qa){qS.left=qa.x;var qR=qS.getChildByName("arrow");qR&&(qa.hasChild?(qR.visible=!0,qR.index=qa.isOpen?1:0,qR.tag=q_,qR.off("click",this,this.onArrowClick),qR.on("click",this,this.onArrowClick)):qR.visible=!1);var qJ=qS.getChildByName("folder");qJ&&(2==qJ.clipY?qJ.index=qa.isDirectory?0:1:qJ.index=qa.isDirectory?qa.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([qS,q_])}},qa.onArrowClick=function(qS){var q_=qS.currentTarget.tag;this._list.array[q_].isOpen=!this._list.array[q_].isOpen,this.event("open"),this._list.array=this.getArray()},qa.setItemState=function(qS,q_){this._list.array[qS]&&(this._list.array[qS].isOpen=q_,this._list.array=this.getArray())},qa.fresh=function(){this._list.array=this.getArray(),this.repaint()},qa.parseXml=function(qS,q_,qa,qR){var qJ,qV=qS.childNodes,qW=qV.length;if(!qR){qJ={};var qk,qz=qS.attributes;for(var qb in qz){var qH=(qk=qz[qb]).nodeName,qL=qk.nodeValue;qJ[qH]="true"==qL||"false"!=qL&&qL}qJ.nodeParent=qa,0<qW&&(qJ.isDirectory=!0),qJ.hasChild=0<qW,q_.push(qJ)}for(var qC=0;qC<qW;qC++){var qG=qV[qC];this.parseXml(qG,q_,qJ,!1)}},qa.parseOpenStatus=function(qS,q_){for(var qa=0,qR=q_.length;qa<qR;qa++){var qJ=q_[qa];if(qJ.isDirectory)for(var qV=0,qW=qS.length;qV<qW;qV++){var qk=qS[qV];if(qk.isDirectory&&this.isSameParent(qk,qJ)&&qJ.label==qk.label){qJ.isOpen=qk.isOpen;break}}}},qa.isSameParent=function(qS,q_){return null==qS.nodeParent&&null==q_.nodeParent||null!=qS.nodeParent&&null!=q_.nodeParent&&(qS.nodeParent.label==q_.nodeParent.label&&this.isSameParent(qS.nodeParent,q_.nodeParent))},qa.filter=function(qS){if(Boolean(qS)){var q_=[];this.getFilterSource(this._source,q_,qS),this._list.array=q_}else this._list.array=this.getArray()},qa.getFilterSource=function(qS,q_,qa){var qR;for(var qJ in qa=qa.toLocaleLowerCase(),qS)!(qR=qS[qJ]).isDirectory&&-1<String(qR.label).toLowerCase().indexOf(qa)&&(qR.x=0,q_.push(qR)),qR.child&&0<qR.child.length&&this.getFilterSource(qR.child,q_,qa)},qJ(0,qa,"spaceBottom",function(){return this._list.spaceY},function(qS){this._list.spaceY=qS}),qJ(0,qa,"keepStatus",function(){return this._keepStatus},function(qS){this._keepStatus=qS}),qJ(0,qa,"itemRender",function(){return this._list.itemRender},function(qS){this._list.itemRender=qS}),qJ(0,qa,"array",function(){return this._list.array},function(qS){this._keepStatus&&this._list.array&&qS&&this.parseOpenStatus(this._list.array,qS),this._source=qS,this._list.array=this.getArray()}),qJ(0,qa,"mouseHandler",function(){return this._list.mouseHandler},function(qS){this._list.mouseHandler=qS}),qJ(0,qa,"dataSource",qS.prototype._$get_dataSource,function(qS){this._dataSource=qS,qo.superSet(qK,this,"dataSource",qS)}),qJ(0,qa,"source",function(){return this._source}),qJ(0,qa,"scrollBar",function(){return this._list.scrollBar}),qJ(0,qa,"list",function(){return this._list}),qJ(0,qa,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(qS){this._list.vScrollBarSkin=qS}),qJ(0,qa,"renderHandler",function(){return this._renderHandler},function(qS){this._renderHandler=qS}),qJ(0,qa,"selectedIndex",function(){return this._list.selectedIndex},function(qS){this._list.selectedIndex=qS}),qJ(0,qa,"spaceLeft",function(){return this._spaceLeft},function(qS){this._spaceLeft=qS}),qJ(0,qa,"selectedItem",function(){return this._list.selectedItem},function(qS){this._list.selectedItem=qS}),qJ(0,qa,"width",qS.prototype._$get_width,function(qS){qo.superSet(qK,this,"width",qS),this._list.width=qS}),qJ(0,qa,"height",qS.prototype._$get_height,function(qS){qo.superSet(qK,this,"height",qS),this._list.height=qS}),qJ(0,qa,"xml",null,function(qS){var q_=[];this.parseXml(qS.childNodes[0],q_,null,!0),this.array=q_}),qJ(0,qa,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),q_}(qK),qSS=function(qS){function q_(){this._items=null,this._selectedIndex=0,q_.__super.call(this),this._setIndexHandler=qC.create(this,this.setIndex,null,!1)}qV(q_,"laya.ui.ViewStack",qS);var qa=q_.prototype;return qo.imps(qa,{"laya.ui.IItem":!0}),qa.setItems=function(qS){this.removeChildren();for(var q_=0,qa=0,qR=qS.length;qa<qR;qa++){var qJ=qS[qa];qJ&&(qJ.name="item"+q_,this.addChild(qJ),q_++)}this.initItems()},qa.addItem=function(qS){qS.name="item"+this._items.length,this.addChild(qS),this.initItems()},qa.initItems=function(){this._items=[];for(var qS=0;qS<1e4;qS++){var q_=this.getChildByName("item"+qS);if(null==q_)break;this._items.push(q_),q_.visible=qS==this._selectedIndex}},qa.setSelect=function(qS,q_){this._items&&-1<qS&&qS<this._items.length&&(this._items[qS].visible=q_)},qa.setIndex=function(qS){this.selectedIndex=qS},qJ(0,qa,"dataSource",qS.prototype._$get_dataSource,function(qS){if("number"==typeof(this._dataSource=qS)&&Math.floor(qS)==qS||"string"==typeof qS)this.selectedIndex=parseInt(qS);else for(var q_ in this._dataSource)this.hasOwnProperty(q_)&&(this[q_]=this._dataSource[q_])}),qJ(0,qa,"selectedIndex",function(){return this._selectedIndex},function(qS){this._selectedIndex!=qS&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=qS,this.setSelect(this._selectedIndex,!0))}),qJ(0,qa,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(qS){this.selectedIndex=this._items.indexOf(qS)}),qJ(0,qa,"items",function(){return this._items}),qJ(0,qa,"setIndexHandler",function(){return this._setIndexHandler},function(qS){this._setIndexHandler=qS}),q_}(qK),q_S=function(qS){function q_(){q_.__super.call(this)}return qV(q_,"laya.ui.VScrollBar",qg),q_}(),qaS=function(q_){function qa(qS){this._bg=null,this._skin=null,qa.__super.call(this),void 0===qS&&(qS=""),this.text=qS,this.skin=this.skin}qV(qa,"laya.ui.TextInput",q_);var qS=qa.prototype;return qS.preinitialize=function(){this.mouseEnabled=!0},qS.destroy=function(qS){qT.clearCache(this,this._skin),void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._bg&&this._bg.destroy(),this._bg=null},qS.createChildren=function(){this.addChild(this._tf=new qG),this._tf.padding=qB.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},qS._onFocus=function(){this.event("focus",this)},qS._onBlur=function(){this.event("blur",this)},qS._onInput=function(){this.event("input",this)},qS._onEnter=function(){this.event("enter",this)},qS.initialize=function(){this.width=128,this.height=22},qS.select=function(){this._tf.select()},qS.setSelection=function(qS,q_){this._tf.setSelection(qS,q_)},qJ(0,qS,"text",q_.prototype._$get_text,function(qS){this._tf.text!=qS&&(qS+="",this._tf.text=qS,this.event("change"))}),qJ(0,qS,"bg",function(){return this._bg},function(qS){this.graphics=this._bg=qS}),qJ(0,qS,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(qS){this._tf.inputElementYAdjuster=qS}),qJ(0,qS,"multiline",function(){return this._tf.multiline},function(qS){this._tf.multiline=qS}),qJ(0,qS,"skin",function(){return this._skin},function(qS){this._skin!=qS&&(qT.clearCache(this,this._skin),this._skin=qS,this._bg||(this.graphics=this._bg=new qX),qT.keepCache(this,this._skin),this._bg.source=qT.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),qJ(0,qS,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(qS){this._bg||(this.graphics=this._bg=new qX),this._bg.sizeGrid=qI.fillArray(qB.defaultSizeGrid,qS,Number)}),qJ(0,qS,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(qS){this._tf.inputElementXAdjuster=qS}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qU,this,"width",qS),this._bg&&(this._bg.width=qS)}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qU,this,"height",qS),this._bg&&(this._bg.height=qS)}),qJ(0,qS,"editable",function(){return this._tf.editable},function(qS){this._tf.editable=qS}),qJ(0,qS,"restrict",function(){return this._tf.restrict},function(qS){this._tf.restrict=qS}),qJ(0,qS,"prompt",function(){return this._tf.prompt},function(qS){this._tf.prompt=qS}),qJ(0,qS,"promptColor",function(){return this._tf.promptColor},function(qS){this._tf.promptColor=qS}),qJ(0,qS,"maxChars",function(){return this._tf.maxChars},function(qS){this._tf.maxChars=qS}),qJ(0,qS,"focus",function(){return this._tf.focus},function(qS){this._tf.focus=qS}),qJ(0,qS,"type",function(){return this._tf.type},function(qS){this._tf.type=qS}),qJ(0,qS,"asPassword",function(){return this._tf.asPassword},function(qS){this._tf.asPassword=qS}),qa}(qU),qRS=function(qS){function q_(){q_.__super.call(this)}return qV(q_,"laya.ui.VSlider",qx),q_}(),qJS=function(qS){function qR(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,qR.__super.call(this)}qV(qR,"laya.ui.Dialog",qS);var q_=qR.prototype;return q_.initialize=function(){this.popupEffect=qR.manager.popupEffectHandler,this.closeEffect=qR.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},q_._dealDragArea=function(){var qS=this.getChildByName("drag");qS&&(this.dragArea=qS.x+","+qS.y+","+qS.width+","+qS.height,qS.removeSelf())},q_._onClick=function(qS){var q_=qS.target;if(q_)switch(q_.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(q_.name)}},q_.show=function(qS,q_){void 0===qS&&(qS=!1),void 0===q_&&(q_=!0),this._open(!1,qS,q_)},q_.popup=function(qS,q_){void 0===qS&&(qS=!1),void 0===q_&&(q_=!0),this._open(!0,qS,q_)},q_._open=function(qS,q_,qa){qR.manager.lock(!1),this.isModal=qS,qR.manager.open(this,q_,qa)},q_.onOpened=function(){},q_.close=function(qS,q_){void 0===q_&&(q_=!0),qR.manager.close(this,qS,q_)},q_.onClosed=function(qS){},q_._onMouseDown=function(qS){var q_=this.getMousePoint();this._dragArea.contains(q_.x,q_.y)?this.startDrag():this.stopDrag()},qJ(0,q_,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(qS){if(qS){var q_=qI.fillArray([0,0,0,0],qS,Number);this._dragArea=new qF(q_[0],q_[1],q_[2],q_[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),qJ(0,q_,"isPopup",function(){return null!=this.parent}),qJ(0,q_,"zOrder",qS.prototype._$get_zOrder,function(qS){qo.superSet(qY,this,"zOrder",qS),qR.manager._checkMask()}),qJ(1,qR,"manager",function(){return qR._manager=qR._manager||new qu},function(qS){qR._manager=qS}),qR.setLockView=function(qS){qR.manager.setLockView(qS)},qR.lock=function(qS){qR.manager.lock(qS)},qR.closeAll=function(){qR.manager.closeAll()},qR.getDialogsByGroup=function(qS){return qR.manager.getDialogsByGroup(qS)},qR.closeByGroup=function(qS){return qR.manager.closeByGroup(qS)},qR.CLOSE="close",qR.CANCEL="cancel",qR.SURE="sure",qR.NO="no",qR.OK="ok",qR.YES="yes",qR._manager=null,qR}(qY),qVS=function(qS){function q_(){q_.__super.call(this)}qV(q_,"laya.ui.HBox",qS);var qa=q_.prototype;return qa.sortItem=function(qS){qS&&qS.sort(function(qS,q_){return qS.x-q_.x})},qa.changeItems=function(){this._itemChanged=!1;for(var qS=[],q_=0,qa=0,qR=this.numChildren;qa<qR;qa++){var qJ=this.getChildAt(qa);qJ&&qJ.layoutEnabled&&(qS.push(qJ),q_=this._height?this._height:Math.max(q_,qJ.height*qJ.scaleY))}this.sortItem(qS);var qV=0;for(qa=0,qR=qS.length;qa<qR;qa++)(qJ=qS[qa]).x=qV,qV+=qJ.width*qJ.scaleX+this._space,"top"==this._align?qJ.y=0:"middle"==this._align?qJ.y=.5*(q_-qJ.height*qJ.scaleY):"bottom"==this._align&&(qJ.y=q_-qJ.height*qJ.scaleY);this.changeSize()},qJ(0,qa,"height",qS.prototype._$get_height,function(qS){this._height!=qS&&(qo.superSet(qZ,this,"height",qS),this.callLater(this.changeItems))}),q_.NONE="none",q_.TOP="top",q_.MIDDLE="middle",q_.BOTTOM="bottom",q_}(qZ),qWS=function(qS){function q_(){q_.__super.call(this)}qV(q_,"laya.ui.VBox",qS);var qa=q_.prototype;return qa.changeItems=function(){this._itemChanged=!1;for(var qS=[],q_=0,qa=0,qR=this.numChildren;qa<qR;qa++){var qJ=this.getChildAt(qa);qJ&&qJ.layoutEnabled&&(qS.push(qJ),q_=this._width?this._width:Math.max(q_,qJ.width*qJ.scaleX))}this.sortItem(qS);var qV=0;for(qa=0,qR=qS.length;qa<qR;qa++)(qJ=qS[qa]).y=qV,qV+=qJ.height*qJ.scaleY+this._space,"left"==this._align?qJ.x=0:"center"==this._align?qJ.x=.5*(q_-qJ.width*qJ.scaleX):"right"==this._align&&(qJ.x=q_-qJ.width*qJ.scaleX);this.changeSize()},qJ(0,qa,"width",qS.prototype._$get_width,function(qS){this._width!=qS&&(qo.superSet(qZ,this,"width",qS),this.callLater(this.changeItems))}),q_.NONE="none",q_.LEFT="left",q_.CENTER="center",q_.RIGHT="right",q_}(qZ),qkS=function(qS){function q_(){q_.__super.call(this)}return qV(q_,"laya.ui.RadioGroup",qw),q_.prototype.createItem=function(qS,q_){return new qv(qS,q_)},q_}(),qzS=function(qS){function q_(){q_.__super.call(this)}return qV(q_,"laya.ui.Tab",qw),q_.prototype.createItem=function(qS,q_){return new qP(qS,q_)},q_}(),qbS=function(q_){function qa(qS){this._vScrollBar=null,this._hScrollBar=null,void 0===qS&&(qS=""),qa.__super.call(this,qS)}qV(qa,"laya.ui.TextArea",q_);var qS=qa.prototype;return qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},qS.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},qS.onVBarChanged=function(qS){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},qS.onHBarChanged=function(qS){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},qS.changeScroll=function(){var qS=this._vScrollBar&&0<this._tf.maxScrollY,q_=this._hScrollBar&&0<this._tf.maxScrollX,qa=qS?this._width-this._vScrollBar.width:this._width,qR=q_?this._height-this._hScrollBar.height:this._height,qJ=this._tf.padding||qB.labelPadding;this._tf.width=qa,this._tf.height=qR,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-qJ[2],this._vScrollBar.y=qJ[1],this._vScrollBar.height=this._height-(q_?this._hScrollBar.height:0)-qJ[1]-qJ[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=qR/Math.max(this._tf.textHeight,qR),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=qS),this._hScrollBar&&(this._hScrollBar.x=qJ[0],this._hScrollBar.y=this._height-this._hScrollBar.height-qJ[3],this._hScrollBar.width=this._width-(qS?this._vScrollBar.width:0)-qJ[0]-qJ[2],this._hScrollBar.scrollSize=Math.max(.033*qa,1),this._hScrollBar.thumbPercent=qa/Math.max(this._tf.textWidth,qa),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=q_)},qS.scrollTo=function(qS){this.commitMeasure(),this._tf.scrollY=qS},qJ(0,qS,"scrollY",function(){return this._tf.scrollY}),qJ(0,qS,"width",q_.prototype._$get_width,function(qS){qo.superSet(qaS,this,"width",qS),this.callLater(this.changeScroll)}),qJ(0,qS,"hScrollBar",function(){return this._hScrollBar}),qJ(0,qS,"height",q_.prototype._$get_height,function(qS){qo.superSet(qaS,this,"height",qS),this.callLater(this.changeScroll)}),qJ(0,qS,"maxScrollX",function(){return this._tf.maxScrollX}),qJ(0,qS,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(qS){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new q_S),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=qS}),qJ(0,qS,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(qS){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new qy),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=qS}),qJ(0,qS,"vScrollBar",function(){return this._vScrollBar}),qJ(0,qS,"maxScrollY",function(){return this._tf.maxScrollY}),qJ(0,qS,"scrollX",function(){return this._tf.scrollX}),qa}(qaS);!function(qS){function q_(){this._uiView=null,this.isCloseOther=!1,q_.__super.call(this)}qV(q_,"laya.ui.AsynDialog",qJS);var qa=q_.prototype;qa.createView=function(qS){this._uiView=qS},qa._open=function(qS,q_,qa){this.isModal=qS,this.isCloseOther=q_,qJS.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},qa.onCreated=function(){this.createUI(),this.onOpen()},qa.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},qa.onOpen=function(){qJS.manager.open(this,this.isCloseOther),qJS.manager.lock(!1)},qa.close=function(qS,q_){void 0===q_&&(q_=!0),qJS.manager.close(this),this.onClose()},qa.onClose=function(){},qa.destroy=function(qS){void 0===qS&&(qS=!0),laya.ui.View.prototype.destroy.call(this,qS),this._uiView=null,this.onDestroy()},qa.onDestroy=function(){}}();qo.__init([qY])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}}),function(qC,qS,qQ){qQ.un,qQ.uns;var qL=qQ.static,qG=qQ.class,qt=qQ.getset,qR=qQ.__newvec,qj=laya.maths.Arith,qW=laya.webgl.atlas.AtlasResourceManager,qa=laya.webgl.shader.BaseShader,qh=laya.utils.Browser,qk=laya.webgl.utils.Buffer,qm=laya.utils.Byte,qJ=laya.utils.ClassUtils,qz=qQ.Config,qV=(laya.events.Event,laya.events.EventDispatcher),qB=laya.utils.Handler,qF=laya.net.Loader,q_=laya.net.LoaderManager,qb=(laya.maths.MathUtil,laya.display.Node),qo=laya.renders.Render,qH=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),q$=laya.resource.Resource,qT=laya.utils.RunDriver,qD=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),qq=laya.display.Sprite,qN=laya.utils.Stat,qn=laya.utils.StringKey,qI=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),ql=laya.utils.Utils,qA=laya.webgl.WebGL,qX=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;qQ.interface("laya.d3.core.IClone"),qQ.interface("laya.d3.graphics.IVertex"),qQ.interface("laya.d3.core.render.IUpdate"),qQ.interface("laya.d3.core.scene.ITreeNode"),qQ.interface("laya.d3.core.render.IRenderable");(function(){function qP(){}qG(qP,"laya.d3.animation.AnimationClipParser01"),qP.READ_DATA=function(){qP._DATA.offset=qP._reader.getUint32(),qP._DATA.size=qP._reader.getUint32()},qP.READ_BLOCK=function(){for(var qS=qP._BLOCK.count=qP._reader.getUint16(),q_=qP._BLOCK.blockStarts=[],qa=qP._BLOCK.blockLengths=[],qR=0;qR<qS;qR++)q_.push(qP._reader.getUint32()),qa.push(qP._reader.getUint32())},qP.READ_STRINGS=function(){var qS=qP._reader.getUint32(),q_=qP._reader.getUint16(),qa=qP._reader.pos;qP._reader.pos=qS+qP._DATA.offset;for(var qR=0;qR<q_;qR++)qP._strings[qR]=qP._reader.readUTFString();qP._reader.pos=qa},qP.parse=function(qS,q_){qP._animationClip=qS;(qP._reader=q_).__getBuffer();qP.READ_DATA(),qP.READ_BLOCK(),qP.READ_STRINGS();for(var qa=0,qR=qP._BLOCK.count;qa<qR;qa++){var qJ=q_.getUint16(),qV=qP._strings[qJ],qW=qP["READ_"+qV];if(null==qW)throw new Error("model file err,no this function:"+qJ+" "+qV);qW.call()}},qP.READ_ANIMATIONS=function(){var qS,q_=0,qa=0,qR=qP._reader,qJ=qR.__getBuffer(),qV=[],qW=qR.getUint8();for(qV.length=qW,q_=0;q_<qW;q_++)qV[q_]=qR.getUint16();var qk=[],qz=qR.getUint16();for(qk.length=qz,q_=0;q_<qz;q_++)qk[q_]=qR.getFloat32();var qb=qP._animationClip;qb.name=qP._strings[qR.getUint16()];var qH=qb._duration=qR.getFloat32();qb.islooping=!!qR.getByte(),qb._frameRate=qR.getInt16();var qL=qR.getInt16(),qC=qb._nodes=new Array;qC.length=qL,(qb._publicClipDatas=[]).length=qL;var qG=qb._nodesMap={},qt=0,qo=0;for(q_=0;q_<qL;q_++){qS=qC[q_]=new qf;var q$=qR.getUint16(),qF=qS.path=[];for(qF.length=q$,qa=0;qa<q$;qa++)qF[qa]=qP._strings[qR.getUint16()];var qT=qF.join("/"),qD=qG[qT];qD||(qG[qT]=qD=[]),qD.push(qS);var qj=qR.getInt16();-1!==qj&&(qS.componentType=qP._strings[qj]);var qQ=qs._propertyIndexDic[qP._strings[qR.getUint16()]];if(null==qQ)throw new Error("AnimationClipParser01:unknown property name.");var qm=qQ<4,qq=!qm||qm&&""===qF[0];(qS._cacheProperty=qq)?qt++:qo++,qS.propertyNameID=qQ;var qN=qV[qR.getUint8()];qS.keyFrameWidth=qN/4;var qn=qS.keyFrames=[],ql=qn.length=qR.getUint16(),qB=null,qI=NaN;for(qa=0;qa<ql;qa++){var qA=qn[qa]=new qU;qI=qA.startTime=qk[qR.getUint16()];var qX=qR.pos;qA.inTangent=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qX=qR.pos,qA.outTangent=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qX=qR.pos,qA.data=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qB&&(qB.next=qA,qB.duration=qI-qB.startTime),qB=qA}qA.next=null,qA.duration=qH-qI}var qh=qb._nodeToCachePropertyMap=new Int32Array(qL),qu=qb._cachePropertyMap=new Int32Array(qt),qK=qb._unCachePropertyMap=new Int32Array(qo);for(qt=qo=0,q_=0;q_<qL;q_++)(qS=qC[q_])._cacheProperty?(qh[q_]=qt,qu[qt++]=q_):qK[qo++]=q_},qP._animationClip=null,qP._reader=null,qP._strings=[],qL(qP,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function qg(){}qG(qg,"laya.d3.animation.AnimationClipParser02"),qg.READ_DATA=function(){qg._DATA.offset=qg._reader.getUint32(),qg._DATA.size=qg._reader.getUint32()},qg.READ_BLOCK=function(){for(var qS=qg._BLOCK.count=qg._reader.getUint16(),q_=qg._BLOCK.blockStarts=[],qa=qg._BLOCK.blockLengths=[],qR=0;qR<qS;qR++)q_.push(qg._reader.getUint32()),qa.push(qg._reader.getUint32())},qg.READ_STRINGS=function(){var qS=qg._reader.getUint32(),q_=qg._reader.getUint16(),qa=qg._reader.pos;qg._reader.pos=qS+qg._DATA.offset;for(var qR=0;qR<q_;qR++)qg._strings[qR]=qg._reader.readUTFString();qg._reader.pos=qa},qg.parse=function(qS,q_){qg._animationClip=qS;(qg._reader=q_).__getBuffer();qg.READ_DATA(),qg.READ_BLOCK(),qg.READ_STRINGS();for(var qa=0,qR=qg._BLOCK.count;qa<qR;qa++){var qJ=q_.getUint16(),qV=qg._strings[qJ],qW=qg["READ_"+qV];if(null==qW)throw new Error("model file err,no this function:"+qJ+" "+qV);qW.call()}},qg.READ_ANIMATIONS=function(){var qS,q_=0,qa=0,qR=qg._reader,qJ=qR.__getBuffer(),qV=[],qW=qR.getUint8();for(qV.length=qW,q_=0;q_<qW;q_++)qV[q_]=qR.getUint16();var qk=[],qz=qR.getUint16();for(qk.length=qz,q_=0;q_<qz;q_++)qk[q_]=qR.getFloat32();var qb=qg._animationClip;qb.name=qg._strings[qR.getUint16()];var qH=qb._duration=qR.getFloat32();qb.islooping=!!qR.getByte(),qb._frameRate=qR.getInt16();var qL=qR.getInt16(),qC=qb._nodes=new Array;qC.length=qL,(qb._publicClipDatas=[]).length=qL;var qG=qb._nodesMap={},qt=0,qo=0;for(q_=0;q_<qL;q_++){qS=qC[q_]=new qf;var q$=qR.getUint16(),qF=qS.path=[];for(qF.length=q$,qa=0;qa<q$;qa++)qF[qa]=qg._strings[qR.getUint16()];var qT=qF.join("/"),qD=qG[qT];qD||(qG[qT]=qD=[]),qD.push(qS);var qj=qR.getInt16();-1!==qj&&(qS.componentType=qg._strings[qj]);var qQ=qs._propertyIndexDic[qg._strings[qR.getUint16()]];if(null==qQ)throw new Error("AnimationClipParser02:unknown property name.");var qm=qQ<4,qq=!qm||qm&&""===qF[0];(qS._cacheProperty=qq)?qt++:qo++,qS.propertyNameID=qQ;var qN=qV[qR.getUint8()];qS.keyFrameWidth=qN/4;var qn=qS.keyFrames=[],ql=qn.length=qR.getUint16(),qB=null,qI=NaN;for(qa=0;qa<ql;qa++){var qA=qn[qa]=new qU;qI=qA.startTime=qk[qR.getUint16()];var qX=qR.pos;qA.inTangent=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qX=qR.pos,qA.outTangent=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qX=qR.pos,qA.data=new Float32Array(qJ.slice(qX,qX+qN)),qR.pos+=qN,qB&&(qB.next=qA,qB.duration=qI-qB.startTime),qB=qA}qA.next=null,qA.duration=qH-qI}var qh=qR.getUint16();for(q_=0;q_<qh;q_++){var qu,qK=new qx;qK.time=qR.getFloat32(),qK.eventName=qg._strings[qR.getUint16()];var qP=qR.getUint16();for(0<qP&&(qK.params=qu=[]),qa=0;qa<qP;qa++){switch(qR.getByte()){case 0:qu.push(!!qR.getByte());break;case 1:qu.push(qR.getInt32());break;case 2:qu.push(qR.getFloat32());break;case 3:qu.push(qg._strings[qR.getUint16()]);break;default:throw new Error("unknown type.")}}qb.addEvent(qK)}var qM=qb._nodeToCachePropertyMap=new Int32Array(qL),qr=qb._cachePropertyMap=new Int32Array(qt),qe=qb._unCachePropertyMap=new Int32Array(qo);for(qt=qo=0,q_=0;q_<qL;q_++)(qS=qC[q_])._cacheProperty?(qM[q_]=qt,qr[qt++]=q_):qe[qo++]=q_},qg._animationClip=null,qg._reader=null,qg._strings=[],qL(qg,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var qx=function(){function qS(){this.time=NaN,this.eventName=null,this.params=null}return qG(qS,"laya.d3.animation.AnimationEvent"),qS}(),qs=function(){function qR(){this._childs=[],this.transform=new qT_(this)}qG(qR,"laya.d3.animation.AnimationNode");var qS=qR.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.addChild=function(qS){qS._parent=this,qS.transform.setParent(this.transform),this._childs.push(qS)},qS.removeChild=function(qS){var q_=this._childs.indexOf(qS);-1!==q_&&this._childs.splice(q_,1)},qS.getChildByName=function(qS){for(var q_=0,qa=this._childs.length;q_<qa;q_++){var qR=this._childs[q_];if(qR.name===qS)return qR}return null},qS.getChildByIndex=function(qS){return this._childs[qS]},qS.getChildCount=function(){return this._childs.length},qS.cloneTo=function(qS){var q_=qS;q_.name=this.name;for(var qa=0,qR=this._childs.length;qa<qR;qa++){var qJ=this._childs[qa],qV=qJ.clone();q_.addChild(qV);var qW=qJ.transform,qk=qV.transform;qk.setLocalPosition(qW.getLocalPosition()),qk.setLocalRotation(qW.getLocalRotation()),qk.setLocalScale(qW.getLocalScale()),qk._localRotationEuler=qW._localRotationEuler,qk._setWorldMatrixIgnoreUpdate(qW.getWorldMatrix())}},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qR.__init__=function(){qR.registerAnimationNodeProperty("localPosition",qR._getLocalPosition,qR._setLocalPosition),qR.registerAnimationNodeProperty("localRotation",qR._getLocalRotation,qR._setLocalRotation),qR.registerAnimationNodeProperty("localScale",qR._getLocalScale,qR._setLocalScale),qR.registerAnimationNodeProperty("localRotationEuler",qR._getLocalRotationEuler,qR._setLocalRotationEuler),qR.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",qR._getParticleRenderSharedMaterialTintColor,qR._setParticleRenderSharedMaterialTintColor),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",qR._getMeshRenderSharedMaterialTilingOffset,qR._setMeshRenderSharedMaterialTilingOffset),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",qR._getMeshRenderSharedMaterialAlbedo,qR._setMeshRenderSharedMaterialAlbedo),qR.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",qR._getSkinnedMeshRenderSharedMaterialTilingOffset,qR._setSkinnedMeshRenderSharedMaterialTilingOffset),qR.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",qR._getSkinnedMeshRenderSharedMaterialAlbedo,qR._setSkinnedMeshRenderSharedMaterialAlbedo),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",qR._getMeshRenderSharedMaterialAlbedo,qR._setMeshRenderSharedMaterialAlbedo),qR.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",qR._getSkinnedMeshRenderSharedMaterialAlbedo,qR._setSkinnedMeshRenderSharedMaterialAlbedo),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",qR._getMeshRenderSharedMaterialIntensity,qR._setMeshRenderSharedMaterialIntensity),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",qR._getMeshRenderSharedMaterialAlpha,qR._setMeshRenderSharedMaterialAlpha),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",qR._getMeshRenderSharedMaterialAlphaColor,qR._setMeshRenderSharedMaterialAlphaColor),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",qR._getMeshRenderSharedMaterialBaseColor,qR._setMeshRenderSharedMaterialBaseColor),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",qR._getMeshRenderSharedMaterialDissolve,qR._setMeshRenderSharedMaterialDissolve),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",qR._getMeshRenderSharedMaterialDissolveSpeed,qR._setMeshRenderSharedMaterialDissolveSpeed),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",qR._getMeshRenderSharedMaterialMMultiplier,qR._setMeshRenderSharedMaterialMMultiplier),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",qR._getMeshRenderSharedMaterialBaseScrollSpeedX,qR._setMeshRenderSharedMaterialBaseScrollSpeedX),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",qR._getMeshRenderSharedMaterialBaseScrollSpeedY,qR._setMeshRenderSharedMaterialBaseScrollSpeedY),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",qR._getMeshRenderSharedMaterialSecondScrollSpeedX,qR._setMeshRenderSharedMaterialSecondScrollSpeedX),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",qR._getMeshRenderSharedMaterialSecondScrollSpeedY,qR._setMeshRenderSharedMaterialSecondScrollSpeedY),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",qR._getMeshRenderSharedMaterialDetailTilingOffset,qR._setMeshRenderSharedMaterialDetailTilingOffset),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",qR._getMeshRenderSharedMaterialDissolveTilingOffset,qR._setMeshRenderSharedMaterialDissolveTilingOffset),qR.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",qR._getMeshRenderSharedMaterialMaskTilingOffset,qR._setMeshRenderSharedMaterialMaskTilingOffset)},qR.registerAnimationNodeProperty=function(qS,q_,qa){if(qR._propertyIndexDic[qS])throw new Error("AnimationNode: this propertyName has registered.");qR._propertyIndexDic[qS]=qR._propertyIDCounter,qR._propertyGetFuncs[qR._propertyIDCounter]=q_,qR._propertySetFuncs[qR._propertyIDCounter]=qa,qR._propertyIDCounter++},qR._getLocalPosition=function(qS,q_){return qS?qS.transform.getLocalPosition():q_._transform.localPosition.elements},qR._setLocalPosition=function(qS,q_,qa){if(qS)qS.transform.setLocalPosition(qa);else{var qR=q_._transform,qJ=qR.localPosition;qJ.elements=qa,qR.localPosition=qJ}},qR._getLocalRotation=function(qS,q_){return qS?qS.transform.getLocalRotation():q_._transform.localRotation.elements},qR._setLocalRotation=function(qS,q_,qa){if(qS)qS.transform.setLocalRotation(qa);else{var qR=q_._transform,qJ=qR.localRotation;qJ.elements=qa,qR.localRotation=qJ}},qR._getLocalScale=function(qS,q_){return qS?qS.transform.getLocalScale():q_._transform.localScale.elements},qR._setLocalScale=function(qS,q_,qa){if(qS)qS.transform.setLocalScale(qa);else{var qR=q_._transform,qJ=qR.localScale;qJ.elements=qa,qR.localScale=qJ}},qR._getLocalRotationEuler=function(qS,q_){return qS?qS.transform.getLocalRotationEuler():q_._transform.localRotationEuler.elements},qR._setLocalRotationEuler=function(qS,q_,qa){if(qS)qS.transform.setLocalRotationEuler(qa);else{var qR=q_._transform,qJ=qR.localRotationEuler;qJ.elements=qa,qR.localRotationEuler=qJ}},qR._getMeshRenderSharedMaterialTilingOffset=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return q_.meshRender.sharedMaterial.tilingOffset.elements},qR._setMeshRenderSharedMaterialTilingOffset=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).tilingOffset).elements=qa,qR.tilingOffset=qJ)}else(qJ=(qR=q_.meshRender.material).tilingOffset).elements=qa,qR.tilingOffset=qJ},qR._getMeshRenderSharedMaterialAlbedo=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.albedoColor.elements:null}return q_.meshRender.sharedMaterial.albedoColor.elements},qR._setMeshRenderSharedMaterialAlbedo=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).albedoColor).elements=qa,qR.albedoColor=qJ)}else(qJ=(qR=q_.meshRender.material).albedoColor).elements=qa,qR.albedoColor=qJ},qR._getSkinnedMeshRenderSharedMaterialTilingOffset=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return q_.skinnedMeshRender.sharedMaterial.tilingOffset.elements},qR._setSkinnedMeshRenderSharedMaterialTilingOffset=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.skinnedMeshRender.material).tilingOffset).elements=qa,qR.tilingOffset=qJ)}else(qJ=(qR=q_.skinnedMeshRender.material).tilingOffset).elements=qa,qR.tilingOffset=qJ},qR._getSkinnedMeshRenderSharedMaterialAlbedo=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return q_.skinnedMeshRender.sharedMaterial.albedoColor.elements},qR._setSkinnedMeshRenderSharedMaterialAlbedo=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.skinnedMeshRender.material).albedoColor).elements=qa,qR.albedoColor=qJ)}else(qJ=(qR=q_.skinnedMeshRender.material).albedoColor).elements=qa,qR.albedoColor=qJ},qR._getParticleRenderSharedMaterialTintColor=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.particleRender.sharedMaterial.tintColor.elements:null}return q_.particleRender.sharedMaterial.tintColor.elements},qR._setParticleRenderSharedMaterialTintColor=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.particleRender.material).tintColor).elements=qa,qR.tintColor=qJ)}else(qJ=(qR=q_.particleRender.material).tintColor).elements=qa,qR.tintColor=qJ},qR._getMeshRenderSharedMaterialAlphaColor=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.alphaColor.elements:null}return q_.meshRender.sharedMaterial.alphaColor.elements},qR._setMeshRenderSharedMaterialAlphaColor=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).alphaColor).elements=qa,qR.alphaColor=qJ)}else(qJ=(qR=q_.meshRender.material).alphaColor).elements=qa,qR.alphaColor=qJ},qR._getMeshRenderSharedMaterialBaseColor=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.baseColor.elements:null}return q_.meshRender.sharedMaterial.baseColor.elements},qR._setMeshRenderSharedMaterialBaseColor=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).baseColor).elements=qa,qR.baseColor=qJ)}else(qJ=(qR=q_.meshRender.material).baseColor).elements=qa,qR.baseColor=qJ},qR._getMeshRenderSharedMaterialDissolve=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.dissolve:0}return q_.meshRender.sharedMaterial.dissolve},qR._setMeshRenderSharedMaterialDissolve=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.dissolve=qa[0])}else q_.meshRender.material.dissolve=qa[0]},qR._getMeshRenderSharedMaterialDissolveSpeed=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.dissolveSpeed:0}return q_.meshRender.sharedMaterial.dissolveSpeed},qR._setMeshRenderSharedMaterialDissolveSpeed=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.dissolveSpeed=qa[0])}else q_.meshRender.material.dissolveSpeed=qa[0]},qR._getMeshRenderSharedMaterialMMultiplier=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.mMultiplier:0}return q_.meshRender.sharedMaterial.mMultiplier},qR._setMeshRenderSharedMaterialMMultiplier=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.mMultiplier=qa[0])}else q_.meshRender.material.mMultiplier=qa[0]},qR._getMeshRenderSharedMaterialBaseScrollSpeedX=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return q_.meshRender.sharedMaterial.baseScrollSpeedX},qR._setMeshRenderSharedMaterialBaseScrollSpeedX=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.baseScrollSpeedX=qa[0])}else q_.meshRender.material.baseScrollSpeedX=qa[0]},qR._getMeshRenderSharedMaterialBaseScrollSpeedY=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return q_.meshRender.sharedMaterial.baseScrollSpeedY},qR._setMeshRenderSharedMaterialBaseScrollSpeedY=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.baseScrollSpeedY=qa[0])}else q_.meshRender.material.baseScrollSpeedY=qa[0]},qR._getMeshRenderSharedMaterialSecondScrollSpeedX=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return q_.meshRender.sharedMaterial.secondScrollSpeedX},qR._setMeshRenderSharedMaterialSecondScrollSpeedX=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.secondScrollSpeedX=qa[0])}else q_.meshRender.material.secondScrollSpeedX=qa[0]},qR._getMeshRenderSharedMaterialSecondScrollSpeedY=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return q_.meshRender.sharedMaterial.secondScrollSpeedY},qR._setMeshRenderSharedMaterialSecondScrollSpeedY=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.secondScrollSpeedY=qa[0])}else q_.meshRender.material.secondScrollSpeedY=qa[0]},qR._getMeshRenderSharedMaterialAlpha=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.alpha:0}return q_.meshRender.sharedMaterial.alpha},qR._setMeshRenderSharedMaterialAlpha=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.alpha=qa[0])}else q_.meshRender.material.alpha=qa[0]},qR._getMeshRenderSharedMaterialIntensity=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.intensity:0}return q_.meshRender.sharedMaterial.intensity},qR._setMeshRenderSharedMaterialIntensity=function(qS,q_,qa){if(qS){var qR=qS.transform._entity;qR&&(qR.owner.meshRender.material.intensity=qa[0])}else q_.meshRender.material.intensity=qa[0]},qR._getMeshRenderSharedMaterialDetailTilingOffset=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return q_.meshRender.sharedMaterial.detailTilingOffset.elements},qR._setMeshRenderSharedMaterialDetailTilingOffset=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).detailTilingOffset).elements=qa,qR.detailTilingOffset=qJ)}else(qJ=(qR=q_.meshRender.material).detailTilingOffset).elements=qa,qR.detailTilingOffset=qJ},qR._getMeshRenderSharedMaterialDissolveTilingOffset=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return q_.meshRender.sharedMaterial.dissolveTilingOffset.elements},qR._setMeshRenderSharedMaterialDissolveTilingOffset=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).dissolveTilingOffset).elements=qa,qR.dissolveTilingOffset=qJ)}else(qJ=(qR=q_.meshRender.material).dissolveTilingOffset).elements=qa,qR.dissolveTilingOffset=qJ},qR._getMeshRenderSharedMaterialMaskTilingOffset=function(qS,q_){if(qS){var qa=qS.transform._entity;return qa?qa.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return q_.meshRender.sharedMaterial.maskTilingOffset.elements},qR._setMeshRenderSharedMaterialMaskTilingOffset=function(qS,q_,qa){var qR,qJ;if(qS){var qV=qS.transform._entity;qV&&((qJ=(qR=qV.owner.meshRender.material).maskTilingOffset).elements=qa,qR.maskTilingOffset=qJ)}else(qJ=(qR=q_.meshRender.material).maskTilingOffset).elements=qa,qR.maskTilingOffset=qJ},qR._propertyIDCounter=0,qR._propertyIndexDic={},qR._propertySetFuncs=[],qR._propertyGetFuncs=[],qR}(),qU=function(){function qS(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return qG(qS,"laya.d3.animation.Keyframe"),qS}(),qf=function(){function qS(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return qG(qS,"laya.d3.animation.KeyframeNode"),qS}(),qu=(function(){function qS(){this._tempVector30=new qW_,this._tempVector31=new qW_,this._tempVector32=new qW_,this._a=new qW_,this._b=new qW_,this._c=new qW_,this._d=new qW_}qG(qS,"laya.d3.core.glitter.SplineCurvePositionVelocity");var q_=qS.prototype;q_.Init=function(qS,q_,qa,qR){qS.cloneTo(this._d),q_.cloneTo(this._c),qW_.scale(qS,2,this._a),qW_.scale(qa,2,this._tempVector30),qW_.subtract(this._a,this._tempVector30,this._a),qW_.add(this._a,q_,this._a),qW_.add(this._a,qR,this._a),qW_.scale(qa,3,this._b),qW_.scale(qS,3,this._tempVector30),qW_.subtract(this._b,this._tempVector30,this._b),qW_.subtract(this._b,qR,this._b),qW_.scale(q_,2,this._tempVector30),qW_.subtract(this._b,this._tempVector30,this._b)},q_.Slerp=function(qS,q_){qW_.scale(this._a,qS*qS*qS,this._tempVector30),qW_.scale(this._b,qS*qS,this._tempVector31),qW_.scale(this._c,qS,this._tempVector32),qW_.add(this._tempVector30,this._tempVector31,q_),qW_.add(q_,this._tempVector32,q_),qW_.add(q_,this._d,q_)}}(),function(){function qr(qS,q_,qa,qR){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=qS,this._h=q_,this._minHeight=qa,this._maxHeight=qR}qG(qr,"laya.d3.core.HeightMap");var qS=qr.prototype;qS._inBounds=function(qS,q_){return 0<=qS&&qS<this._h&&0<=q_&&q_<this._w},qS.getHeight=function(qS,q_){return this._inBounds(qS,q_)?this._datas[qS][q_]:NaN},qt(0,qS,"width",function(){return this._w}),qt(0,qS,"height",function(){return this._h}),qt(0,qS,"maxHeight",function(){return this._maxHeight}),qt(0,qS,"minHeight",function(){return this._minHeight}),qr.creatFromMesh=function(qS,q_,qa,qR){for(var qJ=[],qV=[],qW=qS.getSubMeshCount(),qk=0;qk<qW;qk++){for(var qz=qS.getSubMesh(qk),qb=qz._getVertexBuffer(),qH=qb.getData(),qL=[],qC=0;qC<qH.length;qC+=qb.vertexDeclaration.vertexStride/4){var qG=new qW_(qH[qC+0],qH[qC+1],qH[qC+2]);qL.push(qG)}qJ.push(qL);var qt=qz._getIndexBuffer();qV.push(qt.getData())}var qo=qS.boundingBox,q$=qo.min.x,qF=qo.min.z,qT=qo.max.x,qD=qo.max.z,qj=qo.min.y,qQ=qo.max.y,qm=qT-q$,qq=qD-qF,qN=qR.elements[0]=qm/(q_-1),qn=qR.elements[1]=qq/(qa-1),ql=new qr(q_,qa,qj,qQ),qB=qr._tempRay,qI=qB.direction.elements;qI[0]=0,qI[1]=-1,qI[2]=0;var qA=qQ+.1;qB.origin.elements[1]=qA;for(var qX=0;qX<qa;qX++){var qh=qF+qX*qn;ql._datas[qX]=[];for(var qu=0;qu<q_;qu++){var qK=q$+qu*qN,qP=qB.origin.elements;qP[0]=qK,qP[2]=qh;var qM=qr._getPosition(qB,qJ,qV);ql._datas[qX][qu]=qM===Number.MAX_VALUE?NaN:qA-qM}}return ql},qr.createFromImage=function(qS,q_,qa){for(var qR=qS.width,qJ=qS.height,qV=new qr(qR,qJ,q_,qa),qW=(qa-q_)/254,qk=qS.getPixels(),qz=0,qb=0;qb<qJ;qb++)for(var qH=qV._datas[qb]=[],qL=0;qL<qR;qL++){var qC=qk[qz++],qG=qk[qz++],qt=qk[qz++],qo=qk[qz++];qH[qL]=255==qC&&255==qG&&255==qt&&255==qo?NaN:(qC+qG+qt)/3*qW+q_}return qV},qr._getPosition=function(qS,q_,qa){for(var qR=Number.MAX_VALUE,qJ=0;qJ<q_.length;qJ++)for(var qV=q_[qJ],qW=qa[qJ],qk=0;qk<qW.length;qk+=3){var qz=qV[qW[qk+0]],qb=qV[qW[qk+1]],qH=qV[qW[qk+2]],qL=qt_.rayIntersectsTriangle(qS,qz,qb,qH);!isNaN(qL)&&qL<qR&&(qR=qL)}return qR},qL(qr,["_tempRay",function(){return this._tempRay=new qJ_(new qW_,new qW_)}])}(),function(){function qJ(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}qG(qJ,"laya.d3.core.Layer");var qS=qJ.prototype;return qS._binarySearchIndex=function(){for(var qS=0,q_=qJ._collsionTestList.length-1,qa=0;qS<=q_;){qa=Math.floor((qS+q_)/2);var qR=qJ._collsionTestList[qa];if(qR==this._number)return qa;qR>this._number?q_=qa-1:qS=qa+1}return qS},qS._addCollider=function(qS){0===this._colliders.length&&qJ._collsionTestList.splice(this._binarySearchIndex(),0,this._number),qS._isRigidbody?(this._colliders.unshift(qS),this._nonRigidbodyOffset++):this._colliders.push(qS)},qS._removeCollider=function(qS){var q_=this._colliders.indexOf(qS);q_<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(q_,1),0===this._colliders.length&&qJ._collsionTestList.splice(qJ._collsionTestList.indexOf(this._number),1)},qt(0,qS,"number",function(){return this._number}),qt(0,qS,"visible",function(){return this._visible},function(qS){this._visible=qS,qJ._visibleLayers=qS?qJ._visibleLayers|this.mask:qJ._visibleLayers&~this.mask}),qt(0,qS,"mask",function(){return this._mask}),qt(1,qJ,"visibleLayers",function(){return qJ._visibleLayers},function(qS){qJ._visibleLayers=qS;for(var q_=0,qa=qJ._layerList.length;q_<qa;q_++){var qR=qJ._layerList[q_];qR._visible=0!=(qR._mask&qJ._visibleLayers)}}),qJ.__init__=function(){qJ._layerList.length=31;for(var qS=0;qS<31;qS++){var q_=new qJ;qJ._layerList[qS]=q_,0===qS?(q_.name="Default Layer",q_.visible=!0):(q_.name="Layer-"+qS,q_.visible=!1),q_._number=qS,q_._mask=Math.pow(2,qS)}qJ.currentCreationLayer=qJ._layerList[0]},qJ.getLayerByNumber=function(qS){if(qS<0||30<qS)throw new Error("无法返回指定Layer，该number超出范围！");return qJ._layerList[qS]},qJ.getLayerByName=function(qS){for(var q_=0;q_<31;q_++)if(qJ._layerList[q_].name===qS)return qJ._layerList[q_];throw new Error("无法返回指定Layer,该name不存在")},qJ.isVisible=function(qS){return 0!=(qS&qJ._currentCameraCullingMask&qJ._visibleLayers)},qJ._layerList=[],qJ._visibleLayers=2147483647,qJ._collsionTestList=[],qJ._currentCameraCullingMask=2147483647,qJ.maxCount=31,qJ.currentCreationLayer=null,qJ}()),qK=(function(){function qS(qS,q_,qa){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=qS,this._minCount=q_,this._maxCount=qa}qG(qS,"laya.d3.core.particleShuriKen.module.Burst");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.cloneTo=function(qS){var q_=qS;q_._time=this._time,q_._minCount=this._minCount,q_._maxCount=this._maxCount},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"time",function(){return this._time}),qt(0,q_,"minCount",function(){return this._minCount}),qt(0,q_,"maxCount",function(){return this._maxCount})}(),function(){function qS(qS){this._color=null,this.enbale=!1,this._color=qS}qG(qS,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var q_=qS.prototype;q_.cloneTo=function(qS){var q_=qS;this._color.cloneTo(q_._color),q_.enbale=this.enbale},q_.clone=function(){var qS;switch(this._color.type){case 0:qS=qM.createByConstant(this._color.constant.clone());break;case 1:qS=qM.createByGradient(this._color.gradient.clone());break;case 2:qS=qM.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:qS=qM.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var q_=new this.constructor(qS);return q_.enbale=this.enbale,q_},qt(0,q_,"color",function(){return this._color})}(),function(){function qS(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}qG(qS,"laya.d3.core.particleShuriKen.module.Emission");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),q_._destroy=function(){this._bursts=null,this._destroyed=!0},q_.getBurstsCount=function(){return this._bursts.length},q_.getBurstByIndex=function(qS){return this._bursts[qS]},q_.addBurst=function(qS){var q_=this._bursts.length;if(0<q_)for(var qa=0;qa<q_;qa++)this._bursts[qa].time>qS.time&&this._bursts.splice(qa,0,qS);this._bursts.push(qS)},q_.removeBurst=function(qS){var q_=this._bursts.indexOf(qS);-1!==q_&&this._bursts.splice(q_,1)},q_.removeBurstByIndex=function(qS){this._bursts.splice(qS,1)},q_.clearBurst=function(){this._bursts.length=0},q_.cloneTo=function(qS){var q_=qS,qa=q_._bursts;qa.length=this._bursts.length;for(var qR=0,qJ=this._bursts.length;qR<qJ;qR++){var qV=qa[qR];qV?this._bursts[qR].cloneTo(qV):qa[qR]=this._bursts[qR].clone()}q_._emissionRate=this._emissionRate,q_.enbale=this.enbale},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"destroyed",function(){return this._destroyed}),qt(0,q_,"emissionRate",function(){return this._emissionRate},function(qS){if(qS<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=qS})}(),function(){function qR(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}qG(qR,"laya.d3.core.particleShuriKen.module.FrameOverTime");var qS=qR.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,q_._constant=this._constant,this._overTime.cloneTo(q_._overTime),q_._constantMin=this._constantMin,q_._constantMax=this._constantMax,this._overTimeMin.cloneTo(q_._overTimeMin),this._overTimeMax.cloneTo(q_._overTimeMax)},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"frameOverTimeData",function(){return this._overTime}),qt(0,qS,"constant",function(){return this._constant}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"frameOverTimeDataMin",function(){return this._overTimeMin}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"frameOverTimeDataMax",function(){return this._overTimeMax}),qt(0,qS,"constantMax",function(){return this._constantMax}),qR.createByConstant=function(qS){var q_=new qR;return q_._type=0,q_._constant=qS,q_},qR.createByOverTime=function(qS){var q_=new qR;return q_._type=1,q_._overTime=qS,q_},qR.createByRandomTwoConstant=function(qS,q_){var qa=new qR;return qa._type=2,qa._constantMin=qS,qa._constantMax=q_,qa},qR.createByRandomTwoOverTime=function(qS,q_){var qa=new qR;return qa._type=3,qa._overTimeMin=qS,qa._overTimeMax=q_,qa},qR}()),qP=function(){function qb(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}qG(qb,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var qS=qb.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,q_._separateAxes=this._separateAxes,q_._constant=this._constant,this._constantSeparate.cloneTo(q_._constantSeparate),this._gradient.cloneTo(q_._gradient),this._gradientX.cloneTo(q_._gradientX),this._gradientY.cloneTo(q_._gradientY),this._gradientZ.cloneTo(q_._gradientZ),q_._constantMin=this._constantMin,q_._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(q_._constantMinSeparate),this._constantMaxSeparate.cloneTo(q_._constantMaxSeparate),this._gradientMin.cloneTo(q_._gradientMin),this._gradientMax.cloneTo(q_._gradientMax),this._gradientXMin.cloneTo(q_._gradientXMin),this._gradientXMax.cloneTo(q_._gradientXMax),this._gradientYMin.cloneTo(q_._gradientYMin),this._gradientYMax.cloneTo(q_._gradientYMax),this._gradientZMin.cloneTo(q_._gradientZMin),this._gradientZMax.cloneTo(q_._gradientZMax)},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"gradientZ",function(){return this._gradientZ}),qt(0,qS,"constant",function(){return this._constant}),qt(0,qS,"gradient",function(){return this._gradient}),qt(0,qS,"separateAxes",function(){return this._separateAxes}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"constantSeparate",function(){return this._constantSeparate}),qt(0,qS,"gradientX",function(){return this._gradientX}),qt(0,qS,"gradientY",function(){return this._gradientY}),qt(0,qS,"gradientW",function(){return this._gradientW}),qt(0,qS,"gradientMin",function(){return this._gradientMin}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"gradientMax",function(){return this._gradientMax}),qt(0,qS,"constantMax",function(){return this._constantMax}),qt(0,qS,"gradientWMin",function(){return this._gradientWMin}),qt(0,qS,"constantMinSeparate",function(){return this._constantMinSeparate}),qt(0,qS,"constantMaxSeparate",function(){return this._constantMaxSeparate}),qt(0,qS,"gradientXMin",function(){return this._gradientXMin}),qt(0,qS,"gradientXMax",function(){return this._gradientXMax}),qt(0,qS,"gradientWMax",function(){return this._gradientWMax}),qt(0,qS,"gradientYMin",function(){return this._gradientYMin}),qt(0,qS,"gradientYMax",function(){return this._gradientYMax}),qt(0,qS,"gradientZMin",function(){return this._gradientZMin}),qt(0,qS,"gradientZMax",function(){return this._gradientZMax}),qb.createByConstant=function(qS){var q_=new qb;return q_._type=0,q_._separateAxes=!1,q_._constant=qS,q_},qb.createByConstantSeparate=function(qS){var q_=new qb;return q_._type=0,q_._separateAxes=!0,q_._constantSeparate=qS,q_},qb.createByGradient=function(qS){var q_=new qb;return q_._type=1,q_._separateAxes=!1,q_._gradient=qS,q_},qb.createByGradientSeparate=function(qS,q_,qa,qR){var qJ=new qb;return qJ._type=1,qJ._separateAxes=!0,qJ._gradientX=qS,qJ._gradientY=q_,qJ._gradientZ=qa,qJ._gradientW=qR,qJ},qb.createByRandomTwoConstant=function(qS,q_){var qa=new qb;return qa._type=2,qa._separateAxes=!1,qa._constantMin=qS,qa._constantMax=q_,qa},qb.createByRandomTwoConstantSeparate=function(qS,q_){var qa=new qb;return qa._type=2,qa._separateAxes=!0,qa._constantMinSeparate=qS,qa._constantMaxSeparate=q_,qa},qb.createByRandomTwoGradient=function(qS,q_){var qa=new qb;return qa._type=3,qa._separateAxes=!1,qa._gradientMin=qS,qa._gradientMax=q_,qa},qb.createByRandomTwoGradientSeparate=function(qS,q_,qa,qR,qJ,qV,qW,qk){var qz=new qb;return qz._type=3,qz._separateAxes=!0,qz._gradientXMin=qS,qz._gradientXMax=q_,qz._gradientYMin=qa,qz._gradientYMax=qR,qz._gradientZMin=qJ,qz._gradientZMax=qV,qz._gradientWMin=qW,qz._gradientWMax=qk,qz},qb}(),qM=function(){function qR(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}qG(qR,"laya.d3.core.particleShuriKen.module.GradientColor");var qS=qR.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,this._constant.cloneTo(q_._constant),this._constantMin.cloneTo(q_._constantMin),this._constantMax.cloneTo(q_._constantMax),this._gradient.cloneTo(q_._gradient),this._gradientMin.cloneTo(q_._gradientMin),this._gradientMax.cloneTo(q_._gradientMax)},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"gradient",function(){return this._gradient}),qt(0,qS,"constant",function(){return this._constant}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"gradientMin",function(){return this._gradientMin}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"gradientMax",function(){return this._gradientMax}),qt(0,qS,"constantMax",function(){return this._constantMax}),qR.createByConstant=function(qS){var q_=new qR;return q_._type=0,q_._constant=qS,q_},qR.createByGradient=function(qS){var q_=new qR;return q_._type=1,q_._gradient=qS,q_},qR.createByRandomTwoConstant=function(qS,q_){var qa=new qR;return qa._type=2,qa._constantMin=qS,qa._constantMax=q_,qa},qR.createByRandomTwoGradient=function(qS,q_){var qa=new qR;return qa._type=3,qa._gradientMin=qS,qa._gradientMax=q_,qa},qR}(),qr=(function(){function qS(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}qG(qS,"laya.d3.core.particleShuriKen.module.GradientDataColor");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.addAlpha=function(qS,q_){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==qS&&(qS=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=qS,this._alphaElements[this._alphaCurrentLength++]=q_):DEBUG},q_.addRGB=function(qS,q_){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==qS&&(qS=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=qS,this._rgbElements[this._rgbCurrentLength++]=q_.x,this._rgbElements[this._rgbCurrentLength++]=q_.y,this._rgbElements[this._rgbCurrentLength++]=q_.z):DEBUG},q_.cloneTo=function(qS){var q_=qS,qa=0,qR=0;q_._alphaCurrentLength=this._alphaCurrentLength;var qJ=q_._alphaElements;for(qJ.length=this._alphaElements.length,qa=0,qR=this._alphaElements.length;qa<qR;qa++)qJ[qa]=this._alphaElements[qa];q_._rgbCurrentLength=this._rgbCurrentLength;var qV=q_._rgbElements;for(qV.length=this._rgbElements.length,qa=0,qR=this._rgbElements.length;qa<qR;qa++)qV[qa]=this._rgbElements[qa]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),qt(0,q_,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function qS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}qG(qS,"laya.d3.core.particleShuriKen.module.GradientDataInt");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.add=function(qS,q_){this._currentLength<8?(6===this._currentLength&&1!==qS&&(qS=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=qS,this._elements[this._currentLength++]=q_):console.log("Warning:data count must lessEqual than 4")},q_.cloneTo=function(qS){var q_=qS;q_._currentLength=this._currentLength;var qa=q_._elements;qa.length=this._elements.length;for(var qR=0,qJ=this._elements.length;qR<qJ;qR++)qa[qR]=this._elements[qR]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"gradientCount",function(){return this._currentLength/2})}(),function(){function qS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}qG(qS,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.add=function(qS,q_){this._currentLength<8?(6===this._currentLength&&1!==qS&&(qS=1,DEBUG),this._elements[this._currentLength++]=qS,this._elements[this._currentLength++]=q_):DEBUG},q_.getKeyByIndex=function(qS){return this._elements[2*qS]},q_.getValueByIndex=function(qS){return this._elements[2*qS+1]},q_.getAverageValue=function(){for(var qS=0,q_=this._currentLength-2;qS<q_;qS+=2){this._elements[qS+1];this._elements[qS+3],this._elements[qS+2]-this._elements[qS]}return 0},q_.cloneTo=function(qS){var q_=qS;q_._currentLength=this._currentLength;var qa=q_._elements;qa.length=this._elements.length;for(var qR=0,qJ=this._elements.length;qR<qJ;qR++)qa[qR]=this._elements[qR]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"gradientCount",function(){return this._currentLength/2})}(),function(){function qS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}qG(qS,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.add=function(qS,q_){this._currentLength<8?(6===this._currentLength&&1!==qS&&(qS=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=qS,this._elements[this._currentLength++]=q_.x,this._elements[this._currentLength++]=q_.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},q_.cloneTo=function(qS){var q_=qS;q_._currentLength=this._currentLength;var qa=q_._elements;qa.length=this._elements.length;for(var qR=0,qJ=this._elements.length;qR<qJ;qR++)qa[qR]=this._elements[qR]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"gradientCount",function(){return this._currentLength/3})}(),function(){function qk(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}qG(qk,"laya.d3.core.particleShuriKen.module.GradientSize");var qS=qk.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.getMaxSizeInGradient=function(){var qS=0,q_=0,qa=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(qS=0,q_=this._gradientX.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientX.getValueByIndex(qS));for(qS=0,q_=this._gradientY.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientY.getValueByIndex(qS))}else for(qS=0,q_=this._gradient.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradient.getValueByIndex(qS));break;case 1:qa=this._separateAxes?(qa=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),qa=Math.max(qa,this._constantMinSeparate.y),Math.max(qa,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(qS=0,q_=this._gradientXMin.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientXMin.getValueByIndex(qS));for(qS=0,q_=this._gradientXMax.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientXMax.getValueByIndex(qS));for(qS=0,q_=this._gradientYMin.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientYMin.getValueByIndex(qS));for(qS=0,q_=this._gradientZMax.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientZMax.getValueByIndex(qS))}else{for(qS=0,q_=this._gradientMin.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientMin.getValueByIndex(qS));for(qS=0,q_=this._gradientMax.gradientCount;qS<q_;qS++)qa=Math.max(qa,this._gradientMax.getValueByIndex(qS))}}return qa},qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,q_._separateAxes=this._separateAxes,this._gradient.cloneTo(q_._gradient),this._gradientX.cloneTo(q_._gradientX),this._gradientY.cloneTo(q_._gradientY),this._gradientZ.cloneTo(q_._gradientZ),q_._constantMin=this._constantMin,q_._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(q_._constantMinSeparate),this._constantMaxSeparate.cloneTo(q_._constantMaxSeparate),this._gradientMin.cloneTo(q_._gradientMin),this._gradientMax.cloneTo(q_._gradientMax),this._gradientXMin.cloneTo(q_._gradientXMin),this._gradientXMax.cloneTo(q_._gradientXMax),this._gradientYMin.cloneTo(q_._gradientYMin),this._gradientYMax.cloneTo(q_._gradientYMax),this._gradientZMin.cloneTo(q_._gradientZMin),this._gradientZMax.cloneTo(q_._gradientZMax)},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"gradientZ",function(){return this._gradientZ}),qt(0,qS,"gradient",function(){return this._gradient}),qt(0,qS,"separateAxes",function(){return this._separateAxes}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"gradientMin",function(){return this._gradientMin}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"gradientX",function(){return this._gradientX}),qt(0,qS,"gradientY",function(){return this._gradientY}),qt(0,qS,"gradientMax",function(){return this._gradientMax}),qt(0,qS,"constantMax",function(){return this._constantMax}),qt(0,qS,"constantMinSeparate",function(){return this._constantMinSeparate}),qt(0,qS,"constantMaxSeparate",function(){return this._constantMaxSeparate}),qt(0,qS,"gradientXMin",function(){return this._gradientXMin}),qt(0,qS,"gradientXMax",function(){return this._gradientXMax}),qt(0,qS,"gradientYMin",function(){return this._gradientYMin}),qt(0,qS,"gradientYMax",function(){return this._gradientYMax}),qt(0,qS,"gradientZMin",function(){return this._gradientZMin}),qt(0,qS,"gradientZMax",function(){return this._gradientZMax}),qk.createByGradient=function(qS){var q_=new qk;return q_._type=0,q_._separateAxes=!1,q_._gradient=qS,q_},qk.createByGradientSeparate=function(qS,q_,qa){var qR=new qk;return qR._type=0,qR._separateAxes=!0,qR._gradientX=qS,qR._gradientY=q_,qR._gradientZ=qa,qR},qk.createByRandomTwoConstant=function(qS,q_){var qa=new qk;return qa._type=1,qa._separateAxes=!1,qa._constantMin=qS,qa._constantMax=q_,qa},qk.createByRandomTwoConstantSeparate=function(qS,q_){var qa=new qk;return qa._type=1,qa._separateAxes=!0,qa._constantMinSeparate=qS,qa._constantMaxSeparate=q_,qa},qk.createByRandomTwoGradient=function(qS,q_){var qa=new qk;return qa._type=2,qa._separateAxes=!1,qa._gradientMin=qS,qa._gradientMax=q_,qa},qk.createByRandomTwoGradientSeparate=function(qS,q_,qa,qR,qJ,qV){var qW=new qk;return qW._type=2,qW._separateAxes=!0,qW._gradientXMin=qS,qW._gradientXMax=q_,qW._gradientYMin=qa,qW._gradientYMax=qR,qW._gradientZMin=qJ,qW._gradientZMax=qV,qW},qk}()),qe=function(){function qk(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}qG(qk,"laya.d3.core.particleShuriKen.module.GradientVelocity");var qS=qk.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,this._constant.cloneTo(q_._constant),this._gradientX.cloneTo(q_._gradientX),this._gradientY.cloneTo(q_._gradientY),this._gradientZ.cloneTo(q_._gradientZ),this._constantMin.cloneTo(q_._constantMin),this._constantMax.cloneTo(q_._constantMax),this._gradientXMin.cloneTo(q_._gradientXMin),this._gradientXMax.cloneTo(q_._gradientXMax),this._gradientYMin.cloneTo(q_._gradientYMin),this._gradientYMax.cloneTo(q_._gradientYMax),this._gradientZMin.cloneTo(q_._gradientZMin),this._gradientZMax.cloneTo(q_._gradientZMax)},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"gradientZ",function(){return this._gradientZ}),qt(0,qS,"constant",function(){return this._constant}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"gradientXMax",function(){return this._gradientXMax}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"gradientX",function(){return this._gradientX}),qt(0,qS,"gradientY",function(){return this._gradientY}),qt(0,qS,"gradientXMin",function(){return this._gradientXMin}),qt(0,qS,"constantMax",function(){return this._constantMax}),qt(0,qS,"gradientYMin",function(){return this._gradientYMin}),qt(0,qS,"gradientYMax",function(){return this._gradientYMax}),qt(0,qS,"gradientZMin",function(){return this._gradientZMin}),qt(0,qS,"gradientZMax",function(){return this._gradientZMax}),qk.createByConstant=function(qS){var q_=new qk;return q_._type=0,q_._constant=qS,q_},qk.createByGradient=function(qS,q_,qa){var qR=new qk;return qR._type=1,qR._gradientX=qS,qR._gradientY=q_,qR._gradientZ=qa,qR},qk.createByRandomTwoConstant=function(qS,q_){var qa=new qk;return qa._type=2,qa._constantMin=qS,qa._constantMax=q_,qa},qk.createByRandomTwoGradient=function(qS,q_,qa,qR,qJ,qV){var qW=new qk;return qW._type=3,qW._gradientXMin=qS,qW._gradientXMax=q_,qW._gradientYMin=qa,qW._gradientYMax=qR,qW._gradientZMin=qJ,qW._gradientZMax=qV,qW},qk}(),qg=(function(){function qS(qS){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=qS}qG(qS,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.cloneTo=function(qS){var q_=qS;this._angularVelocity.cloneTo(q_._angularVelocity),q_.enbale=this.enbale},q_.clone=function(){var qS;switch(this._angularVelocity.type){case 0:qS=this._angularVelocity.separateAxes?qP.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):qP.createByConstant(this._angularVelocity.constant);break;case 1:qS=this._angularVelocity.separateAxes?qP.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):qP.createByGradient(this._angularVelocity.gradient.clone());break;case 2:qS=this._angularVelocity.separateAxes?qP.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):qP.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:qS=this._angularVelocity.separateAxes?qP.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):qP.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var q_=new this.constructor(qS);return q_.enbale=this.enbale,q_},qt(0,q_,"angularVelocity",function(){return this._angularVelocity})}(),function(){function qS(){this.enable=!1,this.randomDirection=!1}qG(qS,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_._getShapeBoundBox=function(qS){throw new Error("BaseShape: must override it.")},q_._getSpeedBoundBox=function(qS){throw new Error("BaseShape: must override it.")},q_.generatePositionAndDirection=function(qS,q_,qa,qR){throw new Error("BaseShape: must override it.")},q_._calculateProceduralBounds=function(qS,q_,qa){this._getShapeBoundBox(qS);var qR=qS.min,qJ=qS.max;qW_.multiply(qR,q_,qR),qW_.multiply(qJ,q_,qJ);var qV=new qES(new qW_,new qW_);this.randomDirection?(qV.min=new qW_(-1,-1,-1),qV.max=new qW_(1,1,1)):this._getSpeedBoundBox(qV);var qW=new qES(new qW_,new qW_),qk=qW.min,qz=qW.max;qW_.scale(qV.min,qa.y,qk),qW_.scale(qV.max,qa.y,qz),qW_.add(qS.min,qk,qk),qW_.add(qS.max,qz,qz),qW_.min(qS.min,qk,qS.min),qW_.max(qS.max,qk,qS.max);var qb=new qES(new qW_,new qW_),qH=qb.min,qL=qb.max;qW_.scale(qV.min,qa.x,qH),qW_.scale(qV.max,qa.x,qL),qW_.min(qb.min,qL,qk),qW_.max(qb.min,qL,qz),qW_.min(qS.min,qk,qS.min),qW_.max(qS.max,qk,qS.max)},q_.cloneTo=function(qS){qS.enable=this.enable},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qS}()),qY=function(){function qV(){}return qG(qV,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),qV._randomPointUnitArcCircle=function(qS,q_,qa){var qR=q_.elements,qJ=NaN;qJ=qa?qa.getFloat()*qS:Math.random()*qS,qR[0]=Math.cos(qJ),qR[1]=Math.sin(qJ)},qV._randomPointInsideUnitArcCircle=function(qS,q_,qa){var qR=q_.elements;qV._randomPointUnitArcCircle(qS,q_,qa);var qJ=NaN;qJ=qa?Math.pow(qa.getFloat(),.5):Math.pow(Math.random(),.5),qR[0]=qR[0]*qJ,qR[1]=qR[1]*qJ},qV._randomPointUnitCircle=function(qS,q_){var qa=qS.elements,qR=NaN;qR=q_?q_.getFloat()*Math.PI*2:Math.random()*Math.PI*2,qa[0]=Math.cos(qR),qa[1]=Math.sin(qR)},qV._randomPointInsideUnitCircle=function(qS,q_){var qa=qS.elements;qV._randomPointUnitCircle(qS);var qR=NaN;qR=q_?Math.pow(q_.getFloat(),.5):Math.pow(Math.random(),.5),qa[0]=qa[0]*qR,qa[1]=qa[1]*qR},qV._randomPointUnitSphere=function(qS,q_){var qa=qS.elements,qR=NaN,qJ=NaN;qJ=q_?(qR=qa[2]=2*q_.getFloat()-1,q_.getFloat()*Math.PI*2):(qR=qa[2]=2*Math.random()-1,Math.random()*Math.PI*2);var qV=Math.sqrt(1-qR*qR);qa[0]=qV*Math.cos(qJ),qa[1]=qV*Math.sin(qJ)},qV._randomPointInsideUnitSphere=function(qS,q_){var qa=qS.elements;qV._randomPointUnitSphere(qS);var qR=NaN;qR=q_?Math.pow(q_.getFloat(),1/3):Math.pow(Math.random(),1/3),qa[0]=qa[0]*qR,qa[1]=qa[1]*qR,qa[2]=qa[2]*qR},qV._randomPointInsideHalfUnitBox=function(qS,q_){var qa=qS.elements;q_?(qa[0]=q_.getFloat()-.5,qa[1]=q_.getFloat()-.5,qa[2]=q_.getFloat()-.5):(qa[0]=Math.random()-.5,qa[1]=Math.random()-.5,qa[2]=Math.random()-.5)},qV}(),qi=(function(){function qS(qS){this._size=null,this.enbale=!1,this._size=qS}qG(qS,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.cloneTo=function(qS){var q_=qS;this._size.cloneTo(q_._size),q_.enbale=this.enbale},q_.clone=function(){var qS;switch(this._size.type){case 0:qS=this._size.separateAxes?qr.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):qr.createByGradient(this._size.gradient.clone());break;case 1:qS=this._size.separateAxes?qr.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):qr.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:qS=this._size.separateAxes?qr.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):qr.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var q_=new this.constructor(qS);return q_.enbale=this.enbale,q_},qt(0,q_,"size",function(){return this._size})}(),function(){function qR(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}qG(qR,"laya.d3.core.particleShuriKen.module.StartFrame");var qS=qR.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.cloneTo=function(qS){var q_=qS;q_._type=this._type,q_._constant=this._constant,q_._constantMin=this._constantMin,q_._constantMax=this._constantMax},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qS,"constant",function(){return this._constant}),qt(0,qS,"type",function(){return this._type}),qt(0,qS,"constantMin",function(){return this._constantMin}),qt(0,qS,"constantMax",function(){return this._constantMax}),qR.createByConstant=function(qS){var q_=new qR;return q_._type=0,q_._constant=qS,q_},qR.createByRandomTwoConstant=function(qS,q_){var qa=new qR;return qa._type=1,qa._constantMin=qS,qa._constantMax=q_,qa},qR}()),qZ=(function(){function qS(qS,q_){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new qV_(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=qS,this._startFrame=q_}qG(qS,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.cloneTo=function(qS){var q_=qS;this.tiles.cloneTo(q_.tiles),q_.type=this.type,q_.randomRow=this.randomRow,this._frame.cloneTo(q_._frame),this._startFrame.cloneTo(q_._startFrame),q_.cycles=this.cycles,q_.enableUVChannels=this.enableUVChannels,q_.enable=this.enable},q_.clone=function(){var qS,q_;switch(this._frame.type){case 0:qS=qK.createByConstant(this._frame.constant);break;case 1:qS=qK.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:qS=qK.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:qS=qK.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:q_=qi.createByConstant(this._startFrame.constant);break;case 1:q_=qi.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var qa=new this.constructor(qS,q_);return this.tiles.cloneTo(qa.tiles),qa.type=this.type,qa.randomRow=this.randomRow,qa.cycles=this.cycles,qa.enableUVChannels=this.enableUVChannels,qa.enable=this.enable,qa},qt(0,q_,"frame",function(){return this._frame}),qt(0,q_,"startFrame",function(){return this._startFrame})}(),function(){function qS(qS){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=qS}qG(qS,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.cloneTo=function(qS){var q_=qS;this._velocity.cloneTo(q_._velocity),q_.enbale=this.enbale,q_.space=this.space},q_.clone=function(){var qS;switch(this._velocity.type){case 0:qS=qe.createByConstant(this._velocity.constant.clone());break;case 1:qS=qe.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:qS=qe.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:qS=qe.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var q_=new this.constructor(qS);return q_.enbale=this.enbale,q_.space=this.space,q_},qt(0,q_,"velocity",function(){return this._velocity})}(),function(){function qS(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new qC_,this._vb=qg_.create(qS._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=qe_.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=qM_.nameKey.getID("LINE"),this._shaderCompile=qN_._preCompileShader[this._sharderNameID]}qG(qS,"laya.d3.core.PhasorSpriter3D");var q_=qS.prototype;return q_.line=function(qS,q_,qa,qR){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(qS.x,qS.y,qS.z,q_.x,q_.y,q_.z,q_.w),this.addVertex(qa.x,qa.y,qa.z,qR.x,qR.y,qR.z,qR.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},q_.circle=function(qS,q_,qa,qR,qJ,qV){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*q_,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/q_,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*qS,Math.cos(this._tempNumver0)*qS,0,qa,qR,qJ,qV),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},q_.plane=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=qR/2,this._tempNumver1=qJ/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(qS-this._tempNumver0,q_+this._tempNumver1,qa,qV,qW,qk,qz),this.addVertex(qS+this._tempNumver0,q_+this._tempNumver1,qa,qV,qW,qk,qz),this.addVertex(qS-this._tempNumver0,q_-this._tempNumver1,qa,qV,qW,qk,qz),this.addVertex(qS+this._tempNumver0,q_-this._tempNumver1,qa,qV,qW,qk,qz),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},q_.box=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=qR/2,this._tempNumver1=qJ/2,this._tempNumver2=qV/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(qS-this._tempNumver0,q_+this._tempNumver1,qa+this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS+this._tempNumver0,q_+this._tempNumver1,qa+this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS-this._tempNumver0,q_-this._tempNumver1,qa+this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS+this._tempNumver0,q_-this._tempNumver1,qa+this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS+this._tempNumver0,q_+this._tempNumver1,qa-this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS-this._tempNumver0,q_+this._tempNumver1,qa-this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS+this._tempNumver0,q_-this._tempNumver1,qa-this._tempNumver2,qW,qk,qz,qb),this.addVertex(qS-this._tempNumver0,q_-this._tempNumver1,qa-this._tempNumver2,qW,qk,qz,qb),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},q_.cone=function(qS,q_,qa,qR,qJ,qV,qW){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*qa+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*qa>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/qa,this.addVertexIndex(0,q_,0,qR,qJ,qV,qW,this._tempUint0),this.addVertexIndex(0,0,0,qR,qJ,qV,qW,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<qa;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(qS*this._tempNumver2,0,qS*this._tempNumver3,qR,qJ,qV,qW,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==qa-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(qS*this._tempNumver2,0,qS*this._tempNumver3,qR,qJ,qV,qW,this._tempUint0+(this._tempInt0+qa)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==qa-1?this.addIndexes(this._tempUint1+qa+2):this.addIndexes(this._tempUint1+this._tempInt0+qa+1),this.addIndexes(this._tempUint1+this._tempInt0+qa),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},q_.boundingBoxLine=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(qS,qJ,qV,qW,qk,qz,qb),this.addVertex(qR,qJ,qV,qW,qk,qz,qb),this.addVertex(qS,q_,qV,qW,qk,qz,qb),this.addVertex(qR,q_,qV,qW,qk,qz,qb),this.addVertex(qR,qJ,qa,qW,qk,qz,qb),this.addVertex(qS,qJ,qa,qW,qk,qz,qb),this.addVertex(qR,q_,qa,qW,qk,qz,qb),this.addVertex(qS,q_,qa,qW,qk,qz,qb),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},q_.addVertex=function(qS,q_,qa,qR,qJ,qV,qW){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=qS,this._vbData[this._posInVBData+1]=q_,this._vbData[this._posInVBData+2]=qa,this._vbData[this._posInVBData+3]=qR,this._vbData[this._posInVBData+4]=qJ,this._vbData[this._posInVBData+5]=qV,this._vbData[this._posInVBData+6]=qW,this._posInVBData+=this._floatSizePerVer,this},q_.addVertexIndex=function(qS,q_,qa,qR,qJ,qV,qW,qk){return this._hasBegun||this.addVertexIndexException(),this._vbData[qk]=qS,this._vbData[qk+1]=q_,this._vbData[qk+2]=qa,this._vbData[qk+3]=qR,this._vbData[qk+4]=qJ,this._vbData[qk+5]=qV,this._vbData[qk+6]=qW,(qk+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=qk),this},q_.addIndexes=function(qS){var q_=arguments;this._hasBegun||this.addVertexIndexException();for(var qa=0;qa<q_.length;qa++)this._ibData[this._posInIBData]=q_[qa],this._posInIBData++;return this},q_.begin=function(qS,q_){return this._hasBegun&&this.beginException0(),1!==qS&&4!==qS&&this.beginException1(),this._primitiveType=qS,this._camera=q_,this._hasBegun=!0,this},q_.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},q_.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(qS._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),qN.drawCall++,qA.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},q_.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},q_.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},q_.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},q_.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},q_.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},q_.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(28,[new qWS(0,"vector3",0),new qWS(12,"vector4",1)])}]),qS}()),qp=function(){function qS(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++qS._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new qC_}qG(qS,"laya.d3.core.render.RenderElement");var q_=qS.prototype;return q_.getDynamicBatchBakedVertexs=function(qS){for(var q_=this._renderObj._getVertexBuffer(qS),qa=q_.getData().slice(),qR=q_.vertexDeclaration,qJ=qR.getVertexElementByUsage(0).offset/4,qV=qR.getVertexElementByUsage(3).offset/4,qW=this._sprite3D.transform,qk=qW.worldMatrix,qz=qW.rotation,qb=qR.vertexStride/4,qH=0,qL=qa.length;qH<qL;qH+=qb){var qC=qH+qJ,qG=qH+qV;q$_.transformVector3ArrayToVector3ArrayCoordinate(qa,qC,qk,qa,qC),q$_.transformVector3ArrayByQuat(qa,qG,qz,qa,qG)}return qa},q_.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},q_._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},qt(0,q_,"id",function(){return this._id}),qt(0,q_,"renderObj",function(){return this._renderObj},function(qS){this._renderObj!==qS&&(this._renderObj=qS)}),qS._uniqueIDCounter=0,qS}(),qc=function(){function q_(qS){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++q_._uniqueIDCounter,this._needSort=!1,this._scene=qS,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}qG(q_,"laya.d3.core.render.RenderQueue");var qS=q_.prototype;return qS._sortOpaqueFunc=function(qS,q_){if(qS._render&&q_._render){var qa=qS._material.renderQueue-q_._material.renderQueue;return 0==qa?qS._render._distanceForSort-q_._render._distanceForSort:qa}return 0},qS._sortAlphaFunc=function(qS,q_){if(qS._render&&q_._render){var qa=qS._material.renderQueue-q_._material.renderQueue;return 0==qa?q_._render._distanceForSort-qS._render._distanceForSort:qa}return 0},qS._begainRenderElement=function(qS,q_,qa){return!!q_._beforeRender(qS)},qS._sortAlpha=function(qS){q_._cameraPosition=qS,this._finalElements.sort(this._sortAlphaFunc)},qS._sortOpaque=function(qS){q_._cameraPosition=qS,this._finalElements.sort(this._sortOpaqueFunc)},qS._preRender=function(qS){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},qS._render=function(qS,q_){for(var qa,qR,qJ,qV,qW,qk,qz=qN.loopCount,qb=this._scene,qH=qS.camera,qL=(qH.id,!1),qC=0,qG=this._finalElements.length;qC<qG;qC++){var qt,qo,q$,qF=this._finalElements[qC];if(null!=qF._onPreRenderFunction&&qF._onPreRenderFunction.call(qF._sprite3D,qS),0===qF._type){if(qS.owner=q$=qF._sprite3D,qS.renderElement=qF,q$._preRenderUpdateComponents(qS),qt=qF.renderObj,qo=qF._material,this._begainRenderElement(qS,qt,qo)){if(qa=qt._getVertexBuffers(),!(qJ=(qR=qt._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[qR.id]){this._errorRecord[qR.id]=1;var qT="vertexBuffer:"+("("+qR._destroyed+","+qR._released+","+qR._referenceCount+","+qR._buffer+")")+", material:"+(qo?qo.__className+"("+qo._destroyed+","+qo._released+")":"null")+", owner:"+(q$?q$.__className+"("+q$._destroyed+","+q$._activeInHierarchy+","+q$._displayedInStage+")":"null")+", renderObj:"+(qt?qt.__className+"("+qt._destroyed+","+qt._released+","+qt._referenceCount+")":"")+", parent:, url:"+(q$?q$.url:"")+", disposeStack:"+qR.disposeStack;qQ.recordError("报错：unknown vertexDeclaration  "+qT)}continue}if(qL=(qV=qS._shader=qo._getShader(qb._shaderDefineValue,qJ.shaderDefineValue,q$._shaderDefineValue)).bind()||qz!==qV._uploadLoopCount,qa){if(qV._uploadVertexBuffer!==qa||qL){for(var qD=0;qD<qa.length;qD++){var qj=qa[qD];qV.uploadAttributesX(qj.vertexDeclaration.shaderValues.data,qj)}qV._uploadVertexBuffer=qa}}else(qV._uploadVertexBuffer!==qR||qL)&&(qV.uploadAttributes(qJ.shaderValues.data,null),qV._uploadVertexBuffer=qR);(qV._uploadScene!==qb||qL)&&(qV.uploadSceneUniforms(qb._shaderValues.data),qV._uploadScene=qb),(qH!==qV._uploadCamera||qV._uploadSprite3D!==q$||qL)&&(qV.uploadSpriteUniforms(q$._shaderValues.data),qV._uploadSprite3D=q$),(qH!==qV._uploadCamera||qL)&&(qV.uploadCameraUniforms(qH._shaderValues.data),qV._uploadCamera=qH),(qV._uploadMaterial!==qo||qL)&&(qo._upload(),qV._uploadMaterial=qo),qW!==qo?(qo._setRenderStateBlendDepth(),qo._setRenderStateFrontFace(q_,q$.transform),qW=qo,qk=q$):qk!==q$&&(qo._setRenderStateFrontFace(q_,q$.transform),qk=q$),qt._render(qS),qV._uploadLoopCount=qz}q$._postRenderUpdateComponents(qS)}else if(2===qF._type){qF.renderObj;qS.owner=q$=qF._sprite3D,qS.renderElement=qF,qS._batchIndexStart=qF._tempBatchIndexStart,qS._batchIndexEnd=qF._tempBatchIndexEnd,qt=qF.renderObj,qo=qF._material,this._begainRenderElement(qS,qt,qo)&&(qJ=(qR=qt._getVertexBuffer(0)).vertexDeclaration,qL=(qV=qS._shader=qo._getShader(qb._shaderDefineValue,qJ.shaderDefineValue,q$._shaderDefineValue)).bind()||qz!==qV._uploadLoopCount,(qV._uploadVertexBuffer!==qR||qL)&&(qV.uploadAttributes(qJ.shaderValues.data,null),qV._uploadVertexBuffer=qR),(qV._uploadScene!==qb||qL)&&(qV.uploadSceneUniforms(qb._shaderValues.data),qV._uploadScene=qb),(qH!==qV._uploadCamera||qV._uploadSprite3D!==q$||qL)&&(qV.uploadSpriteUniforms(q$._shaderValues.data),qV._uploadSprite3D=q$),(qH!==qV._uploadCamera||qL)&&(qV.uploadCameraUniforms(qH._shaderValues.data),qV._uploadCamera=qH),(qV._uploadMaterial!==qo||qL)&&(qo._upload(),qV._uploadMaterial=qo),qW!==qo?(qo._setRenderStateBlendDepth(),qo._setRenderStateFrontFace(q_,q$.transform),qW=qo,qk=q$):qk!==q$&&(qo._setRenderStateFrontFace(q_,q$.transform),qk=q$),qt._render(qS),qV._uploadLoopCount=qz)}}},qS._renderShadow=function(qS,q_){for(var qa,qR,qJ,qV,qW,qk=qN.loopCount,qz=this._scene,qb=qS.camera,qH=!1,qL=0,qC=this._finalElements.length;qL<qC;qL++){var qG,qt,qo,q$=this._finalElements[qL];0===q$._type&&(qS.owner=qo=q$._sprite3D,q_||qo._projectionViewWorldUpdateCamera===qb&&qo._projectionViewWorldUpdateLoopCount===qN.loopCount||(qo._render._renderUpdate(qS._projectionViewMatrix),qo._projectionViewWorldUpdateLoopCount=qN.loopCount,qo._projectionViewWorldUpdateCamera=qb),qS.renderElement=q$,qo._preRenderUpdateComponents(qS),qG=q$.renderObj,qt=q$._material,this._begainRenderElement(qS,qG,null)&&(qR=(qa=qG._getVertexBuffer(0)).vertexDeclaration,qH=(qJ=qS._shader=qt._getShader(qz._shaderDefineValue,qR.shaderDefineValue,qo._shaderDefineValue)).bind()||qk!==qJ._uploadLoopCount,(qJ._uploadVertexBuffer!==qa||qH)&&(qJ.uploadAttributes(qR.shaderValues.data,null),qJ._uploadVertexBuffer=qa),(qb!==qJ._uploadCamera||qJ._uploadSprite3D!==qo||qH)&&(qJ.uploadSpriteUniforms(qo._shaderValues.data),qJ._uploadSprite3D=qo),(qb!==qJ._uploadCamera||qH)&&(qJ.uploadCameraUniforms(qb._shaderValues.data),qJ._uploadCamera=qb),(qJ._uploadMaterial!==qt||qH)&&(qt._upload(),qJ._uploadMaterial=qt),qJ._uploadRenderElement,qV!==qt?(qt._setRenderStateFrontFace(!1,qo.transform),qV=qt,qW=qo):qW!==qo&&(qt._setRenderStateFrontFace(!1,qo.transform),qW=qo),qG._render(qS),qJ._uploadLoopCount=qk),qo._postRenderUpdateComponents(qS))}},qS._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},qS._addRenderElement=function(qS){this._renderElements.push(qS),this._needSort=!0},qS._addDynamicBatchElement=function(qS){this._dynamicBatchCombineRenderElements.push(qS)},qt(0,qS,"id",function(){return this._id}),q_._uniqueIDCounter=0,q_._cameraPosition=null,q_}(),qy=function(){function qS(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return qG(qS,"laya.d3.core.render.RenderState"),qS.clientWidth=0,qS.clientHeight=0,qS}(),qE=function(){function qW(qS,q_){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new qwS(new qW_,0),this._corners=[new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_],this._boundingBoxCenter=new qW_,this._children=qR(8),this._objects=[],this._tempBoundBoxCorners=[new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_],this._scene=qS,this._currentDepth=q_}qG(qW,"laya.d3.core.scene.OctreeNode");var qS=qW.prototype;return qQ.imps(qS,{"laya.d3.core.scene.ITreeNode":!0}),qS.init=function(qS,q_){var qa=new qW_,qR=new qW_;qW_.scale(q_,-.5,qa),qW_.scale(q_,.5,qR),qW_.add(qa,qS,qa),qW_.add(qR,qS,qR),this.exactBox=new qES(qa,qR),this.relaxBox=new qES(qa,qR)},qS.addTreeNode=function(qS){1===Collision.boxContainsBox(this._relaxBox,qS.boundingBox)?this.addNodeDown(qS,0):this.addObject(qS)},qS.addChild=function(qS){var q_=this._children[qS];if(null==q_){q_=new qW(this._scene,this._currentDepth+1),(this._children[qS]=q_)._parent=this,qW_.subtract(this._exactBox.max,this._exactBox.min,qW.tempSize),qW_.multiply(qW.tempSize,qW._octreeSplit[qS],qW.tempCenter),qW_.add(this._exactBox.min,qW.tempCenter,qW.tempCenter),qW_.scale(qW.tempSize,.25,qW.tempSize);var qa=new qW_,qR=new qW_;qW_.subtract(qW.tempCenter,qW.tempSize,qa),qW_.add(qW.tempCenter,qW.tempSize,qR),q_.exactBox=new qES(qa,qR),qW_.scale(qW.tempSize,qW.relax,qW.tempSize);var qJ=new qW_,qV=new qW_;qW_.subtract(qW.tempCenter,qW.tempSize,qJ),qW_.add(qW.tempCenter,qW.tempSize,qV),q_.relaxBox=new qES(qJ,qV)}return q_},qS.addObject=function(qS){(qS._treeNode=this)._objects.push(qS)},qS.removeObject=function(qS){if(qS._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var q_=this._objects.indexOf(qS);return-1!==q_&&(this._objects.splice(q_,1),!0)},qS.clearObject=function(){this._objects.length=0},qS.addNodeUp=function(qS,q_){this._parent&&1!==Collision.boxContainsBox(this._exactBox,qS.boundingBox)?this._parent.addNodeUp(qS,q_-1):this.addNodeDown(qS,q_)},qS.addNodeDown=function(qS,q_){if(q_<this._scene.treeLevel){var qa=this.inChildIndex(qS.boundingBoxCenter),qR=this.addChild(qa);1===Collision.boxContainsBox(qR._relaxBox,qS.boundingBox)?qR.addNodeDown(qS,++q_):this.addObject(qS)}else this.addObject(qS)},qS.inChildIndex=function(qS){return 4*(qS.z<this._boundingBoxCenter.z?0:1)+2*(qS.y<this._boundingBoxCenter.y?0:1)+(qS.x<this._boundingBoxCenter.x?0:1)},qS.updateObject=function(qS){1===Collision.boxContainsBox(this._relaxBox,qS.boundingBox)?(this.removeObject(qS),qS._treeNode=null,this.addNodeDown(qS,this._currentDepth)):this._parent&&(this.removeObject(qS),qS._treeNode=null,this._parent.addNodeUp(qS,this._currentDepth-1))},qS.cullingObjects=function(qS,q_,qa,qR,qJ){var qV,qW=0,qk=0,qz=0,qb=this._scene._dynamicBatchManager;for(qW=0,qV=this._objects.length;qW<qV;qW++){var qH=this._objects[qW];if(qu.isVisible(qH._owner.layer.mask)&&qH.enable){if(q_&&(qN.treeSpriteCollision+=1,0===qS.containsBoundSphere(qH.boundingSphere)))continue;qH._renderUpdate(qJ),qH._distanceForSort=qW_.distance(qH.boundingSphere.center,qR)+qH.sortingFudge;var qL=qH._renderElements;for(qk=0,qz=qL.length;qk<qz;qk++){var qC=qL[qk],qG=qC._staticBatch;if(qG&&qG._material===qC._material)qG._addBatchRenderElement(qC);else{var qt=qC.renderObj;qt.triangleCount<10&&1===qt._vertexBufferCount&&qt._getIndexBuffer()&&qC._material.renderQueue<2&&qC._canDynamicBatch&&!qH._owner.isStatic?qb._addPrepareRenderElement(qC):this._scene.getRenderQueue(qC._material.renderQueue)._addRenderElement(qC)}}}}for(qW=0;qW<8;qW++){var qo=this._children[qW];if(null!=qo){var q$=q_;if(q_){var qF=qS.containsBoundBox(qo._relaxBox);if(qN.treeNodeCollision+=1,0===qF)continue;q$=2===qF}qo.cullingObjects(qS,q$,qa,qR,qJ)}}},qS.cullingShadowObjects=function(qS,q_,qa,qR,qJ){var qV,qW=0,qk=0,qz=0;this._scene._dynamicBatchManager;for(qW=0,qV=this._objects.length;qW<qV;qW++){var qb=this._objects[qW];if(qb.castShadow&&qu.isVisible(qb._owner.layer.mask)&&qb.enable){if(qa&&0===qS[0].containsBoundSphere(qb.boundingSphere))continue;for(var qH=1,qL=qS.length;qH<qL;qH++){var qC=q_[qH-1];if(0!==qS[qH].containsBoundSphere(qb.boundingSphere)){var qG=qb._renderElements;for(qk=0,qz=qG.length;qk<qz;qk++)qC._addRenderElement(qG[qk])}}}}for(qW=0;qW<8;qW++){var qt=this._children[qW];if(null!=qt){var qo=qa;if(qa){var q$=qS[0].containsBoundBox(qt._relaxBox);if(0===q$)continue;qo=2===q$}qt.cullingShadowObjects(qS,q_,qo,qR,qJ)}}},qS.cullingShadowObjectsOnePSSM=function(qS,q_,qa,qR,qJ,qV){var qW,qk=q_[0],qz=0,qb=0,qH=0;for(qz=0,qW=this._objects.length;qz<qW;qz++){var qL=this._objects[qz];if(qL.castShadow&&qu.isVisible(qL._owner.layer.mask)&&qL.enable){if(qR&&0===qS.containsBoundSphere(qL.boundingSphere))continue;qL._renderUpdate(qa);var qC=qL._renderElements;for(qb=0,qH=qC.length;qb<qH;qb++)qk._addRenderElement(qC[qb])}}for(qz=0;qz<8;qz++){var qG=this._children[qz];if(null!=qG){var qt=qR;if(qR){var qo=qS.containsBoundBox(qG._relaxBox);if(0===qo)continue;qt=2===qo}qG.cullingShadowObjectsOnePSSM(qS,q_,qa,qt,qJ,qV)}}},qS.renderBoudingBox=function(qS){this._renderBoudingBox(qS);for(var q_=0;q_<8;++q_){var qa=this._children[q_];qa&&qa.renderBoudingBox(qS)}},qS.buildAllChild=function(qS){if(qS<this._scene.treeLevel)for(var q_=0;q_<8;q_++){this.addChild(q_).buildAllChild(qS+1)}},qS._renderBoudingBox=function(qS){},qt(0,qS,"exactBox",function(){return this._exactBox},function(qS){this._exactBox=qS,qW_.add(qS.min,qS.max,this._boundingBoxCenter),qW_.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),qt(0,qS,"relaxBox",function(){return this._relaxBox},function(qS){(this._relaxBox=qS).getCorners(this._corners),qwS.createfromPoints(this._corners,this._boundingSphere)}),qW.debugMode=!1,qW.relax=1.15,qW.CHILDNUM=8,qL(qW,["tempVector0",function(){return this.tempVector0=new qW_},"tempSize",function(){return this.tempSize=new qW_},"tempCenter",function(){return this.tempCenter=new qW_},"_octreeSplit",function(){return this._octreeSplit=[new qW_(.25,.25,.25),new qW_(.75,.25,.25),new qW_(.25,.75,.25),new qW_(.75,.75,.25),new qW_(.25,.25,.75),new qW_(.75,.25,.75),new qW_(.25,.75,.75),new qW_(.75,.75,.75)]}]),qW}(),qO=(function(){function qS(){}qG(qS,"laya.d3.core.scene.SceneManager")}(),function(){function qS(qS,q_,qa,qR){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===qS&&(qS=1),void 0===q_&&(q_=1),void 0===qa&&(qa=1),void 0===qR&&(qR=1),this._r=qS,this._g=q_,this._b=qa,this._a=qR}return qG(qS,"laya.d3.core.trail.module.Color",null,"Color$1"),qS.prototype.cloneTo=function(qS){qS._r=this._r,qS._g=this._g,qS._b=this._b,qS._a=this._a},qL(qS,["RED",function(){return this.RED=new qS(1,0,0,1)},"GREEN",function(){return this.GREEN=new qS(0,1,0,1)},"BLUE",function(){return this.BLUE=new qS(0,0,1,1)},"CYAN",function(){return this.CYAN=new qS(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new qS(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new qS(1,0,1,1)},"GRAY",function(){return this.GRAY=new qS(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new qS(1,1,1,1)},"BLACK",function(){return this.BLACK=new qS(0,0,0,1)}]),qS}()),qw=(function(){function qS(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}qG(qS,"laya.d3.core.trail.module.Gradient");var q_=qS.prototype;q_.setKeys=function(qS,q_){var qa,qR;this._colorKeys=qS;for(var qJ=this.index=0;qJ<qS.length;qJ++){var qV=(qa=qS[qJ]).color;this._colorKeyData[this.index++]=qV._r,this._colorKeyData[this.index++]=qV._g,this._colorKeyData[this.index++]=qV._b,this._colorKeyData[this.index++]=qa.time}this._alphaKeys=q_;for(var qW=this.index=0;qW<q_.length;qW++)qR=q_[qW],this._alphaKeyData[this.index++]=qR.alpha,this._alphaKeyData[this.index++]=qR.time},q_.cloneTo=function(qS){var q_=0,qa=0,qR=this.colorKeys,qJ=[];for(q_=0,qa=qR.length;q_<qa;q_++){var qV=new qv;qR[q_].cloneTo(qV),qJ.push(qV)}var qW=this.alphaKeys,qk=[];for(q_=0,qa=qW.length;q_<qa;q_++){var qz=new qw;qW[q_].cloneTo(qz),qk.push(qz)}qS.setKeys(qJ,qk)},qt(0,q_,"mode",function(){return this._mode},function(qS){this._mode=qS}),qt(0,q_,"colorKeys",function(){return this._colorKeys},function(qS){this._colorKeys=qS;for(var q_=this.index=0;q_<qS.length;q_++){var qa=qS[q_],qR=qa.color;this._colorKeyData[this.index++]=qR._r,this._colorKeyData[this.index++]=qR._g,this._colorKeyData[this.index++]=qR._b,this._colorKeyData[this.index++]=qa.time}}),qt(0,q_,"alphaKeys",function(){return this._alphaKeys},function(qS){this._alphaKeys=qS;for(var q_=this.index=0;q_<qS.length;q_++){var qa=qS[q_];this._alphaKeyData[this.index++]=qa.alpha,this._alphaKeyData[this.index++]=qa.time}})}(),function(){function qS(qS,q_){this._alpha=NaN,this._time=NaN,void 0===qS&&(qS=0),void 0===q_&&(q_=0),this._alpha=qS,this._time=q_}qG(qS,"laya.d3.core.trail.module.GradientAlphaKey");var q_=qS.prototype;return q_.cloneTo=function(qS){qS.alpha=this.alpha,qS.time=this.time},qt(0,q_,"alpha",function(){return this._alpha},function(qS){this._alpha=qS}),qt(0,q_,"time",function(){return this._time},function(qS){this._time=qS}),qS}()),qv=function(){function qS(qS,q_){this._color=null,this._time=NaN,void 0===q_&&(q_=0),this._color=qS||new qO,this._time=q_}qG(qS,"laya.d3.core.trail.module.GradientColorKey");var q_=qS.prototype;return q_.cloneTo=function(qS){this.color.cloneTo(qS.color),qS.time=this.time},qt(0,q_,"color",function(){return this._color},function(qS){this._color=qS}),qt(0,q_,"time",function(){return this._time},function(qS){this._time=qS}),qS}(),qd=(function(){function qS(){}qG(qS,"laya.d3.core.trail.module.GradientMode"),qS.Blend=0,qS.Fixed=1}(),function(){function qS(){}qG(qS,"laya.d3.core.trail.module.TextureMode"),qS.Stretch=0,qS.Tile=1}(),function(){function qS(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}qG(qS,"laya.d3.core.trail.module.TrailKeyFrame"),qS.prototype.cloneTo=function(qS){qS.time=this.time,qS.inTangent=this.inTangent,qS.outTangent=this.outTangent,qS.value=this.value}}(),function(){function q_(qS){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new qW_,this._curPosition=new qW_,this._delVector3=new qW_,this._lastFixedVertexPosition=new qW_,this._pointAtoBVector3=new qW_,this._pointA=new qW_,this._pointB=new qW_,this._owner=qS,this._id=q_.renderElementCount++,0==this._id?qS._owner.transform.position.cloneTo(this._lastPosition):qS._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new qg_(qd.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new qg_(qd.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}qG(q_,"laya.d3.core.trail.TrailRenderElement");var qS=q_.prototype;qQ.imps(qS,{"laya.d3.core.render.IRenderable":!0}),qS._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},qS._addTrailByFirstPosition=function(qS,q_){qW_.subtract(q_,qS,this._delVector3),qW_.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),qW_.normalize(this._pointAtoBVector3,this._pointAtoBVector3),qW_.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(qS),qS.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},qS._addTrailByNextPosition=function(qS){qW_.subtract(qS,this._lastFixedVertexPosition,this._delVector3),qW_.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),qW_.normalize(this._pointAtoBVector3,this._pointAtoBVector3),qW_.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=qW_.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=qvS.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(qS),qS.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(qS),this._virtualVerticesCount=2)},qS._updateVerticesByPosition=function(qS){this._pointe=qS.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},qS._updateVertexBuffer2=function(){var qS,q_=0,qa=0,qR=0;for(qR=0,qS=(this._verticesCount+this._virtualVerticesCount)/2;qR<qS;qR++)qa=0==this._owner.textureMode?(this._VerticesToTailLength[qR]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[qR],this._vertices2[q_++]=1-qa,this._vertices2[q_++]=1-qa;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},qS._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},qS._updateDisappear=function(){var qS,q_=0;for(q_=this._curDisappearIndex,qS=(this._verticesCount+this._virtualVerticesCount)/2;q_<qS;q_++)this._owner._curtime-this._everyGroupVertexBirthTime[q_]>=this._owner.time+qvS.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},qS._beforeRender=function(qS){return this._camera=qS.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),qW_.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},qS._render=function(qS){this._isDead||(qA.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),qN.drawCall++,qN.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},qS._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),0===qS?this._vertexBuffer1:1===qS?this._vertexBuffer2:null},qS._getVertexBuffers=function(){return this._vertexBuffers},qS._getIndexBuffer=function(){return null},qS.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},qS._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},qt(0,qS,"_vertexBufferCount",function(){return this._vertexBuffers.length}),qt(0,qS,"triangleCount",function(){return 0}),q_.renderElementCount=0}(),function(){function qS(){}qG(qS,"laya.d3.core.trail.VertexTrail");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration1}),qt(1,qS,"vertexDeclaration1",function(){return qS._vertexDeclaration1}),qt(1,qS,"vertexDeclaration2",function(){return qS._vertexDeclaration2}),qL(qS,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new qVS(32,[new qWS(0,"vector3",0),new qWS(12,"vector3",41),new qWS(24,"single",33),new qWS(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new qVS(4,[new qWS(0,"single",38)])}]),qS}()),qSS=function(){function qj(qS){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=qS}qG(qj,"laya.d3.graphics.DynamicBatch");var qS=qj.prototype;return qQ.imps(qS,{"laya.d3.core.render.IRenderable":!0}),qS._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),0===qS?this._vertexBuffer:null},qS._getIndexBuffer=function(){return this._indexBuffer},qS._getCombineRenderElementFromPool=function(qS,q_,qa){var qR=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return qR||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=qR=new qp,qR._sprite3D=new qc_),qR._sprite3D._render._renderUpdate(qa),qR},qS._getRenderElement=function(qS,q_,qa){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*qj.maxVertexCount),this._indexDatas=new Uint16Array(qj.maxIndexCount),this._vertexBuffer=qg_.create(this._vertexDeclaration,qj.maxVertexCount,35048),this._indexBuffer=qe_.create("ushort",qj.maxIndexCount,35048));for(var qR=this._merageElements.length=0,qJ=0,qV=0,qW=this._combineRenderElements.length;qV<qW;qV++){var qk=this._combineRenderElements[qV],qz=qk.getDynamicBatchBakedVertexs(0),qb=qk.getBakedIndices(),qH=qk._sprite3D.transform._isFrontFaceInvert,qL=qR/(this._vertexDeclaration.vertexStride/4),qC=qJ,qG=qC+qb.length;qk._tempBatchIndexStart=qC,qk._tempBatchIndexEnd=qG,this._indexDatas.set(qb,qJ);var qt=0;if(qH)for(qt=qC;qt<qG;qt+=3){this._indexDatas[qt]=qL+this._indexDatas[qt];var qo=this._indexDatas[qt+1],q$=this._indexDatas[qt+2];this._indexDatas[qt+1]=qL+q$,this._indexDatas[qt+2]=qL+qo}else for(qt=qC;qt<qG;qt+=3)this._indexDatas[qt]=qL+this._indexDatas[qt],this._indexDatas[qt+1]=qL+this._indexDatas[qt+1],this._indexDatas[qt+2]=qL+this._indexDatas[qt+2];qJ+=qb.length,this._vertexDatas.set(qz,qR),qR+=qz.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),qV=this._combineRenderElementPoolIndex=0,qW=this._materials.length;qV<qW;qV++){var qF=this._getCombineRenderElementFromPool(qS,q_,qa);qF._type=2,qF._staticBatch=null;var qT=(qF.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[qV]]._tempBatchIndexStart,qD=qV+1===this._materialToRenderElementsOffsets.length?qJ:this._combineRenderElements[this._materialToRenderElementsOffsets[qV+1]]._tempBatchIndexStart;qF._tempBatchIndexStart=qT,qF._tempBatchIndexEnd=qD,qF._material=this._materials[qV],this._merageElements.push(qF)}},qS._addCombineRenderObjTest=function(qS){var q_=qS.renderObj,qa=this._currentCombineIndexCount+q_._getIndexBuffer().indexCount,qR=this._currentCombineVertexCount+q_._getVertexBuffer().vertexCount;return!(qj.maxVertexCount<qR||qj.maxIndexCount<qa)},qS._addCombineRenderObj=function(qS){var q_=qS.renderObj;this._combineRenderElements.push(qS),this._currentCombineIndexCount=this._currentCombineIndexCount+q_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+q_._getVertexBuffer().vertexCount},qS._addCombineMaterial=function(qS){this._materials.push(qS)},qS._addMaterialToRenderElementOffset=function(qS){this._materialToRenderElementsOffsets.push(qS)},qS._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},qS._addToRenderQueue=function(qS,q_,qa,qR){this._getRenderElement(q_,qa,qR);for(var qJ=0,qV=this._materials.length;qJ<qV;qJ++)qS.getRenderQueue(this._materials[qJ].renderQueue)._addDynamicBatchElement(this._merageElements[qJ])},qS._beforeRender=function(qS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},qS._render=function(qS){var q_=qS._batchIndexEnd-qS._batchIndexStart;qA.mainContext.drawElements(4,q_,5123,2*qS._batchIndexStart),qN.drawCall++,qN.trianglesFaces+=q_/3},qS._getVertexBuffers=function(){return null},qt(0,qS,"_vertexBufferCount",function(){return 1}),qt(0,qS,"triangleCount",function(){return this._indexBuffer.indexCount/3}),qt(0,qS,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),qj.maxVertexCount=2e4,qj.maxIndexCount=4e4,qj.maxCombineTriangleCount=10,qj}(),q_S=function(){function qj(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}qG(qj,"laya.d3.graphics.DynamicBatchManager");var qS=qj.prototype;return qS.getDynamicBatch=function(qS,q_){var qa,qR=qS.id.toString()+q_;return this._dynamicBatches[qR]?qa=this._dynamicBatches[qR]:this._dynamicBatches[qR]=qa=new qSS(qS),qa},qS._garbageCollection=function(){for(var qS in this._dynamicBatches)0===this._dynamicBatches[qS].combineRenderElementsCount&&delete this._dynamicBatches[qS]},qS._addPrepareRenderElement=function(qS){this._prepareDynamicBatchCombineElements.push(qS)},qS._finishCombineDynamicBatch=function(qS){var q_,qa,qR;this._prepareDynamicBatchCombineElements.sort(qj._sortPrepareDynamicBatch);for(var qJ,qV,qW,qk,qz,qb=-1,qH=!0,qL=0,qC=-1,qG=0,qt=this._prepareDynamicBatchCombineElements.length;qG<qt;qG++){var qo=(qV=this._prepareDynamicBatchCombineElements[qG]).renderObj._getVertexBuffer(0).vertexDeclaration,q$=qa!==qo;q$&&(qL=0,qa=qo);var qF=qL!==qb;if(qF&&(qb=qL),(q$||qF)&&(qW=this.getDynamicBatch(qo,qL),q_=null),qH)if(qW._addCombineRenderObjTest(qV)){if(q_!==(qJ=qV._material))qk&&(qS.getRenderQueue(qz._material.renderQueue)._addRenderElement(qz),qz=qk=null,qC=-1),qk=qJ,qC=qW.combineRenderElementsCount,qz=qV,q_=qJ;else if(qk){var qT=qz.renderObj,qD=qV.renderObj;qT._getVertexBuffer().vertexCount+qD._getVertexBuffer().vertexCount>qSS.maxVertexCount||qT._getIndexBuffer().indexCount+qD._getIndexBuffer().indexCount>qSS.maxIndexCount?(qS.getRenderQueue(qz._material.renderQueue)._addRenderElement(qz),qk=qJ,qC=qW.combineRenderElementsCount,qz=qV):(qW._addCombineMaterial(qk),qW._addMaterialToRenderElementOffset(qC),qW._addCombineRenderObj(qz),qz=qk=null,qC=-1,qW._addCombineRenderObj(qV))}else qW._addCombineRenderObj(qV);qH=!0}else qk&&(qS.getRenderQueue(qz._material.renderQueue)._addRenderElement(qz),qz=qk=null,qC=-1),qL++,qH=!1;else qR=this._prepareDynamicBatchCombineElements[qG-1],qW._addMaterialToRenderElementOffset(qW.combineRenderElementsCount),q_=qR._material,qW._addCombineMaterial(q_),qW._addCombineRenderObj(qR),qH=!0,q_!==(qJ=qV._material)?(qk=qJ,qC=qW.combineRenderElementsCount,qz=qV):qW._addCombineRenderObj(qV),q_=qJ}qk&&(qS.getRenderQueue(qz._material.renderQueue)._addRenderElement(qz),qz=qk=null,qC=-1),this._prepareDynamicBatchCombineElements.length=0},qS._clearRenderElements=function(){for(var qS in this._dynamicBatches)this._dynamicBatches[qS]._clearRenderElements()},qS._addToRenderQueue=function(qS,q_,qa,qR){for(var qJ in this._dynamicBatches){var qV=this._dynamicBatches[qJ];0<qV.combineRenderElementsCount&&qV._addToRenderQueue(qS,q_,qa,qR)}},qS.dispose=function(){this._dynamicBatches=null},qj._sortPrepareDynamicBatch=function(qS,q_){return qS._mainSortID-q_._mainSortID},qj}(),qaS=function(){function qS(){}return qG(qS,"laya.d3.graphics.FrustumCulling"),qS.renderShadowObjectCulling=function(qS,q_,qa,qR,qJ){var qV=0,qW=0,qk=0,qz=0;for(qV=0,qk=qa.length;qV<qk;qV++){var qb=qa[qV];qb&&qb._clearRenderElements()}var qH,qL,qC,qG=qS._cullingRenders;if(1<qJ){for(qV=0,qk=qS._cullingRendersLength;qV<qk;qV++)if((qH=qG[qV]).castShadow&&qu.isVisible(qH._owner.layer.mask)&&qH.enable)for(var qt=1,qo=q_.length;qt<qo;qt++)if(qL=qa[qt-1],0!==q_[qt].containsBoundSphere(qH.boundingSphere))for(qW=0,qz=(qC=qH._renderElements).length;qW<qz;qW++)qL._addRenderElement(qC[qW])}else for(qV=0,qk=qS._cullingRendersLength;qV<qk;qV++)if((qH=qG[qV]).castShadow&&qu.isVisible(qH._owner.layer.mask)&&qH.enable&&0!==q_[0].containsBoundSphere(qH.boundingSphere))for(qH._renderUpdate(qR),qL=qa[0],qW=0,qz=(qC=qH._renderElements).length;qW<qz;qW++)qL._addRenderElement(qC[qW])},qS.renderShadowObjectCullingOctree=function(qS,q_,qa,qR,qJ){for(var qV=0,qW=qa.length;qV<qW;qV++){var qk=qa[qV];qk&&qk._clearRenderElements()}1<qJ?qS.treeRoot.cullingShadowObjects(q_,qa,!0,0,qS):qS.treeRoot.cullingShadowObjectsOnePSSM(q_[0],qa,qR,!0,0,qS)},qS.renderObjectCulling=function(qS,q_,qa,qR,qJ,qV){var qW=0,qk=0,qz=0,qb=0,qH=q_._quenes,qL=q_._dynamicBatchManager,qC=q_._cullingRenders;for(qW=0,qk=qH.length;qW<qk;qW++){var qG=qH[qW];qG&&qG._clearRenderElements()}var qt=qRS._staticBatchManagers;for(qW=0,qk=qt.length;qW<qk;qW++)qt[qW]._clearRenderElements();qL._clearRenderElements();var qo=qa.transform.position;for(qW=0,qk=q_._cullingRendersLength;qW<qk;qW++){var q$=qC[qW];if(qu.isVisible(q$._owner.layer.mask)&&q$.enable&&0!==qS.containsBoundSphere(q$.boundingSphere)&&q$._renderUpdate(qV)){q$._distanceForSort=qW_.distance(q$.boundingSphere.center,qo)+q$.sortingFudge;var qF=q$._renderElements;for(qz=0,qb=qF.length;qz<qb;qz++){var qT=qF[qz],qD=qT._staticBatch;if(qD&&qD._material===qT._material)qD._addBatchRenderElement(qT);else{var qj=qT.renderObj;qj.triangleCount<10&&1===qj._vertexBufferCount&&qj._getIndexBuffer()&&qT._material.renderQueue<2&&qT._canDynamicBatch&&!q$._owner.isStatic?qL._addPrepareRenderElement(qT):q_.getRenderQueue(qT._material.renderQueue)._addRenderElement(qT)}}}}for(qW=0,qk=qt.length;qW<qk;qW++)qt[qW]._addToRenderQueue(q_,qR,qJ,qV);qL._finishCombineDynamicBatch(q_),qL._addToRenderQueue(q_,qR,qJ,qV)},qS.renderObjectCullingOctree=function(qS,q_,qa,qR,qJ,qV){var qW=0,qk=0,qz=q_._quenes,qb=q_._dynamicBatchManager;for(qW=0,qk=qz.length;qW<qk;qW++){var qH=qz[qW];qH&&qH._clearRenderElements()}var qL=qRS._staticBatchManagers;for(qW=0,qk=qL.length;qW<qk;qW++)qL[qW]._clearRenderElements();for(qb._clearRenderElements(),q_._cullingRenders.length=0,q_.treeRoot.cullingObjects(qS,!0,0,qa.transform.position,qV),qW=0,qk=qL.length;qW<qk;qW++)qL[qW]._addToRenderQueue(q_,qR,qJ,qV);qb._finishCombineDynamicBatch(q_),qb._addToRenderQueue(q_,qR,qJ,qV)},qS.renderObjectCullingNoBoundFrustum=function(qS,q_,qa,qR,qJ){var qV=0,qW=0,qk=0,qz=0,qb=qS._quenes,qH=qS._dynamicBatchManager,qL=qS._cullingRenders;for(qV=0,qW=qb.length;qV<qW;qV++){var qC=qb[qV];qC&&qC._clearRenderElements()}var qG=qRS._staticBatchManagers;for(qV=0,qW=qG.length;qV<qW;qV++)qG[qV]._clearRenderElements();qH._clearRenderElements();var qt=q_.transform.position;for(qV=0,qW=qS._cullingRendersLength;qV<qW;qV++){var qo=qL[qV];if(qu.isVisible(qo._owner.layer.mask)&&qo.enable){qo._renderUpdate(qJ),qo._distanceForSort=qW_.distance(qo.boundingSphere.center,qt)+qo.sortingFudge;var q$=qo._renderElements;for(qk=0,qz=q$.length;qk<qz;qk++){var qF=q$[qk],qT=qF._staticBatch;if(qT&&qT._material===qF._material)qT._addBatchRenderElement(qF);else{var qD=qF.renderObj;qD.triangleCount<10&&1===qD._vertexBufferCount&&qD._getIndexBuffer()&&qF._material.renderQueue<2&&qF._canDynamicBatch&&!qo._owner.isStatic?qH._addPrepareRenderElement(qF):qS.getRenderQueue(qF._material.renderQueue)._addRenderElement(qF)}}}}for(qV=0,qW=qG.length;qV<qW;qV++)qG[qV]._addToRenderQueue(qS,qa,qR,qJ);qH._finishCombineDynamicBatch(qS),qH._addToRenderQueue(qS,qa,qR,qJ)},qS}(),qRS=function(){function qV(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}qG(qV,"laya.d3.graphics.StaticBatchManager");var qS=qV.prototype;return qS._finishInit=function(){for(var qS in this._staticBatches)this._staticBatches[qS]._finishInit();this._initBatchRenderElements.length=0},qS._initStaticBatchs=function(qS){throw new Error("StaticBatchManager:must override this function.")},qS._addInitBatchSprite=function(qS){for(var q_=qS._render._renderElements,qa=0,qR=q_.length;qa<qR;qa++)this._initBatchRenderElements.push(q_[qa])},qS._clearRenderElements=function(){for(var qS in this._staticBatches)this._staticBatches[qS]._clearRenderElements()},qS._garbageCollection=function(qS){var q_=qS._staticBatch,qa=q_._initBatchRenderElements,qR=qa.indexOf(qS);qa.splice(qR,1),0===qa.length&&(q_.dispose(),delete this._staticBatches[q_._key])},qS._addToRenderQueue=function(qS,q_,qa,qR){for(var qJ in this._staticBatches){var qV=this._staticBatches[qJ];0<qV._batchRenderElements.length&&qV._updateToRenderQueue(qS,qR)}},qS.dispose=function(){this._staticBatches=null},qV._addToStaticBatchQueue=function(qS){qS instanceof laya.d3.core.RenderableSprite3D&&qS._addToInitStaticBatchManager();for(var q_=0,qa=qS.numChildren;q_<qa;q_++)qV._addToStaticBatchQueue(qS._childs[q_])},qV.combine=function(qS,q_){var qa,qR=0,qJ=0;if(q_)for(qR=0,qJ=q_.length;qR<qJ;qR++){q_[qR]._addToInitStaticBatchManager()}else qS&&qV._addToStaticBatchQueue(qS);for(qR=0,qJ=qV._staticBatchManagers.length;qR<qJ;qR++)(qa=qV._staticBatchManagers[qR])._initStaticBatchs(qS),qa._finishInit()},qV._staticBatchManagers=[],qV}(),qJS=function(){function qS(qS,q_,qa){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=qS,this._manager=q_,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=qa}qG(qS,"laya.d3.graphics.StaticBatch");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),q_._binarySearch=function(qS){for(var q_=0,qa=this._batchRenderElements.length-1,qR=0;q_<=qa;)qR=Math.floor((q_+qa)/2),this._compareBatchRenderElement(this._batchRenderElements[qR],qS)?qa=qR-1:q_=qR+1;return q_},q_._compareBatchRenderElement=function(qS,q_){throw new Error("StaticBatch:must override this function.")},q_._getVertexDecLightMap=function(qS){return qS===qeS.vertexDeclaration?quS.vertexDeclaration:qS===qrS.vertexDeclaration?qhS.vertexDeclaration:qS===qnS.vertexDeclaration?qjS.vertexDeclaration:qS===qUS.vertexDeclaration?null:qS===qoS.vertexDeclaration?q$S.vertexDeclaration:qS===qxS.vertexDeclaration?qPS.vertexDeclaration:qS===qAS.vertexDeclaration?qXS.vertexDeclaration:qS===qgS.vertexDeclaration?qKS.vertexDeclaration:qS===qrS.vertexDeclaration?qhS.vertexDeclaration:qS===qlS.vertexDeclaration?qQS.vertexDeclaration:qS===qUS.vertexDeclaration?null:qS===qoS.vertexDeclaration?q$S.vertexDeclaration:qS===qsS.vertexDeclaration?qMS.vertexDeclaration:qS===qAS.vertexDeclaration?qXS.vertexDeclaration:qS},q_._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},q_._addBatchRenderElement=function(qS){this._batchRenderElements.splice(this._binarySearch(qS),0,qS)},q_._updateToRenderQueue=function(qS,q_){this._combineRenderElementPoolIndex=0,this._getRenderElement(qS.getRenderQueue(this._material.renderQueue)._renderElements,qS,q_)},q_._getRenderElement=function(qS,q_,qa){throw new Error("StaticBatch:must override this function.")},q_._finishInit=function(){throw new Error("StaticBatch:must override this function.")},q_._clearRenderElements=function(){this._batchRenderElements.length=0},q_.dispose=function(){},q_._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),null},q_._getIndexBuffer=function(){return null},q_._beforeRender=function(qS){return!0},q_._render=function(qS){},q_._getVertexBuffers=function(){return null},qt(0,q_,"_vertexBufferCount",function(){return 1}),qt(0,q_,"triangleCount",function(){return 0}),qS.combine=function(qS){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),qRS.combine(qS)},qS.maxBatchVertexCount=65535,qS}(),qVS=function(){function qW(qS,q_){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++qW._uniqueIDCounter,this._id>qW.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",qW.maxVertexDeclaration);this._shaderValues=new qC_,this._vertexElementsDic={},this._vertexStride=qS,this._vertexElements=q_;for(var qa=0;qa<q_.length;qa++){var qR=q_[qa],qJ=qR.elementUsage;this._vertexElementsDic[qJ]=qR;var qV=[qW._getTypeSize(qR.elementFormat)/4,5126,!1,this._vertexStride,qR.offset];switch(this._shaderValues.setValue(qJ,qV),qJ){case 1:this._addShaderDefine(qN_.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(qN_.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(qN_.SHADERDEFINE_UV1)}}}qG(qW,"laya.d3.graphics.VertexDeclaration");var qS=qW.prototype;return qS._addShaderDefine=function(qS){this._shaderDefineValue|=qS},qS._removeShaderDefine=function(qS){this._shaderDefineValue&=~qS},qS.getVertexElements=function(){return this._vertexElements.slice()},qS.getVertexElementByUsage=function(qS){return this._vertexElementsDic[qS]},qS.unBinding=function(){},qt(0,qS,"shaderDefineValue",function(){return this._shaderDefineValue}),qt(0,qS,"id",function(){return this._id}),qt(0,qS,"vertexStride",function(){return this._vertexStride}),qt(0,qS,"shaderValues",function(){return this._shaderValues}),qW._getTypeSize=function(qS){switch(qS){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},qW.getVertexStride=function(qS){for(var q_=0,qa=0;qa<qS.Length;qa++){var qR=qS[qa],qJ=qR.offset+qW._getTypeSize(qR.elementFormat);q_<qJ&&(q_=qJ)}return q_},qW._maxVertexDeclarationBit=1e3,qW._uniqueIDCounter=1,qL(qW,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),qW}(),qWS=function(){function qS(qS,q_,qa){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=qS,this.elementFormat=q_,this.elementUsage=qa}return qG(qS,"laya.d3.graphics.VertexElement"),qS}(),qkS=(function(){function qS(){}qG(qS,"laya.d3.graphics.VertexElementFormat"),qS.Single="single",qS.Vector2="vector2",qS.Vector3="vector3",qS.Vector4="vector4",qS.Color="color",qS.Byte4="byte4",qS.Short2="short2",qS.Short4="short4",qS.NormalizedShort2="normalizedshort2",qS.NormalizedShort4="normalizedshort4",qS.HalfVector2="halfvector2",qS.HalfVector4="halfvector4"}(),function(){function qS(){}qG(qS,"laya.d3.graphics.VertexElementUsage"),qS.POSITION0=0,qS.COLOR0=1,qS.TEXTURECOORDINATE0=2,qS.NORMAL0=3,qS.BINORMAL0=4,qS.TANGENT0=5,qS.BLENDINDICES0=6,qS.BLENDWEIGHT0=7,qS.DEPTH0=8,qS.FOG0=9,qS.POINTSIZE0=10,qS.SAMPLE0=11,qS.TESSELLATEFACTOR0=12,qS.COLOR1=13,qS.NEXTTEXTURECOORDINATE0=14,qS.TEXTURECOORDINATE1=15,qS.NEXTTEXTURECOORDINATE1=16,qS.CORNERTEXTURECOORDINATE0=17,qS.VELOCITY0=18,qS.STARTCOLOR0=19,qS.STARTSIZE=20,qS.AGEADDSCALE0=21,qS.STARTROTATION=22,qS.ENDCOLOR0=23,qS.STARTLIFETIME=24,qS.TIME0=33,qS.SHAPEPOSITIONSTARTLIFETIME=30,qS.DIRECTIONTIME=32,qS.SIZEROTATION0=27,qS.RADIUS0=28,qS.RADIAN0=29,qS.STARTSPEED=31,qS.RANDOM0=34,qS.RANDOM1=35,qS.SIMULATIONWORLDPOSTION=36,qS.SIMULATIONWORLDROTATION=37,qS.TEXTURECOORDINATE0X=38,qS.TEXTURECOORDINATE0X1=39,qS.TEXTURECOORDINATE0Y=40,qS.OFFSETVECTOR=41}(),function(){function qS(qS,q_,qa){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=qS,this._textureCoordinate0=q_,this._time=qa}qG(qS,"laya.d3.graphics.VertexGlitter");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate0}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"time",function(){return this._time}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(24,[new qWS(0,"vector3",0),new qWS(12,"vector2",2),new qWS(20,"single",33)])}])}(),function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=qS,this._position=q_,this._velocity=qa,this._startColor=qR,this._endColor=qJ,this._sizeRotation=qV,this._radius=qW,this._radian=qk,this._ageAddScale=qz,this._time=qb}qG(qS,"laya.d3.graphics.VertexParticle");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"endColor",function(){return this._endColor}),qt(0,q_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),qt(0,q_,"sizeRotation",function(){return this._sizeRotation}),qt(0,q_,"velocity",function(){return this._velocity}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"startColor",function(){return this._startColor}),qt(0,q_,"radius",function(){return this._radius}),qt(0,q_,"radian",function(){return this._radian}),qt(0,q_,"ageAddScale",function(){return this._ageAddScale}),qt(0,q_,"time",function(){return this._time}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(116,[new qWS(0,"vector4",17),new qWS(16,"vector3",0),new qWS(28,"vector3",18),new qWS(40,"vector4",19),new qWS(56,"vector4",23),new qWS(72,"vector3",27),new qWS(84,"vector2",28),new qWS(92,"vector4",29),new qWS(108,"single",24),new qWS(112,"single",33)])}])}(),function(){function qS(qS){this._position=null,this._position=qS}qG(qS,"laya.d3.graphics.VertexPosition");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(12,[new qWS(0,"vector3",0)])}]),qS}()),qzS=function(){function qS(qS,q_){this._position=null,this._normal=null,this._position=qS,this._normal=q_}qG(qS,"laya.d3.graphics.VertexPositionNormal");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(24,[new qWS(0,"vector3",0),new qWS(12,"vector3",3)])}]),qS}(),qbS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._color=null,this._position=qS,this._normal=q_,this._color=qa}qG(qS,"laya.d3.graphics.VertexPositionNormalColor");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(40,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1)])}]),qS}(),qHS=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=qS,this._normal=q_,this._color=qa,this._blendIndex=qR,this._blendWeight=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalColorSkin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(72,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector4",7),new qWS(56,"vector4",6)])}]),qS}(),qLS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._tangent=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(88,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector4",7),new qWS(56,"vector4",6),new qWS(72,"vector4",5)])}]),qS}(),qCS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._tangent=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(84,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector4",7),new qWS(56,"vector4",6),new qWS(72,"vector3",5)])}]),qS}(),qGS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._tangent=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalColorSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(56,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector4",5)])}]),qS}(),qtS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._tangent=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(52,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector3",5)])}]),qS}(),qoS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(48,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2)])}]),qS}(),q$S=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(56,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15)])}]),qS}(),qFS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._blendIndex=qV,this._blendWeight=qW}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(88,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15),new qWS(56,"vector4",7),new qWS(72,"vector4",6)])}]),qS}(),qTS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._tangent=qV,this._blendIndex=qW,this._blendWeight=qk}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(104,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15),new qWS(56,"vector4",7),new qWS(72,"vector4",6),new qWS(88,"vector4",5)])}]),qS}(),qDS=function(){function qS(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),q_.VertexPositionNormalColorTexture0SkinTangent=function(qS,q_,qa,qR,qJ,qV,qW,qk){this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._tangent=qV,this._blendIndex=qW,this._blendWeight=qk},qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(100,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15),new qWS(56,"vector4",7),new qWS(72,"vector4",6),new qWS(88,"vector3",5)])}]),qS}(),qjS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._tangent=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(72,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15),new qWS(56,"vector4",5)])}]),qS}(),qQS=function(){function qS(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),q_.VertexPositionNormalColorTexture0Tangent=function(qS,q_,qa,qR,qJ,qV){this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._tangent=qV},qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(68,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector2",15),new qWS(56,"vector3",5)])}]),qS}(),qmS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(80,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector4",7),new qWS(64,"vector4",6)])}]),qS}(),qqS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR,this._tangent=qJ,this._blendIndex=qV,this._blendWeight=qW}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(96,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector4",7),new qWS(64,"vector4",6),new qWS(80,"vector4",5)])}]),qS}(),qNS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR,this._tangent=qJ,this._blendIndex=qV,this._blendWeight=qW}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(92,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector4",7),new qWS(64,"vector4",6),new qWS(80,"vector3",5)])}]),qS}(),qnS=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR,this._tangent=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(64,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector4",5)])}]),qS}(),qlS=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=qS,this._normal=q_,this._color=qa,this._textureCoordinate=qR,this._tangent=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"color",function(){return this._color}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(60,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",1),new qWS(40,"vector2",2),new qWS(48,"vector3",5)])}]),qS}(),qBS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._tangent=null,this._position=qS,this._normal=q_,this._tangent=qa}qG(qS,"laya.d3.graphics.VertexPositionNormalSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(40,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector4",5)])}]),qS}(),qIS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._tangent=null,this._position=qS,this._normal=q_,this._tangent=qa}qG(qS,"laya.d3.graphics.VertexPositionNormalTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(36,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector3",5)])}]),qS}(),qAS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(32,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2)])}]),qS}(),qXS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(40,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15)])}]),qS}(),qhS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(72,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15),new qWS(40,"vector4",7),new qWS(56,"vector4",6)])}]),qS}(),quS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR,this._tangent=qJ,this._blendIndex=qV,this._blendWeight=qW}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(88,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15),new qWS(40,"vector4",7),new qWS(56,"vector4",6),new qWS(72,"vector4",5)])}]),qS}(),qKS=function(){function qS(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),q_.VertexPositionNormalTexture0SkinTangent=function(qS,q_,qa,qR,qJ,qV,qW){this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR,this._tangent=qJ,this._blendIndex=qV,this._blendWeight=qW},qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(84,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15),new qWS(40,"vector4",7),new qWS(56,"vector4",6),new qWS(72,"vector3",5)])}]),qS}(),qPS=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR,this._tangent=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(56,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15),new qWS(40,"vector4",5)])}]),qS}(),qMS=function(){function qS(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}qG(qS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),q_.VertexPositionNormalTexture0Tangent=function(qS,q_,qa,qR,qJ){this._position=qS,this._normal=q_,this._textureCoordinate0=qa,this._textureCoordinate1=qR,this._tangent=qJ},qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(52,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15),new qWS(40,"vector3",5)])}]),qS}(),qrS=function(){function qS(qS,q_,qa,qR,qJ){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa,this._blendIndex=qR,this._blendWeight=qJ}qG(qS,"laya.d3.graphics.VertexPositionNormalTextureSkin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(64,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector4",7),new qWS(48,"vector4",6)])}]),qS}(),qeS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa,this._tangent=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(80,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector4",7),new qWS(48,"vector4",6),new qWS(64,"vector4",5)])}]),qS}(),qgS=function(){function qS(qS,q_,qa,qR,qJ,qV){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa,this._tangent=qR,this._blendIndex=qJ,this._blendWeight=qV}qG(qS,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(76,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector4",7),new qWS(48,"vector4",6),new qWS(64,"vector3",5)])}]),qS}(),qxS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa,this._tangent=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(48,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector4",5)])}]),qS}(),qsS=function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa,this._tangent=qR}qG(qS,"laya.d3.graphics.VertexPositionNormalTextureTangent");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(44,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector3",5)])}]),qS}(),qUS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa}qG(qS,"laya.d3.graphics.VertexPositionNTBTexture");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(56,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector3",5),new qWS(36,"vector3",4),new qWS(48,"vector2",2)])}]),qS}(),qfS=function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=qS,this._normal=q_,this._textureCoordinate0=qR,this._textureCoordinate1=qJ,this._tangent=qV,qa=qa,this._blendIndex=qW,this._blendWeight=qk}qG(qS,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"tangent",function(){return this._tangent}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(0,q_,"textureCoordinate1",function(){return this._textureCoordinate1}),qt(0,q_,"blendIndex",function(){return this._blendIndex}),qt(0,q_,"blendWeight",function(){return this._blendWeight}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(96,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector3",5),new qWS(36,"vector3",4),new qWS(48,"vector2",2),new qWS(56,"vector2",15),new qWS(64,"vector4",7),new qWS(80,"vector4",6)])}]),qS}(),qYS=function(){function qS(qS,q_,qa){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=qS,this._normal=q_,this._textureCoordinate=qa}qG(qS,"laya.d3.graphics.VertexPositionNTBTextureSkin");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"textureCoordinate",function(){return this._textureCoordinate}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(88,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector3",5),new qWS(36,"vector3",4),new qWS(48,"vector2",2),new qWS(56,"vector4",7),new qWS(72,"vector4",6)])}]),qS}(),qiS=(function(){function qS(qS,q_,qa,qR){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=qS,this._normal=q_,this._textureCoord0=qa,this._textureCoord1=qR}qG(qS,"laya.d3.graphics.VertexPositionTerrain");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"normal",function(){return this._normal}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoord0",function(){return this._textureCoord0}),qt(0,q_,"textureCoord1",function(){return this._textureCoord1}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(40,[new qWS(0,"vector3",0),new qWS(12,"vector3",3),new qWS(24,"vector2",2),new qWS(32,"vector2",15)])}])}(),function(){function qS(qS,q_){this._position=null,this._textureCoordinate0=null,this._position=qS,this._textureCoordinate0=q_}qG(qS,"laya.d3.graphics.VertexPositionTexture0");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"position",function(){return this._position}),qt(0,q_,"textureCoordinate0",function(){return this._textureCoordinate0}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(20,[new qWS(0,"vector3",0),new qWS(12,"vector2",2)])}]),qS}()),qZS=(function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL,qC,qG){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=qS,this._positionStartLifeTime=q_,this._velocity=qa,this._startColor=qR,this._startSize=qJ,this._startRotation0=qV,this._startRotation1=qW,this._startRotation2=qk,this._startLifeTime=qz,this._time=qb,this._startSpeed=qH,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=qG}qG(qS,"laya.d3.graphics.VertexShurikenParticleBillboard");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),qt(0,q_,"random1",function(){return this._randoms1}),qt(0,q_,"startRotation2",function(){return this._startRotation2}),qt(0,q_,"positionStartLifeTime",function(){return this._positionStartLifeTime}),qt(0,q_,"velocity",function(){return this._velocity}),qt(0,q_,"random0",function(){return this._randoms0}),qt(0,q_,"startSize",function(){return this._startSize}),qt(0,q_,"startColor",function(){return this._startColor}),qt(0,q_,"startRotation0",function(){return this._startRotation0}),qt(0,q_,"startRotation1",function(){return this._startRotation1}),qt(0,q_,"startLifeTime",function(){return this._startLifeTime}),qt(0,q_,"time",function(){return this._time}),qt(0,q_,"startSpeed",function(){return this._startSpeed}),qt(0,q_,"simulationWorldPostion",function(){return this._simulationWorldPostion}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(152,[new qWS(0,"vector4",17),new qWS(16,"vector4",30),new qWS(32,"vector4",32),new qWS(48,"vector4",19),new qWS(64,"vector3",20),new qWS(76,"vector3",22),new qWS(88,"single",31),new qWS(92,"vector4",34),new qWS(108,"vector4",35),new qWS(124,"vector3",36),new qWS(136,"vector4",37)])}])}(),function(){function qS(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL,qC,qG){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=qS,this._positionStartLifeTime=q_,this._velocity=qa,this._startColor=qR,this._startSize=qJ,this._startRotation0=qV,this._startRotation1=qW,this._startRotation2=qk,this._startLifeTime=qz,this._time=qb,this._startSpeed=qH,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=qG}qG(qS,"laya.d3.graphics.VertexShurikenParticleMesh");var q_=qS.prototype;qQ.imps(q_,{"laya.d3.graphics.IVertex":!0}),qt(0,q_,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),qt(0,q_,"velocity",function(){return this._velocity}),qt(0,q_,"position",function(){return this._positionStartLifeTime}),qt(0,q_,"random0",function(){return this._randoms0}),qt(0,q_,"startSize",function(){return this._startSize}),qt(0,q_,"startColor",function(){return this._startColor}),qt(0,q_,"startRotation0",function(){return this._startRotation0}),qt(0,q_,"startRotation1",function(){return this._startRotation1}),qt(0,q_,"random1",function(){return this._randoms1}),qt(0,q_,"startRotation2",function(){return this._startRotation2}),qt(0,q_,"startLifeTime",function(){return this._startLifeTime}),qt(0,q_,"time",function(){return this._time}),qt(0,q_,"startSpeed",function(){return this._startSpeed}),qt(0,q_,"simulationWorldPostion",function(){return this._simulationWorldPostion}),qt(0,q_,"vertexDeclaration",function(){return qS._vertexDeclaration}),qt(1,qS,"vertexDeclaration",function(){return qS._vertexDeclaration}),qL(qS,["_vertexDeclaration",function(){return this._vertexDeclaration=new qVS(172,[new qWS(0,"vector3",0),new qWS(12,"vector4",1),new qWS(28,"vector2",2),new qWS(36,"vector4",30),new qWS(52,"vector4",32),new qWS(68,"vector4",19),new qWS(84,"vector3",20),new qWS(96,"vector3",22),new qWS(108,"single",31),new qWS(112,"vector4",34),new qWS(128,"vector4",35),new qWS(144,"vector3",36),new qWS(156,"vector4",37)])}])}(),function(){function qD(qS,q_,qa,qR,qJ,qV){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=qa,this._materials=qR,this._subMeshes=qJ,this._materialMap=qV,this._version=q_,this._onLoaded(qS)}qG(qD,"laya.d3.loaders.LoadModelV01");var qS=qD.prototype;return qS._onLoaded=function(qS){this._readData=qS,this.READ_BLOCK();for(var q_=0;q_<this._BLOCK.count;q_++){var qa=this._readData.getUint16(),qR=this._strings[qa],qJ=this["READ_"+qR];if(null==qJ)throw new Error("model file err,no this function:"+qa+" "+qR);if(!qJ.call(this))break}return this._mesh},qS.onError=function(){},qS._readString=function(){return this._strings[this._readData.getUint16()]},qS.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},qS.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},qS.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var qS=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var q_=0;q_<this._STRINGS.size;q_++)this._strings[q_]=this._readData.readUTFString();return this._readData.pos=qS,!0},qS.READ_MATERIAL=function(){var qS=this._readData.getUint16(),q_=(this._readString(),this._readString());return this._materials[qS]="null"!==q_?qF.getRes(this._materialMap[q_]):new qI_,!0},qS.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var qS,q_=this._readData.__getBuffer(),qa=0,qR=this._readData.getUint32(),qJ=this._readData.getUint32(),qV=(new Float32Array(q_.slice(qR+this._DATA.offset,qR+this._DATA.offset+qJ)),this._readData.getUint32()),qW=this._readData.getUint32(),qk=new Float32Array(q_.slice(qV+this._DATA.offset,qV+this._DATA.offset+qW));for(this.mesh._inverseBindPoses=[],qa=0,qS=qk.length;qa<qS;qa+=16){var qz=new qS_(qk[qa+0],qk[qa+1],qk[qa+2],qk[qa+3],qk[qa+4],qk[qa+5],qk[qa+6],qk[qa+7],qk[qa+8],qk[qa+9],qk[qa+10],qk[qa+11],qk[qa+12],qk[qa+13],qk[qa+14],qk[qa+15]);this.mesh._inverseBindPoses.push(qz)}break;default:throw new Error("LoadModel:unknown version.")}return!0},qS.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var qS=this._readString();this._shaderAttributes=qS.match(qD._attrReg);var q_=this._readData.getUint32(),qa=this._readData.getUint32(),qR=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),qJ=this._readData.getUint32(),qV=this._readData.getUint32(),qW=this._readData.getUint32(),qk=this._readData.__getBuffer(),qz=new qb_(this._mesh),qb=this._getVertexDeclaration(),qH=qg_.create(qb,qJ/qb.vertexStride,35044,!0),qL=qR+this._DATA.offset,qC=qk.slice(qL,qL+qJ);qH.setData(new Float32Array(qC));for(var qG=(qz._vertexBuffer=qH).vertexDeclaration.getVertexElements(),qt=0;qt<qG.length;qt++)qz._bufferUsage[qG[qt].elementUsage]=qH;var qo=qe_.create("ushort",qa/2,35044,!0),q$=q_+this._DATA.offset,qF=qk.slice(q$,q$+qa);qo.setData(new Uint16Array(qF)),qz._indexBuffer=qo;var qT=qk.slice(qV+this._DATA.offset,qV+this._DATA.offset+qW);return qz._boneIndicesList[0]=new Uint8Array(qT),this._subMeshes.push(qz),!0},qS.READ_DATAAREA=function(){return!1},qS._getVertexDeclaration=function(){for(var qS,q_=!1,qa=!1,qR=!1,qJ=!1,qV=!1,qW=!1,qk=!1,qz=!1,qb=!1,qH=0;qH<this._shaderAttributes.length;qH+=8)switch(this._shaderAttributes[qH]){case"POSITION":q_=!0;break;case"NORMAL":qa=!0;break;case"COLOR":qR=!0;break;case"UV":qJ=!0;break;case"UV1":qV=!0;break;case"BLENDWEIGHT":qk=!0;break;case"BLENDINDICES":qz=!0;break;case"TANGENT":qW=!0;break;case"BINORMAL":qb=!0}return q_&&qa&&qR&&qJ&&qV&&qk&&qz&&qW?qS=qDS.vertexDeclaration:q_&&qa&&qR&&qJ&&qV&&qk&&qz?qS=qFS.vertexDeclaration:q_&&qa&&qJ&&qV&&qk&&qz&&qW?qS=qKS.vertexDeclaration:q_&&qa&&qJ&&qV&&qk&&qz?qS=qhS.vertexDeclaration:q_&&qa&&qR&&qJ&&qk&&qz&&qW?qS=qNS.vertexDeclaration:q_&&qa&&qR&&qJ&&qk&&qz?qS=qmS.vertexDeclaration:q_&&qa&&qW&&qb&&qJ&&qk&&qz?qS=qYS.vertexDeclaration:q_&&qa&&qJ&&qk&&qz&&qW?qS=qgS.vertexDeclaration:q_&&qa&&qJ&&qk&&qz?qS=qrS.vertexDeclaration:q_&&qa&&qR&&qk&&qz&&qW?qS=qCS.vertexDeclaration:q_&&qa&&qR&&qk&&qz?qS=qHS.vertexDeclaration:q_&&qa&&qR&&qJ&&qV&&qW?qS=qQS.vertexDeclaration:q_&&qa&&qR&&qJ&&qV?qS=q$S.vertexDeclaration:q_&&qa&&qJ&&qV&&qW?qS=qMS.vertexDeclaration:q_&&qa&&qJ&&qV?qS=qXS.vertexDeclaration:q_&&qa&&qR&&qJ&&qW?qS=qlS.vertexDeclaration:q_&&qa&&qJ&&qW&&qb?qS=qUS.vertexDeclaration:q_&&qa&&qR&&qJ?qS=qoS.vertexDeclaration:q_&&qa&&qJ&&qW?qS=qsS.vertexDeclaration:q_&&qa&&qJ?qS=qAS.vertexDeclaration:q_&&qa&&qR&&qW?qS=qtS.vertexDeclaration:q_&&qa&&qR&&(qS=qbS.vertexDeclaration),qS},qt(0,qS,"mesh",function(){return this._mesh}),qD._attrReg=new RegExp("(\\w+)|([:,;])","g"),qD}()),qpS=function(){function qq(){}return qG(qq,"laya.d3.loaders.LoadModelV02"),qq.parse=function(qS,q_,qa,qR,qJ,qV){qq._mesh=qa,qq._materials=qR,qq._subMeshes=qJ,qq._materialMap=qV,qq._version=q_,qq._readData=qS,qq.READ_DATA(),qq.READ_BLOCK(),qq.READ_STRINGS();for(var qW=0,qk=qq._BLOCK.count;qW<qk;qW++){qq._readData.pos=qq._BLOCK.blockStarts[qW];var qz=qq._readData.getUint16(),qb=qq._strings[qz],qH=qq["READ_"+qb];if(null==qH)throw new Error("model file err,no this function:"+qz+" "+qb);qH.call()}qq._strings.length=0,qq._readData=null,qq._version=null,qq._mesh=null,qq._materials=null,qq._subMeshes=null,qq._materialMap=null},qq._readString=function(){return qq._strings[qq._readData.getUint16()]},qq.READ_DATA=function(){qq._DATA.offset=qq._readData.getUint32(),qq._DATA.size=qq._readData.getUint32()},qq.READ_BLOCK=function(){for(var qS=qq._BLOCK.count=qq._readData.getUint16(),q_=qq._BLOCK.blockStarts=[],qa=qq._BLOCK.blockLengths=[],qR=0;qR<qS;qR++)q_.push(qq._readData.getUint32()),qa.push(qq._readData.getUint32())},qq.READ_STRINGS=function(){var qS=qq._readData.getUint32(),q_=qq._readData.getUint16(),qa=qq._readData.pos;qq._readData.pos=qS+qq._DATA.offset;for(var qR=0;qR<q_;qR++)qq._strings[qR]=qq._readData.readUTFString();qq._readData.pos=qa},qq.READ_MATERIAL=function(){qq._readString(),qq._readString();var qS=qq._readString();return""!==qS&&qq._materials.push(qF.getRes(qq._materialMap[qS])),!0},qq.READ_MESH=function(){qq._readString();var qS,q_=qq._readData.__getBuffer(),qa=0,qR=qq._readData.getInt16(),qJ=qq._DATA.offset;for(qa=0;qa<qR;qa++){var qV=qJ+qq._readData.getUint32(),qW=qq._readData.getUint32(),qk=new Float32Array(q_.slice(qV,qV+qW)),qz=qq._readString().match(qq._attrReg),qb=qq._getVertexDeclaration(qz),qH=qg_.create(qb,4*qk.length/qb.vertexStride,35044,!0);qH.setData(qk),qq._mesh._vertexBuffers.push(qH)}var qL=qJ+qq._readData.getUint32(),qC=qq._readData.getUint32(),qG=new Uint16Array(q_.slice(qL,qL+qC)),qt=qe_.create("ushort",qC/2,35044,!0);qt.setData(qG),qq._mesh._indexBuffer=qt;var qo=qq._mesh._boneNames=[],q$=qq._readData.getUint16();for(qo.length=q$,qa=0;qa<q$;qa++)qo[qa]=qq._strings[qq._readData.getUint16()];var qF=qq._readData.getUint32(),qT=qq._readData.getUint32(),qD=(new Float32Array(q_.slice(qJ+qF,qJ+qF+qT)),qq._readData.getUint32()),qj=qq._readData.getUint32(),qQ=new Float32Array(q_.slice(qJ+qD,qJ+qD+qj));for(qq._mesh._inverseBindPoses=[],qa=0,qS=qQ.length;qa<qS;qa+=16){var qm=new qS_(qQ[qa+0],qQ[qa+1],qQ[qa+2],qQ[qa+3],qQ[qa+4],qQ[qa+5],qQ[qa+6],qQ[qa+7],qQ[qa+8],qQ[qa+9],qQ[qa+10],qQ[qa+11],qQ[qa+12],qQ[qa+13],qQ[qa+14],qQ[qa+15]);qq._mesh._inverseBindPoses.push(qm)}return qq._mesh._skinnedDatas=new Float32Array(16*qQ.length),!0},qq.READ_SUBMESH=function(){var qS=qq._readData.__getBuffer(),q_=new qb_(qq._mesh),qa=qq._readData.getInt16(),qR=qq._readData.getUint32(),qJ=qq._readData.getUint32();q_._vertexBuffer=qq._mesh._vertexBuffers[qa],q_._vertexStart=qR,q_._vertexCount=qJ;var qV=qq._readData.getUint32(),qW=qq._readData.getUint32(),qk=qq._mesh._indexBuffer;q_._indexBuffer=qk,q_._indexStart=qV,q_._indexCount=qW,q_._indices=new Uint16Array(qk.getData().buffer,2*qV,qW);var qz=qq._DATA.offset,qb=q_._subIndexBufferStart,qH=q_._subIndexBufferCount,qL=q_._boneIndicesList,qC=qq._readData.getUint16();qb.length=qC,qH.length=qC,qL.length=qC;for(var qG=0;qG<qC;qG++){qb[qG]=qq._readData.getUint32(),qH[qG]=qq._readData.getUint32();var qt=qq._readData.getUint32(),qo=qq._readData.getUint32();q_._boneIndicesList[qG]=new Uint8Array(qS.slice(qz+qt,qz+qt+qo))}return qq._subMeshes.push(q_),!0},qq._getVertexDeclaration=function(qS){for(var q_,qa=!1,qR=!1,qJ=!1,qV=!1,qW=!1,qk=!1,qz=!1,qb=!1,qH=!1,qL=0;qL<qS.length;qL++)switch(qS[qL]){case"POSITION":qa=!0;break;case"NORMAL":qR=!0;break;case"COLOR":qJ=!0;break;case"UV":qV=!0;break;case"UV1":qW=!0;break;case"BLENDWEIGHT":qz=!0;break;case"BLENDINDICES":qb=!0;break;case"TANGENT":qk=!0;break;case"BINORMAL":qH=!0}return qa&&qR&&qJ&&qV&&qW&&qz&&qb&&qk?q_=qDS.vertexDeclaration:qa&&qR&&qJ&&qV&&qW&&qz&&qb?q_=qFS.vertexDeclaration:qa&&qR&&qV&&qW&&qz&&qb&&qk?q_=qKS.vertexDeclaration:qa&&qR&&qV&&qW&&qz&&qb?q_=qhS.vertexDeclaration:qa&&qR&&qJ&&qV&&qz&&qb&&qk?q_=qNS.vertexDeclaration:qa&&qR&&qJ&&qV&&qz&&qb?q_=qmS.vertexDeclaration:qa&&qR&&qV&&qz&&qb&&qk?q_=qgS.vertexDeclaration:qa&&qR&&qV&&qz&&qb?q_=qrS.vertexDeclaration:qa&&qR&&qJ&&qz&&qb&&qk?q_=qCS.vertexDeclaration:qa&&qR&&qJ&&qz&&qb?q_=qHS.vertexDeclaration:qa&&qR&&qJ&&qV&&qW&&qk?q_=qQS.vertexDeclaration:qa&&qR&&qJ&&qV&&qW?q_=q$S.vertexDeclaration:qa&&qR&&qV&&qW&&qk?q_=qMS.vertexDeclaration:qa&&qR&&qV&&qW?q_=qXS.vertexDeclaration:qa&&qR&&qJ&&qV&&qk?q_=qlS.vertexDeclaration:qa&&qR&&qV&&qk&&qH?q_=qUS.vertexDeclaration:qa&&qR&&qJ&&qV?q_=qoS.vertexDeclaration:qa&&qR&&qV&&qk?q_=qsS.vertexDeclaration:qa&&qR&&qV?q_=qAS.vertexDeclaration:qa&&qR&&qJ&&qk?q_=qtS.vertexDeclaration:qa&&qR&&qJ&&(q_=qbS.vertexDeclaration),q_},qq._attrReg=new RegExp("(\\w+)|([:,;])","g"),qq._strings=[],qq._readData=null,qq._version=null,qq._mesh=null,qq._materials=null,qq._subMeshes=null,qq._materialMap=null,qL(qq,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),qq}(),qcS=function(){function qm(){}return qG(qm,"laya.d3.loaders.LoadModelV03"),qm.parse=function(qS,q_,qa,qR,qJ){qm._mesh=qa,qm._subMeshes=qR,qm._materialMap=qJ,qm._version=q_,qm._readData=qS,qm.READ_DATA(),qm.READ_BLOCK(),qm.READ_STRINGS();for(var qV=0,qW=qm._BLOCK.count;qV<qW;qV++){qm._readData.pos=qm._BLOCK.blockStarts[qV];var qk=qm._readData.getUint16(),qz=qm._strings[qk],qb=qm["READ_"+qz];if(null==qb)throw new Error("model file err,no this function:"+qk+" "+qz);qb.call()}qm._strings.length=0,qm._readData=null,qm._version=null,qm._mesh=null,qm._subMeshes=null,qm._materialMap=null},qm._readString=function(){return qm._strings[qm._readData.getUint16()]},qm.READ_DATA=function(){qm._DATA.offset=qm._readData.getUint32(),qm._DATA.size=qm._readData.getUint32()},qm.READ_BLOCK=function(){for(var qS=qm._BLOCK.count=qm._readData.getUint16(),q_=qm._BLOCK.blockStarts=[],qa=qm._BLOCK.blockLengths=[],qR=0;qR<qS;qR++)q_.push(qm._readData.getUint32()),qa.push(qm._readData.getUint32())},qm.READ_STRINGS=function(){var qS=qm._readData.getUint32(),q_=qm._readData.getUint16(),qa=qm._readData.pos;qm._readData.pos=qS+qm._DATA.offset;for(var qR=0;qR<q_;qR++)qm._strings[qR]=qm._readData.readUTFString();qm._readData.pos=qa},qm.READ_MESH=function(){var qS,q_=qm._readString(),qa=qm._readData.__getBuffer(),qR=0,qJ=qm._readData.getInt16(),qV=qm._DATA.offset;for(qR=0;qR<qJ;qR++){var qW,qk=qV+qm._readData.getUint32(),qz=qm._readData.getUint32(),qb=new Float32Array(qa.slice(qk,qk+qz)),qH=qm._readString();switch(qm._version){case"LAYAMODEL:03":qW=qm._vertexDeclarationMap_Discard[qH];break;case"LAYAMODEL:0301":qW=qm._vertexDeclarationMap[qH];break;default:throw new Error("LoadModelV03: unknown version.")}if(!qW)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+qm._version+"  bufferAttribute="+qH+"  name="+q_+"  url="+(qm._mesh?qm._mesh.url:"null"));var qL=qg_.create(qW,4*qb.length/qW.vertexStride,35044,!0,qm._mesh._url+"_"+qR);qL.setData(qb),qm._mesh._vertexBuffers.push(qL)}var qC=qV+qm._readData.getUint32(),qG=qm._readData.getUint32(),qt=new Uint16Array(qa.slice(qC,qC+qG)),qo=qe_.create("ushort",qG/2,35044,!0,qm._mesh._url);qo.setData(qt),qm._mesh._indexBuffer=qo;var q$=qm._mesh._boneNames=[],qF=qm._readData.getUint16();for(q$.length=qF,qR=0;qR<qF;qR++)q$[qR]=qm._strings[qm._readData.getUint16()];qm._readData.pos+=8;var qT=qm._readData.getUint32(),qD=qm._readData.getUint32(),qj=new Float32Array(qa.slice(qV+qT,qV+qT+qD));for(qm._mesh._inverseBindPoses=[],qR=0,qS=qj.length;qR<qS;qR+=16){var qQ=new qS_(qj[qR+0],qj[qR+1],qj[qR+2],qj[qR+3],qj[qR+4],qj[qR+5],qj[qR+6],qj[qR+7],qj[qR+8],qj[qR+9],qj[qR+10],qj[qR+11],qj[qR+12],qj[qR+13],qj[qR+14],qj[qR+15]);qm._mesh._inverseBindPoses.push(qQ)}return qm._mesh._skinnedDatas=new Float32Array(16*qj.length),!0},qm.READ_SUBMESH=function(){var qS=qm._readData.__getBuffer(),q_=new qb_(qm._mesh),qa=qm._readData.getInt16(),qR=qm._readData.getUint32(),qJ=qm._readData.getUint32();q_._vertexBuffer=qm._mesh._vertexBuffers[qa],q_._vertexStart=qR,q_._vertexCount=qJ;var qV=qm._readData.getUint32(),qW=qm._readData.getUint32(),qk=qm._mesh._indexBuffer;q_._indexBuffer=qk,q_._indexStart=qV,q_._indexCount=qW,q_._indices=new Uint16Array(qk.getData().buffer,2*qV,qW);var qz=qm._DATA.offset,qb=q_._subIndexBufferStart,qH=q_._subIndexBufferCount,qL=q_._boneIndicesList,qC=qm._readData.getUint16();qb.length=qC,qH.length=qC,qL.length=qC;for(var qG=0;qG<qC;qG++){qb[qG]=qm._readData.getUint32(),qH[qG]=qm._readData.getUint32();var qt=qm._readData.getUint32(),qo=qm._readData.getUint32();qL[qG]=new Uint8Array(qS.slice(qz+qt,qz+qt+qo))}return qm._subMeshes.push(q_),!0},qm._strings=[],qm._readData=null,qm._version=null,qm._mesh=null,qm._subMeshes=null,qm._materialMap=null,qL(qm,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":qDS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":qFS.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":qfS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":qKS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":qhS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":qNS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":qmS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":qgS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":qrS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":qCS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":qHS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":qQS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":q$S.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":qMS.vertexDeclaration,"POSITION,NORMAL,UV,UV1":qXS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":qlS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":qUS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":qoS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":qsS.vertexDeclaration,"POSITION,NORMAL,UV":qAS.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":qtS.vertexDeclaration,"POSITION,NORMAL,COLOR":qbS.vertexDeclaration,"POSITION,NORMAL,TANGENT":qIS.vertexDeclaration,"POSITION,NORMAL":qzS.vertexDeclaration,"POSITION,UV":qiS.vertexDeclaration,POSITION:qkS.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":qTS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":qFS.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":qfS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":quS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":qhS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":qqS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":qmS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":qeS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":qrS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":qLS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":qHS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":qjS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":q$S.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":qPS.vertexDeclaration,"POSITION,NORMAL,UV,UV1":qXS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":qnS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":qUS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":qoS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":qxS.vertexDeclaration,"POSITION,NORMAL,UV":qAS.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":qGS.vertexDeclaration,"POSITION,NORMAL,COLOR":qbS.vertexDeclaration,"POSITION,NORMAL,TANGENT":qBS.vertexDeclaration,"POSITION,NORMAL":qzS.vertexDeclaration,"POSITION,UV":qiS.vertexDeclaration,POSITION:qkS.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),qm}(),qyS=function(){function qk(){}return qG(qk,"laya.d3.loaders.MeshReader"),qk.read=function(qS,q_,qa,qR,qJ){var qV=new qm(qS);qV.pos=0;var qW=qV.readUTFString();switch(qW){case"LAYAMODEL:01":case"LAYASKINANI:01":qk._readVersion01(qV,qW,q_,qa,qR,qJ);break;case"LAYAMODEL:02":qpS.parse(qV,qW,q_,qa,qR,qJ);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":qcS.parse(qV,qW,q_,qR,qJ);break;default:throw new Error("MeshReader: unknown mesh version.")}q_._setSubMeshes(qR)},qk._readVersion01=function(qS,q_,qa,qR,qJ,qV){new qZS(qS,q_,qa,qR,qJ,qV)},qk}(),qES=function(){function qS(qS,q_){this.min=null,this.max=null,this.min=qS,this.max=q_}qG(qS,"laya.d3.math.BoundBox");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.getCorners=function(qS){qS.length=8;var q_=this.min.elements,qa=this.max.elements,qR=q_[0],qJ=q_[1],qV=q_[2],qW=qa[0],qk=qa[1],qz=qa[2];qS[0]=new qW_(qR,qk,qz),qS[1]=new qW_(qW,qk,qz),qS[2]=new qW_(qW,qJ,qz),qS[3]=new qW_(qR,qJ,qz),qS[4]=new qW_(qR,qk,qV),qS[5]=new qW_(qW,qk,qV),qS[6]=new qW_(qW,qJ,qV),qS[7]=new qW_(qR,qJ,qV)},q_.toDefault=function(){this.min.toDefault(),this.max.toDefault()},q_.cloneTo=function(qS){var q_=qS;this.min.cloneTo(q_.min),this.max.cloneTo(q_.max)},q_.clone=function(){var qS=new this.constructor(new qW_,new qW_);return this.cloneTo(qS),qS},qS.createfromPoints=function(qS,q_){if(null==qS)throw new Error("points");var qa=q_.min,qR=q_.max,qJ=qa.elements;qJ[0]=Number.MAX_VALUE,qJ[1]=Number.MAX_VALUE,qJ[2]=Number.MAX_VALUE;var qV=qR.elements;qV[0]=-Number.MAX_VALUE,qV[1]=-Number.MAX_VALUE,qV[2]=-Number.MAX_VALUE;for(var qW=0,qk=qS.length;qW<qk;++qW)qW_.min(qa,qS[qW],qa),qW_.max(qR,qS[qW],qR)},qS.merge=function(qS,q_,qa){qW_.min(qS.min,q_.min,qa.min),qW_.max(qS.max,q_.max,qa.max)},qS}(),qOS=function(){function qb(qS){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=qS,this._near=new q__(new qW_),this._far=new q__(new qW_),this._left=new q__(new qW_),this._right=new q__(new qW_),this._top=new q__(new qW_),this._bottom=new q__(new qW_),qb._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}qG(qb,"laya.d3.math.BoundFrustum");var qS=qb.prototype;return qS.equalsBoundFrustum=function(qS){return this._matrix.equalsOtherMatrix(qS.matrix)},qS.equalsObj=function(qS){if(qS instanceof laya.d3.math.BoundFrustum){var q_=qS;return this.equalsBoundFrustum(q_)}return!1},qS.getPlane=function(qS){switch(qS){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},qS.getCorners=function(qS){qb._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(qS[0]),qb._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(qS[1]),qb._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(qS[2]),qb._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(qS[3]),qb._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(qS[4]),qb._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(qS[5]),qb._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(qS[6]),qb._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(qS[7])},qS.containsPoint=function(qS){for(var q_=q__.PlaneIntersectionType_Front,qa=q__.PlaneIntersectionType_Front,qR=0;qR<6;qR++){switch(qR){case 0:qa=Collision.intersectsPlaneAndPoint(this._near,qS);break;case 1:qa=Collision.intersectsPlaneAndPoint(this._far,qS);break;case 2:qa=Collision.intersectsPlaneAndPoint(this._left,qS);break;case 3:qa=Collision.intersectsPlaneAndPoint(this._right,qS);break;case 4:qa=Collision.intersectsPlaneAndPoint(this._top,qS);break;case 5:qa=Collision.intersectsPlaneAndPoint(this._bottom,qS)}switch(qa){case q__.PlaneIntersectionType_Back:return 0;case q__.PlaneIntersectionType_Intersecting:q_=q__.PlaneIntersectionType_Intersecting}}switch(q_){case q__.PlaneIntersectionType_Intersecting:return 2;default:return 1}},qS.containsBoundBox=function(qS){for(var q_,qa=qb._tempV30,qR=qb._tempV31,qJ=1,qV=0;qV<6;qV++){if(q_=this.getPlane(qV),this._getBoxToPlanePVertexNVertex(qS,q_.normal,qa,qR),Collision.intersectsPlaneAndPoint(q_,qa)===q__.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(q_,qR)===q__.PlaneIntersectionType_Back&&(qJ=2)}return qJ},qS.containsBoundSphere=function(qS){for(var q_=q__.PlaneIntersectionType_Front,qa=q__.PlaneIntersectionType_Front,qR=0;qR<6;qR++){switch(qR){case 0:qa=Collision.intersectsPlaneAndSphere(this._near,qS);break;case 1:qa=Collision.intersectsPlaneAndSphere(this._far,qS);break;case 2:qa=Collision.intersectsPlaneAndSphere(this._left,qS);break;case 3:qa=Collision.intersectsPlaneAndSphere(this._right,qS);break;case 4:qa=Collision.intersectsPlaneAndSphere(this._top,qS);break;case 5:qa=Collision.intersectsPlaneAndSphere(this._bottom,qS)}switch(qa){case q__.PlaneIntersectionType_Back:return 0;case q__.PlaneIntersectionType_Intersecting:q_=q__.PlaneIntersectionType_Intersecting}}switch(q_){case q__.PlaneIntersectionType_Intersecting:return 2;default:return 1}},qS._getBoxToPlanePVertexNVertex=function(qS,q_,qa,qR){var qJ=qS.min,qV=qJ.elements,qW=qS.max,qk=qW.elements,qz=q_.elements,qb=qz[0],qH=qz[1],qL=qz[2];qJ.cloneTo(qa);var qC=qa.elements;0<=qb&&(qC[0]=qk[0]),0<=qH&&(qC[1]=qk[1]),0<=qL&&(qC[2]=qk[2]),qW.cloneTo(qR);var qG=qR.elements;0<=qb&&(qG[0]=qV[0]),0<=qH&&(qG[1]=qV[1]),0<=qL&&(qG[2]=qV[2])},qt(0,qS,"top",function(){return this._top}),qt(0,qS,"matrix",function(){return this._matrix},function(qS){this._matrix=qS,qb._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),qt(0,qS,"near",function(){return this._near}),qt(0,qS,"far",function(){return this._far}),qt(0,qS,"left",function(){return this._left}),qt(0,qS,"right",function(){return this._right}),qt(0,qS,"bottom",function(){return this._bottom}),qb._getPlanesFromMatrix=function(qS,q_,qa,qR,qJ,qV,qW){var qk=qS.elements,qz=qk[0],qb=qk[1],qH=qk[2],qL=qk[3],qC=qk[4],qG=qk[5],qt=qk[6],qo=qk[7],q$=qk[8],qF=qk[9],qT=qk[10],qD=qk[11],qj=qk[12],qQ=qk[13],qm=qk[14],qq=qk[15],qN=q_.normal.elements;qN[0]=qL+qH,qN[1]=qo+qt,qN[2]=qD+qT,q_.distance=qq+qm,q_.normalize();var qn=qa.normal.elements;qn[0]=qL-qH,qn[1]=qo-qt,qn[2]=qD-qT,qa.distance=qq-qm,qa.normalize();var ql=qR.normal.elements;ql[0]=qL+qz,ql[1]=qo+qC,ql[2]=qD+q$,qR.distance=qq+qj,qR.normalize();var qB=qJ.normal.elements;qB[0]=qL-qz,qB[1]=qo-qC,qB[2]=qD-q$,qJ.distance=qq-qj,qJ.normalize();var qI=qV.normal.elements;qI[0]=qL-qb,qI[1]=qo-qG,qI[2]=qD-qF,qV.distance=qq-qQ,qV.normalize();var qA=qW.normal.elements;qA[0]=qL+qb,qA[1]=qo+qG,qA[2]=qD+qF,qW.distance=qq+qQ,qW.normalize()},qb._get3PlaneInterPoint=function(qS,q_,qa){var qR=qS.normal,qJ=q_.normal,qV=qa.normal;qW_.cross(qJ,qV,qb._tempV30),qW_.cross(qV,qR,qb._tempV31),qW_.cross(qR,qJ,qb._tempV32);var qW=qW_.dot(qR,qb._tempV30),qk=qW_.dot(qJ,qb._tempV31),qz=qW_.dot(qV,qb._tempV32);return qW_.scale(qb._tempV30,-qS.distance/qW,qb._tempV33),qW_.scale(qb._tempV31,-q_.distance/qk,qb._tempV34),qW_.scale(qb._tempV32,-qa.distance/qz,qb._tempV35),qW_.add(qb._tempV33,qb._tempV34,qb._tempV36),qW_.add(qb._tempV35,qb._tempV36,qb._tempV37),qb._tempV37},qL(qb,["_tempV30",function(){return this._tempV30=new qW_},"_tempV31",function(){return this._tempV31=new qW_},"_tempV32",function(){return this._tempV32=new qW_},"_tempV33",function(){return this._tempV33=new qW_},"_tempV34",function(){return this._tempV34=new qW_},"_tempV35",function(){return this._tempV35=new qW_},"_tempV36",function(){return this._tempV36=new qW_},"_tempV37",function(){return this._tempV37=new qW_}]),qb}(),qwS=function(){function qH(qS,q_){this.center=null,this.radius=NaN,this.center=qS,this.radius=q_}qG(qH,"laya.d3.math.BoundSphere");var qS=qH.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.toDefault=function(){this.center.toDefault(),this.radius=0},qS.intersectsRayDistance=function(qS){return Collision.intersectsRayAndSphereRD(qS,this)},qS.intersectsRayPoint=function(qS,q_){return Collision.intersectsRayAndSphereRP(qS,this,q_)},qS.cloneTo=function(qS){var q_=qS;this.center.cloneTo(q_.center),q_.radius=this.radius},qS.clone=function(){var qS=new this.constructor(new qW_,new qW_);return this.cloneTo(qS),qS},qH.createFromSubPoints=function(qS,q_,qa,qR){if(null==qS)throw new Error("points");if(q_<0||q_>=qS.length)throw new Error("start"+q_+"Must be in the range [0, "+(qS.length-1)+"]");if(qa<0||q_+qa>qS.length)throw new Error("count"+qa+"Must be in the range <= "+qS.length+"}");var qJ=q_+qa,qV=qH._tempVector3;qV.elements[0]=0,qV.elements[1]=0,qV.elements[2]=0;for(var qW=q_;qW<qJ;++qW)qW_.add(qS[qW],qV,qV);var qk=qR.center;qW_.scale(qV,1/qa,qk);var qz=0;for(qW=q_;qW<qJ;++qW){var qb=qW_.distanceSquared(qk,qS[qW]);qz<qb&&(qz=qb)}qR.radius=Math.sqrt(qz)},qH.createfromPoints=function(qS,q_){if(null==qS)throw new Error("points");qH.createFromSubPoints(qS,0,qS.length,q_)},qL(qH,["_tempVector3",function(){return this._tempVector3=new qW_}]),qH}(),qvS=(function(){function qS(){}qG(qS,"laya.d3.math.ContainmentType"),qS.Disjoint=0,qS.Contains=1,qS.Intersects=2}(),function(){function qa(){}return qG(qa,"laya.d3.math.MathUtils3D"),qa.isZero=function(qS){return Math.abs(qS)<qa.zeroTolerance},qa.nearEqual=function(qS,q_){return!!qa.isZero(qS-q_)},qa.fastInvSqrt=function(qS){return qa.isZero(qS)?qS:1/Math.sqrt(qS)},qL(qa,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),qa}()),qdS=function(){function qz(){var qS=this.elements=new Float32Array(9);qS[0]=1,qS[1]=0,qS[2]=0,qS[3]=0,qS[4]=1,qS[5]=0,qS[6]=0,qS[7]=0,qS[8]=1}qG(qz,"laya.d3.math.Matrix3x3");var qS=qz.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.determinant=function(){var qS=this.elements,q_=qS[0],qa=qS[1],qR=qS[2],qJ=qS[3],qV=qS[4],qW=qS[5],qk=qS[6],qz=qS[7],qb=qS[8];return q_*(qb*qV-qW*qz)+qa*(-qb*qJ+qW*qk)+qR*(qz*qJ-qV*qk)},qS.translate=function(qS,q_){var qa=q_.elements,qR=this.elements,qJ=qS.elements,qV=qR[0],qW=qR[1],qk=qR[2],qz=qR[3],qb=qR[4],qH=qR[5],qL=qR[6],qC=qR[7],qG=qR[8],qt=qJ[0],qo=qJ[1];qa[0]=qV,qa[1]=qW,qa[2]=qk,qa[3]=qz,qa[4]=qb,qa[5]=qH,qa[6]=qt*qV+qo*qz+qL,qa[7]=qt*qW+qo*qb+qC,qa[8]=qt*qk+qo*qH+qG},qS.rotate=function(qS,q_){var qa=q_.elements,qR=this.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=qR[4],qb=qR[5],qH=qR[6],qL=qR[7],qC=qR[8],qG=Math.sin(qS),qt=Math.cos(qS);qa[0]=qt*qJ+qG*qk,qa[1]=qt*qV+qG*qz,qa[2]=qt*qW+qG*qb,qa[3]=qt*qk-qG*qJ,qa[4]=qt*qz-qG*qV,qa[5]=qt*qb-qG*qW,qa[6]=qH,qa[7]=qL,qa[8]=qC},qS.scale=function(qS,q_){var qa=q_.elements,qR=this.elements,qJ=qS.elements,qV=qJ[0],qW=qJ[1];qa[0]=qV*qR[0],qa[1]=qV*qR[1],qa[2]=qV*qR[2],qa[3]=qW*qR[3],qa[4]=qW*qR[4],qa[5]=qW*qR[5],qa[6]=qR[6],qa[7]=qR[7],qa[8]=qR[8]},qS.invert=function(qS){var q_=qS.elements,qa=this.elements,qR=qa[0],qJ=qa[1],qV=qa[2],qW=qa[3],qk=qa[4],qz=qa[5],qb=qa[6],qH=qa[7],qL=qa[8],qC=qL*qk-qz*qH,qG=-qL*qW+qz*qb,qt=qH*qW-qk*qb,qo=qR*qC+qJ*qG+qV*qt;qo||(qS=null),qo=1/qo,q_[0]=qC*qo,q_[1]=(-qL*qJ+qV*qH)*qo,q_[2]=(qz*qJ-qV*qk)*qo,q_[3]=qG*qo,q_[4]=(qL*qR-qV*qb)*qo,q_[5]=(-qz*qR+qV*qW)*qo,q_[6]=qt*qo,q_[7]=(-qH*qR+qJ*qb)*qo,q_[8]=(qk*qR-qJ*qW)*qo},qS.transpose=function(qS){var q_=qS.elements,qa=this.elements;if(qS===this){var qR=qa[1],qJ=qa[2],qV=qa[5];q_[1]=qa[3],q_[2]=qa[6],q_[3]=qR,q_[5]=qa[7],q_[6]=qJ,q_[7]=qV}else q_[0]=qa[0],q_[1]=qa[3],q_[2]=qa[6],q_[3]=qa[1],q_[4]=qa[4],q_[5]=qa[7],q_[6]=qa[2],q_[7]=qa[5],q_[8]=qa[8]},qS.identity=function(){var qS=this.elements;qS[0]=1,qS[1]=0,qS[2]=0,qS[3]=0,qS[4]=1,qS[5]=0,qS[6]=0,qS[7]=0,qS[8]=1},qS.cloneTo=function(qS){var q_,qa,qR;if((qa=this.elements)!==(qR=qS.elements))for(q_=0;q_<9;++q_)qR[q_]=qa[q_]},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qz.createFromTranslation=function(qS,q_){q_.elements;var qa=qS.elements;q_[0]=1,q_[1]=0,q_[2]=0,q_[3]=0,q_[4]=1,q_[5]=0,q_[6]=qa[0],q_[7]=qa[1],q_[8]=1},qz.createFromRotation=function(qS,q_){var qa=q_.elements,qR=Math.sin(qS),qJ=Math.cos(qS);qa[0]=qJ,qa[1]=qR,qa[2]=0,qa[3]=-qR,qa[4]=qJ,qa[5]=0,qa[6]=0,qa[7]=0,qa[8]=1},qz.createFromScaling=function(qS,q_){var qa=q_.elements,qR=qS.elements;qa[0]=qR[0],qa[1]=0,qa[2]=0,qa[3]=0,qa[4]=qR[1],qa[5]=0,qa[6]=0,qa[7]=0,qa[8]=1},qz.createFromMatrix4x4=function(qS,q_){q_[0]=qS[0],q_[1]=qS[1],q_[2]=qS[2],q_[3]=qS[4],q_[4]=qS[5],q_[5]=qS[6],q_[6]=qS[8],q_[7]=qS[9],q_[8]=qS[10]},qz.multiply=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements,qW=qJ[0],qk=qJ[1],qz=qJ[2],qb=qJ[3],qH=qJ[4],qL=qJ[5],qC=qJ[6],qG=qJ[7],qt=qJ[8],qo=qV[0],q$=qV[1],qF=qV[2],qT=qV[3],qD=qV[4],qj=qV[5],qQ=qV[6],qm=qV[7],qq=qV[8];qR[0]=qo*qW+q$*qb+qF*qC,qR[1]=qo*qk+q$*qH+qF*qG,qR[2]=qo*qz+q$*qL+qF*qt,qR[3]=qT*qW+qD*qb+qj*qC,qR[4]=qT*qk+qD*qH+qj*qG,qR[5]=qT*qz+qD*qL+qj*qt,qR[6]=qQ*qW+qm*qb+qq*qC,qR[7]=qQ*qk+qm*qH+qq*qG,qR[8]=qQ*qz+qm*qL+qq*qt},qz.lookAt=function(qS,q_,qa,qR){qW_.subtract(qS,q_,qz._tempV30),qW_.normalize(qz._tempV30,qz._tempV30),qW_.cross(qa,qz._tempV30,qz._tempV31),qW_.normalize(qz._tempV31,qz._tempV31),qW_.cross(qz._tempV30,qz._tempV31,qz._tempV32);var qJ=qz._tempV30.elements,qV=qz._tempV31.elements,qW=qz._tempV32.elements,qk=qR.elements;qk[0]=qV[0],qk[3]=qV[1],qk[6]=qV[2],qk[1]=qW[0],qk[4]=qW[1],qk[7]=qW[2],qk[2]=qJ[0],qk[5]=qJ[1],qk[8]=qJ[2]},qz.DEFAULT=new qz,qL(qz,["_tempV30",function(){return this._tempV30=new qW_},"_tempV31",function(){return this._tempV31=new qW_},"_tempV32",function(){return this._tempV32=new qW_}]),qz}(),qS_=function(){function qn(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL,qC,qG,qt,qo){void 0===qS&&(qS=1),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qV&&(qV=1),void 0===qW&&(qW=0),void 0===qk&&(qk=0),void 0===qz&&(qz=0),void 0===qb&&(qb=0),void 0===qH&&(qH=1),void 0===qL&&(qL=0),void 0===qC&&(qC=0),void 0===qG&&(qG=0),void 0===qt&&(qt=0),void 0===qo&&(qo=1);var q$=this.elements=new Float32Array(16);q$[0]=qS,q$[1]=q_,q$[2]=qa,q$[3]=qR,q$[4]=qJ,q$[5]=qV,q$[6]=qW,q$[7]=qk,q$[8]=qz,q$[9]=qb,q$[10]=qH,q$[11]=qL,q$[12]=qC,q$[13]=qG,q$[14]=qt,q$[15]=qo}qG(qn,"laya.d3.math.Matrix4x4");var qS=qn.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.getElementByRowColumn=function(qS,q_){if(qS<0||3<qS)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(q_<0||3<q_)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*qS+q_]},qS.setElementByRowColumn=function(qS,q_,qa){if(qS<0||3<qS)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(q_<0||3<q_)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*qS+q_]=qa},qS.equalsOtherMatrix=function(qS){var q_=this.elements,qa=qS.elements;return qvS.nearEqual(q_[0],qa[0])&&qvS.nearEqual(q_[1],qa[1])&&qvS.nearEqual(q_[2],qa[2])&&qvS.nearEqual(q_[3],qa[3])&&qvS.nearEqual(q_[4],qa[4])&&qvS.nearEqual(q_[5],qa[5])&&qvS.nearEqual(q_[6],qa[6])&&qvS.nearEqual(q_[7],qa[7])&&qvS.nearEqual(q_[8],qa[8])&&qvS.nearEqual(q_[9],qa[9])&&qvS.nearEqual(q_[10],qa[10])&&qvS.nearEqual(q_[11],qa[11])&&qvS.nearEqual(q_[12],qa[12])&&qvS.nearEqual(q_[13],qa[13])&&qvS.nearEqual(q_[14],qa[14])&&qvS.nearEqual(q_[15],qa[15])},qS.decomposeTransRotScale=function(qS,q_,qa){var qR=qn._tempMatrix4x4;return this.decomposeTransRotMatScale(qS,qR,qa)?(qa_.createFromMatrix4x4(qR,q_),!0):(q_.identity(),!1)},qS.decomposeTransRotMatScale=function(qS,q_,qa){var qR=this.elements,qJ=qS.elements,qV=q_.elements,qW=qa.elements;qJ[0]=qR[12],qJ[1]=qR[13],qJ[2]=qR[14];var qk=qR[0],qz=qR[1],qb=qR[2],qH=qR[4],qL=qR[5],qC=qR[6],qG=qR[8],qt=qR[9],qo=qR[10],q$=qW[0]=Math.sqrt(qk*qk+qz*qz+qb*qb),qF=qW[1]=Math.sqrt(qH*qH+qL*qL+qC*qC),qT=qW[2]=Math.sqrt(qG*qG+qt*qt+qo*qo);if(qvS.isZero(q$)||qvS.isZero(qF)||qvS.isZero(qT))return qV[1]=qV[2]=qV[3]=qV[4]=qV[6]=qV[7]=qV[8]=qV[9]=qV[11]=qV[12]=qV[13]=qV[14]=0,qV[0]=qV[5]=qV[10]=qV[15]=1,!1;var qD=qn._tempVector0,qj=qD.elements;qj[0]=qG/qT,qj[1]=qt/qT,qj[2]=qo/qT;var qQ=qn._tempVector1,qm=qQ.elements;qm[0]=qk/q$,qm[1]=qz/q$,qm[2]=qb/q$;var qq=qn._tempVector2;qW_.cross(qD,qQ,qq);var qN=qn._tempVector1;return qW_.cross(qq,qD,qN),qV[3]=qV[7]=qV[11]=qV[12]=qV[13]=qV[14]=0,qV[15]=1,qV[0]=qN.x,qV[1]=qN.y,qV[2]=qN.z,qV[4]=qq.x,qV[5]=qq.y,qV[6]=qq.z,qV[8]=qD.x,qV[9]=qD.y,qV[10]=qD.z,qV[0]*qk+qV[1]*qz+qV[2]*qb<0&&(qW[0]=-q$),qV[4]*qH+qV[5]*qL+qV[6]*qC<0&&(qW[1]=-qF),qV[8]*qG+qV[9]*qt+qV[10]*qo<0&&(qW[2]=-qT),!0},qS.decomposeYawPitchRoll=function(qS){var q_=qS.elements,qa=Math.asin(-this.elements[9]);q_[1]=qa,Math.cos(qa)>qvS.zeroTolerance?(q_[2]=Math.atan2(this.elements[1],this.elements[5]),q_[0]=Math.atan2(this.elements[8],this.elements[10])):(q_[2]=Math.atan2(-this.elements[4],this.elements[0]),q_[0]=0)},qS.normalize=function(){var qS=this.elements,q_=qS[0],qa=qS[1],qR=qS[2],qJ=Math.sqrt(q_*q_+qa*qa+qR*qR);if(!qJ)return qS[0]=0,qS[1]=0,void(qS[2]=0);1!=qJ&&(qJ=1/qJ,qS[0]=q_*qJ,qS[1]=qa*qJ,qS[2]=qR*qJ)},qS.transpose=function(){var qS,q_;return q_=(qS=this.elements)[1],qS[1]=qS[4],qS[4]=q_,q_=qS[2],qS[2]=qS[8],qS[8]=q_,q_=qS[3],qS[3]=qS[12],qS[12]=q_,q_=qS[6],qS[6]=qS[9],qS[9]=q_,q_=qS[7],qS[7]=qS[13],qS[13]=q_,q_=qS[11],qS[11]=qS[14],qS[14]=q_,this},qS.invert=function(qS){var q_=this.elements,qa=qS.elements,qR=q_[0],qJ=q_[1],qV=q_[2],qW=q_[3],qk=q_[4],qz=q_[5],qb=q_[6],qH=q_[7],qL=q_[8],qC=q_[9],qG=q_[10],qt=q_[11],qo=q_[12],q$=q_[13],qF=q_[14],qT=q_[15],qD=qR*qz-qJ*qk,qj=qR*qb-qV*qk,qQ=qR*qH-qW*qk,qm=qJ*qb-qV*qz,qq=qJ*qH-qW*qz,qN=qV*qH-qW*qb,qn=qL*q$-qC*qo,ql=qL*qF-qG*qo,qB=qL*qT-qt*qo,qI=qC*qF-qG*q$,qA=qC*qT-qt*q$,qX=qG*qT-qt*qF,qh=qD*qX-qj*qA+qQ*qI+qm*qB-qq*ql+qN*qn;0!==Math.abs(qh)&&(qh=1/qh,qa[0]=(qz*qX-qb*qA+qH*qI)*qh,qa[1]=(qV*qA-qJ*qX-qW*qI)*qh,qa[2]=(q$*qN-qF*qq+qT*qm)*qh,qa[3]=(qG*qq-qC*qN-qt*qm)*qh,qa[4]=(qb*qB-qk*qX-qH*ql)*qh,qa[5]=(qR*qX-qV*qB+qW*ql)*qh,qa[6]=(qF*qQ-qo*qN-qT*qj)*qh,qa[7]=(qL*qN-qG*qQ+qt*qj)*qh,qa[8]=(qk*qA-qz*qB+qH*qn)*qh,qa[9]=(qJ*qB-qR*qA-qW*qn)*qh,qa[10]=(qo*qq-q$*qQ+qT*qD)*qh,qa[11]=(qC*qQ-qL*qq-qt*qD)*qh,qa[12]=(qz*ql-qk*qI-qb*qn)*qh,qa[13]=(qR*qI-qJ*ql+qV*qn)*qh,qa[14]=(q$*qj-qo*qm-qF*qD)*qh,qa[15]=(qL*qm-qC*qj+qG*qD)*qh)},qS.identity=function(){var qS=this.elements;qS[1]=qS[2]=qS[3]=qS[4]=qS[6]=qS[7]=qS[8]=qS[9]=qS[11]=qS[12]=qS[13]=qS[14]=0,qS[0]=qS[5]=qS[10]=qS[15]=1},qS.cloneTo=function(qS){var q_,qa,qR;if((qa=this.elements)!==(qR=qS.elements))for(q_=0;q_<16;++q_)qR[q_]=qa[q_]},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qS.getTranslationVector=function(qS){var q_=this.elements,qa=qS.elements;qa[0]=q_[12],qa[1]=q_[13],qa[2]=q_[14]},qS.setTranslationVector=function(qS){var q_=this.elements,qa=qS.elements;q_[12]=qa[0],q_[13]=qa[1],q_[14]=qa[2]},qS.getForward=function(qS){var q_=this.elements,qa=qS.elements;qa[0]=-q_[8],qa[1]=-q_[9],qa[2]=-q_[10]},qS.setForward=function(qS){var q_=this.elements,qa=qS.elements;q_[8]=-qa[0],q_[9]=-qa[1],q_[10]=-qa[2]},qn.createRotationX=function(qS,q_){var qa=q_.elements,qR=Math.sin(qS),qJ=Math.cos(qS);qa[1]=qa[2]=qa[3]=qa[4]=qa[7]=qa[8]=qa[11]=qa[12]=qa[13]=qa[14]=0,qa[0]=qa[15]=1,qa[5]=qa[10]=qJ,qa[6]=qR,qa[9]=-qR},qn.createRotationY=function(qS,q_){var qa=q_.elements,qR=Math.sin(qS),qJ=Math.cos(qS);qa[1]=qa[3]=qa[4]=qa[6]=qa[7]=qa[9]=qa[11]=qa[12]=qa[13]=qa[14]=0,qa[5]=qa[15]=1,qa[0]=qa[10]=qJ,qa[2]=-qR,qa[8]=qR},qn.createRotationZ=function(qS,q_){var qa=q_.elements,qR=Math.sin(qS),qJ=Math.cos(qS);qa[2]=qa[3]=qa[6]=qa[7]=qa[8]=qa[9]=qa[11]=qa[12]=qa[13]=qa[14]=0,qa[10]=qa[15]=1,qa[0]=qa[5]=qJ,qa[1]=qR,qa[4]=-qR},qn.createRotationYawPitchRoll=function(qS,q_,qa,qR){qa_.createFromYawPitchRoll(qS,q_,qa,qn._tempQuaternion),qn.createRotationQuaternion(qn._tempQuaternion,qR)},qn.createRotationAxis=function(qS,q_,qa){var qR=qS.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=Math.cos(q_),qz=Math.sin(q_),qb=qJ*qJ,qH=qV*qV,qL=qW*qW,qC=qJ*qV,qG=qJ*qW,qt=qV*qW,qo=qa.elements;qo[3]=qo[7]=qo[11]=qo[12]=qo[13]=qo[14]=0,qo[15]=1,qo[0]=qb+qk*(1-qb),qo[1]=qC-qk*qC+qz*qW,qo[2]=qG-qk*qG-qz*qV,qo[4]=qC-qk*qC-qz*qW,qo[5]=qH+qk*(1-qH),qo[6]=qt-qk*qt+qz*qJ,qo[8]=qG-qk*qG+qz*qV,qo[9]=qt-qk*qt-qz*qJ,qo[10]=qL+qk*(1-qL)},qn.createRotationQuaternion=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0],qV=qa[1],qW=qa[2],qk=qa[3],qz=qJ*qJ,qb=qV*qV,qH=qW*qW,qL=qJ*qV,qC=qW*qk,qG=qW*qJ,qt=qV*qk,qo=qV*qW,q$=qJ*qk;qR[3]=qR[7]=qR[11]=qR[12]=qR[13]=qR[14]=0,qR[15]=1,qR[0]=1-2*(qb+qH),qR[1]=2*(qL+qC),qR[2]=2*(qG-qt),qR[4]=2*(qL-qC),qR[5]=1-2*(qH+qz),qR[6]=2*(qo+q$),qR[8]=2*(qG+qt),qR[9]=2*(qo-q$),qR[10]=1-2*(qb+qz)},qn.createTranslate=function(qS,q_){var qa=qS.elements,qR=q_.elements;qR[4]=qR[8]=qR[1]=qR[9]=qR[2]=qR[6]=qR[3]=qR[7]=qR[11]=0,qR[0]=qR[5]=qR[10]=qR[15]=1,qR[12]=qa[0],qR[13]=qa[1],qR[14]=qa[2]},qn.createScaling=function(qS,q_){var qa=qS.elements,qR=q_.elements;qR[0]=qa[0],qR[5]=qa[1],qR[10]=qa[2],qR[1]=qR[4]=qR[8]=qR[12]=qR[9]=qR[13]=qR[2]=qR[6]=qR[14]=qR[3]=qR[7]=qR[11]=0,qR[15]=1},qn.multiply=function(qS,q_,qa){var qR,qJ,qV,qW,qk,qz,qb,qH;for(qJ=qa.elements,qV=qS.elements,qJ===(qW=q_.elements)&&(qW=qW.slice()),qR=0;qR<4;qR++)qk=qV[qR],qz=qV[qR+4],qb=qV[qR+8],qH=qV[qR+12],qJ[qR]=qk*qW[0]+qz*qW[1]+qb*qW[2]+qH*qW[3],qJ[qR+4]=qk*qW[4]+qz*qW[5]+qb*qW[6]+qH*qW[7],qJ[qR+8]=qk*qW[8]+qz*qW[9]+qb*qW[10]+qH*qW[11],qJ[qR+12]=qk*qW[12]+qz*qW[13]+qb*qW[14]+qH*qW[15]},qn.createFromQuaternion=function(qS,q_){var qa=q_.elements,qR=qS.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=qJ+qJ,qb=qV+qV,qH=qW+qW,qL=qJ*qz,qC=qV*qz,qG=qV*qb,qt=qW*qz,qo=qW*qb,q$=qW*qH,qF=qk*qz,qT=qk*qb,qD=qk*qH;qa[0]=1-qG-q$,qa[1]=qC+qD,qa[2]=qt-qT,qa[3]=0,qa[4]=qC-qD,qa[5]=1-qL-q$,qa[6]=qo+qF,qa[7]=0,qa[8]=qt+qT,qa[9]=qo-qF,qa[10]=1-qL-qG,qa[11]=0,qa[12]=0,qa[13]=0,qa[14]=0,qa[15]=1},qn.createAffineTransformation=function(qS,q_,qa,qR){var qJ=qS.elements,qV=q_.elements,qW=qa.elements,qk=qR.elements,qz=qV[0],qb=qV[1],qH=qV[2],qL=qV[3],qC=qz+qz,qG=qb+qb,qt=qH+qH,qo=qz*qC,q$=qz*qG,qF=qz*qt,qT=qb*qG,qD=qb*qt,qj=qH*qt,qQ=qL*qC,qm=qL*qG,qq=qL*qt,qN=qW[0],qn=qW[1],ql=qW[2];qk[0]=(1-(qT+qj))*qN,qk[1]=(q$+qq)*qN,qk[2]=(qF-qm)*qN,qk[3]=0,qk[4]=(q$-qq)*qn,qk[5]=(1-(qo+qj))*qn,qk[6]=(qD+qQ)*qn,qk[7]=0,qk[8]=(qF+qm)*ql,qk[9]=(qD-qQ)*ql,qk[10]=(1-(qo+qT))*ql,qk[11]=0,qk[12]=qJ[0],qk[13]=qJ[1],qk[14]=qJ[2],qk[15]=1},qn.createLookAt=function(qS,q_,qa,qR){var qJ=qR.elements,qV=qn._tempVector0,qW=qn._tempVector1,qk=qn._tempVector2;qW_.subtract(qS,q_,qk),qW_.normalize(qk,qk),qW_.cross(qa,qk,qV),qW_.normalize(qV,qV),qW_.cross(qk,qV,qW),qR.identity(),qJ[0]=qV.x,qJ[4]=qV.y,qJ[8]=qV.z,qJ[1]=qW.x,qJ[5]=qW.y,qJ[9]=qW.z,qJ[2]=qk.x,qJ[6]=qk.y,qJ[10]=qk.z,qJ[12]=-qW_.dot(qV,qS),qJ[13]=-qW_.dot(qW,qS),qJ[14]=-qW_.dot(qk,qS)},qn.createPerspective=function(qS,q_,qa,qR,qJ){var qV=qJ.elements,qW=1/Math.tan(qS/2),qk=1/(qa-qR);qV[0]=qW/q_,qV[5]=qW,qV[10]=(qR+qa)*qk,qV[11]=-1,qV[14]=2*qR*qa*qk,qV[1]=qV[2]=qV[3]=qV[4]=qV[6]=qV[7]=qV[8]=qV[9]=qV[12]=qV[13]=qV[15]=0},qn.createOrthoOffCenterRH=function(qS,q_,qa,qR,qJ,qV,qW){var qk=qW.elements,qz=1/(qS-q_),qb=1/(qa-qR),qH=1/(qJ-qV);qk[1]=qk[2]=qk[3]=qk[4]=qk[6]=qk[7]=qk[8]=qk[9]=qk[11]=0,qk[15]=1,qk[0]=-2*qz,qk[5]=-2*qb,qk[10]=2*qH,qk[12]=(qS+q_)*qz,qk[13]=(qR+qa)*qb,qk[14]=(qV+qJ)*qH},qn.translation=function(qS,q_){var qa=qS.elements,qR=q_.elements;qR[0]=qR[5]=qR[10]=qR[15]=1,qR[12]=qa[0],qR[13]=qa[1],qR[14]=qa[2]},qL(qn,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new qn},"_tempVector0",function(){return this._tempVector0=new qW_},"_tempVector1",function(){return this._tempVector1=new qW_},"_tempVector2",function(){return this._tempVector2=new qW_},"_tempQuaternion",function(){return this._tempQuaternion=new qa_},"DEFAULT",function(){return this.DEFAULT=new qn},"ZERO",function(){return this.ZERO=new qn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),qn}(),q__=(function(){function qD(qS,q_){this.extents=null,this.transformation=null,this.extents=qS,this.transformation=q_}qG(qD,"laya.d3.math.OrientedBoundBox");var qS=qD.prototype;qS.getCorners=function(qS){var q_=qD._tempV30.elements,qa=qD._tempV31.elements,qR=qD._tempV32.elements,qJ=this.extents.elements;q_[0]=qJ[0],q_[1]=q_[2]=0,qa[1]=qJ[1],qa[0]=qa[2]=0,qR[2]=qJ[2],qR[0]=qR[1]=0,qW_.TransformNormal(qD._tempV30,this.transformation,qD._tempV30),qW_.TransformNormal(qD._tempV31,this.transformation,qD._tempV31),qW_.TransformNormal(qD._tempV32,this.transformation,qD._tempV32);var qV=qD._tempV33;this.transformation.getTranslationVector(qV),qS.length=8,qW_.add(qV,qD._tempV30,qD._tempV34),qW_.add(qD._tempV34,qD._tempV31,qD._tempV34),qW_.add(qD._tempV34,qD._tempV32,qS[0]),qW_.add(qV,qD._tempV30,qD._tempV34),qW_.add(qD._tempV34,qD._tempV31,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV32,qS[1]),qW_.subtract(qV,qD._tempV30,qD._tempV34),qW_.add(qD._tempV34,qD._tempV31,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV32,qS[2]),qW_.subtract(qV,qD._tempV30,qD._tempV34),qW_.add(qD._tempV34,qD._tempV31,qD._tempV34),qW_.add(qD._tempV34,qD._tempV32,qS[3]),qW_.add(qV,qD._tempV30,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV31,qD._tempV34),qW_.add(qD._tempV34,qD._tempV32,qS[4]),qW_.add(qV,qD._tempV30,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV31,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV32,qS[5]),qW_.subtract(qV,qD._tempV30,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV31,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV32,qS[6]),qW_.subtract(qV,qD._tempV30,qD._tempV34),qW_.subtract(qD._tempV34,qD._tempV31,qD._tempV34),qW_.add(qD._tempV34,qD._tempV32,qS[7])},qS.transform=function(qS){qS_.multiply(this.transformation,qS,this.transformation)},qS.scale=function(qS){qW_.multiply(this.extents,qS,this.extents)},qS.translate=function(qS){this.transformation.getTranslationVector(qD._tempV30),qW_.add(qD._tempV30,qS,qD._tempV31),this.transformation.setTranslationVector(qD._tempV31)},qS.Size=function(qS){qW_.scale(this.extents,2,qS)},qS.getSize=function(qS){var q_=this.extents.elements;qD._tempV30.x=q_[0],qD._tempV31.y=q_[1],qD._tempV32.z=q_[2],qW_.TransformNormal(qD._tempV30,this.transformation,qD._tempV30),qW_.TransformNormal(qD._tempV31,this.transformation,qD._tempV31),qW_.TransformNormal(qD._tempV31,this.transformation,qD._tempV32);var qa=qS.elements;qa[0]=qW_.scalarLength(qD._tempV30),qa[1]=qW_.scalarLength(qD._tempV31),qa[2]=qW_.scalarLength(qD._tempV32)},qS.getSizeSquared=function(qS){var q_=this.extents.elements;qD._tempV30.x=q_[0],qD._tempV31.y=q_[1],qD._tempV32.z=q_[2],qW_.TransformNormal(qD._tempV30,this.transformation,qD._tempV30),qW_.TransformNormal(qD._tempV31,this.transformation,qD._tempV31),qW_.TransformNormal(qD._tempV31,this.transformation,qD._tempV32);var qa=qS.elements;qa[0]=qW_.scalarLengthSquared(qD._tempV30),qa[1]=qW_.scalarLengthSquared(qD._tempV31),qa[2]=qW_.scalarLengthSquared(qD._tempV32)},qS.getCenter=function(qS){this.transformation.getTranslationVector(qS)},qS.containsPoint=function(qS){var q_=this.extents.elements,qa=q_[0],qR=q_[1],qJ=q_[2];this.transformation.invert(qD._tempM0),qW_.transformCoordinate(qS,qD._tempM0,qD._tempV30);var qV=qD._tempV30.elements,qW=Math.abs(qV[0]),qk=Math.abs(qV[1]),qz=Math.abs(qV[2]);return qvS.nearEqual(qW,qa)&&qvS.nearEqual(qk,qR)&&qvS.nearEqual(qz,qJ)?2:qW<qa&&qk<qR&&qz<qJ?1:0},qS.containsPoints=function(qS){var q_=this.extents.elements,qa=q_[0],qR=q_[1],qJ=q_[2];this.transformation.invert(qD._tempM0);for(var qV=!0,qW=!1,qk=0;qk<qS.length;qk++){qW_.transformCoordinate(qS[qk],qD._tempM0,qD._tempV30);var qz=qD._tempV30.elements,qb=Math.abs(qz[0]),qH=Math.abs(qz[1]),qL=Math.abs(qz[2]);qvS.nearEqual(qb,qa)&&qvS.nearEqual(qH,qR)&&qvS.nearEqual(qL,qJ)&&(qW=!0),qb<qa&&qH<qR&&qL<qJ?qW=!0:qV=!1}return qV?1:qW?2:0},qS.containsSphere=function(qS,q_){void 0===q_&&(q_=!1);var qa=this.extents.elements,qR=qa[0],qJ=qa[1],qV=qa[2],qW=qS.radius;this.transformation.invert(qD._tempM0),qW_.transformCoordinate(qS.center,qD._tempM0,qD._tempV30);var qk=NaN;if(qk=q_?qW:(qW_.scale(qW_.UnitX,qW,qD._tempV31),qW_.TransformNormal(qD._tempV31,qD._tempM0,qD._tempV31),qW_.scalarLength(qD._tempV31)),qW_.scale(this.extents,-1,qD._tempV32),qW_.Clamp(qD._tempV30,qD._tempV32,this.extents,qD._tempV33),qk*qk<qW_.distanceSquared(qD._tempV30,qD._tempV33))return 0;var qz=qD._tempV30.elements,qb=qz[0],qH=qz[1],qL=qz[2],qC=qD._tempV32.elements,qG=qC[0],qt=qC[1],qo=qC[2];return qG+qk<=qb&&qb<=qR-qk&&qk<qR-qG&&qt+qk<=qH&&qH<=qJ-qk&&qk<qJ-qt&&qo+qk<=qL&&qL<=qV-qk&&qk<qV-qo?1:2},qS.containsOrientedBoundBox=function(qS){var q_=0,qa=0;qS.getCorners(qD._corners);var qR=this.containsPoints(qD._corners);if(0!=qR)return qR;var qJ=this.extents.elements;qS.extents.cloneTo(qD._tempV35);var qV=qD._tempV35.elements;qD._getRows(this.transformation,qD._rows1),qD._getRows(qS.transformation,qD._rows2);var qW=NaN;for(q_=0;q_<4;q_++)for(qa=0;qa<4;qa++)3==q_||3==qa?(qD._tempM0.setElementByRowColumn(q_,qa,0),qD._tempM1.setElementByRowColumn(q_,qa,0)):(qW=qW_.dot(qD._rows1[q_],qD._rows2[qa]),qD._tempM0.setElementByRowColumn(q_,qa,qW),qD._tempM1.setElementByRowColumn(q_,qa,Math.abs(qW)));qS.getCenter(qD._tempV34),this.getCenter(qD._tempV36),qW_.subtract(qD._tempV34,qD._tempV36,qD._tempV30);var qk=qD._tempV31.elements;qk[0]=qW_.dot(qD._tempV30,qD._rows1[0]),qk[1]=qW_.dot(qD._tempV30,qD._rows1[1]),qk[2]=qW_.dot(qD._tempV30,qD._rows1[2]);var qz=qD._tempV32.elements,qb=qD._tempV33.elements;for(q_=0;q_<3;q_++)if(qz[0]=qD._tempM1.getElementByRowColumn(q_,0),qz[1]=qD._tempM1.getElementByRowColumn(q_,1),qz[2]=qD._tempM1.getElementByRowColumn(q_,2),qJ[q_]+qW_.dot(qD._tempV35,qD._tempV32)<Math.abs(qk[q_]))return 0;for(qa=0;qa<3;qa++)if(qz[0]=qD._tempM1.getElementByRowColumn(0,qa),qz[1]=qD._tempM1.getElementByRowColumn(1,qa),qz[2]=qD._tempM1.getElementByRowColumn(2,qa),qb[0]=qD._tempM0.getElementByRowColumn(0,qa),qb[1]=qD._tempM0.getElementByRowColumn(1,qa),qb[2]=qD._tempM0.getElementByRowColumn(2,qa),qW_.dot(this.extents,qD._tempV32)+qV[qa]<Math.abs(qW_.dot(qD._tempV31,qD._tempV33)))return 0;for(q_=0;q_<3;q_++)for(qa=0;qa<3;qa++){var qH=(q_+1)%3,qL=(q_+2)%3,qC=(qa+1)%3,qG=(qa+2)%3;if(qJ[qH]*qD._tempM1.getElementByRowColumn(qL,qa)+qJ[qL]*qD._tempM1.getElementByRowColumn(qH,qa)+(qV[qC]*qD._tempM1.getElementByRowColumn(q_,qG)+qV[qG]*qD._tempM1.getElementByRowColumn(q_,qC))<Math.abs(qk[qL]*qD._tempM0.getElementByRowColumn(qH,qa)-qk[qH]*qD._tempM0.getElementByRowColumn(qL,qa)))return 0}return 2},qS.containsLine=function(qS,q_){qD._corners[0]=qS,qD._corners[1]=q_;var qa=this.containsPoints(qD._corners);if(0!=qa)return qa;var qR=this.extents.elements,qJ=qR[0],qV=qR[1],qW=qR[2];this.transformation.invert(qD._tempM0),qW_.transformCoordinate(qS,qD._tempM0,qD._tempV30),qW_.transformCoordinate(q_,qD._tempM0,qD._tempV31),qW_.add(qD._tempV30,qD._tempV31,qD._tempV32),qW_.scale(qD._tempV32,.5,qD._tempV32),qW_.subtract(qD._tempV30,qD._tempV32,qD._tempV33);var qk=qD._tempV33.elements,qz=qk[0],qb=qk[1],qH=qk[2],qL=qD._tempV34.elements,qC=qL[0]=Math.abs(qk[0]),qG=qL[1]=Math.abs(qk[1]),qt=qL[2]=Math.abs(qk[2]),qo=qD._tempV32.elements,q$=qo[0],qF=qo[1],qT=qo[2];return Math.abs(q$)>qJ+qC?0:Math.abs(qF)>qV+qG?0:Math.abs(qT)>qW+qt?0:Math.abs(qF*qH-qT*qb)>qV*qt+qW*qG?0:Math.abs(q$*qH-qT*qz)>qJ*qt+qW*qC?0:Math.abs(q$*qb-qF*qz)>qJ*qG+qV*qC?0:2},qS.containsBoundBox=function(qS){var q_=0,qa=0,qR=qS.min,qJ=qS.max;qS.getCorners(qD._corners);var qV=this.containsPoints(qD._corners);if(0!=qV)return qV;qW_.subtract(qJ,qR,qD._tempV30),qW_.scale(qD._tempV30,.5,qD._tempV30),qW_.add(qR,qD._tempV30,qD._tempV30),qW_.subtract(qJ,qD._tempV30,qD._tempV31);var qW=this.extents.elements,qk=qD._tempV31.elements;qD._getRows(this.transformation,qD._rows1),this.transformation.invert(qD._tempM0);for(q_=0;q_<3;q_++)for(qa=0;qa<3;qa++)qD._tempM1.setElementByRowColumn(q_,qa,Math.abs(qD._tempM0.getElementByRowColumn(q_,qa)));this.getCenter(qD._tempV35),qW_.subtract(qD._tempV30,qD._tempV35,qD._tempV32);var qz=qD._tempV31.elements;qz[0]=qW_.dot(qD._tempV32,qD._rows1[0]),qz[1]=qW_.dot(qD._tempV32,qD._rows1[1]),qz[2]=qW_.dot(qD._tempV32,qD._rows1[2]);var qb=qD._tempV33.elements,qH=qD._tempV34.elements;for(q_=0;q_<3;q_++)if(qb[0]=qD._tempM1.getElementByRowColumn(q_,0),qb[1]=qD._tempM1.getElementByRowColumn(q_,1),qb[2]=qD._tempM1.getElementByRowColumn(q_,2),qW[q_]+qW_.dot(qD._tempV31,qD._tempV33)<Math.abs(qz[q_]))return 0;for(qa=0;qa<3;qa++)if(qb[0]=qD._tempM1.getElementByRowColumn(0,qa),qb[1]=qD._tempM1.getElementByRowColumn(1,qa),qb[2]=qD._tempM1.getElementByRowColumn(2,qa),qH[0]=qD._tempM0.getElementByRowColumn(0,qa),qH[1]=qD._tempM0.getElementByRowColumn(1,qa),qH[2]=qD._tempM0.getElementByRowColumn(2,qa),qW_.dot(this.extents,qD._tempV33)+qk[qa]<Math.abs(qW_.dot(qD._tempV31,qD._tempV34)))return 0;for(q_=0;q_<3;q_++)for(qa=0;qa<3;qa++){var qL=(q_+1)%3,qC=(q_+2)%3,qG=(qa+1)%3,qt=(qa+2)%3;if(qW[qL]*qD._tempM1.getElementByRowColumn(qC,qa)+qW[qC]*qD._tempM1.getElementByRowColumn(qL,qa)+(qk[qG]*qD._tempM1.getElementByRowColumn(q_,qt)+qk[qt]*qD._tempM1.getElementByRowColumn(q_,qG))<Math.abs(qz[qC]*qD._tempM0.getElementByRowColumn(qL,qa)-qz[qL]*qD._tempM0.getElementByRowColumn(qC,qa)))return 0}return 2},qS.intersectsRay=function(qS,q_){qW_.scale(this.extents,-1,qD._tempV30),this.transformation.invert(qD._tempM0),qW_.TransformNormal(qS.direction,qD._tempM0,qD._ray.direction),qW_.transformCoordinate(qS.origin,qD._tempM0,qD._ray.origin),qD._boxBound1.min=qD._tempV30,qD._boxBound1.max=this.extents;var qa=Collision.intersectsRayAndBoxRP(qD._ray,qD._boxBound1,q_);return-1!==qa&&qW_.transformCoordinate(q_,this.transformation,q_),qa},qS._getLocalCorners=function(qS){qS.length=8;var q_=this.extents.elements;qD._tempV30.x=q_[0],qD._tempV31.y=q_[1],qD._tempV32.z=q_[2],qW_.add(qD._tempV30,qD._tempV31,qD._tempV33),qW_.add(qD._tempV33,qD._tempV32,qS[0]),qW_.add(qD._tempV30,qD._tempV31,qD._tempV33),qW_.subtract(qD._tempV33,qD._tempV32,qS[1]),qW_.subtract(qD._tempV31,qD._tempV30,qD._tempV33),qW_.subtract(qD._tempV33,qD._tempV30,qS[2]),qW_.subtract(qD._tempV31,qD._tempV30,qD._tempV33),qW_.add(qD._tempV33,qD._tempV32,qS[3]),qW_.subtract(qD._tempV30,qD._tempV31,qD._tempV33),qW_.add(qD._tempV33,qD._tempV32,qS[4]),qW_.subtract(qD._tempV30,qD._tempV31,qD._tempV33),qW_.subtract(qD._tempV33,qD._tempV32,qS[5]),qW_.scale(qS[0],-1,qS[6]),qW_.subtract(qD._tempV32,qD._tempV30,qD._tempV33),qW_.subtract(qD._tempV33,qD._tempV31,qS[7])},qS.equals=function(qS){return this.extents==qS.extents&&this.transformation==qS.transformation},qS.cloneTo=function(qS){var q_=qS;this.extents.cloneTo(q_.extents),this.transformation.cloneTo(q_.transformation)},qD.createByBoundBox=function(qS,q_){var qa=qS.min,qR=qS.max;qW_.subtract(qR,qa,qD._tempV30),qW_.scale(qD._tempV30,.5,qD._tempV30),qW_.add(qa,qD._tempV30,qD._tempV31),qW_.subtract(qR,qD._tempV31,qD._tempV32),qS_.translation(qD._tempV31,qD._tempM0);var qJ=qD._tempV32.clone(),qV=qD._tempM0.clone();q_.extents=qJ,q_.transformation=qV},qD.createByMinAndMaxVertex=function(qS,q_){return qW_.subtract(q_,qS,qD._tempV30),qW_.scale(qD._tempV30,.5,qD._tempV30),qW_.add(qS,qD._tempV30,qD._tempV31),qW_.subtract(q_,qD._tempV31,qD._tempV32),qS_.translation(qD._tempV31,qD._tempM0),new qD(qD._tempV32,qD._tempM0)},qD._getRows=function(qS,q_){q_.length=3;var qa=qS.elements,qR=q_[0].elements;qR[0]=qa[0],qR[1]=qa[1],qR[2]=qa[2];var qJ=q_[1].elements;qJ[0]=qa[4],qJ[1]=qa[5],qJ[2]=qa[6];var qV=q_[2].elements;qV[0]=qa[8],qV[1]=qa[9],qV[2]=qa[10]},qD.getObbtoObbMatrix4x4=function(qS,q_,qa,qR){var qJ=qS.transformation,qV=q_.transformation;if(qa){qD._getRows(qJ,qD._rows1),qD._getRows(qV,qD._rows2);for(var qW=0;qW<3;qW++)for(var qk=0;qk<3;qk++)qR.setElementByRowColumn(qW,qk,qW_.dot(qD._rows2[qW],qD._rows1[qk]));q_.getCenter(qD._tempV30),qS.getCenter(qD._tempV31),qW_.subtract(qD._tempV30,qD._tempV31,qD._tempV32);var qz=qR.elements;qz[12]=qW_.dot(qD._tempV32,qD._rows1[0]),qz[13]=qW_.dot(qD._tempV32,qD._rows1[1]),qz[14]=qW_.dot(qD._tempV32,qD._rows1[2]),qz[15]=1}else qJ.invert(qD._tempM0),qS_.multiply(qV,qD._tempM0,qR)},qD.merge=function(qS,q_,qa){var qR=qS.extents,qJ=qS.transformation;qD.getObbtoObbMatrix4x4(qS,q_,qa,qD._tempM0),q_._getLocalCorners(qD._corners),qW_.transformCoordinate(qD._corners[0],qD._tempM0,qD._corners[0]),qW_.transformCoordinate(qD._corners[1],qD._tempM0,qD._corners[1]),qW_.transformCoordinate(qD._corners[2],qD._tempM0,qD._corners[2]),qW_.transformCoordinate(qD._corners[3],qD._tempM0,qD._corners[3]),qW_.transformCoordinate(qD._corners[4],qD._tempM0,qD._corners[4]),qW_.transformCoordinate(qD._corners[5],qD._tempM0,qD._corners[5]),qW_.transformCoordinate(qD._corners[6],qD._tempM0,qD._corners[6]),qW_.transformCoordinate(qD._corners[7],qD._tempM0,qD._corners[7]),qW_.scale(qR,-1,qD._boxBound1.min),qR.cloneTo(qD._boxBound1.max),qES.createfromPoints(qD._corners,qD._boxBound2),qES.merge(qD._boxBound2,qD._boxBound1,qD._boxBound3);var qV=qD._boxBound3.min,qW=qD._boxBound3.max;qW_.subtract(qW,qV,qD._tempV30),qW_.scale(qD._tempV30,.5,qD._tempV30),qW_.add(qV,qD._tempV30,qD._tempV32),qW_.subtract(qW,qD._tempV32,qR),qW_.transformCoordinate(qD._tempV32,qJ,qD._tempV33)},qL(qD,["_tempV30",function(){return this._tempV30=new qW_},"_tempV31",function(){return this._tempV31=new qW_},"_tempV32",function(){return this._tempV32=new qW_},"_tempV33",function(){return this._tempV33=new qW_},"_tempV34",function(){return this._tempV34=new qW_},"_tempV35",function(){return this._tempV35=new qW_},"_tempV36",function(){return this._tempV36=new qW_},"_tempM0",function(){return this._tempM0=new qS_},"_tempM1",function(){return this._tempM1=new qS_},"_corners",function(){return this._corners=[new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_]},"_rows1",function(){return this._rows1=[new qW_,new qW_,new qW_]},"_rows2",function(){return this._rows2=[new qW_,new qW_,new qW_]},"_ray",function(){return this._ray=new qJ_(new qW_,new qW_)},"_boxBound1",function(){return this._boxBound1=new qES(new qW_,new qW_)},"_boxBound2",function(){return this._boxBound2=new qES(new qW_,new qW_)},"_boxBound3",function(){return this._boxBound3=new qES(new qW_,new qW_)}])}(),function(){function qQ(qS,q_){this.normal=null,this.distance=NaN,void 0===q_&&(q_=0),this.normal=qS,this.distance=q_}return qG(qQ,"laya.d3.math.Plane"),qQ.prototype.normalize=function(){var qS=this.normal.elements,q_=qS[0],qa=qS[1],qR=qS[2],qJ=1/Math.sqrt(q_*q_+qa*qa+qR*qR);qS[0]=q_*qJ,qS[1]=qa*qJ,qS[2]=qR*qJ,this.distance*=qJ},qQ.createPlaneBy3P=function(qS,q_,qa){var qR=qS.elements,qJ=q_.elements,qV=qa.elements,qW=qJ[0]-qR[0],qk=qJ[1]-qR[1],qz=qJ[2]-qR[2],qb=qV[0]-qR[0],qH=qV[1]-qR[1],qL=qV[2]-qR[2],qC=qk*qL-qz*qH,qG=qz*qb-qW*qL,qt=qW*qH-qk*qb,qo=1/Math.sqrt(qC*qC+qG*qG+qt*qt),q$=qC*qo,qF=qG*qo,qT=qt*qo,qD=qQ._TEMPVec3.elements;qD[0]=q$,qD[1]=qF,qD[2]=qT;var qj=-(q$*qR[0]+qF*qR[1]+qT*qR[2]);return new qQ(qQ._TEMPVec3,qj)},qQ.PlaneIntersectionType_Back=0,qQ.PlaneIntersectionType_Front=1,qQ.PlaneIntersectionType_Intersecting=2,qL(qQ,["_TEMPVec3",function(){return this._TEMPVec3=new qW_}]),qQ}()),qa_=function(){function qJ(qS,q_,qa,qR){this.elements=new Float32Array(4),void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=1),this.elements[0]=qS,this.elements[1]=q_,this.elements[2]=qa,this.elements[3]=qR}qG(qJ,"laya.d3.math.Quaternion");var qS=qJ.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.scaling=function(qS,q_){var qa=q_.elements,qR=this.elements;qa[0]=qR[0]*qS,qa[1]=qR[1]*qS,qa[2]=qR[2]*qS,qa[3]=qR[3]*qS},qS.normalize=function(qS){var q_=qS.elements,qa=this.elements,qR=qa[0],qJ=qa[1],qV=qa[2],qW=qa[3],qk=qR*qR+qJ*qJ+qV*qV+qW*qW;0<qk&&(qk=1/Math.sqrt(qk),q_[0]=qR*qk,q_[1]=qJ*qk,q_[2]=qV*qk,q_[3]=qW*qk)},qS.length=function(){var qS=this.elements,q_=qS[0],qa=qS[1],qR=qS[2],qJ=qS[3];return Math.sqrt(q_*q_+qa*qa+qR*qR+qJ*qJ)},qS.rotateX=function(qS,q_){var qa=q_.elements,qR=this.elements;qS*=.5;var qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=Math.sin(qS),qb=Math.cos(qS);qa[0]=qJ*qb+qk*qz,qa[1]=qV*qb+qW*qz,qa[2]=qW*qb-qV*qz,qa[3]=qk*qb-qJ*qz},qS.rotateY=function(qS,q_){var qa=q_.elements,qR=this.elements;qS*=.5;var qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=Math.sin(qS),qb=Math.cos(qS);qa[0]=qJ*qb-qW*qz,qa[1]=qV*qb+qk*qz,qa[2]=qW*qb+qJ*qz,qa[3]=qk*qb-qV*qz},qS.rotateZ=function(qS,q_){var qa=q_.elements,qR=this.elements;qS*=.5;var qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=Math.sin(qS),qb=Math.cos(qS);qa[0]=qJ*qb+qV*qz,qa[1]=qV*qb-qJ*qz,qa[2]=qW*qb+qk*qz,qa[3]=qk*qb-qW*qz},qS.getYawPitchRoll=function(qS){qW_.transformQuat(qW_.ForwardRH,this,qJ.TEMPVector31),qW_.transformQuat(qW_.Up,this,qJ.TEMPVector32);var q_=qJ.TEMPVector32.elements;qJ.angleTo(qW_.ZERO,qJ.TEMPVector31,qJ.TEMPVector33);var qa=qJ.TEMPVector33.elements;qa[0]==Math.PI/2?(qa[1]=qJ.arcTanAngle(q_[2],q_[0]),qa[2]=0):qa[0]==-Math.PI/2?(qa[1]=qJ.arcTanAngle(-q_[2],-q_[0]),qa[2]=0):(qS_.createRotationY(-qa[1],qJ.TEMPMatrix0),qS_.createRotationX(-qa[0],qJ.TEMPMatrix1),qW_.transformCoordinate(qJ.TEMPVector32,qJ.TEMPMatrix0,qJ.TEMPVector32),qW_.transformCoordinate(qJ.TEMPVector32,qJ.TEMPMatrix1,qJ.TEMPVector32),qa[2]=qJ.arcTanAngle(q_[1],-q_[0])),qa[1]<=-Math.PI&&(qa[1]=Math.PI),qa[2]<=-Math.PI&&(qa[2]=Math.PI),qa[1]>=Math.PI&&qa[2]>=Math.PI&&(qa[1]=0,qa[2]=0,qa[0]=Math.PI-qa[0]);var qR=qS.elements;qR[0]=qa[1],qR[1]=qa[0],qR[2]=qa[2]},qS.invert=function(qS){var q_=qS.elements,qa=this.elements,qR=qa[0],qJ=qa[1],qV=qa[2],qW=qa[3],qk=qR*qR+qJ*qJ+qV*qV+qW*qW,qz=qk?1/qk:0;q_[0]=-qR*qz,q_[1]=-qJ*qz,q_[2]=-qV*qz,q_[3]=qW*qz},qS.identity=function(){var qS=this.elements;qS[0]=0,qS[1]=0,qS[2]=0,qS[3]=1},qS.fromArray=function(qS,q_){void 0===q_&&(q_=0),this.elements[0]=qS[q_+0],this.elements[1]=qS[q_+1],this.elements[2]=qS[q_+2],this.elements[3]=qS[q_+3]},qS.cloneTo=function(qS){var q_,qa,qR;if((qa=this.elements)!==(qR=qS.elements))for(q_=0;q_<4;++q_)qR[q_]=qa[q_]},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qS.equals=function(qS){var q_=this.elements,qa=qS.elements;return qvS.nearEqual(q_[0],qa[0])&&qvS.nearEqual(q_[1],qa[1])&&qvS.nearEqual(q_[2],qa[2])&&qvS.nearEqual(q_[3],qa[3])},qS.lengthSquared=function(){var qS=this.elements[0],q_=this.elements[1],qa=this.elements[2],qR=this.elements[3];return qS*qS+q_*q_+qa*qa+qR*qR},qt(0,qS,"x",function(){return this.elements[0]}),qt(0,qS,"y",function(){return this.elements[1]}),qt(0,qS,"z",function(){return this.elements[2]}),qt(0,qS,"w",function(){return this.elements[3]}),qJ.createFromYawPitchRoll=function(qS,q_,qa,qR){var qJ=.5*qa,qV=.5*q_,qW=.5*qS,qk=Math.sin(qJ),qz=Math.cos(qJ),qb=Math.sin(qV),qH=Math.cos(qV),qL=Math.sin(qW),qC=Math.cos(qW),qG=qR.elements;qG[0]=qC*qb*qz+qL*qH*qk,qG[1]=qL*qH*qz-qC*qb*qk,qG[2]=qC*qH*qk-qL*qb*qz,qG[3]=qC*qH*qz+qL*qb*qk},qJ.multiply=function(qS,q_,qa){var qR=qS.elements,qJ=q_.elements,qV=qa.elements,qW=qR[0],qk=qR[1],qz=qR[2],qb=qR[3],qH=qJ[0],qL=qJ[1],qC=qJ[2],qG=qJ[3],qt=qk*qC-qz*qL,qo=qz*qH-qW*qC,q$=qW*qL-qk*qH,qF=qW*qH+qk*qL+qz*qC;qV[0]=qW*qG+qH*qb+qt,qV[1]=qk*qG+qL*qb+qo,qV[2]=qz*qG+qC*qb+q$,qV[3]=qb*qG-qF},qJ.arcTanAngle=function(qS,q_){return 0==qS?1==q_?Math.PI/2:-Math.PI/2:0<qS?Math.atan(q_/qS):qS<0?0<q_?Math.atan(q_/qS)+Math.PI:Math.atan(q_/qS)-Math.PI:0},qJ.angleTo=function(qS,q_,qa){qW_.subtract(q_,qS,qJ.TEMPVector30),qW_.normalize(qJ.TEMPVector30,qJ.TEMPVector30),qa.elements[0]=Math.asin(qJ.TEMPVector30.y),qa.elements[1]=qJ.arcTanAngle(-qJ.TEMPVector30.z,-qJ.TEMPVector30.x)},qJ.createFromAxisAngle=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements;q_*=.5;var qV=Math.sin(q_);qR[0]=qV*qJ[0],qR[1]=qV*qJ[1],qR[2]=qV*qJ[2],qR[3]=Math.cos(q_)},qJ.createFromMatrix3x3=function(qS,q_){var qa,qR=q_.elements,qJ=qS.elements,qV=qJ[0]+qJ[4]+qJ[8];if(0<qV)qa=Math.sqrt(qV+1),qR[3]=.5*qa,qa=.5/qa,qR[0]=(qJ[5]-qJ[7])*qa,qR[1]=(qJ[6]-qJ[2])*qa,qR[2]=(qJ[1]-qJ[3])*qa;else{var qW=0;qJ[4]>qJ[0]&&(qW=1),qJ[8]>qJ[3*qW+qW]&&(qW=2);var qk=(qW+1)%3,qz=(qW+2)%3;qa=Math.sqrt(qJ[3*qW+qW]-qJ[3*qk+qk]-qJ[3*qz+qz]+1),qR[qW]=.5*qa,qa=.5/qa,qR[3]=(qJ[3*qk+qz]-qJ[3*qz+qk])*qa,qR[qk]=(qJ[3*qk+qW]+qJ[3*qW+qk])*qa,qR[qz]=(qJ[3*qz+qW]+qJ[3*qW+qz])*qa}},qJ.createFromMatrix4x4=function(qS,q_){var qa,qR,qJ=qS.elements,qV=q_.elements,qW=qJ[0]+qJ[5]+qJ[10];0<qW?(qa=Math.sqrt(qW+1),qV[3]=.5*qa,qa=.5/qa,qV[0]=(qJ[6]-qJ[9])*qa,qV[1]=(qJ[8]-qJ[2])*qa,qV[2]=(qJ[1]-qJ[4])*qa):qJ[0]>=qJ[5]&&qJ[0]>=qJ[10]?(qR=.5/(qa=Math.sqrt(1+qJ[0]-qJ[5]-qJ[10])),qV[0]=.5*qa,qV[1]=(qJ[1]+qJ[4])*qR,qV[2]=(qJ[2]+qJ[8])*qR,qV[3]=(qJ[6]-qJ[9])*qR):qJ[5]>qJ[10]?(qR=.5/(qa=Math.sqrt(1+qJ[5]-qJ[0]-qJ[10])),qV[0]=(qJ[4]+qJ[1])*qR,qV[1]=.5*qa,qV[2]=(qJ[9]+qJ[6])*qR,qV[3]=(qJ[8]-qJ[2])*qR):(qR=.5/(qa=Math.sqrt(1+qJ[10]-qJ[0]-qJ[5])),qV[0]=(qJ[8]+qJ[2])*qR,qV[1]=(qJ[9]+qJ[6])*qR,qV[2]=.5*qa,qV[3]=(qJ[1]-qJ[4])*qR)},qJ.slerp=function(qS,q_,qa,qR){var qJ,qV,qW,qk,qz,qb=qS.elements,qH=q_.elements,qL=qR.elements,qC=qb[0],qG=qb[1],qt=qb[2],qo=qb[3],q$=qH[0],qF=qH[1],qT=qH[2],qD=qH[3];return(qV=qC*q$+qG*qF+qt*qT+qo*qD)<0&&(qV=-qV,q$=-q$,qF=-qF,qT=-qT,qD=-qD),qz=1e-6<1-qV?(qJ=Math.acos(qV),qW=Math.sin(qJ),qk=Math.sin((1-qa)*qJ)/qW,Math.sin(qa*qJ)/qW):(qk=1-qa,qa),qL[0]=qk*qC+qz*q$,qL[1]=qk*qG+qz*qF,qL[2]=qk*qt+qz*qT,qL[3]=qk*qo+qz*qD,qL},qJ.lerp=function(qS,q_,qa,qR){var qJ=qR.elements,qV=qS.elements,qW=q_.elements,qk=qV[0],qz=qV[1],qb=qV[2],qH=qV[3];qJ[0]=qk+qa*(qW[0]-qk),qJ[1]=qz+qa*(qW[1]-qz),qJ[2]=qb+qa*(qW[2]-qb),qJ[3]=qH+qa*(qW[3]-qH)},qJ.add=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]+qV[0],qR[1]=qJ[1]+qV[1],qR[2]=qJ[2]+qV[2],qR[3]=qJ[3]+qV[3]},qJ.dot=function(qS,q_){var qa=qS.elements,qR=q_.elements;return qa[0]*qR[0]+qa[1]*qR[1]+qa[2]*qR[2]+qa[3]*qR[3]},qJ.rotationLookAt=function(qS,q_,qa){qJ.lookAt(qW_.ZERO,qS,q_,qa)},qJ.lookAt=function(qS,q_,qa,qR){qdS.lookAt(qS,q_,qa,qJ._tempMatrix3x3),qJ.rotationMatrix(qJ._tempMatrix3x3,qR)},qJ.invert=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qS.lengthSquared();qvS.isZero(qJ)||(qJ=1/qJ,qR[0]=-qa[0]*qJ,qR[1]=-qa[1]*qJ,qR[2]=-qa[2]*qJ,qR[3]=qa[3]*qJ)},qJ.rotationMatrix=function(qS,q_){var qa=qS.elements,qR=qa[0],qJ=qa[1],qV=qa[2],qW=qa[3],qk=qa[4],qz=qa[5],qb=qa[6],qH=qa[7],qL=qa[8],qC=q_.elements,qG=NaN,qt=NaN,qo=qR+qk+qL;0<qo?(qG=Math.sqrt(qo+1),qC[3]=.5*qG,qG=.5/qG,qC[0]=(qz-qH)*qG,qC[1]=(qb-qV)*qG,qC[2]=(qJ-qW)*qG):qk<=qR&&qL<=qR?(qt=.5/(qG=Math.sqrt(1+qR-qk-qL)),qC[0]=.5*qG,qC[1]=(qJ+qW)*qt,qC[2]=(qV+qb)*qt,qC[3]=(qz-qH)*qt):qL<qk?(qt=.5/(qG=Math.sqrt(1+qk-qR-qL)),qC[0]=(qW+qJ)*qt,qC[1]=.5*qG,qC[2]=(qH+qz)*qt,qC[3]=(qb-qV)*qt):(qt=.5/(qG=Math.sqrt(1+qL-qR-qk)),qC[0]=(qb+qV)*qt,qC[1]=(qH+qz)*qt,qC[2]=.5*qG,qC[3]=(qJ-qW)*qt)},qJ.DEFAULT=new qJ,qL(qJ,["TEMPVector30",function(){return this.TEMPVector30=new qW_},"TEMPVector31",function(){return this.TEMPVector31=new qW_},"TEMPVector32",function(){return this.TEMPVector32=new qW_},"TEMPVector33",function(){return this.TEMPVector33=new qW_},"TEMPMatrix0",function(){return this.TEMPMatrix0=new qS_},"TEMPMatrix1",function(){return this.TEMPMatrix1=new qS_},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new qdS},"NAN",function(){return this.NAN=new qJ(NaN,NaN,NaN,NaN)}]),qJ}(),qR_=function(){function qS(qS){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=qS,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}qG(qS,"laya.d3.math.Rand");var q_=qS.prototype;return q_.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},q_.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},q_.getSignedFloat=function(){return 2*this.getFloat()-1},qt(0,q_,"seed",function(){return this.seeds[0]},function(qS){this.seeds[0]=qS,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),qS.getFloatFromInt=function(qS){return 1/8388607*(8388607&qS)},qS.getByteFromInt=function(qS){return(8388607&qS)>>>15},qS}(),qJ_=(function(){function qJ(qS){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(qS instanceof Array)||4!==qS.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|qS[0],this._state0L=0|qS[1],this._state1U=0|qS[2],this._state1L=0|qS[3]}qG(qJ,"laya.d3.math.RandX");var qS=qJ.prototype;qS.randomint=function(){var qS=this._state0U,q_=this._state0L,qa=this._state1U,qR=this._state1L,qJ=(qR>>>0)+(q_>>>0),qV=qa+qS+(qJ/2>>>31)>>>0,qW=qJ>>>0,qk=0,qz=0;qk=(qS^=qk=qS<<23|(-512&q_)>>>9)^(this._state0U=qa),qz=(q_^=qz=q_<<23)^(this._state0L=qR);qk^=qS>>>18,qz^=q_>>>18|(262143&qS)<<14;return qk^=qa>>>5,qz^=qR>>>5|(31&qa)<<27,this._state1U=qk,this._state1L=qz,[qV,qW]},qS.random=function(){var qS=this.randomint(),q_=qS[0],qa=1023<<20|q_>>>12,qR=0|(qS[1]>>>12|(4095&q_)<<20);return qJ._CONVERTION_BUFFER.setUint32(0,qa,!1),qJ._CONVERTION_BUFFER.setUint32(4,qR,!1),qR_._CONVERTION_BUFFER.getFloat64(0,!1)-1},qL(qJ,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new qR_([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function qS(qS,q_){this.origin=null,this.direction=null,this.origin=qS,this.direction=q_}return qG(qS,"laya.d3.math.Ray"),qS}()),qV_=function(){function qS(qS,q_){this.elements=new Float32Array(2),void 0===qS&&(qS=0),void 0===q_&&(q_=0);var qa=this.elements;qa[0]=qS,qa[1]=q_}qG(qS,"laya.d3.math.Vector2");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.fromArray=function(qS,q_){void 0===q_&&(q_=0),this.elements[0]=qS[q_+0],this.elements[1]=qS[q_+1]},q_.cloneTo=function(qS){var q_=qS.elements,qa=this.elements;q_[0]=qa[0],q_[1]=qa[1]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"x",function(){return this.elements[0]},function(qS){this.elements[0]=qS}),qt(0,q_,"y",function(){return this.elements[1]},function(qS){this.elements[1]=qS}),qS.scale=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements;qR[0]=qJ[0]*q_,qR[1]=qJ[1]*q_},qL(qS,["ZERO",function(){return this.ZERO=new qS(0,0)},"ONE",function(){return this.ONE=new qS(1,1)}]),qS}(),qW_=function(){function qH(qS,q_,qa){this.elements=new Float32Array(3),void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0);var qR=this.elements;qR[0]=qS,qR[1]=q_,qR[2]=qa}qG(qH,"laya.d3.math.Vector3");var qS=qH.prototype;return qQ.imps(qS,{"laya.d3.core.IClone":!0}),qS.fromArray=function(qS,q_){void 0===q_&&(q_=0),this.elements[0]=qS[q_+0],this.elements[1]=qS[q_+1],this.elements[2]=qS[q_+2]},qS.cloneTo=function(qS){var q_=qS.elements,qa=this.elements;q_[0]=qa[0],q_[1]=qa[1],q_[2]=qa[2]},qS.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qS.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},qS.reset=function(qS,q_,qa){this.elements[0]=qS,this.elements[1]=q_,this.elements[2]=qa},qt(0,qS,"x",function(){return this.elements[0]},function(qS){this.elements[0]=qS}),qt(0,qS,"y",function(){return this.elements[1]},function(qS){this.elements[1]=qS}),qt(0,qS,"z",function(){return this.elements[2]},function(qS){this.elements[2]=qS}),qH.distanceSquared=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0]-qR[0],qV=qa[1]-qR[1],qW=qa[2]-qR[2];return qJ*qJ+qV*qV+qW*qW},qH.distance=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0]-qR[0],qV=qa[1]-qR[1],qW=qa[2]-qR[2];return Math.sqrt(qJ*qJ+qV*qV+qW*qW)},qH.min=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=Math.min(qJ[0],qV[0]),qR[1]=Math.min(qJ[1],qV[1]),qR[2]=Math.min(qJ[2],qV[2])},qH.max=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=Math.max(qJ[0],qV[0]),qR[1]=Math.max(qJ[1],qV[1]),qR[2]=Math.max(qJ[2],qV[2])},qH.transformQuat=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements,qW=qJ[0],qk=qJ[1],qz=qJ[2],qb=qV[0],qH=qV[1],qL=qV[2],qC=qV[3],qG=qC*qW+qH*qz-qL*qk,qt=qC*qk+qL*qW-qb*qz,qo=qC*qz+qb*qk-qH*qW,q$=-qb*qW-qH*qk-qL*qz;qR[0]=qG*qC+q$*-qb+qt*-qL-qo*-qH,qR[1]=qt*qC+q$*-qH+qo*-qb-qG*-qL,qR[2]=qo*qC+q$*-qL+qG*-qH-qt*-qb},qH.scalarLength=function(qS){var q_=qS.elements,qa=q_[0],qR=q_[1],qJ=q_[2];return Math.sqrt(qa*qa+qR*qR+qJ*qJ)},qH.scalarLengthSquared=function(qS){var q_=qS.elements,qa=q_[0],qR=q_[1],qJ=q_[2];return qa*qa+qR*qR+qJ*qJ},qH.normalize=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0],qV=qa[1],qW=qa[2],qk=qJ*qJ+qV*qV+qW*qW;0<qk&&(qk=1/Math.sqrt(qk),qR[0]=qa[0]*qk,qR[1]=qa[1]*qk,qR[2]=qa[2]*qk)},qH.multiply=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]*qV[0],qR[1]=qJ[1]*qV[1],qR[2]=qJ[2]*qV[2]},qH.scale=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements;qR[0]=qJ[0]*q_,qR[1]=qJ[1]*q_,qR[2]=qJ[2]*q_},qH.lerp=function(qS,q_,qa,qR){var qJ=qR.elements,qV=qS.elements,qW=q_.elements,qk=qV[0],qz=qV[1],qb=qV[2];qJ[0]=qk+qa*(qW[0]-qk),qJ[1]=qz+qa*(qW[1]-qz),qJ[2]=qb+qa*(qW[2]-qb)},qH.transformV3ToV3=function(qS,q_,qa){var qR=qH._tempVector4;qH.transformV3ToV4(qS,q_,qR);var qJ=qR.elements,qV=qa.elements;qV[0]=qJ[0],qV[1]=qJ[1],qV[2]=qJ[2]},qH.transformV3ToV4=function(qS,q_,qa){var qR=qS.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=q_.elements,qz=qa.elements;qz[0]=qJ*qk[0]+qV*qk[4]+qW*qk[8]+qk[12],qz[1]=qJ*qk[1]+qV*qk[5]+qW*qk[9]+qk[13],qz[2]=qJ*qk[2]+qV*qk[6]+qW*qk[10]+qk[14],qz[3]=qJ*qk[3]+qV*qk[7]+qW*qk[11]+qk[15]},qH.TransformNormal=function(qS,q_,qa){var qR=qS.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=q_.elements,qz=qa.elements;qz[0]=qJ*qk[0]+qV*qk[4]+qW*qk[8],qz[1]=qJ*qk[1]+qV*qk[5]+qW*qk[9],qz[2]=qJ*qk[2]+qV*qk[6]+qW*qk[10]},qH.transformCoordinate=function(qS,q_,qa){var qR=qH._tempVector4.elements,qJ=qS.elements,qV=qJ[0],qW=qJ[1],qk=qJ[2],qz=q_.elements;qR[0]=qV*qz[0]+qW*qz[4]+qk*qz[8]+qz[12],qR[1]=qV*qz[1]+qW*qz[5]+qk*qz[9]+qz[13],qR[2]=qV*qz[2]+qW*qz[6]+qk*qz[10]+qz[14],qR[3]=1/(qV*qz[3]+qW*qz[7]+qk*qz[11]+qz[15]);var qb=qa.elements;qb[0]=qR[0]*qR[3],qb[1]=qR[1]*qR[3],qb[2]=qR[2]*qR[3]},qH.Clamp=function(qS,q_,qa,qR){var qJ=qS.elements,qV=qJ[0],qW=qJ[1],qk=qJ[2],qz=q_.elements,qb=qz[0],qH=qz[1],qL=qz[2],qC=qa.elements,qG=qC[0],qt=qC[1],qo=qC[2],q$=qR.elements;qV=(qV=qG<qV?qG:qV)<qb?qb:qV,qW=(qW=qt<qW?qt:qW)<qH?qH:qW,qk=(qk=qo<qk?qo:qk)<qL?qL:qk,q$[0]=qV,q$[1]=qW,q$[2]=qk},qH.add=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]+qV[0],qR[1]=qJ[1]+qV[1],qR[2]=qJ[2]+qV[2]},qH.subtract=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]-qV[0],qR[1]=qJ[1]-qV[1],qR[2]=qJ[2]-qV[2]},qH.cross=function(qS,q_,qa){var qR=qS.elements,qJ=q_.elements,qV=qa.elements,qW=qR[0],qk=qR[1],qz=qR[2],qb=qJ[0],qH=qJ[1],qL=qJ[2];qV[0]=qk*qL-qz*qH,qV[1]=qz*qb-qW*qL,qV[2]=qW*qH-qk*qb},qH.dot=function(qS,q_){var qa=qS.elements,qR=q_.elements;return qa[0]*qR[0]+qa[1]*qR[1]+qa[2]*qR[2]},qH.equals=function(qS,q_){var qa=qS.elements,qR=q_.elements;return qvS.nearEqual(Math.abs(qa[0]),Math.abs(qR[0]))&&qvS.nearEqual(Math.abs(qa[1]),Math.abs(qR[1]))&&qvS.nearEqual(Math.abs(qa[2]),Math.abs(qR[2]))},qH.ZERO=new qH(0,0,0),qH.ONE=new qH(1,1,1),qH.NegativeUnitX=new qH(-1,0,0),qH.UnitX=new qH(1,0,0),qH.UnitY=new qH(0,1,0),qH.UnitZ=new qH(0,0,1),qH.ForwardRH=new qH(0,0,-1),qH.ForwardLH=new qH(0,0,1),qH.Up=new qH(0,1,0),qH.NAN=new qH(NaN,NaN,NaN),qL(qH,["_tempVector4",function(){return this._tempVector4=new qk_}]),qH}(),qk_=function(){function qS(qS,q_,qa,qR){this.elements=new Float32Array(4),void 0===qS&&(qS=0),void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=0);var qJ=this.elements;qJ[0]=qS,qJ[1]=q_,qJ[2]=qa,qJ[3]=qR}qG(qS,"laya.d3.math.Vector4");var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_.fromArray=function(qS,q_){void 0===q_&&(q_=0),this.elements[0]=qS[q_+0],this.elements[1]=qS[q_+1],this.elements[2]=qS[q_+2],this.elements[3]=qS[q_+3]},q_.cloneTo=function(qS){var q_=qS.elements,qa=this.elements;q_[0]=qa[0],q_[1]=qa[1],q_[2]=qa[2],q_[3]=qa[3]},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},q_.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},q_.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},qt(0,q_,"x",function(){return this.elements[0]},function(qS){this.elements[0]=qS}),qt(0,q_,"y",function(){return this.elements[1]},function(qS){this.elements[1]=qS}),qt(0,q_,"z",function(){return this.elements[2]},function(qS){this.elements[2]=qS}),qt(0,q_,"w",function(){return this.elements[3]},function(qS){this.elements[3]=qS}),qS.lerp=function(qS,q_,qa,qR){var qJ=qR.elements,qV=qS.elements,qW=q_.elements,qk=qV[0],qz=qV[1],qb=qV[2],qH=qV[3];qJ[0]=qk+qa*(qW[0]-qk),qJ[1]=qz+qa*(qW[1]-qz),qJ[2]=qb+qa*(qW[2]-qb),qJ[3]=qH+qa*(qW[3]-qH)},qS.transformByM4x4=function(qS,q_,qa){var qR=qS.elements,qJ=qR[0],qV=qR[1],qW=qR[2],qk=qR[3],qz=q_.elements,qb=qa.elements;qb[0]=qJ*qz[0]+qV*qz[4]+qW*qz[8]+qk*qz[12],qb[1]=qJ*qz[1]+qV*qz[5]+qW*qz[9]+qk*qz[13],qb[2]=qJ*qz[2]+qV*qz[6]+qW*qz[10]+qk*qz[14],qb[3]=qJ*qz[3]+qV*qz[7]+qW*qz[11]+qk*qz[15]},qS.equals=function(qS,q_){var qa=qS.elements,qR=q_.elements;return qvS.nearEqual(Math.abs(qa[0]),Math.abs(qR[0]))&&qvS.nearEqual(Math.abs(qa[1]),Math.abs(qR[1]))&&qvS.nearEqual(Math.abs(qa[2]),Math.abs(qR[2]))&&qvS.nearEqual(Math.abs(qa[3]),Math.abs(qR[3]))},qS.normalize=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qS.length();0<qJ&&(qR[0]=qa[0]*qJ,qR[1]=qa[1]*qJ,qR[2]=qa[2]*qJ,qR[3]=qa[3]*qJ)},qS.add=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]+qV[0],qR[1]=qJ[1]+qV[1],qR[2]=qJ[2]+qV[2],qR[3]=qJ[3]+qV[3]},qS.subtract=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]-qV[0],qR[1]=qJ[1]-qV[1],qR[2]=qJ[2]-qV[2],qR[3]=qJ[3]-qV[3]},qS.multiply=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=qJ[0]*qV[0],qR[1]=qJ[1]*qV[1],qR[2]=qJ[2]*qV[2],qR[3]=qJ[3]*qV[3]},qS.scale=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements;qR[0]=qJ[0]*q_,qR[1]=qJ[1]*q_,qR[2]=qJ[2]*q_,qR[3]=qJ[3]*q_},qS.Clamp=function(qS,q_,qa,qR){var qJ=qS.elements,qV=qJ[0],qW=qJ[1],qk=qJ[2],qz=qJ[3],qb=q_.elements,qH=qb[0],qL=qb[1],qC=qb[2],qG=qb[3],qt=qa.elements,qo=qt[0],q$=qt[1],qF=qt[2],qT=qt[3],qD=qR.elements;qV=(qV=qo<qV?qo:qV)<qH?qH:qV,qW=(qW=q$<qW?q$:qW)<qL?qL:qW,qk=(qk=qF<qk?qF:qk)<qC?qC:qk,qz=(qz=qT<qz?qT:qz)<qG?qG:qz,qD[0]=qV,qD[1]=qW,qD[2]=qk,qD[3]=qz},qS.distanceSquared=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0]-qR[0],qV=qa[1]-qR[1],qW=qa[2]-qR[2],qk=qa[3]-qR[3];return qJ*qJ+qV*qV+qW*qW+qk*qk},qS.distance=function(qS,q_){var qa=qS.elements,qR=q_.elements,qJ=qa[0]-qR[0],qV=qa[1]-qR[1],qW=qa[2]-qR[2],qk=qa[3]-qR[3];return Math.sqrt(qJ*qJ+qV*qV+qW*qW+qk*qk)},qS.dot=function(qS,q_){var qa=qS.elements,qR=q_.elements;return qa[0]*qR[0]+qa[1]*qR[1]+qa[2]*qR[2]+qa[3]*qR[3]},qS.min=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=Math.min(qJ[0],qV[0]),qR[1]=Math.min(qJ[1],qV[1]),qR[2]=Math.min(qJ[2],qV[2]),qR[3]=Math.min(qJ[3],qV[3])},qS.max=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_.elements;qR[0]=Math.max(qJ[0],qV[0]),qR[1]=Math.max(qJ[1],qV[1]),qR[2]=Math.max(qJ[2],qV[2]),qR[3]=Math.max(qJ[3],qV[3])},qL(qS,["ZERO",function(){return this.ZERO=new qS},"ONE",function(){return this.ONE=new qS(1,1,1,1)},"UnitX",function(){return this.UnitX=new qS(1,0,0,0)},"UnitY",function(){return this.UnitY=new qS(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new qS(0,0,1,0)},"UnitW",function(){return this.UnitW=new qS(0,0,0,1)}]),qS}(),qz_=function(){function qV(qS,q_,qa,qR){this.minDepth=0,this.maxDepth=1,this.x=qS,this.y=q_,this.width=qa,this.height=qR}qG(qV,"laya.d3.math.Viewport");var qS=qV.prototype;return qS.project=function(qS,q_,qa){qW_.transformV3ToV3(qS,q_,qa);var qR=qS.elements,qJ=q_.elements,qV=qa.elements,qW=qR[0]*qJ[3]+qR[1]*qJ[7]+qR[2]*qJ[11]+qJ[15];1!==qW&&(qV[0]=qV[0]/qW,qV[1]=qV[1]/qW,qV[2]=qV[2]/qW),qV[0]=.5*(qV[0]+1)*this.width+this.x,qV[1]=.5*(1-qV[1])*this.height+this.y,qV[2]=qV[2]*(this.maxDepth-this.minDepth)+this.minDepth},qS.unprojectFromMat=function(qS,q_,qa){var qR=qS.elements,qJ=q_.elements,qV=qa.elements;qV[0]=(qR[0]-this.x)/this.width*2-1,qV[1]=-((qR[1]-this.y)/this.height*2-1);var qW=(this.maxDepth-this.minDepth)/2;qV[2]=(qR[2]-this.minDepth-qW)/qW;var qk=qV[0]*qJ[3]+qV[1]*qJ[7]+qV[2]*qJ[11]+qJ[15];qW_.transformV3ToV3(qa,q_,qa),1!==qk&&(qV[0]=qV[0]/qk,qV[1]=qV[1]/qk,qV[2]=qV[2]/qk)},qS.unprojectFromWVP=function(qS,q_,qa,qR,qJ){qS_.multiply(q_,qa,qV._tempMatrix4x4),qR&&qS_.multiply(qV._tempMatrix4x4,qR,qV._tempMatrix4x4),qV._tempMatrix4x4.invert(qV._tempMatrix4x4),this.unprojectFromMat(qS,qV._tempMatrix4x4,qJ)},qL(qV,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new qS_}]),qV}(),qb_=function(){function qI(qS){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=qS,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}qG(qI,"laya.d3.resource.models.SubMesh");var qS=qI.prototype;return qQ.imps(qS,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),qS._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),0===qS?this._vertexBuffer:null},qS._getIndexBuffer=function(){return this._indexBuffer},qS._getStaticBatchBakedVertexs=function(qS,q_){var qa,qR,qJ=this._vertexBuffer,qV=qJ.vertexDeclaration,qW=qV.getVertexElementByUsage(0).offset/4,qk=qV.getVertexElementByUsage(3).offset/4,qz=q_.meshRender.lightmapScaleOffset,qb=0,qH=0,qL=0,qC=0,qG=0,qt=0;if(qz)if(qR=qV.getVertexElementByUsage(15))qL=qV.vertexStride/4,qa=0<this._vertexCount?qJ.getData().slice(this._vertexStart*qL,(this._vertexStart+this._vertexCount)*qL):qJ.getData().slice(),qC=qR.offset/4;else{qL=(qt=qV.vertexStride/4)+2,qa=this._vertexCount?new Float32Array(this._vertexCount*(qJ.vertexDeclaration.vertexStride/4+2)):new Float32Array(qJ.vertexCount*(qJ.vertexDeclaration.vertexStride/4+2)),qC=(qG=qV.getVertexElementByUsage(2).offset/4)+2;var qo=qJ.getData();for(qb=0,qH=qo.length/qt;qb<qH;qb++){var q$=0;q$=0<this._vertexCount?(this._vertexStart+qb)*qt:qb*qt;var qF=qb*qL,qT=0;for(qT=0;qT<qC;qT++)qa[qF+qT]=qo[q$+qT];for(qT=qC;qT<qt;qT++)qa[qF+qT+2]=qo[q$+qT]}}else qL=qV.vertexStride/4,qa=this._vertexCount?qJ.getData().slice(this._vertexStart*qL,(this._vertexStart+this._vertexCount)*qL):qJ.getData().slice();if(qS){var qD=qS.worldMatrix,qj=qI._tempMatrix4x40;qD.invert(qj);var qQ=qI._tempMatrix4x41,qm=q_.transform.worldMatrix;qS_.multiply(qj,qm,qQ)}else qQ=q_.transform.worldMatrix;var qq=qI._tempQuaternion0;for(qQ.decomposeTransRotScale(qI._tempVector30,qq,qI._tempVector31),qb=0,qH=qa.length/qL;qb<qH;qb++){var qN=qb*qL+qW,qn=qb*qL+qk;if(q$_.transformVector3ArrayToVector3ArrayCoordinate(qa,qN,qQ,qa,qN),q$_.transformVector3ArrayByQuat(qa,qn,qq,qa,qn),qz){var ql=qb*qL+qC;if(qR)q$_.transformLightingMapTexcoordByUV1Array(qa,ql,qz,qa,ql);else{var qB=qb*qt+qG;q$_.transformLightingMapTexcoordByUV0Array(qo,qB,qz,qa,ql)}}}return qa},qS._getVertexBuffers=function(){return null},qS._beforeRender=function(qS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},qS._render=function(qS){var q_,qa=0,qR=qS.renderElement;if(1<this._indexCount){var qJ=this._boneIndicesList.length;if(1<qJ){for(var qV=0;qV<qJ;qV++)(q_=qR._skinAnimationDatas||this._skinAnimationDatas)&&(qR._shaderValue.setValue(0,q_[qV]),qS._shader.uploadRenderElementUniforms(qR._shaderValue.data)),qA.mainContext.drawElements(4,this._subIndexBufferCount[qV],5123,2*this._subIndexBufferStart[qV]);qN.drawCall+=qJ}else(q_=qR._skinAnimationDatas||this._skinAnimationDatas)&&(qR._shaderValue.setValue(0,q_[0]),qS._shader.uploadRenderElementUniforms(qR._shaderValue.data)),qA.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),qN.drawCall++;qa=this._indexCount}else qa=this._indexBuffer.indexCount,(q_=qR._skinAnimationDatas||this._skinAnimationDatas)&&(qR._shaderValue.setValue(0,q_[0]),qS._shader.uploadRenderElementUniforms(qR._shaderValue.data)),qA.mainContext.drawElements(4,qa,5123,0),qN.drawCall++;qN.trianglesFaces+=qa/3},qS.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},qS.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},qt(0,qS,"_vertexBufferCount",function(){return 1}),qt(0,qS,"triangleCount",function(){return this._indexBuffer.indexCount/3}),qL(qI,["_tempVector30",function(){return this._tempVector30=new qW_},"_tempVector31",function(){return this._tempVector31=new qW_},"_tempQuaternion0",function(){return this._tempQuaternion0=new qa_},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new qS_},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new qS_}]),qI}(),qH_=function(){function qS(qS){this.defineCounter=0,this.defines=null,qS?(this.defineCounter=qS.defineCounter,this.defines=qS.defines.slice()):(this.defineCounter=0,this.defines=[])}return qG(qS,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),qS.prototype.registerDefine=function(qS){var q_=Math.pow(2,this.defineCounter++);return this.defines[q_]=qS,q_},qS}(),qL_=function(){function qS(){}return qG(qS,"laya.d3.shader.ShaderInit3D"),qS.__init__=function(){var qS,q_;qN_._globalRegDefine("HIGHPRECISION",qN_.SHADERDEFINE_HIGHPRECISION),qN_._globalRegDefine("FOG",qN_.SHADERDEFINE_FOG),qN_._globalRegDefine("DIRECTIONLIGHT",qN_.SHADERDEFINE_DIRECTIONLIGHT),qN_._globalRegDefine("POINTLIGHT",qN_.SHADERDEFINE_POINTLIGHT),qN_._globalRegDefine("SPOTLIGHT",qN_.SHADERDEFINE_SPOTLIGHT),qN_._globalRegDefine("UV",qN_.SHADERDEFINE_UV0),qN_._globalRegDefine("COLOR",qN_.SHADERDEFINE_COLOR),qN_._globalRegDefine("UV1",qN_.SHADERDEFINE_UV1),qN_._globalRegDefine("CASTSHADOW",qG_.SHADERDEFINE_CAST_SHADOW),qN_._globalRegDefine("SHADOWMAP_PSSM1",qG_.SHADERDEFINE_SHADOW_PSSM1),qN_._globalRegDefine("SHADOWMAP_PSSM2",qG_.SHADERDEFINE_SHADOW_PSSM2),qN_._globalRegDefine("SHADOWMAP_PSSM3",qG_.SHADERDEFINE_SHADOW_PSSM3),qN_._globalRegDefine("SHADOWMAP_PCF_NO",qG_.SHADERDEFINE_SHADOW_PCF_NO),qN_._globalRegDefine("SHADOWMAP_PCF1",qG_.SHADERDEFINE_SHADOW_PCF1),qN_._globalRegDefine("SHADOWMAP_PCF2",qG_.SHADERDEFINE_SHADOW_PCF2),qN_._globalRegDefine("SHADOWMAP_PCF3",qG_.SHADERDEFINE_SHADOW_PCF3),qN_._globalRegDefine("DEPTHFOG",qN_.SAHDERDEFINE_DEPTHFOG),qM_.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),qM_.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),qS={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},q_={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var qa=qM_.nameKey.add("SIMPLE");shaderCompile=qN_.add(qa,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',qS,q_),qr_.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),qr_.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),qr_.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),qr_.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),qr_.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),qr_.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),qr_.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),qr_.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),qr_.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},qS}(),qC_=function(){function qS(){this._data=null,this._data=[]}qG(qS,"laya.d3.shader.ValusArray");var q_=qS.prototype;return q_.setValue=function(qS,q_){this._data[qS]=q_},qt(0,q_,"data",function(){return this._data}),qS}(),qG_=function(){function qS(){}return qS.SHADERDEFINE_RECEIVE_SHADOW=1,qS.SHADERDEFINE_CAST_SHADOW=512,qS.SHADERDEFINE_SHADOW_PSSM1=1024,qS.SHADERDEFINE_SHADOW_PSSM2=2048,qS.SHADERDEFINE_SHADOW_PSSM3=4096,qS.SHADERDEFINE_SHADOW_PCF_NO=8192,qS.SHADERDEFINE_SHADOW_PCF1=16384,qS.SHADERDEFINE_SHADOW_PCF2=32768,qS.SHADERDEFINE_SHADOW_PCF3=65536,qS.MAX_PSSM_COUNT=3,qS}(),qt_=function(){function qc(){}return qG(qc,"laya.d3.utils.Picker"),qc.calculateCursorRay=function(qS,q_,qa,qR,qJ,qV){var qW=qS.elements[0],qk=qS.elements[1],qz=qc._tempVector30,qb=qz.elements;qb[0]=qW,qb[1]=qk,qb[2]=q_.minDepth;var qH=qc._tempVector31,qL=qH.elements;qL[0]=qW,qL[1]=qk,qL[2]=q_.maxDepth;var qC=qV.origin,qG=qc._tempVector32;q_.unprojectFromWVP(qz,qa,qR,qJ,qC),q_.unprojectFromWVP(qH,qa,qR,qJ,qG);var qt=qV.direction.elements;qt[0]=qG.x-qC.x,qt[1]=qG.y-qC.y,qt[2]=qG.z-qC.z,qW_.normalize(qV.direction,qV.direction)},qc.rayIntersectsPositionsAndIndices=function(qS,q_,qa,qR,qJ){for(var qV=qa.vertexStride/4,qW=qa.getVertexElementByUsage(0).offset/4,qk=Number.MAX_VALUE,qz=-1,qb=-1,qH=-1,qL=0;qL<qR.length;qL+=3){var qC=qc._tempVector35,qG=qC.elements,qt=qR[qL]*qV,qo=qt+qW;qG[0]=q_[qo],qG[1]=q_[1+qo],qG[2]=q_[2+qo];var q$=qc._tempVector36,qF=q$.elements,qT=qR[qL+1]*qV,qD=qT+qW;qF[0]=q_[qD],qF[1]=q_[1+qD],qF[2]=q_[2+qD];var qj=qc._tempVector37,qQ=qj.elements,qm=qR[qL+2]*qV,qq=qm+qW;qQ[0]=q_[qq],qQ[1]=q_[1+qq],qQ[2]=q_[2+qq];var qN=laya.d3.utils.Picker.rayIntersectsTriangle(qS,qC,q$,qj);!isNaN(qN)&&qN<qk&&(qk=qN,qz=qt,qb=qT,qH=qm)}if(qk===Number.MAX_VALUE)return qJ.position.toDefault(),qJ.distance=Number.MAX_VALUE,qJ.trianglePositions[0].toDefault(),qJ.trianglePositions[1].toDefault(),qJ.trianglePositions[2].toDefault(),qJ.triangleNormals[0].toDefault(),qJ.triangleNormals[1].toDefault(),qJ.triangleNormals[2].toDefault(),!1;qJ.distance=qk,qW_.scale(qS.direction,qk,qJ.position),qW_.add(qS.origin,qJ.position,qJ.position);var qn=qJ.trianglePositions,ql=qn[0],qB=qn[1],qI=qn[2],qA=ql.elements,qX=qB.elements,qh=qI.elements,qu=qz+qW;qA[0]=q_[qu],qA[1]=q_[qu+1],qA[2]=q_[qu+2];var qK=qb+qW;qX[0]=q_[qK],qX[1]=q_[qK+1],qX[2]=q_[qK+2];var qP=qH+qW;qh[0]=q_[qP],qh[1]=q_[qP+1],qh[2]=q_[qP+2];var qM=qa.getVertexElementByUsage(3);if(qM){var qr=qM.offset/4,qe=qJ.triangleNormals,qg=qe[0],qx=qe[1],qs=qe[2],qU=qg.elements,qf=qx.elements,qY=qs.elements,qi=qz+qr;qU[0]=q_[qi],qU[1]=q_[qi+1],qU[2]=q_[qi+2];var qZ=qb+qr;qf[0]=q_[qZ],qf[1]=q_[qZ+1],qf[2]=q_[qZ+2];var qp=qH+qr;qY[0]=q_[qp],qY[1]=q_[qp+1],qY[2]=q_[qp+2]}return!0},qc.rayIntersectsTriangle=function(qS,q_,qa,qR){var qJ=qc._tempVector30,qV=qc._tempVector31;qW_.subtract(qa,q_,qJ),qW_.subtract(qR,q_,qV);var qW,qk=qc._tempVector32;if(qW_.cross(qS.direction,qV,qk),(qW=qW_.dot(qJ,qk))>-Number.MIN_VALUE&&qW<Number.MIN_VALUE)return Number.NaN;var qz,qb=1/qW,qH=qc._tempVector33;if(qW_.subtract(qS.origin,q_,qH),qz=qW_.dot(qH,qk),(qz*=qb)<0||1<qz)return Number.NaN;var qL,qC,qG=qc._tempVector34;return qW_.cross(qH,qJ,qG),qL=qW_.dot(qS.direction,qG),(qL*=qb)<0||1<qz+qL?Number.NaN:(qC=qW_.dot(qV,qG),(qC*=qb)<0?Number.NaN:qC)},qL(qc,["_tempVector30",function(){return this._tempVector30=new qW_},"_tempVector31",function(){return this._tempVector31=new qW_},"_tempVector32",function(){return this._tempVector32=new qW_},"_tempVector33",function(){return this._tempVector33=new qW_},"_tempVector34",function(){return this._tempVector34=new qW_},"_tempVector35",function(){return this._tempVector35=new qW_},"_tempVector36",function(){return this._tempVector36=new qW_},"_tempVector37",function(){return this._tempVector37=new qW_}]),qc}(),qo_=(function(){function qS(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new qW_,new qW_,new qW_],this.trianglePositions.length=3,this.triangleNormals=[new qW_,new qW_,new qW_],this.triangleNormals.length=3,this.position=new qW_}qG(qS,"laya.d3.utils.RaycastHit"),qS.prototype.cloneTo=function(qS){qS.distance=this.distance,this.trianglePositions[0].cloneTo(qS.trianglePositions[0]),this.trianglePositions[1].cloneTo(qS.trianglePositions[1]),this.trianglePositions[2].cloneTo(qS.trianglePositions[2]),this.triangleNormals[0].cloneTo(qS.triangleNormals[0]),this.triangleNormals[1].cloneTo(qS.triangleNormals[1]),this.triangleNormals[2].cloneTo(qS.triangleNormals[2]),this.position.cloneTo(qS.position),qS.sprite3D=this.sprite3D}}(),function(){function qS(qS,q_){this._width=0,this._height=0,this._width=qS,this._height=q_}qG(qS,"laya.d3.utils.Size");var q_=qS.prototype;return qt(0,q_,"width",function(){return-1===this._width?qy.clientWidth:this._width}),qt(0,q_,"height",function(){return-1===this._height?qy.clientHeight:this._height}),qt(1,qS,"fullScreen",function(){return new qS(-1,-1)}),qS}()),q$_=function(){function qu(){}return qG(qu,"laya.d3.utils.Utils3D"),qu._rotationTransformScaleSkinAnimation=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL){var qC,qG,qt,qo,q$,qF=qu._tempArray16_0,qT=qu._tempArray16_1,qD=qu._tempArray16_2,qj=qR+qR,qQ=qJ+qJ,qm=qV+qV,qq=qR*qj,qN=qJ*qj,qn=qJ*qQ,ql=qV*qj,qB=qV*qQ,qI=qV*qm,qA=qW*qj,qX=qW*qQ,qh=qW*qm;for(qF[15]=1,qF[0]=1-qn-qI,qF[1]=qN+qh,qF[2]=ql-qX,qF[4]=qN-qh,qF[5]=1-qq-qI,qF[6]=qB+qA,qF[8]=ql+qX,qF[9]=qB-qA,qF[10]=1-qq-qn,qT[15]=1,qT[0]=qk,qT[5]=qz,qT[10]=qb,qC=0;qC<4;qC++)qG=qF[qC],qt=qF[qC+4],qo=qF[qC+8],q$=qF[qC+12],qD[qC]=qG,qD[qC+4]=qt,qD[qC+8]=qo,qD[qC+12]=qG*qS+qt*q_+qo*qa+q$;for(qC=0;qC<4;qC++)qG=qD[qC],qt=qD[qC+4],qo=qD[qC+8],q$=qD[qC+12],qH[qC+qL]=qG*qT[0]+qt*qT[1]+qo*qT[2]+q$*qT[3],qH[qC+qL+4]=qG*qT[4]+qt*qT[5]+qo*qT[6]+q$*qT[7],qH[qC+qL+8]=qG*qT[8]+qt*qT[9]+qo*qT[10]+q$*qT[11],qH[qC+qL+12]=qG*qT[12]+qt*qT[13]+qo*qT[14]+q$*qT[15]},qu._createNodeByJson=function(qS,q_,qa,qR){if(!qa)switch(q_.type){case"Sprite3D":qa=new qP_;break;case"MeshSprite3D":qa=new qc_;break;case"SkinnedMeshSprite3D":qa=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":qa=new ShuriKenParticle3D;break;case"TrailSprite3D":qa=new TrailSprite3D;break;case"Terrain":qa=new Terrain;break;case"Camera":qa=new qp_;break;case"DirectionLight":qa=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var qJ=q_.props;if(qJ)for(var qV in qJ)qa[qV]=qJ[qV];var qW=q_.customProps;qW&&(qa instanceof laya.d3.core.Sprite3D?(qa._parseBaseCustomProps(qW),qa._parseCustomProps(qS,qR,qW,q_),qa._parseCustomComponent(qS,qR,q_.components)):qa._parseCustomProps(qS,qR,qW,q_));var qk=q_.child;if(qk)for(var qz=0,qb=qk.length;qz<qb;qz++){var qH=qu._createNodeByJson(qS,qk[qz],null,qR);qa.addChild(qH)}return qa},qu._computeBoneAndAnimationDatasByBindPoseMatrxix=function(qS,q_,qa,qR,qJ,qV){var qW,qk,qz=0,qb=0,qH=qS.length;for(qW=0;qW<qH;qz+=qS[qW].keyframeWidth,qb+=16,qW++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(q_[qz+0],q_[qz+1],q_[qz+2],q_[qz+3],q_[qz+4],q_[qz+5],q_[qz+6],q_[qz+7],q_[qz+8],q_[qz+9],qR,qb),0!=qW&&(qk=16*qS[qW].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(qR,qk,qR,qb,qR,qb));var qL=qa.length;for(qW=0;qW<qL;qW++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(qR,16*qV[qW],qa[qW],qJ,16*qW)},qu._computeAnimationDatasByArrayAndMatrixFast=function(qS,q_,qa,qR){for(var qJ=0,qV=qS.length;qJ<qV;qJ++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(q_,16*qR[qJ],qS[qJ],qa,16*qJ)},qu._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(qS,q_,qa,qR,qJ){var qV,qW,qk=0,qz=0,qb=qS.length;for(qV=0;qV<qb;qk+=qS[qV].keyframeWidth,qz+=16,qV++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(q_[qk+7],q_[qk+8],q_[qk+9],q_[qk+3],q_[qk+4],q_[qk+5],q_[qk+6],q_[qk+0],q_[qk+1],q_[qk+2],qR,qz),0!=qV&&(qW=16*qS[qV].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(qR,qW,qR,qz,qR,qz));var qH=qa.length;for(qV=0;qV<qH;qV++){var qL=16*qV;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(qR,qL,qa[qV],qJ,qL)}},qu._computeAnimationDatasByArrayAndMatrixFastOld=function(qS,q_,qa){for(var qR=qS.length,qJ=0;qJ<qR;qJ++){var qV=16*qJ;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(q_,qV,qS[qJ],qa,qV)}},qu._computeRootAnimationData=function(qS,q_,qa){for(var qR=0,qJ=0,qV=0,qW=qS.length;qR<qW;qJ+=qS[qR].keyframeWidth,qV+=16,qR++)laya.d3.utils.Utils3D.createAffineTransformationArray(q_[qJ+0],q_[qJ+1],q_[qJ+2],q_[qJ+3],q_[qJ+4],q_[qJ+5],q_[qJ+6],q_[qJ+7],q_[qJ+8],q_[qJ+9],qa,qV)},qu.transformVector3ArrayByQuat=function(qS,q_,qa,qR,qJ){var qV=qa.elements,qW=qS[q_],qk=qS[q_+1],qz=qS[q_+2],qb=qV[0],qH=qV[1],qL=qV[2],qC=qV[3],qG=qC*qW+qH*qz-qL*qk,qt=qC*qk+qL*qW-qb*qz,qo=qC*qz+qb*qk-qH*qW,q$=-qb*qW-qH*qk-qL*qz;qR[qJ]=qG*qC+q$*-qb+qt*-qL-qo*-qH,qR[qJ+1]=qt*qC+q$*-qH+qo*-qb-qG*-qL,qR[qJ+2]=qo*qC+q$*-qL+qG*-qH-qt*-qb},qu.mulMatrixByArray=function(qS,q_,qa,qR,qJ,qV){var qW,qk,qz,qb,qH;if(qJ===qa){for(qa=qu._tempArray16_3,qW=0;qW<16;++qW)qa[qW]=qJ[qV+qW];qR=0}for(qW=0;qW<4;qW++)qk=qS[q_+qW],qz=qS[q_+qW+4],qb=qS[q_+qW+8],qH=qS[q_+qW+12],qJ[qV+qW]=qk*qa[qR+0]+qz*qa[qR+1]+qb*qa[qR+2]+qH*qa[qR+3],qJ[qV+qW+4]=qk*qa[qR+4]+qz*qa[qR+5]+qb*qa[qR+6]+qH*qa[qR+7],qJ[qV+qW+8]=qk*qa[qR+8]+qz*qa[qR+9]+qb*qa[qR+10]+qH*qa[qR+11],qJ[qV+qW+12]=qk*qa[qR+12]+qz*qa[qR+13]+qb*qa[qR+14]+qH*qa[qR+15]},qu.mulMatrixByArrayFast=function(qS,q_,qa,qR,qJ,qV){var qW,qk,qz,qb,qH;for(qW=0;qW<4;qW++)qk=qS[q_+qW],qz=qS[q_+qW+4],qb=qS[q_+qW+8],qH=qS[q_+qW+12],qJ[qV+qW]=qk*qa[qR+0]+qz*qa[qR+1]+qb*qa[qR+2]+qH*qa[qR+3],qJ[qV+qW+4]=qk*qa[qR+4]+qz*qa[qR+5]+qb*qa[qR+6]+qH*qa[qR+7],qJ[qV+qW+8]=qk*qa[qR+8]+qz*qa[qR+9]+qb*qa[qR+10]+qH*qa[qR+11],qJ[qV+qW+12]=qk*qa[qR+12]+qz*qa[qR+13]+qb*qa[qR+14]+qH*qa[qR+15]},qu.mulMatrixByArrayAndMatrixFast=function(qS,q_,qa,qR,qJ){var qV,qW,qk,qz,qb,qH=qa.elements,qL=qH[0],qC=qH[1],qG=qH[2],qt=qH[3],qo=qH[4],q$=qH[5],qF=qH[6],qT=qH[7],qD=qH[8],qj=qH[9],qQ=qH[10],qm=qH[11],qq=qH[12],qN=qH[13],qn=qH[14],ql=qH[15],qB=q_,qI=q_+4,qA=q_+8,qX=q_+12,qh=qJ,qu=qJ+4,qK=qJ+8,qP=qJ+12;for(qV=0;qV<4;qV++)qW=qS[qB+qV],qk=qS[qI+qV],qz=qS[qA+qV],qb=qS[qX+qV],qR[qh+qV]=qW*qL+qk*qC+qz*qG+qb*qt,qR[qu+qV]=qW*qo+qk*q$+qz*qF+qb*qT,qR[qK+qV]=qW*qD+qk*qj+qz*qQ+qb*qm,qR[qP+qV]=qW*qq+qk*qN+qz*qn+qb*ql},qu.createAffineTransformationArray=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL){var qC=qR+qR,qG=qJ+qJ,qt=qV+qV,qo=qR*qC,q$=qR*qG,qF=qR*qt,qT=qJ*qG,qD=qJ*qt,qj=qV*qt,qQ=qW*qC,qm=qW*qG,qq=qW*qt;qH[qL+0]=(1-(qT+qj))*qk,qH[qL+1]=(q$+qq)*qk,qH[qL+2]=(qF-qm)*qk,qH[qL+3]=0,qH[qL+4]=(q$-qq)*qz,qH[qL+5]=(1-(qo+qj))*qz,qH[qL+6]=(qD+qQ)*qz,qH[qL+7]=0,qH[qL+8]=(qF+qm)*qb,qH[qL+9]=(qD-qQ)*qb,qH[qL+10]=(1-(qo+qT))*qb,qH[qL+11]=0,qH[qL+12]=qS,qH[qL+13]=q_,qH[qL+14]=qa,qH[qL+15]=1},qu.transformVector3ArrayToVector3ArrayCoordinate=function(qS,q_,qa,qR,qJ){var qV=qu._tempArray4_0,qW=qS[q_+0],qk=qS[q_+1],qz=qS[q_+2],qb=qa.elements;qV[0]=qW*qb[0]+qk*qb[4]+qz*qb[8]+qb[12],qV[1]=qW*qb[1]+qk*qb[5]+qz*qb[9]+qb[13],qV[2]=qW*qb[2]+qk*qb[6]+qz*qb[10]+qb[14],qV[3]=1/(qW*qb[3]+qk*qb[7]+qz*qb[11]+qb[15]),qR[qJ+0]=qV[0]*qV[3],qR[qJ+1]=qV[1]*qV[3],qR[qJ+2]=qV[2]*qV[3]},qu.transformLightingMapTexcoordByUV0Array=function(qS,q_,qa,qR,qJ){var qV=qa.elements;qR[qJ+0]=qS[q_+0]*qV[0]+qV[2],qR[qJ+1]=(qS[q_+1]-1)*qV[1]+qV[3]},qu.transformLightingMapTexcoordByUV1Array=function(qS,q_,qa,qR,qJ){var qV=qa.elements;qR[qJ+0]=qS[q_+0]*qV[0]+qV[2],qR[qJ+1]=1+qS[q_+1]*qV[1]+qV[3]},qu.getURLVerion=function(qS){var q_=qS.indexOf("?");return 0<=q_?qS.substr(q_):null},qu._quaternionCreateFromYawPitchRollArray=function(qS,q_,qa,qR){var qJ=.5*qa,qV=.5*q_,qW=.5*qS,qk=Math.sin(qJ),qz=Math.cos(qJ),qb=Math.sin(qV),qH=Math.cos(qV),qL=Math.sin(qW),qC=Math.cos(qW);qR[0]=qC*qb*qz+qL*qH*qk,qR[1]=qL*qH*qz-qC*qb*qk,qR[2]=qC*qH*qk-qL*qb*qz,qR[3]=qC*qH*qz+qL*qb*qk},qu._createAffineTransformationArray=function(qS,q_,qa,qR){var qJ=q_[0],qV=q_[1],qW=q_[2],qk=q_[3],qz=qJ+qJ,qb=qV+qV,qH=qW+qW,qL=qJ*qz,qC=qJ*qb,qG=qJ*qH,qt=qV*qb,qo=qV*qH,q$=qW*qH,qF=qk*qz,qT=qk*qb,qD=qk*qH,qj=qa[0],qQ=qa[1],qm=qa[2];qR[0]=(1-(qt+q$))*qj,qR[1]=(qC+qD)*qj,qR[2]=(qG-qT)*qj,qR[3]=0,qR[4]=(qC-qD)*qQ,qR[5]=(1-(qL+q$))*qQ,qR[6]=(qo+qF)*qQ,qR[7]=0,qR[8]=(qG+qT)*qm,qR[9]=(qo-qF)*qm,qR[10]=(1-(qL+qt))*qm,qR[11]=0,qR[12]=qS[0],qR[13]=qS[1],qR[14]=qS[2],qR[15]=1},qu._mulMatrixArray=function(qS,q_,qa,qR){var qJ,qV,qW,qk,qz,qb=q_.elements,qH=qb[0],qL=qb[1],qC=qb[2],qG=qb[3],qt=qb[4],qo=qb[5],q$=qb[6],qF=qb[7],qT=qb[8],qD=qb[9],qj=qb[10],qQ=qb[11],qm=qb[12],qq=qb[13],qN=qb[14],qn=qb[15],ql=qR,qB=qR+4,qI=qR+8,qA=qR+12;for(qJ=0;qJ<4;qJ++)qV=qS[qJ],qW=qS[qJ+4],qk=qS[qJ+8],qz=qS[qJ+12],qa[ql+qJ]=qV*qH+qW*qL+qk*qC+qz*qG,qa[qB+qJ]=qV*qt+qW*qo+qk*q$+qz*qF,qa[qI+qJ]=qV*qT+qW*qD+qk*qj+qz*qQ,qa[qA+qJ]=qV*qm+qW*qq+qk*qN+qz*qn},qu.getYawPitchRoll=function(qS,q_){qu.transformQuat(qW_.ForwardRH,qS,qa_.TEMPVector31),qu.transformQuat(qW_.Up,qS,qa_.TEMPVector32);var qa=qa_.TEMPVector32.elements;qu.angleTo(qW_.ZERO,qa_.TEMPVector31,qa_.TEMPVector33);var qR=qa_.TEMPVector33.elements;qR[0]==Math.PI/2?(qR[1]=qu.arcTanAngle(qa[2],qa[0]),qR[2]=0):qR[0]==-Math.PI/2?(qR[1]=qu.arcTanAngle(-qa[2],-qa[0]),qR[2]=0):(qS_.createRotationY(-qR[1],qa_.TEMPMatrix0),qS_.createRotationX(-qR[0],qa_.TEMPMatrix1),qW_.transformCoordinate(qa_.TEMPVector32,qa_.TEMPMatrix0,qa_.TEMPVector32),qW_.transformCoordinate(qa_.TEMPVector32,qa_.TEMPMatrix1,qa_.TEMPVector32),qR[2]=qu.arcTanAngle(qa[1],-qa[0])),qR[1]<=-Math.PI&&(qR[1]=Math.PI),qR[2]<=-Math.PI&&(qR[2]=Math.PI),qR[1]>=Math.PI&&qR[2]>=Math.PI&&(qR[1]=0,qR[2]=0,qR[0]=Math.PI-qR[0]),q_[0]=qR[1],q_[1]=qR[0],q_[2]=qR[2]},qu.arcTanAngle=function(qS,q_){return 0==qS?1==q_?Math.PI/2:-Math.PI/2:0<qS?Math.atan(q_/qS):qS<0?0<q_?Math.atan(q_/qS)+Math.PI:Math.atan(q_/qS)-Math.PI:0},qu.angleTo=function(qS,q_,qa){qW_.subtract(q_,qS,qa_.TEMPVector30),qW_.normalize(qa_.TEMPVector30,qa_.TEMPVector30),qa.elements[0]=Math.asin(qa_.TEMPVector30.y),qa.elements[1]=qu.arcTanAngle(-qa_.TEMPVector30.z,-qa_.TEMPVector30.x)},qu.transformQuat=function(qS,q_,qa){var qR=qa.elements,qJ=qS.elements,qV=q_,qW=qJ[0],qk=qJ[1],qz=qJ[2],qb=qV[0],qH=qV[1],qL=qV[2],qC=qV[3],qG=qC*qW+qH*qz-qL*qk,qt=qC*qk+qL*qW-qb*qz,qo=qC*qz+qb*qk-qH*qW,q$=-qb*qW-qH*qk-qL*qz;qR[0]=qG*qC+q$*-qb+qt*-qL-qo*-qH,qR[1]=qt*qC+q$*-qH+qo*-qb-qG*-qL,qR[2]=qo*qC+q$*-qL+qG*-qH-qt*-qb},qu.quaterionNormalize=function(qS,q_){var qa=qS[0],qR=qS[1],qJ=qS[2],qV=qS[3],qW=qa*qa+qR*qR+qJ*qJ+qV*qV;0<qW&&(qW=1/Math.sqrt(qW),q_[0]=qa*qW,q_[1]=qR*qW,q_[2]=qJ*qW,q_[3]=qV*qW)},qu.matrix4x4MultiplyFFF=function(qS,q_,qa){var qR,qJ,qV,qW,qk;if(qa===q_)for(q_=new Float32Array(16),qR=0;qR<16;++qR)q_[qR]=qa[qR];for(qR=0;qR<4;qR++)qJ=qS[qR],qV=qS[qR+4],qW=qS[qR+8],qk=qS[qR+12],qa[qR]=qJ*q_[0]+qV*q_[1]+qW*q_[2]+qk*q_[3],qa[qR+4]=qJ*q_[4]+qV*q_[5]+qW*q_[6]+qk*q_[7],qa[qR+8]=qJ*q_[8]+qV*q_[9]+qW*q_[10]+qk*q_[11],qa[qR+12]=qJ*q_[12]+qV*q_[13]+qW*q_[14]+qk*q_[15]},qu.matrix4x4MultiplyMFM=function(qS,q_,qa){qu.matrix4x4MultiplyFFF(qS.elements,q_,qa.elements)},qL(qu,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new qW_},"_tempVector3_1",function(){return this._tempVector3_1=new qW_},"_tempVector3_2",function(){return this._tempVector3_2=new qW_},"_tempVector3_3",function(){return this._tempVector3_3=new qW_},"_tempVector3_4",function(){return this._tempVector3_4=new qW_},"_tempVector3_5",function(){return this._tempVector3_5=new qW_},"_tempVector3_6",function(){return this._tempVector3_6=new qW_},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),qu}(),qF_=function(){function qX(){}return qG(qX,"Laya3D"),qX._cancelLoadByUrl=function(qS){qQ.loader.cancelLoadByUrl(qS),qX._innerFirstLevelLoaderManager.cancelLoadByUrl(qS),qX._innerSecondLevelLoaderManager.cancelLoadByUrl(qS),qX._innerThirdLevelLoaderManager.cancelLoadByUrl(qS),qX._innerFourthLevelLoaderManager.cancelLoadByUrl(qS)},qX._changeWebGLSize=function(qS,q_){qA.onStageResize(qS,q_),qy.clientWidth=qS,qy.clientHeight=q_},qX.__init__=function(){var qS=q_.createMap;qS.lh=[qP_,"SPRITE3DHIERARCHY"],qS.ls=[qK_,"SPRITE3DHIERARCHY"],qS.lm=[qU_,"MESH"],qS.lmat=[qr_,"MATERIAL"],qS.jpg=[qY_,"nativeimage"],qS.jpeg=[qY_,"nativeimage"],qS.png=[qY_,"nativeimage"],qS.pkm=[qY_,"arraybuffer"],qS.raw=[qx_,"arraybuffer"],qS.mipmaps=[qx_,"arraybuffer"],qF.parserMap.SPRITE3DHIERARCHY=qX._loadHierarchy,qF.parserMap.MESH=qX._loadMesh,qF.parserMap.MATERIAL=qX._loadMaterial,qF.parserMap.TEXTURECUBE=qX._loadTextureCube,qF.parserMap.TERRAIN=qX._loadTerrain,qX._innerFirstLevelLoaderManager.on("error",null,qX._eventLoadManagerError),qX._innerSecondLevelLoaderManager.on("error",null,qX._eventLoadManagerError),qX._innerThirdLevelLoaderManager.on("error",null,qX._eventLoadManagerError),qX._innerFourthLevelLoaderManager.on("error",null,qX._eventLoadManagerError)},qX.READ_BLOCK=function(){return qX._readData.pos+=4,!0},qX.READ_DATA=function(){return qX._DATA.offset=qX._readData.getUint32(),qX._DATA.size=qX._readData.getUint32(),!0},qX.READ_STRINGS=function(){var qS=[],q_={offset:0,size:0};q_.offset=qX._readData.getUint16(),q_.size=qX._readData.getUint16();qX._readData.pos;qX._readData.pos=q_.offset+qX._DATA.offset;for(var qa=0;qa<q_.size;qa++){var qR=qX._readData.readUTFString();-1===qR.lastIndexOf(".lmat")&&-1===qR.lastIndexOf(".lpbr")||qS.push(qR)}return qS},qX.formatRelativePath=function(qS,q_){var qa;if("."===q_.charAt(0)){for(var qR=(qS+q_).split("/"),qJ=0,qV=qR.length;qJ<qV;qJ++)if(".."==qR[qJ]){var qW=qJ-1;0<qW&&".."!==qR[qW]&&(qR.splice(qW,2),qJ-=2)}qa=qR.join("/")}else qa=qS+q_;return null!=qI.customFormat&&(qa=qI.customFormat(qa,null)),qa},qX._eventLoadManagerError=function(qS){qQ.loader.event("error",qS)},qX._addHierarchyInnerUrls=function(qS,q_,qa,qR,qJ,qV){var qW=qX.formatRelativePath(qR,qJ);qa&&(qW+=qa),qS.push({url:qW,clas:qV}),q_[qJ]=qW},qX._getSprite3DHierarchyInnerUrls=function(qS,q_,qa,qR,qJ,qV,qW){var qk,qz=0,qb=0;switch(qS.type){case"Scene":var qH=qS.customProps.lightmaps;for(qz=0,qb=qH.length;qz<qb;qz++){var qL=qH[qz].replace(".exr",".png");qX._addHierarchyInnerUrls(qR,qJ,qV,qW,qL,qY_)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var qC;if(qS.instanceParams)(qC=qS.instanceParams.loadPath)&&qX._addHierarchyInnerUrls(q_,qJ,qV,qW,qC,qU_);else{(qC=(qk=qS.customProps).meshPath)&&qX._addHierarchyInnerUrls(q_,qJ,qV,qW,qC,qU_);var qG=qk.materials;if(qG)for(qz=0,qb=qG.length;qz<qb;qz++){for(var qt=qG[qz],qo=qt.type.split("."),q$=qh.window,qF=0,qT=qo.length;qF<qT;++qF){q$=q$[this.clasPaths[qF]]}if("function"!=typeof q$)throw"_getSprite3DHierarchyInnerUrls 错误: "+qt.type+" 不是类";qX._addHierarchyInnerUrls(qa,qJ,qV,qW,qt.path,q$)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var qD=(qk=qS.customProps).meshPath;qD&&qX._addHierarchyInnerUrls(q_,qJ,qV,qW,qD,qU_);var qj=qk.material;if(qj){qo=qj.type.split("."),q$=qh.window;for(qF=0,qT=qo.length;qF<qT;++qF){q$=q$[this.clasPaths[qF]]}qX._addHierarchyInnerUrls(qa,qJ,qV,qW,qj.path,q$)}else{var qQ=qk.materialPath;if(qQ)qX._addHierarchyInnerUrls(qa,qJ,qV,qW,qQ,ShurikenParticleMaterial);else{var qm=qk.texturePath;qm&&qX._addHierarchyInnerUrls(qR,qJ,qV,qW,qm,qY_)}}break;case"Terrain":qX._addHierarchyInnerUrls(qR,qJ,qV,qW,qS.customProps.dataPath,TerrainRes)}var qq=qS.components;for(var qN in qq){var qn=qq[qN];switch(qN){case"Animator":var ql=qn.avatarPath;if(ql)qX._addHierarchyInnerUrls(qR,qJ,qV,qW,ql,Avatar);else{var qB=qn.avatar;qB&&qX._addHierarchyInnerUrls(qR,qJ,qV,qW,qB.path,Avatar)}var qI=qn.clipPaths;for(qz=0,qb=qI.length;qz<qb;qz++)qX._addHierarchyInnerUrls(qR,qJ,qV,qW,qI[qz],AnimationClip)}}var qA=qS.child;for(qz=0,qb=qA.length;qz<qb;qz++)qX._getSprite3DHierarchyInnerUrls(qA[qz],q_,qa,qR,qJ,qV,qW)},qX._loadHierarchy=function(qS){qS.on("loaded",null,qX._onHierarchylhLoaded,[qS,qS._class._getGroup()]),qS.load(qS.url,"json",!1,null,!0)},qX._onHierarchylhLoaded=function(qS,q_,qa){if(qS._class.destroyed)qS.endLoad();else{var qR=qS.url,qJ=q$_.getURLVerion(qR),qV=qI.getPath(qR),qW=[],qk=[],qz=[],qb={};qX._getSprite3DHierarchyInnerUrls(qa,qW,qk,qz,qb,qJ,qV);var qH=qW.length+qk.length+qz.length,qL=qH+1,qC=1/qL;if(qX._onProcessChange(qS,0,qC,1),0<qz.length){var qG=qH/qL,qt=qB.create(null,qX._onProcessChange,[qS,qC,qG],!1);qX._innerFourthLevelLoaderManager.create(qz,qB.create(null,qX._onHierarchyInnerForthLevResouLoaded,[qS,q_,qt,qa,qb,qW,qk,qC+qG*qz.length,qG]),qt,null,null,1,!0,q_)}else qX._onHierarchyInnerForthLevResouLoaded(qS,q_,null,qa,qb,qW,qk,qC,qG)}},qX._onHierarchyInnerForthLevResouLoaded=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz){if(qS._class.destroyed)qS.endLoad();else if(qa&&qa.recover(),0<qW.length){var qb=qB.create(null,qX._onProcessChange,[qS,qk,qz],!1);qX._innerSecondLevelLoaderManager.create(qW,qB.create(null,qX._onHierarchyInnerSecondLevResouLoaded,[qS,q_,qb,qR,qJ,qV,qk+qz*qW.length,qz]),qa,null,null,1,!0,q_)}else qX._onHierarchyInnerSecondLevResouLoaded(qS,q_,null,qR,qJ,qV,qk,qz)},qX._onHierarchyInnerSecondLevResouLoaded=function(qS,q_,qa,qR,qJ,qV,qW,qk){if(qS._class.destroyed)qS.endLoad();else if(qa&&qa.recover(),0<qV.length){var qz=qB.create(null,qX._onProcessChange,[qS,qW,qk],!1);qX._innerFirstLevelLoaderManager.create(qV,qB.create(null,qX._onHierarchyInnerFirstLevResouLoaded,[qS,qz,qR,qJ]),qa,null,null,1,!0,q_)}else qX._onHierarchyInnerFirstLevResouLoaded(qS,null,qR,qJ)},qX._onHierarchyInnerFirstLevResouLoaded=function(qS,q_,qa,qR){q_&&q_.recover(),qS.endLoad([qa,qR])},qX._loadTerrain=function(qS){qS.on("loaded",null,qX._onTerrainLtLoaded,[qS,qS._class._getGroup()]),qS.load(qS.url,"json",!1,null,!0)},qX._onTerrainLtLoaded=function(qS,q_,qa){if(qS._class.destroyed)qS.endLoad();else{var qR,qJ,qV=qS.url,qW=q$_.getURLVerion(qV),qk=qI.getPath(qV),qz=[],qb={},qH=0,qL=0,qC=qa.heightData;qR=qC.url,qJ=qX.formatRelativePath(qk,qR),qW&&(qJ+=qW),qR=qb[qR]=qJ;var qG=qa.detailTexture;for(qH=0,qL=qG.length;qH<qL;qH++)qz.push({url:qG[qH].diffuse});var qt=qa.normalMap;for(qH=0,qL=qt.length;qH<qL;qH++)qz.push({url:qt[qH]});var qo=qa.alphaMap;for(qH=0,qL=qo.length;qH<qL;qH++)qz.push({url:qo[qH],params:[!1,!1,6408,!0]});for(qH=0,qL=qz.length;qH<qL;qH++){var q$=qz[qH].url;qJ=qX.formatRelativePath(qk,q$),qW&&(qJ+=qW),qz[qH].url=qJ,qb[q$]=qJ}var qF=qz.length,qT=qF+2,qD=1/qT;qX._onProcessChange(qS,0,qD,1);var qj={heightMapLoaded:!1,texturesLoaded:!1},qQ=qB.create(null,qX._onProcessChange,[qS,qD,qD],!1);qX._innerFourthLevelLoaderManager.create(qR,qB.create(null,qX._onTerrainHeightMapLoaded,[qS,qQ,qa,qb,qj]),qQ,null,[qC.numX,qC.numZ,qC.bitType,qC.value],1,!0,q_);var qm=qB.create(null,qX._onProcessChange,[qS,2*qD,qF/qT],!1);qX._innerFourthLevelLoaderManager.create(qz,qB.create(null,qX._onTerrainTexturesLoaded,[qS,qm,qa,qb,qj]),qm,null,null,1,!0,q_)}},qX._onTerrainHeightMapLoaded=function(qS,q_,qa,qR,qJ){qJ.heightMapLoaded=!0,qJ.texturesLoaded&&(qS.endLoad([qa,qR]),q_.recover())},qX._onTerrainTexturesLoaded=function(qS,q_,qa,qR,qJ){qJ.texturesLoaded=!0,qJ.heightMapLoaded&&(qS.endLoad([qa,qR]),q_.recover())},qX._loadMesh=function(qS){qS.on("loaded",null,qX._onMeshLmLoaded,[qS,qS._class._getGroup()]),qS.load(qS.url,"arraybuffer",!1,null,!0)},qX._onMeshLmLoaded=function(qS,q_,qa){if(qS._class.destroyed)qS.endLoad();else{var qR,qJ,qV,qW=qS.url,qk=q$_.getURLVerion(qW),qz=qI.getPath(qW),qb={},qH=0,qL=0;switch((qX._readData=new qm(qa)).pos=0,qX._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var qC=qX._readData.getUint32();qX._readData.pos=qX._readData.pos+4,qL=qX._readData.getUint16(),qX._readData.pos=qX._readData.pos+8*qL;var qG=qX._readData.getUint32();for(qL=qX._readData.getUint16(),qX._readData.pos=qC+qG,qR=[],qH=0;qH<qL;qH++){var qt=qX._readData.readUTFString();-1!==qt.lastIndexOf(".lmat")&&qR.push(qt)}break;default:for(qX.READ_BLOCK(),qH=0;qH<2;qH++){var qo=qX._readData.getUint16(),q$=qX._strings[qo],qF=qX["READ_"+q$];if(null==qF)throw new Error("model file err,no this function:"+qo+" "+q$);1===qH?qR=qF.call():qF.call()}}for(qH=0,qV=qR.length;qH<qV;qH++){var qT=qR[qH];qJ=qX.formatRelativePath(qz,qT),qk&&(qJ+=qk),qR[qH]=qJ,qb[qT]=qJ}if(0<qR.length){qX._onProcessChange(qS,0,.5,1);var qD=qB.create(null,qX._onProcessChange,[qS,.5,.5],!1);qX._innerSecondLevelLoaderManager.create(qR,qB.create(null,qX._onMeshMateialLoaded,[qS,qD,qa,qb]),qD,null,null,1,!0,q_)}else qS.endLoad([qa,qb])}},qX._onMeshMateialLoaded=function(qS,q_,qa,qR){qS.endLoad([qa,qR]),q_.recover()},qX._getMaterialTexturePath=function(qS,q_,qa){var qR=qS.length-4;return qS.indexOf(".dds")!=qR&&qS.indexOf(".tga")!=qR&&qS.indexOf(".exr")!=qR&&qS.indexOf(".DDS")!=qR&&qS.indexOf(".TGA")!=qR&&qS.indexOf(".EXR")!=qR||(qS=qS.substr(0,qR)+".png"),qS=qX.formatRelativePath(qa,qS),q_&&(qS+=q_),qS},qX._loadMaterial=function(qS){qS.on("loaded",null,qX._onMaterilLmatLoaded,[qS,qS._class._getGroup()]),qS.load(qS.url,"json",!1,null,!0)},qX._onMaterilLmatLoaded=function(qS,q_,qa){if(qS._class.destroyed)qS.endLoad();else{var qR,qJ=qS.url,qV=q$_.getURLVerion(qJ),qW=qI.getPath(qJ),qk=[],qz={},qb=qa.customProps,qH=qa.version;if(qH)switch(qH){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var qL=qa.props.textures,qC=0,qG=qL.length;qC<qG;qC++){var qt=qL[qC],qo=qt.path;if(qo){var q$=qo.length-4;qo.indexOf(".exr")!=q$&&qo.indexOf(".EXR")!=q$||(qo=qo.substr(0,q$)+".png"),qR=qX.formatRelativePath(qW,qo),qV&&(qR+=qV),qk.push({url:qR,params:qt.params}),qz[qo]=qR}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var qF=qb.diffuseTexture.texture2D;if(qF&&(qR=qX._getMaterialTexturePath(qF,qV,qW),qk.push(qR),qz[qF]=qR),qb.normalTexture){var qT=qb.normalTexture.texture2D;qT&&(qR=qX._getMaterialTexturePath(qT,qV,qW),qk.push(qR),qz[qT]=qR)}if(qb.specularTexture){var qD=qb.specularTexture.texture2D;qD&&(qR=qX._getMaterialTexturePath(qD,qV,qW),qk.push(qR),qz[qD]=qR)}if(qb.emissiveTexture){var qj=qb.emissiveTexture.texture2D;qj&&(qR=qX._getMaterialTexturePath(qj,qV,qW),qk.push(qR),qz[qj]=qR)}if(qb.ambientTexture){var qQ=qb.ambientTexture.texture2D;qQ&&(qR=qX._getMaterialTexturePath(qQ,qV,qW),qk.push(qR),qz[qQ]=qR)}if(qb.reflectTexture){var qm=qb.reflectTexture.texture2D;qm&&(qR=qX._getMaterialTexturePath(qm,qV,qW),qk.push(qR),qz[qm]=qR)}}var qq=qk.length,qN=qq+1,qn=1/qN;if(qX._onProcessChange(qS,0,qn,1),0<qq){var ql=qB.create(null,qX._onProcessChange,[qS,qn,qq/qN],!1);qX._innerFourthLevelLoaderManager.create(qk,qB.create(null,qX._onMateialTexturesLoaded,[qS,ql,qa,qz]),ql,qY_,null,1,!0,q_)}else qX._onMateialTexturesLoaded(qS,null,qa,null)}},qX._onMateialTexturesLoaded=function(qS,q_,qa,qR){qS.endLoad([qa,qR]),q_&&q_.recover()},qX._loadTextureCube=function(qS){qS.on("loaded",null,qX._onTextureCubeLtcLoaded,[qS]),qS.load(qS.url,"json",!1,null,!0)},qX._onTextureCubeLtcLoaded=function(qS,q_){if(qS._class.destroyed)qS.endLoad();else{var qa=qI.getPath(qS.url),qR=[qX.formatRelativePath(qa,q_.px),qX.formatRelativePath(qa,q_.nx),qX.formatRelativePath(qa,q_.py),qX.formatRelativePath(qa,q_.ny),qX.formatRelativePath(qa,q_.pz),qX.formatRelativePath(qa,q_.nz)];qX._onProcessChange(qS,0,1/7,1);var qJ=qB.create(null,qX._onProcessChange,[qS,1/7,6/7],!1);qX._innerFourthLevelLoaderManager.load(qR,qB.create(null,qX._onTextureCubeImagesLoaded,[qS,qR,qJ]),qJ,"nativeimage")}},qX._onTextureCubeImagesLoaded=function(qS,q_,qa){var qR=[];qR.length=6;for(var qJ=0;qJ<6;qJ++){var qV=q_[qJ];qR[qJ]=qF.getRes(qV),qF.clearRes(qV)}qS.endLoad(qR),qa.recover()},qX._onProcessChange=function(qS,q_,qa,qR){(qR=q_+qR*qa)<1&&qS.event("progress",qR)},qX.init=function(qS,q_,qa,qR,qJ,qV){if(void 0===qa&&(qa=!1),void 0===qR&&(qR=!1),void 0===qJ&&(qJ=!0),void 0===qV&&(qV=!0),qT.update3DLoop=function(){},qT.cancelLoadByUrl=function(qS){qX._cancelLoadByUrl(qS)},qz.isAntialias=qa,qz.isAlpha=qR,qz.premultipliedAlpha=qJ,qz.isStencil=qV,!qA.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");qT.changeWebGLSize=qX._changeWebGLSize,qo.is3DMode=!0,qQ.init(qS,q_),qu.__init__(),qL_.__init__(),qc_.__init__(),qs.__init__(),qX.__init__(),qW.maxTextureCount=2,(qX.debugMode||qE.debugMode)&&(qX._debugPhasorSprite=new qZ)},qX.HIERARCHY="SPRITE3DHIERARCHY",qX.MESH="MESH",qX.MATERIAL="MATERIAL",qX.PBRMATERIAL="PBRMTL",qX.TEXTURECUBE="TEXTURECUBE",qX.TERRAIN="TERRAIN",qX._readData=null,qX._debugPhasorSprite=null,qX.debugMode=!1,qL(qX,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new q_},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new q_},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new q_},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new q_}]),qX}(),qT_=function(qS){function qJ(qS){qJ.__super.call(this),this._owner=qS,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}qG(qJ,"laya.d3.animation.AnimationTransform3D",qV);var q_=qJ.prototype;return q_._getlocalMatrix=function(){return this._localUpdate&&(q$_._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},q_._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldTransform()}},q_._setWorldMatrixAndUpdate=function(qS){if(this._worldMatrix=qS,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var q_=this._getlocalMatrix(),qa=0;qa<16;++qa)this._worldMatrix[qa]=q_[qa];else q$_.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},q_._setWorldMatrixNoUpdate=function(qS){this._worldMatrix=qS},q_._setWorldMatrixIgnoreUpdate=function(qS){this._worldMatrix=qS,this._worldUpdate=!1},q_.getLocalPosition=function(){return this._localPosition},q_.setLocalPosition=function(qS){if(this._parent)this._localPosition=qS,this._localUpdate=!0,this._onWorldTransform();else{var q_=this._entity.owner._transform,qa=this._entity.localPosition,qR=qa.elements;qR[0]=qS[0],qR[1]=qS[1],qR[2]=qS[2],q_.localPosition=qa}},q_.getLocalRotation=function(){if(this._localQuaternionUpdate){var qS=this._localRotationEuler;q$_._quaternionCreateFromYawPitchRollArray(qS[1]/qJ._angleToRandin,qS[0]/qJ._angleToRandin,qS[2]/qJ._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},q_.setLocalRotation=function(qS){if(this._parent)this._localRotation=qS,q$_.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var q_=this._entity.owner._transform,qa=this._entity.localRotation,qR=qa.elements;qR[0]=qS[0],qR[1]=qS[1],qR[2]=qS[2],qR[3]=qS[3],q_.localRotation=qa}},q_.getLocalScale=function(){return this._localScale},q_.setLocalScale=function(qS){if(this._parent)this._localScale=qS,this._localUpdate=!0,this._onWorldTransform();else{var q_=this._entity.owner._transform,qa=this._entity.localScale,qR=qa.elements;qR[0]=qS[0],qR[1]=qS[1],qR[2]=qS[2],q_.localScale=qa}},q_.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){q$_.getYawPitchRoll(this._localRotation,qJ._tempVector3);var qS=qJ._tempVector3,q_=this._localRotationEuler;q_[0]=qS[1]*qJ._angleToRandin,q_[1]=qS[0]*qJ._angleToRandin,q_[2]=qS[2]*qJ._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},q_.setLocalRotationEuler=function(qS){if(this._parent)q$_._quaternionCreateFromYawPitchRollArray(qS[1]/qJ._angleToRandin,qS[0]/qJ._angleToRandin,qS[2]/qJ._angleToRandin,this._localRotation),this._localRotationEuler=qS,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var q_=this._entity.owner._transform,qa=this._entity.localRotationEuler,qR=qa.elements;qR[0]=qS[0],qR[1]=qS[1],qR[2]=qS[2],q_.localRotationEuler=qa}},q_.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)q$_.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var qS=this._getlocalMatrix(),q_=0;q_<16;++q_)this._worldMatrix[q_]=qS[q_];this._worldUpdate=!1}return this._worldMatrix},q_.setParent=function(qS){if(this._parent!==qS){if(this._parent){var q_=this._parent._childs,qa=q_.indexOf(this);q_.splice(qa,1)}qS&&(qS._childs.push(this),qS&&this._onWorldTransform()),this._parent=qS}},qL(qJ,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),qJ}(),qD_=function(qS){function q_(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,q_.__super.call(this),this._destroyed=!1,this._id=q_._uniqueIDCounter,q_._uniqueIDCounter++}qG(q_,"laya.d3.component.Component3D",qV);var qa=q_.prototype;return qQ.imps(qa,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),qa._initialize=function(qS){this._owner=qS,this._enable=!0,this.started=!1,this._load(qS)},qa._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},qa._load=function(qS){},qa._start=function(qS){},qa._update=function(qS){},qa._lateUpdate=function(qS){},qa._preRenderUpdate=function(qS){},qa._postRenderUpdate=function(qS){},qa._unload=function(qS){this.offAll()},qa._cloneTo=function(qS){},qt(0,qa,"id",function(){return this._id}),qt(0,qa,"destroyed",function(){return this._destroyed}),qt(0,qa,"owner",function(){return this._owner}),qt(0,qa,"enable",function(){return this._enable},function(qS){this._enable!==qS&&(this._enable=qS,this.event("enablechanged",this._enable))}),qt(0,qa,"isSingleton",function(){return q_._isSingleton}),q_._isSingleton=!0,q_._uniqueIDCounter=1,q_}(),qj_=function(qS){function q_(){this._destroyed=!1,q_.__super.call(this),this._destroyed=!1}qG(q_,"laya.d3.core.GeometryFilter",qV);var qa=q_.prototype;return qQ.imps(qa,{"laya.resource.IDestroy":!0}),qa._destroy=function(){this.offAll(),this._destroyed=!0},qt(0,qa,"_isAsyncLoaded",function(){return!0}),qt(0,qa,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),qt(0,qa,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),qt(0,qa,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),qt(0,qa,"destroyed",function(){return this._destroyed}),q_}(),qQ_=function(qS){function qR(qS){qR.__super.call(this),this._id=++qR._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new qES(new qW_,new qW_),this._boundingBoxCenter=new qW_,this._boundingSphere=new qwS(new qW_,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=qS,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}qG(qR,"laya.d3.core.render.BaseRender",qV);var q_=qR.prototype;return qQ.imps(q_,{"laya.resource.IDestroy":!0}),q_._changeMaterialReference=function(qS,q_){qS&&qS._removeReference(),q_._addReference()},q_._getInstanceMaterial=function(qS,q_){var qa=new qS.constructor;return qS.cloneTo(qa),qa.name=qa.name+"(Instance)",this._materialsInstance[q_]=!0,this._changeMaterialReference(this._materials[q_],qa),this._materials[q_]=qa},q_._setShaderValuelightMap=function(qS){this._setShaderValueTexture(3,qS)},q_._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},q_._renderRenderableBoundBox=function(){var qS=qF_._debugPhasorSprite,q_=this.boundingBox,qa=qR._tempBoundBoxCorners;q_.getCorners(qa),qS.line(qa[0],qR._greenColor,qa[1],qR._greenColor),qS.line(qa[2],qR._greenColor,qa[3],qR._greenColor),qS.line(qa[4],qR._greenColor,qa[5],qR._greenColor),qS.line(qa[6],qR._greenColor,qa[7],qR._greenColor),qS.line(qa[0],qR._greenColor,qa[3],qR._greenColor),qS.line(qa[1],qR._greenColor,qa[2],qR._greenColor),qS.line(qa[2],qR._greenColor,qa[6],qR._greenColor),qS.line(qa[3],qR._greenColor,qa[7],qR._greenColor),qS.line(qa[0],qR._greenColor,qa[4],qR._greenColor),qS.line(qa[1],qR._greenColor,qa[5],qR._greenColor),qS.line(qa[4],qR._greenColor,qa[7],qR._greenColor),qS.line(qa[5],qR._greenColor,qa[6],qR._greenColor)},q_._calculateBoundingSphere=function(){throw"BaseRender: must override it."},q_._calculateBoundingBox=function(){throw"BaseRender: must override it."},q_._setShaderValueTexture=function(qS,q_){this._owner._shaderValues.setValue(qS,q_)},q_._setShaderValueMatrix4x4=function(qS,q_){this._owner._shaderValues.setValue(qS,q_?q_.elements:null)},q_._setShaderValueColor=function(qS,q_){this._owner._shaderValues.setValue(qS,q_?q_.elements:null)},q_._setShaderValueBuffer=function(qS,q_){this._owner._shaderValues.setValue(qS,q_)},q_._setShaderValueInt=function(qS,q_){this._owner._shaderValues.setValue(qS,q_)},q_._setShaderValueBool=function(qS,q_){this._owner._shaderValues.setValue(qS,q_)},q_._setShaderValueNumber=function(qS,q_){this._owner._shaderValues.setValue(qS,q_)},q_._setShaderValueVector2=function(qS,q_){this._owner._shaderValues.setValue(qS,q_?q_.elements:null)},q_._addShaderDefine=function(qS){this._owner._shaderDefineValue|=qS},q_._removeShaderDefine=function(qS){this._owner._shaderDefineValue&=~qS},q_._renderUpdate=function(qS){return!0},q_._applyLightMapParams=function(){if(0<=this._lightmapIndex){var qS=this._owner.scene;if(qS){var q_=qS.getlightmaps()[this._lightmapIndex];q_?(this._addShaderDefine(qZ_.SAHDERDEFINE_LIGHTMAP),q_.loaded?this._setShaderValuelightMap(q_):q_.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(qZ_.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(qZ_.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(qZ_.SAHDERDEFINE_LIGHTMAP)},q_._updateOctreeNode=function(){var qS=this._treeNode;qS&&this._octreeNodeNeedChange&&(qS.updateObject(this),this._octreeNodeNeedChange=!1)},q_._destroy=function(){this.offAll();var qS=0,q_=0;for(qS=0,q_=this._renderElements.length;qS<q_;qS++)this._renderElements[qS]._destroy();for(qS=0,q_=this._materials.length;qS<q_;qS++)this._materials[qS]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},qt(0,q_,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),qt(0,q_,"id",function(){return this._id}),qt(0,q_,"material",function(){var qS=this._materials[0];if(qS&&!this._materialsInstance[0]){var q_=this._getInstanceMaterial(qS,0);this.event("materialchanged",[this,0,q_])}return this._materials[0]},function(qS){this.sharedMaterial=qS}),qt(0,q_,"sharedMaterial",function(){return this._materials[0]},function(qS){var q_=this._materials[0];q_!==qS&&(this._materials[0]=qS,this._materialsInstance[0]=!1,this._changeMaterialReference(q_,qS),this.event("materialchanged",[this,0,qS]))}),qt(0,q_,"lightmapIndex",function(){return this._lightmapIndex},function(qS){this._lightmapIndex=qS,this._applyLightMapParams()}),qt(0,q_,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(qS){this._lightmapScaleOffset=qS,this._setShaderValueColor(2,qS),this._addShaderDefine(qZ_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),qt(0,q_,"enable",function(){return this._enable},function(qS){this._enable=qS,this.event("enablechanged",[this,qS])}),qt(0,q_,"materials",function(){for(var qS=0,q_=this._materials.length;qS<q_;qS++)if(!this._materialsInstance[qS]){var qa=this._getInstanceMaterial(this._materials[qS],qS);this.event("materialchanged",[this,qS,qa])}return this._materials.slice()},function(qS){this.sharedMaterials=qS}),qt(0,q_,"sharedMaterials",function(){return this._materials.slice()},function(qS){if(!qS)throw new Error("MeshRender: shadredMaterials value can't be null.");var q_=qS.length;this._materialsInstance.length=q_;for(var qa=0;qa<q_;qa++){var qR=this._materials[qa];qR!==qS[qa]&&(this._materialsInstance[qa]=!1,this._changeMaterialReference(qR,qS[qa]),this.event("materialchanged",[this,qa,qS[qa]]))}this._materials=qS}),qt(0,q_,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),qt(0,q_,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var qS=this.boundingBox;qW_.add(qS.min,qS.max,this._boundingBoxCenter),qW_.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),qt(0,q_,"receiveShadow",function(){return this._receiveShadow},function(qS){this._receiveShadow!==qS&&((this._receiveShadow=qS)?this._addShaderDefine(qG_.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(qG_.SHADERDEFINE_RECEIVE_SHADOW))}),qt(0,q_,"destroyed",function(){return this._destroyed}),qR._uniqueIDCounter=0,qL(qR,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_,new qW_]},"_greenColor",function(){return this._greenColor=new qk_(0,1,0,1)}]),qR}(),qm_=function(qS){function qk(qS){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,qk.__super.call(this),this._localPosition=new qW_,this._localRotation=new qa_(0,0,0,1),this._localScale=new qW_(1,1,1),this._localRotationEuler=new qW_,this._localMatrix=new qS_,this._position=new qW_,this._rotation=new qa_(0,0,0,1),this._scale=new qW_(1,1,1),this._worldMatrix=new qS_,this._forward=new qW_,this._up=new qW_,this._right=new qW_,this._owner=qS,this._childs=[]}qG(qk,"laya.d3.core.Transform3D",qV);var q_=qk.prototype;return q_._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)qS_.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var qS=qk._tempVector30;qW_.multiply(this.pivot,this._localScale,qS);var q_=qk._tempVector31;qW_.subtract(qS,this.pivot,q_);var qa=qk._tempVector32,qR=this.localRotation;qW_.transformQuat(qS,qR,qa),qW_.subtract(qa,qS,qa);var qJ=qk._tempVector33;qW_.subtract(this._localPosition,q_,qJ),qW_.subtract(qJ,qa,qJ),qS_.createAffineTransformation(qJ,qR,this._localScale,this._localMatrix)}},q_._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldPositionRotationTransform()}},q_._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldPositionScaleTransform()}},q_._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldPositionTransform()}},q_._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldPositionRotationTransform()}},q_._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldPositionScaleTransform()}},q_._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._onWorldTransform()}},q_.translate=function(qS,q_){void 0===q_&&(q_=!0),q_?(qS_.createFromQuaternion(this.localRotation,qk._tempMatrix0),qW_.transformCoordinate(qS,qk._tempMatrix0,qk._tempVector30),qW_.add(this.localPosition,qk._tempVector30,this._localPosition),this.localPosition=this._localPosition):(qW_.add(this.position,qS,this._position),this.position=this._position)},q_.rotate=function(qS,q_,qa){var qR;void 0===q_&&(q_=!0),void 0===qa&&(qa=!0),qR=qa?qS:(qW_.scale(qS,Math.PI/180,qk._tempVector30),qk._tempVector30),qa_.createFromYawPitchRoll(qR.y,qR.x,qR.z,qk._tempQuaternion0),q_?(qa_.multiply(this._localRotation,qk._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(qa_.multiply(qk._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},q_.lookAt=function(qS,q_,qa){void 0===qa&&(qa=!1);var qR,qJ=qS.elements;if(qa){if(qR=this._localPosition.elements,Math.abs(qR[0]-qJ[0])<qvS.zeroTolerance&&Math.abs(qR[1]-qJ[1])<qvS.zeroTolerance&&Math.abs(qR[2]-qJ[2])<qvS.zeroTolerance)return;qa_.lookAt(this._localPosition,qS,q_,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var qV=this.position;if(qR=qV.elements,Math.abs(qR[0]-qJ[0])<qvS.zeroTolerance&&Math.abs(qR[1]-qJ[1])<qvS.zeroTolerance&&Math.abs(qR[2]-qJ[2])<qvS.zeroTolerance)return;qa_.lookAt(qV,qS,q_,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},qt(0,q_,"_isFrontFaceInvert",function(){var qS=this.scale,q_=qS.x<0;return qS.y<0&&(q_=!q_),qS.z<0&&(q_=!q_),q_}),qt(0,q_,"owner",function(){return this._owner}),qt(0,q_,"localRotation",function(){if(this._localQuaternionUpdate){var qS=this._localRotationEuler.elements;qa_.createFromYawPitchRoll(qS[1]/qk._angleToRandin,qS[0]/qk._angleToRandin,qS[2]/qk._angleToRandin,this._localRotation)}return this._localRotation},function(qS){this._localRotation=qS,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),qt(0,q_,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?qS_.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(qS){null===this._parent?qS.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),qS_.multiply(this._localMatrix,qS,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=qS,this._worldUpdate=!1}),qt(0,q_,"worldNeedUpdate",function(){return this._worldUpdate}),qt(0,q_,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(qS){this._localMatrix=qS,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),qt(0,q_,"dummy",function(){return this._dummy},function(qS){this._dummy!==qS&&(this._dummy&&(this._dummy._entity=null),qS&&(qS._entity=this),this._dummy=qS)}),qt(0,q_,"localPosition",function(){return this._localPosition},function(qS){this._localPosition=qS,this._localUpdate=!0,this._onWorldPositionTransform()}),qt(0,q_,"position",function(){if(this._positionUpdate){if(null!=this._parent){var qS=this._parent.position;qW_.multiply(this._localPosition,this._parent.scale,qk._tempVector30),qW_.transformQuat(qk._tempVector30,this._parent.rotation,qk._tempVector30),qW_.add(qS,qk._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(qS){if(null!=this._parent){qW_.subtract(qS,this._parent.position,this._localPosition);var q_=this._parent.scale.elements,qa=q_[0],qR=q_[1],qJ=q_[2];if(1!==qa||1!==qR||1!==qJ){var qV=qk._tempVector30,qW=qV.elements;qW[0]=1/qa,qW[1]=1/qR,qW[2]=1/qJ,qW_.multiply(this._localPosition,qV,this._localPosition)}this._parent.rotation.invert(qk._tempQuaternion0),qW_.transformQuat(this._localPosition,qk._tempQuaternion0,this._localPosition)}else qS.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=qS,this._positionUpdate=!1}),qt(0,q_,"localScale",function(){return this._localScale},function(qS){this._localScale=qS,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),qt(0,q_,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(qk._tempVector30);var qS=qk._tempVector30.elements,q_=this._localRotationEuler.elements;q_[0]=qS[1]*qk._angleToRandin,q_[1]=qS[0]*qk._angleToRandin,q_[2]=qS[2]*qk._angleToRandin}return this._localRotationEuler},function(qS){this._localRotationEuler=qS,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),qt(0,q_,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?qa_.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(qS){null!=this._parent?(this._parent.rotation.invert(qk._tempQuaternion0),qa_.multiply(qS,qk._tempQuaternion0,this._localRotation)):qS.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=qS,this._rotationUpdate=!1}),qt(0,q_,"scale",function(){return this._scaleUpdate&&(null!==this._parent?qW_.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(qS){if(null!==this._parent){var q_=this._parent.scale.elements,qa=qk._tempVector30.elements;qa[0]=1/q_[0],qa[1]=1/q_[1],qa[2]=1/q_[2],qW_.multiply(qS,qk._tempVector30,this._localScale)}else qS.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=qS,this._scaleUpdate=!1}),qt(0,q_,"rotationEuler",null,function(qS){qa_.createFromYawPitchRoll(qS.y,qS.x,qS.z,this._rotation),this.rotation=this._rotation}),qt(0,q_,"forward",function(){var qS=this.worldMatrix.elements;return this._forward.elements[0]=-qS[8],this._forward.elements[1]=-qS[9],this._forward.elements[2]=-qS[10],this._forward}),qt(0,q_,"up",function(){var qS=this.worldMatrix.elements;return this._up.elements[0]=qS[4],this._up.elements[1]=qS[5],this._up.elements[2]=qS[6],this._up}),qt(0,q_,"right",function(){var qS=this.worldMatrix.elements;return this._right.elements[0]=qS[0],this._right.elements[1]=qS[1],this._right.elements[2]=qS[2],this._right}),qt(0,q_,"parent",function(){return this._parent},function(qS){if(this._parent!==qS){if(this._parent){var q_=this._parent._childs,qa=q_.indexOf(this);q_.splice(qa,1)}qS&&(qS._childs.push(this),qS&&this._onWorldTransform()),this._parent=qS}}),qL(qk,["_tempVector30",function(){return this._tempVector30=new qW_},"_tempVector31",function(){return this._tempVector31=new qW_},"_tempVector32",function(){return this._tempVector32=new qW_},"_tempVector33",function(){return this._tempVector33=new qW_},"_tempQuaternion0",function(){return this._tempQuaternion0=new qa_},"_tempMatrix0",function(){return this._tempMatrix0=new qS_},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),qk}(),qq_=(function(qS){function q_(){this._rotation=0,this._matNeedUpdte=!1,q_.__super.call(this),this._matrix=new qS_,this._offset=new qV_,this._tiling=new qV_(1,1)}qG(q_,"laya.d3.core.TransformUV",qV);var qa=q_.prototype;qQ.imps(qa,{"laya.d3.core.IClone":!0}),qa._updateMatrix=function(){q_._tempOffsetV3.elements[0]=this._offset.x,q_._tempOffsetV3.elements[1]=this._offset.y,qa_.createFromYawPitchRoll(0,0,this._rotation,q_._tempRotationQua),q_._tempTitlingV3.elements[0]=this._tiling.x,q_._tempTitlingV3.elements[1]=this._tiling.y,qS_.createAffineTransformation(q_._tempOffsetV3,q_._tempRotationQua,q_._tempTitlingV3,this._matrix)},qa.cloneTo=function(qS){qS._matrix=this._matrix.clone(),qS._offset=this._offset.clone(),qS._rotation=this._rotation,qS._tiling=this._tiling.clone()},qa.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,qa,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),qt(0,qa,"tiling",function(){return this._tiling},function(qS){this._tiling=qS,this._matNeedUpdte=!0}),qt(0,qa,"offset",function(){return this._offset},function(qS){this._offset=qS,this._matNeedUpdte=!0}),qt(0,qa,"rotation",function(){return this._rotation},function(qS){this._rotation=qS,this._matNeedUpdte=!0}),qL(q_,["_tempOffsetV3",function(){return this._tempOffsetV3=new qW_(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new qa_},"_tempTitlingV3",function(){return this._tempTitlingV3=new qW_(1,1,1)}])}(),function(qa){function qS(){this.x=NaN,this.y=NaN,this.z=NaN,qS.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}qG(qS,"laya.d3.core.particleShuriKen.module.shape.BoxShape",qa);var q_=qS.prototype;q_._getShapeBoundBox=function(qS){var q_=qS.min.elements;q_[0]=.5*-this.x,q_[1]=.5*-this.y,q_[2]=.5*-this.z;var qa=qS.max.elements;qa[0]=.5*this.x,qa[1]=.5*this.y,qa[2]=.5*this.z},q_._getSpeedBoundBox=function(qS){var q_=qS.min.elements;q_[0]=0,q_[1]=0,q_[2]=0;var qa=qS.max.elements;qa[0]=0,qa[1]=1,qa[2]=0},q_.generatePositionAndDirection=function(qS,q_,qa,qR){var qJ=qS.elements,qV=q_.elements;qa?(qa.seed=qR[16],qY._randomPointInsideHalfUnitBox(qS,qa),qR[16]=qa.seed):qY._randomPointInsideHalfUnitBox(qS),qJ[0]=this.x*qJ[0],qJ[1]=this.y*qJ[1],qJ[2]=this.z*qJ[2],this.randomDirection?qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_):(qV[0]=0,qV[1]=0,qV[2]=1)},q_.cloneTo=function(qS){qa.prototype.cloneTo.call(this,qS);var q_=qS;q_.x=this.x,q_.y=this.y,q_.z=this.z,q_.randomDirection=this.randomDirection}}(qg),function(qa){function qW(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,qW.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}qG(qW,"laya.d3.core.particleShuriKen.module.shape.CircleShape",qa);var qS=qW.prototype;qS._getShapeBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[2]=-this.radius,q_[1]=0;var qa=qS.max.elements;qa[0]=qa[2]=this.radius,qa[1]=0},qS._getSpeedBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[1]=-1,q_[2]=0;var qa=qS.max.elements;qa[0]=qa[1]=1,qa[2]=0},qS.generatePositionAndDirection=function(qS,q_,qa,qR){var qJ=qS.elements,qV=qW._tempPositionPoint.elements;qa?(qa.seed=qR[16],this.emitFromEdge?qY._randomPointUnitArcCircle(this.arc,qW._tempPositionPoint,qa):qY._randomPointInsideUnitArcCircle(this.arc,qW._tempPositionPoint,qa),qR[16]=qa.seed):this.emitFromEdge?qY._randomPointUnitArcCircle(this.arc,qW._tempPositionPoint):qY._randomPointInsideUnitArcCircle(this.arc,qW._tempPositionPoint),qJ[0]=-qV[0],qJ[1]=qV[1],qJ[2]=0,qW_.scale(qS,this.radius,qS),this.randomDirection?qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_):qS.cloneTo(q_)},qS.cloneTo=function(qS){qa.prototype.cloneTo.call(this,qS);var q_=qS;q_.radius=this.radius,q_.arc=this.arc,q_.emitFromEdge=this.emitFromEdge,q_.randomDirection=this.randomDirection},qL(qW,["_tempPositionPoint",function(){return this._tempPositionPoint=new qV_}])}(qg),function(qa){function qC(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,qC.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}qG(qC,"laya.d3.core.particleShuriKen.module.shape.ConeShape",qa);var qS=qC.prototype;qS._getShapeBoundBox=function(qS){var q_=this.radius+this.length*Math.sin(this.angle),qa=this.length*Math.cos(this.angle),qR=qS.min.elements;qR[0]=qR[1]=-q_,qR[2]=0;var qJ=qS.max.elements;qJ[0]=qJ[1]=q_,qJ[2]=qa},qS._getSpeedBoundBox=function(qS){var q_=Math.sin(this.angle),qa=qS.min.elements;qa[0]=qa[1]=-q_,qa[2]=0;var qR=qS.max.elements;qR[0]=qa[1]=q_,qR[2]=1},qS.generatePositionAndDirection=function(qS,q_,qa,qR){var qJ,qV=qS.elements,qW=q_.elements,qk=qC._tempPositionPoint.elements,qz=NaN,qb=NaN,qH=Math.cos(this.angle),qL=Math.sin(this.angle);switch(this.emitType){case 0:qa?(qa.seed=qR[16],qY._randomPointInsideUnitCircle(qC._tempPositionPoint,qa),qR[16]=qa.seed):qY._randomPointInsideUnitCircle(qC._tempPositionPoint),qz=qk[0],qb=qk[1],qV[0]=qz*this.radius,qV[1]=qb*this.radius,qV[2]=0,this.randomDirection?(qa?(qa.seed=qR[17],qY._randomPointInsideUnitCircle(qC._tempDirectionPoint,qa),qR[17]=qa.seed):qY._randomPointInsideUnitCircle(qC._tempDirectionPoint),qJ=qC._tempDirectionPoint.elements,qW[0]=qJ[0]*qL,qW[1]=qJ[1]*qL):(qW[0]=qz*qL,qW[1]=qb*qL),qW[2]=qH;break;case 1:qa?(qa.seed=qR[16],qY._randomPointUnitCircle(qC._tempPositionPoint,qa),qR[16]=qa.seed):qY._randomPointUnitCircle(qC._tempPositionPoint),qz=qk[0],qb=qk[1],qV[0]=qz*this.radius,qV[1]=qb*this.radius,qV[2]=0,this.randomDirection?(qa?(qa.seed=qR[17],qY._randomPointInsideUnitCircle(qC._tempDirectionPoint,qa),qR[17]=qa.seed):qY._randomPointInsideUnitCircle(qC._tempDirectionPoint),qJ=qC._tempDirectionPoint.elements,qW[0]=qJ[0]*qL,qW[1]=qJ[1]*qL):(qW[0]=qz*qL,qW[1]=qb*qL),qW[2]=qH;break;case 2:qa?(qa.seed=qR[16],qY._randomPointInsideUnitCircle(qC._tempPositionPoint,qa)):qY._randomPointInsideUnitCircle(qC._tempPositionPoint),qz=qk[0],qb=qk[1],qV[0]=qz*this.radius,qV[1]=qb*this.radius,qW[qV[2]=0]=qz*qL,qW[1]=qb*qL,qW[2]=qH,qW_.normalize(q_,q_),qa?(qW_.scale(q_,this.length*qa.getFloat(),q_),qR[16]=qa.seed):qW_.scale(q_,this.length*Math.random(),q_),qW_.add(qS,q_,qS),this.randomDirection&&(qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_));break;case 3:qa?(qa.seed=qR[16],qY._randomPointUnitCircle(qC._tempPositionPoint,qa)):qY._randomPointUnitCircle(qC._tempPositionPoint),qz=qk[0],qb=qk[1],qV[0]=qz*this.radius,qV[1]=qb*this.radius,qW[qV[2]=0]=qz*qL,qW[1]=qb*qL,qW[2]=qH,qW_.normalize(q_,q_),qa?(qW_.scale(q_,this.length*qa.getFloat(),q_),qR[16]=qa.seed):qW_.scale(q_,this.length*Math.random(),q_),qW_.add(qS,q_,qS),this.randomDirection&&(qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_));break;default:throw new Error("ConeShape:emitType is invalid.")}},qS.cloneTo=function(qS){qa.prototype.cloneTo.call(this,qS);var q_=qS;q_.angle=this.angle,q_.radius=this.radius,q_.length=this.length,q_.emitType=this.emitType,q_.randomDirection=this.randomDirection},qL(qC,["_tempPositionPoint",function(){return this._tempPositionPoint=new qV_},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new qV_}])}(qg),function(qa){function qS(){this.radius=NaN,this.emitFromShell=!1,qS.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}qG(qS,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",qa);var q_=qS.prototype;q_._getShapeBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[1]=q_[2]=-this.radius;var qa=qS.max.elements;qa[0]=qa[1]=this.radius,qa[2]=0},q_._getSpeedBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[1]=-1,q_[2]=0;var qa=qS.max.elements;qa[0]=qa[1]=qa[2]=1},q_.generatePositionAndDirection=function(qS,q_,qa,qR){var qJ=qS.elements;qa?(qa.seed=qR[16],this.emitFromShell?qY._randomPointUnitSphere(qS,qa):qY._randomPointInsideUnitSphere(qS,qa),qR[16]=qa.seed):this.emitFromShell?qY._randomPointUnitSphere(qS):qY._randomPointInsideUnitSphere(qS),qW_.scale(qS,this.radius,qS);var qV=qJ[2];qV<0&&(qJ[2]=-1*qV),this.randomDirection?qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_):qS.cloneTo(q_)},q_.cloneTo=function(qS){qa.prototype.cloneTo.call(this,qS);var q_=qS;q_.radius=this.radius,q_.emitFromShell=this.emitFromShell,q_.randomDirection=this.randomDirection}}(qg),function(qa){function qS(){this.radius=NaN,this.emitFromShell=!1,qS.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}qG(qS,"laya.d3.core.particleShuriKen.module.shape.SphereShape",qa);var q_=qS.prototype;q_._getShapeBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[1]=q_[2]=-this.radius;var qa=qS.max.elements;qa[0]=qa[1]=qa[2]=this.radius},q_._getSpeedBoundBox=function(qS){var q_=qS.min.elements;q_[0]=q_[1]=q_[2]=-1;var qa=qS.max.elements;qa[0]=qa[1]=qa[2]=1},q_.generatePositionAndDirection=function(qS,q_,qa,qR){qa?(qa.seed=qR[16],this.emitFromShell?qY._randomPointUnitSphere(qS,qa):qY._randomPointInsideUnitSphere(qS,qa),qR[16]=qa.seed):this.emitFromShell?qY._randomPointUnitSphere(qS):qY._randomPointInsideUnitSphere(qS),qW_.scale(qS,this.radius,qS),this.randomDirection?qa?(qa.seed=qR[17],qY._randomPointUnitSphere(q_,qa),qR[17]=qa.seed):qY._randomPointUnitSphere(q_):qS.cloneTo(q_)},q_.cloneTo=function(qS){qa.prototype.cloneTo.call(this,qS);var q_=qS;q_.radius=this.radius,q_.emitFromShell=this.emitFromShell,q_.randomDirection=this.randomDirection}}(qg),function(qS){function q_(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,q_.__super.call(this)}return qG(q_,"laya.d3.core.render.SubMeshRenderElement",qp),q_}()),qN_=function(qS){function q$(qS,q_,qa,qR,qJ,qV){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=qS,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[qG_.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[qZ_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[qZ_.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[qI_.SHADERDEFINE_ALPHATEST]="ALPHATEST";q$.__super.call(this,qS,q_,qa,null,{}),this._attributeMap=qR;var qW;for(qW in qJ){var qk=qJ[qW];switch(qk[1]){case 0:this._renderElementUniformMap[qW]=qk[0];break;case 1:this._materialUniformMap[qW]=qk[0];break;case 2:this._spriteUniformMap[qW]=qk[0];break;case 3:this._cameraUniformMap[qW]=qk[0];break;case 4:this._sceneUniformMap[qW]=qk[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}qG(q$,"laya.d3.shader.ShaderCompile3D",qD);var q_=q$.prototype;return q_._definesToNameDic=function(qS,q_){for(var qa={},qR=1,qJ=0;qJ<32&&!(qS<(qR=1<<qJ));qJ++)if(qS&qR){var qV=q_[qR];qV&&(qa[qV]="")}return qa},q_.withCompile=function(qS,q_,qa,qR){var qJ,qV,qW;if(qV=this.sharders[qS])if(qW=qV[q_]){if(qJ=qW[qa])return qJ}else qW=qV[q_]=[];else qW=(qV=this.sharders[qS]=[])[q_]=[];var qk,qz=this._definesToNameDic(qS,q$._globalInt2name),qb=this._definesToNameDic(q_,this._spriteInt2name),qH=this._definesToNameDic(qa,this._materialInt2name),qL={},qC="";if(qz)for(qk in qz)qC+="#define "+qk+"\n",qL[qk]=!0;if(qb)for(qk in qb)qC+="#define "+qk+"\n",qL[qk]=!0;if(qH)for(qk in qH)qC+="#define "+qk+"\n",qL[qk]=!0;var qG=qM_.nameKey.getName(this._name)+" compile ("+qS+","+q_+","+qa+")",qt=this._VS.toscript(qL,[]),qo=this._PS.toscript(qL,[]);qh.now();if(qJ=qM_.create(qC+qt.join("\n"),qC+qo.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,qR,qG),qW[qa]=qJ,laya.d3.shader.ShaderCompile3D.debugMode)qh.now();return qJ},q_.precompileShaderWithShaderDefine=function(qS,q_,qa){this.withCompile(qS,q_,qa,!0)},q_.addMaterialDefines=function(qS){var q_=qS.defines;for(var qa in q_){var qR=q_[qa],qJ=parseInt(qa);this._materialInt2name[qJ]=qR,this._materialName2Int[qR]=qJ}},q_.addSpriteDefines=function(qS){var q_=qS.defines;for(var qa in q_){var qR=q_[qa],qJ=parseInt(qa);this._spriteInt2name[qJ]=qR,this._spriteName2Int[qR]=qJ}},q_.getMaterialDefineByName=function(qS){return this._materialName2Int[qS]},q_.registerMaterialDefine=function(qS){var q_=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[q_]=qS,this._materialName2Int[qS]=q_},q_.registerSpriteDefine=function(qS){var q_=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[q_]=qS,this._spriteName2Int[qS]=q_},q$._globalRegDefine=function(qS,q_){q$._globalInt2name[q_]=qS},q$.add=function(qS,q_,qa,qR,qJ){return laya.d3.shader.ShaderCompile3D._preCompileShader[qS]=new q$(qS,q_,qa,qR,qJ,qD.includes)},q$.get=function(qS){return laya.d3.shader.ShaderCompile3D._preCompileShader[qM_.nameKey.getID(qS)]},q$._preCompileShader={},q$._globalInt2name=[],q$.debugMode=!1,q$.SHADERDEFINE_HIGHPRECISION=1,q$.SHADERDEFINE_FOG=4,q$.SHADERDEFINE_DIRECTIONLIGHT=8,q$.SHADERDEFINE_POINTLIGHT=16,q$.SHADERDEFINE_SPOTLIGHT=32,q$.SHADERDEFINE_UV0=64,q$.SHADERDEFINE_COLOR=128,q$.SHADERDEFINE_UV1=256,q$.SAHDERDEFINE_DEPTHFOG=131072,q$}(),qn_=function(qS){function qt(){qt.__super.call(this)}qG(qt,"laya.d3.graphics.MeshSprite3DStaticBatchManager",qRS);var q_=qt.prototype;return q_._getStaticBatch=function(qS,q_,qa,qR){var qJ,qV;return qV=qS?qS.id.toString()+qa.id.toString()+q_.id.toString()+qR.toString():qa.id.toString()+q_.id.toString()+qR.toString(),this._staticBatches[qV]?qJ=this._staticBatches[qV]:this._staticBatches[qV]=qJ=new ql_(qV,this,qS,q_,qa),qJ},q_._initStaticBatchs=function(qS){var q_,qa;this._initBatchRenderElements.sort(qt._sortPrepareStaticBatch);for(var qR,qJ=!1,qV=0,qW=0,qk=this._initBatchRenderElements.length;qW<qk;qW++){var qz,qb=this._initBatchRenderElements[qW],qH=qb.renderObj._getVertexBuffer(0);qb._sprite3D;if(qa===qH.vertexDeclaration&&q_===qb._material)if(qJ)qR._addCombineBatchRenderObjTest(qb)?(qz=qb._staticBatch)!==qR&&(qz&&qz._deleteCombineBatchRenderObj(qb),qR._addCombineBatchRenderObj(qb)):(qJ=!1,qV++);else{var qL=this._initBatchRenderElements[qW-1],qC=qL.renderObj,qG=qb.renderObj;qJ=!(65535<qC._getVertexBuffer().vertexCount+qG._getVertexBuffer().vertexCount)&&(qR=this._getStaticBatch(qS,qa,q_,qV),(qz=qL._staticBatch)!==qR&&(qz&&qz._deleteCombineBatchRenderObj(qL),qR._addCombineBatchRenderObj(qL)),(qz=qb._staticBatch)!==qR&&(qz&&qz._deleteCombineBatchRenderObj(qb),qR._addCombineBatchRenderObj(qb)),!0)}else qJ=!1,qV=0;q_=qb._material,qa=qH.vertexDeclaration}},qt._sortPrepareStaticBatch=function(qS,q_){var qa=qS._render,qR=q_._render,qJ=qa.lightmapIndex-qR.lightmapIndex;if(0!=qJ)return qJ;var qV=qa.receiveShadow-qR.receiveShadow;if(0!=qV)return qV;var qW=qS._mainSortID-q_._mainSortID;return 0==qW?qS.renderObj.triangleCount-q_.renderObj.triangleCount:qW},qt}(),ql_=function(qS){function qV(qS,q_,qa,qR,qJ){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,qV.__super.call(this,qS,q_,qa),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=qR,this._material=qJ}qG(qV,"laya.d3.graphics.SubMeshStaticBatch",qJS);var q_=qV.prototype;return q_._compareBatchRenderElement=function(qS,q_){return qS._batchIndexStart>q_._batchIndexStart},q_._addCombineBatchRenderObjTest=function(qS){var q_=qS.renderObj._vertexCount;return!(65535<(0<q_?this._currentCombineVertexCount+q_:this._currentCombineVertexCount+qS.renderObj._getVertexBuffer().vertexCount))},q_._addCombineBatchRenderObj=function(qS){var q_=qS.renderObj,qa=q_._vertexCount;this._initBatchRenderElements.push(qS),qS._staticBatch=this,0<qa?(this._currentCombineIndexCount+=q_._indexCount,this._currentCombineVertexCount+=qa):(this._currentCombineIndexCount=this._currentCombineIndexCount+q_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+q_._getVertexBuffer().vertexCount),this._needFinishCombine=!0},q_._deleteCombineBatchRenderObj=function(qS){var q_=qS.renderObj,qa=this._initBatchRenderElements.indexOf(qS);if(-1!==qa){this._initBatchRenderElements.splice(qa,1),qS._staticBatch=null;var qR=q_._vertexCount;0<qR?(this._currentCombineIndexCount=this._currentCombineIndexCount-q_._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-qR):(this._currentCombineIndexCount=this._currentCombineIndexCount-q_._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-q_._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},q_._finishInit=function(){if(this._needFinishCombine){var qS=0,q_=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var qa=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),qR=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=qg_.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=qe_.create("ushort",this._currentCombineIndexCount,35044);for(var qJ=0,qV=this._initBatchRenderElements.length;qJ<qV;qJ++){var qW=this._initBatchRenderElements[qJ],qk=qW.renderObj,qz=qk._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,qW._sprite3D),qb=qk.getIndices(),qH=qW._sprite3D.transform._isFrontFaceInvert,qL=qS/(this._vertexDeclaration.vertexStride/4)-qk._vertexStart,qC=q_,qG=qC+qb.length;qW._batchIndexStart=qC,qW._batchIndexEnd=qG,qR.set(qb,q_);var qt=0;if(qH)for(qt=qC;qt<qG;qt+=3){qR[qt]=qL+qR[qt];var qo=qR[qt+1],q$=qR[qt+2];qR[qt+1]=qL+q$,qR[qt+2]=qL+qo}else for(qt=qC;qt<qG;qt+=3)qR[qt]=qL+qR[qt],qR[qt+1]=qL+qR[qt+1],qR[qt+2]=qL+qR[qt+2];q_+=qb.length,qa.set(qz,qS),qS+=qz.length}this._vertexBuffer.setData(qa),this._indexBuffer.setData(qR),this._needFinishCombine=!1}},q_._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new qq_)},q_._getRenderElement=function(qS,q_,qa){for(var qR,qJ,qV=this._batchRenderElements.length,qW=!0,qk=0;qk<qV;qk++){var qz,qb,qH=(qJ=this._batchRenderElements[qk])._sprite3D._render;if(0!==qk&&(qW=(qz=(qR=this._batchRenderElements[qk-1])._sprite3D._render).lightmapIndex!==qH.lightmapIndex||qz.receiveShadow!==qH.receiveShadow||qR._batchIndexEnd!==qJ._batchIndexStart),qW){(qb=this._getCombineRenderElementFromPool()).renderObj=this,qb._material=this._material,qb._batchIndexStart=qJ._batchIndexStart,qb._batchIndexEnd=qJ._batchIndexEnd;var qL=qH.lightmapIndex,qC=qL+1,qG=this._batchOwnerIndices[qC];qG||(qG=this._batchOwnerIndices[qC]=[]);var qt,qo=qG[qJ._render.receiveShadow?1:0];void 0===qo?(qG[qH.receiveShadow?1:0]=this._batchOwners.length,(qt=new qc_(null,"StaticBatchMeshSprite3D"))._scene=q_,qt._transform=this._rootOwner?this._rootOwner._transform:null,qt._render.lightmapIndex=qL,qt._render.receiveShadow=qJ._render.receiveShadow,this._batchOwners.push(qt)):qt=this._batchOwners[qo],qt._render._renderUpdate(qa),qb._sprite3D=qt,qS.push(qb)}else qb._batchIndexEnd=qJ._batchIndexEnd}},q_._beforeRender=function(qS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},q_._render=function(qS){var q_=qS.renderElement,qa=q_._batchIndexStart,qR=q_._batchIndexEnd-qa;qA.mainContext.drawElements(4,qR,5123,2*qa),qN.drawCall++,qN.trianglesFaces+=qR/3},q_.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},q_._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),this._vertexBuffer},qV}(),qB_=function(qS){function q_(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,q_.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}qG(q_,"laya.d3.core.ComponentNode",qb);var qa=q_.prototype;return qa.addComponent=function(qS){var q_,qa=this._componentsMap.indexOf(qS);if(-1===qa)q_=[],this._componentsMap.push(qS),this._typeComponentsIndices.push(q_);else if(q_=this._typeComponentsIndices[qa],this._components[q_[0]].isSingleton)throw new Error("无法单实例创建"+qS+"组件，"+qS+"组件已存在！");var qR=qJ.getInstance(qS);return q_.push(this._components.length),this._components.push(qR),qR instanceof laya.d3.component.Script&&this._scripts.push(qR),qR._initialize(this),qR},qa._removeComponent=function(qS,q_){var qa=this._typeComponentsIndices[qS],qR=qa[q_],qJ=this._components[qR];this._components.splice(qR,1),qJ instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(qJ),1),qa.splice(q_,1),0===qa.length&&(this._typeComponentsIndices.splice(qS,1),this._componentsMap.splice(qS,1));for(var qV=0,qW=this._componentsMap.length;qV<qW;qV++)for(var qk=(qa=this._typeComponentsIndices[qV]).length-1;0<=qk;qk--){var qz=qa[qk];if(!(qR<qz))break;qa[qk]=--qz}qJ._destroy()},qa.getComponentByType=function(qS,q_){void 0===q_&&(q_=0);var qa=this._componentsMap.indexOf(qS);return-1===qa?null:this._components[this._typeComponentsIndices[qa][q_]]},qa.getComponentsByType=function(qS,q_){var qa=this._componentsMap.indexOf(qS);if(-1!==qa){var qR=this._typeComponentsIndices[qa],qJ=qR.length;q_.length=qJ;for(var qV=0;qV<qJ;qV++)q_[qV]=this._components[qR[qV]]}else q_.length=0},qa.getComponentByIndex=function(qS){return this._components[qS]},qa.removeComponentByType=function(qS,q_){void 0===q_&&(q_=0);var qa=this._componentsMap.indexOf(qS);-1!==qa&&this._removeComponent(qa,q_)},qa.removeComponentsByType=function(qS){var q_=this._componentsMap.indexOf(qS);if(-1!==q_)for(var qa=this._typeComponentsIndices[q_],qR=0,qJ=qa.length;qR<qJ;qa.length<qJ?qJ--:qR++)this._removeComponent(q_,qR)},qa.removeAllComponent=function(){for(var qS=0,q_=this._componentsMap.length;qS<q_;this._componentsMap.length<q_?q_--:qS++)this.removeComponentsByType(this._componentsMap[qS])},qa._updateComponents=function(qS){for(var q_=0,qa=this._components.length;q_<qa;q_++){var qR=this._components[q_];!qR.started&&(qR._start(qS),qR.started=!0),qR.enable&&qR._update(qS)}},qa._lateUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._lateUpdate(qS)}},qa._preRenderUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._preRenderUpdate(qS)}},qa._postRenderUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._postRenderUpdate(qS)}},q_}(),qI_=function(qR){function qS(){qS.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new qC_,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new qk_(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}qG(qS,"laya.d3.core.material.BaseMaterial",qR);var q_=qS.prototype;return qQ.imps(q_,{"laya.d3.core.IClone":!0}),q_._addShaderDefine=function(qS){this._shaderDefineValue|=qS},q_._removeShaderDefine=function(qS){this._shaderDefineValue&=~qS},q_._addDisablePublicShaderDefine=function(qS){this._disablePublicShaderDefine|=qS},q_._removeDisablePublicShaderDefine=function(qS){this._disablePublicShaderDefine&=~qS},q_._setBuffer=function(qS,q_){this._shaderValues.setValue(qS,q_),this._values[qS]=q_},q_._getBuffer=function(qS){return this._values[qS]},q_._setMatrix4x4=function(qS,q_){this._shaderValues.setValue(qS,q_?q_.elements:null),this._values[qS]=q_},q_._getMatrix4x4=function(qS){return this._values[qS]},q_._setInt=function(qS,q_){this._shaderValues.setValue(qS,q_),this._values[qS]=q_},q_._getInt=function(qS){return this._values[qS]},q_._setNumber=function(qS,q_){this._shaderValues.setValue(qS,q_),this._values[qS]=q_},q_._getNumber=function(qS){return this._values[qS]},q_._setBool=function(qS,q_){this._shaderValues.setValue(qS,q_),this._values[qS]=q_},q_._getBool=function(qS){return this._values[qS]},q_._setVector2=function(qS,q_){this._shaderValues.setValue(qS,q_?q_.elements:null),this._values[qS]=q_},q_._getVector2=function(qS){return this._values[qS]},q_._setColor=function(qS,q_){this._shaderValues.setValue(qS,q_?q_.elements:null),this._values[qS]=q_},q_._getColor=function(qS){return this._values[qS]},q_._setTexture=function(qS,q_){var qa=this._values[qS];this._values[qS]=q_,this._shaderValues.setValue(qS,q_),0<this.referenceCount&&(qa&&qa._removeReference(),q_&&q_._addReference())},q_._getTexture=function(qS){return this._values[qS]},q_._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},q_._getShader=function(qS,q_,qa){var qR=(qS|q_)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(qR,qa,this._shaderDefineValue),this._shader},q_._setRenderStateBlendDepth=function(){var qS=qA.mainContext;switch(qX.setDepthMask(qS,this.depthWrite),0===this.depthTest?qX.setDepthTest(qS,!1):(qX.setDepthTest(qS,!0),qX.setDepthFunc(qS,this.depthTest)),this.blend){case 0:qX.setBlend(qS,!1);break;case 1:qX.setBlend(qS,!0),qX.setBlendFunc(qS,this.srcBlend,this.dstBlend);break;case 2:qX.setBlend(qS,!0)}},q_._setRenderStateFrontFace=function(qS,q_){var qa=qA.mainContext,qR=0;switch(this.cull){case 0:qX.setCullFace(qa,!1);break;case 1:qX.setCullFace(qa,!0),qR=qS?q_&&q_._isFrontFaceInvert?2305:2304:q_&&q_._isFrontFaceInvert?2304:2305,qX.setFrontFace(qa,qR);break;case 2:qX.setCullFace(qa,!0),qR=qS?q_&&q_._isFrontFaceInvert?2304:2305:q_&&q_._isFrontFaceInvert?2305:2304,qX.setFrontFace(qa,qR)}},q_.onAsynLoaded=function(qS,q_,qa){var qR=q_[0],qJ=q_[1];switch(qR.version){case"LAYAMATERIAL:01":var qV=0,qW=0,qk=qR.props;for(var qz in qk)switch(qz){case"vectors":var qb=qk[qz];for(qV=0,qW=qb.length;qV<qW;qV++){var qH=qb[qV],qL=qH.value;switch(qL.length){case 2:this[qH.name]=new qV_(qL[0],qL[1]);break;case 3:this[qH.name]=new qW_(qL[0],qL[1],qL[2]);break;case 4:this[qH.name]=new qk_(qL[0],qL[1],qL[2],qL[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var qC=qk[qz];for(qV=0,qW=qC.length;qV<qW;qV++){var qG=qC[qV],qt=qG.path;qt&&(this[qG.name]=qF.getRes(qJ[qt]))}break;case"defines":var qo=qk[qz];for(qV=0,qW=qo.length;qV<qW;qV++){var q$=this._shaderCompile.getMaterialDefineByName(qo[qV]);this._addShaderDefine(q$)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[qz]=qk[qz];break;case"renderQueue":switch(qk[qz]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[qz]=qk[qz]}break;case"LAYAMATERIAL:02":for(qz in qk=qR.props)switch(qz){case"vectors":for(qV=0,qW=(qb=qk[qz]).length;qV<qW;qV++)switch((qL=(qH=qb[qV]).value).length){case 2:this[qH.name]=new qV_(qL[0],qL[1]);break;case 3:this[qH.name]=new qW_(qL[0],qL[1],qL[2]);break;case 4:this[qH.name]=new qk_(qL[0],qL[1],qL[2],qL[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(qV=0,qW=(qC=qk[qz]).length;qV<qW;qV++)(qt=(qG=qC[qV]).path)&&(this[qG.name]=qF.getRes(qJ[qt]));break;case"defines":for(qV=0,qW=(qo=qk[qz]).length;qV<qW;qV++)q$=this._shaderCompile.getMaterialDefineByName(qo[qV]),this._addShaderDefine(q$);break;default:this[qz]=qk[qz]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},q_._addReference=function(){qR.prototype._addReference.call(this);for(var qS=0,q_=this._values.length;qS<q_;qS++){var qa=this._values[qS];qa&&qa instanceof laya.d3.resource.BaseTexture&&qa._addReference()}},q_._removeReference=function(){qR.prototype._removeReference.call(this);for(var qS=0,q_=this._values.length;qS<q_;qS++){var qa=this._values[qS];qa&&qa instanceof laya.d3.resource.BaseTexture&&qa._removeReference()}},q_.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},q_.setShaderName=function(qS){var q_=qM_.nameKey.getID(qS);if(-1===q_)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=qN_._preCompileShader[q_]},q_.cloneTo=function(qS){var q_=qS;q_.name=this.name,q_.cull=this.cull,q_.blend=this.blend,q_.srcBlend=this.srcBlend,q_.dstBlend=this.dstBlend,q_.srcBlendRGB=this.srcBlendRGB,q_.dstBlendRGB=this.dstBlendRGB,q_.srcBlendAlpha=this.srcBlendAlpha,q_.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(q_.blendConstColor),q_.blendEquation=this.blendEquation,q_.blendEquationRGB=this.blendEquationRGB,q_.blendEquationAlpha=this.blendEquationAlpha,q_.depthTest=this.depthTest,q_.depthWrite=this.depthWrite,q_.renderQueue=this.renderQueue,q_._shader=this._shader,q_._disablePublicShaderDefine=this._disablePublicShaderDefine,q_._shaderDefineValue=this._shaderDefineValue;var qa,qR=0,qJ=q_._shaderValues;q_._shaderValues.data.length=this._shaderValues.data.length;var qV=this._values.length,qW=q_._values;for(qR=0,qa=qW.length=qV;qR<qa;qR++){var qk=this._values[qR];if(qk)if("number"==typeof qk)qW[qR]=qk,qJ.data[qR]=qk;else if("number"==typeof qk&&Math.floor(qk)==qk)qW[qR]=qk,qJ.data[qR]=qk;else if("boolean"==typeof qk)qW[qR]=qk,qJ.data[qR]=qk;else if(qk instanceof laya.d3.math.Vector2){var qz=qW[qR]||(qW[qR]=new qV_);qk.cloneTo(qz),qJ.data[qR]=qz.elements}else if(qk instanceof laya.d3.math.Vector3){var qb=qW[qR]||(qW[qR]=new qW_);qk.cloneTo(qb),qJ.data[qR]=qb.elements}else if(qk instanceof laya.d3.math.Vector4){var qH=qW[qR]||(qW[qR]=new qk_);qk.cloneTo(qH),qJ.data[qR]=qH.elements}else if(qk instanceof laya.d3.math.Matrix4x4){var qL=qW[qR]||(qW[qR]=new qS_);qk.cloneTo(qL),qJ.data[qR]=qL.elements}else qk instanceof laya.d3.resource.BaseTexture&&(qW[qR]=qk,qJ.data[qR]=qk)}},q_.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qt(0,q_,"alphaTestValue",function(){return this._getNumber(0)},function(qS){this._setNumber(0,qS)}),qt(0,q_,"alphaTest",function(){return this._alphaTest},function(qS){(this._alphaTest=qS)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),qS.__init__=function(){qS.SHADERDEFINE_ALPHATEST=qS.shaderDefines.registerDefine("ALPHATEST")},qS.RENDERQUEUE_OPAQUE=2e3,qS.RENDERQUEUE_ALPHATEST=2450,qS.RENDERQUEUE_TRANSPARENT=3e3,qS.CULL_NONE=0,qS.CULL_FRONT=1,qS.CULL_BACK=2,qS.BLEND_DISABLE=0,qS.BLEND_ENABLE_ALL=1,qS.BLEND_ENABLE_SEPERATE=2,qS.BLENDPARAM_ZERO=0,qS.BLENDPARAM_ONE=1,qS.BLENDPARAM_SRC_COLOR=768,qS.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,qS.BLENDPARAM_DST_COLOR=774,qS.BLENDPARAM_ONE_MINUS_DST_COLOR=775,qS.BLENDPARAM_SRC_ALPHA=770,qS.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,qS.BLENDPARAM_DST_ALPHA=772,qS.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,qS.BLENDPARAM_SRC_ALPHA_SATURATE=776,qS.BLENDEQUATION_ADD=0,qS.BLENDEQUATION_SUBTRACT=1,qS.BLENDEQUATION_REVERSE_SUBTRACT=2,qS.DEPTHTEST_OFF=0,qS.DEPTHTEST_NEVER=512,qS.DEPTHTEST_LESS=513,qS.DEPTHTEST_EQUAL=514,qS.DEPTHTEST_LEQUAL=515,qS.DEPTHTEST_GREATER=516,qS.DEPTHTEST_NOTEQUAL=517,qS.DEPTHTEST_GEQUAL=518,qS.DEPTHTEST_ALWAYS=519,qS.SHADERDEFINE_ALPHATEST=1,qS.ALPHATESTVALUE=0,qL(qS,["shaderDefines",function(){return this.shaderDefines=new qH_}]),qS}(q$),qA_=function(qS){function q_(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,q_.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}qG(q_,"laya.d3.resource.BaseTexture",q$);var qa=q_.prototype;return qt(0,qa,"width",function(){return this._width}),qt(0,qa,"repeat",function(){return this._repeat},function(qS){if(this._repeat!==qS&&(this._repeat=qS,this._source)){var q_=qA.mainContext;qX.bindTexture(q_,this._type,this._source),qj.isPOT(this._width,this._height)&&this._repeat?(q_.texParameteri(this._type,10242,10497),q_.texParameteri(this._type,10243,10497)):(q_.texParameteri(this._type,10242,33071),q_.texParameteri(this._type,10243,33071))}}),qt(0,qa,"height",function(){return this._height}),qt(0,qa,"magFifter",function(){return this._magFifter},function(qS){(this._magFifter=qS)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(qS)}),qt(0,qa,"wrapModeV",function(){return this._wrapModeV}),qt(0,qa,"size",function(){return this._size}),qt(0,qa,"wrapModeU",function(){return this._wrapModeU}),qt(0,qa,"mipmap",function(){return this._mipmap},function(qS){this._mipmap=qS,this._mipmap!=qS&&this._conchTexture&&this._conchTexture.setMipMap(qS)}),qt(0,qa,"minFifter",function(){return this._minFifter},function(qS){this._minFifter=qS,this._minFifter!=qS&&this._conchTexture&&this._conchTexture.setMinFifter(qS)}),qt(0,qa,"format",function(){return this._format}),qt(0,qa,"source",function(){return this.activeResource(),this._source}),qt(0,qa,"defaulteTexture",function(){return qf_.grayTexture}),q_.WARPMODE_REPEAT=0,q_.WARPMODE_CLAMP=1,q_}(),qX_=function(qS){function q_(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,q_.__super.call(this),this._boundingBoxCorners=qR(8,null)}qG(q_,"laya.d3.resource.models.BaseMesh",q$);var qa=q_.prototype;return qa._getPositions=function(){throw new Error("未Override,请重载该属性！")},qa._generateBoundingObject=function(){this._boundingSphere=new qwS(new qW_,0),qwS.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new qES(new qW_,new qW_),qES.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},qa.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},qa.getRenderElement=function(qS){throw new Error("未Override,请重载该属性！")},qt(0,qa,"subMeshCount",function(){return this._subMeshCount}),qt(0,qa,"boundingBox",function(){return this._boundingBox}),qt(0,qa,"boundingBoxCorners",function(){return this._boundingBoxCorners}),qt(0,qa,"boundingSphere",function(){return this._boundingSphere}),q_}(),qh_=(function(qS){function q_(){q_.__super.call(this)}qG(q_,"laya.d3.component.Script",qD_);var qa=q_.prototype;qa.onTriggerEnter=function(qS){},qa.onTriggerExit=function(qS){},qa.onTriggerStay=function(qS){},qt(0,qa,"isSingleton",function(){return q_._isSingleton}),q_._isSingleton=!1}(),function(qS){function q_(qS){this._owner=null,this._sharedMesh=null,q_.__super.call(this),this._owner=qS}qG(q_,"laya.d3.core.MeshFilter",qS);var qa=q_.prototype;return qa._sharedMeshLoaded=function(){this.event("loaded")},qa._destroy=function(){qS.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},qt(0,qa,"sharedMesh",function(){return this._sharedMesh},function(qS){var q_=this._sharedMesh;q_&&q_._removeReference(),(this._sharedMesh=qS)._addReference(),this.event("meshchanged",[this,q_,qS]),qS.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),qt(0,qa,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),qt(0,qa,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),qt(0,qa,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),qt(0,qa,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),q_}(qj_)),qu_=function(qS){function q_(qS){q_.__super.call(this,qS),qS.meshFilter.on("meshchanged",this,this._onMeshChanged)}qG(q_,"laya.d3.core.MeshRender",qQ_);var qa=q_.prototype;return qa._onMeshChanged=function(qS,q_,qa){qa.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:qa.once("loaded",this,this._onMeshLoaed)},qa._onMeshLoaed=function(qS,q_){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},qa._calculateBoundingSphereByInitSphere=function(qS){var q_=NaN,qa=this._owner.transform,qR=qa.scale.elements,qJ=Math.abs(qR[0]),qV=Math.abs(qR[1]),qW=Math.abs(qR[2]);q_=qV<=qJ&&qW<=qJ?qJ:qW<=qV?qV:qW,qW_.transformCoordinate(qS.center,qa.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=qS.radius*q_},qa._calculateBoundBoxByInitCorners=function(qS){for(var q_=this._owner.transform.worldMatrix,qa=0;qa<8;qa++)qW_.transformCoordinate(qS[qa],q_,qQ_._tempBoundBoxCorners[qa]);qES.createfromPoints(qQ_._tempBoundBoxCorners,this._boundingBox)},qa._calculateBoundingSphere=function(){var qS=this._owner.meshFilter.sharedMesh;null==qS||null==qS.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(qS.boundingSphere)},qa._calculateBoundingBox=function(){var qS=this._owner.meshFilter.sharedMesh;null==qS||null==qS.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(qS.boundingBoxCorners)},qa._renderUpdate=function(qS){var q_=this._owner.transform;if(q_){this._setShaderValueMatrix4x4(0,q_.worldMatrix);var qa=this._owner.getProjectionViewWorldMatrix(qS);this._setShaderValueMatrix4x4(1,qa)}else this._setShaderValueMatrix4x4(0,qS_.DEFAULT),this._setShaderValueMatrix4x4(1,qS);return qF_.debugMode&&this._renderRenderableBoundBox(),!0},q_}(),qK_=function(q_){function qR(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,qR.__super.call(this),this._renderState=new qy,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new qC_,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new q_S,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new qW_(.7,.7,.7),this.ambientColor=new qW_(.212,.227,.259),qA.shaderHighPrecision&&this.addShaderDefine(qN_.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}qG(qR,"laya.d3.core.scene.Scene",q_);var qS=qR.prototype;return qQ.imps(qS,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),qS._setUrl=function(qS){this._url=qS},qS._getGroup=function(){return this._group},qS._setGroup=function(qS){this._group=qS},qS._display=function(){qQ.stage._scenes.push(this),qQ.stage._scenes.sort(qR._sortScenes);for(var qS=0,q_=this._childs.length;qS<q_;qS++){var qa=this._childs[qS];qa.active&&qa._activeHierarchy()}},qS._unDisplay=function(){var qS=qQ.stage._scenes;qS.splice(qS.indexOf(this),1);for(var q_=0,qa=this._childs.length;q_<qa;q_++){var qR=this._childs[q_];qR.active&&qR._inActiveHierarchy()}},qS._addChild3D=function(qS){qS.transform._onWorldTransform(),qS._setBelongScene(this),this.displayedInStage&&qS.active&&qS._activeHierarchy()},qS._removeChild3D=function(qS){qS.transform.parent=null,this.displayedInStage&&qS.active&&qS._inActiveHierarchy(),qS._setUnBelongScene()},qS.initOctree=function(qS,q_,qa,qR,qJ){void 0===qJ&&(qJ=6),this.treeSize=new qW_(qS,q_,qa),this.treeLevel=qJ,this.treeRoot=new qE(this,0),this.treeRoot.init(qR,this.treeSize)},qS._prepareUpdateToRenderState=function(qS,q_){q_.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,q_.scene=this},qS._prepareSceneToRender=function(qS){var q_=this._lights.length;if(0<q_)for(var qa=0,qR=0;qR<q_&&!(this._lights[qR]._prepareToScene(qS)&&++qa>=this._enableLightCount);qR++);},qS._updateChilds=function(qS){for(var q_=0,qa=this._childs.length;q_<qa;++q_)this._childs[q_]._update(qS)},qS._preRenderScene=function(qS,q_,qa){var qR,qJ=q_._viewMatrix,qV=q_._projectionMatrix,qW=q_._projectionViewMatrix,qk=0,qz=q_.camera;for(qz.useOcclusionCulling?this.treeRoot?qaS.renderObjectCullingOctree(qa,this,qz,qJ,qV,qW):qaS.renderObjectCulling(qa,this,qz,qJ,qV,qW):qaS.renderObjectCullingNoBoundFrustum(this,qz,qJ,qV,qW),qk=0,qR=this._quenes.length;qk<qR;qk++)this._quenes[qk]&&this._quenes[qk]._preRender(q_)},qS._clear=function(qS,q_){var qa=q_._viewport,qR=q_.camera,qJ=qa.x,qV=qR.renderTargetSize.height-qa.y-qa.height,qW=qa.width,qk=qa.height;qS.viewport(qJ,qV,qW,qk);var qz=256,qb=qR.renderTarget;switch(qR.clearFlag){case 0:var qH=qR.clearColor;if(qH){qS.enable(3089),qS.scissor(qJ,qV,qW,qk);var qL=qH.elements;qS.clearColor(qL[0],qL[1],qL[2],qL[3]),qz|=16384}if(qb)switch(qH||(qz=16384),qb.depthStencilFormat){case 33189:qz|=256;break;case 36168:qz|=1024;break;case 34041:qz|=256,qz|=1024}qS.clear(qz),qH&&qS.disable(3089);break;case 1:case 2:if(qb)switch(qz=16384,qb.depthStencilFormat){case 33189:qz|=256;break;case 36168:qz|=1024;break;case 34041:qz|=256,qz|=1024}qS.clear(qz);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},qS._renderScene=function(qS,q_){var qa,qR,qJ=q_.camera,qV=0;for(qV=0;qV<2;qV++)(qR=this._quenes[qV])&&(qJ.renderTarget?qR._render(q_,!0):qR._render(q_,!1));if(1===qJ.clearFlag){var qW=qJ.sky;qW&&(qX.setCullFace(qS,!1),qX.setDepthFunc(qS,515),qX.setDepthMask(qS,!1),qW._render(q_),qX.setDepthFunc(qS,513),qX.setDepthMask(qS,!0))}for(qV=2,qa=this._quenes.length;qV<qa;qV++)(qR=this._quenes[qV])&&(qR._sortAlpha(q_.camera.transform.position),qJ.renderTarget?qR._render(q_,!0):qR._render(q_,!1))},qS._set3DRenderConfig=function(qS){qS.disable(3042),qX._blend=!1,qS.blendFunc(770,771),qX._sFactor=770,qX._dFactor=771,qS.disable(2929),qX._depthTest=!1,qS.enable(2884),qX._cullFace=!0,qS.depthMask(1),qX._depthMask=!0,qS.frontFace(2304),qX._frontFace=2304},qS._set2DRenderConfig=function(qS){qX.setBlend(qS,!0),qX.setBlendFunc(qS,1,771),qX.setDepthTest(qS,!1),qX.setCullFace(qS,!1),qX.setDepthMask(qS,!0),qX.setFrontFace(qS,2305),qS.viewport(0,0,qH.width,qH.height)},qS._parseCustomProps=function(qS,q_,qa,qR){var qJ=qR.customProps.lightmaps,qV=qJ.length,qW=this._lightmaps;qW.length=qV;for(var qk=0;qk<qV;qk++)qW[qk]=qF.getRes(q_[qJ[qk].replace(".exr",".png")]);this.setlightmaps(qW);var qz=qR.customProps.ambientColor;qz&&(this.ambientColor=new qW_(qz[0],qz[1],qz[2]));var qb=qR.customProps.fogColor;qb&&(this.fogColor=new qW_(qb[0],qb[1],qb[2]))},qS._addLight=function(qS){this._lights.indexOf(qS)<0&&this._lights.push(qS)},qS._removeLight=function(qS){var q_=this._lights.indexOf(qS);0<=q_&&this._lights.splice(q_,1)},qS._updateScene=function(){var qS=this._renderState;this._prepareUpdateToRenderState(qA.mainContext,qS),this._updateComponents(qS),this._updateChilds(qS),this._lateUpdateComponents(qS),this._time+=qS.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},qS._updateSceneConch=function(){var qS=this._renderState;this._prepareUpdateToRenderState(qA.mainContext,qS),this._updateComponents(qS),this._lateUpdateComponents(qS),this._prepareSceneToRender(qS);for(var q_=0,qa=this._cameraPool.length;q_<qa;q_++){var qR=this._cameraPool[q_];(qS.camera=qR)._prepareCameraToRender()}},qS._preRenderShadow=function(qS,q_,qa,qR,qJ){this.treeRoot?qaS.renderShadowObjectCullingOctree(this,q_,qa,qR,qJ):qaS.renderShadowObjectCulling(this,q_,qa,qR,qJ);for(var qV=0,qW=qa.length;qV<qW;qV++)qa[qV]&&qa[qV]._preRender(qS)},qS._renderShadowMap=function(qS,q_,qa){var qR=this.parallelSplitShadowMaps[0];qR._calcAllLightCameraInfo(qa);var qJ,qV,qW,qk=qR.PSSMNum;if(this._preRenderShadow(q_,qR._lightCulling,qR._shadowQuenes,qR._lightVPMatrix[0],qk),this.addShaderDefine(qG_.SHADERDEFINE_CAST_SHADOW),1<qk)for(var qz=0;qz<qk;qz++)qJ=qR.getRenderTarget(qz+1),qR.beginRenderTarget(qz+1),qS.clearColor(1,1,1,1),qS.clear(16640),qS.viewport(0,0,qJ.width,qJ.height),q_.camera=qW=qR.getLightCamera(qz),qW._prepareCameraToRender(),qW._prepareCameraViewProject(qW.viewMatrix,qW.projectionMatrix),q_._projectionViewMatrix=qR._lightVPMatrix[qz+1],(qV=qR._shadowQuenes[qz])._preRender(q_),qV._renderShadow(q_,!1),qR.endRenderTarget(qz+1);else qJ=qR.getRenderTarget(1),qR.beginRenderTarget(1),qS.clearColor(1,1,1,1),qS.clear(16640),qS.viewport(0,0,qJ.width,qJ.height),q_.camera=qW=qR.getLightCamera(0),qW._prepareCameraToRender(),qW._prepareCameraViewProject(qW.viewMatrix,qW.projectionMatrix),q_._projectionViewMatrix=qR._lightVPMatrix[0],(qV=qR._shadowQuenes[0])._preRender(q_),qV._renderShadow(q_,!0),qR.endRenderTarget(1);this.removeShaderDefine(qG_.SHADERDEFINE_CAST_SHADOW)},qS.addTreeNode=function(qS){this.treeRoot.addTreeNode(qS)},qS.removeTreeNode=function(qS){this.treeSize&&qS._treeNode&&qS._treeNode.removeObject(qS)},qS.setlightmaps=function(qS){this._lightmaps=qS;for(var q_=0,qa=this._renderableSprite3Ds.length;q_<qa;q_++)this._renderableSprite3Ds[q_]._render._applyLightMapParams()},qS.getlightmaps=function(){return this._lightmaps},qS.addChildAt=function(qS,q_){if(!(qS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(qS&&qS.__className));if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),0<=q_&&q_<=this._childs.length){if(qS._parent===this){var qa=this.getChildIndex(qS);this._childs.splice(qa,1),this._childs.splice(q_,0,qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,q_)),this._childChanged()}else qS.parent&&qS.parent.removeChild(qS),this._childs===qb.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(q_,0,qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,q_),(qS.parent=this)._addChild3D(qS);return qS}throw new Error("appendChildAt:The index is out of bounds")},qS.addChild=function(qS){if(!(qS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),qS._parent===this){var q_=this.getChildIndex(qS);q_!==this._childs.length-1&&(this._childs.splice(q_,1),this._childs.push(qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,this._childs.length-1)),this._childChanged())}else qS.parent&&qS.parent.removeChild(qS),this._childs===qb.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,this._childs.length-1),(qS.parent=this)._childChanged(),this._addChild3D(qS);return qS},qS.removeChildAt=function(qS){var q_=this.getChildAt(qS);return q_&&(this._removeChild3D(q_),this._childs.splice(qS,1),this.conchModel&&this.conchModel.removeChild(q_.conchModel),q_.parent=null),q_},qS.removeChildren=function(qS,q_){if(void 0===qS&&(qS=0),void 0===q_&&(q_=2147483647),this._childs&&0<this._childs.length){var qa=this._childs;if(0===qS&&qV<=q_){var qR=qa;this._childs=qb.ARRAY_EMPTY}else qR=qa.splice(qS,q_-qS);for(var qJ=0,qV=qR.length;qJ<qV;qJ++)this._removeChild3D(qR[qJ]),qR[qJ].parent=null,this.conchModel&&this.conchModel.removeChild(qR[qJ].conchModel)}return this},qS.addFrustumCullingObject=function(qS){this.treeRoot?this.addTreeNode(qS):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(qS):this._cullingRenders[this._cullingRendersLength]=qS,qS._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},qS.removeFrustumCullingObject=function(qS){if(this.treeRoot)this.removeTreeNode(qS);else{this._cullingRendersLength--;var q_=qS._indexInSceneFrustumCullingObjects;if(q_!==this._cullingRendersLength){var qa=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[q_]=qa)._indexInSceneFrustumCullingObjects=q_,qS._indexInSceneFrustumCullingObjects=-1}}},qS.getRenderQueue=function(qS){return qS<3e3?this._quenes[1]||(this._quenes[1]=new qc(this)):this._quenes[2]||(this._quenes[2]=new qc(this))},qS.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new qc(this)},qS.addShaderDefine=function(qS){this._shaderDefineValue|=qS},qS.removeShaderDefine=function(qS){this._shaderDefineValue&=~qS},qS.addScript=function(qS){return this._addComponent(qS)},qS.getScriptByType=function(qS,q_){return void 0===q_&&(q_=0),this._getComponentByType(qS,q_)},qS.getScriptsByType=function(qS,q_){this._getComponentsByType(qS,q_)},qS.getScriptByIndex=function(qS){return this._getComponentByIndex(qS)},qS.removeScriptByType=function(qS,q_){void 0===q_&&(q_=0),this._removeComponentByType(qS,q_)},qS.removeScriptsByType=function(qS){this._removeComponentByType(qS)},qS.removeAllScript=function(){this._removeAllComponent()},qS.render=function(qS,q_,qa){(qo._context.ctx._renderKey=0)<this._childs.length&&qS.addRenderObject(this)},qS.renderSubmit=function(){var qS=qA.mainContext,q_=this._renderState;this._set3DRenderConfig(qS),this._prepareSceneToRender(this._renderState);var qa,qR=0,qJ=0;if(qF_.debugMode||qE.debugMode)for(qR=0,qJ=this._cameraPool.length;qR<qJ;qR++)qa=this._cameraPool[qR],qF_._debugPhasorSprite.begin(1,qa),qa.activeInHierarchy&&qa._renderCamera(qS,q_,this),qF_._debugPhasorSprite.end();else for(qR=0,qJ=this._cameraPool.length;qR<qJ;qR++)(qa=this._cameraPool[qR]).activeInHierarchy&&qa._renderCamera(qS,q_,this);return this._set2DRenderConfig(qS),1},qS.onAsynLoaded=function(qS,q_,qa){var qR=q_[0];if("Scene"!==qR.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var qJ=q_[1];q$_._createNodeByJson(this,qR,this,qJ),this.event("hierarchyloaded",[this]),this.__loaded=!0},qS.destroy=function(qS){void 0===qS&&(qS=!0),this.destroyed||(q_.prototype.destroy.call(this,qS),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,qF.clearRes(this.url),this.loaded||qF_._cancelLoadByUrl(this.url))},qS.getRenderType=function(){return 0},qS.releaseRender=function(){},qS._addComponent=function(qS){var q_,qa=this._componentsMap.indexOf(qS);if(-1===qa)q_=[],this._componentsMap.push(qS),this._typeComponentsIndices.push(q_);else if(q_=this._typeComponentsIndices[qa],this._components[q_[0]].isSingleton)throw new Error("无法单实例创建"+qS+"组件，"+qS+"组件已存在！");var qR=qJ.getInstance(qS);q_.push(this._components.length),this._components.push(qR);return qR._initialize(this),qR},qS._removeComponent=function(qS,q_){var qa=this._typeComponentsIndices[qS],qR=qa[q_],qJ=this._components[qR];this._components.splice(qR,1),qa.splice(q_,1),0===qa.length&&(this._typeComponentsIndices.splice(qS,1),this._componentsMap.splice(qS,1));for(var qV=0,qW=this._componentsMap.length;qV<qW;qV++)for(var qk=(qa=this._typeComponentsIndices[qV]).length-1;0<=qk;qk--){var qz=qa[qk];if(!(qR<qz))break;qa[qk]=--qz}qJ._destroy()},qS._getComponentByType=function(qS,q_){void 0===q_&&(q_=0);var qa=this._componentsMap.indexOf(qS);return-1===qa?null:this._components[this._typeComponentsIndices[qa][q_]]},qS._getComponentsByType=function(qS,q_){var qa=this._componentsMap.indexOf(qS);if(-1!==qa){var qR=this._typeComponentsIndices[qa],qJ=qR.length;q_.length=qJ;for(var qV=0;qV<qJ;qV++)q_[qV]=this._components[qR[qV]]}else q_.length=0},qS._getComponentByIndex=function(qS){return this._components[qS]},qS._removeComponentByType=function(qS,q_){void 0===q_&&(q_=0);var qa=this._componentsMap.indexOf(qS);-1!==qa&&this._removeComponent(qa,q_)},qS._removeComponentsByType=function(qS){var q_=this._componentsMap.indexOf(qS);if(-1!==q_)for(var qa=this._typeComponentsIndices[q_],qR=0,qJ=qa.length;qR<qJ;qa.length<qJ?qJ--:qR++)this._removeComponent(q_,qR)},qS._removeAllComponent=function(){for(var qS=0,q_=this._componentsMap.length;qS<q_;this._componentsMap.length<q_?q_--:qS++)this._removeComponentsByType(this._componentsMap[qS])},qS._updateComponents=function(qS){for(var q_=0,qa=this._components.length;q_<qa;q_++){var qR=this._components[q_];!qR.started&&(qR._start(qS),qR.started=!0),qR.enable&&qR._update(qS)}},qS._lateUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._lateUpdate(qS)}},qS._preRenderUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._preRenderUpdate(qS)}},qS._postRenderUpdateComponents=function(qS){for(var q_=0;q_<this._components.length;q_++){var qa=this._components[q_];!qa.started&&(qa._start(qS),qa.started=!0),qa.enable&&qa._postRenderUpdate(qS)}},qt(0,qS,"_loaded",null,function(qS){this.__loaded=qS}),qt(0,qS,"fogColor",function(){return this._fogColor},function(qS){this._fogColor=qS,this._shaderValues.setValue(0,qS.elements)}),qt(0,qS,"enableFog",function(){return this._enableFog},function(qS){this._enableFog!==qS&&((this._enableFog=qS)?(this.addShaderDefine(qN_.SHADERDEFINE_FOG),this.removeShaderDefine(qN_.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(qN_.SHADERDEFINE_FOG))}),qt(0,qS,"url",function(){return this._url}),qt(0,qS,"loaded",function(){return this.__loaded}),qt(0,qS,"enableDepthFog",function(){return this._enableDepthFog},function(qS){this._enableDepthFog!=qS&&((this._enableDepthFog=qS)?(this.addShaderDefine(qN_.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(qN_.SHADERDEFINE_FOG)):this.removeShaderDefine(qN_.SAHDERDEFINE_DEPTHFOG))}),qt(0,qS,"fogStart",function(){return this._fogStart},function(qS){this._fogStart=qS,this._shaderValues.setValue(1,qS)}),qt(0,qS,"fogRange",function(){return this._fogRange},function(qS){this._fogRange=qS,this._shaderValues.setValue(2,qS)}),qt(0,qS,"ambientColor",function(){return this._ambientColor},function(qS){this._ambientColor=qS,this._shaderValues.setValue(21,qS.elements)}),qt(0,qS,"scene",function(){return this}),qt(0,qS,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),qR._sortScenes=function(qS,q_){if(qS.parent!==qQ.stage||q_.parent!==qQ.stage)return qS.parent!==qQ.stage&&q_.parent!==qQ.stage?qR._sortScenes(qS.parent,q_.parent):qS.parent===qQ.stage?-1:1;var qa=qQ.stage._childs;return qa.indexOf(qS)-qa.indexOf(q_)},qR.load=function(qS){return qQ.loader.create(qS,null,null,qR)},qR.FOGCOLOR=0,qR.FOGSTART=1,qR.FOGRANGE=2,qR.LIGHTDIRECTION=3,qR.LIGHTDIRCOLOR=4,qR.POINTLIGHTPOS=5,qR.POINTLIGHTRANGE=6,qR.POINTLIGHTATTENUATION=7,qR.POINTLIGHTCOLOR=8,qR.SPOTLIGHTPOS=9,qR.SPOTLIGHTDIRECTION=10,qR.SPOTLIGHTSPOT=11,qR.SPOTLIGHTRANGE=12,qR.SPOTLIGHTATTENUATION=13,qR.SPOTLIGHTCOLOR=14,qR.SHADOWDISTANCE=15,qR.SHADOWLIGHTVIEWPROJECT=16,qR.SHADOWMAPPCFOFFSET=17,qR.SHADOWMAPTEXTURE1=18,qR.SHADOWMAPTEXTURE2=19,qR.SHADOWMAPTEXTURE3=20,qR.AMBIENTCOLOR=21,qR.TIME=22,qR}(qq),qP_=function(qS){function q_(qS){q_.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new qS_,this._shaderValues=new qC_,this._colliders=[],this._id=++q_._uniqueIDCounter,this._transform=new qm_(this),this.name=qS||"Sprite3D-"+q_._nameNumberCounter++,this.layer=qu.currentCreationLayer,this.active=!0}qG(q_,"laya.d3.core.Sprite3D",qB_);var qa=q_.prototype;return qQ.imps(qa,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),qa._setUrl=function(qS){this._url=qS},qa._getGroup=function(){return this._group},qa._setGroup=function(qS){this._group=qS},qa._addChild3D=function(qS){qS.transform.parent=this.transform,this._hierarchyAnimator&&(!qS._hierarchyAnimator&&qS._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(qS,!0,[qS.name])),this._scene&&(qS._setBelongScene(this._scene),this._activeInHierarchy&&qS._active&&qS._activeHierarchy())},qa._removeChild3D=function(qS){qS.transform.parent=null,this._scene&&(this._activeInHierarchy&&qS._active&&qS._inActiveHierarchy(),qS._setUnBelongScene()),this._hierarchyAnimator&&(qS._hierarchyAnimator==this._hierarchyAnimator&&qS._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(qS,!1,[qS.name]))},qa._parseBaseCustomProps=function(qS){var q_=this.transform.localPosition;qS.translate?(q_.fromArray(qS.translate),q_.x*=100,q_.y*=100,q_.z*=100):q_.elements.fill(0),this.transform.localPosition=q_;var qa=this.transform.localRotation;qS.rotation?qa.fromArray(qS.rotation):qa.fromArray([0,0,0,-1]),this.transform.localRotation=qa;var qR=this.transform.localScale;qS.scale?qR.fromArray(qS.scale):qR.elements.fill(1),this.transform.localScale=qR;var qJ=qS.layer;null!=qJ&&(this.layer=qu.getLayerByNumber(qJ))},qa._parseCustomComponent=function(qS,q_,qa){for(var qR in qa){var qJ=qa[qR];switch(qR){case"Animator":var qV=this.addComponent(Animator);if(qJ.avatarPath)qV.avatar=qF.getRes(q_[qJ.avatarPath]);else{var qW=qJ.avatar;if(qW){qV.avatar=qF.getRes(q_[qW.path]);var qk=qW.linkSprites;qk&&qS.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[qV,qk])}}for(var qz=qJ.clipPaths,qb=qz.length,qH=0;qH<qb;qH++)qV.addClip(qF.getRes(q_[qz[qH]]));qV.clip=qF.getRes(q_[qz[0]]);var qL=qJ.playOnWake;void 0!==qL&&(qV.playOnWake=qL);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var qC=this.addComponent(SphereCollider);qC.isTrigger=qJ.isTrigger;var qG=qC.center;qG.fromArray(qJ.center),qC.center=qG,qC.radius=qJ.radius;break;case"BoxCollider":var qt=this.addComponent(BoxCollider);qt.isTrigger=qJ.isTrigger,qt.center.fromArray(qJ.center);var qo=qt.size;qo.fromArray(qJ.size),qt.size=qo;break;case"MeshCollider":this.addComponent(MeshCollider)}}},qa._onRootNodeHierarchyLoaded=function(qS,q_){for(var qa in q_){for(var qR=this,qJ=q_[qa],qV=0,qW=qJ.length;qV<qW;qV++){var qk=qJ[qV];if(""===qk)break;if(!(qR=qR.getChildByName(qk)))break}qR&&qS.linkSprite3DToAvatarNode(qa,qR)}},qa._setHierarchyAnimator=function(qS,q_){this._changeHierarchyAnimator(qS);for(var qa=0,qR=this._childs.length;qa<qR;qa++){var qJ=this._childs[qa];qJ._hierarchyAnimator==q_&&qJ._setHierarchyAnimator(qS,q_)}},qa._clearHierarchyAnimator=function(qS,q_){this._changeHierarchyAnimator(q_);for(var qa=0,qR=this._childs.length;qa<qR;qa++){var qJ=this._childs[qa];qJ._hierarchyAnimator==qS&&qJ._clearHierarchyAnimator(qS,q_)}},qa._getAnimatorToLinkSprite3D=function(qS,q_,qa){var qR=this.getComponentByType(Animator);if(qR&&(qR.avatar?qR.avatar._version||qS._setAnimatorToLinkAvatar(qR,q_):qS._setAnimatorToLinkSprite3DNoAvatar(qR,q_,qa)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){qa.unshift(this._parent.name);var qJ=this._parent;qJ._hierarchyAnimator&&qJ._getAnimatorToLinkSprite3D(qS,q_,qa)}},qa._setAnimatorToLinkSprite3DNoAvatar=function(qS,q_,qa){var qR=0,qJ=0;for(qR=0,qJ=qS.getClipCount();qR<qJ;qR++)qS._handleSpriteOwnersBySprite(qR,q_,qa,this);for(qR=0,qJ=this._childs.length;qR<qJ;qR++){var qV=this._childs[qR],qW=qa.length;qa.push(qV.name),qV._setAnimatorToLinkSprite3DNoAvatar(qS,q_,qa),qa.splice(qW,1)}},qa._changeHierarchyAnimator=function(qS){this._hierarchyAnimator=qS},qa._isLinkSpriteToAnimationNode=function(qS,q_,qa){var qR=qS._avatarNodes.indexOf(q_),qJ=qS._cacheSpriteToNodesMap;if(qa)this._transform.dummy=q_.transform,qS._cacheNodesToSpriteMap[qR]=qJ.length,qJ.push(qR);else{this._transform.dummy=null;var qV=qS._cacheNodesToSpriteMap[qR];qS._cacheNodesToSpriteMap[qR]=null,qJ.splice(qV,1)}},qa._setBelongScene=function(qS){this._scene=qS;for(var q_=0,qa=this._childs.length;q_<qa;q_++)this._childs[q_]._setBelongScene(qS)},qa._setUnBelongScene=function(){this._scene=null;for(var qS=0,q_=this._childs.length;qS<q_;qS++)this._childs[qS]._setUnBelongScene()},qa._activeHierarchy=function(){var qS=0,q_=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),qS=0,q_=this._colliders.length;qS<q_;qS++)this._layer._addCollider(this._colliders[qS]);for(this.event("activeinhierarchychanged",!0),qS=0,q_=this._childs.length;qS<q_;qS++){var qa=this._childs[qS];qa._active&&qa._activeHierarchy()}},qa._inActiveHierarchy=function(){var qS=0,q_=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),qS=0,q_=this._colliders.length;qS<q_;qS++){var qa=this._colliders[qS];qa._clearCollsionMap(),this._layer._removeCollider(qa)}for(this.event("activeinhierarchychanged",!1),qS=0,q_=this._childs.length;qS<q_;qS++){var qR=this._childs[qS];qR._active&&qR._inActiveHierarchy()}},qa.addComponent=function(qS){var q_,qa=this._componentsMap.indexOf(qS);if(-1===qa)q_=[],this._componentsMap.push(qS),this._typeComponentsIndices.push(q_);else if(q_=this._typeComponentsIndices[qa],this._components[q_[0]].isSingleton)throw new Error("无法单实例创建"+qS+"组件，"+qS+"组件已存在！");var qR=qJ.getInstance(qS);return q_.push(this._components.length),this._components.push(qR),qR instanceof laya.d3.component.Script&&this._scripts.push(qR),qR._initialize(this),qR},qa._removeComponent=function(qS,q_){var qa,qR=0,qJ=this._typeComponentsIndices[qS],qV=qJ[q_],qW=this._components[qV];for(qW instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(qW),1),qJ.splice(q_,1),0===qJ.length&&(this._typeComponentsIndices.splice(qS,1),this._componentsMap.splice(qS,1)),qR=0,qa=this._componentsMap.length;qR<qa;qR++)for(var qk=(qJ=this._typeComponentsIndices[qR]).length-1;0<=qk;qk--){var qz=qJ[qk];if(!(qV<qz))break;qJ[qk]=--qz}qW._destroy()},qa._clearSelfRenderObjects=function(){},qa._addSelfRenderObjects=function(){},qa._parseCustomProps=function(qS,q_,qa,qR){},qa._updateChilds=function(qS){var q_=this._childs.length;if(0!==q_)for(var qa=0;qa<q_;++qa)this._childs[qa]._update(qS)},qa._getSortID=function(qS,q_){return 1e3*q_.id+qS._getVertexBuffer().vertexDeclaration.id},qa._update=function(qS){(qS.owner=this)._activeInHierarchy&&(this._updateComponents(qS),this._lateUpdateComponents(qS),qN.spriteCount++,this._childs.length&&this._updateChilds(qS))},qa.getProjectionViewWorldMatrix=function(qS){return qS_.multiply(qS,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},qa.loadHierarchy=function(qS){this.addChild(laya.d3.core.Sprite3D.load(qS))},qa.addChildAt=function(qS,q_){if(!(qS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),0<=q_&&q_<=this._childs.length){if(qS._parent===this){var qa=this.getChildIndex(qS);this._childs.splice(qa,1),this._childs.splice(q_,0,qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,q_)),this._childChanged()}else qS.parent&&qS.parent.removeChild(qS),this._childs===qb.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(q_,0,qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,q_),(qS.parent=this)._addChild3D(qS);return qS}throw new Error("appendChildAt:The index is out of bounds")},qa.addChild=function(qS){if(!(qS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!qS||this.destroyed||qS===this)return qS;if(qS.zOrder&&this._set$P("hasZorder",!0),qS._parent===this){var q_=this.getChildIndex(qS);q_!==this._childs.length-1&&(this._childs.splice(q_,1),this._childs.push(qS),this.conchModel&&(this.conchModel.removeChild(qS.conchModel),this.conchModel.addChildAt(qS.conchModel,this._childs.length-1)),this._childChanged())}else qS.parent&&qS.parent.removeChild(qS),this._childs===qb.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(qS),this.conchModel&&this.conchModel.addChildAt(qS.conchModel,this._childs.length-1),(qS.parent=this)._childChanged(),this._addChild3D(qS);return qS},qa.removeChildAt=function(qS){var q_=this.getChildAt(qS);return q_&&(this._removeChild3D(q_),this._childs.splice(qS,1),this.conchModel&&this.conchModel.removeChild(q_.conchModel),q_.parent=null),q_},qa.removeChildren=function(qS,q_){if(void 0===qS&&(qS=0),void 0===q_&&(q_=2147483647),this._childs&&0<this._childs.length){var qa=this._childs;if(0===qS&&qV<=q_){var qR=qa;this._childs=qb.ARRAY_EMPTY}else qR=qa.splice(qS,q_-qS);for(var qJ=0,qV=qR.length;qJ<qV;qJ++)this._removeChild3D(qR[qJ]),qR[qJ].parent=null,this.conchModel&&this.conchModel.removeChild(qR[qJ].conchModel)}return this},qa.onAsynLoaded=function(qS,q_,qa){var qR=q_[0];if("Sprite3D"!==qR.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var qJ=q_[1];q$_._createNodeByJson(this,qR,this,qJ),this.event("hierarchyloaded",[this]),this.__loaded=!0},qa.cloneTo=function(qS){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var q_=qS;q_.name=this.name,q_._destroyed=this._destroyed,q_.timer=this.timer,q_._$P=this._$P,q_.active=this._active;var qa=q_.transform.localPosition;this.transform.localPosition.cloneTo(qa),q_.transform.localPosition=qa;var qR=q_.transform.localRotation;this.transform.localRotation.cloneTo(qR),q_.transform.localRotation=qR;var qJ=q_.transform.localScale;this.transform.localScale.cloneTo(qJ),q_.transform.localScale=qJ,q_.isStatic=this.isStatic;var qV=0,qW=0;for(qV=0,qW=this._componentsMap.length;qV<qW;qV++){var qk=q_.addComponent(this._componentsMap[qV]);this._components[qV]._cloneTo(qk)}for(qV=0,qW=this._childs.length;qV<qW;qV++)q_.addChild(this._childs[qV].clone());var qz=q_.getComponentByType(Animator);if(qz){var qb=qz._linkSpritesData;if(qb)for(var qH in qb){for(var qL=qb[qH],qC=q_,qG=0,qt=qL.length;qG<qt&&(qC=qC.getChildByName(qL[qG]));qG++);if(qC){var qo=qz._avatarNodeMap[qH];qC._isLinkSpriteToAnimationNode(qz,qo,!0)}}}},qa.clone=function(){var qS=new this.constructor;return this.cloneTo(qS),qS},qa.destroy=function(qS){if(void 0===qS&&(qS=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,qS);var q_,qa=0;for(qa=0,q_=this._components.length;qa<q_;qa++)this._components[qa]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,qF.clearRes(this.url),this.loaded||qF_._cancelLoadByUrl(this.url)}},qa._handleSpriteToAvatar=function(qS,q_){qS._avatarNodes;var qa=qS._avatarNodeMap[this.name];qa&&qa.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(qS,qa,q_)},qa._setAnimatorToLinkAvatar=function(qS,q_){this._handleSpriteToAvatar(qS,q_);for(var qa=0,qR=this._childs.length;qa<qR;qa++){this._childs[qa]._setAnimatorToLinkAvatar(qS,q_)}},qt(0,qa,"activeInHierarchy",function(){return this._activeInHierarchy}),qt(0,qa,"_loaded",null,function(qS){this.__loaded=qS}),qt(0,qa,"active",function(){return this._active},function(qS){this._active!==qS&&(this._active=qS,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(qS?this._activeHierarchy():this._inActiveHierarchy()))}),qt(0,qa,"componentsCount",function(){return this._components.length}),qt(0,qa,"loaded",function(){return this.__loaded}),qt(0,qa,"id",function(){return this._id}),qt(0,qa,"url",function(){return this._url}),qt(0,qa,"layer",function(){return this._layer},function(qS){if(this._layer!==qS){if(!qS)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var q_=0,qa=this._colliders.length;if(this._layer)for(q_=0;q_<qa;q_++)this._layer._removeCollider(this._colliders[q_]);for(q_=0;q_<qa;q_++)qS._addCollider(this._colliders[q_])}this._layer=qS,this.event("layerchanged",qS)}}),qt(0,qa,"scene",function(){return this._scene}),qt(0,qa,"transform",function(){return this._transform}),q_.instantiate=function(qS,q_,qa,qR,qJ){void 0===qa&&(qa=!0);var qV=qS.clone();q_&&q_.addChild(qV);var qW=qV.transform;if(qa){var qk=qW.worldMatrix;qS.transform.worldMatrix.cloneTo(qk),qW.worldMatrix=qk}else qR&&(qW.position=qR),qJ&&(qW.rotation=qJ);return qV},q_.load=function(qS){return qQ.loader.create(qS,null,null,q_)},q_.WORLDMATRIX=0,q_.MVPMATRIX=1,q_._uniqueIDCounter=0,q_._nameNumberCounter=0,q_}(),qM_=function(qS){function qH(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],qH.__super.call(this),!qS||!q_)throw"Shader Error";this._id=++qH._count,this._vs=qS,this._ps=q_,this._attributeMap=qa,this._sceneUniformMap=qR,this._cameraUniformMap=qJ,this._spriteUniformMap=qV,this._materialUniformMap=qW,this._renderElementUniformMap=qk,this._precompile=qz,this._define=qb,this._precompile&&qH.extCompileObj&&qH.extCompileFunc?qH.extCompileFunc.call(qH.extCompileObj,qS,q_,qb):this.recreateResource()}qG(qH,"laya.d3.shader.Shader3D",qa);var q_=qH.prototype;return q_.recreateResource=function(){qh.now();this._compile(),this.completeCreate(),this.memorySize=0},q_.disposeResource=function(){qA.mainContext.deleteShader(this._vshader),qA.mainContext.deleteShader(this._pshader),qA.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},q_._compile=function(){if(!qA.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var qS=[this._vs,this._ps],q_=qA.mainContext;if(this._program=q_.createProgram(),this._vshader=qH._createShader(q_,qS[0],35633),this._pshader=qH._createShader(q_,qS[1],35632),q_.attachShader(this._program,this._vshader),q_.attachShader(this._program,this._pshader),q_.linkProgram(this._program),!qo.isConchApp&&qN_.debugMode&&!q_.getProgramParameter(this._program,35714))throw q_.getProgramInfoLog(this._program);var qa,qR=0,qJ=0,qV=0;for(qV=qo.isConchApp?q_.getProgramParameterEx(this._vs,this._ps,"",35721):q_.getProgramParameter(this._program,35721),qR=0;qR<qV;qR++){var qW=null;qa={vartype:"attribute",ivartype:0,attrib:qW=qo.isConchApp?q_.getActiveAttribEx(this._vs,this._ps,"",qR):q_.getActiveAttrib(this._program,qR),location:q_.getAttribLocation(this._program,qW.name),name:qW.name,type:qW.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(qa)}var qk=0;for(qk=qo.isConchApp?q_.getProgramParameterEx(this._vs,this._ps,"",35718):q_.getProgramParameter(this._program,35718),qR=0;qR<qk;qR++){var qz=null;qz=qo.isConchApp?q_.getActiveUniformEx(this._vs,this._ps,"",qR):q_.getActiveUniform(this._program,qR),0<(qa={vartype:"uniform",ivartype:1,attrib:qW,location:q_.getUniformLocation(this._program,qz.name),name:qz.name,type:qz.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(qa.name=qa.name.substr(0,qa.name.length-3),qa.isArray=!0,qa.location=q_.getUniformLocation(this._program,qa.name)),this._uniformParams.push(qa)}for(qR=0,qJ=this._attributeParams.length;qR<qJ;qR++)(qa=this._attributeParams[qR]).indexOfParams=qR,qa.index=1,qa.value=[qa.location,null],qa.codename=qa.name,qa.name=null!=this._attributeMap[qa.codename]?this._attributeMap[qa.codename]:qa.codename,this._attributeParamsMap.push(qa.name),this._attributeParamsMap.push(qa),qa._this=this,qa.uploadedValue=[],qa.fun=this._attribute;for(qR=0,qJ=this._uniformParams.length;qR<qJ;qR++)switch((qa=this._uniformParams[qR]).indexOfParams=qR,qa.index=1,qa.value=[qa.location,null],qa.codename=qa.name,null!=this._sceneUniformMap[qa.codename]?(qa.name=this._sceneUniformMap[qa.codename],this._sceneUniformParamsMap.push(qa.name),this._sceneUniformParamsMap.push(qa)):null!=this._cameraUniformMap[qa.codename]?(qa.name=this._cameraUniformMap[qa.codename],this._cameraUniformParamsMap.push(qa.name),this._cameraUniformParamsMap.push(qa)):null!=this._spriteUniformMap[qa.codename]?(qa.name=this._spriteUniformMap[qa.codename],this._spriteUniformParamsMap.push(qa.name),this._spriteUniformParamsMap.push(qa)):null!=this._materialUniformMap[qa.codename]?(qa.name=this._materialUniformMap[qa.codename],this._materialUniformParamsMap.push(qa.name),this._materialUniformParamsMap.push(qa)):null!=this._renderElementUniformMap[qa.codename]?(qa.name=this._renderElementUniformMap[qa.codename],this._renderElementUniformParamsMap.push(qa.name),this._renderElementUniformParamsMap.push(qa)):console.log("Shader:can't find uinform name:"+qa.codename+" in shader file."),qa._this=this,qa.uploadedValue=[],qa.type){case 5124:qa.fun=qa.isArray?this._uniform1iv:this._uniform1i;break;case 5126:qa.fun=qa.isArray?this._uniform1fv:this._uniform1f;break;case 35664:qa.fun=qa.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:qa.fun=qa.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:qa.fun=qa.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:qa.fun=this._uniform_sampler2D;break;case 35680:qa.fun=this._uniform_samplerCube;break;case 35676:qa.fun=this._uniformMatrix4fv;break;case 35670:qa.fun=this._uniform1i;break;case 35674:qa.fun=this._uinformMatrix2fv;break;case 35675:qa.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},q_._attribute=function(qS,q_){var qa=qA.mainContext,qR=qk._enableAtributes,qJ=qS.location;return qR[qJ]||qa.enableVertexAttribArray(qJ),qa.vertexAttribPointer(qJ,q_[0],q_[1],q_[2],q_[3],q_[4]),qR[qJ]=qk._bindVertexBuffer,1},q_._uniform1f=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_?(qA.mainContext.uniform1f(qS.location,qa[0]=q_),1):0},q_._uniform1fv=function(qS,q_){if(q_.length<4){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qA.mainContext.uniform1fv(qS.location,q_),qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3],1):0}return qA.mainContext.uniform1fv(qS.location,q_),1},q_._uniform_vec2=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]?(qA.mainContext.uniform2f(qS.location,qa[0]=q_[0],qa[1]=q_[1]),1):0},q_._uniform_vec2v=function(qS,q_){if(q_.length<2){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qA.mainContext.uniform2fv(qS.location,q_),qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3],1):0}return qA.mainContext.uniform2fv(qS.location,q_),1},q_._uniform_vec3=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]?(qA.mainContext.uniform3f(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2]),1):0},q_._uniform_vec3v=function(qS,q_){return qA.mainContext.uniform3fv(qS.location,q_),1},q_._uniform_vec4=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qA.mainContext.uniform4f(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3]),1):0},q_._uniform_vec4v=function(qS,q_){return qA.mainContext.uniform4fv(qS.location,q_),1},q_._uniformMatrix2fv=function(qS,q_){return qA.mainContext.uniformMatrix2fv(qS.location,!1,q_),1},q_._uniformMatrix3fv=function(qS,q_){return qA.mainContext.uniformMatrix3fv(qS.location,!1,q_),1},q_._uniformMatrix4fv=function(qS,q_){return qA.mainContext.uniformMatrix4fv(qS.location,!1,q_),1},q_._uinformMatrix2fv=function(qS,q_){return qA.mainContext.uniformMatrix2fv(qS.location,!1,q_),1},q_._uinformMatrix3fv=function(qS,q_){return qA.mainContext.uniformMatrix3fv(qS.location,!1,q_),1},q_._uniform1i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_?(qA.mainContext.uniform1i(qS.location,qa[0]=q_),1):0},q_._uniform1iv=function(qS,q_){return qA.mainContext.uniform1iv(qS.location,q_),1},q_._uniform_ivec2=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]?(qA.mainContext.uniform2i(qS.location,qa[0]=q_[0],qa[1]=q_[1]),1):0},q_._uniform_ivec2v=function(qS,q_){return qA.mainContext.uniform2iv(qS.location,q_),1},q_._uniform_vec3i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]?(qA.mainContext.uniform3i(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2]),1):0},q_._uniform_vec3vi=function(qS,q_){return qA.mainContext.uniform3iv(qS.location,q_),1},q_._uniform_vec4i=function(qS,q_){var qa=qS.uploadedValue;return qa[0]!==q_[0]||qa[1]!==q_[1]||qa[2]!==q_[2]||qa[3]!==q_[3]?(qA.mainContext.uniform4i(qS.location,qa[0]=q_[0],qa[1]=q_[1],qa[2]=q_[2],qa[3]=q_[3]),1):0},q_._uniform_vec4vi=function(qS,q_){return qA.mainContext.uniform4iv(qS.location,q_),1},q_._uniform_sampler2D=function(qS,q_){var qa=q_.source||q_.defaulteTexture.source,qR=qA.mainContext,qJ=qS.uploadedValue;if(null!=qJ[0])return qR.activeTexture(qH._TEXTURES[qJ[0]]),qa&&qX.bindTexture(qR,3553,qa),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return qJ[0]=this._curActTexIndex,qR.uniform1i(qS.location,this._curActTexIndex),qR.activeTexture(qH._TEXTURES[this._curActTexIndex]),qa&&qX.bindTexture(qR,3553,qa),this._curActTexIndex++,1},q_._uniform_samplerCube=function(qS,q_){var qa=q_.source||q_.defaulteTexture.source,qR=qA.mainContext,qJ=qS.uploadedValue;if(null!=qJ[0])return qR.activeTexture(qH._TEXTURES[qJ[0]]),qa?qX.bindTexture(qR,34067,qa):qX.bindTexture(qR,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return qJ[0]=this._curActTexIndex,qR.uniform1i(qS.location,this._curActTexIndex),qR.activeTexture(qH._TEXTURES[this._curActTexIndex]),qa?qX.bindTexture(qR,34067,qa):qX.bindTexture(qR,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},q_._noSetValue=function(qS){console.log("no....:"+qS.name)},q_.bind=function(){return qa.activeShader=this,(qa.bindShader=this).activeResource(),qX.UseProgram(this._program)},q_.uploadAttributes=function(qS,q_){for(var qa,qR,qJ=0,qV=0,qW=this._attributeParamsMap.length;qV<qW;qV+=2)qR=this._attributeParamsMap[qV+1],null!=(qa=qS[this._attributeParamsMap[qV]])&&(q_&&q_[qR.name]&&q_[qR.name].bind(),qJ+=qR.fun.call(this,qR,qa));qN.shaderCall+=qJ},q_.uploadAttributesX=function(qS,q_){for(var qa,qR,qJ=0,qV=0,qW=this._attributeParamsMap.length;qV<qW;qV+=2)qR=this._attributeParamsMap[qV+1],null!=(qa=qS[this._attributeParamsMap[qV]])&&(q_._bind(),qJ+=qR.fun.call(this,qR,qa));qN.shaderCall+=qJ},q_.uploadSceneUniforms=function(qS){for(var q_,qa,qR=0,qJ=0,qV=this._sceneUniformParamsMap.length;qJ<qV;qJ+=2)qa=this._sceneUniformParamsMap[qJ+1],null!=(q_=qS[this._sceneUniformParamsMap[qJ]])&&(qR+=qa.fun.call(this,qa,q_));qN.shaderCall+=qR},q_.uploadCameraUniforms=function(qS){for(var q_,qa,qR=0,qJ=0,qV=this._cameraUniformParamsMap.length;qJ<qV;qJ+=2)qa=this._cameraUniformParamsMap[qJ+1],null!=(q_=qS[this._cameraUniformParamsMap[qJ]])&&(qR+=qa.fun.call(this,qa,q_));qN.shaderCall+=qR},q_.uploadSpriteUniforms=function(qS){for(var q_,qa,qR=0,qJ=0,qV=this._spriteUniformParamsMap.length;qJ<qV;qJ+=2)qa=this._spriteUniformParamsMap[qJ+1],null!=(q_=qS[this._spriteUniformParamsMap[qJ]])&&(qR+=qa.fun.call(this,qa,q_));qN.shaderCall+=qR},q_.uploadMaterialUniforms=function(qS){for(var q_,qa,qR=0,qJ=0,qV=this._materialUniformParamsMap.length;qJ<qV;qJ+=2)qa=this._materialUniformParamsMap[qJ+1],null!=(q_=qS[this._materialUniformParamsMap[qJ]])&&(qR+=qa.fun.call(this,qa,q_));qN.shaderCall+=qR},q_.uploadRenderElementUniforms=function(qS){for(var q_,qa,qR=0,qJ=0,qV=this._renderElementUniformParamsMap.length;qJ<qV;qJ+=2)qa=this._renderElementUniformParamsMap[qJ+1],null!=(q_=qS[this._renderElementUniformParamsMap[qJ]])&&(qR+=qa.fun.call(this,qa,q_));qN.shaderCall+=qR},qH.create=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return new qH(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb)},qH.addInclude=function(qS,q_){qD.addInclude(qS,q_)},qH._createShader=function(qS,q_,qa){var qR=qS.createShader(qa);if(qS.shaderSource(qR,q_),qS.compileShader(qR),qN_.debugMode&&!qS.getShaderParameter(qR,35713))throw qS.getShaderInfoLog(qR);return qR},qH.PERIOD_RENDERELEMENT=0,qH.PERIOD_MATERIAL=1,qH.PERIOD_SPRITE=2,qH.PERIOD_CAMERA=3,qH.PERIOD_SCENE=4,qH._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],qH._count=0,qH._preCompile=!1,qH.extCompileFunc=null,qH.extCompileObj=null,qL(qH,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new qn}]),qH}(),qr_=function(qk){function qz(){this._transformUV=null,qz.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new qW_(.6,.6,.6)),this._setColor(10,new qW_(1,1,1)),this._setColor(11,new qk_(1,1,1,8)),this._setColor(12,new qW_(1,1,1)),this._setColor(7,new qk_(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new qk_(1,1,0,0)),this.renderMode=1}qG(qz,"laya.d3.core.material.StandardMaterial",qk);var qS=qz.prototype;return qS.disableLight=function(){this._addDisablePublicShaderDefine(qN_.SHADERDEFINE_POINTLIGHT|qN_.SHADERDEFINE_SPOTLIGHT|qN_.SHADERDEFINE_DIRECTIONLIGHT)},qS.disableFog=function(){this._addDisablePublicShaderDefine(qN_.SHADERDEFINE_FOG)},qS.onAsynLoaded=function(qS,q_,qa){var qR=q_[0];if(qR.version)qk.prototype.onAsynLoaded.call(this,qS,q_,qa);else{var qJ=q_[1],qV=qR.props;for(var qW in qV)this[qW]=qV[qW];qz._parseStandardMaterial(qJ,this,qR),this._endLoaded()}},qS.cloneTo=function(qS){qk.prototype.cloneTo.call(this,qS);var q_=qS;this._transformUV&&(q_._transformUV=this._transformUV.clone())},qt(0,qS,"ambientColor",function(){return this._getColor(9)},function(qS){this._setColor(9,qS)}),qt(0,qS,"ambientTexture",function(){return this._getTexture(5)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,qS)}),qt(0,qS,"renderMode",null,function(qS){switch(qS){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(qz.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(qS)}),qt(0,qS,"reflectColor",function(){return this._getColor(12)},function(qS){this._setColor(12,qS)}),qt(0,qS,"tilingOffset",function(){return this._getColor(15)},function(qS){if(qS){var q_=qS.elements;1!=q_[0]||1!=q_[1]||0!=q_[2]||0!=q_[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,qS)}),qt(0,qS,"albedo",function(){return this._getColor(7)},function(qS){this._setColor(7,qS)}),qt(0,qS,"diffuseColor",function(){return this._getColor(10)},function(qS){this._setColor(10,qS)}),qt(0,qS,"albedoColor",function(){return this._getColor(7)},function(qS){this._setColor(7,qS)}),qt(0,qS,"specularColor",function(){return this._getColor(11)},function(qS){this._setColor(11,qS)}),qt(0,qS,"diffuseTexture",function(){return this._getTexture(1)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,qS)}),qt(0,qS,"normalTexture",function(){return this._getTexture(2)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,qS)}),qt(0,qS,"specularTexture",function(){return this._getTexture(3)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,qS)}),qt(0,qS,"emissiveTexture",function(){return this._getTexture(4)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,qS)}),qt(0,qS,"reflectTexture",function(){return this._getTexture(6)},function(qS){qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,qS)}),qt(0,qS,"transformUV",function(){return this._transformUV},function(qS){this._transformUV=qS,this._setMatrix4x4(13,qS.matrix),qS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,qS.matrix.elements,0)}),qz.__init__=function(){qz.SHADERDEFINE_DIFFUSEMAP=qz.shaderDefines.registerDefine("DIFFUSEMAP"),qz.SHADERDEFINE_NORMALMAP=qz.shaderDefines.registerDefine("NORMALMAP"),qz.SHADERDEFINE_SPECULARMAP=qz.shaderDefines.registerDefine("SPECULARMAP"),qz.SHADERDEFINE_EMISSIVEMAP=qz.shaderDefines.registerDefine("EMISSIVEMAP"),qz.SHADERDEFINE_AMBIENTMAP=qz.shaderDefines.registerDefine("AMBIENTMAP"),qz.SHADERDEFINE_REFLECTMAP=qz.shaderDefines.registerDefine("REFLECTMAP"),qz.SHADERDEFINE_UVTRANSFORM=qz.shaderDefines.registerDefine("UVTRANSFORM"),qz.SHADERDEFINE_TILINGOFFSET=qz.shaderDefines.registerDefine("TILINGOFFSET"),qz.SHADERDEFINE_ADDTIVEFOG=qz.shaderDefines.registerDefine("ADDTIVEFOG")},qz.load=function(qS){return qQ.loader.create(qS,null,null,qz)},qz._parseStandardMaterial=function(qS,q_,qa){var qR=qa.customProps,qJ=qR.ambientColor;q_.ambientColor=new qW_(qJ[0],qJ[1],qJ[2]);var qV=qR.diffuseColor;q_.diffuseColor=new qW_(qV[0],qV[1],qV[2]);var qW=qR.specularColor;q_.specularColor=new qk_(qW[0],qW[1],qW[2],qW[3]);var qk=qR.reflectColor;q_.reflectColor=new qW_(qk[0],qk[1],qk[2]);var qz=qR.albedoColor;qz&&(q_.albedo=new qk_(qz[0],qz[1],qz[2],qz[3]));var qb=qR.diffuseTexture.texture2D;qb&&(q_.diffuseTexture=qF.getRes(qS[qb]));var qH=qR.normalTexture.texture2D;qH&&(q_.normalTexture=qF.getRes(qS[qH]));var qL=qR.specularTexture.texture2D;qL&&(q_.specularTexture=qF.getRes(qS[qL]));var qC=qR.emissiveTexture.texture2D;qC&&(q_.emissiveTexture=qF.getRes(qS[qC]));var qG=qR.ambientTexture.texture2D;qG&&(q_.ambientTexture=qF.getRes(qS[qG]));var qt=qR.reflectTexture.texture2D;qt&&(q_.reflectTexture=qF.getRes(qS[qt]))},qz.RENDERMODE_OPAQUE=1,qz.RENDERMODE_OPAQUEDOUBLEFACE=2,qz.RENDERMODE_CUTOUT=3,qz.RENDERMODE_CUTOUTDOUBLEFACE=4,qz.RENDERMODE_TRANSPARENT=13,qz.RENDERMODE_TRANSPARENTDOUBLEFACE=14,qz.RENDERMODE_ADDTIVE=15,qz.RENDERMODE_ADDTIVEDOUBLEFACE=16,qz.RENDERMODE_DEPTHREAD_TRANSPARENT=5,qz.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,qz.RENDERMODE_DEPTHREAD_ADDTIVE=7,qz.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,qz.RENDERMODE_NONDEPTH_TRANSPARENT=9,qz.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,qz.RENDERMODE_NONDEPTH_ADDTIVE=11,qz.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,qz.SHADERDEFINE_DIFFUSEMAP=0,qz.SHADERDEFINE_NORMALMAP=0,qz.SHADERDEFINE_SPECULARMAP=0,qz.SHADERDEFINE_EMISSIVEMAP=0,qz.SHADERDEFINE_AMBIENTMAP=0,qz.SHADERDEFINE_REFLECTMAP=0,qz.SHADERDEFINE_UVTRANSFORM=0,qz.SHADERDEFINE_TILINGOFFSET=0,qz.SHADERDEFINE_ADDTIVEFOG=0,qz.DIFFUSETEXTURE=1,qz.NORMALTEXTURE=2,qz.SPECULARTEXTURE=3,qz.EMISSIVETEXTURE=4,qz.AMBIENTTEXTURE=5,qz.REFLECTTEXTURE=6,qz.ALBEDO=7,qz.UVANIAGE=8,qz.MATERIALAMBIENT=9,qz.MATERIALDIFFUSE=10,qz.MATERIALSPECULAR=11,qz.MATERIALREFLECT=12,qz.UVMATRIX=13,qz.UVAGE=14,qz.TILINGOFFSET=15,qL(qz,["defaultMaterial",function(){var qS=new qz;return qS.lock=!0,this.defaultMaterial=qS},"shaderDefines",function(){return this.shaderDefines=new qH_(qI_.shaderDefines)}]),qz}(qI_),qe_=function(qS){function qW(qS,q_,qa,qR,qJ){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===qa&&(qa=35044),void 0===qR&&(qR=!1),qW.__super.call(this),this._indexType=qS,this._indexCount=q_,this._bufferUsage=qa,this._bufferType=34963,this._canRead=qR;var qV;if("ushort"==qS)this._indexTypeByteCount=2;else{if("ubyte"!=qS)throw new Error("unidentification index type.");this._indexTypeByteCount=1}qV=this._indexTypeByteCount*q_,this._byteLength=qV,this._bind(),qk._gl.bufferData(this._bufferType,qV,this._bufferUsage),this.uri=qJ,qR?("ushort"==qS?this._buffer=new Uint16Array(q_):"ubyte"==qS&&(this._buffer=new Uint8Array(q_)),this.memorySize=2*qV):this.memorySize=qV}qG(qW,"laya.d3.graphics.IndexBuffer3D",qS);var q_=qW.prototype;return q_.setData=function(qS,q_,qa,qR){void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=4294967295);var qJ=0;if("ushort"==this._indexType?(qJ=2,0===qa&&4294967295===qR||(qS=new Uint16Array(qS.buffer,qa*qJ,qR))):"ubyte"==this._indexType&&(qJ=1,0===qa&&4294967295===qR||(qS=new Uint8Array(qS.buffer,qa*qJ,qR))),this._bind(),qk._gl.bufferSubData(this._bufferType,q_*qJ,qS),this._canRead)if(0!==q_||0!==qa||4294967295!==qR){var qV=this._buffer.length-q_;qV<qR&&(qR=qV);for(var qW=0;qW<qR;qW++)this._buffer[q_+qW]=qS[qW]}else this._buffer=qS},q_.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},q_.disposeResource=function(){qS.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},qt(0,q_,"indexType",function(){return this._indexType}),qt(0,q_,"indexTypeByteCount",function(){return this._indexTypeByteCount}),qt(0,q_,"indexCount",function(){return this._indexCount}),qt(0,q_,"canRead",function(){return this._canRead}),qW.INDEXTYPE_UBYTE="ubyte",qW.INDEXTYPE_USHORT="ushort",qW.create=function(qS,q_,qa,qR,qJ){return void 0===qa&&(qa=35044),void 0===qR&&(qR=!1),new qW(qS,q_,qa,qR,qJ)},qW}(qk),qg_=function(qV){function qW(qS,q_,qa,qR,qJ){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===qR&&(qR=!1),qW.__super.call(this),this._vertexDeclaration=qS,this._vertexCount=q_,this._bufferUsage=qa,this._bufferType=34962,this._canRead=qR,this.uri=qJ,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*q_,this._bind(),qk._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),qR&&(this._buffer=new Float32Array(this._byteLength/4))}qG(qW,"laya.d3.graphics.VertexBuffer3D",qV);var qS=qW.prototype;return qS.bindWithIndexBuffer=function(qS){qS&&qS._bind(),this._bind()},qS.setData=function(qS,q_,qa,qR){if(void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=4294967295),0===qa&&4294967295===qR||(qS=new Float32Array(qS.buffer,4*qa,qR)),this._bind(),qk._gl.bufferSubData(this._bufferType,4*q_,qS),this._canRead)if(0!==q_||0!==qa||4294967295!==qR){var qJ=this._buffer.length-q_;qJ<qR&&(qR=qJ);for(var qV=0;qV<qR;qV++)this._buffer[q_+qV]=qS[qV]}else this._buffer=qS},qS.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},qS.disposeResource=function(){for(var qS=qA.mainContext,q_=this._vertexDeclaration.getVertexElements(),qa=qk._enableAtributes,qR=0,qJ=q_.length;qR<qJ;qR++)qa[qR]===this._glBuffer&&(qS.disableVertexAttribArray(qR),qa[qR]=null);qV.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},qt(0,qS,"vertexDeclaration",function(){return this._vertexDeclaration}),qt(0,qS,"vertexCount",function(){return this._vertexCount}),qt(0,qS,"canRead",function(){return this._canRead}),qW.create=function(qS,q_,qa,qR,qJ){return void 0===qa&&(qa=35044),void 0===qR&&(qR=!1),new qW(qS,q_,qa,qR,qJ)},qW}(qk),qx_=function(qS){function qD(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,qD.__super.call(this),this._type=3553}qG(qD,"laya.d3.resource.DataTexture2D",qA_);var q_=qD.prototype;return q_.genDebugMipmaps=function(){var qS=[];return qS.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),qS.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),qS.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),qS.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),qS.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),qS.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),qS.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),qS.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),qS.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),qS.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),qS},q_._onTextureLoaded=function(qS){},q_._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var qS=qA.mainContext,q_=this._source=qS.createTexture(),qa=this._width,qR=this._height,qJ=qX.curBindTexTarget,qV=qX.curBindTexValue,qW=!1;if(qX.bindTexture(qS,this._type,q_),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var qk=0;qS.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var qz=0;qz<this._mipmaps.length;qz++){if(this._mipmaps[qz].byteLength!=qb*qH*4)throw"mipmap size error  level:"+qz;qS.texSubImage2D(this._type,0,qD.simLodRect[qk++],qD.simLodRect[qk++],qD.simLodRect[qk++],qD.simLodRect[qk++],6408,5121,new Uint8Array(this._mipmaps[qz]))}this.minFifter=9729,this.magFifter=9729}else{var qb=this._width,qH=this._height;for(qk=0,qS.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),qz=0;qz<this._mipmaps.length;qz++){if(this._mipmaps[qz].byteLength!=qb*qH*4)throw"mipmap size error  level:"+qz;qS.texImage2D(this._type,qz,6408,qb,qH,0,6408,5121,new Uint8Array(this._mipmaps[qz])),(qb/=2)<1&&(qb=1),(qH/=2)<1&&(qH=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&qS.pixelStorei(qS.UNPACK_ALIGNMENT,1),qS.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var qL=0,qC=!1,qG=!1;this._buffer.byteLength==4*qa*qR?(qL=6408,qC=!0):this._buffer.byteLength==3*qa*qR?(qL=6407,qG=!0):qL=this._format,qC||qG?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),qG&&qS.pixelStorei(qS.UNPACK_ALIGNMENT,1),qS.texImage2D(this._type,0,qL,qa,qR,0,qL,5121,this._buffer)):qS&&qL==qS.ALPHA?(qS.texImage2D(3553,0,qL,qa,qR,0,qL,qS.UNSIGNED_BYTE,this._buffer),qW=!0):0!=qL&&(qS.compressedTexImage2D(3553,0,qL,qa,qR,0,this._buffer),qW=!0)}var qt=this._minFifter,qo=this._magFifter,q$=0==this._wrapModeU?10497:33071,qF=0==this._wrapModeV?10497:33071,qT=qj.isPOT(qa,qR);qT?(this._mipmap||this._mipmaps?-1!==qt||(qt=9987):-1!==qt||(qt=9729),-1!==qo||(qo=9729),qS.texParameteri(this._type,10241,qt),qS.texParameteri(this._type,10240,qo),qS.texParameteri(this._type,10242,q$),qS.texParameteri(this._type,10243,qF),this._mipmap&&qS.generateMipmap(this._type)):(-1!==qt||(qt=9729),-1!==qo||(qo=9729),qS.texParameteri(this._type,10241,qt),qS.texParameteri(this._type,10240,qo),qS.texParameteri(this._type,10242,33071),qS.texParameteri(this._type,10243,33071)),qJ&&qV&&qX.bindTexture(qS,qJ,qV),this.memorySize=qW?this._buffer.length:qT?qa*qR*4*(1+1/3):qa*qR*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},q_.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},q_.onAsynLoaded=function(qS,q_,qa){var qR;qa&&(qR=qa[0].call(this,q_)),qR&&(this._width=qR.width,this._height=qR.height,this._buffer=qR.data),this._src=qS,this._size=new qo_(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},q_.getPixels=function(){return new Uint8Array(this._buffer)},q_.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(qA.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},qt(0,q_,"src",function(){return this._src}),qD.create=function(qS,q_,qa,qR,qJ,qV,qW){if(void 0===qR&&(qR=9729),void 0===qJ&&(qJ=9729),void 0===qV&&(qV=!0),!qS||qS.byteLength<q_*qa*4)throw"DataTexture2D create error";var qk=new qD;return qk.uri=qW,qk._buffer=qS,qk._width=q_,qk._height=qa,qk._mipmap=qV,qk._magFifter=qR,qk._minFifter=qJ,qk._size=new qo_(qk._width,qk._height),qk._conchTexture?alert("怎么给runtime传递datatexture数据"):qk.activeResource(),qk},qD.load=function(qS,q_,qa,qR,qJ){if(void 0===q_&&(q_=0),void 0===qa&&(qa=0),void 0===qR&&(qR=9729),void 0===qJ&&(qJ=9729),"mipmaps"===ql.getFileExtension(qS)){var qV=qQ.loader.create(qS,null,null,qD,[function(qS){this._mipmaps=[];var q_=new Uint32Array(qS);this._width=q_[0];var qa=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,qa=1024),this._width!=qa)throw"现在只支持512x256的环境贴图。当前的是"+q_[0];this._height=q_[1];for(var qR=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,qJ=this._height,qV=8;;){var qW=qR*qJ*4;if(qV+qW>qS.byteLength)throw"load mipmaps data size error ";var qk=new Uint8Array(qS,qV,qW);if(this._mipmaps.push(qk),qV+=qW,1==qR&&1==qJ)break;(qR/=2)<1&&(qR=1),(qJ/=2)<1&&(qJ=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){qV.simLodInfo=new Float32Array(40);for(var qW=0;qW<qV.simLodInfo.length;)qV.simLodInfo[qW]=(qD.simLodRect[qW]+.5)/1024,qW++,qV.simLodInfo[qW]=(qD.simLodRect[qW]+.5)/256,qW++,qV.simLodInfo[qW]=Math.max(qD.simLodRect[qW]-1,.1)/1024,qW++,qV.simLodInfo[qW]=Math.max(qD.simLodRect[qW]-1.5,.1)/256,qW++}return qV}if("number"==typeof q_)return qQ.loader.create(qS,null,null,qD,[function(qS){return this._width=q_,this._height=qa,this._buffer=qS,null}]);if("function"==typeof q_)return qQ.loader.create(qS,null,null,qD,[q_]);throw new Error("unknown params.")},qD.lodasatlas=!1,qL(qD,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),qD}(),qs_=function(qS){function q_(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,q_.__super.call(this)}qG(q_,"laya.d3.resource.models.PrimitiveMesh",qX_);var qa=q_.prototype;return qQ.imps(qa,{"laya.d3.core.render.IRenderable":!0}),qa._getVertexBuffer=function(qS){return void 0===qS&&(qS=0),0===qS?this._vertexBuffer:null},qa._getVertexBuffers=function(){return null},qa._getIndexBuffer=function(){return this._indexBuffer},qa._getPositions=function(){var qS,q_=[],qa=this._vertexBuffer.vertexDeclaration.getVertexElements(),qR=0;for(qR=0;qR<qa.length;qR++){var qJ=qa[qR];if("vector3"===qJ.elementFormat&&0===qJ.elementUsage){qS=qJ;break}}var qV=this._vertexBuffer.getData();for(qR=0;qR<qV.length;qR+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var qW=qR+qS.offset/4,qk=new qW_(qV[qW+0],qV[qW+1],qV[qW+2]);q_.push(qk)}return q_},qa.getRenderElement=function(qS){return this},qa.getRenderElementsCount=function(){return 1},qa.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},qa._beforeRender=function(qS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},qa._render=function(qS){qA.mainContext.drawElements(4,this._numberIndices,5123,0),qN.drawCall++,qN.trianglesFaces+=this._numberIndices/3},qt(0,qa,"_vertexBufferCount",function(){return 1}),qt(0,qa,"triangleCount",function(){return this._indexBuffer.indexCount/3}),q_}(),qU_=function(qS){function q_(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,q_.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}qG(q_,"laya.d3.resource.models.Mesh",qX_);var qa=q_.prototype;return qa._getPositions=function(){var qS,q_,qa,qR,qJ,qV=[],qW=0,qk=0,qz=0;if(0!==this._vertexBuffers.length){var qb=this._vertexBuffers.length;for(qW=0;qW<qb;qW++){for(qa=(qS=this._vertexBuffers[qW]).vertexDeclaration.getVertexElements(),qk=0;qk<qa.length;qk++)if("vector3"===(qR=qa[qk]).elementFormat&&0===qR.elementUsage){q_=qR;break}for(qJ=qS.getData(),qk=0;qk<qJ.length;qk+=qS.vertexDeclaration.vertexStride/4)qz=qk+q_.offset/4,qV.push(new qW_(qJ[qz+0],qJ[qz+1],qJ[qz+2]))}}else{var qH=this._subMeshes.length;for(qW=0;qW<qH;qW++){for(qa=(qS=this._subMeshes[qW]._getVertexBuffer()).vertexDeclaration.getVertexElements(),qk=0;qk<qa.length;qk++)if("vector3"===(qR=qa[qk]).elementFormat&&0===qR.elementUsage){q_=qR;break}for(qJ=qS.getData(),qk=0;qk<qJ.length;qk+=qS.vertexDeclaration.vertexStride/4)qz=qk+q_.offset/4,qV.push(new qW_(qJ[qz+0],qJ[qz+1],qJ[qz+2]))}}return qV},qa._setSubMeshes=function(qS){this._subMeshes=qS,this._subMeshCount=qS.length;for(var q_=0;q_<this._subMeshCount;q_++)qS[q_]._indexInMesh=q_;this._positions=this._getPositions(),this._generateBoundingObject()},qa.onAsynLoaded=function(qS,q_,qa){var qR=q_[0],qJ=q_[1];qyS.read(qR,this,this._materials,this._subMeshes,qJ),this.completeCreate(),this._endLoaded()},qa.getSubMesh=function(qS){return this._subMeshes[qS]},qa.getSubMeshCount=function(){return this._subMeshes.length},qa.getRenderElementsCount=function(){return this._subMeshes.length},qa.getRenderElement=function(qS){return this._subMeshes[qS]},qa.disposeResource=function(){for(var qS=0;qS<this._subMeshes.length;qS++)this._subMeshes[qS].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},qt(0,qa,"materials",function(){return this._materials.slice()}),qt(0,qa,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),q_.load=function(qS){return qQ.loader.create(qS,null,null,q_)},q_}(),qf_=(function(qS){function qb(qS,q_,qa,qR,qJ,qV,qW,qk,qz){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===qa&&(qa=6408),void 0===qR&&(qR=5121),void 0===qJ&&(qJ=33189),void 0===qV&&(qV=!1),void 0===qW&&(qW=!1),void 0===qk&&(qk=-1),void 0===qz&&(qz=-1),qb.__super.call(this),this._type=3553,this._width=qS,this._height=q_,this._size=new qo_(qS,q_),this._surfaceFormat=qa,this._surfaceType=qR,this._depthStencilFormat=qJ,qo.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=qV,this._repeat=qW,this._minFifter=qk,this._magFifter=qz,this.activeResource(),this._alreadyResolved=!0}qG(qb,"laya.d3.resource.RenderTexture",qA_);var q_=qb.prototype;q_.recreateResource=function(){var qS=qA.mainContext;this._frameBuffer=qS.createFramebuffer(),this._source=qS.createTexture();var q_=qX.curBindTexTarget,qa=qX.curBindTexValue;qX.bindTexture(qS,this._type,this._source),qS.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var qR=this._minFifter,qJ=this._magFifter,qV=this._repeat?10497:33071;if(qj.isPOT(this._width,this._height)?(this._mipmap?-1!==qR||(qR=9987):-1!==qR||(qR=9729),-1!==qJ||(qJ=9729),qS.texParameteri(this._type,10241,qR),qS.texParameteri(this._type,10240,qJ),qS.texParameteri(this._type,10242,qV),qS.texParameteri(this._type,10243,qV),this._mipmap&&qS.generateMipmap(this._type)):(-1!==qR||(qR=9729),-1!==qJ||(qJ=9729),qS.texParameteri(this._type,10241,qR),qS.texParameteri(this._type,10240,qJ),qS.texParameteri(this._type,10242,33071),qS.texParameteri(this._type,10243,33071)),q_&&qa&&qX.bindTexture(qS,q_,qa),qS.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=qS.createRenderbuffer(),qS.bindRenderbuffer(36161,this._depthStencilBuffer),qS.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),qS.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:qS.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:qS.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:qS.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}qS.framebufferTexture2D(36160,36064,3553,this._source,0),qS.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},q_.start=function(){qA.mainContext.bindFramebuffer(36160,this.frameBuffer),(qb._currentRenderTarget=this)._alreadyResolved=!1},q_.end=function(){qA.mainContext.bindFramebuffer(36160,null),qb._currentRenderTarget=null,this._alreadyResolved=!0},q_.getData=function(qS,q_,qa,qR){var qJ=qA.mainContext;if(qJ.bindFramebuffer(36160,this._frameBuffer),!(36053===qJ.checkFramebufferStatus(36160)))return qJ.bindFramebuffer(36160,null),null;var qV=new Uint8Array(this._width*this._height*4);return qJ.readPixels(qS,q_,qa,qR,this._surfaceFormat,this._surfaceType,qV),qJ.bindFramebuffer(36160,null),qV},q_.disposeResource=function(){if(this._frameBuffer){var qS=qA.mainContext;qS.deleteTexture(this._source),qS.deleteFramebuffer(this._frameBuffer),qS.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},qt(0,q_,"surfaceFormat",function(){return this._surfaceFormat}),qt(0,q_,"surfaceType",function(){return this._surfaceType}),qt(0,q_,"depthStencilFormat",function(){return this._depthStencilFormat}),qt(0,q_,"source",function(){return this._alreadyResolved?qQ.superGet(qA_,this,"source"):null}),qt(0,q_,"depthStencilBuffer",function(){return this._depthStencilBuffer}),qt(0,q_,"frameBuffer",function(){return this._frameBuffer}),qb._currentRenderTarget=null}(),function(qS){function q_(qS){this._color=null,this._pixels=null,q_.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new qo_(this.width,this.height),this._color=qS,this._pixels=new Uint8Array([255*qS.x,255*qS.y,255*qS.z,255*qS.w]),this.uri="SolidColorTexture2D_"+this.id}qG(q_,"laya.d3.resource.SolidColorTexture2D",qA_);var qa=q_.prototype;return qa._createWebGlTexture=function(){var qS=qA.mainContext,q_=this._source=qS.createTexture(),qa=this._width,qR=this._height,qJ=qX.curBindTexTarget,qV=qX.curBindTexValue;qX.bindTexture(qS,this._type,q_),qS.texImage2D(this._type,0,6408,qa,qR,0,6408,5121,this._pixels);var qW=this._minFifter,qk=this._magFifter,qz=this._repeat?10497:33071,qb=qj.isPOT(qa,qR);qb?(this._mipmap?-1!==qW||(qW=9987):-1!==qW||(qW=9729),-1!==qk||(qk=9729),qS.texParameteri(this._type,10241,qW),qS.texParameteri(this._type,10240,qk),qS.texParameteri(this._type,10242,qz),qS.texParameteri(this._type,10243,qz),this._mipmap&&qS.generateMipmap(this._type)):(-1!==qW||(qW=9729),-1!==qk||(qk=9729),qS.texParameteri(this._type,10241,qW),qS.texParameteri(this._type,10240,qk),qS.texParameteri(this._type,10242,33071),qS.texParameteri(this._type,10243,33071)),qJ&&qV&&qX.bindTexture(qS,qJ,qV),this.memorySize=qb?qa*qR*4*(1+1/3):qa*qR*4},qa.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},qa.disposeResource=function(){this._source&&(qA.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},qL(q_,["magentaTexture",function(){var qS=new q_(new qk_(1,0,1,1));return qS.lock=!0,this.magentaTexture=qS},"grayTexture",function(){var qS=new q_(new qk_(.5,.5,.5,1));return qS.lock=!0,this.grayTexture=qS}]),q_}()),qY_=function(qS){function qJ(qS,q_,qa,qR){this._canRead=!1,this._image=null,this._pixels=null,void 0===qS&&(qS=!1),void 0===q_&&(q_=!0),void 0===qa&&(qa=6408),void 0===qR&&(qR=!0),qJ.__super.call(this),this._type=3553,this._repeat=q_,this._canRead=qS,this._format=qa,this._mipmap=qR}qG(qJ,"laya.d3.resource.Texture2D",qA_);var q_=qJ.prototype;return q_._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var qS=qA.mainContext,q_=this._source=qS.createTexture(),qa=this._width,qR=this._height,qJ=qX.curBindTexTarget,qV=qX.curBindTexValue;switch(qX.bindTexture(qS,this._type,q_),this._format){case 6407:case 6408:this._canRead?qS.texImage2D(this._type,0,this._format,qa,qR,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?qS.texImage2D(this._type,0,this._image._format,qa,qR,0,this._image._format,5121,this._image.atlasSource):qS.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case qA.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:qS.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var qW=this._minFifter,qk=this._magFifter,qz=this._repeat?10497:33071,qb=0==this._wrapModeU?10497:33071,qH=0==this._wrapModeV?10497:33071,qL=qj.isPOT(qa,qR);qL?(this._mipmap?-1!==qW||(qW=9987):-1!==qW||(qW=9729),-1!==qk||(qk=9729),qS.texParameteri(this._type,10241,qW),qS.texParameteri(this._type,10240,qk),qS.texParameteri(this._type,10242,qz),qS.texParameteri(this._type,10243,qz),qS.texParameteri(this._type,10242,qb),qS.texParameteri(this._type,10243,qH),this._mipmap&&qS.generateMipmap(this._type)):(-1!==qW||(qW=9729),-1!==qk||(qk=9729),qS.texParameteri(this._type,10241,qW),qS.texParameteri(this._type,10240,qk),qS.texParameteri(this._type,10242,33071),qS.texParameteri(this._type,10243,33071)),qJ&&qV&&qX.bindTexture(qS,qJ,qV),this._image.onload=null,this._image=null,this.memorySize=qL?qa*qR*4*(1+1/3):qa*qR*4},q_.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},q_.onAsynLoaded=function(qS,q_,qa){if(qa){var qR=qa[0];void 0!==qR&&(this._canRead=qR);var qJ=qa[1];void 0!==qJ&&(this._repeat=qJ);var qV=qa[2];void 0!==qV&&(this._format=qV);var qW=qa[3];void 0!==qW&&(this._mipmap=qW);var qk=qa.wrapModeU;void 0!==qk&&(this._wrapModeU=qk);var qz=qa.wrapModeV;void 0!==qz&&(this._wrapModeV=qz)}switch(this._format){case 6407:case 6408:var qb=(this._image=q_).width,qH=q_.height;this._width=qb,this._height=qH,this._size=new qo_(qb,qH),this._canRead&&(qo.isConchApp?q_ instanceof qC.HTMLElement&&(this._pixels=new Uint8Array(q_.getImageData(0,0,qb,qH))):(qh.canvas.size(qb,qH),qh.canvas.clear(),qh.context.drawImage(q_,0,0,qb,qH),this._pixels=new Uint8Array(qh.context.getImageData(0,0,qb,qH).data.buffer)));break;case qA.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var qL=new qm(q_);qL.readUTFBytes(4),qL.readUTFBytes(2),qL.getInt16();qL.endian="bigEndian",this._width=qL.getInt16(),this._height=qL.getInt16(),this._size=new qo_(this._width,this._height);qL.getInt16(),qL.getInt16();this._image=new Uint8Array(q_,qL.pos)}this.recreateResource(),this._endLoaded()},q_.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},q_.disposeResource=function(){this._source&&(qA.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},qt(0,q_,"_src",function(){return this.url}),qt(0,q_,"src",function(){return this.url}),qJ.load=function(qS){return qQ.loader.create(qS,null,null,qJ)},qJ}(),qi_=function(q_){function qa(qS,q_){qa.__super.call(this),void 0===qS&&(qS=.3),void 0===q_&&(q_=1e3),this._tempVector3=new qW_,this._position=new qW_,this._up=new qW_,this._forward=new qW_,this._right=new qW_,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=qo_.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=qS,this._farPlane=q_,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),qQ.stage.on("resize",this,this._onScreenSizeChanged)}qG(qa,"laya.d3.core.BaseCamera",q_);var qS=qa.prototype;return qS._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var qS=this.scene._cameraPool,q_=qS.length-1,qa=0;qa<q_;qa++)if(qS[qa].renderingOrder>qS[q_].renderingOrder){var qR=qS[qa];qS[qa]=qS[q_],qS[q_]=qR}},qS._calculateProjectionMatrix=function(){},qS._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},qS._prepareCameraToRender=function(){qu._currentCameraCullingMask=this.cullingMask;var qS=this._shaderValues;qS.setValue(0,this.transform.position.elements),qS.setValue(5,this.forward.elements),qS.setValue(6,this.up.elements)},qS._prepareCameraViewProject=function(qS,q_){var qa=this._shaderValues;qa.setValue(1,qS.elements),qa.setValue(2,q_.elements)},qS._renderCamera=function(qS,q_,qa){},qS.addLayer=function(qS){29!==qS.number&&30!=qS.number&&(this.cullingMask=this.cullingMask|qS.mask)},qS.removeLayer=function(qS){29!==qS.number&&30!=qS.number&&(this.cullingMask=this.cullingMask&~qS.mask)},qS.addAllLayers=function(){this.cullingMask=2147483647},qS.removeAllLayers=function(){this.cullingMask=0|qu.getLayerByNumber(29).mask|qu.getLayerByNumber(30).mask},qS.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},qS.moveForward=function(qS){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=qS,this.transform.translate(this._tempVector3)},qS.moveRight=function(qS){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=qS,this.transform.translate(this._tempVector3)},qS.moveVertical=function(qS){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=qS,this.transform.translate(this._tempVector3,!1)},qS._addSelfRenderObjects=function(){var qS=this.scene._cameraPool,q_=qS.length;if(0<q_){for(var qa=q_-1;0<=qa;qa--)if(this.renderingOrder<=qS[qa].renderingOrder){qS.splice(qa+1,0,this);break}}else qS.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},qS._clearSelfRenderObjects=function(){var qS=this.scene._cameraPool;qS.splice(qS.indexOf(this),1)},qS.destroy=function(qS){void 0===qS&&(qS=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,qQ.stage.off("resize",this,this._onScreenSizeChanged),q_.prototype.destroy.call(this,qS)},qt(0,qS,"sky",function(){return this._sky},function(qS){(this._sky=qS)._ownerCamera=this}),qt(0,qS,"forward",function(){var qS=this.transform.worldMatrix.elements,q_=this._forward.elements;return q_[0]=-qS[8],q_[1]=-qS[9],q_[2]=-qS[10],this._forward}),qt(0,qS,"position",function(){var qS=this.transform.worldMatrix.elements,q_=this._position.elements;return q_[0]=qS[12],q_[1]=qS[13],q_[2]=qS[14],this._position}),qt(0,qS,"renderTarget",function(){return this._renderTarget},function(qS){null!=(this._renderTarget=qS)&&(this._renderTargetSize=qS.size)}),qt(0,qS,"up",function(){var qS=this.transform.worldMatrix.elements,q_=this._up.elements;return q_[0]=qS[4],q_[1]=qS[5],q_[2]=qS[6],this._up}),qt(0,qS,"right",function(){var qS=this.transform.worldMatrix.elements,q_=this._right.elements;return q_[0]=qS[0],q_[1]=qS[1],q_[2]=qS[2],this._right}),qt(0,qS,"renderTargetSize",function(){return this._renderTargetSize},function(qS){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=qS,this._calculateProjectionMatrix()}),qt(0,qS,"fieldOfView",function(){return this._fieldOfView},function(qS){this._fieldOfView=qS,this._calculateProjectionMatrix()}),qt(0,qS,"nearPlane",function(){return this._nearPlane},function(qS){this._nearPlane=qS,this._calculateProjectionMatrix()}),qt(0,qS,"farPlane",function(){return this._farPlane},function(qS){this._farPlane=qS,this._calculateProjectionMatrix()}),qt(0,qS,"orthographic",function(){return this._orthographic},function(qS){this._orthographic=qS,this._calculateProjectionMatrix()}),qt(0,qS,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(qS){this._orthographicVerticalSize=qS,this._calculateProjectionMatrix()}),qt(0,qS,"renderingOrder",function(){return this._renderingOrder},function(qS){this._renderingOrder=qS,this._sortCamerasByRenderingOrder()}),qa.CAMERAPOS=0,qa.VIEWMATRIX=1,qa.PROJECTMATRIX=2,qa.VPMATRIX=3,qa.VPMATRIX_NO_TRANSLATE=4,qa.CAMERADIRECTION=5,qa.CAMERAUP=6,qa.ENVIRONMENTDIFFUSE=7,qa.ENVIRONMENTSPECULAR=8,qa.SIMLODINFO=9,qa.DIFFUSEIRRADMATR=10,qa.DIFFUSEIRRADMATG=11,qa.DIFFUSEIRRADMATB=12,qa.HDREXPOSURE=13,qa.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",qa.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",qa.CLEARFLAG_SOLIDCOLOR=0,qa.CLEARFLAG_SKY=1,qa.CLEARFLAG_DEPTHONLY=2,qa.CLEARFLAG_NONE=3,qL(qa,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new qS_(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new qS_},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new qS_}]),qa}(qP_),qZ_=function(qa){function q_(qS){this._render=null,this._geometryFilter=null,q_.__super.call(this,qS)}qG(q_,"laya.d3.core.RenderableSprite3D",qa);var qS=q_.prototype;return qS._addToInitStaticBatchManager=function(){},qS._setBelongScene=function(qS){qa.prototype._setBelongScene.call(this,qS),qS._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},qS._setUnBelongScene=function(){var qS=this._scene._renderableSprite3Ds,q_=qS.indexOf(this);qS.splice(q_,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),qa.prototype._setUnBelongScene.call(this)},qS._update=function(qS){(qS.owner=this)._activeInHierarchy&&(this._updateComponents(qS),this._render._updateOctreeNode(),this._lateUpdateComponents(qS),qN.spriteCount++,this._childs.length&&this._updateChilds(qS))},qS.destroy=function(qS){void 0===qS&&(qS=!0),qa.prototype.destroy.call(this,qS),this._render._destroy(),this._render=null},q_.__init__=function(){q_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=q_.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),q_.SAHDERDEFINE_LIGHTMAP=q_.shaderDefines.registerDefine("LIGHTMAP")},q_.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,q_.SAHDERDEFINE_LIGHTMAP=4,q_.LIGHTMAPSCALEOFFSET=2,q_.LIGHTMAP=3,qL(q_,["shaderDefines",function(){return this.shaderDefines=new qH_}]),q_}(qP_),qp_=(function(qS){function qR(qS,q_,qa){this._long=NaN,this._width=NaN,this._height=NaN,void 0===qS&&(qS=1),void 0===q_&&(q_=1),void 0===qa&&(qa=1),qR.__super.call(this),this._long=qS,this._width=q_,this._height=qa,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}qG(qR,"laya.d3.resource.models.BoxMesh",qs_);var q_=qR.prototype;q_.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var qS=qAS.vertexDeclaration,q_=(qS.vertexStride,this._long/2),qa=this._height/2,qR=this._width/2,qJ=new Float32Array([-q_,qa,-qR,0,1,0,0,0,q_,qa,-qR,0,1,0,1,0,q_,qa,qR,0,1,0,1,1,-q_,qa,qR,0,1,0,0,1,-q_,-qa,-qR,0,-1,0,0,1,q_,-qa,-qR,0,-1,0,1,1,q_,-qa,qR,0,-1,0,1,0,-q_,-qa,qR,0,-1,0,0,0,-q_,qa,-qR,-1,0,0,0,0,-q_,qa,qR,-1,0,0,1,0,-q_,-qa,qR,-1,0,0,1,1,-q_,-qa,-qR,-1,0,0,0,1,q_,qa,-qR,1,0,0,1,0,q_,qa,qR,1,0,0,0,0,q_,-qa,qR,1,0,0,0,1,q_,-qa,-qR,1,0,0,1,1,-q_,qa,qR,0,0,1,0,0,q_,qa,qR,0,0,1,1,0,q_,-qa,qR,0,0,1,1,1,-q_,-qa,qR,0,0,1,0,1,-q_,qa,-qR,0,0,-1,1,0,q_,qa,-qR,0,0,-1,0,0,q_,-qa,-qR,0,0,-1,0,1,-q_,-qa,-qR,0,0,-1,1,1]),qV=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new qg_(qS,this._numberVertices,35044,!0),this._indexBuffer=new qe_("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(qJ),this._indexBuffer.setData(qV),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},qt(0,q_,"long",function(){return this._long},function(qS){this._long!==qS&&(this._long=qS,this.releaseResource(),this.activeResource())}),qt(0,q_,"width",function(){return this._width},function(qS){this._width!==qS&&(this._width=qS,this.releaseResource(),this.activeResource())}),qt(0,q_,"height",function(){return this._height},function(qS){this._height!==qS&&(this._height=qS,this.releaseResource(),this.activeResource())})}(),function(qS){function qW(qS,q_,qa){void 0===qS&&(qS=0),void 0===q_&&(q_=.3),void 0===qa&&(qa=1e3),this._viewMatrix=new qS_,this._projectionMatrix=new qS_,this._projectionViewMatrix=new qS_,this._viewport=new qz_(0,0,0,0),this._normalizedViewport=new qz_(0,0,1,1),this._aspectRatio=qS,this._boundFrustumUpdate=!0,this._boundFrustum=new qOS(qS_.DEFAULT),qW.__super.call(this,q_,qa),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}qG(qW,"laya.d3.core.Camera",qi_);var q_=qW.prototype;return q_._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},q_._parseCustomProps=function(qS,q_,qa,qR){var qJ=qa.clearColor;this.clearColor=new qk_(qJ[0],qJ[1],qJ[2],qJ[3]);var qV=qa.viewport;this.normalizedViewport=new qz_(qV[0],qV[1],qV[2],qV[3])},q_._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var qS=this.orthographicVerticalSize*this.aspectRatio*.5,q_=.5*this.orthographicVerticalSize;qS_.createOrthoOffCenterRH(-qS,qS,-q_,q_,this.nearPlane,this.farPlane,this._projectionMatrix)}else qS_.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},q_._update=function(qS){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,qS)},q_._renderCamera=function(qS,q_,qa){var qR,qJ;qa.parallelSplitShadowMaps[0]&&qa._renderShadowMap(qS,q_,this),(q_.camera=this)._prepareCameraToRender(),qa._preRenderUpdateComponents(q_),qR=q_._viewMatrix=this.viewMatrix;var qV=this._renderTarget;qV?(qV.start(),qS_.multiply(qi_._invertYScaleMatrix,this._projectionMatrix,qi_._invertYProjectionMatrix),qS_.multiply(qi_._invertYScaleMatrix,this.projectionViewMatrix,qi_._invertYProjectionViewMatrix),qJ=q_._projectionMatrix=qi_._invertYProjectionMatrix,q_._projectionViewMatrix=qi_._invertYProjectionViewMatrix):(qJ=q_._projectionMatrix=this._projectionMatrix,q_._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(qR,qJ),q_._viewport=this.viewport,qa._preRenderScene(qS,q_,this.boundFrustum),qa._clear(qS,q_),qa._renderScene(qS,q_),qa._postRenderUpdateComponents(q_),qV&&qV.end()},q_.viewportPointToRay=function(qS,q_){qt_.calculateCursorRay(qS,this.viewport,this._projectionMatrix,this.viewMatrix,null,q_)},q_.normalizedViewportPointToRay=function(qS,q_){var qa=qW._tempVector20,qR=this.viewport,qJ=qS.elements,qV=qa.elements;qV[0]=qJ[0]*qR.width,qV[1]=qJ[1]*qR.height,qt_.calculateCursorRay(qa,this.viewport,this._projectionMatrix,this.viewMatrix,null,q_)},q_.worldToViewportPoint=function(qS,q_){qS_.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(qS,this._projectionViewMatrix,q_);var qa=q_.elements;qa[0]=qa[0]/qQ.stage.clientScaleX,qa[1]=qa[1]/qQ.stage.clientScaleY},q_.worldToNormalizedViewportPoint=function(qS,q_){qS_.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(qS,this._projectionViewMatrix,q_);var qa=q_.elements;qa[0]=qa[0]/qQ.stage.clientScaleX,qa[1]=qa[1]/qQ.stage.clientScaleY},q_.convertScreenCoordToOrthographicCoord=function(qS,q_){if(this._orthographic){var qa=qy.clientWidth,qR=qy.clientHeight,qJ=this.orthographicVerticalSize*this.aspectRatio/qa,qV=this.orthographicVerticalSize/qR,qW=qS.elements,qk=q_.elements;return qk[0]=(-qa/2+qW[0])*qJ,qk[1]=(qR/2-qW[1])*qV,qk[2]=(this.nearPlane-this.farPlane)*(qW[2]+1)/2-this.nearPlane,qW_.transformCoordinate(q_,this.transform.worldMatrix,q_),!0}return!1},qt(0,q_,"projectionViewMatrix",function(){return qS_.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),qt(0,q_,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var qS=this.viewport;return qS.width/qS.height},function(qS){if(qS<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=qS,this._calculateProjectionMatrix()}),qt(0,q_,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),qt(0,q_,"needViewport",function(){var qS=this.normalizedViewport;return 0===qS.x&&0===qS.y&&1===qS.width&&1===qS.height}),qt(0,q_,"viewport",function(){if(this._viewportExpressedInClipSpace){var qS=this._normalizedViewport,q_=this.renderTargetSize,qa=q_.width,qR=q_.height;this._viewport.x=qS.x*qa,this._viewport.y=qS.y*qR,this._viewport.width=qS.width*qa,this._viewport.height=qS.height*qR}return this._viewport},function(qS){if(null!=this.renderTarget&&(qS.x<0||qS.y<0||0==qS.width||0==qS.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=qS,this._calculateProjectionMatrix()}),qt(0,q_,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var qS=this._viewport,q_=this.renderTargetSize,qa=q_.width,qR=q_.height;this._normalizedViewport.x=qS.x/qa,this._normalizedViewport.y=qS.y/qR,this._normalizedViewport.width=qS.width/qa,this._normalizedViewport.height=qS.height/qR}return this._normalizedViewport},function(qS){qS.x<0&&(qS.x=0,console.warn("Camera: viewport.x must large than 0.0.")),qS.y<0&&(qS.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<qS.x+qS.width&&(qS.width=1-qS.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<qS.y+qS.height&&(qS.height=1-qS.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=qS,this._calculateProjectionMatrix()}),qt(0,q_,"projectionMatrix",function(){return this._projectionMatrix},function(qS){this._projectionMatrix=qS,this._useUserProjectionMatrix=!0}),qt(0,q_,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),qL(qW,["_tempVector20",function(){return this._tempVector20=new qV_}]),qW}()),qc_=function(qa){function qR(qS,q_){qR.__super.call(this,q_),this._geometryFilter=new qh_(this),this._render=new qu_(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),qS&&(this._geometryFilter.sharedMesh=qS)instanceof laya.d3.resource.models.Mesh&&(qS.loaded?this._render.sharedMaterials=qS.materials:qS.once("loaded",this,this._applyMeshMaterials))}qG(qR,"laya.d3.core.MeshSprite3D",qa);var qS=qR.prototype;return qS._changeRenderObjectByMesh=function(qS){var q_=this._render._renderElements,qa=q_[qS];qa||(qa=q_[qS]=new qq_),qa._render=this._render;var qR=this._render.sharedMaterials[qS];qR||(qR=qr_.defaultMaterial);var qJ=this._geometryFilter.sharedMesh.getRenderElement(qS);return qa._mainSortID=this._getSortID(qJ,qR),qa._sprite3D=this,qa.renderObj=qJ,qa._material=qR,qa},qS._changeRenderObjectByMaterial=function(qS,q_){var qa=this._render._renderElements[qS];q_||(q_=qr_.defaultMaterial);var qR=this._geometryFilter.sharedMesh.getRenderElement(qS);return qa._mainSortID=this._getSortID(qR,q_),qa._sprite3D=this,qa.renderObj=qR,qa._material=q_,qa},qS._changeRenderObjectsByMesh=function(){var qS=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=qS;for(var q_=0;q_<qS;q_++)this._changeRenderObjectByMesh(q_)},qS._onMeshChanged=function(qS){var q_=qS.sharedMesh;q_.loaded?this._changeRenderObjectsByMesh():q_.once("loaded",this,this._onMeshLoaded)},qS._onMeshLoaded=function(qS){qS===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},qS._onMaterialChanged=function(qS,q_,qa){q_<this._render._renderElements.length&&this._changeRenderObjectByMaterial(q_,qa)},qS._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},qS._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},qS._parseCustomProps=function(qS,q_,qa,qR){var qJ=this.meshRender,qV=qa.lightmapIndex;null!=qV&&(qJ.lightmapIndex=qV);var qW,qk,qz=qa.lightmapScaleOffset;if(qz&&(qJ.lightmapScaleOffset=new qk_(qz[0],qz[1],qz[2],qz[3])),qR.instanceParams)(qW=qR.instanceParams.loadPath)&&(qk=qF.getRes(q_[qW]),(this.meshFilter.sharedMesh=qk).loaded?qJ.sharedMaterials=qk.materials:qk.once("loaded",this,this._applyMeshMaterials));else{(qW=qa.meshPath)&&(qk=qF.getRes(q_[qW]),this.meshFilter.sharedMesh=qk);var qb=qa.materials;if(qb){var qH=qJ.sharedMaterials,qL=qb.length;qH.length=qL;for(var qC=0;qC<qL;qC++)qH[qC]=qF.getRes(q_[qb[qC].path]);qJ.sharedMaterials=qH}}},qS._applyMeshMaterials=function(qS){for(var q_=this._render.sharedMaterials,qa=qS.materials,qR=0,qJ=qa.length;qR<qJ;qR++)q_[qR]||(q_[qR]=qa[qR]);this._render.sharedMaterials=q_},qS._addToInitStaticBatchManager=function(){qR._staticBatchManager._addInitBatchSprite(this)},qS.cloneTo=function(qS){var q_=qS;q_._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var qa=this._render,qR=q_._render;qR.enable=qa.enable,qR.sharedMaterials=qa.sharedMaterials,qR.castShadow=qa.castShadow;var qJ=qa.lightmapScaleOffset;qJ&&(qR.lightmapScaleOffset=qJ.clone()),qR.lightmapIndex=qa.lightmapIndex,qR.receiveShadow=qa.receiveShadow,qR.sortingFudge=qa.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,qS)},qS.destroy=function(qS){if(void 0===qS&&(qS=!0),!this.destroyed){var q_=this.meshFilter.sharedMesh;null!=q_&&(q_.loaded||q_.off("loaded",this,this._applyMeshMaterials)),qa.prototype.destroy.call(this,qS),this._geometryFilter._destroy()}},qt(0,qS,"meshFilter",function(){return this._geometryFilter}),qt(0,qS,"meshRender",function(){return this._render}),qR.__init__=function(){qRS._staticBatchManagers.push(qR._staticBatchManager)},qR.load=function(qS){return qQ.loader.create(qS,null,null,qR)},qL(qR,["_staticBatchManager",function(){return this._staticBatchManager=new qn_}]),qR}(qZ_)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}}),function(qS,q_,qJS){qJS.un,qJS.uns;var qa=qJS.static,qR=qJS.class,qV=qJS.getset,qo=qJS.__newvec,qk=laya.maths.Bezier,qL=laya.utils.Browser,qAS=laya.utils.Byte,qJ=(laya.events.Event,laya.events.EventDispatcher),qW=laya.display.Graphics,qz=(laya.resource.HTMLCanvas,laya.utils.Handler),qb=laya.net.Loader,qC=laya.maths.MathUtil,qXS=laya.maths.Matrix,q$=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),qH=(laya.renders.RenderContext,laya.resource.Resource),qG=laya.utils.RunDriver,qVS=laya.display.Sprite,qt=laya.utils.Stat,qhS=laya.resource.Texture,qF=(laya.net.URL,laya.utils.Utils),qX=function(){function qS(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return qR(qS,"laya.ani.AnimationContent"),qS}(),qh=function(){function qS(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return qR(qS,"laya.ani.AnimationNodeContent"),qS}(),qD=function(){function qS(){}return qR(qS,"laya.ani.AnimationParser01"),qS.parse=function(qS,q_){var qa=q_.__getBuffer(),qR=0,qJ=0,qV=0,qW=0,qk=0,qz=0,qb=0,qH=q_.readUTFString();qS._aniClassName=qH;var qL,qC=q_.readUTFString().split("\n"),qG=q_.getUint8(),qt=q_.getUint32(),qo=q_.getUint32();0<qt&&(qL=qa.slice(qt,qo));var q$=new qAS(qL);for(0<qo&&(qS._publicExtData=qa.slice(qo,qa.byteLength)),qS._useParent=!!q_.getUint8(),qS._anis.length=qG,qR=0;qR<qG;qR++){var qF=qS._anis[qR]=new qX;qF.nodes=new Array;var qT=qF.name=qC[q_.getUint16()];qS._aniMap[qT]=qR,qF.bone3DMap={},qF.playTime=q_.getFloat32(),qF.playTime<=0&&console.error("播放时间不能为0  url="+qS.url+" name="+qF.name);var qD=qF.nodes.length=q_.getUint8();for(qJ=qF.totalKeyframeDatasLength=0;qJ<qD;qJ++){var qj=qF.nodes[qJ]=new qh;qj.childs=[];var qQ=q_.getInt16();0<=qQ&&(qj.name=qC[qQ],qF.bone3DMap[qj.name]=qJ),qj.keyFrame=new Array,qj.parentIndex=q_.getInt16(),-1==qj.parentIndex?qj.parent=null:qj.parent=qF.nodes[qj.parentIndex],qj.lerpType=q_.getUint8();var qm=q_.getUint32();q$.pos=qm;var qq=qj.keyframeWidth=q$.getUint16();if(qF.totalKeyframeDatasLength+=qq,0===qj.lerpType||1===qj.lerpType)for(qj.interpolationMethod=[],qj.interpolationMethod.length=qq,qV=0;qV<qq;qV++)qj.interpolationMethod[qV]=qP.interpolation[q$.getUint8()];null!=qj.parent&&qj.parent.childs.push(qj);var qN=q_.getUint16();0<qN&&(qj.extenData=qa.slice(q_.pos,q_.pos+qN),q_.pos+=qN);var qn,ql=q_.getUint16(),qB=0;for(qV=0,qW=qj.keyFrame.length=ql;qV<qW;qV++){if((qn=qj.keyFrame[qV]=new qu).duration=q_.getFloat32(),qn.startTime=qB,2===qj.lerpType){qn.interpolationData=[];var qI,qA=q_.getUint8();switch(qI=q_.getFloat32()){case 254:for(qn.interpolationData.length=qq,qb=0;qb<qq;qb++)qn.interpolationData[qb]=0;break;case 255:for(qn.interpolationData.length=qq,qb=0;qb<qq;qb++)qn.interpolationData[qb]=5;break;default:for(qn.interpolationData.push(qI),qz=1;qz<qA;qz++)qn.interpolationData.push(q_.getFloat32())}}for(qn.data=new Float32Array(qq),qk=0;qk<qq;qk++)qn.data[qk]=q_.getFloat32(),-1e-8<qn.data[qk]&&qn.data[qk]<1e-8&&(qn.data[qk]=0);qB+=qn.duration}qn.startTime=qF.playTime,qj.playTime=qF.playTime,qS._calculateKeyFrame(qj,ql,qq)}}},qS}(),qj=function(){function qQ(){}return qR(qQ,"laya.ani.AnimationParser02"),qQ.READ_DATA=function(){qQ._DATA.offset=qQ._reader.getUint32(),qQ._DATA.size=qQ._reader.getUint32()},qQ.READ_BLOCK=function(){for(var qS=qQ._BLOCK.count=qQ._reader.getUint16(),q_=qQ._BLOCK.blockStarts=[],qa=qQ._BLOCK.blockLengths=[],qR=0;qR<qS;qR++)q_.push(qQ._reader.getUint32()),qa.push(qQ._reader.getUint32())},qQ.READ_STRINGS=function(){var qS=qQ._reader.getUint32(),q_=qQ._reader.getUint16(),qa=qQ._reader.pos;qQ._reader.pos=qS+qQ._DATA.offset;for(var qR=0;qR<q_;qR++)qQ._strings[qR]=qQ._reader.readUTFString();qQ._reader.pos=qa},qQ.parse=function(qS,q_){qQ._templet=qS;(qQ._reader=q_).__getBuffer();qQ.READ_DATA(),qQ.READ_BLOCK(),qQ.READ_STRINGS();for(var qa=0,qR=qQ._BLOCK.count;qa<qR;qa++){var qJ=q_.getUint16(),qV=qQ._strings[qJ],qW=qQ["READ_"+qV];if(null==qW)throw new Error("model file err,no this function:"+qJ+" "+qV);qW.call()}},qQ.READ_ANIMATIONS=function(){var qS=qQ._reader,q_=qS.__getBuffer(),qa=0,qR=0,qJ=0,qV=0,qW=qS.getUint16(),qk=[];for(qk.length=qW,qa=0;qa<qW;qa++)qk[qa]=qP.interpolation[qS.getByte()];var qz=qS.getUint8();for(qQ._templet._anis.length=qz,qa=0;qa<qz;qa++){var qb=qQ._templet._anis[qa]={};qb.nodes=new Array;var qH=qb.name=qQ._strings[qS.getUint16()];qQ._templet._aniMap[qH]=qa,qb.bone3DMap={},qb.playTime=qS.getFloat32();var qL=qb.nodes.length=qS.getInt16();for(qR=qb.totalKeyframeDatasLength=0;qR<qL;qR++){var qC=qb.nodes[qR]={};qC.keyframeWidth=qW,qC.childs=[];var qG=qS.getUint16();0<=qG&&(qC.name=qQ._strings[qG],qb.bone3DMap[qC.name]=qR),qC.keyFrame=new Array,qC.parentIndex=qS.getInt16(),-1==qC.parentIndex?qC.parent=null:qC.parent=qb.nodes[qC.parentIndex],qb.totalKeyframeDatasLength+=qW,qC.interpolationMethod=qk,null!=qC.parent&&qC.parent.childs.push(qC);var qt=qS.getUint16(),qo=null,q$=null;for(qJ=0,qV=qC.keyFrame.length=qt;qJ<qV;qJ++){(qo=qC.keyFrame[qJ]={}).startTime=qS.getFloat32(),q$&&(q$.duration=qo.startTime-q$.startTime);var qF=qQ._DATA.offset,qT=qS.getUint32(),qD=4*qW,qj=q_.slice(qF+qT,qF+qT+qD);qo.data=new Float32Array(qj),q$=qo}qo.duration=0,qC.playTime=qb.playTime,qQ._templet._calculateKeyFrame(qC,qt,qW)}}},qQ._templet=null,qQ._reader=null,qQ._strings=[],qa(qQ,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),qQ}(),quS=(function(){function qS(){}qR(qS,"laya.ani.AnimationState"),qS.stopped=0,qS.paused=1,qS.playing=2}(),function(){function qJ(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new qZS,this.resultMatrix=new qXS,this._children=[]}qR(qJ,"laya.ani.bone.Bone");var qS=qJ.prototype;return qS.setTempMatrix=function(qS){this._tempMatrix=qS;var q_,qa=0;for(qa=0,q_=this._children.length;qa<q_;qa++)this._children[qa].setTempMatrix(this._tempMatrix)},qS.update=function(qS){var q_;if(this.rotation=this.transform.skX,qS)q_=this.resultTransform.getMatrix(),qXS.mul(q_,qS,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)q_=this.resultTransform.getMatrix(),qXS.mul(q_,this.parentBone.resultMatrix,this.resultMatrix);else{var qa=this.parentBone,qR=NaN,qJ=NaN,qV=NaN,qW=this.parentBone.resultMatrix;q_=this.resultTransform.getMatrix();var qk=qW.a*q_.tx+qW.c*q_.ty+qW.tx,qz=qW.b*q_.tx+qW.d*q_.ty+qW.ty,qb=new qXS;this.inheritRotation?(qR=Math.atan2(qa.resultMatrix.b,qa.resultMatrix.a),qJ=Math.cos(qR),qV=Math.sin(qR),qb.setTo(qJ,qV,-qV,qJ,0,0),qXS.mul(this._tempMatrix,qb,qXS.TEMP),qXS.TEMP.copyTo(qb),q_=this.resultTransform.getMatrix(),qXS.mul(q_,qb,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,q_=this.resultTransform.getMatrix(),qXS.TEMP.identity(),qXS.TEMP.d=this.d,qXS.mul(q_,qXS.TEMP,this.resultMatrix)),this.resultMatrix.tx=qk,this.resultMatrix.ty=qz}else(q_=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var qH,qL=0;for(qL=0,qH=this._children.length;qL<qH;qL++)this._children[qL].update()},qS.updateChild=function(){var qS,q_=0;for(q_=0,qS=this._children.length;q_<qS;q_++)this._children[q_].update()},qS.setRotation=function(qS){this._sprite&&(this._sprite.rotation=180*qS/Math.PI)},qS.updateDraw=function(qS,q_){qJ.ShowBones&&!qJ.ShowBones[this.name]||(this._sprite||(this._sprite=new qVS,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),qJS.stage.addChild(this._sprite)),this._sprite.x=qS+this.resultMatrix.tx,this._sprite.y=q_+this.resultMatrix.ty);var qa,qR=0;for(qR=0,qa=this._children.length;qR<qa;qR++)this._children[qR].updateDraw(qS,q_)},qS.addChild=function(qS){this._children.push(qS),qS.parentBone=this},qS.findBone=function(qS){if(this.name==qS)return this;var q_,qa,qR=0;for(qR=0,q_=this._children.length;qR<q_;qR++)if(qa=this._children[qR].findBone(qS))return qa;return null},qS.localToWorld=function(qS){var q_=qS[0],qa=qS[1];qS[0]=q_*this.resultMatrix.a+qa*this.resultMatrix.c+this.resultMatrix.tx,qS[1]=q_*this.resultMatrix.b+qa*this.resultMatrix.d+this.resultMatrix.ty},qJ.ShowBones={},qJ}()),qKS=function(){function qo(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}qR(qo,"laya.ani.bone.BoneSlot");var qS=qo.prototype;return qS.showSlotData=function(qS,q_){void 0===q_&&(q_=!0),this.currSlotData=qS,q_&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},qS.showDisplayByName=function(qS){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(qS))},qS.replaceDisplayByName=function(qS,q_){if(this.currSlotData){var qa;qa=this.currSlotData.getDisplayByName(qS);var qR;qR=this.currSlotData.getDisplayByName(q_),this.replaceDisplayByIndex(qa,qR)}},qS.replaceDisplayByIndex=function(qS,q_){this.currSlotData&&(this._replaceDic[qS]=q_,this.displayIndex==qS&&this.showDisplayByIndex(qS))},qS.showDisplayByIndex=function(qS){if(null!=this._replaceDic[qS]&&(qS=this._replaceDic[qS]),this.currSlotData&&-1<qS&&qS<this.currSlotData.displayArr.length){if(this.displayIndex=qS,this.currDisplayData=this.currSlotData.displayArr[qS],this.currDisplayData){var q_=this.currDisplayData.name;this.currTexture=this.templet.getTexture(q_),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!q$.isConchApp||q$.isConchApp&&"0.9.15"<qVS.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},qS.replaceSkin=function(qS){this._diyTexture=qS,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},qS.setParentMatrix=function(qS){this._parentMatrix=qS},qS.draw=function(qS,q_,qa,qR){if(void 0===qa&&(qa=!1),void 0===qR&&(qR=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var qJ,qV=this.currTexture;switch(this._diyTexture&&(qV=this._diyTexture),this.currDisplayData.type){case 0:if(qS){var qW=this.getDisplayMatrix();if(this._parentMatrix){var qk=!1;if(qW){var qz;if(qXS.mul(qW,this._parentMatrix,qXS.TEMP),qz=qa?(null==this._resultMatrix&&(this._resultMatrix=new qXS),this._resultMatrix):new qXS,!q$.isWebGL&&this.currDisplayData.uvs||q$.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var qb=qo._tempMatrix;qb.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(qb.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(qk=!0,qb.rotate(-Math.PI/2)),qXS.mul(qb,qXS.TEMP,qz)}else qXS.TEMP.copyTo(qz);qk?qS.drawTexture(qV,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,qz):qS.drawTexture(qV,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,qz)}}}break;case 1:if(null==(qJ=qa?(null==this._skinSprite&&(this._skinSprite=qo.createSkinMesh()),this._skinSprite):qo.createSkinMesh()))return;var qH;if(null==this.currDisplayData.bones){var qL,qC=this.currDisplayData.weights;this.deformData&&(qC=this.deformData),qL=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=qq.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=qq.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=qC;this.currDisplayData.triangles.length;qH=this.currDisplayData.triangles,qJ.init2(qV,null,qH,this._mVerticleArr,qL);var qG,qt=this.getDisplayMatrix();if(this._parentMatrix)if(qt)qXS.mul(qt,this._parentMatrix,qXS.TEMP),qG=qa?(null==this._resultMatrix&&(this._resultMatrix=new qXS),this._resultMatrix):new qXS,qXS.TEMP.copyTo(qG),qJ.transform=qG}else this.skinMesh(q_,qJ,qR);qS.drawSkin(qJ);break;case 2:if(null==(qJ=qa?(null==this._skinSprite&&(this._skinSprite=qo.createSkinMesh()),this._skinSprite):qo.createSkinMesh()))return;this.skinMesh(q_,qJ,qR),qS.drawSkin(qJ)}}},qS.skinMesh=function(qS,q_,qa){var qR,qJ=this.currTexture,qV=this.currDisplayData.bones;qR=this._diyTexture?(qJ=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=qq.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=qq.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var qW,qk,qz=this.currDisplayData.weights,qb=this.currDisplayData.triangles,qH=0,qL=0,qC=0,qG=NaN,qt=NaN,qo=0,q$=0,qF=[],qT=0,qD=0;if(this.deformData&&0<this.deformData.length){var qj=0;for(qT=0,qD=qV.length;qT<qD;){for(qC=qV[qT++]+qT,qL=qH=0;qT<qC;qT++)qk=qS[qV[qT]],qG=qz[qo]+this.deformData[qj++],qt=qz[qo+1]+this.deformData[qj++],q$=qz[qo+2],qH+=(qG*qk.a+qt*qk.c+qk.tx)*q$,qL+=(qG*qk.b+qt*qk.d+qk.ty)*q$,qo+=3;qF.push(qH,qL)}}else for(qT=0,qD=qV.length;qT<qD;){for(qC=qV[qT++]+qT,qL=qH=0;qT<qC;qT++)qk=qS[qV[qT]],qG=qz[qo],qt=qz[qo+1],q$=qz[qo+2],qH+=(qG*qk.a+qt*qk.c+qk.tx)*q$,qL+=(qG*qk.b+qt*qk.d+qk.ty)*q$,qo+=3;qF.push(qH,qL)}this._mVerticleArr=qF,qW=qb,q_.init2(qJ,null,qW,this._mVerticleArr,qR)},qS.drawBonePoint=function(qS){qS&&this._parentMatrix&&qS.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},qS.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},qS.getMatrix=function(){return this._resultMatrix},qS.copy=function(){var qS=new qo;return qS.type="copy",qS.name=this.name,qS.attachmentName=this.attachmentName,qS.srcDisplayIndex=this.srcDisplayIndex,qS.parent=this.parent,qS.displayIndex=this.displayIndex,qS.templet=this.templet,qS.currSlotData=this.currSlotData,qS.currTexture=this.currTexture,qS.currDisplayData=this.currDisplayData,qS},qo.createSkinMesh=function(){return q$.isWebGL||q$.isConchApp?qG.skinAniSprite():(q$.isWebGL,null)},qa(qo,["_tempMatrix",function(){return this._tempMatrix=new qXS}]),qo}(),qPS=function(){function qS(){this.skinName=null,this.deformSlotDataList=[]}return qR(qS,"laya.ani.bone.DeformAniData"),qS}(),qMS=function(){function qS(){this.deformSlotDisplayList=[]}return qR(qS,"laya.ani.bone.DeformSlotData"),qS}(),qrS=function(){function qS(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}qR(qS,"laya.ani.bone.DeformSlotDisplayData");var q_=qS.prototype;return q_.binarySearch1=function(qS,q_){var qa=0,qR=qS.length-2;if(0==qR)return 1;for(var qJ=qR>>>1;;){if(qS[Math.floor(qJ+1)]<=q_?qa=qJ+1:qR=qJ,qa==qR)return qa+1;qJ=qa+qR>>>1}return 0},q_.apply=function(qS,q_,qa){if(void 0===qa&&(qa=1),qS+=.05,!(this.timeList.length<=0)){var qR=0;if(!(qS<this.timeList[0])){var qJ=this.vectices[0].length,qV=[],qW=this.binarySearch1(this.timeList,qS);if(this.frameIndex=qW,qS>=this.timeList[this.timeList.length-1]){var qk=this.vectices[this.vectices.length-1];if(qa<1)for(qR=0;qR<qJ;qR++)qV[qR]+=(qk[qR]-qV[qR])*qa;else for(qR=0;qR<qJ;qR++)qV[qR]=qk[qR];this.deformData=qV}else{this.tweenKeyList[this.frameIndex];var qz=this.vectices[this.frameIndex-1],qb=this.vectices[this.frameIndex],qH=this.timeList[this.frameIndex-1],qL=this.timeList[this.frameIndex];qa=this.tweenKeyList[qW-1]?(qS-qH)/(qL-qH):0;var qC=NaN;for(qR=0;qR<qJ;qR++)qC=qz[qR],qV[qR]=qC+(qb[qR]-qC)*qa;this.deformData=qV}}}},qS}(),qeS=function(){function qS(){this.time=NaN,this.drawOrder=[]}return qR(qS,"laya.ani.bone.DrawOrderData"),qS}(),qgS=function(){function qS(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return qR(qS,"laya.ani.bone.EventData"),qS}(),qT=function(){function qRS(qS,q_){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=qS,this._targetBone=q_[qS.targetBoneIndex],this.isSpine=qS.isSpine,null==this._bones&&(this._bones=[]);for(var qa=this._bones.length=0,qR=qS.boneIndexs.length;qa<qR;qa++)this._bones.push(q_[qS.boneIndexs[qa]]);this.name=qS.name,this.mix=qS.mix,this.bendDirection=qS.bendDirection}qR(qRS,"laya.ani.bone.IkConstraint");var qS=qRS.prototype;return qS.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},qS._applyIk1=function(qS,q_,qa,qR){var qJ=qS.parentBone,qV=1/(qJ.resultMatrix.a*qJ.resultMatrix.d-qJ.resultMatrix.b*qJ.resultMatrix.c),qW=q_-qJ.resultMatrix.tx,qk=qa-qJ.resultMatrix.ty,qz=(qW*qJ.resultMatrix.d-qk*qJ.resultMatrix.c)*qV-qS.transform.x,qb=(qk*qJ.resultMatrix.a-qW*qJ.resultMatrix.b)*qV-qS.transform.y,qH=Math.atan2(qb,qz)*qRS.radDeg-0-qS.transform.skX;qS.transform.scX<0&&(qH+=180),180<qH?qH-=360:qH<-180&&(qH+=360),qS.transform.skX=qS.transform.skY=qS.transform.skX+qH*qR,qS.update()},qS.updatePos=function(qS,q_){this._sp&&this._sp.pos(qS,q_)},qS._applyIk2=function(qS,q_,qa,qR,qJ,qV){if(0!=qV){var qW=qS.resultTransform.x,qk=qS.resultTransform.y,qz=qS.transform.scX,qb=qS.transform.scY,qH=q_.transform.scX,qL=0,qC=0,qG=0;qG=qz<0?(qz=-qz,qL=180,-1):(qL=0,1),qb<0&&(qb=-qb,qG=-qG),qC=qH<0?(qH=-qH,180):0;var qt=q_.resultTransform.x,qo=NaN,q$=NaN,qF=NaN,qT=qS.resultMatrix.a,qD=qS.resultMatrix.c,qj=qS.resultMatrix.b,qQ=qS.resultMatrix.d,qm=Math.abs(qz-qb)<=1e-4;qF=qm?(q$=qT*qt+qD*(qo=q_.resultTransform.y)+qS.resultMatrix.tx,qj*qt+qQ*qo+qS.resultMatrix.ty):(qo=0,q$=qT*qt+qS.resultMatrix.tx,qj*qt+qS.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new qVS,qJS.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(qa,qR,15,"#ffff00"),this._sp.graphics.drawCircle(q$,qF,15,"#ff00ff")),qS.setRotation(Math.atan2(qF-qS.resultMatrix.ty,q$-qS.resultMatrix.tx));var qq=qS.parentBone;qT=qq.resultMatrix.a,qD=qq.resultMatrix.c,qj=qq.resultMatrix.b;var qN=1/(qT*(qQ=qq.resultMatrix.d)-qD*qj),qn=qa-qq.resultMatrix.tx,ql=qR-qq.resultMatrix.ty,qB=(qn*qQ-ql*qD)*qN-qW,qI=(ql*qT-qn*qj)*qN-qk,qA=((qn=q$-qq.resultMatrix.tx)*qQ-(ql=qF-qq.resultMatrix.ty)*qD)*qN-qW,qX=(ql*qT-qn*qj)*qN-qk,qh=Math.sqrt(qA*qA+qX*qX),qu=q_.length*qH,qK=NaN,qP=NaN;if(qm){var qM=(qB*qB+qI*qI-qh*qh-(qu*=qz)*qu)/(2*qh*qu);qM<-1?qM=-1:1<qM&&(qM=1),qP=Math.acos(qM)*qJ,qT=qh+qu*qM,qD=qu*Math.sin(qP),qK=Math.atan2(qI*qT-qB*qD,qB*qT+qI*qD)}else{var qr=(qT=qz*qu)*qT,qe=(qD=qb*qu)*qD,qg=qB*qB+qI*qI,qx=Math.atan2(qI,qB),qs=-2*qe*qh,qU=qe-qr;if(0<(qQ=qs*qs-4*qU*(qj=qe*qh*qh+qr*qg-qr*qe))){var qf=Math.sqrt(qQ);qs<0&&(qf=-qf);var qY=(qf=-(qs+qf)/2)/qU,qi=qj/qf,qZ=Math.abs(qY)<Math.abs(qi)?qY:qi;qZ*qZ<=qg&&(ql=Math.sqrt(qg-qZ*qZ)*qJ,qK=qx-Math.atan2(ql,qZ),qP=Math.atan2(ql/qb,(qZ-qh)/qz))}var qp=0,qc=Number.MAX_VALUE,qy=0,qE=0,qO=0,qw=0,qv=0,qd=0;qw<(qQ=(qn=qh+qT)*qn)&&(qO=0,qw=qQ,qv=qn),(qQ=(qn=qh-qT)*qn)<qc&&(qp=Math.PI,qc=qQ,qy=qn);var qSS=Math.acos(-qT*qh/(qr-qe));(qQ=(qn=qT*Math.cos(qSS)+qh)*qn+(ql=qD*Math.sin(qSS))*ql)<qc&&(qp=qSS,qc=qQ,qy=qn,qE=ql),qw<qQ&&(qO=qSS,qw=qQ,qv=qn,qd=ql),qP=qg<=(qc+qw)/2?(qK=qx-Math.atan2(qE*qJ,qy),qp*qJ):(qK=qx-Math.atan2(qd*qJ,qv),qO*qJ)}var q_S=Math.atan2(qo,qt)*qG,qaS=qS.resultTransform.skX;180<(qK=(qK-q_S)*qRS.radDeg+qL-qaS)?qK-=360:qK<-180&&(qK+=360),qS.resultTransform.x=qW,qS.resultTransform.y=qk,qS.resultTransform.skX=qS.resultTransform.skY=qaS+qK*qV,qaS=q_.resultTransform.skX,180<(qP=((qP+q_S)*qRS.radDeg-0)*qG+qC-(qaS%=360))?qP-=360:qP<-180&&(qP+=360),q_.resultTransform.x=qt,q_.resultTransform.y=qo,q_.resultTransform.skX=q_.resultTransform.skY=q_.resultTransform.skY+qP*qV,qS.update()}},qS._applyIk3=function(qS,q_,qa,qR,qJ,qV){if(0!=qV){var qW,qk,qz=q_.resultMatrix.a*q_.length,qb=q_.resultMatrix.b*q_.length,qH=qz*qz+qb*qb,qL=Math.sqrt(qH),qC=qS.resultMatrix.tx,qG=qS.resultMatrix.ty,qt=q_.resultMatrix.tx,qo=q_.resultMatrix.ty,q$=qt-qC,qF=qo-qG,qT=q$*q$+qF*qF,qD=Math.sqrt(qT),qj=(q$=qa-qS.resultMatrix.tx)*q$+(qF=qR-qS.resultMatrix.ty)*qF,qQ=Math.sqrt(qj);if(qL+qD<=qQ||qQ+qL<=qD||qQ+qD<=qL){var qm=NaN;qt=qC+(qm=qL+qD<=qQ?1:-1)*(qa-qC)*qD/qQ,qo=qG+qm*(qR-qG)*qD/qQ}else{var qq=(qT-qH+qj)/(2*qj),qN=Math.sqrt(qT-qq*qq*qj)/qQ,qn=qC+q$*qq,ql=qG+qF*qq,qB=-qF*qN,qI=q$*qN;qo=0<qJ?(qt=qn-qB,ql-qI):(qt=qn+qB,ql+qI)}qW=qt,qk=qo,this.isDebug&&(this._sp||(this._sp=new qVS,qJS.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(qC,qG,15,"#ff00ff"),this._sp.graphics.drawCircle(qa,qR,15,"#ffff00"),this._sp.graphics.drawCircle(qW,qk,15,"#ff00ff"));var qA,qX;qA=Math.atan2(qk-qS.resultMatrix.ty,qW-qS.resultMatrix.tx),qS.setRotation(qA),(qX=qRS._tempMatrix).identity(),qX.rotate(qA),qX.scale(qS.resultMatrix.getScaleX(),qS.resultMatrix.getScaleY()),qX.translate(qS.resultMatrix.tx,qS.resultMatrix.ty),qX.copyTo(qS.resultMatrix),qS.updateChild();var qh,qu;qh=Math.atan2(qR-qk,qa-qW),q_.setRotation(qh),(qu=qRS._tempMatrix).identity(),qu.rotate(qh),qu.scale(q_.resultMatrix.getScaleX(),q_.resultMatrix.getScaleY()),qu.translate(qW,qk),qX.copyTo(q_.resultMatrix),q_.updateChild()}},qa(qRS,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new qXS}]),qRS}(),qxS=function(){function qS(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return qR(qS,"laya.ani.bone.IkConstraintData"),qS}(),qQ=function(){function qu(qS,q_){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=qS,this.position=qS.position,this.spacing=qS.spacing,this.rotateMix=qS.rotateMix,this.translateMix=qS.translateMix,this.bones=[];for(var qa=this.data.bones,qR=0,qJ=qa.length;qR<qJ;qR++)this.bones.push(q_[qa[qR]])}qR(qu,"laya.ani.bone.PathConstraint");var qS=qu.prototype;return qS.apply=function(qS,q_){if(this.target){var qa=this.translateMix,qR=this.translateMix,qJ=0<qR,qV=this.data.spacingMode,qW="length"==qV,qk=this.data.rotateMode,qz="tangent"==qk,qb="chainScale"==qk,qH=[],qL=this.bones.length,qC=qz?qL:qL+1,qG=[];(this._spaces=qG)[0]=this.position;var qt=this.spacing;if(qb||qW)for(var qo=0,q$=qC-1;qo<q$;){var qF=this.bones[qo],qT=qF.length,qD=qT*qF.resultMatrix.a,qj=qT*qF.resultMatrix.b;qT=Math.sqrt(qD*qD+qj*qj),qb&&(qH[qo]=qT),qG[++qo]=qW?Math.max(0,qT+qt):qt}else for(qo=1;qo<qC;qo++)qG[qo]=qt;var qQ=this.computeWorldPositions(this.target,qS,q_,qC,qz,"percent"==this.data.positionMode,"percent"==qV);if(this._debugKey){for(qo=0;qo<qQ.length;qo++)q_.drawCircle(qQ[qo++],qQ[qo++],5,"#00ff00");var qm=[];for(qo=0;qo<qQ.length;qo++)qm.push(qQ[qo++],qQ[qo++]);q_.drawLines(0,0,qm,"#ff0000")}var qq=qQ[0],qN=qQ[1],qn=this.data.offsetRotation,ql="chain"==qk&&0==qn,qB=NaN;for(qo=0,qB=3;qo<qL;qo++,qB+=3){(qF=this.bones[qo]).resultMatrix.tx+=(qq-qF.resultMatrix.tx)*qa,qF.resultMatrix.ty+=(qN-qF.resultMatrix.ty)*qa;var qI=(qD=qQ[qB])-qq,qA=(qj=qQ[qB+1])-qN;if(qb&&0!=(qT=qH[qo])){var qX=(Math.sqrt(qI*qI+qA*qA)/qT-1)*qR+1;qF.resultMatrix.a*=qX,qF.resultMatrix.c*=qX}if(qq=qD,qN=qj,qJ){var qh=qF.resultMatrix.a,qu=qF.resultMatrix.c,qK=qF.resultMatrix.b,qP=qF.resultMatrix.d,qM=NaN,qr=NaN,qe=NaN;qM=qz?qQ[qB-1]:0==qG[qo+1]?qQ[qB+2]:Math.atan2(qA,qI),qM-=Math.atan2(qK,qh)-qn/180*Math.PI,ql&&(qr=Math.cos(qM),qe=Math.sin(qM),qq+=((qT=qF.length)*(qr*qh-qe*qK)-qI)*qR,qN+=(qT*(qe*qh+qr*qK)-qA)*qR),qM>Math.PI?qM-=2*Math.PI:qM<-Math.PI&&(qM+=2*Math.PI),qM*=qR,qr=Math.cos(qM),qe=Math.sin(qM),qF.resultMatrix.a=qr*qh-qe*qK,qF.resultMatrix.c=qr*qu-qe*qP,qF.resultMatrix.b=qe*qh+qr*qK,qF.resultMatrix.d=qe*qu+qr*qP}}}},qS.computeWorldVertices2=function(qS,q_,qa,qR,qJ,qV){var qW,qk,qz=qS.currDisplayData.bones,qb=qS.currDisplayData.weights,qH=qS.currDisplayData.triangles,qL=0,qC=0,qG=0,qt=0,qo=0,q$=0,qF=0,qT=0,qD=0,qj=0,qQ=0;if(null!=qz){for(qL=0;qL<qa;qL+=2)qC+=(qt=qz[qC])+1,qG+=qt;var qm=q_;for(qo=qV,q$=3*qG;qo<qR;qo+=2){for(qT=qF=0,qt=qz[qC++],qt+=qC;qC<qt;qC++,q$+=3){qW=qm[qz[qC]].resultMatrix,qD=qb[q$],qj=qb[q$+1];var qq=qb[q$+2];qF+=(qD*qW.a+qj*qW.c+qW.tx)*qq,qT+=(qD*qW.b+qj*qW.d+qW.ty)*qq}qJ[qo]=qF,qJ[qo+1]=qT}}else{var qN,qn;if(qH||(qH=qb),qS.deformData&&(qH=qS.deformData),qN=qS.parent,q_)for(qQ=q_.length,qL=0;qL<qQ;qL++)if(q_[qL].name==qN){qk=q_[qL];break}qk&&(qn=qk.resultMatrix),qn||(qn=qu._tempMt);var ql=qn.tx,qB=qn.ty,qI=qn.a,qA=qn.b,qX=qn.c,qh=qn.d;for(qk&&(qh*=qk.d),qC=qa,qo=qV;qo<qR;qC+=2,qo+=2)qD=qH[qC],qj=qH[qC+1],qJ[qo]=qD*qI+qj*qA+ql,qJ[qo+1]=-(qD*qX+qj*qh+qB)}},qS.computeWorldPositions=function(qS,q_,qa,qR,qJ,qV,qW){qS.currDisplayData.bones,qS.currDisplayData.weights,qS.currDisplayData.triangles;var qk=[],qz=0,qb=qS.currDisplayData.verLen,qH=this.position,qL=this._spaces,qC=[],qG=[],qt=qb/6,qo=-1,q$=NaN,qF=0,qT=0,qD=NaN,qj=NaN,qQ=NaN,qm=NaN;if(qt--,qb-=4,this.computeWorldVertices2(qS,q_,2,qb,qk,0),this._debugKey)for(qz=0;qz<qk.length;)qa.drawCircle(qk[qz++],qk[qz++],10,"#ff0000");qC=qk,this._curves.length=qt;var qq=this._curves,qN=qC[q$=0],qn=qC[1],ql=0,qB=0,qI=0,qA=0,qX=0,qh=0,qu=NaN,qK=NaN,qP=NaN,qM=NaN,qr=NaN,qe=NaN,qg=NaN,qx=NaN,qs=0;for(qz=0,qs=2;qz<qt;qz++,qs+=6)ql=qC[qs],qB=qC[qs+1],qI=qC[qs+2],qA=qC[qs+3],qr=2*(qu=.1875*(qN-2*ql+qI))+(qP=.09375*(3*(ql-qI)-qN+(qX=qC[qs+4]))),qe=2*(qK=.1875*(qn-2*qB+qA))+(qM=.09375*(3*(qB-qA)-qn+(qh=qC[qs+5]))),qg=.75*(ql-qN)+qu+.16666667*qP,qx=.75*(qB-qn)+qK+.16666667*qM,q$+=Math.sqrt(qg*qg+qx*qx),qg+=qr,qx+=qe,qr+=qP,qe+=qM,q$+=Math.sqrt(qg*qg+qx*qx),qg+=qr,qx+=qe,q$+=Math.sqrt(qg*qg+qx*qx),qg+=qr+qP,qx+=qe+qM,q$+=Math.sqrt(qg*qg+qx*qx),qq[qz]=q$,qN=qX,qn=qh;if(qV&&(qH*=q$),qW)for(qz=0;qz<qR;qz++)qL[qz]*=q$;var qU=this._segments,qf=0,qY=0;for(qY=qT=qF=qz=0;qz<qR;qz++,qF+=3)if((qD=qH+=qj=qL[qz])<0)this.addBeforePosition(qD,qC,0,qG,qF);else if(q$<qD)this.addAfterPosition(qD-q$,qC,qb-4,qG,qF);else{for(;;qT++)if(!((qm=qq[qT])<qD)){0==qT?qD/=qm:qD=(qD-(qQ=qq[qT-1]))/(qm-qQ);break}if(qT!=qo){var qi=6*(qo=qT);for(qN=qC[qi],qn=qC[qi+1],ql=qC[qi+2],qB=qC[qi+3],qI=qC[qi+4],qA=qC[qi+5],qr=2*(qu=.03*(qN-2*ql+qI))+(qP=.006*(3*(ql-qI)-qN+(qX=qC[qi+6]))),qe=2*(qK=.03*(qn-2*qB+qA))+(qM=.006*(3*(qB-qA)-qn+(qh=qC[qi+7]))),qg=.3*(ql-qN)+qu+.16666667*qP,qx=.3*(qB-qn)+qK+.16666667*qM,qf=Math.sqrt(qg*qg+qx*qx),qU[0]=qf,qi=1;qi<8;qi++)qg+=qr,qx+=qe,qr+=qP,qe+=qM,qf+=Math.sqrt(qg*qg+qx*qx),qU[qi]=qf;qg+=qr,qx+=qe,qf+=Math.sqrt(qg*qg+qx*qx),qU[8]=qf,qg+=qr+qP,qx+=qe+qM,qf+=Math.sqrt(qg*qg+qx*qx),qU[9]=qf,qY=0}for(qD*=qf;;qY++)if(!((qm=qU[qY])<qD)){0==qY?qD/=qm:qD=qY+(qD-(qQ=qU[qY-1]))/(qm-qQ);break}this.addCurvePosition(.1*qD,qN,qn,ql,qB,qI,qA,qX,qh,qG,qF,qJ||0<qz&&0==qj)}return qG},qS.addBeforePosition=function(qS,q_,qa,qR,qJ){var qV=q_[qa],qW=q_[qa+1],qk=q_[qa+2]-qV,qz=q_[qa+3]-qW,qb=Math.atan2(qz,qk);qR[qJ]=qV+qS*Math.cos(qb),qR[qJ+1]=qW+qS*Math.sin(qb),qR[qJ+2]=qb},qS.addAfterPosition=function(qS,q_,qa,qR,qJ){var qV=q_[qa+2],qW=q_[qa+3],qk=qV-q_[qa],qz=qW-q_[qa+1],qb=Math.atan2(qz,qk);qR[qJ]=qV+qS*Math.cos(qb),qR[qJ+1]=qW+qS*Math.sin(qb),qR[qJ+2]=qb},qS.addCurvePosition=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH,qL){0==qS&&(qS=1e-4);var qC=qS*qS,qG=qC*qS,qt=1-qS,qo=qt*qt,q$=qo*qt,qF=qt*qS,qT=3*qF,qD=qt*qT,qj=qT*qS,qQ=q_*q$+qR*qD+qV*qj+qk*qG,qm=qa*q$+qJ*qD+qW*qj+qz*qG;qb[qH]=qQ,qb[qH+1]=qm,qb[qH+2]=qL?Math.atan2(qm-(qa*qo+qJ*qF*2+qW*qC),qQ-(q_*qo+qR*qF*2+qV*qC)):0},qu.NONE=-1,qu.BEFORE=-2,qu.AFTER=-3,qa(qu,["_tempMt",function(){return this._tempMt=new qXS}]),qu}(),qsS=function(){function qS(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return qR(qS,"laya.ani.bone.PathConstraintData"),qS}(),qUS=function(){function qS(){this.name=null,this.slotArr=[]}return qR(qS,"laya.ani.bone.SkinData"),qS}(),qfS=function(){function qS(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}qR(qS,"laya.ani.bone.SkinSlotDisplayData");var q_=qS.prototype;return q_.createTexture=function(qS){return this.texture||(this.texture=new qhS(qS.bitmap,this.uvs),qS.bitmap.alphaTexture&&(this.texture.alphaTexture=new qhS(qS.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=qS.height,this.texture.height=qS.width,this.texture.offsetX=-qS.offsetX,this.texture.offsetY=-qS.offsetY,this.texture.sourceWidth=qS.sourceHeight,this.texture.sourceHeight=qS.sourceWidth):(this.texture.width=qS.width,this.texture.height=qS.height,this.texture.offsetX=-qS.offsetX,this.texture.offsetY=-qS.offsetY,this.texture.sourceWidth=qS.sourceWidth,this.texture.sourceHeight=qS.sourceHeight),q$.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},q_.destory=function(){this.texture&&this.texture.destroy()},qS}(),qYS=function(){function qS(){this.name=null,this.displayArr=[]}return qR(qS,"laya.ani.bone.SlotData"),qS.prototype.getDisplayByName=function(qS){for(var q_=0,qa=this.displayArr.length;q_<qa;q_++)if(this.displayArr[q_].attachmentName==qS)return q_;return-1},qS}(),qm=function(){function qS(qS,q_){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=qo(2,0),this._data=qS,null==this._bones&&(this._bones=[]),this.target=q_[qS.targetIndex];var qa,qR=0;for(qR=0,qa=qS.boneIndexs.length;qR<qa;qR++)this._bones.push(q_[qS.boneIndexs[qR]]);this.rotateMix=qS.rotateMix,this.translateMix=qS.translateMix,this.scaleMix=qS.scaleMix,this.shearMix=qS.shearMix}return qR(qS,"laya.ani.bone.TfConstraint"),qS.prototype.apply=function(){for(var qS,q_=this.target.resultMatrix.a,qa=this.target.resultMatrix.b,qR=this.target.resultMatrix.c,qJ=this.target.resultMatrix.d,qV=0,qW=this._bones.length;qV<qW;qV++){if(qS=this._bones[qV],0<this.rotateMix){var qk=qS.resultMatrix.a,qz=qS.resultMatrix.b,qb=qS.resultMatrix.c,qH=qS.resultMatrix.d,qL=Math.atan2(qR,q_)-Math.atan2(qb,qk)+this._data.offsetRotation*Math.PI/180;qL>Math.PI?qL-=2*Math.PI:qL<-Math.PI&&(qL+=2*Math.PI),qL*=this.rotateMix;var qC=Math.cos(qL),qG=Math.sin(qL);qS.resultMatrix.a=qC*qk-qG*qb,qS.resultMatrix.b=qC*qz-qG*qH,qS.resultMatrix.c=qG*qk+qC*qb,qS.resultMatrix.d=qG*qz+qC*qH}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),qS.resultMatrix.tx+=(this._temp[0]-qS.resultMatrix.tx)*this.translateMix,qS.resultMatrix.ty+=(this._temp[1]-qS.resultMatrix.ty)*this.translateMix,qS.updateChild()),0<this.scaleMix){var qt=Math.sqrt(qS.resultMatrix.a*qS.resultMatrix.a+qS.resultMatrix.c*qS.resultMatrix.c),qo=Math.sqrt(q_*q_+qR*qR),q$=1e-5<qt?(qt+(qo-qt+this._data.offsetScaleX)*this.scaleMix)/qt:0;qS.resultMatrix.a*=q$,qS.resultMatrix.c*=q$,qt=Math.sqrt(qS.resultMatrix.b*qS.resultMatrix.b+qS.resultMatrix.d*qS.resultMatrix.d),qo=Math.sqrt(qa*qa+qJ*qJ),q$=1e-5<qt?(qt+(qo-qt+this._data.offsetScaleY)*this.scaleMix)/qt:0,qS.resultMatrix.b*=q$,qS.resultMatrix.d*=q$}if(0<this.shearMix){qz=qS.resultMatrix.b,qH=qS.resultMatrix.d;var qF=Math.atan2(qH,qz);(qL=Math.atan2(qJ,qa)-Math.atan2(qR,q_)-(qF-Math.atan2(qS.resultMatrix.c,qS.resultMatrix.a)))>Math.PI?qL-=2*Math.PI:qL<-Math.PI&&(qL+=2*Math.PI),qL=qF+(qL+this._data.offsetShearY*Math.PI/180)*this.shearMix,q$=Math.sqrt(qz*qz+qH*qH),qS.resultMatrix.b=Math.cos(qL)*q$,qS.resultMatrix.d=Math.sin(qL)*q$}}},qS}(),qiS=function(){function qS(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return qR(qS,"laya.ani.bone.TfConstraintData"),qS}(),qZS=function(){function qS(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}qR(qS,"laya.ani.bone.Transform");var q_=qS.prototype;return q_.initData=function(qS){null!=qS.x&&(this.x=qS.x),null!=qS.y&&(this.y=qS.y),null!=qS.skX&&(this.skX=qS.skX),null!=qS.skY&&(this.skY=qS.skY),null!=qS.scX&&(this.scX=qS.scX),null!=qS.scY&&(this.scY=qS.scY)},q_.getMatrix=function(){var qS;return(qS=this.mMatrix?this.mMatrix:this.mMatrix=new qXS).identity(),qS.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(qS,this.skewX*Math.PI/180,this.skewY*Math.PI/180),qS.rotate(this.skX*Math.PI/180),qS.translate(this.x,this.y),qS},q_.skew=function(qS,q_,qa){var qR=Math.sin(qa),qJ=Math.cos(qa),qV=Math.sin(q_),qW=Math.cos(q_);return qS.setTo(qS.a*qW-qS.b*qR,qS.a*qV+qS.b*qJ,qS.c*qW-qS.d*qR,qS.c*qV+qS.d*qJ,qS.tx*qW-qS.ty*qR,qS.tx*qV+qS.ty*qJ),qS},qS}(),qq=function(){function qS(){}return qR(qS,"laya.ani.bone.UVTools"),qS.getRelativeUV=function(qS,q_,qa){var qR=qS[0],qJ=qS[2]-qS[0],qV=qS[1],qW=qS[5]-qS[1];qa||(qa=[]),qa.length=q_.length;var qk,qz=0;qk=qa.length;var qb=1/qJ,qH=1/qW;for(qz=0;qz<qk;qz+=2)qa[qz]=(q_[qz]-qR)*qb,qa[qz+1]=(q_[qz+1]-qV)*qH;return qa},qS.getAbsoluteUV=function(qS,q_,qa){if(0==qS[0]&&0==qS[1]&&1==qS[4]&&1==qS[5])return qa?(qF.copyArray(qa,q_),qa):q_;var qR=qS[0],qJ=qS[2]-qS[0],qV=qS[1],qW=qS[5]-qS[1];qa||(qa=[]),qa.length=q_.length;var qk,qz=0;for(qk=qa.length,qz=0;qz<qk;qz+=2)qa[qz]=q_[qz]*qJ+qR,qa[qz+1]=q_[qz+1]*qW+qV;return qa},qS}(),qu=function(){function qS(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return qR(qS,"laya.ani.KeyFramesContent"),qS}(),qN=function(){function qH(){}return qR(qH,"laya.ani.math.BezierLerp"),qH.getBezierRate=function(qS,q_,qa,qR,qJ){var qV=qH._getBezierParamKey(q_,qa,qR,qJ),qW=100*qV+qS;if(qH._bezierResultCache[qW])return qH._bezierResultCache[qW];var qk,qz=qH._getBezierPoints(q_,qa,qR,qJ,qV),qb=0;for(qk=qz.length,qb=0;qb<qk;qb+=2)if(qS<=qz[qb])return qH._bezierResultCache[qW]=qz[qb+1],qz[qb+1];return qH._bezierResultCache[qW]=1},qH._getBezierParamKey=function(qS,q_,qa,qR){return 100*(100*(100*(100*qS+q_)+qa)+qR)},qH._getBezierPoints=function(qS,q_,qa,qR,qJ){return qH._bezierPointsCache[qJ]?qH._bezierPointsCache[qJ]:(qV=[0,0,qS,q_,qa,qR,1,1],qW=(new qk).getBezierPoints(qV,100,3),qH._bezierPointsCache[qJ]=qW);var qV,qW},qH._bezierResultCache={},qH._bezierPointsCache={},qH}(),qn=function(qS){function q_(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,q_.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}qR(q_,"laya.ani.AnimationPlayer",qJ);var qa=q_.prototype;return qJS.imps(qa,{"laya.resource.IDestroy":!0}),qa._onTempletLoadedComputeFullKeyframeIndices=function(qS,q_,qa){this._templet===qa&&this._cachePlayRate===qS&&this._cacheFrameRate===q_&&this._computeFullKeyframeIndices()},qa._computeFullKeyframeIndices=function(){for(var qS=this._fullFrames=[],q_=this._templet,qa=this._cacheFrameRateInterval*this._cachePlayRate,qR=0,qJ=q_.getAnimationCount();qR<qJ;qR++){for(var qV=[],qW=0,qk=q_.getAnimation(qR).nodes.length;qW<qk;qW++){for(var qz=q_.getAnimation(qR).nodes[qW],qb=Math.floor(qz.playTime/qa+.01),qH=new Uint16Array(qb+1),qL=-1,qC=0,qG=qz.keyFrame.length;qC<qG;qC++){var qt=qz.keyFrame[qC],qo=qt.startTime,q$=qo+qt.duration+qa;do{for(var qF=Math.floor(qo/qa+.5),qT=qL+1;qT<qF;qT++)qH[qT]=qC;qH[qL=qF]=qC,qo+=qa}while(qo<=q$)}qV.push(qH)}qS.push(qV)}},qa._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},qa._calculatePlayDuration=function(){if(0!==this.state){var qS=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=qS),this._playEnd>qS&&(this._playEnd=qS),this._playDuration=this._playEnd-this._playStart}},qa._setPlayParams=function(qS,q_){this._currentTime=qS,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/q_+.01),0),this._currentFrameTime=this._currentKeyframeIndex*q_},qa._setPlayParamsWhenStop=function(qS,q_){this._currentTime=qS,this._currentKeyframeIndex=Math.max(Math.floor(qS/q_+.01),0),this._currentFrameTime=this._currentKeyframeIndex*q_,this._currentAnimationClipIndex=-1},qa._update=function(qS){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var q_=this._cacheFrameRateInterval*this._cachePlayRate,qa=0;this._startUpdateLoopCount!==qt.loopCount&&(qa=qS*this.playbackRate,this._elapsedPlaybackTime+=qa);var qR=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=qR)return this._setPlayParamsWhenStop(qR,q_),void this.event("stopped");if(qa+=this._currentTime,0<qR)if(qR<=qa)do{if(qa-=qR,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(qR,q_),this._stopWhenCircleFinish=!1,void this.event("stopped");qa<qR&&(this._setPlayParams(qa,q_),this.event("complete"))}while(qR<=qa);else this._setPlayParams(qa,q_);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(qR,q_),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},qa._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},qa.play=function(qS,q_,qa,qR,qJ){if(void 0===qS&&(qS=0),void 0===q_&&(q_=1),void 0===qa&&(qa=2147483647),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(qa<0||qR<0||qJ<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==qJ&&qJ<qR)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=q_,this._overallDuration=qa,this._playStart=qR,this._playEnd=qJ,this._paused=!1,this._currentAnimationClipIndex=qS,this._currentKeyframeIndex=0,this._startUpdateLoopCount=qt.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},qa.playByFrame=function(qS,q_,qa,qR,qJ,qV){void 0===qS&&(qS=0),void 0===q_&&(q_=1),void 0===qa&&(qa=2147483647),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qV&&(qV=30);var qW=1e3/qV;this.play(qS,q_,qa,qR*qW,qJ*qW)},qa.stop=function(qS){void 0===qS&&(qS=!0),qS?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},qV(0,qa,"playEnd",function(){return this._playEnd}),qV(0,qa,"templet",function(){return this._templet},function(qS){0===!this.state&&this.stop(!0),this._templet!==qS&&((this._templet=qS).loaded?this._computeFullKeyframeIndices():qS.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),qV(0,qa,"playStart",function(){return this._playStart}),qV(0,qa,"playDuration",function(){return this._playDuration}),qV(0,qa,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),qV(0,qa,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),qV(0,qa,"overallDuration",function(){return this._overallDuration}),qV(0,qa,"currentFrameTime",function(){return this._currentFrameTime}),qV(0,qa,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),qV(0,qa,"currentPlayTime",function(){return this._currentTime+this._playStart}),qV(0,qa,"cachePlayRate",function(){return this._cachePlayRate},function(qS){this._cachePlayRate!==qS&&(this._cachePlayRate=qS,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[qS,this._cacheFrameRate])))}),qV(0,qa,"cacheFrameRate",function(){return this._cacheFrameRate},function(qS){this._cacheFrameRate!==qS&&(this._cacheFrameRate=qS,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,qS])))}),qV(0,qa,"currentTime",null,function(qS){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(qS<this._playStart||qS>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=qt.loopCount;var q_=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=qS,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/q_),0),this._currentFrameTime=this._currentKeyframeIndex*q_}}),qV(0,qa,"paused",function(){return this._paused},function(qS){(this._paused=qS)&&this.event("paused")}),qV(0,qa,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),qV(0,qa,"destroyed",function(){return this._destroyed}),q_}(),qK=function(qS){function q_(){q_.__super.call(this),q$.isConchNode&&(this.drawSkin=function(qS){qS.transform||(qS.transform=qXS.EMPTY),this._addCmd([qS]),this.setSkinMesh&&this.setSkinMesh(qS._ps,qS.mVBData,qS.mEleNum,0,qS.mTexture,qS.transform)})}return qR(q_,"laya.ani.GraphicsAni",qW),q_.prototype.drawSkin=function(qS){var q_=[qS];this._saveToCmd(q$._context._drawSkin,q_)},q_.create=function(){return q_._caches.pop()||new q_},q_.recycle=function(qS){qS.clear(),q_._caches.push(qS)},q_._caches=[],q_}(),qP=function(qS){function qT(){this._aniMap={},this.unfixedLastAniIndex=-1,qT.__super.call(this),this._anis=new Array}qR(qT,"laya.ani.AnimationTemplet",qH);var q_=qT.prototype;return q_.parse=function(qS){var q_=new qAS(qS);this._aniVersion=q_.readUTFString(),qD.parse(this,q_)},q_._calculateKeyFrame=function(qS,q_,qa){var qR=qS.keyFrame;qR[q_]=qR[0];for(var qJ=0;qJ<q_;qJ++){var qV=qR[qJ];qV.nextData=0===qV.duration?qV.data:qR[qJ+1].data}qR.length--},q_.onAsynLoaded=function(qS,q_,qa){var qR=new qAS(q_);switch(this._aniVersion=qR.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":qj.parse(this,qR);break;default:qD.parse(this,qR)}this._endLoaded()},q_.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},q_.getAnimationCount=function(){return this._anis.length},q_.getAnimation=function(qS){return this._anis[qS]},q_.getAniDuration=function(qS){return this._anis[qS].playTime},q_.getNodes=function(qS){return this._anis[qS].nodes},q_.getNodeIndexWithName=function(qS,q_){return this._anis[qS].bone3DMap[q_]},q_.getNodeCount=function(qS){return this._anis[qS].nodes.length},q_.getTotalkeyframesLength=function(qS){return this._anis[qS].totalKeyframeDatasLength},q_.getPublicExtData=function(){return this._publicExtData},q_.getAnimationDataWithCache=function(qS,q_,qa,qR){var qJ=q_[qa];if(qJ){var qV=qJ[qS];return qV?qV[qR]:null}return null},q_.setAnimationDataWithCache=function(qS,q_,qa,qR,qJ){var qV=q_[qa]||(q_[qa]={});(qV[qS]||(qV[qS]=[]))[qR]=qJ},q_.getOriginalData=function(qS,q_,qa,qR,qJ){for(var qV=this._anis[qS].nodes,qW=0,qk=0,qz=qV.length,qb=0;qk<qz;qk++){var qH,qL=qV[qk];qH=qL.keyFrame[qa[qk][qR]],qL.dataOffset=qb;var qC=qJ-qH.startTime,qG=qL.lerpType;if(qG)switch(qG){case 0:case 1:for(qW=0;qW<qL.keyframeWidth;)qW+=qL.interpolationMethod[qW](qL,qW,q_,qb+qW,qH.data,qC,null,qH.duration,qH.nextData);break;case 2:var qt=qH.interpolationData,qo=qt.length,q$=0;for(qW=0;qW<qo;){var qF=qt[qW];switch(qF){case 6:case 7:qW+=qT.interpolation[qF](qL,q$,q_,qb+q$,qH.data,qC,null,qH.duration,qH.nextData,qt,qW+1);break;default:qW+=qT.interpolation[qF](qL,q$,q_,qb+q$,qH.data,qC,null,qH.duration,qH.nextData)}q$++}}else for(qW=0;qW<qL.keyframeWidth;)qW+=qL.interpolationMethod[qW](qL,qW,q_,qb+qW,qH.data,qC,null,qH.duration,qH.nextData);qb+=qL.keyframeWidth}},q_.getNodesCurrentFrameIndex=function(qS,q_){var qa=this._anis[qS].nodes;qS!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(qa.length),this.unfixedCurrentTimes=new Float32Array(qa.length),this.unfixedLastAniIndex=qS);for(var qR=0,qJ=qa.length;qR<qJ;qR++){var qV=qa[qR];for(q_<this.unfixedCurrentTimes[qR]&&(this.unfixedCurrentFrameIndexes[qR]=0),this.unfixedCurrentTimes[qR]=q_;this.unfixedCurrentFrameIndexes[qR]<qV.keyFrame.length&&!(qV.keyFrame[this.unfixedCurrentFrameIndexes[qR]].startTime>this.unfixedCurrentTimes[qR]);)this.unfixedCurrentFrameIndexes[qR]++;this.unfixedCurrentFrameIndexes[qR]--}return this.unfixedCurrentFrameIndexes},q_.getOriginalDataUnfixedRate=function(qS,q_,qa){var qR=this._anis[qS].nodes;qS!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(qR.length),this.unfixedCurrentTimes=new Float32Array(qR.length),this.unfixedKeyframes=qo(qR.length),this.unfixedLastAniIndex=qS);for(var qJ=0,qV=0,qW=qR.length,qk=0;qV<qW;qV++){var qz=qR[qV];for(qa<this.unfixedCurrentTimes[qV]&&(this.unfixedCurrentFrameIndexes[qV]=0),this.unfixedCurrentTimes[qV]=qa;this.unfixedCurrentFrameIndexes[qV]<qz.keyFrame.length&&!(qz.keyFrame[this.unfixedCurrentFrameIndexes[qV]].startTime>this.unfixedCurrentTimes[qV]);)this.unfixedKeyframes[qV]=qz.keyFrame[this.unfixedCurrentFrameIndexes[qV]],this.unfixedCurrentFrameIndexes[qV]++;var qb=this.unfixedKeyframes[qV];qz.dataOffset=qk;var qH=qa-qb.startTime;if(qz.lerpType)switch(qz.lerpType){case 0:case 1:for(qJ=0;qJ<qz.keyframeWidth;)qJ+=qz.interpolationMethod[qJ](qz,qJ,q_,qk+qJ,qb.data,qH,null,qb.duration,qb.nextData);break;case 2:var qL=qb.interpolationData,qC=qL.length,qG=0;for(qJ=0;qJ<qC;){var qt=qL[qJ];switch(qt){case 6:case 7:qJ+=qT.interpolation[qt](qz,qG,q_,qk+qG,qb.data,qH,null,qb.duration,qb.nextData,qL,qJ+1);break;default:qJ+=qT.interpolation[qt](qz,qG,q_,qk+qG,qb.data,qH,null,qb.duration,qb.nextData)}qG++}}else for(qJ=0;qJ<qz.keyframeWidth;)qJ+=qz.interpolationMethod[qJ](qz,qJ,q_,qk+qJ,qb.data,qH,null,qb.duration,qb.nextData);qk+=qz.keyframeWidth}},qT._LinearInterpolation_0=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){var qH=0===qk?0:qV/qk;return qa[qR]=(1-qH)*qJ[q_]+qH*qz[q_],1},qT._QuaternionInterpolation_1=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){var qH=0===qk?0:qV/qk;return qC.slerpQuaternionArray(qJ,q_,qz,q_,qH,qa,qR),4},qT._AngleInterpolation_2=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return 0},qT._RadiansInterpolation_3=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return 0},qT._Matrix4x4Interpolation_4=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){for(var qH=0;qH<16;qH++,q_++)qa[qR+qH]=qJ[q_]+qV*qW[q_];return 16},qT._NoInterpolation_5=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb){return qa[qR]=qJ[q_],1},qT._BezierInterpolation_6=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH){return void 0===qH&&(qH=0),qa[qR]=qJ[q_]+(qz[q_]-qJ[q_])*qN.getBezierRate(qV/qk,qb[qH],qb[qH+1],qb[qH+2],qb[qH+3]),5},qT._BezierInterpolation_7=function(qS,q_,qa,qR,qJ,qV,qW,qk,qz,qb,qH){return void 0===qH&&(qH=0),qa[qR]=qb[qH+4]+qb[qH+5]*qN.getBezierRate((.001*qV+qb[qH+6])/qb[qH+7],qb[qH],qb[qH+1],qb[qH+2],qb[qH+3]),9},qT.load=function(qS){return qJS.loader.create(qS,null,null,qT)},qT.interpolation=[qT._LinearInterpolation_0,qT._QuaternionInterpolation_1,qT._AngleInterpolation_2,qT._RadiansInterpolation_3,qT._Matrix4x4Interpolation_4,qT._NoInterpolation_5,qT._BezierInterpolation_6,qT._BezierInterpolation_7],qT}(),ql=function(q_){function qa(qS,q_){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,qa.__super.call(this),void 0===q_&&(q_=0),qS&&this.init(qS,q_)}qR(qa,"laya.ani.bone.Skeleton",q_);var qS=qa.prototype;return qS.init=function(qS,q_){void 0===q_&&(q_=0);var qa,qR,qJ,qV=0,qW=0;if(1==q_)for(this._graphicsCache=[],qV=0,qW=qS.getAnimationCount();qV<qW;qV++)this._graphicsCache.push([]);if(this._yReverseMatrix=qS.yReverseMatrix,this._aniMode=q_,this._templet=qS,this._player=new qn,this._player.cacheFrameRate=qS.rate,this._player.templet=qS,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=qS.mBoneArr,this._rootBone=qS.mRootBone,this._aniSectionDic=qS.aniSectionDic,0<qS.ikArr.length)for(this._ikArr=[],qV=0,qW=qS.ikArr.length;qV<qW;qV++)this._ikArr.push(new qT(qS.ikArr[qV],this._boneList));if(0<qS.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),qV=0,qW=qS.pathArr.length;qV<qW;qV++)qa=qS.pathArr[qV],qR=new qQ(qa,this._boneList),(qJ=this._boneSlotDic[qa.name])&&((qR=new qQ(qa,this._boneList)).target=qJ),this._pathDic[qa.name]=qR;if(0<qS.tfArr.length)for(this._tfArr=[],qV=0,qW=qS.tfArr.length;qV<qW;qV++)this._tfArr.push(new qm(qS.tfArr[qV],this._boneList));if(0<qS.skinDataArray.length){var qk=this._templet.skinDataArray[this._skinIndex];this._skinName=qk.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},qS.load=function(qS,q_,qa){},qS._onLoaded=function(){},qS._parseComplete=function(){var qS=qB.TEMPLET_DICTIONARY[this._aniPath];qS&&(this.init(qS,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},qS._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},qS._onPlay=function(){this.event("played")},qS._onStop=function(){var qS,q_=this._templet.eventAniArr[this._aniClipIndex];if(q_&&this._eventIndex<q_.length)for(;this._eventIndex<q_.length;this._eventIndex++)(qS=q_[this._eventIndex]).time>=this._player.playStart&&qS.time<=this._player.playEnd&&this.event("label",qS);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},qS._onPause=function(){this.event("paused")},qS._parseSrcBoneMatrix=function(){var qS=0,q_=0;for(q_=this._templet.srcBoneMatrixArr.length,qS=0;qS<q_;qS++)this._boneMatrixArray.push(new qXS);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var qa,qR,qJ=this._templet.boneSlotArray;for(qS=0,q_=qJ.length;qS<q_;qS++)qa=qJ[qS],null==(qR=this._bindBoneBoneSlotDic[qa.parent])&&(this._bindBoneBoneSlotDic[qa.parent]=qR=[]),this._boneSlotDic[qa.name]=qa=qa.copy(),qR.push(qa),this._boneSlotArray.push(qa)}},qS._emitMissedEvents=function(qS,q_,qa){void 0===qa&&(qa=0);var qR=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(qR){var qJ,qV,qW=0;for(qJ=qR.length,qW=qa;qW<qJ;qW++)(qV=qR[qW]).time>=this._player.playStart&&qV.time<=this._player.playEnd&&this.event("label",qV)}},qS._update=function(qS){if(void 0===qS&&(qS=!0),!(this._pause||qS&&this._indexControl)){var q_=this.timer.currTimer,qa=this._player.currentKeyframeIndex,qR=q_-this._lastTime;if(qS?this._player._update(qR):qa=-1,this._lastTime=q_,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<qR&&this._clipIndex==qa&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var qJ;this._lastUpdateAniClipIndex=this._aniClipIndex,qa>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var qV,qW=this._templet.eventAniArr[this._aniClipIndex];if(qW&&this._eventIndex<qW.length&&((qJ=qW[this._eventIndex]).time>=this._player.playStart&&qJ.time<=this._player.playEnd?this._player.currentPlayTime>=qJ.time&&(this.event("label",qJ),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(qV=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=qV&&(this.graphics=qV));var qk=0,qz=0;for(qz=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,qz-1)&&0<qz;)qz--;if(qz<this._clipIndex)for(qk=qz;qk<this._clipIndex;qk++)this._createGraphics(qk)}else if(1==this._aniMode){if(qV=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=qV&&(this.graphics=qV));for(qz=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,qz-1)&&0<qz;)qz--;if(qz<this._clipIndex)for(qk=qz;qk<this._clipIndex;qk++)this._createGraphics(qk)}this._createGraphics()}}},qS._createGraphics=function(qS){void 0===qS&&(qS=-1),-1==qS&&(qS=this._clipIndex);var q_,qa,qR=qS*this._player.cacheFrameRateInterval,qJ=this._templet.drawOrderAniArr[this._aniClipIndex];if(qJ&&0<qJ.length)for(this._drawOrderIndex=0,q_=qJ[this._drawOrderIndex];qR>=q_.time&&(this._drawOrder=q_.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=qJ.length));)q_=qJ[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=qK.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=qK.create(),qa=this.graphics;var qV=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],qS,qR);var qW,qk,qz,qb,qH=this._aniSectionDic[this._aniClipIndex],qL=0,qC=0,qG=0,qt=0,qo=0,q$=this._templet.srcBoneMatrixArr.length;for(qo=qH[qC=0];qC<q$;qC++)qb=this._boneList[qC],qz=this._templet.srcBoneMatrixArr[qC],qb.resultTransform.scX=qz.scX*this._curOriginalData[qL++],qb.resultTransform.skX=qz.skX+this._curOriginalData[qL++],qb.resultTransform.skY=qz.skY+this._curOriginalData[qL++],qb.resultTransform.scY=qz.scY*this._curOriginalData[qL++],qb.resultTransform.x=qz.x+this._curOriginalData[qL++],qb.resultTransform.y=qz.y+this._curOriginalData[qL++],8===this._templet.tMatrixDataLen&&(qb.resultTransform.skewX=qz.skewX+this._curOriginalData[qL++],qb.resultTransform.skewY=qz.skewY+this._curOriginalData[qL++]);var qF,qT={},qD={};for(qo+=qH[1];qC<qo;qC++)qT[(qF=qV[qC]).name]=this._curOriginalData[qL++],qD[qF.name]=this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++];var qj,qQ,qm={},qq={};for(qo+=qH[2];qC<qo;qC++)qm[(qF=qV[qC]).name]=this._curOriginalData[qL++],qq[qF.name]=this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++],this._curOriginalData[qL++];if(this._pathDic)for(qo+=qH[3];qC<qo;qC++){if(qF=qV[qC],qj=this._pathDic[qF.name])switch(new qAS(qF.extenData).getByte()){case 1:qj.position=this._curOriginalData[qL++];break;case 2:qj.spacing=this._curOriginalData[qL++];break;case 3:qj.rotateMix=this._curOriginalData[qL++],qj.translateMix=this._curOriginalData[qL++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(qXS.TEMP.identity()),this._ikArr)for(qC=0,qo=this._ikArr.length;qC<qo;qC++)qQ=this._ikArr[qC],qm.hasOwnProperty(qQ.name)&&(qQ.bendDirection=qm[qQ.name]),qq.hasOwnProperty(qQ.name)&&(qQ.mix=qq[qQ.name]),qQ.apply();if(this._pathDic)for(var qN in this._pathDic)(qj=this._pathDic[qN]).apply(this._boneList,qa);if(this._tfArr)for(qC=0,qt=this._tfArr.length;qC<qt;qC++)this._tfArr[qC].apply();for(qC=0,qt=this._boneList.length;qC<qt;qC++)if(qb=this._boneList[qC],qk=this._bindBoneBoneSlotDic[qb.name],qb.resultMatrix.copyTo(this._boneMatrixArray[qC]),qk)for(qG=0,qo=qk.length;qG<qo;qG++)(qW=qk[qG])&&qW.setParentMatrix(qb.resultMatrix);var qn,ql,qB,qI,qA={},qX=this._templet.deformAniArr;if(qX&&0<qX.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,qC=0,qo=this._boneSlotArray.length;qC<qo;qC++)(qW=this._boneSlotArray[qC]).deformData=null;var qh,qu=qX[this._aniClipIndex];for(qh in qn=qu.default,this._setDeform(qn,qA,this._boneSlotArray,qR),qu)"default"!=qh&&qh!=this._skinName&&(qn=qu[qh],this._setDeform(qn,qA,this._boneSlotArray,qR));qn=qu[this._skinName],this._setDeform(qn,qA,this._boneSlotArray,qR)}if(this._drawOrder)for(qC=0,qo=this._drawOrder.length;qC<qo;qC++)ql=qT[(qW=this._boneSlotArray[this._drawOrder[qC]]).name],qB=qD[qW.name],isNaN(qB)||(qa.save(),qa.alpha(qB)),isNaN(ql)||-2==ql||(this._templet.attachmentNames?qW.showDisplayByName(this._templet.attachmentNames[ql]):qW.showDisplayByIndex(ql)),qA[this._drawOrder[qC]]?(qI=qA[this._drawOrder[qC]],qW.currDisplayData&&qI[qW.currDisplayData.attachmentName]?qW.deformData=qI[qW.currDisplayData.attachmentName]:qW.deformData=null):qW.deformData=null,isNaN(qB)?qW.draw(qa,this._boneMatrixArray,2==this._aniMode):qW.draw(qa,this._boneMatrixArray,2==this._aniMode,qB),isNaN(qB)||qa.restore();else for(qC=0,qo=this._boneSlotArray.length;qC<qo;qC++)ql=qT[(qW=this._boneSlotArray[qC]).name],qB=qD[qW.name],isNaN(qB)||(qa.save(),qa.alpha(qB)),isNaN(ql)||-2==ql||(this._templet.attachmentNames?qW.showDisplayByName(this._templet.attachmentNames[ql]):qW.showDisplayByIndex(ql)),qA[qC]?(qI=qA[qC],qW.currDisplayData&&qI[qW.currDisplayData.attachmentName]?qW.deformData=qI[qW.currDisplayData.attachmentName]:qW.deformData=null):qW.deformData=null,isNaN(qB)?qW.draw(qa,this._boneMatrixArray,2==this._aniMode):qW.draw(qa,this._boneMatrixArray,2==this._aniMode,qB),isNaN(qB)||qa.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,qS,qa):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,qS,qa)},qS._setDeform=function(qS,q_,qa,qR){if(qS){var qJ,qV,qW,qk=0,qz=0,qb=0;if(qS)for(qk=0,qz=qS.deformSlotDataList.length;qk<qz;qk++)for(qJ=qS.deformSlotDataList[qk],qb=0;qb<qJ.deformSlotDisplayList.length;qb++)qW=qa[(qV=qJ.deformSlotDisplayList[qb]).slotIndex],qV.apply(qR,qW),q_[qV.slotIndex]||(q_[qV.slotIndex]={}),q_[qV.slotIndex][qV.attachment]=qV.deformData}},qS.getAnimNum=function(){return this._templet.getAnimationCount()},qS.getAniNameByIndex=function(qS){return this._templet.getAniNameByIndex(qS)},qS.getSlotByName=function(qS){return this._boneSlotDic[qS]},qS.showSkinByName=function(qS,q_){void 0===q_&&(q_=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(qS),q_)},qS.showSkinByIndex=function(qS,q_){void 0===q_&&(q_=!0);for(var qa=0;qa<this._boneSlotArray.length;qa++)this._boneSlotArray[qa].showSlotData(null,q_);if(this._templet.showSkinByIndex(this._boneSlotDic,qS,q_)){var qR=this._templet.skinDataArray[qS];this._skinIndex=qS,this._skinName=qR.name}this._clearCache()},qS.showSlotSkinByIndex=function(qS,q_){if(0!=this._aniMode){var qa=this.getSlotByName(qS);qa&&qa.showDisplayByIndex(q_),this._clearCache()}},qS.showSlotSkinByName=function(qS,q_){if(0!=this._aniMode){var qa=this.getSlotByName(qS);qa&&qa.showDisplayByName(q_),this._clearCache()}},qS.replaceSlotSkinName=function(qS,q_,qa){if(0!=this._aniMode){var qR=this.getSlotByName(qS);qR&&qR.replaceDisplayByName(q_,qa),this._clearCache()}},qS.replaceSlotSkinByIndex=function(qS,q_,qa){if(0!=this._aniMode){var qR=this.getSlotByName(qS);qR&&qR.replaceDisplayByIndex(q_,qa),this._clearCache()}},qS.setSlotSkin=function(qS,q_){if(0!=this._aniMode){var qa=this.getSlotByName(qS);qa&&qa.replaceSkin(q_),this._clearCache()}},qS._clearCache=function(){if(1==this._aniMode)for(var qS=0,q_=this._graphicsCache.length;qS<q_;qS++){for(var qa=0,qR=this._graphicsCache[qS].length;qa<qR;qa++){var qJ=this._graphicsCache[qS][qa];qJ!=this.graphics&&qK.recycle(qJ)}this._graphicsCache[qS].length=0}},qS.play=function(qS,q_,qa,qR,qJ,qV){void 0===qa&&(qa=!0),void 0===qR&&(qR=0),void 0===qJ&&(qJ=0),void 0===qV&&(qV=!0),this._indexControl=!1;var qW=-1,qk=NaN;if(qk=q_?2147483647:0,"string"==typeof qS)for(var qz=0,qb=this._templet.getAnimationCount();qz<qb;qz++){var qH=this._templet.getAnimation(qz);if(qH&&qS==qH.name){qW=qz;break}}else qW=qS;-1<qW&&qW<this.getAnimNum()&&(this._aniClipIndex=qW,(qa||this._pause||this._currAniIndex!=qW)&&(this._currAniIndex=qW,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(qW)),this._drawOrder=null,this._eventIndex=0,this._player.play(qW,this._player.playbackRate,qk,qR,qJ),qV&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=qL.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},qS.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},qS.playbackRate=function(qS){this._player&&(this._player.playbackRate=qS)},qS.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},qS.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=qL.now(),this.timer.frameLoop(1,this,this._update,null,!0))},qS._getGrahicsDataWithCache=function(qS,q_){return this._graphicsCache[qS][q_]},qS._setGrahicsDataWithCache=function(qS,q_,qa){this._graphicsCache[qS][q_]=qa},qS.destroy=function(qS){void 0===qS&&(qS=!0),q_.prototype.destroy.call(this,qS),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},qV(0,qS,"url",function(){return this._aniPath},function(qS){this.load(qS)}),qV(0,qS,"index",function(){return this._index},function(qS){this.player&&(this._index=qS,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),qV(0,qS,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),qV(0,qS,"templet",function(){return this._templet}),qV(0,qS,"player",function(){return this._player}),qa.useSimpleMeshInCanvas=!1,qa}(qVS),qB=function(q_){function qJ(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,qJ.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}qR(qJ,"laya.ani.bone.Templet",q_);var qS=qJ.prototype;return qS.getLoadList=function(){return this._loadList},qS.loadAni=function(qS){this._skBufferUrl=qS,qJS.loader.load(qS,qz.create(this,this.onComplete),null,"arraybuffer")},qS.onComplete=function(qS){if(this._isDestroyed)this.destroy();else{var q_=qb.getRes(this._skBufferUrl);q_?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,q_)):this.event("error","load failed:"+this._skBufferUrl)}},qS.parseData=function(qS,q_,qa){void 0===qa&&(qa=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=qS,this._mainTexture&&q$.isWebGL&&qS.bitmap&&(qS.bitmap.enableMerageInAtlas=!1),this._rate=qa,this.parse(q_)},qS.buildArmature=function(qS){return void 0===qS&&(qS=0),new ql(this,qS)},qS.parse=function(qS){q_.prototype.parse.call(this,qS),this._endLoaded(),this._aniVersion!=qJ.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+qJ.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},qS._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var qS=0;this._loadList=[];var q_,qa=new qAS(this.getPublicExtData()),qR=0,qJ=0,qV=0,qW=qa.getInt32(),qk=qa.readUTFString(),qz=qk.split("\n");for(qS=0;qS<qW;qS++)q_=this._path+qz[2*qS],qk=qz[2*qS+1],qa.getFloat32(),qa.getFloat32(),qR=qa.getFloat32(),qJ=qa.getFloat32(),qV=qa.getFloat32(),isNaN(qV)?0:qV,qV=qa.getFloat32(),isNaN(qV)?0:qV,qV=qa.getFloat32(),isNaN(qV)?qR:qV,qV=qa.getFloat32(),isNaN(qV)?qJ:qV,-1==this._loadList.indexOf(q_)&&this._loadList.push(q_);this.event("inited",this)}},qS._textureComplete=function(){for(var qS,q_,qa=0,qR=this._loadList.length;qa<qR;qa++)q_=this._loadList[qa],qS=this._textureDic[q_]=qb.getRes(q_),q$.isWebGL&&qS&&qS.bitmap&&(qS.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},qS._parsePublicExtData=function(){var qS=0,q_=0,qa=0,qR=0,qJ=0;for(qS=0,qJ=this.getAnimationCount();qS<qJ;qS++)this._graphicsCache.push([]);var qV;qV="Dragon"!=this._aniClassName;var qW,qk,qz=new qAS(this.getPublicExtData()),qb=0,qH=0,qL=0,qC=0,qG=0,qt=0,qo=0,q$=0,qF=0,qT=qz.getInt32(),qD=qz.readUTFString(),qj=qD.split("\n");for(qS=0;qS<qT;qS++){if(qW=this._mainTexture,qk=this._path+qj[2*qS],qD=qj[2*qS+1],null==this._mainTexture&&(qW=this._textureDic[qk]),!qW)return this.event("error",this),void(this.isParseFail=!0);qb=qz.getFloat32(),qH=qz.getFloat32(),qL=qz.getFloat32(),qC=qz.getFloat32(),qF=qz.getFloat32(),qG=isNaN(qF)?0:qF,qF=qz.getFloat32(),qt=isNaN(qF)?0:qF,qF=qz.getFloat32(),qo=isNaN(qF)?qL:qF,qF=qz.getFloat32(),q$=isNaN(qF)?qC:qF,this.subTextureDic[qD]=qhS.create(qW,qb,qH,qL,qC,-qG,-qt,qo,q$),qW.alphaTexture&&(this.subTextureDic[qD].alphaTexture=qhS.create(qW.alphaTexture,qb,qH,qL,qC,-qG,-qt,qo,q$))}this._mainTexture=qW;var qQ,qm,qq,qN,qn,ql=qz.getUint16();for(qS=0;qS<ql;qS++)(qQ=[]).push(qz.getUint16()),qQ.push(qz.getUint16()),qQ.push(qz.getUint16()),qQ.push(qz.getUint16()),this.aniSectionDic[qS]=qQ;var qB,qI=qz.getInt16(),qA={};for(qS=0;qS<qI;qS++)qm=new quS,0==qS?qB=qm:qm.root=qB,qm.d=qV?-1:1,qN=qz.readUTFString(),qn=qz.readUTFString(),qm.length=qz.getFloat32(),1==qz.getByte()&&(qm.inheritRotation=!1),1==qz.getByte()&&(qm.inheritScale=!1),qm.name=qN,qn&&((qq=qA[qn])?qq.addChild(qm):this.mRootBone=qm),qA[qN]=qm,this.mBoneArr.push(qm);this.tMatrixDataLen=qz.getUint16();var qX,qh,qu=qz.getUint16(),qK=Math.floor(qu/this.tMatrixDataLen),qP=this.srcBoneMatrixArr;for(qS=0;qS<qK;qS++)(qX=new qZS).scX=qz.getFloat32(),qX.skX=qz.getFloat32(),qX.skY=qz.getFloat32(),qX.scY=qz.getFloat32(),qX.x=qz.getFloat32(),qX.y=qz.getFloat32(),8===this.tMatrixDataLen&&(qX.skewX=qz.getFloat32(),qX.skewY=qz.getFloat32()),qP.push(qX),(qm=this.mBoneArr[qS]).transform=qX;var qM,qr=qz.getUint16(),qe=0;for(qS=0;qS<qr;qS++){for(qh=new qxS,qe=qz.getUint16(),q_=0;q_<qe;q_++)qh.boneNames.push(qz.readUTFString()),qh.boneIndexs.push(qz.getInt16());qh.name=qz.readUTFString(),qh.targetBoneName=qz.readUTFString(),qh.targetBoneIndex=qz.getInt16(),qh.bendDirection=qz.getFloat32(),qh.mix=qz.getFloat32(),qh.isSpine=qV,this.ikArr.push(qh)}var qg,qx=qz.getUint16(),qs=0;for(qS=0;qS<qx;qS++){for(qM=new qiS,qs=qz.getUint16(),q_=0;q_<qs;q_++)qM.boneIndexs.push(qz.getInt16());qM.name=qz.getUTFString(),qM.targetIndex=qz.getInt16(),qM.rotateMix=qz.getFloat32(),qM.translateMix=qz.getFloat32(),qM.scaleMix=qz.getFloat32(),qM.shearMix=qz.getFloat32(),qM.offsetRotation=qz.getFloat32(),qM.offsetX=qz.getFloat32(),qM.offsetY=qz.getFloat32(),qM.offsetScaleX=qz.getFloat32(),qM.offsetScaleY=qz.getFloat32(),qM.offsetShearY=qz.getFloat32(),this.tfArr.push(qM)}var qU=qz.getUint16(),qf=0;for(qS=0;qS<qU;qS++){for((qg=new qsS).name=qz.readUTFString(),qf=qz.getUint16(),q_=0;q_<qf;q_++)qg.bones.push(qz.getInt16());qg.target=qz.readUTFString(),qg.positionMode=qz.readUTFString(),qg.spacingMode=qz.readUTFString(),qg.rotateMode=qz.readUTFString(),qg.offsetRotation=qz.getFloat32(),qg.position=qz.getFloat32(),qg.spacing=qz.getFloat32(),qg.rotateMix=qz.getFloat32(),qg.translateMix=qz.getFloat32(),this.pathArr.push(qg)}var qY,qi,qZ,qp,qc,qy=0,qE=0,qO=0,qw=NaN,qv=0,qd=qz.getInt16();for(qS=0;qS<qd;qS++){var qSS=qz.getUint8(),q_S={};this.deformAniArr.push(q_S);for(var qaS=0;qaS<qSS;qaS++)for((qY=new qPS).skinName=qz.getUTFString(),q_S[qY.skinName]=qY,qy=qz.getInt16(),q_=0;q_<qy;q_++)for(qi=new qMS,qY.deformSlotDataList.push(qi),qE=qz.getInt16(),qa=0;qa<qE;qa++)for(qZ=new qrS,qi.deformSlotDisplayList.push(qZ),qZ.slotIndex=qz.getInt16(),qZ.attachment=qz.getUTFString(),qO=qz.getInt16(),qR=0;qR<qO;qR++)for(1==qz.getByte()?qZ.tweenKeyList.push(!0):qZ.tweenKeyList.push(!1),qw=qz.getFloat32(),qZ.timeList.push(qw),qp=[],qZ.vectices.push(qp),qv=qz.getInt16(),qJ=0;qJ<qv;qJ++)qp.push(qz.getFloat32())}var qRS,qJS,qVS=qz.getInt16(),qWS=0,qkS=0;for(qS=0;qS<qVS;qS++){for(qWS=qz.getInt16(),qc=[],q_=0;q_<qWS;q_++){for((qRS=new qeS).time=qz.getFloat32(),qkS=qz.getInt16(),qa=0;qa<qkS;qa++)qRS.drawOrder.push(qz.getInt16());qc.push(qRS)}this.drawOrderAniArr.push(qc)}var qzS,qbS=qz.getInt16(),qHS=0;for(qS=0;qS<qbS;qS++){for(qHS=qz.getInt16(),qJS=[],q_=0;q_<qHS;q_++)(qzS=new qgS).name=qz.getUTFString(),qzS.intValue=qz.getInt32(),qzS.floatValue=qz.getFloat32(),qzS.stringValue=qz.getUTFString(),qzS.time=qz.getFloat32(),qJS.push(qzS);this.eventAniArr.push(qJS)}var qLS=qz.getInt16();if(0<qLS)for(this.attachmentNames=[],qS=0;qS<qLS;qS++)this.attachmentNames.push(qz.getUTFString());var qCS,qGS,qtS=qz.getInt16();for(qS=0;qS<qtS;qS++)(qCS=new qKS).name=qz.readUTFString(),qCS.parent=qz.readUTFString(),qCS.attachmentName=qz.readUTFString(),qCS.srcDisplayIndex=qCS.displayIndex=qz.getInt16(),(qCS.templet=this).boneSlotDic[qCS.name]=qCS,null==(qGS=this.bindBoneBoneSlotDic[qCS.parent])&&(this.bindBoneBoneSlotDic[qCS.parent]=qGS=[]),qGS.push(qCS),this.boneSlotArray.push(qCS);var qoS,q$S,qFS,qTS=qz.readUTFString().split("\n"),qDS=0,qjS=qz.getUint8(),qQS=0,qmS=0,qqS=0,qNS=0,qnS=0,qlS=0,qBS=0;for(qS=0;qS<qjS;qS++){for((qoS=new qUS).name=qTS[qDS++],qQS=qz.getUint8(),q_=0;q_<qQS;q_++){for((q$S=new qYS).name=qTS[qDS++],qCS=this.boneSlotDic[q$S.name],qmS=qz.getUint8(),qa=0;qa<qmS;qa++){if(qFS=new qfS,this.skinSlotDisplayDataArr.push(qFS),qFS.name=qTS[qDS++],qFS.attachmentName=qTS[qDS++],qFS.transform=new qZS,qFS.transform.scX=qz.getFloat32(),qFS.transform.skX=qz.getFloat32(),qFS.transform.skY=qz.getFloat32(),qFS.transform.scY=qz.getFloat32(),qFS.transform.x=qz.getFloat32(),qFS.transform.y=qz.getFloat32(),q$S.displayArr.push(qFS),qFS.width=qz.getFloat32(),qFS.height=qz.getFloat32(),qFS.type=qz.getUint8(),qFS.verLen=qz.getUint16(),0<(qI=qz.getUint16()))for(qFS.bones=[],qR=0;qR<qI;qR++){var qIS=qz.getUint16();qFS.bones.push(qIS)}if(0<(qqS=qz.getUint16()))for(qFS.uvs=[],qR=0;qR<qqS;qR++)qFS.uvs.push(qz.getFloat32());if(0<(qNS=qz.getUint16()))for(qFS.weights=[],qR=0;qR<qNS;qR++)qFS.weights.push(qz.getFloat32());if(0<(qnS=qz.getUint16()))for(qFS.triangles=[],qR=0;qR<qnS;qR++)qFS.triangles.push(qz.getUint16());if(0<(qlS=qz.getUint16()))for(qFS.vertices=[],qR=0;qR<qlS;qR++)qFS.vertices.push(qz.getFloat32());if(0<(qBS=qz.getUint16()))for(qFS.lengths=[],qR=0;qR<qBS;qR++)qFS.lengths.push(qz.getFloat32())}qoS.slotArr.push(q$S)}this.skinDic[qoS.name]=qoS,this.skinDataArray.push(qoS)}1==qz.getUint8()?(this.yReverseMatrix=new qXS(1,0,0,-1,0,0),qB&&qB.setTempMatrix(this.yReverseMatrix)):qB&&qB.setTempMatrix(new qXS),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},qS.getTexture=function(qS){var q_=this.subTextureDic[qS];return q_||(q_=this.subTextureDic[qS.substr(0,qS.length-1)]),null==q_?this._mainTexture:q_},qS.showSkinByIndex=function(qS,q_,qa){if(void 0===qa&&(qa=!0),q_<0&&q_>=this.skinDataArray.length)return!1;var qR,qJ,qV=0,qW=0,qk=this.skinDataArray[q_];if(qk){for(qV=0,qW=qk.slotArr.length;qV<qW;qV++)(qJ=qk.slotArr[qV])&&(qR=qS[qJ.name])&&(qR.showSlotData(qJ,qa),qa&&"undefined"!=qR.attachmentName&&"null"!=qR.attachmentName?qR.showDisplayByName(qR.attachmentName):qR.showDisplayByIndex(qR.displayIndex));return!0}return!1},qS.getSkinIndexByName=function(qS){for(var q_=0,qa=this.skinDataArray.length;q_<qa;q_++)if(this.skinDataArray[q_].name==qS)return q_;return-1},qS.getGrahicsDataWithCache=function(qS,q_){return this._graphicsCache[qS][q_]},qS.setGrahicsDataWithCache=function(qS,q_,qa){this._graphicsCache[qS][q_]=qa},qS.destroy=function(){var qS;for(var q_ in this._isDestroyed=!0,this.subTextureDic)(qS=this.subTextureDic[q_])&&qS.destroy();for(q_ in this._textureDic)(qS=this._textureDic[q_])&&qS.destroy();for(var qa=0,qR=this.skinSlotDisplayDataArr.length;qa<qR;qa++)this.skinSlotDisplayDataArr[qa].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete qJ.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},qS.getAniNameByIndex=function(qS){var q_=this.getAnimation(qS);return q_?q_.name:null},qV(0,qS,"rate",function(){return this._rate},function(qS){this._rate=qS}),qJ.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",qJ.TEMPLET_DICTIONARY=null,qJ}(qP)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(qS,q_){"use strict";for(var qa in Object.defineProperty(q_,"__esModule",{value:!0}),Laya){var qR=Laya[qa];qR&&qR.__isclass&&(q_[qa]=qR)}});