var Z=wx.$L;import{dfSDK}from"../utils/wxdfsdk";var config={game_id:256,game_pkg:Z[30895],partner_label:Z[30896],partner_id:Z[30897],game_ver:Z[30898],is_auth:!1,partner_game_id:Z[30899]};window.config=config;var $lTNMZO=$lTMOZN();var HOST=Z[30900];var $lTNMOZ=null;var $lTMZON=null;var sysInfo=wx.getSystemInfoSync();var platform=sysInfo.platform;function $lTMOZN(){var o={};return{order_data:{},init:function(e,r){e=e&&e.game_ver?e.game_ver:0;console.log(Z[30901]);var t=this;var n;n=wx.getStorageSync(Z[30902])?0:(n=t.uuid(16,32),wx.setStorageSync(Z[30902],n),1),wx.getStorageSync(Z[30903])||(o=t.uuid(16,32),wx.setStorageSync(Z[30903],o));var o=wx.getLaunchOptionsSync();var a=o.scene||"";n&&o.query&&o.query.ad_code&&wx.setStorageSync(Z[30904],o.query.ad_code),t.log(Z[1137],{install:n,scene:a}),wx.showShareMenu();t=o.query&&o.query.invite?o.query.invite:"";o=o.query&&o.query.invite_type?o.query.invite_type:"";t&&($lTMZON={invite:t,invite_type:o,is_new:n,scene:a}),e&&this.checkGameVersion(e,function(e){r&&r(e)}),dfSDK.create({gameId:config.partner_game_id,release:!0})},login:function(e,r){console.log(Z[30905]),o[Z[700]]=typeof r==Z[30812]?r:null;var t=this;dfSDK.login(function(e){1==e.status?(console.log(Z[30906]+e.data.user_name),console.log(Z[30907]+e.data.user_id),console.log(Z[30908]+e.data.open_id),t.do_login(e.data)):console.log(e.msg)})},do_login:function(e){var t=this;var r=t.getPublicData();if(r[Z[30909]]=JSON.stringify(e),$lTMZON&&typeof $lTMZON==Z[1132])for(var n in $lTMZON)r[n]=$lTMZON[n];wx.request({url:Z[26868]+HOST+Z[30910],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:r,success:function(e){if(console.log(Z[30911]+JSON.stringify(e)),200==e.statusCode){e=e.data;if(e.state){try{wx.setStorageSync(Z[30912],e.data.sdk_token),wx.setStorageSync(Z[30913],e.data.user_id),wx.setStorageSync(Z[30914],e.data.username),e.data.ext&&wx.setStorageSync(Z[30915],e.data.ext)}catch(e){}var r={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0"};o[Z[700]]&&o[Z[700]](0,r)}else o[Z[700]]&&o[Z[700]](1,{errMsg:e.msg});t.getShareInfo(Z[30916],function(e){console.log(Z[30917]),dfSDK.onShareAppMessage(function(){return t.logStartShare(Z[30916]),{title:e.title,imageUrl:e.img,query:e.query}})})}else o[Z[700]]&&o[Z[700]](1,{errMsg:Z[30918]})}})},share:function(e){o[Z[794]]=typeof callback==Z[30812]?callback:null;var r=e.type||Z[794];console.log(Z[30919]+r);var t=this;this.getShareInfo(r,function(e){t.logStartShare(r);e.query;dfSDK.shareAppMessage({share_title:e.title,share_img_url:e.img,share_query:e.query})})},logStartShare:function(e){var r=wx.getStorageSync(Z[30912]);wx.request({url:Z[26868]+HOST+Z[30920],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:r,server_id:$lTNMOZ?$lTNMOZ.server_id:"",role_id:$lTNMOZ?$lTNMOZ.role_id:"",type:e},success:function(e){}})},openService:function(){dfSDK.openCustomerService()},checkGameVersion:function(e,t){console.log(Z[30921]);wx.getStorageSync(Z[30912]);wx.request({url:Z[26868]+HOST+Z[30922],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){var r;console.log(Z[30923]+JSON.stringify(e)),200==e.statusCode&&(r=e.data).state?t&&t(r.data):t&&t({develop:0})}})},getShareInfo:function(e,r){console.log(Z[30924]);var t=wx.getStorageSync(Z[30912]);wx.request({url:Z[26868]+HOST+Z[30925],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:t,type:e,server_id:$lTNMOZ?$lTNMOZ.server_id:"",role_id:$lTNMOZ?$lTNMOZ.role_id:"",no_log:1},success:function(e){console.log(Z[30926]),console.log(e),200==e.statusCode?(e=e.data).state?r&&r(e.data):o[Z[794]]&&o[Z[794]](1,{errMsg:Z[30927]+e.msg}):o[Z[794]]&&o[Z[794]](1,{errMsg:Z[30928]})}})},updateShare:function(e,r,t,n,o,a){console.log(Z[30929]);var i=wx.getStorageSync(Z[30912]);wx.request({url:Z[26868]+HOST+Z[30930],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:r,is_new:t,role_id:n,sever_id:o,scene:a},success:function(e){console.log(Z[30931]+JSON.stringify(e))}})},msgCheck:function(e,r){console.log(Z[30932]+e);let t={data:{}};dfSDK.messageCheck({content:e},function(e){e.data.passed?t.data.state=1:t.data.state=0,t.statusCode=200,r&&r(t)})},pay:function(e,r){this.startPay(e,r)},startPay:function(e,r){console.log(Z[30933]+JSON.stringify(e));var t=this;o[Z[776]]=typeof r==Z[30812]?r:null;r=wx.getStorageSync(Z[30912]);var n=wx.getStorageSync(Z[30915]);r?(e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:r,session_key:n,platform:platform},t.order_data=e,(r=t.getPublicData())[Z[30935]]=JSON.stringify(e),wx.request({url:Z[26868]+HOST+Z[30936],method:Z[668],dataType:Z[6795],header:{"content-type":Z[834]},data:r,success:function(e){console.log(Z[30937]+JSON.stringify(e)),200==e.statusCode?(e=e.data).state?""==e.data.ext?dfSDK.pay(e.data.pay_data,function(e){console.log(Z[30938]+JSON.stringify(e))}):t.extDo({ext1:e.data.ext,ext2:e.data.pay_data}):o[Z[776]]&&o[Z[776]](1,{errMsg:e.msg}):o[Z[700]]&&o[Z[700]](1,{errMsg:Z[30918]})}})):o[Z[776]]&&o[Z[776]](1,{errMsg:Z[30934]})},extDo:function(e){wx.navigateToMiniProgram({appId:e.ext1,path:Z[30939]+e.ext2.trade_id+Z[30940]+e.ext2.total_fee/100,extraData:{},envVersion:Z[30941],success(e){}})},logCreateRole:function(e){var r=wx.getStorageSync(Z[30913]);var t=wx.getStorageSync(Z[30914]);var n={};n[Z[30942]]=r,n[Z[30943]]=t,n[Z[11846]]=e.roleid,n[Z[30944]]=e.rolelevel,n[Z[30945]]=e.rolename,n[Z[158]]=e.serverid,e.roleid&&e.serverid&&($lTNMOZ={role_id:e.roleid,server_id:e.serverid}),this.log(Z[7],n),dfSDK.submitData({data_type:2,server_id:e.serverid,server_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,money_num:0,vip:0},function(e){console.log(Z[30946]+JSON.stringify(e))})},logEnterGame:function(e){var r=wx.getStorageSync(Z[30913]);var t=wx.getStorageSync(Z[30914]);var n={};n[Z[30942]]=r,n[Z[30943]]=t,n[Z[11846]]=e.roleid,n[Z[30944]]=e.rolelevel,n[Z[30945]]=e.rolename,n[Z[158]]=e.serverid,e.roleid&&e.serverid&&($lTNMOZ={role_id:e.roleid,server_id:e.serverid}),this.log(Z[6677],n),$lTMZON&&this.updateShare($lTMZON.invite,$lTMZON.invite_type,$lTMZON.is_new,e.roleid,e.serverid,$lTMZON.scene),dfSDK.submitData({data_type:3,server_id:e.serverid,server_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,money_num:0,vip:0},function(e){console.log(Z[30947]+JSON.stringify(e))})},logRoleUpLevel:function(e){var r=wx.getStorageSync(Z[30913]);var t=wx.getStorageSync(Z[30914]);var n={};n[Z[30942]]=r,n[Z[30943]]=t,n[Z[11846]]=e.roleid,n[Z[30944]]=e.rolelevel,n[Z[30945]]=e.rolename,n[Z[158]]=e.serverid,e.roleid&&e.serverid&&($lTNMOZ={role_id:e.roleid,server_id:e.serverid,server_name:e.servername,role_name:e.rolename,role_level:e.rolelevel,role_createtime:e.rolecreatetime}),this.log(Z[30948],n),dfSDK.submitData({data_type:4,server_id:e.serverid,server_name:e.servername,role_id:e.roleid,role_name:e.rolename,role_level:e.rolelevel,money_num:0,vip:0},function(e){console.log(Z[30949]+JSON.stringify(e))})},uuid:function(e,r){var t=Z[30950].split("");var n,o=[];var a;if(e=e||t.length,r)for(n=0;n<r;n++)o[n]=t[0|Math.random()*e];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(a=0|16*Math.random(),o[n]=t[19==n?3&a|8:a]);return o.join("")},getPublicData:function(){var e=wx.getStorageSync(Z[30902]);var r=wx.getStorageSync(Z[30903]);var t=wx.getStorageSync(Z[30904]);return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,partner_label:config.partner_label,ad_code:t,uuid:e,idfv:r,mac:Z[30951],is_from_min:1,dname:sysInfo.model,net_type:0==sysInfo.wifiSignal?"4G":Z[30952],os_ver:sysInfo.system,sdk_ver:sysInfo.version,game_ver:config.game_ver,device:sysInfo.platform==Z[567]?1:2}},log:function(e,r){var t=this.getPublicData();for(var n in r)t[n]=r[n];console.log(Z[30953]+e),console.log(t),wx.request({url:Z[26868]+HOST+Z[30954]+e+Z[30955]+encodeURIComponent(JSON.stringify(t))})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()},weiduanHelper:function(){},setMessageToFriendQuery:function(e,r){e=e.activity_id;r(wx.setMessageToFriendQuery({shareMessageToFriendScene:e}))},subscribeMessage:function(e,r){console.log(Z[30956]+e),o[Z[805]]=typeof r==Z[30812]?r:null,wx.requestSubscribeMessage({tmplIds:e,success(e){console.log(Z[30957]),console.log(e),o[Z[805]]&&o[Z[805]](e)},fail(e){console.log(Z[30958]),console.log(e),o[Z[805]]&&o[Z[805]](e)}})}}}function run(e,r,t){e in $lTNMZO&&$lTNMZO[e](r,t)}exports.init=function(e,r){run(Z[371],e,r)},exports.login=function(e){run(Z[700],"",e)},exports.login=function(e){run(Z[700],"",e)},exports.pay=function(e,r){run(Z[776],e,r)},exports.openService=function(){run(Z[795])},exports.logCreateRole=function(e,r,t,n,o,a){run(Z[789],{serverid:e,servername:r,roleid:t,rolename:n,rolelevel:o,rolecreatetime:a})},exports.logEnterGame=function(e,r,t,n,o,a){run(Z[791],{serverid:e,servername:r,roleid:t,rolename:n,rolelevel:o,rolecreatetime:a})},exports.logRoleUpLevel=function(e,r,t,n,o,a){run(Z[793],{serverid:e,servername:r,roleid:t,rolename:n,rolelevel:o,rolecreatetime:a})},exports.share=function(e){run(Z[794],{type:e})},exports.msgCheck=function(e,r){run(Z[649],e,r)},exports.downloadClient=function(){run(Z[30959])},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(Z[30960])},exports.weiduanHelper=function(){run(Z[797])},exports.setMessageToFriendQuery=function(e,r){run(Z[30961],e,r)},exports.subscribeMessage=function(e,r){run(Z[805],e,r)};