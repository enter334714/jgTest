function t(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s}const e=void 0,s={cn:"https://mcs.volceapplog.com",va:"https://mcs.itobsnssdk.com",sg:"https://mcs.tobsnssdk.com"},i={appOnShow:"app_launch",appOnHide:"app_terminate",appOnError:"on_error",pageOnShow:"predefine_pageview",pageOnHide:"predefine_pageview_hide",pageOnShareAppMessage:"on_share",pageOnAddToFavorites:"on_addtofavorites",mpClick:"bav2b_click"},r=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],n=["__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],o=()=>+new Date;class a{constructor(t){this.sdk=t,this.env=this.init()}init(){return{user:{web_id:e,user_unique_id:e,user_id:e,user_type:e,user_is_auth:e,user_is_login:e,ip_addr_id:e,device_id:e,user_unique_id_type:e},header:{app_id:e,app_name:e,app_install_id:e,install_id:e,app_package:e,app_channel:e,app_version:e,os_name:e,os_version:e,device_model:e,device_brand:e,traffic_type:e,client_ip:e,os_api:e,access:e,language:e,app_language:e,creative_id:e,ad_id:e,campaign_id:e,ab_client:e,ab_version:e,platform:e,sdk_version:e,sdk_lib:e,app_region:e,region:e,province:e,city:e,timezone:e,tz_offset:e,tz_name:e,sim_region:e,carrier:e,resolution:e,screen_width:e,screen_height:e,browser:e,browser_version:e,referrer:e,referrer_host:e,utm_source:e,utm_medium:e,utm_campaign:e,utm_term:e,utm_content:e,custom:{},ab_sdk_version:e,_sdk_version:e,_sdk_name:e,wechat_openid:e,wechat_unionid:e,is_connected:e}}}set(t){this.sdk.emit(this.sdk.types.EnvTransform,t),Object.keys(t).forEach((e=>{if("evtParams"===e)this.evtParams=Object.assign(Object.assign({},this.evtParams||{}),t.evtParams||{});else if("_staging_flag"===e)this.evtParams=Object.assign(Object.assign({},this.evtParams||{}),{_staging_flag:t._staging_flag});else{let s=e,i=t[e];if(null===i)return!1;let r="";s.indexOf(".")>-1&&([r,s]=s.split(".")),"platform"===s&&(i="mp"),"os_version"!==s&&"mp_platform"!==s||(i=`${i}`),r?("headers"===r&&(r="header"),"user"===r||"header"===r?this.env[r][s]=i:this.env.header.custom[s]=i):this.env.user.hasOwnProperty(s)?["user_type","ip_addr_id"].indexOf(s)>-1?this.env.user[s]=Number(i):["user_id","web_id","user_unique_id"].indexOf(s)>-1?this.env.user[s]=String(i):["user_is_auth","user_is_login"].indexOf(s)>-1?this.env.user[s]=Boolean(i):this.env.user[s]=i:this.env.header.hasOwnProperty(s)?this.env.header[s]=i:this.env.header.custom[s]=i}}))}get(t){if(!t||"env"===t)return this.clone(this.env);if("evtParams"===t)return Object.assign({},this[t]);if(this.env.hasOwnProperty(t))return this.clone(this.env[t]);if(this.env.user.hasOwnProperty(t))return this.clone(this.env.user[t]);if(this.env.header.hasOwnProperty(t))return this.clone(this.env.header[t]);if(this.env.header.custom.hasOwnProperty(t))return this.clone(this.env.header.custom[t])}compose(t,e=[]){const{user:s,header:i}=this.env,{evtParams:r}=this,n=t.map((t=>(t.event&&!e.includes(t.event)&&r&&Object.keys(r).forEach((e=>{void 0===t.params[e]&&(t.params[e]=r[e])})),t.params=JSON.stringify(t.params),t)));return this.clone({events:n,user:s,header:i})}merge(t,e=[]){const s=this.compose(t,e);return s.local_time=Math.floor(o()/1e3),[s]}clone(t){if(this.sdk.isObject(t))return JSON.parse(JSON.stringify(t));return t}}const h=t=>null!=t&&"[object Object]"==Object.prototype.toString.call(t),c=t=>"number"==typeof t&&!isNaN(t);class p{constructor(){this.domains=s,this.init()}init(){this.option={caller:"",log:!1,channel:"cn",report_channel:"cn",channel_domain:"",report_url:"",auto_report:false,auto_profile:false,profile_channel:"cn",enable_profile:false,enable_ab_test:false,ab_channel_domain:"",clear_ab_cache_on_user_change:true,enable_et_test:false,event_verify_url:"",enable_buffer:false,buffer_interval:5e3,buffer_number:5,enable_storage_only:false,enable_cache:false,enable_filter_list:false,enable_third:false,enable_filter_crawler:false,request_timeout:0,enable_initiative_launch:false,enable_custom_webid:false,disable_sdk_monitor:false,verify:null},this.cloneOption=Object.assign({},this.option),this.initDomain()}initDomain(){if(this.option.channel_domain)return this.domain=this.option.channel_domain,void 0;let t=this.option.report_channel;Object.keys(this.domains).includes(t)||(t="cn"),this.domain=this.domains[t]}set(t){if(!h(t))return;Object.keys(t).forEach((e=>{this.option.hasOwnProperty(e)&&("channel"===e||"report_channel"===e?(this.option.report_channel=this.option.channel=t[e]?t[e]:this.cloneOption[e],this.initDomain()):(this.option[e]=void 0===t[e]?this.cloneOption[e]:t[e],"channel_domain"===e&&this.initDomain()))}))}get(t){if(t){if(this.hasOwnProperty(t))return this[t];if(this.option.hasOwnProperty(t))return this.option[t];return}return Object.assign({},this.option)}}class d{constructor(){this.hooks={}}on(t,e){if(!t||!e||"function"!=typeof e)return;this.hooks[t]||(this.hooks[t]=[]),this.hooks[t].push(e)}once(t,e){if(!t||!e||"function"!=typeof e)return;const s=i=>{e(i),this.off(t,s)};this.on(t,s)}off(t,e){if(!t||!this.hooks[t]||!this.hooks[t].length)return;if(e){const s=this.hooks[t].indexOf(e);-1!==s&&this.hooks[t].splice(s,1)}else this.hooks[t]=[]}emit(t,e){if(!t||!this.hooks[t]||!this.hooks[t].length)return;[...this.hooks[t]].forEach((t=>{try{t(e)}catch(t){}}))}}class u{constructor(t){this.ready=!1,this.sdk=t}setLog(t){t&&this.sdk.isFunction(t.log)&&(this._log=t)}setRequest(t){if(this.sdk.isFunction(t)){const e=t(this.sdk);this.sdk.isFunction(e)&&(this._request=e)}}setStorage(t){this.sdk.isObject(t)&&this.sdk.isFunction(t.get)&&this.sdk.isFunction(t.set)&&this.sdk.isFunction(t.remove)&&(this._storage=t)}check(){if(!this._request||!this._storage)return;this.ready=!0}log(...t){if(!this._log)return;try{this.sdk.option.get("log")&&this._log.log(...t)}catch(t){}}request(t){var e;if(!this.ready)return Promise.reject(null);try{return null===(e=this._request)||void 0===e?void 0:e.call(this,t)}catch(t){}}get(t){if(!this.ready)return Promise.reject(null);return this._storage.get(t)}set(t,e){if(!this.ready)return Promise.reject(!1);return this._storage.set(t,e)}remove(t){if(!this.ready)return Promise.reject(!1);return this._storage.remove(t)}storageInfo(){if(!this.ready)return Promise.reject(null);return this._storage.info()}}var l;!function(t){t.Init="$init",t.Config="$config",t.Send="$send",t.Ready="$ready",t.TokenComplete="$token-complete",t.TokenStorage="$token-storage",t.TokenFetch="$token-fetch",t.TokenGet="$token-get",t.LaunchComplete="$launch-complete",t.ConfigUuid="$config-uuid",t.ConfigWebId="$config-webid",t.ConfigTransform="$config-transform",t.UuidChangeBefore="$uuid-change-before",t.UuidChangeAfter="$uuid-change-after",t.EnvTransform="$env-transform",t.Event="$event",t.Report="$report",t.AppOpen="$app-open",t.AppClose="$app-close",t.AppShowStart="$app-show-start",t.AppShow="$app-show",t.AppHide="$app-hide",t.AppError="$app-error",t.AppShare="$app-share",t.AppOnShare="$app-on-share",t.PageShow="$page-show",t.PageHide="$page-hide",t.PageShare="$page-share",t.SubmitBefore="$submit-before",t.SubmitAfter="$submit-after",t.SubmitError="$submit-error",t.FilterCrawler="$filter-crawler",t.LaunchInfo="$launch-info",t.Pause="$pause",t.CancelPause="$cancel-pause",t.AbVar="$ab-var",t.AbAllVars="$ab-all-vars",t.AbExternalVersion="$ab-external-version",t.AbVersionChangeOn="$ab-version-change-on",t.AbVersionChangeOff="$ab-version-change-off",t.AbRefresh="$ab-refresh",t.AbFetchAfter="$ab-fetch-After",t.ProfileSet="$profile-set",t.ProfileSetOnce="$profile-set-once",t.ProfileUnset="$profile-unset",t.ProfileIncrement="$profile-increment",t.ProfileAppend="$profile-append",t.ProfileClear="$profile-clear",t.ProfileSubmitAfter="$profile-submit-after",t.ProfileSubmitError="$profile-submit-error",t.TransformInfo="$transform-info",t.ExtendAppLaunch="$extend-app-launch",t.ExtendAppTerminate="$extend-app-terminate",t.ExtendAppError="$extend-app-error",t.ExtendPageShow="$extend-page-show",t.ExtendPageHide="$extend-page-hide",t.ExtendPageShare="$extend-page-share",t.ExtendPageFavorite="$extend-page-favorite",t.MpClick="$mp-click",t.Network="$network",t.CacheUnReady="$cache-unready",t.CacheBuffer="$cache-buffer",t.Verify="$verify",t.Check="$check"}(l||(l={}));var f=l,g=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));class m{constructor(){this.types=f,this.EventType=i,this.ProfileType=n,this.UtmType=r,this.SdkHook=f,this.Domains=s,this.inited=!1,this.sended=!1,this.pluginInstances=[],this.data={},this.unInitedCache=[],this.ready=!1,this.sessionId="",this.appShowStarted=!1,this.env=new a(this),this.option=new p,this.hook=new d,this.sessionId=g(),m.instances.push(this);try{this.adapter=new u(this),this.adapter.setLog(m._log),this.adapter.setRequest(m._request),this.adapter.setStorage(m._storage),this.adapter.check(),m.plugins.reduce(((t,e)=>{const{plugin:s}=e;return t.push(new s),t}),this.pluginInstances)}catch(t){}}on(t,e){var s;null===(s=this.hook)||void 0===s?void 0:s.on(t,e)}once(t,e){var s;null===(s=this.hook)||void 0===s?void 0:s.once(t,e)}off(t,e){var s;if(!e&&this.types[t])return;null===(s=this.hook)||void 0===s?void 0:s.off(t,e)}emit(t,e){var s;this.adapter.log(`emit ${t}`,e||""),null===(s=this.hook)||void 0===s||s.emit(t,e)}static useAdapterLog(t){m._log=t}static useAdapterRequest(t){m._request=t}static useAdapterStorage(t){m._storage=t}static usePlugin(t,e){const s=e||t.pluginName;if(s){let e=!1;for(let i=0,r=m.plugins.length;i<r;i++){if(m.plugins[i].name===s){m.plugins[i].plugin=t,e=!0;break}}e||m.plugins.push({name:s,plugin:t})}else m.plugins.push({plugin:t});if("function"==typeof t.init)try{t.init(m)}catch(t){}}get appId(){return this._appId}checkUsePlugin(t){return!!m.plugins.find((({name:e})=>e===t))}init(e){if(this.inited||!this.isObject(e))return;const{app_id:s,log:i}=e,r=t(e,["app_id","log"]);if(void 0!==i&&this.option.set({log:i}),!(c(s)&&s>0))return this.adapter.log("app_id invalid"),void 0;this._appId=s,this.option.set(r),this.env.set({app_id:s}),Promise.all([new Promise((t=>{this.once(this.types.TokenComplete,(()=>{t(!0)}))})),new Promise((t=>{this.checkUsePlugin("official:auto")?this.on(this.types.LaunchComplete,(()=>{t(!0)})):t(!0)})),new Promise((t=>{this.sended?t(!0):this.once(this.types.Send,(()=>{t(!0)}))}))]).then((()=>{this.ready=!0,this.emit(this.types.Ready)})),this.on(this.types.AppShowStart,(()=>{this.appShowStarted?this.sessionId=g():this.appShowStarted=!0})),this.on(this.types.UuidChangeAfter,(()=>{this.sessionId=g()}));const n=this.option.get();if(this.pluginInstances.forEach((t=>{t.apply(this,n)})),this.get("is-crawler"))return;this.inited=!0,this.emit(this.types.Init),this.unInitedCache.length>0&&this.unInitedCache.forEach((t=>{this.emit(this.types.Event,t)}))}config(e){if(!this.inited||!this.isObject(e))return;this.emit(this.types.Config,e),this.emit(this.types.ConfigTransform,e);const{web_id:s,user_unique_id:i}=e,r=t(e,["web_id","user_unique_id"]);void 0!==s&&this.emit(this.types.ConfigWebId,s),void 0!==i&&this.emit(this.types.ConfigUuid,i),this.emit(this.types.Check,{type:"config",value:r}),this.env.set(r)}send(){if(!this.inited||this.sended)return;this.sended=!0,this.emit(this.types.Send)}event(t,e){if(this.get("is-crawler"))return;if(Array.isArray(t)){const e=o(),s=[];t.forEach((t=>{let i,r,n;if(Array.isArray(t)?[i,r,n]=t:this.isObject(t)&&(i=t.event,r=t.params,n=t.local_time_ms),!i)return;(!c(n)||n<0||n>e)&&(n=e),s.push(this.createEvent({event:i,params:r,time:n}))})),s.length>0&&(this.inited?this.emit(this.types.Event,s):this.unInitedCache.push(s))}else{const s=this.createEvent({event:t,params:e});this.inited?this.emit(this.types.Event,s):this.unInitedCache.push(s),this.emit(this.types.Verify,{event:t,params:e})}}createEvent(t,e=!0){const s=Object.assign({event:t.event,params:t.params||{},local_time_ms:t.time||o()},this.sessionId?{session_id:this.sessionId}:{});if(this.emit(this.types.Check,{type:"event",value:s}),!e)return s;let i="";const r=this.get("ab_sdk_version");r&&(i+=r);const n=this.get("ab_sdk_version_external");return n&&(i?i+=","+n:i=n),Object.assign(Object.assign({},s),i?{ab_sdk_version:i}:{})}set(t,e){this.data[t]=e}get(t){return this.data[t]}getKey(t){const e=this.appId;if("ab_version"===t||"ab_version_external"===t)return`__tea_sdk_${t}_${e}`;const s={token:"tokens",report:"reports",event:"events",utm:"utm",first:"first",compensate:"compensate",buffer:"buffer"};return s[t]?`__tea_cache_${s[t]}_${e}`:void 0}getUrl(t){const{option:e,env:s}=this,i=s.get("_sdk_version"),r=(s.get("_sdk_name")||"").replace(/@.+\//,""),n=`${e.get("domain")}${t}?sdk_version=${i}&sdk_name=${r}`,o=e.get("caller");if(o)return`${n}&app_id=${this.appId}&caller=${o}`;return n}getToken(t){if(t)return this.emit(this.types.TokenGet,{callback:t}),void 0;return new Promise((t=>{this.emit(this.types.TokenGet,{callback:e=>{t(e)}})}))}getConfig(t){return this.env.get(t||"header")}stash(t,e={}){const s="stash";this.set(s,[...this.get(s)||[],this.createEvent({event:t,params:e})])}commit(){const t="stash",e=this.get(t)||[];e.length>0&&(this.event(e),this.set(t,[]))}isObject(t){return h(t)}isArray(t){return(t=>"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t))(t)}isNumber(t){return c(t)}isString(t){return(t=>"string"==typeof t)(t)}isFunction(t){return(t=>"function"==typeof t)(t)}isUndefined(t){return void 0===t}}m.plugins=[],m.instances=[];class y{apply(t,e){t.env.set({sdk_version:"2.1.1",_sdk_version:"2.1.1",_sdk_name:"@datarangers/sdk-qg"})}}var _;y.pluginName="official:info",function(t){t.Default="default",t.Custom="custom"}(_||(_={}));class k{constructor(t,e){this.wrap=t,this.sdk=e,this.url="/webid/"}storageNoData(){this.fetch()}storageHasData(t){return this.wrap.dataComplete(t)}fetch(){const{adapter:t,appId:e}=this.sdk;t.request({url:this.sdk.getUrl(`${this.url}`),method:"POST",data:{app_id:e,url:"-",user_agent:"-",referer:"-",user_unique_id:""}}).then((e=>{try{const{data:{e:s=-1e4,web_id:i=""}={}}=e;if(0===s)return this.fetchComplete(i),void 0;t.log("parse web_id error",s)}catch(e){t.log("parse web_id error",e)}this.fetchComplete()})).catch((e=>{this.fetchComplete(),t.log("fetch web_id error",e)}))}fetchComplete(t){if(!t)return;this.wrap.webIdComplete(t)}storageComplete(t){if(!t)return this.storageNoData(),void 0;try{if(t[this.wrap.typeKey]===_.Default){const e=this.storageHasData(t);this.wrap.complete(e)}else this.storageNoData()}catch(t){}}}class b{constructor(t,e){this.wrap=t,this.sdk=e,this.sdk.on(this.sdk.types.ConfigWebId,(t=>{t=`${t}`,this.wrap.tokenComplete?this.waitComplete(t):this.waitResolve?this.waitResolve(t):this.tmpWebId=t}))}storageNoData(){this.wait()}storageHasData(t){return this.wrap.dataComplete(t,this.tmpWebId)}wait(){new Promise((t=>{void 0!==this.tmpWebId?(t(this.tmpWebId),this.tmpWebId=void 0):this.waitResolve=t})).then((t=>{this.waitComplete(t)}))}waitComplete(t){this.wrap.webIdComplete(t)}storageComplete(t){if(!t)return this.storageNoData(),void 0;try{if(t[this.wrap.typeKey]===_.Custom){const e=this.storageHasData(t);this.wrap.complete(e)}else this.storageNoData()}catch(t){}}}class v{constructor(){this.tokenComplete=!1,this.tobid="",this.tobidUrl="/tobid/",this.tobidKey="",this.isCustom=!1,this.typeKey="_type_"}apply(t,e){this.sdk=t,this.options=e,this.key=this.sdk.getKey("token"),this.tobidKey="diss".split("").reverse().join(""),this.options.enable_custom_webid?(this.isCustom=!0,this.token=new b(this,this.sdk)):(this.isCustom=!1,this.token=new k(this,this.sdk));const{types:s}=this.sdk;this.sdk.on(s.ConfigUuid,(t=>{this.setUserUniqueId(t)})),this.sdk.on(s.TokenGet,(({callback:t})=>{const e=()=>{this.fetchTobid().then((()=>{const e=this.sdk.env.get("user"),s=Object.assign(Object.assign({},e),{web_id:this.webId,user_unique_id:this.userUniqueId});s[this.tobidKey]=this.tobid,"function"==typeof t&&t(s)}))};this.sdk.ready?e():this.sdk.once(s.Ready,(()=>{e()}))})),this.storage()}storage(){const{adapter:t}=this.sdk;t.get(this.key).then((e=>{if(!this.sdk.isObject(e)||!e.web_id)return this.storageComplete(null),void 0;e[this.typeKey]&&!e[this.tobidKey]&&e.user_unique_id||(e={web_id:e.web_id,user_unique_id:e.user_unique_id||e.web_id,[this.typeKey]:this.isCustom?_.Custom:_.Default},t.set(this.key,e)),this.storageComplete(e)})).catch((e=>{this.storageComplete(null),t.log("get token error",e)}))}storageComplete(t){this.token.storageComplete(t)}dataComplete(t,e){let s=t.web_id;void 0!==e&&e!==s&&(s=e),this.webId=s;let i=t.web_id===t.user_unique_id?s:t.user_unique_id;return void 0!==this.tmpUserUniqueId&&this.tmpUserUniqueId!==i&&(i=this.tmpUserUniqueId?this.tmpUserUniqueId:s,this.tmpUserUniqueId=void 0),this.userUniqueId=i,s!==t.web_id||i!==t.user_unique_id}webIdComplete(t){this.webId=t,this.tmpUserUniqueId?(this.userUniqueId=this.tmpUserUniqueId,this.tmpUserUniqueId=void 0):this.userUniqueId=t,this.complete(!0)}complete(t=!1){const{types:e}=this.sdk,s={web_id:this.webId,user_unique_id:this.userUniqueId};this.sdk.env.set(s),s[this.typeKey]=this.isCustom?_.Custom:_.Default,t&&this.sdk.adapter.set(this.key,s),this.tokenComplete=!0,this.sdk.emit(e.TokenComplete)}setUserUniqueId(t){const{adapter:e,env:s,types:i}=this.sdk;if(this.tokenComplete){if(this.userUniqueId===t)return;this.sdk.emit(i.UuidChangeBefore),this.userUniqueId=t||this.webId,s.set({user_unique_id:this.userUniqueId});const r={web_id:this.webId,user_unique_id:this.userUniqueId,[this.typeKey]:this.isCustom?_.Custom:_.Default};e.set(this.key,r),this.sdk.emit(i.UuidChangeAfter)}else this.tmpUserUniqueId=t}fetchTobid(){const{adapter:t,appId:e}=this.sdk;return t.request({url:this.sdk.getUrl(`${this.tobidUrl}`),method:"POST",data:{app_id:e,web_id:this.webId,user_unique_id:this.userUniqueId}}).then((t=>{try{const{data:{e:e=-1e4,tobid:s=""}={}}=t;if(0===e)return this.tobid=s,void 0}catch(t){}})).catch((e=>{t.log("fetch tobid error",e)}))}}v.pluginName="official:token";class O{constructor(){this.url="/list/",this.cache=[],this.pause=!1,this.eventName="request_status__"}apply(t,e){this.sdk=t,this.options=e,this.key=this.sdk.getKey("report"),this.reportUrl=this.sdk.getUrl(`${this.url}`),this.sdk.set("report_url",this.reportUrl);const{types:s}=this.sdk;this.sdk.on(s.Report,(t=>{if(Array.isArray(t)||(t=[t]),!this.sdk.ready||this.pause)return t.forEach((t=>this.cache.push(t))),void 0;this.report(t)})),this.sdk.on(s.Ready,(()=>{this.reportCache()})),this.sdk.on(s.Pause,(()=>{this.pause=!0})),this.sdk.on(s.CancelPause,(()=>{this.pause=!1,this.reportCache()}));const{adapter:i}=this.sdk;this.sdk.on(s.AppOpen,(()=>{i.get(this.key).then((()=>{}))})),this.sdk.on(s.AppClose,(()=>{this.cache.length>0&&(i.set(this.key,[...this.cache]),this.cache.length=0)}))}reportCache(){this.cache.length>0&&(this.report([...this.cache]),this.cache.length=0)}report(t){this.submit(t)}submit(t){const{types:e}=this.sdk;this.sdk.emit(e.SubmitBefore,t),this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:t}).then((s=>{this.sdk.emit(e.SubmitAfter,{isError:!1,response:s,event:t});try{if(this.checkMonitor(t))return;const{data:e,statusCode:i}=s;if(0!==e.e){const s=t.map((t=>null==t?void 0:t.events));this.reportMonitor({status_code:i,response_data:JSON.stringify(e),event_info:JSON.stringify(s)})}}catch(t){}})).catch((s=>{this.sdk.emit(e.SubmitAfter,{isError:!0,error:s,event:t});try{if(this.checkMonitor(t))return;this.sdk.emit(e.SubmitError,{event:t})}catch(t){}}))}reportMonitor(t){const e=this.sdk.createEvent({event:this.eventName,params:t}),s=this.sdk.env.merge([e]);this.submit(s)}checkMonitor(t){if(t&&t[0]&&t[0].events[0]&&t[0].events[0].event===this.eventName)return!0;return!1}}O.pluginName="official:report";class w{constructor(){this.buffer=[],this.timer=0,this.unReadyCache=[],this.cacheBatchNumber=15}apply(t,e){var s,i;this.sdk=t,this.options=e,this.enable=!!this.options.enable_buffer,this.cacheEnable=!!this.options.enable_cache;const r=!0===this.options.enable_storage||!1===this.options.disable_storage;if(r&&(this.enable=!0),this.enable){this.interval=this.options.buffer_interval,this.number=this.options.buffer_number,r&&((null===(s=this.options)||void 0===s?void 0:s.report_interval)>0&&(this.interval=this.options.report_interval),(null===(i=this.options)||void 0===i?void 0:i.max_batch_event)>0&&(this.number=this.options.max_batch_event));try{this.interval=Number(this.interval),this.number=Number(this.number)}catch(t){}}const{types:n}=this.sdk;this.sdk.on(n.Event,(t=>{const e=Array.isArray(t)?t:[t];if(!this.sdk.ready)return this.unReadyCache=[...this.unReadyCache,...e],this.cacheEnable&&this.unReadyCache.length>=this.cacheBatchNumber&&(this.sdk.emit(n.CacheUnReady,[...this.unReadyCache]),this.unReadyCache.length=0),void 0;this.process(e)})),this.sdk.on(n.Ready,(()=>{this.unReadyCache.length>0&&(this.process(this.unReadyCache),this.unReadyCache.length=0)})),this.sdk.on(n.Network,(t=>{!t.origin&&t.current&&(this.enable?this.refresh():this.buffer.length>0&&(this.report([...this.buffer]),this.buffer.length=0))})),this.sdk.on(n.AppClose,(()=>{if(this.timer&&clearTimeout(this.timer),!this.sdk.ready)return this.cacheEnable&&this.unReadyCache.length>0&&(this.sdk.emit(n.CacheUnReady,[...this.unReadyCache]),this.unReadyCache.length=0),void 0;if(this.buffer.length>0){this.network()?this.report([...this.buffer]):this.cacheEnable&&this.sdk.emit(n.CacheBuffer,[...this.buffer]),this.buffer.length=0}}))}process(t){const e=this.sdk.env.compose(t);this.network()?this.enable?(this.buffer=[...this.buffer,e],this.refresh()):this.report(e):(this.buffer=[...this.buffer,e],this.cacheEnable&&this.buffer.length>=this.cacheBatchNumber&&(this.sdk.emit(this.sdk.types.CacheBuffer,[...this.buffer]),this.buffer.length=0))}refresh(){this.buffer.length>=this.number?(this.timer&&(clearTimeout(this.timer),this.timer=0),this.report([...this.buffer]),this.buffer.length=0):this.timer||(this.timer=setTimeout((()=>{this.timer=0,this.buffer.length>0&&(this.report([...this.buffer]),this.buffer.length=0)}),this.interval))}report(t){this.sdk.emit(this.sdk.types.Report,t)}network(){return!!this.sdk.env.get("is_connected")}}w.pluginName="official:buffer";class S{apply(t,e){this.sdk=t,this.options=e;const{types:s,env:i}=this.sdk,r=(()=>{try{const t=(new Date).getTimezoneOffset();return{timezone:Math.floor(Math.abs(t)/60),offset:60*t}}catch(t){return{timezone:8,offset:-28800}}})();i.set({timezone:r.timezone,tz_offset:r.offset}),this.sdk.on(s.ConfigTransform,(t=>{void 0!==t.user_unique_id_type&&(t.evtParams=Object.assign(Object.assign({},t.evtParams||{}),{$user_unique_id_type:t.user_unique_id_type})),void 0!==t.gender&&([1,2,"1","2"].includes(t.gender)?t.gender=t.gender<2?"male":"female":delete t.gender);if(!!this.options.enable_profile){const e={};["nick_name","gender","avatar_url"].forEach((s=>{void 0!==t[s]&&(e[s]=t[s],delete t[s])})),this.sdk.emit(s.ProfileSet,e)}})),this.sdk.on(s.EnvTransform,(t=>{if(!!this.options.enable_profile){const e={};["$mp_from_uuid"].forEach((s=>{void 0!==t[s]&&(e[s]=t[s],delete t[s])})),Object.keys(e).length>0&&this.sdk.emit(s.ProfileSetOnce,e)}}))}}S.pluginName="official:transform";class C{constructor(){this.url="/profile/list",this.lastId=0,this.lastOnceId=0,this.duration=6e4,this.cache={},this.buffer=[]}static init(t){t.prototype.profileSet=function(t){this.emit(this.types.ProfileSet,t)},t.prototype.profileSetOnce=function(t){this.emit(this.types.ProfileSetOnce,t)},t.prototype.profileUnset=function(t){this.emit(this.types.ProfileUnset,t)},t.prototype.profileIncrement=function(t){this.emit(this.types.ProfileIncrement,t)},t.prototype.profileAppend=function(t){this.emit(this.types.ProfileAppend,t)}}apply(t,e){this.sdk=t,this.options=e;const{types:s}=this.sdk;this.sdk.on(s.ProfileSet,(t=>{this.check()&&this.setProfile(t)})),this.sdk.on(s.ProfileSetOnce,(t=>{this.check()&&this.setOnceProfile(t)})),this.sdk.on(s.ProfileUnset,(t=>{this.check()&&this.unsetProfile(t)})),this.sdk.on(s.ProfileIncrement,(t=>{this.check()&&this.incrementProfile(t)})),this.sdk.on(s.ProfileAppend,(t=>{this.check()&&this.appendProfile(t)})),this.sdk.on(s.ProfileClear,(()=>{this.cache={}})),this.sdk.on(s.Ready,(()=>{if(!this.buffer.length)return;this.reportMore([...this.buffer]),this.buffer=[]}))}check(){return!!this.options.enable_profile}setProfile(t){const e=this.debounce(t);if(!e)return;this.putCache(e);const s=this.filter(e,(t=>this.sdk.isString(t)||this.sdk.isNumber(t)||this.sdk.isArray(t)));this.report(this.sdk.createEvent({event:"__profile_set",params:s}))}setOnceProfile(t){const e=this.debounce(t,!0);if(!e)return;this.putCache(e);const s=this.filter(e,(t=>this.sdk.isString(t)||this.sdk.isNumber(t)||this.sdk.isArray(t)));this.report(this.sdk.createEvent({event:"__profile_set_once",params:s}))}incrementProfile(t){if(!t)return;const e=this.filter(t,(t=>this.sdk.isNumber(t)));this.report(this.sdk.createEvent({event:"__profile_increment",params:e}))}unsetProfile(t){if(!t||!this.sdk.isString(t))return;const e={};e[t]="1",this.report(this.sdk.createEvent({event:"__profile_unset",params:e}))}appendProfile(t){if(!t||!this.sdk.isObject(t)||this.isEmpty(t))return;const e=this.filter(t,(t=>this.sdk.isString(t)||this.sdk.isArray(t)));this.report(this.sdk.createEvent({event:"__profile_append",params:e}))}reportMore(t){if(this.sdk.ready){const e=this.sdk.env.merge(t,this.sdk.ProfileType),{adapter:s,option:i}=this.sdk;s.request({url:`${i.get("domain")}${this.url}`,method:"POST",data:e}).then((t=>{this.sdk.emit(this.sdk.types.ProfileSubmitAfter,{isError:!0,response:t,event:e})})).catch((t=>{this.sdk.emit(this.sdk.types.ProfileSubmitError,{isError:!0,error:t,event:e})}))}else t.forEach((t=>{this.buffer.push(t)}))}report(t){this.reportMore([t])}ms(){return o()}debounce(t,e=!1){if(!t||!this.sdk.isObject(t)||this.isEmpty(t))return;let s=Object.keys(t);const i=this.ms(),r=s.filter((s=>{const r=this.cache[s];if(r&&(e||this.compare(r.val,t[s])&&i-r.timestamp<this.duration))return!1;return!0})).reduce(((e,s)=>(e[s]=t[s],e)),{});if(s=Object.keys(r),!s.length)return;return r}putCache(t){const e=this.ms();Object.keys(t).forEach((s=>{this.cache[s]={val:this.clone(t[s]),timestamp:e}}))}clone(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return t}}compare(t,e){return JSON.stringify(t)===JSON.stringify(e)}filter(t,e){return Object.keys(t).reduce(((s,i)=>{const r=t[i];return e(r)&&(s[i]=r),s}),{})}isEmpty(t){return!Object.keys(t).length}}C.pluginName="official:profile",m.usePlugin(y),m.usePlugin(v),m.usePlugin(O),m.usePlugin(w),m.usePlugin(S),m.usePlugin(C);var P=console;let A="undefined";const $=()=>{if("undefined"!==A)return A;return A="undefined"!=typeof tt?{target:tt,is:"tt"}:"undefined"!=typeof swan?{target:swan,is:"swan"}:"undefined"!=typeof qq?{target:qq,is:"qq"}:"undefined"!=typeof wx?{target:wx,is:"wx"}:"undefined"!=typeof qg?{target:qg,is:"qg"}:{target:null,is:""},A};let I="";const q=$();var j="undefined"!=typeof qg||"undefined"!=typeof cc?"undefined"!=typeof qg&&qg.request?t=>e=>{I||(I=qg.getSystemInfoSync().brand);const s=e.timeout||t.option.get("request_timeout"),i="number"==typeof s&&s>0;return new Promise(((t,r)=>{qg.request(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),i?{timeout:s}:{}),{dataType:e.dataType||"json"}),"vivo"===I?{data:JSON.stringify(e.data)}:{}),{success:e=>{t(e)},fail:t=>{r(t)}}))}))}:t=>e=>{const s=e.timeout||t.option.get("request_timeout"),i="number"==typeof s&&s>0;return new Promise(((t,s)=>{const{url:r,method:n,timeout:o,data:a}=e,h=new XMLHttpRequest;i&&(h.timeout=o),h.open(n,`${r}`,!0),h.setRequestHeader("Content-Type","application/json; charset=utf-8"),h.onload=()=>{try{const e=JSON.parse(h.responseText);t({data:e})}catch(t){s()}},h.ontimeout=()=>{s()},h.onerror=()=>{h.abort(),s()},h.send(JSON.stringify(a))}))}:((t,e=!1)=>s=>i=>{const r=i.timeout||s.option.get("request_timeout"),n="number"==typeof r&&r>0;return new Promise(((s,o)=>{const a=t.request(Object.assign(Object.assign(Object.assign({},i),n&&!e?{timeout:r}:{}),{dataType:i.dataType||"json",success:t=>{s(t)},fail:t=>{o(t)}}));n&&e&&setTimeout((()=>{try{a&&a.abort()}catch(t){}}),r)}))})(q.target,"swan"===q.is);const E=$(),x=t=>class{get(e){return new Promise(((s,i)=>{try{const i=t.getItem(e);s(i?JSON.parse(i):null)}catch(t){i(t)}}))}set(e,s){return new Promise(((i,r)=>{try{t.setItem(e,JSON.stringify(s)),i(!0)}catch(t){r(!1)}}))}remove(e){return new Promise(((s,i)=>{try{t.removeItem(e),s(!0)}catch(t){i(!1)}}))}info(){return new Promise(((e,s)=>{try{const s=[];for(let e=0,i=t.length;e<i;e++)s.push(t.key(e));e(s)}catch(t){s(null)}}))}};var U=new((()=>{if("undefined"!=typeof qg||"undefined"!=typeof cc){if("undefined"!=typeof qg&&qg.getStorageSync)return class{get(t){return new Promise(((e,s)=>{try{const s=qg.getStorageSync({key:t});if(void 0===s||"object"==typeof s)return e(s),void 0;if("string"==typeof s)return"key not define"===s.trim()?e(null):e(JSON.parse(s)),void 0;e(s)}catch(t){s(t)}}))}set(t,e){return new Promise(((s,i)=>{try{qg.setStorageSync({key:t,value:JSON.stringify(e)}),s(!0)}catch(t){i(!1)}}))}remove(t){return new Promise(((e,s)=>{try{qg.removeStorageSync({key:t}),e(!0)}catch(t){s(!1)}}))}info(){return new Promise(((t,e)=>{try{qg.getStorageInfo({success(e){t(e)},fail(){e(null)}})}catch(t){e(null)}}))}};if(void 0!==cc&&void 0!==cc.sys)return x(cc.sys.localStorage);return x(localStorage)}return class{get(t){return new Promise(((e,s)=>{try{e(E.target.getStorageSync(t))}catch(t){s(t)}}))}set(t,e){return new Promise(((s,i)=>{try{E.target.setStorageSync(t,e),s(!0)}catch(t){i(!1)}}))}remove(t){return new Promise(((e,s)=>{try{E.target.removeStorageSync(t),e(!0)}catch(t){s(!1)}}))}info(){return new Promise(((t,e)=>{try{E.target.getStorageInfo({success(e){t(e)},fail(){e(null)}})}catch(t){e(null)}}))}}})());class N{constructor(){this.timer=0}apply(t,e){this.sdk=t,this.options=e,this.boost();const{types:s}=this.sdk;this.getInfo(),this.sdk.on(s.AppOpen,(()=>{this.getInfo(),this.onChange()}))}boost(){}getInfo(){const{target:t}=this.sdk;t&&(this.system(t),this.network(t))}system(t){const e=this,{env:s}=this.sdk;t.getSystemInfo&&t.getSystemInfo({success(t){const i=Math.ceil(t.screenWidth),r=Math.ceil(t.screenHeight),n={device_brand:t.brand,device_model:t.model,os_version:t.system,os_name:t.platform,platform:t.platform,resolution:`${i}x${r}`,screen_width:i,screen_height:r};e.overlap(t,n),s.set(n)}})}network(t){const e=this,{env:s,types:i}=this.sdk;t.getNetworkType&&t.getNetworkType({success(t){const r={access:t.networkType,is_connected:void 0!==t.networkAvailable?!!t.networkAvailable:"none"!==t.networkType};e.sdk.emit(i.Network,{origin:s.get("is_connected"),current:r.is_connected}),s.set(r)},fail(){if(e.timer>0)return;e.timer=setTimeout((()=>{e.network(t)}),50)}})}onChange(){const{target:t,env:e,types:s}=this.sdk;null==t?void 0:t.onNetworkStatusChange((t=>{this.sdk.emit(s.Network,{origin:e.get("is_connected"),current:null==t?void 0:t.isConnected}),e.set({access:null==t?void 0:t.networkType,is_connected:null==t?void 0:t.isConnected})}))}overlap(t,e){e.language=t.language,e.mp_platform_app_version=t.version,e.mp_platform_basic_version=t.SDKVersion}}N.pluginName="official:device";class R extends N{boost(){super.boost(),this.sdk.env.set(Object.assign({sdk_lib:"qg_common",custom_platform:"quickGame",mp_platform:4},"undefined"!=typeof qg||"undefined"!=typeof cc?{is_connected:!0}:{}))}overlap(t,e){super.overlap(t,e),e.os_version=t.system||t.osVersionName,e.os_name=t.platform||t.platformVersionName}}m.useAdapterLog(P),m.useAdapterRequest(j),m.useAdapterStorage(U),m.usePlugin(class extends R{static init(t){const e=$();t.platform=e.is?e.target:null}boost(){super.boost(),this.which=$(),this.sdk.target=this.which.target,this.sdk.whichIs=this.which.is}});class T{apply(t,e){this.sdk=t,this.options=e;const{types:s}=this.sdk;this.sdk.on(s.Check,(({type:t,value:e})=>{var s;if("event"===t){const t=e;if("applog_trace"===t.event)return;const i=0===(null===(s=t.event)||void 0===s?void 0:s.indexOf("__profile_"));i||this.check("name",t.event),this.sdk.isObject(t.params)&&Object.keys(t.params).forEach((e=>{this.check(i?"profile":"param",e,t.params[e])}))}else if("config"===t){const t=e;this.sdk.isObject(t)&&Object.keys(t).forEach((e=>{if("evtParams"===e){const{evtParams:e}=t;this.sdk.isObject(e)&&Object.keys(e).forEach((t=>{this.check("header",t,e[t])}))}else this.check("header",e,t[e])}))}}))}check(t,e,s){const i=t=>/^[a-zA-Z0-9][a-z0-9A-Z_ .-]{0,255}$/.test(t);switch(t){case"name":i(String(e))||this.warn(`event name ${e} illegal`);break;case"param":case"header":case"profile":{const r="param"===t?"event params":"header"===t?"config":"profile";"profile"!==e&&["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time"].includes(e)||i(String(e))||this.warn(`${r} name ${e} illegal`),"string"!=typeof s||(t=>String(t).length<=1024)(s)||this.warn(`the value ${s} length more than 1024 in ${r} ${e}`);break}}}warn(t){var e,s;null===(s=null===(e=this.sdk.adapter._log)||void 0===e?void 0:e.warn)||void 0===s?void 0:s.call(e,t)}}T.pluginName="official:check";class K{constructor(){this.key="start_rangers_data_check",this.buffer=[],this.test=!1,this.testRequestNumber=0,this.interval=1e3,this.needOn=!1,this.onHandler=()=>{}}apply(t,e){this.sdk=t,this.options=e;const{types:s}=this.sdk;this.sdk.once(s.AppOpen,(()=>{try{if(this.host=this.sdk.target,this.host.getLaunchOptionsSync){const t=this.host.getLaunchOptionsSync(),{query:e}=t;this.verify(e).then((()=>{this.needOn=!0,this.onHandler=t=>{this.submit(t)},this.sdk.on(s.Event,this.onHandler)}))}}catch(t){}})),this.sdk.on(s.AppClose,(()=>{this.needOn&&(this.userInfo=null,this.sdk.off(s.Event,this.onHandler),this.onHandler=()=>{},this.needOn=!1)}))}check(t){var e;return null!==(e=null==t?void 0:t[this.key])&&void 0!==e?e:""}verify(t){const{adapter:e}=this.sdk;let s;const i=new Promise((t=>{s=t})),r=t=>{s(!0),this.userInfo=t||{nickName:"未知",avatarUrl:""},e.log(`verify open ${JSON.stringify(this.userInfo)}`),this.login()},n=this.check(t);e.log(`verify ${n}`);const o=this;if(n){try{const t=(t=>{const e=e=>{return(s=t,s.split("").map((t=>t.charCodeAt(0)))).reduce(((t,e)=>t^e),e);var s};return t=>t.match(/.{1,2}/g).map((t=>parseInt(t,16))).map(e).map((t=>String.fromCharCode(t))).join("")})("logverify")(n);t&&/^https?:\/\//.test(t)&&(this.domain=t),e.log(`verify domain ${t}`)}catch(t){}o.host.getSetting({success(t){e.log("getSetting success"),t.authSetting["scope.userInfo"]?(e.log("getSetting scope.userInfo success"),o.host.getUserInfo?o.host.getUserInfo({success(t){e.log("getUserInfo success");const{nickName:s,avatarUrl:i}=t.userInfo;r({nickName:s,avatarUrl:i})},fail(){e.log("getUserInfo fail"),r()}}):o.host.getOpenUserInfo&&o.host.getOpenUserInfo({success(t){e.log("getUserInfo success");try{const e=JSON.parse(t.response).response,{nickName:s,avatar:i}=e;r({nickName:s,avatarUrl:i})}catch(t){}},fail(){e.log("getUserInfo fail"),r()}})):(e.log("getSetting scope.userInfo fail"),r())},fail(){e.log("getSetting fail"),r()}})}return i}submit(t){try{this.pushBuffer(JSON.parse(JSON.stringify(t)))}catch(t){}}login(){if(!this.domain)return;const{header:t}=this.prepareHeader();this.sdk.adapter.request({url:`${this.domain}/simulator/limited_mobile/try_link`,method:"POST",data:Object.assign(Object.assign({header:Object.assign(Object.assign({},t||{}),{aid:t.app_id})},this.userInfo?{nick_name:this.userInfo.nickName}:{}),{host_version:(t.custom||{}).mp_platform_app_version||"",sync_id:this.syncId||""})}).then((t=>{try{const{data:{data:{retry:e,sync_id:s,token:i}}}=t;if(this.syncId=s,this.token=i,this.test&&this.testRequestNumber>3)return this.report(),void 0;0===e||(1===e?this.loginLoop():2===e&&this.report())}catch(t){this.loginLoop()}})).catch((()=>{this.loginLoop()}))}loginLoop(){this.test&&this.testRequestNumber++,setTimeout((()=>{this.login()}),this.interval)}report(){if(!this.domain)return;const{header:t}=this.prepareHeader(),e=this.buffer;this.buffer=[],this.sdk.adapter.request({url:`${this.domain}/simulator/limited_mobile/log`,method:"POST",data:{header:Object.assign(Object.assign({},t||{}),{aid:t.app_id}),token:this.token||"",event_v3:e||[]}}).then((t=>{try{const{data:{data:{keep:e}}}=t;!0===e?this.reportLoop():this.reset()}catch(t){this.reportLoop()}})).catch((()=>{this.reportLoop()}))}reportLoop(){setTimeout((()=>{this.report()}),this.interval)}pushBuffer(t){(Array.isArray(t)?[...t]:[t]).forEach((t=>{if("string"==typeof t.params)try{t.params=JSON.parse(t.params)}catch(t){}this.buffer.push(t)}))}prepareHeader(){const{env:t}=this.sdk,{user:e,header:s}=t.get();return JSON.parse(JSON.stringify({user:e,header:s}))}reset(){this.buffer=[],this.syncId="",this.token=""}}K.pluginName="official:verify";const V={cn:"https://abtest.volceapplog.com",va:"https://toblog.itobsnssdk.com",sg:"https://toblog.tobsnssdk.com"};function L(t,e,s){if(s)return this.emit(this.types.AbVar,{name:t,defaultValue:e,callback:s}),void 0;return new Promise((s=>{this.emit(this.types.AbVar,{name:t,defaultValue:e,callback:t=>{s(t)}})}))}function M(t){if(t)return this.emit(this.types.AbAllVars,t),void 0;return new Promise((t=>{this.emit(this.types.AbAllVars,(e=>{t(e)}))}))}function H(t,e){if(e)return this.emit(this.types.AbRefresh,{params:t,callback:e}),void 0;return new Promise((e=>{this.emit(this.types.AbRefresh,{params:t,callback:t=>{e(t)}})}))}class D{constructor(){this.expire=2592e6,this.domains=V,this.url="/service/2/abtest_config/",this.message={cb:"回调函数必须为一个函数",var:"变量名不能为空",value:"变量没有默认值"},this.fetchStatus=0,this.callbacks=[],this.data=null,this.versions=[],this.externalVersions=null,this.hasOn=!1,this.onHandler=()=>{},this.changeListener=[],this.exposureName="abtest_exposure",this.clear=!1}static init(t){t.prototype.getVar=L,t.prototype.getAllVars=M,t.prototype.getAbSdkVersion=function(){const t=this.get("ab_versions")||[];return t.length>0?t[t.length-1].ab:""},t.prototype.onAbSdkVersionChange=function(t){return this.emit(this.types.AbVersionChangeOn,t),()=>{this.emit(this.types.AbVersionChangeOff,t)}},t.prototype.offAbSdkVersionChange=function(t){this.emit(this.types.AbVersionChangeOff,t)},t.prototype.setExternalAbVersion=function(t){this.emit(this.types.AbExternalVersion,"string"==typeof t&&t?`${t}`.trim():null)},t.prototype.getAbConfig=H}apply(t,e){this.sdk=t,this.options=e;const{adapter:s,types:i,appId:r}=this.sdk;if(this.appId=r,this.externalKey=this.sdk.getKey("ab_version_external"),this.sdk.on(i.AbExternalVersion,(t=>{this.processExternal(t);const{adapter:e}=this.sdk;t?e.set(this.externalKey,t):e.remove(this.externalKey)})),s.get(this.externalKey).then((t=>{if(!t)return;try{this.processExternal(t)}catch(t){}})),!this.options.enable_ab_test)return;this.dataKey=this.sdk.getKey("ab_version"),this.clear=this.options.clear_ab_cache_on_user_change,this.domain=this.getDomain(),this.sdk.on(i.UuidChangeAfter,(()=>{if(!this.sdk.ready)return;this.clear&&(this.versions=[],this.data={},this.updateVersions(),this.emitChange())})),this.sdk.once(i.Ready,(()=>{this.preFetch(),this.sdk.on(i.UuidChangeAfter,(()=>{this.preFetch()}))})),this.sdk.on(i.AbVar,(({name:t,defaultValue:e,callback:s})=>{this.getVar(t,e,s)})),this.sdk.on(i.AbAllVars,(t=>{this.getAllVars(t)})),this.sdk.on(i.AbVersionChangeOn,(t=>{this.changeListener.push(t)})),this.sdk.on(i.AbVersionChangeOff,(t=>{const e=this.changeListener.indexOf(t);-1!==e&&this.changeListener.splice(e,1)})),this.sdk.on(i.AbRefresh,(({params:t,callback:e})=>{this.preFetch(t,e)})),s.get(this.dataKey).then((t=>{if(!t)return;const e=t.timestamp;if(o()-e>=this.expire)return this.sdk.adapter.remove(this.dataKey),void 0;try{const{ab_version:e,data:s}=t;2!==this.fetchStatus&&(this.versions=e||[],this.data=s,this.configVersions())}catch(t){}}))}output(t){this.sdk.adapter.log(t)}processExternal(t){this.externalVersions=t,this.sdk.set("ab_sdk_version_external",t)}getAllVars(t){if("function"!=typeof t)return this.output(this.message.cb);const e={callback:t,type:1};2===this.fetchStatus?this._getAllVars(e):this.callbacks.push(e)}getVar(t,e,s){if(!t)return this.output(this.message.var);if(void 0===e)return this.output(this.message.value);if("function"!=typeof s)return this.output(this.message.cb);const i={name:t,defaultValue:e,callback:t=>{try{s(t)}catch(t){}},type:0};2===this.fetchStatus?this._getVar(i):this.callbacks.push(i)}fetchComplete(t){if(t){this.data=t;const e=[];Object.keys(t).forEach((s=>{const{vid:i}=t[s];i&&e.push(i)}));const s=this.versions.length;s?(this.versions=this.versions.filter((t=>e.includes(t))),this.versions.length!==s&&this.updateVersions()):this.updateVersions()}this.callbacks.forEach((t=>this[0===t.type?"_getVar":"_getAllVars"](t))),this.callbacks=[]}_getAllVars(t){const{callback:e}=t;e(this.data?JSON.parse(JSON.stringify(this.data)):{})}_getVar(t){const{name:e,defaultValue:s,callback:i}=t,{data:r}=this;if(!r)return i(s),void 0;if(this.sdk.isObject(r[e])){const{vid:t,val:s}=r[e];return t&&(this.versions.includes(t)||(this.versions.push(t),this.updateVersions(),this.emitChange()),this.sdk.emit(this.sdk.types.Event,Object.assign(Object.assign({},this.sdk.createEvent({event:this.exposureName},!1)),{ab_sdk_version:t}))),i(s),void 0}i(s)}updateVersions(){this.configVersions(),this.sdk.adapter.set(this.dataKey,{data:this.data,ab_version:this.versions,timestamp:o()})}configVersions(){const t=this.versions.join(",");this.sdk.set("ab_sdk_version",t);const e="ab_versions";this.sdk.set(e,[...this.sdk.get(e)||[],{time:o(),ab:t}])}emitChange(){const t=this.versions.join(",");this.changeListener.length>0&&this.changeListener.forEach((e=>{"function"==typeof e&&setTimeout((()=>{try{e(t)}catch(t){}}),0)}))}getDomain(){var t;const{channel_domain:e,ab_channel_domain:s}=this.options,{option:i}=this.sdk,r=null===(t=i.get("cloneOption"))||void 0===t?void 0:t.report_channel;let n="";if(s)n=s;else if(e)n=e;else{let{report_channel:t}=this.options;Object.keys(this.domains).includes(t)||(t=r),n=this.domains[t]}return n}preFetch(e={},s){if(!this.domain)return this.fetchStatus=2,this.fetchComplete(null),s&&s(null),void 0;const{env:i}=this.sdk,{user:r,header:n}=i.get(),{headers:o}=n,a=t(n,["headers"]);this.user=Object.assign({},r),this.fetch(Object.assign(Object.assign(Object.assign({},a),o),e||{})).then((t=>s&&s(t)))}fetch(t){this.fetchStatus=1;const{user_unique_id:e}=this.user;return this.sdk.adapter.request({url:`${this.domain}${this.url}`,method:"POST",data:{header:Object.assign(Object.assign({aid:this.appId},this.user||{}),t||{})}}).then((t=>{var s;if(this.user.user_unique_id!==e)return null;this.fetchStatus=2;const i=null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.data;return this.sdk.emit(this.sdk.types.AbFetchAfter,i),this.fetchComplete(i),i})).catch((()=>(this.fetchStatus=2,this.fetchComplete(null),null)))}}D.pluginName="official:ab";const J=t=>{let e=t;try{e=decodeURIComponent(t)}catch(t){}return e};var F;!function(t){t[t.Undefined=0]="Undefined",t[t.Start=1]="Start",t[t.End=2]="End"}(F||(F={}));class B{constructor(){this.key="utm",this.utmed=F.Undefined,this.reload=!1}apply(t,e){this.sdk=t,this.options=e;const{types:s}=this.sdk;this.sdk.on(s.LaunchInfo,(t=>{var e,s;if(this.utmed===F.Start)return;this.utmed===F.End&&(this.reload=!0),this.utmed=F.Start,this.parseDefault(null!==(e=null==t?void 0:t.query)&&void 0!==e?e:{}),this.parseMore(null!==(s=null==t?void 0:t.query)&&void 0!==s?s:{})})),this.sdk.on(s.AppHide,(()=>{this.utmed=F.End}))}parseDefault(t={}){let e=!1;const s=Object.keys(t).reduce(((s,i)=>(this.sdk.UtmType.includes(i)&&(e=!0,s[i]=J(t[i])),s)),{});e&&this.sdk.env.set(s)}parseMore(t={}){const{tr_token:e="",surl_token:s="",scene:i=""}=t||{};let r=e||s;if(i){const t=(t=>{const e={};return t&&t.split("&").forEach((t=>{if(t){const s=t.split("=");s[0]&&(e[s[0]]=s[1]||"")}})),e})(J(`${i}`));t.tr_token&&(r=t.tr_token),this.sdk.set("scene_extra_query",t)}if(!r)return this.dispatch(),void 0;const n=()=>{this.reload?this.sdk.emit(this.sdk.types.CancelPause):this.dispatch()};this.reload&&this.sdk.emit(this.sdk.types.Pause),this.storageGet(r).then((t=>{t?(this.sdk.env.set(t.utms||{}),n()):this.fetch(r).then((()=>n())).catch((()=>n()))})).catch((()=>{this.fetch(r).then((()=>n())).catch((()=>n()))}))}storageGet(t){const e=this.sdk.getKey(this.key),{adapter:s}=this.sdk;return s.get(e).then((i=>{const r=o(),n=[];if(Object.keys(i).forEach((t=>{i[t]&&i[t].timestamp+864e7<r&&n.push(t)})),n.length>0&&(n.forEach((t=>{delete i[t]})),s.set(e,i)),i&&i[t])return i[t];return null}))}storageSet(t,e){const s=this.sdk.getKey(this.key),{adapter:i}=this.sdk;i.get(s).then((r=>{r||(r={}),r[t]={utms:e,timestamp:o()},i.set(s,r)}))}fetch(t){const{adapter:e,option:s,env:i,UtmType:r}=this.sdk;return e.request({url:`${s.get("domain")}/service/2/mp_campaigns`,method:"GET",data:{tr_token:t},timeout:3e3}).then((s=>{const{data:{code:n=-1,data:o={},message:a=""}={}}=s||{};if(0===n){if(this.sdk.isObject(o)){let e=!1;const s=Object.keys(o).reduce(((t,i)=>(r.includes(i)&&(e=!0,s[i]=o[i]),t)),{});e&&i.set(s),this.storageSet(t,s)}}else 40002===n&&this.storageSet(t,{});0!==n&&e.log(a||"")}))}dispatch(){this.sdk.emit(this.sdk.types.LaunchComplete)}}B.pluginName="official:utm";class z{apply(t,e){this.sdk=t,this.options=e;const{types:s}=this.sdk;this.options.disable_sdk_monitor||this.options.channel_domain||this.sdk.on(s.Ready,(()=>{this.reportLoad()}))}reportLoad(){const t=this.sdk.env.get(),{user:e,header:s}=t,i=this.sdk.env.merge([{event:"onload",params:Object.assign(Object.assign(Object.assign({},e),s),this.options)}]);i[0].header.app_id=1338,this.report(i)}report(t){if(!this.reportUrl){let t=this.sdk.get("report_url");if(!t)return;t+=(t.indexOf("?")?"&":"?")+"type=monitor",this.reportUrl=t}this.sdk.adapter.request({url:this.reportUrl,method:"POST",header:{"X-MCS-AppKey":"566f58151b0ed37e"},data:t})}}z.pluginName="official:monitor";const G=(t,e)=>{t.adapter.log(`参数类型不匹配，参数及类型需要如下：${e}`)},W="gt_ad_button_click",X="gt_ad_show",Z="gt_ad_show_end",Q="gt_levelup",Y="gt_start_play",et="gt_end_play",st="gt_get_coins",it="gt_cost_coins",rt="purchase",nt={gtAdButtonClick:(t,e,s)=>{if("string"!=typeof s.ad_type||"string"!=typeof s.ad_position_type||"string"!=typeof s.ad_position)return G(t,"ad_type: string;ad_position_type: string;ad_position: string;"),void 0;e(W,Object.assign({},s))},gtAdShow:(t,e,s)=>{if("string"!=typeof s.ad_type||"string"!=typeof s.ad_position_type||"string"!=typeof s.ad_position)return G(t,"ad_type: string;ad_position_type: string;ad_position: string;"),void 0;e(X,Object.assign({},s))},gtAdShowEnd:(t,e,s)=>{if("string"!=typeof s.ad_type||"string"!=typeof s.ad_position_type||"string"!=typeof s.ad_position||"string"!=typeof s.result)return G(t,"ad_type: string;ad_position_type: string;ad_position: string;result: string;"),void 0;e(Z,Object.assign({},s))},gtLevelup:(t,e,s)=>{if("number"!=typeof s.get_exp||"string"!=typeof s.method||"number"!=typeof s.aflev||"number"!=typeof s.lev)return G(t,"get_exp: number;method: string;aflev: number;lev: number;"),void 0;e(Q,Object.assign({},s))},gtStartPlay:(t,e,s)=>{if("string"!=typeof s.ectype_name)return G(t,"ectype_name: string;"),void 0;e(Y,Object.assign({},s))},gtEndPlay:(t,e,s)=>{if("string"!=typeof s.ectype_name||"string"!=typeof s.result||"number"!=typeof s.duration)return G(t,"ectype_name: string;result: string;duration: number;"),void 0;e(et,Object.assign({},s))},gtGetCoins:(t,e,s)=>{if("string"!=typeof s.coin_type||"string"!=typeof s.method||"number"!=typeof s.coin_num)return G(t,"coin_type: string;method: string;coin_num: number;"),void 0;e(st,Object.assign({},s))},gtCostCoins:(t,e,s)=>{if("string"!=typeof s.coin_type||"string"!=typeof s.method||"number"!=typeof s.coin_num)return G(t,"coin_type: string;method: string;coin_num: number;"),void 0;e(it,Object.assign({},s))},gtPurchase:(t,e,s)=>{if("string"!=typeof s.content_id||"string"!=typeof s.content_name||"number"!=typeof s.content_num||"string"!=typeof s.content_type||"string"!=typeof s.currency||"number"!=typeof s.currency_amount||"string"!=typeof s.is_success||"string"!=typeof s.payment_channel)return G(t,"content_id: string;content_name: string;content_num: number;content_type: string;currency: string;currency_amount: number;is_success: string;payment_channel: string;"),void 0;e(rt,Object.assign({},s))}};class ot{apply(t,e){this.sdk=t,this.options=e,Object.keys(nt).forEach((t=>{this.sdk[t]=nt[t].bind(null,this.sdk,this.sdk.event.bind(this.sdk))}))}}var at;ot.pluginName="official:extend",function(t){t.True="true",t.False="false"}(at||(at={}));const ht=["wx","qq"];class ct{constructor(){this.queue=[],this.firstTime=at.False,this.open=!1,this.startup=0}static init(t){var e,s,i,r,n,o;t.platform&&(null===(s=(e=t.platform).onShow)||void 0===s?void 0:s.call(e,(e=>{t.instances.forEach((t=>{t.emit(t.types.AppShowStart,e),t.emit(t.types.AppShow,e)}))})),null===(r=(i=t.platform).onHide)||void 0===r||r.call(i,(()=>{t.instances.forEach((t=>{t.emit(t.types.AppHide),t.emit(t.types.AppClose)}))})),null===(o=(n=t.platform).onError)||void 0===o||o.call(n,(e=>{t.instances.forEach((t=>{t.emit(t.types.AppError,e)}))}))),t.prototype.appLaunch=function(){this.appShow()},t.prototype.appTerminate=function(){this.appHide()},t.prototype.appShow=function(){let t;void 0!==this.target.getLaunchOptionsSync&&(t=this.target.getLaunchOptionsSync()),this.emit(this.types.AppShow,t)},t.prototype.appHide=function(){this.emit(this.types.AppHide)},t.prototype.appError=function(t){this.emit(this.types.AppError,t)},t.prototype.rangerOnShareAppMessage=function(t){this.emit(this.types.AppOnShare,t)},t.prototype.rangerShareAppMessage=function(t){this.emit(this.types.AppShare,t)}}apply(t,e){this.sdk=t,this.options=e,this.open=!!this.options.auto_report;const{types:s,adapter:i}=this.sdk,r=this.sdk.getKey("first");if(i.get(r).then((t=>{if(t===at.False)return this.firstTime=at.False,void 0;t||(this.firstTime=at.True),i.set(r,at.False)})),this.sdk.on(s.Ready,(()=>{this.queue.length>0&&(this.sdk.event([...this.queue]),this.queue.length=0)})),"undefined"!=typeof cc)return this.sdk.emit(this.sdk.types.LaunchComplete),void 0;this.sdk.target&&this.appLaunch(),this.open&&this.sdk.target&&(this.sdk.whichIs&&ht.includes(this.sdk.whichIs)&&(this.appShowPrefix(this.appInfo),this.appShow(this.appInfo)),this.sdk.on(s.AppShow,(t=>{this.appShowPrefix(t),this.appShow(t)})),this.sdk.on(s.AppHide,(()=>{this.appHide()})),this.sdk.on(s.AppError,(t=>{this.appError(t)})),this.sdk.on(s.AppOnShare,(t=>{this.onShareAppMessage(t)})),this.sdk.on(s.AppShare,(t=>{this.shareAppMessage(t)})),this.sdk.on(s.UuidChangeBefore,(()=>{this.appHide(!0)})),this.sdk.on(s.UuidChangeAfter,(()=>{this.appShow(this.appInfo||{},!0)})))}event(t,e){const{ready:s}=this.sdk;s?this.sdk.event(t,e):this.queue.push({event:t,params:e,local_time_ms:o()})}getQuery(t={}){const e={};return this.sdk.isObject(t)&&Object.keys(t).forEach((s=>{if(!this.sdk.UtmType.includes(s)&&"scene"!==s){let i=t[s];"from_title"===s&&(i=encodeURIComponent(J(t[s]))),e[`query_${s}`]=i}})),e}appLaunch(){var t,e,s;this.appInfo=null===(e=(t=this.sdk.target).getLaunchOptionsSync)||void 0===e?void 0:e.call(t),this.scene=null===(s=this.appInfo)||void 0===s?void 0:s.scene,this.sdk.checkUsePlugin("official:utm")?this.sdk.emit(this.sdk.types.LaunchInfo,this.appInfo):this.sdk.emit(this.sdk.types.LaunchComplete)}appShowPrefix(t){this.startup++}}ct.pluginName="official:auto",ct.instances=[];class pt{constructor(){this.key="compensate",this.keyCache=[],this.batchMax=5,this.cacheBatchNumber=15,this.enable=!1,this.unReadyKeys={},this.bufferKeys={},this.errorKeys={},this.bufferPreKey="",this.errorPreKey="",this.hasKey=!1}apply(t,e){if(this.sdk=t,this.options=e,this.enable=!!this.options.enable_cache,!this.enable)return;this.reportUrl=this.sdk.get("report_url"),this.bufferPreKey=this.sdk.getKey("buffer"),this.errorPreKey=this.sdk.getKey("compensate");const{types:s}=this.sdk;this.sdk.on(s.AppShow,(()=>{this.hasKey?this.sdk.ready&&this.network()&&this.nowReport():this.getKeys().then((()=>{this.hasKey=!0,this.sdk.ready&&this.network()&&this.nowReport()}))})),this.sdk.on(s.Ready,(()=>{this.hasKey?this.network()&&this.nowReport():this.getKeys().then((()=>{this.hasKey=!0,this.network()&&this.nowReport()}))})),this.sdk.on(s.Network,(t=>{t.current&&this.sdk.ready&&this.nowReport()})),this.sdk.on(s.AppClose,(()=>{try{["unReadyKeys","bufferKeys","errorKeys"].forEach((t=>{Object.keys(this[t]).forEach((e=>{2===this[t][e]&&delete this[t][e]}))}))}catch(t){}})),this.sdk.on(s.SubmitError,(t=>{const{event:e}=t;this.storageError(e).then((t=>{this.errorKeys[t]=0}))})),this.sdk.on(s.CacheUnReady,(t=>{const e=t.length;if(e>0){const s=`${this.bufferPreKey}_unready_`;if(e>this.cacheBatchNumber){const e=[...t];for(;e.length>0;){const t=e.splice(0,this.cacheBatchNumber);if(t.length>0){const e=s+this.random();this.sSet(e,t).then((()=>this.unReadyKeys[s]=0))}}}else{const e=s+this.random();this.sSet(e,t).then((()=>this.unReadyKeys[s]=0))}}})),this.sdk.on(s.CacheBuffer,(t=>{const e=`${this.bufferPreKey}_buffer_`+this.random();this.sSet(e,t).then((()=>{this.bufferKeys[e]=0}))}))}getKeys(){const{adapter:t}=this.sdk;return t.storageInfo().then((t=>{if(null==t?void 0:t.keys){const{keys:e}=t;Array.isArray(e)&&e.forEach((t=>{0===t.indexOf(`${this.bufferPreKey}_unready`)?void 0===this.unReadyKeys[t]&&(this.unReadyKeys[t]=0):0===t.indexOf(`${this.bufferPreKey}_buffer`)?void 0===this.bufferKeys[t]&&(this.bufferKeys[t]=0):0===t.indexOf(`${this.errorPreKey}`)&&void 0===this.errorKeys[t]&&(this.errorKeys[t]=0)}))}}))}nowReport(){this.unReadyReport(),this.bufferReport(),this.errorReport()}unReadyReport(){this.batchReport(this.unReadyKeys,!0)}bufferReport(){this.batchReport(this.bufferKeys,!1)}errorReport(){this.batchReport(this.errorKeys,!1)}batchReport(t,e=!1){const s=Object.keys(t).filter((e=>0===t[e]));if(0===s.length)return;if(s.length<=3)s.forEach((s=>{t[s]=1,this.byKey(t,s,e)}));else{const i=[...s];let r=0;for(;i.length>0;){const s=i.splice(0,3);s.length>0&&(s.forEach((e=>{t[e]=1})),setTimeout((()=>{s.forEach((s=>{this.byKey(t,s,e)}))}),150*r)),r++}}}byKey(t,e,s){this.sGet(e).then((i=>{if(!i)return t[e]=2,void 0;const r=s?this.sdk.env.compose(i):i;this.report(r).then((()=>{t[e]=2,this.sRemove(e)})).catch((()=>{t[e]=0}))})).catch((()=>{t[e]=0}))}report(t){if(!this.reportUrl&&(this.reportUrl=this.sdk.get("report_url"),!this.reportUrl))return Promise.reject();return this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:t})}storageError(t){const e=`${this.errorPreKey}_`+this.random();return this.sSet(e,t).then((()=>e))}sGet(t){const{adapter:e}=this.sdk;return e.get(t).then((s=>{if(!this.sdk.isObject(s)||!s.timestamp)return e.remove(t),null;const i=o();if(s.timestamp+6048e5<i)return e.remove(t),null;return s.data}))}sSet(t,e){const{adapter:s}=this.sdk;return s.set(t,{data:e,timestamp:o()})}sRemove(t){return this.sdk.adapter.remove(t)}random(){return`${+new Date}_${Math.floor(1e5*Math.random())}`}network(){return!!this.sdk.env.get("is_connected")}}pt.pluginName="official:compensate",m.usePlugin(T),m.usePlugin(K),m.usePlugin(D),m.usePlugin(B),m.usePlugin(z),m.usePlugin(ot),m.usePlugin(class extends ct{constructor(){super(...arguments),this.sessionStart=0,this.sessionDepth=0,this.shareDepth=0}appShow(t,e=!1){this.sessionStart=o();const s={session_id:this.sdk.sessionId,$is_first_time:this.firstTime};if(t)if("string"==typeof t)s.query=t;else if("object"==typeof t){const{scene:e,query:i}=t;if(s.scene=e,s.path="/",i&&"object"==typeof i){this.shareDepth=Number(i.share_depth)||0;const t={},e={};let r=!1;Object.keys(i).forEach((n=>{const o=i[n];this.sdk.UtmType.includes(n)?(r=!0,e[n]=J(o)):(t[n]=o,s[`query_${n}`]=o)})),r&&this.sdk.env.set(e),s.query=JSON.stringify(t)}}s.launch_type=e?2:this.startup>1?1:0,this.event(this.sdk.EventType.appOnShow,s),this.firstTime===at.True&&(this.firstTime=at.False)}appHide(t=!1){const e={session_duration:Math.ceil((o()-this.sessionStart)/1e3),session_id:this.sdk.sessionId};e.terminate_type=t?2:1,this.event(this.sdk.EventType.appOnHide,e)}appError(t){let e={session_id:this.sdk.sessionId};if("string"==typeof t)e=Object.assign(Object.assign({},e),{stack:t,on_error:t});else{const{message:s="",stack:i=""}=this.sdk.isObject(t)?t:{};e=Object.assign(Object.assign({},e),{stack:i,on_error:i,message:s})}this.event(this.sdk.EventType.appOnError,e)}appShare(t){const{user_unique_id:e}=this.sdk.env.get("user"),s=(Number(this.shareDepth)||0)+1;let i=t||{};"object"!=typeof i&&(i={});const{title:r=""}=i,n=`from_user_unique_id=${e}&share_depth=${s}&from_title=${r}`;return i.query?i.query+="&"+n:i.query=n,this.event(this.sdk.EventType.pageOnShareAppMessage,Object.assign(Object.assign({},i.title?{title:i.title}:{}),{path:"/?"+i.query,query_share_depth:s,session_id:this.sdk.sessionId})),i}onShareAppMessage(t){try{"function"==typeof this.sdk.target.onShareAppMessage&&this.sdk.target.onShareAppMessage((()=>this.appShare(t())))}catch(t){}}shareAppMessage(t){try{"function"==typeof this.sdk.target.shareAppMessage&&this.sdk.target.shareAppMessage(this.appShare(t))}catch(t){}}}),m.usePlugin(pt);var dt=new m;export{dt as default};
