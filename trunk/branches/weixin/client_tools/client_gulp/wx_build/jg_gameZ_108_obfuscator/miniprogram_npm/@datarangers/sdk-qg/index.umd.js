!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).$$TEA=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function u(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=o(e);if(t){var s=o(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return u(this,n)}}function h(e,t,n){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(!i)return;var s=Object.getOwnPropertyDescriptor(i,t);if(s.get)return s.get.call(n);return s.value},h(e,t,n||e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,s,r=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){a=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}return r}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}var y,g=void 0,m="cn",k={cn:"https://mcs.volceapplog.com",va:"https://mcs.itobsnssdk.com",sg:"https://mcs.tobsnssdk.com"},_={appOnShow:"app_launch",appOnHide:"app_terminate",appOnError:"on_error",pageOnShow:"predefine_pageview",pageOnHide:"predefine_pageview_hide",pageOnShareAppMessage:"on_share",pageOnAddToFavorites:"on_addtofavorites",mpClick:"bav2b_click"},b=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],O=["__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],w=function(){return+new Date},S=function(){function e(n){t(this,e),this.sdk=n,this.env=this.init()}return i(e,[{key:"init",value:function(){return{user:{web_id:g,user_unique_id:g,user_id:g,user_type:g,user_is_auth:g,user_is_login:g,ip_addr_id:g,device_id:g,user_unique_id_type:g},header:{app_id:g,app_name:g,app_install_id:g,install_id:g,app_package:g,app_channel:g,app_version:g,os_name:g,os_version:g,device_model:g,device_brand:g,traffic_type:g,client_ip:g,os_api:g,access:g,language:g,app_language:g,creative_id:g,ad_id:g,campaign_id:g,ab_client:g,ab_version:g,platform:g,sdk_version:g,sdk_lib:g,app_region:g,region:g,province:g,city:g,timezone:g,tz_offset:g,tz_name:g,sim_region:g,carrier:g,resolution:g,screen_width:g,screen_height:g,browser:g,browser_version:g,referrer:g,referrer_host:g,utm_source:g,utm_medium:g,utm_campaign:g,utm_term:g,utm_content:g,custom:{},ab_sdk_version:g,_sdk_version:g,_sdk_name:g,wechat_openid:g,wechat_unionid:g,is_connected:g}}}},{key:"set",value:function(e){var t=this;this.sdk.emit(this.sdk.types.EnvTransform,e),Object.keys(e).forEach((function(n){if("evtParams"===n)t.evtParams=Object.assign(Object.assign({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===n)t.evtParams=Object.assign(Object.assign({},t.evtParams||{}),{_staging_flag:e._staging_flag});else{var i=n,s=e[n];if(null===s)return!1;var r="";if(i.indexOf(".")>-1){var o=f(i.split("."),2);r=o[0],i=o[1]}"platform"===i&&(s="mp"),"os_version"!==i&&"mp_platform"!==i||(s="".concat(s)),r?("headers"===r&&(r="header"),"user"===r||"header"===r?t.env[r][i]=s:t.env.header.custom[i]=s):t.env.user.hasOwnProperty(i)?["user_type","ip_addr_id"].indexOf(i)>-1?t.env.user[i]=Number(s):["user_id","web_id","user_unique_id"].indexOf(i)>-1?t.env.user[i]=String(s):["user_is_auth","user_is_login"].indexOf(i)>-1?t.env.user[i]=Boolean(s):t.env.user[i]=s:t.env.header.hasOwnProperty(i)?t.env.header[i]=s:t.env.header.custom[i]=s}}))}},{key:"get",value:function(e){if(!e||"env"===e)return this.clone(this.env);if("evtParams"===e)return Object.assign({},this[e]);if(this.env.hasOwnProperty(e))return this.clone(this.env[e]);if(this.env.user.hasOwnProperty(e))return this.clone(this.env.user[e]);if(this.env.header.hasOwnProperty(e))return this.clone(this.env.header[e]);if(this.env.header.custom.hasOwnProperty(e))return this.clone(this.env.header.custom[e])}},{key:"compose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.env,i=n.user,s=n.header,r=this.evtParams,o=e.map((function(e){return e.event&&!t.includes(e.event)&&r&&Object.keys(r).forEach((function(t){void 0===e.params[t]&&(e.params[t]=r[t])})),e.params=JSON.stringify(e.params),e}));return this.clone({events:o,user:i,header:s})}},{key:"merge",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.compose(e,t);return n.local_time=Math.floor(w()/1e3),[n]}},{key:"clone",value:function(e){if(this.sdk.isObject(e))return JSON.parse(JSON.stringify(e));return e}}]),e}(),P=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},A=function(e){return"number"==typeof e&&!isNaN(e)},C=function(){function e(){t(this,e),this.domains=k,this.init()}return i(e,[{key:"init",value:function(){this.option={caller:"",log:!1,channel:m,report_channel:m,channel_domain:"",report_url:"",auto_report:false,auto_profile:false,profile_channel:"cn",enable_profile:false,enable_ab_test:false,ab_channel_domain:"",clear_ab_cache_on_user_change:true,enable_et_test:false,event_verify_url:"",enable_buffer:false,buffer_interval:5e3,buffer_number:5,enable_storage_only:false,enable_cache:false,enable_filter_list:false,enable_third:false,enable_filter_crawler:false,request_timeout:0,enable_initiative_launch:false,enable_custom_webid:false,disable_sdk_monitor:false,verify:null},this.cloneOption=Object.assign({},this.option),this.initDomain()}},{key:"initDomain",value:function(){if(this.option.channel_domain)return this.domain=this.option.channel_domain,void 0;var e=this.option.report_channel;Object.keys(this.domains).includes(e)||(e=m),this.domain=this.domains[e]}},{key:"set",value:function(e){var t=this;if(!P(e))return;Object.keys(e).forEach((function(n){t.option.hasOwnProperty(n)&&("channel"===n||"report_channel"===n?(t.option.report_channel=t.option.channel=e[n]?e[n]:t.cloneOption[n],t.initDomain()):(t.option[n]=void 0===e[n]?t.cloneOption[n]:e[n],"channel_domain"===n&&t.initDomain()))}))}},{key:"get",value:function(e){if(e){if(this.hasOwnProperty(e))return this[e];if(this.option.hasOwnProperty(e))return this.option[e];return}return Object.assign({},this.option)}}]),e}(),j=function(){function e(){t(this,e),this.hooks={}}return i(e,[{key:"on",value:function(e,t){if(!e||!t||"function"!=typeof t)return;this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t)}},{key:"once",value:function(e,t){var n=this;if(!e||!t||"function"!=typeof t)return;this.on(e,(function i(s){t(s),n.off(e,i)}))}},{key:"off",value:function(e,t){if(!e||!this.hooks[e]||!this.hooks[e].length)return;if(t){var n=this.hooks[e].indexOf(t);-1!==n&&this.hooks[e].splice(n,1)}else this.hooks[e]=[]}},{key:"emit",value:function(e,t){if(!e||!this.hooks[e]||!this.hooks[e].length)return;p(this.hooks[e]).forEach((function(e){try{e(t)}catch(e){}}))}}]),e}(),I=function(){function e(n){t(this,e),this.ready=!1,this.sdk=n}return i(e,[{key:"setLog",value:function(e){e&&this.sdk.isFunction(e.log)&&(this._log=e)}},{key:"setRequest",value:function(e){if(this.sdk.isFunction(e)){var t=e(this.sdk);this.sdk.isFunction(t)&&(this._request=t)}}},{key:"setStorage",value:function(e){this.sdk.isObject(e)&&this.sdk.isFunction(e.get)&&this.sdk.isFunction(e.set)&&this.sdk.isFunction(e.remove)&&(this._storage=e)}},{key:"check",value:function(){if(!this._request||!this._storage)return;this.ready=!0}},{key:"log",value:function(){if(!this._log)return;try{var e;this.sdk.option.get("log")&&(e=this._log).log.apply(e,arguments)}catch(e){}}},{key:"request",value:function(e){var t;if(!this.ready)return Promise.reject(null);try{return null===(t=this._request)||void 0===t?void 0:t.call(this,e)}catch(e){}}},{key:"get",value:function(e){if(!this.ready)return Promise.reject(null);return this._storage.get(e)}},{key:"set",value:function(e,t){if(!this.ready)return Promise.reject(!1);return this._storage.set(e,t)}},{key:"remove",value:function(e){if(!this.ready)return Promise.reject(!1);return this._storage.remove(e)}},{key:"storageInfo",value:function(){if(!this.ready)return Promise.reject(null);return this._storage.info()}}]),e}();!function(e){e.Init="$init",e.Config="$config",e.Send="$send",e.Ready="$ready",e.TokenComplete="$token-complete",e.TokenStorage="$token-storage",e.TokenFetch="$token-fetch",e.TokenGet="$token-get",e.LaunchComplete="$launch-complete",e.ConfigUuid="$config-uuid",e.ConfigWebId="$config-webid",e.ConfigTransform="$config-transform",e.UuidChangeBefore="$uuid-change-before",e.UuidChangeAfter="$uuid-change-after",e.EnvTransform="$env-transform",e.Event="$event",e.Report="$report",e.AppOpen="$app-open",e.AppClose="$app-close",e.AppShowStart="$app-show-start",e.AppShow="$app-show",e.AppHide="$app-hide",e.AppError="$app-error",e.AppShare="$app-share",e.AppOnShare="$app-on-share",e.PageShow="$page-show",e.PageHide="$page-hide",e.PageShare="$page-share",e.SubmitBefore="$submit-before",e.SubmitAfter="$submit-after",e.SubmitError="$submit-error",e.FilterCrawler="$filter-crawler",e.LaunchInfo="$launch-info",e.Pause="$pause",e.CancelPause="$cancel-pause",e.AbVar="$ab-var",e.AbAllVars="$ab-all-vars",e.AbExternalVersion="$ab-external-version",e.AbVersionChangeOn="$ab-version-change-on",e.AbVersionChangeOff="$ab-version-change-off",e.AbRefresh="$ab-refresh",e.AbFetchAfter="$ab-fetch-After",e.ProfileSet="$profile-set",e.ProfileSetOnce="$profile-set-once",e.ProfileUnset="$profile-unset",e.ProfileIncrement="$profile-increment",e.ProfileAppend="$profile-append",e.ProfileClear="$profile-clear",e.ProfileSubmitAfter="$profile-submit-after",e.ProfileSubmitError="$profile-submit-error",e.TransformInfo="$transform-info",e.ExtendAppLaunch="$extend-app-launch",e.ExtendAppTerminate="$extend-app-terminate",e.ExtendAppError="$extend-app-error",e.ExtendPageShow="$extend-page-show",e.ExtendPageHide="$extend-page-hide",e.ExtendPageShare="$extend-page-share",e.ExtendPageFavorite="$extend-page-favorite",e.MpClick="$mp-click",e.Network="$network",e.CacheUnReady="$cache-unready",e.CacheBuffer="$cache-buffer",e.Verify="$verify",e.Check="$check"}(y||(y={}));var q=y,E=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},x=function(){function e(){t(this,e),this.types=q,this.EventType=_,this.ProfileType=O,this.UtmType=b,this.SdkHook=q,this.Domains=k,this.inited=!1,this.sended=!1,this.pluginInstances=[],this.data={},this.unInitedCache=[],this.ready=!1,this.sessionId="",this.appShowStarted=!1,this.env=new S(this),this.option=new C,this.hook=new j,this.sessionId=E(),e.instances.push(this);try{this.adapter=new I(this),this.adapter.setLog(e._log),this.adapter.setRequest(e._request),this.adapter.setStorage(e._storage),this.adapter.check(),e.plugins.reduce((function(e,t){var n=t.plugin;return e.push(new n),e}),this.pluginInstances)}catch(e){}}return i(e,[{key:"on",value:function(e,t){var n;null===(n=this.hook)||void 0===n?void 0:n.on(e,t)}},{key:"once",value:function(e,t){var n;null===(n=this.hook)||void 0===n?void 0:n.once(e,t)}},{key:"off",value:function(e,t){var n;if(!t&&this.types[e])return;null===(n=this.hook)||void 0===n?void 0:n.off(e,t)}},{key:"emit",value:function(e,t){var n;this.adapter.log("emit ".concat(e),t||""),null===(n=this.hook)||void 0===n||n.emit(e,t)}},{key:"appId",get:function(){return this._appId}},{key:"checkUsePlugin",value:function(t){return!!e.plugins.find((function(e){return e.name===t}))}},{key:"init",value:function(e){var t=this;if(this.inited||!this.isObject(e))return;var n=e.app_id,i=e.log,s=v(e,["app_id","log"]);if(void 0!==i&&this.option.set({log:i}),!(A(n)&&n>0))return this.adapter.log("app_id invalid"),void 0;this._appId=n,this.option.set(s),this.env.set({app_id:n}),Promise.all([new Promise((function(e){t.once(t.types.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){t.checkUsePlugin("official:auto")?t.on(t.types.LaunchComplete,(function(){e(!0)})):e(!0)})),new Promise((function(e){t.sended?e(!0):t.once(t.types.Send,(function(){e(!0)}))}))]).then((function(){t.ready=!0,t.emit(t.types.Ready)})),this.on(this.types.AppShowStart,(function(){t.appShowStarted?t.sessionId=E():t.appShowStarted=!0})),this.on(this.types.UuidChangeAfter,(function(){t.sessionId=E()}));var r=this.option.get();if(this.pluginInstances.forEach((function(e){e.apply(t,r)})),this.get("is-crawler"))return;this.inited=!0,this.emit(this.types.Init),this.unInitedCache.length>0&&this.unInitedCache.forEach((function(e){t.emit(t.types.Event,e)}))}},{key:"config",value:function(e){if(!this.inited||!this.isObject(e))return;this.emit(this.types.Config,e),this.emit(this.types.ConfigTransform,e);var t=e.web_id,n=e.user_unique_id,i=v(e,["web_id","user_unique_id"]);void 0!==t&&this.emit(this.types.ConfigWebId,t),void 0!==n&&this.emit(this.types.ConfigUuid,n),this.emit(this.types.Check,{type:"config",value:i}),this.env.set(i)}},{key:"send",value:function(){if(!this.inited||this.sended)return;this.sended=!0,this.emit(this.types.Send)}},{key:"event",value:function(e,t){var n=this;if(this.get("is-crawler"))return;if(Array.isArray(e)){var i=w(),s=[];e.forEach((function(e){var t,r,o;if(Array.isArray(e)){var a=f(e,3);t=a[0],r=a[1],o=a[2]}else n.isObject(e)&&(t=e.event,r=e.params,o=e.local_time_ms);if(!t)return;(!A(o)||o<0||o>i)&&(o=i),s.push(n.createEvent({event:t,params:r,time:o}))})),s.length>0&&(this.inited?this.emit(this.types.Event,s):this.unInitedCache.push(s))}else{var r=this.createEvent({event:e,params:t});this.inited?this.emit(this.types.Event,r):this.unInitedCache.push(r),this.emit(this.types.Verify,{event:e,params:t})}}},{key:"createEvent",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object.assign({event:e.event,params:e.params||{},local_time_ms:e.time||w()},this.sessionId?{session_id:this.sessionId}:{});if(this.emit(this.types.Check,{type:"event",value:n}),!t)return n;var i="",s=this.get("ab_sdk_version");s&&(i+=s);var r=this.get("ab_sdk_version_external");return r&&(i?i+=","+r:i=r),Object.assign(Object.assign({},n),i?{ab_sdk_version:i}:{})}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"get",value:function(e){return this.data[e]}},{key:"getKey",value:function(e){var t=this.appId;if("ab_version"===e||"ab_version_external"===e)return"__tea_sdk_".concat(e,"_").concat(t);var n={token:"tokens",report:"reports",event:"events",utm:"utm",first:"first",compensate:"compensate",buffer:"buffer"};return n[e]?"__tea_cache_".concat(n[e],"_").concat(t):void 0}},{key:"getUrl",value:function(e){var t=this.option,n=this.env,i=n.get("_sdk_version"),s=(n.get("_sdk_name")||"").replace(/@.+\//,""),r="".concat(t.get("domain")).concat(e,"?sdk_version=").concat(i,"&sdk_name=").concat(s),o=t.get("caller");if(o)return"".concat(r,"&app_id=").concat(this.appId,"&caller=").concat(o);return r}},{key:"getToken",value:function(e){var t=this;if(e)return this.emit(this.types.TokenGet,{callback:e}),void 0;return new Promise((function(e){t.emit(t.types.TokenGet,{callback:function(t){e(t)}})}))}},{key:"getConfig",value:function(e){return this.env.get(e||"header")}},{key:"stash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="stash";this.set(n,[].concat(p(this.get(n)||[]),[this.createEvent({event:e,params:t})]))}},{key:"commit",value:function(){var e="stash",t=this.get(e)||[];t.length>0&&(this.event(t),this.set(e,[]))}},{key:"isObject",value:function(e){return P(e)}},{key:"isArray",value:function(e){return function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}(e)}},{key:"isNumber",value:function(e){return A(e)}},{key:"isString",value:function(e){return function(e){return"string"==typeof e}(e)}},{key:"isFunction",value:function(e){return function(e){return"function"==typeof e}(e)}},{key:"isUndefined",value:function(e){return void 0===e}}],[{key:"useAdapterLog",value:function(t){e._log=t}},{key:"useAdapterRequest",value:function(t){e._request=t}},{key:"useAdapterStorage",value:function(t){e._storage=t}},{key:"usePlugin",value:function(t,n){var i=n||t.pluginName;if(i){for(var s=!1,r=0,o=e.plugins.length;r<o;r++){if(e.plugins[r].name===i){e.plugins[r].plugin=t,s=!0;break}}s||e.plugins.push({name:i,plugin:t})}else e.plugins.push({plugin:t});if("function"==typeof t.init)try{t.init(e)}catch(e){}}}]),e}();x.plugins=[],x.instances=[];var U,N="2.1.1",R=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){e.env.set({sdk_version:N,_sdk_version:N,_sdk_name:"@datarangers/sdk-qg"})}}]),e}();R.pluginName="official:info",function(e){e.Default="default",e.Custom="custom"}(U||(U={}));var T=function(){function e(n,i){t(this,e),this.wrap=n,this.sdk=i,this.url="/webid/"}return i(e,[{key:"storageNoData",value:function(){this.fetch()}},{key:"storageHasData",value:function(e){return this.wrap.dataComplete(e)}},{key:"fetch",value:function(){var e=this,t=this.sdk,n=t.adapter,i=t.appId;n.request({url:this.sdk.getUrl("".concat(this.url)),method:"POST",data:{app_id:i,url:"-",user_agent:"-",referer:"-",user_unique_id:""}}).then((function(t){try{var i=t.data,s=(i=void 0===i?{}:i).e,r=void 0===s?-1e4:s,o=i.web_id,a=void 0===o?"":o;if(0===r)return e.fetchComplete(a),void 0;n.log("parse web_id error",r)}catch(e){n.log("parse web_id error",e)}e.fetchComplete()})).catch((function(t){e.fetchComplete(),n.log("fetch web_id error",t)}))}},{key:"fetchComplete",value:function(e){if(!e)return;this.wrap.webIdComplete(e)}},{key:"storageComplete",value:function(e){if(!e)return this.storageNoData(),void 0;try{if(e[this.wrap.typeKey]===U.Default){var t=this.storageHasData(e);this.wrap.complete(t)}else this.storageNoData()}catch(e){}}}]),e}(),$=function(){function e(n,i){var s=this;t(this,e),this.wrap=n,this.sdk=i,this.sdk.on(this.sdk.types.ConfigWebId,(function(e){e="".concat(e),s.wrap.tokenComplete?s.waitComplete(e):s.waitResolve?s.waitResolve(e):s.tmpWebId=e}))}return i(e,[{key:"storageNoData",value:function(){this.wait()}},{key:"storageHasData",value:function(e){return this.wrap.dataComplete(e,this.tmpWebId)}},{key:"wait",value:function(){var e=this;new Promise((function(t){void 0!==e.tmpWebId?(t(e.tmpWebId),e.tmpWebId=void 0):e.waitResolve=t})).then((function(t){e.waitComplete(t)}))}},{key:"waitComplete",value:function(e){this.wrap.webIdComplete(e)}},{key:"storageComplete",value:function(e){if(!e)return this.storageNoData(),void 0;try{if(e[this.wrap.typeKey]===U.Custom){var t=this.storageHasData(e);this.wrap.complete(t)}else this.storageNoData()}catch(e){}}}]),e}(),K=function(){function e(){t(this,e),this.tokenComplete=!1,this.tobid="",this.tobidUrl="/tobid/",this.tobidKey="",this.isCustom=!1,this.typeKey="_type_"}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.key=this.sdk.getKey("token"),this.tobidKey="diss".split("").reverse().join(""),this.options.enable_custom_webid?(this.isCustom=!0,this.token=new $(this,this.sdk)):(this.isCustom=!1,this.token=new T(this,this.sdk));var i=this.sdk.types;this.sdk.on(i.ConfigUuid,(function(e){n.setUserUniqueId(e)})),this.sdk.on(i.TokenGet,(function(e){var t=e.callback,s=function(){n.fetchTobid().then((function(){var e=n.sdk.env.get("user"),i=Object.assign(Object.assign({},e),{web_id:n.webId,user_unique_id:n.userUniqueId});i[n.tobidKey]=n.tobid,"function"==typeof t&&t(i)}))};n.sdk.ready?s():n.sdk.once(i.Ready,(function(){s()}))})),this.storage()}},{key:"storage",value:function(){var e=this,t=this.sdk.adapter;t.get(this.key).then((function(n){if(!e.sdk.isObject(n)||!n.web_id)return e.storageComplete(null),void 0;n[e.typeKey]&&!n[e.tobidKey]&&n.user_unique_id||(n=s({web_id:n.web_id,user_unique_id:n.user_unique_id||n.web_id},e.typeKey,e.isCustom?U.Custom:U.Default),t.set(e.key,n)),e.storageComplete(n)})).catch((function(n){e.storageComplete(null),t.log("get token error",n)}))}},{key:"storageComplete",value:function(e){this.token.storageComplete(e)}},{key:"dataComplete",value:function(e,t){var n=e.web_id;void 0!==t&&t!==n&&(n=t),this.webId=n;var i=e.web_id===e.user_unique_id?n:e.user_unique_id;return void 0!==this.tmpUserUniqueId&&this.tmpUserUniqueId!==i&&(i=this.tmpUserUniqueId?this.tmpUserUniqueId:n,this.tmpUserUniqueId=void 0),this.userUniqueId=i,n!==e.web_id||i!==e.user_unique_id}},{key:"webIdComplete",value:function(e){this.webId=e,this.tmpUserUniqueId?(this.userUniqueId=this.tmpUserUniqueId,this.tmpUserUniqueId=void 0):this.userUniqueId=e,this.complete(!0)}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.sdk.types,n={web_id:this.webId,user_unique_id:this.userUniqueId};this.sdk.env.set(n),n[this.typeKey]=this.isCustom?U.Custom:U.Default,e&&this.sdk.adapter.set(this.key,n),this.tokenComplete=!0,this.sdk.emit(t.TokenComplete)}},{key:"setUserUniqueId",value:function(e){var t=this.sdk,n=t.adapter,i=t.env,r=t.types;if(this.tokenComplete){if(this.userUniqueId===e)return;this.sdk.emit(r.UuidChangeBefore),this.userUniqueId=e||this.webId,i.set({user_unique_id:this.userUniqueId});var o=s({web_id:this.webId,user_unique_id:this.userUniqueId},this.typeKey,this.isCustom?U.Custom:U.Default);n.set(this.key,o),this.sdk.emit(r.UuidChangeAfter)}else this.tmpUserUniqueId=e}},{key:"fetchTobid",value:function(){var e=this,t=this.sdk,n=t.adapter,i=t.appId;return n.request({url:this.sdk.getUrl("".concat(this.tobidUrl)),method:"POST",data:{app_id:i,web_id:this.webId,user_unique_id:this.userUniqueId}}).then((function(t){try{var n=t.data,i=(n=void 0===n?{}:n).e,s=void 0===i?-1e4:i,r=n.tobid,o=void 0===r?"":r;if(0===s)return e.tobid=o,void 0}catch(e){}})).catch((function(e){n.log("fetch tobid error",e)}))}}]),e}();K.pluginName="official:token";var V=function(){function e(){t(this,e),this.url="/list/",this.cache=[],this.pause=!1,this.eventName="request_status__"}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.key=this.sdk.getKey("report"),this.reportUrl=this.sdk.getUrl("".concat(this.url)),this.sdk.set("report_url",this.reportUrl);var i=this.sdk.types;this.sdk.on(i.Report,(function(e){if(Array.isArray(e)||(e=[e]),!n.sdk.ready||n.pause)return e.forEach((function(e){return n.cache.push(e)})),void 0;n.report(e)})),this.sdk.on(i.Ready,(function(){n.reportCache()})),this.sdk.on(i.Pause,(function(){n.pause=!0})),this.sdk.on(i.CancelPause,(function(){n.pause=!1,n.reportCache()}));var s=this.sdk.adapter;this.sdk.on(i.AppOpen,(function(){s.get(n.key).then((function(){}))})),this.sdk.on(i.AppClose,(function(){n.cache.length>0&&(s.set(n.key,p(n.cache)),n.cache.length=0)}))}},{key:"reportCache",value:function(){this.cache.length>0&&(this.report(p(this.cache)),this.cache.length=0)}},{key:"report",value:function(e){this.submit(e)}},{key:"submit",value:function(e){var t=this,n=this.sdk.types;this.sdk.emit(n.SubmitBefore,e),this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:e}).then((function(i){t.sdk.emit(n.SubmitAfter,{isError:!1,response:i,event:e});try{if(t.checkMonitor(e))return;var s=i.data,r=i.statusCode;if(0!==s.e){var o=e.map((function(e){return null==e?void 0:e.events}));t.reportMonitor({status_code:r,response_data:JSON.stringify(s),event_info:JSON.stringify(o)})}}catch(e){}})).catch((function(i){t.sdk.emit(n.SubmitAfter,{isError:!0,error:i,event:e});try{if(t.checkMonitor(e))return;t.sdk.emit(n.SubmitError,{event:e})}catch(e){}}))}},{key:"reportMonitor",value:function(e){var t=this.sdk.createEvent({event:this.eventName,params:e}),n=this.sdk.env.merge([t]);this.submit(n)}},{key:"checkMonitor",value:function(e){if(e&&e[0]&&e[0].events[0]&&e[0].events[0].event===this.eventName)return!0;return!1}}]),e}();V.pluginName="official:report";var L=function(){function e(){t(this,e),this.buffer=[],this.timer=0,this.unReadyCache=[],this.cacheBatchNumber=15}return i(e,[{key:"apply",value:function(e,t){var n,i,s=this;this.sdk=e,this.options=t,this.enable=!!this.options.enable_buffer,this.cacheEnable=!!this.options.enable_cache;var r=!0===this.options.enable_storage||!1===this.options.disable_storage;if(r&&(this.enable=!0),this.enable){this.interval=this.options.buffer_interval,this.number=this.options.buffer_number,r&&((null===(n=this.options)||void 0===n?void 0:n.report_interval)>0&&(this.interval=this.options.report_interval),(null===(i=this.options)||void 0===i?void 0:i.max_batch_event)>0&&(this.number=this.options.max_batch_event));try{this.interval=Number(this.interval),this.number=Number(this.number)}catch(e){}}var o=this.sdk.types;this.sdk.on(o.Event,(function(e){var t=Array.isArray(e)?e:[e];if(!s.sdk.ready)return s.unReadyCache=[].concat(p(s.unReadyCache),p(t)),s.cacheEnable&&s.unReadyCache.length>=s.cacheBatchNumber&&(s.sdk.emit(o.CacheUnReady,p(s.unReadyCache)),s.unReadyCache.length=0),void 0;s.process(t)})),this.sdk.on(o.Ready,(function(){s.unReadyCache.length>0&&(s.process(s.unReadyCache),s.unReadyCache.length=0)})),this.sdk.on(o.Network,(function(e){!e.origin&&e.current&&(s.enable?s.refresh():s.buffer.length>0&&(s.report(p(s.buffer)),s.buffer.length=0))})),this.sdk.on(o.AppClose,(function(){if(s.timer&&clearTimeout(s.timer),!s.sdk.ready)return s.cacheEnable&&s.unReadyCache.length>0&&(s.sdk.emit(o.CacheUnReady,p(s.unReadyCache)),s.unReadyCache.length=0),void 0;s.buffer.length>0&&(s.network()?s.report(p(s.buffer)):s.cacheEnable&&s.sdk.emit(o.CacheBuffer,p(s.buffer)),s.buffer.length=0)}))}},{key:"process",value:function(e){var t=this.sdk.env.compose(e);this.network()?this.enable?(this.buffer=[].concat(p(this.buffer),[t]),this.refresh()):this.report(t):(this.buffer=[].concat(p(this.buffer),[t]),this.cacheEnable&&this.buffer.length>=this.cacheBatchNumber&&(this.sdk.emit(this.sdk.types.CacheBuffer,p(this.buffer)),this.buffer.length=0))}},{key:"refresh",value:function(){var e=this;this.buffer.length>=this.number?(this.timer&&(clearTimeout(this.timer),this.timer=0),this.report(p(this.buffer)),this.buffer.length=0):this.timer||(this.timer=setTimeout((function(){e.timer=0,e.buffer.length>0&&(e.report(p(e.buffer)),e.buffer.length=0)}),this.interval))}},{key:"report",value:function(e){this.sdk.emit(this.sdk.types.Report,e)}},{key:"network",value:function(){return!!this.sdk.env.get("is_connected")}}]),e}();L.pluginName="official:buffer";var M=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk,s=i.types,r=i.env,o=function(){try{var e=(new Date).getTimezoneOffset();return{timezone:Math.floor(Math.abs(e)/60),offset:60*e}}catch(e){return{timezone:8,offset:-28800}}}();r.set({timezone:o.timezone,tz_offset:o.offset}),this.sdk.on(s.ConfigTransform,(function(e){if(void 0!==e.user_unique_id_type&&(e.evtParams=Object.assign(Object.assign({},e.evtParams||{}),{$user_unique_id_type:e.user_unique_id_type})),void 0!==e.gender&&([1,2,"1","2"].includes(e.gender)?e.gender=e.gender<2?"male":"female":delete e.gender),!!n.options.enable_profile){var t={};["nick_name","gender","avatar_url"].forEach((function(n){void 0!==e[n]&&(t[n]=e[n],delete e[n])})),n.sdk.emit(s.ProfileSet,t)}})),this.sdk.on(s.EnvTransform,(function(e){if(!!n.options.enable_profile){var t={};["$mp_from_uuid"].forEach((function(n){void 0!==e[n]&&(t[n]=e[n],delete e[n])})),Object.keys(t).length>0&&n.sdk.emit(s.ProfileSetOnce,t)}}))}}]),e}();M.pluginName="official:transform";var D=function(){function e(){t(this,e),this.url="/profile/list",this.lastId=0,this.lastOnceId=0,this.duration=6e4,this.cache={},this.buffer=[]}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.on(i.ProfileSet,(function(e){n.check()&&n.setProfile(e)})),this.sdk.on(i.ProfileSetOnce,(function(e){n.check()&&n.setOnceProfile(e)})),this.sdk.on(i.ProfileUnset,(function(e){n.check()&&n.unsetProfile(e)})),this.sdk.on(i.ProfileIncrement,(function(e){n.check()&&n.incrementProfile(e)})),this.sdk.on(i.ProfileAppend,(function(e){n.check()&&n.appendProfile(e)})),this.sdk.on(i.ProfileClear,(function(){n.cache={}})),this.sdk.on(i.Ready,(function(){if(!n.buffer.length)return;n.reportMore(p(n.buffer)),n.buffer=[]}))}},{key:"check",value:function(){return!!this.options.enable_profile}},{key:"setProfile",value:function(e){var t=this,n=this.debounce(e);if(!n)return;this.putCache(n);var i=this.filter(n,(function(e){return t.sdk.isString(e)||t.sdk.isNumber(e)||t.sdk.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_set",params:i}))}},{key:"setOnceProfile",value:function(e){var t=this,n=this.debounce(e,!0);if(!n)return;this.putCache(n);var i=this.filter(n,(function(e){return t.sdk.isString(e)||t.sdk.isNumber(e)||t.sdk.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_set_once",params:i}))}},{key:"incrementProfile",value:function(e){var t=this;if(!e)return;var n=this.filter(e,(function(e){return t.sdk.isNumber(e)}));this.report(this.sdk.createEvent({event:"__profile_increment",params:n}))}},{key:"unsetProfile",value:function(e){if(!e||!this.sdk.isString(e))return;var t={};t[e]="1",this.report(this.sdk.createEvent({event:"__profile_unset",params:t}))}},{key:"appendProfile",value:function(e){var t=this;if(!e||!this.sdk.isObject(e)||this.isEmpty(e))return;var n=this.filter(e,(function(e){return t.sdk.isString(e)||t.sdk.isArray(e)}));this.report(this.sdk.createEvent({event:"__profile_append",params:n}))}},{key:"reportMore",value:function(e){var t=this;if(this.sdk.ready){var n=this.sdk.env.merge(e,this.sdk.ProfileType),i=this.sdk,s=i.adapter,r=i.option;s.request({url:"".concat(r.get("domain")).concat(this.url),method:"POST",data:n}).then((function(e){t.sdk.emit(t.sdk.types.ProfileSubmitAfter,{isError:!0,response:e,event:n})})).catch((function(e){t.sdk.emit(t.sdk.types.ProfileSubmitError,{isError:!0,error:e,event:n})}))}else e.forEach((function(e){t.buffer.push(e)}))}},{key:"report",value:function(e){this.reportMore([e])}},{key:"ms",value:function(){return w()}},{key:"debounce",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!this.sdk.isObject(e)||this.isEmpty(e))return;var i=Object.keys(e),s=this.ms(),r=i.filter((function(i){var r=t.cache[i];if(r&&(n||t.compare(r.val,e[i])&&s-r.timestamp<t.duration))return!1;return!0})).reduce((function(t,n){return t[n]=e[n],t}),{});if(!(i=Object.keys(r)).length)return;return r}},{key:"putCache",value:function(e){var t=this,n=this.ms();Object.keys(e).forEach((function(i){t.cache[i]={val:t.clone(e[i]),timestamp:n}}))}},{key:"clone",value:function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return e}}},{key:"compare",value:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}},{key:"filter",value:function(e,t){return Object.keys(e).reduce((function(n,i){var s=e[i];return t(s)&&(n[i]=s),n}),{})}},{key:"isEmpty",value:function(e){return!Object.keys(e).length}}],[{key:"init",value:function(e){e.prototype.profileSet=function(e){this.emit(this.types.ProfileSet,e)},e.prototype.profileSetOnce=function(e){this.emit(this.types.ProfileSetOnce,e)},e.prototype.profileUnset=function(e){this.emit(this.types.ProfileUnset,e)},e.prototype.profileIncrement=function(e){this.emit(this.types.ProfileIncrement,e)},e.prototype.profileAppend=function(e){this.emit(this.types.ProfileAppend,e)}}}]),e}();D.pluginName="official:profile",x.usePlugin(R),x.usePlugin(K),x.usePlugin(V),x.usePlugin(L),x.usePlugin(M),x.usePlugin(D);var H=console,J="undefined",F=J,B=function(){if(F!==J)return F;return F=("undefined"==typeof tt?"undefined":e(tt))!==J?{target:tt,is:"tt"}:("undefined"==typeof swan?"undefined":e(swan))!==J?{target:swan,is:"swan"}:("undefined"==typeof qq?"undefined":e(qq))!==J?{target:qq,is:"qq"}:("undefined"==typeof wx?"undefined":e(wx))!==J?{target:wx,is:"wx"}:("undefined"==typeof qg?"undefined":e(qg))!==J?{target:qg,is:"qg"}:{target:null,is:""}},z="",G=B(),W="undefined"!=typeof qg||"undefined"!=typeof cc?"undefined"!=typeof qg&&qg.request?function(e){return function(t){z||(z=qg.getSystemInfoSync().brand);var n=t.timeout||e.option.get("request_timeout"),i="number"==typeof n&&n>0;return new Promise((function(e,s){qg.request(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t),i?{timeout:n}:{}),{dataType:t.dataType||"json"}),"vivo"===z?{data:JSON.stringify(t.data)}:{}),{success:function(t){e(t)},fail:function(e){s(e)}}))}))}}:function(e){return function(t){var n=t.timeout||e.option.get("request_timeout"),i="number"==typeof n&&n>0;return new Promise((function(e,n){var s=t.url,r=t.method,o=t.timeout,a=t.data,u=new XMLHttpRequest;i&&(u.timeout=o),u.open(r,"".concat(s),!0),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),u.onload=function(){try{var t=JSON.parse(u.responseText);e({data:t})}catch(e){n()}},u.ontimeout=function(){n()},u.onerror=function(){u.abort(),n()},u.send(JSON.stringify(a))}))}}:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return function(i){var s=i.timeout||n.option.get("request_timeout"),r="number"==typeof s&&s>0;return new Promise((function(n,o){var a=e.request(Object.assign(Object.assign(Object.assign({},i),r&&!t?{timeout:s}:{}),{dataType:i.dataType||"json",success:function(e){n(e)},fail:function(e){o(e)}}));r&&t&&setTimeout((function(){try{a&&a.abort()}catch(e){}}),s)}))}}}(G.target,"swan"===G.is),X=B(),Z=function(e){return function(){function n(){t(this,n)}return i(n,[{key:"get",value:function(t){return new Promise((function(n,i){try{var s=e.getItem(t);n(s?JSON.parse(s):null)}catch(e){i(e)}}))}},{key:"set",value:function(t,n){return new Promise((function(i,s){try{e.setItem(t,JSON.stringify(n)),i(!0)}catch(e){s(!1)}}))}},{key:"remove",value:function(t){return new Promise((function(n,i){try{e.removeItem(t),n(!0)}catch(e){i(!1)}}))}},{key:"info",value:function(){return new Promise((function(t,n){try{for(var i=[],s=0,r=e.length;s<r;s++)i.push(e.key(s));t(i)}catch(e){n(null)}}))}}]),n}()},Q=new(function(){if("undefined"!=typeof qg||"undefined"!=typeof cc){if("undefined"!=typeof qg&&qg.getStorageSync)return function(){function n(){t(this,n)}return i(n,[{key:"get",value:function(t){return new Promise((function(n,i){try{var s=qg.getStorageSync({key:t});if(void 0===s||"object"===e(s))return n(s),void 0;if("string"==typeof s)return"key not define"===s.trim()?n(null):n(JSON.parse(s)),void 0;n(s)}catch(e){i(e)}}))}},{key:"set",value:function(e,t){return new Promise((function(n,i){try{qg.setStorageSync({key:e,value:JSON.stringify(t)}),n(!0)}catch(e){i(!1)}}))}},{key:"remove",value:function(e){return new Promise((function(t,n){try{qg.removeStorageSync({key:e}),t(!0)}catch(e){n(!1)}}))}},{key:"info",value:function(){return new Promise((function(e,t){try{qg.getStorageInfo({success:function(t){e(t)},fail:function(){t(null)}})}catch(e){t(null)}}))}}]),n}();if(void 0!==cc&&void 0!==cc.sys)return Z(cc.sys.localStorage);return Z(localStorage)}return function(){function e(){t(this,e)}return i(e,[{key:"get",value:function(e){return new Promise((function(t,n){try{t(X.target.getStorageSync(e))}catch(e){n(e)}}))}},{key:"set",value:function(e,t){return new Promise((function(n,i){try{X.target.setStorageSync(e,t),n(!0)}catch(e){i(!1)}}))}},{key:"remove",value:function(e){return new Promise((function(t,n){try{X.target.removeStorageSync(e),t(!0)}catch(e){n(!1)}}))}},{key:"info",value:function(){return new Promise((function(e,t){try{X.target.getStorageInfo({success:function(t){e(t)},fail:function(){t(null)}})}catch(e){t(null)}}))}}]),e}()}()),Y=function(){function e(){t(this,e),this.timer=0}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.boost();var i=this.sdk.types;this.getInfo(),this.sdk.on(i.AppOpen,(function(){n.getInfo(),n.onChange()}))}},{key:"boost",value:function(){}},{key:"getInfo",value:function(){var e=this.sdk.target;e&&(this.system(e),this.network(e))}},{key:"system",value:function(e){var t=this,n=this.sdk.env;e.getSystemInfo&&e.getSystemInfo({success:function(e){var i=Math.ceil(e.screenWidth),s=Math.ceil(e.screenHeight),r={device_brand:e.brand,device_model:e.model,os_version:e.system,os_name:e.platform,platform:e.platform,resolution:"".concat(i,"x").concat(s),screen_width:i,screen_height:s};t.overlap(e,r),n.set(r)}})}},{key:"network",value:function(e){var t=this,n=this.sdk,i=n.env,s=n.types;e.getNetworkType&&e.getNetworkType({success:function(e){var n={access:e.networkType,is_connected:void 0!==e.networkAvailable?!!e.networkAvailable:"none"!==e.networkType};t.sdk.emit(s.Network,{origin:i.get("is_connected"),current:n.is_connected}),i.set(n)},fail:function(){if(t.timer>0)return;t.timer=setTimeout((function(){t.network(e)}),50)}})}},{key:"onChange",value:function(){var e=this,t=this.sdk,n=t.target,i=t.env,s=t.types;null==n?void 0:n.onNetworkStatusChange((function(t){e.sdk.emit(s.Network,{origin:i.get("is_connected"),current:null==t?void 0:t.isConnected}),i.set({access:null==t?void 0:t.networkType,is_connected:null==t?void 0:t.isConnected})}))}},{key:"overlap",value:function(e,t){t.language=e.language,t.mp_platform_app_version=e.version,t.mp_platform_basic_version=e.SDKVersion}}]),e}();Y.pluginName="official:device";var ee=function(e){r(s,e);var n=c(s);function s(){return t(this,s),n.apply(this,arguments)}return i(s,[{key:"boost",value:function(){h(o(s.prototype),"boost",this).call(this),this.sdk.env.set(Object.assign({sdk_lib:"qg_common",custom_platform:"quickGame",mp_platform:4},"undefined"!=typeof qg||"undefined"!=typeof cc?{is_connected:!0}:{}))}},{key:"overlap",value:function(e,t){h(o(s.prototype),"overlap",this).call(this,e,t),t.os_version=e.system||e.osVersionName,t.os_name=e.platform||e.platformVersionName}}]),s}(Y),te=function(e){r(s,e);var n=c(s);function s(){return t(this,s),n.apply(this,arguments)}return i(s,[{key:"boost",value:function(){h(o(s.prototype),"boost",this).call(this),this.which=B(),this.sdk.target=this.which.target,this.sdk.whichIs=this.which.is}}],[{key:"init",value:function(e){var t=B();e.platform=t.is?t.target:null}}]),s}(ee);x.useAdapterLog(H),x.useAdapterRequest(W),x.useAdapterStorage(Q),x.usePlugin(te);var ne=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.on(i.Check,(function(e){var t,i=e.type,s=e.value;if("event"===i){var r=s;if("applog_trace"===r.event)return;var o=0===(null===(t=r.event)||void 0===t?void 0:t.indexOf("__profile_"));o||n.check("name",r.event),n.sdk.isObject(r.params)&&Object.keys(r.params).forEach((function(e){n.check(o?"profile":"param",e,r.params[e])}))}else if("config"===i){var a=s;n.sdk.isObject(a)&&Object.keys(a).forEach((function(e){if("evtParams"===e){var t=a.evtParams;n.sdk.isObject(t)&&Object.keys(t).forEach((function(e){n.check("header",e,t[e])}))}else n.check("header",e,a[e])}))}}))}},{key:"check",value:function(e,t,n){var i=function(e){return/^[a-zA-Z0-9][a-z0-9A-Z_ .-]{0,255}$/.test(e)};switch(e){case"name":i(String(t))||this.warn("event name ".concat(t," illegal"));break;case"param":case"header":case"profile":var s="param"===e?"event params":"header"===e?"config":"profile";"profile"!==t&&["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time"].includes(t)||i(String(t))||this.warn("".concat(s," name ").concat(t," illegal")),"string"!=typeof n||function(e){return String(e).length<=1024}(n)||this.warn("the value ".concat(n," length more than 1024 in ").concat(s," ").concat(t))}}},{key:"warn",value:function(e){var t,n;null===(n=null===(t=this.sdk.adapter._log)||void 0===t?void 0:t.warn)||void 0===n?void 0:n.call(t,e)}}]),e}();ne.pluginName="official:check";var ie=function(){function e(){t(this,e),this.key="start_rangers_data_check",this.buffer=[],this.test=!1,this.testRequestNumber=0,this.interval=1e3,this.needOn=!1,this.onHandler=function(){}}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.once(i.AppOpen,(function(){try{if(n.host=n.sdk.target,n.host.getLaunchOptionsSync){var e=n.host.getLaunchOptionsSync().query;n.verify(e).then((function(){n.needOn=!0,n.onHandler=function(e){n.submit(e)},n.sdk.on(i.Event,n.onHandler)}))}}catch(e){}})),this.sdk.on(i.AppClose,(function(){n.needOn&&(n.userInfo=null,n.sdk.off(i.Event,n.onHandler),n.onHandler=function(){},n.needOn=!1)}))}},{key:"check",value:function(e){var t;return null!==(t=null==e?void 0:e[this.key])&&void 0!==t?t:""}},{key:"verify",value:function(e){var t,n=this,i=this.sdk.adapter,s=new Promise((function(e){t=e})),r=function(e){t(!0),n.userInfo=e||{nickName:"未知",avatarUrl:""},i.log("verify open ".concat(JSON.stringify(n.userInfo))),n.login()},o=this.check(e);i.log("verify ".concat(o));var a,u,c=this;if(o){try{var h=(a="logverify",u=function(e){return(t=a,t.split("").map((function(e){return e.charCodeAt(0)}))).reduce((function(e,t){return e^t}),e);var t},function(e){return e.match(/.{1,2}/g).map((function(e){return parseInt(e,16)})).map(u).map((function(e){return String.fromCharCode(e)})).join("")})(o);h&&/^https?:\/\//.test(h)&&(this.domain=h),i.log("verify domain ".concat(h))}catch(e){}c.host.getSetting({success:function(e){i.log("getSetting success"),e.authSetting["scope.userInfo"]?(i.log("getSetting scope.userInfo success"),c.host.getUserInfo?c.host.getUserInfo({success:function(e){i.log("getUserInfo success");var t=e.userInfo,n=t.nickName,s=t.avatarUrl;r({nickName:n,avatarUrl:s})},fail:function(){i.log("getUserInfo fail"),r()}}):c.host.getOpenUserInfo&&c.host.getOpenUserInfo({success:function(e){i.log("getUserInfo success");try{var t=JSON.parse(e.response).response,n=t.nickName,s=t.avatar;r({nickName:n,avatarUrl:s})}catch(e){}},fail:function(){i.log("getUserInfo fail"),r()}})):(i.log("getSetting scope.userInfo fail"),r())},fail:function(){i.log("getSetting fail"),r()}})}return s}},{key:"submit",value:function(e){try{this.pushBuffer(JSON.parse(JSON.stringify(e)))}catch(e){}}},{key:"login",value:function(){var e=this;if(!this.domain)return;var t=this.prepareHeader().header;this.sdk.adapter.request({url:"".concat(this.domain,"/simulator/limited_mobile/try_link"),method:"POST",data:Object.assign(Object.assign({header:Object.assign(Object.assign({},t||{}),{aid:t.app_id})},this.userInfo?{nick_name:this.userInfo.nickName}:{}),{host_version:(t.custom||{}).mp_platform_app_version||"",sync_id:this.syncId||""})}).then((function(t){try{var n=t.data.data,i=n.retry,s=n.sync_id,r=n.token;if(e.syncId=s,e.token=r,e.test&&e.testRequestNumber>3)return e.report(),void 0;0===i||(1===i?e.loginLoop():2===i&&e.report())}catch(t){e.loginLoop()}})).catch((function(){e.loginLoop()}))}},{key:"loginLoop",value:function(){var e=this;this.test&&this.testRequestNumber++,setTimeout((function(){e.login()}),this.interval)}},{key:"report",value:function(){var e=this;if(!this.domain)return;var t=this.prepareHeader().header,n=this.buffer;this.buffer=[],this.sdk.adapter.request({url:"".concat(this.domain,"/simulator/limited_mobile/log"),method:"POST",data:{header:Object.assign(Object.assign({},t||{}),{aid:t.app_id}),token:this.token||"",event_v3:n||[]}}).then((function(t){try{!0===t.data.data.keep?e.reportLoop():e.reset()}catch(t){e.reportLoop()}})).catch((function(){e.reportLoop()}))}},{key:"reportLoop",value:function(){var e=this;setTimeout((function(){e.report()}),this.interval)}},{key:"pushBuffer",value:function(e){var t=this;(Array.isArray(e)?p(e):[e]).forEach((function(e){if("string"==typeof e.params)try{e.params=JSON.parse(e.params)}catch(e){}t.buffer.push(e)}))}},{key:"prepareHeader",value:function(){var e=this.sdk.env.get(),t=e.user,n=e.header;return JSON.parse(JSON.stringify({user:t,header:n}))}},{key:"reset",value:function(){this.buffer=[],this.syncId="",this.token=""}}]),e}();ie.pluginName="official:verify";var se={cn:"https://abtest.volceapplog.com",va:"https://toblog.itobsnssdk.com",sg:"https://toblog.tobsnssdk.com"};function re(e,t,n){var i=this;if(n)return this.emit(this.types.AbVar,{name:e,defaultValue:t,callback:n}),void 0;return new Promise((function(n){i.emit(i.types.AbVar,{name:e,defaultValue:t,callback:function(e){n(e)}})}))}function oe(e){var t=this;if(e)return this.emit(this.types.AbAllVars,e),void 0;return new Promise((function(e){t.emit(t.types.AbAllVars,(function(t){e(t)}))}))}function ae(e,t){var n=this;if(t)return this.emit(this.types.AbRefresh,{params:e,callback:t}),void 0;return new Promise((function(t){n.emit(n.types.AbRefresh,{params:e,callback:function(e){t(e)}})}))}var ue=function(){function e(){t(this,e),this.expire=2592e6,this.domains=se,this.url="/service/2/abtest_config/",this.message={cb:"回调函数必须为一个函数",var:"变量名不能为空",value:"变量没有默认值"},this.fetchStatus=0,this.callbacks=[],this.data=null,this.versions=[],this.externalVersions=null,this.hasOn=!1,this.onHandler=function(){},this.changeListener=[],this.exposureName="abtest_exposure",this.clear=!1}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk,s=i.adapter,r=i.types,o=i.appId;if(this.appId=o,this.externalKey=this.sdk.getKey("ab_version_external"),this.sdk.on(r.AbExternalVersion,(function(e){n.processExternal(e);var t=n.sdk.adapter;e?t.set(n.externalKey,e):t.remove(n.externalKey)})),s.get(this.externalKey).then((function(e){if(!e)return;try{n.processExternal(e)}catch(e){}})),!this.options.enable_ab_test)return;this.dataKey=this.sdk.getKey("ab_version"),this.clear=this.options.clear_ab_cache_on_user_change,this.domain=this.getDomain(),this.sdk.on(r.UuidChangeAfter,(function(){if(!n.sdk.ready)return;n.clear&&(n.versions=[],n.data={},n.updateVersions(),n.emitChange())})),this.sdk.once(r.Ready,(function(){n.preFetch(),n.sdk.on(r.UuidChangeAfter,(function(){n.preFetch()}))})),this.sdk.on(r.AbVar,(function(e){var t=e.name,i=e.defaultValue,s=e.callback;n.getVar(t,i,s)})),this.sdk.on(r.AbAllVars,(function(e){n.getAllVars(e)})),this.sdk.on(r.AbVersionChangeOn,(function(e){n.changeListener.push(e)})),this.sdk.on(r.AbVersionChangeOff,(function(e){var t=n.changeListener.indexOf(e);-1!==t&&n.changeListener.splice(t,1)})),this.sdk.on(r.AbRefresh,(function(e){var t=e.params,i=e.callback;n.preFetch(t,i)})),s.get(this.dataKey).then((function(e){if(!e)return;var t=e.timestamp;if(w()-t>=n.expire)return n.sdk.adapter.remove(n.dataKey),void 0;try{var i=e.ab_version,s=e.data;2!==n.fetchStatus&&(n.versions=i||[],n.data=s,n.configVersions())}catch(e){}}))}},{key:"output",value:function(e){this.sdk.adapter.log(e)}},{key:"processExternal",value:function(e){this.externalVersions=e,this.sdk.set("ab_sdk_version_external",e)}},{key:"getAllVars",value:function(e){if("function"!=typeof e)return this.output(this.message.cb);var t={callback:e,type:1};2===this.fetchStatus?this._getAllVars(t):this.callbacks.push(t)}},{key:"getVar",value:function(e,t,n){if(!e)return this.output(this.message.var);if(void 0===t)return this.output(this.message.value);if("function"!=typeof n)return this.output(this.message.cb);var i={name:e,defaultValue:t,callback:function(e){try{n(e)}catch(e){}},type:0};2===this.fetchStatus?this._getVar(i):this.callbacks.push(i)}},{key:"fetchComplete",value:function(e){var t=this;if(e){this.data=e;var n=[];Object.keys(e).forEach((function(t){var i=e[t].vid;i&&n.push(i)}));var i=this.versions.length;i?(this.versions=this.versions.filter((function(e){return n.includes(e)})),this.versions.length!==i&&this.updateVersions()):this.updateVersions()}this.callbacks.forEach((function(e){return t[0===e.type?"_getVar":"_getAllVars"](e)})),this.callbacks=[]}},{key:"_getAllVars",value:function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{})}},{key:"_getVar",value:function(e){var t=e.name,n=e.defaultValue,i=e.callback,s=this.data;if(!s)return i(n),void 0;if(this.sdk.isObject(s[t])){var r=s[t],o=r.vid,a=r.val;return o&&(this.versions.includes(o)||(this.versions.push(o),this.updateVersions(),this.emitChange()),this.sdk.emit(this.sdk.types.Event,Object.assign(Object.assign({},this.sdk.createEvent({event:this.exposureName},!1)),{ab_sdk_version:o}))),i(a),void 0}i(n)}},{key:"updateVersions",value:function(){this.configVersions(),this.sdk.adapter.set(this.dataKey,{data:this.data,ab_version:this.versions,timestamp:w()})}},{key:"configVersions",value:function(){var e=this.versions.join(",");this.sdk.set("ab_sdk_version",e);var t="ab_versions";this.sdk.set(t,[].concat(p(this.sdk.get(t)||[]),[{time:w(),ab:e}]))}},{key:"emitChange",value:function(){var e=this.versions.join(",");this.changeListener.length>0&&this.changeListener.forEach((function(t){"function"==typeof t&&setTimeout((function(){try{t(e)}catch(e){}}),0)}))}},{key:"getDomain",value:function(){var e,t=this.options,n=t.channel_domain,i=t.ab_channel_domain,s=null===(e=this.sdk.option.get("cloneOption"))||void 0===e?void 0:e.report_channel,r="";if(i)r=i;else if(n)r=n;else{var o=this.options.report_channel;Object.keys(this.domains).includes(o)||(o=s),r=this.domains[o]}return r}},{key:"preFetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!this.domain)return this.fetchStatus=2,this.fetchComplete(null),t&&t(null),void 0;var n=this.sdk.env,i=n.get(),s=i.user,r=i.header,o=r.headers,a=v(r,["headers"]);this.user=Object.assign({},s),this.fetch(Object.assign(Object.assign(Object.assign({},a),o),e||{})).then((function(e){return t&&t(e)}))}},{key:"fetch",value:function(e){var t=this;this.fetchStatus=1;var n=this.user.user_unique_id;return this.sdk.adapter.request({url:"".concat(this.domain).concat(this.url),method:"POST",data:{header:Object.assign(Object.assign({aid:this.appId},this.user||{}),e||{})}}).then((function(e){var i;if(t.user.user_unique_id!==n)return null;t.fetchStatus=2;var s=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.data;return t.sdk.emit(t.sdk.types.AbFetchAfter,s),t.fetchComplete(s),s})).catch((function(){return t.fetchStatus=2,t.fetchComplete(null),null}))}}],[{key:"init",value:function(e){e.prototype.getVar=re,e.prototype.getAllVars=oe,e.prototype.getAbSdkVersion=function(){var e=this.get("ab_versions")||[];return e.length>0?e[e.length-1].ab:""},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(this.types.AbVersionChangeOn,e),function(){t.emit(t.types.AbVersionChangeOff,e)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(this.types.AbVersionChangeOff,e)},e.prototype.setExternalAbVersion=function(e){this.emit(this.types.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null)},e.prototype.getAbConfig=ae}}]),e}();ue.pluginName="official:ab";var ce,he=function(e){var t=e;try{t=decodeURIComponent(e)}catch(e){}return t},fe=function(e){var t={};return e&&e.split("&").forEach((function(e){if(e){var n=e.split("=");n[0]&&(t[n[0]]=n[1]||"")}})),t};!function(e){e[e.Undefined=0]="Undefined",e[e.Start=1]="Start",e[e.End=2]="End"}(ce||(ce={}));var pe=function(){function e(){t(this,e),this.key="utm",this.utmed=ce.Undefined,this.reload=!1}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.sdk.on(i.LaunchInfo,(function(e){var t,i;if(n.utmed===ce.Start)return;n.utmed===ce.End&&(n.reload=!0),n.utmed=ce.Start,n.parseDefault(null!==(t=null==e?void 0:e.query)&&void 0!==t?t:{}),n.parseMore(null!==(i=null==e?void 0:e.query)&&void 0!==i?i:{})})),this.sdk.on(i.AppHide,(function(){n.utmed=ce.End}))}},{key:"parseDefault",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,i=Object.keys(t).reduce((function(i,s){return e.sdk.UtmType.includes(s)&&(n=!0,i[s]=he(t[s])),i}),{});n&&this.sdk.env.set(i)}},{key:"parseMore",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t||{},i=n.tr_token,s=void 0===i?"":i,r=n.surl_token,o=void 0===r?"":r,a=n.scene,u=void 0===a?"":a,c=s||o;if(u){var h=fe(he("".concat(u)));h.tr_token&&(c=h.tr_token),this.sdk.set("scene_extra_query",h)}if(!c)return this.dispatch(),void 0;var f=function(){e.reload?e.sdk.emit(e.sdk.types.CancelPause):e.dispatch()};this.reload&&this.sdk.emit(this.sdk.types.Pause),this.storageGet(c).then((function(t){t?(e.sdk.env.set(t.utms||{}),f()):e.fetch(c).then((function(){return f()})).catch((function(){return f()}))})).catch((function(){e.fetch(c).then((function(){return f()})).catch((function(){return f()}))}))}},{key:"storageGet",value:function(e){var t=this.sdk.getKey(this.key),n=this.sdk.adapter;return n.get(t).then((function(i){var s=w(),r=[];if(Object.keys(i).forEach((function(e){i[e]&&i[e].timestamp+864e7<s&&r.push(e)})),r.length>0&&(r.forEach((function(e){delete i[e]})),n.set(t,i)),i&&i[e])return i[e];return null}))}},{key:"storageSet",value:function(e,t){var n=this.sdk.getKey(this.key),i=this.sdk.adapter;i.get(n).then((function(s){s||(s={}),s[e]={utms:t,timestamp:w()},i.set(n,s)}))}},{key:"fetch",value:function(e){var t=this,n=this.sdk,i=n.adapter,s=n.option,r=n.env,o=n.UtmType;return i.request({url:"".concat(s.get("domain"),"/service/2/mp_campaigns"),method:"GET",data:{tr_token:e},timeout:3e3}).then((function(n){var s=(n||{}).data,a=(s=void 0===s?{}:s).code,u=void 0===a?-1:a,c=s.data,h=void 0===c?{}:c,f=s.message,p=void 0===f?"":f;if(0===u){if(t.sdk.isObject(h)){var l=!1,d=Object.keys(h).reduce((function(e,t){return o.includes(t)&&(l=!0,d[t]=h[t]),e}),{});l&&r.set(d),t.storageSet(e,d)}}else 40002===u&&t.storageSet(e,{});0!==u&&i.log(p||"")}))}},{key:"dispatch",value:function(){this.sdk.emit(this.sdk.types.LaunchComplete)}}]),e}();pe.pluginName="official:utm";var le=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t;var i=this.sdk.types;this.options.disable_sdk_monitor||this.options.channel_domain||this.sdk.on(i.Ready,(function(){n.reportLoad()}))}},{key:"reportLoad",value:function(){var e=this.sdk.env.get(),t=e.user,n=e.header,i=this.sdk.env.merge([{event:"onload",params:Object.assign(Object.assign(Object.assign({},t),n),this.options)}]);i[0].header.app_id=1338,this.report(i)}},{key:"report",value:function(e){if(!this.reportUrl){var t=this.sdk.get("report_url");if(!t)return;t+=(t.indexOf("?")?"&":"?")+"type=monitor",this.reportUrl=t}this.sdk.adapter.request({url:this.reportUrl,method:"POST",header:{"X-MCS-AppKey":"566f58151b0ed37e"},data:e})}}]),e}();le.pluginName="official:monitor";var de,ve=function(e,t){e.adapter.log("参数类型不匹配，参数及类型需要如下：".concat(t))},ye="gt_ad_button_click",ge="gt_ad_show",me="gt_ad_show_end",ke="gt_levelup",_e="gt_start_play",be="gt_end_play",Oe="gt_get_coins",we="gt_cost_coins",Se="purchase",Pe={gtAdButtonClick:function(e,t,n){if("string"!=typeof n.ad_type||"string"!=typeof n.ad_position_type||"string"!=typeof n.ad_position)return ve(e,"ad_type: string;ad_position_type: string;ad_position: string;"),void 0;t(ye,Object.assign({},n))},gtAdShow:function(e,t,n){if("string"!=typeof n.ad_type||"string"!=typeof n.ad_position_type||"string"!=typeof n.ad_position)return ve(e,"ad_type: string;ad_position_type: string;ad_position: string;"),void 0;t(ge,Object.assign({},n))},gtAdShowEnd:function(e,t,n){if("string"!=typeof n.ad_type||"string"!=typeof n.ad_position_type||"string"!=typeof n.ad_position||"string"!=typeof n.result)return ve(e,"ad_type: string;ad_position_type: string;ad_position: string;result: string;"),void 0;t(me,Object.assign({},n))},gtLevelup:function(e,t,n){if("number"!=typeof n.get_exp||"string"!=typeof n.method||"number"!=typeof n.aflev||"number"!=typeof n.lev)return ve(e,"get_exp: number;method: string;aflev: number;lev: number;"),void 0;t(ke,Object.assign({},n))},gtStartPlay:function(e,t,n){if("string"!=typeof n.ectype_name)return ve(e,"ectype_name: string;"),void 0;t(_e,Object.assign({},n))},gtEndPlay:function(e,t,n){if("string"!=typeof n.ectype_name||"string"!=typeof n.result||"number"!=typeof n.duration)return ve(e,"ectype_name: string;result: string;duration: number;"),void 0;t(be,Object.assign({},n))},gtGetCoins:function(e,t,n){if("string"!=typeof n.coin_type||"string"!=typeof n.method||"number"!=typeof n.coin_num)return ve(e,"coin_type: string;method: string;coin_num: number;"),void 0;t(Oe,Object.assign({},n))},gtCostCoins:function(e,t,n){if("string"!=typeof n.coin_type||"string"!=typeof n.method||"number"!=typeof n.coin_num)return ve(e,"coin_type: string;method: string;coin_num: number;"),void 0;t(we,Object.assign({},n))},gtPurchase:function(e,t,n){if("string"!=typeof n.content_id||"string"!=typeof n.content_name||"number"!=typeof n.content_num||"string"!=typeof n.content_type||"string"!=typeof n.currency||"number"!=typeof n.currency_amount||"string"!=typeof n.is_success||"string"!=typeof n.payment_channel)return ve(e,"content_id: string;content_name: string;content_num: number;content_type: string;currency: string;currency_amount: number;is_success: string;payment_channel: string;"),void 0;t(Se,Object.assign({},n))}},Ae=function(){function e(){t(this,e)}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,Object.keys(Pe).forEach((function(e){n.sdk[e]=Pe[e].bind(null,n.sdk,n.sdk.event.bind(n.sdk))}))}}]),e}();Ae.pluginName="official:extend",function(e){e.True="true",e.False="false"}(de||(de={}));var Ce=["wx","qq"],je=function(){function e(){t(this,e),this.queue=[],this.firstTime=de.False,this.open=!1,this.startup=0}return i(e,[{key:"apply",value:function(e,t){var n=this;this.sdk=e,this.options=t,this.open=!!this.options.auto_report;var i=this.sdk,s=i.types,r=i.adapter,o=this.sdk.getKey("first");if(r.get(o).then((function(e){if(e===de.False)return n.firstTime=de.False,void 0;e||(n.firstTime=de.True),r.set(o,de.False)})),this.sdk.on(s.Ready,(function(){n.queue.length>0&&(n.sdk.event(p(n.queue)),n.queue.length=0)})),"undefined"!=typeof cc)return this.sdk.emit(this.sdk.types.LaunchComplete),void 0;this.sdk.target&&this.appLaunch(),this.open&&this.sdk.target&&(this.sdk.whichIs&&Ce.includes(this.sdk.whichIs)&&(this.appShowPrefix(this.appInfo),this.appShow(this.appInfo)),this.sdk.on(s.AppShow,(function(e){n.appShowPrefix(e),n.appShow(e)})),this.sdk.on(s.AppHide,(function(){n.appHide()})),this.sdk.on(s.AppError,(function(e){n.appError(e)})),this.sdk.on(s.AppOnShare,(function(e){n.onShareAppMessage(e)})),this.sdk.on(s.AppShare,(function(e){n.shareAppMessage(e)})),this.sdk.on(s.UuidChangeBefore,(function(){n.appHide(!0)})),this.sdk.on(s.UuidChangeAfter,(function(){n.appShow(n.appInfo||{},!0)})))}},{key:"event",value:function(e,t){this.sdk.ready?this.sdk.event(e,t):this.queue.push({event:e,params:t,local_time_ms:w()})}},{key:"getQuery",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};return this.sdk.isObject(t)&&Object.keys(t).forEach((function(i){if(!e.sdk.UtmType.includes(i)&&"scene"!==i){var s=t[i];"from_title"===i&&(s=encodeURIComponent(he(t[i]))),n["query_".concat(i)]=s}})),n}},{key:"appLaunch",value:function(){var e,t,n;this.appInfo=null===(t=(e=this.sdk.target).getLaunchOptionsSync)||void 0===t?void 0:t.call(e),this.scene=null===(n=this.appInfo)||void 0===n?void 0:n.scene,this.sdk.checkUsePlugin("official:utm")?this.sdk.emit(this.sdk.types.LaunchInfo,this.appInfo):this.sdk.emit(this.sdk.types.LaunchComplete)}},{key:"appShowPrefix",value:function(e){this.startup++}}],[{key:"init",value:function(e){var t,n,i,s,r,o;e.platform&&(null===(n=(t=e.platform).onShow)||void 0===n?void 0:n.call(t,(function(t){e.instances.forEach((function(e){e.emit(e.types.AppShowStart,t),e.emit(e.types.AppShow,t)}))})),null===(s=(i=e.platform).onHide)||void 0===s||s.call(i,(function(){e.instances.forEach((function(e){e.emit(e.types.AppHide),e.emit(e.types.AppClose)}))})),null===(o=(r=e.platform).onError)||void 0===o||o.call(r,(function(t){e.instances.forEach((function(e){e.emit(e.types.AppError,t)}))}))),e.prototype.appLaunch=function(){this.appShow()},e.prototype.appTerminate=function(){this.appHide()},e.prototype.appShow=function(){var e;void 0!==this.target.getLaunchOptionsSync&&(e=this.target.getLaunchOptionsSync()),this.emit(this.types.AppShow,e)},e.prototype.appHide=function(){this.emit(this.types.AppHide)},e.prototype.appError=function(e){this.emit(this.types.AppError,e)},e.prototype.rangerOnShareAppMessage=function(e){this.emit(this.types.AppOnShare,e)},e.prototype.rangerShareAppMessage=function(e){this.emit(this.types.AppShare,e)}}}]),e}();je.pluginName="official:auto",je.instances=[];var Ie=function(n){r(o,n);var s=c(o);function o(){var e;return t(this,o),(e=s.apply(this,arguments)).sessionStart=0,e.sessionDepth=0,e.shareDepth=0,e}return i(o,[{key:"appShow",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sessionStart=w();var s={session_id:this.sdk.sessionId,$is_first_time:this.firstTime};if(t)if("string"==typeof t)s.query=t;else if("object"===e(t)){var r=t.scene,o=t.query;if(s.scene=r,s.path="/",o&&"object"===e(o)){this.shareDepth=Number(o.share_depth)||0;var a={},u={},c=!1;Object.keys(o).forEach((function(e){var t=o[e];n.sdk.UtmType.includes(e)?(c=!0,u[e]=he(t)):(a[e]=t,s["query_".concat(e)]=t)})),c&&this.sdk.env.set(u),s.query=JSON.stringify(a)}}s.launch_type=i?2:this.startup>1?1:0,this.event(this.sdk.EventType.appOnShow,s),this.firstTime===de.True&&(this.firstTime=de.False)}},{key:"appHide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={session_duration:Math.ceil((w()-this.sessionStart)/1e3),session_id:this.sdk.sessionId};t.terminate_type=e?2:1,this.event(this.sdk.EventType.appOnHide,t)}},{key:"appError",value:function(e){var t={session_id:this.sdk.sessionId};if("string"==typeof e)t=Object.assign(Object.assign({},t),{stack:e,on_error:e});else{var n=this.sdk.isObject(e)?e:{},i=n.message,s=void 0===i?"":i,r=n.stack,o=void 0===r?"":r;t=Object.assign(Object.assign({},t),{stack:o,on_error:o,message:s})}this.event(this.sdk.EventType.appOnError,t)}},{key:"appShare",value:function(t){var n=this.sdk.env.get("user").user_unique_id,i=(Number(this.shareDepth)||0)+1,s=t||{};"object"!==e(s)&&(s={});var r=s.title,o=void 0===r?"":r,a="from_user_unique_id=".concat(n,"&share_depth=").concat(i,"&from_title=").concat(o);return s.query?s.query+="&"+a:s.query=a,this.event(this.sdk.EventType.pageOnShareAppMessage,Object.assign(Object.assign({},s.title?{title:s.title}:{}),{path:"/?"+s.query,query_share_depth:i,session_id:this.sdk.sessionId})),s}},{key:"onShareAppMessage",value:function(e){var t=this;try{"function"==typeof this.sdk.target.onShareAppMessage&&this.sdk.target.onShareAppMessage((function(){return t.appShare(e())}))}catch(e){}}},{key:"shareAppMessage",value:function(e){try{"function"==typeof this.sdk.target.shareAppMessage&&this.sdk.target.shareAppMessage(this.appShare(e))}catch(e){}}}]),o}(je),qe=function(){function e(){t(this,e),this.key="compensate",this.keyCache=[],this.batchMax=5,this.cacheBatchNumber=15,this.enable=!1,this.unReadyKeys={},this.bufferKeys={},this.errorKeys={},this.bufferPreKey="",this.errorPreKey="",this.hasKey=!1}return i(e,[{key:"apply",value:function(e,t){var n=this;if(this.sdk=e,this.options=t,this.enable=!!this.options.enable_cache,!this.enable)return;this.reportUrl=this.sdk.get("report_url"),this.bufferPreKey=this.sdk.getKey("buffer"),this.errorPreKey=this.sdk.getKey("compensate");var i=this.sdk.types;this.sdk.on(i.AppShow,(function(){n.hasKey?n.sdk.ready&&n.network()&&n.nowReport():n.getKeys().then((function(){n.hasKey=!0,n.sdk.ready&&n.network()&&n.nowReport()}))})),this.sdk.on(i.Ready,(function(){n.hasKey?n.network()&&n.nowReport():n.getKeys().then((function(){n.hasKey=!0,n.network()&&n.nowReport()}))})),this.sdk.on(i.Network,(function(e){e.current&&n.sdk.ready&&n.nowReport()})),this.sdk.on(i.AppClose,(function(){try{["unReadyKeys","bufferKeys","errorKeys"].forEach((function(e){Object.keys(n[e]).forEach((function(t){2===n[e][t]&&delete n[e][t]}))}))}catch(e){}})),this.sdk.on(i.SubmitError,(function(e){var t=e.event;n.storageError(t).then((function(e){n.errorKeys[e]=0}))})),this.sdk.on(i.CacheUnReady,(function(e){var t=e.length;t>0&&!function(){var i="".concat(n.bufferPreKey,"_unready_");if(t>n.cacheBatchNumber)for(var s=p(e);s.length>0;){var r=s.splice(0,n.cacheBatchNumber);if(r.length>0){var o=i+n.random();n.sSet(o,r).then((function(){return n.unReadyKeys[i]=0}))}}else{var a=i+n.random();n.sSet(a,e).then((function(){return n.unReadyKeys[i]=0}))}}()})),this.sdk.on(i.CacheBuffer,(function(e){var t="".concat(n.bufferPreKey,"_buffer_")+n.random();n.sSet(t,e).then((function(){n.bufferKeys[t]=0}))}))}},{key:"getKeys",value:function(){var e=this;return this.sdk.adapter.storageInfo().then((function(t){if(null==t?void 0:t.keys){var n=t.keys;Array.isArray(n)&&n.forEach((function(t){0===t.indexOf("".concat(e.bufferPreKey,"_unready"))?void 0===e.unReadyKeys[t]&&(e.unReadyKeys[t]=0):0===t.indexOf("".concat(e.bufferPreKey,"_buffer"))?void 0===e.bufferKeys[t]&&(e.bufferKeys[t]=0):0===t.indexOf("".concat(e.errorPreKey))&&void 0===e.errorKeys[t]&&(e.errorKeys[t]=0)}))}}))}},{key:"nowReport",value:function(){this.unReadyReport(),this.bufferReport(),this.errorReport()}},{key:"unReadyReport",value:function(){this.batchReport(this.unReadyKeys,!0)}},{key:"bufferReport",value:function(){this.batchReport(this.bufferKeys,!1)}},{key:"errorReport",value:function(){this.batchReport(this.errorKeys,!1)}},{key:"batchReport",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Object.keys(e).filter((function(t){return 0===e[t]}));if(0===i.length)return;if(i.length<=3)i.forEach((function(i){e[i]=1,t.byKey(e,i,n)}));else for(var s=p(i),r=0,o=function(){var i=s.splice(0,3);i.length>0&&(i.forEach((function(t){e[t]=1})),setTimeout((function(){i.forEach((function(i){t.byKey(e,i,n)}))}),150*r)),r++};s.length>0;)o()}},{key:"byKey",value:function(e,t,n){var i=this;this.sGet(t).then((function(s){if(!s)return e[t]=2,void 0;var r=n?i.sdk.env.compose(s):s;i.report(r).then((function(){e[t]=2,i.sRemove(t)})).catch((function(){e[t]=0}))})).catch((function(){e[t]=0}))}},{key:"report",value:function(e){if(!this.reportUrl&&(this.reportUrl=this.sdk.get("report_url"),!this.reportUrl))return Promise.reject();return this.sdk.adapter.request({url:this.reportUrl,method:"POST",data:e})}},{key:"storageError",value:function(e){var t="".concat(this.errorPreKey,"_")+this.random();return this.sSet(t,e).then((function(){return t}))}},{key:"sGet",value:function(e){var t=this,n=this.sdk.adapter;return n.get(e).then((function(i){if(!t.sdk.isObject(i)||!i.timestamp)return n.remove(e),null;var s=w();if(i.timestamp+6048e5<s)return n.remove(e),null;return i.data}))}},{key:"sSet",value:function(e,t){return this.sdk.adapter.set(e,{data:t,timestamp:w()})}},{key:"sRemove",value:function(e){return this.sdk.adapter.remove(e)}},{key:"random",value:function(){return"".concat(+new Date,"_").concat(Math.floor(1e5*Math.random()))}},{key:"network",value:function(){return!!this.sdk.env.get("is_connected")}}]),e}();return qe.pluginName="official:compensate",x.usePlugin(ne),x.usePlugin(ie),x.usePlugin(ue),x.usePlugin(pe),x.usePlugin(le),x.usePlugin(Ae),x.usePlugin(Ie),x.usePlugin(qe),new x}));
