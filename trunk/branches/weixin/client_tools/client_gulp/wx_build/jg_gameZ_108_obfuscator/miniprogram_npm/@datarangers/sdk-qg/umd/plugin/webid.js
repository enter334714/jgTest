!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).$$LOGSDK_PLUGIN_WEBID=n()}(this,(function(){"use strict";function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e){for(var n=0,t=0,i=(e+="").length,o=0;o<i;o++)((n=31*n+e.charCodeAt(t++))>0x7fffffffffff||n<-0x800000000000)&&(n&=0xffffffffffff);return n<0&&(n+=0x7ffffffffffff),n}function t(e){var n;if(!e.option.get("enable_custom_webid"))return null===(n=e.adapter._log)||void 0===n?void 0:n.warn("需要开启enable_custom_webid"),!1;return!0}function i(e,n){0!==e.indexOf(encodeURIComponent("https://"))&&0!==e.indexOf(encodeURIComponent("http://"))||(e=function(e){var n=e;try{n=decodeURIComponent(e)}catch(e){}return n}(e));var t=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(e),i=t[1]||"",o=t[2]||"",r=t[3]||"",f=o?function(e){var n={};return e&&e.split("&").forEach((function(e){if(e){var t=e.split("=");t[0]&&(n[t[0]]=t[1]||"")}})),n}(o.substring(1)):{};return f.Web_ID=n,e=i+function(e,n){var t=e;if(n){var i=[];Object.keys(n).forEach((function(e){i.push("".concat(e,"=").concat(n[e]))})),i.length>0&&(t+="?".concat(i.join("&")))}return t}("",f)+r,e}var o=function(){function o(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o)}var r,f,c;return r=o,c=[{key:"init",value:function(e){e.prototype.setWebId=function(e){if(null==e||!t(this))return;var i=n("".concat(e));this.config({web_id:"".concat(i)})},e.prototype.setWebIDviaUnionID=function(e){if(!e||!t(this))return;var i=n(String(e).trim());this.config({web_id:"".concat(i),wechat_unionid:e})},e.prototype.setWebIDviaOpenID=function(e){if(!e||!t(this))return;var i=n(String(e).trim());this.config({web_id:"".concat(i),wechat_openid:e})},e.prototype.createWebViewUrl=function(e){if(!e||!this.ready)return e;var n=this.env.get(o.key);if(!n)return e;return i(e,n)},e.prototype.createWebViewUrlAsync=function(e){var n=this;if(!e)return Promise.resolve(e);return this.ready?Promise.resolve(this.process(e,this.env.get(o.key))):new Promise((function(t){n.on(n.types.Ready,(function(){t(i(e,n.env.get(o.key)))}))}))}}}],(f=[{key:"apply",value:function(e,n){}}])&&e(r.prototype,f),c&&e(r,c),r,o}();return o.pluginName="official:webid",o.key="web_id",o}));
