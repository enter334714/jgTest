!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).$$LOGSDK_PLUGIN_AUTO=e()}(this,(function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function o(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return o(this,n)}}function p(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var c,h=function(){return+new Date},f=function(t){var e=t;try{e=decodeURIComponent(t)}catch(t){}return e};!function(t){t.True="true",t.False="false"}(c||(c={}));var l=["wx","qq"],d=function(){function t(){e(this,t),this.queue=[],this.firstTime=c.False,this.open=!1,this.startup=0}return i(t,[{key:"apply",value:function(t,e){var n=this;this.sdk=t,this.options=e,this.open=!!this.options.auto_report;var i=this.sdk,s=i.types,r=i.adapter,o=this.sdk.getKey("first");if(r.get(o).then((function(t){if(t===c.False)return n.firstTime=c.False,void 0;t||(n.firstTime=c.True),r.set(o,c.False)})),this.sdk.on(s.Ready,(function(){n.queue.length>0&&(n.sdk.event(p(n.queue)),n.queue.length=0)})),"undefined"!=typeof cc)return this.sdk.emit(this.sdk.types.LaunchComplete),void 0;this.sdk.target&&this.appLaunch(),this.open&&this.sdk.target&&(this.sdk.whichIs&&l.includes(this.sdk.whichIs)&&(this.appShowPrefix(this.appInfo),this.appShow(this.appInfo)),this.sdk.on(s.AppShow,(function(t){n.appShowPrefix(t),n.appShow(t)})),this.sdk.on(s.AppHide,(function(){n.appHide()})),this.sdk.on(s.AppError,(function(t){n.appError(t)})),this.sdk.on(s.AppOnShare,(function(t){n.onShareAppMessage(t)})),this.sdk.on(s.AppShare,(function(t){n.shareAppMessage(t)})),this.sdk.on(s.UuidChangeBefore,(function(){n.appHide(!0)})),this.sdk.on(s.UuidChangeAfter,(function(){n.appShow(n.appInfo||{},!0)})))}},{key:"event",value:function(t,e){this.sdk.ready?this.sdk.event(t,e):this.queue.push({event:t,params:e,local_time_ms:h()})}},{key:"getQuery",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};return this.sdk.isObject(e)&&Object.keys(e).forEach((function(i){if(!t.sdk.UtmType.includes(i)&&"scene"!==i){var s=e[i];"from_title"===i&&(s=encodeURIComponent(f(e[i]))),n["query_".concat(i)]=s}})),n}},{key:"appLaunch",value:function(){var t,e,n;this.appInfo=null===(e=(t=this.sdk.target).getLaunchOptionsSync)||void 0===e?void 0:e.call(t),this.scene=null===(n=this.appInfo)||void 0===n?void 0:n.scene,this.sdk.checkUsePlugin("official:utm")?this.sdk.emit(this.sdk.types.LaunchInfo,this.appInfo):this.sdk.emit(this.sdk.types.LaunchComplete)}},{key:"appShowPrefix",value:function(t){this.startup++}}],[{key:"init",value:function(t){var e,n,i,s,r,o;t.platform&&(null===(n=(e=t.platform).onShow)||void 0===n?void 0:n.call(e,(function(e){t.instances.forEach((function(t){t.emit(t.types.AppShowStart,e),t.emit(t.types.AppShow,e)}))})),null===(s=(i=t.platform).onHide)||void 0===s||s.call(i,(function(){t.instances.forEach((function(t){t.emit(t.types.AppHide),t.emit(t.types.AppClose)}))})),null===(o=(r=t.platform).onError)||void 0===o||o.call(r,(function(e){t.instances.forEach((function(t){t.emit(t.types.AppError,e)}))}))),t.prototype.appLaunch=function(){this.appShow()},t.prototype.appTerminate=function(){this.appHide()},t.prototype.appShow=function(){var t;void 0!==this.target.getLaunchOptionsSync&&(t=this.target.getLaunchOptionsSync()),this.emit(this.types.AppShow,t)},t.prototype.appHide=function(){this.emit(this.types.AppHide)},t.prototype.appError=function(t){this.emit(this.types.AppError,t)},t.prototype.rangerOnShareAppMessage=function(t){this.emit(this.types.AppOnShare,t)},t.prototype.rangerShareAppMessage=function(t){this.emit(this.types.AppShare,t)}}}]),t}();d.pluginName="official:auto",d.instances=[];var y=function(n){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}(o,n);var s=a(o);function o(){var t;return e(this,o),(t=s.apply(this,arguments)).sessionStart=0,t.sessionDepth=0,t.shareDepth=0,t}return i(o,[{key:"appShow",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sessionStart=h();var s={session_id:this.sdk.sessionId,$is_first_time:this.firstTime};if(e)if("string"==typeof e)s.query=e;else if("object"===t(e)){var r=e.scene,o=e.query;if(s.scene=r,s.path="/",o&&"object"===t(o)){this.shareDepth=Number(o.share_depth)||0;var a={},p={},u=!1;Object.keys(o).forEach((function(t){var e=o[t];n.sdk.UtmType.includes(t)?(u=!0,p[t]=f(e)):(a[t]=e,s["query_".concat(t)]=e)})),u&&this.sdk.env.set(p),s.query=JSON.stringify(a)}}s.launch_type=i?2:this.startup>1?1:0,this.event(this.sdk.EventType.appOnShow,s),this.firstTime===c.True&&(this.firstTime=c.False)}},{key:"appHide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={session_duration:Math.ceil((h()-this.sessionStart)/1e3),session_id:this.sdk.sessionId};e.terminate_type=t?2:1,this.event(this.sdk.EventType.appOnHide,e)}},{key:"appError",value:function(t){var e={session_id:this.sdk.sessionId};if("string"==typeof t)e=Object.assign(Object.assign({},e),{stack:t,on_error:t});else{var n=this.sdk.isObject(t)?t:{},i=n.message,s=void 0===i?"":i,r=n.stack,o=void 0===r?"":r;e=Object.assign(Object.assign({},e),{stack:o,on_error:o,message:s})}this.event(this.sdk.EventType.appOnError,e)}},{key:"appShare",value:function(e){var n=this.sdk.env.get("user").user_unique_id,i=(Number(this.shareDepth)||0)+1,s=e||{};"object"!==t(s)&&(s={});var r=s.title,o=void 0===r?"":r,a="from_user_unique_id=".concat(n,"&share_depth=").concat(i,"&from_title=").concat(o);return s.query?s.query+="&"+a:s.query=a,this.event(this.sdk.EventType.pageOnShareAppMessage,Object.assign(Object.assign({},s.title?{title:s.title}:{}),{path:"/?"+s.query,query_share_depth:i,session_id:this.sdk.sessionId})),s}},{key:"onShareAppMessage",value:function(t){var e=this;try{"function"==typeof this.sdk.target.onShareAppMessage&&this.sdk.target.onShareAppMessage((function(){return e.appShare(t())}))}catch(t){}}},{key:"shareAppMessage",value:function(t){try{"function"==typeof this.sdk.target.shareAppMessage&&this.sdk.target.shareAppMessage(this.appShare(t))}catch(t){}}}]),o}(d);return y}));
