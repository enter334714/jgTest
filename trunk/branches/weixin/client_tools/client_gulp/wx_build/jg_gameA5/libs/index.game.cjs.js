"use strict";var t="__clickId$$__",e="__openId$$__",r="wechat_mini_game",i=["brand","model","pixelRatio","screenWidth","screenHeight","system","platform","SDKVersion","bluetoothEnabled","locationEnabled","wifiEnabled","locationReducedAccuracy","theme"],n=["path","scene","query","shareTicket","referrerInfo"],o=function(t,e){try{wx.setStorageSync(t,e)}catch(t){console.error(t)}},a=function(t){try{return wx.getStorageSync(t)}catch(t){return console.error(t),""}},c=function(e){var r;(null===(r=e.query)||void 0===r?void 0:r.clickid)&&o(t,e.query.clickid)},l=function(){return a(t)||""},s=function(){return a(e)||""},d=function(){try{var t=wx.getSystemInfoSync(),e={};return i.forEach((function(r){e[r]=t[r]})),e}catch(t){return console.error(t),{}}},u=function(){var t,e;try{var r=wx.getAccountInfoSync();return{app_id:null===(t=null==r?void 0:r.miniProgram)||void 0===t?void 0:t.appId,client_version:null===(e=null==r?void 0:r.miniProgram)||void 0===e?void 0:e.version}}catch(t){return console.error(t),{}}},p=function(){var t=String((new Date).getTime());return t.substring(0,t.length-3)},v=function(){try{var t=wx.getEnterOptionsSync();c(t);var e={};return n.forEach((function(r){e[r]=t[r]})),e}catch(t){return console.error(t),{}}},f=function(){return f=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},f.apply(this,arguments)},h={source:r,clickId:"",device:{platform:"",brand:"",model:"",os_version:"",login_id:""},appData:{},extra:{system_data:{},launch_data:{},version:"1.0.1",page_stay_obj:{}},extraString:""},g=new(function(){function t(){var t,e=d(),r=v();c(r),this.loginId=s(),this.properties={},h.clickId=(null===(t=null==r?void 0:r.query)||void 0===t?void 0:t.clickid)||l(),h.device={platform:e.platform,brand:e.brand,model:e.model,os_version:e.system,login_id:s()},h.appData=u(),h.extra={system_data:e,launch_data:r,version:"1.0.1",page_stay_obj:{}},h.extraString=JSON.stringify(h.extra)}return t.prototype.setClickId=function(t){void 0===t&&(t=""),h.clickId=t||l()},t.prototype.setPageStay=function(t,e){if("start_time"!==t){var r=h.extra.page_stay_obj.start_time;if(!r)return console.error("没有进入时间");var i=e-r,n=Math.floor(i/60);h.extra.page_stay_obj={start_time:r,end_time:e,stay_time:n},h.extraString=JSON.stringify(h.extra)}else h.extra.page_stay_obj={start_time:e}},t.prototype.setProperties=function(t){void 0===t&&(t={}),this.properties=f(f({},this.properties),t)},t.prototype.setExtra=function(t){void 0===t&&(t={}),h.extra=f(f({},h.extra),t),h.extraString=JSON.stringify(h.extra)},t.prototype.getIp=function(){var t=this;wx.request({url:"https://ipv4",complete:function(e){wx.request({url:"https://ipv6",complete:function(r){var i,n;h.device.ipv4=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.ipv4,h.device.ipv6=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.ipv6,t.track(t.loginId?"launch_app":"login_fail")}})}})},t.prototype.init=function(t){if(void 0===t&&(t=""),t){var r=function(t){for(var e,r,i,n,o,a,c,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",d=0;d<t.length;)n=(e=t.charCodeAt(d++))>>2,o=(3&e)<<4|(r=t.charCodeAt(d++))>>4,a=(15&r)<<2|(i=t.charCodeAt(d++))>>6,c=63&i,isNaN(r)?a=c=64:isNaN(i)&&(c=64),s=s+l.charAt(n)+l.charAt(o)+l.charAt(a)+l.charAt(c);return s}(t);this.loginId=r,(i=r)&&o(e,i)}var i;this.loginId&&(h.device=f(f({},h.device),{login_id:this.loginId})),this.track(this.loginId?"launch_app":"login_fail")},t.prototype.track=function(t,e,i){if(void 0===e&&(e={}),!t)return console.error("event_type不得为空!");var n,o={event_type:t,source:r,context:{device:h.device,app:h.appData,clickid:h.clickId},properties:f(f({},this.properties),e),params:h.extraString,timestamp:+p()};n=o,wx.request({url:"https://sdk.gameapida.com/sdk/v1/wechat",method:"POST",data:n})},t}());!function(t){var e,r,i=function(t){return{startEffect:function(e){var r;c(e),t.setClickId(null===(r=null==e?void 0:e.query)||void 0===r?void 0:r.clickid),t.setPageStay("start_time",Number(p()))},hideEffect:function(){t.setPageStay("end_time",Number(p())),t.track("page_stay")}}}(t),n=i.startEffect,o=i.hideEffect;null===(e=wx.onShow)||void 0===e||e.call(wx,n),null===(r=wx.onHide)||void 0===r||r.call(wx,o)}(g),module.exports=g;
