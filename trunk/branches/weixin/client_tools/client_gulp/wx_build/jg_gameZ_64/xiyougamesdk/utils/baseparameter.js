"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_config=require("../config"),_config2=_interopRequireDefault(_config),_common=require("./common"),_common2=_interopRequireDefault(_common);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var instance=void 0,BaseParameter=function(){function e(){if(_classCallCheck(this,e),instance)return instance;(instance=this).parameter={api_version:"0.0.0",sdk_version:"0.0.0",network_type:"",share_id:"",uuid:""},this.offsetTime=!1,this._getOffsetTime(),this._getNetworkType(),this.getUUID(),_common2.default.xylog("BaseParameter constructor")}return _createClass(e,[{key:"getUUID",value:function(){var e=wx.getStorageSync("xiyou:uuid");if(e)return this.UUID=e;e=_common2.default.getDeviceId();return _common2.default.xylog("xiyou:uuid",e),wx.setStorage({key:"xiyou:uuid",data:e}),this.UUID=e}},{key:"getQueryParam",value:function(){var e={time:this.getTime()},t=this.getSystemInfo(),t={deb:t.deb,det:t.det,osn:t.osn,osv:t.osv,iemio:t.iemio,udid:t.udid,mac:t.mac},n=this.getSdkInfo(),a=n.app_id,i=n.channel,r=n.package_id,s=n.api_version,o=n.sdk_version,c=n.package_name,u=n.version_code,n=n.version_name;return Object.assign(e,t,{app_id:a,channel:i,package_id:r,api_version:s,sdk_version:o,package_name:c,version_code:u,version_name:n,idfao:""}),console.log(e),e}},{key:"getAnalyticsLaunch",value:function(){var e={ts:this.getTime()},t=new _config2.default,n=this.getSystemInfo(),a=n.wxv,i=n.sr,r=n.udid,s=n.blevel,o=n.deb,c=n.det,a={weixin_version:a,sr:i,openudido:r,benchmark_level:s,osn:n.osn,osv:n.osv,device_brand:o,device_type:c},i=this.getSdkInfo(),r=i.app_id,s=i.master_id,n=i.channel,o=i.package_id,c=i.package_name,i=i.sdk_version;return Object.assign(e,a,{apid:r,chid:s,gcid:n,paid:o,pn:c,sdk_version:i},{network_type:this.networkType,scene_value:this.getLaunchOptions().scene,share_id:this.shareId,share_ticket:this.getLaunchOptions().share_ticket,referrer_appid:this.getLaunchOptions().referrer_info.app_id||"",latitude:"0",longitude:"0",app_version:t.appVersion}),e}},{key:"getSdkInfo",value:function(){if(this.parameter.sdk_info)return this.parameter.sdk_info;var e=new _config2.default,t=this.getLaunchOptions().query,n=this.getLaunchOptions().referrerInfo;return this.parameter.sdk_info={app_id:e.appId,master_id:e.masterId,channel:t.gcid||e.channelId,package_id:t.paid||e.packageId,package_name:t.pn||e.packageName,version_name:"1.0.0",version_code:"1",api_version:this.parameter.api_version||"1.4",sdk_version:this.parameter.sdk_version||"1.0.1"},n&&(this.parameter.sdk_info.app_id=n.appId,n.extraData&&(this.parameter.sdk_info.channel=refExtraData.gcid,this.parameter.sdk_info.package_id=refExtraData.paid,this.parameter.sdk_info.package_name=refExtraData.pn)),this.parameter.sdk_info}},{key:"getLaunchOptions",value:function(){if(this.parameter.launch_options)return this.parameter.launch_options;var e=wx.getLaunchOptionsSync(),t=(_common2.default.xylog("LaunchOptionsSync",JSON.stringify(e)),{});return e.referrerInfo&&e.referrerInfo.appId&&(t={app_id:e.referrerInfo.appId,extra_data:e.referrerInfo.extraData||""}),this.parameter.launch_options={scene:e.scene,is_sticky:!!e.isSticky,share_ticket:e.shareTicket||"",referrer_info:t,query:e.query},this.parameter.launch_options}},{key:"getSystemInfo",value:function(){if(this.parameter.system_info)return this.parameter.system_info;var e=wx.getSystemInfoSync();return this.parameter.system_info={deb:e.brand,det:e.model,osn:e.platform,osv:e.system,iemio:"",udid:this.getUUID(),mac:"",sr:e.screenWidth+"x"+e.screenHeight,wxv:e.version,blevel:e.benchmarkLevel},this.parameter.system_info}},{key:"_getNetworkType",value:function(){wx.getNetworkType({success:function(e){_common2.default.xylog("getNetworkType",this),this.networkType=e.networkType}.bind(this),fail:function(){}.bind(this)})}},{key:"getTime",value:function(){var e=0,t=(Object.is(instance.offsetTime,!1)?this._getOffsetTime():e=instance.offsetTime,Date.parse(new Date)),n=(t/=1e3)-e;return _common2.default.xylog("当前时间偏移量",e,"当前时间戳",t,"计算后的时间",n),n}},{key:"_getOffsetTime",value:function(){wx.request({url:"https://analytics.52xiyou.com/tools/timestamp",success:function(e){var t=Date.parse(new Date);instance.offsetTime=e.data-(t/=1e3),_common2.default.xylog("获取时间偏移量成功",instance.offsetTime)},fail:function(e){_common2.default.xylog("获取时间偏移量失败，不设置偏移量")}})}},{key:"apiVersion",set:function(e){this.parameter.api_version=e},get:function(){return this.parameter.api_version}},{key:"sdkVersion",set:function(e){this.parameter.sdk_version=e},get:function(){return this.parameter.sdk_version}},{key:"networkType",set:function(e){this.parameter.network_type=e},get:function(){return this.parameter.network_type}},{key:"shareId",set:function(e){this.parameter.share_id=e},get:function(){return this.parameter.share_id}},{key:"UUID",set:function(e){this.parameter.uuid=e},get:function(){return this.parameter.uuid}}]),e}();exports.default=BaseParameter;