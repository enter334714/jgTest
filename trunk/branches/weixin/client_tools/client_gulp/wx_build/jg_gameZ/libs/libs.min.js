var Laya=window.Laya=function($t,$V){var $b={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($V,$U){return 1==arguments.length?$b.__presubstr.call(this,$V):$b.__presubstr.call(this,$V,0<$U?$U:this.length+$U)},__init:function($V){$V.forEach(function($V){$V.__init$&&$V.__init$()})},__isClass:function($V){return $V&&($V.__isclass||$V==Object||$V==String||$V==Array)},__newvec:function($V,$U){var $r=[];$r.length=$V;for(var $s=0;$s<$V;$s++)$r[$s]=$U;return $r},__extend:function($V,$U){for(var $r in $U)if($U.hasOwnProperty($r)){var $s=Object.getOwnPropertyDescriptor($U,$r),$p=$s.get,$c=$s.set;$p||$c?$p&&$c?Object.defineProperty($V,$r,$s):($p&&Object.defineProperty($V,$r,$p),$c&&Object.defineProperty($V,$r,$c)):$V[$r]=$U[$r]}function $R(){$b.un(this,"constructor",$V)}$R.prototype=$U.prototype,$V.prototype=new $R,$b.un($V.prototype,"__imps",$b.__copy({},$U.prototype.__imps))},__copy:function($V,$U){if(!$U)return null;for(var $r in $V=$V||{},$U)$V[$r]=$U[$r];return $V},__package:function($V,$U){if(!$b.__packages[$V]){$b.__packages[$V]=!0;var $r=$t,$s=$V.split(".");if(1<$s.length)for(var $p=0,$c=$s.length-1;$p<$c;$p++){var $R=$r[$s[$p]];$r=$R||($r[$s[$p]]={})}$r[$s[$s.length-1]]||($r[$s[$s.length-1]]=$U||{})}},__hasOwnProperty:function($V,$U){return $U=$U||this,Object.hasOwnProperty.call($U,$V)||function $V($U,$r){if(Object.hasOwnProperty.call($r.prototype,$U))return!0;var $s=$r.prototype.__super;return null==$s?null:$V($U,$s)}($V,$U.__class)},__typeof:function($V,$U){if(!$V||!$U)return!1;if($U===String)return"string"==typeof $V;if($U===Number)return"number"==typeof $V;if($U.__interface__)$U=$U.__interface__;else if("string"!=typeof $U)return $V instanceof $U;return $V.__imps&&$V.__imps[$U]||$V.__class==$U},__as:function($V,$U){return this.__typeof($V,$U)?$V:null},__int:function($V){return $V?parseInt($V):0},interface:function($V,$U){$b.__package($V,{});var $r=$b.__internals,$s=$r[$V]=$r[$V]||{self:$V};if($U){var $p=$U.split(",");$s.extend=[];for(var $c=0;$c<$p.length;$c++){var $R=$p[$c];$r[$R]=$r[$R]||{self:$R},$s.extend.push($r[$R])}}var $T=$t,$N=$V.split(".");for($c=0;$c<$N.length-1;$c++)$T=$T[$N[$c]];$T[$N[$N.length-1]]={__interface__:$V}},class:function($V,$U,$r,$s){if($r&&$b.__extend($V,$r),$U)if($b.__package($U,$V),$b.__classmap[$U]=$V,0<$U.indexOf(".")){if(0==$U.indexOf("laya.")){var $p=$U.split(".");$s=$s||$p[$p.length-1],$b[$s]&&console.log("Warning!,this class["+$s+"] already exist:",$b[$s]),$b[$s]=$V}}else"Main"==$U?$t.Main=$V:"MainWX"==$U?$t.MainWX=$V:($b[$U]&&console.log("Error!,this class["+$U+"] already exist:",$b[$U]),$b[$U]=$V);var $c=$b.un,$R=$V.prototype;$c($R,"hasOwnProperty",$b.__hasOwnProperty),$c($R,"__class",$V),$c($R,"__super",$r),$c($R,"__className",$U),$c($V,"__super",$r),$c($V,"__className",$U),$c($V,"__isclass",!0),$c($V,"super",function($V){this.__super.call($V)})},imps:function($V,$U){if(!$U)return null;var $p=$V.__imps||$b.un($V,"__imps",{});function $c($V){var $U,$r;if(($U=$b.__internals[$V])&&($p[$V]=!0,$r=$U.extend))for(var $s=0;$s<$r.length;$s++)$c($r[$s].self)}for(var $r in $U)$c($r)},superSet:function($V,$U,$r,$s){var $p=$V.prototype["_$set_"+$r];$p&&$p.call($U,$s)},superGet:function($V,$U,$r){var $s=$V.prototype["_$get_"+$r];return $s?$s.call($U):null},getset:function($V,$U,$r,$s,$p){$V?($s&&($U["_$GET_"+$r]=$s),$p&&($U["_$SET_"+$r]=$p)):($s&&$b.un($U,"_$get_"+$r,$s),$p&&$b.un($U,"_$set_"+$r,$p)),$s&&$p?Object.defineProperty($U,$r,{get:$s,set:$p,enumerable:!1,configurable:!0}):($s&&Object.defineProperty($U,$r,{get:$s,enumerable:!1,configurable:!0}),$p&&Object.defineProperty($U,$r,{set:$p,enumerable:!1,configurable:!0}))},static:function($r,$s){for(var $p=0,$V=$s.length;$p<$V;$p+=2)if("length"==$s[$p])$r.length=$s[$p+1].call($r);else{function $U(){var $U=$s[$p],$V=$s[$p+1];Object.defineProperty($r,$U,{get:function(){return delete this[$U],this[$U]=$V.call(this)},set:function($V){delete this[$U],this[$U]=$V},enumerable:!0,configurable:!0})}$U()}},un:function($V,$U,$r){return $r||($r=$V[$U]),$b.__propun.value=$r,Object.defineProperty($V,$U,$b.__propun),$r},uns:function($U,$V){$V.forEach(function($V){$b.un($U,$V)})}};return $t.console=$t.console||{log:function(){}},$t.trace=$t.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$b}(window,document);!function($V,$U,$r){$r.un,$r.uns,$r.static,$r.class,$r.getset,$r.__newvec}(window,document,Laya),function($R,$U,$y){$y.un,$y.uns;var $N=$y.static,$u=$y.class,$b=$y.getset;$y.__newvec;$y.interface("laya.runtime.IMarket"),$y.interface("laya.filters.IFilter"),$y.interface("laya.display.ILayout"),$y.interface("laya.resource.IDispose"),$y.interface("laya.runtime.IPlatform"),$y.interface("laya.resource.IDestroy"),$y.interface("laya.runtime.IConchNode"),$y.interface("laya.filters.IFilterAction"),$y.interface("laya.runtime.ICPlatformClass"),$y.interface("laya.resource.ICreateResource"),$y.interface("laya.runtime.IConchRenderObject"),$y.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $w=function(){function $c(){}return $u($c,"laya.utils.RunDriver"),$c.FILTER_ACTIONS=[],$c.pixelRatio=-1,$c._charSizeTestDiv=null,$c.now=function(){return Date.now()},$c.getWindow=function(){return $R},$c.getPixelRatio=function(){if($c.pixelRatio<0){var $V=$j.context,$U=$V.backingStorePixelRatio||$V.webkitBackingStorePixelRatio||$V.mozBackingStorePixelRatio||$V.msBackingStorePixelRatio||$V.oBackingStorePixelRatio||$V.backingStorePixelRatio||1;($c.pixelRatio=($j.window.devicePixelRatio||1)/$U)<1&&($c.pixelRatio=1)}return $c.pixelRatio},$c.getIncludeStr=function($V){return null},$c.createShaderCondition=function($V){var $U="(function() {return "+$V+";})";return $y._runScript($U)},$c.fontMap=[],$c.measureText=function($V,$U){var $r=$c.hanzi.test($V);if($r&&$c.fontMap[$U])return $c.fontMap[$U];var $s=$j.context;$s.font=$U;var $p=$s.measureText($V);return $p||($p={width:16,height:16}),$r&&($c.fontMap[$U]=$p),$p},$c.getWebGLContext=function($V){},$c.beginFlush=function(){},$c.endFinish=function(){},$c.addToAtlas=null,$c.flashFlushImage=function($V){},$c.drawToCanvas=function($V,$U,$r,$s,$p,$c){var $R=$OV.create("2D"),$T=new $a($r,$s,$R);return $Z.renders[$U]._fun($V,$T,$p,$c),$R},$c.createParticleTemplate2D=null,$c.createGLTextur=null,$c.createWebGLContext2D=null,$c.changeWebGLSize=function($V,$U){},$c.createRenderSprite=function($V,$U){return new $Z($V,$U)},$c.createFilterAction=function($V){return new $O},$c.createGraphics=function(){return new $_},$c.clear=function($V){$m._context.ctx.clear()},$c.cancelLoadByUrl=function($V){},$c.clearAtlas=function($V){},$c.isAtlas=function($V){return!1},$c.addTextureToAtlas=function($V){},$c.getTexturePixels=function($V,$U,$r,$s,$p){return null},$c.skinAniSprite=function(){return null},$c.update3DLoop=function(){},$N($c,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$c}(),$s=($b(1,$y,"alertGlobalError",null,function($V){var $c=0;$j.window.onerror=$V?function($V,$U,$r,$s,$p){$c++<5&&$p&&alert($p.stack||$p)}:null}),$y.init=function($V,$U,$r){for(var $s=[],$p=2,$c=arguments.length;$p<$c;$p++)$s.push(arguments[$p]);if(!$y._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$y._arrayBufferSlice),$y._isinit=!0,$j.__init__(),$x.__init__(),$_.__init__(),$y.timer=new $F,$y.scaleTimer=new $F,$y.loader=new $NV,$C.__init__(),$p=0;for(var $R=$s.length;$p<$R;$p++)$s[$p].enable&&$s[$p].enable();return $G.__init__(),$T.__init__(),$$.__init__(),$J.beginCheck(),$y._currentStage=$y.stage=new $lV,$y.stage.conchModel&&$y.stage.conchModel.setRootNode(),$y._getUrlPath(),$y.render=new $m(0,0),$y.stage.size($V,$U),$Z.__init__(),$S.__init__(),$q.instance.__init__($y.stage,$m.canvas),$dV.__init__(),$H.autoStopMusic=!0,$I.__init__(),$m.canvas}},$y._getUrlPath=function(){var $V=$j.window.location,$U=$V.pathname;$U=$U&&":"==$U.charAt(2)?$U.substring(1):$U,$K.rootPath=$K.basePath=$K.getPath("file:"==$V.protocol?$U:$V.protocol+"//"+$V.host+$V.pathname)},$y._arrayBufferSlice=function($V,$U){var $r=new Uint8Array(this,$V,$U-$V),$s=new Uint8Array($r.length);return $s.set($r),$s.buffer},$y._runScript=function($V){return $j.window[$y._evcode]($V)},$y.stage=null,$y.timer=null,$y.scaleTimer=null,$y.loader=null,$y.version="1.8.6",$y.render=null,$y._currentStage=null,$y._isinit=!1,$y.isDebug=!1,$y.MiniAdpter={init:function(){$R.navigator&&$R.navigator.userAgent&&-1<$R.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$N($y,["conchMarket",function(){return this.conchMarket=$R.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$R.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $V(){}return $u($V,"Config"),$V.WebGLTextCacheCount=500,$V.atlasEnable=!1,$V.showCanvasMark=!1,$V.animationInterval=50,$V.isAntialias=!1,$V.isAlpha=!1,$V.premultipliedAlpha=!0,$V.isStencil=!0,$V.preserveDrawingBuffer=!1,$V}()),$t=function(){function $t(){this._events=null}$u($t,"laya.events.EventDispatcher");var $V=$t.prototype;return $V.hasListener=function($V){return!!(this._events&&this._events[$V])},$V.getListener=function($V){return this._events?this._events[$V]:null},$V.event=function($V,$U){if(!this._events||!this._events[$V])return!1;var $r=this._events[$V];if($r.lock)$r.queue||($r.queue=[]),$r.queue.push($U);else{var $s;for($r.lock=!0,$r.cursor=$r.head;$r.cursor;)($s=$r.cursor).recover?($r.head=$r.tail=$r.cursor=null,console.error("node is recover："+$s.id)):($r.cursor=$s.next,$s.once&&$t.delNode($r,$s),$s.method&&(null!=$U?$s.args?$s.method.apply($s.caller,$s.args.concat($U)):$U instanceof Array?$s.method.apply($s.caller,$U):$s.caller?$s.method.call($s.caller,$U):$y.recordError("事件派发错误","node.caller:"+$s.caller+"node.method:"+$s.method+"data:"+$U+"node.prev"+$s.prev):$s.method.apply($s.caller,$s.args)),$s.once&&$t.recoverHandler($s));$r.lock=!1,!$r.head&&this._events&&this._events[$V]==$r&&delete this._events[$V],$r.queue&&$r.queue.length&&this.event($V,$r.queue.shift())}return!0},$V.on=function($V,$U,$r,$s){return this._createListener($V,$U,$r,$s,!1)},$V.once=function($V,$U,$r,$s){return this._createListener($V,$U,$r,$s,!0)},$V._createListener=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=!0),$c&&this.off($V,$U,$r,$p);var $R=$t.createHandler($U||this,$r,$s,$p);this._events||(this._events={});var $T=this._events,$N=$T[$V];return $N?$N.tail?($R.prev=$N.tail,$N.tail.next=$R,$N.tail=$R):$N.head=$N.tail=$R:$T[$V]={head:$R,tail:$R,cursor:null,lock:!1},this},$V.off=function($V,$U,$r,$s){if(void 0===$s&&($s=!1),!this._events||!this._events[$V])return this;for(var $p=this._events[$V],$c=$p.head;$c;){if((!$U||$c.caller===$U)&&$c.method===$r&&(!$s||$c.once)){$t.delNode($p,$c),$p.cursor==$c&&($p.cursor=$c.next),$t.recoverHandler($c);break}$c=$c.next}return this},$V.offAll=function($V){var $U=this._events;if(!$U)return this;if($V)this._recoverHandlers($U[$V]),delete $U[$V];else{for(var $r in $U)this._recoverHandlers($U[$r]);this._events=null}return this},$V._recoverHandlers=function($V){if($V){for(var $U=$V.head;$U;){$t.delNode($V,$U);var $r=$U.next;$t.recoverHandler($U),$U=$r}$V.cursor=null}},$V.isMouseEvent=function($V){return $t.MOUSE_EVENTS[$V]},$t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$t.delNode=function($V,$U){$U.prev?$U.prev.next=$U.next:$V.head=$U.next,$U.next?$U.next.prev=$U.prev:$V.tail=$U.prev},$t.createHandler=function($V,$U,$r,$s){var $p=500<$t._freeHandler.length?$t._freeHandler.shift():null;if($p)if($p.recover)$p.recover=!1,$p.caller=$V,$p.method=$U,$p.args=$r,$p.once=$s;else{var $c="";try{arguments.propertyIsEnumerable.caller}catch($V){$c=$V.stack}var $R=$p.caller?($p.caller.__proto__&&$p.caller.__proto__.constructor&&$p.caller.__proto__.constructor.name)+"|"+$p.caller.__className+"|"+$p.caller.name:"",$T=$p.method?$p.method.name:"";$y.recordError("EventDispatcher重复创建","caller="+$R+"  method="+$T+"  stack="+$c),$p={id:++$t._nodeCount,caller:$V,method:$U,args:$r,once:$s,recover:!1}}else $p={id:++$t._nodeCount,caller:$V,method:$U,args:$r,once:$s,recover:!1};return $p.prev=$p.next=null,$p},$t.recoverHandler=function($V){if($V.recover){if($t._errorCount<5){$t._errorCount++;var $U="";try{arguments.propertyIsEnumerable.caller}catch($V){$U=$V.stack}var $r=$V.caller?($V.caller.__proto__&&$V.caller.__proto__.constructor&&$V.caller.__proto__.constructor.name)+"|"+$V.caller.__className+"|"+$V.caller.name:"",$s=$V.method?$V.method.name:"";$y.recordError("EventDispatcher重复回收","id="+$V.id+"  caller="+$r+"  method="+$s+"  stack="+$U)}$V.caller=$V.method=$V.args=$V.prev=null}else $V.recover=!0,$V.caller=$V.method=$V.args=$V.prev=$V.next=null,$t._freeHandler&&$t._freeHandler.length<3e3&&$t._freeHandler.push($V)},$t._freeHandler=[],$t._nodeCount=0,$t._errorCount=0,$t}(),$W=function(){function $p($V,$U,$r,$s){this.once=!1,void(this._id=0)===$s&&($s=!1),this.setTo($V,$U,$r,$s)}$u($p,"laya.utils.Handler");var $V=$p.prototype;return $V.setTo=function($V,$U,$r,$s){return this._id=$p._gid++,this.caller=$V,this.method=$U,this.args=$r,this.once=$s,this},$V.run=function(){if(null==this.method)return null;var $V=this._id,$U=this.method.apply(this.caller,this.args);return this._id===$V&&this.once&&this.recover(),$U},$V.runWith=function($V){if(null==this.method)return null;var $U=this._id;if(null==$V)var $r=this.method.apply(this.caller,this.args);else $r=this.args||$V.unshift?this.args?this.method.apply(this.caller,this.args.concat($V)):this.method.apply(this.caller,$V):this.method.call(this.caller,$V);return this._id===$U&&this.once&&this.recover(),$r},$V.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$V.recover=function(){0<this._id&&(this._id=0,this.clear())},$p.create=function($V,$U,$r,$s){return void 0===$s&&($s=!0),new $p($V,$U,$r,$s)},$p._gid=1,$p}(),$Q=function(){function $V(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$u($V,"laya.display.BitmapFont");var $U=$V.prototype;return $U.loadFont=function($V,$U){this._path=$V,this._complete=$U,$y.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$W.create(this,this.onLoaded))},$U.onLoaded=function(){this.parseFont($TV.getRes(this._path),$TV.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$U.parseFont=function($V,$U){if(null!=$V&&null!=$U){this._texture=$U;var $r=$V.getElementsByTagName("info");if(!$r[0].getAttributeNode)return this.parseFont2($V,$U);this.fontSize=parseInt($r[0].getAttributeNode("size").nodeValue);var $s,$p=$r[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($p[0]),parseInt($p[1]),parseInt($p[2]),parseInt($p[3])],$s=$V.getElementsByTagName("char");var $c=0;for($c=0;$c<$s.length;$c++){var $R=$s[$c],$T=parseInt($R.getAttributeNode("id").nodeValue),$N=parseInt($R.getAttributeNode("xoffset").nodeValue)/1,$t=parseInt($R.getAttributeNode("yoffset").nodeValue)/1,$b=parseInt($R.getAttributeNode("xadvance").nodeValue)/1,$S=new $n;$S.x=parseInt($R.getAttributeNode("x").nodeValue),$S.y=parseInt($R.getAttributeNode("y").nodeValue),$S.width=parseInt($R.getAttributeNode("width").nodeValue),$S.height=parseInt($R.getAttributeNode("height").nodeValue);var $_=$bV.create($U,$S.x,$S.y,$S.width,$S.height,$N,$t);this._maxWidth=Math.max(this._maxWidth,$b+this.letterSpacing),this._fontCharDic[$T]=$_,this._fontWidthMap[$T]=$b}}},$U.parseFont2=function($V,$U){if(null!=$V&&null!=$U){this._texture=$U;var $r=$V.getElementsByTagName("info");this.fontSize=parseInt($r[0].attributes.size.nodeValue);var $s=$r[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($s[0]),parseInt($s[1]),parseInt($s[2]),parseInt($s[3])];var $p=$V.getElementsByTagName("char"),$c=0;for($c=0;$c<$p.length;$c++){var $R=$p[$c].attributes,$T=parseInt($R.id.nodeValue),$N=parseInt($R.xoffset.nodeValue)/1,$t=parseInt($R.yoffset.nodeValue)/1,$b=parseInt($R.xadvance.nodeValue)/1,$S=new $n;$S.x=parseInt($R.x.nodeValue),$S.y=parseInt($R.y.nodeValue),$S.width=parseInt($R.width.nodeValue),$S.height=parseInt($R.height.nodeValue);var $_=$bV.create($U,$S.x,$S.y,$S.width,$S.height,$N,$t);this._maxWidth=Math.max(this._maxWidth,$b+this.letterSpacing),this._fontCharDic[$T]=$_,this._fontWidthMap[$T]=$b}}},$U.getCharTexture=function($V){return this._fontCharDic[$V.charCodeAt(0)]},$U.destroy=function(){if(this._texture){for(var $V in this._fontCharDic){var $U=this._fontCharDic[$V];$U&&$U.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$U.setSpaceWidth=function($V){this._spaceWidth=$V},$U.getCharWidth=function($V){var $U=$V.charCodeAt(0);return this._fontWidthMap[$U]?this._fontWidthMap[$U]+this.letterSpacing:" "==$V?this._spaceWidth+this.letterSpacing:0},$U.getTextWidth=function($V){for(var $U=0,$r=0,$s=$V.length;$r<$s;$r++)$U+=this.getCharWidth($V.charAt($r));return $U},$U.getMaxWidth=function(){return this._maxWidth},$U.getMaxHeight=function(){return this.fontSize},$U.drawText=function($V,$U,$r,$s,$p,$c){var $R,$T=this.getTextWidth($V),$N=0;"center"===$p&&($N=($c-$T)/2),"right"===$p&&($N=$c-$T);for(var $t=0,$b=0,$S=$V.length;$b<$S;$b++)($R=this.getCharTexture($V.charAt($b)))&&($U.graphics.drawTexture($R,$r+$t+$N,$s),$t+=this.getCharWidth($V.charAt($b)))},$V}(),$T=function(){function $r(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$r._TF_EMPTY}$u($r,"laya.display.css.Style");var $V=$r.prototype;return $V.getTransform=function(){return this._tf},$V.setTransform=function($V){this._tf="none"!==$V&&$V?$V:$r._TF_EMPTY},$V.setTranslateX=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.translateX=$V},$V.setTranslateY=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.translateY=$V},$V.setScaleX=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.scaleX=$V},$V.setScale=function($V,$U){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.scaleX=$V,this._tf.scaleY=$U},$V.setScaleY=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.scaleY=$V},$V.setRotate=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.rotate=$V},$V.setSkewX=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.skewX=$V},$V.setSkewY=function($V){this._tf===$r._TF_EMPTY&&(this._tf=new $p),this._tf.skewY=$V},$V.destroy=function(){this.scrollRect=null},$V.render=function($V,$U,$r,$s){},$V.getCSSStyle=function(){return $UV.EMPTY},$V._enableLayout=function(){return!1},$b(0,$V,"scaleX",function(){return this._tf.scaleX},function($V){this.setScaleX($V)}),$b(0,$V,"transform",function(){return this.getTransform()},function($V){this.setTransform($V)}),$b(0,$V,"translateX",function(){return this._tf.translateX},function($V){this.setTranslateX($V)}),$b(0,$V,"translateY",function(){return this._tf.translateY},function($V){this.setTranslateY($V)}),$b(0,$V,"scaleY",function(){return this._tf.scaleY},function($V){this.setScaleY($V)}),$b(0,$V,"block",function(){return 0!=(1&this._type)}),$b(0,$V,"skewY",function(){return this._tf.skewY},function($V){this.setSkewY($V)}),$b(0,$V,"rotate",function(){return this._tf.rotate},function($V){this.setRotate($V)}),$b(0,$V,"skewX",function(){return this._tf.skewX},function($V){this.setSkewX($V)}),$b(0,$V,"paddingLeft",function(){return 0}),$b(0,$V,"paddingTop",function(){return 0}),$b(0,$V,"absolute",function(){return!0}),$r.__init__=function(){$r._TF_EMPTY=new $p,$r.EMPTY=new $r},$r.EMPTY=null,$r._TF_EMPTY=null,$r}(),$G=function(){function $U($V){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$B.create($U.defaultColor),this.family=$U.defaultFamily,this.stroke=$U._STROKE,this.size=$U.defaultSize,$V&&$V!==$U.EMPTY&&$V.copyTo(this)}$u($U,"laya.display.css.Font");var $V=$U.prototype;return $V.set=function($V){this._text=null;for(var $U=$V.split(" "),$r=0,$s=$U.length;$r<$s;$r++){var $p=$U[$r];switch($p){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$p.indexOf("px")&&(this.size=parseInt($p),this.family=$U[$r+1],$r++)}},$V.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$V.copyTo=function($V){$V._type=this._type,$V._text=this._text,$V._weight=this._weight,$V._color=this._color,$V.family=this.family,$V.stroke=this.stroke!=$U._STROKE?this.stroke.slice():$U._STROKE,$V.indent=this.indent,$V.size=this.size},$b(0,$V,"password",function(){return 0!=(1024&this._type)},function($V){$V?this._type|=1024:this._type&=-1025}),$b(0,$V,"color",function(){return this._color.strColor},function($V){this._color=$B.create($V)}),$b(0,$V,"italic",function(){return 0!=(512&this._type)},function($V){$V?this._type|=512:this._type&=-513}),$b(0,$V,"bold",function(){return 0!=(2048&this._type)},function($V){$V?this._type|=2048:this._type&=-2049}),$b(0,$V,"weight",function(){return""+this._weight},function($V){var $U=0;switch($V){case"normal":break;case"bold":this.bold=!0,$U=700;break;case"bolder":$U=800;break;case"lighter":$U=100;break;default:$U=parseInt($V)}this._weight=$U,this._text=null}),$b(0,$V,"decoration",function(){return this._decoration?this._decoration.value:null},function($V){var $U=$V.split(" ");switch(this._decoration||(this._decoration={}),$U[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$U[0]}$U[1]&&(this._decoration.color=$B.create($U)),this._decoration.value=$V}),$U.__init__=function(){$U.EMPTY=new $U(null)},$U.EMPTY=null,$U.defaultColor="#000000",$U.defaultSize=12,$U.defaultFamily="Arial",$U.defaultFont="12px Arial",$U._STROKE=[0,"#000000"],$U._ITALIC=512,$U._PASSWORD=1024,$U._BOLD=2048,$U}(),$p=function(){function $V(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $u($V,"laya.display.css.TransformInfo"),$V}(),$_=function(){function $S(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$m.isConchNode){this._nativeObj=new $R._conchGraphics,this.id=this._nativeObj.conchID}}$u($S,"laya.display.Graphics");var $V=$S.prototype;return $V.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$V.clear=function($V){void 0===$V&&($V=!1);var $U=0,$r=0;if($V){var $s=this._one;if(this._cmds){for($r=this._cmds.length,$U=0;$U<$r;$U++)!($s=this._cmds[$U])||$s.callee!==$m._context._drawTexture&&$s.callee!==$m._context._drawTextureWithTransform||($s[0]=null,$S._cache.push($s));this._cmds.length=0}else $s&&(!$s||$s.callee!==$m._context._drawTexture&&$s.callee!==$m._context._drawTextureWithTransform||($s[0]=null,$S._cache.push($s)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($U=0,$r=this._vectorgraphArray.length;$U<$r;$U++)$Y.getInstance().deleteShape(this._vectorgraphArray[$U]);this._vectorgraphArray.length=0}},$V._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$V._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $r,this._graphicBounds._graphics=this)},$V._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$V._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$V.getBounds=function($V){return void 0===$V&&($V=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($V)},$V.getBoundPoints=function($V){return void 0===$V&&($V=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($V)},$V._addCmd=function($V){this._cmds=this._cmds||[],$V.callee=$V.shift(),this._cmds.push($V)},$V.setFilters=function($V){this._saveToCmd($m._context._setFilters,$V)},$V.drawTexture=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$R&&($R=1),!$V||$R<.01)return null;$s||($s=$V.sourceWidth),$p||($p=$V.sourceHeight),$R=$R<0?0:1<$R?1:$R;var $T,$N=!$m.isWebGL&&($j.onFirefox||$j.onEdge||$j.onIE||$j.onSafari)?.5:0,$t=$s/$V.sourceWidth,$b=$p/$V.sourceHeight;return $s=$V.width*$t,$p=$V.height*$b,$V.loaded&&($s<=0||$p<=0)?null:($U+=$V.offsetX*$t,$r+=$V.offsetY*$b,this._sp&&(this._sp._renderType|=512),$U-=$N,$r-=$N,$s+=2*$N,$p+=2*$N,$S._cache.length?(($T=$S._cache.pop())[0]=$V,$T[1]=$U,$T[2]=$r,$T[3]=$s,$T[4]=$p,$T[5]=$c,$T[6]=$R):$T=[$V,$U,$r,$s,$p,$c,$R],$T.callee=$c||1!=$R?$m._context._drawTextureWithTransform:$m._context._drawTexture,null!=this._one||$c||1!=$R?this._saveToCmd($T.callee,$T):(this._one=$T,this._render=this._renderOneImg),$V.loaded||$V.once("loaded",this,this._textureLoaded,[$V,$T]),this._repaint(),$T)},$V.cleanByTexture=function($V,$U,$r,$s,$p){if(void 0===$s&&($s=0),void 0===$p&&($p=0),!$V)return this.clear();if(this._one&&this._render===this._renderOneImg){$s||($s=$V.sourceWidth),$p||($p=$V.sourceHeight);var $c=$s/$V.sourceWidth,$R=$p/$V.sourceHeight;$s=$V.width*$c,$p=$V.height*$R,$U+=$V.offsetX*$c,$r+=$V.offsetY*$R,this._one[0]=$V,this._one[1]=$U,this._one[2]=$r,this._one[3]=$s,this._one[4]=$p,this._repaint()}else this.clear(),$V&&this.drawTexture($V,$U,$r,$s,$p)},$V.drawTextures=function($V,$U){$V&&this._saveToCmd($m._context._drawTextures,[$V,$U])},$V.fillTexture=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$c&&($c="repeat"),$V){var $T=[$V,$U,$r,$s,$p,$c,$R||$D.EMPTY,{}];$V.loaded||$V.once("loaded",this,this._textureLoaded,[$V,$T]),this._saveToCmd($m._context._fillTexture,$T)}},$V._textureLoaded=function($V,$U){$U[3]=$U[3]||$V.width,$U[4]=$U[4]||$V.height,this._repaint()},$V.fillCircle=function($V,$U,$r,$s,$p,$c,$R){$r.bitmap.enableMerageInAtlas=!1;var $T=new Float32Array(2*($R+1)),$N=new Float32Array(2*($R+1)),$t=new Uint16Array(3*$R),$b=2*Math.PI/$R,$S=0;$T[0]=$s,$T[1]=$p,$N[0]=$s/$r.width,$N[1]=$p/$r.height;for(var $_=2,$G=0;$G<$R;$G++){var $q=$c*Math.cos($S)+$s,$u=$c*Math.sin($S)+$p;$T[$_]=$q,$T[$_+1]=$u,$N[$_]=$q/$r.width,$N[$_+1]=$u/$r.height,$S+=$b,$_+=2}for($G=$_=0;$G<$R;$G++)$t[$_++]=0,$t[$_++]=$G+1,$t[$_++]=$R+1<=$G+2?1:$G+2;this.drawTriangles($r,$V,$U,$T,$N,$t)},$V.drawTriangles=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){void 0===$T&&($T=1),this._saveToCmd($m._context.drawTriangles,[$V,$U,$r,$s,$p,$c,$R,$T,$N,$t])},$V._saveToCmd=function($V,$U){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$U,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($U)),$U.callee=$V,this._repaint(),$U},$V.clipRect=function($V,$U,$r,$s){this._saveToCmd($m._context._clipRect,[$V,$U,$r,$s])},$V.fillText=function($V,$U,$r,$s,$p,$c,$R){void 0===$R&&($R=0),this._saveToCmd($m._context._fillText,[$V,$U,$r,$s||$G.defaultFont,$p,$c])},$V.fillBorderText=function($V,$U,$r,$s,$p,$c,$R,$T){this._saveToCmd($m._context._fillBorderText,[$V,$U,$r,$s||$G.defaultFont,$p,$c,$R,$T])},$V.strokeText=function($V,$U,$r,$s,$p,$c,$R){this._saveToCmd($m._context._strokeText,[$V,$U,$r,$s||$G.defaultFont,$p,$c,$R])},$V.alpha=function($V){$V=$V<0?0:1<$V?1:$V,this._saveToCmd($m._context._alpha,[$V])},$V.setAlpha=function($V){$V=$V<0?0:1<$V?1:$V,this._saveToCmd($m._context._setAlpha,[$V])},$V.transform=function($V,$U,$r){void 0===$U&&($U=0),void 0===$r&&($r=0),this._saveToCmd($m._context._transform,[$V,$U,$r])},$V.rotate=function($V,$U,$r){void 0===$U&&($U=0),void 0===$r&&($r=0),this._saveToCmd($m._context._rotate,[$V,$U,$r])},$V.scale=function($V,$U,$r,$s){void 0===$r&&($r=0),void 0===$s&&($s=0),this._saveToCmd($m._context._scale,[$V,$U,$r,$s])},$V.translate=function($V,$U){this._saveToCmd($m._context._translate,[$V,$U])},$V.save=function(){this._saveToCmd($m._context._save,[])},$V.restore=function(){this._saveToCmd($m._context._restore,[])},$V.replaceText=function($V){this._repaint();var $U=this._cmds;if($U){for(var $r=$U.length-1;-1<$r;$r--)if(this._isTextCmd($U[$r].callee))return $U[$r][0].toUpperCase?$U[$r][0]=$V:$U[$r][0].setText($V),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$V:this._one[0].setText($V),!0;return!1},$V._isTextCmd=function($V){return $V===$m._context._fillText||$V===$m._context._fillBorderText||$V===$m._context._strokeText},$V.replaceTextColor=function($V){this._repaint();var $U=this._cmds;if($U)for(var $r=$U.length-1;-1<$r;$r--)this._isTextCmd($U[$r].callee)&&($U[$r][4]=$V,$U[$r][0].toUpperCase||($U[$r][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$V,this._one[0].toUpperCase||(this._one[0].changed=!0))},$V.loadImage=function($V,$U,$r,$s,$p,$c){var $R=this;void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),void 0===$p&&($p=0);var $T=$TV.getRes($V);function $N($V){$V&&($R.drawTexture($V,$U,$r,$s,$p),null!=$c&&$c.call($R._sp,$V))}$T?$N($T):$y.loader.load($V,$W.create(null,$N),null,"image")},$V._renderEmpty=function($V,$U,$r,$s){},$V._renderAll=function($V,$U,$r,$s){for(var $p,$c=this._cmds,$R=0,$T=$c.length;$R<$T;$R++)($p=$c[$R]).callee.call($U,$r,$s,$p)},$V._renderOne=function($V,$U,$r,$s){this._one.callee.call($U,$r,$s,this._one)},$V._renderOneImg=function($V,$U,$r,$s){this._one.callee.call($U,$r,$s,this._one),2305!==$V._renderType&&($V._renderType|=1)},$V.drawLine=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=1);var $R=0;$m.isWebGL&&($R=$Y.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($R));var $T=$c%2==0?0:.5,$N=[$V+$T,$U+$T,$r+$T,$s+$T,$p,$c,$R];this._saveToCmd($m._context._drawLine,$N)},$V.drawLines=function($V,$U,$r,$s,$p){void 0===$p&&($p=1);var $c=0;if($r&&!($r.length<4)){$m.isWebGL&&($c=$Y.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($c));var $R=$p%2==0?0:.5,$T=[$V+$R,$U+$R,$r,$s,$p,$c];this._saveToCmd($m._context._drawLines,$T)}},$V.drawCurves=function($V,$U,$r,$s,$p){void 0===$p&&($p=1);var $c=[$V,$U,$r,$s,$p];this._saveToCmd($m._context._drawCurves,$c)},$V.drawRect=function($V,$U,$r,$s,$p,$c,$R){void 0===$R&&($R=1);var $T=$c?$R/2:0,$N=$c?$R:0,$t=[$V+$T,$U+$T,$r-$N,$s-$N,$p,$c,$R];this._saveToCmd($m._context._drawRect,$t)},$V.drawCircle=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=1);var $R=$p?$c/2:0,$T=0;$m.isWebGL&&($T=$Y.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($T));var $N=[$V,$U,$r-$R,$s,$p,$c,$T];this._saveToCmd($m._context._drawCircle,$N)},$V.drawPie=function($V,$U,$r,$s,$p,$c,$R,$T){void 0===$T&&($T=1);var $N=$R?$T/2:0,$t=$R?$T:0,$b=0;$m.isWebGL&&($b=$Y.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($b));var $S=[$V+$N,$U+$N,$r-$t,$s,$p,$c,$R,$T,$b];$S[3]=$v.toRadian($s),$S[4]=$v.toRadian($p),this._saveToCmd($m._context._drawPie,$S)},$V.drawPoly=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=1);var $R=0,$T=!1;$m.isWebGL&&($R=$Y.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($R),$T=!(6<$r.length));var $N=$p?$c%2==0?0:.5:0,$t=[$V+$N,$U+$N,$r,$s,$p,$c,$R,$T];this._saveToCmd($m._context._drawPoly,$t)},$V.drawPath=function($V,$U,$r,$s,$p){var $c=[$V,$U,$r,$s,$p];this._saveToCmd($m._context._drawPath,$c)},$b(0,$V,"cmds",function(){return this._cmds},function($V){this._sp&&(this._sp._renderType|=512),this._cmds=$V,this._render=this._renderAll,this._repaint()}),$S.__init__=function(){if($m.isConchNode){for(var $V=laya.display.Graphics.prototype,$U=$j.window.ConchGraphics.prototype,$r=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$s=0,$p=$r.length;$s<=$p;$s++){var $c=$r[$s];$V[$c]=$U[$c]}$V._saveToCmd=null,$U.drawImageS&&($V.drawTextures=function($V,$U){if($V&&$V.loaded&&$V.bitmap&&$V.source){var $r=$V.uv,$s=$V.bitmap.width,$p=$V.bitmap.height;this.drawImageS($V.bitmap.source,$r[0]*$s,$r[1]*$p,($r[2]-$r[0])*$s,($r[5]-$r[3])*$p,$V.offsetX,$V.offsetY,$V.width,$V.height,$U)}}),$V.drawTexture=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$R&&($R=1),$V)if($V.loaded){if($V.loaded&&$V.bitmap&&$V.source&&($s||($s=$V.sourceWidth),$p||($p=$V.sourceHeight),$R=$R<0?0:1<$R?1:$R,$s=$s-$V.sourceWidth+$V.width,$p=$p-$V.sourceHeight+$V.height,!($s<=0||$p<=0))){$U+=$V.offsetX,$r+=$V.offsetY;var $T=$V.uv,$N=$V.bitmap.width,$t=$V.bitmap.height;$T[4]<$T[0]&&$T[5]<$T[1]?this.drawImageM($V.bitmap.source,$T[4]*$N,$T[5]*$t,($T[0]-$T[4])*$N,($T[1]-$T[5])*$t,$U,$r,$s,$p,$c,$R):this.drawImageM($V.bitmap.source,$T[0]*$N,$T[1]*$t,($T[2]-$T[0])*$N,($T[5]-$T[3])*$t,$U,$r,$s,$p,$c,$R),this._repaint()}}else $V.once("loaded",this,function(){this.drawTexture($V,$U,$r,$s,$p,$c)})},$V.fillTexture=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$c&&($c="repeat"),$V&&$V.loaded){var $T,$N=$m._context.ctx,$t=$V.bitmap.width,$b=$V.bitmap.height,$S=$V.uv;$T=$V.uv!=$bV.DEF_UV?$N.createPattern($V.bitmap.source,$c,$S[0]*$t,$S[1]*$b,($S[2]-$S[0])*$t,($S[5]-$S[3])*$b):$N.createPattern($V.bitmap.source,$c);var $_=0,$G=0;$R&&($U+=$R.x%$V.width,$r+=$R.y%$V.height,$_-=$R.x%$V.width,$G-=$R.y%$V.height),this._fillImage($T,$U,$r,$_,$G,$s,$p)}}}},$S._cache=[],$S}(),$r=function(){function $O(){this._cacheBoundsType=!1}$u($O,"laya.display.GraphicsBounds");var $V=$O.prototype;return $V.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$V.reset=function(){this._temp&&(this._temp.length=0)},$V.getBounds=function($V){return void 0===$V&&($V=!1),(!this._bounds||!this._temp||this._temp.length<1||$V!=this._cacheBoundsType)&&(this._bounds=$n._getWrapRec(this.getBoundPoints($V),this._bounds)),this._cacheBoundsType=$V,this._bounds},$V.getBoundPoints=function($V){return void 0===$V&&($V=!1),(!this._temp||this._temp.length<1||$V!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($V)),this._cacheBoundsType=$V,this._rstBoundPoints=$v.copyArray(this._rstBoundPoints,this._temp)},$V._getCmdPoints=function($V){void 0===$V&&($V=!1);var $U,$r,$s=$m._context,$p=this._graphics.cmds;if(($U=this._temp||(this._temp=[])).length=0,$p||null==this._graphics._one||($O._tempCmds.length=0,$O._tempCmds.push(this._graphics._one),$p=$O._tempCmds),!$p)return $U;($r=$O._tempMatrixArrays).length=0;var $c=$O._initMatrix;$c.identity();for(var $R,$T,$N=$O._tempMatrix,$t=NaN,$b=NaN,$S=NaN,$_=NaN,$G=NaN,$q=NaN,$u=0,$h=$p.length;$u<$h;$u++)if(($R=$p[$u]).callee)switch($R.callee){case $s._save:case 7:$r.push($c),$c=$c.clone();break;case $s._restore:case 8:$c=$r.pop();break;case $s._scale:case 5:$N.identity(),$N.translate(-$R[2],-$R[3]),$N.scale($R[0],$R[1]),$N.translate($R[2],$R[3]),this._switchMatrix($c,$N);break;case $s._rotate:case 3:$N.identity(),$N.translate(-$R[1],-$R[2]),$N.rotate($R[0]),$N.translate($R[1],$R[2]),this._switchMatrix($c,$N);break;case $s._translate:case 6:$N.identity(),$N.translate($R[0],$R[1]),this._switchMatrix($c,$N);break;case $s._transform:case 4:$N.identity(),$N.translate(-$R[1],-$R[2]),$N.concat($R[0]),$N.translate($R[1],$R[2]),this._switchMatrix($c,$N);break;case 16:case 24:$O._addPointArrToRst($U,$n._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$c);break;case 17:$c.copyTo($N),$N.concat($R[4]),$O._addPointArrToRst($U,$n._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$N);break;case $s._drawTexture:$T=$R[0],$V?$R[3]&&$R[4]?$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$c):($T=$R[0],$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$T.width,$T.height),$c)):($t=($R[3]||$T.sourceWidth)/$T.width,$b=($R[4]||$T.sourceHeight)/$T.height,$S=$t*$T.sourceWidth,$_=$b*$T.sourceHeight,$G=0<$T.offsetX?$T.offsetX:0,$q=0<$T.offsetY?$T.offsetY:0,$G*=$t,$q*=$b,$O._addPointArrToRst($U,$n._getBoundPointS($R[1]-$G,$R[2]-$q,$S,$_),$c));break;case $s._fillTexture:$R[3]&&$R[4]?$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$c):($T=$R[0],$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$T.width,$T.height),$c));break;case $s._drawTextureWithTransform:var $l;$l=$R[5]?($c.copyTo($N),$N.concat($R[5]),$N):$c,$V?$R[3]&&$R[4]?$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$R[3],$R[4]),$l):($T=$R[0],$O._addPointArrToRst($U,$n._getBoundPointS($R[1],$R[2],$T.width,$T.height),$l)):($T=$R[0],$t=($R[3]||$T.sourceWidth)/$T.width,$b=($R[4]||$T.sourceHeight)/$T.height,$S=$t*$T.sourceWidth,$_=$b*$T.sourceHeight,$G=0<$T.offsetX?$T.offsetX:0,$q=0<$T.offsetY?$T.offsetY:0,$G*=$t,$q*=$b,$O._addPointArrToRst($U,$n._getBoundPointS($R[1]-$G,$R[2]-$q,$S,$_),$l));break;case $s._drawRect:case 13:$O._addPointArrToRst($U,$n._getBoundPointS($R[0],$R[1],$R[2],$R[3]),$c);break;case $s._drawCircle:case $s._fillCircle:case 14:$O._addPointArrToRst($U,$n._getBoundPointS($R[0]-$R[2],$R[1]-$R[2],$R[2]+$R[2],$R[2]+$R[2]),$c);break;case $s._drawLine:case 20:$O._tempPoints.length=0;var $W;$W=.5*$R[5],$R[0]==$R[2]?$O._tempPoints.push($R[0]+$W,$R[1],$R[2]+$W,$R[3],$R[0]-$W,$R[1],$R[2]-$W,$R[3]):$R[1]==$R[3]?$O._tempPoints.push($R[0],$R[1]+$W,$R[2],$R[3]+$W,$R[0],$R[1]-$W,$R[2],$R[3]-$W):$O._tempPoints.push($R[0],$R[1],$R[2],$R[3]),$O._addPointArrToRst($U,$O._tempPoints,$c);break;case $s._drawCurves:case 22:$O._addPointArrToRst($U,$L.I.getBezierPoints($R[2]),$c,$R[0],$R[1]);break;case $s._drawPoly:case $s._drawLines:case 18:$O._addPointArrToRst($U,$R[2],$c,$R[0],$R[1]);break;case $s._drawPath:case 19:$O._addPointArrToRst($U,this._getPathPoints($R[2]),$c,$R[0],$R[1]);break;case $s._drawPie:case 15:$O._addPointArrToRst($U,this._getPiePoints($R[0],$R[1],$R[2],$R[3],$R[4]),$c)}return 200<$U.length?$U=$v.copyArray($U,$n._getWrapRec($U)._getBoundPoints()):8<$U.length&&($U=$d.scanPList($U)),$U},$V._switchMatrix=function($V,$U){$U.concat($V),$U.copyTo($V)},$V._getPiePoints=function($V,$U,$r,$s,$p){var $c=$O._tempPoints;$O._tempPoints.length=0,$c.push($V,$U);var $R=($p-$s)%(2*Math.PI)/10,$T=NaN,$N=$s;for($T=0;$T<=10;$T++)$c.push($V+$r*Math.cos($N),$U+$r*Math.sin($N)),$N+=$R;return $c},$V._getPathPoints=function($V){var $U,$r,$s=0,$p=$O._tempPoints;for($p.length=0,$U=$V.length,$s=0;$s<$U;$s++)1<($r=$V[$s]).length&&($p.push($r[1],$r[2]),3<$r.length&&$p.push($r[3],$r[4]));return $p},$O._addPointArrToRst=function($V,$U,$r,$s,$p){void 0===$s&&($s=0),void 0===$p&&($p=0);var $c,$R=0;for($c=$U.length,$R=0;$R<$c;$R+=2)$O._addPointToRst($V,$U[$R]+$s,$U[$R+1]+$p,$r)},$O._addPointToRst=function($V,$U,$r,$s){var $p=$D.TEMP;$p.setTo($U||0,$r||0),$s.transformPoint($p),$V.push($p.x,$p.y)},$O._tempPoints=[],$O._tempMatrixArrays=[],$O._tempCmds=[],$N($O,["_tempMatrix",function(){return this._tempMatrix=new $z},"_initMatrix",function(){return this._initMatrix=new $z}]),$O}(),$c=function(){function $V(){}$u($V,"laya.events.Event");var $U=$V.prototype;return $U.setTo=function($V,$U,$r){return this.type=$V,this.currentTarget=$U,this.target=$r,this},$U.stopPropagation=function(){this._stoped=!0},$b(0,$U,"stageY",function(){return $y.stage.mouseY}),$b(0,$U,"charCode",function(){return this.nativeEvent.charCode}),$b(0,$U,"touches",function(){var $V=this.nativeEvent.touches;if($V)for(var $U=$y.stage,$r=0,$s=$V.length;$r<$s;$r++){var $p=$V[$r],$c=$D.TEMP;$c.setTo($p.clientX,$p.clientY),$U._canvasTransform.invertTransformPoint($c),$U.transform.invertTransformPoint($c),$p.stageX=$c.x,$p.stageY=$c.y}return $V}),$b(0,$U,"keyLocation",function(){return this.nativeEvent.keyLocation}),$b(0,$U,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$b(0,$U,"altKey",function(){return this.nativeEvent.altKey}),$b(0,$U,"shiftKey",function(){return this.nativeEvent.shiftKey}),$b(0,$U,"stageX",function(){return $y.stage.mouseX}),$V.EMPTY=new $V,$V.MOUSE_DOWN="mousedown",$V.MOUSE_UP="mouseup",$V.CLICK="click",$V.RIGHT_MOUSE_DOWN="rightmousedown",$V.RIGHT_MOUSE_UP="rightmouseup",$V.RIGHT_CLICK="rightclick",$V.MOUSE_MOVE="mousemove",$V.MOUSE_OVER="mouseover",$V.MOUSE_OUT="mouseout",$V.MOUSE_WHEEL="mousewheel",$V.ROLL_OVER="mouseover",$V.ROLL_OUT="mouseout",$V.DOUBLE_CLICK="doubleclick",$V.CHANGE="change",$V.CHANGED="changed",$V.RESIZE="resize",$V.ADDED="added",$V.REMOVED="removed",$V.DISPLAY="display",$V.UNDISPLAY="undisplay",$V.ERROR="error",$V.COMPLETE="complete",$V.LOADED="loaded",$V.INITED="inited",$V.PROGRESS="progress",$V.INPUT="input",$V.RENDER="render",$V.OPEN="open",$V.MESSAGE="message",$V.CLOSE="close",$V.KEY_DOWN="keydown",$V.KEY_PRESS="keypress",$V.KEY_UP="keyup",$V.FRAME="enterframe",$V.DRAG_START="dragstart",$V.DRAG_MOVE="dragmove",$V.DRAG_END="dragend",$V.ENTER="enter",$V.SELECT="select",$V.BLUR="blur",$V.FOCUS="focus",$V.VISIBILITY_CHANGE="visibilitychange",$V.FOCUS_CHANGE="focuschange",$V.PLAYED="played",$V.PAUSED="paused",$V.STOPPED="stopped",$V.START="start",$V.END="end",$V.ENABLE_CHANGED="enablechanged",$V.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$V.COMPONENT_ADDED="componentadded",$V.COMPONENT_REMOVED="componentremoved",$V.LAYER_CHANGED="layerchanged",$V.HIERARCHY_LOADED="hierarchyloaded",$V.RECOVERED="recovered",$V.RELEASED="released",$V.LINK="link",$V.LABEL="label",$V.FULL_SCREEN_CHANGE="fullscreenchange",$V.DEVICE_LOST="devicelost",$V.MESH_CHANGED="meshchanged",$V.MATERIAL_CHANGED="materialchanged",$V.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$V.ANIMATION_CHANGED="animationchanged",$V.TRIGGER_ENTER="triggerenter",$V.TRIGGER_STAY="triggerstay",$V.TRIGGER_EXIT="triggerexit",$V.TRAIL_FILTER_CHANGE="trailfilterchange",$V.DOMINO_FILTER_CHANGE="dominofilterchange",$V}(),$S=(function(){function $V(){}$u($V,"laya.events.Keyboard"),$V.NUMBER_0=48,$V.NUMBER_1=49,$V.NUMBER_2=50,$V.NUMBER_3=51,$V.NUMBER_4=52,$V.NUMBER_5=53,$V.NUMBER_6=54,$V.NUMBER_7=55,$V.NUMBER_8=56,$V.NUMBER_9=57,$V.A=65,$V.B=66,$V.C=67,$V.D=68,$V.E=69,$V.F=70,$V.G=71,$V.H=72,$V.I=73,$V.J=74,$V.K=75,$V.L=76,$V.M=77,$V.N=78,$V.O=79,$V.P=80,$V.Q=81,$V.R=82,$V.S=83,$V.T=84,$V.U=85,$V.V=86,$V.W=87,$V.X=88,$V.Y=89,$V.Z=90,$V.F1=112,$V.F2=113,$V.F3=114,$V.F4=115,$V.F5=116,$V.F6=117,$V.F7=118,$V.F8=119,$V.F9=120,$V.F10=121,$V.F11=122,$V.F12=123,$V.F13=124,$V.F14=125,$V.F15=126,$V.NUMPAD=21,$V.NUMPAD_0=96,$V.NUMPAD_1=97,$V.NUMPAD_2=98,$V.NUMPAD_3=99,$V.NUMPAD_4=100,$V.NUMPAD_5=101,$V.NUMPAD_6=102,$V.NUMPAD_7=103,$V.NUMPAD_8=104,$V.NUMPAD_9=105,$V.NUMPAD_ADD=107,$V.NUMPAD_DECIMAL=110,$V.NUMPAD_DIVIDE=111,$V.NUMPAD_ENTER=108,$V.NUMPAD_MULTIPLY=106,$V.NUMPAD_SUBTRACT=109,$V.SEMICOLON=186,$V.EQUAL=187,$V.COMMA=188,$V.MINUS=189,$V.PERIOD=190,$V.SLASH=191,$V.BACKQUOTE=192,$V.LEFTBRACKET=219,$V.BACKSLASH=220,$V.RIGHTBRACKET=221,$V.QUOTE=222,$V.ALTERNATE=18,$V.BACKSPACE=8,$V.CAPS_LOCK=20,$V.COMMAND=15,$V.CONTROL=17,$V.DELETE=46,$V.ENTER=13,$V.ESCAPE=27,$V.PAGE_UP=33,$V.PAGE_DOWN=34,$V.END=35,$V.HOME=36,$V.LEFT=37,$V.UP=38,$V.RIGHT=39,$V.DOWN=40,$V.SHIFT=16,$V.SPACE=32,$V.TAB=9,$V.INSERT=45}(),function(){function $p(){}return $u($p,"laya.events.KeyBoardManager"),$p.__init__=function(){$p._addEvent("keydown"),$p._addEvent("keypress"),$p._addEvent("keyup")},$p._addEvent=function($U){$j.document.addEventListener($U,function($V){laya.events.KeyBoardManager._dispatch($V,$U)},!0)},$p._dispatch=function($V,$U){if($p.enabled){$p._event._stoped=!1,$p._event.nativeEvent=$V,$p._event.keyCode=$V.keyCode||$V.which||$V.charCode,"keydown"===$U?$p._pressKeys[$p._event.keyCode]=!0:"keyup"===$U&&($p._pressKeys[$p._event.keyCode]=null);for(var $r=$y.stage.focus&&null!=$y.stage.focus.event&&$y.stage.focus.displayedInStage?$y.stage.focus:$y.stage,$s=$r;$s;)$s.event($U,$p._event.setTo($U,$s,$r)),$s=$s.parent}},$p.hasKeyDown=function($V){return $p._pressKeys[$V]},$p._pressKeys={},$p.enabled=!0,$N($p,["_event",function(){return this._event=new $c}]),$p}()),$q=(function(){function $V(){}$u($V,"laya.events.KeyLocation"),$V.STANDARD=0,$V.LEFT=1,$V.RIGHT=2,$V.NUM_PAD=3}(),function(){function $b(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$j.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $c,this._matrix=new $z,this._point=new $D,this._rect=new $n,this._prePoint=new $D,this._curTouchID=NaN}$u($b,"laya.events.MouseManager");var $V=$b.prototype;return $V.__init__=function($V,$U){var $r=this;this._stage=$V;var $s=this,$p=this._eventList;$U.oncontextmenu=function($V){if($b.enabled)return!1},$U.addEventListener("mousedown",function($V){$b.enabled&&($j.onIE||$V.preventDefault(),$p.push($V),$s.mouseDownTime=$j.now())}),$U.addEventListener("mouseup",function($V){$b.enabled&&($V.preventDefault(),$p.push($V),$s.mouseDownTime=-$j.now())},!0),$U.addEventListener("mousemove",function($V){if($b.enabled){$V.preventDefault();var $U=$j.now();if($U-$s._lastMoveTimer<10)return;$s._lastMoveTimer=$U,$p.push($V)}},!0),$U.addEventListener("mouseout",function($V){$b.enabled&&$p.push($V)}),$U.addEventListener("mouseover",function($V){$b.enabled&&$p.push($V)}),$U.addEventListener("touchstart",function($V){$b.enabled&&($p.push($V),$b._isFirstTouch||$dV.isInputting||$V.preventDefault(),$s.mouseDownTime=$j.now())}),$U.addEventListener("touchend",function($V){$b.enabled?($b._isFirstTouch||$dV.isInputting||$V.preventDefault(),$b._isFirstTouch=!1,$p.push($V),$s.mouseDownTime=-$j.now()):$r._curTouchID=NaN},!0),$U.addEventListener("touchmove",function($V){$b.enabled&&($V.preventDefault(),$p.push($V))},!0),$U.addEventListener("touchcancel",function($V){$b.enabled?($V.preventDefault(),$p.push($V)):$r._curTouchID=NaN},!0),$U.addEventListener("mousewheel",function($V){$b.enabled&&$p.push($V)}),$U.addEventListener("DOMMouseScroll",function($V){$b.enabled&&$p.push($V)})},$V.initEvent=function($V,$U){var $r;this._event._stoped=!1,this._event.nativeEvent=$U||$V,this._target=null,this._point.setTo($V.pageX||$V.clientX,$V.pageY||$V.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$V.identifier||0,this._tTouchID=this._event.touchId,($r=$h.I._event)._stoped=!1,$r.nativeEvent=this._event.nativeEvent,$r.touchId=this._event.touchId},$V.checkMouseWheel=function($V){this._event.delta=$V.wheelDelta?.025*$V.wheelDelta:-$V.detail;for(var $U=$h.I.getLastOvers(),$r=0,$s=$U.length;$r<$s;$r++){var $p=$U[$r];$p.event("mousewheel",this._event.setTo("mousewheel",$p,this._target))}},$V.onMouseMove=function($V){$h.I.onMouseMove($V,this._tTouchID)},$V.onMouseDown=function($V){if($dV.isInputting&&$y.stage.focus&&$y.stage.focus.focus&&!$y.stage.focus.contains(this._target)){var $U=$y.stage.focus._tf||$y.stage.focus,$r=$V._tf||$V;$r instanceof laya.display.Input&&$r.multiline==$U.multiline?$U._focusOut():$U.focus=!1}$h.I.onMouseDown($V,this._tTouchID,this._isLeftMouse)},$V.onMouseUp=function($V){$h.I.onMouseUp($V,this._tTouchID,this._isLeftMouse)},$V.check=function($V,$U,$r,$s){this._point.setTo($U,$r),$V.fromParentPoint(this._point),$U=this._point.x,$r=this._point.y;var $p=$V.scrollRect;if($p&&(this._rect.setTo($p.x,$p.y,$p.width,$p.height),!this._rect.contains($U,$r)))return!1;if(!this.disableMouseEvent){if($V.hitTestPrior&&!$V.mouseThrough&&!this.hitTest($V,$U,$r))return!1;for(var $c=$V._childs.length-1;-1<$c;$c--){var $R=$V._childs[$c];if(!$R.destroyed&&$R.mouseEnabled&&$R.visible&&this.check($R,$U,$r,$s))return!0}}var $T=!(!$V.hitTestPrior||$V.mouseThrough||this.disableMouseEvent)||this.hitTest($V,$U,$r);return $T?(this._target=$V,$s.call(this,$V)):$s===this.onMouseUp&&$V===this._stage&&(this._target=this._stage,$s.call(this,this._target)),$T},$V.hitTest=function($V,$U,$r){var $s=!1;if($V.scrollRect&&($U-=$V.scrollRect.x,$r-=$V.scrollRect.y),$V.hitArea instanceof laya.utils.HitArea)return $V.hitArea.isHit($U,$r);if(0<$V.width&&0<$V.height||$V.mouseThrough||$V.hitArea)if($V.mouseThrough)$s=$V.getGraphicBounds().contains($U,$r);else{var $p=this._rect;$V.hitArea?$p=$V.hitArea:$p.setTo(0,0,$V.width,$V.height),$s=$p.contains($U,$r)}return $s},$V.runEvent=function(){var $V=this._eventList.length;if($V){var $U=this;$U.mouseEventTime=$j.now();var $r,$s=0,$p=0,$c=0;try{for(;$s<$V;){var $R=this._eventList[$s];switch("mousemove"!==$R.type&&(this._prePoint.x=this._prePoint.y=-1e6),$R.type){case"mousedown":this._touchIDs[0]=this._id++,$b._isTouchRespond?$b._isTouchRespond=!1:($U._isLeftMouse=0===$R.button,$U.initEvent($R),$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseDown));break;case"mouseup":$U._isLeftMouse=0===$R.button,$U.initEvent($R),$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$R.clientX)+Math.abs(this._prePoint.y-$R.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$R.clientX,this._prePoint.y=$R.clientY,$U.initEvent($R),$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseMove));break;case"touchstart":$b._isTouchRespond=!0,$U._isLeftMouse=!0;var $T=$R.changedTouches;for($p=0,$c=$T.length;$p<$c;$p++)$r=$T[$p],($b.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$r.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$r.identifier]=this._id++,$U.initEvent($r,$R),$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseDown));break;case"touchend":case"touchcancel":$b._isTouchRespond=!0,$U._isLeftMouse=!0;var $N=$R.changedTouches;for($p=0,$c=$N.length;$p<$c;$p++)if($r=$N[$p],$b.multiTouchEnabled||$r.identifier==this._curTouchID){this._curTouchID=NaN,$U.initEvent($r,$R);$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseUp)||$U.onMouseUp(null)}break;case"touchmove":var $t=$R.changedTouches;for($p=0,$c=$t.length;$p<$c;$p++)$r=$t[$p],($b.multiTouchEnabled||$r.identifier==this._curTouchID)&&($U.initEvent($r,$R),$U.check($U._stage,$U.mouseX,$U.mouseY,$U.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$U.checkMouseWheel($R);break;case"mouseout":$h.I.stageMouseOut();break;case"mouseover":$U._stage.event("mouseover",$U._event.setTo("mouseover",$U._stage,$U._stage))}$s++}}catch($V){throw this._eventList.length=0,$V}this._eventList.length=0}},$b.enabled=!0,$b.multiTouchEnabled=!0,$b._isTouchRespond=!1,$b._isFirstTouch=!0,$N($b,["instance",function(){return this.instance=new $b}]),$b}()),$h=function(){function $q(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $c}$u($q,"laya.events.TouchManager");var $V=$q.prototype;return $V._clearTempArrs=function(){$q._oldArr.length=0,$q._newArr.length=0,$q._tEleArr.length=0},$V.getTouchFromArr=function($V,$U){var $r,$s,$p=0;for($r=$U.length,$p=0;$p<$r;$p++)if(($s=$U[$p]).id==$V)return $s;return null},$V.removeTouchFromArr=function($V,$U){var $r=0;for($r=$U.length-1;0<=$r;$r--)$U[$r].id==$V&&$U.splice($r,1)},$V.createTouchO=function($V,$U){var $r;return($r=$X.getItem("TouchData")||{}).id=$U,$r.tar=$V,$r},$V.onMouseDown=function($V,$U,$r){var $s,$p,$c,$R;(void 0===$r&&($r=!1),this.enable)&&($s=this.getTouchFromArr($U,this.preOvers),$c=this.getEles($V,null,$q._tEleArr),$s?$s.tar=$V:($p=this.createTouchO($V,$U),this.preOvers.push($p)),$j.onMobile&&this.sendEvents($c,"mouseover",$U),$R=$r?this.preDowns:this.preRightDowns,($s=this.getTouchFromArr($U,$R))?$s.tar=$V:($p=this.createTouchO($V,$U),$R.push($p)),this.sendEvents($c,$r?"mousedown":"rightmousedown",$U),this._clearTempArrs())},$V.sendEvents=function($V,$U,$r){void 0===$r&&($r=0);var $s,$p,$c,$R=0;for($s=$V.length,this._event._stoped=!1,$p=$V[0],$R=0;$R<$s;$R++){if(($c=$V[$R]).destroyed)return;if($c.event($U,this._event.setTo($U,$c,$p)),this._event._stoped)break}},$V.getEles=function($V,$U,$r){for($r?$r.length=0:$r=[];$V&&$V!=$U;)$r.push($V),$V=$V.parent;return $r},$V.checkMouseOutAndOverOfMove=function($V,$U,$r){if(void 0===$r&&($r=0),$U!=$V){var $s,$p,$c=0,$R=0;if($U.contains($V))$p=this.getEles($V,$U,$q._tEleArr),this.sendEvents($p,"mouseover",$r);else if($V.contains($U))$p=this.getEles($U,$V,$q._tEleArr),this.sendEvents($p,"mouseout",$r);else{var $T,$N;($p=$q._tEleArr).length=0,$T=this.getEles($U,null,$q._oldArr),$N=this.getEles($V,null,$q._newArr),$R=$T.length;var $t=0;for($c=0;$c<$R;$c++){if($s=$T[$c],0<=($t=$N.indexOf($s))){$N.splice($t,$N.length-$t);break}$p.push($s)}0<$p.length&&this.sendEvents($p,"mouseout",$r),0<$N.length&&this.sendEvents($N,"mouseover",$r)}}},$V.onMouseMove=function($V,$U){var $r,$s;this.enable&&(($r=this.getTouchFromArr($U,this.preOvers))?(this.checkMouseOutAndOverOfMove($V,$r.tar),$r.tar=$V,$s=this.getEles($V,null,$q._tEleArr)):($s=this.getEles($V,null,$q._tEleArr),this.sendEvents($s,"mouseover",$U),this.preOvers.push(this.createTouchO($V,$U))),this.sendEvents($s,"mousemove",$U),this._clearTempArrs())},$V.getLastOvers=function(){return($q._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$q._tEleArr):($q._tEleArr.push($y.stage),$q._tEleArr)},$V.stageMouseOut=function(){var $V;$V=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($V,"mouseout",0)},$V.onMouseUp=function($V,$U,$r){if(void 0===$r&&($r=!1),this.enable){var $s,$p,$c,$R,$T,$N,$t=0,$b=0,$S=$j.onMobile;if($p=this.getEles($V,null,$q._tEleArr),this.sendEvents($p,$r?"mouseup":"rightmouseup",$U),$N=$r?this.preDowns:this.preRightDowns,$s=this.getTouchFromArr($U,$N)){var $_,$G=$j.now();if($_=$G-this._lastClickTime<300,this._lastClickTime=$G,$V==$s.tar)$T=$p;else for($c=this.getEles($s.tar,null,$q._oldArr),($T=$q._newArr).length=0,$b=$c.length,$t=0;$t<$b;$t++)$R=$c[$t],0<=$p.indexOf($R)&&$T.push($R);0<$T.length&&this.sendEvents($T,$r?"click":"rightclick",$U),$r&&$_&&this.sendEvents($T,"doubleclick",$U),this.removeTouchFromArr($U,$N),$s.tar=null,$X.recover("TouchData",$s)}else;($s=this.getTouchFromArr($U,this.preOvers))&&$S&&(($T=this.getEles($s.tar,null,$T))&&0<$T.length&&this.sendEvents($T,"mouseout",$U),this.removeTouchFromArr($U,this.preOvers),$s.tar=null,$X.recover("TouchData",$s)),this._clearTempArrs()}},$q._oldArr=[],$q._newArr=[],$q._tEleArr=[],$N($q,["I",function(){return this.I=new $q}]),$q}(),$l=function(){function $V(){this._action=null}$u($V,"laya.filters.Filter");var $U=$V.prototype;return $y.imps($U,{"laya.filters.IFilter":!0}),$U.callNative=function($V){},$b(0,$U,"type",function(){return-1}),$b(0,$U,"action",function(){return this._action}),$V.BLUR=16,$V.COLOR=32,$V.GLOW=8,$V._filterStart=null,$V._filterEnd=null,$V._EndTarget=null,$V._recycleScope=null,$V._filter=null,$V._useSrc=null,$V._endSrc=null,$V._useOut=null,$V._endOut=null,$V}(),$O=function(){function $V(){this.data=null}$u($V,"laya.filters.ColorFilterAction");var $U=$V.prototype;return $y.imps($U,{"laya.filters.IFilterAction":!0}),$U.apply=function($V){var $U=$V.ctx.ctx,$r=$V.ctx.ctx.canvas;if(0==$r.width||0==$r.height)return $r;for(var $s,$p=$U.getImageData(0,0,$r.width,$r.height),$c=$p.data,$R=0,$T=$c.length;$R<$T;$R+=4)$s=this.getColor($c[$R],$c[$R+1],$c[$R+2],$c[$R+3]),0!=$c[$R+3]&&($c[$R]=$s[0],$c[$R+1]=$s[1],$c[$R+2]=$s[2],$c[$R+3]=$s[3]);return $U.putImageData($p,0,0),$V},$U.getColor=function($V,$U,$r,$s){var $p=[];if(this.data._mat&&this.data._alpha){var $c=this.data._mat,$R=this.data._alpha;$p[0]=$c[0]*$V+$c[1]*$U+$c[2]*$r+$c[3]*$s+$R[0],$p[1]=$c[4]*$V+$c[5]*$U+$c[6]*$r+$c[7]*$s+$R[1],$p[2]=$c[8]*$V+$c[9]*$U+$c[10]*$r+$c[11]*$s+$R[2],$p[3]=$c[12]*$V+$c[13]*$U+$c[14]*$r+$c[15]*$s+$R[3]}return $p},$V}(),$L=(function(){function $V(){}$u($V,"laya.maths.Arith"),$V.formatR=function($V){return $V>Math.PI&&($V-=2*Math.PI),$V<-Math.PI&&($V+=2*Math.PI),$V},$V.isPOT=function($V,$U){return 0<$V&&0==($V&$V-1)&&0<$U&&0==($U&$U-1)},$V.setMatToArray=function($V,$U){$V.a,$V.b,$V.c,$V.d,$V.tx,$V.ty,$U[0]=$V.a,$U[1]=$V.b,$U[4]=$V.c,$U[5]=$V.d,$U[12]=$V.tx,$U[13]=$V.ty}}(),function(){function $V(){this._controlPoints=[new $D,new $D,new $D],this._calFun=this.getPoint2}$u($V,"laya.maths.Bezier");var $U=$V.prototype;return $U._switchPoint=function($V,$U){var $r=this._controlPoints.shift();$r.setTo($V,$U),this._controlPoints.push($r)},$U.getPoint2=function($V,$U){var $r=this._controlPoints[0],$s=this._controlPoints[1],$p=this._controlPoints[2],$c=Math.pow(1-$V,2)*$r.x+2*$V*(1-$V)*$s.x+Math.pow($V,2)*$p.x,$R=Math.pow(1-$V,2)*$r.y+2*$V*(1-$V)*$s.y+Math.pow($V,2)*$p.y;$U.push($c,$R)},$U.getPoint3=function($V,$U){var $r=this._controlPoints[0],$s=this._controlPoints[1],$p=this._controlPoints[2],$c=this._controlPoints[3],$R=Math.pow(1-$V,3)*$r.x+3*$s.x*$V*(1-$V)*(1-$V)+3*$p.x*$V*$V*(1-$V)+$c.x*Math.pow($V,3),$T=Math.pow(1-$V,3)*$r.y+3*$s.y*$V*(1-$V)*(1-$V)+3*$p.y*$V*$V*(1-$V)+$c.y*Math.pow($V,3);$U.push($R,$T)},$U.insertPoints=function($V,$U){var $r,$s=NaN;for($r=1/($V=0<$V?$V:5),$s=0;$s<=1;$s+=$r)this._calFun($s,$U)},$U.getBezierPoints=function($V,$U,$r){void 0===$U&&($U=5),void 0===$r&&($r=2);var $s,$p,$c=0;if(($s=$V.length)<2*($r+1))return[];switch($p=[],$r){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$r;)this._controlPoints.push(new $D);for($c=0;$c<2*$r;$c+=2)this._switchPoint($V[$c],$V[$c+1]);for($c=2*$r;$c<$s;$c+=2)this._switchPoint($V[$c],$V[$c+1]),$c/2%$r==0&&this.insertPoints($U,$p);return $p},$N($V,["I",function(){return this.I=new $V}]),$V}()),$d=function(){function $t(){}return $u($t,"laya.maths.GrahamScan"),$t.multiply=function($V,$U,$r){return($V.x-$r.x)*($U.y-$r.y)-($U.x-$r.x)*($V.y-$r.y)},$t.dis=function($V,$U){return($V.x-$U.x)*($V.x-$U.x)+($V.y-$U.y)*($V.y-$U.y)},$t._getPoints=function($V,$U,$r){for(void 0===$U&&($U=!1),$t._mPointList||($t._mPointList=[]);$t._mPointList.length<$V;)$t._mPointList.push(new $D);return $r||($r=[]),$r.length=0,$U?$t.getFrom($r,$t._mPointList,$V):$t.getFromR($r,$t._mPointList,$V),$r},$t.getFrom=function($V,$U,$r){var $s=0;for($s=0;$s<$r;$s++)$V.push($U[$s]);return $V},$t.getFromR=function($V,$U,$r){var $s=0;for($s=0;$s<$r;$s++)$V.push($U.pop());return $V},$t.pListToPointList=function($V,$U){void 0===$U&&($U=!1);var $r=0,$s=$V.length/2,$p=$t._getPoints($s,$U,$t._tempPointList);for($r=0;$r<$s;$r++)$p[$r].setTo($V[$r+$r],$V[$r+$r+1]);return $p},$t.pointListToPlist=function($V){var $U,$r=0,$s=$V.length,$p=$t._temPList;for($r=$p.length=0;$r<$s;$r++)$U=$V[$r],$p.push($U.x,$U.y);return $p},$t.scanPList=function($V){return $v.copyArray($V,$t.pointListToPlist($t.scan($t.pListToPointList($V,!0))))},$t.scan=function($V){var $U,$r,$s,$p=0,$c=0,$R=0,$T=$V.length,$N={};for(($r=$t._temArr).length=0,$p=($T=$V.length)-1;0<=$p;$p--)$s=($U=$V[$p]).x+"_"+$U.y,$N.hasOwnProperty($s)||($N[$s]=!0,$r.push($U));for($T=$r.length,$v.copyArray($V,$r),$p=1;$p<$T;$p++)($V[$p].y<$V[$R].y||$V[$p].y==$V[$R].y&&$V[$p].x<$V[$R].x)&&($R=$p);for($U=$V[0],$V[0]=$V[$R],$V[$R]=$U,$p=1;$p<$T-1;$p++){for($c=($R=$p)+1;$c<$T;$c++)(0<$t.multiply($V[$c],$V[$R],$V[0])||0==$t.multiply($V[$c],$V[$R],$V[0])&&$t.dis($V[0],$V[$c])<$t.dis($V[0],$V[$R]))&&($R=$c);$U=$V[$p],$V[$p]=$V[$R],$V[$R]=$U}if(($r=$t._temArr).length=0,$V.length<3)return $v.copyArray($r,$V);for($r.push($V[0],$V[1],$V[2]),$p=3;$p<$T;$p++){for(;2<=$r.length&&0<=$t.multiply($V[$p],$r[$r.length-1],$r[$r.length-2]);)$r.pop();$V[$p]&&$r.push($V[$p])}return $r},$t._mPointList=null,$t._tempPointList=[],$t._temPList=[],$t._temArr=[],$t}(),$k=function(){function $p(){}return $u($p,"laya.maths.MathUtil"),$p.subtractVector3=function($V,$U,$r){$r[0]=$V[0]-$U[0],$r[1]=$V[1]-$U[1],$r[2]=$V[2]-$U[2]},$p.lerp=function($V,$U,$r){return $V*(1-$r)+$U*$r},$p.scaleVector3=function($V,$U,$r){$r[0]=$V[0]*$U,$r[1]=$V[1]*$U,$r[2]=$V[2]*$U},$p.lerpVector3=function($V,$U,$r,$s){var $p=$V[0],$c=$V[1],$R=$V[2];$s[0]=$p+$r*($U[0]-$p),$s[1]=$c+$r*($U[1]-$c),$s[2]=$R+$r*($U[2]-$R)},$p.lerpVector4=function($V,$U,$r,$s){var $p=$V[0],$c=$V[1],$R=$V[2],$T=$V[3];$s[0]=$p+$r*($U[0]-$p),$s[1]=$c+$r*($U[1]-$c),$s[2]=$R+$r*($U[2]-$R),$s[3]=$T+$r*($U[3]-$T)},$p.slerpQuaternionArray=function($V,$U,$r,$s,$p,$c,$R){var $T,$N,$t,$b,$S,$_=$V[$U+0],$G=$V[$U+1],$q=$V[$U+2],$u=$V[$U+3],$h=$r[$s+0],$l=$r[$s+1],$W=$r[$s+2],$O=$r[$s+3];return($N=$_*$h+$G*$l+$q*$W+$u*$O)<0&&($N=-$N,$h=-$h,$l=-$l,$W=-$W,$O=-$O),$S=1e-6<1-$N?($T=Math.acos($N),$t=Math.sin($T),$b=Math.sin((1-$p)*$T)/$t,Math.sin($p*$T)/$t):($b=1-$p,$p),$c[$R+0]=$b*$_+$S*$h,$c[$R+1]=$b*$G+$S*$l,$c[$R+2]=$b*$q+$S*$W,$c[$R+3]=$b*$u+$S*$O,$c},$p.getRotation=function($V,$U,$r,$s){return Math.atan2($s-$U,$r-$V)/Math.PI*180},$p.sortBigFirst=function($V,$U){return $V==$U?0:$V<$U?1:-1},$p.sortSmallFirst=function($V,$U){return $V==$U?0:$V<$U?-1:1},$p.sortNumBigFirst=function($V,$U){return parseFloat($U)-parseFloat($V)},$p.sortNumSmallFirst=function($V,$U){return parseFloat($V)-parseFloat($U)},$p.sortByKey=function($r,$V,$U){var $s;return void 0===$V&&($V=!1),void 0===$U&&($U=!0),$s=$V?$U?$p.sortNumBigFirst:$p.sortBigFirst:$U?$p.sortNumSmallFirst:$p.sortSmallFirst,function($V,$U){return $s($V[$r],$U[$r])}},$p}(),$z=function(){function $r($V,$U,$r,$s,$p,$c){this.inPool=!1,this.bTransform=!1,void 0===$V&&($V=1),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=1),void 0===$p&&($p=0),void 0===$c&&($c=0),this.a=$V,this.b=$U,this.c=$r,this.d=$s,this.tx=$p,this.ty=$c,this._checkTransform()}$u($r,"laya.maths.Matrix");var $V=$r.prototype;return $V.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$V._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$V.setTranslate=function($V,$U){return this.tx=$V,this.ty=$U,this},$V.translate=function($V,$U){return this.tx+=$V,this.ty+=$U,this},$V.scale=function($V,$U){this.a*=$V,this.d*=$U,this.c*=$V,this.b*=$U,this.tx*=$V,this.ty*=$U,this.bTransform=!0},$V.rotate=function($V){var $U=Math.cos($V),$r=Math.sin($V),$s=this.a,$p=this.c,$c=this.tx;this.a=$s*$U-this.b*$r,this.b=$s*$r+this.b*$U,this.c=$p*$U-this.d*$r,this.d=$p*$r+this.d*$U,this.tx=$c*$U-this.ty*$r,this.ty=$c*$r+this.ty*$U,this.bTransform=!0},$V.skew=function($V,$U){var $r=Math.tan($V),$s=Math.tan($U),$p=this.a,$c=this.b;return this.a+=$s*this.c,this.b+=$s*this.d,this.c+=$r*$p,this.d+=$r*$c,this},$V.invertTransformPoint=function($V){var $U=this.a,$r=this.b,$s=this.c,$p=this.d,$c=this.tx,$R=$U*$p-$r*$s,$T=$p/$R,$N=-$r/$R,$t=-$s/$R,$b=$U/$R,$S=($s*this.ty-$p*$c)/$R,$_=-($U*this.ty-$r*$c)/$R;return $V.setTo($T*$V.x+$t*$V.y+$S,$N*$V.x+$b*$V.y+$_)},$V.transformPoint=function($V){return $V.setTo(this.a*$V.x+this.c*$V.y+this.tx,this.b*$V.x+this.d*$V.y+this.ty)},$V.transformPointN=function($V){return $V.setTo(this.a*$V.x+this.c*$V.y,this.b*$V.x+this.d*$V.y)},$V.transformPointArray=function($V,$U){for(var $r=$V.length,$s=0;$s<$r;$s+=2){var $p=$V[$s],$c=$V[$s+1];$U[$s]=this.a*$p+this.c*$c+this.tx,$U[$s+1]=this.b*$p+this.d*$c+this.ty}return $U},$V.transformPointArrayScale=function($V,$U){for(var $r=$V.length,$s=0;$s<$r;$s+=2){var $p=$V[$s],$c=$V[$s+1];$U[$s]=this.a*$p+this.c*$c,$U[$s+1]=this.b*$p+this.d*$c}return $U},$V.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$V.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$V.invert=function(){var $V=this.a,$U=this.b,$r=this.c,$s=this.d,$p=this.tx,$c=$V*$s-$U*$r;return this.a=$s/$c,this.b=-$U/$c,this.c=-$r/$c,this.d=$V/$c,this.tx=($r*this.ty-$s*$p)/$c,this.ty=-($V*this.ty-$U*$p)/$c,this},$V.setTo=function($V,$U,$r,$s,$p,$c){return this.a=$V,this.b=$U,this.c=$r,this.d=$s,this.tx=$p,this.ty=$c,this},$V.concat=function($V){var $U=this.a,$r=this.c,$s=this.tx;return this.a=$U*$V.a+this.b*$V.c,this.b=$U*$V.b+this.b*$V.d,this.c=$r*$V.a+this.d*$V.c,this.d=$r*$V.b+this.d*$V.d,this.tx=$s*$V.a+this.ty*$V.c+$V.tx,this.ty=$s*$V.b+this.ty*$V.d+$V.ty,this},$V.scaleEx=function($V,$U){var $r=this.a,$s=this.b,$p=this.c,$c=this.d;0!==$s||0!==$p?(this.a=$V*$r,this.b=$V*$s,this.c=$U*$p):(this.a=$V*$r,this.b=0*$c,this.c=0*$r),this.d=$U*$c,this.bTransform=!0},$V.rotateEx=function($V){var $U=Math.cos($V),$r=Math.sin($V),$s=this.a,$p=this.b,$c=this.c,$R=this.d;0!==$p||0!==$c?(this.a=$U*$s+$r*$c,this.b=$U*$p+$r*$R,this.c=-$r*$s+$U*$c,this.d=-$r*$p+$U*$R):(this.a=$U*$s,this.b=$r*$R,this.c=-$r*$s,this.d=$U*$R),this.bTransform=!0},$V.clone=function(){var $V=$r.create();return $V.a=this.a,$V.b=this.b,$V.c=this.c,$V.d=this.d,$V.tx=this.tx,$V.ty=this.ty,$V.bTransform=this.bTransform,$V},$V.copyTo=function($V){return $V.a=this.a,$V.b=this.b,$V.c=this.c,$V.d=this.d,$V.tx=this.tx,$V.ty=this.ty,$V.bTransform=this.bTransform,$V},$V.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$V.destroy=function(){if(!this.inPool){var $V=$r._cache;this.inPool=!0,$V._length||($V._length=0),($V[$V._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$r.mul=function($V,$U,$r){var $s=$V.a,$p=$V.b,$c=$V.c,$R=$V.d,$T=$V.tx,$N=$V.ty,$t=$U.a,$b=$U.b,$S=$U.c,$_=$U.d,$G=$U.tx,$q=$U.ty;return 0!==$b||0!==$S?($r.a=$s*$t+$p*$S,$r.b=$s*$b+$p*$_,$r.c=$c*$t+$R*$S,$r.d=$c*$b+$R*$_,$r.tx=$t*$T+$S*$N+$G,$r.ty=$b*$T+$_*$N+$q):($r.a=$s*$t,$r.b=$p*$_,$r.c=$c*$t,$r.d=$R*$_,$r.tx=$t*$T+$G,$r.ty=$_*$N+$q),$r},$r.mul16=function($V,$U,$r){var $s=$V.a,$p=$V.b,$c=$V.c,$R=$V.d,$T=$V.tx,$N=$V.ty,$t=$U.a,$b=$U.b,$S=$U.c,$_=$U.d,$G=$U.tx,$q=$U.ty;return 0!==$b||0!==$S?($r[0]=$s*$t+$p*$S,$r[1]=$s*$b+$p*$_,$r[4]=$c*$t+$R*$S,$r[5]=$c*$b+$R*$_,$r[12]=$t*$T+$S*$N+$G,$r[13]=$b*$T+$_*$N+$q):($r[0]=$s*$t,$r[1]=$p*$_,$r[4]=$c*$t,$r[5]=$R*$_,$r[12]=$t*$T+$G,$r[13]=$_*$N+$q),$r},$r.mulPre=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=$V.a,$t=$V.b,$b=$V.c,$S=$V.d,$_=$V.tx,$G=$V.ty;return 0!==$r||0!==$s?($T.a=$N*$U+$t*$s,$T.b=$N*$r+$t*$p,$T.c=$b*$U+$S*$s,$T.d=$b*$r+$S*$p,$T.tx=$U*$_+$s*$G+$c,$T.ty=$r*$_+$p*$G+$R):($T.a=$N*$U,$T.b=$t*$p,$T.c=$b*$U,$T.d=$S*$p,$T.tx=$U*$_+$c,$T.ty=$p*$G+$R),$T},$r.mulPos=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=$V.a,$t=$V.b,$b=$V.c,$S=$V.d,$_=$V.tx,$G=$V.ty;return 0!==$t||0!==$b?($T.a=$U*$N+$r*$b,$T.b=$U*$t+$r*$S,$T.c=$s*$N+$p*$b,$T.d=$s*$t+$p*$S,$T.tx=$N*$c+$b*$R+$_,$T.ty=$t*$c+$S*$R+$G):($T.a=$U*$N,$T.b=$r*$S,$T.c=$s*$N,$T.d=$p*$S,$T.tx=$N*$c+$_,$T.ty=$S*$R+$G),$T},$r.preMul=function($V,$U,$r){var $s=$V.a,$p=$V.b,$c=$V.c,$R=$V.d,$T=$U.a,$N=$U.b,$t=$U.c,$b=$U.d,$S=$U.tx,$_=$U.ty;return $r.a=$T*$s,$r.b=$r.c=0,$r.d=$b*$R,$r.tx=$S*$s+$V.tx,$r.ty=$_*$R+$V.ty,0===$N&&0===$t&&0===$p&&0===$c||($r.a+=$N*$c,$r.d+=$t*$p,$r.b+=$T*$p+$N*$R,$r.c+=$t*$s+$b*$c,$r.tx+=$_*$c,$r.ty+=$S*$p),$r},$r.preMulXY=function($V,$U,$r,$s){var $p=$V.a,$c=$V.b,$R=$V.c,$T=$V.d;return $s.a=$p,$s.b=$c,$s.c=$R,$s.d=$T,$s.tx=$U*$p+$V.tx+$r*$R,$s.ty=$r*$T+$V.ty+$U*$c,$s},$r.create=function(){var $V=$r._cache,$U=$V._length?$V[--$V._length]:new $r;return $U.inPool=!1,$U},$r.EMPTY=new $r,$r.TEMP=new $r,$r._cache=[],$r}(),$D=function(){function $V($V,$U){void 0===$V&&($V=0),void 0===$U&&($U=0),this.x=$V,this.y=$U}$u($V,"laya.maths.Point");var $U=$V.prototype;return $U.setTo=function($V,$U){return this.x=$V,this.y=$U,this},$U.distance=function($V,$U){return Math.sqrt((this.x-$V)*(this.x-$V)+(this.y-$U)*(this.y-$U))},$U.toString=function(){return this.x+","+this.y},$U.normalize=function(){var $V=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$V){var $U=1/$V;this.x*=$U,this.y*=$U}},$V.TEMP=new $V,$V.EMPTY=new $V,$V}(),$n=function(){function $t($V,$U,$r,$s){void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),this.x=$V,this.y=$U,this.width=$r,this.height=$s}$u($t,"laya.maths.Rectangle");var $V=$t.prototype;return $V.setTo=function($V,$U,$r,$s){return this.x=$V,this.y=$U,this.width=$r,this.height=$s,this},$V.copyFrom=function($V){return this.x=$V.x,this.y=$V.y,this.width=$V.width,this.height=$V.height,this},$V.contains=function($V,$U){return!(this.width<=0||this.height<=0)&&($V>=this.x&&$V<this.right&&$U>=this.y&&$U<this.bottom)},$V.intersects=function($V){return!($V.x>this.x+this.width||$V.x+$V.width<this.x||$V.y>this.y+this.height||$V.y+$V.height<this.y)},$V.intersection=function($V,$U){return this.intersects($V)?($U||($U=new $t),$U.x=Math.max(this.x,$V.x),$U.y=Math.max(this.y,$V.y),$U.width=Math.min(this.right,$V.right)-$U.x,$U.height=Math.min(this.bottom,$V.bottom)-$U.y,$U):null},$V.union=function($V,$U){return $U||($U=new $t),this.clone($U),$V.width<=0||$V.height<=0?$U:($U.addPoint($V.x,$V.y),$U.addPoint($V.right,$V.bottom),this)},$V.clone=function($V){return $V||($V=new $t),$V.x=this.x,$V.y=this.y,$V.width=this.width,$V.height=this.height,$V},$V.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$V.equals=function($V){return!(!$V||$V.x!==this.x||$V.y!==this.y||$V.width!==this.width||$V.height!==this.height)},$V.addPoint=function($V,$U){return this.x>$V&&(this.width+=this.x-$V,this.x=$V),this.y>$U&&(this.height+=this.y-$U,this.y=$U),this.width<$V-this.x&&(this.width=$V-this.x),this.height<$U-this.y&&(this.height=$U-this.y),this},$V._getBoundPoints=function(){var $V=$t._temB;return($V.length=0)==this.width||0==this.height||$V.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$V},$V.isEmpty=function(){return this.width<=0||this.height<=0},$b(0,$V,"right",function(){return this.x+this.width}),$b(0,$V,"bottom",function(){return this.y+this.height}),$t._getBoundPointS=function($V,$U,$r,$s){var $p=$t._temA;return($p.length=0)==$r||0==$s||$p.push($V,$U,$V+$r,$U,$V,$U+$s,$V+$r,$U+$s),$p},$t._getWrapRec=function($V,$U){if(!$V||$V.length<1)return $U?$U.setTo(0,0,0,0):$t.TEMP.setTo(0,0,0,0);$U=$U||new $t;var $r,$s,$p,$c,$R,$T=$V.length,$N=$D.TEMP;for($p=$R=-($s=$c=99999),$r=0;$r<$T;$r+=2)$N.x=$V[$r],$N.y=$V[$r+1],$s=$s<$N.x?$s:$N.x,$c=$c<$N.y?$c:$N.y,$p=$p>$N.x?$p:$N.x,$R=$R>$N.y?$R:$N.y;return $U.setTo($s,$c,$p-$s,$R-$c)},$t.EMPTY=new $t,$t.TEMP=new $t,$t._temB=[],$t._temA=[],$t}(),$H=function(){function $N(){}return $u($N,"laya.media.SoundManager"),$b(1,$N,"useAudioMusic",function(){return $N._useAudioMusic},function($V){$N._useAudioMusic=$V,$N._musicClass=$V?$rV:null}),$b(1,$N,"autoStopMusic",function(){return $N._autoStopMusic},function($V){$y.stage.off("blur",null,$N._stageOnBlur),$y.stage.off("focus",null,$N._stageOnFocus),$y.stage.off("visibilitychange",null,$N._visibilityChange),($N._autoStopMusic=$V)&&($y.stage.on("blur",null,$N._stageOnBlur),$y.stage.on("focus",null,$N._stageOnFocus),$y.stage.on("visibilitychange",null,$N._visibilityChange))}),$b(1,$N,"muted",function(){return $N._muted},function($V){$V!=$N._muted&&($V&&$N.stopAllSound(),$N.musicMuted=$V,$N._muted=$V)}),$b(1,$N,"musicMuted",function(){return $N._musicMuted},function($V){$V!=$N._musicMuted&&($V?($N._tMusic&&$N._musicChannel&&!$N._musicChannel.isStopped?$N._musicChannel.pause():$N._musicChannel=null,$N._musicMuted=$V):($N._musicMuted=$V,$N._tMusic&&$N._musicChannel&&$N._musicChannel.resume()))}),$b(1,$N,"soundMuted",function(){return $N._soundMuted},function($V){$N._soundMuted=$V}),$N.addChannel=function($V){0<=$N._channels.indexOf($V)||($N._channels.push($V),$N.autoReleaseSound&&0!=$N._notUsedCount&&$N._notUsedUrls[$V.url]&&(delete $N._notUsedUrls[$V.url],0==--$N._notUsedCount&&$y.timer.clear($N,$N.disposeSoundIfNotUsed)))},$N.removeChannel=function($V){var $U=$N._channels,$r=$U.indexOf($V);if(-1!=$r&&($U.splice($r,1),$N.autoReleaseSound)){var $s=$V.url,$p=$N.defaultIntervals[$s]||2e4;if(0<$p){var $c=!0;for($r=$U.length-1;0<=$r;$r--)if($U[$r].url==$s){$c=!1;break}$c&&($N._notUsedUrls[$s]=Date.now()+$p,0==$N._notUsedCount++&&$y.timer.loop(1e4,$N,$N.disposeSoundIfNotUsed))}}},$N.disposeSoundIfNotUsed=function(){var $V=$N._notUsedUrls;if(0!=$N._notUsedCount){var $U=Date.now();for(var $r in $V)$U>=$V[$r]&&(delete $V[$r],--$N._notUsedCount,$N.destroySound($r));if(0!=$N._notUsedCount)return}$y.timer.clear($N,$N.disposeSoundIfNotUsed)},$N._visibilityChange=function(){$y.stage.isVisibility?$N._stageOnFocus():$N._stageOnBlur()},$N._stageOnBlur=function(){$N._isActive=!1,$N._musicChannel&&($N._musicChannel.isStopped||($N._blurPaused=!0,$N._musicChannel.pause())),$N.stopAllSound(),$y.stage.once("mousedown",null,$N._stageOnFocus)},$N._recoverWebAudio=function(){$cV.ctx&&"running"!=$cV.ctx.state&&$cV.ctx.resume&&$cV.ctx.resume()},$N._stageOnFocus=function(){if($N._isActive=!0,$N._recoverWebAudio(),$y.stage.off("mousedown",null,$N._stageOnFocus),$N._blurPaused){var $V=$N._musicChannel;$V&&$N._music&&$V.isStopped&&($N._blurPaused=!1,$N._music._disposed?$N.playMusic($V.url,$V.loops,$V.startHandler,$V.completeHandler,$V.startTime):$V.audioBuffer?$V.resume():$N._music.play($V.startTime,$V.loops,$V.startHandler,$V))}},$N.playSound=function($V,$U,$r,$s,$p,$c){if(void 0===$U&&($U=1),void 0===$c&&($c=0),!$V)return null;if($N._muted)return null;if($N._recoverWebAudio(),$V==$N._tMusic){if($N._musicMuted)return null}else{if(!$N._isActive)return null;if($N._soundMuted)return null}var $R,$T=$N._pool[$V];return $p||($p=$N._soundClass),$T||(($T=new $p).load($V),$N._pool[$V]=$T),($R=$T.play($c,$U,$r))?($V==$N._tMusic&&($N._music=$T,$N._isActive||($N._blurPaused=!0,$R.pause())),$R.url=$V,$R.volume=$V==$N._tMusic?$N.musicVolume:$N.soundVolume,$R.completeHandler=$s,$R):null},$N.destroySound=function($V){var $U=$N._pool[$V];$U&&(delete $N._pool[$V],$U.dispose())},$N.playMusic=function($V,$U,$r,$s,$p){return void 0===$U&&($U=0),void 0===$p&&($p=0),$N._tMusic=$V,$N._musicChannel&&$N._musicChannel.stop(),$N._musicChannel=$N.playSound($V,$U,$r,$s,null,$p)},$N.stopSound=function($V){for(var $U,$r=$N._channels.length-1;0<=$r;$r--)($U=$N._channels[$r]).url==$V&&$U.stop()},$N.stopAll=function(){$N._tMusic=null;var $V=0;for($V=$N._channels.length-1;0<=$V;$V--)$N._channels[$V].stop()},$N.stopAllSound=function(){var $V,$U=0;for($U=$N._channels.length-1;0<=$U;$U--)($V=$N._channels[$U]).url!=$N._tMusic&&$V.stop()},$N.stopMusic=function(){$N._musicChannel&&$N._musicChannel.stop(),$N._tMusic=null},$N.setSoundVolume=function($V,$U){if($U)$N._setVolume($U,$V);else{$N.soundVolume=$V;var $r,$s=0;for($s=$N._channels.length-1;0<=$s;$s--)($r=$N._channels[$s]).url!=$N._tMusic&&($r.volume=$V)}},$N.setMusicVolume=function($V){$N.musicVolume=$V,$N._setVolume($N._tMusic,$V)},$N._setVolume=function($V,$U){for(var $r,$s=$N._channels.length-1;0<=$s;$s--)($r=$N._channels[$s]).url==$V&&($r.volume=$U)},$N.musicVolume=1,$N.soundVolume=1,$N.playbackRate=1,$N._useAudioMusic=!0,$N._muted=!1,$N._soundMuted=!1,$N._musicMuted=!1,$N._tMusic=null,$N._musicChannel=null,$N._music=null,$N._channels=[],$N._autoStopMusic=!1,$N._blurPaused=!1,$N._isActive=!0,$N._soundClass=null,$N._musicClass=null,$N.autoReleaseSound=!0,$N._pool={},$N.defaultIntervals={},$N._notUsedUrls={},$N._notUsedCount=0,$N}(),$I=function(){var $V;function $r(){}return $u($r,"laya.net.LocalStorage"),$r.__init__=function(){$r._baseClass||($r._baseClass=$V).init(),$r.items=$r._baseClass.items,$r.support=$r._baseClass.support},$r.setItem=function($V,$U){$r._baseClass.setItem($V,$U)},$r.getItem=function($V){return $r._baseClass.getItem($V)},$r.setJSON=function($V,$U){$r._baseClass.setJSON($V,$U)},$r.getJSON=function($V){return $r._baseClass.getJSON($V)},$r.removeItem=function($V){$r._baseClass.removeItem($V)},$r.clear=function(){$r._baseClass.clear()},$r._baseClass=null,$r.items=null,$r.support=!1,$r.__init$=function(){$V=function(){function $r(){}return $u($r,""),$r.init=function(){try{$r.support=!0,$r.items=$R.localStorage,$r.setItem("laya","1"),$r.removeItem("laya")}catch($V){$r.support=!1}$r.support||console.log("LocalStorage is not supprot or browser is private mode.")},$r.setItem=function($V,$U){try{$r.support&&$r.items.setItem($V,$U)}catch($V){console.warn("set localStorage failed",$V)}},$r.getItem=function($V){return $r.support?$r.items.getItem($V):null},$r.setJSON=function($V,$U){try{$r.support&&$r.items.setItem($V,JSON.stringify($U))}catch($V){console.warn("set localStorage failed",$V)}},$r.getJSON=function($V){return JSON.parse($r.support?$r.items.getItem($V):null)},$r.removeItem=function($V){$r.support&&$r.items.removeItem($V)},$r.clear=function(){$r.support&&$r.items.clear()},$r.items=null,$r.support=!1,$r}()},$r}(),$E=(function(){function $s(){}$u($s,"laya.net.ResourceVersion"),$s.enable=function($V,$U,$r){void 0===$r&&($r=2),laya.net.ResourceVersion.type=$r,$y.loader.load($V,$W.create(null,$s.onManifestLoaded,[$U]),null,"json"),$K.customFormat=$s.addVersionPrefix},$s.onManifestLoaded=function($V,$U){$s.manifest=$U,$V.run(),$U||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$s.addVersionPrefix=function($V){return $s.manifest&&$s.manifest[$V]?2==$s.type?$s.manifest[$V]:$s.manifest[$V]+"/"+$V:$V},$s.FOLDER_VERSION=1,$s.FILENAME_VERSION=2,$s.manifest=null,$s.type=1}(),function(){function $V(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$u($V,"laya.net.TTFLoader");var $U=$V.prototype;return $U.load=function($V){var $U=(this._url=$V).split(".ttf")[0].split("/");this.fontName=$U[$U.length-1],$j.window.conch?this._loadConch():$j.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$U._loadConch=function(){this._http=new $RV,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$U._onHttpLoaded=function($V){$j.window.conch.setFontFaceFromBuffer(this.fontName,$V),this._clearHttp(),this._complete()},$U._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$U._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$U._complete=function(){$y.timer.clear(this,this._complete),$y.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$U._checkComplete=function(){$w.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$U._loadWithFontFace=function(){var $V=new $j.window.FontFace(this.fontName,"url('"+this._url+"')");$j.window.document.fonts.add($V);var $U=this;$V.loaded.then(function(){$U._complete()}),$V.load()},$U._createDiv=function(){this._div=$j.createElement("div"),this._div.innerHTML="laya";var $V=this._div.style;$V.fontFamily=this.fontName,$V.position="absolute",$V.left="-100px",$V.top="-100px",$j.document.body.appendChild(this._div)},$U._loadWithCSS=function(){var $V=this,$U=$j.createElement("style");$U.type="text/css",$j.document.body.appendChild($U),$U.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$w.measureText("LayaTTFFont",this._fontTxt).width;var $r=this;$U.onload=function(){$y.timer.once(1e4,$r,$V._complete)},$y.timer.loop(20,this,this._checkComplete),this._createDiv()},$V._testString="LayaTTFFont",$V}()),$K=function(){function $s($V){this._url=null,this._path=null,this._url=$s.formatURL($V),this._path=$s.getPath($V)}$u($s,"laya.net.URL");var $V=$s.prototype;return $b(0,$V,"path",function(){return this._path}),$b(0,$V,"url",function(){return this._url}),$s.formatURL=function($V,$U){if(!$V)return"null path";if(0<$V.indexOf(":"))return $V;null!=$s.customFormat&&($V=$s.customFormat($V,$U));var $r=$V.charAt(0);if("."===$r)return $s.formatRelativePath(($U||$s.basePath)+$V);if("~"===$r)return $s.rootPath+$V.substring(1);if("d"===$r){if(0===$V.indexOf("data:image"))return $V}else if("/"===$r)return $V;return($U||$s.basePath)+$V},$s.formatRelativePath=function($V){for(var $U=$V.split("/"),$r=0,$s=$U.length;$r<$s;$r++)".."==$U[$r]&&($U.splice($r-1,2),$r-=2);return $U.join("/")},$s.isAbsolute=function($V){return 0<$V.indexOf(":")||"/"==$V.charAt(0)},$s.getPath=function($V){var $U=$V.lastIndexOf("/");return 0<$U?$V.substr(0,$U+1):""},$s.getFileName=function($V){var $U=$V.lastIndexOf("/");return 0<$U?$V.substr($U+1):$V},$s.version={},$s.basePath="",$s.rootPath="",$s.customFormat=function($V){var $U=$s.version[$V];return!$m.isConchApp&&$U&&($V+="?v="+$U),$V},$s}(),$m=function(){function $p($V,$U){this._timeId=0;var $r=$p._mainCanvas.source.style;$r.position="absolute",$r.top=$r.left="0px",$r.background="#000000",$p._mainCanvas.source.id="layaCanvas";var $s=laya.renders.Render.isWebGL;$p._mainCanvas.source.width=$V,$p._mainCanvas.source.height=$U,$s&&$p.WebGL.init($p._mainCanvas,$V,$U),$j.container.appendChild($p._mainCanvas.source),($p._context=new $a($V,$U,$s?null:$p._mainCanvas)).ctx.setIsMainContext(),$j.window.requestAnimationFrame(function $V($U){$j.window.requestAnimationFrame($V);$y.stage._loop()}),$y.stage.on("visibilitychange",this,this._onVisibilitychange)}$u($p,"laya.renders.Render");var $V=$p.prototype;return $V._onVisibilitychange=function(){$y.stage.isVisibility?0!=this._timeId&&$j.window.clearInterval(this._timeId):this._timeId=$j.window.setInterval(this._enterFrame,1e3)},$V._enterFrame=function($V){$y.stage._loop()},$b(1,$p,"context",function(){return $p._context}),$b(1,$p,"canvas",function(){return $p._mainCanvas.source}),$p._context=null,$p._mainCanvas=null,$p.WebGL=null,$p.isConchNode=!1,$p.isConchApp=!1,$p.isConchWebGL=!1,$p.isWebGL=!1,$p.is3DMode=!1,$p.optimizeTextureMemory=function($V,$U){return!0},$p.__init$=function(){$R.ConchRenderType=$R.ConchRenderType||1,$R.ConchRenderType|=$R.conch?4:0,$p.isConchNode=5==(5&$R.ConchRenderType),$p.isConchApp=4==(4&$R.ConchRenderType),$p.isConchWebGL=6==$R.ConchRenderType},$p}(),$a=function(){function $R($V,$U,$r){this.x=0,this.y=0,this._drawTexture=function($V,$U,$r){$r[0].loaded&&this.ctx.drawTexture($r[0],$r[1],$r[2],$r[3],$r[4],$V,$U)},this._fillTexture=function($V,$U,$r){$r[0].loaded&&this.ctx.fillTexture($r[0],$r[1]+$V,$r[2]+$U,$r[3],$r[4],$r[5],$r[6],$r[7])},this._drawTextureWithTransform=function($V,$U,$r){$r[0].loaded&&this.ctx.drawTextureWithTransform($r[0],$r[1],$r[2],$r[3],$r[4],$r[5],$V,$U,$r[6])},this._fillQuadrangle=function($V,$U,$r){this.ctx.fillQuadrangle($r[0],$r[1],$r[2],$r[3],$r[4])},this._drawRect=function($V,$U,$r){var $s=this.ctx;null!=$r[4]&&($s.fillStyle=$r[4],$s.fillRect($V+$r[0],$U+$r[1],$r[2],$r[3],null)),null!=$r[5]&&($s.strokeStyle=$r[5],$s.lineWidth=$r[6],$s.strokeRect($V+$r[0],$U+$r[1],$r[2],$r[3],$r[6]))},this._drawPie=function($V,$U,$r){var $s=this.ctx;$m.isWebGL&&$s.setPathId($r[8]),$s.beginPath(),$m.isWebGL?($s.movePath($r[0]+$V,$r[1]+$U),$s.moveTo(0,0)):$s.moveTo($V+$r[0],$U+$r[1]),$s.arc($V+$r[0],$U+$r[1],$r[2],$r[3],$r[4]),$s.closePath(),this._fillAndStroke($r[5],$r[6],$r[7],!0)},this._clipRect=function($V,$U,$r){this.ctx.clipRect($V+$r[0],$U+$r[1],$r[2],$r[3])},this._fillRect=function($V,$U,$r){this.ctx.fillRect($V+$r[0],$U+$r[1],$r[2],$r[3],$r[4])},this._drawCircle=function($V,$U,$r){var $s=this.ctx;$m.isWebGL&&$s.setPathId($r[6]),$e.drawCall++,$s.beginPath(),$m.isWebGL&&$s.movePath($r[0]+$V,$r[1]+$U),$s.arc($r[0]+$V,$r[1]+$U,$r[2],0,$R.PI2),$s.closePath(),this._fillAndStroke($r[3],$r[4],$r[5],!0)},this._fillCircle=function($V,$U,$r){$e.drawCall++;var $s=this.ctx;$s.beginPath(),$s.fillStyle=$r[3],$s.arc($r[0]+$V,$r[1]+$U,$r[2],0,$R.PI2),$s.fill()},this._setShader=function($V,$U,$r){this.ctx.setShader($r[0])},this._drawLine=function($V,$U,$r){var $s=this.ctx;$m.isWebGL&&$s.setPathId($r[6]),$s.beginPath(),$s.strokeStyle=$r[4],$s.lineWidth=$r[5],$m.isWebGL?($s.movePath($V,$U),$s.moveTo($r[0],$r[1]),$s.lineTo($r[2],$r[3])):($s.moveTo($V+$r[0],$U+$r[1]),$s.lineTo($V+$r[2],$U+$r[3])),$s.stroke()},this._drawLines=function($V,$U,$r){var $s=this.ctx;$m.isWebGL&&$s.setPathId($r[5]),$s.beginPath(),$V+=$r[0],$U+=$r[1],$m.isWebGL&&$s.movePath($V,$U),$s.strokeStyle=$r[3],$s.lineWidth=$r[4];var $p=$r[2],$c=2,$R=$p.length;if($m.isWebGL)for($s.moveTo($p[0],$p[1]);$c<$R;)$s.lineTo($p[$c++],$p[$c++]);else for($s.moveTo($V+$p[0],$U+$p[1]);$c<$R;)$s.lineTo($V+$p[$c++],$U+$p[$c++]);$s.stroke()},this._drawLinesWebGL=function($V,$U,$r){this.ctx.drawLines($V+this.x+$r[0],$U+this.y+$r[1],$r[2],$r[3],$r[4])},this._drawCurves=function($V,$U,$r){this.ctx.drawCurves($V,$U,$r)},this._draw=function($V,$U,$r){$r[0].call(null,this,$V,$U)},this._transformByMatrix=function($V,$U,$r){this.ctx.transformByMatrix($r[0])},this._setTransform=function($V,$U,$r){this.ctx.setTransform($r[0],$r[1],$r[2],$r[3],$r[4],$r[5])},this._setTransformByMatrix=function($V,$U,$r){this.ctx.setTransformByMatrix($r[0])},this._save=function($V,$U,$r){this.ctx.save()},this._restore=function($V,$U,$r){this.ctx.restore()},this._translate=function($V,$U,$r){this.ctx.translate($r[0],$r[1])},this._transform=function($V,$U,$r){this.ctx.translate($r[1]+$V,$r[2]+$U);var $s=$r[0];this.ctx.transform($s.a,$s.b,$s.c,$s.d,$s.tx,$s.ty),this.ctx.translate(-$V-$r[1],-$U-$r[2])},this._rotate=function($V,$U,$r){this.ctx.translate($r[1]+$V,$r[2]+$U),this.ctx.rotate($r[0]),this.ctx.translate(-$V-$r[1],-$U-$r[2])},this._scale=function($V,$U,$r){this.ctx.translate($r[2]+$V,$r[3]+$U),this.ctx.scale($r[0],$r[1]),this.ctx.translate(-$V-$r[2],-$U-$r[3])},this._alpha=function($V,$U,$r){this.ctx.globalAlpha*=$r[0]},this._setAlpha=function($V,$U,$r){this.ctx.globalAlpha=$r[0]},this._fillText=function($V,$U,$r){this.ctx.fillText($r[0],$r[1]+$V,$r[2]+$U,$r[3],$r[4],$r[5])},this._strokeText=function($V,$U,$r){this.ctx.strokeText($r[0],$r[1]+$V,$r[2]+$U,$r[3],$r[4],$r[5],$r[6])},this._fillBorderText=function($V,$U,$r){this.ctx.fillBorderText($r[0],$r[1]+$V,$r[2]+$U,$r[3],$r[4],$r[5],$r[6],$r[7])},this._blendMode=function($V,$U,$r){this.ctx.globalCompositeOperation=$r[0]},this._beginClip=function($V,$U,$r){this.ctx.beginClip&&this.ctx.beginClip($V+$r[0],$U+$r[1],$r[2],$r[3])},this._setIBVB=function($V,$U,$r){this.ctx.setIBVB($r[0]+$V,$r[1]+$U,$r[2],$r[3],$r[4],$r[5],$r[6],$r[7])},this._fillTrangles=function($V,$U,$r){this.ctx.fillTrangles($r[0],$r[1]+$V,$r[2]+$U,$r[3],$r[4])},this._drawPath=function($V,$U,$r){var $s=this.ctx;$m.isWebGL&&$s.setPathId(-1),$s.beginPath(),$V+=$r[0],$U+=$r[1],$m.isWebGL&&$s.movePath($V,$U);for(var $p=$r[2],$c=0,$R=$p.length;$c<$R;$c++){var $T=$p[$c];switch($T[0]){case"moveTo":$m.isWebGL?$s.moveTo($T[1],$T[2]):$s.moveTo($V+$T[1],$U+$T[2]);break;case"lineTo":$m.isWebGL?$s.lineTo($T[1],$T[2]):$s.lineTo($V+$T[1],$U+$T[2]);break;case"arcTo":$m.isWebGL?$s.arcTo($T[1],$T[2],$T[3],$T[4],$T[5]):$s.arcTo($V+$T[1],$U+$T[2],$V+$T[3],$U+$T[4],$T[5]);break;case"closePath":$s.closePath()}}var $N=$r[3];null!=$N&&($s.fillStyle=$N.fillStyle,$s.fill());var $t=$r[4];null!=$t&&($s.strokeStyle=$t.strokeStyle,$s.lineWidth=$t.lineWidth||1,$s.lineJoin=$t.lineJoin,$s.lineCap=$t.lineCap,$s.miterLimit=$t.miterLimit,$s.stroke())},this.drawPoly=function($V,$U,$r){this.ctx.drawPoly($V+this.x+$r[0],$U+this.y+$r[1],$r[2],$r[3],$r[4],$r[5],$r[6])},this._drawPoly=function($V,$U,$r){var $s=this.ctx,$p=$r[2],$c=2,$R=$p.length;if($m.isWebGL)for($s.setPathId($r[6]),$s.beginPath(),$V+=$r[0],$U+=$r[1],$s.movePath($V,$U),$s.moveTo($p[0],$p[1]);$c<$R;)$s.lineTo($p[$c++],$p[$c++]);else for($s.beginPath(),$V+=$r[0],$U+=$r[1],$s.moveTo($V+$p[0],$U+$p[1]);$c<$R;)$s.lineTo($V+$p[$c++],$U+$p[$c++]);$s.closePath(),this._fillAndStroke($r[3],$r[4],$r[5],$r[7])},this._drawSkin=function($V,$U,$r){var $s=$r[0];if($s){var $p=this.ctx;$s.render($p,$V,$U)}},this._drawParticle=function($V,$U,$r){this.ctx.drawParticle($V+this.x,$U+this.y,$r[0])},this._setFilters=function($V,$U,$r){this.ctx.setFilters($r)},$r?this.ctx=$r.getContext("2d"):($r=$OV.create("3D"),this.ctx=$w.createWebGLContext2D($r),$r._setContext(this.ctx)),$r.size($V,$U),this.canvas=$r}$u($R,"laya.renders.RenderContext");var $V=$R.prototype;return $V.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$V.drawTexture=function($V,$U,$r,$s,$p){$V.loaded&&this.ctx.drawTexture($V,$U,$r,$s,$p,this.x,this.y)},$V._drawTextures=function($V,$U,$r){$r[0].loaded&&this.ctx.drawTextures($r[0],$r[1],$V+this.x,$U+this.y)},$V.drawTextureWithTransform=function($V,$U,$r,$s,$p,$c,$R){$V.loaded&&this.ctx.drawTextureWithTransform($V,$U,$r,$s,$p,$c,this.x,this.y,$R)},$V.fillQuadrangle=function($V,$U,$r,$s,$p){this.ctx.fillQuadrangle($V,$U,$r,$s,$p)},$V.drawCanvas=function($V,$U,$r,$s,$p){this.ctx.drawCanvas($V,$U+this.x,$r+this.y,$s,$p)},$V.drawRect=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=1);var $R=this.ctx;$R.strokeStyle=$p,$R.lineWidth=$c,$R.strokeRect($V+this.x,$U+this.y,$r,$s,$c)},$V._fillAndStroke=function($V,$U,$r,$s){void 0===$s&&($s=!1);var $p=this.ctx;null!=$V&&($p.fillStyle=$V,$m.isWebGL?$p.fill($s):$p.fill()),null!=$U&&0<$r&&($p.strokeStyle=$U,$p.lineWidth=$r,$p.stroke())},$V.clipRect=function($V,$U,$r,$s){this.ctx.clipRect($V+this.x,$U+this.y,$r,$s)},$V.fillRect=function($V,$U,$r,$s,$p){this.ctx.fillRect($V+this.x,$U+this.y,$r,$s,$p)},$V.drawCircle=function($V,$U,$r,$s,$p){void 0===$p&&($p=1),$e.drawCall++;var $c=this.ctx;$c.beginPath(),$c.strokeStyle=$s,$c.lineWidth=$p,$c.arc($V+this.x,$U+this.y,$r,0,$R.PI2),$c.stroke()},$V.drawTriangles=function($V,$U,$r){if($m.isWebGL)this.ctx.drawTriangles($r[0],$V+$r[1],$U+$r[2],$r[3],$r[4],$r[5],$r[6],$r[7],$r[8],$r[9]);else{var $s=$r[5],$p=0,$c=$s.length,$R=this.ctx;for($p=0;$p<$c;$p+=3){var $T=2*$s[$p],$N=2*$s[$p+1],$t=2*$s[$p+2];$R.drawTriangle($r[0],$r[3],$r[4],$T,$N,$t,$r[6],!0)}}},$V.fillCircle=function($V,$U,$r,$s){$e.drawCall++;var $p=this.ctx;$p.beginPath(),$p.fillStyle=$s,$p.arc($V+this.x,$U+this.y,$r,0,$R.PI2),$p.fill()},$V.setShader=function($V){this.ctx.setShader($V)},$V.drawLine=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=1);var $R=this.ctx;$R.beginPath(),$R.strokeStyle=$p,$R.lineWidth=$c,$R.moveTo(this.x+$V,this.y+$U),$R.lineTo(this.x+$r,this.y+$s),$R.stroke()},$V.clear=function(){this.ctx.clear()},$V.transformByMatrix=function($V){this.ctx.transformByMatrix($V)},$V.setTransform=function($V,$U,$r,$s,$p,$c){this.ctx.setTransform($V,$U,$r,$s,$p,$c)},$V.setTransformByMatrix=function($V){this.ctx.setTransformByMatrix($V)},$V.save=function(){this.ctx.save()},$V.restore=function(){this.ctx.restore()},$V.translate=function($V,$U){this.ctx.translate($V,$U)},$V.transform=function($V,$U,$r,$s,$p,$c){this.ctx.transform($V,$U,$r,$s,$p,$c)},$V.rotate=function($V){this.ctx.rotate($V)},$V.scale=function($V,$U){this.ctx.scale($V,$U)},$V.alpha=function($V){this.ctx.globalAlpha*=$V},$V.setAlpha=function($V){this.ctx.globalAlpha=$V},$V.fillWords=function($V,$U,$r,$s,$p,$c){void 0===$c&&($c=0),this.ctx.fillWords($V,$U,$r,$s,$p,$c)},$V.fillBorderWords=function($V,$U,$r,$s,$p,$c,$R){this.ctx.fillBorderWords($V,$U,$r,$s,$p,$c,$R)},$V.fillText=function($V,$U,$r,$s,$p,$c){this.ctx.fillText($V,$U+this.x,$r+this.y,$s,$p,$c)},$V.strokeText=function($V,$U,$r,$s,$p,$c,$R){this.ctx.strokeText($V,$U+this.x,$r+this.y,$s,$p,$c,$R)},$V.blendMode=function($V){this.ctx.globalCompositeOperation=$V},$V.flush=function(){this.ctx.flush&&this.ctx.flush()},$V.addRenderObject=function($V){this.ctx.addRenderObject($V)},$V.beginClip=function($V,$U,$r,$s){this.ctx.beginClip&&this.ctx.beginClip($V,$U,$r,$s)},$V.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$V.fillTrangles=function($V,$U,$r){this.ctx.fillTrangles($r[0],$r[1],$r[2],$r[3],4<$r.length?$r[4]:null)},$R.PI2=2*Math.PI,$R}(),$Z=function(){function $R($V,$U){switch(this._next=$U||$R.NORENDER,$V){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$l._filter);case 69905:return void(this._fun=$R._initRenderFun)}this.onCreate($V)}$u($R,"laya.renders.RenderSprite");var $V=$R.prototype;return $V.onCreate=function($V){},$V._style=function($V,$U,$r,$s){$V._style.render($V,$U,$r,$s);var $p=this._next;$p._fun.call($p,$V,$U,$r,$s)},$V._no=function($V,$U,$r,$s){},$V._custom=function($V,$U,$r,$s){$V.customRender($U,$r,$s);var $p=$V._style._tf;this._next._fun.call(this._next,$V,$U,$r-$p.translateX,$s-$p.translateY)},$V._clip=function($V,$U,$r,$s){var $p=this._next;if($p!=$R.NORENDER){var $c=$V._style.scrollRect;$U.ctx.save(),$U.ctx.clipRect($r,$s,$c.width,$c.height),$p._fun.call($p,$V,$U,$r-$c.x,$s-$c.y),$U.ctx.restore()}},$V._blend=function($V,$U,$r,$s){var $p=$V._style;$p.blendMode&&($U.ctx.globalCompositeOperation=$p.blendMode);var $c=this._next;$c._fun.call($c,$V,$U,$r,$s),$U.ctx.globalCompositeOperation="source-over"},$V._mask=function($V,$U,$r,$s){var $p=this._next;$p._fun.call($p,$V,$U,$r,$s);var $c=$V.mask;$c&&($U.ctx.globalCompositeOperation="destination-in",(0<$c.numChildren||!$c.graphics._isOnlyOne())&&($c.cacheAsBitmap=!0),$c.render($U,$r-$V.pivotX,$s-$V.pivotY)),$U.ctx.globalCompositeOperation="source-over"},$V._graphics=function($V,$U,$r,$s){var $p=$V._style._tf;$V._graphics&&$V._graphics._render($V,$U,$r-$p.translateX,$s-$p.translateY);var $c=this._next;$c._fun.call($c,$V,$U,$r,$s)},$V._image=function($V,$U,$r,$s){var $p=$V._style;$U.ctx.drawTexture2($r,$s,$p._tf.translateX,$p._tf.translateY,$V.transform,$p.alpha,$p.blendMode,$V._graphics._one)},$V._image2=function($V,$U,$r,$s){var $p=$V._style._tf;$U.ctx.drawTexture2($r,$s,$p.translateX,$p.translateY,$V.transform,1,null,$V._graphics._one)},$V._alpha=function($V,$U,$r,$s){var $p;if(.01<($p=$V._style.alpha)||$V._needRepaint()){var $c=$U.ctx.globalAlpha;$U.ctx.globalAlpha*=$p;var $R=this._next;$R._fun.call($R,$V,$U,$r,$s),$U.ctx.globalAlpha=$c}},$V._transform=function($V,$U,$r,$s){var $p=$V.transform,$c=this._next;$p&&$c!=$R.NORENDER?($U.save(),$U.transform($p.a,$p.b,$p.c,$p.d,$p.tx+$r,$p.ty+$s),$c._fun.call($c,$V,$U,0,0),$U.restore()):$c._fun.call($c,$V,$U,$r,$s)},$V._childs=function($V,$U,$r,$s){var $p=$V._style,$c=$p._tf;if($r=$r-$c.translateX+$p.paddingLeft,$s=$s-$c.translateY+$p.paddingTop,$p._calculation){var $R=$V._getWords();if($R){var $T=$p;$T&&($T.stroke?$U.fillBorderWords($R,$r,$s,$T.font,$T.color,$T.strokeColor,$T.stroke):$U.fillWords($R,$r,$s,$T.font,$T.color,"none"!=$T.textDecoration&&$T.underLine?1:0))}}var $N,$t=$V._childs,$b=$t.length;if($V.viewport||$V.optimizeScrollRect&&$V._style.scrollRect){var $S=$V.viewport||$V._style.scrollRect,$_=$S.x,$G=$S.y,$q=$S.right,$u=$S.bottom,$h=NaN,$l=NaN;for($W=0;$W<$b;++$W)($N=$t[$W]).visible&&($h=$N._x)<$q&&$h+$N.width>$_&&($l=$N._y)<$u&&$l+$N.height>$G&&$N.render($U,$r,$s)}else for(var $W=0;$W<$b;++$W)($N=$t[$W])._style.visible&&$N.render($U,$r,$s)},$V._canvas=function($V,$U,$r,$s){var $p=$V._$P.cacheCanvas;if($p){"bitmap"===$p.type?$e.canvasBitmap++:$e.canvasNormal++;var $c=$p.ctx;if($V._needRepaint()||!$c)this._canvas_repaint($V,$U,$r,$s);else{var $R=$p._cacheRec;$U.drawCanvas($c.canvas,$r+$R.x,$s+$R.y,$R.width,$R.height)}}else this._next._fun.call(this._next,$V,$U,$r,$s)},$V._canvas_repaint=function($V,$U,$r,$s){var $p=$V._$P.cacheCanvas,$c=this._next;if($p){var $R,$T,$N,$t,$b=$p.ctx,$S=$V._needRepaint()||!$b,$_=$p.type;if("bitmap"===$_?$e.canvasBitmap++:$e.canvasNormal++,$S){var $G,$q;$p._cacheRec||($p._cacheRec=new $n),$m.isWebGL&&"bitmap"!==$_?$p._cacheRec.setTo(-$V.pivotX,-$V.pivotY,1,1):(($t=$V.getSelfBounds()).x=$t.x-$V.pivotX,$t.y=$t.y-$V.pivotY,$t.x=$t.x-16,$t.y=$t.y-16,$t.width=$t.width+32,$t.height=$t.height+32,$t.x=Math.floor($t.x+$r)-$r,$t.y=Math.floor($t.y+$s)-$s,$t.width=Math.floor($t.width),$t.height=Math.floor($t.height),$p._cacheRec.copyFrom($t)),$t=$p._cacheRec;var $u,$h=$m.isWebGL?1:$j.pixelRatio*$y.stage.clientScaleX,$l=$m.isWebGL?1:$j.pixelRatio*$y.stage.clientScaleY;if(!$m.isWebGL){var $W,$O=1,$L=1;for($W=$V;$W&&$W!=$y.stage;)$O*=$W.scaleX,$L*=$W.scaleY,$W=$W.parent;$m.isWebGL?($O<1&&($h*=$O),$L<1&&($l*=$L)):(1<$O&&($h*=$O),1<$L&&($l*=$L))}if($V.scrollRect){var $d=$V.scrollRect;$t.x-=$d.x,$t.y-=$d.y}if($G=$t.width*$h,$q=$t.height*$l,$T=$t.x,$N=$t.y,$m.isWebGL&&"bitmap"===$_&&(2048<$G||2048<$q))return console.warn("cache bitmap size larger than 2048,cache ignored"),$p.ctx&&($X.recover("RenderContext",$p.ctx),$p.ctx.canvas.size(0,0),$p.ctx=null),void $c._fun.call($c,$V,$U,$r,$s);if($b||($b=$p.ctx=$X.getItem("RenderContext")||new $a($G,$q,$OV.create("AUTO"))),$b.ctx.sprite=$V,($R=$b.canvas).clear(),($R.width!=$G||$R.height!=$q)&&$R.size($G,$q),"bitmap"===$_?$R.context.asBitmap=!0:"normal"===$_&&($R.context.asBitmap=!1),1!=$h||1!=$l){var $k=$b.ctx;$k.save(),$k.scale($h,$l),!$m.isConchWebGL&&$m.isConchApp&&($u=$V._$P.cf)&&$k.setFilterMatrix&&$k.setFilterMatrix($u._mat,$u._alpha),$c._fun.call($c,$V,$b,-$T,-$N),$k.restore(),$m.isConchApp&&!$m.isConchWebGL||$V._applyFilters()}else $k=$b.ctx,!$m.isConchWebGL&&$m.isConchApp&&($u=$V._$P.cf)&&$k.setFilterMatrix&&$k.setFilterMatrix($u._mat,$u._alpha),$c._fun.call($c,$V,$b,-$T,-$N),$m.isConchApp&&!$m.isConchWebGL||$V._applyFilters();$V._$P.staticCache&&($p.reCache=!1),$e.canvasReCache++}else $T=($t=$p._cacheRec).x,$N=$t.y,$R=$b.canvas;$U.drawCanvas($R,$r+$T,$s+$N,$t.width,$t.height)}else $c._fun.call($c,$V,$b,$r,$s)},$R.__init__=function(){var $V,$U,$r=0;for($U=$w.createRenderSprite(69905,null),$V=$R.renders.length=4096,$r=0;$r<$V;$r++)$R.renders[$r]=$U;$R.renders[0]=$w.createRenderSprite(0,null),function($V,$U){for(var $r=0,$s=0;$s<$V.length;$s++)$r|=$V[$s],$R.renders[$r]=$U}([1,512,4,2],new $R(1,null)),$R.renders[513]=$w.createRenderSprite(513,null),$R.renders[517]=new $R(517,null)},$R._initRenderFun=function($V,$U,$r,$s){var $p=$V._renderType;($R.renders[$p]=$R._getTypeRender($p))._fun($V,$U,$r,$s)},$R._getTypeRender=function($V){for(var $U=null,$r=2048;1<$r;)$r&$V&&($U=$w.createRenderSprite($r,$U)),$r>>=1;return $U},$R.IMAGE=1,$R.ALPHA=2,$R.TRANSFORM=4,$R.BLEND=8,$R.CANVAS=16,$R.FILTERS=32,$R.MASK=64,$R.CLIP=128,$R.STYLE=256,$R.GRAPHICS=512,$R.CUSTOM=1024,$R.CHILDS=2048,$R.INIT=69905,$R.renders=[],$R.NORENDER=new $R(0,null),$R}(),$x=function(){function $T(){this._repaint=!1}$u($T,"laya.resource.Context");var $V=$T.prototype;return $V.replaceReset=function(){var $V,$U,$r=0;for($V=$T.replaceKeys.length,$r=0;$r<$V;$r++)$U=$T.replaceKeys[$r],this[$T.newKeys[$r]]=this[$U]},$V.replaceResotre=function(){this.__restore(),this.__reset()},$V.setIsMainContext=function(){},$V.drawTextures=function($V,$U,$r,$s){$e.drawCall+=$U.length/2;for(var $p=$V.width,$c=$V.height,$R=0,$T=$U.length;$R<$T;$R+=2)this.drawTexture($V,$U[$R],$U[$R+1],$p,$c,$r,$s)},$V.drawCanvas=function($V,$U,$r,$s,$p){$e.drawCall++,this.drawImage($V.source,$U,$r,$s,$p)},$V.fillRect=function($V,$U,$r,$s,$p){$e.drawCall++,$p&&(this.fillStyle=$p),this.__fillRect($V,$U,$r,$s)},$V.fillText=function($V,$U,$r,$s,$p,$c){$e.drawCall++,3<arguments.length&&null!=$s&&(this.font=$s,this.fillStyle=$p,this.textAlign=$c,this.textBaseline="top"),this.__fillText($V,$U,$r)},$V.fillBorderText=function($V,$U,$r,$s,$p,$c,$R,$T){$e.drawCall++,this.font=$s,this.fillStyle=$p,this.textBaseline="top",this.strokeStyle=$c,this.lineWidth=$R,this.textAlign=$T,this.__strokeText($V,$U,$r),this.__fillText($V,$U,$r)},$V.strokeText=function($V,$U,$r,$s,$p,$c,$R){$e.drawCall++,3<arguments.length&&null!=$s&&(this.font=$s,this.strokeStyle=$p,this.lineWidth=$c,this.textAlign=$R,this.textBaseline="top"),this.__strokeText($V,$U,$r)},$V.transformByMatrix=function($V){this.transform($V.a,$V.b,$V.c,$V.d,$V.tx,$V.ty)},$V.setTransformByMatrix=function($V){this.setTransform($V.a,$V.b,$V.c,$V.d,$V.tx,$V.ty)},$V.clipRect=function($V,$U,$r,$s){$e.drawCall++,this.beginPath(),this.rect($V,$U,$r,$s),this.clip()},$V.drawTexture=function($V,$U,$r,$s,$p,$c,$R){$e.drawCall++;var $T=$V.uv,$N=$V.bitmap.width,$t=$V.bitmap.height;this.drawImage($V.source,$T[0]*$N,$T[1]*$t,($T[2]-$T[0])*$N,($T[5]-$T[3])*$t,$U+$c,$r+$R,$s,$p)},$V.drawTextureWithTransform=function($V,$U,$r,$s,$p,$c,$R,$T,$N){$e.drawCall++;var $t=$V.uv,$b=$V.bitmap.width,$S=$V.bitmap.height;this.save(),1!=$N&&(this.globalAlpha*=$N),$c?(this.transform($c.a,$c.b,$c.c,$c.d,$c.tx+$R,$c.ty+$T),this.drawImage($V.source,$t[0]*$b,$t[1]*$S,($t[2]-$t[0])*$b,($t[5]-$t[3])*$S,$U,$r,$s,$p)):this.drawImage($V.source,$t[0]*$b,$t[1]*$S,($t[2]-$t[0])*$b,($t[5]-$t[3])*$S,$U+$R,$r+$T,$s,$p),this.restore()},$V.drawTexture2=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=$T[0];if($N.loaded&&$N.bitmap&&$N.source){$e.drawCall++;var $t=1!==$c;if($t){var $b=this.globalAlpha;this.globalAlpha*=$c}var $S=$N.uv,$_=$N.bitmap.width,$G=$N.bitmap.height;$p?(this.save(),this.transform($p.a,$p.b,$p.c,$p.d,$p.tx+$V,$p.ty+$U),this.drawImage($N.source,$S[0]*$_,$S[1]*$G,($S[2]-$S[0])*$_,($S[5]-$S[3])*$G,$T[1]-$r,$T[2]-$s,$T[3],$T[4]),this.restore()):this.drawImage($N.source,$S[0]*$_,$S[1]*$G,($S[2]-$S[0])*$_,($S[5]-$S[3])*$G,$T[1]-$r+$V,$T[2]-$s+$U,$T[3],$T[4]),$t&&(this.globalAlpha=$b)}},$V.fillTexture=function($V,$U,$r,$s,$p,$c,$R,$T){if(!$T.pat){if($V.uv!=$bV.DEF_UV){var $N=new $OV("2D");$N.getContext("2d"),$N.size($V.width,$V.height),$N.context.drawTexture($V,0,0,$V.width,$V.height,0,0),$V=new $bV($N)}$T.pat=this.createPattern($V.bitmap.source,$c)}var $t=$U,$b=$r,$S=0,$_=0;$R&&($t+=$R.x%$V.width,$b+=$R.y%$V.height,$S-=$R.x%$V.width,$_-=$R.y%$V.height),this.translate($t,$b),this.fillRect($S,$_,$s,$p,$T.pat),this.translate(-$t,-$b)},$V.drawTriangle=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=$V.bitmap,$t=$N.source,$b=$V.width,$S=$V.height,$_=$N.width,$G=$N.height,$q=$r[$s]*$_,$u=$r[$p]*$_,$h=$r[$c]*$_,$l=$r[$s+1]*$G,$W=$r[$p+1]*$G,$O=$r[$c+1]*$G,$L=$U[$s],$d=$U[$p],$k=$U[$c],$y=$U[$s+1],$D=$U[$p+1],$n=$U[$c+1];if($T){var $I=($L+$d+$k)/3,$Q=($y+$D+$n)/3,$H=$L-$I,$w=$y-$Q,$z=Math.sqrt($H*$H+$w*$w);$L=$I+$H/$z*($z+1),$y=$Q+$w/$z*($z+1),$w=$D-$Q,$d=$I+($H=$d-$I)/($z=Math.sqrt($H*$H+$w*$w))*($z+1),$D=$Q+$w/$z*($z+1),$w=$n-$Q,$k=$I+($H=$k-$I)/($z=Math.sqrt($H*$H+$w*$w))*($z+1),$n=$Q+$w/$z*($z+1)}this.save(),$R&&this.transform($R.a,$R.b,$R.c,$R.d,$R.tx,$R.ty),this.beginPath(),this.moveTo($L,$y),this.lineTo($d,$D),this.lineTo($k,$n),this.closePath(),this.clip();var $E=1/($q*$W+$l*$h+$u*$O-$W*$h-$l*$u-$q*$O),$K=$L*$W+$l*$k+$d*$O-$W*$k-$l*$d-$L*$O,$m=$q*$d+$L*$h+$u*$k-$d*$h-$L*$u-$q*$k,$a=$q*$W*$k+$l*$d*$h+$L*$u*$O-$L*$W*$h-$l*$u*$k-$q*$d*$O,$Z=$y*$W+$l*$n+$D*$O-$W*$n-$l*$D-$y*$O,$x=$q*$D+$y*$h+$u*$n-$D*$h-$y*$u-$q*$n,$$=$q*$W*$n+$l*$D*$h+$y*$u*$O-$y*$W*$h-$l*$u*$n-$q*$D*$O;this.transform($K*$E,$Z*$E,$m*$E,$x*$E,$a*$E,$$*$E),this.drawImage($t,$V.uv[0]*$_,$V.uv[1]*$G,$b,$S,$V.uv[0]*$_,$V.uv[1]*$G,$b,$S),this.restore()},$V.flush=function(){return 0},$V.fillWords=function($V,$U,$r,$s,$p,$c){$s&&(this.font=$s),$p&&(this.fillStyle=$p);this.textBaseline="top",this.textAlign="left";for(var $R=0,$T=$V.length;$R<$T;$R++){var $N=$V[$R];if(this.__fillText($N.char,$N.x+$U,$N.y+$r),1===$c){var $t=$N.height,$b=.5*$N.style.letterSpacing;$b||($b=0),this.beginPath(),this.strokeStyle=$p,this.lineWidth=1,this.moveTo($U+$N.x-$b+.5,$r+$N.y+$t+.5),this.lineTo($U+$N.x+$N.width+$b+.5,$r+$N.y+$t+.5),this.stroke()}}},$V.fillBorderWords=function($V,$U,$r,$s,$p,$c,$R){$s&&(this.font=$s),$p&&(this.fillStyle=$p),this.textBaseline="top",this.lineWidth=$R,this.textAlign="left",this.strokeStyle=$c;for(var $T=0,$N=$V.length;$T<$N;$T++){var $t=$V[$T];this.__strokeText($t.char,$t.x+$U,$t.y+$r),this.__fillText($t.char,$t.x+$U,$t.y+$r)}},$V.destroy=function(){this.canvas.width=this.canvas.height=0},$V.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$V.drawCurves=function($V,$U,$r){this.beginPath(),this.strokeStyle=$r[3],this.lineWidth=$r[4];var $s=$r[2];$V+=$r[0],$U+=$r[1],this.moveTo($V+$s[0],$U+$s[1]);for(var $p=2,$c=$s.length;$p<$c;)this.quadraticCurveTo($V+$s[$p++],$U+$s[$p++],$V+$s[$p++],$U+$s[$p++]);this.stroke()},$T.__init__=function($U){var $r=laya.resource.Context.prototype;if(!($U=$U||CanvasRenderingContext2D.prototype).inited){$U.inited=!0,$U.__fillText=$U.fillText,$U.__fillRect=$U.fillRect,$U.__strokeText=$U.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($V){$U[$V]=$r[$V]})}},$T.replaceCanvasGetSet=function($V,$U){var $r=Object.getOwnPropertyDescriptor($V,$U);if(!$r||!$r.configurable)return!1;var $s,$p={};for($s in $r)"set"!=$s&&($p[$s]=$r[$s]);var $c=$r.set;return $p.set=function($V){$c.call(this,$V);var $U=this.getContext("2d");$U&&"__reset"in $U&&$U.__reset()},Object.defineProperty($V,$U,$p),!0},$T.replaceGetSet=function($V,$U){var $r=Object.getOwnPropertyDescriptor($V,$U);if(!$r||!$r.configurable)return!1;var $s,$p={};for($s in $r)"set"!=$s&&($p[$s]=$r[$s]);var $c=$r.set,$R="___"+$U+"__";return $T.newKeys.push($R),$p.set=function($V){$V!=this[$R]&&(this[$R]=$V,$c.call(this,$V))},Object.defineProperty($V,$U,$p),!0},$T._default=new $T,$T.newKeys=[],$N($T,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$T}(),$$=function(){function $c($V){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$c._uniqueIDCounter,this._name=$V||"Content Manager",$c._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$c._resourceManagers.push(this),this._resources=[],this._records={}}$u($c,"laya.resource.ResourceManager");var $V=$c.prototype;return $y.imps($V,{"laya.resource.IDispose":!0}),$V.getResourceByIndex=function($V){return this._resources[$V]},$V.getResourcesLength=function(){return this._resources.length},$V.addResource=function($V){return $V.resourceManager&&$V.resourceManager.removeResource($V),-1===this._resources.indexOf($V)&&(($V._resourceManager=this)._resources.push($V),this.addRecord($V.uri,$V.__className,$V.memorySize),this.addSize($V.memorySize),!0)},$V.removeResource=function($V){var $U=this._resources.indexOf($V);return-1!==$U&&(this._resources.splice($U,1),$V._resourceManager=null,this._memorySize-=$V.memorySize,this.addRecord($V.uri,$V.__className,-$V.memorySize),!0)},$V.unload=function(){for(var $V=this._resources.slice(0,this._resources.length),$U=0;$U<$V.length;$U++){$V[$U].destroy()}$V.length=0},$V.dispose=function(){if(this===$c._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$c._resourceManagers.splice($c._resourceManagers.indexOf(this),1),$c._isResourceManagersSorted=!1;for(var $V=this._resources.slice(0,this._resources.length),$U=0;$U<$V.length;$U++){var $r=$V[$U];$r.resourceManager.removeResource($r),$r.destroy()}$V.length=0},$V.addSize=function($V){$V&&(this.autoRelease&&0<$V&&this._memorySize+$V>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$V)},$V.addRecord=function($V,$U,$r){DEBUG&&$r&&!$V&&console.error($V,$U,$r)},$V.garbageCollection=function($V){var $U=this._resources;($U=$U.slice()).sort(function($V,$U){if(!$V||!$U)throw new Error("a或b不能为空！");return $V.released&&$U.released?0:$V.released?1:$U.released?-1:$V._lastUseFrameCount-$U._lastUseFrameCount});for(var $r=$e.loopCount,$s=0,$p=$U.length;$s<$p;$s++){var $c=$U[$s];if(!(1<$r-$c._lastUseFrameCount))return void(this._memorySize>=$V&&(this._isOverflow=!0));if($c.releaseResource(),this._memorySize<$V)return void(this._isOverflow=!1)}},$b(0,$V,"id",function(){return this._id}),$b(0,$V,"name",function(){return this._name},function($V){!$V&&""===$V||this._name===$V||(this._name=$V,$c._isResourceManagersSorted=!1)}),$b(0,$V,"memorySize",function(){return this._memorySize}),$b(0,$V,"records",function(){return this._records}),$b(1,$c,"systemResourceManager",function(){return $c._systemResourceManager}),$c.__init__=function(){$c.currentResourceManager=$c.systemResourceManager},$c.getLoadedResourceManagerByIndex=function($V){return $c._resourceManagers[$V]},$c.getLoadedResourceManagersCount=function(){return $c._resourceManagers.length},$c.recreateContentManagers=function($V){void 0===$V&&($V=!1);for(var $U=$c.currentResourceManager,$r=0;$r<$c._resourceManagers.length;$r++){$c.currentResourceManager=$c._resourceManagers[$r];for(var $s=0;$s<$c.currentResourceManager._resources.length;$s++)$c.currentResourceManager._resources[$s].releaseResource($V),$c.currentResourceManager._resources[$s].activeResource($V)}$c.currentResourceManager=$U},$c.releaseContentManagers=function($V){void 0===$V&&($V=!1);for(var $U=$c.currentResourceManager,$r=0;$r<$c._resourceManagers.length;$r++){$c.currentResourceManager=$c._resourceManagers[$r];for(var $s=0;$s<$c.currentResourceManager._resources.length;$s++){var $p=$c.currentResourceManager._resources[$s];!$p.released&&$p.releaseResource($V)}}$c.currentResourceManager=$U},$c._uniqueIDCounter=0,$c._isResourceManagersSorted=!1,$c._resourceManagers=[],$N($c,["_systemResourceManager",function(){return this._systemResourceManager=new $c("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$c._systemResourceManager}]),$c}(),$j=(function(){function $V(){}$u($V,"laya.system.System"),$V.changeDefinition=function($V,$U){$y[$V]=$U;var $r=$V+"=classObj";$y._runScript($r)},$V.__init__=function(){$m.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $r(){}return $u($r,"laya.utils.Browser"),$b(1,$r,"pixelRatio",function(){return $r.__init__(),-1<$r.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$w.getPixelRatio()}),$b(1,$r,"height",function(){return $r.__init__(),($y.stage&&$y.stage.canvasRotation?$r.clientWidth:$r.clientHeight)*$r.pixelRatio}),$b(1,$r,"clientWidth",function(){return $r.__init__(),$r.window.innerWidth||$r.document.body.clientWidth}),$b(1,$r,"window",function(){return $r.__init__(),$r._window}),$b(1,$r,"clientHeight",function(){return $r.__init__(),$r.window.innerHeight||$r.document.body.clientHeight||$r.document.documentElement.clientHeight}),$b(1,$r,"width",function(){return $r.__init__(),($y.stage&&$y.stage.canvasRotation?$r.clientHeight:$r.clientWidth)*$r.pixelRatio}),$b(1,$r,"container",function(){return $r.__init__(),$r._container||(($r._container=$r.createElement("div")).id="layaContainer",$r.document.body.appendChild($r._container)),$r._container},function($V){$r._container=$V}),$b(1,$r,"document",function(){return $r.__init__(),$r._document}),$r.__init__=function(){if(!$r._window){$r._window=$w.getWindow(),$r._document=$r.window.document,$r._window.addEventListener("message",function($V){laya.utils.Browser._onMessage($V)},!1),$r.document.__createElement=$r.document.createElement,$R.requestAnimationFrame=$R.requestAnimationFrame||$R.webkitRequestAnimationFrame||$R.mozRequestAnimationFrame||$R.oRequestAnimationFrame||$R.msRequestAnimationFrame||function($V){return $R.setTimeout($V,1e3/60)};var $V=$R.document.body.style;$V["-webkit-user-select"]="none",$V["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$r.userAgent=$r.window.navigator.userAgent,$r.onIOS=!!($r.u=$r.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$r.onMobile=-1<$r.u.indexOf("Mobile"),$r.onIPhone=-1<$r.u.indexOf("iPhone"),$r.onMac=-1<$r.u.indexOf("Mac OS X"),$r.onIPad=-1<$r.u.indexOf("iPad"),$r.onAndroid=-1<$r.u.indexOf("Android")||-1<$r.u.indexOf("Adr"),$r.onWP=-1<$r.u.indexOf("Windows Phone"),$r.onQQBrowser=-1<$r.u.indexOf("QQBrowser"),$r.onMQQBrowser=-1<$r.u.indexOf("MQQBrowser")||-1<$r.u.indexOf("Mobile")&&-1<$r.u.indexOf("QQ"),$r.onIE=!!$r.window.ActiveXObject||"ActiveXObject"in $r.window,$r.onWeiXin=-1<$r.u.indexOf("MicroMessenger"),$r.onPC=!$r.onMobile,$r.onSafari=-1<$r.u.indexOf("Safari"),$r.onFirefox=-1<$r.u.indexOf("Firefox"),$r.onEdge=-1<$r.u.indexOf("Edge"),$r.onMiniGame=-1<$r.u.indexOf("MiniGame"),$r.onLimixiu=-1<$r.u.indexOf("limixiu"),$r.httpProtocol="http:"==$r.window.location.protocol,$r.onMiniGame&&null==$r.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$r.webAudioEnabled=!!($r.window.AudioContext||$r.window.webkitAudioContext||$r.window.mozAudioContext),$r.soundType=$r.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$pV=$r.webAudioEnabled?$cV:$rV,$r.webAudioEnabled&&$cV.initWebAudio(),$rV._initMusicAudio(),$r.enableTouch="ontouchstart"in $R||$R.DocumentTouch&&$U instanceof DocumentTouch,$R.focus(),$H._soundClass=$pV,$H._musicClass=$rV,$m._mainCanvas=$m._mainCanvas||$OV.create("2D"),$r.canvas||($r.canvas=$OV.create("2D"),$r.context=$r.canvas.getContext("2d"))}},$r._onMessage=function($V){if($V.data&&"size"==$V.data.name){if($r.window.innerWidth=$V.data.width,$r.window.innerHeight=$V.data.height,$r.window.__innerHeight=$V.data.clientHeight,!$r.document.createEvent)return void console.warn("no document.createEvent");var $U=$r.document.createEvent("HTMLEvents");return $U.initEvent("resize",!1,!1),void $r.window.dispatchEvent($U)}},$r.createElement=function($V){return $r.__init__(),$r.document.__createElement($V)},$r.getElementById=function($V){return $r.__init__(),$r.document.getElementById($V)},$r.removeElement=function($V){$V&&$V.parentNode&&$V.parentNode.removeChild($V)},$r.now=function(){return $w.now()},$r._window=null,$r._document=null,$r._container=null,$r.userAgent=null,$r.u=null,$r.onIOS=!1,$r.onMac=!1,$r.onMobile=!1,$r.onIPhone=!1,$r.onIPad=!1,$r.onAndroid=!1,$r.onWP=!1,$r.onQQBrowser=!1,$r.onMQQBrowser=!1,$r.onSafari=!1,$r.onFirefox=!1,$r.onEdge=!1,$r.onIE=!1,$r.onWeiXin=!1,$r.onMiniGame=!1,$r.onLimixiu=!1,$r.onPC=!1,$r.httpProtocol=!1,$r.webAudioEnabled=!1,$r.soundType=null,$r.enableTouch=!1,$r.canvas=null,$r.context=null,$r.__init$=function(){},$r}()),$o=function(){function $U($V){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$V?(this._u8d_=new Uint8Array($V),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$u($U,"laya.utils.Byte");var $V=$U.prototype;return $V.___resizeBuffer=function($U){try{var $V=new Uint8Array($U);null!=this._u8d_&&(this._u8d_.length<=$U?$V.set(this._u8d_):$V.set(this._u8d_.subarray(0,$U))),this._u8d_=$V,this._d_=new DataView($V.buffer)}catch($V){throw"___resizeBuffer err:"+$U}},$V.getString=function(){return this.rUTF(this.getUint16())},$V.getFloat32Array=function($V,$U){var $r=$V+$U;$r=$r>this._length?this._length:$r;var $s=new Float32Array(this._d_.buffer.slice($V,$r));return this._pos_=$r,$s},$V.getUint8Array=function($V,$U){var $r=$V+$U;$r=$r>this._length?this._length:$r;var $s=new Uint8Array(this._d_.buffer.slice($V,$r));return this._pos_=$r,$s},$V.getInt16Array=function($V,$U){var $r=$V+$U;$r=$r>this._length?this._length:$r;var $s=new Int16Array(this._d_.buffer.slice($V,$r));return this._pos_=$r,$s},$V.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $V=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$V},$V.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $V=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$V},$V.writeFloat32=function($V){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$V,this._xd_),this._pos_+=4},$V.writeFloat64=function($V){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$V,this._xd_),this._pos_+=8},$V.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $V=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$V},$V.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $V=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$V},$V.writeInt32=function($V){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$V,this._xd_),this._pos_+=4},$V.writeUint32=function($V){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$V,this._xd_),this._pos_+=4},$V.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $V=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$V},$V.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $V=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$V},$V.writeUint16=function($V){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$V,this._xd_),this._pos_+=2},$V.writeInt16=function($V){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$V,this._xd_),this._pos_+=2},$V.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$V.writeUint8=function($V){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$V),this._pos_++},$V._getUInt8=function($V){return this._d_.getUint8($V)},$V._getUint16=function($V){return this._d_.getUint16($V,this._xd_)},$V._getMatrix=function(){return new $z(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$V.rUTF=function($V){for(var $U=[],$r=this._pos_+$V,$s=0,$p=0,$c=0,$R=String.fromCharCode,$T=this._u8d_;this._pos_<$r;)($s=$T[this._pos_++])<128?0!=$s&&$U.push($R($s)):$s<224?$U.push($R((63&$s)<<6|127&$T[this._pos_++])):$s<240?($p=$T[this._pos_++],$U.push($R((31&$s)<<12|(127&$p)<<6|127&$T[this._pos_++]))):($p=$T[this._pos_++],$c=$T[this._pos_++],$U.push($R((15&$s)<<18|(127&$p)<<12|$c<<6&127|127&$T[this._pos_++]))),0;return $U.join("")},$V.getCustomString=function($V){for(var $U=[],$r=0,$s=0,$p=0,$c=String.fromCharCode,$R=this._u8d_;0<$V;)if(($s=$R[this._pos_])<128)$U.push($c($s)),this._pos_++,$V--;else for($r=$s-128,this._pos_++,$V-=$r;0<$r;)$s=$R[this._pos_++],$p=$R[this._pos_++],$U.push($c($p<<8|$s)),$r--;return $U.join("")},$V.clear=function(){this._pos_=0,this.length=0},$V.__getBuffer=function(){return this._d_.buffer},$V.writeUTFBytes=function($V){for(var $U=0,$r=($V+="").length;$U<$r;$U++){var $s=$V.charCodeAt($U);$s<=127?this.writeByte($s):$s<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$s>>6,128|63&$s],this._pos_),this._pos_+=2):$s<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$s>>12,128|$s>>6&63,128|63&$s],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$s>>18,128|$s>>12&63,128|$s>>6&63,128|63&$s],this._pos_),this._pos_+=4)}},$V.writeUTFString=function($V){var $U=this.pos;this.writeUint16(1),this.writeUTFBytes($V);var $r=this.pos-$U-2;if(65536<=$r)throw"writeUTFString byte len more than 65536";this._d_.setUint16($U,$r,this._xd_)},$V.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$V.getUTFString=function(){return this.readUTFString()},$V.readUTFBytes=function($V){if(void 0===$V&&($V=-1),0==$V)return"";var $U=this.bytesAvailable;if($U<$V)throw"readUTFBytes error - Out of bounds";return $V=0<$V?$V:$U,this.rUTF($V)},$V.getUTFBytes=function($V){return void 0===$V&&($V=-1),this.readUTFBytes($V)},$V.writeByte=function($V){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$V),this._pos_+=1},$V.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$V.getByte=function(){return this.readByte()},$V.ensureWrite=function($V){this._length<$V&&(this._length=$V),this._allocated_<$V&&(this.length=$V)},$V.writeArrayBuffer=function($V,$U,$r){if(void 0===$U&&($U=0),void 0===$r&&($r=0),$U<0||$r<0)throw"writeArrayBuffer error - Out of bounds";0==$r&&($r=$V.byteLength-$U),this.ensureWrite(this._pos_+$r);var $s=new Uint8Array($V);this._u8d_.set($s.subarray($U,$U+$r),this._pos_),this._pos_+=$r},$b(0,$V,"buffer",function(){var $V=this._d_.buffer;return $V.byteLength==this.length?$V:$V.slice(0,this.length)}),$b(0,$V,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($V){this._xd_="littleEndian"==$V}),$b(0,$V,"length",function(){return this._length},function($V){this._allocated_<$V?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($V,2*this._allocated_))):this._allocated_>$V&&this.___resizeBuffer(this._allocated_=$V),this._length=$V}),$b(0,$V,"pos",function(){return this._pos_},function($V){this._pos_=$V}),$b(0,$V,"bytesAvailable",function(){return this._length-this._pos_}),$U.getSystemEndian=function(){if(!$U._sysEndian){var $V=new ArrayBuffer(2);new DataView($V).setInt16(0,256,!0),$U._sysEndian=256===new Int16Array($V)[0]?"littleEndian":"bigEndian"}return $U._sysEndian},$U.BIG_ENDIAN="bigEndian",$U.LITTLE_ENDIAN="littleEndian",$U._sysEndian=null,$U}(),$J=function(){function $p(){}return $u($p,"laya.utils.CacheManager"),$p.regCacheByFunction=function($V,$U){var $r;$p.unRegCacheByFunction($V,$U),$r={tryDispose:$V,getCacheList:$U},$p._cacheList.push($r)},$p.unRegCacheByFunction=function($V,$U){var $r,$s=0;for($r=$p._cacheList.length,$s=0;$s<$r;$s++)if($p._cacheList[$s].tryDispose==$V&&$p._cacheList[$s].getCacheList==$U)return void $p._cacheList.splice($s,1)},$p.forceDispose=function(){var $V=0,$U=$p._cacheList.length;for($V=0;$V<$U;$V++)$p._cacheList[$V].tryDispose(!0)},$p.beginCheck=function($V){void 0===$V&&($V=15e3),$y.timer.loop($V,null,$p._checkLoop)},$p.stopCheck=function(){$y.timer.clear(null,$p._checkLoop)},$p._checkLoop=function(){var $V=$p._cacheList;if(!($V.length<1)){var $U,$r=$j.now(),$s=0;for($U=$s=$V.length;0<$s&&($V[$p._index=++$p._index%$U].tryDispose(!1),!($j.now()-$r>$p.loopTimeLimit));)$s--}},$p.loopTimeLimit=2,$p._cacheList=[],$p._index=0,$p}(),$i=function(){function $G(){}return $u($G,"laya.utils.ClassUtils"),$G.regClass=function($V,$U){$G._classMap[$V]=$U},$G.getRegClass=function($V){return $G._classMap[$V]},$G.getInstance=function($V){var $U=$G.getClass($V);return $U?new $U:(console.warn("[error] Undefined class:",$V),null)},$G.createByJson=function($V,$U,$r,$s,$p){"string"==typeof $V&&($V=JSON.parse($V));var $c=$V.props;if(!$U&&!($U=$p?$p.runWith($V):$G.getInstance($c.runtime||$V.type)))return null;var $R=$V.child;if($R)for(var $T=0,$N=$R.length;$T<$N;$T++){var $t=$R[$T];if("render"!==$t.props.name&&"render"!==$t.props.renderType||!$U._$set_itemRender)if("Graphic"==$t.type)$G.addGraphicsToSprite($t,$U);else if($G.isDrawType($t.type))$G.addGraphicToSprite($t,$U,!0);else{var $b=$G.createByJson($t,null,$r,$s,$p);"Script"==$t.type?$b.hasOwnProperty("owner")?$b.owner=$U:$b.hasOwnProperty("target")&&($b.target=$U):"mask"==$t.props.renderType?$U.mask=$b:$U.addChild($b)}else $U.itemRender=$t}if($c)for(var $S in $c){var $_=$c[$S];"var"===$S&&$r?$r[$_]=$U:$_ instanceof Array&&"function"==typeof $U[$S]?$U[$S].apply($U,$_):$U[$S]=$_}return $s&&$V.customProps&&$s.runWith([$U,$V]),$U.created&&$U.created(),$U},$G.addGraphicsToSprite=function($V,$U){var $r;if(($r=$V.child)&&!($r.length<1)){var $s;$s=$G._getGraphicsFromSprite($V,$U);var $p=0,$c=0;$V.props&&($p=$G._getObjVar($V.props,"x",0),$c=$G._getObjVar($V.props,"y",0)),0!=$p&&0!=$c&&$s.translate($p,$c);var $R,$T=0;for($R=$r.length,$T=0;$T<$R;$T++)$G._addGraphicToGraphics($r[$T],$s);0!=$p&&0!=$c&&$s.translate(-$p,-$c)}},$G.addGraphicToSprite=function($V,$U,$r){var $s;void 0===$r&&($r=!1),$s=$r?$G._getGraphicsFromSprite($V,$U):$U.graphics,$G._addGraphicToGraphics($V,$s)},$G._getGraphicsFromSprite=function($V,$U){var $r,$s;if(!$V||!$V.props)return $U.graphics;switch($s=$V.props.renderType){case"hit":case"unHit":var $p;$U.hitArea||($U.hitArea=new $A),($p=$U.hitArea)[$s]||($p[$s]=new $_),$r=$p[$s]}return $r||($r=$U.graphics),$r},$G._getTransformData=function($V){var $U;($V.hasOwnProperty("pivotX")||$V.hasOwnProperty("pivotY"))&&($U=$U||new $z).translate(-$G._getObjVar($V,"pivotX",0),-$G._getObjVar($V,"pivotY",0));var $r=$G._getObjVar($V,"scaleX",1),$s=$G._getObjVar($V,"scaleY",1),$p=$G._getObjVar($V,"rotation",0);$G._getObjVar($V,"skewX",0),$G._getObjVar($V,"skewY",0);return 1==$r&&1==$s&&0==$p||(($U=$U||new $z).scale($r,$s),$U.rotate(.0174532922222222*$p)),$U},$G._addGraphicToGraphics=function($V,$U){var $r,$s;if(($r=$V.props)&&($s=$G.DrawTypeDic[$V.type])){var $p,$c;$p=$U;var $R=$G._getParams($r,$s[1],$s[2],$s[3]);(($c=$G._tM)||1!=$G._alpha)&&($p.save(),$c&&$p.transform($c),1!=$G._alpha&&$p.alpha($G._alpha)),$p[$s[0]].apply($p,$R),($c||1!=$G._alpha)&&$p.restore()}},$G._adptLineData=function($V){return $V[2]=parseFloat($V[0])+parseFloat($V[2]),$V[3]=parseFloat($V[1])+parseFloat($V[3]),$V},$G._adptTextureData=function($V){return $V[0]=$TV.getRes($V[0]),$V},$G._adptLinesData=function($V){return $V[2]=$G._getPointListByStr($V[2]),$V},$G.isDrawType=function($V){return"Image"!=$V&&$G.DrawTypeDic.hasOwnProperty($V)},$G._getParams=function($V,$U,$r,$s){var $p;void 0===$r&&($r=0),($p=$G._temParam).length=$U.length;var $c,$R,$T=0;for($c=$U.length,$T=0;$T<$c;$T++)$p[$T]=$G._getObjVar($V,$U[$T][0],$U[$T][1]);return $G._alpha=$G._getObjVar($V,"alpha",1),$R=$G._getTransformData($V),$G._tM=$R?($r||($r=0),$R.translate($p[$r],$p[$r+1]),$p[$r]=$p[$r+1]=0,$R):null,$s&&$G[$s]&&($p=$G[$s]($p)),$p},$G._getPointListByStr=function($V){var $U,$r,$s=0;for($r=($U=$V.split(",")).length,$s=0;$s<$r;$s++)$U[$s]=parseFloat($U[$s]);return $U},$G._getObjVar=function($V,$U,$r){return $V.hasOwnProperty($U)?$V[$U]:$r},$G._temParam=[],$G._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$G.getClass=function($V){var $U=$G._classMap[$V]||$V;return"string"==typeof $U?$y.__classmap[$U]:$U},$G._tM=null,$G._alpha=NaN,$N($G,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$G}(),$B=function(){function $c($V){if(this._color=[],"string"==typeof $V){null===(this.strColor=$V)&&($V="#000000"),"#"==$V.charAt(0)&&($V=$V.substr(1));var $U=$V.length;if(3==$U||4==$U){for(var $r="",$s=0;$s<$U;$s++)$r+=$V[$s]+$V[$s];$V=$r}var $p=this.numColor=parseInt($V,16);if(8==$V.length)return void(this._color=[parseInt($V.substr(0,2),16)/255,((16711680&$p)>>16)/255,((65280&$p)>>8)/255,(255&$p)/255])}else $p=this.numColor=$V,this.strColor=$v.toHexColor($p);this._color=[((16711680&$p)>>16)/255,((65280&$p)>>8)/255,(255&$p)/255,1],this._color.__id=++$c._COLODID}return $u($c,"laya.utils.Color"),$c._initDefault=function(){for(var $V in $c._DEFAULT={},$c._COLOR_MAP)$c._SAVE[$V]=$c._DEFAULT[$V]=new $c($c._COLOR_MAP[$V]);return $c._DEFAULT},$c._initSaveMap=function(){for(var $V in $c._SAVE_SIZE=0,$c._SAVE={},$c._DEFAULT)$c._SAVE[$V]=$c._DEFAULT[$V]},$c.create=function($V){var $U=$c._SAVE[$V+""];return null!=$U?$U:($c._SAVE_SIZE<1e3||$c._initSaveMap(),$c._SAVE[$V+""]=new $c($V))},$c._SAVE={},$c._SAVE_SIZE=0,$c._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$c._DEFAULT=$c._initDefault(),$c._COLODID=1,$c}(),$P=(function(){function $V(){this._values=[],this._keys=[]}$u($V,"laya.utils.Dictionary");var $U=$V.prototype;$U.set=function($V,$U){var $r=this.indexOf($V);0<=$r?this._values[$r]=$U:(this._keys.push($V),this._values.push($U))},$U.indexOf=function($V){var $U=this._keys.indexOf($V);return 0<=$U?$U:($V="string"==typeof $V?Number($V):"number"==typeof $V?$V.toString():$V,this._keys.indexOf($V))},$U.get=function($V){var $U=this.indexOf($V);return $U<0?null:this._values[$U]},$U.remove=function($V){var $U=this.indexOf($V);return 0<=$U&&(this._keys.splice($U,1),this._values.splice($U,1),!0)},$U.clear=function(){this._values.length=0,this._keys.length=0},$b(0,$U,"values",function(){return this._values}),$b(0,$U,"keys",function(){return this._keys})}(),function(){function $V(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$u($V,"laya.utils.Dragging");var $U=$V.prototype;return $U.start=function($V,$U,$r,$s,$p,$c,$R,$T){void 0===$T&&($T=.92),this.clearTimer(),this.target=$V,this.area=$U,this.hasInertia=$r,this.elasticDistance=$U?$s:0,this.elasticBackTime=$p,this.data=$c,this._disableMouseEvent=$R,this.ratio=$T,1!=$V.globalScaleX||1!=$V.globalScaleY?this._parent=$V.parent:this._parent=$y.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$y.stage.on("mouseup",this,this.onStageMouseUp),$y.stage.on("mouseout",this,this.onStageMouseUp),$y.timer.frameLoop(1,this,this.loop)},$U.clearTimer=function(){$y.timer.clear(this,this.loop),$y.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$U.stop=function(){this._dragging&&($q.instance.disableMouseEvent=!1,$y.stage.off("mouseup",this,this.onStageMouseUp),$y.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$U.loop=function(){var $V=this._parent.getMousePoint(),$U=$V.x,$r=$V.y,$s=$U-this._lastX,$p=$r-this._lastY;if(this._clickOnly){if(!(1<Math.abs($s*$y.stage._canvasTransform.getScaleX())||1<Math.abs($p*$y.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$q.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($s,$p);0==$s&&0==$p||(this._lastX=$U,this._lastY=$r,this.target.x+=$s*this._elasticRateX,this.target.y+=$p*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$U.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $V=this.area.x-this.target.x;else $V=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$V/this.elasticDistance),this.target.y<this.area.y)var $U=this.area.y-this.target.y;else $U=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$U/this.elasticDistance)}},$U.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$U.onStageMouseUp=function($V){if($q.instance.disableMouseEvent=!1,$y.stage.off("mouseup",this,this.onStageMouseUp),$y.stage.off("mouseout",this,this.onStageMouseUp),$y.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $U=this._offsets.length,$r=Math.min($U,6),$s=this._offsets.length-$r,$p=$U-1;$s<$p;$p--)this._offsetY+=this._offsets[$p--],this._offsetX+=this._offsets[$p];this._offsetX=this._offsetX/$r*2,this._offsetY=this._offsetY/$r*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$y.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$U.checkElastic=function(){var $V=NaN,$U=NaN;if(this.target.x<this.area.x?$V=this.area.x:this.target.x>this.area.x+this.area.width&&($V=this.area.x+this.area.width),this.target.y<this.area.y?$U=this.area.y:this.target.y>this.area.y+this.area.height&&($U=this.area.y+this.area.height),isNaN($V)&&isNaN($U))this.clear();else{var $r={};isNaN($V)||($r.x=$V),isNaN($U)||($r.y=$U),this._tween=$g.to(this.target,$r,this.elasticBackTime,$M.sineOut,$W.create(this,this.clear),0,!1,!1)}},$U.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($y.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$U.clear=function(){if(this.target){this.clearTimer();var $V=this.target;this.target=null,this._parent=null,$V.event("dragend",this.data)}},$V}()),$M=function(){function $T(){}return $u($T,"laya.utils.Ease"),$T.linearNone=function($V,$U,$r,$s){return $r*$V/$s+$U},$T.linearIn=function($V,$U,$r,$s){return $r*$V/$s+$U},$T.linearInOut=function($V,$U,$r,$s){return $r*$V/$s+$U},$T.linearOut=function($V,$U,$r,$s){return $r*$V/$s+$U},$T.bounceIn=function($V,$U,$r,$s){return $r-$T.bounceOut($s-$V,0,$r,$s)+$U},$T.bounceInOut=function($V,$U,$r,$s){return $V<.5*$s?.5*$T.bounceIn(2*$V,0,$r,$s)+$U:.5*$T.bounceOut(2*$V-$s,0,$r,$s)+.5*$r+$U},$T.bounceOut=function($V,$U,$r,$s){return($V/=$s)<1/2.75?$r*(7.5625*$V*$V)+$U:$V<2/2.75?$r*(7.5625*($V-=1.5/2.75)*$V+.75)+$U:$V<2.5/2.75?$r*(7.5625*($V-=2.25/2.75)*$V+.9375)+$U:$r*(7.5625*($V-=2.625/2.75)*$V+.984375)+$U},$T.backIn=function($V,$U,$r,$s,$p){return void 0===$p&&($p=1.70158),$r*($V/=$s)*$V*(($p+1)*$V-$p)+$U},$T.backInOut=function($V,$U,$r,$s,$p){return void 0===$p&&($p=1.70158),($V/=.5*$s)<1?.5*$r*($V*$V*((1+($p*=1.525))*$V-$p))+$U:$r/2*(($V-=2)*$V*((1+($p*=1.525))*$V+$p)+2)+$U},$T.backOut=function($V,$U,$r,$s,$p){return void 0===$p&&($p=1.70158),$r*(($V=$V/$s-1)*$V*(($p+1)*$V+$p)+1)+$U},$T.elasticIn=function($V,$U,$r,$s,$p,$c){var $R;return void 0===$p&&($p=0),void 0===$c&&($c=0),0==$V?$U:1==($V/=$s)?$U+$r:($c||($c=.3*$s),$R=!$p||0<$r&&$p<$r||$r<0&&$p<-$r?($p=$r,$c/4):$c/$T.PI2*Math.asin($r/$p),-$p*Math.pow(2,10*($V-=1))*Math.sin(($V*$s-$R)*$T.PI2/$c)+$U)},$T.elasticInOut=function($V,$U,$r,$s,$p,$c){var $R;return void 0===$p&&($p=0),void 0===$c&&($c=0),0==$V?$U:2==($V/=.5*$s)?$U+$r:($c||($c=$s*(.3*1.5)),$R=!$p||0<$r&&$p<$r||$r<0&&$p<-$r?($p=$r,$c/4):$c/$T.PI2*Math.asin($r/$p),$V<1?$p*Math.pow(2,10*($V-=1))*Math.sin(($V*$s-$R)*$T.PI2/$c)*-.5+$U:$p*Math.pow(2,-10*($V-=1))*Math.sin(($V*$s-$R)*$T.PI2/$c)*.5+$r+$U)},$T.elasticOut=function($V,$U,$r,$s,$p,$c){var $R;return void 0===$p&&($p=0),void 0===$c&&($c=0),0==$V?$U:1==($V/=$s)?$U+$r:($c||($c=.3*$s),$R=!$p||0<$r&&$p<$r||$r<0&&$p<-$r?($p=$r,$c/4):$c/$T.PI2*Math.asin($r/$p),$p*Math.pow(2,-10*$V)*Math.sin(($V*$s-$R)*$T.PI2/$c)+$r+$U)},$T.strongIn=function($V,$U,$r,$s){return $r*($V/=$s)*$V*$V*$V*$V+$U},$T.strongInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*$r*$V*$V*$V*$V*$V+$U:.5*$r*(($V-=2)*$V*$V*$V*$V+2)+$U},$T.strongOut=function($V,$U,$r,$s){return $r*(($V=$V/$s-1)*$V*$V*$V*$V+1)+$U},$T.sineInOut=function($V,$U,$r,$s){return.5*-$r*(Math.cos(Math.PI*$V/$s)-1)+$U},$T.sineIn=function($V,$U,$r,$s){return-$r*Math.cos($V/$s*$T.HALF_PI)+$r+$U},$T.sineOut=function($V,$U,$r,$s){return $r*Math.sin($V/$s*$T.HALF_PI)+$U},$T.quintIn=function($V,$U,$r,$s){return $r*($V/=$s)*$V*$V*$V*$V+$U},$T.quintInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*$r*$V*$V*$V*$V*$V+$U:.5*$r*(($V-=2)*$V*$V*$V*$V+2)+$U},$T.quintOut=function($V,$U,$r,$s){return $r*(($V=$V/$s-1)*$V*$V*$V*$V+1)+$U},$T.quartIn=function($V,$U,$r,$s){return $r*($V/=$s)*$V*$V*$V+$U},$T.quartInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*$r*$V*$V*$V*$V+$U:.5*-$r*(($V-=2)*$V*$V*$V-2)+$U},$T.quartOut=function($V,$U,$r,$s){return-$r*(($V=$V/$s-1)*$V*$V*$V-1)+$U},$T.cubicIn=function($V,$U,$r,$s){return $r*($V/=$s)*$V*$V+$U},$T.cubicInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*$r*$V*$V*$V+$U:.5*$r*(($V-=2)*$V*$V+2)+$U},$T.cubicOut=function($V,$U,$r,$s){return $r*(($V=$V/$s-1)*$V*$V+1)+$U},$T.quadIn=function($V,$U,$r,$s){return $r*($V/=$s)*$V+$U},$T.quadInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*$r*$V*$V+$U:.5*-$r*(--$V*($V-2)-1)+$U},$T.quadOut=function($V,$U,$r,$s){return-$r*($V/=$s)*($V-2)+$U},$T.expoIn=function($V,$U,$r,$s){return 0==$V?$U:$r*Math.pow(2,10*($V/$s-1))+$U-.001*$r},$T.expoInOut=function($V,$U,$r,$s){return 0==$V?$U:$V==$s?$U+$r:($V/=.5*$s)<1?.5*$r*Math.pow(2,10*($V-1))+$U:.5*$r*(2-Math.pow(2,-10*--$V))+$U},$T.expoOut=function($V,$U,$r,$s){return $V==$s?$U+$r:$r*(1-Math.pow(2,-10*$V/$s))+$U},$T.circIn=function($V,$U,$r,$s){return-$r*(Math.sqrt(1-($V/=$s)*$V)-1)+$U},$T.circInOut=function($V,$U,$r,$s){return($V/=.5*$s)<1?.5*-$r*(Math.sqrt(1-$V*$V)-1)+$U:.5*$r*(Math.sqrt(1-($V-=2)*$V)+1)+$U},$T.circOut=function($V,$U,$r,$s){return $r*Math.sqrt(1-($V=$V/$s-1)*$V)+$U},$T.HALF_PI=.5*Math.PI,$T.PI2=2*Math.PI,$T}(),$A=function(){function $S(){this._hit=null,this._unHit=null}$u($S,"laya.utils.HitArea");var $V=$S.prototype;return $V.isHit=function($V,$U){return!!$S.isHitGraphic($V,$U,this.hit)&&!$S.isHitGraphic($V,$U,this.unHit)},$V.contains=function($V,$U){return this.isHit($V,$U)},$b(0,$V,"hit",function(){return this._hit||(this._hit=new $_),this._hit},function($V){this._hit=$V}),$b(0,$V,"unHit",function(){return this._unHit||(this._unHit=new $_),this._unHit},function($V){this._unHit=$V}),$S.isHitGraphic=function($V,$U,$r){if(!$r)return!1;var $s;if(!($s=$r.cmds)&&$r._one&&(($s=$S._cmds).length=1,$s[0]=$r._one),!$s)return!1;var $p,$c,$R=0;for($p=$s.length,$R=0;$R<$p;$R++)if($c=$s[$R]){var $T=$m._context;switch($c.callee){case $T._translate:case 6:$V-=$c[0],$U-=$c[1]}if($S.isHitCmd($V,$U,$c))return!0}return!1},$S.isHitCmd=function($V,$U,$r){if(!$r)return!1;var $s=$m._context,$p=!1;switch($r.callee){case $s._drawRect:case 13:$S._rec.setTo($r[0],$r[1],$r[2],$r[3]),$p=$S._rec.contains($V,$U);break;case $s._drawCircle:case $s._fillCircle:case 14:$p=($V-=$r[0])*$V+($U-=$r[1])*$U<$r[2]*$r[2];break;case $s._drawPoly:case 18:$V-=$r[0],$U-=$r[1],$p=$S.ptInPolygon($V,$U,$r[2])}return $p},$S.ptInPolygon=function($V,$U,$r){var $s;($s=$S._ptPoint).setTo($V,$U);var $p,$c=0,$R=NaN,$T=NaN,$N=NaN,$t=NaN;$p=$r.length;for(var $b=0;$b<$p;$b+=2){if($R=$r[$b],$T=$r[$b+1],$N=$r[($b+2)%$p],$T!=($t=$r[($b+3)%$p]))if(!($s.y<Math.min($T,$t)))if(!($s.y>=Math.max($T,$t)))($s.y-$T)*($N-$R)/($t-$T)+$R>$s.x&&$c++}return $c%2==1},$S._cmds=[],$N($S,["_rec",function(){return this._rec=new $n},"_ptPoint",function(){return this._ptPoint=new $D}]),$S}(),$X=(function(){function $p($V,$U,$r,$s){this.char=$V,this.charNum=$V.charCodeAt(0),this._x=this._y=0,this.width=$U,this.height=$r,this.style=$s,this.isWord=!$p._isWordRegExp.test($V)}$u($p,"laya.utils.HTMLChar");var $V=$p.prototype;$y.imps($V,{"laya.display.ILayout":!0}),$V.setSprite=function($V){this._sprite=$V},$V.getSprite=function(){return this._sprite},$V._isChar=function(){return!0},$V._getCSSStyle=function(){return this.style},$b(0,$V,"width",function(){return this._w},function($V){this._w=$V}),$b(0,$V,"x",function(){return this._x},function($V){this._sprite&&(this._sprite.x=$V),this._x=$V}),$b(0,$V,"y",function(){return this._y},function($V){this._sprite&&(this._sprite.y=$V),this._y=$V}),$b(0,$V,"height",function(){return this._h},function($V){this._h=$V}),$p._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $U(){}$u($U,"laya.utils.Log"),$U.enable=function(){$U._logdiv||($U._logdiv=$j.window.document.createElement("div"),$j.window.document.body.appendChild($U._logdiv),$U._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$U.toggle=function(){var $V=$U._logdiv.style;"1px"==$V.width?$V.width=$V.height="50%":$V.width=$V.height="1px"},$U.print=function($V){$U._logdiv&&($U.maxCount<=$U._count&&$U.clear(),$U._count++,$U._logdiv.innerText+=$V+"\n",$U._logdiv.scrollTop=$U._logdiv.scrollHeight)},$U.clear=function(){$U._logdiv.innerText="",$U._count=0},$U._logdiv=null,$U._count=0,$U.maxCount=20}(),function(){function $U(){}$u($U,"laya.utils.Mouse"),$b(1,$U,"cursor",function(){return $U._style.cursor},function($V){$U._style.cursor=$V}),$U.hide=function(){"none"!=$U.cursor&&($U._preCursor=$U.cursor,$U.cursor="none")},$U.show=function(){"none"==$U.cursor&&($U.cursor=$U._preCursor?$U._preCursor:"auto")},$U._preCursor=null,$N($U,["_style",function(){return this._style=$j.document.body.style}])}(),function(){function $c(){}return $u($c,"laya.utils.Pool"),$c.getPoolBySign=function($V){return $c._poolDic[$V]||($c._poolDic[$V]=[])},$c.clearBySign=function($V){$c._poolDic[$V]&&($c._poolDic[$V].length=0)},$c.recover=function($V,$U){$U.__InPool||($U.__InPool=!0,$c.getPoolBySign($V).push($U))},$c.getItemByClass=function($V,$U){var $r=$c.getPoolBySign($V),$s=$r.length?$r.pop():new $U;return $s.__InPool=!1,$s},$c.getItemByCreateFun=function($V,$U,$r){var $s=$c.getPoolBySign($V),$p=$s.length?$s.pop():$U.call($r);return $p.__InPool=!1,$p},$c.getItem=function($V){var $U=$c.getPoolBySign($V),$r=$U.length?$U.pop():null;return $r&&($r.__InPool=!1),$r},$c._poolDic={},$c.InPoolSign="__InPool",$c}()),$e=function(){function $N(){}return $u($N,"laya.utils.Stat"),$b(1,$N,"onclick",null,function($V){$N._sp&&$N._sp.on("click",$N._sp,$V),$N._canvas&&($N._canvas.source.onclick=$V,$N._canvas.source.style.pointerEvents="")}),$N.show=function($V,$U,$r){if(void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),!$m.isConchApp||$m.isConchWebGL){if($m.isConchWebGL||$j.onMiniGame||$j.onLimixiu||($N._useCanvas=!0),$N._show=!0,$N._fpsData.length=60,$N._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$N._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$N._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$N._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$m.isWebGL)if($N._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$m.is3DMode){if($N._view[0].title="FPS(3D)",$N._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$N._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$N._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$r){var $s=8;$N._view[$s++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$N._view[$s++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$N._view[$s++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$r){$s=8;$N._view[$s++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$N._view[$s++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$N._view[$s++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$N._view[$s++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$N._view[$s++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$N._view[$s++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$N._view[$s++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $N._view[0].title="FPS(WebGL)",$N._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $N._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$N._useCanvas?$N.createUIPre($V,$U):$N.createUI($V,$U),$N.enable()}else $j.window.conch.showFPS&&$j.window.conch.showFPS($V,$U)},$N.createUIPre=function($V,$U){var $r=$j.pixelRatio;$N._width=170*$r,$N._vx=75*$r,$N._height=$r*(12*$N._view.length+3*$r)+4,$N._fontSize=12*$r;for(var $s=0;$s<$N._view.length;$s++)$N._view[$s].x=4,$N._view[$s].y=$s*$N._fontSize+2*$r;$N._canvas||(($N._canvas=new $OV("2D")).size($N._width,$N._height),($N._ctx=$N._canvas.getContext("2d")).textBaseline="top",$N._ctx.font=$N._fontSize+"px Sans-serif",$N._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$V+"px;top:"+$U+"px;width:"+$N._width/$r+"px;height:"+$N._height/$r+"px;"),$N._first=!0,$N.loop(),$N._first=!1,$j.container.appendChild($N._canvas.source)},$N.createUI=function($V,$U){var $r=$N._sp,$s=$j.pixelRatio;$r||($r=new $SV,($N._leftText=new $hV).pos(5,5),$N._leftText.color="#ffffff",$r.addChild($N._leftText),($N._txt=new $hV).pos(80*$s,5),$N._txt.color="#ffffff",$r.addChild($N._txt),$N._sp=$r),$r.pos($V,$U);for(var $p="",$c=0;$c<$N._view.length;$c++){$p+=$N._view[$c].title+"\n"}$N._leftText.text=$p;var $R=170*$s,$T=$s*(12*$N._view.length+3*$s)+4;$N._txt.fontSize=$N._fontSize*$s,$N._leftText.fontSize=$N._fontSize*$s,$r.size($R,$T),$r.graphics.clear(),$r.graphics.setAlpha(.5),$r.graphics.drawRect(0,0,$R,$T,"#999999"),$r.graphics.setAlpha(1),$N.loop()},$N.enable=function(){$y.timer.frameLoop(1,$N,$N.loop)},$N.hide=function(){$N._show=!1,$y.timer.clear($N,$N.loop),$N._canvas&&$j.removeElement($N._canvas.source)},$N.clear=function(){$N.trianglesFaces=$N.drawCall=$N.shaderCall=$N.spriteCount=$N.spriteRenderUseCacheCount=$N.treeNodeCollision=$N.treeSpriteCollision=$N.canvasNormal=$N.canvasBitmap=$N.canvasReCache=0},$N.loop=function(){$N._count++;var $V=$j.now();if(!($V-$N._timer<1e3)){var $U=$N._count;if($N.FPS=Math.round(1e3*$U/($V-$N._timer)),$N._show){$N.trianglesFaces=Math.round($N.trianglesFaces/$U),$N.spriteCount=$N._useCanvas?($N.drawCall=Math.round($N.drawCall/$U)-2,$N.shaderCall=Math.round($N.shaderCall/$U),Math.round($N.spriteCount/$U)-1):($N.drawCall=Math.round($N.drawCall/$U)-2,$N.shaderCall=Math.round($N.shaderCall/$U)-4,Math.round($N.spriteCount/$U)-4),$N.spriteRenderUseCacheCount=Math.round($N.spriteRenderUseCacheCount/$U),$N.canvasNormal=Math.round($N.canvasNormal/$U),$N.canvasBitmap=Math.round($N.canvasBitmap/$U),$N.canvasReCache=Math.ceil($N.canvasReCache/$U),$N.treeNodeCollision=Math.round($N.treeNodeCollision/$U),$N.treeSpriteCollision=Math.round($N.treeSpriteCollision/$U);var $r=0<$N.FPS?Math.floor(1e3/$N.FPS).toString():" ";$N._fpsStr=$N.FPS+($N.renderSlow?" slow":"")+" "+$r,$N._spriteStr=$N.spriteCount+($N.spriteRenderUseCacheCount?"/"+$N.spriteRenderUseCacheCount:""),$N._canvasStr=$N.canvasReCache+"/"+$N.canvasNormal+"/"+$N.canvasBitmap,$N.currentMemorySize=$$.systemResourceManager.memorySize,$N._useCanvas?$N.renderInfoPre():$N.renderInfo(),$N.clear()}$N._count=0,$N._timer=$V}},$N.renderInfoPre=function(){if($N._canvas){var $V=$N._ctx;$V.clearRect($N._first?0:$N._vx,0,$N._width,$N._height);for(var $U=$m.WebGL.mainContext,$r=0;$r<$N._view.length;$r++){var $s=$N._view[$r];$N._first&&($V.fillStyle="white",$V.fillText($s.title,$s.x,$s.y,null,null,null)),$V.fillStyle=$s.color;var $p=-1;if(($s=$N._view[$r]).varying){if($U)switch($s.varying){case 1:$p=$U.getParameter($U[$s.value]);break;case 2:$p=$U.getExtension($s.value)}}else $p=$N[$s.value];"M"==$s.units&&($p=Math.floor($p/1048576*100)/100+" M"),"K"==$s.units&&($p=Math.floor($p/1024*100)/100+" K"),"string"==$s.units&&($p=$p.match(/\d+\.?\d/i)),$V.fillText($p+"",$s.x+$N._vx,$s.y,null,null,null)}}},$N.renderInfo=function(){for(var $V="",$U=$m.WebGL.mainContext,$r=0;$r<$N._view.length;$r++){var $s=$N._view[$r],$p=-1;if($s.varying){if($U)switch($s.varying){case 1:$p=$U.getParameter($U[$s.value]);break;case 2:$p=$U.getExtension($s.value)}}else $p=$N[$s.value];"M"==$s.units&&($p=Math.floor($p/1048576*100)/100+" M"),"K"==$s.units&&($p=Math.floor($p/1024*100)/100+" K"),"string"==$s.units&&($p=$p.match(/\d+\.?\d/i)),$V+=$p+"\n"}$N._txt.text=$V},$N.FPS=0,$N.loopCount=0,$N.shaderCall=0,$N.drawCall=0,$N.trianglesFaces=0,$N.spriteCount=0,$N.spriteRenderUseCacheCount=0,$N.treeNodeCollision=0,$N.treeSpriteCollision=0,$N.canvasNormal=0,$N.canvasBitmap=0,$N.canvasReCache=0,$N.renderSlow=!1,$N.currentMemorySize=0,$N._fpsStr=null,$N._canvasStr=null,$N._spriteStr=null,$N._fpsData=[],$N._timer=0,$N._count=0,$N._view=[],$N._fontSize=12,$N._txt=null,$N._leftText=null,$N._sp=null,$N._show=!1,$N._useCanvas=!1,$N._canvas=null,$N._ctx=null,$N._first=!1,$N._vx=NaN,$N._width=0,$N._height=100,$N}(),$F=(function(){function $V(){this._strsToID={},this._idToStrs=[],this._length=0}$u($V,"laya.utils.StringKey");var $U=$V.prototype;$U.add=function($V){var $U=this._strsToID[$V];return null!=$U?$U:(this._idToStrs[this._length]=$V,this._strsToID[$V]=this._length++)},$U.getID=function($V){var $U=this._strsToID[$V];return null==$U?-1:$U},$U.getName=function($V){var $U=this._idToStrs[$V];return null==$U?void 0:$U}}(),function(){var $t;function $V(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$u($V,"laya.utils.Timer");var $U=$V.prototype;return $U._init=function(){$y.timer&&$y.timer.frameLoop(1,this,this._update)},$U._now=function(){return Date.now()},$U._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $V=this.currFrame=this.currFrame+this.scale,$U=this._now();this._delta=($U-this._lastTimer)*this.scale;var $r=this.currTimer=this.currTimer+this._delta;$y.isDebug&&6e4<Math.abs($U-this._lastTimer)&&console.error("系统时间错误！"+($U-this._lastTimer)),this._lastTimer=$U;var $s=this._handlers;for($R=this._count=0,$T=$s.length;$R<$T;$R++)if(null!==($N=$s[$R]).method){var $p=$N.userFrame?$V:$r;if($p>=$N.exeTime)if($N.repeat)if($N.jumpFrame)for(;$p>=$N.exeTime;)$N.exeTime+=$N.delay,$N.run(!1);else $N.exeTime+=$N.delay,$N.run(!1),$p>$N.exeTime&&($N.exeTime+=Math.ceil(($p-$N.exeTime)/$N.delay)*$N.delay);else $N.run(!0)}else this._count++;(30<this._count||$V%200==0)&&this._clearHandlers();for(var $c=this._laters,$R=0,$T=$c.length-1;$R<=$T;$R++){var $N=$c[$R];this._isIgnoreRecover($N)||(null!==$N.method&&(delete this._map[$N.key],$N.run(!1)),this._recoverHandler($N)),$R===$T&&($T=$c.length-1)}$c.length=0}},$U._clearHandlers=function(){for(var $V=this._handlers,$U=0,$r=$V.length;$U<$r;$U++){var $s=$V[$U];null!==$s.method?this._temp.push($s):this._isIgnoreRecover($s)?this._temp.push($s):this._recoverHandler($s)}this._handlers=this._temp,this._temp=$V,this._temp.length=0},$U._recoverHandler=function($V){this._map[$V.key]==$V&&delete this._map[$V.key],$V.recover()},$U._create=function($V,$U,$r,$s,$p,$c,$R,$T){if(!$r)return $p.apply($s,$c),null;if($R){var $N=this._getHandler($s,$p);if($N)return $N.repeat=$U,$N.userFrame=$V,$N.delay=$r,$N.ignoreRecover=$T,$N.caller=$s,$N.method=$p,$N.args=$c,$N.exeTime=$r+($V?this.currFrame:this.currTimer+this._now()-this._lastTimer),$N}return($N=$t.create()).repeat=$U,$N.userFrame=$V,$N.delay=$r,$N.ignoreRecover=$T,$N.caller=$s,$N.method=$p,$N.args=$c,$N.exeTime=$r+($V?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($N),this._handlers.push($N),$N},$U._indexHandler=function($V){var $U=$V.caller,$r=$V.method,$s=$U?$U.$_GID||($U.$_GID=$v.getGID()):0,$p=$r.$_TID||($r.$_TID=this._mid++);$V.key=$s+"_"+$p,this._map[$V.key]=$V},$U.once=function($V,$U,$r,$s,$p){void 0===$p&&($p=!0),this._create(!1,!1,$V,$U,$r,$s,$p,!1)},$U.loop=function($V,$U,$r,$s,$p,$c,$R){void 0===$p&&($p=!0),void 0===$c&&($c=!1),void 0===$R&&($R=!1);var $T=this._create(!1,!0,$V,$U,$r,$s,$p,$R);$T&&($T.jumpFrame=$c)},$U.frameOnce=function($V,$U,$r,$s,$p){void 0===$p&&($p=!0),this._create(!0,!1,$V,$U,$r,$s,$p,!1)},$U.frameLoop=function($V,$U,$r,$s,$p,$c){void 0===$p&&($p=!0),void 0===$c&&($c=!1),this._create(!0,!0,$V,$U,$r,$s,$p,$c)},$U.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$t._freeCount},$U.clear=function($V,$U){var $r=this._getHandler($V,$U);return!(!$r||this._isIgnoreRecover($r))&&(delete this._map[$r.key],$r.key=null,$r.clear(),!0)},$U.clearAll=function($V){if($V)for(var $U=0,$r=this._handlers.length;$U<$r;$U++){var $s=this._handlers[$U];$s.caller===$V&&(this._isIgnoreRecover($s)||(delete this._map[$s.key],$s.key=null,$s.clear()))}},$U._getHandler=function($V,$U){var $r=$V?$V.$_GID||($V.$_GID=$v.getGID()):0,$s=$U.$_TID||($U.$_TID=this._mid++);return this._map[$r+"_"+$s]},$U._isIgnoreRecover=function($V){if($V.ignoreRecover||$V.caller&&"IgnoreRecover"==$V.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $U="";try{arguments.propertyIsEnumerable.caller}catch($V){$U=$V.stack}$y.recordError("报错：核心定时器销毁忽略  "+$U)}return!0}return!1},$U.hasHandler=function($V,$U){return this._map[$V.$_GID+"_"+$U.$_TID]},$U.callLater=function($V,$U,$r){if(null==this._getHandler($V,$U)){var $s=$t.create();$s.caller=$V,$s.method=$U,$s.args=$r,this._indexHandler($s),this._laters.push($s)}},$U.runCallLater=function($V,$U){var $r=this._getHandler($V,$U);$r&&null!=$r.method&&(this._isIgnoreRecover($r)||(delete this._map[$r.key],$r.run(!0)))},$U.runTimer=function($V,$U){this.runCallLater($V,$U)},$b(0,$U,"delta",function(){return this._delta}),$V.__init$=function(){$t=function(){function $U(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$u($U,"");var $V=$U.prototype;return $V.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$V.recover=function(){this.clear(),this.args=$U._freeHandler,$U._freeHandler=this,$U._freeCount++},$V.run=function($V){var $U=this.caller;if($U&&$U.destroyed)return this.clear();var $r=this.method,$s=this.args;$V&&this.clear(),null!=$r&&($s?$r.apply($U,$s):$r.call($U))},$U._freeHandler=null,$U._freeCount=0,$U.create=function(){var $V=$U._freeHandler;return $V?($U._freeHandler=$V.args,--$U._freeCount,$V.args=null,$V):new $U},$U}()},$V}()),$g=function(){function $S(){this.gid=0}$u($S,"laya.utils.Tween");var $V=$S.prototype;return $V.to=function($V,$U,$r,$s,$p,$c,$R){return void 0===$c&&($c=0),void 0===$R&&($R=!1),this._create($V,$U,$r,$s,$p,$c,$R,!0,!1,!0)},$V.from=function($V,$U,$r,$s,$p,$c,$R){return void 0===$c&&($c=0),void 0===$R&&($R=!1),this._create($V,$U,$r,$s,$p,$c,$R,!1,!1,!0)},$V._create=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){if(!$V)throw new Error("Tween:target is null");this._target=$V,this._duration=$r,this._ease=$s||$U.ease||$S.easeNone,this._complete=$p||$U.complete,this._delay=$c,this._props=[],this._usedTimer=0,this._startTimer=$j.now(),this._usedPool=$N,this._delayParam=null,this.update=$U.update;var $b=$V.$_GID||($V.$_GID=$v.getGID());return $S.tweenMap[$b]?($R&&$S.clearTween($V),$S.tweenMap[$b].push(this)):$S.tweenMap[$b]=[this],$t?$c<=0?this.firstStart($V,$U,$T):(this._delayParam=[$V,$U,$T],$y.scaleTimer.once($c,this,this.firstStart,this._delayParam)):this._initProps($V,$U,$T),this},$V.firstStart=function($V,$U,$r){this._delayParam=null,$V.destroyed?this.clear():(this._initProps($V,$U,$r),this._beginLoop())},$V._initProps=function($V,$U,$r){for(var $s in $U)if("number"==typeof $V[$s]){var $p=$r?$V[$s]:$U[$s],$c=$r?$U[$s]:$V[$s];this._props.push([$s,$p,$c-$p]),$r||($V[$s]=$p)}},$V._beginLoop=function(){$y.scaleTimer.frameLoop(1,this,this._doEase)},$V._doEase=function(){this._updateEase($j.now())},$V._updateEase=function($V){var $U=this._target;if($U){if($U.destroyed)return $S.clearTween($U);var $r=this._usedTimer=$V-this._startTimer-this._delay;if(!($r<0)){if($r>=this._duration)return this.complete();for(var $s=0<$r?this._ease($r,0,1,this._duration):0,$p=this._props,$c=0,$R=$p.length;$c<$R;$c++){var $T=$p[$c];$U[$T[0]]=$T[1]+$s*$T[2]}this.update&&this.update.run()}}},$V.complete=function(){if(this._target){$y.scaleTimer.runTimer(this,this.firstStart);for(var $V=this._target,$U=this._props,$r=this._complete,$s=0,$p=$U.length;$s<$p;$s++){var $c=$U[$s];$V[$c[0]]=$c[1]+$c[2]}this.update&&this.update.run(),this.clear(),$r&&$r.run()}},$V.pause=function(){$y.scaleTimer.clear(this,this._beginLoop),$y.scaleTimer.clear(this,this._doEase),$y.scaleTimer.clear(this,this.firstStart);var $V;($V=$j.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$V)},$V.setStartTime=function($V){this._startTimer=$V},$V.clear=function(){this._target&&(this._remove(),this._clear())},$V._clear=function(){this.pause(),$y.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$X.recover("tween",this))},$V.recover=function(){this._usedPool=!0,this._clear()},$V._remove=function(){var $V=$S.tweenMap[this._target.$_GID];if($V)for(var $U=0,$r=$V.length;$U<$r;$U++)if($V[$U]===this){$V.splice($U,1);break}},$V.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$j.now(),this._delayParam)$y.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $V=this._props,$U=0,$r=$V.length;$U<$r;$U++){var $s=$V[$U];this._target[$s[0]]=$s[1]}$y.scaleTimer.once(this._delay,this,this._beginLoop)}},$V.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$j.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$y.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$b(0,$V,"progress",null,function($V){var $U=$V*this._duration;this._startTimer=$j.now()-this._delay-$U}),$S.to=function($V,$U,$r,$s,$p,$c,$R,$T){return void 0===$c&&($c=0),void 0===$R&&($R=!1),void 0===$T&&($T=!0),$X.getItemByClass("tween",$S)._create($V,$U,$r,$s,$p,$c,$R,!0,$T,!0)},$S.from=function($V,$U,$r,$s,$p,$c,$R,$T){return void 0===$c&&($c=0),void 0===$R&&($R=!1),void 0===$T&&($T=!0),$X.getItemByClass("tween",$S)._create($V,$U,$r,$s,$p,$c,$R,!1,$T,!0)},$S.clearAll=function($V){if($V&&$V.$_GID){var $U=$S.tweenMap[$V.$_GID];if($U){for(var $r=0,$s=$U.length;$r<$s;$r++)$U[$r]._clear();$U.length=0}}},$S.clear=function($V){$V.clear()},$S.clearTween=function($V){$S.clearAll($V)},$S.easeNone=function($V,$U,$r,$s){return $r*$V/$s+$U},$S.tweenMap={},$S}(),$v=function(){function $T(){}return $u($T,"laya.utils.Utils"),$T.toRadian=function($V){return $V*$T._pi2},$T.toAngle=function($V){return $V*$T._pi},$T.toHexColor=function($V){if($V<0||isNaN($V))return null;for(var $U=$V.toString(16);$U.length<6;)$U="0"+$U;return"#"+$U},$T.getGID=function(){return $T._gid++},$T.concatArray=function($V,$U){if(!$U)return $V;if(!$V)return $U;var $r=0,$s=$U.length;for($r=0;$r<$s;$r++)$V.push($U[$r]);return $V},$T.clearArray=function($V){return $V&&($V.length=0),$V},$T.copyArray=function($V,$U){if($V||($V=[]),!$U)return $V;$V.length=$U.length;var $r=0,$s=$U.length;for($r=0;$r<$s;$r++)$V[$r]=$U[$r];return $V},$T.getGlobalRecByPoints=function($V,$U,$r,$s,$p){var $c,$R;return $c=new $D($U,$r),$c=$V.localToGlobal($c),$R=new $D($s,$p),$R=$V.localToGlobal($R),$n._getWrapRec([$c.x,$c.y,$R.x,$R.y])},$T.getGlobalPosAndScale=function($V){return $T.getGlobalRecByPoints($V,0,0,1,1)},$T.bind=function($V,$U){return $V.bind($U)},$T.measureText=function($V,$U){return $w.measureText($V,$U)},$T.contextMeasureText=function($V){var $U=$j.context.measureText($V);return $U||($U={width:16,height:16}),$U},$T.updateOrder=function($V){if(!$V||$V.length<2)return!1;for(var $U,$r=1,$s=0,$p=$V.length,$c=NaN;$r<$p;){for($U=$V[$s=$r],$c=$V[$s]._zOrder;-1<--$s&&$V[$s]._zOrder>$c;)$V[$s+1]=$V[$s];$V[$s+1]=$U,$r++}var $R=$U.parent.conchModel;if($R)if(null!=$R.updateZOrder)$R.updateZOrder();else{for($r=0;$r<$p;$r++)$R.removeChild($V[$r].conchModel);for($r=0;$r<$p;$r++)$R.addChildAt($V[$r].conchModel,$r)}return!0},$T.transPointList=function($V,$U,$r){var $s=0,$p=$V.length;for($s=0;$s<$p;$s+=2)$V[$s]+=$U,$V[$s+1]+=$r},$T.parseInt=function($V,$U){void 0===$U&&($U=0);var $r=$j.window.parseInt($V,$U);return isNaN($r)?0:$r},$T.getFileExtension=function($V){$T._extReg.lastIndex=$V.lastIndexOf(".");var $U=$T._extReg.exec($V);return $U&&1<$U.length?$U[1].toLowerCase():null},$T.getTransformRelativeToWindow=function($V,$U,$r){var $s=$y.stage,$p=laya.utils.Utils.getGlobalPosAndScale($V),$c=$s._canvasTransform.clone(),$R=$c.tx,$T=$c.ty;$c.rotate(-Math.PI/180*$y.stage.canvasDegree),$c.scale($y.stage.clientScaleX,$y.stage.clientScaleY);var $N=$y.stage.canvasDegree%180!=0,$t=NaN,$b=NaN;$N?($t=$r+$p.y,$b=$U+$p.x,$t*=$c.d,$b*=$c.a,90==$y.stage.canvasDegree?($t=$R-$t,$b+=$T):($t+=$R,$b=$T-$b)):($t=$U+$p.x,$b=$r+$p.y,$t*=$c.a,$b*=$c.d,$t+=$R,$b+=$T);var $S=NaN,$_=NaN;return $_=$N?($S=$c.d*$p.height,$c.a*$p.width):($S=$c.a*$p.width,$c.d*$p.height),{x:$t,y:$b,scaleX:$S,scaleY:$_}},$T.fitDOMElementInArea=function($V,$U,$r,$s,$p,$c){$V._fitLayaAirInitialized||($V._fitLayaAirInitialized=!0,$V.style.transformOrigin=$V.style.webKittransformOrigin="left top",$V.style.position="absolute");var $R=$T.getTransformRelativeToWindow($U,$r,$s);$V.style.transform=$V.style.webkitTransform="scale("+$R.scaleX+","+$R.scaleY+") rotate("+$y.stage.canvasDegree+"deg)",$V.style.width=$p+"px",$V.style.height=$c+"px",$V.style.left=$R.x+"px",$V.style.top=$R.y+"px"},$T.isOkTextureList=function($V){if(!$V)return!1;var $U,$r=0,$s=$V.length;for($r=0;$r<$s;$r++)if(!($U=$V[$r])||!$U.source)return!1;return!0},$T.isOKCmdList=function($V){if(!$V)return!1;var $U,$r,$s=0,$p=$V.length,$c=$m._context;for($s=0;$s<$p;$s++)switch(($U=$V[$s]).callee){case $c._drawTexture:case $c._fillTexture:case $c._drawTextureWithTransform:if(!($r=$U[0])||!$r.source)return!1}return!0},$T._gid=1,$T._pi=180/Math.PI,$T._pi2=Math.PI/180,$T._extReg=/\.(\w+)\??/g,$T.parseXMLFromString=function($V){var $U;if($V=$V.replace(/>\s+</g,"><"),-1<($U=(new DOMParser).parseFromString($V,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($U.firstChild.firstChild.textContent);return $U},$T}(),$Y=function(){function $V(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$m.isWebGL&&$J.regCacheByFunction($v.bind(this.startDispose,this),$v.bind(this.getCacheList,this))}$u($V,"laya.utils.VectorGraphManager");var $U=$V.prototype;return $U.getId=function(){return this._id++},$U.addShape=function($V,$U){this.shapeDic[$V]=$U,this.useDic[$V]||(this.useDic[$V]=!0)},$U.addLine=function($V,$U){this.shapeLineDic[$V]=$U,this.shapeLineDic[$V]||(this.shapeLineDic[$V]=!0)},$U.getShape=function($V){this._checkKey&&null!=this.useDic[$V]&&(this.useDic[$V]=!0)},$U.deleteShape=function($V){this.shapeDic[$V]&&(this.shapeDic[$V]=null,delete this.shapeDic[$V]),this.shapeLineDic[$V]&&(this.shapeLineDic[$V]=null,delete this.shapeLineDic[$V]),null!=this.useDic[$V]&&delete this.useDic[$V]},$U.getCacheList=function(){var $V,$U=[];for($V in this.shapeDic)$U.push(this.shapeDic[$V]);for($V in this.shapeLineDic)$U.push(this.shapeLineDic[$V]);return $U},$U.startDispose=function($V){var $U;for($U in this.useDic)this.useDic[$U]=!1;this._checkKey=!0},$U.endDispose=function(){if(this._checkKey){var $V;for($V in this.useDic)this.useDic[$V]||this.deleteShape($V);this._checkKey=!1}},$V.getInstance=function(){return $V.instance=$V.instance||new $V},$V.instance=null,$V}(),$C=function(){function $s(){this._obj=null,this._obj=$s.supportWeakMap?new $j.window.WeakMap:{},$s.supportWeakMap||$s._maps.push(this)}$u($s,"laya.utils.WeakObject");var $V=$s.prototype;return $V.set=function($V,$U){if(null!=$V)if($s.supportWeakMap){var $r=$V;"string"!=typeof $V&&"number"!=typeof $V||($r=$s._keys[$V])||($r=$s._keys[$V]={k:$V}),this._obj.set($r,$U)}else"string"==typeof $V||"number"==typeof $V?this._obj[$V]=$U:($V.$_GID||($V.$_GID=$v.getGID()),this._obj[$V.$_GID]=$U)},$V.get=function($V){if(null==$V)return null;if($s.supportWeakMap){var $U="string"==typeof $V||"number"==typeof $V?$s._keys[$V]:$V;return $U?this._obj.get($U):null}return"string"==typeof $V||"number"==typeof $V?this._obj[$V]:this._obj[$V.$_GID]},$V.del=function($V){if(null!=$V)if($s.supportWeakMap){var $U="string"==typeof $V||"number"==typeof $V?$s._keys[$V]:$V;if(!$U)return;this._obj.delete($U)}else"string"==typeof $V||"number"==typeof $V?delete this._obj[$V]:delete this._obj[this._obj.$_GID]},$V.has=function($V){if(null==$V)return!1;if($s.supportWeakMap){var $U="string"==typeof $V||"number"==typeof $V?$s._keys[$V]:$V;return this._obj.has($U)}return"string"==typeof $V||"number"==typeof $V?null!=this._obj[$V]:null!=this._obj[this._obj.$_GID]},$s.__init__=function(){($s.supportWeakMap=null!=$j.window.WeakMap)||$y.timer.loop($s.delInterval,null,$s.clearCache)},$s.clearCache=function(){for(var $V=0,$U=$s._maps.length;$V<$U;$V++){$s._maps[$V]._obj={}}},$s.supportWeakMap=!1,$s.delInterval=3e5,$s._keys={},$s._maps=[],$N($s,["I",function(){return this.I=new $s}]),$s}(),$f=function(){function $V(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$u($V,"laya.utils.WordText");var $U=$V.prototype;return $U.setText=function($V){this.changed=!0,this._text=$V},$U.toString=function(){return this._text},$U.charCodeAt=function($V){return this._text?this._text.charCodeAt($V):NaN},$U.charAt=function($V){return this._text?this._text.charAt($V):null},$b(0,$U,"length",function(){return this._text?this._text.length:0}),$V}(),$VV=function($V){function $R(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$R.__super.call(this),this._childs=$R.ARRAY_EMPTY,this._$P=$R.PROP_EMPTY,this.timer=$y.scaleTimer,this.conchModel=$m.isConchNode?this.createConchModel():null}$u($R,"laya.display.Node",$t);var $U=$R.prototype;return $U._setBit=function($V,$U){1==$V&&(this._getBit($V)!=$U&&this._updateDisplayedInstage());$U?this._bits|=$V:this._bits&=~$V},$U._getBit=function($V){return 0!=(this._bits&$V)},$U._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$U._setUpNoticeType=function($V){var $U=this;for($U._setBit($V,!0),$U=$U.parent;$U;){if($U._getBit($V))return;$U._setBit($V,!0),$U=$U.parent}},$U.on=function($V,$U,$r,$s){return"display"!==$V&&"undisplay"!==$V||this._getBit(1)||this._setUpNoticeType(1),this._createListener($V,$U,$r,$s,!1)},$U.once=function($V,$U,$r,$s){return"display"!==$V&&"undisplay"!==$V||this._getBit(1)||this._setUpNoticeType(1),this._createListener($V,$U,$r,$s,!0)},$U.createConchModel=function(){return null},$U.destroy=function($V){void 0===$V&&($V=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($V?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$U.destroyChildren=function(){if(this._childs)for(var $V=this._childs.length-1;-1<$V;$V--)this._childs[$V].destroy(!0)},$U.addChild=function($V){if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),$V._parent===this){var $U=this.getChildIndex($V);$U!==this._childs.length-1&&(this._childs.splice($U,1),this._childs.push($V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,this._childs.length-1)),this._childChanged())}else $V.parent&&$V.parent.removeChild($V),this._childs===$R.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,this._childs.length-1),($V.parent=this)._childChanged();return $V},$U.addChildren=function($V){for(var $U=arguments,$r=0,$s=$U.length;$r<$s;)this.addChild($U[$r++])},$U.addChildAt=function($V,$U){if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),0<=$U&&$U<=this._childs.length){if($V._parent===this){var $r=this.getChildIndex($V);this._childs.splice($r,1),this._childs.splice($U,0,$V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,$U)),this._childChanged()}else $V.parent&&$V.parent.removeChild($V),this._childs===$R.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($U,0,$V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,$U),$V.parent=this;return $V}throw new Error("appendChildAt:The index is out of bounds")},$U.getChildIndex=function($V){return this._childs.indexOf($V)},$U.getChildByName=function($V){var $U=this._childs;if($U)for(var $r=0,$s=$U.length;$r<$s;$r++){var $p=$U[$r];if($p.name===$V)return $p}return null},$U._get$P=function($V){return this._$P[$V]},$U._set$P=function($V,$U){return this.destroyed||(this._$P===$R.PROP_EMPTY&&(this._$P={}),this._$P[$V]=$U),$U},$U.getChildAt=function($V){return this._childs[$V]},$U.setChildIndex=function($V,$U){var $r=this._childs;if($U<0||$U>=$r.length)throw new Error("setChildIndex:The index is out of bounds.");var $s=this.getChildIndex($V);if($s<0)throw new Error("setChildIndex:node is must child of this object.");return $r.splice($s,1),$r.splice($U,0,$V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,$U)),this._childChanged(),$V},$U._childChanged=function($V){},$U.removeChild=function($V){if(!this._childs)return $V;var $U=this._childs.indexOf($V);return this.removeChildAt($U)},$U.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$U.removeChildByName=function($V){var $U=this.getChildByName($V);return $U&&this.removeChild($U),$U},$U.removeChildAt=function($V){var $U=this.getChildAt($V);if($U){for(var $r=this._childs.length-1,$s=$V;$s<$r;++$s)this._childs[$s]=this._childs[$s+1];this._childs.length=$r,this.conchModel&&this.conchModel.removeChild($U.conchModel),$U.parent=null}return $U},$U.removeChildren=function($V,$U){if(void 0===$V&&($V=0),void 0===$U&&($U=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$V&&$c<=$U){var $s=$r;this._childs=$R.ARRAY_EMPTY}else $s=$r.splice($V,$U-$V);for(var $p=0,$c=$s.length;$p<$c;$p++)$s[$p].parent=null,this.conchModel&&this.conchModel.removeChild($s[$p].conchModel)}return this},$U.replaceChild=function($V,$U){var $r=this._childs.indexOf($U);return-1<$r?(this._childs.splice($r,1,$V),this.conchModel&&(this.conchModel.removeChild($U.conchModel),this.conchModel.addChildAt($V.conchModel,$r)),$U.parent=null,$V.parent=this,$V):null},$U._updateDisplayedInstage=function(){var $V;$V=this;var $U=$y.stage;for(this._displayedInStage=!1;$V;){if($V._getBit(1)){this._displayedInStage=$V._displayedInStage;break}if($V==$U||$V._displayedInStage){this._displayedInStage=!0;break}$V=$V.parent}},$U._setDisplay=function($V){this._displayedInStage!==$V&&((this._displayedInStage=$V)?this.event("display"):this.event("undisplay"))},$U._displayChild=function($V,$U){var $r=$V._childs;if($r)for(var $s=0;$s<$r.length;$s++){var $p=$r[$s];$p&&$p._getBit(1)&&(0<$p._childs.length?this._displayChild($p,$U):$p._setDisplay($U))}$V._setDisplay($U)},$U.contains=function($V){if($V===this)return!0;for(;$V;){if($V.parent===this)return!0;$V=$V.parent}return!1},$U.timerLoop=function($V,$U,$r,$s,$p,$c){void 0===$p&&($p=!0),void 0===$c&&($c=!1),this.timer.loop($V,$U,$r,$s,$p,$c)},$U.timerOnce=function($V,$U,$r,$s,$p){void 0===$p&&($p=!0),this.timer._create(!1,!1,$V,$U,$r,$s,$p)},$U.frameLoop=function($V,$U,$r,$s,$p){void 0===$p&&($p=!0),this.timer._create(!0,!0,$V,$U,$r,$s,$p)},$U.frameOnce=function($V,$U,$r,$s,$p){void 0===$p&&($p=!0),this.timer._create(!0,!1,$V,$U,$r,$s,$p)},$U.clearTimer=function($V,$U){this.timer.clear($V,$U)},$b(0,$U,"numChildren",function(){return this._childs.length}),$b(0,$U,"destroyed",function(){return this._destroyed}),$b(0,$U,"parent",function(){return this._parent},function($V){this._parent!==$V&&($V?(this._parent=$V,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$V.displayedInStage&&this._displayChild(this,!0)),$V._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$V))}),$b(0,$U,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$R.ARRAY_EMPTY=[],$R.PROP_EMPTY={},$R.NOTICE_DISPLAY=1,$R.MOUSEENABLE=2,$R}(),$UV=function($V){function $_($V){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$_.__super.call(this),this._padding=$_._PADDING,this._spacing=$_._SPACING,this._aligns=$_._ALIGNS,this._font=$G.EMPTY,this._ower=$V}$u($_,"laya.display.css.CSSStyle",$V);var $U=$_.prototype;return $U.destroy=function(){this._ower=null,this._font=null,this._rect=null},$U.inherit=function($V){this._font=$V._font,this._spacing=$V._spacing===$_._SPACING?$_._SPACING:$V._spacing.slice(),this.lineHeight=$V.lineHeight},$U._widthAuto=function(){return 0!=(262144&this._type)},$U.widthed=function($V){return 0!=(8&this._type)},$U._calculation=function($V,$U){if($U.indexOf("%")<0)return!1;var $s=this._ower,$p=$s.parent,$c=this._rect;function $R($V,$U,$r){return $V*$r[0]+$U*$r[1]+$r[2]}function $r($V){var $U=$p.width,$r=$s.width;$c.width&&($s.width=$R($U,$r,$c.width)),$c.height&&($s.height=$R($U,$r,$c.height)),$c.left&&($s.x=$R($U,$r,$c.left)),$c.top&&($s.y=$R($U,$r,$c.top))}null===$c&&($p._getCSSStyle()._type|=524288,$p.on("resize",this,$r),this._rect=$c={input:{}});var $T=$U.split(" ");return $T[0]=parseFloat($T[0])/100,1==$T.length?$T[1]=$T[2]=0:($T[1]=parseFloat($T[1])/100,$T[2]=parseFloat($T[2])),$c[$V]=$T,$c.input[$V]=$U,$r(),!0},$U.heighted=function($V){return 0!=(8192&this._type)},$U.size=function($V,$U){var $r=this._ower,$s=!1;-1!==$V&&$V!=this._ower.width&&(this._type|=8,this._ower.width=$V,$s=!0),-1!==$U&&$U!=this._ower.height&&(this._type|=8192,this._ower.height=$U,$s=!0),$s&&($r._layoutLater(),524288&this._type&&$r.event("resize",this))},$U._getAlign=function(){return this._aligns[0]},$U._getValign=function(){return this._aligns[1]},$U._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$U._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $G(this._font))},$U.render=function($V,$U,$r,$s){var $p=$V.width,$c=$V.height;$r-=$V.pivotX,$s-=$V.pivotY,this._bgground&&null!=this._bgground.color&&$U.ctx.fillRect($r,$s,$p,$c,this._bgground.color),this._border&&this._border.color&&$U.drawRect($r,$s,$p,$c,this._border.color.strColor,this._border.size)},$U.getCSSStyle=function(){return this},$U.cssText=function($V){this.attrs($_.parseOneCSS($V,";"))},$U.attrs=function($V){if($V)for(var $U=0,$r=$V.length;$U<$r;$U++){var $s=$V[$U];this[$s[0]]=$s[1]}},$U.setTransform=function($V){"none"===$V?this._tf=$T._TF_EMPTY:this.attrs($_.parseOneCSS($V,","))},$U.translate=function($V,$U){this._tf===$T._TF_EMPTY&&(this._tf=new $p),this._tf.translateX=$V,this._tf.translateY=$U},$U.scale=function($V,$U){this._tf===$T._TF_EMPTY&&(this._tf=new $p),this._tf.scaleX=$V,this._tf.scaleY=$U},$U._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$b(0,$U,"block",$V.prototype._$get_block,function($V){$V?this._type|=1:this._type&=-2}),$b(0,$U,"valign",function(){return $_._valigndef[this._aligns[1]]},function($V){this._aligns===$_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$_._valigndef[$V]}),$b(0,$U,"height",null,function($V){if(this._type|=8192,"string"==typeof $V){if(this._calculation("height",$V))return;$V=parseInt($V)}this.size(-1,$V)}),$b(0,$U,"width",null,function($V){if(this._type|=8,"string"==typeof $V){var $U=$V.indexOf("auto");if(0<=$U&&(this._type|=262144,$V=$V.substr(0,$U)),this._calculation("width",$V))return;$V=parseInt($V)}this.size($V,-1)}),$b(0,$U,"fontWeight",function(){return this._font.weight},function($V){this._createFont().weight=$V}),$b(0,$U,"left",null,function($V){var $U=this._ower;if("string"==typeof $V){if("center"===$V?$V="50% -50% 0":"right"===$V&&($V="100% -100% 0"),this._calculation("left",$V))return;$V=parseInt($V)}$U.x=$V}),$b(0,$U,"_translate",null,function($V){this.translate($V[0],$V[1])}),$b(0,$U,"absolute",function(){return 0!=(4&this._type)}),$b(0,$U,"top",null,function($V){var $U=this._ower;if("string"==typeof $V){if("middle"===$V?$V="50% -50% 0":"bottom"===$V&&($V="100% -100% 0"),this._calculation("top",$V))return;$V=parseInt($V)}$U.y=$V}),$b(0,$U,"align",function(){return $_._aligndef[this._aligns[0]]},function($V){this._aligns===$_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$_._aligndef[$V]}),$b(0,$U,"bold",function(){return this._font.bold},function($V){this._createFont().bold=$V}),$b(0,$U,"padding",function(){return this._padding},function($V){this._padding=$V}),$b(0,$U,"leading",function(){return this._spacing[1]},function($V){"string"==typeof $V&&($V=parseInt($V+"")),this._spacing===$_._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$V}),$b(0,$U,"lineElement",function(){return 0!=(65536&this._type)},function($V){$V?this._type|=65536:this._type&=-65537}),$b(0,$U,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($V){this.lineElement=!1,"right"===$V?this._type|=32768:this._type&=-32769}),$b(0,$U,"textDecoration",function(){return this._font.decoration},function($V){this._createFont().decoration=$V}),$b(0,$U,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($V){"nowrap"===$V&&(this._type|=131072),"none"===$V&&(this._type&=-131073)}),$b(0,$U,"background",null,function($V){$V?(this._bgground||(this._bgground={}),this._bgground.color=$V,this._ower.conchModel&&this._ower.conchModel.bgColor($V),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$b(0,$U,"wordWrap",function(){return 0==(131072&this._type)},function($V){$V?this._type&=-131073:this._type|=131072}),$b(0,$U,"color",function(){return this._font.color},function($V){this._createFont().color=$V}),$b(0,$U,"password",function(){return this._font.password},function($V){this._createFont().password=$V}),$b(0,$U,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($V){"none"===$V?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$V),this._ower.conchModel&&this._ower.conchModel.bgColor($V),this._ower._renderType|=256}),$b(0,$U,"font",function(){return this._font.toString()},function($V){this._createFont().set($V)}),$b(0,$U,"weight",null,function($V){this._createFont().weight=$V}),$b(0,$U,"letterSpacing",function(){return this._spacing[0]},function($V){"string"==typeof $V&&($V=parseInt($V+"")),this._spacing===$_._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$V}),$b(0,$U,"fontSize",function(){return this._font.size},function($V){this._createFont().size=$V}),$b(0,$U,"italic",function(){return this._font.italic},function($V){this._createFont().italic=$V}),$b(0,$U,"fontFamily",function(){return this._font.family},function($V){this._createFont().family=$V}),$b(0,$U,"stroke",function(){return this._font.stroke[0]},function($V){this._createFont().stroke===$G._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$V}),$b(0,$U,"strokeColor",function(){return this._font.stroke[1]},function($V){this._createFont().stroke===$G._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$V}),$b(0,$U,"border",function(){return this._border?this._border.value:""},function($V){if("none"!=$V){this._border||(this._border={});var $U=(this._border.value=$V).split(" ");if(this._border.color=$B.create($U[$U.length-1]),1==$U.length)return this._border.size=1,void(this._border.type="solid");var $r=0;0<$U[0].indexOf("px")?(this._border.size=parseInt($U[0]),$r++):this._border.size=1,this._border.type=$U[$r],this._ower._renderType|=256}else this._border=null}),$b(0,$U,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($V){$V?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$V?null:$B.create($V),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$b(0,$U,"position",function(){return 4&this._type?"absolute":""},function($V){"absolute"==$V?this._type|=4:this._type&=-5}),$b(0,$U,"display",null,function($V){switch($V){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$b(0,$U,"paddingLeft",function(){return this.padding[3]}),$b(0,$U,"paddingTop",function(){return this.padding[0]}),$b(0,$U,"_scale",null,function($V){this._ower.scale($V[0],$V[1])}),$b(0,$U,"_rotate",null,function($V){this._ower.rotation=$V}),$_.parseOneCSS=function($V,$U){for(var $r,$s=[],$p=$V.split($U),$c=0,$R=$p.length;$c<$R;$c++){var $T=$p[$c],$N=$T.indexOf(":"),$t=$T.substr(0,$N).replace(/^\s+|\s+$/g,"");if(0!=$t.length){var $b=$T.substr($N+1).replace(/^\s+|\s+$/g,""),$S=[$t,$b];switch($t){case"italic":case"bold":$S[1]="true"==$b;break;case"line-height":$S[0]="lineHeight",$S[1]=parseInt($b);break;case"font-size":$S[0]="fontSize",$S[1]=parseInt($b);break;case"padding":1<($r=$b.split(" ")).length||($r[1]=$r[2]=$r[3]=$r[0]),$S[1]=[parseInt($r[0]),parseInt($r[1]),parseInt($r[2]),parseInt($r[3])];break;case"rotate":$S[0]="_rotate",$S[1]=parseFloat($b);break;case"scale":$r=$b.split(" "),$S[0]="_scale",$S[1]=[parseFloat($r[0]),parseFloat($r[1])];break;case"translate":$r=$b.split(" "),$S[0]="_translate",$S[1]=[parseInt($r[0]),parseInt($r[1])];break;default:($S[0]=$_._CSSTOVALUE[$t])||($S[0]=$t)}$s.push($S)}}return $s},$_.parseCSS=function($V,$U){for(var $r;null!=($r=$_._parseCSSRegExp.exec($V));)$_.styleSheets[$r[1]]=$_.parseOneCSS($r[2],";")},$_.EMPTY=new $_(null),$_._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$_._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$_._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$_._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$_.styleSheets={},$_.ALIGN_CENTER=1,$_.ALIGN_RIGHT=2,$_.VALIGN_MIDDLE=1,$_.VALIGN_BOTTOM=2,$_._CSS_BLOCK=1,$_._DISPLAY_NONE=2,$_._ABSOLUTE=4,$_._WIDTH_SET=8,$_._PADDING=[0,0,0,0],$_._RECT=[-1,-1,-1,-1],$_._SPACING=[0,0],$_._ALIGNS=[0,0,0],$_.ADDLAYOUTED=512,$_._NEWFONT=4096,$_._HEIGHT_SET=8192,$_._BACKGROUND_SET=16384,$_._FLOAT_RIGHT=32768,$_._LINE_ELEMENT=65536,$_._NOWARP=131072,$_._WIDTHAUTO=262144,$_._LISTERRESZIE=524288,$_}($T),$rV=function($V){function $R(){this.url=null,this.audio=null,this.loaded=!1,$R.__super.call(this)}$u($R,"laya.media.h5audio.AudioSound",$t);var $U=$R.prototype;return $U.dispose=function(){var $V=$R._audioCache[this.url];$V&&($V.src="",delete $R._audioCache[this.url])},$U.load=function($V){var $U;if($V=$K.formatURL($V),(this.url=$V)==$H._tMusic?($R._initMusicAudio(),($U=$R._musicAudio).src!=$V&&($R._audioCache[$U.src]=null,$U=null)):$U=$R._audioCache[$V],$U&&2<=$U.readyState)this.event("complete");else{$U||($U=$V==$H._tMusic?($R._initMusicAudio(),$R._musicAudio):$j.createElement("audio"),($R._audioCache[$V]=$U).src=$V),$U.addEventListener("canplaythrough",$s),$U.addEventListener("error",$p);var $r=this;(this.audio=$U).load?$U.load():$p()}function $s(){$c(),$r.loaded=!0,$r.event("complete")}function $p(){$U.load=null,$c(),$r.event("error")}function $c(){$U.removeEventListener("canplaythrough",$s),$U.removeEventListener("error",$p)}},$U.play=function($V,$U,$r){if(void 0===$V&&($V=0),void 0===$U&&($U=0),!this.url)return null;var $s,$p;if(!($s=this.url==$H._tMusic?$R._musicAudio:$R._audioCache[this.url]))return null;$p=$X.getItem("audio:"+this.url),$m.isConchApp?$p||(($p=$j.createElement("audio")).src=this.url):this.url==$H._tMusic?($R._initMusicAudio(),($p=$R._musicAudio).src=this.url):$p=$p||$s.cloneNode(!0);var $c=new $_V($p);return $c.url=this.url,$c.loops=$U,$c.startTime=$V,$c.startHandler=$r,$c.play(!1),$H.addChannel($c),$c},$b(0,$U,"duration",function(){var $V;return($V=$R._audioCache[this.url])?$V.duration:0}),$R._initMusicAudio=function(){$R._musicAudio||($R._musicAudio||($R._musicAudio=$j.createElement("audio")),$m.isConchApp||$j.document.addEventListener("mousedown",$R._makeMusicOK))},$R._makeMusicOK=function(){$j.document.removeEventListener("mousedown",$R._makeMusicOK),$R._musicAudio.src?$R._musicAudio.play():($R._musicAudio.src="",$R._musicAudio.load())},$R._audioCache={},$R._musicAudio=null,$R}(),$sV=function($V){function $U(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$U.__super.call(this)}$u($U,"laya.media.SoundChannel",$t);var $r=$U.prototype;return $r.play=function(){},$r.stop=function(){},$r.pause=function(){},$r.resume=function(){},$r.__runComplete=function($V){$V&&$V.run()},$b(0,$r,"volume",function(){return 1},function($V){}),$b(0,$r,"position",function(){return 0}),$b(0,$r,"duration",function(){return 0}),$U}(),$pV=function($V){function $U(){$U.__super.call(this)}$u($U,"laya.media.Sound",$t);var $r=$U.prototype;return $r.load=function($V){},$r.play=function($V,$U,$r){return void 0===$V&&($V=0),void 0===$U&&($U=0),null},$r.dispose=function(){},$b(0,$r,"duration",function(){return 0}),$U}(),$cV=function($V){function $p(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$p.__super.call(this)}$u($p,"laya.media.webaudio.WebAudioSound",$t);var $U=$p.prototype;return $U.load=function($V){this.url=$V,this.audioBuffer=$p._dataCache[$V],this.audioBuffer?this._loaded(this.audioBuffer):($p.e.on("loaded:"+$V,this,this._loaded),$p.e.on("err:"+$V,this,this._err),$p.__loadingSound[$V]||($p.__loadingSound[$V]=!0,$y.loader.load($V,$W.create(this,this.onloaded),null,$TV.BUFFER,4,!1,null,!0)))},$U.onloaded=function($V){$V||this._err(),this._disposed?this._removeLoadEvents():(this.data=$V,$p.buffs.push({buffer:this.data,url:this.url}),$p.decode())},$U._err=function(){if(this._removeLoadEvents(),$p.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $V,$U,$r,$s=0;for($V=($U=this.__toPlays).length,$s=0;$s<$V;$s++)($r=$U[$s])[3]&&!$r[3].isStopped&&$r[3].event("error");this.__toPlays.length=0}},$U._loaded=function($V){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$V,this.loaded=!0,this.event("complete"))},$U._removeLoadEvents=function(){$p.e.off("loaded:"+this.url,this,this._loaded),$p.e.off("err:"+this.url,this,this._err)},$U.__playAfterLoaded=function(){if(this.__toPlays){var $V,$U,$r,$s=0;for($V=($U=this.__toPlays).length,$s=0;$s<$V;$s++)($r=$U[$s])[3]&&!$r[3].isStopped&&this.play($r[0],$r[1],$r[2],$r[3]);this.__toPlays.length=0}},$U.play=function($V,$U,$r,$s){return void 0===$V&&($V=0),void 0===$U&&($U=0),$s=$s||new $GV,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$V,$U,$r,$s]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$s.url=this.url,$s.loops=$U,$s.audioBuffer=this.audioBuffer,$s.startTime=$V,$s.startHandler=$r,$s.play(!1),$H.addChannel($s),$s},$U.dispose=function(){this._disposed=!0,delete $p._dataCache[this.url],delete $p.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$b(0,$U,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$p.decode=function(){if(!($p.buffs.length<=0||$p.isDecoding))if($p.isDecoding=!0,($p.tInfo=$p.buffs.shift())&&$p.tInfo.buffer&&$p.tInfo.buffer.byteLength)try{$p.ctx.decodeAudioData($p.tInfo.buffer,$p._done,$p._fail)}catch($V){console.error("decodeAudioData error  byteLength:"+$p.tInfo.buffer.byteLength+"  url:"+$p.tInfo.url)}else $p._fail()},$p._done=function($V){$p.e.event("loaded:"+$p.tInfo.url,$V),$p._dataCache[$p.tInfo.url]=$V,$p.isDecoding=!1,$p.decode()},$p._fail=function(){$p.e.event("err:"+$p.tInfo.url,null),$p.isDecoding=!1,$p.decode()},$p._playEmptySound=function(){if(null!=$p.ctx){if($p._emptySource&&($p._emptySource.stop(),$p._emptySource.disconnect(0),!$GV._tryCleanFailed))try{$p._emptySource.buffer=null}catch($V){$GV._tryCleanFailed=!0}var $V=$p.ctx.createBufferSource();$V.buffer=$p._miniBuffer,$V.connect($p.ctx.destination),$V.start(0,0,0),$p._emptySource=$V}},$p._unlock=function(){$p._unlocked||($p._playEmptySound(),"running"==$p.ctx.state?($j.document.removeEventListener("mousedown",$p._unlock,!0),$j.document.removeEventListener("touchend",$p._unlock,!0),$j.document.removeEventListener("touchstart",$p._unlock,!0),$p._unlocked=!0):"suspended"==$p.ctx.state&&$H._recoverWebAudio())},$p.initWebAudio=function(){"running"!=$p.ctx.state&&($p._unlock(),$j.document.addEventListener("mousedown",$p._unlock,!0),$j.document.addEventListener("touchend",$p._unlock,!0),$j.document.addEventListener("touchstart",$p._unlock,!0))},$p._emptySource=null,$p._dataCache={},$p.buffs=[],$p.isDecoding=!1,$p._unlocked=!1,$p.tInfo=null,$p.__loadingSound={},$N($p,["window",function(){return this.window=$j.window},"webAudioEnabled",function(){return this.webAudioEnabled=$p.window.AudioContext||$p.window.webkitAudioContext||$p.window.mozAudioContext},"ctx",function(){return this.ctx=$p.webAudioEnabled?new($p.window.AudioContext||$p.window.webkitAudioContext||$p.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$p.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $t}]),$p}(),$RV=function($V){function $U(){this._responseType=null,this._data=null,$U.__super.call(this),this._http=new $j.window.XMLHttpRequest}$u($U,"laya.net.HttpRequest",$t);var $r=$U.prototype;return $r.send=function($V,$U,$r,$s,$p){void 0===$r&&($r="get"),void 0===$s&&($s="text"),this._responseType=$s,this._data=null;var $c=this,$R=this._http;if($R.open($r,$V,!0),$p)for(var $T=0;$T<$p.length;$T++)$R.setRequestHeader($p[$T++],$p[$T]);else $m.isConchApp||($U&&"string"!=typeof $U?$R.setRequestHeader("Content-Type","application/json"):$R.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$R.responseType="arraybuffer"!==$s?"text":"arraybuffer",$R.onerror=function($V){$c._onError($V)},$R.onabort=function($V){$c._onAbort($V)},$R.onprogress=function($V){$c._onProgress($V)},$R.onload=function($V){$c._onLoad($V)},$R.send($U)},$r._onProgress=function($V){$V&&$V.lengthComputable&&this.event("progress",$V.loaded/$V.total)},$r._onAbort=function($V){this.error("Request was aborted by user")},$r._onError=function($V){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$r._onLoad=function($V){var $U=this._http,$r=void 0!==$U.status?$U.status:200;200===$r||204===$r||0===$r?this.complete():this.error("["+$U.status+"]"+$U.statusText+":"+$U.responseURL)},$r.error=function($V){this.clear(),this.event("error",$V)},$r.complete=function(){this.clear();var $U=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$v.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($V){$U=!1,this.error($V.message)}$U&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$r.clear=function(){var $V=this._http;$V.onerror=$V.onabort=$V.onprogress=$V.onload=null},$b(0,$r,"url",function(){return this._http.responseURL}),$b(0,$r,"http",function(){return this._http}),$b(0,$r,"data",function(){return this._data}),$U}(),$TV=function($V){function $I(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$I.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}$u($I,"laya.net.Loader",$t);var $U=$I.prototype;return $U.load=function($V,$U,$r,$s,$p){if($V&&""!=$V||console.error("Loader 加载的url不合法 "+$V),void 0===$r&&($r=!0),void 0===$p&&($p=!1),this._url=$V,this._base64=!1,0===$V.indexOf("data:image")?(this._base64=!0,this._type=$U="image"):this._type=$U||($U=this.getTypeFromUrl($V)),this._cache=$r,this._data=null,!$p&&$I.loadedMap[$V])return this._data=$I.loadedMap[$V],this.event("progress",1),void this.event("complete",this._data);if($s&&$I.setGroup($V,$s),null!=$I.parserMap[$U])return this._customParse=!0,void($I.parserMap[$U]instanceof laya.utils.Handler?$I.parserMap[$U].runWith(this):$I.parserMap[$U].call(null,this));if("image"===$U||"htmlimage"===$U||"nativeimage"===$U)return this._loadImage($V);if("ttf"===$U)return this._loadTTF($V);switch($U){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$U}$I.preLoadedMap[$V]?this.onLoaded($I.preLoadedMap[$V]):$R.resMgrLoad($V,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$U.getTypeFromUrl=function($V){var $U=$v.getFileExtension($V);return $U?$I.typeMap[$U]:(console.warn("Not recognize the resources suffix",$V),"text")},$U._loadTTF=function($V){$V=$K.formatURL($V);var $U=new $E;$U.complete=$W.create(this,this.onLoaded),$U.load($V)},$U._loadBase64Image=function($U){$U=$K.formatURL($U);var $r,$V=this;function $s(){$r.onload=null,$r.onerror=null,delete $I.imgCache[$U]}function $p(){$s(),$V.onLoaded($r)}function $c(){$s(),$V.event("error","Load image failed")}"nativeimage"===this._type?(($r=new $j.window.Image).crossOrigin="",$r.onload=$p,$r.onerror=$c,$r.src=$U,$I.imgCache[$U]=$r):new $kV.create($U,{onload:$p,onerror:$c,onCreate:function($V){$r=$V,$I.imgCache[$U]=$V}})},$U._loadImage=function($V){this._base64?this._loadBase64Image($V):$R.imgMgrLoad($V,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$U._loadImageComplete=function($V,$U,$r){if(null!=$r)if($r instanceof ArrayBuffer){var $s=new DataView($r),$p=new laya.webgl.resource.WebGLImage(new Uint8Array($r,8),$V,0,!1,$s.getUint32(0),$s.getUint32(4));this.onLoaded($p)}else if($r instanceof $bV)$I.imgMgrSet[$V]=$U,$R.imgMgrLock($V,$I.imgMgrSet[$V]),this._url=$V,this.complete($r);else{var $c=-1!=$V.indexOf(".png",$V.length-4)?6408:6407;$p=new laya.webgl.resource.WebGLImage($r,$V,$c,!1,$r.width,$r.height);this.onLoaded($p)}else this.event("error","Load image failed")},$U.imageCancel=function($V,$U,$r){$R.imgMgrCancel&&$R.imgMgrCancel($V,this._onImageCallback)},$U._loadSound=function($V){var $U=new $H._soundClass,$r=this;function $s(){$U.offAll()}$U.on("complete",this,function(){$s(),$r.onLoaded($U)}),$U.on("error",this,function(){$s(),$U.dispose(),$r.event("error","Load sound failed")}),$U.load($V)},$U.onProgress=function($V){"atlas"===this._type?this.event("progress",.3*$V):this.event("progress",$V)},$U.onError=function($V){this.event("error",$V)},$U._loadedComplete=function($V,$U,$r){if(null!=$r)switch(this._type){case"atlas":case"plf":case"json":var $s=new $o($r);this.onLoaded(JSON.parse($s.readUTFBytes()));break;case"font":$s=new $o($r);this.onLoaded($v.parseXMLFromString($s.readUTFBytes()));break;default:this.onLoaded($r)}else this.event("error",$V)},$U.onLoaded=function($V){var $U=this._type;if("plf"==$U)this.parsePLFData($V),this.complete($V);else if("image"===$U){var $r=new $bV($V);$r.url=this._url,this.complete($r)}else if("sound"===$U||"htmlimage"===$U||"nativeimage"===$U)this.complete($V);else if("atlas"===$U){if(!$V.src&&!$V._setContext){if(!this._data){if((this._data=$V).meta&&$V.meta.image)for(var $s=$V.meta.image.split(","),$p=0<=this._url.indexOf("/")?"/":"\\",$c=this._url.lastIndexOf($p),$R=0<=$c?this._url.substr(0,$c+1):"",$T=0,$N=$s.length;$T<$N;$T++)$s[$T]=$R+$s[$T];else $s=[this._url.replace(".json",".png")];$s.reverse(),$V.toLoads=$s,$V.pics=[]}return this.event("progress",.3+1/$s.length*.6),this._loadImage($s.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($V),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $t=this._data.frames,$b=this._url.split("?")[0],$S=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$b.substring(0,$b.lastIndexOf("."))+"/",$_=this._data.pics,$G=$K.formatURL(this._url),$q=$I.atlasMap[$G]||($I.atlasMap[$G]=[]);$q.dir=$S;var $u=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $h in $u=parseFloat(this._data.meta.scale),$t){var $l,$W=$t[$h],$O=$_[$W.frame.idx?$W.frame.idx:0],$L=$K.formatURL($S+$h);$O.scaleRate=$u,$l=$bV.create($O,$W.frame.x,$W.frame.y,$W.frame.w,$W.frame.h,$W.spriteSourceSize.x,$W.spriteSourceSize.y,$W.sourceSize.w,$W.sourceSize.h),$I.cacheRes($L,$l),$I.keepCache(this._url,$S+$h),$l.url=$L,$q.push($L)}else for($h in $t)$O=$_[($W=$t[$h]).frame.idx?$W.frame.idx:0],$L=$K.formatURL($S+$h),$I.cacheRes($L,$bV.create($O,$W.frame.x,$W.frame.y,$W.frame.w,$W.frame.h,$W.spriteSourceSize.x,$W.spriteSourceSize.y,$W.sourceSize.w,$W.sourceSize.h)),$I.loadedMap[$L].url=$L,$I.keepCache(this._url,$S+$h),$q.push($L);delete this._data.pics,this.complete(this._data)}else if("font"==$U){if(!$V.src)return this._data=$V,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $d=new $Q;$d.parseFont(this._data,$V);var $k=this._url.split(".fnt")[0].split("/"),$y=$k[$k.length-1];$hV.registerBitmapFont($y,$d),this._data=$d,this.complete(this._data)}else if("pkm"==$U){var $D=$kV.create($V,this._url),$n=new $bV($D);$n.url=this._url,this.complete($n)}else this.complete($V)},$U.parsePLFData=function($V){var $U,$r,$s;for($U in $V)switch($s=$V[$U],$U){case"json":case"text":for($r in $s)$I.preLoadedMap[$K.formatURL($r)]=$s[$r];break;default:for($r in $s)$I.preLoadedMap[$K.formatURL($r)]=$s[$r]}},$U.complete=function($V){this._data=$V,this._customParse?this.event("loaded",$V instanceof Array?[$V]:$V):($I._loaders.push(this),$I._isWorking||$I.checkNext())},$U.endLoad=function($V){$V&&(this._data=$V),this._cache&&$I.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$b(0,$U,"url",function(){return this._url}),$b(0,$U,"data",function(){return this._data}),$b(0,$U,"cache",function(){return this._cache}),$b(0,$U,"type",function(){return this._type}),$I.checkNext=function(){$I._isWorking=!0;for(var $V=$j.now();$I._startIndex<$I._loaders.length;)if($j.now(),$I._loaders[$I._startIndex].endLoad(),$I._startIndex++,$j.now()-$V>$I.maxTimeOut)return console.warn("loader callback cost a long time:"+($j.now()-$V)+" url="+$I._loaders[$I._startIndex-1].url),void $y.timer.frameOnce(1,null,$I.checkNext);$I._loaders.length=0,$I._startIndex=0,$I._isWorking=!1},$I.clearRes=function($V,$U){if(null!=$V){void 0===$U&&($U=!1),$V=$K.formatURL($V);var $r=$I.getAtlas($V);if($r){for(var $s=0,$p=$r.length;$s<$p;$s++){var $c=$r[$s],$R=$I.getRes($c);delete $I.loadedMap[$c],$I.clearCache($V.substring($K.basePath.length),$c.substring($K.basePath.length)),$R&&$R.destroy($U)}$r.length=0,delete $I.atlasMap[$V],delete $I.loadedMap[$V]}else{var $T=$I.loadedMap[$V];$T&&(delete $I.loadedMap[$V],$T instanceof laya.resource.Texture&&$T.bitmap&&$T.destroy($U))}}},$I.clearTextureRes=function($V){$V=$K.formatURL($V);var $U=laya.net.Loader.getAtlas($V),$r=$U&&0<$U.length?laya.net.Loader.getRes($U[0]):laya.net.Loader.getRes($V);$r&&$r.bitmap&&($m.isConchApp&&!$m.isConchWebGL?$r.bitmap.source.releaseTexture&&$r.bitmap.source.releaseTexture():null==$r.bitmap._atlaser&&$r.bitmap.releaseResource(!0))},$I.getRes=function($V){return $I.loadedMap[$K.formatURL($V)]},$I.getAtlas=function($V){return $I.atlasMap[$K.formatURL($V)]},$I.cacheRes=function($V,$U){$V=$K.formatURL($V),null!=$I.loadedMap[$V]?console.warn("Resources already exist,is repeated loading:",$V):$I.loadedMap[$V]=$U},$I.setGroup=function($V,$U){$I.groupMap[$U]||($I.groupMap[$U]=[]),$I.groupMap[$U].push($V)},$I.clearResByGroup=function($V){if($I.groupMap[$V]){var $U=$I.groupMap[$V],$r=0,$s=$U.length;for($r=0;$r<$s;$r++)$I.clearRes($U[$r]);$U.length=0}},$I.keepCache=function($V,$U){if($V&&$U){var $r=$I.cacheSet[$U];$r?-1==$r.indexOf($V)&&$r.push($V):$I.cacheSet[$U]=[$V]}},$I.clearCache=function($V,$U){if($V&&$U){var $r=$I.cacheSet[$U];if($r){var $s=$r.indexOf($V);if(-1!==$s){var $p=$r.length-1;0==$p?(delete $I.cacheSet[$U],0<$I.imgMgrSet[$U]?$R.imgMgrFree($U,$I.imgMgrSet[$U]):$I.clearRes($U,!0)):($r[$s]=$r[$p],$r.length=$p)}}}},$I.saveObject=function($V,$U,$r){if($U&&$V){var $s=$I.objectSet[$V];$s?(console.warn("Loader.saveObject: "+$V),$s[0]=$U,$s[1]=$r):$I.objectSet[$V]=[$U,$r,[]]}},$I.findObject=function($V){if($V){var $U=$I.objectSet[$V];if($U)return $U[0]}return null},$I.keepObject=function($V,$U){if($V&&$U){var $r=$I.objectSet[$U];$r&&-1===$r[2].indexOf($V)&&$r[2].push($V)}},$I.clearObject=function($V,$U){if($V&&$U){var $r=$I.objectSet[$U];if($r){var $s=$r[2],$p=$s.indexOf($V);if(-1!==$p){var $c=$s.length-1;0==$c?(delete $I.objectSet[$U],$r[1]&&$r[1].call(null,$r[0])):($s[$p]=$s[$c],$s.length=$c)}}}},$I.TEXT="text",$I.JSON="json",$I.XML="xml",$I.BUFFER="arraybuffer",$I.IMAGE="image",$I.SOUND="sound",$I.ATLAS="atlas",$I.FONT="font",$I.TTF="ttf",$I.PLF="plf",$I.PKM="pkm",$I.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$I.parserMap={},$I.groupMap={},$I.maxTimeOut=100,$I.loadedMap={},$I.preLoadedMap={},$I.atlasMap={},$I._loaders=[],$I._isWorking=!1,$I._startIndex=0,$I.imgCache={},$I.cacheSet={},$I.objectSet={},$I.imgMgrSet={},$I}(),$NV=function($V){var $_;function $G(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$G.__super.call(this);for(var $V=0;$V<this._maxPriority;$V++)this._resInfos[$V]=[]}$u($G,"laya.net.LoaderManager",$t);var $U=$G.prototype;return $U.create=function($V,$r,$U,$s,$p,$c,$R,$T){if(null==$c&&($c=2),null==$R&&($R=!0),$V instanceof Array){var $N=$V,$t=$N.length,$b=0;if($U)var $S=$W.create($U.caller,$U.method,$U.args,!1);for(var $_=0;$_<$t;$_++){var $G=$N[$_];"string"==typeof $G&&($G=$N[$_]={url:$G}),$G.progress=0}for($_=0;$_<$t;$_++){$G=$N[$_];var $q=$U?$W.create(null,$l,[$G],!1):null,$u=$U||$r?$W.create(null,$h,[$G]):null;this._create($G.url,$u,$q,$G.clas||$s,$G.params||$p,null!=$G.priority&&0<=$G.priority?$G.priority:$c,$R,$G.group||$T)}function $h($V,$U){$b++,$V.progress=1,$b===$t&&$r&&$r.run()}function $l($V,$U){$V.progress=$U;for(var $r=0,$s=0;$s<$t;$s++){$r+=$N[$s].progress}var $p=$r/$t;$S.runWith($p)}return!0}return this._create($V,$r,$U,$s,$p,$c,$R,$T)},$U._create=function($U,$r,$V,$s,$p,$c,$R,$T){$U&&""!=$U||console.error("加载的url不合法 "+$U),null==$c&&($c=2),null==$R&&($R=!0);var $N=$K.formatURL($U),$t=this.getRes($N);if($t)!$t.hasOwnProperty("loaded")||$t.loaded?($V&&$V.runWith(1),$r&&$r.run()):$r&&$y.loader._createListener($U,$r.caller,$r.method,$r.args,!0,!1);else{var $b=$v.getFileExtension($U),$S=$G.createMap[$b];if(!$S)throw new Error("LoaderManager:unknown file("+$U+") extension with: "+$b+".");$s||($s=$S[0]);var $_=$S[1];if("atlas"==$b)this.load($U,$r,$V,$_,$c,$R);else{$s===$bV&&($_="htmlimage"),($t=$s?new $s:null).hasOwnProperty("_loaded")&&($t._loaded=!1),$t._setUrl($U),$T&&$t._setGroup($T),this._createLoad($t,$U,$W.create(null,function($V){$t&&!$t.destroyed&&$V&&$t.onAsynLoaded.call($t,$U,$V,$p),$r&&$r.run();$y.loader.event($U)}),$V,$_,$c,!1,$T,!0),$R&&this.cacheRes($N,$t)}}return $t},$U.load=function($V,$U,$r,$s,$p,$c,$R,$T){$V&&""!=$V||console.error("加载的url不合法 "+$V);var $N=this;if(null==$p&&($p=2),null==$c&&($c=!0),void 0===$T&&($T=!1),$V instanceof Array)return this._loadAssets($V,$U,$r,$s,$p,$c,$R);var $t=$TV.getRes($V);if(null!=$t)$y.timer.frameOnce(1,null,function(){$r&&$r.runWith(1),$U&&$U.runWith($t),$N._loaderCount||$N.event("complete")});else{var $b=$G._resMap[$V];$b?($U&&$b._createListener("complete",$U.caller,$U.method,$U.args,!1,!1),$r&&$b._createListener("progress",$r.caller,$r.method,$r.args,!1,!1)):(($b=this._infoPool.length?this._infoPool.pop():new $_).url=$V,$b.clas=null,$b.type=$s,$b.cache=$c,$b.group=$R,$b.ignoreCache=$T,$b.priority=$p,$U&&$b.on("complete",$U.caller,$U.method,$U.args),$r&&$b.on("progress",$r.caller,$r.method,$r.args),$G._resMap[$V]=$b,$p=$p<this._maxPriority?0<=$p?$p:0:this._maxPriority-1,this._resInfos[$p].push($b),this._next())}return this},$U.cancel=function($V,$U,$r){if($t=$G._resMap[$V]){$U&&$t.off("complete",$U.caller,$U.method,!1),$r&&$t.off("progress",$r.caller,$r.method,!1);var $s=$t.getListener("complete"),$p=$t.getListener("progress");if(!($s&&$s.head||$p&&$p.head)){if($t.loader){var $c=$t.loader;$c.imageCancel($V),$c.offAll(),$c._data=null,$c._customParse=!1,$c._url=null,$c._class=null,$c._type=null,this._loaders.push($c),this._loaderCount--,delete this._loaderMap[$t.url]}for(var $R=0;$R<this._maxPriority;$R++)for(var $T=this._resInfos[$R],$N=$T.length-1;-1<$N;$N--){var $t;($t=$T[$N])&&$t.url===$V&&($T[$N]=null,$t.destroy(),$t.offAll(),this._infoPool.push($t))}delete $G._resMap[$V],this._next()}}},$U._createLoad=function($V,$U,$r,$s,$p,$c,$R,$T,$N){var $t=this;if(null==$c&&($c=2),null==$R&&($R=!0),void 0===$N&&($N=!1),$U instanceof Array)return this._loadAssets($U,$r,$s,$p,$c,$R,$T);var $b=$TV.getRes($U);if(null!=$b)$y.timer.frameOnce(1,null,function(){$s&&$s.runWith(1),$r&&$r.runWith($b),$t._loaderCount||$t.event("complete")});else{var $S=$G._resMap[$U];$S?($r&&$S._createListener("complete",$r.caller,$r.method,$r.args,!1,!1),$s&&$S._createListener("progress",$s.caller,$s.method,$s.args,!1,!1)):(($S=this._infoPool.length?this._infoPool.pop():new $_).url=$U,$S.clas=$V,$S.type=$p,$S.cache=$R,$S.group=$T,$S.ignoreCache=$N,$S.priority=$c,$r&&$S.on("complete",$r.caller,$r.method,$r.args),$s&&$S.on("progress",$s.caller,$s.method,$s.args),$G._resMap[$U]=$S,$c=$c<this._maxPriority?0<=$c?$c:0:this._maxPriority-1,this._resInfos[$c].push($S),this._next())}return this},$U._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $V=0;$V<this._maxPriority;$V++)for(var $U=this._resInfos[$V];0<$U.length;){var $r=$U.shift();if($r)return this._doLoad($r)}this._loaderCount||this.event("complete")}},$U._doLoad=function($U){var $r=this._loaders.length?this._loaders.pop():new $TV;this._loaderCount++,(this._loaderMap[$U.url]=$r).on("complete",null,$p),$r.on("progress",null,function($V){$U.event("progress",$V)}),$r.on("error",null,function($V){$p(null)}),$U.loader=$r;var $s=this;function $p($V){$r.offAll(),$r._data=null,$r._customParse=!1,$r._url=null,$r._class=null,$r._type=null,$s._loaders.push($r),$s._loaderCount--,delete $s._loaderMap[$U.url],$s._endLoad($U,$V instanceof Array?[$V]:$V),$s._next()}$r._class=$U.clas,1<=$U.priority?($r.priority=$U.priority,$r.realTime=!1):($r.priority=0,$r.realTime=!0),$r.load($U.url,$U.type,$U.cache,$U.group,$U.ignoreCache)},$U._endLoad=function($V,$U){var $r=$V.url;if(null==$U){var $s=this._failRes[$r]||0;if($s<this.retryNum)return console.warn("[warn]Retry to load:",$r),this._failRes[$r]=$s+1,void $y.timer.once(this.retryDelay,this,this._addReTry,[$V],!1);console.warn("[error]Failed to load:",$r),this.event("error",$r)}this._failRes[$r]&&(this._failRes[$r]=0),delete $G._resMap[$r],$V.event("complete",$U),$V.destroy(),$V.offAll(),this._infoPool.push($V)},$U._addReTry=function($V){this._resInfos[this._maxPriority-1].push($V),this._next()},$U.clearRes=function($V,$U){void 0===$U&&($U=!1),$TV.clearRes($V,$U)},$U.getRes=function($V){return $TV.getRes($V)},$U.cacheRes=function($V,$U){$TV.cacheRes($V,$U)},$U.clearTextureRes=function($V){$TV.clearTextureRes($V)},$U.setGroup=function($V,$U){$TV.setGroup($V,$U)},$U.clearResByGroup=function($V){$TV.clearResByGroup($V)},$U.clearUnLoaded=function(){for(var $V=0;$V<this._maxPriority;$V++){for(var $U=this._resInfos[$V],$r=$U.length-1;-1<$r;$r--){var $s=$U[$r];$s&&($s.destroy(),$s.offAll(),this._infoPool.push($s))}$U.length=0}this._loaderCount=0,$G._resMap={}},$U.cancelLoadByUrls=function($V){if($V)for(var $U=0,$r=$V.length;$U<$r;$U++)this.cancelLoadByUrl($V[$U])},$U.cancelLoadByUrl=function($V){for(var $U=0;$U<this._maxPriority;$U++)for(var $r=this._resInfos[$U],$s=$r.length-1;-1<$s;$s--){var $p=$r[$s];$p&&$p.url===$V&&($r[$s]=null,$p.destroy(),$p.offAll(),this._infoPool.push($p))}$G._resMap[$V]&&delete $G._resMap[$V]},$U._loadAssets=function($V,$r,$R,$U,$s,$p,$c){null==$s&&($s=2),null==$p&&($p=!0);for(var $T=$V.length,$N=0,$t=0,$b=[],$S=!0,$_=0;$_<$T;$_++){var $G=$V[$_];if(!$G)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$V);"string"==typeof $G&&($G={url:$G,type:$U,size:1,priority:$s}),$G.size||($G.size=1),$G.progress=0,$t+=$G.size,$b.push($G);var $q=$R?$W.create(null,$l,[$G],!1):null,$u=$r||$R?$W.create(null,$h,[$G]):null;this.load($G.url,$u,$q,$G.type,null!=$G.priority&&0<=$G.priority?$G.priority:2,$p,$G.group||$c)}function $h($V,$U){$N++,$V.progress=1,$U||($S=!1),$N===$T&&$r&&$r.runWith($S)}function $l($V,$U){if(null!=$R){$V.progress=$U;for(var $r=0,$s=0;$s<$b.length;$s++){var $p=$b[$s];$r+=$p.size*$p.progress}var $c=$r/$t;$R.runWith($c)}}return this},$G.cacheRes=function($V,$U){$TV.cacheRes($V,$U)},$G._resMap={},$N($G,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$G.__init$=function(){$_=function($V){function $U(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$U.__super.call(this)}return $u($U,"",$t),$U.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$U}()},$G}(),$tV=(function($V){function $p($V){$p.__super.call(this),$V||($V=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $U=0,$r=0,$s=0;$s<20;$s++)$s%5!=4?this._mat[$U++]=$V[$s]:this._alpha[$r++]=$V[$s];this._action=$w.createFilterAction(32),this._action.data=this}$u($p,"laya.filters.ColorFilter",$l);var $U=$p.prototype;$y.imps($U,{"laya.filters.IFilter":!0}),$U.callNative=function($V){$V._$P.cf=this;$V.conchModel&&$V.conchModel.setFilterMatrix&&$V.conchModel.setFilterMatrix(this._mat,this._alpha)},$b(0,$U,"type",function(){return 32}),$b(0,$U,"action",function(){return this._action})}(),function($V){function $s($V,$U,$r){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$U&&($U=0),$s.__super.call(this),this._byteClass=$r||$o,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$V&&0<$U&&$U<65535&&this.connect($V,$U)}$u($s,"laya.net.Socket",$t);var $U=$s.prototype;$U.connect=function($V,$U){var $r="ws://"+$V+":"+$U;$r="https:"==$j.window.location.protocol?"wss://"+$V+":"+$U:"ws://"+$V+":"+$U,this.connectByUrl($r)},$U.connectByUrl=function($V){var $U=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $j.window.WebSocket($V,this.protocols):this._socket=new $j.window.WebSocket($V),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($V){$U._onOpen($V)},this._socket.onmessage=function($V){$U._onMessage($V)},this._socket.onclose=function($V){$U._onClose($V)},this._socket.onerror=function($V){$U._onError($V)}},$U.cleanSocket=function(){try{this._socket.close()}catch($V){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$U.close=function(){if(null!=this._socket)try{this._socket.close()}catch($V){}},$U._onOpen=function($V){this._connected=!0,this.event("open",$V)},$U._onMessage=function($V){if($V&&$V.data){var $U=$V.data;if(this.disableInput&&$U)this.event("message",$U);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $r=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$U&&("string"==typeof $U?this._input.writeUTFBytes($U):this._input.writeArrayBuffer($U),this._addInputPosition=this._input.pos,this._input.pos=$r),this.event("message",$U)}}},$U._onClose=function($V){this._connected=!1,this.event("close",$V)},$U._onError=function($V){this.event("error",$V)},$U.send=function($V){this._socket.send($V)},$U.flush=function(){if(this._output&&0<this._output.length){var $U;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($V){$U=$V}this._output.endian=this.endian,this._output.clear(),$U&&this.event("error",$U)}},$b(0,$U,"input",function(){return this._input}),$b(0,$U,"output",function(){return this._output}),$b(0,$U,"connected",function(){return this._connected}),$b(0,$U,"endian",function(){return this._endian},function($V){this._endian=$V,null!=this._input&&(this._input.endian=$V),null!=this._output&&(this._output.endian=$V)}),$s.LITTLE_ENDIAN="littleEndian",$s.BIG_ENDIAN="bigEndian"}(),function($V){function $T(){$T.__super.call(this),this._$1__id=++$T._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($T._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$$.currentResourceManager&&$$.currentResourceManager.addResource(this)}$u($T,"laya.resource.Resource",$t);var $U=$T.prototype;return $y.imps($U,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$U._setUrl=function($V){var $U;this._url!==$V&&(this._url&&(($U=$T._urlResourcesMap[this._url]).splice($U.indexOf(this),1),0===$U.length&&delete $T._urlResourcesMap[this._url]),$V&&(($U=$T._urlResourcesMap[$V])||($T._urlResourcesMap[$V]=$U=[]),$U.push(this)),this._url=$V)},$U._getGroup=function(){return this._group},$U._setGroup=function($V){var $U;this._group!==$V&&(this._group&&(($U=$T._groupResourcesMap[this._group]).splice($U.indexOf(this),1),0===$U.length&&delete $T._groupResourcesMap[this._group]),$V&&(($U=$T._groupResourcesMap[$V])||($T._groupResourcesMap[$V]=$U=[]),$U.push(this)),this._group=$V)},$U._addReference=function(){this._referenceCount++},$U._removeReference=function(){this._referenceCount--},$U._clearReference=function(){this._referenceCount=0},$U._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$U.recreateResource=function(){this.completeCreate()},$U.disposeResource=function(){},$U.activeResource=function($V){void 0===$V&&($V=!1),this._lastUseFrameCount=$e.loopCount,!this._destroyed&&this.__loaded&&(this._released||$V)&&this.recreateResource()},$U.releaseResource=function($V){return void 0===$V&&($V=!0),!(!$V&&this.lock)&&(!(this._released&&!$V)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$U.onAsynLoaded=function($V,$U,$r){throw new Error("Resource: must override this function!")},$U.destroy=function(){var $V;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $T._idResourcesMap[this.id],this._url&&(($V=$T._urlResourcesMap[this._url])&&($V.splice($V.indexOf(this),1),0===$V.length&&delete $T._urlResourcesMap[this.url]),$TV.clearRes(this._url),this.__loaded||$w.cancelLoadByUrl(this._url)),this._group&&(($V=$T._groupResourcesMap[this._group]).splice($V.indexOf(this),1),0===$V.length&&delete $T._groupResourcesMap[this.url]))},$U.completeCreate=function(){this._released=!1,this.event("recovered",this)},$U.dispose=function(){this.destroy()},$b(0,$U,"memorySize",function(){return this._memorySize},function($V){var $U=$V-this._memorySize;this._memorySize=$V,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$U),this.resourceManager&&this.resourceManager.addSize($U)}),$b(0,$U,"_loaded",null,function($V){this.__loaded=$V}),$b(0,$U,"loaded",function(){return this.__loaded}),$b(0,$U,"id",function(){return this._$1__id}),$b(0,$U,"destroyed",function(){return this._destroyed}),$b(0,$U,"group",function(){return this._getGroup()},function($V){this._setGroup($V)}),$b(0,$U,"resourceManager",function(){return this._resourceManager}),$b(0,$U,"url",function(){return this._url}),$b(0,$U,"released",function(){return this._released}),$b(0,$U,"referenceCount",function(){return this._referenceCount}),$T.getResourceByID=function($V){return $T._idResourcesMap[$V]},$T.getResourceByURL=function($V,$U){return void 0===$U&&($U=0),null==$T._urlResourcesMap[$V]?null:$T._urlResourcesMap[$V][$U]},$T.getResourceCountByURL=function($V){return $T._urlResourcesMap[$V].length},$T.destroyUnusedResources=function($V){var $U;if($V){var $r=$T._groupResourcesMap[$V];if($r)for(var $s=$r.slice(),$p=0,$c=$s.length;$p<$c;$p++)($U=$s[$p]).lock||0!==$U._referenceCount||$U.destroy()}else for(var $R in $T._idResourcesMap)($U=$T._idResourcesMap[$R]).lock||0!==$U._referenceCount||$U.destroy()},$T._uniqueIDCounter=0,$T._idResourcesMap={},$T._urlResourcesMap={},$T._groupResourcesMap={},$T}()),$bV=function($V){function $I($V,$U){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$I.__super.call(this),$V&&null!=$V._addReference&&$V._addReference(),this.setTo($V,$U)}$u($I,"laya.resource.Texture",$t);var $U=$I.prototype;return $U._setUrl=function($V){this.url=$V},$U.setTo=function($V,$U){if($V instanceof $R.HTMLElement){var $r=$OV.create("2D",$V);this.bitmap=$r}else this.bitmap=$V;if(this.uv=$U||$I.DEF_UV,$V){this._w=$V.width,this._h=$V.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $s=this;if(this._loaded)$w.addToAtlas&&$w.addToAtlas($s);else{var $p=$V;$p instanceof laya.resource.HTMLImage&&$p.image&&$p.image.addEventListener("load",function($V){$w.addToAtlas&&$w.addToAtlas($s)},!1)}}},$U.active=function(){this.bitmap&&this.bitmap.activeResource()},$U.destroy=function($V){if(void 0===$V&&($V=!1),this.alphaTexture&&(this.alphaTexture.destroy($V),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $U=this.bitmap;$V?($m.isConchApp&&$U.source&&$U.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$U.dispose(),$U._clearReference()):($U._removeReference(),0==$U.referenceCount&&($m.isConchApp&&$U.source&&$U.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$U.dispose())),this.url&&this===$y.loader.getRes(this.url)&&$y.loader.clearRes(this.url,$V),this._loaded=!1}},$U.load=function($V){var $U=this;this._loaded=!1,$V=$K.customFormat($V);var $r=this.bitmap||(this.bitmap=$kV.create($V));$r.uri=$V,$r&&$r._addReference();var $s=this;$r.onload=function(){$r.onload=null,$s._loaded=!0,$U.sourceWidth=$U._w=$r.width,$U.sourceHeight=$U._h=$r.height,$s.event("loaded",this),$w.addToAtlas&&$w.addToAtlas($s)}},$U.addTextureToAtlas=function($V){$w.addTextureToAtlas(this)},$U.getPixels=function($V,$U,$r,$s){if($m.isConchApp){var $p=this.bitmap;if($p.source&&$p.source.getImageData){var $c=$p.source.getImageData($V,$U,$r,$s),$R=new Uint8Array($c);return Array.from($R)}return null}return $m.isWebGL?$w.getTexturePixels(this,$V,$U,$r,$s):($j.canvas.size($r,$s),$j.canvas.clear(),$j.context.drawTexture(this,-$V,-$U,this.width,this.height,0,0),$j.context.getImageData(0,0,$r,$s).data)},$U.onAsynLoaded=function($V,$U){if($U){if("function"!=typeof $U._addReference)throw new Error("bitmap._addReference is not a function. "+$U.className+" "+typeof $U._addReference+" "+$U.constructor);$U._addReference()}this.setTo($U,this.uv),this._loaded&&this.event("loaded",this)},$b(0,$U,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$b(0,$U,"loaded",function(){return this._loaded}),$b(0,$U,"released",function(){return!this.bitmap||this.bitmap.released}),$b(0,$U,"width",function(){return this._w?this._w:this.uv&&this.uv!==$I.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($V){this._w=$V,this.sourceWidth||(this.sourceWidth=$V)}),$b(0,$U,"repeat",function(){return!$m.isWebGL||!this.bitmap||this.bitmap.repeat},function($V){$V&&$m.isWebGL&&this.bitmap&&(this.bitmap.repeat=$V)&&(this.bitmap.enableMerageInAtlas=!1)}),$b(0,$U,"height",function(){return this._h?this._h:this.uv&&this.uv!==$I.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($V){this._h=$V,this.sourceHeight||(this.sourceHeight=$V)}),$b(0,$U,"isLinearSampling",function(){return!$m.isWebGL||9728!=this.bitmap.minFifter},function($V){!$V&&$m.isWebGL&&($V||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$I.moveUV=function($V,$U,$r){for(var $s=0;$s<8;$s+=2)$r[$s]+=$V,$r[$s+1]+=$U;return $r},$I.create=function($V,$U,$r,$s,$p,$c,$R,$T,$N){void 0===$c&&($c=0),void 0===$R&&($R=0),void 0===$T&&($T=0),void 0===$N&&($N=0);var $t=$V instanceof laya.resource.Texture,$b=$t?$V.uv:$I.DEF_UV,$S=$t?$V.bitmap:$V,$_=$w.isAtlas($S);if($_){var $G=$S._atlaser,$q=$V._atlasID;if(-1==$q)throw new Error("create texture error");$S=$G._inAtlasTextureBitmapValue[$q],$b=$G._inAtlasTextureOriUVValue[$q]}var $u=new $I($S,null);$S.width&&$U+$s>$S.width&&($s=$S.width-$U),$S.height&&$r+$p>$S.height&&($p=$S.height-$r),$u.width=$s,$u.height=$p,$u.offsetX=$c,$u.offsetY=$R,$u.sourceWidth=$T||$s,$u.sourceHeight=$N||$p;var $h=1/$S.width,$l=1/$S.height;$U*=$h,$r*=$l,$s*=$h,$p*=$l;var $W=$u.uv[0],$O=$u.uv[1],$L=$u.uv[4],$d=$u.uv[5],$k=$L-$W,$y=$d-$O,$D=$I.moveUV($b[0],$b[1],[$U,$r,$U+$s,$r,$U+$s,$r+$p,$U,$r+$p]);$u.uv=[$W+$D[0]*$k,$O+$D[1]*$y,$L-(1-$D[2])*$k,$O+$D[3]*$y,$L-(1-$D[4])*$k,$d-(1-$D[5])*$y,$W+$D[6]*$k,$d-(1-$D[7])*$y],$_&&$u.addTextureToAtlas();var $n=$S.scaleRate;return $n&&1!=$n?($u.sourceWidth/=$n,$u.sourceHeight/=$n,$u.width/=$n,$u.height/=$n,$u.scaleRate=$n,$u.offsetX/=$n,$u.offsetY/=$n):$u.scaleRate=1,$u},$I.createFromTexture=function($V,$U,$r,$s,$p){var $c=$V.scaleRate;1!=$c&&($U*=$c,$r*=$c,$s*=$c,$p*=$c);var $R=$n.TEMP.setTo($U-$V.offsetX,$r-$V.offsetY,$s,$p),$T=$R.intersection($I._rect1.setTo(0,0,$V.width,$V.height),$I._rect2);if(!$T)return null;var $N=$I.create($V,$T.x,$T.y,$T.width,$T.height,$T.x-$R.x,$T.y-$R.y,$s,$p);if($N.bitmap&&$N.bitmap._removeReference)return $N.bitmap._removeReference(),$N;var $t="bitmap:"+($N.bitmap?$N.bitmap.constructor?$N.bitmap.constructor.name:$N.bitmap.__className:"")+", url:"+($V.url+" | "+($N.bitmap?$N.bitmap.url:$V.url))+", x="+$U+",y="+$r+",width="+$s+",height="+$p+", result="+($T?$T.x+","+$T.y+","+$T.width+","+$T.height:"null")+", rect="+$R.x+","+$R.y+","+$R.width+","+$R.height;throw new Error("报错：bitmap._removeReference is not a function  "+$t)},$I.DEF_UV=[0,0,1,0,1,1,0,1],$I.INV_UV=[0,1,1,1,1,0,0,0],$I._rect1=new $n,$I._rect2=new $n,$I}(),$V=function($V){var $T;function $c(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$c.__super.call(this)}$u($c,"laya.utils.TimeLine",$t);var $U=$c.prototype;return $U.to=function($V,$U,$r,$s,$p){return void 0===$p&&($p=0),this._create($V,$U,$r,$s,$p,!0)},$U.from=function($V,$U,$r,$s,$p){return void 0===$p&&($p=0),this._create($V,$U,$r,$s,$p,!1)},$U._create=function($V,$U,$r,$s,$p,$c){var $R=$X.getItemByClass("tweenData",$T);return $R.isTo=$c,$R.type=0,$R.target=$V,$R.duration=$r,$R.data=$U,$R.startTime=this._startTime+$p,$R.endTime=$R.startTime+$R.duration,$R.ease=$s,this._startTime=Math.max($R.endTime,this._startTime),this._tweenDataList.push($R),this._startTimeSort=!0,this._endTimeSort=!0,this},$U.addLabel=function($V,$U){var $r=$X.getItemByClass("tweenData",$T);return $r.type=1,$r.data=$V,$r.endTime=$r.startTime=this._startTime+$U,this._labelDic||(this._labelDic={}),this._labelDic[$V]=$r,this._tweenDataList.push($r),this},$U.removeLabel=function($V){if(this._labelDic&&this._labelDic[$V]){var $U=this._labelDic[$V];if($U){var $r=this._tweenDataList.indexOf($U);-1<$r&&this._tweenDataList.splice($r,1)}delete this._labelDic[$V]}},$U.gotoTime=function($V){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $U,$r,$s,$p;for(var $c in this._firstTweenDic)if($r=this._firstTweenDic[$c])for(var $R in $r)$r.diyTarget.hasOwnProperty($R)&&($r.diyTarget[$R]=$r[$R]);for($c in this._tweenDic)($U=this._tweenDic[$c]).clear(),delete this._tweenDic[$c];if(this._index=0,this._gidIndex=0,this._currTime=$V,this._lastTime=$j.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$s=this._tweenDataList.concat(),$s.sort(function($V,$U){return $V.endTime>$U.endTime?1:$V.endTime<$U.endTime?-1:0})}else $s=this._endTweenDataList;for(var $T=0,$N=$s.length;$T<$N;$T++)if(0==($p=$s[$T]).type){if(!($V>=$p.endTime))break;this._index=Math.max(this._index,$T+1);var $t=$p.data;if($p.isTo)for(var $b in $t)$p.target[$b]=$t[$b]}for($T=0,$N=this._tweenDataList.length;$T<$N;$T++)0==($p=this._tweenDataList[$T]).type&&$V>=$p.startTime&&$V<$p.endTime&&(this._index=Math.max(this._index,$T+1),this._gidIndex++,($U=$X.getItemByClass("tween",$g))._create($p.target,$p.data,$p.duration,$p.ease,$W.create(this,this._animComplete,[this._gidIndex]),0,!1,$p.isTo,!0,!1),$U.setStartTime(this._currTime-($V-$p.startTime)),$U._updateEase(this._currTime),$U.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$U)}},$U.gotoLabel=function($V){if(null!=this._labelDic){var $U=this._labelDic[$V];$U&&this.gotoTime($U.startTime)}},$U.pause=function(){$y.timer.clear(this,this._update)},$U.resume=function(){this.play(this._currTime,this._loopKey)},$U.play=function($V,$U){if(void 0===$V&&($V=0),void 0===$U&&($U=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($V,$U){return $V.startTime>$U.startTime?1:$V.startTime<$U.startTime?-1:0});for(var $r=0,$s=this._tweenDataList.length;$r<$s;$r++){var $p=this._tweenDataList[$r];if(null!=$p&&0==$p.type){var $c=$p.target,$R=$c.$_GID||($c.$_GID=$v.getGID()),$T=null;for(var $N in null==this._firstTweenDic[$R]?(($T={}).diyTarget=$c,this._firstTweenDic[$R]=$T):$T=this._firstTweenDic[$R],$p.data)null==$T[$N]&&($T[$N]=$c[$N])}}}"string"==typeof $V?this.gotoLabel($V):this.gotoTime($V),this._loopKey=$U,this._lastTime=$j.now(),$y.timer.frameLoop(1,this,this._update)}},$U._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $V in this._tweenDic)($U=this._tweenDic[$V]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $U,$r=$j.now(),$s=$r-this._lastTime,$p=this._currTime+=$s*this.scale;for($V in this._lastTime=$r,this._tweenDic)($U=this._tweenDic[$V])._updateEase($p);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $c=this._tweenDataList[this._index];$p>=$c.startTime&&(this._index++,0==$c.type?(this._gidIndex++,($U=$X.getItemByClass("tween",$g))._create($c.target,$c.data,$c.duration,$c.ease,$W.create(this,this._animComplete,[this._gidIndex]),0,!1,$c.isTo,!0,!1),$U.setStartTime($p),$U.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$U)._updateEase($p)):this.event("label",$c.data))}},$U._animComplete=function($V){this._tweenDic[$V]&&delete this._tweenDic[$V]},$U._complete=function(){this.event("complete")},$U.reset=function(){var $V;if(this._labelDic)for($V in this._labelDic)delete this._labelDic[$V];for($V in this._tweenDic)this._tweenDic[$V].clear(),delete this._tweenDic[$V];for($V in this._firstTweenDic)delete this._firstTweenDic[$V];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $U,$r=0;for($U=this._tweenDataList.length,$r=0;$r<$U;$r++)this._tweenDataList[$r]&&this._tweenDataList[$r].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$y.timer.clear(this,this._update)},$U.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$b(0,$U,"index",function(){return this._frameIndex},function($V){this._frameIndex=$V,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$b(0,$U,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$c.to=function($V,$U,$r,$s,$p){return void 0===$p&&($p=0),(new $c).to($V,$U,$r,$s,$p)},$c.from=function($V,$U,$r,$s,$p){return void 0===$p&&($p=0),(new $c).from($V,$U,$r,$s,$p)},$c.__init$=function(){$T=function(){function $V(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $u($V,""),$V.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$X.recover("tweenData",this)},$V}()},$c}(),$SV=function($p){function $r(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$r.__super.call(this),this._style=$T.EMPTY}$u($r,"laya.display.Sprite",$p);var $V=$r.prototype;return $y.imps($V,{"laya.display.ILayout":!0}),$V.createConchModel=function(){return new ConchNode},$V.destroy=function($V){if(void 0===$V&&($V=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $U=this.mask;$U&&(this.mask=null,$U.destroy($V))}$p.prototype.destroy.call(this,$V),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$V.updateZOrder=function(){$v.updateOrder(this._childs)&&this.repaint()},$V.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$V.setBounds=function($V){this._set$P("uBounds",$V)},$V.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $n),$n._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$V.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $n),$n._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$V._boundPointsToParent=function($V){void 0===$V&&($V=!1);var $U=0,$r=0;this._style&&($U=this._style._tf.translateX,$r=this._style._tf.translateY,$V=$V||0!==this._style._tf.rotate,this._style.scrollRect&&($U+=this._style.scrollRect.x,$r+=this._style.scrollRect.y));var $s=this._getBoundPointsM($V);if(!$s||$s.length<1)return $s;if(8!=$s.length&&($s=$V?$d.scanPList($s):$n._getWrapRec($s,$n.TEMP)._getBoundPoints()),!this.transform)return $v.transPointList($s,this._x-$U,this._y-$r),$s;var $p=$D.TEMP,$c=0,$R=$s.length;for($c=0;$c<$R;$c+=2)$p.x=$s[$c],$p.y=$s[$c+1],this.toParentPoint($p),$s[$c]=$p.x,$s[$c+1]=$p.y;return $s},$V.getGraphicBounds=function($V){return void 0===$V&&($V=!1),this._graphics?this._graphics.getBounds($V):$n.TEMP.setTo(0,0,0,0)},$V._getBoundPointsM=function($V){if(void 0===$V&&($V=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $U=$v.clearArray(this._$P.temBM),$r=$n.TEMP;return $r.copyFrom(this.scrollRect),$v.concatArray($U,$r._getBoundPoints()),$U}for(var $s,$p,$c,$R=this._graphics?this._graphics.getBoundPoints():$v.clearArray(this._$P.temBM),$T=0,$N=($c=this._childs).length;$T<$N;$T++)($s=$c[$T])instanceof laya.display.Sprite&&1==$s.visible&&($p=$s._boundPointsToParent($V))&&($R=$R?$v.concatArray($R,$p):$p);return $R},$V.getStyle=function(){return this._style===$T.EMPTY&&(this._style=new $T),this._style},$V.setStyle=function($V){this._style=$V},$V._adjustTransform=function(){this._tfChanged=!1;var $V,$U=this._style._tf,$r=$U.scaleX,$s=$U.scaleY;if($U.rotate||1!==$r||1!==$s||$U.skewX||$U.skewY){($V=this._transform||(this._transform=$z.create())).bTransform=!0;var $p=.0174532922222222*($U.rotate-$U.skewX),$c=.0174532922222222*($U.rotate+$U.skewY),$R=Math.cos($c),$T=Math.sin($c),$N=Math.sin($p),$t=Math.cos($p);return $V.a=$r*$R,$V.b=$r*$T,$V.c=-$s*$N,$V.d=$s*$t,$V.tx=$V.ty=0,$V}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$V},$V.pos=function($V,$U,$r){if(void 0===$r&&($r=!1),this._x!==$V||this._y!==$U){if(this.destroyed)return this;if($r){this._x=$V,this._y=$U,this.conchModel&&this.conchModel.pos(this._x,this._y);var $s=this._parent;$s&&0===$s._repaint&&($s._repaint=1,$s.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$V,this.y=$U}return this},$V.pivot=function($V,$U){return this.pivotX=$V,this.pivotY=$U,this},$V.size=function($V,$U){return this.width=$V,this.height=$U,this},$V.scale=function($V,$U,$r){void 0===$r&&($r=!1);var $s=this.getStyle(),$p=$s._tf;if($p.scaleX!=$V||$p.scaleY!=$U){if(this.destroyed)return this;if($r){$s.setScale($V,$U),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($V,$U),this._renderType|=4;var $c=this._parent;$c&&0===$c._repaint&&($c._repaint=1,$c.parentRepaint())}else this.scaleX=$V,this.scaleY=$U}return this},$V.skew=function($V,$U){return this.skewX=$V,this.skewY=$U,this},$V.render=function($V,$U,$r){$e.spriteCount++,$Z.renders[this._renderType]._fun(this,$V,$U+this._x,$r+this._y),this._repaint=0},$V.drawToCanvas=function($V,$U,$r,$s){if($m.isConchNode){var $p=$OV.create("2D");return new $a($V,$U,$p).ctx.setCanvasType(1),this.conchModel.drawToCanvas($p.source,$r,$s),$p}return $w.drawToCanvas(this,this._renderType,$V,$U,$r,$s)},$V.customRender=function($V,$U,$r){this._renderType|=1024},$V._applyFilters=function(){var $V;if(!$m.isWebGL&&(($V=this._$P.filters)&&!($V.length<1)))for(var $U=0,$r=$V.length;$U<$r;$U++)$V[$U].action.apply(this._$P.cacheCanvas)},$V._isHaveGlowFilter=function(){var $V,$U=0;if(this.filters)for($U=0;$U<this.filters.length;$U++)if(8==this.filters[$U].type)return!0;for($U=0,$V=this._childs.length;$U<$V;$U++)if(this._childs[$U]._isHaveGlowFilter())return!0;return!1},$V.localToGlobal=function($V,$U){void 0===$U&&($U=!1),!0===$U&&($V=new $D($V.x,$V.y));for(var $r=this;$r&&$r!=$y.stage;)$V=$r.toParentPoint($V),$r=$r.parent;return $V},$V.globalToLocal=function($V,$U){void 0===$U&&($U=!1),$U&&($V=new $D($V.x,$V.y));for(var $r=this,$s=[];$r&&$r!=$y.stage;)$s.push($r),$r=$r.parent;for(var $p=$s.length-1;0<=$p;)$V=($r=$s[$p]).fromParentPoint($V),$p--;return $V},$V.toParentPoint=function($V){if(!$V)return $V;$V.x-=this.pivotX,$V.y-=this.pivotY,this.transform&&this._transform.transformPoint($V),$V.x+=this._x,$V.y+=this._y;var $U=this._style.scrollRect;return $U&&($V.x-=$U.x,$V.y-=$U.y),$V},$V.fromParentPoint=function($V){if(!$V)return $V;$V.x-=this._x,$V.y-=this._y;var $U=this._style.scrollRect;return $U&&($V.x+=$U.x,$V.y+=$U.y),this.transform&&this._transform.invertTransformPoint($V),$V.x+=this.pivotX,$V.y+=this.pivotY,$V},$V.on=function($V,$U,$r,$s){return 1!==this._mouseEnableState&&this.isMouseEvent($V)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($V,$U,$r,$s,!1)):$p.prototype.on.call(this,$V,$U,$r,$s)},$V.once=function($V,$U,$r,$s){return 1!==this._mouseEnableState&&this.isMouseEvent($V)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($V,$U,$r,$s,!0)):$p.prototype.once.call(this,$V,$U,$r,$s)},$V._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $V=this;for($V=$V.parent;$V&&1!==$V._mouseEnableState&&!$V._getBit(2);)$V.mouseEnabled=!0,$V._setBit(2,!0),$V=$V.parent}},$V.loadImage=function($V,$U,$r,$s,$p,$c){var $R=this;return void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),void 0===$p&&($p=0),this.graphics.loadImage($V,$U,$r,$s,$p,function($V){$R.destroyed||($R.size($U+($s||$V.width),$r+($p||$V.height)),$R.repaint(),$c&&$c.runWith($V))}),this},$V.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$V._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$V._childChanged=function($V){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$V&&this._get$P("hasZorder")&&$y.timer.callLater(this,this.updateZOrder),this.repaint()},$V.parentRepaint=function(){var $V=this._parent;$V&&0===$V._repaint&&($V._repaint=1,$V.parentRepaint())},$V.startDrag=function($V,$U,$r,$s,$p,$c,$R){void 0===$U&&($U=!1),void 0===$r&&($r=0),void 0===$s&&($s=300),void 0===$c&&($c=!1),void 0===$R&&($R=.92),this._$P.dragging||this._set$P("dragging",new $P),this._$P.dragging.start(this,$V,$U,$r,$s,$p,$c,$R)},$V.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$V._releaseMem=function(){if(this._$P){var $V=this._$P.cacheCanvas;$V&&$V.ctx&&($X.recover("RenderContext",$V.ctx),$V.ctx.canvas.size(0,0),$V.ctx=null);var $U=this._$P._filterCache;$U&&($U.destroy(),$U.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$V._setDisplay=function($V){$V||this._releaseMem(),$p.prototype._setDisplay.call(this,$V)},$V.hitTestPoint=function($V,$U){var $r=this.globalToLocal($D.TEMP.setTo($V,$U));return $V=$r.x,$U=$r.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$n.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($V,$U)},$V.getMousePoint=function(){return this.globalToLocal($D.TEMP.setTo($y.stage.mouseX,$y.stage.mouseY))},$V._getWords=function(){return null},$V._addChildsToLayout=function($V){var $U=this._getWords();if(null==$U&&0==this._childs.length)return!1;if($U)for(var $r=0,$s=$U.length;$r<$s;$r++)$V.push($U[$r]);$r=0;for(var $p=this._childs.length;$r<$p;++$r){var $c=this._childs[$r];$c._style._enableLayout()&&$c._addToLayout($V)}return!0},$V._addToLayout=function($V){this._style.absolute||(this._style.block?$V.push(this):this._addChildsToLayout($V)&&(this.x=this.y=0))},$V._isChar=function(){return!1},$V._getCSSStyle=function(){return this._style.getCSSStyle()},$V._setAttributes=function($V,$U){switch($V){case"x":this.x=parseFloat($U);break;case"y":this.y=parseFloat($U);break;case"width":this.width=parseFloat($U);break;case"height":this.height=parseFloat($U);break;default:this[$V]=$U}},$V._layoutLater=function(){this.parent&&this.parent._layoutLater()},$b(0,$V,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($V){this._optimizeScrollRect!=$V&&(this._optimizeScrollRect=$V,this.conchModel&&this.conchModel.optimizeScrollRect($V))}),$b(0,$V,"customRenderEnable",null,function($V){if($V&&(this._renderType|=1024,$m.isConchNode)){$r.CustomList.push(this);var $U=new $OV("2d");$U._setContext(new CanvasRenderingContext2D),this.customContext=new $a(0,0,$U),$U.context.setCanvasType&&$U.context.setCanvasType(2),this.conchModel.custom($U.context)}}),$b(0,$V,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($V){this.cacheAs=$V?this._$P.hasFilter?"none":"normal":"none"}),$b(0,$V,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($V){var $U=this._$P.cacheCanvas;if($V!==($U?$U.type:"none")){if("none"!==$V)this._getBit(1)||this._setUpNoticeType(1),$U||($U=this._set$P("cacheCanvas",$X.getItemByClass("cacheCanvas",Object))),$U.type=$V,$U.reCache=!0,this._renderType|=16,"bitmap"==$V&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($U){var $r=$U;$r&&$r.ctx&&($X.recover("RenderContext",$r.ctx),$r.ctx.canvas.size(0,0),$r.ctx=null),$X.recover("cacheCanvas",$U)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$b(0,$V,"zOrder",function(){return this._zOrder},function($V){this._zOrder!=$V&&(this._zOrder=$V,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($V),this._parent&&($V&&this._parent._set$P("hasZorder",!0),$y.timer.callLater(this._parent,this.updateZOrder)))}),$b(0,$V,"rotation",function(){return this._style._tf.rotate},function($V){var $U=this.getStyle();if($U._tf.rotate!==$V){$U.setRotate($V),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($V),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$b(0,$V,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($V){this._width!==$V&&(this._width=$V,this.conchModel&&this.conchModel.size($V,this._height),this.repaint())}),$b(0,$V,"x",function(){return this._x},function($V){if(this._x!==$V){if(this.destroyed)return;this._x=$V,this.conchModel&&this.conchModel.pos($V,this._y);var $U=this._parent;$U&&0===$U._repaint&&($U._repaint=1,$U.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$b(0,$V,"globalScaleY",function(){for(var $V=1,$U=this;$U&&$U!==$y.stage;)$V*=$U.scaleY,$U=$U.parent;return $V}),$b(0,$V,"hitArea",function(){return this._$P.hitArea},function($V){this._set$P("hitArea",$V)}),$b(0,$V,"staticCache",function(){return this._$P.staticCache},function($V){this._set$P("staticCache",$V),$V||this.reCache()}),$b(0,$V,"texture",function(){return this._texture},function($V){this._texture!=$V&&(this._texture=$V,this.graphics.cleanByTexture($V,0,0))}),$b(0,$V,"y",function(){return this._y},function($V){if(this._y!==$V){if(this.destroyed)return;this._y=$V,this.conchModel&&this.conchModel.pos(this._x,$V);var $U=this._parent;$U&&0===$U._repaint&&($U._repaint=1,$U.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$b(0,$V,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($V){this._height!==$V&&(this._height=$V,this.conchModel&&this.conchModel.size(this._width,$V),this.repaint())}),$b(0,$V,"blendMode",function(){return this._style.blendMode},function($V){this.getStyle().blendMode=$V,this.conchModel&&this.conchModel.blendMode($V),$V&&"source-over"!=$V?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$b(0,$V,"scaleX",function(){return this._style._tf.scaleX},function($V){var $U=this.getStyle();if($U._tf.scaleX!==$V){$U.setScaleX($V),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($V,$U._tf.scaleY),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$b(0,$V,"scaleY",function(){return this._style._tf.scaleY},function($V){var $U=this.getStyle();if($U._tf.scaleY!==$V){$U.setScaleY($V),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($U._tf.scaleX,$V),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$b(0,$V,"stage",function(){return $y.stage}),$b(0,$V,"skewX",function(){return this._style._tf.skewX},function($V){var $U=this.getStyle();if($U._tf.skewX!==$V){$U.setSkewX($V),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($V,$U._tf.skewY),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$b(0,$V,"scrollRect",function(){return this._style.scrollRect},function($V){this.getStyle().scrollRect=$V,this.repaint(),$V?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($V.x,$V.y,$V.width,$V.height)):(this._renderType&=-129,this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$b(0,$V,"skewY",function(){return this._style._tf.skewY},function($V){var $U=this.getStyle();if($U._tf.skewY!==$V){$U.setSkewY($V),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($U._tf.skewX,$V),this._renderType|=4;var $r=this._parent;$r&&0===$r._repaint&&($r._repaint=1,$r.parentRepaint())}}),$b(0,$V,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($V){this._tfChanged=!1,(this._transform=$V)&&(this._x=$V.tx,this._y=$V.ty,$V.tx=$V.ty=0,this.conchModel&&this.conchModel.transform($V.a,$V.b,$V.c,$V.d,this._x,this._y)),$V?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$b(0,$V,"pivotX",function(){return this._style._tf.translateX},function($V){this.getStyle().setTranslateX($V),this.conchModel&&this.conchModel.pivot($V,this._style._tf.translateY),this.repaint()}),$b(0,$V,"pivotY",function(){return this._style._tf.translateY},function($V){this.getStyle().setTranslateY($V),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$V),this.repaint()}),$b(0,$V,"alpha",function(){return this._style.alpha},function($V){this._style&&this._style.alpha!==$V&&($V=$V<0?0:1<$V?1:$V,this.getStyle().alpha=$V,this.conchModel&&this.conchModel.alpha($V),1!==$V?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$b(0,$V,"visible",function(){return this._style.visible},function($V){this._style&&this._style.visible!==$V&&(this.getStyle().visible=$V,this.conchModel&&this.conchModel.visible($V),this.parentRepaint())}),$b(0,$V,"graphics",function(){return this._graphics||(this.graphics=$w.createGraphics())},function($V){this._graphics&&(this._graphics._sp=null),(this._graphics=$V)?(this._renderType&=-2,this._renderType|=512,($V._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$b(0,$V,"filters",function(){return this._$P.filters},function($V){$V&&0===$V.length&&($V=null),this._$P.filters!=$V&&(this._set$P("filters",$V?$V.slice():null),$m.isConchApp&&(this.conchModel&&($r.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$m.isWebGL&&($V&&$V.length?this._renderType|=32:this._renderType&=-33),$V&&0<$V.length?(this._getBit(1)||this._setUpNoticeType(1),$m.isWebGL&&1==$V.length&&$V[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($m.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$b(0,$V,"parent",$p.prototype._$get_parent,function($V){$y.superSet($VV,this,"parent",$V),$V&&this._getBit(2)&&this._$2__onDisplay()}),$b(0,$V,"mask",function(){return this._$P._mask},function($V){$V&&this.mask&&this.mask._$P.maskParent||($V?(this.cacheAs="bitmap",this._set$P("_mask",$V),$V._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$V),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($V?$V.conchModel:null),this._renderType|=64,this.parentRepaint())}),$b(0,$V,"mouseEnabled",function(){return 1<this._mouseEnableState},function($V){this._mouseEnableState=$V?2:1}),$b(0,$V,"globalScaleX",function(){for(var $V=1,$U=this;$U&&$U!==$y.stage;)$V*=$U.scaleX,$U=$U.parent;return $V}),$b(0,$V,"mouseX",function(){return this.getMousePoint().x}),$b(0,$V,"mouseY",function(){return this.getMousePoint().y}),$r.fromImage=function($V){return(new $r).loadImage($V)},$r._cachePool=[],$r.CustomList=[],$N($r,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$R.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$r}($VV),$_V=function($V){function $U($V){this._audio=null,this._onEnd=null,this._resumePlay=null,$U.__super.call(this),this._onEnd=$v.bind(this.__onEnd,this),this._resumePlay=$v.bind(this.__resumePlay,this),$V.addEventListener("ended",this._onEnd),this._audio=$V}$u($U,"laya.media.h5audio.AudioSoundChannel",$sV);var $r=$U.prototype;return $r.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($y.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$r.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$j.container.appendChild(this._audio),this._audio.play()}catch($V){this.event("error")}},$r.play=function($V){this.isStopped=!1;try{this._audio.playbackRate=$H.playbackRate,this._audio.currentTime=this.startTime}catch($V){return void this._audio.addEventListener("canplay",this._resumePlay)}$H.addChannel(this),$j.container.appendChild(this._audio),!$V&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$r.stop=function(){this.isStopped=!0,$H.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$m.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$j.onIE||this._audio!=$rV._musicAudio&&$X.recover("audio:"+this.url,this._audio),$j.removeElement(this._audio),this._audio=null)},$r.pause=function(){this.isStopped=!0,$H.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$r.resume=function(){this._audio&&(this.isStopped=!1,$H.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$b(0,$r,"position",function(){return this._audio?this._audio.currentTime:0}),$b(0,$r,"duration",function(){return this._audio?this._audio.duration:0}),$b(0,$r,"volume",function(){return this._audio?this._audio.volume:1},function($V){this._audio&&(this._audio.volume=$V)}),$U}(),$GV=function($V){function $U(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$cV.ctx,$U.__super.call(this),this._onPlayEnd=$v.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$u($U,"laya.media.webaudio.WebAudioSoundChannel",$sV);var $r=$U.prototype;return $r.play=function($V){if($H.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $U=this.context,$r=this.gain,$s=$U.createBufferSource();(this.bufferSource=$s).buffer=this.audioBuffer,$s.connect($r),$r&&$r.disconnect(),$r.connect($U.destination),$s.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$j.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($s.loop=!0),$s.playbackRate.setTargetAtTime?$s.playbackRate.setTargetAtTime($H.playbackRate,this.context.currentTime,.1):$s.playbackRate.value=$H.playbackRate,$s.start(0,this.startTime),!$V&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$r.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($y.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$r._clearBufferSource=function(){if(this.bufferSource){var $V=this.bufferSource;$V.stop?$V.stop(0):$V.noteOff(0),$V.disconnect(0),$V.onended=null,$U._tryCleanFailed||this._tryClearBuffer($V),this.bufferSource=null}},$r._tryClearBuffer=function($V){try{$V.buffer=null}catch($V){$U._tryCleanFailed=!0}},$r.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$H.removeChannel(this),this.startHandler=null,this.completeHandler=null},$r.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$H.removeChannel(this)},$r.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$b(0,$r,"position",function(){return this.bufferSource?($j.now()-this._startTime)/1e3+this.startTime:0}),$b(0,$r,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$b(0,$r,"volume",function(){return this._volume},function($V){this.isStopped||(this._volume=$V,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($V,this.context.currentTime,.1):this.gain.gain.value=$V)}),$U._tryCleanFailed=!1,$U}(),$qV=function($V){function $U(){$U.__super.call(this),this._w=0,this._h=0}$u($U,"laya.resource.Bitmap",$tV);var $r=$U.prototype;return $b(0,$r,"width",function(){return this._w}),$b(0,$r,"height",function(){return this._h}),$b(0,$r,"source",function(){return this._source}),$U}(),$uV=function($U){function $V(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$V.__super.call(this),this._interval=$s.animationInterval,this._setUpNoticeType(1)}$u($V,"laya.display.AnimationPlayerBase",$U);var $r=$V.prototype;return $r.play=function($V,$U,$r,$s){void 0===$V&&($V=0),void 0===$U&&($U=!0),void 0===$r&&($r=""),void 0===$s&&($s=!0),this._isPlaying=!0,this.index="string"==typeof $V?this._getFrameByLabel($V):$V,this.loop=$U,this._actionName=$r,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$r._getFrameByLabel=function($V){var $U=0;for($U=0;$U<this._count;$U++)if(this._labels[$U]&&0<=this._labels[$U].indexOf($V))return $U;return 0},$r._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$r._setControlNode=function($V){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$V)&&$V!=this&&($V.on("display",this,this._checkResumePlaying),$V.on("undisplay",this,this._checkResumePlaying))},$r._setDisplay=function($V){$U.prototype._setDisplay.call(this,$V),this._checkResumePlaying()},$r._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$r.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$r.addLabel=function($V,$U){this._labels||(this._labels={}),this._labels[$U]||(this._labels[$U]=[]),this._labels[$U].push($V)},$r.removeLabel=function($V){if($V){if(this._labels)for(var $U in this._labels)this._removeLabelFromLabelList(this._labels[$U],$V)}else this._labels=null},$r._removeLabelFromLabelList=function($V,$U){if($V)for(var $r=$V.length-1;0<=$r;$r--)$V[$r]==$U&&$V.splice($r,1)},$r.gotoAndStop=function($V){this.index="string"==typeof $V?this._getFrameByLabel($V):$V,this.stop()},$r._displayToIndex=function($V){},$r.clear=function(){this.stop(),this._labels=null},$b(0,$r,"interval",function(){return this._interval},function($V){this._interval!=$V&&(this._frameRateChanged=!0,this._interval=$V,this._isPlaying&&0<$V&&this.timerLoop($V,this,this._frameLoop,null,!0,!0))}),$b(0,$r,"isPlaying",function(){return this._isPlaying}),$b(0,$r,"index",function(){return this._index},function($V){if(this._index=$V,this._displayToIndex($V),this._labels&&this._labels[$V])for(var $U=this._labels[$V],$r=0,$s=$U.length;$r<$s;$r++)this.event("label",$U[$r])}),$b(0,$r,"count",function(){return this._count}),$V.WRAP_POSITIVE=0,$V.WRAP_REVERSE=1,$V.WRAP_PINGPONG=2,$V}($SV),$hV=function($U){function $G(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$G.__super.call(this),this.overflow=$G.VISIBLE,this._style=new $UV(this),this._style.wordWrap=!1}$u($G,"laya.display.Text",$U);var $V=$G.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$V._getBoundPointsM=function($V){void 0===$V&&($V=!1);var $U=$n.TEMP;return $U.setTo(0,0,this.width,this.height),$U._getBoundPoints()},$V.getGraphicBounds=function($V){void 0===$V&&($V=!1);var $U=$n.TEMP;return $U.setTo(0,0,this.width,this.height),$U},$V._getCSSStyle=function(){return this._style},$V.lang=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b){if($V=$G.langPacks&&$G.langPacks[$V]?$G.langPacks[$V]:$V,arguments.length<2)this._text=$V;else{for(var $S=0,$_=arguments.length;$S<$_;$S++)$V=$V.replace("{"+$S+"}",arguments[$S+1]);this._text=$V}},$V._isPassWordMode=function(){var $V=this._style.password;return"prompt"in this&&this.prompt==this._text&&($V=!1),$V},$V._getPassWordTxt=function($V){var $U;$U="";for(var $r=$V.length;0<$r;$r--)$U+="●";return $U},$V.renderText=function($V,$U){var $r=this.graphics;$r.clear(!0);var $s=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($j.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$j.context.font=$s;var $p=this.padding,$c=$p[3],$R="left",$T=this._lines,$N=this.leading+this._charSize.height,$t=this._currBitmapFont;$t&&($N=this.leading+$t.getMaxHeight());var $b=$p[0];if(!$t&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($R="right",$c=this._width-$p[1]):"center"==this.align&&($R="center",$c=.5*this._width+$p[3]-$p[1])),0<this._height){var $S=this._textHeight>this._height?"top":this.valign;"middle"===$S?$b=.5*(this._height-$U*$N)+$p[0]-$p[2]:"bottom"===$S&&($b=this._height-$U*$N-$p[2])}var $_=this._style;if($t&&$t.autoScaleSize)var $G=$t.fontSize/this.fontSize;if(this._clipPoint)if($r.save(),$t&&$t.autoScaleSize){var $q=0,$u=0;$q=this._width?this._width-$p[3]-$p[1]:this._textWidth,$u=this._height?this._height-$p[0]-$p[2]:this._textHeight,$q*=$G,$u*=$G,$r.clipRect($p[3],$p[0],$q,$u)}else $r.clipRect($p[3],$p[0],this._width?this._width-$p[3]-$p[1]:this._textWidth,this._height?this._height-$p[0]-$p[2]:this._textHeight);var $h=$_.password;"prompt"in this&&this.prompt==this._text&&($h=!1);for(var $l=0,$W=0,$O=Math.min(this._lines.length,$U+$V)||1,$L=$V;$L<$O;$L++){var $d,$k=$T[$L];if($h){var $y=$k.length;$k="";for(var $D=$y;0<$D;$D--)$k+="●"}if($l=$c-(this._clipPoint?this._clipPoint.x:0),$W=$b+$N*$L-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($R,$l,$W,$L),$t){var $n=this.width;$t.autoScaleSize&&($n=this.width*$G),$t.drawText($k,this,$l,$W,this.align,$n)}else $m.isWebGL?(this._words||(this._words=[]),($d=this._words.length>$L-$V?this._words[$L-$V]:new $f).setText($k)):$d=$k,$_.stroke?$r.fillBorderText($d,$l,$W,$s,this.color,$_.strokeColor,$_.stroke,$R):$r.fillText($d,$l,$W,$s,this.color,$R)}if($t&&$t.autoScaleSize){var $I=1/$G;this.scale($I,$I)}this._clipPoint&&$r.restore(),this._startX=$c,this._startY=$b},$V.drawUnderline=function($V,$U,$r,$s){var $p=this._lineWidths[$s];switch($V){case"center":$U-=$p/2;break;case"right":$U-=$p}$r+=this._charSize.height,this._graphics.drawLine($U,$r,$U+$p,$r,this.underlineColor||this.color,1)},$V.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$j.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $D(0,0)):this._clipPoint=null;var $V=this._lines.length;if(this.overflow!=$G.VISIBLE){var $U=this.overflow==$G.HIDDEN?Math.floor:Math.ceil;$V=Math.min($V,$U((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $r=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($r,$V),this.repaint()},$V.evalTextSize=function(){var $V,$U=NaN;$V=Math.max.apply(this,this._lineWidths),$U=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$V==this._textWidth&&$U==this._textHeight||(this._textWidth=$V,this._textHeight=$U,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$V.checkEnabledViewportOrNot=function(){return this.overflow==$G.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$V.changeText=function($V){this._text!==$V&&(this.lang($V+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$V.parseLines=function($V){var $U=this.wordWrap||this.overflow==$G.HIDDEN;if($U)var $r=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $s=$v.contextMeasureText($G._testWord);$m.isConchApp&&0===$s.width&&0===$s.height&&($s=$v.contextMeasureText("W")),this._charSize.width=$s.width,this._charSize.height=$s.height||this.fontSize}for(var $p=$V.replace(/\r\n/g,"\n").split("\n"),$c=0,$R=$p.length;$c<$R;$c++){var $T=$p[$c];$U?this.parseLine($T,$r):(this._lineWidths.push(this.getTextWidth($T)),this._lines.push($T))}},$V.parseLine=function($V,$U){$j.context;var $r,$s=this._lines,$p=0,$c=NaN,$R=NaN,$T=0;if(($c=this.getTextWidth($V))<=$U)return $s.push($V),void this._lineWidths.push($c);$c=this._charSize.width,0==($p=Math.floor($U/$c))&&($p=1),$R=$c=this.getTextWidth($V.substring(0,$p));for(var $N=$p,$t=$V.length;$N<$t;$N++)if($U<($R+=$c=this.getTextWidth($V.charAt($N))))if(this.wordWrap){var $b=$V.substring($T,$N);if($b.charCodeAt($b.length-1)<255?($r=/(?:\w|-)+$/.exec($b))&&($N=$r.index+$T,0==$r.index?$N+=$b.length:$b=$V.substring($T,$N)):$G.RightToLeft&&($r=/([\u0600-\u06FF])+$/.exec($b))&&($N=$r.index+$T,0==$r.index?$N+=$b.length:$b=$V.substring($T,$N)),$s.push($b),this._lineWidths.push($R-$c),!(($T=$N)+$p<$t)){$s.push($V.substring($T,$t)),this._lineWidths.push(this.getTextWidth($s[$s.length-1])),$T=-1;break}$N+=$p,$R=$c=this.getTextWidth($V.substring($T,$N)),$N--}else if(this.overflow==$G.HIDDEN)return $s.push($V.substring(0,$N)),void this._lineWidths.push(this.getTextWidth($s[$s.length-1]));this.wordWrap&&-1!=$T&&($s.push($V.substring($T,$t)),this._lineWidths.push(this.getTextWidth($s[$s.length-1])))},$V.getTextWidth=function($V){return this._currBitmapFont?this._currBitmapFont.getTextWidth($V):$v.contextMeasureText($V).width},$V.getWordWrapWidth=function(){var $V=this.padding,$U=NaN;return($U=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($U=this.wordWrap?100:$j.width),$U<=0&&($U=100),$U-$V[3]-$V[1]},$V.getCharPoint=function($V,$U){this._isChanged&&$y.timer.runCallLater(this,this.typeset);for(var $r=0,$s=this._lines,$p=0,$c=0,$R=$s.length;$c<$R;$c++){if($V<($r+=$s[$c].length)){var $T=$c;break}$p=$r}var $N=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$j.context.font=$N;var $t=this.getTextWidth(this._text.substring($p,$V));return($U||new $D).setTo(this._startX+$t-(this._clipPoint?this._clipPoint.x:0),this._startY+$T*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$b(0,$V,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($V){$V!=this._width&&($y.superSet($SV,this,"width",$V),this.isChanged=!0)}),$b(0,$V,"textWidth",function(){return this._isChanged&&$y.timer.runCallLater(this,this.typeset),this._textWidth}),$b(0,$V,"height",function(){return this._height?this._height:this.textHeight},function($V){$V!=this._height&&($y.superSet($SV,this,"height",$V),this.isChanged=!0)}),$b(0,$V,"textHeight",function(){return this._isChanged&&$y.timer.runCallLater(this,this.typeset),this._textHeight}),$b(0,$V,"padding",function(){return this._getCSSStyle().padding},function($V){this._getCSSStyle().padding=$V,this.isChanged=!0}),$b(0,$V,"bold",function(){return this._getCSSStyle().bold},function($V){this._getCSSStyle().bold=$V,this.isChanged=!0}),$b(0,$V,"text",function(){return this._text||""},function($V){this._text!==$V&&(this.lang($V+""),this.isChanged=!0,this.event("change"))}),$b(0,$V,"color",function(){return this._getCSSStyle().color},function($V){this._getCSSStyle().color!=$V&&(this._getCSSStyle().color=$V,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$b(0,$V,"font",function(){return this._getCSSStyle().fontFamily},function($V){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$G._bitmapFonts&&$G._bitmapFonts[$V]&&(this._currBitmapFont=$G._bitmapFonts[$V]),this._getCSSStyle().fontFamily=$V,this.isChanged=!0}),$b(0,$V,"fontSize",function(){return this._getCSSStyle().fontSize},function($V){this._getCSSStyle().fontSize=$V,this.isChanged=!0}),$b(0,$V,"italic",function(){return this._getCSSStyle().italic},function($V){this._getCSSStyle().italic=$V,this.isChanged=!0}),$b(0,$V,"align",function(){return this._getCSSStyle().align},function($V){this._getCSSStyle().align=$V,this.isChanged=!0}),$b(0,$V,"valign",function(){return this._getCSSStyle().valign},function($V){this._getCSSStyle().valign=$V,this.isChanged=!0}),$b(0,$V,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($V){this._getCSSStyle().wordWrap=$V,this.isChanged=!0}),$b(0,$V,"leading",function(){return this._getCSSStyle().leading},function($V){this._getCSSStyle().leading=$V,this.isChanged=!0}),$b(0,$V,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($V){this._getCSSStyle().backgroundColor=$V,this.isChanged=!0}),$b(0,$V,"borderColor",function(){return this._getCSSStyle().borderColor},function($V){this._getCSSStyle().borderColor=$V,this.isChanged=!0}),$b(0,$V,"stroke",function(){return this._getCSSStyle().stroke},function($V){this._getCSSStyle().stroke=$V,this.isChanged=!0}),$b(0,$V,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($V){this._getCSSStyle().strokeColor=$V,this.isChanged=!0}),$b(0,$V,"isChanged",null,function($V){this._isChanged!==$V&&(this._isChanged=$V)&&$y.timer.callLater(this,this.typeset)}),$b(0,$V,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($V){if(!(this.overflow!=$G.SCROLL||this.textWidth<this._width)&&this._clipPoint){$V=$V<this.padding[3]?this.padding[3]:$V;var $U=this._textWidth-this._width;$V=$U<$V?$U:$V;var $r=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$V,this.renderText(this._lastVisibleLineIndex,$r)}}),$b(0,$V,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($V){if(!(this.overflow!=$G.SCROLL||this.textHeight<this._height)&&this._clipPoint){$V=$V<this.padding[0]?this.padding[0]:$V;var $U=this._textHeight-this._height,$r=($V=$U<$V?$U:$V)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$r;var $s=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$V,this.renderText($r,$s)}}),$b(0,$V,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$b(0,$V,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$b(0,$V,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$b(0,$V,"underlineColor",function(){return this._underlineColor},function($V){this._underlineColor=$V,this._isChanged=!0,this.typeset()}),$G.registerBitmapFont=function($V,$U){$G._bitmapFonts||($G._bitmapFonts={}),$G._bitmapFonts[$V]=$U},$G.unregisterBitmapFont=function($V,$U){if(void 0===$U&&($U=!0),$G._bitmapFonts&&$G._bitmapFonts[$V]){var $r=$G._bitmapFonts[$V];$U&&$r.destroy(),delete $G._bitmapFonts[$V]}},$G.setTextRightToLeft=function(){var $V;($V=$j.canvas.source.style).display="none",$V.position="absolute",$V.direction="rtl",$m._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$j.document.body.appendChild($j.canvas.source)},$G.supportFont=function($V){$j.context.font="10px sans-serif";var $U=$v.contextMeasureText("abcji").width;$j.context.font="10px "+$V;var $r=$v.contextMeasureText("abcji").width;return console.log($U,$r),$U!==$r},$G._testWord="游",$G.langPacks=null,$G.VISIBLE="visible",$G.SCROLL="scroll",$G.HIDDEN="hidden",$G.CharacterCache=!0,$G.RightToLeft=!1,$G._bitmapFonts=null,$N($G,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$G}($SV),$lV=function($S){function $R(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$R.__super.call(this),this.offset=new $D,this._canvasTransform=new $z,this._previousOrientation=$j.window.orientation;var $U=this;this.transform=$z.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $V=$j.window,$r=this;$V.addEventListener("focus",function(){$U._isFocused=!0,$r.event("focus"),$r.event("focuschange")}),$V.addEventListener("blur",function(){$U._isFocused=!1,$r.event("blur"),$r.event("focuschange"),$r._isInputting()&&($dV.inputElement.target.focus=!1)});var $s="visibilityState",$p="visibilitychange",$c=$V.document;void 0!==$c.hidden?($p="visibilitychange",$s="visibilityState"):void 0!==$c.mozHidden?($p="mozvisibilitychange",$s="mozVisibilityState"):void 0!==$c.msHidden?($p="msvisibilitychange",$s="msVisibilityState"):void 0!==$c.webkitHidden&&($p="webkitvisibilitychange",$s="webkitVisibilityState"),$V.document.addEventListener($p,function(){"hidden"==$j.document[$s]?$r._setStageVisible(!1):$r._setStageVisible(!0)}),$V.document.addEventListener("qbrowserVisibilityChange",function($V){$r._setStageVisible(!$V.hidden)}),$V.addEventListener("resize",function(){var $V=$j.window.orientation;null!=$V&&$V!=$U._previousOrientation&&$r._isInputting()&&($dV.inputElement.target.focus=!1),$U._previousOrientation=$V,$r._isInputting()||$r._resetCanvas()}),$V.addEventListener("orientationchange",function($V){$r._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$j.onMobile&&this.on("mousedown",this,this._onmouseMove)}$u($R,"laya.display.Stage",$S);var $V=$R.prototype;return $V._setStageVisible=function($V){this._isVisibility!=$V&&(this._isVisibility=$V,this._isVisibility||this._isInputting()&&($dV.inputElement.target.focus=!1),this.event("visibilitychange"))},$V._isInputting=function(){return $j.onMobile&&$dV.isInputting},$V._changeCanvasSize=function(){this.setScreenSize($j.clientWidth*$j.pixelRatio,$j.clientHeight*$j.pixelRatio)},$V._resetCanvas=function(){if(this.screenAdaptationEnabled){var $V=$m._mainCanvas;$V.source.style;$V.size(1,1),$y.timer.once(100,this,this._changeCanvasSize)}},$V.setScreenSize=function($V,$U){var $r=!1;if("none"!==this._screenMode&&($r=($V/$U<1?"vertical":"horizontal")!==this._screenMode)){var $s=$U;$U=$V,$V=$s}this.canvasRotation=$r;var $p=$m._mainCanvas,$c=$p.source.style,$R=this._canvasTransform.identity(),$T=this._scaleMode,$N=$V/this.designWidth,$t=$U/this.designHeight,$b=this.designWidth,$S=this.designHeight,$_=$V,$G=$U,$q=$j.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$T){case"noscale":$N=$t=1,$_=this.designWidth,$G=this.designHeight;break;case"showall":$N=$t=Math.min($N,$t),$b=$_=Math.round(this.designWidth*$N),$S=$G=Math.round(this.designHeight*$t);break;case"noborder":$N=$t=Math.max($N,$t),$_=Math.round(this.designWidth*$N),$G=Math.round(this.designHeight*$t);break;case"full":$N=$t=1,this._width=$b=$V,this._height=$S=$U;break;case"fixedwidth":$t=$N,this._height=$S=Math.round($U/$N);break;case"fixedheight":$N=$t,this._width=$b=Math.round($V/$t);break;case"fixedauto":$V/$U<this.designWidth/this.designHeight?($t=$N,this._height=$S=Math.round($U/$N)):($N=$t,this._width=$b=Math.round($V/$t))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$b=$b+1&2147483646,$S=$S+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$N*=this.scaleX,$t*=this.scaleY,1===$N&&1===$t?this.transform.identity():(this.transform.a=this._formatData($N/($_/$b)),this.transform.d=this._formatData($t/($G/$S)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$p.size($b,$S),$w.changeWebGLSize($b,$S),$R.scale($_/$b/$q,$G/$S/$q),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($V-$_)/$q:this.offset.x=.5*($V-$_)/$q,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($U-$G)/$q:this.offset.y=.5*($U-$G)/$q,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$R.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$r&&("horizontal"===this._screenMode?($R.rotate(Math.PI/2),$R.translate($U/$q,0),this.canvasDegree=90):($R.rotate(-Math.PI/2),$R.translate(0,$V/$q),this.canvasDegree=-90)),$R.a=this._formatData($R.a),$R.d=this._formatData($R.d),$R.tx=this._formatData($R.tx),$R.ty=this._formatData($R.ty),$c.transformOrigin=$c.webkitTransformOrigin=$c.msTransformOrigin=$c.mozTransformOrigin=$c.oTransformOrigin="0px 0px 0px",$c.transform=$c.webkitTransform=$c.msTransform=$c.mozTransform=$c.oTransform="matrix("+$R.toString()+")",$R.translate(parseInt($c.left)||0,parseInt($c.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$V._formatData=function($V){return Math.abs($V)<1e-6?0:Math.abs(1-$V)<.001?0<$V?1:-1:$V},$V.getMousePoint=function(){return $D.TEMP.setTo(this.mouseX,this.mouseY)},$V.repaint=function(){this._repaint=1},$V.parentRepaint=function(){},$V._loop=function(){return this.render($m.context,0,0),!0},$V._onmouseMove=function($V){this._mouseMoveTime=$j.now()},$V.getTimeFromFrameStart=function(){return $j.now()-this._frameStartTime},$V.render=function($V,$U,$r){if("sleep"===this._frameRate&&!$m.isConchApp){var $s=$j.now();if(!(1e3<=$s-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($e.loopCount++,$q.instance.runEvent(),$y.timer._update()));this._frameStartTime=$s}if(this._renderCount++,$m.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$j.now();var $p="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$c=this._renderCount%2==0;if($e.renderSlow=!$p,$p||$c||$m.isConchApp){var $R;$e.loopCount++,$q.instance.runEvent(),$y.timer._update(),$w.update3DLoop();var $T=0,$N=0;if($m.isConchNode)for($T=0,$N=this._scenes.length;$T<$N;$T++)($R=this._scenes[$T])&&$R._updateSceneConch();else for($T=0,$N=this._scenes.length;$T<$N;$T++)($R=this._scenes[$T])&&$R._updateScene();if($m.isConchNode){var $t=$SV.CustomList;for($T=0,$N=$t.length;$T<$N;$T++){var $b=$t[$T];$b.customRender($b.customContext,0,0)}return}}$m.isConchNode||this.renderingEnabled&&($p||!$c||$m.isConchWebGL)&&($m.isWebGL?$m.WebGL.mainContext&&!$m.WebGL.mainContext.isContextLost()&&($V.clear(),$S.prototype.render.call(this,$V,$U,$r),$e._show&&$e._sp&&$e._sp.render($V,$U,$r),$w.clear(this._bgColor),$w.beginFlush(),$V.flush(),$w.endFinish(),$Y.instance&&$Y.getInstance().endDispose()):($w.clear(this._bgColor),$S.prototype.render.call(this,$V,$U,$r),$e._show&&$e._sp&&$e._sp.render($V,$U,$r)))}else this._renderCount%5==0&&($e.loopCount++,$q.instance.runEvent(),$y.timer._update())},$V._requestFullscreen=function(){var $V=$j.document.documentElement;$V.requestFullscreen?$V.requestFullscreen():$V.mozRequestFullScreen?$V.mozRequestFullScreen():$V.webkitRequestFullscreen?$V.webkitRequestFullscreen():$V.msRequestFullscreen&&$V.msRequestFullscreen()},$V._fullScreenChanged=function(){$y.stage.event("fullscreenchange")},$V.exitFullscreen=function(){var $V=$j.document;$V.exitFullscreen?$V.exitFullscreen():$V.mozCancelFullScreen?$V.mozCancelFullScreen():$V.webkitExitFullscreen&&$V.webkitExitFullscreen()},$b(0,$V,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$b(0,$V,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$b(0,$V,"frameRate",function(){return this._frameRate},function($V){if(this._frameRate=$V,$m.isConchApp)switch(this._frameRate){case"slow":$j.window.conch&&$j.window.conchConfig.setSlowFrame&&$j.window.conchConfig.setSlowFrame(!0);break;case"fast":$j.window.conch&&$j.window.conchConfig.setSlowFrame&&$j.window.conchConfig.setSlowFrame(!1);break;case"mouse":$j.window.conch&&$j.window.conchConfig.setMouseFrame&&$j.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$j.window.conch&&$j.window.conchConfig.setLimitFPS&&$j.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$b(0,$V,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$b(0,$V,"width",$S.prototype._$get_width,function($V){this.designWidth=$V,$y.superSet($SV,this,"width",$V),$y.timer.callLater(this,this._changeCanvasSize)}),$b(0,$V,"alignH",function(){return this._alignH},function($V){this._alignH=$V,$y.timer.callLater(this,this._changeCanvasSize)}),$b(0,$V,"isFocused",function(){return this._isFocused}),$b(0,$V,"height",$S.prototype._$get_height,function($V){this.designHeight=$V,$y.superSet($SV,this,"height",$V),$y.timer.callLater(this,this._changeCanvasSize)}),$b(0,$V,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$z.create()},$S.prototype._$set_transform),$b(0,$V,"isVisibility",function(){return this._isVisibility}),$b(0,$V,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$b(0,$V,"scaleMode",function(){return this._scaleMode},function($V){this._scaleMode=$V,$y.timer.callLater(this,this._changeCanvasSize)}),$b(0,$V,"alignV",function(){return this._alignV},function($V){this._alignV=$V,$y.timer.callLater(this,this._changeCanvasSize)}),$b(0,$V,"bgColor",function(){return this._bgColor},function($V){this._bgColor=$V,this.conchModel&&this.conchModel.bgColor($V),$m.isWebGL&&($V?$R._wgColor=$B.create($V)._color:$j.onMiniGame||($R._wgColor=null)),$j.onLimixiu?$R._wgColor=$B.create($V)._color:$m.canvas.style.background=$V||"none"}),$b(0,$V,"mouseX",function(){return Math.round($q.instance.mouseX/this.clientScaleX)}),$b(0,$V,"mouseY",function(){return Math.round($q.instance.mouseY/this.clientScaleY)}),$b(0,$V,"screenMode",function(){return this._screenMode},function($V){this._screenMode=$V}),$b(0,$V,"visible",$S.prototype._$get_visible,function($V){this.visible!==$V&&($y.superSet($SV,this,"visible",$V),$m._mainCanvas.source.style.visibility=$V?"visible":"hidden")}),$b(0,$V,"fullScreenEnabled",null,function($V){var $U=$j.document,$r=$m.canvas;$V?($r.addEventListener("mousedown",this._requestFullscreen),$r.addEventListener("touchstart",this._requestFullscreen),$U.addEventListener("fullscreenchange",this._fullScreenChanged),$U.addEventListener("mozfullscreenchange",this._fullScreenChanged),$U.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$U.addEventListener("msfullscreenchange",this._fullScreenChanged)):($r.removeEventListener("mousedown",this._requestFullscreen),$r.removeEventListener("touchstart",this._requestFullscreen),$U.removeEventListener("fullscreenchange",this._fullScreenChanged),$U.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$U.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$U.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$R.SCALE_NOSCALE="noscale",$R.SCALE_EXACTFIT="exactfit",$R.SCALE_SHOWALL="showall",$R.SCALE_NOBORDER="noborder",$R.SCALE_FULL="full",$R.SCALE_FIXED_WIDTH="fixedwidth",$R.SCALE_FIXED_HEIGHT="fixedheight",$R.SCALE_FIXED_AUTO="fixedauto",$R.ALIGN_LEFT="left",$R.ALIGN_RIGHT="right",$R.ALIGN_CENTER="center",$R.ALIGN_TOP="top",$R.ALIGN_MIDDLE="middle",$R.ALIGN_BOTTOM="bottom",$R.SCREEN_NONE="none",$R.SCREEN_HORIZONTAL="horizontal",$R.SCREEN_VERTICAL="vertical",$R.FRAME_FAST="fast",$R.FRAME_SLOW="slow",$R.FRAME_MOUSE="mouse",$R.FRAME_SLEEP="sleep",$R.FRAME_MOUSE_THREDHOLD=2e3,$N($R,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$R}($SV),$WV=(function($V){function $U(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$U.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$u($U,"laya.media.SoundNode",$SV);var $r=$U.prototype;$r._onParentChange=function(){this.target=this.parent},$r.play=function($V,$U){void 0===$V&&($V=1),isNaN($V)&&($V=1),this.url&&(this.stop(),this._channel=$H.playSound(this.url,$V,null,$U))},$r.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$r._setPlayAction=function($V,$U,$r,$s){void 0===$s&&($s=!0),this[$r]&&$V&&($s?$V.on($U,this,this[$r]):$V.off($U,this,this[$r]))},$r._setPlayActions=function($V,$U,$r,$s){if(void 0===$s&&($s=!0),$V&&$U){var $p,$c=$U.split(","),$R=0;for($p=$c.length,$R=0;$R<$p;$R++)this._setPlayAction($V,$c[$R],$r,$s)}},$b(0,$r,"playEvent",null,function($V){(this._playEvents=$V)&&this._tar&&this._setPlayActions(this._tar,$V,"play")}),$b(0,$r,"target",null,function($V){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$V,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$b(0,$r,"stopEvent",null,function($V){(this._stopEvents=$V)&&this._tar&&this._setPlayActions(this._tar,$V,"stop")})}(),function($V){function $U(){this._src=null,this._onload=null,this._onerror=null,$U.__super.call(this)}$u($U,"laya.resource.FileBitmap",$qV);var $r=$U.prototype;return $b(0,$r,"src",function(){return this._src},function($V){this._src=$V}),$b(0,$r,"onload",null,function($V){}),$b(0,$r,"onerror",null,function($V){}),$U}()),$OV=function($V){function $r($V,$U){this._is2D=!1,$r.__super.call(this);var $s=this;if(this._source=this,"2D"===$V||"AUTO"===$V&&!$m.isWebGL){this._is2D=!0,this._source=$U||$j.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $p=this;$p.getContext=function($V,$U){if($s._ctx)return $s._ctx;var $r=$s._ctx=$s._source.getContext($V,$U);return $r&&($r._canvas=$p,$m.isFlash||$j.onLimixiu||($r.size=function($V,$U){})),$r}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$u($r,"laya.resource.HTMLCanvas",$qV);var $U=$r.prototype;return $U.clear=function(){this._ctx&&this._ctx.clear()},$U.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$U.release=function(){},$U._setContext=function($V){this._ctx=$V},$U.getContext=function($V,$U){return this._ctx?this._ctx:this._ctx=$r._createContext(this)},$U.getMemSize=function(){return 0},$U.size=function($V,$U){(this._w!=$V||this._h!=$U||this._source&&(this._source.width!=$V||this._source.height!=$U))&&(this._w=$V,this._h=$U,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($V,$U),this._source&&(this._source.height=$U,this._source.width=$V))},$U.getCanvas=function(){return this._source},$U.toBase64=function($V,$U,$r){if(this._source)if($m.isConchApp&&this._source.toBase64)this._source.toBase64($V,$U,$r);else{var $s=this._source.toDataURL($V,$U);$r.call(this,$s)}},$b(0,$U,"context",function(){return this._ctx}),$b(0,$U,"asBitmap",null,function($V){}),$r.create=function($V,$U){return new $r($V,$U)},$r.TYPE2D="2D",$r.TYPE3D="3D",$r.TYPEAUTO="AUTO",$r._createContext=null,$r}(),$LV=(function($V){function $N($V,$U,$r,$s,$p,$c,$R,$T){throw $N.__super.call(this),new Error("不允许new！")}$u($N,"laya.resource.HTMLSubImage",$qV),$N.create=function($V,$U,$r,$s,$p,$c,$R,$T){return void 0===$T&&($T=!1),new $N($V,$U,$r,$s,$p,$c,$R,$T)}}(),function($V){function $S(){this._frames=null,this._url=null,$S.__super.call(this),this._setControlNode(this)}$u($S,"laya.display.Animation",$V);var $U=$S.prototype;$U.destroy=function($V){void 0===$V&&($V=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$V),this._frames=null,this._labels=null},$U.play=function($V,$U,$r,$s){void 0===$V&&($V=0),void 0===$U&&($U=!0),void 0===$r&&($r=""),void 0===$s&&($s=!0),$r&&this._setFramesFromCache($r,$s),this._isPlaying=!0,this.index="string"==typeof $V?this._getFrameByLabel($V):$V,this.loop=$U,this._actionName=$r,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$U._setFramesFromCache=function($V,$U){var $r;return void 0===$U&&($U=!1),this._url&&($V=this._url+"#"+$V),$V&&$S.framesMap[$V]?(($r=$S.framesMap[$V])instanceof Array?(this._frames=$S.framesMap[$V],this._count=this._frames.length):($r.nodeRoot&&($S.framesMap[$V]=this._parseGraphicAnimationByData($r),$r=$S.framesMap[$V]),this._frames=$r.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$r.interval),this._labels=this._copyLabels($r.labels)),!0):($U&&console.log("ani not found:",$V),!1)},$U._copyLabels=function($V){if(!$V)return null;var $U,$r;for($r in $U={},$V)$U[$r]=$v.copyArray([],$V[$r]);return $U},$U._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$V.prototype._frameLoop.call(this)},$U._displayToIndex=function($V){this._frames&&(this.graphics=this._frames[$V])},$U.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$U.loadImages=function($V,$U){return void 0===$U&&($U=""),this._url="",this._setFramesFromCache($U)||(this.frames=$S.framesMap[$U]?$S.framesMap[$U]:$S.createFrames($V,$U)),this},$U.loadAtlas=function($U,$r,$s){void 0===$s&&($s=""),this._url="";var $p=this;function $V($V){$U===$V&&($p.frames=$S.framesMap[$s]?$S.framesMap[$s]:$S.createFrames($U,$s),$r&&$r.run())}return $p._setFramesFromCache($s)||($TV.getAtlas($U)?$V($U):$y.loader.load($U,$W.create(null,$V,[$U]),null,"atlas")),this},$U.loadAnimation=function($V,$U,$r){this._url=$V;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$U&&$U.run()):!$r||$TV.getAtlas($r)?this._loadAnimationData($V,$U,$r):$y.loader.load($r,$W.create(this,this._loadAnimationData,[$V,$U,$r]),null,"atlas"),this},$U._loadAnimationData=function($T,$N,$V){var $t=this;if(!$V||$TV.getAtlas($V)){var $b=this;$TV.getRes($T)?$U($T):$y.loader.load($T,$W.create(null,$U,[$T]),null,"json"),$TV.clearRes($T)}else console.warn("atlas load fail:"+$V);function $U($V){if($TV.getRes($V)&&$T===$V){var $U;if($S.framesMap[$T+"#"])$b._setFramesFromCache($t._actionName,!0),$t.index=0,$t._checkResumePlaying();else{var $r=$b._parseGraphicAnimation($TV.getRes($T));if(!$r)return;var $s,$p=$r.animationList,$c=0,$R=$p.length;for($c=0;$c<$R;$c++)$U=$p[$c],$S.framesMap[$T+"#"+$U.name]=$U,$s||($s=$U);$s&&($S.framesMap[$T+"#"]=$s,$b._setFramesFromCache($t._actionName,!0),$t.index=0),$t._checkResumePlaying()}$N&&$N.run()}}},$U._parseGraphicAnimation=function($V){return $yV.parseAnimationData($V)},$U._parseGraphicAnimationByData=function($V){return $yV.parseAnimationByData($V)},$b(0,$U,"frames",function(){return this._frames},function($V){(this._frames=$V)&&(this._count=$V.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$b(0,$U,"autoPlay",null,function($V){$V?this.play():this.stop()}),$b(0,$U,"source",null,function($V){-1<$V.indexOf(".ani")?this.loadAnimation($V):-1<$V.indexOf(".json")||-1<$V.indexOf("als")||-1<$V.indexOf("atlas")?this.loadAtlas($V):this.loadImages($V.split(","))}),$b(0,$U,"autoAnimation",null,function($V){this.play(0,!0,$V,!1)}),$S.createFrames=function($V,$U){var $r,$s,$p=0,$c=0;if("string"==typeof $V){var $R=$TV.getAtlas($V);if($R&&$R.length)for($r=[],$p=0,$c=$R.length;$p<$c;$p++)($s=new $w.createGraphics).drawTexture($TV.getRes($R[$p]),0,0),$r.push($s)}else if($V instanceof Array)for($r=[],$p=0,$c=$V.length;$p<$c;$p++)($s=new $w.createGraphics).loadImage($V[$p],0,0),$r.push($s);return $U&&($S.framesMap[$U]=$r),$r},$S.clearCache=function($V){var $U,$r=$S.framesMap,$s=$V+"#";for($U in $r)$U!==$V&&0!=$U.indexOf($s)||delete $S.framesMap[$U]},$S.framesMap={}}($uV),function($V){function $c(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$c.__super.call(this),null==$c._sortIndexFun&&($c._sortIndexFun=$k.sortByKey("index",!1,!0))}$u($c,"laya.display.FrameAnimation",$V);var $U=$c.prototype;return $U._setUp=function($V,$U){this._labels=null,this._animationNewFrames=null,this._targetDic=$V,this._animationData=$U,this.interval=1e3/$U.frameRate,$U.parsed?(this._count=$U.count,this._labels=$U.labels,this._animationNewFrames=$U.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$U.parsed=!0,$U.labels=this._labels,$U.count=this._count,$U.animationNewFrames=this._animationNewFrames},$U.clear=function(){$V.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$U._displayToIndex=function($V){if(this._animationData){$V<0&&($V=0),$V>this._count&&($V=this._count);var $U=this._animationData.nodes,$r=0,$s=$U.length;for($r=0;$r<$s;$r++)this._displayNodeToFrame($U[$r],$V)}},$U._displayNodeToFrame=function($V,$U,$r){$r||($r=this._targetDic);var $s=$r[$V.target];if($s){var $p,$c,$R,$T=$V.frames,$N=$V.keys,$t=0,$b=$N.length;for($t=0;$t<$b;$t++)$R=($c=$T[$p=$N[$t]]).length>$U?$c[$U]:$c[$c.length-1],$s[$p]=$R}},$U._calculateDatas=function(){if(this._animationData){var $V,$U=this._animationData.nodes,$r=0,$s=$U.length;for($r=this._count=0;$r<$s;$r++)$V=$U[$r],this._calculateNodeKeyFrames($V);this._count+=1}},$U._calculateNodeKeyFrames=function($V){var $U,$r,$s=$V.keyframes,$p=$V.target;for($U in $V.frames||($V.frames={}),$V.keys?$V.keys.length=0:$V.keys=[],$V.initValues||($V.initValues={}),$s)$r=$s[$U],$V.frames[$U]||($V.frames[$U]=[]),this._targetDic&&this._targetDic[$p]&&($V.initValues[$U]=this._targetDic[$p][$U]),$r.sort($c._sortIndexFun),$V.keys.push($U),this._calculateNodePropFrames($r,$V.frames[$U],$U,$p)},$U.resetToInitState=function(){if(this._targetDic&&this._animationData){var $V,$U,$r=this._animationData.nodes,$s=0,$p=$r.length;for($s=0;$s<$p;$s++)if($U=($V=$r[$s]).initValues){var $c,$R=this._targetDic[$V.target];if($R)for($c in $U)$R[$c]=$U[$c]}}},$U._calculateNodePropFrames=function($V,$U,$r,$s){var $p=0,$c=$V.length-1;if(0<$c){for($U.length=$V[$c].index+1,$p=0;$p<$c;$p++)this._dealKeyFrame($V[$p]),this._calculateFrameValues($V[$p],$V[$p+1],$U);this._dealKeyFrame($V[$p])}0==$c&&($U[$V[0].index]=$V[0].value,this._animationNewFrames&&(this._animationNewFrames[$V[0].index]=!0))},$U._dealKeyFrame=function($V){$V.label&&""!=$V.label&&this.addLabel($V.label,$V.index)},$U._calculateFrameValues=function($V,$U,$r){var $s,$p=0,$c=$V.index,$R=$U.index,$T=$V.value,$N=$U.value-$V.value,$t=$R-$c;if($R>this._count&&(this._count=$R),$V.tween)for(null==($s=$M[$V.tweenMethod])&&($s=$M.linearNone),$p=$c;$p<$R;$p++)$r[$p]=$s($p-$c,$T,$N,$t),this._animationNewFrames&&(this._animationNewFrames[$p]=!0);else for($p=$c;$p<$R;$p++)$r[$p]=$T;this._animationNewFrames&&(this._animationNewFrames[$V.index]=!0,this._animationNewFrames[$U.index]=!0),$r[$U.index]=$U.value},$c._sortIndexFun=null,$c}($uV)),$dV=function($U){function $p(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$p.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$hV.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$u($p,"laya.display.Input",$U);var $V=$p.prototype;return $V.setSelection=function($V,$U){this.focus=!0,laya.display.Input.inputElement.selectionStart=$V,laya.display.Input.inputElement.selectionEnd=$U},$V._onUnDisplay=function($V){this.focus=!1},$V._onMouseDown=function($V){this.focus=!0},$V._syncInputTransform=function(){var $V=this.nativeInput,$U=$v.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$r=this._width-this.padding[1]-this.padding[3],$s=this._height-this.padding[0]-this.padding[2];$m.isConchApp?($V.setScale($U.scaleX,$U.scaleY),$V.setSize($r,$s),$V.setPos($U.x,$U.y)):($p.inputContainer.style.transform=$p.inputContainer.style.webkitTransform="scale("+$U.scaleX+","+$U.scaleY+") rotate("+$y.stage.canvasDegree+"deg)",$V.style.width=$r+"px",$V.style.height=$s+"px",$p.inputContainer.style.left=$U.x+"px",$p.inputContainer.style.top=$U.y+"px")},$V.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$V._setInputMethod=function(){$p.input.parentElement&&$p.inputContainer.removeChild($p.input),$p.area.parentElement&&$p.inputContainer.removeChild($p.area),$p.inputElement=this._multiline?$p.area:$p.input,$p.inputContainer.appendChild($p.inputElement),$hV.RightToLeft&&($p.inputElement.style.direction="rtl")},$V._focusIn=function(){laya.display.Input.isInputting=!0;var $V=this.nativeInput;this._focus=!0;var $U=$V.style;$U.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$V.readOnly=!this._editable,$m.isConchApp&&($V.setType(this._type),$V.setForbidEdit(!this._editable)),$V.maxLength=this._maxChars;this.padding;if($V.type=this._type,$V.value=this._content,$V.placeholder=this._prompt,$y.stage.off("keydown",this,this._onKeyDown),$y.stage.on("keydown",this,this._onKeyDown),($y.stage.focus=this).event("focus"),$j.onPC&&$V.focus(),!$j.onMiniGame){this._text;this._text=null}this.typeset(),$V.setColor(this._originColor),$V.setFontSize(this.fontSize),$V.setFontFace($j.onIPhone&&$hV._fontFamilyMap[this.font]||this.font),$m.isConchApp&&$V.setMultiAble&&$V.setMultiAble(this._multiline),$U.lineHeight=this.leading+this.fontSize+"px",$U.fontStyle=this.italic?"italic":"normal",$U.fontWeight=this.bold?"bold":"normal",$U.textAlign=this.align,$U.padding="0 0",this._syncInputTransform(),!$m.isConchApp&&$j.onPC&&$y.timer.frameLoop(1,this,this._syncInputTransform)},$V._setPromptColor=function(){($p.promptStyleDOM=$j.getElementById("promptStyle"))||(($p.promptStyleDOM=$j.createElement("style")).setAttribute("id","promptStyle"),$j.document.head.appendChild($p.promptStyleDOM)),$p.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$V._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($y.superSet($hV,this,"text",this._content),$y.superSet($hV,this,"color",this._originColor)):($y.superSet($hV,this,"text",this._prompt),$y.superSet($hV,this,"color",this._promptColor)),$y.stage.off("keydown",this,this._onKeyDown),$y.stage.focus=null,this.event("blur"),$m.isConchApp&&this.nativeInput.blur(),$j.onPC&&$y.timer.clear(this,this._syncInputTransform)},$V._onKeyDown=function($V){13===$V.keyCode&&($j.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$V.changeText=function($V){this._content=$V,this._focus?(this.nativeInput.value=$V||"",this.event("change")):$U.prototype.changeText.call(this,$V)},$b(0,$V,"color",$U.prototype._$get_color,function($V){this._focus&&this.nativeInput.setColor($V),$y.superSet($hV,this,"color",this._content?$V:this._promptColor),this._originColor=$V}),$b(0,$V,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($V){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$b(0,$V,"multiline",function(){return this._multiline},function($V){this._multiline=$V,this.valign=$V?"top":"middle"}),$b(0,$V,"maxChars",function(){return this._maxChars},function($V){$V<=0&&($V=1e5),this._maxChars=$V}),$b(0,$V,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($V){$y.superSet($hV,this,"color",this._originColor),$V+="",this._focus?(this.nativeInput.value=$V||"",this.event("change")):(this._multiline||($V=$V.replace(/\r?\n/g,"")),(this._content=$V)?$y.superSet($hV,this,"text",$V):($y.superSet($hV,this,"text",this._prompt),$y.superSet($hV,this,"color",this.promptColor)))}),$b(0,$V,"nativeInput",function(){return this._multiline?$p.area:$p.input}),$b(0,$V,"prompt",function(){return this._prompt},function($V){!this._text&&$V&&$y.superSet($hV,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$y.superSet($hV,this,"text",this._text==this._prompt?$V:this._text):$y.superSet($hV,this,"text",$V),this._prompt=$hV.langPacks&&$hV.langPacks[$V]?$hV.langPacks[$V]:$V}),$b(0,$V,"focus",function(){return this._focus},function($V){var $U=this.nativeInput;this._focus!==$V&&($V?($U.target?$U.target._focusOut():this._setInputMethod(),($U.target=this)._focusIn()):($U.target=null,this._focusOut(),$j.document.body.scrollTop=0,$U.blur(),$m.isConchApp?$U.setPos(-1e4,-1e4):$p.inputContainer.contains($U)&&$p.inputContainer.removeChild($U)))}),$b(0,$V,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($V){$V?(-1<($V="[^"+$V+"]").indexOf("^^")&&($V=$V.replace("^^","")),this._restrictPattern=new RegExp($V,"g")):this._restrictPattern=null}),$b(0,$V,"editable",function(){return this._editable},function($V){this._editable=$V,$m.isConchApp&&$p.input.setForbidEdit(!$V)}),$b(0,$V,"promptColor",function(){return this._promptColor},function($V){this._promptColor=$V,this._content||$y.superSet($hV,this,"color",$V)}),$b(0,$V,"type",function(){return this._type},function($V){this._getCSSStyle().password="password"==$V,this._type=$V,$m.isConchApp&&this.nativeInput.setType($V)}),$b(0,$V,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($V){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$b(0,$V,"asPassword",function(){return this._getCSSStyle().password},function($V){this._getCSSStyle().password=$V,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$p.__init__=function(){$p._createInputElement(),$j.onMobile&&$m.canvas.addEventListener($p.IOS_IFRAME?$j.onMiniGame?"touchend":"click":"touchend",$p._popupInputMethod)},$p._popupInputMethod=function($V){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$p._createInputElement=function(){$p._initInput($p.area=$j.createElement("textarea")),$p._initInput($p.input=$j.createElement("input")),($p.inputContainer=$j.createElement("div")).style.position="absolute",$p.inputContainer.style.zIndex=1e5,$j.container.appendChild($p.inputContainer),$p.inputContainer.setPos=function($V,$U){$p.inputContainer.style.left=$V+"px",$p.inputContainer.style.top=$U+"px"}},$p._initInput=function($U){var $V=$U.style;$V.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$V.resize="none",$V.backgroundColor="transparent",$V.border="none",$V.outline="none",$V.zIndex=1,$U.addEventListener("input",$p._processInputting),$U.addEventListener("mousemove",$p._stopEvent),$U.addEventListener("mousedown",$p._stopEvent),$U.addEventListener("touchmove",$p._stopEvent),$U.setFontFace=function($V){$U.style.fontFamily=$V},$m.isConchApp||($U.setColor=function($V){$U.style.color=$V},$U.setFontSize=function($V){$U.style.fontSize=$V+"px"})},$p._processInputting=function($V){var $U=laya.display.Input.inputElement.target;if($U){var $r=laya.display.Input.inputElement.value;$U._restrictPattern&&($r=$r.replace(/\u2006|\x27/g,""),$U._restrictPattern.test($r)&&($r=$r.replace($U._restrictPattern,""),laya.display.Input.inputElement.value=$r)),$U._text=$r,$U.event("input")}},$p._stopEvent=function($V){"touchmove"==$V.type&&$V.preventDefault(),$V.stopPropagation&&$V.stopPropagation()},$p.TYPE_TEXT="text",$p.TYPE_PASSWORD="password",$p.TYPE_EMAIL="email",$p.TYPE_URL="url",$p.TYPE_NUMBER="number",$p.TYPE_RANGE="range",$p.TYPE_DATE="date",$p.TYPE_MONTH="month",$p.TYPE_WEEK="week",$p.TYPE_TIME="time",$p.TYPE_DATE_TIME="datetime",$p.TYPE_DATE_TIME_LOCAL="datetime-local",$p.TYPE_SEARCH="search",$p.input=null,$p.area=null,$p.inputElement=null,$p.inputContainer=null,$p.confirmButton=null,$p.promptStyleDOM=null,$p.inputHeight=45,$p.isInputting=!1,$p.stageMatrix=null,$N($p,["IOS_IFRAME",function(){return this.IOS_IFRAME=$j.onIOS&&$j.window.top!=$j.window.self}]),$p}($hV),$kV=function($V){function $r($V,$U){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$r.__super.call(this),$V&&this._init_($V,$U)}$u($r,"laya.resource.HTMLImage",$WV);var $U=$r.prototype;return $U._init_=function($V,$U){this._src=$V,this._source=new $j.window.Image,$U&&($U.onload&&(this.onload=$U.onload),$U.onerror&&(this.onerror=$U.onerror),$U.onCreate&&$U.onCreate(this)),0!=$V.indexOf("data:image")&&(this._source.crossOrigin=""),$V&&(this._source.src=$V)},$U.recreateResource=function(){var $V=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $U=this;this._source=new $j.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($U._needReleaseAgain)return $U._needReleaseAgain=!1,$U._source.onload=null,void($U._source=null);$U._source.onload=null,$U.memorySize=$V._w*$V._h*4,$U._recreateLock=!1,$U.completeCreate()},this._source.src=this._src}},$U.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$U.onresize=function(){this._w=this._source.width,this._h=this._source.height},$b(0,$U,"onload",null,function($V){var $U=this;this._onload=$V,this._source&&(this._source.onload=null!=this._onload?function(){$U.onresize(),$U._onload()}:null)}),$b(0,$U,"onerror",null,function($V){var $U=this;this._onerror=$V,this._source&&(this._source.onerror=null!=this._onerror?function(){$U._onerror()}:null)}),$b(0,$U,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($V){this._enableMerageInAtlas=$V,$m.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$V)}),$r.create=function($V,$U){return new $r($V,$U)},$r}(),$yV=(function($c){function $V(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$V.__super.call(this)}$u($V,"laya.display.EffectAnimation",$c);var $U=$V.prototype;$U._onOtherBegin=function($V){$V!=this&&this.stop()},$U.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$U._onPlayAction=function(){this.play(0,!1)},$U.play=function($V,$U,$r,$s){void 0===$V&&($V=0),void 0===$U&&($U=!0),void 0===$r&&($r=""),void 0===$s&&($s=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$V,$U,$r,$s))},$U._recordInitData=function(){if(this._aniKeys){var $V,$U,$r=0;for($V=this._aniKeys.length,$r=0;$r<$V;$r++)$U=this._aniKeys[$r],this._initData[$U]=this._target[$U]}},$U._displayToIndex=function($V){if(this._animationData){$V<0&&($V=0),$V>this._count&&($V=this._count);var $U=this._animationData.nodes,$r=0,$s=$U.length;for($s=1<$s?1:$s,$r=0;$r<$s;$r++)this._displayNodeToFrame($U[$r],$V)}},$U._displayNodeToFrame=function($V,$U,$r){if(this._target){var $s;$s=this._target;var $p,$c,$R,$T,$N=$V.frames,$t=$V.keys,$b=0,$S=$t.length;$T=$V.secondFrames;var $_,$G,$q,$u,$h=0;for($b=0;$b<$S;$b++)$c=$N[$p=$t[$b]],$R=-1==($h=$T[$p])?this._initData[$p]:$U<$h?($q=($G=$V.keyframes[$p])[0]).tween?(null==($_=$M[$q.tweenMethod])&&($_=$M.linearNone),$u=$G[1],$_($U,this._initData[$p],$u.value-this._initData[$p],$u.index)):this._initData[$p]:$c.length>$U?$c[$U]:$c[$c.length-1],$s[$p]=$R}},$U._calculateNodeKeyFrames=function($V){$c.prototype._calculateNodeKeyFrames.call(this,$V);var $U,$r,$s,$p=$V.keyframes;$V.target;for($U in $s={},$V.secondFrames=$s,$p)($r=$p[$U]).length<=1?$s[$U]=-1:$s[$U]=$r[1].index},$b(0,$U,"target",function(){return this._target},function($V){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$V,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$b(0,$U,"playEvent",null,function($V){(this._playEvents=$V)&&this.addEvent()}),$b(0,$U,"effectData",null,function($V){var $U;$V&&(($U=$V.animations)&&$U[0]&&(this._setUp({},$U[0]),$U[0].nodes&&$U[0].nodes[0]&&(this._aniKeys=$U[0].nodes[0].keys)))}),$b(0,$U,"effectClass",null,function($V){var $U,$r;(this._effectClass=$i.getClass($V),this._effectClass)&&(($U=this._effectClass.uiView)&&($r=$U.animations)&&$r[0]&&(this._setUp({},$r[0]),$r[0].nodes&&$r[0].nodes[0]&&(this._aniKeys=$r[0].nodes[0].keys)))}),$V.EffectAnimationBegin="effectanimationbegin"}($LV),function($U){var $Q;function $H(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$H.__super.call(this)}$u($H,"laya.utils.GraphicAnimation",$U);var $V=$H.prototype;return $V._parseNodeList=function($V){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$V.compId]=$V.props,$V.compId&&this._nodeList.push($V.compId);var $U=$V.child;if($U){var $r=0,$s=$U.length;for($r=0;$r<$s;$r++)this._parseNodeList($U[$r])}},$V._calGraphicData=function($V){var $U;if(this._setUp(null,$V),this._createGraphicData(),this._nodeIDAniDic)for($U in this._nodeIDAniDic)this._nodeIDAniDic[$U]=null},$V._createGraphicData=function(){var $V,$U=[],$r=0,$s=this.count,$p=this._animationNewFrames;for($p||($p=[]),$r=0;$r<$s;$r++)!$p[$r]&&$V||($V=this._createFrameGraphic($r)),$U.push($V);this._gList=$U},$V._createFrameGraphic=function($V){var $U=$w.createGraphics();return $H._rootMatrix||($H._rootMatrix=new $z),this._updateNodeGraphic(this._rootNode,$V,$H._rootMatrix,$U),$U},$V._updateNodeGraphic=function($V,$U,$r,$s,$p){var $c;void 0===$p&&($p=1);var $R,$T,$N,$t=($c=this._nodeGDic[$V.compId]=this._getNodeGraphicData($V.compId,$U,this._nodeGDic[$V.compId])).alpha*$p;if(!($t<.01)&&($c.resultTransform||($c.resultTransform=$z.create()),$R=$c.resultTransform,$z.mul($c.transform,$r,$R),$c.skin&&($T=this._getTextureByUrl($c.skin))&&($R._checkTransform()?($s.drawTexture($T,0,0,$c.width,$c.height,$R,$t),$c.resultTransform=null):$s.drawTexture($T,$R.tx,$R.ty,$c.width,$c.height,null,$t)),$N=$V.child)){var $b,$S=0;for($b=$N.length,$S=0;$S<$b;$S++)this._updateNodeGraphic($N[$S],$U,$R,$s,$t)}},$V._updateNoChilds=function($V,$U){if($V.skin){var $r=this._getTextureByUrl($V.skin);if($r){var $s=$V.transform;$s._checkTransform();!$s.bTransform?$U.drawTexture($r,$s.tx,$s.ty,$V.width,$V.height,null,$V.alpha):$U.drawTexture($r,0,0,$V.width,$V.height,$s.clone(),$V.alpha)}}},$V._updateNodeGraphic2=function($V,$U,$r){var $s;if($s=this._nodeGDic[$V.compId]=this._getNodeGraphicData($V.compId,$U,this._nodeGDic[$V.compId]),$V.child){var $p=$s.transform;$p._checkTransform();var $c,$R;$R=($c=!$p.bTransform)&&(0!=$p.tx||0!=$p.ty);var $T,$N,$t;if(($T=$p.bTransform||1!=$s.alpha)&&$r.save(),1!=$s.alpha&&$r.alpha($s.alpha),$c?$R&&$r.translate($p.tx,$p.ty):$r.transform($p.clone()),$N=$V.child,$s.skin&&($t=this._getTextureByUrl($s.skin))&&$r.drawTexture($t,0,0,$s.width,$s.height),$N){var $b,$S=0;for($b=$N.length,$S=0;$S<$b;$S++)this._updateNodeGraphic2($N[$S],$U,$r)}$T?$r.restore():$c?$R&&$r.translate(-$p.tx,-$p.ty):$r.transform($p.clone().invert())}else this._updateNoChilds($s,$r)},$V._calculateNodeKeyFrames=function($V){$U.prototype._calculateNodeKeyFrames.call(this,$V),this._nodeIDAniDic[$V.target]=$V},$V.getNodeDataByID=function($V){return this._nodeIDAniDic[$V]},$V._getParams=function($V,$U,$r,$s){var $p=$H._temParam;$p.length=$U.length;var $c=0,$R=$U.length;for($c=0;$c<$R;$c++)$p[$c]=this._getObjVar($V,$U[$c][0],$r,$U[$c][1],$s);return $p},$V._getObjVar=function($V,$U,$r,$s,$p){if($V.hasOwnProperty($U)){var $c=$V[$U];if($r>=$c.length&&($r=$c.length-1),null!=$V[$U][$r])return $V[$U][$r]}return $p.hasOwnProperty($U)?$p[$U]:$s},$V._getNodeGraphicData=function($V,$U,$r){$r||($r=$Q.create()),$r.transform?$r.transform.identity():$r.transform=$z.create();var $s=this.getNodeDataByID($V);if(!$s)return $r;var $p,$c,$R=$s.frames,$T=this._getParams($R,$H._drawTextureCmd,$U,this._nodeDefaultProps[$V]),$N=$T[0],$t=NaN,$b=NaN,$S=$T[5],$_=$T[6],$G=$T[13],$q=$T[14],$u=$T[7],$h=$T[8],$l=$T[9],$W=$T[11],$O=$T[12];$t=$T[3],$b=$T[4],0!=$t&&0!=$b||($N=null),-1==$t&&($t=0),-1==$b&&($b=0),$r.skin=$N,$r.width=$t,$r.height=$b,$N&&(($p=this._getTextureByUrl($N))?($t||($t=$p.sourceWidth),$b||($b=$p.sourceHeight)):console.warn("lost skin:",$N,",you may load pics first")),$r.alpha=$T[10],$c=$r.transform,0!=$G&&($S=$G*$t),0!=$q&&($_=$q*$b),0==$S&&0==$_||$c.translate(-$S,-$_);var $L=null;if($l||1!==$u||1!==$h||$W||$O){($L=$H._tempMt).identity(),$L.bTransform=!0;var $d=.0174532922222222*($l-$W),$k=.0174532922222222*($l+$O),$y=Math.cos($k),$D=Math.sin($k),$n=Math.sin($d),$I=Math.cos($d);$L.a=$u*$y,$L.b=$u*$D,$L.c=-$h*$n,$L.d=$h*$I,$L.tx=$L.ty=0}return $L&&($c=$z.mul($c,$L,$c)),$c.translate($T[1],$T[2]),$r},$V._getTextureByUrl=function($V){return $TV.getRes($V)},$V.setAniData=function($V,$U){if($V.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$V,this._parseNodeList($V);var $r,$s={},$p=[],$c=$V.animations,$R=0,$T=$c.length;for($R=0;$R<$T;$R++)if($r=$c[$R],this._labels=null,(!$U||$U==$r.name)&&$r){try{this._calGraphicData($r)}catch($V){console.warn("parse animation fail:"+$r.name+",empty animation created"),this._gList=[]}var $N={};$N.interval=1e3/$r.frameRate,$N.frames=this._gList,$N.labels=this._labels,$N.name=$r.name,$p.push($N),$s[$r.name]=$N}this.animationList=$p,this.animationDic=$s}$H._temParam.length=0},$V.parseByData=function($V){var $U,$r;$U=$V.nodeRoot,$r=$V.aniO,delete $V.nodeRoot,delete $V.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$U,this._parseNodeList($U),this._labels=null;try{this._calGraphicData($r)}catch($V){console.warn("parse animation fail:"+$r.name+",empty animation created"),this._gList=[]}var $s=$V;return $s.interval=1e3/$r.frameRate,$s.frames=this._gList,$s.labels=this._labels,$s.name=$r.name,$s},$V.setUpAniData=function($V){if($V.animations){var $U,$r={},$s=[],$p=$V.animations,$c=0,$R=$p.length;for($c=0;$c<$R;$c++)if($U=$p[$c]){var $T={};$T.name=$U.name,$T.aniO=$U,$T.nodeRoot=$V,$s.push($T),$r[$U.name]=$T}this.animationList=$s,this.animationDic=$r}},$V._clear=function(){var $V,$U;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($V in this._nodeGDic)($U=this._nodeGDic[$V])&&$U.recover();this._nodeGDic=null},$H.parseAnimationByData=function($V){var $U;return $H._I||($H._I=new $H),$U=$H._I.parseByData($V),$H._I._clear(),$U},$H.parseAnimationData=function($V){var $U;return $H._I||($H._I=new $H),$H._I.setUpAniData($V),($U={}).animationList=$H._I.animationList,$U.animationDic=$H._I.animationDic,$H._I._clear(),$U},$H._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$H._temParam=[],$H._I=null,$H._rootMatrix=null,$N($H,["_tempMt",function(){return this._tempMt=new $z}]),$H.__init$=function(){$Q=function(){function $V(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $u($V,""),$V.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$X.recover("GraphicNode",this)},$V.create=function(){return $X.getItemByClass("GraphicNode",$V)},$V}()},$H}($LV));$y.__init([$t,$NV,$m,$j,$F,$I,$V,$yV])}(window,document,Laya),function($V,$U,$r){$r.un,$r.uns,$r.static;var $s=$r.class;$r.getset,$r.__newvec;new(function(){function $V(){}return $s($V,"LayaMain"),$V}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}}),function($V,$U,$k){$k.un,$k.uns;var $R=$k.static,$_=$k.class,$s=$k.getset,$c=$k.__newvec,$b=laya.maths.Arith,$S=laya.maths.Bezier,$r=laya.resource.Bitmap,$G=laya.utils.Browser,$N=laya.utils.Byte,$q=laya.utils.Color,$y=(laya.filters.ColorFilter,$k.Config),$p=laya.resource.Context,$D=(laya.events.Event,laya.filters.Filter),$T=laya.display.Graphics,$t=laya.resource.HTMLCanvas,$u=(laya.utils.HTMLChar,laya.resource.HTMLImage),$h=laya.resource.HTMLSubImage,$n=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$I=laya.maths.Point,$Q=laya.maths.Rectangle,$l=laya.renders.Render,$W=(laya.renders.RenderContext,laya.renders.RenderSprite),$O=laya.resource.Resource,$L=laya.resource.ResourceManager,$d=laya.utils.RunDriver,$H=laya.display.Sprite,$w=laya.display.Stage,$z=laya.utils.Stat,$E=laya.utils.StringKey,$K=(laya.display.css.Style,laya.system.System),$m=laya.display.Text,$a=laya.resource.Texture,$Z=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$x=laya.utils.VectorGraphManager;laya.utils.WordText;$k.interface("laya.webgl.shapes.IShape"),$k.interface("laya.webgl.submit.ISubmit"),$k.interface("laya.webgl.text.ICharSegment"),$k.interface("laya.webgl.canvas.save.ISaveData"),$k.interface("laya.webgl.resource.IMergeAtlasBitmap"),$k.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $$=function(){function $V(){}$_($V,"laya.filters.webgl.FilterActionGL");var $U=$V.prototype;return $k.imps($U,{"laya.filters.IFilterActionGL":!0}),$U.setValue=function($V){},$U.setValueMix=function($V){},$U.apply3d=function($V,$U,$r,$s,$p){return null},$U.apply=function($V){return null},$s(0,$U,"typeMix",function(){return 0}),$V}(),$j=function(){function $V(){}return $_($V,"laya.webgl.shader.ShaderValue"),$V}(),$o=function(){var $s,$p;function $V($V,$U,$r){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $p,void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),this._cells=null,this._rowInfo=null,this._init($V,$U),this._atlasID=$r}$_($V,"laya.webgl.atlas.AtlasGrid");var $U=$V.prototype;return $U.getAltasID=function(){return this._atlasID},$U.setAltasID=function($V){0<=$V&&(this._atlasID=$V)},$U.addTex=function($V,$U,$r){var $s=this._get($U,$r);return 0==$s.ret||(this._fill($s.x,$s.y,$U,$r,$V),this._texCount++),$s},$U._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$U._init=function($V,$U){if(this._width=$V,this._height=$U,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$c(this._height);for(var $r=0;$r<this._height;$r++)this._rowInfo[$r]=new $s;return this._clear(),!0},$U._get=function($V,$U){var $r=new $i;if($V>=this._failSize.width&&$U>=this._failSize.height)return $r;for(var $s=-1,$p=-1,$c=this._width,$R=this._height,$T=this._cells,$N=0;$N<$R;$N++)if(!(this._rowInfo[$N].spaceCount<$V))for(var $t=0;$t<$c;){var $b=3*($N*$c+$t);if(0!=$T[$b]||$T[1+$b]<$V||$T[2+$b]<$U)$t+=$T[1+$b];else{$s=$t,$p=$N;for(var $S=0;$S<$V;$S++)if($T[3*$S+$b+2]<$U){$s=-1;break}if(!($s<0))return $r.ret=!0,$r.x=$s,$r.y=$p,$r;$t+=$T[1+$b]}}return $r},$U._fill=function($V,$U,$r,$s,$p){var $c=this._width,$R=this._height;this._check($V+$r<=$c&&$U+$s<=$R);for(var $T=$U;$T<$s+$U;++$T){this._check(this._rowInfo[$T].spaceCount>=$r),this._rowInfo[$T].spaceCount-=$r;for(var $N=0;$N<$r;$N++){var $t=3*($V+$T*$c+$N);this._check(0==this._cells[$t]),this._cells[$t]=$p,this._cells[1+$t]=$r,this._cells[2+$t]=$s}}if(0<$V)for($T=0;$T<$s;++$T){var $b=0;for($N=$V-1;0<=$N&&0==this._cells[3*(($U+$T)*$c+$N)];--$N,++$b);for($N=$b;0<$N;--$N)this._cells[3*(($U+$T)*$c+$V-$N)+1]=$N,this._check(0<$N)}if(0<$U)for($N=$V;$N<$V+$r;++$N){for($b=0,$T=$U-1;0<=$T&&0==this._cells[3*($N+$T*$c)];--$T,$b++);for($T=$b;0<$T;--$T)this._cells[3*($N+($U-$T)*$c)+2]=$T,this._check(0<$T)}},$U._check=function($V){0==$V&&console.log("xtexMerger 错误啦")},$U._clear=function(){for(var $V=this._texCount=0;$V<this._height;$V++)this._rowInfo[$V].spaceCount=this._width;for(var $U=0;$U<this._height;$U++)for(var $r=0;$r<this._width;$r++){var $s=3*($U*this._width+$r);this._cells[$s]=0,this._cells[1+$s]=this._width-$r,this._cells[2+$s]=this._width-$U}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$V.__init$=function(){$s=function(){function $V(){this.spaceCount=0}return $_($V,""),$V}(),$p=function(){function $V(){this.width=0,this.height=0}return $_($V,""),$V}()},$V}(),$J=function(){function $l($V,$U,$r,$s){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$V,this._height=$U,this._gridSize=$r,this._maxAtlaserCount=$s,this._gridNumX=$V/$r,this._gridNumY=$U/$r,this._curAtlasIndex=0,this._atlaserArray=[]}$_($l,"laya.webgl.atlas.AtlasResourceManager");var $V=$l.prototype;return $V.setAtlasParam=function($V,$U,$r,$s){if(1==this._setAtlasParam)return $l._sid_=0,this._width=$V,this._height=$U,this._gridSize=$r,this._maxAtlaserCount=$s,this._gridNumX=$V/$r,this._gridNumY=$U/$r,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$V.pushData=function($V){var $U,$r=$V.bitmap,$s=-1,$p=null,$c=0,$R=0;for($c=0,$U=this._atlaserArray.length;$c<$U&&($R=(this._curAtlasIndex+$c)%$U,-1==($s=($p=this._atlaserArray[$R]).findBitmapIsExist($r)));$c++);if(-1!=$s){var $T=$p.InAtlasWebGLImagesOffsetValue[$s];return $q=$T[0],$u=$T[1],$p.addToAtlas($V,$q,$u),!0}this._setAtlasParam=!1;for(var $N=Math.ceil(($V.bitmap.width+2)/this._gridSize),$t=Math.ceil(($V.bitmap.height+2)/this._gridSize),$b=!1,$S=0;$S<2;$S++){var $_=this._maxAtlaserCount;for($c=0;$c<$_;$c++){$R=(this._curAtlasIndex+$c)%$_,this._atlaserArray.length-1>=$R||this._atlaserArray.push(new $QV(this._gridNumX,this._gridNumY,this._width,this._height,$l._sid_++));var $G=this._atlaserArray[$R],$q=0,$u=0,$h=$G.addTex(1,$N,$t);if($h.ret){$q=$h.x*this._gridSize+1,$u=$h.y*this._gridSize+1,$r.lock=!0,$G.addToAtlasTexture($r,$q,$u),$G.addToAtlas($V,$q,$u),$b=!0,this._curAtlasIndex=$R;break}}if($b)break;this._atlaserArray.push(new $QV(this._gridNumX,this._gridNumY,this._width,this._height,$l._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $b||console.log(">>>AtlasManager pushData error"),$b},$V.addToAtlas=function($V){laya.webgl.atlas.AtlasResourceManager.instance.pushData($V)},$V.garbageCollection=function(){if(!0===this._needGC){for(var $V=this._atlaserArray.length-this._maxAtlaserCount,$U=0;$U<$V;$U++)this._atlaserArray[$U].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$V),this._atlaserArray.splice(0,$V),this._needGC=!1}return!0},$V.freeAll=function(){for(var $V=0,$U=this._atlaserArray.length;$V<$U;$V++)this._atlaserArray[$V].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$V.getAtlaserCount=function(){return this._atlaserArray.length},$V.getAtlaserByIndex=function($V){return this._atlaserArray[$V]},$s(1,$l,"instance",function(){return $l._Instance||($l._Instance=new $l(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$l._Instance}),$s(1,$l,"enabled",function(){return $y.atlasEnable}),$s(1,$l,"atlasLimitWidth",function(){return $l._atlasLimitWidth},function($V){$l._atlasLimitWidth=$V}),$s(1,$l,"atlasLimitHeight",function(){return $l._atlasLimitHeight},function($V){$l._atlasLimitHeight=$V}),$l._enable=function(){$y.atlasEnable=!0},$l._disable=function(){$y.atlasEnable=!1},$l.__init__=function(){$l.atlasTextureWidth=2048,$l.atlasTextureHeight=2048,$l.maxTextureCount=6,$l.atlasLimitWidth=512,$l.atlasLimitHeight=512},$l._atlasLimitWidth=0,$l._atlasLimitHeight=0,$l.gridSize=16,$l.atlasTextureWidth=0,$l.atlasTextureHeight=0,$l.maxTextureCount=0,$l._atlasRestore=0,$l.BOARDER_TYPE_NO=0,$l.BOARDER_TYPE_RIGHT=1,$l.BOARDER_TYPE_LEFT=2,$l.BOARDER_TYPE_BOTTOM=4,$l.BOARDER_TYPE_TOP=8,$l.BOARDER_TYPE_ALL=15,$l._sid_=0,$l._Instance=null,$l}(),$i=function(){function $V(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $_($V,"laya.webgl.atlas.MergeFillInfo"),$V}(),$B=function(){function $U(){}return $_($U,"laya.webgl.canvas.BlendMode"),$U._init_=function($V){$U.fns=[$U.BlendNormal,$U.BlendAdd,$U.BlendMultiply,$U.BlendScreen,$U.BlendOverlay,$U.BlendLight,$U.BlendMask,$U.BlendDestinationOut],$U.targetFns=[$U.BlendNormalTarget,$U.BlendAddTarget,$U.BlendMultiplyTarget,$U.BlendScreenTarget,$U.BlendOverlayTarget,$U.BlendLightTarget,$U.BlendMask,$U.BlendDestinationOut]},$U.BlendNormal=function($V){$V.blendFunc(1,771)},$U.BlendAdd=function($V){$V.blendFunc(1,772)},$U.BlendMultiply=function($V){$V.blendFunc(774,771)},$U.BlendScreen=function($V){$V.blendFunc(1,1)},$U.BlendOverlay=function($V){$V.blendFunc(1,769)},$U.BlendLight=function($V){$V.blendFunc(1,1)},$U.BlendNormalTarget=function($V){$V.blendFunc(1,771)},$U.BlendAddTarget=function($V){$V.blendFunc(1,772)},$U.BlendMultiplyTarget=function($V){$V.blendFunc(774,771)},$U.BlendScreenTarget=function($V){$V.blendFunc(1,1)},$U.BlendOverlayTarget=function($V){$V.blendFunc(1,769)},$U.BlendLightTarget=function($V){$V.blendFunc(1,1)},$U.BlendMask=function($V){$V.blendFunc(0,770)},$U.BlendDestinationOut=function($V){$V.blendFunc(0,0)},$U.activeBlendFunction=null,$U.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$U.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$U.NORMAL="normal",$U.ADD="add",$U.MULTIPLY="multiply",$U.SCREEN="screen",$U.LIGHT="light",$U.OVERLAY="overlay",$U.DESTINATIONOUT="destination-out",$U.fns=[],$U.targetFns=[],$U}(),$P=function(){function $r($V){this._color=$q.create("black"),this.setValue($V)}$_($r,"laya.webgl.canvas.DrawStyle");var $V=$r.prototype;return $V.setValue=function($V){if($V){if("string"==typeof $V)return void(this._color=$q.create($V));if($V instanceof laya.utils.Color)return void(this._color=$V)}},$V.reset=function(){this._color=$q.create("black")},$V.equal=function($V){return"string"==typeof $V?this._color.strColor===$V:$V instanceof laya.utils.Color&&this._color.numColor===$V.numColor},$V.toColorStr=function(){return this._color.strColor},$r.create=function($V){var $U;if($V&&("string"==typeof $V?$U=$q.create($V):$V instanceof laya.utils.Color&&($U=$V),$U))return $U._drawStyle||($U._drawStyle=new $r($V));return laya.webgl.canvas.DrawStyle.DEFAULT},$R($r,["DEFAULT",function(){return this.DEFAULT=new $r("#000000")}]),$r}(),$M=function(){function $V(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$LV.mainContext;this.ib=$CV.create(35048),this.vb=$fV.create(5)}$_($V,"laya.webgl.canvas.Path");var $U=$V.prototype;return $U.addPoint=function($V,$U){this.tempArray.push($V,$U)},$U.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$U.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$U.polygon=function($V,$U,$r,$s,$p,$c){var $R;return this.geomatrys.push(this._curGeomatry=$R=new $EV($V,$U,$r,$s,$p,$c)),$s||($R.fill=!1),null==$c&&($R.borderWidth=0),$R},$U.setGeomtry=function($V){this.geomatrys.push(this._curGeomatry=$V)},$U.drawLine=function($V,$U,$r,$s,$p){var $c;return this.closePath?this.geomatrys.push(this._curGeomatry=$c=new $zV($V,$U,$r,$s,$p)):this.geomatrys.push(this._curGeomatry=$c=new $wV($V,$U,$r,$s,$p)),$c.fill=!1,$c},$U.update=function(){var $V=this.ib._byteLength,$U=this.geomatrys.length;this.offset=$V;for(var $r=this.geoStart;$r<$U;$r++)this.geomatrys[$r].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$U,this.count=(this.ib._byteLength-$V)/$uV.BYTES_PIDX},$U.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$U.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$V}(),$A=function(){function $T(){}$_($T,"laya.webgl.canvas.save.SaveBase");var $V=$T.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!1},$V.restore=function($V){this._dataObj[this._valueName]=this._value,($T._cache[$T._cache._length++]=this)._newSubmit&&($V._curSubmit=$cV.RENDERBASE,$V._renderKey=0)},$T._createArray=function(){var $V=[];return $V._length=0,$V},$T._init=function(){var $V=$T._namemap={};return $V[1]="ALPHA",$V[2]="fillStyle",$V[8]="font",$V[256]="lineWidth",$V[512]="strokeStyle",$V[8192]="_mergeID",$V[1024]=$V[2048]=$V[4096]=[],$V[16384]="textBaseline",$V[32768]="textAlign",$V[65536]="_nBlendType",$V[1048576]="shader",$V[2097152]="filters",$V},$T.save=function($V,$U,$r,$s){if(($V._saveMark._saveuse&$U)!==$U){$V._saveMark._saveuse|=$U;var $p=$T._cache,$c=0<$p._length?$p[--$p._length]:new $T;$c._value=$r[$c._valueName=$T._namemap[$U]],$c._dataObj=$r,$c._newSubmit=$s;var $R=$V._save;$R[$R._length++]=$c}},$T._cache=laya.webgl.canvas.save.SaveBase._createArray(),$T._namemap=$T._init(),$T}(),$X=function(){function $c(){this._clipRect=new $Q}$_($c,"laya.webgl.canvas.save.SaveClipRect");var $V=$c.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!1},$V.restore=function($V){$V._clipRect=this._clipSaveRect,($c._cache[$c._cache._length++]=this)._submitScissor.submitLength=$V._submits._length-this._submitScissor.submitIndex,$V._curSubmit=$cV.RENDERBASE,$V._renderKey=0},$c.save=function($V,$U){if(131072!=(131072&$V._saveMark._saveuse)){$V._saveMark._saveuse|=131072;var $r=$c._cache,$s=0<$r._length?$r[--$r._length]:new $c;$s._clipSaveRect=$V._clipRect,$V._clipRect=$s._clipRect.copyFrom($V._clipRect),$s._submitScissor=$U;var $p=$V._save;$p[$p._length++]=$s}},$R($c,["_cache",function(){return this._cache=$A._createArray()}]),$c}(),$e=function(){function $G(){this._contextX=0,this._contextY=0,this._clipRect=new $Q,this._rect=new $Q,this._matrix=new $n}$_($G,"laya.webgl.canvas.save.SaveClipRectStencil");var $V=$G.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!1},$V.restore=function($V){$bV.restore($V,this._rect,this._saveMatrix,this._contextX,this._contextY),$V._clipRect=this._clipSaveRect,$V._curMat=this._saveMatrix,$V._x=this._contextX,$V._y=this._contextY,$G._cache[$G._cache._length++]=this,$V._curSubmit=$cV.RENDERBASE},$G.save=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){if(262144!=(262144&$V._saveMark._saveuse)){$V._saveMark._saveuse|=262144;var $b=$G._cache,$S=0<$b._length?$b[--$b._length]:new $G;$S._clipSaveRect=$V._clipRect,$S._clipRect.setTo($R,$T,$N,$t),$V._clipRect=$S._clipRect,$S._rect.x=$r,$S._rect.y=$s,$S._rect.width=$p,$S._rect.height=$c,$S._contextX=$V._x,$S._contextY=$V._y,$S._saveMatrix=$V._curMat,$V._curMat.copyTo($S._matrix),$V._curMat=$S._matrix,$S._submitStencil=$U;var $_=$V._save;$_[$_._length++]=$S}},$R($G,["_cache",function(){return this._cache=$A._createArray()}]),$G}(),$F=function(){function $s(){this._saveuse=0}$_($s,"laya.webgl.canvas.save.SaveMark");var $V=$s.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!0},$V.restore=function($V){$V._saveMark=this._preSaveMark,$s._no[$s._no._length++]=this},$s.Create=function($V){var $U=$s._no,$r=0<$U._length?$U[--$U._length]:new $s;return $r._saveuse=0,$r._preSaveMark=$V._saveMark,$V._saveMark=$r},$R($s,["_no",function(){return this._no=$A._createArray()}]),$s}(),$g=function(){function $c(){this._matrix=new $n}$_($c,"laya.webgl.canvas.save.SaveTransform");var $V=$c.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!1},$V.restore=function($V){$V._curMat=this._savematrix,$c._no[$c._no._length++]=this},$c.save=function($V){var $U=$V._saveMark;if(2048!=(2048&$U._saveuse)){$U._saveuse|=2048;var $r=$c._no,$s=0<$r._length?$r[--$r._length]:new $c;$s._savematrix=$V._curMat,$V._curMat=$V._curMat.copyTo($s._matrix);var $p=$V._save;$p[$p._length++]=$s}},$R($c,["_no",function(){return this._no=$A._createArray()}]),$c}(),$v=function(){function $p(){}$_($p,"laya.webgl.canvas.save.SaveTranslate");var $V=$p.prototype;return $k.imps($V,{"laya.webgl.canvas.save.ISaveData":!0}),$V.isSaveMark=function(){return!1},$V.restore=function($V){$V._curMat;$V._x=this._x,$V._y=this._y,$p._no[$p._no._length++]=this},$p.save=function($V){var $U=$p._no,$r=0<$U._length?$U[--$U._length]:new $p;$r._x=$V._x,$r._y=$V._y;var $s=$V._save;$s[$s._length++]=$r},$R($p,["_no",function(){return this._no=$A._createArray()}]),$p}(),$Y=function(){function $V(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $Q}$_($V,"laya.webgl.resource.RenderTargetMAX");var $U=$V.prototype;return $U.setSP=function($V){this._sp=$V},$U.size=function($V,$U){var $r=this;this._width!==$V||this._height!==$U?(this.repaint=!0,this._width=$V,this._height=$U,this.target?this.target.size($V,$U):this.target=$xV.create($V,$U),this.target.hasListener("recovered")||this.target.on("recovered",this,function($V){$k.timer.callLater($r._sp,$r._sp.repaint)})):this.target.size($V,$U)},$U._flushToTarget=function($V,$U){if(!$U._destroy){var $r=$WV.worldScissorTest,$s=$WV.worldClipRect;$WV.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$WV.worldScissorTest=!1,$LV.mainContext.disable(3089);var $p=$WV.worldAlpha,$c=$WV.worldMatrix4,$R=$WV.worldMatrix,$T=$WV.worldFilters,$N=$WV.worldShaderDefines;if($WV.worldMatrix=$n.EMPTY,$WV.restoreTempArray(),$WV.worldMatrix4=$WV.TEMPMAT4_ARRAY,$WV.worldAlpha=1,$WV.worldFilters=null,$WV.worldShaderDefines=null,$ZV.activeShader=null,$U.start(),$y.showCanvasMark?$U.clear(0,1,0,.3):$U.clear(0,0,0,0),$V.flush(),$U.end(),$ZV.activeShader=null,$WV.worldAlpha=$p,$WV.worldMatrix4=$c,$WV.worldMatrix=$R,$WV.worldFilters=$T,$WV.worldShaderDefines=$N,$WV.worldScissorTest=$r){var $t=$WV.height-$s.y-$s.height;$LV.mainContext.scissor($s.x,$t,$s.width,$s.height),$LV.mainContext.enable(3089)}$WV.worldClipRect=$s}},$U.flush=function($V){this.repaint&&(this._flushToTarget($V,this.target),this.repaint=!1)},$U.drawTo=function($V,$U,$r,$s,$p){$V.drawTexture(this.target.getTexture(),$U,$r,$s,$p,0,0)},$U.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$V}(),$C=function(){function $V(){this.ALPHA=1,this.shaderType=0,this.defines=new $HV}return $_($V,"laya.webgl.shader.d2.Shader2D"),$V.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$V.__init__=function(){var $V,$U;$FV.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$FV.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$FV.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$FV.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$FV.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$FV.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$FV.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$FV.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$V="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$U='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$FV.preCompile2D(0,1,$V,$U,null),$V="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$U='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$FV.preCompile2D(0,2,$V,$U,null),$V="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$U="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$FV.preCompile2D(0,4,$V,$U,null),$V="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$U='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$FV.preCompile2D(0,256,$V,$U,null),$V="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$U="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$FV.preCompile2D(0,512,$V,$U,null)},$V}(),$f=function(){function $U($V,$U,$r){this._value=0,this._name2int=$V,this._int2name=$U,this._int2nameMap=$r}$_($U,"laya.webgl.shader.ShaderDefines");var $V=$U.prototype;return $V.add=function($V){return"string"==typeof $V&&($V=this._name2int[$V]),this._value|=$V,this._value},$V.addInt=function($V){return this._value|=$V,this._value},$V.remove=function($V){return"string"==typeof $V&&($V=this._name2int[$V]),this._value&=~$V,this._value},$V.isDefine=function($V){return(this._value&$V)===$V},$V.getValue=function(){return this._value},$V.setValue=function($V){this._value=$V},$V.toNameDic=function(){var $V=this._int2nameMap[this._value];return $V||$U._toText(this._value,this._int2name,this._int2nameMap)},$U._reg=function($V,$U,$r,$s){$s[$r[$V]=$U]=$V},$U._toText=function($V,$U,$r){var $s=$r[$V];if($s)return $s;for(var $p={},$c=1,$R=0;$R<32&&!($V<($c=1<<$R));$R++)if($V&$c){var $T=$U[$c];$T&&($p[$T]="")}return $r[$V]=$p},$U._toInt=function($V,$U){for(var $r=$V.split("."),$s=0,$p=0,$c=$r.length;$p<$c;$p++){var $R=$U[$r[$p]];if(!$R)throw new Error("Defines to int err:"+$V+"/"+$r[$p]);$s|=$R}return $s},$U}(),$VV=function(){function $R(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $n}$_($R,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $V=$R.prototype;return $V.init=function($V,$U,$r){if($U)this._vs=$U;else{this._vs=[];var $s=$V.width,$p=$V.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($s,0,1,0,1,1,1,1),this._vs.push($s,$p,1,1,1,1,1,1),this._vs.push(0,$p,0,1,1,1,1,1)}$r?this._ps=$r:($R._defaultPS||($R._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$R._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$V},$V.init2=function($V,$U,$r,$s,$p){this.transform&&(this.transform=null),$r?this._ps=$r:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$s,this._uvs=$p,this.mEleNum=this._ps.length,this.mTexture=$V,($l.isConchNode||$l.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$V._initMyData=function(){var $V=0,$U=0,$r=4*this._verticles.length;this._vs=$R._tempVS;var $s=!1;if($l.isConchNode||$l.isConchApp?(this._vs.length=$r,$s=!0):this._vs.length<$r&&(this._vs.length=$r,$s=!0),$R._tVSLen=$r,$s)for(;$V<$r;)this._vs[$V]=this._verticles[$U],this._vs[$V+1]=this._verticles[$U+1],this._vs[$V+2]=this._uvs[$U],this._vs[$V+3]=this._uvs[$U+1],this._vs[$V+4]=1,this._vs[$V+5]=1,this._vs[$V+6]=1,this._vs[$V+7]=1,$V+=8,$U+=2;else for(;$V<$r;)this._vs[$V]=this._verticles[$U],this._vs[$V+1]=this._verticles[$U+1],this._vs[$V+2]=this._uvs[$U],this._vs[$V+3]=this._uvs[$U+1],$V+=8,$U+=2},$V.getData2=function($V,$U,$r){var $s;this.mVBBuffer=$V,this.mIBBuffer=$U,this._initMyData(),$V.appendEx2(this._vs,Float32Array,$R._tVSLen,4),this._indexStart=$U._byteLength,($s=$R._tempIB).length<this._ps.length&&($s.length=this._ps.length);for(var $p=0,$c=this._ps.length;$p<$c;$p++)$s[$p]=this._ps[$p]+$r;$U.appendEx2($s,Uint16Array,this._ps.length,2)},$V.getData=function($V,$U,$r){if(this.mVBBuffer=$V,this.mIBBuffer=$U,$V.append(this.mVBData),this._indexStart=$U._byteLength,this.mIBData.start!=$r){for(var $s=0,$p=this._ps.length;$s<$p;$s++)this.mIBData[$s]=this._ps[$s]+$r;this.mIBData.start=$r}$U.append(this.mIBData)},$V.render=function($V,$U,$r){if($l.isWebGL&&this.mTexture){$V._renderKey=0,$V._shader2D.glTexture=null,$UV.getInstance().addSkinMesh(this);var $s=$cV.createShape($V,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$DV.create(512,0));this.transform||(this.transform=$n.EMPTY),this.transform.translate($U,$r),$n.mul(this.transform,$V._curMat,this._tempMatrix),this.transform.translate(-$U,-$r);var $p=$s.shaderValue,$c=$p.u_mmat2||$WV.getMatrArray();$WV.mat2MatArray(this._tempMatrix,$c),$p.textureHost=this.mTexture,$p.offsetX=0,$p.offsetY=0,$p.u_mmat2=$c,$p.ALPHA=$V._shader2D.ALPHA,$V._submits[$V._submits._length++]=$s}else $l.isConchApp&&this.mTexture&&(this.transform||(this.transform=$n.EMPTY),$V.setSkinMesh&&$V.setSkinMesh($U,$r,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$R._tempVS=[],$R._tempIB=[],$R._defaultPS=null,$R._tVSLen=0,$R}(),$UV=function(){function $V(){this.ib=null,this.vb=null;$LV.mainContext;this.ib=$CV.create(35048),this.vb=$fV.create(8)}$_($V,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $U=$V.prototype;return $U.addSkinMesh=function($V){$V.getData2(this.vb,this.ib,this.vb._byteLength/32)},$U.reset=function(){this.vb.clear(),this.ib.clear()},$V.getInstance=function(){return $V.instance=$V.instance||new $V},$V.instance=null,$V}(),$rV=function(){function $V($V,$U,$r,$s,$p,$c,$R,$T,$N){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$N&&($N=0),this.x=$V,this.y=$U,this.width=$r,this.height=$s,this.edges=$p,this.color=$c,this.borderWidth=$R,this.borderColor=$T}$_($V,"laya.webgl.shapes.BasePoly");var $U=$V.prototype;return $k.imps($U,{"laya.webgl.shapes.IShape":!0}),$U.getData=function($V,$U,$r){},$U.rebuild=function($V){},$U.setMatrix=function($V){},$U.needUpdate=function($V){return!0},$U.sector=function($V,$U,$r){var $s=this.x,$p=this.y,$c=this.edges,$R=(this.r1-this.r0)/$c,$T=this.width,$N=this.height,$t=this.color,$b=($t>>16&255)/255,$S=($t>>8&255)/255,$_=(255&$t)/255;$V.push($s,$p,$b,$S,$_);for(var $G=0;$G<$c+1;$G++)$V.push($s+Math.sin($R*$G+this.r0)*$T,$p+Math.cos($R*$G+this.r0)*$N),$V.push($b,$S,$_);for($G=0;$G<$c;$G++)$U.push($r,$r+$G+1,$r+$G+2)},$U.createLine2=function($V,$U,$r,$s,$p,$c){var $R,$T,$N,$t,$b,$S,$_,$G,$q,$u,$h,$l,$W,$O,$L,$d,$k,$y,$D,$n,$I=$V.concat(),$Q=$p,$H=this.borderColor,$w=($H>>16&255)/255,$z=($H>>8&255)/255,$E=(255&$H)/255,$K=$I.length/2,$m=$s,$a=$r/2;$N=$I[0],$t=$I[1],$u=$N-($b=$I[2]),$q=($q=-($t-($S=$I[3])))/($n=Math.sqrt($q*$q+$u*$u))*$a,$u=$u/$n*$a,$Q.push($N-$q+this.x,$t-$u+this.y,$w,$z,$E,$N+$q+this.x,$t+$u+this.y,$w,$z,$E);for(var $Z=1;$Z<$K-1;$Z++)$N=$I[2*($Z-1)],$t=$I[2*($Z-1)+1],$b=$I[2*$Z],$S=$I[2*$Z+1],$_=$I[2*($Z+1)],$G=$I[2*($Z+1)+1],$u=$N-$b,$l=$b-$_,$L=(-($q=($q=-($t-$S))/($n=Math.sqrt($q*$q+$u*$u))*$a)+$N)*(-($u=$u/$n*$a)+$S)-(-$q+$b)*(-$u+$t),$y=(-($h=($h=-($S-$G))/($n=Math.sqrt($h*$h+$l*$l))*$a)+$_)*(-($l=$l/$n*$a)+$S)-(-$h+$b)*(-$l+$G),$D=($W=-$u+$t-(-$u+$S))*($k=-$h+$b-(-$h+$_))-($d=-$l+$G-(-$l+$S))*($O=-$q+$b-(-$q+$N)),Math.abs($D)<.1?($D+=10.1,$Q.push($b-$q+this.x,$S-$u+this.y,$w,$z,$E,$b+$q+this.x,$S+$u+this.y,$w,$z,$E)):((($R=($O*$y-$k*$L)/$D)-$b)*($R-$b)+(($T=($d*$L-$W*$y)/$D)-$S)+($T-$S),$Q.push($R+this.x,$T+this.y,$w,$z,$E,$b-($R-$b)+this.x,$S-($T-$S)+this.y,$w,$z,$E));$N=$I[$I.length-4],$t=$I[$I.length-3],$u=$N-($b=$I[$I.length-2]),$q=($q=-($t-($S=$I[$I.length-1])))/($n=Math.sqrt($q*$q+$u*$u))*$a,$u=$u/$n*$a,$Q.push($b-$q+this.x,$S-$u+this.y,$w,$z,$E,$b+$q+this.x,$S+$u+this.y,$w,$z,$E);var $x=$c;for($Z=1;$Z<$x;$Z++)$U.push($m+2*($Z-1),$m+2*($Z-1)+1,$m+2*$Z+1,$m+2*$Z+1,$m+2*$Z,$m+2*($Z-1));return $Q},$U.createLine=function($V,$U,$r,$s){var $p=$V.concat(),$c=$V,$R=this.borderColor,$T=($R>>16&255)/255,$N=($R>>8&255)/255,$t=(255&$R)/255;$p.splice(0,5);var $b,$S,$_,$G,$q,$u,$h,$l,$W,$O,$L,$d,$k,$y,$D,$n,$I,$Q,$H,$w,$z=$p.length/5,$E=$s,$K=$r/2;$_=$p[0],$G=$p[1],$O=$_-($q=$p[5]),$W=($W=-($G-($u=$p[6])))/($w=Math.sqrt($W*$W+$O*$O))*$K,$O=$O/$w*$K,$c.push($_-$W,$G-$O,$T,$N,$t,$_+$W,$G+$O,$T,$N,$t);for(var $m=1;$m<$z-1;$m++)$_=$p[5*($m-1)],$G=$p[5*($m-1)+1],$q=$p[5*$m],$u=$p[5*$m+1],$h=$p[5*($m+1)],$l=$p[5*($m+1)+1],$O=$_-$q,$d=$q-$h,$D=(-($W=($W=-($G-$u))/($w=Math.sqrt($W*$W+$O*$O))*$K)+$_)*(-($O=$O/$w*$K)+$u)-(-$W+$q)*(-$O+$G),$Q=(-($L=($L=-($u-$l))/($w=Math.sqrt($L*$L+$d*$d))*$K)+$h)*(-($d=$d/$w*$K)+$u)-(-$L+$q)*(-$d+$l),$H=($k=-$O+$G-(-$O+$u))*($I=-$L+$q-(-$L+$h))-($n=-$d+$l-(-$d+$u))*($y=-$W+$q-(-$W+$_)),Math.abs($H)<.1?($H+=10.1,$c.push($q-$W,$u-$O,$T,$N,$t,$q+$W,$u+$O,$T,$N,$t)):((($b=($y*$Q-$I*$D)/$H)-$q)*($b-$q)+(($S=($n*$D-$k*$Q)/$H)-$u)+($S-$u),$c.push($b,$S,$T,$N,$t,$q-($b-$q),$u-($S-$u),$T,$N,$t));$_=$p[$p.length-10],$G=$p[$p.length-9],$O=$_-($q=$p[$p.length-5]),$W=($W=-($G-($u=$p[$p.length-4])))/($w=Math.sqrt($W*$W+$O*$O))*$K,$O=$O/$w*$K,$c.push($q-$W,$u-$O,$T,$N,$t,$q+$W,$u+$O,$T,$N,$t);var $a=this.edges+1;for($m=1;$m<$a;$m++)$U.push($E+2*($m-1),$E+2*($m-1)+1,$E+2*$m+1,$E+2*$m+1,$E+2*$m,$E+2*($m-1));return $c},$U.createLoopLine=function($V,$U,$r,$s,$p,$c){var $R=$V.concat(),$T=$p||$V,$N=this.borderColor,$t=($N>>16&255)/255,$b=($N>>8&255)/255,$S=(255&$N)/255;$R.splice(0,5);var $_=[$R[0],$R[1]],$G=[$R[$R.length-5],$R[$R.length-4]],$q=$G[0]+.5*($_[0]-$G[0]),$u=$G[1]+.5*($_[1]-$G[1]);$R.unshift($q,$u,0,0,0),$R.push($q,$u,0,0,0);var $h,$l,$W,$O,$L,$d,$k,$y,$D,$n,$I,$Q,$H,$w,$z,$E,$K,$m,$a,$Z,$x=$R.length/5,$$=$s,$j=$r/2;$W=$R[0],$O=$R[1],$n=$W-($L=$R[5]),$D=($D=-($O-($d=$R[6])))/($Z=Math.sqrt($D*$D+$n*$n))*$j,$n=$n/$Z*$j,$T.push($W-$D,$O-$n,$t,$b,$S,$W+$D,$O+$n,$t,$b,$S);for(var $o=1;$o<$x-1;$o++)$W=$R[5*($o-1)],$O=$R[5*($o-1)+1],$L=$R[5*$o],$d=$R[5*$o+1],$k=$R[5*($o+1)],$y=$R[5*($o+1)+1],$n=$W-$L,$Q=$L-$k,$z=(-($D=($D=-($O-$d))/($Z=Math.sqrt($D*$D+$n*$n))*$j)+$W)*(-($n=$n/$Z*$j)+$d)-(-$D+$L)*(-$n+$O),$m=(-($I=($I=-($d-$y))/($Z=Math.sqrt($I*$I+$Q*$Q))*$j)+$k)*(-($Q=$Q/$Z*$j)+$d)-(-$I+$L)*(-$Q+$y),$a=($H=-$n+$O-(-$n+$d))*($K=-$I+$L-(-$I+$k))-($E=-$Q+$y-(-$Q+$d))*($w=-$D+$L-(-$D+$W)),Math.abs($a)<.1?($a+=10.1,$T.push($L-$D,$d-$n,$t,$b,$S,$L+$D,$d+$n,$t,$b,$S)):((($h=($w*$m-$K*$z)/$a)-$L)*($h-$L)+(($l=($E*$z-$H*$m)/$a)-$d)+($l-$d),$T.push($h,$l,$t,$b,$S,$L-($h-$L),$d-($l-$d),$t,$b,$S));$c&&($U=$c);var $J=this.edges+1;for($o=1;$o<$J;$o++)$U.push($$+2*($o-1),$$+2*($o-1)+1,$$+2*$o+1,$$+2*$o+1,$$+2*$o,$$+2*($o-1));return $U.push($$+2*($o-1),$$+2*($o-1)+1,$$+1,$$+1,$$,$$+2*($o-1)),$T},$V}(),$sV=function(){function $u(){}return $_($u,"laya.webgl.shapes.Earcut"),$u.earcut=function($V,$U,$r){$r=$r||2;var $s,$p,$c,$R,$T,$N,$t,$b=$U&&$U.length,$S=$b?$U[0]*$r:$V.length,$_=$u.linkedList($V,0,$S,$r,!0),$G=[];if(!$_)return $G;if($b&&($_=$u.eliminateHoles($V,$U,$_,$r)),$V.length>80*$r){$s=$c=$V[0],$p=$R=$V[1];for(var $q=$r;$q<$S;$q+=$r)($T=$V[$q])<$s&&($s=$T),($N=$V[$q+1])<$p&&($p=$N),$c<$T&&($c=$T),$R<$N&&($R=$N);$t=0!==($t=Math.max($c-$s,$R-$p))?1/$t:0}return $u.earcutLinked($_,$G,$r,$s,$p,$t),$G},$u.linkedList=function($V,$U,$r,$s,$p){var $c,$R;if($p===0<$u.signedArea($V,$U,$r,$s))for($c=$U;$c<$r;$c+=$s)$R=$u.insertNode($c,$V[$c],$V[$c+1],$R);else for($c=$r-$s;$U<=$c;$c-=$s)$R=$u.insertNode($c,$V[$c],$V[$c+1],$R);return $R&&$u.equals($R,$R.next)&&($u.removeNode($R),$R=$R.next),$R},$u.filterPoints=function($V,$U){if(!$V)return $V;$U||($U=$V);var $r,$s=$V;do{if($r=!1,$s.steiner||!$u.equals($s,$s.next)&&0!==$u.area($s.prev,$s,$s.next))$s=$s.next;else{if($u.removeNode($s),($s=$U=$s.prev)===$s.next)break;$r=!0}}while($r||$s!==$U);return $U},$u.earcutLinked=function($V,$U,$r,$s,$p,$c,$R){if($V){!$R&&$c&&$u.indexCurve($V,$s,$p,$c);for(var $T,$N,$t=$V;$V.prev!==$V.next;)if($T=$V.prev,$N=$V.next,$c?$u.isEarHashed($V,$s,$p,$c):$u.isEar($V))$U.push($T.i/$r),$U.push($V.i/$r),$U.push($N.i/$r),$u.removeNode($V),$V=$N.next,$t=$N.next;else if(($V=$N)===$t){$R?1===$R?($V=$u.cureLocalIntersections($V,$U,$r),$u.earcutLinked($V,$U,$r,$s,$p,$c,2)):2===$R&&$u.splitEarcut($V,$U,$r,$s,$p,$c):$u.earcutLinked($u.filterPoints($V,null),$U,$r,$s,$p,$c,1);break}}},$u.isEar=function($V){var $U=$V.prev,$r=$V,$s=$V.next;if(0<=$u.area($U,$r,$s))return!1;for(var $p=$V.next.next;$p!==$V.prev;){if($u.pointInTriangle($U.x,$U.y,$r.x,$r.y,$s.x,$s.y,$p.x,$p.y)&&0<=$u.area($p.prev,$p,$p.next))return!1;$p=$p.next}return!0},$u.isEarHashed=function($V,$U,$r,$s){var $p=$V.prev,$c=$V,$R=$V.next;if(0<=$u.area($p,$c,$R))return!1;for(var $T=$p.x<$c.x?$p.x<$R.x?$p.x:$R.x:$c.x<$R.x?$c.x:$R.x,$N=$p.y<$c.y?$p.y<$R.y?$p.y:$R.y:$c.y<$R.y?$c.y:$R.y,$t=$p.x>$c.x?$p.x>$R.x?$p.x:$R.x:$c.x>$R.x?$c.x:$R.x,$b=$p.y>$c.y?$p.y>$R.y?$p.y:$R.y:$c.y>$R.y?$c.y:$R.y,$S=$u.zOrder($T,$N,$U,$r,$s),$_=$u.zOrder($t,$b,$U,$r,$s),$G=$V.nextZ;$G&&$G.z<=$_;){if($G!==$V.prev&&$G!==$V.next&&$u.pointInTriangle($p.x,$p.y,$c.x,$c.y,$R.x,$R.y,$G.x,$G.y)&&0<=$u.area($G.prev,$G,$G.next))return!1;$G=$G.nextZ}for($G=$V.prevZ;$G&&$G.z>=$S;){if($G!==$V.prev&&$G!==$V.next&&$u.pointInTriangle($p.x,$p.y,$c.x,$c.y,$R.x,$R.y,$G.x,$G.y)&&0<=$u.area($G.prev,$G,$G.next))return!1;$G=$G.prevZ}return!0},$u.cureLocalIntersections=function($V,$U,$r){var $s=$V;do{var $p=$s.prev,$c=$s.next.next;!$u.equals($p,$c)&&$u.intersects($p,$s,$s.next,$c)&&$u.locallyInside($p,$c)&&$u.locallyInside($c,$p)&&($U.push($p.i/$r),$U.push($s.i/$r),$U.push($c.i/$r),$u.removeNode($s),$u.removeNode($s.next),$s=$V=$c),$s=$s.next}while($s!==$V);return $s},$u.splitEarcut=function($V,$U,$r,$s,$p,$c){var $R=$V;do{for(var $T=$R.next.next;$T!==$R.prev;){if($R.i!==$T.i&&$u.isValidDiagonal($R,$T)){var $N=$u.splitPolygon($R,$T);return $R=$u.filterPoints($R,$R.next),$N=$u.filterPoints($N,$N.next),$u.earcutLinked($R,$U,$r,$s,$p,$c),void $u.earcutLinked($N,$U,$r,$s,$p,$c)}$T=$T.next}$R=$R.next}while($R!==$V)},$u.eliminateHoles=function($V,$U,$r,$s){var $p,$c,$R,$T,$N,$t=[];for($p=0,$c=$U.length;$p<$c;$p++)$R=$U[$p]*$s,$T=$p<$c-1?$U[$p+1]*$s:$V.length,($N=$u.linkedList($V,$R,$T,$s,!1))===$N.next&&($N.steiner=!0),$t.push($u.getLeftmost($N));for($t.sort($u.compareX),$p=0;$p<$t.length;$p++)$u.eliminateHole($t[$p],$r),$r=$u.filterPoints($r,$r.next);return $r},$u.compareX=function($V,$U){return $V.x-$U.x},$u.eliminateHole=function($V,$U){if($U=$u.findHoleBridge($V,$U)){var $r=$u.splitPolygon($U,$V);$u.filterPoints($r,$r.next)}},$u.findHoleBridge=function($V,$U){var $r,$s=$U,$p=$V.x,$c=$V.y,$R=-1/0;do{if($c<=$s.y&&$c>=$s.next.y&&$s.next.y!==$s.y){var $T=$s.x+($c-$s.y)*($s.next.x-$s.x)/($s.next.y-$s.y);if($T<=$p&&$R<$T){if(($R=$T)===$p){if($c===$s.y)return $s;if($c===$s.next.y)return $s.next}$r=$s.x<$s.next.x?$s:$s.next}}$s=$s.next}while($s!==$U);if(!$r)return null;if($p===$R)return $r.prev;var $N,$t=$r,$b=$r.x,$S=$r.y,$_=1/0;for($s=$r.next;$s!==$t;)$p>=$s.x&&$s.x>=$b&&$p!==$s.x&&$u.pointInTriangle($c<$S?$p:$R,$c,$b,$S,$c<$S?$R:$p,$c,$s.x,$s.y)&&(($N=Math.abs($c-$s.y)/($p-$s.x))<$_||$N===$_&&$s.x>$r.x)&&$u.locallyInside($s,$V)&&($r=$s,$_=$N),$s=$s.next;return $r},$u.indexCurve=function($V,$U,$r,$s){for(var $p=$V;null===$p.z&&($p.z=$u.zOrder($p.x,$p.y,$U,$r,$s)),$p.prevZ=$p.prev,$p.nextZ=$p.next,($p=$p.next)!==$V;);$p.prevZ.nextZ=null,$p.prevZ=null,$u.sortLinked($p)},$u.sortLinked=function($V){var $U,$r,$s,$p,$c,$R,$T,$N,$t=1;do{for($r=$V,$c=$V=null,$R=0;$r;){for($R++,$s=$r,$U=$T=0;$U<$t&&($T++,$s=$s.nextZ);$U++);for($N=$t;0<$T||0<$N&&$s;)0!==$T&&(0===$N||!$s||$r.z<=$s.z)?($r=($p=$r).nextZ,$T--):($s=($p=$s).nextZ,$N--),$c?$c.nextZ=$p:$V=$p,$p.prevZ=$c,$c=$p;$r=$s}$c.nextZ=null,$t*=2}while(1<$R);return $V},$u.zOrder=function($V,$U,$r,$s,$p){return($V=1431655765&(($V=858993459&(($V=252645135&(($V=16711935&(($V=32767*($V-$r)*$p)|$V<<8))|$V<<4))|$V<<2))|$V<<1))|($U=1431655765&(($U=858993459&(($U=252645135&(($U=16711935&(($U=32767*($U-$s)*$p)|$U<<8))|$U<<4))|$U<<2))|$U<<1))<<1},$u.getLeftmost=function($V){for(var $U=$V,$r=$V;$U.x<$r.x&&($r=$U),($U=$U.next)!==$V;);return $r},$u.pointInTriangle=function($V,$U,$r,$s,$p,$c,$R,$T){return 0<=($p-$R)*($U-$T)-($V-$R)*($c-$T)&&0<=($V-$R)*($s-$T)-($r-$R)*($U-$T)&&0<=($r-$R)*($c-$T)-($p-$R)*($s-$T)},$u.isValidDiagonal=function($V,$U){return $V.next.i!==$U.i&&$V.prev.i!==$U.i&&!$u.intersectsPolygon($V,$U)&&$u.locallyInside($V,$U)&&$u.locallyInside($U,$V)&&$u.middleInside($V,$U)},$u.area=function($V,$U,$r){return($U.y-$V.y)*($r.x-$U.x)-($U.x-$V.x)*($r.y-$U.y)},$u.equals=function($V,$U){return $V.x===$U.x&&$V.y===$U.y},$u.intersects=function($V,$U,$r,$s){return!!($u.equals($V,$U)&&$u.equals($r,$s)||$u.equals($V,$s)&&$u.equals($r,$U))||0<$u.area($V,$U,$r)!=0<$u.area($V,$U,$s)&&0<$u.area($r,$s,$V)!=0<$u.area($r,$s,$U)},$u.intersectsPolygon=function($V,$U){var $r=$V;do{if($r.i!==$V.i&&$r.next.i!==$V.i&&$r.i!==$U.i&&$r.next.i!==$U.i&&$u.intersects($r,$r.next,$V,$U))return!0;$r=$r.next}while($r!==$V);return!1},$u.locallyInside=function($V,$U){return $u.area($V.prev,$V,$V.next)<0?0<=$u.area($V,$U,$V.next)&&0<=$u.area($V,$V.prev,$U):$u.area($V,$U,$V.prev)<0||$u.area($V,$V.next,$U)<0},$u.middleInside=function($V,$U){for(var $r=$V,$s=!1,$p=($V.x+$U.x)/2,$c=($V.y+$U.y)/2;$r.y>$c!=$r.next.y>$c&&$r.next.y!==$r.y&&$p<($r.next.x-$r.x)*($c-$r.y)/($r.next.y-$r.y)+$r.x&&($s=!$s),($r=$r.next)!==$V;);return $s},$u.splitPolygon=function($V,$U){var $r=new $pV($V.i,$V.x,$V.y),$s=new $pV($U.i,$U.x,$U.y),$p=$V.next,$c=$U.prev;return($V.next=$U).prev=$V,($r.next=$p).prev=$r,($s.next=$r).prev=$s,($c.next=$s).prev=$c,$s},$u.insertNode=function($V,$U,$r,$s){var $p=new $pV($V,$U,$r);return $s?($p.next=$s.next,($p.prev=$s).next.prev=$p,$s.next=$p):($p.prev=$p).next=$p,$p},$u.removeNode=function($V){$V.next.prev=$V.prev,$V.prev.next=$V.next,$V.prevZ&&($V.prevZ.nextZ=$V.nextZ),$V.nextZ&&($V.nextZ.prevZ=$V.prevZ)},$u.signedArea=function($V,$U,$r,$s){for(var $p=0,$c=$U,$R=$r-$s;$c<$r;$c+=$s)$p+=($V[$R]-$V[$c])*($V[$c+1]+$V[$R+1]),$R=$c;return $p},$u}(),$pV=function(){function $V($V,$U,$r){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$V,this.x=$U,this.y=$r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $_($V,"laya.webgl.shapes.EarcutNode"),$V}(),$cV=(function(){function $V($V,$U,$r,$s,$p,$c,$R){this.lineWidth=$V,this.lineColor=$U,this.lineAlpha=$r,this.fillColor=$s,this.fillAlpha=$p,this.shape=$R,this.fill=$c}$_($V,"laya.webgl.shapes.GeometryData");var $U=$V.prototype;$U.clone=function(){return new $V(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$U.getIndexData=function(){return null},$U.getVertexData=function(){return null},$U.destroy=function(){this.shape=null}}(),function(){function $V($V){if($V instanceof Float32Array)this.points=$V;else if($V instanceof Array){$V.length;this.points=new Float32Array($V)}}$_($V,"laya.webgl.shapes.Vertex");var $U=$V.prototype;$k.imps($U,{"laya.webgl.shapes.IShape":!0}),$U.getData=function($V,$U,$r){},$U.needUpdate=function($V){return!1},$U.rebuild=function($V){},$U.setMatrix=function($V){}}(),function(){function $N($V){void 0===$V&&($V=1e4),this._renderType=$V}$_($N,"laya.webgl.submit.Submit");var $V=$N.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V.releaseRender=function(){var $V=$N._cache;($V[$V._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$V.getRenderType=function(){return this._renderType},$V.renderSubmit=function(){if(0===this._numEle)return 1;var $V=this.shaderValue.textureHost;if($V){var $U=$V.source;if(!$V.bitmap||!$U)return 1;this.shaderValue.texture=$U,$V.alphaTexture&&$V.alphaTexture.source&&(this.shaderValue.texture1=$V.alphaTexture.source)}this._vb.bind_upload(this._ib);var $r=$LV.mainContext;return this.shaderValue.upload(),$B.activeBlendFunction!==this._blendFn&&($r.enable(3042),this._blendFn($r),$B.activeBlendFunction=this._blendFn),$z.drawCall++,$z.trianglesFaces+=this._numEle/3,$r.drawElements(4,this._numEle,5123,this._startIdx),1},$N.__init__=function(){var $V=$N.RENDERBASE=new $N(-1);$V.shaderValue=new $DV(0,0),$V.shaderValue.ALPHA=-1234},$N.createSubmit=function($V,$U,$r,$s,$p){var $c=$N._cache._length?$N._cache[--$N._cache._length]:new $N;null==$r&&(($r=$c._selfVb||($c._selfVb=$fV.create(-1))).clear(),$s=0),$c._ib=$U,$c._vb=$r,$c._startIdx=$s*$uV.BYTES_PIDX,$c._numEle=0;var $R=$V._nBlendType;$c._blendFn=$V._targets?$B.targetFns[$R]:$B.fns[$R],$c.shaderValue=$p,$c.shaderValue.setValue($V._shader2D);var $T=$V._shader2D.filters;return $T&&$c.shaderValue.setFilters($T),$c},$N.createShape=function($V,$U,$r,$s,$p,$c){var $R=$N._cache._length?$N._cache[--$N._cache._length]:new $N;$R._ib=$U,$R._vb=$r,$R._numEle=$s,$R._startIdx=$p,$R.shaderValue=$c,$R.shaderValue.setValue($V._shader2D);var $T=$V._nBlendType;return $R._blendFn=$V._targets?$B.targetFns[$T]:$B.fns[$T],$R},$N.TYPE_2D=1e4,$N.TYPE_CANVAS=10003,$N.TYPE_CMDSETRT=10004,$N.TYPE_CUSTOM=10005,$N.TYPE_BLURRT=10006,$N.TYPE_CMDDESTORYPRERT=10007,$N.TYPE_DISABLESTENCIL=10008,$N.TYPE_OTHERIBVB=10009,$N.TYPE_PRIMITIVE=10010,$N.TYPE_RT=10011,$N.TYPE_BLUR_RT=10012,$N.TYPE_TARGET=10013,$N.TYPE_CHANGE_VALUE=10014,$N.TYPE_SHAPE=10015,$N.TYPE_TEXTURE=10016,$N.TYPE_FILLTEXTURE=10017,$N.RENDERBASE=null,$N._cache=(($N._cache=[])._length=0,$N._cache),$N}()),$RV=function(){function $s(){this.fun=null,this.args=null}$_($s,"laya.webgl.submit.SubmitCMD");var $V=$s.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V.renderSubmit=function(){return this.fun.apply(null,this.args),1},$V.getRenderType=function(){return 0},$V.releaseRender=function(){var $V=$s._cache;$V[$V._length++]=this},$s.create=function($V,$U){var $r=$s._cache._length?$s._cache[--$s._cache._length]:new $s;return $r.fun=$U,$r.args=$V,$r},$s._cache=(($s._cache=[])._length=0,$s._cache),$s}(),$TV=function(){function $U(){this.variables={}}$_($U,"laya.webgl.submit.SubmitCMDScope");var $V=$U.prototype;return $V.getValue=function($V){return this.variables[$V]},$V.addValue=function($V,$U){return this.variables[$V]=$U},$V.setValue=function($V,$U){return this.variables.hasOwnProperty($V)?this.variables[$V]=$U:null},$V.clear=function(){for(var $V in this.variables)delete this.variables[$V]},$V.recycle=function(){this.clear(),$U.POOL.push(this)},$U.create=function(){var $V=$U.POOL.pop();return $V||($V=new $U),$V},$U.POOL=[],$U}(),$NV=function(){function $S(){this.offset=0,this.startIndex=0,this._mat=$n.create()}$_($S,"laya.webgl.submit.SubmitOtherIBVB");var $V=$S.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V.releaseRender=function(){var $V=$S._cache;($V[$V._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$V.getRenderType=function(){return 10009},$V.renderSubmit=function(){var $V=this._shaderValue.textureHost;if($V){var $U=$V.source;if(!$V.bitmap||!$U)return 1;this._shaderValue.texture=$U}this._vb.bind_upload(this._ib);var $r=$WV.worldMatrix4,$s=$n.TEMP;$n.mulPre(this._mat,$r[0],$r[1],$r[4],$r[5],$r[12],$r[13],$s);var $p=$WV.worldMatrix4=$S.tempMatrix4;$p[0]=$s.a,$p[1]=$s.b,$p[4]=$s.c,$p[5]=$s.d,$p[12]=$s.tx,$p[13]=$s.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $c=$LV.mainContext;return $B.activeBlendFunction!==this._blendFn&&($c.enable(3042),this._blendFn($c),$B.activeBlendFunction=this._blendFn),$z.drawCall++,$z.trianglesFaces+=this._numEle/3,$c.drawElements(4,this._numEle,5123,this.startIndex),$WV.worldMatrix4=$r,$ZV.activeShader=null,1},$S.create=function($V,$U,$r,$s,$p,$c,$R,$T,$N){void 0===$N&&($N=0);var $t=$S._cache._length?$S._cache[--$S._cache._length]:new $S;$t._ib=$r,$t._vb=$U,$t._numEle=$s,$t._shader=$p,$t._shaderValue=$c;var $b=$V._nBlendType;switch($t._blendFn=$V._targets?$B.targetFns[$b]:$B.fns[$b],$N){case 0:$t.offset=0,$t.startIndex=$T/($uV.BYTES_PE*$U.vertexStride)*1.5,$t.startIndex*=$uV.BYTES_PIDX;break;case 1:$t.startIndex=$R,$t.offset=$T}return $t},$S._cache=(($S._cache=[])._length=0,$S._cache),$S.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$S}(),$tV=function(){function $r(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $Q,this.screenRect=new $Q}$_($r,"laya.webgl.submit.SubmitScissor");var $V=$r.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V._scissor=function($V,$U,$r,$s){var $p=$WV.worldMatrix4,$c=$p[0],$R=$p[5],$T=$p[12],$N=$p[13];if($s*=$R,($r*=$c)<1||$s<1)return!1;var $t=($V=$V*$c+$T)+$r,$b=($U=$U*$R+$N)+$s;$V<0&&($r=$t-($V=0)),$U<0&&($s=$b-($U=0));var $S=$WV.worldClipRect;if($V=Math.max($V,$S.x),$U=Math.max($U,$S.y),$r=Math.min($t,$S.right)-$V,$s=Math.min($b,$S.bottom)-$U,$r<1||$s<1)return!1;var $_=$WV.worldScissorTest;return this.screenRect.copyFrom($S),$S.x=$V,$S.y=$U,$S.width=$r,$S.height=$s,$WV.worldScissorTest=!0,$U=$WV.height-$U-$s,$LV.mainContext.scissor($V,$U,$r,$s),$LV.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$_?($U=$WV.height-this.screenRect.y-this.screenRect.height,$LV.mainContext.scissor(this.screenRect.x,$U,this.screenRect.width,this.screenRect.height),$LV.mainContext.enable(3089)):($LV.mainContext.disable(3089),$WV.worldScissorTest=!1),$S.copyFrom(this.screenRect),!0},$V._scissorWithTagart=function($V,$U,$r,$s){if($r<1||$s<1)return!1;var $p=$V+$r,$c=$U+$s;$V<0&&($r=$p-($V=0)),$U<0&&($s=$c-($U=0));var $R=$WV.worldClipRect;if($V=Math.max($V,$R.x),$U=Math.max($U,$R.y),$r=Math.min($p,$R.right)-$V,$s=Math.min($c,$R.bottom)-$U,$r<1||$s<1)return!1;var $T=$WV.worldScissorTest;return this.screenRect.copyFrom($R),$WV.worldScissorTest=!0,$R.x=$V,$R.y=$U,$R.width=$r,$R.height=$s,$U=$WV.height-$U-$s,$LV.mainContext.scissor($V,$U,$r,$s),$LV.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$T?($U=$WV.height-this.screenRect.y-this.screenRect.height,$LV.mainContext.scissor(this.screenRect.x,$U,this.screenRect.width,this.screenRect.height),$LV.mainContext.enable(3089)):($LV.mainContext.disable(3089),$WV.worldScissorTest=!1),$R.copyFrom(this.screenRect),!0},$V.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$V.getRenderType=function(){return 0},$V.releaseRender=function(){var $V=$r._cache;($V[$V._length++]=this).context=null},$r.create=function($V){var $U=$r._cache._length?$r._cache[--$r._cache._length]:new $r;return $U.context=$V,$U},$r._cache=(($r._cache=[])._length=0,$r._cache),$r}(),$bV=function(){function $N(){this.step=0,this.blendMode=null,this.level=0}$_($N,"laya.webgl.submit.SubmitStencil");var $V=$N.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$V.getRenderType=function(){return 0},$V.releaseRender=function(){var $V=$N._cache;$V[$V._length++]=this},$V.do1=function(){var $V=$LV.mainContext;$V.enable(2960),$V.clear(1024),$V.colorMask(!1,!1,!1,!1),$V.stencilFunc(514,this.level,255),$V.stencilOp(7680,7680,7682)},$V.do2=function(){var $V=$LV.mainContext;$V.stencilFunc(514,this.level+1,255),$V.colorMask(!0,!0,!0,!0),$V.stencilOp(7680,7680,7680)},$V.do3=function(){var $V=$LV.mainContext;$V.colorMask(!0,!0,!0,!0),$V.stencilOp(7680,7680,7680),$V.clear(1024),$V.disable(2960)},$V.do4=function(){var $V=$LV.mainContext;0==this.level&&($V.enable(2960),$V.clear(1024)),$V.colorMask(!1,!1,!1,!1),$V.stencilFunc(519,0,255),$V.stencilOp(7680,7680,7682)},$V.do5=function(){var $V=$LV.mainContext;$V.stencilFunc(514,this.level,255),$V.colorMask(!0,!0,!0,!0),$V.stencilOp(7680,7680,7680)},$V.do6=function(){var $V=$LV.mainContext;$B.targetFns[$B.TOINT[this.blendMode]]($V)},$V.do7=function(){var $V=$LV.mainContext;$V.colorMask(!1,!1,!1,!1),$V.stencilOp(7680,7680,7683)},$V.do8=function(){var $V=$LV.mainContext;$V.colorMask(!0,!0,!0,!0),$V.stencilFunc(514,this.level,255),$V.stencilOp(7680,7680,7680)},$N.restore=function($V,$U,$r,$s,$p){var $c;if(($V._renderKey=0)<$N._mask&&$N._mask--,0==$N._mask)$c=laya.webgl.submit.SubmitStencil.create(3),$V.addRenderObject($c),$V._curSubmit=$cV.RENDERBASE;else{$c=laya.webgl.submit.SubmitStencil.create(7),$V.addRenderObject($c);var $R=$V._vb;$R._byteLength;if($hV.fillRectImgVb($R,null,$U.x,$U.y,$U.width,$U.height,$a.DEF_UV,$r,$s,$p,0,0)){$V._shader2D.glTexture=null;var $T=$V._curSubmit=$cV.createSubmit($V,$V._ib,$R,($R._byteLength-64)/32*3,$DV.create(2,0));$T.shaderValue.ALPHA=1,$V._submits[$V._submits._length++]=$T,$V._curSubmit._numEle+=6,$V._curSubmit=$cV.RENDERBASE}else alert("clipRect calc stencil rect error");$c=laya.webgl.submit.SubmitStencil.create(8),$V.addRenderObject($c)}},$N.restore2=function($V,$U){var $r;($V._renderKey=0)<$N._mask&&$N._mask--,0==$N._mask?($r=laya.webgl.submit.SubmitStencil.create(3),$V.addRenderObject($r),$V._curSubmit=$cV.RENDERBASE):($r=laya.webgl.submit.SubmitStencil.create(7),$V.addRenderObject($r),$V._submits[$V._submits._length++]=$U,$r=laya.webgl.submit.SubmitStencil.create(8),$V.addRenderObject($r))},$N.create=function($V){var $U=$N._cache._length?$N._cache[--$N._cache._length]:new $N;return 5==($U.step=$V)&&++$N._mask,$U.level=$N._mask,$U},$N._cache=(($N._cache=[])._length=0,$N._cache),$N._mask=0,$N}(),$SV=function(){function $T(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$_($T,"laya.webgl.submit.SubmitTarget");var $V=$T.prototype;return $k.imps($V,{"laya.webgl.submit.ISubmit":!0}),$V.renderSubmit=function(){this._vb.bind_upload(this._ib);var $V=this.scope.getValue(this.proName);return $V&&(this.shaderValue.texture=$V.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$V.width,$V.height]),this.shaderValue.upload(),this.blend(),$z.drawCall++,$z.trianglesFaces+=this._numEle/3,$LV.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$V.blend=function(){if($B.activeBlendFunction!==$B.fns[this.blendType]){var $V=$LV.mainContext;$V.enable(3042),$B.fns[this.blendType]($V),$B.activeBlendFunction=$B.fns[this.blendType]}},$V.getRenderType=function(){return 0},$V.releaseRender=function(){var $V=$T._cache;($V[$V._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$T.create=function($V,$U,$r,$s,$p,$c){var $R=$T._cache._length?$T._cache[--$T._cache._length]:new $T;return $R._ib=$U,$R._vb=$r,$R.proName=$c,$R._startIdx=$s*$uV.BYTES_PIDX,$R._numEle=0,$R.blendType=$V._nBlendType,$R.shaderValue=$p,$R.shaderValue.setValue($V._shader2D),$R},$T._cache=(($T._cache=[])._length=0,$T._cache),$T}(),$_V=function(){function $V(){this._sourceStr=null}$_($V,"laya.webgl.text.CharSegment");var $U=$V.prototype;return $k.imps($U,{"laya.webgl.text.ICharSegment":!0}),$U.textToSpit=function($V){this._sourceStr=$V},$U.getChar=function($V){return this._sourceStr.charAt($V)},$U.getCharCode=function($V){return this._sourceStr.charCodeAt($V)},$U.length=function(){return this._sourceStr.length},$V}(),$GV=function(){var $V;function $z(){}return $_($z,"laya.webgl.text.DrawText"),$z.__init__=function(){$z._charsTemp=new Array,$z._drawValue=new $V,$z._charSeg=new $_V},$z.customCharSeg=function($V){$z._charSeg=$V},$z.getChar=function($V,$U,$r){var $s=$AV.createOneChar($V,$r);return-1!=$U&&($z._charsCache[$U]=$s),$s},$z._drawSlow=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S,$_,$G,$q){var $u,$h,$l=$z._drawValue.value($c,$T,$N,$t,$_,$G,$q),$W=0,$O=0,$L=$z._charsTemp,$d=0,$k=NaN;if($s)for($L.length=$s.length,$W=0,$O=$s.length;$W<$O;$W++)($h=$s[$W])&&($k=$h.charNum+$l.txtID,$L[$W]=$u=$z._charsCache[$k]||$z.getChar($h.char,$k,$l),$u.active());else{var $y=$r instanceof laya.utils.WordText?$r.toString():$r;if($m.CharacterCache){$z._charSeg.textToSpit($y);var $D=$z._charSeg.length();for($W=0,$O=$L.length=$D;$W<$O;$W++)$k=$z._charSeg.getCharCode($W)+$l.txtID,$L[$W]=$u=$z._charsCache[$k]||$z.getChar($z._charSeg.getChar($W),$k,$l),$u.active(),$d+=$u.cw}else $L.length=0,($u=$z.getChar($y,-1,$l)).active(),$d+=$u.cw,$L[0]=$u}var $n=0;null!==$R&&"left"!==$R&&($n=-("center"==$R?$d/2:$d));var $I,$Q,$H=NaN,$w=0;if($s)for($W=0,$O=$L.length;$W<$O;$W++)$u=$L[$W],$h=$s[$W],$u&&$h&&!$u.isSpace&&($H=$u.borderSize,$I=$u.texture,$U._drawText($I,$b+$n+$h.x*$_-$H,$S+$h.y*$G-$H,$I.width,$I.height,$p,0,0,0,0));else{for($W=0,$O=$L.length;$W<$O;$W++)($u=$L[$W])&&!$u.isSpace&&($H=$u.borderSize,$I=$u.texture,$U._drawText($I,$b+$n-$H,$S-$H,$I.width,$I.height,$p,0,0,0,0),$V&&(($Q=$V[$w++])||($Q=$V[$w-1]=[]),$Q[0]=$I,$Q[1]=$n-$H,$Q[2]=-$H)),$n+=$u.cw;$V&&($V.length=$w)}},$z._drawFast=function($V,$U,$r,$s,$p){for(var $c,$R,$T=0,$N=$V.length;$T<$N;$T++)($c=($R=$V[$T])[0]).active(),$U._drawText($c,$s+$R[1],$p+$R[2],$c.width,$c.height,$r,0,0,0,0)},$z.drawText=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S){if(void 0===$S&&($S=0),!($U&&0===$U.length||$r&&0===$r.length)){var $_=$s.a,$G=$s.d;(0!==$s.b||0!==$s.c)&&($_=$G=1);var $q=1!==$_||1!==$G;if($q&&$k.stage.transform){var $u=$k.stage.transform;$q=$u.a===$_&&$u.d===$G}else $q=!1;if($q){var $h=($s=$s.copyTo($yV._tmpMatrix)).tx,$l=$s.ty;$s.scale(1/$_,1/$G),$s._checkTransform(),$t*=$_,$b*=$G,$t+=$h-$s.tx,$b+=$l-$s.ty}else $_=$G=1;if($r)$z._drawSlow(null,$V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$_,$G,$S);else{if(null===$U.toUpperCase){var $W=$_+1e5*$G,$O=$U;return void($O.changed||$O.id!==$W?($O.id=$W,$O.changed=!1,$z._drawSlow($O.save,$V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$_,$G,$S)):$z._drawFast($O.save,$V,$s,$t,$b))}var $L=$U+$p.toString()+$R+$T+$N+$_+$G+$c,$d=$z._textsCache[$L];$m.CharacterCache?$d?$z._drawFast($d,$V,$s,$t,$b):($z._textsCache.__length||($z._textsCache.__length=0),$z._textsCache.__length>$y.WebGLTextCacheCount&&(($z._textsCache={}).__length=0,$z._curPoolIndex=0),$z._textCachesPool[$z._curPoolIndex]?($d=$z._textsCache[$L]=$z._textCachesPool[$z._curPoolIndex]).length=0:$z._textCachesPool[$z._curPoolIndex]=$d=$z._textsCache[$L]=[],$z._textsCache.__length++,$z._curPoolIndex++,$z._drawSlow($d,$V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$_,$G,$S)):$z._drawSlow($d,$V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$_,$G,$S)}}},$z._charsTemp=null,$z._textCachesPool=[],$z._curPoolIndex=0,$z._charsCache={},$z._textsCache={},$z._drawValue=null,$z.d=[],$z._charSeg=null,$z.__init$=function(){$V=function(){function $N(){}return $_($N,""),$N.prototype.value=function($V,$U,$r,$s,$p,$c,$R){this.font=$V,this.fillColor=$U,this.borderColor=$r,this.lineWidth=$s,this.scaleX=$p,this.scaleY=$c,this.underLine=$R;var $T=$V.toString()+$p+$c+$s+($U?$U.toLowerCase():" ")+($r?$r.toLowerCase():" ")+$R;return this.txtID=$N._keymap[$T],this.txtID||(this.txtID=1e-7*++$N._keymapCount,$N._keymap[$T]=this.txtID),this},$N.clear=function(){$N._keymap={},$N._keymapCount=1},$N._keymap={},$N._keymapCount=1,$N}()},$z}(),$qV=function(){function $p($V){this._index=0,this._size=14,this._italic=-2,$p._cache2=$p._cache2||[],this.setFont($V||"14px Arial")}$_($p,"laya.webgl.text.FontInContext");var $V=$p.prototype;return $V.setFont=function($V){var $U=$p._cache2[$V];if($U)this._words=$U[0],this._size=$U[1];else{this._words=$V.split(" ");for(var $r=0,$s=this._words.length;$r<$s;$r++)if(0<this._words[$r].indexOf("px")){this._index=$r;break}this._size=parseInt(this._words[this._index]),$p._cache2[$V]=[this._words,this._size]}this._text=null,this._italic=-2},$V.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$V.hasType=function($V){for(var $U=0,$r=this._words.length;$U<$r;$U++)if(this._words[$U]===$V)return $U;return-1},$V.removeType=function($V){for(var $U=0,$r=this._words.length;$U<$r;$U++)if(this._words[$U]===$V){this._words.splice($U,1),this._index>$U&&this._index--;break}this._text=null,this._italic=-2},$V.copyTo=function($V){return $V._text=this._text,$V._size=this._size,$V._index=this._index,$V._words=this._words.slice(),$V._italic=-2,$V},$V.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$s(0,$V,"size",function(){return this._size},function($V){this._size=$V,this._words[this._index]=$V+"px",this._text=null}),$p.create=function($V){var $U=$p._cache[$V];return $U||($U=$p._cache[$V]=new $p($V))},$p.EMPTY=new $p,$p._cache={},$p._cache2=null,$p}(),$uV=function(){function $V(){}return $_($V,"laya.webgl.utils.CONST3D2D"),$V.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$V.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$V.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$V._TMPARRAY=[],$V._OFFSETX=0,$V._OFFSETY=0,$R($V,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$V}(),$hV=function(){function $q(){}return $_($q,"laya.webgl.utils.GlUtils"),$q.make2DProjection=function($V,$U,$r){return[2/$V,0,0,0,0,-2/$U,0,0,0,0,2/$r,0,-1,1,0,1]},$q.fillIBQuadrangle=function($V,$U){if(65535/4<$U)throw Error("IBQuadrangle count:"+$U+" must<:"+Math.floor(65535/4));$U=Math.floor($U),$V._resizeBuffer(6*($U+1)*2,!1),$V.byteLength=$V.bufferLength;for(var $r=$V.getUint16Array(),$s=0,$p=0;$p<$U;$p++)$r[$s++]=4*$p,$r[$s++]=4*$p+2,$r[$s++]=4*$p+1,$r[$s++]=4*$p,$r[$s++]=4*$p+3,$r[$s++]=4*$p+2;return $V.setNeedUpload(),!0},$q.expandIBQuadrangle=function($V,$U){$V.bufferLength>=6*$U*2||$q.fillIBQuadrangle($V,$U)},$q.mathCeilPowerOfTwo=function($V){return $V--,$V|=$V>>1,$V|=$V>>2,$V|=$V>>4,$V|=$V>>8,$V|=$V>>16,++$V},$q.fillQuadrangleImgVb=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=16+($V._byteLength>>2);$V.byteLength=$N<<2;var $t=$V.getFloat32Array();$t[($N-=16)+2]=$p[0],$t[$N+3]=$p[1],$t[$N+6]=$p[2],$t[$N+7]=$p[3],$t[$N+10]=$p[4],$t[$N+11]=$p[5],$t[$N+14]=$p[6],$t[$N+15]=$p[7];var $b=$c.a,$S=$c.b,$_=$c.c,$G=$c.d;if(1!==$b||0!==$S||0!==$_||1!==$G){$c.bTransform=!0;var $q=$c.tx+$R,$u=$c.ty+$T;$t[$N]=($s[0]+$U)*$b+($s[1]+$r)*$_+$q,$t[$N+1]=($s[0]+$U)*$S+($s[1]+$r)*$G+$u,$t[$N+4]=($s[2]+$U)*$b+($s[3]+$r)*$_+$q,$t[$N+5]=($s[2]+$U)*$S+($s[3]+$r)*$G+$u,$t[$N+8]=($s[4]+$U)*$b+($s[5]+$r)*$_+$q,$t[$N+9]=($s[4]+$U)*$S+($s[5]+$r)*$G+$u,$t[$N+12]=($s[6]+$U)*$b+($s[7]+$r)*$_+$q,$t[$N+13]=($s[6]+$U)*$S+($s[7]+$r)*$G+$u}else $c.bTransform=!1,$U+=$c.tx+$R,$r+=$c.ty+$T,$t[$N]=$U+$s[0],$t[$N+1]=$r+$s[1],$t[$N+4]=$U+$s[2],$t[$N+5]=$r+$s[3],$t[$N+8]=$U+$s[4],$t[$N+9]=$r+$s[5],$t[$N+12]=$U+$s[6],$t[$N+13]=$r+$s[7];return $V._upload=!0},$q.fillTranglesVB=function($V,$U,$r,$s,$p,$c,$R){var $T=($V._byteLength>>2)+$s.length;$V.byteLength=$T<<2;var $N=$V.getFloat32Array();$T-=$s.length;for(var $t=$s.length,$b=$p.a,$S=$p.b,$_=$p.c,$G=$p.d,$q=0;$q<$t;$q+=4)if($N[$T+$q+2]=$s[$q+2],$N[$T+$q+3]=$s[$q+3],1!==$b||0!==$S||0!==$_||1!==$G){$p.bTransform=!0;var $u=$p.tx+$c,$h=$p.ty+$R;$N[$T+$q]=($s[$q]+$U)*$b+($s[$q+1]+$r)*$_+$u,$N[$T+$q+1]=($s[$q]+$U)*$S+($s[$q+1]+$r)*$G+$h}else $p.bTransform=!1,$U+=$p.tx+$c,$r+=$p.ty+$R,$N[$T+$q]=$U+$s[$q],$N[$T+$q+1]=$r+$s[$q+1];return $V._upload=!0},$q.copyPreImgVb=function($V,$U,$r){var $s=$V._byteLength>>2;$V.byteLength=$s+16<<2;for(var $p=$V.getFloat32Array(),$c=0,$R=$s-16;$c<4;$c++)$p[$s]=$p[$R]+$U,++$R,$p[++$s]=$p[$R]+$r,++$R,$p[++$s]=$p[$R],++$R,$p[++$s]=$p[$R],++$s,++$R;$V._upload=!0},$q.fillRectImgVb=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S,$_){void 0===$_&&($_=!1);var $G,$q,$u,$h,$l,$W,$O,$L,$d,$k,$y,$D,$n,$I,$Q,$H,$w=1,$z=$T.a,$E=$T.b,$K=$T.c,$m=$T.d,$a=$U&&$U.width<99999999;if(1!==$z||0!==$E||0!==$K||1!==$m?($T.bTransform=!0,0===$E&&0===$K&&($w=23,$d=$p+$r,$k=$c+$s,$G=$z*$r+($y=$T.tx+$N),$u=$z*$d+$y,$q=$m*$s+($D=$T.ty+$t),$h=$m*$k+$D)):($w=23,$T.bTransform=!1,$u=($G=$r+$T.tx+$N)+$p,$h=($q=$s+$T.ty+$t)+$c),$a&&($l=$U.x,$W=$U.y,$O=$U.width+$l,$L=$U.height+$W),1!==$w){if(Math.min($G,$u)>=$O)return!1;if(Math.min($q,$h)>=$L)return!1;if(Math.max($u,$G)<=$l)return!1;if(Math.max($h,$q)<=$W)return!1}var $Z=$V._byteLength>>2;$V.byteLength=16+$Z<<2;var $x=$V.getFloat32Array();switch($x[2+$Z]=$R[0],$x[3+$Z]=$R[1],$x[6+$Z]=$R[2],$x[7+$Z]=$R[3],$x[10+$Z]=$R[4],$x[11+$Z]=$R[5],$x[14+$Z]=$R[6],$x[15+$Z]=$R[7],$w){case 1:$y=$T.tx+$N,$D=$T.ty+$t;var $$=$z*$r,$j=$K*$s,$o=$m*$s,$J=$E*$r,$i=$z*($d=$p+$r),$B=$K*($k=$c+$s),$P=$m*$k,$M=$E*$d;$_?($n=$$+$j+$y,$Q=Math.round($n)-$n,$I=$o+$J+$D,$H=Math.round($I)-$I,$x[$Z]=$n+$Q,$x[1+$Z]=$I+$H,$x[4+$Z]=$i+$j+$y+$Q,$x[5+$Z]=$o+$M+$D+$H,$x[8+$Z]=$i+$B+$y+$Q,$x[9+$Z]=$P+$M+$D+$H,$x[12+$Z]=$$+$B+$y+$Q,$x[13+$Z]=$P+$J+$D+$H):($x[$Z]=$$+$j+$y,$x[1+$Z]=$o+$J+$D,$x[4+$Z]=$i+$j+$y,$x[5+$Z]=$o+$M+$D,$x[8+$Z]=$i+$B+$y,$x[9+$Z]=$P+$M+$D,$x[12+$Z]=$$+$B+$y,$x[13+$Z]=$P+$J+$D);break;case 23:$_?($n=$G+$b,$Q=Math.round($n)-$n,$I=$q,$H=Math.round($I)-$I,$x[$Z]=$n+$Q,$x[1+$Z]=$I+$H,$x[4+$Z]=$u+$b+$Q,$x[5+$Z]=$q+$H,$x[8+$Z]=$u+$Q,$x[9+$Z]=$h+$H,$x[12+$Z]=$G+$Q,$x[13+$Z]=$h+$H):($x[$Z]=$G+$b,$x[1+$Z]=$q,$x[4+$Z]=$u+$b,$x[5+$Z]=$q,$x[8+$Z]=$u,$x[9+$Z]=$h,$x[12+$Z]=$G,$x[13+$Z]=$h)}return $V._upload=!0},$q.fillLineVb=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=.5*$R,$t=$q._fillLineArray,$b=-($s-$c),$S=$r-$p,$_=Math.sqrt($b*$b+$S*$S);$b/=$_,$S/=$_,$b*=$N,$S*=$N,$t[0]=$r-$b,$t[1]=$s-$S,$t[4]=$r+$b,$t[5]=$s+$S,$t[8]=$p+$b,$t[9]=$c+$S,$t[12]=$p-$b,$t[13]=$c-$S,$T&&$T.transformPointArray($t,$t);var $G=16+($V._byteLength>>2);return $V.byteLength=$G<<2,$V.insertData($t,$G-16),!0},$q._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$q}(),$lV=(function(){function $N(){}$_($N,"laya.webgl.utils.MatirxArray"),$N.ArrayMul=function($V,$U,$r){if($V)if($U)for(var $s=NaN,$p=NaN,$c=NaN,$R=NaN,$T=0;$T<4;$T++)$s=$V[$T],$p=$V[$T+4],$c=$V[$T+8],$R=$V[$T+12],$r[$T]=$s*$U[0]+$p*$U[1]+$c*$U[2]+$R*$U[3],$r[$T+4]=$s*$U[4]+$p*$U[5]+$c*$U[6]+$R*$U[7],$r[$T+8]=$s*$U[8]+$p*$U[9]+$c*$U[10]+$R*$U[11],$r[$T+12]=$s*$U[12]+$p*$U[13]+$c*$U[14]+$R*$U[15];else $N.copyArray($V,$r);else $N.copyArray($U,$r)},$N.copyArray=function($V,$U){if($V&&$U)for(var $r=0;$r<$V.length;$r++)$U[$r]=$V[$r]}}(),function(){function $U($V,$U,$r){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$V,this._vb=new $fV($V,35048),$U&&this._vb._resizeBuffer($U,!1),this._ib=new $CV,$r&&this._ib._resizeBuffer($r,!1)}$_($U,"laya.webgl.utils.Mesh2D");var $V=$U.prototype;return $V.cloneWithNewVB=function(){var $V=new $U(this._stride,0,0);return $V._ib=this._ib,$V._quadNum=this._quadNum,$V._attribInfo=this._attribInfo,$V},$V.cloneWithNewVBIB=function(){var $V=new $U(this._stride,0,0);return $V._attribInfo=this._attribInfo,$V},$V.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$V.getVBR=function(){return this._vb},$V.getIBR=function(){return this._ib},$V.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$V.createQuadIB=function($V){this._quadNum=$V,this._ib._resizeBuffer(6*$V*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $U=this._ib.getUint16Array(),$r=0,$s=0,$p=0;$p<$V;$p++)$U[$r++]=$s,$U[$r++]=$s+2,$U[$r++]=$s+1,$U[$r++]=$s,$U[$r++]=$s+3,$U[$r++]=$s+2,$s+=4;this._ib.setNeedUpload()},$V.setAttributes=function($V){if(this._attribInfo=$V,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$V.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$V.releaseMesh=function(){},$V.destroy=function(){},$V.clearVB=function(){this._vb.clear()},$U._gvaoid=0,$U}()),$WV=function(){function $p(){}return $_($p,"laya.webgl.utils.RenderState2D"),$p.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$p.mat2MatArray=function($V,$U){var $r=$V,$s=$U;return $s[0]=$r.a,$s[1]=$r.b,$s[2]=$p.EMPTYMAT4_ARRAY[2],$s[3]=$p.EMPTYMAT4_ARRAY[3],$s[4]=$r.c,$s[5]=$r.d,$s[6]=$p.EMPTYMAT4_ARRAY[6],$s[7]=$p.EMPTYMAT4_ARRAY[7],$s[8]=$p.EMPTYMAT4_ARRAY[8],$s[9]=$p.EMPTYMAT4_ARRAY[9],$s[10]=$p.EMPTYMAT4_ARRAY[10],$s[11]=$p.EMPTYMAT4_ARRAY[11],$s[12]=$r.tx,$s[13]=$r.ty,$s[14]=$p.EMPTYMAT4_ARRAY[14],$s[15]=$p.EMPTYMAT4_ARRAY[15],$U},$p.restoreTempArray=function(){$p.TEMPMAT4_ARRAY[0]=1,$p.TEMPMAT4_ARRAY[1]=0,$p.TEMPMAT4_ARRAY[4]=0,$p.TEMPMAT4_ARRAY[5]=1,$p.TEMPMAT4_ARRAY[12]=0,$p.TEMPMAT4_ARRAY[13]=0},$p.clear=function(){$p.worldScissorTest=!1,$p.worldShaderDefines=null,$p.worldFilters=null,$p.worldAlpha=1,$p.worldClipRect.x=$p.worldClipRect.y=0,$p.worldClipRect.width=$p.width,$p.worldClipRect.height=$p.height,$p.curRenderTarget=null},$p._MAXSIZE=99999999,$p.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$p.worldMatrix4=$p.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$p.worldAlpha=1,$p.worldScissorTest=!1,$p.worldFilters=null,$p.worldShaderDefines=null,$p.curRenderTarget=null,$p.width=0,$p.height=0,$R($p,["worldMatrix",function(){return this.worldMatrix=new $n},"worldClipRect",function(){return this.worldClipRect=new $Q(0,0,99999999,99999999)}]),$p}(),$OV=function(){var $W,$r;function $O($V,$U,$r,$s,$p){var $c=this;function $R($V){var $U=[],$r=new $W($U);return $c._compileToTree($r,$V.split("\n"),0,$U,$p),$r}var $T=$G.now();this._VS=$R($U),this._PS=$R($r),this._nameMap=$s,2<$G.now()-$T&&console.log("ShaderCompile use time:"+($G.now()-$T)+"  size:"+$U.length+"/"+$r.length)}$_($O,"laya.webgl.utils.ShaderCompile");var $V=$O.prototype;return $V._compileToTree=function($V,$U,$r,$s,$p){var $c,$R,$T,$N,$t,$b,$S,$_=0,$G=0,$q=0,$u=0;for($G=$r;$G<$U.length;$G++)if(!(($T=$U[$G]).length<1)&&0!==($_=$T.indexOf("//"))){if(0<=$_&&($T=$T.substr(0,$_)),$c=$S||new $W($s),$S=null,$c.text=$T,$c.noCompile=!0,0<=($_=$T.indexOf("#"))){for($N="#",$u=$_+1,$q=$T.length;$u<$q;$u++){var $h=$T.charAt($u);if(" "===$h||"\t"===$h||"\r"===$h||"\n"===$h||"?"===$h)break;$N+=$h}switch($c.name=$N){case"#ifdef":case"#ifndef":if($c.src=$T,$c.noCompile=null!=$T.match(/[!&|()=<>]/),$c.noCompile?console.log("function():Boolean{return "+$T.substr($_+$c.name.length)+"}"):($b=$T.replace(/^\s*/,"").split(/\s+/),$c.setCondition($b[1],"#ifdef"===$N?1:2),$c.text="//"+$c.text),$c.setParent($V),$V=$c,$p)for($b=$T.substr($u).split($O._splitToWordExps3),$u=0;$u<$b.length;$u++)($T=$b[$u]).length&&($p[$T]=!0);continue;case"#if":if($c.src=$T,$c.noCompile=!0,$c.setParent($V),$V=$c,$p)for($b=$T.substr($u).split($O._splitToWordExps3),$u=0;$u<$b.length;$u++)($T=$b[$u]).length&&"defined"!=$T&&($p[$T]=!0);continue;case"#else":$c.src=$T,$R=($V=$V.parent).childs[$V.childs.length-1],$c.noCompile=$R.noCompile,$c.noCompile||($c.condition=$R.condition,$c.conditionType=1==$R.conditionType?2:1,$c.text="//"+$c.text+" "+$R.text+" "+$c.conditionType),$c.setParent($V),$V=$c;continue;case"#endif":$R=($V=$V.parent).childs[$V.childs.length-1],$c.noCompile=$R.noCompile,$c.noCompile||($c.text="//"+$c.text),$c.setParent($V);continue;case"#include":$b=$O.splitToWords($T,null);var $l=$O.includes[$b[1]];if(!$l)throw"ShaderCompile error no this include file:"+$b[1];if(($_=$b[0].indexOf("?"))<0){$c.setParent($V),$T=$l.getWith("with"==$b[2]?$b[3]:null),this._compileToTree($c,$T.split("\n"),0,$s,$p),$c.text="";continue}$c.setCondition($b[0].substr($_+1),1),$c.text=$l.getWith("with"==$b[2]?$b[3]:null);break;case"#import":$t=($b=$O.splitToWords($T,null))[1],$s.push({node:$c,file:$O.includes[$t],ofs:$c.text.length});continue}}else{if(($R=$V.childs[$V.childs.length-1])&&!$R.name){0<$s.length&&$O.splitToWords($T,$R),$S=$c,$R.text+="\n"+$T;continue}0<$s.length&&$O.splitToWords($T,$c)}$c.setParent($V)}},$V.createShader=function($V,$U,$r){var $s={},$p="";if($V)for(var $c in $V)$p+="#define "+$c+"\n",$s[$c]=!0;var $R=this._VS.toscript($s,[]),$T=this._PS.toscript($s,[]);return($r||$FV.create)($p+$R.join("\n"),$p+$T.join("\n"),$U,this._nameMap)},$O._parseOne=function($V,$U,$r,$s,$p,$c){var $R={type:$O.shaderParamsMap[$r[$s+1]],name:$r[$s+2],size:isNaN(parseInt($r[$s+3]))?1:parseInt($r[$s+3])};return $c&&("attribute"==$p?$V.push($R):$U.push($R)),":"==$r[$s+3]&&($R.type=$r[$s+4],$s+=2),$s+=2},$O.addInclude=function($V,$U){if(!$U||0===$U.length)throw new Error("add shader include file err:"+$V);if($O.includes[$V])throw new Error("add shader include file err, has add:"+$V);$O.includes[$V]=new $r($U)},$O.preGetParams=function($V,$U){var $r=[$V,$U],$s={},$p=[],$c=[],$R={},$T=[];$s.attributes=$p,$s.uniforms=$c,$s.defines=$R;for(var $N=0,$t=0,$b=0;$b<2;$b++){$r[$b]=$r[$b].replace($O._removeAnnotation,"");var $S,$_=$r[$b].match($O._reg);for($N=0,$t=$_.length;$N<$t;$N++){var $G=$_[$N];if("attribute"==$G||"uniform"==$G)$N=$O._parseOne($p,$c,$_,$N,$G,!0);else{if("#define"==$G){$T[$G=$_[++$N]]=1;continue}if("#ifdef"==$G){$R[$S=$_[++$N]]=$R[$S]||[];for($N++;$N<$t;$N++)if("attribute"==($G=$_[$N])||"uniform"==$G)$N=$O._parseOne($p,$c,$_,$N,$G,$T[$S]);else if("#else"==$G)for($N++;$N<$t;$N++)if("attribute"==($G=$_[$N])||"uniform"==$G)$N=$O._parseOne($p,$c,$_,$N,$G,!$T[$S]);else if("#endif"==$G)break}}}}return $s},$O.splitToWords=function($V,$U){for(var $r,$s,$p=[],$c=-1,$R=0,$T=$V.length;$R<$T;$R++)if($r=$V.charAt($R),0<=" \t=+-*/&%!<>()'\",;".indexOf($r)){if(0<=$c&&1<$R-$c&&($s=$V.substr($c,$R-$c),$p.push($s)),'"'==$r||"'"==$r){var $N=$V.indexOf($r,$R+1);if($N<0)throw"Sharder err:"+$V;$p.push($V.substr($R+1,$N-$R-1)),$R=$N,$c=-1;continue}"("==$r&&$U&&0<$p.length&&($s=$p[$p.length-1]+";","vec4;main;".indexOf($s)<0&&($U.useFuns+=$s)),$c=-1}else $c<0&&($c=$R);return $c<$T&&1<$T-$c&&($s=$V.substr($c,$T-$c),$p.push($s)),$p},$O.IFDEF_NO=0,$O.IFDEF_YES=1,$O.IFDEF_ELSE=2,$O.IFDEF_PARENT=3,$O._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$O._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$O._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$O.includes={},$R($O,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$O.__init$=function(){$W=function(){function $r($V){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$V}$_($r,"");var $V=$r.prototype;return $V.setParent=function($V){$V.childs.push(this),this.z=$V.z+1,this.parent=$V},$V.setCondition=function($V,$U){$V&&(this.conditionType=$U,$V=$V.replace(/(\s*$)/g,""),this.condition=function(){return this[$V]},this.condition.__condition=$V)},$V.toscript=function($V,$U){return this._toscript($V,$U,++$r.__id)},$V._toscript=function($s,$p,$c){if(this.childs.length<1&&!this.text)return $p;$p.length;if(this.condition){var $V=!!this.condition.call($s);if(2===this.conditionType&&($V=!$V),!$V)return $p}if(this.text&&$p.push(this.text),0<this.childs.length&&this.childs.forEach(function($V,$U,$r){$V._toscript($s,$p,$c)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $U,$r=0,$R=this.includefiles.length;$r<$R;$r++)this.includefiles[$r].curUseID!=$c&&0<($U=this.includefiles[$r].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$r].curUseID=$c,$p[0]=$U+$p[0]);return $p},$r.__id=1,$r}(),$r=function(){function $V($V){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$V;for(var $U=0,$r=0,$s=0;!(($U=$V.indexOf("#begin",$U))<0);){for($s=$U+5;!(($s=$V.indexOf("#end",$s))<0)&&"i"===$V.charAt($s+4);)$s+=5;if($s<0)throw"add include err,no #end:"+$V;$r=$V.indexOf("\n",$U);var $p=$O.splitToWords($V.substr($U,$r-$U),null);"code"==$p[1]?this.codes[$p[2]]=$V.substr($r+1,$s-$r-1):"function"==$p[1]&&($r=$V.indexOf("function",$U),$r+="function".length,this.funs[$p[3]]=$V.substr($r+1,$s-$r-1),this.funnames+=$p[3]+";"),$U=$s+1}}$_($V,"");var $U=$V.prototype;return $U.getWith=function($V){var $U=$V?this.codes[$V]:this.script;if(!$U)throw"get with error:"+$V;return $U},$U.getFunsScript=function($V){var $U="";for(var $r in this.funs)0<=$V.indexOf($r+";")&&($U+=this.funs[$r]);return $U},$V}()},$O}(),$LV=function(){function $R(){}return $_($R,"laya.webgl.WebGL"),$R._uint8ArraySlice=function(){for(var $V=this.length,$U=new Uint8Array(this.length),$r=0;$r<$V;$r++)$U[$r]=this[$r];return $U},$R._float32ArraySlice=function(){for(var $V=this.length,$U=new Float32Array(this.length),$r=0;$r<$V;$r++)$U[$r]=this[$r];return $U},$R._uint16ArraySlice=function($V){var $U,$r=arguments,$s=0,$p=0;if(0===$r.length)for($s=this.length,$U=new Uint16Array($s),$p=0;$p<$s;$p++)$U[$p]=this[$p];else if(2===$r.length){var $c=$r[0],$R=$r[1];if($c<$R)for($s=$R-$c,$U=new Uint16Array($s),$p=$c;$p<$R;$p++)$U[$p-$c]=this[$p];else $U=new Uint16Array(0)}return $U},$R.expandContext=function(){var $V=$p.prototype,$U=CanvasRenderingContext2D.prototype;$U.fillTrangles=$V.fillTrangles,$gV.__int__(null),$U.setIBVB=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){void 0===$N&&($N=0),void 0===$t&&($t=0),null===$r&&(this._ib=this._ib||$CV.QuadrangleIB,$r=this._ib,$hV.expandIBQuadrangle($r,$s._byteLength/64+8)),this._setIBVB($V,$U,$r,$s,$p,$c,$R,$T,$N,$t)},$U.fillTrangles=function($V,$U,$r,$s,$p){this._curMat=this._curMat||$n.create(),this._vb=this._vb||$fV.create(),this._ib||(this._ib=$CV.create(),$hV.fillIBQuadrangle(this._ib,$R/4));var $c=this._vb,$R=$s.length>>4;$hV.fillTranglesVB($c,$U,$r,$s,$p||this._curMat,0,0),$hV.expandIBQuadrangle(this._ib,$c._byteLength/64+8);var $T=new $DV(1,0);$T.textureHost=$V;var $N=new $YV("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$c._vertType=3,this._setIBVB($U,$r,this._ib,$c,6*$R,$p,$N,$T,0,0)}},$R.enable=function(){if($G.__init__(),$l.isConchApp&&!$l.isConchWebGL)return $d.skinAniSprite=function(){return new $VV},$R.expandContext(),!1;if($d.getWebGLContext=function($V){for(var $U,$r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$s=0;$s<$r.length;$s++){try{$U=$V.getContext($r[$s],{stencil:$y.isStencil,alpha:$y.isAlpha,antialias:$y.isAntialias,premultipliedAlpha:$y.premultipliedAlpha,preserveDrawingBuffer:$y.preserveDrawingBuffer})}catch($V){}if($U)return $U}return null},null==($R.mainContext=$R.mainContext||$d.getWebGLContext($l._mainCanvas)))return!1;if($l.isWebGL)return!0;$u.create=function($V,$U){return new $VU($V,$U)},$h.create=function($V,$U,$r,$s,$p,$c,$R){return new $eV($V,$U,$r,$s,$p,$c,$R)},$l.WebGL=$R,$l.isWebGL=!0,$GV.__init__(),$d.createRenderSprite=function($V,$U){return new $nV($V,$U)},$d.createWebGLContext2D=function($V){return new $yV($V)},$d.changeWebGLSize=function($V,$U){laya.webgl.WebGL.onStageResize($V,$U)},$d.createGraphics=function(){return new $kV};var $V=$d.createFilterAction;return $d.createFilterAction=$V||function($V){return new $IV},$d.clear=function($V){$WV.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $U=$l.context.ctx,$r=0==$U._submits._length||$y.preserveDrawingBuffer?$q.create($V)._color:$w._wgColor;$r&&$U.clearBG($r[0],$r[1],$r[2],$r[3]),$WV.clear()},$d.addToAtlas=function($V,$U){void 0===$U&&($U=!1);var $r=$V.bitmap;$l.optimizeTextureMemory($V.url,$V)?$k.__typeof($r,"laya.webgl.resource.IMergeAtlasBitmap")&&$r.allowMerageInAtlas&&$r.on("recovered",$V,$V.addTextureToAtlas):$r.enableMerageInAtlas=!1},$d.isAtlas=function($V){return $V instanceof laya.webgl.atlas.AtlasWebGLCanvas},$J._enable(),$d.beginFlush=function(){for(var $V=$J.instance,$U=$V.getAtlaserCount(),$r=0;$r<$U;$r++){var $s=$V.getAtlaserByIndex($r).texture;$s._flashCacheImageNeedFlush&&$d.flashFlushImage($s)}},$d.drawToCanvas=function($V,$U,$r,$s,$p,$c){($r<=0||$s<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$r|=0,$s|=0,$p|=0,$c|=0;var $R=$xV.create($r,$s,6408,5121,0,!1);$R.start(),$R.clear(0,0,0,0),$l.context.clear(),$W.renders[$U]._fun($V,$l.context,$p,$WV.height-$s+$c),$l.context.flush(),$R.end();var $T=$R.getData(0,0,$r,$s);if($R.recycle(),$T.byteLength==$r*$s*4){var $N=new $MV;$N._canvas=$G.createElement("canvas"),$N.size($r,$s);var $t=$N._canvas.getContext("2d");$G.canvas.size($r,$s);var $b=$G.context,$S=$b.createImageData($r,$s);return $S.data.set(new Uint8ClampedArray($T.buffer)),$N._imgData=$S,$b.putImageData($S,0,0),$t.save(),$t.translate(0,$s),$t.scale(1,-1),$t.drawImage($G.canvas.source,0,0),$t.restore(),$N}console.log("drawToCanvas error: w:"+$r+",h:"+$s+",datalen:"+$T.byteLength)},$d.createFilterAction=function($V){var $U;switch($V){case 32:$U=new $IV}return $U},$d.addTextureToAtlas=function($V){$V._uvID++,$J._atlasRestore++,$V.bitmap.enableMerageInAtlas&&$J.instance.addToAtlas($V)},$d.getTexturePixels=function($V,$U,$r,$s,$p){$l.context.ctx.clear();var $c=new $H;$c.graphics.drawTexture($V,-$U,-$r);var $R=$xV.create($s,$p);$R.start(),$R.clear(0,0,0,0),$c.render($l.context,0,0),$l.context.ctx.flush(),$R.end();for(var $T=$R.getData(0,0,$s,$p),$N=[],$t=0,$b=$p-1;0<=$b;$b--)for(var $S=0;$S<$s;$S++)$t=4*($b*$s+$S),$N.push($T[$t]),$N.push($T[$t+1]),$N.push($T[$t+2]),$N.push($T[$t+3]);return $N},$d.skinAniSprite=function(){return new $VV},$t.create=function($V,$U){var $r=new $MV;return $r._imgData=$U,$r.flipY=!1,$r},$D._filterStart=function($V,$U,$r,$s,$p){var $c=$V.getValue("bounds"),$R=$xV.create($c.width,$c.height);if($R.start(),$R.clear(0,0,0,0),$V.addValue("src",$R),$V.addValue("ScissorTest",$WV.worldScissorTest),$WV.worldScissorTest){var $T=new $Q;$T.copyFrom($r.ctx._clipRect),$V.addValue("clipRect",$T),$WV.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$D._filterEnd=function($V,$U,$r,$s,$p){var $c=$V.getValue("bounds");$V.getValue("src").end();var $R=$xV.create($c.width,$c.height);$R.start(),$R.clear(0,0,0,0),$V.addValue("out",$R),$U._set$P("_filterCache",$R),$U._set$P("_isHaveGlowFilter",$V.getValue("_isHaveGlowFilter"))},$D._EndTarget=function($V,$U){if($V.getValue("src").recycle(),$V.getValue("out").end(),$V.getValue("ScissorTest")){$WV.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$U.ctx.save();var $r=$V.getValue("clipRect");$U.ctx.clipRect($r.x,$r.y,$r.width,$r.height)}},$D._useSrc=function($V){var $U=$V.getValue("out");$U.end(),($U=$V.getValue("src")).start(),$U.clear(0,0,0,0)},$D._endSrc=function($V){$V.getValue("src").end()},$D._useOut=function($V){var $U=$V.getValue("src");$U.end(),($U=$V.getValue("out")).start(),$U.clear(0,0,0,0)},$D._endOut=function($V){$V.getValue("out").end()},$D._recycleScope=function($V){$V.recycle()},$D._filter=function($V,$U,$r,$s){var $p=this._next;if($p){var $c,$R,$T=$V.filters,$N=$T.length;if(1==$N&&32==$T[0].type)return $U.ctx.save(),$U.ctx.setFilters([$T[0]]),$p._fun.call($p,$V,$U,$r,$s),void $U.ctx.restore();var $t=$TV.create(),$b=$I.TEMP,$S=$U.ctx._getTransformMatrix(),$_=$n.create();$S.copyTo($_);var $G=0,$q=0,$u=!1,$h=$V._$P._filterCache?$V._$P._filterCache:null;if(!$h||$V._repaint){$u=$V._isHaveGlowFilter(),$t.addValue("_isHaveGlowFilter",$u),$u&&($G=50,$q=25),($R=new $Q).copyFrom($V.getSelfBounds()),$R.x+=$V.x,$R.y+=$V.y,$R.x-=$V.pivotX+4,$R.y-=$V.pivotY+4;var $l=$R.x,$W=$R.y;if($R.width+=$G+8,$R.height+=$G+8,$b.x=$R.x*$_.a+$R.y*$_.c,$b.y=$R.y*$_.d+$R.x*$_.b,$R.x=$b.x,$R.y=$b.y,$b.x=$R.width*$_.a+$R.height*$_.c,$b.y=$R.height*$_.d+$R.width*$_.b,$R.width=$b.x,$R.height=$b.y,$R.width<=0||$R.height<=0)return;$h&&$h.recycle(),$t.addValue("bounds",$R);var $O=$RV.create([$t,$V,$U,0,0],$D._filterStart);$U.addRenderObject($O),$U.ctx._renderKey=0,$U.ctx._shader2D.glTexture=null;var $L=$V.x-$l+$q,$d=$V.y-$W+$q;$p._fun.call($p,$V,$U,$L,$d),$O=$RV.create([$t,$V,$U,0,0],$D._filterEnd),$U.addRenderObject($O);for(var $k=0;$k<$N;$k++){0!=$k&&($O=$RV.create([$t],$D._useSrc),$U.addRenderObject($O),$c=$DV.create(1,0),$n.TEMP.identity(),$U.ctx.drawTarget($t,0,0,$R.width,$R.height,$n.TEMP,"out",$c,null,$B.TOINT.overlay),$O=$RV.create([$t],$D._useOut),$U.addRenderObject($O)),$T[$k].action.apply3d($t,$V,$U,0,0)}$O=$RV.create([$t,$U],$D._EndTarget),$U.addRenderObject($O)}else{if(($u=!!$V._$P._isHaveGlowFilter&&$V._$P._isHaveGlowFilter)&&($G=50,$q=25),($R=$V.getBounds()).width<=0||$R.height<=0)return;$R.width+=$G,$R.height+=$G,$b.x=$R.x*$_.a+$R.y*$_.c,$b.y=$R.y*$_.d+$R.x*$_.b,$R.x=$b.x,$R.y=$b.y,$b.x=$R.width*$_.a+$R.height*$_.c,$b.y=$R.height*$_.d+$R.width*$_.b,$R.width=$b.x,$R.height=$b.y,$t.addValue("out",$h)}$r=$r-$q-$V.x,$s=$s-$q-$V.y,$b.setTo($r,$s),$_.transformPoint($b),$r=$b.x+$R.x,$s=$b.y+$R.y,$c=$DV.create(1,0),$n.TEMP.identity(),$U.ctx.drawTarget($t,$r,$s,$R.width,$R.height,$n.TEMP,"out",$c,null,$B.TOINT.overlay),$O=$RV.create([$t],$D._recycleScope),$U.addRenderObject($O),$_.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$R._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$R._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$R._uint8ArraySlice),!0},$R.onStageResize=function($V,$U){null!=$R.mainContext&&($R.mainContext.viewport(0,0,$V,$U),$WV.width=$V,$WV.height=$U)},$R.onInvalidGLRes=function(){$J.instance.freeAll(),$L.releaseContentManagers(!0),$R.doNodeRepaint($k.stage),$R.mainContext.viewport(0,0,$WV.width,$WV.height),$k.stage.event("devicelost")},$R.doNodeRepaint=function($V){0==$V.numChildren&&$V.repaint();for(var $U=0;$U<$V.numChildren;$U++)$R.doNodeRepaint($V.getChildAt($U))},$R.init=function($V,$U,$r){$R.mainCanvas=$V,$t._createContext=function($V){return new $yV($V)},$MV._createContext=function($V){return new $yV($V)};var $s=laya.webgl.WebGL.mainContext;if(null!=$s.getShaderPrecisionFormat){var $p=$s.getShaderPrecisionFormat(35633,36338),$c=$s.getShaderPrecisionFormat(35632,36338);$R.shaderHighPrecision=!(!$p.precision||!$c.precision)}else $R.shaderHighPrecision=!1;if($R.compressAstc=$s.getExtension("WEBGL_compressed_texture_astc"),$R.compressAtc=$s.getExtension("WEBGL_compressed_texture_atc"),$R.compressEtc=$s.getExtension("WEBGL_compressed_texture_etc"),$R.compressEtc1=$s.getExtension("WEBGL_compressed_texture_etc1"),$R.compressPvrtc=$s.getExtension("WEBGL_compressed_texture_pvrtc"),$R.compressS3tc=$s.getExtension("WEBGL_compressed_texture_s3tc"),$R.compressS3tc_srgb=$s.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$R.compressAstc=$R.compressAstc?$R.compressAstc:{},$R.compressAtc=$R.compressAtc?$R.compressAtc:{},$R.compressEtc=$R.compressEtc?$R.compressEtc:{},$R.compressEtc1=$R.compressEtc1?$R.compressEtc1:{},$R.compressPvrtc=$R.compressPvrtc?$R.compressPvrtc:{},$R.compressS3tc=$R.compressS3tc?$R.compressS3tc:{},$R.compressS3tc_srgb=$R.compressS3tc_srgb?$R.compressS3tc_srgb:{},$s.deleteTexture1=$s.deleteTexture,$s.deleteTexture=function($V){$V==$dV.curBindTexValue&&($dV.curBindTexValue=null),$s.deleteTexture1($V)},$R.onStageResize($U,$r),null==$R.mainContext)throw new Error("webGL getContext err!");$K.__init__(),$J.__init__(),$HV.__init__(),$cV.__init__(),$yV.__init__(),$DV.__init__(),$C.__init__(),$gV.__int__($s),$B._init_($s),$l.isConchApp&&conch.setOnInvalidGLRes($R.onInvalidGLRes)},$R.mainCanvas=null,$R.antialias=!0,$R.shaderHighPrecision=!1,$R._bg_null=[0,0,0,0],$R}(),$dV=function(){function $s(){}return $_($s,"laya.webgl.WebGLContext"),$s.UseProgram=function($V){return $s._useProgram!==$V&&($LV.mainContext.useProgram($V),$s._useProgram=$V,!0)},$s.setDepthTest=function($V,$U){$U!==$s._depthTest&&(($s._depthTest=$U)?$V.enable(2929):$V.disable(2929))},$s.setDepthMask=function($V,$U){$U!==$s._depthMask&&($s._depthMask=$U,$V.depthMask($U))},$s.setDepthFunc=function($V,$U){$U!==$s._depthFunc&&($s._depthFunc=$U,$V.depthFunc($U))},$s.setBlend=function($V,$U){$U!==$s._blend&&(($s._blend=$U)?$V.enable(3042):$V.disable(3042))},$s.setBlendFunc=function($V,$U,$r){($U!==$s._sFactor||$r!==$s._dFactor)&&($s._sFactor=$U,$s._dFactor=$r,$V.blendFunc($U,$r))},$s.setCullFace=function($V,$U){$U!==$s._cullFace&&(($s._cullFace=$U)?$V.enable(2884):$V.disable(2884))},$s.setFrontFace=function($V,$U){$U!==$s._frontFace&&($s._frontFace=$U,$V.frontFace($U))},$s.bindTexture=function($V,$U,$r){$V.bindTexture($U,$r),$s.curBindTexTarget=$U,$s.curBindTexValue=$r},$s.DEPTH_BUFFER_BIT=256,$s.STENCIL_BUFFER_BIT=1024,$s.COLOR_BUFFER_BIT=16384,$s.POINTS=0,$s.LINES=1,$s.LINE_LOOP=2,$s.LINE_STRIP=3,$s.TRIANGLES=4,$s.TRIANGLE_STRIP=5,$s.TRIANGLE_FAN=6,$s.ZERO=0,$s.ONE=1,$s.SRC_COLOR=768,$s.ONE_MINUS_SRC_COLOR=769,$s.SRC_ALPHA=770,$s.ONE_MINUS_SRC_ALPHA=771,$s.DST_ALPHA=772,$s.ONE_MINUS_DST_ALPHA=773,$s.DST_COLOR=774,$s.ONE_MINUS_DST_COLOR=775,$s.SRC_ALPHA_SATURATE=776,$s.FUNC_ADD=32774,$s.BLEND_EQUATION=32777,$s.BLEND_EQUATION_RGB=32777,$s.BLEND_EQUATION_ALPHA=34877,$s.FUNC_SUBTRACT=32778,$s.FUNC_REVERSE_SUBTRACT=32779,$s.BLEND_DST_RGB=32968,$s.BLEND_SRC_RGB=32969,$s.BLEND_DST_ALPHA=32970,$s.BLEND_SRC_ALPHA=32971,$s.CONSTANT_COLOR=32769,$s.ONE_MINUS_CONSTANT_COLOR=32770,$s.CONSTANT_ALPHA=32771,$s.ONE_MINUS_CONSTANT_ALPHA=32772,$s.BLEND_COLOR=32773,$s.ARRAY_BUFFER=34962,$s.ELEMENT_ARRAY_BUFFER=34963,$s.ARRAY_BUFFER_BINDING=34964,$s.ELEMENT_ARRAY_BUFFER_BINDING=34965,$s.STREAM_DRAW=35040,$s.STATIC_DRAW=35044,$s.DYNAMIC_DRAW=35048,$s.BUFFER_SIZE=34660,$s.BUFFER_USAGE=34661,$s.CURRENT_VERTEX_ATTRIB=34342,$s.FRONT=1028,$s.BACK=1029,$s.CULL_FACE=2884,$s.FRONT_AND_BACK=1032,$s.BLEND=3042,$s.DITHER=3024,$s.STENCIL_TEST=2960,$s.DEPTH_TEST=2929,$s.SCISSOR_TEST=3089,$s.POLYGON_OFFSET_FILL=32823,$s.SAMPLE_ALPHA_TO_COVERAGE=32926,$s.SAMPLE_COVERAGE=32928,$s.NO_ERROR=0,$s.INVALID_ENUM=1280,$s.INVALID_VALUE=1281,$s.INVALID_OPERATION=1282,$s.OUT_OF_MEMORY=1285,$s.CW=2304,$s.CCW=2305,$s.LINE_WIDTH=2849,$s.ALIASED_POINT_SIZE_RANGE=33901,$s.ALIASED_LINE_WIDTH_RANGE=33902,$s.CULL_FACE_MODE=2885,$s.FRONT_FACE=2886,$s.DEPTH_RANGE=2928,$s.DEPTH_WRITEMASK=2930,$s.DEPTH_CLEAR_VALUE=2931,$s.DEPTH_FUNC=2932,$s.STENCIL_CLEAR_VALUE=2961,$s.STENCIL_FUNC=2962,$s.STENCIL_FAIL=2964,$s.STENCIL_PASS_DEPTH_FAIL=2965,$s.STENCIL_PASS_DEPTH_PASS=2966,$s.STENCIL_REF=2967,$s.STENCIL_VALUE_MASK=2963,$s.STENCIL_WRITEMASK=2968,$s.STENCIL_BACK_FUNC=34816,$s.STENCIL_BACK_FAIL=34817,$s.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$s.STENCIL_BACK_PASS_DEPTH_PASS=34819,$s.STENCIL_BACK_REF=36003,$s.STENCIL_BACK_VALUE_MASK=36004,$s.STENCIL_BACK_WRITEMASK=36005,$s.VIEWPORT=2978,$s.SCISSOR_BOX=3088,$s.COLOR_CLEAR_VALUE=3106,$s.COLOR_WRITEMASK=3107,$s.UNPACK_ALIGNMENT=3317,$s.PACK_ALIGNMENT=3333,$s.MAX_TEXTURE_SIZE=3379,$s.MAX_VIEWPORT_DIMS=3386,$s.SUBPIXEL_BITS=3408,$s.RED_BITS=3410,$s.GREEN_BITS=3411,$s.BLUE_BITS=3412,$s.ALPHA_BITS=3413,$s.DEPTH_BITS=3414,$s.STENCIL_BITS=3415,$s.POLYGON_OFFSET_UNITS=10752,$s.POLYGON_OFFSET_FACTOR=32824,$s.TEXTURE_BINDING_2D=32873,$s.SAMPLE_BUFFERS=32936,$s.SAMPLES=32937,$s.SAMPLE_COVERAGE_VALUE=32938,$s.SAMPLE_COVERAGE_INVERT=32939,$s.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$s.COMPRESSED_TEXTURE_FORMATS=34467,$s.DONT_CARE=4352,$s.FASTEST=4353,$s.NICEST=4354,$s.GENERATE_MIPMAP_HINT=33170,$s.BYTE=5120,$s.UNSIGNED_BYTE=5121,$s.SHORT=5122,$s.UNSIGNED_SHORT=5123,$s.INT=5124,$s.UNSIGNED_INT=5125,$s.FLOAT=5126,$s.DEPTH_COMPONENT=6402,$s.ALPHA=6406,$s.RGB=6407,$s.RGBA=6408,$s.LUMINANCE=6409,$s.LUMINANCE_ALPHA=6410,$s.UNSIGNED_SHORT_4_4_4_4=32819,$s.UNSIGNED_SHORT_5_5_5_1=32820,$s.UNSIGNED_SHORT_5_6_5=33635,$s.FRAGMENT_SHADER=35632,$s.VERTEX_SHADER=35633,$s.MAX_VERTEX_ATTRIBS=34921,$s.MAX_VERTEX_UNIFORM_VECTORS=36347,$s.MAX_VARYING_VECTORS=36348,$s.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$s.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$s.MAX_TEXTURE_IMAGE_UNITS=34930,$s.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$s.SHADER_TYPE=35663,$s.DELETE_STATUS=35712,$s.LINK_STATUS=35714,$s.VALIDATE_STATUS=35715,$s.ATTACHED_SHADERS=35717,$s.ACTIVE_UNIFORMS=35718,$s.ACTIVE_ATTRIBUTES=35721,$s.SHADING_LANGUAGE_VERSION=35724,$s.CURRENT_PROGRAM=35725,$s.NEVER=512,$s.LESS=513,$s.EQUAL=514,$s.LEQUAL=515,$s.GREATER=516,$s.NOTEQUAL=517,$s.GEQUAL=518,$s.ALWAYS=519,$s.KEEP=7680,$s.REPLACE=7681,$s.INCR=7682,$s.DECR=7683,$s.INVERT=5386,$s.INCR_WRAP=34055,$s.DECR_WRAP=34056,$s.VENDOR=7936,$s.RENDERER=7937,$s.VERSION=7938,$s.NEAREST=9728,$s.LINEAR=9729,$s.NEAREST_MIPMAP_NEAREST=9984,$s.LINEAR_MIPMAP_NEAREST=9985,$s.NEAREST_MIPMAP_LINEAR=9986,$s.LINEAR_MIPMAP_LINEAR=9987,$s.TEXTURE_MAG_FILTER=10240,$s.TEXTURE_MIN_FILTER=10241,$s.TEXTURE_WRAP_S=10242,$s.TEXTURE_WRAP_T=10243,$s.TEXTURE_2D=3553,$s.TEXTURE=5890,$s.TEXTURE_CUBE_MAP=34067,$s.TEXTURE_BINDING_CUBE_MAP=34068,$s.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$s.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$s.TEXTURE0=33984,$s.TEXTURE1=33985,$s.TEXTURE2=33986,$s.TEXTURE3=33987,$s.TEXTURE4=33988,$s.TEXTURE5=33989,$s.TEXTURE6=33990,$s.TEXTURE7=33991,$s.TEXTURE8=33992,$s.TEXTURE9=33993,$s.TEXTURE10=33994,$s.TEXTURE11=33995,$s.TEXTURE12=33996,$s.TEXTURE13=33997,$s.TEXTURE14=33998,$s.TEXTURE15=33999,$s.TEXTURE16=34e3,$s.TEXTURE17=34001,$s.TEXTURE18=34002,$s.TEXTURE19=34003,$s.TEXTURE20=34004,$s.TEXTURE21=34005,$s.TEXTURE22=34006,$s.TEXTURE23=34007,$s.TEXTURE24=34008,$s.TEXTURE25=34009,$s.TEXTURE26=34010,$s.TEXTURE27=34011,$s.TEXTURE28=34012,$s.TEXTURE29=34013,$s.TEXTURE30=34014,$s.TEXTURE31=34015,$s.ACTIVE_TEXTURE=34016,$s.REPEAT=10497,$s.CLAMP_TO_EDGE=33071,$s.MIRRORED_REPEAT=33648,$s.FLOAT_VEC2=35664,$s.FLOAT_VEC3=35665,$s.FLOAT_VEC4=35666,$s.INT_VEC2=35667,$s.INT_VEC3=35668,$s.INT_VEC4=35669,$s.BOOL=35670,$s.BOOL_VEC2=35671,$s.BOOL_VEC3=35672,$s.BOOL_VEC4=35673,$s.FLOAT_MAT2=35674,$s.FLOAT_MAT3=35675,$s.FLOAT_MAT4=35676,$s.SAMPLER_2D=35678,$s.SAMPLER_CUBE=35680,$s.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$s.VERTEX_ATTRIB_ARRAY_SIZE=34339,$s.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$s.VERTEX_ATTRIB_ARRAY_TYPE=34341,$s.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$s.VERTEX_ATTRIB_ARRAY_POINTER=34373,$s.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$s.COMPILE_STATUS=35713,$s.LOW_FLOAT=36336,$s.MEDIUM_FLOAT=36337,$s.HIGH_FLOAT=36338,$s.LOW_INT=36339,$s.MEDIUM_INT=36340,$s.HIGH_INT=36341,$s.FRAMEBUFFER=36160,$s.RENDERBUFFER=36161,$s.RGBA4=32854,$s.RGB5_A1=32855,$s.RGB565=36194,$s.DEPTH_COMPONENT16=33189,$s.STENCIL_INDEX=6401,$s.STENCIL_INDEX8=36168,$s.DEPTH_STENCIL=34041,$s.RENDERBUFFER_WIDTH=36162,$s.RENDERBUFFER_HEIGHT=36163,$s.RENDERBUFFER_INTERNAL_FORMAT=36164,$s.RENDERBUFFER_RED_SIZE=36176,$s.RENDERBUFFER_GREEN_SIZE=36177,$s.RENDERBUFFER_BLUE_SIZE=36178,$s.RENDERBUFFER_ALPHA_SIZE=36179,$s.RENDERBUFFER_DEPTH_SIZE=36180,$s.RENDERBUFFER_STENCIL_SIZE=36181,$s.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$s.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$s.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$s.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$s.COLOR_ATTACHMENT0=36064,$s.DEPTH_ATTACHMENT=36096,$s.STENCIL_ATTACHMENT=36128,$s.DEPTH_STENCIL_ATTACHMENT=33306,$s.NONE=0,$s.FRAMEBUFFER_COMPLETE=36053,$s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$s.FRAMEBUFFER_UNSUPPORTED=36061,$s.FRAMEBUFFER_BINDING=36006,$s.RENDERBUFFER_BINDING=36007,$s.MAX_RENDERBUFFER_SIZE=34024,$s.INVALID_FRAMEBUFFER_OPERATION=1286,$s.UNPACK_FLIP_Y_WEBGL=37440,$s.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$s.CONTEXT_LOST_WEBGL=37442,$s.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$s.BROWSER_DEFAULT_WEBGL=37444,$s._useProgram=null,$s._depthTest=!0,$s._depthMask=!0,$s._blend=!1,$s._cullFace=!1,$s.curBindTexTarget=null,$s.curBindTexValue=null,$R($s,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$s}(),$kV=function($V){function $U(){$U.__super.call(this)}$_($U,"laya.webgl.display.GraphicsGL",$T);var $r=$U.prototype;return $r.setShader=function($V){this._saveToCmd($l.context._setShader,[$V])},$r.setIBVB=function($V,$U,$r,$s,$p,$c){this._saveToCmd($l.context._setIBVB,[$V,$U,$r,$s,$p,$c])},$r.drawParticle=function($V,$U,$r){var $s=$d.createParticleTemplate2D($r);$s.x=$V,$s.y=$U,this._saveToCmd($l.context._drawParticle,[$s])},$U}(),$yV=function($V){var $r;function $o($V){this._x=0,this._y=0,this._id=++$o._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$o.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$o.MAXCLIPRECT,this.mOutPoint,this._canvas=$V,this._canvas._addReference(),$o._contextcount++,$l.isFlash?(this._ib=$CV.create(35044),$hV.fillIBQuadrangle(this._ib,16)):this._ib=$CV.QuadrangleIB,this.clear()}$_($o,"laya.webgl.canvas.WebGLContext2D",$p);var $U=$o.prototype;return $U.setIsMainContext=function(){this._isMain=!0},$U.clearBG=function($V,$U,$r,$s){var $p=$LV.mainContext;$p.clearColor($V,$U,$r,$s),$p.clear(16384)},$U._getSubmits=function(){return this._submits},$U._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $V=0,$U=this._submits._length;$V<$U;$V++)this._submits[$V].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$U.destroy=function(){--$o._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$CV.QuadrangleIB&&this._ib.releaseResource()},$U.clear=function(){this._submits||(this._other=$r.DEFAULT,this._curMat=$n.create(),this._vb=$fV.create(-1),this._submits=[],this._save=[$F.Create(this)],this._save.length=10,this._shader2D=new $C,this._triangleMesh=$aV.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$r.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$o.MAXCLIPRECT,this._curSubmit=$cV.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$P.DEFAULT;for(var $V=0,$U=this._submits._length;$V<$U;$V++)this._submits[$V].releaseRender(),this._submits[$V]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$U.size=function($V,$U){if(this._width!=$V||this._height!=$U)if(0==$V||0==$U){0!=this._vb._byteLength&&(this._width=$V,this._height=$U,this._vb.clear(),this._vb.upload());for(var $r=0,$s=this._submits._length;$r<$s;$r++)this._submits[$r].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$V,this._height=$U,this._targets&&this._targets.size($V,$U),this._canvas.memorySize-=this._canvas.memorySize;0===$V&&0===$U&&this._releaseMem()},$U._getTransformMatrix=function(){return this._curMat},$U.translate=function($V,$U){0===$V&&0===$U||($v.save(this),this._curMat.bTransform&&($g.save(this),this._curMat.transformPointN($I.TEMP.setTo($V,$U)),$V=$I.TEMP.x,$U=$I.TEMP.y),this._x+=$V,this._y+=$U)},$U.save=function(){this._save[this._save._length++]=$F.Create(this)},$U.restore=function(){var $V=this._save._length;if(!($V<1))for(var $U=$V-1;0<=$U;$U--){var $r=this._save[$U];if($r.restore(this),$r.isSaveMark())return void(this._save._length=$U)}},$U._fillText=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){void 0===$t&&($t=0);var $b=this._shader2D,$S=this._curSubmit.shaderValue,$_=$p?$qV.create($p):this._other.font;if($J.enabled)$b.ALPHA!==$S.ALPHA&&($b.glTexture=null),$GV.drawText(this,$V,$U,this._curMat,$_,$N||this._other.textAlign,$c,$R,$T,$r,$s,$t);else{this._shader2D.defines.getValue();var $G=$c?$q.create($c)._color:$b.colorAdd;$b.ALPHA===$S.ALPHA&&$G===$b.colorAdd&&$S.colorAdd===$b.colorAdd||($b.glTexture=null,$b.colorAdd=$G),$GV.drawText(this,$V,$U,this._curMat,$_,$N||this._other.textAlign,$c,$R,$T,$r,$s,$t)}},$U.fillWords=function($V,$U,$r,$s,$p,$c){this._fillText(null,$V,$U,$r,$s,$p,null,-1,null,$c)},$U.fillBorderWords=function($V,$U,$r,$s,$p,$c,$R){this._fillBorderText(null,$V,$U,$r,$s,$p,$c,$R,null)},$U.fillText=function($V,$U,$r,$s,$p,$c){this._fillText($V,null,$U,$r,$s,$p,null,-1,$c)},$U.strokeText=function($V,$U,$r,$s,$p,$c,$R){this._fillText($V,null,$U,$r,$s,null,$p,$c||1,$R)},$U.fillBorderText=function($V,$U,$r,$s,$p,$c,$R,$T){this._fillBorderText($V,null,$U,$r,$s,$p,$c,$R,$T)},$U._fillBorderText=function($V,$U,$r,$s,$p,$c,$R,$T,$N){if(!$J.enabled)return this._fillText($V,$U,$r,$s,$p,null,$R,$T||1,$N),void this._fillText($V,$U,$r,$s,$p,$c,null,-1,$N);var $t=this._shader2D,$b=this._curSubmit.shaderValue;$t.ALPHA!==$b.ALPHA&&($t.glTexture=null);var $S=$p?($o._fontTemp.setFont($p),$o._fontTemp):this._other.font;$GV.drawText(this,$V,$U,this._curMat,$S,$N||this._other.textAlign,$c,$R,$T||1,$r,$s,0)},$U.fillRect=function($V,$U,$r,$s,$p){var $c=this._vb;if($hV.fillRectImgVb($c,this._clipRect,$V,$U,$r,$s,$a.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $R=this._shader2D.fillStyle;$p&&(this._shader2D.fillStyle=$P.create($p));var $T=this._shader2D,$N=this._curSubmit.shaderValue;if($T.fillStyle!==$N.fillStyle||$T.ALPHA!==$N.ALPHA){$T.glTexture=null;var $t=this._curSubmit=$cV.createSubmit(this,this._ib,$c,($c._byteLength-64)/32*3,$DV.create(2,0));$t.shaderValue.color=$T.fillStyle._color._color,$t.shaderValue.ALPHA=$T.ALPHA,this._submits[this._submits._length++]=$t}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$R}},$U.fillTexture=function($V,$U,$r,$s,$p,$c,$R,$T){if($V.loaded&&$V.bitmap&&$V.source){var $N=this._vb,$t=$V.bitmap.width,$b=$V.bitmap.height,$S=$V.uv,$_=$R.x%$V.width,$G=$R.y%$V.height;if($t!=$T.w||$b!=$T.h){if(!$T.w&&!$T.h)switch($T.oy=$T.ox=0,$c){case"repeat":$T.width=$s,$T.height=$p;break;case"repeat-x":$T.width=$s,$G<0?$V.height+$G>$p?$T.height=$p:$T.height=$V.height+$G:($T.oy=$G,$V.height+$G>$p?$T.height=$p-$G:$T.height=$V.height);break;case"repeat-y":$_<0?$V.width+$_>$s?$T.width=$s:$T.width=$V.width+$_:($T.ox=$_,$V.width+$_>$s?$T.width=$s-$_:$T.width=$V.width),$T.height=$p;break;case"no-repeat":$_<0?$V.width+$_>$s?$T.width=$s:$T.width=$V.width+$_:($T.ox=$_,$V.width+$_>$s?$T.width=$s-$_:$T.width=$V.width),$G<0?$V.height+$G>$p?$T.height=$p:$T.height=$V.height+$G:($T.oy=$G,$V.height+$G>$p?$T.height=$p-$G:$T.height=$V.height);break;default:$T.width=$s,$T.height=$p}$T.w=$t,$T.h=$b,$T.uv=[0,0,$T.width/$t,0,$T.width/$t,$T.height/$b,0,$T.height/$b]}if($U+=$T.ox,$r+=$T.oy,$_-=$T.ox,$G-=$T.oy,$hV.fillRectImgVb($N,this._clipRect,$U,$r,$T.width,$T.height,$T.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $q=$mV.create(this,this._ib,$N,($N._byteLength-64)/32*3,$DV.create(256,0)),$u=(this._submits[this._submits._length++]=$q).shaderValue;$u.textureHost=$V;var $h=$S[0]*$t,$l=$S[1]*$b,$W=($S[2]-$S[0])*$t,$O=($S[5]-$S[3])*$b,$L=-$_/$t,$d=-$G/$b;$u.u_TexRange[0]=$h/$t,$u.u_TexRange[1]=$W/$t,$u.u_TexRange[2]=$l/$b,$u.u_TexRange[3]=$O/$b,$u.u_offset[0]=$L,$u.u_offset[1]=$d,$J.enabled&&!this._isMain&&$q.addTexture($V,($N._byteLength>>2)-16),(this._curSubmit=$q)._renderType=10017,$q._numEle+=6}}else this.sprite&&$k.timer.callLater(this,this._repaintSprite)},$U.setShader=function($V){$A.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$V},$U.setFilters=function($V){$A.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$V,this._curSubmit=$cV.RENDERBASE,this._renderKey=0,this._drawCount++},$U.drawTexture=function($V,$U,$r,$s,$p,$c,$R){this._drawTextureM($V,$U,$r,$s,$p,$c,$R,null,1)},$U.addTextureVb=function($V,$U,$r){var $s=this._curSubmit._vb||this._vb,$p=$s._byteLength>>2;$s.byteLength=$p+16<<2;for(var $c=$s.getFloat32Array(),$R=0;$R<16;$R+=4)$c[$p++]=$V[$R]+$U,$c[$p++]=$V[$R+1]+$r,$c[$p++]=$V[$R+2],$c[$p++]=$V[$R+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$s._upload=!0},$U.willDrawTexture=function($V,$U){if(!($V.loaded&&$V.bitmap&&$V.source))return this.sprite&&$k.timer.callLater(this,this._repaintSprite),0;var $r=$V.bitmap,$s=$r.id+this._shader2D.ALPHA*$U+10016;if($s==this._renderKey)return $s;var $p=this._shader2D,$c=$p.ALPHA,$R=this._curSubmit.shaderValue;$p.ALPHA*=$U,this._renderKey=$s,this._drawCount++,$p.glTexture=$r;var $T=this._vb,$N=null,$t=$T._byteLength/32*3,$b=$R.textureHost&&$R.textureHost==$V&&$R.textureHost.alphaTexture==$V.alphaTexture;return $N=$mV.create(this,this._ib,$T,$t,$DV.create(1,0)),(this._submits[this._submits._length++]=$N).shaderValue.textureHost=$V,$N._renderType=10016,$N._preIsSameTextureShader=10016===this._curSubmit._renderType&&$p.ALPHA===$R.ALPHA&&$b,this._curSubmit=$N,$p.ALPHA=$c,$s},$U.drawTextures=function($V,$U,$r,$s){if($V.loaded&&$V.bitmap&&$V.source){var $p=this._clipRect;if(this._clipRect=$o.MAXCLIPRECT,this._drawTextureM($V,$U[0],$U[1],$V.width,$V.height,$r,$s,null,1)){if(this._clipRect=$p,$z.drawCall++,!($U.length<4)){for(var $c=this._curSubmit._vb||this._vb,$R=this._curMat.a,$T=this._curMat.d,$N=2,$t=$U.length;$N<$t;$N+=2)$hV.copyPreImgVb($c,($U[$N]-$U[$N-2])*$R,($U[$N+1]-$U[$N-1])*$T),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$k.timer.callLater(this,this._repaintSprite)},$U._drawTextureM=function($V,$U,$r,$s,$p,$c,$R,$T,$N){if(!$V.loaded||!$V.source)return this.sprite&&$k.timer.callLater(this,this._repaintSprite),!1;var $t=this._curSubmit._vb||this._vb,$b=$V.bitmap;$U+=$c,$r+=$R,this._drawCount++;var $S=$b.id+this._shader2D.ALPHA*$N+10016;if($S!=this._renderKey){this._renderKey=$S;var $_=this._curSubmit.shaderValue,$G=this._shader2D,$q=$G.ALPHA;$G.ALPHA*=$N,$G.glTexture=$b;var $u=this._vb,$h=null,$l=$u._byteLength/32*3,$W=$_.textureHost&&$_.textureHost==$V&&$_.textureHost.alphaTexture==$V.alphaTexture;$h=$mV.create(this,this._ib,$u,$l,$DV.create(1,0)),(this._submits[this._submits._length++]=$h).shaderValue.textureHost=$V,$h._renderType=10016,$h._preIsSameTextureShader=10016===this._curSubmit._renderType&&$G.ALPHA===$_.ALPHA&&$W,this._curSubmit=$h,$t=this._curSubmit._vb||this._vb,$G.ALPHA=$q}return!!$hV.fillRectImgVb($t,this._clipRect,$U,$r,$s||$V.width,$p||$V.height,$V.uv,$T||this._curMat,this._x,this._y,0,0)&&($J.enabled&&!this._isMain&&this._curSubmit.addTexture($V,($t._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$U._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$U._drawText=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){var $b=$V.bitmap;this._drawCount++;var $S=$b.id+this._shader2D.ALPHA+10016;if($S!=this._renderKey){this._renderKey=$S;var $_=this._curSubmit.shaderValue,$G=this._shader2D;$G.glTexture=$b;var $q=this._vb,$u=null,$h=$q._byteLength/32*3,$l=$_.textureHost&&$_.textureHost==$V&&$_.textureHost.alphaTexture==$V.alphaTexture;($u=$J.enabled?$mV.create(this,this._ib,$q,$h,$DV.create(1,0)):$mV.create(this,this._ib,$q,$h,$vV.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$G.ALPHA===$_.ALPHA&&$l,(this._submits[this._submits._length++]=$u).shaderValue.textureHost=$V,$u._renderType=10016,this._curSubmit=$u}$V.active();var $W=this._curSubmit._vb||this._vb;$hV.fillRectImgVb($W,this._clipRect,$U+$R,$r+$T,$s||$V.width,$p||$V.height,$V.uv,$c||this._curMat,this._x,this._y,$N,$t,!0)&&($J.enabled&&!this._isMain&&this._curSubmit.addTexture($V,($W._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$U.drawTextureWithTransform=function($V,$U,$r,$s,$p,$c,$R,$T,$N){if($c){var $t=this._curMat,$b=this._x,$S=this._y;(0!==$R||0!==$T)&&(this._x=$R*$t.a+$T*$t.c,this._y=$T*$t.d+$R*$t.b),$c&&$t.bTransform?($n.mul($c,$t,$o._tmpMatrix),($c=$o._tmpMatrix)._checkTransform()):(this._x+=$t.tx,this._y+=$t.ty),this._drawTextureM($V,$U,$r,$s,$p,0,0,$c,$N),this._x=$b,this._y=$S}else this._drawTextureM($V,$U,$r,$s,$p,$R,$T,null,$N)},$U.fillQuadrangle=function($V,$U,$r,$s,$p){var $c=this._curSubmit,$R=this._vb,$T=this._shader2D,$N=$c.shaderValue;if(this._renderKey=0,$V.bitmap){var $t=$V.bitmap;$T.glTexture==$t&&$T.ALPHA===$N.ALPHA||($T.glTexture=$t,($c=this._curSubmit=$cV.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$DV.create(1,0))).shaderValue.glTexture=$t,this._submits[this._submits._length++]=$c),$hV.fillQuadrangleImgVb($R,$U,$r,$s,$V.uv,$p||this._curMat,this._x,this._y)}else $c.shaderValue.fillStyle&&$c.shaderValue.fillStyle.equal($V)&&$T.ALPHA===$N.ALPHA||($T.glTexture=null,($c=this._curSubmit=$cV.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$DV.create(2,0))).shaderValue.defines.add(2),$c.shaderValue.fillStyle=$P.create($V),this._submits[this._submits._length++]=$c),$hV.fillQuadrangleImgVb($R,$U,$r,$s,$a.DEF_UV,$p||this._curMat,this._x,this._y);$c._numEle+=6},$U.drawTexture2=function($V,$U,$r,$s,$p,$c,$R,$T){if(0!=$c){var $N=this._curMat;if(this._x=$V*$N.a+$U*$N.c,this._y=$U*$N.d+$V*$N.b,$p&&($p=$N.bTransform||$p.bTransform?($n.mul($p,$N,$o._tmpMatrix),$o._tmpMatrix):(this._x+=$p.tx+$N.tx,this._y+=$p.ty+$N.ty,$n.EMPTY)),1!==$c||$R){var $t=this._shader2D.ALPHA,$b=this._nBlendType;this._shader2D.ALPHA=$c,$R&&(this._nBlendType=$B.TOINT($R)),this._drawTextureM($T[0],$T[1]-$r,$T[2]-$s,$T[3],$T[4],0,0,$p,1),this._shader2D.ALPHA=$t,this._nBlendType=$b}else this._drawTextureM($T[0],$T[1]-$r,$T[2]-$s,$T[3],$T[4],0,0,$p,1);this._x=this._y=0}},$U.drawCanvas=function($V,$U,$r,$s,$p){var $c=$V.context;if(this._renderKey=0,$c._targets)this._submits[this._submits._length++]=$KV.create($c,0,null),this._curSubmit=$cV.RENDERBASE,$c._targets.drawTo(this,$U,$r,$s,$p);else{var $R=this._submits[this._submits._length++]=$KV.create($c,this._shader2D.ALPHA,this._shader2D.filters),$T=$s/$V.width,$N=$p/$V.height,$t=$R._matrix;this._curMat.copyTo($t),1!=$T&&1!=$N&&$t.scale($T,$N);var $b=$t.tx,$S=$t.ty;$t.tx=$t.ty=0,$t.transformPoint($I.TEMP.setTo($U,$r)),$t.translate($I.TEMP.x+$b,$I.TEMP.y+$S),this._curSubmit=$cV.RENDERBASE}$y.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$c._targets?"yellow":"green",this.strokeRect($U-1,$r-1,$s+2,$p+2,1),this.strokeRect($U,$r,$s,$p,1),this.restore())},$U.drawTarget=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){void 0===$t&&($t=-1);var $b=this._vb;if($hV.fillRectImgVb($b,this._clipRect,$U,$r,$s,$p,$N||$a.DEF_UV,$c||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $S=this._curSubmit=$SV.create(this,this._ib,$b,($b._byteLength-64)/32*3,$T,$R);$S.blendType=-1==$t?this._nBlendType:$t,$S.scope=$V,this._submits[this._submits._length++]=$S,this._curSubmit._numEle+=6}},$U.mixRGBandAlpha=function($V){return this._mixRGBandAlpha($V,this._shader2D.ALPHA)},$U._mixRGBandAlpha=function($V,$U){var $r=(4278190080&$V)>>>24;return 0!=$r?$r*=$U:$r=255*$U,16777215&$V|$r<<24},$U.drawTriangles=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){if(!$V.loaded||!$V.source)return this.sprite&&$k.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$V.bitmap;var $b=this._mixRGBandAlpha(4294967295,$T),$S=($s.length,$c.length);this._renderKey=-1;var $_=this._curSubmit=$mV.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$DV.create(1,0));return $_.shaderValue.textureHost=$V,$_._renderType=10016,this._submits[this._submits._length++]=$_,$R?($o._tmpMatrix.a=$R.a,$o._tmpMatrix.b=$R.b,$o._tmpMatrix.c=$R.c,$o._tmpMatrix.d=$R.d,$o._tmpMatrix.tx=$R.tx+$U,$o._tmpMatrix.ty=$R.ty+$r,$n.mul($o._tmpMatrix,this._curMat,$o._tmpMatrix)):($o._tmpMatrix.a=this._curMat.a,$o._tmpMatrix.b=this._curMat.b,$o._tmpMatrix.c=this._curMat.c,$o._tmpMatrix.d=this._curMat.d,$o._tmpMatrix.tx=this._curMat.tx+$U,$o._tmpMatrix.ty=this._curMat.ty+$r),this._triangleMesh.addData($s,$p,$c,$o._tmpMatrix,$b,this),this._curSubmit._numEle+=$S,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$U.transform=function($V,$U,$r,$s,$p,$c){$g.save(this),$n.mul($n.TEMP.setTo($V,$U,$r,$s,$p,$c),this._curMat,this._curMat),this._curMat._checkTransform()},$U.setTransformByMatrix=function($V){$V.copyTo(this._curMat)},$U.transformByMatrix=function($V){$g.save(this),$n.mul($V,this._curMat,this._curMat),this._curMat._checkTransform()},$U.rotate=function($V){$g.save(this),this._curMat.rotateEx($V)},$U.scale=function($V,$U){$g.save(this),this._curMat.scaleEx($V,$U)},$U.clipRect=function($V,$U,$r,$s){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $p=$bV.create(4);this.addRenderObject($p);var $c=this._vb,$R=$c._byteLength>>2;if($hV.fillRectImgVb($c,null,$V,$U,$r,$s,$a.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $T=this._curSubmit=$cV.createSubmit(this,this._ib,$c,($c._byteLength-64)/32*3,$DV.create(2,0));$T.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$T,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $N=$bV.create(5);this.addRenderObject($N);var $t=$c.getFloat32Array(),$b=Math.min(Math.min(Math.min($t[0+$R],$t[4+$R]),$t[8+$R]),$t[12+$R]),$S=Math.max(Math.max(Math.max($t[0+$R],$t[4+$R]),$t[8+$R]),$t[12+$R]),$_=Math.min(Math.min(Math.min($t[1+$R],$t[5+$R]),$t[9+$R]),$t[13+$R]),$G=Math.max(Math.max(Math.max($t[1+$R],$t[5+$R]),$t[9+$R]),$t[13+$R]);$e.save(this,$N,$V,$U,$r,$s,$b,$_,$S-$b,$G-$_),this._curSubmit=$cV.RENDERBASE}else{$r*=this._curMat.a,$s*=this._curMat.d;var $q=$I.TEMP;this._curMat.transformPoint($q.setTo($V,$U)),$r<0&&($q.x=$q.x+$r,$r=-$r),$s<0&&($q.y=$q.y+$s,$s=-$s),this._renderKey=0;var $u=this._curSubmit=$tV.create(this);(this._submits[this._submits._length++]=$u).submitIndex=this._submits._length,$u.submitLength=9999999,$X.save(this,$u);var $h=this._clipRect,$l=$h.x,$W=$h.y,$O=$q.x+$r,$L=$q.y+$s;$l<$q.x&&($h.x=$q.x),$W<$q.y&&($h.y=$q.y),$h.width=Math.min($O,$l+$h.width)-$h.x,$h.height=Math.min($L,$W+$h.height)-$h.y,this._shader2D.glTexture=null,$u.clipRect.copyFrom($h),this._curSubmit=$cV.RENDERBASE}},$U.setIBVB=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b){if(void 0===$N&&($N=0),void 0===$t&&($t=0),void 0===$b&&($b=0),null===$r){if($l.isFlash){var $S=$s;$S._selfIB||($S._selfIB=$CV.create(35044)),$S._selfIB.clear(),$r=$S._selfIB}else $r=this._ib;$hV.expandIBQuadrangle($r,$s._byteLength/(4*$s.vertexStride*4))}if(!$T||!$R)throw Error("setIBVB must input:shader shaderValues");var $_=$NV.create(this,$s,$r,$p,$R,$T,$N,$t,$b);$c||($c=$n.EMPTY),$c.translate($V,$U),$n.mul($c,this._curMat,$_._mat),$c.translate(-$V,-$U),this._submits[this._submits._length++]=$_,this._curSubmit=$cV.RENDERBASE,this._renderKey=0},$U.addRenderObject=function($V){this._submits[this._submits._length++]=$V},$U.fillTrangles=function($V,$U,$r,$s,$p){var $c=this._curSubmit,$R=this._vb,$T=this._shader2D,$N=$c.shaderValue,$t=$s.length>>4,$b=$V.bitmap;this._renderKey=0,$T.glTexture==$b&&$T.ALPHA===$N.ALPHA||(($c=this._curSubmit=$cV.createSubmit(this,this._ib,$R,$R._byteLength/32*3,$DV.create(1,0))).shaderValue.textureHost=$V,this._submits[this._submits._length++]=$c),$hV.fillTranglesVB($R,$U,$r,$s,$p||this._curMat,this._x,this._y),$c._numEle+=6*$t},$U.submitElement=function($V,$U){var $r=this._submits;for($U<0&&($U=$r._length);$V<$U;)$V+=$r[$V].renderSubmit()},$U.finish=function(){$LV.mainContext.finish()},$U.flush=function(){var $V=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($V>this._ib.bufferLength/12&&$hV.expandIBQuadrangle(this._ib,$V),!this._isMain&&$J.enabled&&$J._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$J._atlasRestore;for(var $U=this._submits,$r=0,$s=$U._length;$r<$s;$r++){var $p=$U[$r];10016===$p.getRenderType()&&$p.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$UV.instance&&$UV.getInstance().reset();var $c;for($r=0,$c=this.meshlist.length;$r<$c;$r++){var $R=this.meshlist[$r];$R.canReuse?$R.releaseMesh():$R.destroy()}return this.meshlist.length=0,this._curSubmit=$cV.RENDERBASE,this._renderKey=0,this._triangleMesh=$aV.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$U.setPathId=function($V){if(this.mId=$V,-1!=this.mId){this.mHaveKey=!1;var $U=$x.getInstance();$U.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$U.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$U.movePath=function($V,$U){var $r=$V,$s=$U;$V=this._curMat.a*$r+this._curMat.c*$s+this._curMat.tx,$U=this._curMat.b*$r+this._curMat.d*$s+this._curMat.ty,this.mX+=$V,this.mY+=$U},$U.beginPath=function(){var $V=this._getPath();$V.tempArray.length=0,$V.closePath=!1,this.mX=0,this.mY=0},$U.closePath=function(){this._path.closePath=!0},$U.fill=function($V){void 0===$V&&($V=!1);var $U=this._getPath();this.drawPoly(0,0,$U.tempArray,this.fillStyle._color.numColor,0,0,$V)},$U.stroke=function(){var $V=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$V.drawLine(0,0,$V.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $U=$x.getInstance().shapeLineDic[this.mId];$U.rebuild($V.tempArray),$V.setGeomtry($U)}else $x.getInstance().addLine(this.mId,$V.drawLine(0,0,$V.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$V.update();var $r=[this.mX,this.mY],$s=$cV.createShape(this,$V.ib,$V.vb,$V.count,$V.offset,$DV.create(4,0));$s.shaderValue.ALPHA=this._shader2D.ALPHA,$s.shaderValue.u_pos=$r,$s.shaderValue.u_mmat2=$WV.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$s,this._renderKey=-1}},$U.line=function($V,$U,$r,$s,$p,$c){var $R=this._curSubmit,$T=this._vb;if($hV.fillLineVb($T,this._clipRect,$V,$U,$r,$s,$p,$c)){this._renderKey=0;var $N=this._shader2D,$t=$R.shaderValue;$N.strokeStyle===$t.strokeStyle&&$N.ALPHA===$t.ALPHA||($N.glTexture=null,($R=this._curSubmit=$cV.createSubmit(this,this._ib,$T,($T._byteLength-64)/32*3,$DV.create(2,0))).shaderValue.strokeStyle=$N.strokeStyle,$R.shaderValue.mainID=2,$R.shaderValue.ALPHA=$N.ALPHA,this._submits[this._submits._length++]=$R),$R._numEle+=6}},$U.moveTo=function($V,$U,$r){void 0===$r&&($r=!0);var $s=this._getPath();if($r){var $p=$V,$c=$U;$V=this._curMat.a*$p+this._curMat.c*$c,$U=this._curMat.b*$p+this._curMat.d*$c}$s.addPoint($V,$U)},$U.lineTo=function($V,$U,$r){void 0===$r&&($r=!0);var $s=this._getPath();if($r){var $p=$V,$c=$U;$V=this._curMat.a*$p+this._curMat.c*$c,$U=this._curMat.b*$p+this._curMat.d*$c}$s.addPoint($V,$U)},$U.drawCurves=function($V,$U,$r){this.setPathId(-1),this.beginPath(),this.strokeStyle=$r[3],this.lineWidth=$r[4];var $s=$r[2];$V+=$r[0],$U+=$r[1],this.movePath($V,$U),this.moveTo($s[0],$s[1]);for(var $p=2,$c=$s.length;$p<$c;)this.quadraticCurveTo($s[$p++],$s[$p++],$s[$p++],$s[$p++]);this.stroke()},$U.arcTo=function($V,$U,$r,$s,$p){if(-1==this.mId||!this.mHaveKey){var $c=0,$R=0,$T=0,$N=this._getPath();this._curMat.copyTo($o._tmpMatrix),$o._tmpMatrix.tx=$o._tmpMatrix.ty=0,$o._tempPoint.setTo($N.getEndPointX(),$N.getEndPointY()),$o._tmpMatrix.invertTransformPoint($o._tempPoint);var $t=$o._tempPoint.x-$V,$b=$o._tempPoint.y-$U,$S=Math.sqrt($t*$t+$b*$b);if(!($S<=1e-6)){var $_=$t/$S,$G=$b/$S,$q=$r-$V,$u=$s-$U,$h=$q*$q+$u*$u,$l=Math.sqrt($h);if(!($l<=1e-6)){var $W=$q/$l,$O=$u/$l,$L=$_+$W,$d=$G+$O,$k=Math.sqrt($L*$L+$d*$d);if(!($k<=1e-6)){var $y=$L/$k,$D=$d/$k,$n=Math.acos($y*$_+$D*$G),$I=Math.PI/2-$n,$Q=($S=$p/Math.tan($I))*$_+$V,$H=$S*$G+$U,$w=Math.sqrt($S*$S+$p*$p),$z=$V+$y*$w,$E=$U+$D*$w,$K=0,$m=0;if(0<=$_*$O-$G*$W){var $a=2*$I/$o.SEGNUM;$K=Math.sin($a),$m=Math.cos($a)}else $a=2*-$I/$o.SEGNUM,$K=Math.sin($a),$m=Math.cos($a);$R=this._curMat.a*$Q+this._curMat.c*$H,$T=this._curMat.b*$Q+this._curMat.d*$H,$R==this._path.getEndPointX()&&$T==this._path.getEndPointY()||$N.addPoint($R,$T);var $Z=$Q-$z,$x=$H-$E;for($c=0;$c<$o.SEGNUM;$c++){var $$=$Z*$m+$x*$K,$j=-$Z*$K+$x*$m;$R=$$+$z,$T=$j+$E,$V=this._curMat.a*$R+this._curMat.c*$T,$T=$U=this._curMat.b*$R+this._curMat.d*$T,($R=$V)==this._path.getEndPointX()&&$T==this._path.getEndPointY()||$N.addPoint($R,$T),$Z=$$,$x=$j}}}}}},$U.arc=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$c&&($c=!1),void 0===$R&&($R=!0),-1!=this.mId){var $T=$x.getInstance().shapeDic[this.mId];if($T&&this.mHaveKey&&!$T.needUpdate(this._curMat))return;$U=$V=0}var $N,$t=0,$b=0,$S=0,$_=0,$G=0,$q=0,$u=0;if($b=$p-$s,$c)if(Math.abs($b)>=2*Math.PI)$b=2*-Math.PI;else for(;0<$b;)$b-=2*Math.PI;else if(Math.abs($b)>=2*Math.PI)$b=2*Math.PI;else for(;$b<0;)$b+=2*Math.PI;$N=$b/($u=$r<101?Math.max(10,$b*$r/5):$r<201?Math.max(10,$b*$r/20):Math.max(10,$b*$r/40))/2,$S=Math.abs(4/3*(1-Math.cos($N))/Math.sin($N)),$c&&($S=-$S);var $h=this._getPath(),$l=NaN,$W=NaN;for($q=0;$q<=$u;$q++)$t=$s+$b*($q/$u),$_=$V+Math.cos($t)*$r,$G=$U+Math.sin($t)*$r,$R&&($l=$_,$W=$G,$_=this._curMat.a*$l+this._curMat.c*$W,$G=this._curMat.b*$l+this._curMat.d*$W),$_==this._path.getEndPointX()&&$G==this._path.getEndPointY()||$h.addPoint($_,$G);$_=$V+Math.cos($p)*$r,$G=$U+Math.sin($p)*$r,$R&&($l=$_,$W=$G,$_=this._curMat.a*$l+this._curMat.c*$W,$G=this._curMat.b*$l+this._curMat.d*$W),$_==this._path.getEndPointX()&&$G==this._path.getEndPointY()||$h.addPoint($_,$G)},$U.quadraticCurveTo=function($V,$U,$r,$s){var $p=$S.I,$c=$r,$R=$s;$r=this._curMat.a*$c+this._curMat.c*$R,$s=this._curMat.b*$c+this._curMat.d*$R,$c=$V,$R=$U,$V=this._curMat.a*$c+this._curMat.c*$R,$U=this._curMat.b*$c+this._curMat.d*$R;for(var $T=$p.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$V,$U,$r,$s],30,2),$N=0,$t=$T.length/2;$N<$t;$N++)this.lineTo($T[2*$N],$T[2*$N+1],!1);this.lineTo($r,$s,!1)},$U.rect=function($V,$U,$r,$s){this._other=this._other.make(),this._other.path||(this._other.path=new $M),this._other.path.rect($V,$U,$r,$s)},$U.strokeRect=function($V,$U,$r,$s,$p){var $c=.5*$p;this.line($V-$c,$U,$V+$r+$c,$U,$p,this._curMat),this.line($V+$r,$U,$V+$r,$U+$s,$p,this._curMat),this.line($V,$U,$V,$U+$s,$p,this._curMat),this.line($V-$c,$U+$s,$V+$r+$c,$U+$s,$p,this._curMat)},$U.clip=function(){},$U.drawPoly=function($V,$U,$r,$s,$p,$c,$R){void 0===$R&&($R=!1),this._renderKey=0,this._shader2D.glTexture=null;var $T=this._getPath();if(-1==this.mId)$T.polygon($V,$U,$r,$s,$p||1,$c);else if(this.mHaveKey){var $N=$x.getInstance().shapeDic[this.mId];$N.setMatrix(this._curMat),$N.rebuild($T.tempArray),$T.setGeomtry($N)}else{var $t=$T.polygon($V,$U,$r,$s,$p||1,$c);$x.getInstance().addShape(this.mId,$t),$t.setMatrix(this._curMat)}$T.update();var $b,$S=[this.mX,this.mY];if(($b=$cV.createShape(this,$T.ib,$T.vb,$T.count,$T.offset,$DV.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$b.shaderValue.u_pos=$S,$b.shaderValue.u_mmat2=$WV.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$b,0<$p){if(this.mHaveLineKey){var $_=$x.getInstance().shapeLineDic[this.mId];$_.rebuild($T.tempArray),$T.setGeomtry($_)}else $x.getInstance().addShape(this.mId,$T.drawLine($V,$U,$r,$p,$c));$T.update(),($b=$cV.createShape(this,$T.ib,$T.vb,$T.count,$T.offset,$DV.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$b.shaderValue.u_mmat2=$WV.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$b}},$U.drawParticle=function($V,$U,$r){$r.x=$V,$r.y=$U,this._submits[this._submits._length++]=$r},$U._getPath=function(){return this._path||(this._path=new $M)},$s(0,$U,"globalCompositeOperation",function(){return $B.NAMES[this._nBlendType]},function($V){var $U=$B.TOINT[$V];null==$U||this._nBlendType===$U||($A.save(this,65536,this,!0),this._curSubmit=$cV.RENDERBASE,this._renderKey=0,this._nBlendType=$U)}),$s(0,$U,"strokeStyle",function(){return this._shader2D.strokeStyle},function($V){this._shader2D.strokeStyle.equal($V)||($A.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$P.create($V))}),$s(0,$U,"globalAlpha",function(){return this._shader2D.ALPHA},function($V){($V=Math.floor(1e3*$V)/1e3)!=this._shader2D.ALPHA&&($A.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$V)}),$s(0,$U,"asBitmap",null,function($V){if($V){if(this._targets||(this._targets=new $Y),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$s(0,$U,"fillStyle",function(){return this._shader2D.fillStyle},function($V){this._shader2D.fillStyle.equal($V)||($A.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$P.create($V))}),$s(0,$U,"textAlign",function(){return this._other.textAlign},function($V){this._other.textAlign===$V||(this._other=this._other.make(),$A.save(this,32768,this._other,!1),this._other.textAlign=$V)}),$s(0,$U,"lineWidth",function(){return this._other.lineWidth},function($V){this._other.lineWidth===$V||(this._other=this._other.make(),$A.save(this,256,this._other,!1),this._other.lineWidth=$V)}),$s(0,$U,"textBaseline",function(){return this._other.textBaseline},function($V){this._other.textBaseline===$V||(this._other=this._other.make(),$A.save(this,16384,this._other,!1),this._other.textBaseline=$V)}),$s(0,$U,"font",null,function($V){$V!=this._other.font.toString()&&(this._other=this._other.make(),$A.save(this,8,this._other,!1),this._other.font===$qV.EMPTY?this._other.font=new $qV($V):this._other.font.setFont($V))}),$o.__init__=function(){$r.DEFAULT=new $r},$o._tempPoint=new $I,$o._SUBMITVBSIZE=32e3,$o._MAXSIZE=99999999,$o._RECTVBSIZE=16,$o.MAXCLIPRECT=new $Q(0,0,99999999,99999999),$o._COUNT=0,$o._tmpMatrix=new $n,$o.SEGNUM=32,$o._contextcount=0,$R($o,["_fontTemp",function(){return this._fontTemp=new $qV},"_drawStyleTemp",function(){return this._drawStyleTemp=new $P(null)}]),$o.__init$=function(){$r=function(){function $V(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$qV.EMPTY}$_($V,"");var $U=$V.prototype;return $U.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$qV.EMPTY},$U.make=function(){return this===$V.DEFAULT?new $V:this},$V.DEFAULT=null,$V}()},$o}(),$DV=function($V){function $s($V,$U){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$s.__super.call(this),this.defines=new $HV,this.position=$s._POSITION,this.mainID=$V,this.subID=$U,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$V|$U,this._inClassCache=$s._cache[this._cacheID],0<$V&&!this._inClassCache&&(this._inClassCache=$s._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$_($s,"laya.webgl.shader.d2.value.Value2D",$j);var $U=$s.prototype;return $U.setValue=function($V){},$U.refresh=function(){var $V=this.size;return $V[0]=$WV.width,$V[1]=$WV.height,this.alpha=this.ALPHA*$WV.worldAlpha,this.mmat=$WV.worldMatrix4,this},$U._ShaderWithCompile=function(){return $FV.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$YV.create)},$U._withWorldShaderDefines=function(){var $V=$WV.worldShaderDefines,$U=$FV.sharders[this.mainID|this.defines._value|$V.getValue()];if(!$U){var $r,$s={};for($r in this.defines.toNameDic())$s[$r]="";for($r in $V.toNameDic())$s[$r]="";$U=$FV.withCompile2D(0,this.mainID,$s,this.mainID|this.defines._value|$V.getValue(),$YV.create)}var $p=$WV.worldFilters;if(!$p)return $U;for(var $c,$R=$p.length,$T=0;$T<$R;$T++)($c=$p[$T])&&$c.action.setValue(this);return $U},$U.upload=function(){var $V=$WV;this.alpha=this.ALPHA*$V.worldAlpha,$WV.worldMatrix4!==$WV.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$LV.shaderHighPrecision&&this.defines.add(1024);var $U,$r=$V.worldShaderDefines?this._withWorldShaderDefines():$FV.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$V.width,this.size[1]=$V.height,this.mmat=$V.worldMatrix4,$ZV.activeShader!==$r?$r._shaderValueWidth!==$V.width||$r._shaderValueHeight!==$V.height?($r._shaderValueWidth=$V.width,$r._shaderValueHeight=$V.height):$U=$r._params2dQuick2||$r._make2dQuick2():$r._shaderValueWidth!==$V.width||$r._shaderValueHeight!==$V.height?($r._shaderValueWidth=$V.width,$r._shaderValueHeight=$V.height):$U=$r._params2dQuick1||$r._make2dQuick1(),$r.upload(this,$U)},$U.setFilters=function($V){if(this.filters=$V)for(var $U,$r=$V.length,$s=0;$s<$r;$s++)($U=$V[$s])&&(this.defines.add($U.type),$U.action.setValue(this))},$U.clear=function(){this.defines.setValue(this.subID)},$U.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$s._initone=function($V,$U){$s._typeClass[$V]=$U,$s._cache[$V]=[],$s._cache[$V]._length=0},$s.__init__=function(){$s._POSITION=[2,5126,!1,4*$uV.BYTES_PE,0],$s._TEXCOORD=[2,5126,!1,4*$uV.BYTES_PE,2*$uV.BYTES_PE],$s._initone(2,$oV),$s._initone(4,$BV),$s._initone(256,$JV),$s._initone(512,$jV),$s._initone(1,$iV),$s._initone(65,$vV),$s._initone(9,$iV)},$s.create=function($V,$U){var $r=$s._cache[$V|$U];return $r._length?$r[--$r._length]:new $s._typeClass[$V|$U]($U)},$s._POSITION=null,$s._TEXCOORD=null,$s._cache=[],$s._typeClass=[],$s.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$s}(),$nV=function($V){function $h($V,$U){$h.__super.call(this,$V,$U)}$_($h,"laya.webgl.utils.RenderSprite3D",$W);var $U=$h.prototype;return $U.onCreate=function($V){switch($V){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$U._mask=function($V,$U,$r,$s){var $p,$c,$R=this._next,$T=$V.mask;if($T){$U.ctx.save();var $N=$U.ctx.globalCompositeOperation,$t=new $Q;if($t.copyFrom($T.getBounds()),$t.width=Math.round($t.width),$t.height=Math.round($t.height),$t.x=Math.round($t.x),$t.y=Math.round($t.y),0<$t.width&&0<$t.height){var $b=$V._style._tf,$S=$TV.create();$S.addValue("bounds",$t),$p=$RV.create([$S,$U],laya.webgl.utils.RenderSprite3D.tmpTarget),$U.addRenderObject($p),$T.render($U,-$t.x,-$t.y),$p=$RV.create([$S],laya.webgl.utils.RenderSprite3D.endTmpTarget),$U.addRenderObject($p),$U.ctx.save(),$U.clipRect($r-$b.translateX+$t.x,$s-$b.translateY+$t.y,$t.width,$t.height),$R._fun.call($R,$V,$U,$r,$s),$U.ctx.restore(),$c=$bV.create(6),$N=$U.ctx.globalCompositeOperation,$c.blendMode="mask",$U.addRenderObject($c),$n.TEMP.identity();var $_=$DV.create(1,0),$G=$a.INV_UV,$q=$t.width,$u=$t.height;($t.width<32||$t.height<32)&&(($G=$h.tempUV)[0]=0,$G[1]=0,$G[2]=32<=$t.width?1:$t.width/32,$G[3]=0,$G[4]=32<=$t.width?1:$t.width/32,$G[5]=32<=$t.height?1:$t.height/32,$G[6]=0,$G[7]=32<=$t.height?1:$t.height/32,$t.width=32<=$t.width?$t.width:32,$t.height=32<=$t.height?$t.height:32,$G[1]*=-1,$G[3]*=-1,$G[5]*=-1,$G[7]*=-1,$G[1]+=1,$G[3]+=1,$G[5]+=1,$G[7]+=1),$U.ctx.drawTarget($S,$r+$t.x-$b.translateX,$s+$t.y-$b.translateY,$q,$u,$n.TEMP,"tmpTarget",$_,$G,6),$p=$RV.create([$S],laya.webgl.utils.RenderSprite3D.recycleTarget),$U.addRenderObject($p),($c=$bV.create(6)).blendMode=$N,$U.addRenderObject($c)}$U.ctx.restore()}else $R._fun.call($R,$V,$U,$r,$s)},$U._blend=function($V,$U,$r,$s){var $p=$V._style,$c=this._next;$p.blendMode?($U.ctx.save(),$U.ctx.globalCompositeOperation=$p.blendMode,$c._fun.call($c,$V,$U,$r,$s),$U.ctx.restore()):$c._fun.call($c,$V,$U,$r,$s)},$U._transform=function($V,$U,$r,$s){var $p=$V.transform,$c=this._next;if($p&&$c!=$W.NORENDER){var $R=$U.ctx;$V._style;$p.tx=$r,$p.ty=$s;var $T=$R._getTransformMatrix(),$N=$T.clone();$n.mul($p,$T,$T),$T._checkTransform(),$p.tx=$p.ty=0,$c._fun.call($c,$V,$U,0,0),$N.copyTo($T),$N.destroy()}else $c._fun.call($c,$V,$U,$r,$s)},$h.tmpTarget=function($V,$U){var $r=$V.getValue("bounds"),$s=$xV.create($r.width,$r.height);$s.start(),$s.clear(0,0,0,0),$V.addValue("tmpTarget",$s)},$h.endTmpTarget=function($V){$V.getValue("tmpTarget").end()},$h.recycleTarget=function($V){$V.getValue("tmpTarget").recycle(),$V.recycle()},$R($h,["tempUV",function(){return this.tempUV=new Array(8)}]),$h}(),$IV=function($V){function $U(){this.data=null,$U.__super.call(this)}$_($U,"laya.filters.webgl.ColorFilterActionGL",$$);var $r=$U.prototype;return $k.imps($r,{"laya.filters.IFilterActionGL":!0}),$r.setValue=function($V){$V.colorMat=this.data._mat,$V.colorAlpha=this.data._alpha},$r.apply3d=function($V,$U,$r,$s,$p){var $c=$V.getValue("bounds"),$R=$DV.create(1,0);$R.setFilters([this.data]);var $T=$n.TEMP;$T.identity(),$r.ctx.drawTarget($V,0,0,$c.width,$c.height,$T,"src",$R)},$U}(),$QV=function($V){function $c($V,$U,$r,$s,$p){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$c.__super.call(this,$V,$U,$p),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $PV,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$r,this._atlasCanvas.height=$s,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$_($c,"laya.webgl.atlas.Atlaser",$o);var $U=$c.prototype;return $U.computeUVinAtlasTexture=function($V,$U,$r,$s){var $p=$J.atlasTextureWidth,$c=$J.atlasTextureHeight,$R=$r/$p,$T=$s/$c,$N=($r+$V.bitmap.width)/$p,$t=($s+$V.bitmap.height)/$c,$b=$V.bitmap.width/$p,$S=$V.bitmap.height/$c;$V.uv=[$R+$U[0]*$b,$T+$U[1]*$S,$N-(1-$U[2])*$b,$T+$U[3]*$S,$N-(1-$U[4])*$b,$t-(1-$U[5])*$S,$R+$U[6]*$b,$t-(1-$U[7])*$S]},$U.findBitmapIsExist=function($V){if($V instanceof laya.webgl.resource.WebGLImage){var $U=$V,$r=$U.url,$s=this._InAtlasWebGLImagesKey[$r||$U.id];if($s)return $s.offsetInfoID}return-1},$U.addToAtlasTexture=function($V,$U,$r){if($V instanceof laya.webgl.resource.WebGLImage){var $s=$V,$p=$s.url;this._InAtlasWebGLImagesKey[$p||$s.id]={bitmap:$V,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$U,$r])}this._atlasCanvas.texSubImage2D($U,$r,$V.atlasSource),$V.clearAtlasSource()},$U.addToAtlas=function($V,$U,$r){$V._atlasID=this._inAtlasTextureKey.length;var $s=$V.uv.slice(),$p=$V.bitmap;this._inAtlasTextureKey.push($V),this._inAtlasTextureOriUVValue.push($s),this._inAtlasTextureBitmapValue.push($p),this.computeUVinAtlasTexture($V,$s,$U,$r),$V.bitmap=this._atlasCanvas},$U.clear=function(){for(var $V=0,$U=this._inAtlasTextureKey.length;$V<$U;$V++)this._inAtlasTextureKey[$V].bitmap=this._inAtlasTextureBitmapValue[$V],this._inAtlasTextureKey[$V].uv=this._inAtlasTextureOriUVValue[$V],this._inAtlasTextureKey[$V]._atlasID=-1,this._inAtlasTextureKey[$V].bitmap.lock=!1,this._inAtlasTextureKey[$V].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$U.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$s(0,$U,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$s(0,$U,"texture",function(){return this._atlasCanvas}),$s(0,$U,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$c}(),$HV=function($V){function $r(){$r.__super.call(this,$r.__name2int,$r.__int2name,$r.__int2nameMap)}return $_($r,"laya.webgl.shader.d2.ShaderDefines2D",$f),$r.__init__=function(){$r.reg("TEXTURE2D",1),$r.reg("COLOR2D",2),$r.reg("PRIMITIVE",4),$r.reg("GLOW_FILTER",8),$r.reg("BLUR_FILTER",16),$r.reg("COLOR_FILTER",32),$r.reg("COLOR_ADD",64),$r.reg("WORLDMAT",128),$r.reg("FILLTEXTURE",256),$r.reg("FSHIGHPRECISION",1024),$r.reg("TXTALPHA",2048),$r.reg("TXTCOMPRESS",4096)},$r.reg=function($V,$U){$f._reg($V,$U,$r.__name2int,$r.__int2name)},$r.toText=function($V,$U,$r){return $f._toText($V,$U,$r)},$r.toInt=function($V){return $f._toInt($V,$r.__name2int)},$r.TEXTURE2D=1,$r.COLOR2D=2,$r.PRIMITIVE=4,$r.FILTERGLOW=8,$r.FILTERBLUR=16,$r.FILTERCOLOR=32,$r.COLORADD=64,$r.WORLDMAT=128,$r.FILLTEXTURE=256,$r.SKINMESH=512,$r.SHADERDEFINE_FSHIGHPRECISION=1024,$r.TXTALPHA=2048,$r.TXTCOMPRESS=4096,$r.__name2int={},$r.__int2name=[],$r.__int2nameMap=[],$r}(),$wV=(function($V){function $T($V,$U,$r,$s,$p,$c,$R){$T.__super.call(this,$V,$U,$r,$s,40,$p,$c,$R)}$_($T,"laya.webgl.shapes.Ellipse",$rV)}(),function($V){function $c($V,$U,$r,$s,$p){this._points=[],this.rebuild($r),$c.__super.call(this,$V,$U,0,0,0,$p,$s,$p,0)}$_($c,"laya.webgl.shapes.Line",$rV);var $U=$c.prototype;return $U.rebuild=function($V){var $U=$V.length;$U!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($U/2-1)),this.mFloat32Array=new Float32Array(5*$U)),this._points.length=0;for(var $r=NaN,$s=NaN,$p=-1,$c=-1,$R=$V.length/2,$T=0;$T<$R;$T++)$r=$V[2*$T],$s=$V[2*$T+1],(.01<Math.abs($p-$r)||.01<Math.abs($c-$s))&&this._points.push($r,$s),$p=$r,$c=$s},$U.getData=function($V,$U,$r){var $s=[],$p=[];0<this.borderWidth&&this.createLine2(this._points,$s,this.borderWidth,$r,$p,this._points.length/2),this.mUint16Array.set($s,0),this.mFloat32Array.set($p,0),$V.append(this.mUint16Array),$U.append(this.mFloat32Array)},$c}()),$zV=function($V){function $S($V,$U,$r,$s,$p){this._points=[];for(var $c=NaN,$R=NaN,$T=-1,$N=-1,$t=$r.length/2-1,$b=0;$b<$t;$b++)$c=$r[2*$b],$R=$r[2*$b+1],(.01<Math.abs($T-$c)||.01<Math.abs($N-$R))&&this._points.push($c,$R),$T=$c,$N=$R;$c=$r[2*$t],$R=$r[2*$t+1],$T=this._points[0],$N=this._points[1],(.01<Math.abs($T-$c)||.01<Math.abs($N-$R))&&this._points.push($c,$R),$S.__super.call(this,$V,$U,0,0,this._points.length/2,0,$s,$p)}$_($S,"laya.webgl.shapes.LoopLine",$rV);var $U=$S.prototype;return $U.getData=function($V,$U,$r){if(0<this.borderWidth){for(var $s=this.color,$p=($s>>16&255)/255,$c=($s>>8&255)/255,$R=(255&$s)/255,$T=[],$N=0,$t=0,$b=[],$S=Math.floor(this._points.length/2),$_=0;$_<$S;$_++)$N=this._points[2*$_],$t=this._points[2*$_+1],$T.push(this.x+$N,this.y+$t,$p,$c,$R);this.createLoopLine($T,$b,this.borderWidth,$r+$T.length/5),$V.append(new Uint16Array($b)),$U.append(new Float32Array($T))}},$U.createLoopLine=function($V,$U,$r,$s,$p,$c){$V.length;var $R=$V.concat(),$T=$p||$V,$N=this.borderColor,$t=($N>>16&255)/255,$b=($N>>8&255)/255,$S=(255&$N)/255,$_=[$R[0],$R[1]],$G=[$R[$R.length-5],$R[$R.length-4]],$q=$G[0]+.5*($_[0]-$G[0]),$u=$G[1]+.5*($_[1]-$G[1]);$R.unshift($q,$u,0,0,0),$R.push($q,$u,0,0,0);var $h,$l,$W,$O,$L,$d,$k,$y,$D,$n,$I,$Q,$H,$w,$z,$E,$K,$m,$a,$Z,$x=$R.length/5,$$=$s,$j=$r/2;$W=$R[0],$O=$R[1],$n=$W-($L=$R[5]),$D=($D=-($O-($d=$R[6])))/($Z=Math.sqrt($D*$D+$n*$n))*$j,$n=$n/$Z*$j,$T.push($W-$D,$O-$n,$t,$b,$S,$W+$D,$O+$n,$t,$b,$S);for(var $o=1;$o<$x-1;$o++)$W=$R[5*($o-1)],$O=$R[5*($o-1)+1],$L=$R[5*$o],$d=$R[5*$o+1],$k=$R[5*($o+1)],$y=$R[5*($o+1)+1],$n=$W-$L,$Q=$L-$k,$z=(-($D=($D=-($O-$d))/($Z=Math.sqrt($D*$D+$n*$n))*$j)+$W)*(-($n=$n/$Z*$j)+$d)-(-$D+$L)*(-$n+$O),$m=(-($I=($I=-($d-$y))/($Z=Math.sqrt($I*$I+$Q*$Q))*$j)+$k)*(-($Q=$Q/$Z*$j)+$d)-(-$I+$L)*(-$Q+$y),$a=($H=-$n+$O-(-$n+$d))*($K=-$I+$L-(-$I+$k))-($E=-$Q+$y-(-$Q+$d))*($w=-$D+$L-(-$D+$W)),Math.abs($a)<.1?($a+=10.1,$T.push($L-$D,$d-$n,$t,$b,$S,$L+$D,$d+$n,$t,$b,$S)):((($h=($w*$m-$K*$z)/$a)-$L)*($h-$L)+(($l=($E*$z-$H*$m)/$a)-$d)+($l-$d),$T.push($h,$l,$t,$b,$S,$L-($h-$L),$d-($l-$d),$t,$b,$S));$c&&($U=$c);var $J=this.edges+1;for($o=1;$o<$J;$o++)$U.push($$+2*($o-1),$$+2*($o-1)+1,$$+2*$o+1,$$+2*$o+1,$$+2*$o,$$+2*($o-1));return $U.push($$+2*($o-1),$$+2*($o-1)+1,$$+1,$$+1,$$,$$+2*($o-1)),$T},$S}(),$EV=function($V){function $R($V,$U,$r,$s,$p,$c){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$n.create(),this._points=$r.slice(0,$r.length),$R.__super.call(this,$V,$U,0,0,this._points.length/2,$s,$p,$c)}$_($R,"laya.webgl.shapes.Polygon",$rV);var $U=$R.prototype;return $U.rebuild=function($V){this._repaint||(this._points.length=0,this._points=this._points.concat($V))},$U.setMatrix=function($V){$V.copyTo(this._mat)},$U.needUpdate=function($V){return this._repaint=this._mat.a==$V.a&&this._mat.b==$V.b&&this._mat.c==$V.c&&this._mat.d==$V.d&&this._mat.tx==$V.tx&&this._mat.ty==$V.ty,!this._repaint},$U.getData=function($V,$U,$r){var $s,$p=0,$c=this._points,$R=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$r){for(this._start=$r,$s=[],$R=this.earcutTriangles.length,$p=0;$p<$R;$p++)$s.push(this.earcutTriangles[$p]+$r);this.mUint16Array=new Uint16Array($s)}}else{this._start=$r,$s=[];var $T=[],$N=[],$t=this.color,$b=($t>>16&255)/255,$S=($t>>8&255)/255,$_=(255&$t)/255;for($R=Math.floor($c.length/2),$p=0;$p<$R;$p++)$T.push(this.x+$c[2*$p],this.y+$c[2*$p+1],$b,$S,$_),$N.push(this.x+$c[2*$p],this.y+$c[2*$p+1]);for(this.earcutTriangles=$sV.earcut($N,null,2),$R=this.earcutTriangles.length,$p=0;$p<$R;$p++)$s.push(this.earcutTriangles[$p]+$r);this.mUint16Array=new Uint16Array($s),this.mFloat32Array=new Float32Array($T)}$V.append(this.mUint16Array),$U.append(this.mFloat32Array)},$R}(),$KV=function($V){function $c(){this._matrix=new $n,this._matrix4=$uV.defaultMatrix4.concat(),$c.__super.call(this,1e4),this.shaderValue=new $DV(0,0)}$_($c,"laya.webgl.submit.SubmitCanvas",$cV);var $U=$c.prototype;return $U.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $V=$WV.worldAlpha,$U=$WV.worldMatrix4,$r=$WV.worldMatrix,$s=$WV.worldFilters,$p=$WV.worldShaderDefines,$c=this.shaderValue,$R=this._matrix,$T=this._matrix4,$N=$n.TEMP;return $n.mul($R,$r,$N),$T[0]=$N.a,$T[1]=$N.b,$T[4]=$N.c,$T[5]=$N.d,$T[12]=$N.tx,$T[13]=$N.ty,$WV.worldMatrix=$N.clone(),$WV.worldMatrix4=$T,$WV.worldAlpha=$WV.worldAlpha*$c.alpha,$c.filters&&$c.filters.length&&($WV.worldFilters=$c.filters,$WV.worldShaderDefines=$c.defines),this._ctx_src.flush(),$WV.worldAlpha=$V,$WV.worldMatrix4=$U,$WV.worldMatrix.destroy(),$WV.worldMatrix=$r,$WV.worldFilters=$s,$WV.worldShaderDefines=$p,1},$U.releaseRender=function(){var $V=$c._cache;this._ctx_src=null,$V[$V._length++]=this},$U.getRenderType=function(){return 10003},$c.create=function($V,$U,$r){var $s=$c._cache._length?$c._cache[--$c._cache._length]:new $c;$s._ctx_src=$V;var $p=$s.shaderValue;return $p.alpha=$U,$p.defines.setValue(0),$r&&$r.length&&$p.setFilters($r),$s},$c._cache=(($c._cache=[])._length=0,$c._cache),$c}(),$mV=function($V){function $t($V){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$V&&($V=1e4),$t.__super.call(this,$V)}$_($t,"laya.webgl.submit.SubmitTexture",$cV);var $U=$t.prototype;return $U.releaseRender=function(){var $V=$t._cache;($V[$V._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$U.addTexture=function($V,$U){this._texsID[this._texs.length]=$V._uvID,this._texs.push($V),this._vbPos.push($U)},$U.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $V=this.shaderValue.textureHost.bitmap;if(null!==$V)for(var $U=this._vb.getFloat32Array(),$r=0,$s=this._texs.length;$r<$s;$r++){var $p=this._texs[$r];$p.active();var $c=$p.uv;if(this._texsID[$r]!==$p._uvID){this._texsID[$r]=$p._uvID;var $R=this._vbPos[$r];$U[$R+2]=$c[0],$U[$R+3]=$c[1],$U[$R+6]=$c[2],$U[$R+7]=$c[3],$U[$R+10]=$c[4],$U[$R+11]=$c[5],$U[$R+14]=$c[6],$U[$R+15]=$c[7],this._vb.setNeedUpload()}$p.bitmap!==$V&&(this._isSameTexture=!1)}}},$U.renderSubmit=function(){if(0===this._numEle)return $t._shaderSet=!1,1;var $V=this.shaderValue.textureHost;if($V){var $U=$V.source;if(!$V.bitmap||!$U)return $t._shaderSet=!1,1;this.shaderValue.texture=$U,$V.alphaTexture&&$V.alphaTexture.source&&(this.shaderValue.texture1=$V.alphaTexture.source)}this._vb.bind_upload(this._ib);var $r=$LV.mainContext;if($B.activeBlendFunction!==this._blendFn&&($r.enable(3042),this._blendFn($r),$B.activeBlendFunction=this._blendFn),$z.drawCall++,$z.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$ZV.activeShader&&$t._shaderSet?($ZV.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$ZV.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$t._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $s=$V.bitmap,$p=0,$c=$ZV.activeShader,$R=0,$T=this._texs.length;$R<$T;$R++){var $N=this._texs[$R];$N.bitmap===$s&&$R+1!==$T||($c.uploadTexture2D($N.source),$r.drawElements(4,6*($R-$p+1),5123,this._startIdx+6*$p*$uV.BYTES_PIDX),$s=$N.bitmap,$p=$R)}else $r.drawElements(4,this._numEle,5123,this._startIdx);return 1},$t.create=function($V,$U,$r,$s,$p){var $c=$t._cache._length?$t._cache[--$t._cache._length]:new $t;null==$r&&(($r=$c._selfVb||($c._selfVb=$fV.create(-1))).clear(),$s=0),$c._ib=$U,$c._vb=$r,$c._startIdx=$s*$uV.BYTES_PIDX,$c._numEle=0;var $R=$V._nBlendType;$c._blendFn=$V._targets?$B.targetFns[$R]:$B.fns[$R],$c.shaderValue=$p,$c.shaderValue.setValue($V._shader2D);var $T=$V._shader2D.filters;return $T&&$c.shaderValue.setFilters($T),$c},$t._cache=(($t._cache=[])._length=0,$t._cache),$t._shaderSet=!0,$t}(),$aV=function($V){function $l(){$l.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$_($l,"laya.webgl.utils.MeshTexture",$lV);var $U=$l.prototype;return $U.addData=function($V,$U,$r,$s,$p,$c){for(var $R=$V.length/2,$T=this._vb.needSize($R*$l.const_stride)>>2,$N=this._vb.getFloat32Array(),$t=0,$b=0;$b<$R;$b++){var $S=$V[$t],$_=$V[$t+1],$G=$S*$s.a+$_*$s.c+$s.tx,$q=$S*$s.b+$_*$s.d+$s.ty;$N[$T++]=$G,$N[$T++]=$q,$N[$T++]=$U[$t],$N[$T++]=$U[$t+1],$t+=2}this._vb.setNeedUpload();var $u=this.vertNum;if(0<$u){($R=$r.length)>$l.tmpIdx.length&&($l.tmpIdx=new Uint16Array($R));for(var $h=0;$h<$R;$h++)$l.tmpIdx[$h]=$r[$h]+$u;this._ib.appendU16Array($l.tmpIdx,$r.length)}else this._ib.append($r);this._ib.setNeedUpload(),this.vertNum+=$R,this.indexNum+=$r.length},$U.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$U.destroy=function(){this._ib.destroy(),this._vb.destroy()},$l.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $l},$l.const_stride=16,$l._POOL=[],$R($l,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$l}(),$ZV=function($V){function $U(){$U.__super.call(this),this.lock=!0}return $_($U,"laya.webgl.shader.BaseShader",$O),$U.activeShader=null,$U.bindShader=null,$U}(),$xV=function($U){function $b($V,$U,$r,$s,$p,$c,$R,$T,$N){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$r&&($r=6408),void 0===$s&&($s=5121),void 0===$p&&($p=34041),void 0===$c&&($c=!1),void 0===$R&&($R=!1),void 0===$T&&($T=-1),void 0===$N&&($N=-1),this._type=1,this._w=$V,this._h=$U,this._surfaceFormat=$r,this._surfaceType=$s,this._depthStencilFormat=$p,$l.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$c,this._repeat=$R,this._minFifter=$T,this._magFifter=$N,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$b.__super.call(this,this.bitmap,$a.INV_UV)}$_($b,"laya.webgl.resource.RenderTarget2D",$U);var $V=$b.prototype;return $k.imps($V,{"laya.resource.IDispose":!0}),$V.getType=function(){return this._type},$V.getTexture=function(){return this},$V.size=function($V,$U){this._w==$V&&this._h==$U||(this._w=$V,this._h=$U,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$V.release=function(){this.destroy()},$V.recycle=function(){$b.POOL.push(this)},$V.start=function(){var $V=$LV.mainContext;return this._preRenderTarget=$WV.curRenderTarget,$WV.curRenderTarget=this,$V.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($V.viewport(0,0,this._w,this._h),this._svWidth=$WV.width,this._svHeight=$WV.height,$WV.width=this._w,$WV.height=this._h,$ZV.activeShader=null),this},$V.clear=function($V,$U,$r,$s){void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=1);var $p=$LV.mainContext;$p.clearColor($V,$U,$r,$s);var $c=16384;switch(this._depthStencilFormat){case 33189:$c|=256;break;case 36168:$c|=1024;break;case 34041:$c|=256,$c|=1024}$p.clear($c)},$V.end=function(){var $V=$LV.mainContext;$V.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$WV.curRenderTarget=this._preRenderTarget,1==this._type?($V.viewport(0,0,this._svWidth,this._svHeight),$WV.width=this._svWidth,$WV.height=this._svHeight,$ZV.activeShader=null):$V.viewport(0,0,$k.stage.width,$k.stage.height)},$V.getData=function($V,$U,$r,$s){var $p=$LV.mainContext;if($p.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$p.checkFramebufferStatus(36160)))return $p.bindFramebuffer(36160,null),null;var $c=new Uint8Array(this._w*this._h*4);return $p.readPixels($V,$U,$r,$s,this._surfaceFormat,this._surfaceType,$c),$p.bindFramebuffer(36160,null),$c},$V.destroy=function($V){void 0===$V&&($V=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$U.prototype.destroy.call(this))},$V.dispose=function(){},$V._createWebGLRenderTarget=function(){this.bitmap=new $XV(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($V){this.event("recovered")})},$s(0,$V,"surfaceFormat",function(){return this._surfaceFormat}),$s(0,$V,"magFifter",function(){return this._magFifter}),$s(0,$V,"surfaceType",function(){return this._surfaceType}),$s(0,$V,"mipMap",function(){return this._mipMap}),$s(0,$V,"depthStencilFormat",function(){return this._depthStencilFormat}),$s(0,$V,"minFifter",function(){return this._minFifter}),$s(0,$V,"source",function(){return this._alreadyResolved?$k.superGet($a,this,"source"):null}),$b.create=function($V,$U,$r,$s,$p,$c,$R,$T,$N){void 0===$r&&($r=6408),void 0===$s&&($s=5121),void 0===$p&&($p=34041),void 0===$c&&($c=!1),void 0===$R&&($R=!1),void 0===$T&&($T=-1),void 0===$N&&($N=-1);var $t=$b.POOL.pop();return $t||($t=new $b($V,$U)),$t.bitmap&&$t._w==$V&&$t._h==$U&&$t._surfaceFormat==$r&&$t._surfaceType==$s&&$t._depthStencilFormat==$p&&$t._mipMap==$c&&$t._repeat==$R&&$t._minFifter==$T&&$t._magFifter==$N||($t._w=$V,$t._h=$U,$t._surfaceFormat=$r,$t._surfaceType=$s,$t._depthStencilFormat=$p,$l.isConchWebGL&&34041===$t._depthStencilFormat&&($t._depthStencilFormat=33189),$t._mipMap=$c,$t._repeat=$R,$t._minFifter=$T,$t._magFifter=$N,$t.release(),$t._createWebGLRenderTarget()),$t},$b.TYPE2D=1,$b.TYPE3D=2,$b.POOL=[],$b}($a),$$V=function($V){function $U(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$U.__super.call(this),$U._gl=$LV.mainContext}$_($U,"laya.webgl.utils.Buffer",$O);var $r=$U.prototype;return $r._bind=function(){this.activeResource(),$U._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($U._bindVertexBuffer=this._glBuffer),$U._gl.bindBuffer(this._bufferType,$U._bindActive[this._bufferType]=this._glBuffer),$ZV.activeShader=null)},$r.recreateResource=function(){this._glBuffer||(this._glBuffer=$U._gl.createBuffer()),this.completeCreate()},$r.disposeResource=function(){this._glBuffer&&($LV.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$s(0,$r,"bufferUsage",function(){return this._bufferUsage}),$U._gl=null,$U._bindActive={},$U._bindVertexBuffer=null,$U._enableAtributes=[],$U}(),$jV=function($V){function $r($V){this.texcoord=null,this.offsetX=300,this.offsetY=0,$r.__super.call(this,512,0);var $U=8*$uV.BYTES_PE;this.position=[2,5126,!1,$U,0],this.texcoord=[2,5126,!1,$U,2*$uV.BYTES_PE],this.color=[4,5126,!1,$U,4*$uV.BYTES_PE]}return $_($r,"laya.webgl.shader.d2.skinAnishader.SkinSV",$DV),$r}(),$oV=function($V){function $U($V){$U.__super.call(this,2,0),this.color=[]}return $_($U,"laya.webgl.shader.d2.value.Color2dSV",$DV),$U.prototype.setValue=function($V){$V.fillStyle&&(this.color=$V.fillStyle._color._color),$V.strokeStyle&&(this.color=$V.strokeStyle._color._color)},$U}(),$JV=function($V){function $U($V){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$DV._TEXCOORD,$U.__super.call(this,256,0)}$_($U,"laya.webgl.shader.d2.value.FillTextureSV",$DV);var $r=$U.prototype;return $r.setValue=function($V){this.ALPHA=$V.ALPHA,$V.filters&&this.setFilters($V.filters)},$r.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$U}(),$iV=function($V){function $U($V){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$DV._TEXCOORD,void 0===$V&&($V=0),$U.__super.call(this,1,$V)}$_($U,"laya.webgl.shader.d2.value.TextureSV",$DV);var $r=$U.prototype;return $r.setValue=function($V){this.ALPHA=$V.ALPHA,$V.filters&&this.setFilters($V.filters)},$r.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$U}(),$BV=function($V){function $U($V){this.a_color=null,this.u_pos=[0,0],$U.__super.call(this,4,0),this.position=[2,5126,!1,5*$uV.BYTES_PE,0],this.a_color=[3,5126,!1,5*$uV.BYTES_PE,2*$uV.BYTES_PE]}return $_($U,"laya.webgl.shader.d2.value.PrimitiveSV",$DV),$U}(),$PV=function($V){function $U(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$U.__super.call(this)}$_($U,"laya.webgl.atlas.AtlasWebGLCanvas",$V);var $r=$U.prototype;return $r.recreateResource=function(){var $V=$LV.mainContext,$U=this._source=$V.createTexture(),$r=$dV.curBindTexTarget,$s=$dV.curBindTexValue;$dV.bindTexture($V,3553,$U),$V.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$V.texParameteri(3553,10241,9729),$V.texParameteri(3553,10240,9729),$V.texParameteri(3553,10242,33071),$V.texParameteri(3553,10243,33071),$r&&$s&&$dV.bindTexture($V,$r,$s),this.memorySize=this._w*this._h*4,this.completeCreate()},$r.disposeResource=function(){this._source&&($LV.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$r.texSubImage2D=function($V,$U,$r){if($l.isFlash){this._flashCacheImage||(this._flashCacheImage=$u.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $s=$r.bitmapdata;this._flashCacheImage._image.copyPixels($s,0,0,$s.width,$s.height,$V,$U),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $p=$LV.mainContext,$c=$dV.curBindTexTarget,$R=$dV.curBindTexValue;$dV.bindTexture($p,3553,this._source),$p.pixelStorei(37441,!0),0<=$V-1&&$p.texSubImage2D(3553,0,$V-1,$U,6408,5121,$r),$V+1<=this._w&&$p.texSubImage2D(3553,0,$V+1,$U,6408,5121,$r),0<=$U-1&&$p.texSubImage2D(3553,0,$V,$U-1,6408,5121,$r),$U+1<=this._h&&$p.texSubImage2D(3553,0,$V,$U+1,6408,5121,$r),$p.texSubImage2D(3553,0,$V,$U,6408,5121,$r),$p.pixelStorei(37441,!1),$c&&$R&&$dV.bindTexture($p,$c,$R)}},$r.texSubImage2DPixel=function($V,$U,$r,$s,$p){var $c=$LV.mainContext,$R=$dV.curBindTexTarget,$T=$dV.curBindTexValue;$dV.bindTexture($c,3553,this._source);var $N=new Uint8Array($p.data);$c.pixelStorei(37441,!0),$c.texSubImage2D(3553,0,$V,$U,$r,$s,6408,5121,$N),$c.pixelStorei(37441,!1),$R&&$T&&$dV.bindTexture($c,$R,$T)},$s(0,$r,"width",$V.prototype._$get_width,function($V){this._w=$V}),$s(0,$r,"height",$V.prototype._$get_height,function($V){this._h=$V}),$U}($r),$MV=function($V){function $p(){this.flipY=!0,this.alwaysChange=!1,$p.__super.call(this)}$_($p,"laya.webgl.resource.WebGLCanvas",$r);var $U=$p.prototype;return $U.getCanvas=function(){return this._canvas},$U.clear=function(){this._ctx&&this._ctx.clear()},$U.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$U._setContext=function($V){this._ctx=$V},$U.getContext=function($V,$U){return this._ctx?this._ctx:this._ctx=$p._createContext(this)},$U.size=function($V,$U){this._w==$V&&this._h==$U||(this._w=$V,this._h=$U,this._ctx&&this._ctx.size($V,$U),this._canvas&&(this._canvas.height=$U,this._canvas.width=$V))},$U.activeResource=function($V){void 0===$V&&($V=!1),this._source||this.recreateResource()},$U.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$U.disposeResource=function(){this._source&&!this.iscpuSource&&($LV.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$U.createWebGlTexture=function(){var $V=$LV.mainContext;this._canvas;var $U=this._source=$V.createTexture();this.iscpuSource=!1;var $r=$dV.curBindTexTarget,$s=$dV.curBindTexValue;$dV.bindTexture($V,3553,$U),$V.pixelStorei(37440,this.flipY?1:0),$p.premulAlpha&&$V.pixelStorei(37441,!0),$V.texImage2D(3553,0,6408,6408,5121,this._imgData),$p.premulAlpha&&$V.pixelStorei(37441,!1),$V.texParameteri(3553,10240,9729),$V.texParameteri(3553,10241,9729),$V.texParameteri(3553,10242,33071),$V.texParameteri(3553,10243,33071),$V.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$r&&$s&&$dV.bindTexture($V,$r,$s)},$U.reloadCanvasData=function(){var $V=$LV.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $U=$dV.curBindTexTarget,$r=$dV.curBindTexValue;$dV.bindTexture($V,3553,this._source),$p.premulAlpha&&$V.pixelStorei(37441,!0),$V.texImage2D(3553,0,6408,6408,5121,this._imgData),$p.premulAlpha&&$V.pixelStorei(37441,!1),$V.pixelStorei(37440,0),$U&&$r&&$dV.bindTexture($V,$U,$r)},$U.texSubImage2D=function($V,$U,$r){var $s=$LV.mainContext,$p=$dV.curBindTexTarget,$c=$dV.curBindTexValue;$dV.bindTexture($s,3553,this._source),$s.pixelStorei(37441,!0),$s.texSubImage2D(3553,0,$U,$r,6408,5121,$V._source),$s.pixelStorei(37441,!1),$p&&$c&&$dV.bindTexture($s,$p,$c)},$U.toBase64=function($V,$U,$r){var $s=null;this._canvas&&($s=this._canvas.toDataURL($V,$U)),$r.call(this,$s)},$s(0,$U,"context",function(){return this._ctx}),$s(0,$U,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$s(0,$U,"asBitmap",null,function($V){this._ctx&&(this._ctx.asBitmap=$V)}),$p._createContext=null,$p.premulAlpha=!1,$p}(),$AV=function($V){function $c($V,$U){this.CborderSize=12,$c.__super.call(this),this.char=$V,this.isSpace=" "===$V,this.xs=$U.scaleX,this.ys=$U.scaleY,this.font=$U.font.toString(),this.fontSize=$U.font.size,this.fillColor=$U.fillColor,this.borderColor=$U.borderColor,this.lineWidth=$U.lineWidth,this.underLine=$U.underLine;var $r,$s=$l.isConchApp;$s?(($r=ConchTextCanvas)._source=ConchTextCanvas,$r._source.canvas=ConchTextCanvas):$r=$G.canvas.source,this.canvas=$r,this._enableMerageInAtlas=!0,this._ctx=$s?$r:this.canvas.getContext("2d",void 0);var $p=$Z.measureText(this.char,this.font);this.cw=$p.width*this.xs,this.ch=($p.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $a(this)}$_($c,"laya.webgl.resource.WebGLCharImage",$r);var $U=$c.prototype;return $k.imps($U,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$U.active=function(){this.texture.active()},$U.recreateResource=function(){var $V=$l.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$V){var $U=this.fontSize;1==this.xs&&1==this.ys||($U=parseInt($U*(this.xs>this.ys?this.xs:this.ys)+""));var $r="normal 100 "+this.font;$r=$r.replace($c._fontSizeReg,$U),this.borderColor&&($r+=" 1 "+this.borderColor),this._ctx.font=$r,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$m.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $s=this._ctx.measureText(this.char);$s||($s={width:16});var $p=$s.width+1;this._ctx.lineTo($p,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$U.onresize=function($V,$U){this._w=$V,this._h=$U,this._allowMerageInAtlas=!0},$U.clearAtlasSource=function(){},$s(0,$U,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$s(0,$U,"atlasSource",function(){return this.canvas}),$s(0,$U,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($V){this._enableMerageInAtlas=$V}),$c.createOneChar=function($V,$U){return new $c($V,$U)},$c._fontSizeReg=new RegExp("\\d+(?=px)","g"),$c}(),$XV=function($V){function $t($V,$U,$r,$s,$p,$c,$R,$T,$N){void 0===$r&&($r=6408),void 0===$s&&($s=5121),void 0===$p&&($p=34041),void 0===$c&&($c=!1),void 0===$R&&($R=!1),void 0===$T&&($T=-1),void 0===$N&&($N=1),$t.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$V,this._h=$U,this._surfaceFormat=$r,this._surfaceType=$s,this._depthStencilFormat=$p,this._mipMap=$c,this._repeat=$R,this._minFifter=$T,this._magFifter=$N}$_($t,"laya.webgl.resource.WebGLRenderTarget",$r);var $U=$t.prototype;return $U.recreateResource=function(){var $V=$LV.mainContext;this._frameBuffer||(this._frameBuffer=$V.createFramebuffer()),this._source||(this._source=$V.createTexture());var $U=$dV.curBindTexTarget,$r=$dV.curBindTexValue;$dV.bindTexture($V,3553,this._source),$V.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $s=this._minFifter,$p=this._magFifter,$c=this._repeat?10497:33071,$R=$b.isPOT(this._w,this._h);if($R?(this._mipMap?-1!==$s||($s=9987):-1!==$s||($s=9729),-1!==$p||($p=9729),$V.texParameteri(3553,10241,$s),$V.texParameteri(3553,10240,$p),$V.texParameteri(3553,10242,$c),$V.texParameteri(3553,10243,$c),this._mipMap&&$V.generateMipmap(3553)):(-1!==$s||($s=9729),-1!==$p||($p=9729),$V.texParameteri(3553,10241,$s),$V.texParameteri(3553,10240,$p),$V.texParameteri(3553,10242,33071),$V.texParameteri(3553,10243,33071)),$V.bindFramebuffer(36160,this._frameBuffer),$V.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$V.createRenderbuffer()),$V.bindRenderbuffer(36161,this._depthStencilBuffer),$V.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$V.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$V.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$V.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$V.bindFramebuffer(36160,null),$U&&$r&&$dV.bindTexture($V,$U,$r),$V.bindRenderbuffer(36161,null),$R&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$U.disposeResource=function(){this._frameBuffer&&($LV.mainContext.deleteTexture(this._source),$LV.mainContext.deleteFramebuffer(this._frameBuffer),$LV.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$s(0,$U,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$s(0,$U,"frameBuffer",function(){return this._frameBuffer}),$t}(),$eV=function($V){function $T($V,$U,$r,$s,$p,$c,$R){this.offsetX=0,this.offsetY=0,$T.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$c,this.canvas=$V,this._ctx=$V.getContext("2d",void 0),this._w=$s,this._h=$p,this.offsetX=$U,this.offsetY=$r,this.src=$R,this._enableMerageInAtlas=!0,$J.enabled&&this._w<$J.atlasLimitWidth&&this._h<$J.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$_($T,"laya.webgl.resource.WebGLSubImage",$r);var $U=$T.prototype;return $k.imps($U,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$U.size=function($V,$U){this._w=$V,this._h=$U,this._ctx&&this._ctx.size($V,$U),this.canvas&&(this.canvas.height=$U,this.canvas.width=$V)},$U.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$U.createWebGlTexture=function(){var $V=$LV.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $U=this._source=$V.createTexture(),$r=$dV.curBindTexTarget,$s=$dV.curBindTexValue;$dV.bindTexture($V,3553,$U),$V.pixelStorei(37441,!0),$V.texImage2D(3553,0,6408,6408,5121,this.canvas),$V.pixelStorei(37441,!1);var $p=this.minFifter,$c=this.magFifter,$R=this.repeat?10497:33071,$T=$b.isPOT(this.width,this.height);$T?(this.mipmap?-1!==$p||($p=9987):-1!==$p||($p=9729),-1!==$c||($c=9729),$V.texParameteri(3553,10240,$c),$V.texParameteri(3553,10241,$p),$V.texParameteri(3553,10242,$R),$V.texParameteri(3553,10243,$R),this.mipmap&&$V.generateMipmap(3553)):(-1!==$p||($p=9729),-1!==$c||($c=9729),$V.texParameteri(3553,10241,$p),$V.texParameteri(3553,10240,$c),$V.texParameteri(3553,10242,33071),$V.texParameteri(3553,10243,33071)),$r&&$s&&$dV.bindTexture($V,$r,$s),this.canvas=null,$T&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$U.disposeResource=function(){$J.enabled&&this._allowMerageInAtlas||!this._source||($LV.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$U.clearAtlasSource=function(){},$s(0,$U,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$s(0,$U,"atlasSource",function(){return this.canvas}),$s(0,$U,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($V){this._allowMerageInAtlas=$V}),$T}(),$FV=function($V){function $t($V,$U,$r,$s){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$t.__super.call(this),!$V||!$U)throw"Shader Error";this._id=++$t._count,this._vs=$V,this._ps=$U,this._nameMap=$s||{},null!=$r&&($t.sharders[$r]=this)}$_($t,"laya.webgl.shader.Shader",$ZV);var $U=$t.prototype;return $U.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$U.disposeResource=function(){$LV.mainContext.deleteShader(this._vshader),$LV.mainContext.deleteShader(this._pshader),$LV.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$U._compile=function(){if(!$LV.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $V=[this._vs,this._ps],$U=$LV.mainContext;if(this._program=$U.createProgram(),this._vshader=$t._createShader($U,$V[0],35633),this._pshader=$t._createShader($U,$V[1],35632),$U.attachShader(this._program,this._vshader),$U.attachShader(this._program,this._pshader),$U.linkProgram(this._program),!$l.isConchApp&&!$U.getProgramParameter(this._program,35714))throw $U.getProgramInfoLog(this._program);var $r,$s,$p=0,$c=0;for($c=$l.isConchApp?$U.getProgramParameterEx(this._vs,this._ps,"",35721):$U.getProgramParameter(this._program,35721),$p=0;$p<$c;$p++){var $R=null;$r={vartype:"attribute",glfun:null,ivartype:0,attrib:$R=$l.isConchApp?$U.getActiveAttribEx(this._vs,this._ps,"",$p):$U.getActiveAttrib(this._program,$p),location:$U.getAttribLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($r)}var $T=0;for($T=$l.isConchApp?$U.getProgramParameterEx(this._vs,this._ps,"",35718):$U.getProgramParameter(this._program,35718),$p=0;$p<$T;$p++){var $N=null;$N=$l.isConchApp?$U.getActiveUniformEx(this._vs,this._ps,"",$p):$U.getActiveUniform(this._program,$p),0<($r={vartype:"uniform",glfun:null,ivartype:1,attrib:$R,location:$U.getUniformLocation(this._program,$N.name),name:$N.name,type:$N.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($r.name=$r.name.substr(0,$r.name.length-3),$r.isArray=!0,$r.location=$U.getUniformLocation(this._program,$r.name)),this._params.push($r)}for($p=0,$s=this._params.length;$p<$s;$p++)if(($r=this._params[$p]).indexOfParams=$p,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,$r.name=this._nameMap[$r.codename]?this._nameMap[$r.codename]:$r.codename,(this._paramsMap[$r.name]=$r)._this=this,$r.uploadedValue=[],"attribute"!==$r.vartype)switch($r.type){case 5124:$r.fun=$r.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$r.fun=$r.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$r.fun=$r.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$r.fun=$r.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$r.fun=$r.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$r.fun=this._uniform_sampler2D;break;case 35680:$r.fun=this._uniform_samplerCube;break;case 35676:$r.glfun=$U.uniformMatrix4fv,$r.fun=this._uniformMatrix4fv;break;case 35670:$r.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $r.fun=this._attribute}},$U.getUniform=function($V){return this._paramsMap[$V]},$U._attribute=function($V,$U){var $r=$LV.mainContext,$s=$$V._enableAtributes,$p=$V.location;return $s[$p]||$r.enableVertexAttribArray($p),$r.vertexAttribPointer($p,$U[0],$U[1],$U[2],$U[3],$U[4]+this._offset),$s[$p]=$$V._bindVertexBuffer,1},$U._uniform1f=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U?($LV.mainContext.uniform1f($V.location,$r[0]=$U),1):0},$U._uniform1fv=function($V,$U){if($U.length<4){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($LV.mainContext.uniform1fv($V.location,$U),$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3],1):0}return $LV.mainContext.uniform1fv($V.location,$U),1},$U._uniform_vec2=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]?($LV.mainContext.uniform2f($V.location,$r[0]=$U[0],$r[1]=$U[1]),1):0},$U._uniform_vec2v=function($V,$U){if($U.length<2){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($LV.mainContext.uniform2fv($V.location,$U),$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3],1):0}return $LV.mainContext.uniform2fv($V.location,$U),1},$U._uniform_vec3=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]?($LV.mainContext.uniform3f($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2]),1):0},$U._uniform_vec3v=function($V,$U){return $LV.mainContext.uniform3fv($V.location,$U),1},$U._uniform_vec4=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($LV.mainContext.uniform4f($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3]),1):0},$U._uniform_vec4v=function($V,$U){return $LV.mainContext.uniform4fv($V.location,$U),1},$U._uniformMatrix2fv=function($V,$U){return $LV.mainContext.uniformMatrix2fv($V.location,!1,$U),1},$U._uniformMatrix3fv=function($V,$U){return $LV.mainContext.uniformMatrix3fv($V.location,!1,$U),1},$U._uniformMatrix4fv=function($V,$U){return $LV.mainContext.uniformMatrix4fv($V.location,!1,$U),1},$U._uniform1i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U?($LV.mainContext.uniform1i($V.location,$r[0]=$U),1):0},$U._uniform1iv=function($V,$U){return $LV.mainContext.uniform1iv($V.location,$U),1},$U._uniform_ivec2=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]?($LV.mainContext.uniform2i($V.location,$r[0]=$U[0],$r[1]=$U[1]),1):0},$U._uniform_ivec2v=function($V,$U){return $LV.mainContext.uniform2iv($V.location,$U),1},$U._uniform_vec3i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]?($LV.mainContext.uniform3i($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2]),1):0},$U._uniform_vec3vi=function($V,$U){return $LV.mainContext.uniform3iv($V.location,$U),1},$U._uniform_vec4i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($LV.mainContext.uniform4i($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3]),1):0},$U._uniform_vec4vi=function($V,$U){return $LV.mainContext.uniform4iv($V.location,$U),1},$U._uniform_sampler2D=function($V,$U){var $r=$LV.mainContext,$s=$V.uploadedValue;return null==$s[0]?($s[0]=this._curActTexIndex,$r.uniform1i($V.location,this._curActTexIndex),$r.activeTexture($t._TEXTURES[this._curActTexIndex]),$dV.bindTexture($r,3553,$U),this._curActTexIndex++,1):($r.activeTexture($t._TEXTURES[$s[0]]),$dV.bindTexture($r,3553,$U),0)},$U._uniform_samplerCube=function($V,$U){var $r=$LV.mainContext,$s=$V.uploadedValue;return null==$s[0]?($s[0]=this._curActTexIndex,$r.uniform1i($V.location,this._curActTexIndex),$r.activeTexture($t._TEXTURES[this._curActTexIndex]),$dV.bindTexture($r,34067,$U),this._curActTexIndex++,1):($r.activeTexture($t._TEXTURES[$s[0]]),$dV.bindTexture($r,34067,$U),0)},$U._noSetValue=function($V){console.log("no....:"+$V.name)},$U.uploadOne=function($V,$U){this.activeResource(),$dV.UseProgram(this._program);var $r=this._paramsMap[$V];$r.fun.call(this,$r,$U)},$U.uploadTexture2D=function($V){$z.shaderCall++;var $U=$LV.mainContext;$U.activeTexture(33984),$dV.bindTexture($U,3553,$V)},$U.uploadTexture2D1=function($V){$z.shaderCall++;var $U=$LV.mainContext;$U.activeTexture(33985),$dV.bindTexture($U,3553,$V)},$U.upload=function($V,$U){$ZV.activeShader=$ZV.bindShader=this,this._lastUseFrameCount===$z.loopCount||this.activeResource(),$dV.UseProgram(this._program),this._reCompile?($U=this._params,this._reCompile=!1):$U=$U||this._params;$LV.mainContext;for(var $r,$s,$p=$U.length,$c=0,$R=0;$R<$p;$R++)null!==($s=$V[($r=$U[$R]).name])&&($c+=$r.fun.call(this,$r,$s));$z.shaderCall+=$c},$U.uploadArray=function($V,$U,$r){$ZV.activeShader=this,($ZV.bindShader=this).activeResource(),$dV.UseProgram(this._program);this._params;for(var $s,$p,$c=0,$R=$U-2;0<=$R;$R-=2)($p=this._paramsMap[$V[$R]])&&null!=($s=$V[$R+1])&&($r&&$r[$p.name]&&$r[$p.name].bind(),$c+=$p.fun.call(this,$p,$s));$z.shaderCall+=$c},$U.getParams=function(){return this._params},$t.getShader=function($V){return $t.sharders[$V]},$t.create=function($V,$U,$r,$s){return new $t($V,$U,$r,$s)},$t.withCompile=function($V,$U,$r,$s){if($r&&$t.sharders[$r])return $t.sharders[$r];var $p=$t._preCompileShader[2e-4*$V];if(!$p)throw new Error("withCompile shader err!"+$V);return $p.createShader($U,$r,$s)},$t.withCompile2D=function($V,$U,$r,$s,$p){if($s&&$t.sharders[$s])return $t.sharders[$s];var $c=$t._preCompileShader[2e-4*$V+$U];if(!$c)throw new Error("withCompile shader err!"+$V+" "+$U);return $c.createShader($r,$s,$p)},$t.addInclude=function($V,$U){$OV.addInclude($V,$U)},$t.preCompile=function($V,$U,$r,$s){var $p=2e-4*$V;$t._preCompileShader[$p]=new $OV($p,$U,$r,$s)},$t.preCompile2D=function($V,$U,$r,$s,$p){var $c=2e-4*$V+$U;$t._preCompileShader[$c]=new $OV($c,$r,$s,$p)},$t._createShader=function($V,$U,$r){var $s=$V.createShader($r);return $V.shaderSource($s,$U),$V.compileShader($s),$s},$t._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$t._count=0,$t._preCompileShader={},$t.SHADERNAME2ID=2e-4,$t.sharders=(($t.sharders=[]).length=32,$t.sharders),$R($t,["nameKey",function(){return this.nameKey=new $E}]),$t}(),$gV=function($V){function $U(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$U.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$_($U,"laya.webgl.utils.Buffer2D",$V);var $r=$U.prototype;return $r.needSize=function($V){var $U=this._byteLength;if($V){var $r=this._byteLength+$V;$r<=this._buffer.byteLength||this._resizeBuffer($r<<1,!0),this._byteLength=$r}return $U},$r._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$z.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$$V._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$$V._gl.bufferSubData(this._bufferType,0,this._buffer)},$r._bufferSubData=function($V,$U,$r){if(void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$z.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$$V._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$U||$r){var $s=this._buffer.slice($U,$r);$$V._gl.bufferSubData(this._bufferType,$V,$s)}else $$V._gl.bufferSubData(this._bufferType,$V,this._buffer)},$r._checkArrayUse=function(){},$r._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$r._bind_subUpload=function($V,$U,$r){return void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($V,$U,$r),!0)},$r._resizeBuffer=function($V,$U){if($V<this._buffer.byteLength)return this;if(this.memorySize=$V,$U&&this._buffer&&0<this._buffer.byteLength){var $r=new ArrayBuffer($V);new Uint8Array($r).set(new Uint8Array(this._buffer),0),this._buffer=$r}else this._buffer=new ArrayBuffer($V);return this._checkArrayUse(),this._upload=!0,this},$r.append=function($V){this._upload=!0;var $U,$r;$U=$V.byteLength,$V instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$U,!0),$r=new Uint8Array(this._buffer,this._byteLength)):$V instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$U,!0),$r=new Uint16Array(this._buffer,this._byteLength)):$V instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$U,!0),$r=new Float32Array(this._buffer,this._byteLength)),$r.set($V,0),this._byteLength+=$U,this._checkArrayUse()},$r.appendU16Array=function($V,$U){this._resizeBuffer(this._byteLength+2*$U,!0);for(var $r=new Uint16Array(this._buffer,this._byteLength,$U),$s=0;$s<$U;$s++)$r[$s]=$V[$s];this._byteLength+=2*$U,this._checkArrayUse()},$r.appendEx=function($V,$U){this._upload=!0;var $r;$r=$V.byteLength,this._resizeBuffer(this._byteLength+$r,!0),new $U(this._buffer,this._byteLength).set($V,0),this._byteLength+=$r,this._checkArrayUse()},$r.appendEx2=function($V,$U,$r,$s){void 0===$s&&($s=1),this._upload=!0;var $p,$c;$p=$r*$s,this._resizeBuffer(this._byteLength+$p,!0),$c=new $U(this._buffer,this._byteLength);var $R=0;for($R=0;$R<$r;$R++)$c[$R]=$V[$R];this._byteLength+=$p,this._checkArrayUse()},$r.getBuffer=function(){return this._buffer},$r.setNeedUpload=function(){this._upload=!0},$r.getNeedUpload=function(){return this._upload},$r.upload=function(){var $V=this._bind_upload();return $$V._gl.bindBuffer(this._bufferType,null),$$V._bindActive[this._bufferType]=null,$ZV.activeShader=null,$V},$r.subUpload=function($V,$U,$r){void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0);var $s=this._bind_subUpload();return $$V._gl.bindBuffer(this._bufferType,null),$$V._bindActive[this._bufferType]=null,$ZV.activeShader=null,$s},$r.disposeResource=function(){$V.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$r.clear=function(){this._byteLength=0,this._upload=!0},$s(0,$r,"bufferLength",function(){return this._buffer.byteLength}),$s(0,$r,"byteLength",null,function($V){this._byteLength!==$V&&($V<=this._buffer.byteLength||this._resizeBuffer(2*$V+256,!0),this._byteLength=$V)}),$U.__int__=function($V){$CV.QuadrangleIB=$CV.create(35044),$hV.fillIBQuadrangle($CV.QuadrangleIB,16)},$U.FLOAT32=4,$U.SHORT=2,$U}($$V),$vV=(function($U){function $r($V){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$r.__super.call(this,9)}$_($r,"laya.webgl.shader.d2.value.GlowSV",$U);var $V=$r.prototype;$V.setValue=function($V){$U.prototype.setValue.call(this,$V)},$V.clear=function(){$U.prototype.clear.call(this)}}($iV),function($V){function $U($V){$U.__super.call(this,64),this.defines.add(64)}$_($U,"laya.webgl.shader.d2.value.TextSV",$V);var $r=$U.prototype;return $r.release=function(){($U.pool[$U._length++]=this).clear()},$r.clear=function(){$V.prototype.clear.call(this)},$U.create=function(){return $U._length?$U.pool[--$U._length]:new $U(null)},$U.pool=[],$U._length=0,$U}($iV)),$YV=function($V){function $p($V,$U,$r,$s){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$p.__super.call(this,$V,$U,$r,$s)}$_($p,"laya.webgl.shader.d2.Shader2X",$V);var $U=$p.prototype;return $U.upload2dQuick1=function($V){this.upload($V,this._params2dQuick1||this._make2dQuick1())},$U._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $V,$U=this._params,$r=0,$s=$U.length;$r<$s;$r++)$V=$U[$r],($l.isFlash||"size"!==$V.name&&"position"!==$V.name&&"texcoord"!==$V.name)&&this._params2dQuick1.push($V)}return this._params2dQuick1},$U.disposeResource=function(){$V.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$U.upload2dQuick2=function($V){this.upload($V,this._params2dQuick2||this._make2dQuick2())},$U._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $V,$U=this._params,$r=0,$s=$U.length;$r<$s;$r++)$V=$U[$r],($l.isFlash||"size"!==$V.name)&&this._params2dQuick2.push($V)}return this._params2dQuick2},$p.create=function($V,$U,$r,$s){return new $p($V,$U,$r,$s)},$p}($FV),$CV=function($V){function $U($V){this._uint8Array=null,this._uint16Array=null,void 0===$V&&($V=35044),$U.__super.call(this),this._bufferUsage=$V,this._bufferType=34963,$l.isFlash||(this._buffer=new ArrayBuffer(8))}$_($U,"laya.webgl.utils.IndexBuffer2D",$gV);var $r=$U.prototype;return $r._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$r.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$r.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$r.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$U.QuadrangleIB=null,$U.create=function($V){return void 0===$V&&($V=35044),new $U($V)},$U}(),$fV=function($V){function $r($V,$U){this._floatArray32=null,this._vertexStride=0,$r.__super.call(this),this._vertexStride=$V,this._bufferUsage=$U,this._bufferType=34962,$l.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$_($r,"laya.webgl.utils.VertexBuffer2D",$V);var $U=$r.prototype;return $U.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$U.bind=function($V){$V&&$V._bind(),this._bind()},$U.insertData=function($V,$U){this.getFloat32Array().set($V,$U),this._upload=!0},$U.bind_upload=function($V){$V._bind_upload()||$V._bind(),this._bind_upload()||this._bind()},$U._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$U.disposeResource=function(){$V.prototype.disposeResource.call(this)},$U.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$s(0,$U,"vertexStride",function(){return this._vertexStride}),$r.create=function($V,$U){return void 0===$U&&($U=35048),new $r($V,$U)},$r}($gV),$VU=function($V){function $T($V,$U,$r,$s,$p,$c){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$r&&($r=6408),void 0===$s&&($s=!0),$T.__super.call(this,$V,$U),$V){if(this._format=$r,this._mipmap=$s,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $V)this._url=$V,this._src=$V,this._image=new $G.window.Image,$U&&($U.onload&&(this.onload=$U.onload),$U.onerror&&(this.onerror=$U.onerror),$U.onCreate&&$U.onCreate(this)),this._image.crossOrigin=$V&&0==$V.indexOf("data:")?null:"",$V&&(this._image.src=$V);else if($V instanceof ArrayBuffer){this._src=$U,this._url=this._src;var $R=new $N($V);$R.readUTFBytes(4),$R.readUTFBytes(2),$R.getInt16();$R.endian="bigEndian",this._w=$R.getInt16(),this._h=$R.getInt16();$R.getInt16(),$R.getInt16();this._image=new Uint8Array($V,$R.pos),this._format=$LV.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$J.enabled&&this._w<$J.atlasLimitWidth&&this._h<$J.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($V instanceof Uint8Array))return this._src=$U,this._url=this._src,this._image=$V.source||$V,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$U,this._url=this._src,this._w=$p,this._h=$c,this._image=$V,this._format=0===$r?$V.byteLength/($p*$c)==4?6408:6407:$r}this._$5__enableMerageInAtlas=!0}}$_($T,"laya.webgl.resource.WebGLImage",$u);var $U=$T.prototype;return $k.imps($U,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$U._init_=function($V,$U){},$U._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $V=$LV.mainContext,$U=this._source=$V.createTexture(),$r=$dV.curBindTexTarget,$s=$dV.curBindTexValue;$dV.bindTexture($V,3553,$U);var $p=this.minFifter,$c=this.magFifter,$R=this.repeat?10497:33071,$T=$b.isPOT(this._w,this._h),$N=!1;switch($T?(this.mipmap?-1!==$p||($p=9987):-1!==$p||($p=9729),-1!==$c||($c=9729),$V.texParameteri(3553,10241,$p),$V.texParameteri(3553,10240,$c),$V.texParameteri(3553,10242,$R),$V.texParameteri(3553,10243,$R),this.mipmap&&$V.generateMipmap(3553)):(-1!==$p||($p=9729),-1!==$c||($c=9729),$V.texParameteri(3553,10241,$p),$V.texParameteri(3553,10240,$c),$V.texParameteri(3553,10242,33071),$V.texParameteri(3553,10243,33071)),$V.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$V.pixelStorei($V.UNPACK_ALIGNMENT,1),$V.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$V.pixelStorei($V.UNPACK_ALIGNMENT,1),$V.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$N=!0,$V.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $LV.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$N=!0,$V.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$V.pixelStorei(37441,!1),$r&&$s&&$dV.bindTexture($V,$r,$s),this.uri||(this.uri=this._url),$N?this.memorySize=this._image.length:$T&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$U.recreateResource=function(){var $V=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $U=this;this._image=new $G.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($U._needReleaseAgain)return $U._needReleaseAgain=!1,$U._image.onload=null,void($U._image=null);$U._allowMerageInAtlas&&$U._enableMerageInAtlas?($V.memorySize=0,$V._recreateLock=!1):$U._createWebGlTexture(),$U.completeCreate()},this._image.src=this._src}},$U.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$LV.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$U.onresize=function(){this._w=this._image.width,this._h=this._image.height,$J.enabled&&this._w<$J.atlasLimitWidth&&this._h<$J.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$U.clearAtlasSource=function(){this._image=null},$s(0,$U,"format",function(){return this._format}),$s(0,$U,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($V){this._$5__enableMerageInAtlas=$V}),$s(0,$U,"mipmap",function(){return this._mipmap}),$s(0,$U,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$s(0,$U,"atlasSource",function(){return this._image}),$s(0,$U,"onload",null,function($V){var $U=this;this._onload=$V,this._image&&(this._image.onload=null!=this._onload?function(){$U.onresize(),$U._onload()}:null)}),$s(0,$U,"onerror",null,function($V){var $U=this;this._onerror=$V,this._image&&(this._image.onerror=null!=this._onerror?function(){$U._onerror()}:null)}),$T}();$k.__init([$GV,$o,$yV,$OV])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}}),function($c,$V,$s){$s.un,$s.uns;var $p=$s.static,$R=$s.class,$T=$s.getset,$N=($s.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$q=laya.utils.ClassUtils,$S=(laya.events.Event,laya.utils.HTMLChar),$t=laya.net.Loader,$b=(laya.display.Node,laya.maths.Rectangle),$_=laya.renders.Render,$G=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$u=laya.utils.Stat,$Z=laya.display.Text,$h=laya.resource.Texture,$l=laya.net.URL,$W=laya.utils.Utils,$O=function(){function $G(){}return $R($G,"laya.html.utils.HTMLParse"),$G.parse=function($V,$U,$r){$U=($U="<root>"+($U=$U.replace(/<br>/g,"<br/>"))+"</root>").replace($G.spacePattern,$G.char255);var $s=$W.parseXMLFromString($U);$G._parseXML($V,$s.childNodes[0].childNodes,$r)},$G._parseXML=function($V,$U,$r,$s){var $p=0,$c=0;if($U.join||$U.item)for($p=0,$c=$U.length;$p<$c;++$p)$G._parseXML($V,$U[$p],$r,$s);else{var $R,$T,$N;if(3==$U.nodeType)return void($V instanceof laya.html.dom.HTMLDivElement?(null==$U.nodeName&&($U.nodeName="#text"),$T=$U.nodeName.toLowerCase(),0<($N=$U.textContent.replace(/^\s+|\s+$/g,"")).length&&($R=$q.getInstance($T))&&($V.addChild($R),$R.innerTEXT=$N.replace($G.char255AndOneSpacePattern," "))):0<($N=$U.textContent.replace(/^\s+|\s+$/g,"")).length&&($V.innerTEXT=$N.replace($G.char255AndOneSpacePattern," ")));if("#comment"==($T=$U.nodeName.toLowerCase()))return;if($R=$q.getInstance($T)){($R=$V.addChild($R)).URI=$r,$R.href=$s;var $t=$U.attributes;if($t&&0<$t.length)for($p=0,$c=$t.length;$p<$c;++$p){var $b=$t[$p],$S=$b.nodeName,$_=$b.value;$R._setAttributes($S,$_)}$G._parseXML($R,$U.childNodes,$r,$R.href)}else $G._parseXML($V,$U.childNodes,$r,$s)}},$G.char255=String.fromCharCode(255),$G.spacePattern=/&nbsp;|&#160;/g,$G.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$G}(),$L=function(){function $a(){}return $R($a,"laya.html.utils.Layout"),$a.later=function($V){null==$a._will&&($a._will=[],$s.stage.frameLoop(1,null,function(){if(!($a._will.length<1)){for(var $V=0;$V<$a._will.length;$V++)laya.html.utils.Layout.layout($a._will[$V]);$a._will.length=0}})),$a._will.push($V)},$a.layout=function($V){if(!$V||!$V._style)return null;if(0==(512&$V._style._type))return null;$V.getStyle()._type&=-513;var $U=$a._multiLineLayout($V);return $_.isConchApp&&$V.layaoutCallNative&&$V.layaoutCallNative(),$U},$a._multiLineLayout=function($V){if($Z.RightToLeft)return $a._multiLineLayout2($V);var $U=new Array;$V._addChildsToLayout($U);var $r,$s,$p,$c,$R,$T=0,$N=$U.length,$t=$V._getCSSStyle(),$b=$t.letterSpacing,$S=$t.leading,$_=$t.lineHeight,$G=$t._widthAuto()||!$t.wordWrap,$q=$G?999999:$V.width,$u=($V.height,0),$h=$t.italic?$t.fontSize/3:0,$l=$t._getAlign(),$W=$t._getValign(),$O=0!==$W||0!==$l||0!=$_,$L=0,$d=0,$k=0,$y=0,$D=new Array,$n=$D[0]=new $x,$I=!1,$Q=!1;$n.h=0,$t.italic&&($q-=$t.fontSize/3);var $H=0,$w=!0;function $z(){$n.y=$d,$d+=$n.h+$S,0==$n.h&&($d+=$_),$n.mWidth=$H,$H=0,$n=new $x,$D.push($n),$n.h=0,$I=!($w=!($L=0))}for($T=0;$T<$N;$T++)if(null!=($r=$U[$T]))if($w=!1,$r instanceof laya.html.dom.HTMLBrElement)$z(),$n.y=$d;else{if($r._isChar()){if(($c=$r).isWord)$I=$Q||"\n"===$c.char,$n.wordStartIndex=$n.elements.length;else{if($k=$c.width+$c.style.letterSpacin,0<$D.length&&$q<$L+$k&&0<$n.wordStartIndex){var $E;$E=$n.elements.length-$n.wordStartIndex+1,$n.elements.length=$n.wordStartIndex,$T-=$E,$z();continue}$I=!1,$H+=$c.width}$k=$c.width+$b,$y=$c.height,$Q=!1,($I=$I||$q<$L+$k)&&$z(),$n.minTextHeight=Math.min($n.minTextHeight,$r.height)}else $s=$r._getCSSStyle(),$R=$r,$p=$s.padding,0===$s._getCssFloat()||($O=!0),$I=$Q||$s.lineElement,$k=$R.width*$R._style._tf.scaleX+$p[1]+$p[3]+$b,$y=$R.height*$R._style._tf.scaleY+$p[0]+$p[2],$Q=$s.lineElement,($I=$I||$q<$L+$k&&$s.wordWrap)&&$z();$n.elements.push($r),$n.h=Math.max($n.h,$y),$r.x=$L,$r.y=$d,$L+=$k,$n.w=$L-$b,$n.y=$d,$u=Math.max($L+$h,$u)}else $w||($L+=$a.DIV_ELEMENT_PADDING),$n.wordStartIndex=$n.elements.length;if($d=$n.y+$n.h,$O){var $K=0,$m=$q;for($G&&0<$V.width&&($m=$V.width),$T=0,$N=$D.length;$T<$N;$T++)$D[$T].updatePos(0,$m,$T,$K,$l,$W,$_),$K+=Math.max($_,$D[$T].h+$S);$d=$K}return $G&&($V.width=$u),$d>$V.height&&($V.height=$d),[$u,$d]},$a._multiLineLayout2=function($V){var $U=new Array;$V._addChildsToLayout($U);var $r,$s,$p,$c,$R,$T=0,$N=$U.length,$t=$V._getCSSStyle(),$b=$t.letterSpacing,$S=$t.leading,$_=$t.lineHeight,$G=$t._widthAuto()||!$t.wordWrap,$q=$G?999999:$V.width,$u=($V.height,0),$h=$t.italic?$t.fontSize/3:0,$l=2-$t._getAlign(),$W=$t._getValign(),$O=0!==$W||0!=$l||0!=$_,$L=0,$d=0,$k=0,$y=0,$D=new Array,$n=$D[0]=new $x,$I=!1,$Q=!1;$n.h=0,$t.italic&&($q-=$t.fontSize/3);var $H=0,$w=!0;function $z(){$n.y=$d,$d+=$n.h+$S,0==$n.h&&($d+=$_),$n.mWidth=$H,$H=0,$n=new $x,$D.push($n),$n.h=0,$I=!($w=!($L=0))}for($T=0;$T<$N;$T++)if(null!=($r=$U[$T]))if($w=!1,$r instanceof laya.html.dom.HTMLBrElement)$z(),$n.y=$d;else{if($r._isChar()){if(($c=$r).isWord)$I=$Q||"\n"===$c.char,$n.wordStartIndex=$n.elements.length;else{if(0<$D.length&&$q<$L+$k&&0<$n.wordStartIndex){var $E;$E=$n.elements.length-$n.wordStartIndex+1,$n.elements.length=$n.wordStartIndex,$T-=$E,$z();continue}$I=!1,$H+=$c.width}$k=$c.width+$b,$y=$c.height,$Q=!1,($I=$I||$q<$L+$k)&&$z(),$n.minTextHeight=Math.min($n.minTextHeight,$r.height)}else $s=$r._getCSSStyle(),$R=$r,$p=$s.padding,0===$s._getCssFloat()||($O=!0),$I=$Q||$s.lineElement,$k=$R.width*$R._style._tf.scaleX+$p[1]+$p[3]+$b,$y=$R.height*$R._style._tf.scaleY+$p[0]+$p[2],$Q=$s.lineElement,($I=$I||$q<$L+$k&&$s.wordWrap)&&$z();$n.elements.push($r),$n.h=Math.max($n.h,$y),$r.x=$L,$r.y=$d,$L+=$k,$n.w=$L-$b,$n.y=$d,$u=Math.max($L+$h,$u)}else $w||($L+=$a.DIV_ELEMENT_PADDING),$n.wordStartIndex=$n.elements.length;if($d=$n.y+$n.h,$O){var $K=0,$m=$q;for($T=0,$N=$D.length;$T<$N;$T++)$D[$T].updatePos(0,$m,$T,$K,$l,$W,$_),$K+=Math.max($_,$D[$T].h+$S);$d=$K}for($G&&($V.width=$u),$d>$V.height&&($V.height=$d),$T=0,$N=$D.length;$T<$N;$T++)$D[$T].revertOrder($q);return[$u,$d]},$a._will=null,$a.DIV_ELEMENT_PADDING=0,$a}(),$x=function(){function $V(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$R($V,"laya.html.utils.LayoutLine");var $U=$V.prototype;return $U.updatePos=function($V,$U,$r,$s,$p,$c,$R){var $T,$N=0;0<this.elements.length&&($N=($T=this.elements[this.elements.length-1]).x+$T.width-this.elements[0].x);var $t=0,$b=NaN;1===$p&&($t=($U-$N)/2),2===$p&&($t=$U-$N),0===$R||0!=$c||($c=1);for(var $S=0,$_=this.elements.length;$S<$_;$S++){var $G=($T=this.elements[$S])._getCSSStyle();switch(0!==$t&&($T.x+=$t),$G._getValign()){case 0:$T.y=$s;break;case 1:var $q=0;99999!=this.minTextHeight&&($q=this.minTextHeight);var $u=($q+$R)/2;$u=Math.max($u,this.h),$b=(laya.html.dom.HTMLImageElement,$s+$u-$T.height),$T.y=$b;break;case 2:$T.y=$s+($R-$T.height)}}},$U.revertOrder=function($V){var $U;if(0<this.elements.length){var $r,$s=0;for($r=this.elements.length,$s=0;$s<$r;$s++)($U=this.elements[$s]).x=$V-$U.x-$U.width}},$V}(),$d=function($r){function $U(){this.URI=null,this._href=null,$U.__super.call(this),this._text=$U._EMPTYTEXT,this.setStyle(new $N(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$R($U,"laya.html.dom.HTMLElement",$r);var $V=$U.prototype;return $V.layaoutCallNative=function(){var $V=0;if(this._childs&&0<($V=this._childs.length))for(var $U=0;$U<$V;$U++)this._childs[$U].layaoutCallNative&&this._childs[$U].layaoutCallNative();var $r=this._getWords();$r?laya.html.dom.HTMLElement.fillWords(this,$r,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$V.appendChild=function($V){return this.addChild($V)},$V._getWords2=function(){var $V=this._text.text;if(!$V||0===$V.length)return null;var $U,$r,$s=0,$p=0;if(this._text.drawWords)$r=this._text.drawWords;else{for($p=($U=$V.split(" ")).length-1,$r=[],$s=0;$s<$p;$s++)$r.push($U[$s]," ");0<=$p&&$r.push($U[$p]),this._text.drawWords=$r}var $c,$R=this._text.words;if($R&&$R.length===$r.length)return $R;null===$R&&(this._text.words=$R=[]),$R.length=$r.length;var $T=this.style,$N=$T.font;for($s=0,$p=$r.length;$s<$p;$s++){$c=$W.measureText($r[$s],$N);var $t=$R[$s]=new $S($r[$s],$c.width,$c.height||$T.fontSize,$T);if(1<$t.char.length&&($t.charNum=$t.char),this.href){var $b=new $G;this.addChild($b),$t.setSprite($b)}}return $R},$V._getWords=function(){if(!$Z.CharacterCache)return this._getWords2();var $V=this._text.text;if(!$V||0===$V.length)return null;var $U,$r=this._text.words;if($r&&$r.length===$V.length)return $r;null===$r&&(this._text.words=$r=[]),$r.length=$V.length;for(var $s=this.style,$p=$s.font,$c=0,$R=$V.length;$c<$R;$c++)if($U=$W.measureText($V.charAt($c),$p)){var $T=$r[$c]=new $S($V.charAt($c),$U.width,$U.height||$s.fontSize,$s);if(this.href){var $N=new $G;this.addChild($N),$T.setSprite($N)}}else console.warn("_getWords size is null"+$V.charAt($c),$p);return $r},$V.showLinkSprite=function(){var $V=this._text.words;if($V)for(var $U,$r,$s=[],$p=0;$p<$V.length;$p++)$r=$V[$p],($U=new $G).graphics.drawRect(0,0,$r.width,$r.height,"#ff0000"),$U.width=$r.width,$U.height=$r.height,this.addChild($U),$s.push($U)},$V._layoutLater=function(){var $V=this.style;512&$V._type||($V.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$V.block?($L.later(this),$V._type|=512):this.parent&&this.parent._layoutLater())},$V._setAttributes=function($V,$U){switch($V){case"style":return void this.style.cssText($U);case"class":return void(this.className=$U)}$r.prototype._setAttributes.call(this,$V,$U)},$V.updateHref=function(){if(null!=this._href){var $V=this._getWords();if($V)for(var $U,$r,$s=0;$s<$V.length;$s++)($r=($U=$V[$s]).getSprite())&&($r.size($U.width,$U.height),$r.on("click",this,this.onLinkHandler))}},$V.onLinkHandler=function($V){switch($V.type){case"click":for(var $U=this;$U;)$U.event("link",[this.href]),$U=$U.parent}},$V.formatURL=function($V){return this.URI?$l.formatURL($V,this.URI?this.URI.path:null):$V},$T(0,$V,"href",function(){return this._href},function($V){null!=(this._href=$V)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$T(0,$V,"color",null,function($V){this.style.color=$V}),$T(0,$V,"onClick",null,function($V){$s._runScript("fn=function(event){"+$V+";}"),this.on("click",this,void 0)}),$T(0,$V,"id",null,function($V){$k.document.setElementById($V,this)}),$T(0,$V,"innerTEXT",function(){return this._text.text},function($V){this.text=$V}),$T(0,$V,"style",function(){return this._style}),$T(0,$V,"text",function(){return this._text.text},function($V){this._text==$U._EMPTYTEXT?this._text={text:$V,words:null}:(this._text.text=$V,this._text.words&&(this._text.words.length=0)),$_.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$T(0,$V,"parent",$r.prototype._$get_parent,function($V){if($V instanceof laya.html.dom.HTMLElement){var $U=$V;this.URI||(this.URI=$U.URI),this.style.inherit($U.style)}$s.superSet($G,this,"parent",$V)}),$T(0,$V,"className",null,function($V){this.style.attrs($k.document.styleSheets["."+$V])}),$U.fillWords=function($V,$U,$r,$s,$p,$c,$R){$V.graphics.clear();for(var $T=0,$N=$U.length;$T<$N;$T++){var $t=$U[$T];$V.graphics.fillText($t.char,$t.x+$r,$t.y+$s,$p,$c,"left",$R)}},$U._EMPTYTEXT={text:null,words:null},$U}($G),$U=(function($V){function $U(){$U.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$R($U,"laya.html.dom.HTMLBrElement",$d)}(),function($V){function $U(){this.contextHeight=NaN,this.contextWidth=NaN,$U.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$R($U,"laya.html.dom.HTMLDivElement",$V);var $r=$U.prototype;return $r.appendHTML=function($V){$O.parse(this,$V,this.URI),this.layout()},$r._addChildsToLayout=function($U){var $V=this._getWords();if(null==$V&&0==this._childs.length)return!1;$V&&$V.forEach(function($V){$U.push($V)});for(var $r=!0,$s=0,$p=this._childs.length;$s<$p;$s++){var $c=this._childs[$s];$r?$r=!1:$U.push(null),$c._addToLayout($U)}return!0},$r._addToLayout=function($V){this.layout()},$r.layout=function(){if(this.style){this.style._type|=512;var $V=$L.layout(this);if($V){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $b);var $U=this._$P.mHtmlBounds;$U.x=$U.y=0,$U.width=this.contextWidth=$V[0],$U.height=this.contextHeight=$V[1],this.setBounds($U)}}},$T(0,$r,"height",function(){return this._height?this._height:this.contextHeight},$V.prototype._$set_height),$T(0,$r,"innerHTML",null,function($V){this.destroyChildren(),this.appendHTML($V)}),$T(0,$r,"width",function(){return this._width?this._width:this.contextWidth},function($V){var $U=!1;$U=0===$V?$V!=this._width:$V!=this.width,$s.superSet($d,this,"width",$V),$U&&this.layout()}),$U}($d)),$k=function($V){function $U(){this.all=new Array,this.styleSheets=$N.styleSheets,$U.__super.call(this)}$R($U,"laya.html.dom.HTMLDocument",$d);var $r=$U.prototype;return $r.getElementById=function($V){return this.all[$V]},$r.setElementById=function($V,$U){this.all[$V]=$U},$p($U,["document",function(){return this.document=new $U}]),$U}();(function($V){function $U(){this._tex=null,this._url=null,this._renderArgs=[],$U.__super.call(this),this.style.block=!0}$R($U,"laya.html.dom.HTMLImageElement",$d);var $r=$U.prototype;$r._addToLayout=function($V){!this._style.absolute&&$V.push(this)},$r.render=function($V,$U,$r){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($u.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$V.ctx.drawTexture2($U,$r,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$r.layaoutCallNative=function(){var $V=0;if(this._childs&&0<($V=this._childs.length))for(var $U=0;$U<$V;$U++)this._childs[$U].layaoutCallNative&&this._childs[$U].layaoutCallNative()},$T(0,$r,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($V){this._width!==$V&&(this._width=$V,this._style.width=$V,this.repaint())}),$T(0,$r,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($V){this._height!==$V&&(this._height=$V,this._style.height=$V,this.repaint())}),$r.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$t.clearCache(this,this._url),this._tex=null),$d.prototype.destroy.call(this)},$r.onloaded=function(){var $V=this._style;$V&&!$V.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$V&&!$V.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$_.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$r._loadImageComplete=function($V,$U,$r){if(!this._destroyed)if(null!=$r)if($r instanceof ArrayBuffer){var $s=new DataView($r);new laya.webgl.resource.WebGLImage(new Uint8Array($r,8),$V,0,!1,$s.getUint32(0),$s.getUint32(4));this.onloaded()}else if($r instanceof $h)$t.imgMgrSet[$V]=$U,$c.imgMgrLock($V,$t.imgMgrSet[$V]),this._url=$V,this._tex=$r,$t.keepCache(this,$V),$t.cacheRes($V,this._tex),this.onloaded();else{var $p=-1!=$V.indexOf(".png",$V.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($r,$V,$p,!1,$r.width,$r.height);this.onloaded()}else this.event("error","Load image failed")},$T(0,$r,"src",null,function($V){($V=this.formatURL($V),this._url!=$V)&&(null!=this._tex&&($t.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$V,(this._tex=$t.getRes($V))?($t.keepCache(this,$V),this.onloaded()):$c.imgMgrLoad($V,this._loadImageComplete.bind(this),2,!1))})})(),function($V){function $U(){this.type=null,$U.__super.call(this),this.visible=!1}$R($U,"laya.html.dom.HTMLLinkElement",$V);var $r=$U.prototype;$r._onload=function($V){switch(this.type){case"text/css":$N.parseCSS($V,this.URI)}},$T(0,$r,"href",$V.prototype._$get_href,function($V){var $U=this;$V=this.formatURL($V),this.URI=new $l($V);var $r=new $t;$r.once("complete",null,function($V){$U._onload($V)}),$r.load($V,"text")}),$U._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($d),function($V){function $U(){$U.__super.call(this),this.visible=!1}$R($U,"laya.html.dom.HTMLStyleElement",$V),$T(0,$U.prototype,"text",$V.prototype._$get_text,function($V){$N.parseCSS($V,null)})}($d),function($V){function $U(){$U.__super.call(this),this._getCSSStyle().valign="middle"}$R($U,"laya.html.dom.HTMLIframeElement",$V),$T(0,$U.prototype,"href",$V.prototype._$get_href,function($r){var $s=this;$r=this.formatURL($r);var $V=new $t;$V.once("complete",null,function($V){var $U=$s.URI;$s.URI=new $l($r),$s.innerHTML=$V,!$U||($s.URI=$U)}),$V.load($r,"text")})}($U)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}}),function($p,$V,$u){$u.un,$u.uns;var $s=$u.static,$c=$u.class,$R=$u.getset,$r=($u.__newvec,laya.display.Animation),$h=(laya.utils.Browser,laya.utils.ClassUtils),$T=laya.filters.ColorFilter,$N=laya.utils.Ease,$t=laya.events.Event,$b=(laya.events.EventDispatcher,laya.display.css.Font),$S=laya.display.FrameAnimation,$U=laya.display.Graphics,$_=laya.utils.Handler,$G=laya.display.Input,$W=laya.net.Loader,$q=(laya.display.Node,laya.maths.Point),$l=laya.maths.Rectangle,$O=laya.renders.Render,$L=laya.display.Sprite,$d=laya.display.Text,$k=laya.resource.Texture,$y=laya.utils.Tween,$D=laya.utils.Utils,$n=laya.utils.WeakObject;$u.interface("laya.ui.IItem"),$u.interface("laya.ui.ISelect"),$u.interface("laya.ui.IRender"),$u.interface("laya.ui.IComponent"),$u.interface("laya.ui.IBox","IComponent");var $I=function(){function $V(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $c($V,"laya.ui.LayoutStyle"),$s($V,["EMPTY",function(){return this.EMPTY=new $V}]),$V}(),$Q=function(){function $V(){}return $c($V,"laya.ui.Styles"),$V.labelColor="#000000",$V.buttonStateNum=3,$V.scrollBarMinNum=15,$V.scrollBarDelayTime=500,$s($V,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$V}(),$H=function(){function $p(){}return $c($p,"laya.ui.UIUtils"),$p.fillArray=function($V,$U,$r){var $s=$V.concat();if($U)for(var $p=$U.split(","),$c=0,$R=Math.min($s.length,$p.length);$c<$R;$c++){var $T=$p[$c];$s[$c]="true"==$T||"false"!=$T&&$T,null!=$r&&($s[$c]=$r($T))}return $s},$p.toColor=function($V){return $D.toHexColor($V)},$p.gray=function($V,$U){void 0===$U&&($U=!0),$U?$p.addFilter($V,$p.grayFilter):$p.clearFilter($V,$T)},$p.addFilter=function($V,$U){var $r=$V.filters||[];$r.push($U),$V.filters=$r},$p.clearFilter=function($V,$U){var $r=$V.filters;if(null!=$r&&0<$r.length){for(var $s=$r.length-1;-1<$s;$s--){var $p=$r[$s];$u.__typeof($p,$U)&&$r.splice($s,1)}$V.filters=$r}},$p._getReplaceStr=function($V){return $p.escapeSequence[$V]},$p.adptString=function($V){return $V.replace(/\\(\w)/g,$p._getReplaceStr)},$p.getBindFun=function($V){var $U=$p._funMap.get($V);if(null==$U){var $r='"'+$V+'"',$s="(function(data){if(data==null)return;with(data){try{\nreturn "+($r=$r.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$U=$u._runScript($s),$p._funMap.set($V,$U)}return $U},$s($p,["grayFilter",function(){return this.grayFilter=new $T([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $n}]),$p}(),$w=function(){function $V(){}return $c($V,"UIConfig"),$V.touchScrollEnable=!0,$V.mouseWheelEnable=!0,$V.showButtons=!0,$V.popupBgColor="#000000",$V.popupBgAlpha=.5,$V.closeDialogOnSide=!0,$V}(),$z=function($r){function $l(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$l.__super.call(this),this._weakKeys=[]}$c($l,"laya.ui.AutoBitmap",$r);var $V=$l.prototype;return $V.destroy=function(){if($W.clearObject(this,this._weakKey),this._weakKeys){for(var $V=0,$U=this._weakKeys.length;$V<$U;++$V)$W.clearObject(this,this._weakKeys[$V]);this._weakKeys=null}$r.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$V._setChanged=function(){this._isChanged||(this._isChanged=!0,$u.timer.callLater(this,this.changeSource))},$V.changeSource=function(){this._isChanged=!1;var $V=this._source;if($V&&$V.bitmap){var $U=this.width,$r=this.height,$s=this._sizeGrid,$p=$V.sourceWidth,$c=$V.sourceHeight;if(!$s||$p===$U&&$c===$r)this.cleanByTexture($V,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$U,$r);else{$W.clearObject(this,this._weakKey),$V.$_GID||($V.$_GID=$D.getGID());var $R=$V.$_GID+"."+$U+"."+$r+"."+$s.join("."),$T=$W.findObject($R);if($D.isOKCmdList($T))return this._weakKey=$R,$W.keepObject(this,this._weakKey),void(this.cmds=$T);this.clear();var $N,$t,$b=$s[0],$S=$s[1],$_=$s[2],$G=$s[3],$q=$s[4],$u=!1;if($U==$p&&($G=$S=0),$r==$c&&($b=$_=0),$U<$G+$S){var $h=$U;$u=!0,$U=$G+$S,this.save(),this.clipRect(0,0,$h,$r)}$G&&$b&&($N=$l.getTexture($V,0,0,$G,$b),$t=this._weakKeys[0],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[0]=$N.weakKey),this.drawTexture($N,0,0,$G,$b)):($W.clearObject(this,$t),this._weakKeys[0]="")),$S&&$b&&($N=$l.getTexture($V,$p-$S,0,$S,$b),$t=this._weakKeys[1],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[1]=$N.weakKey),this.drawTexture($N,$U-$S,0,$S,$b)):($W.clearObject(this,$t),this._weakKeys[1]="")),$G&&$_&&($N=$l.getTexture($V,0,$c-$_,$G,$_),$t=this._weakKeys[2],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[2]=$N.weakKey),this.drawTexture($N,0,$r-$_,$G,$_)):($W.clearObject(this,$t),this._weakKeys[2]="")),$S&&$_&&($N=$l.getTexture($V,$p-$S,$c-$_,$S,$_),$t=this._weakKeys[3],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[3]=$N.weakKey),this.drawTexture($N,$U-$S,$r-$_,$S,$_)):($W.clearObject(this,$t),this._weakKeys[3]="")),$b&&($N=$l.getTexture($V,$G,0,$p-$G-$S,$b),$t=this._weakKeys[4],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[4]=$N.weakKey),this.drawBitmap($q,$N,$G,0,$U-$G-$S,$b)):($W.clearObject(this,$t),this._weakKeys[4]="")),$_&&($N=$l.getTexture($V,$G,$c-$_,$p-$G-$S,$_),$t=this._weakKeys[5],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[5]=$N.weakKey),this.drawBitmap($q,$N,$G,$r-$_,$U-$G-$S,$_)):($W.clearObject(this,$t),this._weakKeys[5]="")),$G&&($N=$l.getTexture($V,0,$b,$G,$c-$b-$_),$t=this._weakKeys[6],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[6]=$N.weakKey),this.drawBitmap($q,$N,0,$b,$G,$r-$b-$_)):($W.clearObject(this,$t),this._weakKeys[6]="")),$S&&($N=$l.getTexture($V,$p-$S,$b,$S,$c-$b-$_),$t=this._weakKeys[7],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[7]=$N.weakKey),this.drawBitmap($q,$N,$U-$S,$b,$S,$r-$b-$_)):($W.clearObject(this,$t),this._weakKeys[7]="")),$N=$l.getTexture($V,$G,$b,$p-$G-$S,$c-$b-$_),$t=this._weakKeys[8],$N?($t!=$N.weakKey&&($W.clearObject(this,$t),$W.keepObject(this,$N.weakKey),this._weakKeys[8]=$N.weakKey),this.drawBitmap($q,$N,$G,$b,$U-$G-$S,$r-$b-$_)):($W.clearObject(this,$t),this._weakKeys[8]=""),$u&&this.restore(),this.autoCacheCmd&&!$O.isConchApp&&($W.saveObject($R,this.cmds,null),this._weakKey=$R,$W.keepObject(this,this._weakKey))}this._repaint()}},$V.drawBitmap=function($V,$U,$r,$s,$p,$c){void 0===$p&&($p=0),void 0===$c&&($c=0),$p<.1||$c<.1||(!$V||$U.width==$p&&$U.height==$c?this.drawTexture($U,$r,$s,$p,$c):this.fillTexture($U,$r,$s,$p,$c))},$V.clear=function($V){void 0===$V&&($V=!0),$r.prototype.clear.call(this,!1)},$R(0,$V,"sizeGrid",function(){return this._sizeGrid},function($V){this._sizeGrid=$V,this._setChanged()}),$R(0,$V,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($V){this._width!=$V&&(this._width=$V,this._setChanged())}),$R(0,$V,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($V){this._height!=$V&&(this._height=$V,this._setChanged())}),$R(0,$V,"source",function(){return this._source},function($V){$V?(this._source=$V,this._setChanged()):(this._source=null,this.clear())}),$l.getTexture=function($V,$U,$r,$s,$p){$s<=0&&($s=1),$p<=0&&($p=1),$V.$_GID||($V.$_GID=$D.getGID());var $c=$V.$_GID+"."+$U+"."+$r+"."+$s+"."+$p,$R=$W.findObject($c);if((!$R||!$R.source)&&($R=$k.createFromTexture($V,$U,$r,$s,$p))){if($V.alphaTexture){var $T=$V.width/$V.alphaTexture.width;$R.alphaTexture=$k.createFromTexture($V.alphaTexture,$U/$T,$r/$T,$s/$T,$p/$T)}$W.saveObject($c,$R),$R.weakKey=$c}return $R},$l}($U),$E=(function($V){function $U(){$U.__super.call(this)}$c($U,"laya.ui.UIEvent",$t),$U.SHOW_TIP="showtip",$U.HIDE_TIP="hidetip"}(),function($U){function $V(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$V.__super.call(this),this._layout=$I.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$c($V,"laya.ui.Component",$U);var $r=$V.prototype;return $u.imps($r,{"laya.ui.IComponent":!0}),$r.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$r.preinitialize=function(){},$r.createChildren=function(){},$r.initialize=function(){},$r.callLater=function($V,$U){$u.timer.callLater(this,$V,$U)},$r.runCallLater=function($V){$u.timer.runCallLater(this,$V)},$r.commitMeasure=function(){},$r.changeSize=function(){this.event("resize")},$r.getLayout=function(){return this._layout===$I.EMPTY&&(this._layout=new $I),this._layout},$r._setLayoutEnabled=function($V){this._layout&&this._layout.enable!=$V&&(this._layout.enable=$V,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$r.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$r.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$r.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$r.resetLayoutX=function(){var $V=this._layout;if(isNaN($V.anchorX)||(this.pivotX=$V.anchorX*this.width),this.layoutEnabled){var $U=this.parent;$U&&(isNaN($V.centerX)?isNaN($V.left)?isNaN($V.right)||(this.x=Math.round($U.width-this.displayWidth-$V.right+this.pivotX*this.scaleX)):(this.x=Math.round($V.left+this.pivotX*this.scaleX),isNaN($V.right)||(this.width=($U._width-$V.left-$V.right)/(this.scaleX||.01))):this.x=Math.round(.5*($U.width-this.displayWidth)+$V.centerX+this.pivotX*this.scaleX))}},$r.resetLayoutY=function(){var $V=this._layout;if(isNaN($V.anchorY)||(this.pivotY=$V.anchorY*this.height),this.layoutEnabled){var $U=this.parent;$U&&(isNaN($V.centerY)?isNaN($V.top)?isNaN($V.bottom)||(this.y=Math.round($U.height-this.displayHeight-$V.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($V.top+this.pivotY*this.scaleY),isNaN($V.bottom)||(this.height=($U._height-$V.top-$V.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($U.height-this.displayHeight)+$V.centerY+this.pivotY*this.scaleY))}},$r.onMouseOver=function($V){$u.stage.event("showtip",this._toolTip)},$r.onMouseOut=function($V){$u.stage.event("hidetip",this._toolTip)},$R(0,$r,"displayWidth",function(){return this.width*this.scaleX}),$R(0,$r,"width",function(){return this._width?this._width:this.measureWidth},function($V){this._width!=$V&&(this._width=$V,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$R(0,$r,"measureWidth",function(){var $V=0;this.commitMeasure();for(var $U=this.numChildren-1;-1<$U;$U--){var $r=this.getChildAt($U);$r.visible&&($V=Math.max($r.x+$r.width*$r.scaleX,$V))}return $V}),$R(0,$r,"displayHeight",function(){return this.height*this.scaleY}),$R(0,$r,"height",function(){return this._height?this._height:this.measureHeight},function($V){this._height!=$V&&(this._height=$V,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$R(0,$r,"dataSource",function(){return this._dataSource},function($V){for(var $U in this._dataSource=$V,this._dataSource)this.hasOwnProperty($U)&&"function"!=typeof this[$U]&&(this[$U]=this._dataSource[$U])}),$R(0,$r,"scaleY",$U.prototype._$get_scaleY,function($V){$u.superGet($L,this,"scaleY")!=$V&&($u.superSet($L,this,"scaleY",$V),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$R(0,$r,"measureHeight",function(){var $V=0;this.commitMeasure();for(var $U=this.numChildren-1;-1<$U;$U--){var $r=this.getChildAt($U);$r.visible&&($V=Math.max($r.y+$r.height*$r.scaleY,$V))}return $V}),$R(0,$r,"scaleX",$U.prototype._$get_scaleX,function($V){$u.superGet($L,this,"scaleX")!=$V&&($u.superSet($L,this,"scaleX",$V),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$R(0,$r,"top",function(){return this._layout.top},function($V){$V!=this._layout.top&&(this.getLayout().top=$V,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$r,"bottom",function(){return this._layout.bottom},function($V){$V!=this._layout.bottom&&(this.getLayout().bottom=$V,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$r,"left",function(){return this._layout.left},function($V){$V!=this._layout.left&&(this.getLayout().left=$V,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$r,"right",function(){return this._layout.right},function($V){$V!=this._layout.right&&(this.getLayout().right=$V,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$r,"centerX",function(){return this._layout.centerX},function($V){$V!=this._layout.centerX&&(this.getLayout().centerX=$V,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$r,"centerY",function(){return this._layout.centerY},function($V){$V!=this._layout.centerY&&(this.getLayout().centerY=$V,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$r,"anchorX",function(){return this._layout.anchorX},function($V){$V!=this._layout.anchorX&&(this.getLayout().anchorX=$V,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$R(0,$r,"anchorY",function(){return this._layout.anchorY},function($V){$V!=this._layout.anchorY&&(this.getLayout().anchorY=$V,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$R(0,$r,"tag",function(){return this._tag},function($V){this._tag=$V}),$R(0,$r,"toolTip",function(){return this._toolTip},function($V){this._toolTip!=$V&&(null!=(this._toolTip=$V)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$R(0,$r,"comXml",function(){return this._comXml},function($V){this._comXml=$V}),$R(0,$r,"gray",function(){return this._gray},function($V){$V!==this._gray&&(this._gray=$V,$H.gray(this,$V))}),$R(0,$r,"disabled",function(){return this._disabled},function($V){$V!==this._disabled&&(this.gray=this._disabled=$V,this.mouseEnabled=!$V)}),$V}($L)),$K=function($V){function $U(){this.lockLayer=null,this.popupEffect=function($V){$V.scale(1,1),$y.from($V,{x:$u.stage.width/2,y:$u.stage.height/2,scaleX:0,scaleY:0},300,$N.backOut,$_.create(this,this.doOpen,[$V]))},this.closeEffect=function($V,$U){$y.to($V,{x:$u.stage.width/2,y:$u.stage.height/2,scaleX:0,scaleY:0},300,$N.strongOut,$_.create(this,this.doClose,[$V,$U]))},$U.__super.call(this),this.maskLayer=new $L,this.popupEffectHandler=$_.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$_.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$u.stage.addChild(this),$u.stage.on("resize",this,this._onResize),$w.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$c($U,"laya.ui.DialogManager",$L);var $r=$U.prototype;return $r._closeOnSide=function(){var $V=this.getChildAt(this.numChildren-1);$V instanceof laya.ui.Dialog&&$V.close("side")},$r.setLockView=function($V){this.lockLayer||(this.lockLayer=new $m,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($u.stage.width,$u.stage.height)),this.lockLayer.removeChildren(),$V&&($V.centerX=$V.centerY=0,this.lockLayer.addChild($V))},$r._onResize=function($V){var $U=this.maskLayer.width=$u.stage.width,$r=this.maskLayer.height=$u.stage.height;this.lockLayer&&this.lockLayer.size($U,$r),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$U,$r,$w.popupBgColor),this.maskLayer.alpha=$w.popupBgAlpha;for(var $s=this.numChildren-1;-1<$s;$s--){var $p=this.getChildAt($s);$p.popupCenter&&this._centerDialog($p)}},$r._centerDialog=function($V){$V.x=Math.round(($u.stage.width-$V.width>>1)+$V.pivotX),$V.y=Math.round(($u.stage.height-$V.height>>1)+$V.pivotY)},$r.open=function($V,$U,$r){void 0===$U&&($U=!1),void 0===$r&&($r=!1),$U&&this._closeAll(),$V.popupCenter&&this._centerDialog($V),this.addChild($V),($V.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$r&&null!=$V.popupEffect?$V.popupEffect.runWith($V):this.doOpen($V),this.event("open")},$r.doOpen=function($V){$V.onOpened()},$r.lock=function($V){this.lockLayer&&($V?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$r.close=function($V,$U,$r){void 0===$r&&($r=!1),$r&&null!=$V.closeEffect?$V.closeEffect.runWith([$V,$U]):this.doClose($V,$U),this.event("close")},$r.doClose=function($V,$U){$V.removeSelf(),$V.isModal&&this._checkMask(),$V.closeHandler&&$V.closeHandler.runWith($U),$V.onClosed($U)},$r.closeAll=function(){this._closeAll(),this.event("close")},$r._closeAll=function(){for(var $V=this.numChildren-1;-1<$V;$V--){var $U=this.getChildAt($V);$U&&null!=$U.close&&this.doClose($U)}},$r.getDialogsByGroup=function($V){for(var $U=[],$r=this.numChildren-1;-1<$r;$r--){var $s=this.getChildAt($r);$s&&$s.group===$V&&$U.push($s)}return $U},$r.closeByGroup=function($V){for(var $U=[],$r=this.numChildren-1;-1<$r;$r--){var $s=this.getChildAt($r);$s&&$s.group===$V&&($s.close(),$U.push($s))}return $U},$r._checkMask=function(){this.maskLayer.removeSelf();for(var $V=this.numChildren-1;-1<$V;$V--){var $U=this.getChildAt($V);if($U&&$U.isModal)return void this.addChildAt(this.maskLayer,$V)}},$U}(),$m=function($V){function $U(){$U.__super.call(this)}$c($U,"laya.ui.Box",$V);var $r=$U.prototype;return $u.imps($r,{"laya.ui.IBox":!0}),$R(0,$r,"dataSource",$V.prototype._$get_dataSource,function($V){for(var $U in this._dataSource=$V){var $r=this.getChildByName($U);$r?$r.dataSource=$V[$U]:this.hasOwnProperty($U)&&"function"!=typeof this[$U]&&(this[$U]=$V[$U])}}),$U}($E),$a=function($U){function $r($V,$U){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$r.__super.call(this),this._labelColors=$Q.buttonLabelColors,this._stateNum=$Q.buttonStateNum,void 0===$U&&($U=""),this.skin=$V,this.label=$U}$c($r,"laya.ui.Button",$U);var $V=$r.prototype;return $u.imps($V,{"laya.ui.ISelect":!0}),$V.destroy=function($V){this.clearEvent(),$W.clearCache(this,this._skin),$W.clearObject(this,this._weakKey),void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($V),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$V.clearEvent=function(){this._skin&&$p.atalsNotify&&$p.atalsNotify.off(this._skin,this,this._setBtnSource)},$V.createChildren=function(){this.graphics=this._bitmap=new $z},$V.createText=function(){this._text||(this._text=new $d,this._text.overflow=$d.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$V.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$V.onMouse=function($V){if(!1!==this.toggle||!this._selected)return"click"===$V.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$r.stateMap[$V.type]))},$V.changeClips=function(){var $V=$W.getRes(this._skin);if($V)if(this._skin&&""!=this._skin){$W.clearObject(this,this._weakKey);var $U=$V.sourceWidth,$r=$V.sourceHeight/this._stateNum;$V.$_GID||($V.$_GID=$D.getGID());var $s=$V.$_GID+"-"+this._stateNum,$p=$W.findObject($s);if($D.isOkTextureList($p)||($p=null),$p)this._weakKey=$s,$W.keepObject(this,this._weakKey),this._sources=$p;else{if(this._sources=[],1===this._stateNum)this._sources.push($V);else for(var $c=0;$c<this._stateNum;$c++){var $R=$k.createFromTexture($V,0,$r*$c,$U,$r);if($V.alphaTexture){var $T=$V.width/$V.alphaTexture.width;$R.alphaTexture=$k.createFromTexture($V.alphaTexture,0/$T,$r*$c/$T,$U/$T,$r/$T)}this._sources.push($R)}$W.saveObject($s,this._sources),this._weakKey=$s,$W.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$U,this._bitmap.height=this._height||$r,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$U)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$V.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $V=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$V]),this.label&&(this._text.color=this._labelColors[$V],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$V]))},$V._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$R(0,$V,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($V){this.createText(),this._text.strokeColor=$V}),$R(0,$V,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$R(0,$V,"skin",function(){return this._skin},function($V){if(this._skin!=$V)if(this.clearEvent(),$W.clearCache(this,this._skin),this._skin=$V,$W.keepCache(this,this._skin),$W.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $U=$p.resAtalsObj&&$p.resAtalsObj[this._skin];$U?($p.atalsNotify&&$p.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$U.sourceW),0==this.height&&(this.height=$U.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$V._setBtnSource=function($V,$U){$V===this._skin&&$U&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$R(0,$V,"state",function(){return this._state},function($V){this._state!=$V&&(this._state=$V,this._setStateChanged())}),$R(0,$V,"text",function(){return this.createText(),this._text}),$R(0,$V,"stateNum",function(){return this._stateNum},function($V){"string"==typeof $V&&($V=parseInt($V)),this._stateNum!=$V&&(this._stateNum=$V<1?1:3<$V?3:$V,this.callLater(this.changeClips))}),$R(0,$V,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($V){this._strokeColors=$H.fillArray($Q.buttonLabelColors,$V,String),this._setStateChanged()}),$R(0,$V,"labelColors",function(){return this._labelColors.join(",")},function($V){this._labelColors=$H.fillArray($Q.buttonLabelColors,$V,String),this._setStateChanged()}),$R(0,$V,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$R(0,$V,"label",function(){return this._text?this._text.text:null},function($V){(this._text||$V)&&(this.createText(),this._text.text!=$V&&($V&&!this._text.parent&&this.addChild(this._text),this._text.text=($V+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$R(0,$V,"selected",function(){return this._selected},function($V){this._selected!=$V&&(this._selected=$V,this.state=this._selected?2:0,this.event("change"))}),$R(0,$V,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($V){this.createText(),this._text.padding=$H.fillArray($Q.labelPadding,$V,Number)}),$R(0,$V,"labelSize",function(){return this.createText(),this._text.fontSize},function($V){this.createText(),this._text.fontSize=$V}),$R(0,$V,"labelStroke",function(){return this.createText(),this._text.stroke},function($V){this.createText(),this._text.stroke=$V}),$R(0,$V,"labelBold",function(){return this.createText(),this._text.bold},function($V){this.createText(),this._text.bold=$V}),$R(0,$V,"labelFont",function(){return this.createText(),this._text.font},function($V){this.createText(),this._text.font=$V}),$R(0,$V,"labelAlign",function(){return this.createText(),this._text.align},function($V){this.createText(),this._text.align=$V}),$R(0,$V,"clickHandler",function(){return this._clickHandler},function($V){this._clickHandler=$V}),$R(0,$V,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($V){this._bitmap.sizeGrid=$H.fillArray($Q.defaultSizeGrid,$V,Number)}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($E,this,"width",$V),this._autoSize&&(this._bitmap.width=$V,this._text&&(this._text.width=$V))}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($E,this,"height",$V),this._autoSize&&(this._bitmap.height=$V,this._text&&(this._text.height=$V))}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)||"string"==typeof $V?this.label=$V+"":$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($V){this._bitmap._offset=$V?$H.fillArray([1,1],$V,Number):[]}),$s($r,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$r}($E),$Z=function($U){function $s($V,$U,$r){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$s.__super.call(this),void 0===$U&&($U=1),void 0===$r&&($r=1),this._clipX=$U,this._clipY=$r,this.skin=$V}$c($s,"laya.ui.Clip",$U);var $V=$s.prototype;return $V.destroy=function($V){this.clearEvent(),this.clearLoad(),$W.clearCache(this,this._skin),$W.clearObject(this,this._weakKey),void 0===$V&&($V=!0),$U.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$V.dispose=function(){this.destroy(!0),$u.loader.clearRes(this._skin)},$V.createChildren=function(){this.graphics=this._bitmap=new $z},$V._onDisplay=function($V){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$V.changeClip=function(){if(this._clipChanged=!1,this._skin){var $V=$W.getRes(this._skin);if($V)this.loadComplete(this._skin,$V);else{if($p.resAtalsObj&&$p.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$_.create(this,this.loadComplete,[this._skin]),this._progress=null,$u.loader.load(this._skin,this._complete,this._progress)}}},$V.loadComplete=function($V,$U){if($V===this._skin&&$U){$W.clearObject(this,this._weakKey);var $r=this._clipWidth||Math.ceil($U.sourceWidth/this._clipX),$s=this._clipHeight||Math.ceil($U.sourceHeight/this._clipY),$p=this._skin+$r+$s,$c=$W.findObject($p);if($D.isOkTextureList($c)||($c=null),$c)this._weakKey=$p,$W.keepObject(this,this._weakKey),this._sources=$c;else{this._sources=[];for(var $R=0;$R<this._clipY;$R++)for(var $T=0;$T<this._clipX;$T++){var $N=$k.createFromTexture($U,$r*$T,$s*$R,$r,$s);if($U.alphaTexture){var $t=$U.width/$U.alphaTexture.width;$N.alphaTexture=$k.createFromTexture($U.alphaTexture,$r*$T/$t,$s*$R/$t,$r/$t,$s/$t)}this._sources.push($N)}$W.saveObject($p,this._sources),this._weakKey=$p,$W.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$V.play=function($V,$U){void 0===$V&&($V=0),void 0===$U&&($U=-1),this._isPlaying=!0,this.index=$V,this._toIndex=$U,this._index++,$u.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$V._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$V.stop=function(){this._isPlaying=!1,$u.timer.clear(this,this._loop),this.event("complete")},$V._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$R(0,$V,"interval",function(){return this._interval},function($V){this._interval!=$V&&(this._interval=$V,this._isPlaying&&this.play())}),$V.clearEvent=function(){this._skin&&$p.atalsNotify&&$p.atalsNotify.off(this._skin,this,this._setBtnSource)},$V.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$u.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$R(0,$V,"skin",function(){return this._skin},function($V){if(this._skin!=$V)if(this.clearLoad(),this.clearEvent(),$W.clearCache(this,this._skin),this._skin=$V){$W.keepCache(this,this._skin);var $U=$W.getRes($V),$r=$p.resAtalsObj&&$p.resAtalsObj[this._skin];!$U&&$r?$p.atalsNotify&&$p.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$V._setBtnSource=function($V,$U){$V===this._skin&&$U&&(this.loadComplete($V,$U),this.clearEvent())},$R(0,$V,"sources",function(){return this._sources},function($V){this._sources=$V,this.index=this._index,this.event("loaded")}),$R(0,$V,"clipX",function(){return this._clipX},function($V){this._clipX=$V||1,this._setClipChanged()}),$R(0,$V,"clipY",function(){return this._clipY},function($V){this._clipY=$V||1,this._setClipChanged()}),$R(0,$V,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$R(0,$V,"clipWidth",function(){return this._clipWidth},function($V){this._clipWidth=$V,this._setClipChanged()}),$R(0,$V,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($V){this._bitmap.sizeGrid=$H.fillArray($Q.defaultSizeGrid,$V,Number)}),$R(0,$V,"group",function(){return this._group},function($V){$V&&this._skin&&$W.setGroup(this._skin,$V),this._group=$V}),$R(0,$V,"clipHeight",function(){return this._clipHeight},function($V){this._clipHeight=$V,this._setClipChanged()}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($E,this,"width",$V),this._bitmap.width=$V}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($E,this,"height",$V),this._bitmap.height=$V}),$R(0,$V,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$R(0,$V,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$R(0,$V,"index",function(){return this._index},function($V){this._index=$V,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$V]),this.event("change")}),$R(0,$V,"autoPlay",function(){return this._autoPlay},function($V){this._autoPlay!=$V&&((this._autoPlay=$V)?this.play():this.stop())}),$R(0,$V,"isPlaying",function(){return this._isPlaying},function($V){this._isPlaying=$V}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)&&Math.floor($V)==$V||"string"==typeof $V?this.index=parseInt($V):$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"bitmap",function(){return this._bitmap}),$s}($E),$x=function($U){function $V(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$V.__super.call(this)}$c($V,"laya.ui.ColorPicker",$U);var $r=$V.prototype;return $r.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._colorPanel&&this._colorPanel.destroy($V),this._colorButton&&this._colorButton.destroy($V),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$r.createChildren=function(){this.addChild(this._colorButton=new $a),this._colorPanel=new $m,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $L),this._colorPanel.addChild(this._colorBlock=new $L),this._colorPanel.addChild(this._colorInput=new $G)},$r.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$r.onPanelMouseDown=function($V){$V.stopPropagation()},$r.changePanel=function(){this._panelChanged=!1;var $V=this._colorPanel.graphics;$V.clear(),$V.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($V=this._colorTiles.graphics).clear();for(var $U=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$r=0;$r<12;$r++)for(var $s=0;$s<20;$s++){var $p=0;$p=0===$s?$U[$r]:1===$s?0:51*(((3*$r+$s/6)%3<<0)+3*($r/6<<0))<<16|$s%6*51<<8|($r<<0)%6*51;var $c=$H.toColor($p);this._colors.push($c);var $R=$s*this._gridSize,$T=$r*this._gridSize;$V.drawRect($R,$T,this._gridSize,this._gridSize,$c,"#000000")}},$r.onColorButtonClick=function($V){this._colorPanel.parent?this.close():this.open()},$r.open=function(){var $V=this.localToGlobal(new $q),$U=$V.x+this._colorPanel.width<=$u.stage.width?$V.x:$u.stage.width-this._colorPanel.width,$r=$V.y+this._colorButton.height;$r=$r+this._colorPanel.height<=$u.stage.height?$r:$V.y-this._colorPanel.height,this._colorPanel.pos($U,$r),this._colorPanel.zOrder=1001,$u._currentStage.addChild(this._colorPanel),$u.stage.on("mousedown",this,this.removeColorBox)},$r.close=function(){$u.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$r.removeColorBox=function($V){this.close()},$r.onColorFieldKeyDown=function($V){13==$V.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$V.stopPropagation())},$r.onColorInputChange=function($V){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$r.onColorTilesClick=function($V){this.selectedColor=this.getColorByMouse(),this.close()},$r.onColorTilesMouseMove=function($V){this._colorInput.focus=!1;var $U=this.getColorByMouse();this._colorInput.text=$U,this.drawBlock($U)},$r.getColorByMouse=function(){var $V=this._colorTiles.getMousePoint(),$U=Math.floor($V.x/this._gridSize),$r=Math.floor($V.y/this._gridSize);return this._colors[20*$r+$U]},$r.drawBlock=function($V){var $U=this._colorBlock.graphics;$U.clear();var $r=$V||"#ffffff";$U.drawRect(0,0,50,20,$r,this._borderColor),$V||$U.drawLine(0,0,50,20,"#ff0000")},$r.changeColor=function(){var $V=this.graphics;$V.clear();var $U=this._selectedColor||"#000000";$V.drawRect(0,0,this._colorButton.width,this._colorButton.height,$U)},$r._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$R(0,$r,"inputBgColor",function(){return this._inputBgColor},function($V){this._inputBgColor=$V,this._setPanelChanged()}),$R(0,$r,"selectedColor",function(){return this._selectedColor},function($V){this._selectedColor!=$V&&(this._selectedColor=this._colorInput.text=$V,this.drawBlock($V),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$t.EMPTY.setTo("change",this,this)))}),$R(0,$r,"skin",function(){return this._colorButton.skin},function($V){this._colorButton.skin=$V,this.changeColor()}),$R(0,$r,"bgColor",function(){return this._bgColor},function($V){this._bgColor=$V,this._setPanelChanged()}),$R(0,$r,"borderColor",function(){return this._borderColor},function($V){this._borderColor=$V,this._setPanelChanged()}),$R(0,$r,"inputColor",function(){return this._inputColor},function($V){this._inputColor=$V,this._setPanelChanged()}),$V}($E),$$=function($U){function $r($V,$U){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$r.__super.call(this),this._itemColors=$Q.comboBoxItemColors,this.skin=$V,this.labels=$U}$c($r,"laya.ui.ComboBox",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._button&&this._button.destroy($V),this._list&&this._list.destroy($V),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$V.createChildren=function(){this.addChild(this._button=new $a),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$V._createList=function(){this._list=new $e,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$V._setListEvent=function($V){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$_.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$V.onListDown=function($V){$V.stopPropagation()},$V.onScrollBarDown=function($V){$V.stopPropagation()},$V.onButtonMouseDown=function($V){this.callLater(this.switchTo,[!this._isOpen])},$V.changeList=function(){this._listChanged=!1;var $V=this.width-2,$U=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$V,height:this._itemHeight,fontSize:this._itemSize,color:$U}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$V.onlistItemMouse=function($V,$U){var $r=$V.type;if("mouseover"===$r||"mouseout"===$r){if(this._isCustomList)return;var $s=this._list.getCell($U);if(!$s)return;var $p=$s.getChildByName("label");$p&&("mouseover"===$r?($p.bgColor=this._itemColors[0],$p.color=this._itemColors[1]):($p.bgColor=null,$p.color=this._itemColors[2]))}else"click"===$r&&(this.selectedIndex=$U,this.isOpen=!1)},$V.switchTo=function($V){this.isOpen=$V},$V.changeOpen=function(){this.isOpen=!this._isOpen},$V.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $V=this._list.graphics;$V.clear(),$V.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $U=this._list.array||[],$r=$U.length=0,$s=this._labels.length;$r<$s;$r++)$U.push({label:this._labels[$r]});this._list.height=this._listHeight,this._list.array=$U},$V.changeSelected=function(){this._button.label=this.selectedLabel},$V._onStageMouseWheel=function($V){this._list&&!this._list.contains($V.target)&&this.removeList(null)},$V.removeList=function($V){$u.stage.off("mousedown",this,this.removeList),$u.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$R(0,$V,"selectedIndex",function(){return this._selectedIndex},function($V){this._selectedIndex!=$V&&(this._selectedIndex=$V,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$t.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$R(0,$V,"measureHeight",function(){return this._button.height}),$R(0,$V,"skin",function(){return this._button.skin},function($V){this._button.skin!=$V&&(this._button.skin=$V,this._listChanged=!0)}),$R(0,$V,"measureWidth",function(){return this._button.width}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($E,this,"width",$V),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$R(0,$V,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($V){this.selectedIndex=this._labels.indexOf($V)}),$R(0,$V,"labels",function(){return this._labels.join(",")},function($V){0<this._labels.length&&(this.selectedIndex=-1),$V?this._labels=$V.split(","):this._labels.length=0,this._itemChanged=!0}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($E,this,"height",$V),this._button.height=this._height}),$R(0,$V,"selectHandler",function(){return this._selectHandler},function($V){this._selectHandler=$V}),$R(0,$V,"visibleNum",function(){return this._visibleNum},function($V){this._visibleNum=$V,this._listChanged=!0}),$R(0,$V,"labelBold",function(){return this._button.text.bold},function($V){this._button.text.bold=$V}),$R(0,$V,"itemColors",function(){return String(this._itemColors)},function($V){this._itemColors=$H.fillArray(this._itemColors,$V,String),this._listChanged=!0}),$R(0,$V,"itemSize",function(){return this._itemSize},function($V){this._itemSize=$V,this._listChanged=!0}),$R(0,$V,"scrollBar",function(){return this.list.scrollBar}),$R(0,$V,"isOpen",function(){return this._isOpen},function($V){if(this._isOpen!=$V)if(this._isOpen=$V,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $U=this.localToGlobal($q.TEMP.setTo(0,0)),$r=$U.y+this._button.height;$r=$r+this._listHeight<=$u.stage.height?$r:$U.y-this._listHeight,this._list.pos($U.x,$r),this._list.zOrder=1001,$u._currentStage.addChild(this._list),$u.stage.once("mousedown",this,this.removeList),$u.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$R(0,$V,"scrollBarSkin",function(){return this._scrollBarSkin},function($V){this._scrollBarSkin=$V}),$R(0,$V,"sizeGrid",function(){return this._button.sizeGrid},function($V){this._button.sizeGrid=$V}),$R(0,$V,"button",function(){return this._button}),$R(0,$V,"list",function(){return this._list||this._createList(),this._list},function($V){$V&&($V.removeSelf(),this._isCustomList=!0,this._list=$V,this._setListEvent($V),this._itemHeight=$V.getCell(0).height+$V.spaceY)}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)&&Math.floor($V)==$V||"string"==typeof $V?this.selectedIndex=parseInt($V):$V instanceof Array?this.labels=$V.join(","):$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"labelColors",function(){return this._button.labelColors},function($V){this._button.labelColors!=$V&&(this._button.labelColors=$V)}),$R(0,$V,"labelPadding",function(){return this._button.text.padding.join(",")},function($V){this._button.text.padding=$H.fillArray($Q.labelPadding,$V,Number)}),$R(0,$V,"labelSize",function(){return this._button.text.fontSize},function($V){this._button.text.fontSize=$V}),$R(0,$V,"labelFont",function(){return this._button.text.font},function($V){this._button.text.font=$V}),$R(0,$V,"stateNum",function(){return this._button.stateNum},function($V){this._button.stateNum=$V}),$r}($E),$j=function($U){function $r($V){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$r.__super.call(this),this._showButtons=$w.showButtons,this._touchScrollEnable=$w.touchScrollEnable,this._mouseWheelEnable=$w.mouseWheelEnable,this.skin=$V,this.max=1}$c($r,"laya.ui.ScrollBar",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),this.stopScroll(),this.target=null,$U.prototype.destroy.call(this,$V),this.upButton&&this.upButton.destroy($V),this.downButton&&this.downButton.destroy($V),this.slider&&this.slider.destroy($V),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$V.createChildren=function(){this.addChild(this.slider=new $o),this.addChild(this.upButton=new $a),this.addChild(this.downButton=new $a)},$V.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$V.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$V.onButtonMouseDown=function($V){var $U=$V.currentTarget===this.upButton;this.slide($U),$u.timer.once($Q.scrollBarDelayTime,this,this.startLoop,[$U]),$u.stage.once("mouseup",this,this.onStageMouseUp)},$V.startLoop=function($V){$u.timer.frameLoop(1,this,this.slide,[$V])},$V.slide=function($V){$V?this.value-=this._scrollSize:this.value+=this._scrollSize},$V.onStageMouseUp=function($V){$u.timer.clear(this,this.startLoop),$u.timer.clear(this,this.slide)},$V.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$V.changeSize=function(){$U.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$V.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$V.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$V.setScroll=function($V,$U,$r){this.runCallLater(this.changeSize),this.slider.setSlider($V,$U,$r),this.slider.bar.visible=0<$U,!this._hide&&this.autoHide&&(this.visible=!1)},$V.onTargetMouseWheel=function($V){this.value-=$V.delta*this._scrollSize,this.target=this._target},$V.onTargetMouseDown=function($V){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $q),this._lastPoint.setTo($u.stage.mouseX,$u.stage.mouseY),$u.timer.clear(this,this.tweenMove),$y.clearTween(this),$u.stage.once("mouseup",this,this.onStageMouseUp2),$u.stage.once("mouseout",this,this.onStageMouseUp2),$u.timer.frameLoop(1,this,this.loop)},$V.loop=function(){var $V=$u.stage.mouseY,$U=$u.stage.mouseX;if(this._lastOffset=this.isVertical?$V-this._lastPoint.y:$U-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$u.stage._canvasTransform.getScaleY():$u.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$U,this._lastPoint.y=$V,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$V.onStageMouseUp2=function($V){if($u.stage.off("mouseup",this,this.onStageMouseUp2),$u.stage.off("mouseout",this,this.onStageMouseUp2),$u.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$y.to(this,{value:this.min},this.elasticBackTime,$N.sineOut,$_.create(this,this.elasticOver)):this._value>this.max&&$y.to(this,{value:this.max},this.elasticBackTime,$N.sineOut,$_.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$u.stage.mouseY-this._lastPoint.y:$u.stage.mouseX-this._lastPoint.x);for(var $U=0,$r=Math.min(this._offsets.length,3),$s=0;$s<$r;$s++)$U+=this._offsets[this._offsets.length-1-$s];if(this._lastOffset=$U/$r,($U=Math.abs(this._lastOffset))<2)return void this.event("end");60<$U&&(this._lastOffset=0<this._lastOffset?60:-60);var $p=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$u.timer.frameLoop(1,this,this.tweenMove,[$p])}},$V.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$y.to(this,{alpha:0},500),this.event("end")},$V.tweenMove=function($V){this._lastOffset*=this.rollRatio;var $U=NaN;if(0<$V&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$U=.5*-(this.min-$V-this.value),this._lastOffset>$U&&(this._lastOffset=$U)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$U=.5*-(this.max+$V-this.value),this._lastOffset<$U&&(this._lastOffset=$U))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($u.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$y.to(this,{value:this.min},this.elasticBackTime,$N.sineOut,$_.create(this,this.elasticOver)):this._value>this.max?$y.to(this,{value:this.max},this.elasticBackTime,$N.sineOut,$_.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$y.to(this,{alpha:0},500)}},$V.stopScroll=function(){this.onStageMouseUp2(null),$u.timer.clear(this,this.tweenMove),$y.clearTween(this)},$R(0,$V,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$R(0,$V,"skin",function(){return this._skin},function($V){this._skin!=$V&&(this._skin=$V,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$R(0,$V,"max",function(){return this.slider.max},function($V){this.slider.max=$V}),$R(0,$V,"showButtons",function(){return this._showButtons},function($V){this._showButtons=$V,this.callLater(this.changeScrollBar)}),$R(0,$V,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$R(0,$V,"min",function(){return this.slider.min},function($V){this.slider.min=$V}),$R(0,$V,"value",function(){return this._value},function($V){$V!==this._value&&(this._value=$V,this._isElastic||(this.slider._value!=$V&&(this.slider._value=$V,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$R(0,$V,"isVertical",function(){return this.slider.isVertical},function($V){this.slider.isVertical=$V}),$R(0,$V,"sizeGrid",function(){return this.slider.sizeGrid},function($V){this.slider.sizeGrid=$V}),$R(0,$V,"scrollSize",function(){return this._scrollSize},function($V){this._scrollSize=$V}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)||"string"==typeof $V?this.value=Number($V):$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"thumbPercent",function(){return this._thumbPercent},function($V){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$V=1<=$V?.99:$V,this._thumbPercent=$V,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$V,$Q.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$V,$Q.scrollBarMinNum))}),$R(0,$V,"target",function(){return this._target},function($V){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$V)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$R(0,$V,"hide",function(){return this._hide},function($V){this._hide=$V,this.visible=!$V}),$R(0,$V,"touchScrollEnable",function(){return this._touchScrollEnable},function($V){this._touchScrollEnable=$V,this.target=this._target}),$R(0,$V,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($V){this._mouseWheelEnable=$V,this.target=this._target}),$R(0,$V,"tick",function(){return this.slider.tick},function($V){this.slider.tick=$V}),$r}($E),$o=function($U){function $r($V){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$r.__super.call(this),this.skin=$V}$c($r,"laya.ui.Slider",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._bg&&this._bg.destroy($V),this._bar&&this._bar.destroy($V),this._progress&&this._progress.destroy($V),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$V.createChildren=function(){this.addChild(this._bg=new $J),this.addChild(this._bar=new $a)},$V.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$V.onBarMouseDown=function($V){this._globalSacle||(this._globalSacle=new $q),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$u.stage.mouseX,this._ty=$u.stage.mouseY,$u.stage.on("mousemove",this,this.mouseMove),$u.stage.once("mouseup",this,this.mouseUp),$u.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$V.showValueText=function(){if(this.showLabel){var $V=laya.ui.Slider.label;this.addChild($V),$V.textField.changeText(this._value+""),this.isVertical?($V.x=this._bar.x+20,$V.y=.5*(this._bar.height-$V.height)+this._bar.y):($V.y=this._bar.y-20,$V.x=.5*(this._bar.width-$V.width)+this._bar.x)}},$V.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$V.mouseUp=function($V){$u.stage.off("mousemove",this,this.mouseMove),$u.stage.off("mouseup",this,this.mouseUp),$u.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$V.mouseMove=function($V){var $U=this._value;this.isVertical?(this._bar.y+=($u.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($u.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$u.stage.mouseX,this._ty=$u.stage.mouseY;var $r=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$r)/$r,this._value!=$U&&this.sendChangeEvent(),this.showValueText()},$V.sendChangeEvent=function($V){void 0===$V&&($V="change"),this.event($V),this.changeHandler&&this.changeHandler.runWith(this._value)},$V.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$V.changeSize=function(){$U.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$V.setSlider=function($V,$U,$r){this._value=-1,this._min=$V,this._max=$V<$U?$U:$V,this.value=$r<$V?$V:$U<$r?$U:$r},$V.changeValue=function(){var $V=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$V)/$V,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $U=this._max-this._min;0===$U&&($U=1),this.isVertical?(this._bar.y=(this._value-this._min)/$U*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$U*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$V.onBgMouseDown=function($V){var $U=this._bg.getMousePoint();this.isVertical?this.value=$U.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$U.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$R(0,$V,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$R(0,$V,"skin",function(){return this._skin},function($V){if(this._skin!=$V){this._skin=$V,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $U=this._skin.replace(".png","$progress.png");$W.getRes($U)&&(this._progress||(this.addChild(this._progress=new $J),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$U),this.setBarPoint(),this.callLater(this.changeValue)}}),$R(0,$V,"allowClickBack",function(){return this._allowClickBack},function($V){this._allowClickBack!=$V&&((this._allowClickBack=$V)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$R(0,$V,"max",function(){return this._max},function($V){this._max!=$V&&(this._max=$V,this.callLater(this.changeValue))}),$R(0,$V,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$R(0,$V,"tick",function(){return this._tick},function($V){this._tick!=$V&&(this._tick=$V,this.callLater(this.changeValue))}),$R(0,$V,"sizeGrid",function(){return this._bg.sizeGrid},function($V){this._bg.sizeGrid=$V,this._bar.sizeGrid=$V,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$R(0,$V,"min",function(){return this._min},function($V){this._min!=$V&&(this._min=$V,this.callLater(this.changeValue))}),$R(0,$V,"value",function(){return this._value},function($V){if(this._value!=$V){var $U=this._value;this._value=$V,this.changeValue(),this._value!=$U&&this.sendChangeEvent()}}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)||"string"==typeof $V?this.value=Number($V):$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"bar",function(){return this._bar}),$s($r,["label",function(){return this.label=new $i}]),$r}($E),$J=function($U){function $r($V){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$r.__super.call(this),this.skin=$V}$c($r,"laya.ui.Image",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$W.clearCache(this,this._skin)},$V.dispose=function(){this.destroy(!0),$W.clearCache(this,this._skin),this.clearEvent()},$V.createChildren=function(){this.graphics=this._bitmap=new $z},$V.setSource=function($V,$U){this.destroyed||$V===this._skin&&$U&&(this.source=$U,this.onCompResize(),this.clearEvent())},$V.clearEvent=function(){this._skin&&$p.atalsNotify&&$p.atalsNotify.off(this._skin,this,this.setSource)},$V.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$u.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$R(0,$V,"source",function(){return this._bitmap.source},function($V){this._bitmap&&(this._bitmap.source=$V,this.event("loaded"),this.repaint())}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"string"==typeof(this._dataSource=$V)?this.skin=$V:$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"measureHeight",function(){return this._bitmap.height}),$R(0,$V,"skin",function(){return this._skin},function($V){if(this._skin!=$V)if($W.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$V){$W.keepCache(this,this._skin);var $U=$W.getRes($V),$r=$p.resAtalsObj&&$p.resAtalsObj[this._skin];$U?(this.source=$U,this.onCompResize()):$r?($p.atalsNotify&&$p.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$r.sourceW),0==this.height&&(this.height=$r.sourceH)):(this._complete=$_.create(this,this.setSource,[this._skin]),this._progress=null,$u.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$R(0,$V,"group",function(){return this._group},function($V){$V&&this._skin&&$W.setGroup(this._skin,$V),this._group=$V}),$R(0,$V,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($V){this._bitmap.sizeGrid=$H.fillArray($Q.defaultSizeGrid,$V,Number)}),$R(0,$V,"measureWidth",function(){return this._bitmap.width}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($E,this,"width",$V),this._bitmap.width=0==$V?1e-7:$V}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($E,this,"height",$V),this._bitmap.height=0==$V?1e-7:$V}),$r}($E),$i=function($U){function $r($V){this._tf=null,$r.__super.call(this),void 0===$V&&($V=""),$b.defaultColor=$Q.labelColor,this.text=$V}$c($r,"laya.ui.Label",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._tf=null},$V.createChildren=function(){this.addChild(this._tf=new $d)},$V.changeText=function($V){this._tf.changeText($V)},$R(0,$V,"padding",function(){return this._tf.padding.join(",")},function($V){this._tf.padding=$H.fillArray($Q.labelPadding,$V,Number)}),$R(0,$V,"bold",function(){return this._tf.bold},function($V){this._tf.bold=$V}),$R(0,$V,"align",function(){return this._tf.align},function($V){this._tf.align=$V}),$R(0,$V,"text",function(){return this._tf.text},function($V){this._tf.text!=$V&&($V&&($V=$H.adptString($V+"")),this._tf.text=$V,this.event("change"),this._width&&this._height||this.onCompResize())}),$R(0,$V,"italic",function(){return this._tf.italic},function($V){this._tf.italic=$V}),$R(0,$V,"wordWrap",function(){return this._tf.wordWrap},function($V){this._tf.wordWrap=$V}),$R(0,$V,"font",function(){return this._tf.font},function($V){this._tf.font=$V}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)||"string"==typeof $V?this.text=$V+"":$u.superSet($E,this,"dataSource",$V)}),$R(0,$V,"color",function(){return this._tf.color},function($V){this._tf.color=$V}),$R(0,$V,"valign",function(){return this._tf.valign},function($V){this._tf.valign=$V}),$R(0,$V,"leading",function(){return this._tf.leading},function($V){this._tf.leading=$V}),$R(0,$V,"fontSize",function(){return this._tf.fontSize},function($V){this._tf.fontSize=$V}),$R(0,$V,"bgColor",function(){return this._tf.bgColor},function($V){this._tf.bgColor=$V}),$R(0,$V,"borderColor",function(){return this._tf.borderColor},function($V){this._tf.borderColor=$V}),$R(0,$V,"stroke",function(){return this._tf.stroke},function($V){this._tf.stroke=$V}),$R(0,$V,"strokeColor",function(){return this._tf.strokeColor},function($V){this._tf.strokeColor=$V}),$R(0,$V,"textField",function(){return this._tf}),$R(0,$V,"measureWidth",function(){return this._tf.width}),$R(0,$V,"measureHeight",function(){return this._tf.height}),$R(0,$V,"width",function(){return this._width||this._tf.text?$u.superGet($E,this,"width"):0},function($V){$u.superSet($E,this,"width",$V),this._tf.width=$V}),$R(0,$V,"height",function(){return this._height||this._tf.text?$u.superGet($E,this,"height"):0},function($V){$u.superSet($E,this,"height",$V),this._tf.height=$V}),$R(0,$V,"overflow",function(){return this._tf.overflow},function($V){this._tf.overflow=$V}),$R(0,$V,"underline",function(){return this._tf.underline},function($V){this._tf.underline=$V}),$R(0,$V,"underlineColor",function(){return this._tf.underlineColor},function($V){this._tf.underlineColor=$V}),$r}($E),$B=function($U){function $r($V){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$r.__super.call(this),this.skin=$V}$c($r,"laya.ui.ProgressBar",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._bg&&this._bg.destroy($V),this._bar&&this._bar.destroy($V),this._bg=this._bar=null,this.changeHandler=null},$V.createChildren=function(){this.addChild(this._bg=new $J),this.addChild(this._bar=new $J)},$V.changeValue=function(){if(this.sizeGrid){var $V=this.sizeGrid.split(","),$U=Number($V[3]),$r=Number($V[1]),$s=(this.width-$U-$r)*this._value;this._bar.width=$U+$r+$s,this._bar.visible=this._bar.width>$U+$r}else this._bar.width=this.width*this._value},$R(0,$V,"measureHeight",function(){return this._bg.height}),$R(0,$V,"skin",function(){return this._skin},function($V){this._skin!=$V&&(this._skin=$V,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$R(0,$V,"measureWidth",function(){return this._bg.width}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($E,this,"height",$V),this._bg.height=this._height,this._bar.height=this._height}),$R(0,$V,"bar",function(){return this._bar}),$R(0,$V,"value",function(){return this._value},function($V){this._value!=$V&&($V=1<$V?1:$V<0?0:$V,this._value=$V,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($V))}),$R(0,$V,"bg",function(){return this._bg}),$R(0,$V,"sizeGrid",function(){return this._bg.sizeGrid},function($V){this._bg.sizeGrid=this._bar.sizeGrid=$V}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($E,this,"width",$V),this._bg.width=this._width,this.callLater(this.changeValue)}),$R(0,$V,"dataSource",$U.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)||"string"==typeof $V?this.value=Number($V):$u.superSet($E,this,"dataSource",$V)}),$r}($E),$P=(function($V){function $r(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$r.__super.call(this),this._tipBox=new $E,this._tipBox.addChild(this._tipText=new $d),this._tipText.x=this._tipText.y=5,this._tipText.color=$r.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$u.stage.on("showtip",this,this._onStageShowTip),$u.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$c($r,"laya.ui.TipManager",$E);var $U=$r.prototype;$U._onStageHideTip=function($V){$u.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$U._onStageShowTip=function($V){$u.timer.once($r.tipDelay,this,this._showTip,[$V],!0)},$U._showTip=function($V){if("string"==typeof $V){var $U=String($V);Boolean($U)&&this._defaultTipHandler($U)}else $V instanceof laya.utils.Handler?$V.run():"function"==typeof $V&&$V.apply();$u.stage.on("mousemove",this,this._onStageMouseMove),$u.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$U._onStageMouseDown=function($V){this.closeAll()},$U._onStageMouseMove=function($V){this._showToStage(this,$r.offsetX,$r.offsetY)},$U._showToStage=function($V,$U,$r){void 0===$U&&($U=0),void 0===$r&&($r=0);var $s=$V.getBounds();$V.x=$u.stage.mouseX+$U,$V.y=$u.stage.mouseY+$r,$V.x+$s.width>$u.stage.width&&($V.x-=$s.width+$U),$V.y+$s.height>$u.stage.height&&($V.y-=$s.height+$r)},$U.closeAll=function(){$u.timer.clear(this,this._showTip),$u.stage.off("mousemove",this,this._onStageMouseMove),$u.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$U.showDislayTip=function($V){this.addChild($V),this._showToStage(this),$u._currentStage.addChild(this)},$U._showDefaultTip=function($V){this._tipText.text=$V;var $U=this._tipBox.graphics;$U.clear(),$U.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$r.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$u._currentStage.addChild(this)},$R(0,$U,"defaultTipHandler",function(){return this._defaultTipHandler},function($V){this._defaultTipHandler=$V}),$r.offsetX=10,$r.offsetY=15,$r.tipTextColor="#ffffff",$r.tipBackColor="#111111",$r.tipDelay=200}(),function($V){var $G;function $q(){this._idMap=null,this._aniList=null,this._watchMap={},$q.__super.call(this)}$c($q,"laya.ui.View",$m);var $U=$q.prototype;return $U.createView=function($V){if($V.animations&&!this._idMap&&(this._idMap={}),$q.createComp($V,this,this),$V.animations){var $U,$r,$s=[],$p=$V.animations,$c=0,$R=$p.length;for($c=0;$c<$R;$c++){switch($U=new $S,$r=$p[$c],$U._setUp(this._idMap,$r),(this[$r.name]=$U)._setControlNode(this),$r.action){case 1:$U.play(0,!1);break;case 2:$U.play(0,!0)}$s.push($U)}this._aniList=$s}0<this._width&&null==$V.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$U.onEvent=function($V,$U){},$U.loadUI=function($V){var $U=$q.uiMap[$V];$U&&this.createView($U)},$U.destroy=function($V){void 0===$V&&($V=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$V)},$U.changeData=function($V){var $U=this._watchMap[$V];if($U){console.log("change",$V);for(var $r=0,$s=$U.length;$r<$s;$r++){$U[$r].exe(this)}}},$q._regs=function(){for(var $V in $q.uiClassMap)$h.regClass($V,$q.uiClassMap[$V])},$q.createComp=function($V,$U,$r,$s){if(!($U=$U||$q.getCompInstance($V)))return console.warn("can not create:"+$V.type),null;var $p=$V.child;if($p)for(var $c=$U instanceof laya.ui.List,$R=0,$T=$p.length;$R<$T;$R++){var $N=$p[$R];if(!$U.hasOwnProperty("itemRender")||"render"!=$N.props.name&&"render"!==$N.props.renderType)if("Graphic"==$N.type)$h.addGraphicsToSprite($N,$U);else if($h.isDrawType($N.type))$h.addGraphicToSprite($N,$U,!0);else{if($c){var $t=[],$b=$q.createComp($N,null,$r,$t);$t.length&&($b._$bindData=$t)}else $b=$q.createComp($N,null,$r,$s);"Script"==$N.type?"owner"in $b?$b.owner=$U:"target"in $b&&($b.target=$U):"mask"==$N.props.renderType||"mask"==$N.props.name?$U.mask=$b:$b instanceof laya.display.Sprite&&$U.addChild($b)}else $U.itemRender=$N}var $S=$V.props;for(var $_ in $S){var $G=$S[$_];$q.eventDic[$_]?$G&&$r&&$U.on($_,$r,$r.onEvent,[$G]):$q.setCompValue($U,$_,$G,$r,$s)}return $u.__typeof($U,"laya.ui.IItem")&&$U.initItems(),$V.compId&&$r&&$r._idMap&&($r._idMap[$V.compId]=$U),$U},$q.setCompValue=function($V,$U,$r,$s,$p){if("string"==typeof $r&&-1<$r.indexOf("${")){if($q._sheet||($q._sheet=$h.getClass("laya.data.Table")),!$q._sheet)return void console.warn("Can not find class Sheet");if($p)$p.push($V,$U,$r);else if($s){-1==$r.indexOf("].")&&($r=$r.replace(".","[0]."));var $c,$R,$T=new $G($V,$U,$r);$T.exe($s);for(var $N=$r.replace(/\[.*?\]\./g,".");null!=($c=$q._parseWatchData.exec($N));){for(var $t=$c[1];null!=($R=$q._parseKeyWord.exec($t));){var $b=$R[0],$S=$s._watchMap[$b]||($s._watchMap[$b]=[]);$S.push($T),$q._sheet.I.notifer.on($b,$s,$s.changeData,[$b])}($S=$s._watchMap[$t]||($s._watchMap[$t]=[])).push($T),$q._sheet.I.notifer.on($t,$s,$s.changeData,[$t])}}}else if("var"===$U&&$s)$s[$r]=$V;else if("onClick"==$U){var $_=$u._runScript("(function(){"+$r+"})");$V.on("click",$s,$_)}else $V[$U]="true"===$r||"false"!==$r&&$r},$q.getCompInstance=function($V){var $U,$r=$V.props?$V.props.runtime:null;return $U=$r?$q.viewClassMap[$r]||$q.uiClassMap[$r]||$u.__classmap[$r]:$q.uiClassMap[$V.type],$V.props&&$V.props.hasOwnProperty("renderType")&&"instance"==$V.props.renderType?$U.instance:$U?new $U:null},$q.regComponent=function($V,$U){$q.uiClassMap[$V]=$U,$h.regClass($V,$U)},$q.regViewRuntime=function($V,$U){$q.viewClassMap[$V]=$U},$q.uiMap={},$q.viewClassMap={},$q._sheet=null,$s($q,["uiClassMap",function(){return this.uiClassMap={ViewStack:$VV,LinkButton:$a,TextArea:$tV,ColorPicker:$x,Box:$m,Button:$a,CheckBox:$M,Clip:$Z,ComboBox:$$,Component:$E,HScrollBar:$F,HSlider:$v,Image:$J,Label:$i,List:$e,Panel:$g,ProgressBar:$B,Radio:$C,RadioGroup:$TV,ScrollBar:$j,Slider:$o,Tab:$NV,TextInput:$rV,View:$q,VScrollBar:$UV,VSlider:$sV,Tree:$f,HBox:$cV,VBox:$RV,Sprite:$L,Animation:$r,Text:$d,FontClip:$X}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$q.__init$=function(){$q._regs(),$G=function(){function $V($V,$U,$r){this.comp=null,this.prop=null,this.value=null,this.comp=$V,this.prop=$U,this.value=$r}return $c($V,""),$V.prototype.exe=function($V){var $U=$H.getBindFun(this.value);this.comp[this.prop]=$U.call(this,$V)},$V}()},$q}()),$M=function($V){function $r($V,$U){void 0===$U&&($U=""),$r.__super.call(this,$V,$U)}$c($r,"laya.ui.CheckBox",$V);var $U=$r.prototype;return $U.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$U.initialize=function(){$V.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$R(0,$U,"dataSource",$V.prototype._$get_dataSource,function($V){"boolean"==typeof(this._dataSource=$V)?this.selected=$V:"string"==typeof $V?this.selected="true"===$V:$u.superSet($a,this,"dataSource",$V)}),$r}($a),$A=function($V){function $U(){this._space=0,this._align="none",this._itemChanged=!1,$U.__super.call(this)}$c($U,"laya.ui.LayoutBox",$m);var $r=$U.prototype;return $r.addChild=function($V){return $V.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$V)},$r.onResize=function($V){this._setItemChanged()},$r.addChildAt=function($V,$U){return $V.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$V,$U)},$r.removeChild=function($V){return $V.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$V)},$r.removeChildAt=function($V){return this.getChildAt($V).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$V)},$r.refresh=function(){this._setItemChanged()},$r.changeItems=function(){this._itemChanged=!1},$r.sortItem=function($V){$V&&$V.sort(function($V,$U){return $V.y-$U.y})},$r._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$R(0,$r,"space",function(){return this._space},function($V){this._space=$V,this._setItemChanged()}),$R(0,$r,"align",function(){return this._align},function($V){this._align=$V,this._setItemChanged()}),$U}(),$X=function($U){function $r($V,$U){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$r.__super.call(this),$V&&(this.skin=$V),$U&&(this.sheet=$U)}$c($r,"laya.ui.FontClip",$U);var $V=$r.prototype;return $V.createChildren=function(){this._bitmap=new $z,this.on("loaded",this,this._onClipLoaded)},$V._onClipLoaded=function(){this.callLater(this.changeValue)},$V.changeValue=function(){var $V;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$V=this._sources[0]))){var $U="horizontal"===this._direction;$U?(this._wordsW=this._valueArr.length*($V.sourceWidth+this.spaceX),this._wordsH=$V.sourceHeight):(this._wordsW=$V.sourceWidth,this._wordsH=($V.sourceHeight+this.spaceY)*this._valueArr.length);var $r=0;if(this._width)switch(this._align){case"center":$r=.5*(this._width-this._wordsW);break;case"right":$r=this._width-this._wordsW;break;default:$r=0}for(var $s=0,$p=this._valueArr.length;$s<$p;$s++){var $c=this._indexMap[this._valueArr.charAt($s)];this.sources[$c]&&($V=this.sources[$c],$U?this.graphics.drawTexture($V,$r+$s*($V.sourceWidth+this.spaceX),0,$V.sourceWidth,$V.sourceHeight):this.graphics.drawTexture($V,0+$r,$s*($V.sourceHeight+this.spaceY),$V.sourceWidth,$V.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$V.destroy=function($V){void 0===$V&&($V=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$U.prototype.destroy.call(this,$V)},$R(0,$V,"sheet",function(){return this._sheet},function($V){$V+="";var $U=(this._sheet=$V).split(" ");this._clipX=String($U[0]).length,this.clipY=$U.length,this._indexMap={};for(var $r=0;$r<this._clipY;$r++)for(var $s=$U[$r].split(""),$p=0,$c=$s.length;$p<$c;$p++)this._indexMap[$s[$p]]=$r*this._clipX+$p}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($Z,this,"height",$V),this.callLater(this.changeValue)}),$R(0,$V,"direction",function(){return this._direction},function($V){this._direction=$V,this.callLater(this.changeValue)}),$R(0,$V,"value",function(){return this._valueArr?this._valueArr:""},function($V){$V+="",this._valueArr=$V,this.callLater(this.changeValue)}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($Z,this,"width",$V),this.callLater(this.changeValue)}),$R(0,$V,"spaceX",function(){return this._spaceX},function($V){this._spaceX=$V,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$R(0,$V,"spaceY",function(){return this._spaceY},function($V){this._spaceY=$V,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$R(0,$V,"align",function(){return this._align},function($V){this._align=$V,this.callLater(this.changeValue)}),$R(0,$V,"measureWidth",function(){return this._wordsW}),$R(0,$V,"measureHeight",function(){return this._wordsH}),$r}($Z),$e=function($V){function $U(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $q,$U.__super.call(this)}$c($U,"laya.ui.List",$V);var $r=$U.prototype;return $u.imps($r,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$r.destroy=function($V){void 0===$V&&($V=!0),this._content&&this._content.destroy($V),this._scrollBar&&this._scrollBar.destroy($V),laya.ui.Component.prototype.destroy.call(this,$V),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$r.createChildren=function(){this.addChild(this._content=new $m)},$r.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$u.superGet($m,this,"cacheAs")),$u.superSet($m,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$r.onScrollEnd=function(){$u.superSet($m,this,"cacheAs",this._$P.cacheAs)},$r._removePreScrollBar=function(){var $V=this.removeChildByName("scrollBar");$V&&$V.destroy(!0)},$r.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $V=this._getOneCell(),$U=$V.width+this._spaceX||1,$r=$V.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$U):Math.ceil(this._width/$U)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$r):Math.round(this._height/$r));var $s=this._width?this._width:$U*this.repeatX-this._spaceX,$p=this._height?this._height:$r*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$r:$U,this._cellOffset=this._isVertical?$r*Math.max(this._repeatY2,this._repeatY)-$p-this._spaceY:$U*Math.max(this._repeatX2,this._repeatX)-$s-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$p:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$s),this.setContentSize($s,$p);var $c=this._isVertical?this.repeatX:this.repeatY,$R=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$c,$R),this._createdLine=$R,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$r._getOneCell=function(){if(0===this._cells.length){var $V=this.createItem();if(this._offset.setTo($V.x,$V.y),this.cacheContent)return $V;this._cells.push($V)}return this._cells[0]},$r._createItems=function($V,$U,$r){var $s=this._content,$p=this._getOneCell(),$c=$p.width+this._spaceX,$R=$p.height+this._spaceY;if(this.cacheContent){var $T=new $m;$T.cacheAsBitmap=!0,$T.pos((this._isVertical?0:$V)*$c,(this._isVertical?$V:0)*$R),this._content.addChild($T),this._content.optimizeScrollRect=!0,$s=$T}else{for(var $N=[],$t=this._cells.length-1;-1<$t;$t--){var $b=this._cells[$t];$b.removeSelf(),$N.push($b)}this._cells.length=0}for(var $S=$V;$S<$r;$S++)for(var $_=0;$_<$U;$_++)($p=$N&&$N.length?$N.pop():this.createItem()).x=(this._isVertical?$_:$S)*$c-$s.x,$p.y=(this._isVertical?$S:$_)*$R-$s.y,$p.name="item"+($S*$U+$_),$s.addChild($p),this.addCell($p)},$r.createItem=function(){var $V=[];if("function"==typeof this._itemRender)var $U=new this._itemRender;else $U=$P.createComp(this._itemRender,null,null,$V);if(0==$V.length&&$U._watchMap){var $r=$U._watchMap;for(var $s in $r)for(var $p=$r[$s],$c=0;$c<$p.length;$c++){var $R=$p[$c];$V.push($R.comp,$R.prop,$R.value)}}return $V.length&&($U._$bindData=$V),$U},$r.addCell=function($V){$V.on("click",this,this.onCellMouse),$V.on("rightclick",this,this.onCellMouse),$V.on("mouseover",this,this.onCellMouse),$V.on("mouseout",this,this.onCellMouse),$V.on("mousedown",this,this.onCellMouse),$V.on("mouseup",this,this.onCellMouse),this._cells.push($V)},$r.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $V=0,$U=$V=0;$U<1e4;$U++){var $r=this.getChildByName("item"+$U);if(!$r)break;this.addCell($r),$V++}this.repeatY=$V}},$r.setContentSize=function($V,$U){this._content.width=$V,this._content.height=$U,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $l),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$V,$U),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$r.onCellMouse=function($V){"mousedown"===$V.type&&(this._isMoved=!1);var $U=$V.currentTarget,$r=this._startIndex+this._cells.indexOf($U);$r<0||("click"===$V.type||"rightclick"===$V.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$r:this.changeCellState($U,!0,0):"mouseover"!==$V.type&&"mouseout"!==$V.type||this._selectedIndex===$r||this.changeCellState($U,"mouseover"===$V.type,0),this.mouseHandler&&this.mouseHandler.runWith([$V,$r]))},$r.changeCellState=function($V,$U,$r){var $s=$V.getChildByName("selectBox");$s&&(this.selectEnable=!0,$s.visible=$U,$s.index=$r)},$r.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$r.onScrollBarChange=function($V){this.runCallLater(this.changeCells);var $U=this._scrollBar.value,$r=this._isVertical?this.repeatX:this.repeatY,$s=this._isVertical?this.repeatY:this.repeatX,$p=Math.floor($U/this._cellSize);if(this.cacheContent)$R=$s+1,this._createdLine-$p<$R&&(this._createItems(this._createdLine,$r,this._createdLine+$R),this.renderItems(this._createdLine*$r,0),this._createdLine+=$R);else{var $c=$p*$r,$R=0;if($c>this._startIndex){$R=$c-this._startIndex;var $T=!0,$N=this._startIndex+$r*($s+1);this._isMoved=!0}else $c<this._startIndex&&($R=this._startIndex-$c,$T=!1,$N=this._startIndex-1,this._isMoved=!0);for(var $t=0;$t<$R;$t++){if($T){var $b=this._cells.shift();this._cells[this._cells.length]=$b;var $S=$N+$t}else $b=this._cells.pop(),this._cells.unshift($b),$S=$N-$t;var $_=Math.floor($S/$r)*this._cellSize;this._isVertical?$b.y=$_:$b.x=$_,this.renderItem($b,$S)}this._startIndex=$c,this.changeSelectStatus()}var $G=this._content.scrollRect;this._isVertical?($G.y=$U-this._offset.y,$G.x=-this._offset.x):($G.y=-this._offset.y,$G.x=$U-this._offset.x),this._content.scrollRect=$G},$r.posCell=function($V,$U){if(this._scrollBar){var $r=this._isVertical?this.repeatX:this.repeatY,$s=(this._isVertical?this.repeatY:this.repeatX,Math.floor($U/$r)*this._cellSize);this._isVertical?$V.y=$s:$V.x=$s}},$r.changeSelectStatus=function(){for(var $V=0,$U=this._cells.length;$V<$U;$V++)this.changeCellState(this._cells[$V],this._selectedIndex===this._startIndex+$V,1)},$r.renderItems=function($V,$U){void 0===$V&&($V=0),void 0===$U&&($U=0);for(var $r=$V,$s=$U||this._cells.length;$r<$s;$r++)this.renderItem(this._cells[$r],this._startIndex+$r);this.changeSelectStatus(),this._twDone=!0},$r.renderItem=function($V,$U){this._array&&0<=$U&&$U<this._array.length?($V.visible=!0,$V._$bindData?($V._dataSource=this._array[$U],this._bindData($V,this._array[$U])):$V.dataSource=this._array[$U],this.cacheContent||this.posCell($V,$U),this.hasListener("render")&&this.event("render",[$V,$U]),this.renderHandler&&this.renderHandler.runWith([$V,$U]),this.renderTwHandler&&this.renderTwHandler.runWith([$V,$U])):($V.visible=!1,$V.dataSource=null)},$r._bindData=function($V,$U){for(var $r=$V._$bindData,$s=0,$p=$r.length;$s<$p;$s++){var $c=$r[$s++],$R=$r[$s++],$T=$r[$s],$N=$H.getBindFun($T);$c[$R]=$N.call(this,$U)}},$r.refresh=function(){this.array=this._array},$r.getItem=function($V){return-1<$V&&$V<this._array.length?this._array[$V]:null},$r.changeItem=function($V,$U){-1<$V&&$V<this._array.length&&(this._array[$V]=$U,$V>=this._startIndex&&$V<this._startIndex+this._cells.length&&this.renderItem(this.getCell($V),$V))},$r.setItem=function($V,$U){this.changeItem($V,$U)},$r.addItem=function($V){this._array.push($V),this.array=this._array},$r.addItemAt=function($V,$U){this._array.splice($U,0,$V),this.array=this._array},$r.deleteItem=function($V){this._array.splice($V,1),this.array=this._array},$r.getCell=function($V){return this.runCallLater(this.changeCells),-1<$V&&this._cells?this._cells[($V-this._startIndex)%this._cells.length]:null},$r.scrollTo=function($V){if(this._scrollBar){var $U=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($V/$U)*this._cellSize}else this.startIndex=$V},$r.tweenTo=function($V,$U,$r){if(void 0===$U&&($U=200),this._scrollBar){var $s=this._isVertical?this.repeatX:this.repeatY;$y.to(this._scrollBar,{value:Math.floor($V/$s)*this._cellSize},$U,null,$r,0,!0)}else this.startIndex=$V,$r&&$r.run()},$r._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$r.commitMeasure=function(){this.runCallLater(this.changeCells)},$R(0,$r,"cacheAs",$V.prototype._$get_cacheAs,function($V){$u.superSet($m,this,"cacheAs",$V),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$V?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$R(0,$r,"content",function(){return this._content}),$R(0,$r,"height",$V.prototype._$get_height,function($V){$V!=this._height&&($u.superSet($m,this,"height",$V),this._setCellChanged())}),$R(0,$r,"itemRender",function(){return this._itemRender},function($V){if(this._itemRender!=$V){this._itemRender=$V;for(var $U=this._cells.length-1;-1<$U;$U--)this._cells[$U].destroy();this._cells.length=0,this._setCellChanged()}}),$R(0,$r,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($V){this._removePreScrollBar();var $U=new $UV;$U.name="scrollBar",$U.right=0,$V&&" "!=$V&&($U.skin=$V),this.scrollBar=$U,this.addChild($U),this._setCellChanged()}),$R(0,$r,"page",function(){return this._page},function($V){this._page=$V,this._array&&(this._page=0<$V?$V:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$R(0,$r,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($V){this._removePreScrollBar();var $U=new $F;$U.name="scrollBar",$U.bottom=0,$V&&" "!=$V&&($U.skin=$V),this.scrollBar=$U,this.addChild($U),this._setCellChanged()}),$R(0,$r,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($V){this._repeatX=$V,this._setCellChanged()}),$R(0,$r,"scrollBar",function(){return this._scrollBar},function($V){this._scrollBar!=$V&&(this._scrollBar=$V)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$R(0,$r,"width",$V.prototype._$get_width,function($V){$V!=this._width&&($u.superSet($m,this,"width",$V),this._setCellChanged())}),$R(0,$r,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($V){this._repeatY=$V,this._setCellChanged()}),$R(0,$r,"spaceX",function(){return this._spaceX},function($V){this._spaceX=$V,this._setCellChanged()}),$R(0,$r,"spaceY",function(){return this._spaceY},function($V){this._spaceY=$V,this._setCellChanged()}),$R(0,$r,"selectedIndex",function(){return this._selectedIndex},function($V){this._selectedIndex!=$V&&(this._selectedIndex=$V,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($V),this.startIndex=this._startIndex)}),$R(0,$r,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($V){this.selectedIndex=this._array.indexOf($V)}),$R(0,$r,"length",function(){return this._array?this._array.length:0}),$R(0,$r,"selection",function(){return this.getCell(this._selectedIndex)},function($V){this.selectedIndex=this._startIndex+this._cells.indexOf($V)}),$R(0,$r,"startIndex",function(){return this._startIndex},function($V){this._startIndex=0<$V?$V:0,this.callLater(this.renderItems)}),$R(0,$r,"twSwitch",function(){return this._twSwitch},function($V){this._twSwitch=$V}),$R(0,$r,"twDone",function(){return this._twDone},function($V){this._twDone=$V}),$R(0,$r,"array",function(){return this._array},function($V){this.runCallLater(this.changeCells),this._array=$V||[];var $U=this._array.length;if(this.totalPage=Math.ceil($U/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$U?this._selectedIndex:$U-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $r=this._isVertical?this.repeatX:this.repeatY,$s=this._isVertical?this.repeatY:this.repeatX,$p=Math.ceil($U/$r);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$s/$p,this._scrollBar.setScroll(0,($p-$s)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$R(0,$r,"dataSource",$V.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)&&Math.floor($V)==$V||"string"==typeof $V?this.selectedIndex=parseInt($V):$V instanceof Array?this.array=$V:$u.superSet($m,this,"dataSource",$V)}),$R(0,$r,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$U}($m),$F=function($V){function $U(){$U.__super.call(this)}return $c($U,"laya.ui.HScrollBar",$V),$U.prototype.initialize=function(){$V.prototype.initialize.call(this),this.slider.isVertical=!1},$U}($j),$g=function($V){function $U(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$U.__super.call(this),this.width=this.height=100}$c($U,"laya.ui.Panel",$V);var $r=$U.prototype;return $r.destroy=function($V){void 0===$V&&($V=!0),laya.ui.Component.prototype.destroy.call(this,$V),this._content&&this._content.destroy($V),this._vScrollBar&&this._vScrollBar.destroy($V),this._hScrollBar&&this._hScrollBar.destroy($V),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$r.destroyChildren=function(){this._content.destroyChildren()},$r.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $m)},$r.addChild=function($V){return $V.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($V)},$r.onResize=function(){this._setScrollChanged()},$r.addChildAt=function($V,$U){return $V.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($V,$U)},$r.removeChild=function($V){return $V.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($V)},$r.removeChildAt=function($V){return this.getChildAt($V).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($V)},$r.removeChildren=function($V,$U){return void 0===$V&&($V=0),void 0===$U&&($U=2147483647),this._content.removeChildren($V,$U),this._setScrollChanged(),this},$r.getChildAt=function($V){return this._content.getChildAt($V)},$r.getChildByName=function($V){return this._content.getChildByName($V)},$r.getChildIndex=function($V){return this._content.getChildIndex($V)},$r.changeScroll=function(){this._scrollChanged=!1;var $V=this.contentWidth||1,$U=this.contentHeight||1,$r=this._vScrollBar,$s=this._hScrollBar,$p=$r&&$U>this._height,$c=$s&&$V>this._width,$R=$p?this._width-$r.width:this._width,$T=$c?this._height-$s.height:this._height;$r&&($r.x=this._width-$r.width,$r.y=0,$r.height=this._height-($c?$s.height:0),$r.scrollSize=Math.max(.033*this._height,1),$r.thumbPercent=$T/$U,$r.setScroll(0,$U-$T,$r.value)),$s&&($s.x=0,$s.y=this._height-$s.height,$s.width=this._width-($p?$r.width:0),$s.scrollSize=Math.max(.033*this._width,1),$s.thumbPercent=$R/$V,$s.setScroll(0,$V-$R,$s.value))},$r.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$r.setContentSize=function($V,$U){var $r=this._content;$r.width=$V,$r.height=$U,$r.scrollRect||($r.scrollRect=new $l),$r.scrollRect.setTo(0,0,$V,$U),$r.scrollRect=$r.scrollRect},$r.onScrollBarChange=function($V){var $U=this._content.scrollRect;if($U){var $r=Math.round($V.value);$V.isVertical?$U.y=$r:$U.x=$r,this._content.scrollRect=$U}},$r.scrollTo=function($V,$U){void 0===$V&&($V=0),void 0===$U&&($U=0),this.vScrollBar&&(this.vScrollBar.value=$U),this.hScrollBar&&(this.hScrollBar.value=$V)},$r.refresh=function(){this.changeScroll()},$r.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$u.superGet($m,this,"cacheAs")),$u.superSet($m,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$r.onScrollEnd=function(){$u.superSet($m,this,"cacheAs",this._$P.cacheAs)},$r._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$R(0,$r,"numChildren",function(){return this._content.numChildren}),$R(0,$r,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($V){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $F),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$V}),$R(0,$r,"contentWidth",function(){for(var $V=0,$U=this._content.numChildren-1;-1<$U;$U--){var $r=this._content.getChildAt($U);$V=Math.max($r.x+$r.width*$r.scaleX,$V)}return $V}),$R(0,$r,"contentHeight",function(){for(var $V=0,$U=this._content.numChildren-1;-1<$U;$U--){var $r=this._content.getChildAt($U);$V=Math.max($r.y+$r.height*$r.scaleY,$V)}return $V}),$R(0,$r,"width",$V.prototype._$get_width,function($V){$u.superSet($m,this,"width",$V),this._setScrollChanged()}),$R(0,$r,"hScrollBar",function(){return this._hScrollBar}),$R(0,$r,"content",function(){return this._content}),$R(0,$r,"height",$V.prototype._$get_height,function($V){$u.superSet($m,this,"height",$V),this._setScrollChanged()}),$R(0,$r,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($V){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $UV),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$V}),$R(0,$r,"vScrollBar",function(){return this._vScrollBar}),$R(0,$r,"cacheAs",$V.prototype._$get_cacheAs,function($V){$u.superSet($m,this,"cacheAs",$V),this._$P.cacheAs=null,"none"!==$V?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$U}($m),$v=function($V){function $U($V){$U.__super.call(this,$V),this.isVertical=!1}return $c($U,"laya.ui.HSlider",$o),$U}(),$Y=function($V){function $r($V,$U){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$r.__super.call(this),this.skin=$U,this.labels=$V}$c($r,"laya.ui.UIGroup",$V);var $U=$r.prototype;return $u.imps($U,{"laya.ui.IItem":!0}),$U.preinitialize=function(){this.mouseEnabled=!0},$U.destroy=function($V){void 0===$V&&($V=!0),laya.ui.Component.prototype.destroy.call(this,$V),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$U.addItem=function($V,$U){void 0===$U&&($U=!0);var $r=$V,$s=this._items.length;if($r.name="item"+$s,this.addChild($r),this.initItems(),$U&&0<$s){var $p=this._items[$s-1];"horizontal"==this._direction?$r.x=$p.x+$p.width+this._space:$r.y=$p.y+$p.height+this._space}else $U&&($r.x=0,$r.y=0);return $s},$U.delItem=function($V,$U){void 0===$U&&($U=!0);var $r=this._items.indexOf($V);if(-1!=$r){var $s=$V;this.removeChild($s);for(var $p=$r+1,$c=this._items.length;$p<$c;$p++){var $R=this._items[$p];$R.name="item"+($p-1),$U&&("horizontal"==this._direction?$R.x-=$s.width+this._space:$R.y-=$s.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $T;$T=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$T}}},$U.initItems=function(){this._items||(this._items=[]);for(var $V=this._items.length=0;$V<1e4;$V++){var $U=this.getChildByName("item"+$V);if(null==$U)break;this._items.push($U),$U.selected=$V===this._selectedIndex,$U.clickHandler=$_.create(this,this.itemClick,[$V],!1)}},$U.itemClick=function($V){this.selectedIndex=$V},$U.setSelect=function($V,$U){this._items&&-1<$V&&$V<this._items.length&&(this._items[$V].selected=$U)},$U.createItem=function($V,$U){return null},$U.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $V=0,$U=0,$r=this._items.length;$U<$r;$U++){var $s=this._items[$U];this._skin&&($s.skin=this._skin),this._labelColors&&($s.labelColors=this._labelColors),this._labelSize&&($s.labelSize=this._labelSize),this._labelStroke&&($s.labelStroke=this._labelStroke),this._labelStrokeColor&&($s.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($s.strokeColors=this._strokeColors),this._labelBold&&($s.labelBold=this._labelBold),this._labelPadding&&($s.labelPadding=this._labelPadding),this._labelAlign&&($s.labelAlign=this._labelAlign),this._stateNum&&($s.stateNum=this._stateNum),this._labelFont&&($s.labelFont=this._labelFont),"horizontal"===this._direction?($s.y=0,$s.x=$V,$V+=$s.width+this._space):($s.x=0,$s.y=$V,$V+=$s.height+this._space)}this.changeSize()},$U.commitMeasure=function(){this.runCallLater(this.changeLabels)},$U._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$R(0,$U,"labelStrokeColor",function(){return this._labelStrokeColor},function($V){this._labelStrokeColor!=$V&&(this._labelStrokeColor=$V,this._setLabelChanged())}),$R(0,$U,"skin",function(){return this._skin},function($V){this._skin!=$V&&(this._skin=$V,this._setLabelChanged())}),$R(0,$U,"selectedIndex",function(){return this._selectedIndex},function($V){this._selectedIndex!=$V&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$V,this.setSelect($V,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$R(0,$U,"labels",function(){return this._labels},function($V){if(this._labels!=$V){if(this._labels=$V,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $U=this._labels.split(","),$r=0,$s=$U.length;$r<$s;$r++){var $p=this.createItem(this._skin,$U[$r]);$p.name="item"+$r,this.addChild($p)}this.initItems()}}),$R(0,$U,"strokeColors",function(){return this._strokeColors},function($V){this._strokeColors!=$V&&(this._strokeColors=$V,this._setLabelChanged())}),$R(0,$U,"labelColors",function(){return this._labelColors},function($V){this._labelColors!=$V&&(this._labelColors=$V,this._setLabelChanged())}),$R(0,$U,"labelStroke",function(){return this._labelStroke},function($V){this._labelStroke!=$V&&(this._labelStroke=$V,this._setLabelChanged())}),$R(0,$U,"labelSize",function(){return this._labelSize},function($V){this._labelSize!=$V&&(this._labelSize=$V,this._setLabelChanged())}),$R(0,$U,"stateNum",function(){return this._stateNum},function($V){this._stateNum!=$V&&(this._stateNum=$V,this._setLabelChanged())}),$R(0,$U,"labelBold",function(){return this._labelBold},function($V){this._labelBold!=$V&&(this._labelBold=$V,this._setLabelChanged())}),$R(0,$U,"labelFont",function(){return this._labelFont},function($V){this._labelFont!=$V&&(this._labelFont=$V,this._setLabelChanged())}),$R(0,$U,"labelPadding",function(){return this._labelPadding},function($V){this._labelPadding!=$V&&(this._labelPadding=$V,this._setLabelChanged())}),$R(0,$U,"direction",function(){return this._direction},function($V){this._direction=$V,this._setLabelChanged()}),$R(0,$U,"space",function(){return this._space},function($V){this._space=$V,this._setLabelChanged()}),$R(0,$U,"items",function(){return this._items}),$R(0,$U,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($V){this.selectedIndex=this._items.indexOf($V)}),$R(0,$U,"dataSource",$V.prototype._$get_dataSource,function($V){"number"==typeof(this._dataSource=$V)&&Math.floor($V)==$V||"string"==typeof $V?this.selectedIndex=parseInt($V):$V instanceof Array?this.labels=$V.join(","):$u.superSet($m,this,"dataSource",$V)}),$r}($m),$C=function($U){function $r($V,$U){this._value=null,void 0===$U&&($U=""),$r.__super.call(this,$V,$U)}$c($r,"laya.ui.Radio",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._value=null},$V.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$V.initialize=function(){$U.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$V.onClick=function($V){this.selected=!0},$R(0,$V,"value",function(){return null!=this._value?this._value:this.label},function($V){this._value=$V}),$r}($a),$f=function($V){function $U(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$U.__super.call(this),this.width=this.height=200}$c($U,"laya.ui.Tree",$V);var $r=$U.prototype;return $u.imps($r,{"laya.ui.IRender":!0}),$r.destroy=function($V){void 0===$V&&($V=!0),laya.ui.Component.prototype.destroy.call(this,$V),this._list&&this._list.destroy($V),this._list=null,this._source=null,this._renderHandler=null},$r.createChildren=function(){this.addChild(this._list=new $e),this._list.renderHandler=$_.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$r.onListChange=function($V){this.event("change")},$r.getArray=function(){var $V,$U=[];for(var $r in this._source)$V=this._source[$r],this.getParentOpenStatus($V)&&($V.x=this._spaceLeft*this.getDepth($V),$U.push($V));return $U},$r.getDepth=function($V,$U){return void 0===$U&&($U=0),null==$V.nodeParent?$U:this.getDepth($V.nodeParent,$U+1)},$r.getParentOpenStatus=function($V){var $U=$V.nodeParent;return null==$U||!!$U.isOpen&&(null==$U.nodeParent||this.getParentOpenStatus($U))},$r.renderItem=function($V,$U){var $r=$V.dataSource;if($r){$V.left=$r.x;var $s=$V.getChildByName("arrow");$s&&($r.hasChild?($s.visible=!0,$s.index=$r.isOpen?1:0,$s.tag=$U,$s.off("click",this,this.onArrowClick),$s.on("click",this,this.onArrowClick)):$s.visible=!1);var $p=$V.getChildByName("folder");$p&&(2==$p.clipY?$p.index=$r.isDirectory?0:1:$p.index=$r.isDirectory?$r.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$V,$U])}},$r.onArrowClick=function($V){var $U=$V.currentTarget.tag;this._list.array[$U].isOpen=!this._list.array[$U].isOpen,this.event("open"),this._list.array=this.getArray()},$r.setItemState=function($V,$U){this._list.array[$V]&&(this._list.array[$V].isOpen=$U,this._list.array=this.getArray())},$r.fresh=function(){this._list.array=this.getArray(),this.repaint()},$r.parseXml=function($V,$U,$r,$s){var $p,$c=$V.childNodes,$R=$c.length;if(!$s){$p={};var $T,$N=$V.attributes;for(var $t in $N){var $b=($T=$N[$t]).nodeName,$S=$T.nodeValue;$p[$b]="true"==$S||"false"!=$S&&$S}$p.nodeParent=$r,0<$R&&($p.isDirectory=!0),$p.hasChild=0<$R,$U.push($p)}for(var $_=0;$_<$R;$_++){var $G=$c[$_];this.parseXml($G,$U,$p,!1)}},$r.parseOpenStatus=function($V,$U){for(var $r=0,$s=$U.length;$r<$s;$r++){var $p=$U[$r];if($p.isDirectory)for(var $c=0,$R=$V.length;$c<$R;$c++){var $T=$V[$c];if($T.isDirectory&&this.isSameParent($T,$p)&&$p.label==$T.label){$p.isOpen=$T.isOpen;break}}}},$r.isSameParent=function($V,$U){return null==$V.nodeParent&&null==$U.nodeParent||null!=$V.nodeParent&&null!=$U.nodeParent&&($V.nodeParent.label==$U.nodeParent.label&&this.isSameParent($V.nodeParent,$U.nodeParent))},$r.filter=function($V){if(Boolean($V)){var $U=[];this.getFilterSource(this._source,$U,$V),this._list.array=$U}else this._list.array=this.getArray()},$r.getFilterSource=function($V,$U,$r){var $s;for(var $p in $r=$r.toLocaleLowerCase(),$V)!($s=$V[$p]).isDirectory&&-1<String($s.label).toLowerCase().indexOf($r)&&($s.x=0,$U.push($s)),$s.child&&0<$s.child.length&&this.getFilterSource($s.child,$U,$r)},$R(0,$r,"spaceBottom",function(){return this._list.spaceY},function($V){this._list.spaceY=$V}),$R(0,$r,"keepStatus",function(){return this._keepStatus},function($V){this._keepStatus=$V}),$R(0,$r,"itemRender",function(){return this._list.itemRender},function($V){this._list.itemRender=$V}),$R(0,$r,"array",function(){return this._list.array},function($V){this._keepStatus&&this._list.array&&$V&&this.parseOpenStatus(this._list.array,$V),this._source=$V,this._list.array=this.getArray()}),$R(0,$r,"mouseHandler",function(){return this._list.mouseHandler},function($V){this._list.mouseHandler=$V}),$R(0,$r,"dataSource",$V.prototype._$get_dataSource,function($V){this._dataSource=$V,$u.superSet($m,this,"dataSource",$V)}),$R(0,$r,"source",function(){return this._source}),$R(0,$r,"scrollBar",function(){return this._list.scrollBar}),$R(0,$r,"list",function(){return this._list}),$R(0,$r,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($V){this._list.vScrollBarSkin=$V}),$R(0,$r,"renderHandler",function(){return this._renderHandler},function($V){this._renderHandler=$V}),$R(0,$r,"selectedIndex",function(){return this._list.selectedIndex},function($V){this._list.selectedIndex=$V}),$R(0,$r,"spaceLeft",function(){return this._spaceLeft},function($V){this._spaceLeft=$V}),$R(0,$r,"selectedItem",function(){return this._list.selectedItem},function($V){this._list.selectedItem=$V}),$R(0,$r,"width",$V.prototype._$get_width,function($V){$u.superSet($m,this,"width",$V),this._list.width=$V}),$R(0,$r,"height",$V.prototype._$get_height,function($V){$u.superSet($m,this,"height",$V),this._list.height=$V}),$R(0,$r,"xml",null,function($V){var $U=[];this.parseXml($V.childNodes[0],$U,null,!0),this.array=$U}),$R(0,$r,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$U}($m),$VV=function($V){function $U(){this._items=null,this._selectedIndex=0,$U.__super.call(this),this._setIndexHandler=$_.create(this,this.setIndex,null,!1)}$c($U,"laya.ui.ViewStack",$V);var $r=$U.prototype;return $u.imps($r,{"laya.ui.IItem":!0}),$r.setItems=function($V){this.removeChildren();for(var $U=0,$r=0,$s=$V.length;$r<$s;$r++){var $p=$V[$r];$p&&($p.name="item"+$U,this.addChild($p),$U++)}this.initItems()},$r.addItem=function($V){$V.name="item"+this._items.length,this.addChild($V),this.initItems()},$r.initItems=function(){this._items=[];for(var $V=0;$V<1e4;$V++){var $U=this.getChildByName("item"+$V);if(null==$U)break;this._items.push($U),$U.visible=$V==this._selectedIndex}},$r.setSelect=function($V,$U){this._items&&-1<$V&&$V<this._items.length&&(this._items[$V].visible=$U)},$r.setIndex=function($V){this.selectedIndex=$V},$R(0,$r,"dataSource",$V.prototype._$get_dataSource,function($V){if("number"==typeof(this._dataSource=$V)&&Math.floor($V)==$V||"string"==typeof $V)this.selectedIndex=parseInt($V);else for(var $U in this._dataSource)this.hasOwnProperty($U)&&(this[$U]=this._dataSource[$U])}),$R(0,$r,"selectedIndex",function(){return this._selectedIndex},function($V){this._selectedIndex!=$V&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$V,this.setSelect(this._selectedIndex,!0))}),$R(0,$r,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($V){this.selectedIndex=this._items.indexOf($V)}),$R(0,$r,"items",function(){return this._items}),$R(0,$r,"setIndexHandler",function(){return this._setIndexHandler},function($V){this._setIndexHandler=$V}),$U}($m),$UV=function($V){function $U(){$U.__super.call(this)}return $c($U,"laya.ui.VScrollBar",$j),$U}(),$rV=function($U){function $r($V){this._bg=null,this._skin=null,$r.__super.call(this),void 0===$V&&($V=""),this.text=$V,this.skin=this.skin}$c($r,"laya.ui.TextInput",$U);var $V=$r.prototype;return $V.preinitialize=function(){this.mouseEnabled=!0},$V.destroy=function($V){$W.clearCache(this,this._skin),void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._bg&&this._bg.destroy(),this._bg=null},$V.createChildren=function(){this.addChild(this._tf=new $G),this._tf.padding=$Q.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$V._onFocus=function(){this.event("focus",this)},$V._onBlur=function(){this.event("blur",this)},$V._onInput=function(){this.event("input",this)},$V._onEnter=function(){this.event("enter",this)},$V.initialize=function(){this.width=128,this.height=22},$V.select=function(){this._tf.select()},$V.setSelection=function($V,$U){this._tf.setSelection($V,$U)},$R(0,$V,"text",$U.prototype._$get_text,function($V){this._tf.text!=$V&&($V+="",this._tf.text=$V,this.event("change"))}),$R(0,$V,"bg",function(){return this._bg},function($V){this.graphics=this._bg=$V}),$R(0,$V,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($V){this._tf.inputElementYAdjuster=$V}),$R(0,$V,"multiline",function(){return this._tf.multiline},function($V){this._tf.multiline=$V}),$R(0,$V,"skin",function(){return this._skin},function($V){this._skin!=$V&&($W.clearCache(this,this._skin),this._skin=$V,this._bg||(this.graphics=this._bg=new $z),$W.keepCache(this,this._skin),this._bg.source=$W.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$R(0,$V,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($V){this._bg||(this.graphics=this._bg=new $z),this._bg.sizeGrid=$H.fillArray($Q.defaultSizeGrid,$V,Number)}),$R(0,$V,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($V){this._tf.inputElementXAdjuster=$V}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($i,this,"width",$V),this._bg&&(this._bg.width=$V)}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($i,this,"height",$V),this._bg&&(this._bg.height=$V)}),$R(0,$V,"editable",function(){return this._tf.editable},function($V){this._tf.editable=$V}),$R(0,$V,"restrict",function(){return this._tf.restrict},function($V){this._tf.restrict=$V}),$R(0,$V,"prompt",function(){return this._tf.prompt},function($V){this._tf.prompt=$V}),$R(0,$V,"promptColor",function(){return this._tf.promptColor},function($V){this._tf.promptColor=$V}),$R(0,$V,"maxChars",function(){return this._tf.maxChars},function($V){this._tf.maxChars=$V}),$R(0,$V,"focus",function(){return this._tf.focus},function($V){this._tf.focus=$V}),$R(0,$V,"type",function(){return this._tf.type},function($V){this._tf.type=$V}),$R(0,$V,"asPassword",function(){return this._tf.asPassword},function($V){this._tf.asPassword=$V}),$r}($i),$sV=function($V){function $U(){$U.__super.call(this)}return $c($U,"laya.ui.VSlider",$o),$U}(),$pV=function($V){function $s(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$s.__super.call(this)}$c($s,"laya.ui.Dialog",$V);var $U=$s.prototype;return $U.initialize=function(){this.popupEffect=$s.manager.popupEffectHandler,this.closeEffect=$s.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$U._dealDragArea=function(){var $V=this.getChildByName("drag");$V&&(this.dragArea=$V.x+","+$V.y+","+$V.width+","+$V.height,$V.removeSelf())},$U._onClick=function($V){var $U=$V.target;if($U)switch($U.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($U.name)}},$U.show=function($V,$U){void 0===$V&&($V=!1),void 0===$U&&($U=!0),this._open(!1,$V,$U)},$U.popup=function($V,$U){void 0===$V&&($V=!1),void 0===$U&&($U=!0),this._open(!0,$V,$U)},$U._open=function($V,$U,$r){$s.manager.lock(!1),this.isModal=$V,$s.manager.open(this,$U,$r)},$U.onOpened=function(){},$U.close=function($V,$U){void 0===$U&&($U=!0),$s.manager.close(this,$V,$U)},$U.onClosed=function($V){},$U._onMouseDown=function($V){var $U=this.getMousePoint();this._dragArea.contains($U.x,$U.y)?this.startDrag():this.stopDrag()},$R(0,$U,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($V){if($V){var $U=$H.fillArray([0,0,0,0],$V,Number);this._dragArea=new $l($U[0],$U[1],$U[2],$U[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$R(0,$U,"isPopup",function(){return null!=this.parent}),$R(0,$U,"zOrder",$V.prototype._$get_zOrder,function($V){$u.superSet($P,this,"zOrder",$V),$s.manager._checkMask()}),$R(1,$s,"manager",function(){return $s._manager=$s._manager||new $K},function($V){$s._manager=$V}),$s.setLockView=function($V){$s.manager.setLockView($V)},$s.lock=function($V){$s.manager.lock($V)},$s.closeAll=function(){$s.manager.closeAll()},$s.getDialogsByGroup=function($V){return $s.manager.getDialogsByGroup($V)},$s.closeByGroup=function($V){return $s.manager.closeByGroup($V)},$s.CLOSE="close",$s.CANCEL="cancel",$s.SURE="sure",$s.NO="no",$s.OK="ok",$s.YES="yes",$s._manager=null,$s}($P),$cV=function($V){function $U(){$U.__super.call(this)}$c($U,"laya.ui.HBox",$V);var $r=$U.prototype;return $r.sortItem=function($V){$V&&$V.sort(function($V,$U){return $V.x-$U.x})},$r.changeItems=function(){this._itemChanged=!1;for(var $V=[],$U=0,$r=0,$s=this.numChildren;$r<$s;$r++){var $p=this.getChildAt($r);$p&&$p.layoutEnabled&&($V.push($p),$U=this._height?this._height:Math.max($U,$p.height*$p.scaleY))}this.sortItem($V);var $c=0;for($r=0,$s=$V.length;$r<$s;$r++)($p=$V[$r]).x=$c,$c+=$p.width*$p.scaleX+this._space,"top"==this._align?$p.y=0:"middle"==this._align?$p.y=.5*($U-$p.height*$p.scaleY):"bottom"==this._align&&($p.y=$U-$p.height*$p.scaleY);this.changeSize()},$R(0,$r,"height",$V.prototype._$get_height,function($V){this._height!=$V&&($u.superSet($A,this,"height",$V),this.callLater(this.changeItems))}),$U.NONE="none",$U.TOP="top",$U.MIDDLE="middle",$U.BOTTOM="bottom",$U}($A),$RV=function($V){function $U(){$U.__super.call(this)}$c($U,"laya.ui.VBox",$V);var $r=$U.prototype;return $r.changeItems=function(){this._itemChanged=!1;for(var $V=[],$U=0,$r=0,$s=this.numChildren;$r<$s;$r++){var $p=this.getChildAt($r);$p&&$p.layoutEnabled&&($V.push($p),$U=this._width?this._width:Math.max($U,$p.width*$p.scaleX))}this.sortItem($V);var $c=0;for($r=0,$s=$V.length;$r<$s;$r++)($p=$V[$r]).y=$c,$c+=$p.height*$p.scaleY+this._space,"left"==this._align?$p.x=0:"center"==this._align?$p.x=.5*($U-$p.width*$p.scaleX):"right"==this._align&&($p.x=$U-$p.width*$p.scaleX);this.changeSize()},$R(0,$r,"width",$V.prototype._$get_width,function($V){this._width!=$V&&($u.superSet($A,this,"width",$V),this.callLater(this.changeItems))}),$U.NONE="none",$U.LEFT="left",$U.CENTER="center",$U.RIGHT="right",$U}($A),$TV=function($V){function $U(){$U.__super.call(this)}return $c($U,"laya.ui.RadioGroup",$Y),$U.prototype.createItem=function($V,$U){return new $C($V,$U)},$U}(),$NV=function($V){function $U(){$U.__super.call(this)}return $c($U,"laya.ui.Tab",$Y),$U.prototype.createItem=function($V,$U){return new $a($V,$U)},$U}(),$tV=function($U){function $r($V){this._vScrollBar=null,this._hScrollBar=null,void 0===$V&&($V=""),$r.__super.call(this,$V)}$c($r,"laya.ui.TextArea",$U);var $V=$r.prototype;return $V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$V.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$V.onVBarChanged=function($V){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$V.onHBarChanged=function($V){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$V.changeScroll=function(){var $V=this._vScrollBar&&0<this._tf.maxScrollY,$U=this._hScrollBar&&0<this._tf.maxScrollX,$r=$V?this._width-this._vScrollBar.width:this._width,$s=$U?this._height-this._hScrollBar.height:this._height,$p=this._tf.padding||$Q.labelPadding;this._tf.width=$r,this._tf.height=$s,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$p[2],this._vScrollBar.y=$p[1],this._vScrollBar.height=this._height-($U?this._hScrollBar.height:0)-$p[1]-$p[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$s/Math.max(this._tf.textHeight,$s),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$V),this._hScrollBar&&(this._hScrollBar.x=$p[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$p[3],this._hScrollBar.width=this._width-($V?this._vScrollBar.width:0)-$p[0]-$p[2],this._hScrollBar.scrollSize=Math.max(.033*$r,1),this._hScrollBar.thumbPercent=$r/Math.max(this._tf.textWidth,$r),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$U)},$V.scrollTo=function($V){this.commitMeasure(),this._tf.scrollY=$V},$R(0,$V,"scrollY",function(){return this._tf.scrollY}),$R(0,$V,"width",$U.prototype._$get_width,function($V){$u.superSet($rV,this,"width",$V),this.callLater(this.changeScroll)}),$R(0,$V,"hScrollBar",function(){return this._hScrollBar}),$R(0,$V,"height",$U.prototype._$get_height,function($V){$u.superSet($rV,this,"height",$V),this.callLater(this.changeScroll)}),$R(0,$V,"maxScrollX",function(){return this._tf.maxScrollX}),$R(0,$V,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($V){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $UV),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$V}),$R(0,$V,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($V){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $F),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$V}),$R(0,$V,"vScrollBar",function(){return this._vScrollBar}),$R(0,$V,"maxScrollY",function(){return this._tf.maxScrollY}),$R(0,$V,"scrollX",function(){return this._tf.scrollX}),$r}($rV);!function($V){function $U(){this._uiView=null,this.isCloseOther=!1,$U.__super.call(this)}$c($U,"laya.ui.AsynDialog",$pV);var $r=$U.prototype;$r.createView=function($V){this._uiView=$V},$r._open=function($V,$U,$r){this.isModal=$V,this.isCloseOther=$U,$pV.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$r.onCreated=function(){this.createUI(),this.onOpen()},$r.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$r.onOpen=function(){$pV.manager.open(this,this.isCloseOther),$pV.manager.lock(!1)},$r.close=function($V,$U){void 0===$U&&($U=!0),$pV.manager.close(this),this.onClose()},$r.onClose=function(){},$r.destroy=function($V){void 0===$V&&($V=!0),laya.ui.View.prototype.destroy.call(this,$V),this._uiView=null,this.onDestroy()},$r.onDestroy=function(){}}();$u.__init([$P])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}}),function($_,$V,$d){$d.un,$d.uns;var $S=$d.static,$G=$d.class,$q=$d.getset,$s=$d.__newvec,$L=laya.maths.Arith,$R=laya.webgl.atlas.AtlasResourceManager,$r=laya.webgl.shader.BaseShader,$E=laya.utils.Browser,$T=laya.webgl.utils.Buffer,$k=laya.utils.Byte,$p=laya.utils.ClassUtils,$N=$d.Config,$c=(laya.events.Event,laya.events.EventDispatcher),$Q=laya.utils.Handler,$l=laya.net.Loader,$U=laya.net.LoaderManager,$t=(laya.maths.MathUtil,laya.display.Node),$u=laya.renders.Render,$b=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$h=laya.resource.Resource,$W=laya.utils.RunDriver,$O=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$y=laya.display.Sprite,$D=laya.utils.Stat,$n=laya.utils.StringKey,$H=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$I=laya.utils.Utils,$w=laya.webgl.WebGL,$z=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$d.interface("laya.d3.core.IClone"),$d.interface("laya.d3.graphics.IVertex"),$d.interface("laya.d3.core.render.IUpdate"),$d.interface("laya.d3.core.scene.ITreeNode"),$d.interface("laya.d3.core.render.IRenderable");(function(){function $a(){}$G($a,"laya.d3.animation.AnimationClipParser01"),$a.READ_DATA=function(){$a._DATA.offset=$a._reader.getUint32(),$a._DATA.size=$a._reader.getUint32()},$a.READ_BLOCK=function(){for(var $V=$a._BLOCK.count=$a._reader.getUint16(),$U=$a._BLOCK.blockStarts=[],$r=$a._BLOCK.blockLengths=[],$s=0;$s<$V;$s++)$U.push($a._reader.getUint32()),$r.push($a._reader.getUint32())},$a.READ_STRINGS=function(){var $V=$a._reader.getUint32(),$U=$a._reader.getUint16(),$r=$a._reader.pos;$a._reader.pos=$V+$a._DATA.offset;for(var $s=0;$s<$U;$s++)$a._strings[$s]=$a._reader.readUTFString();$a._reader.pos=$r},$a.parse=function($V,$U){$a._animationClip=$V;($a._reader=$U).__getBuffer();$a.READ_DATA(),$a.READ_BLOCK(),$a.READ_STRINGS();for(var $r=0,$s=$a._BLOCK.count;$r<$s;$r++){var $p=$U.getUint16(),$c=$a._strings[$p],$R=$a["READ_"+$c];if(null==$R)throw new Error("model file err,no this function:"+$p+" "+$c);$R.call()}},$a.READ_ANIMATIONS=function(){var $V,$U=0,$r=0,$s=$a._reader,$p=$s.__getBuffer(),$c=[],$R=$s.getUint8();for($c.length=$R,$U=0;$U<$R;$U++)$c[$U]=$s.getUint16();var $T=[],$N=$s.getUint16();for($T.length=$N,$U=0;$U<$N;$U++)$T[$U]=$s.getFloat32();var $t=$a._animationClip;$t.name=$a._strings[$s.getUint16()];var $b=$t._duration=$s.getFloat32();$t.islooping=!!$s.getByte(),$t._frameRate=$s.getInt16();var $S=$s.getInt16(),$_=$t._nodes=new Array;$_.length=$S,($t._publicClipDatas=[]).length=$S;var $G=$t._nodesMap={},$q=0,$u=0;for($U=0;$U<$S;$U++){$V=$_[$U]=new $B;var $h=$s.getUint16(),$l=$V.path=[];for($l.length=$h,$r=0;$r<$h;$r++)$l[$r]=$a._strings[$s.getUint16()];var $W=$l.join("/"),$O=$G[$W];$O||($G[$W]=$O=[]),$O.push($V);var $L=$s.getInt16();-1!==$L&&($V.componentType=$a._strings[$L]);var $d=$J._propertyIndexDic[$a._strings[$s.getUint16()]];if(null==$d)throw new Error("AnimationClipParser01:unknown property name.");var $k=$d<4,$y=!$k||$k&&""===$l[0];($V._cacheProperty=$y)?$q++:$u++,$V.propertyNameID=$d;var $D=$c[$s.getUint8()];$V.keyFrameWidth=$D/4;var $n=$V.keyFrames=[],$I=$n.length=$s.getUint16(),$Q=null,$H=NaN;for($r=0;$r<$I;$r++){var $w=$n[$r]=new $i;$H=$w.startTime=$T[$s.getUint16()];var $z=$s.pos;$w.inTangent=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$z=$s.pos,$w.outTangent=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$z=$s.pos,$w.data=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$Q&&($Q.next=$w,$Q.duration=$H-$Q.startTime),$Q=$w}$w.next=null,$w.duration=$b-$H}var $E=$t._nodeToCachePropertyMap=new Int32Array($S),$K=$t._cachePropertyMap=new Int32Array($q),$m=$t._unCachePropertyMap=new Int32Array($u);for($q=$u=0,$U=0;$U<$S;$U++)($V=$_[$U])._cacheProperty?($E[$U]=$q,$K[$q++]=$U):$m[$u++]=$U},$a._animationClip=null,$a._reader=null,$a._strings=[],$S($a,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $j(){}$G($j,"laya.d3.animation.AnimationClipParser02"),$j.READ_DATA=function(){$j._DATA.offset=$j._reader.getUint32(),$j._DATA.size=$j._reader.getUint32()},$j.READ_BLOCK=function(){for(var $V=$j._BLOCK.count=$j._reader.getUint16(),$U=$j._BLOCK.blockStarts=[],$r=$j._BLOCK.blockLengths=[],$s=0;$s<$V;$s++)$U.push($j._reader.getUint32()),$r.push($j._reader.getUint32())},$j.READ_STRINGS=function(){var $V=$j._reader.getUint32(),$U=$j._reader.getUint16(),$r=$j._reader.pos;$j._reader.pos=$V+$j._DATA.offset;for(var $s=0;$s<$U;$s++)$j._strings[$s]=$j._reader.readUTFString();$j._reader.pos=$r},$j.parse=function($V,$U){$j._animationClip=$V;($j._reader=$U).__getBuffer();$j.READ_DATA(),$j.READ_BLOCK(),$j.READ_STRINGS();for(var $r=0,$s=$j._BLOCK.count;$r<$s;$r++){var $p=$U.getUint16(),$c=$j._strings[$p],$R=$j["READ_"+$c];if(null==$R)throw new Error("model file err,no this function:"+$p+" "+$c);$R.call()}},$j.READ_ANIMATIONS=function(){var $V,$U=0,$r=0,$s=$j._reader,$p=$s.__getBuffer(),$c=[],$R=$s.getUint8();for($c.length=$R,$U=0;$U<$R;$U++)$c[$U]=$s.getUint16();var $T=[],$N=$s.getUint16();for($T.length=$N,$U=0;$U<$N;$U++)$T[$U]=$s.getFloat32();var $t=$j._animationClip;$t.name=$j._strings[$s.getUint16()];var $b=$t._duration=$s.getFloat32();$t.islooping=!!$s.getByte(),$t._frameRate=$s.getInt16();var $S=$s.getInt16(),$_=$t._nodes=new Array;$_.length=$S,($t._publicClipDatas=[]).length=$S;var $G=$t._nodesMap={},$q=0,$u=0;for($U=0;$U<$S;$U++){$V=$_[$U]=new $B;var $h=$s.getUint16(),$l=$V.path=[];for($l.length=$h,$r=0;$r<$h;$r++)$l[$r]=$j._strings[$s.getUint16()];var $W=$l.join("/"),$O=$G[$W];$O||($G[$W]=$O=[]),$O.push($V);var $L=$s.getInt16();-1!==$L&&($V.componentType=$j._strings[$L]);var $d=$J._propertyIndexDic[$j._strings[$s.getUint16()]];if(null==$d)throw new Error("AnimationClipParser02:unknown property name.");var $k=$d<4,$y=!$k||$k&&""===$l[0];($V._cacheProperty=$y)?$q++:$u++,$V.propertyNameID=$d;var $D=$c[$s.getUint8()];$V.keyFrameWidth=$D/4;var $n=$V.keyFrames=[],$I=$n.length=$s.getUint16(),$Q=null,$H=NaN;for($r=0;$r<$I;$r++){var $w=$n[$r]=new $i;$H=$w.startTime=$T[$s.getUint16()];var $z=$s.pos;$w.inTangent=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$z=$s.pos,$w.outTangent=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$z=$s.pos,$w.data=new Float32Array($p.slice($z,$z+$D)),$s.pos+=$D,$Q&&($Q.next=$w,$Q.duration=$H-$Q.startTime),$Q=$w}$w.next=null,$w.duration=$b-$H}var $E=$s.getUint16();for($U=0;$U<$E;$U++){var $K,$m=new $o;$m.time=$s.getFloat32(),$m.eventName=$j._strings[$s.getUint16()];var $a=$s.getUint16();for(0<$a&&($m.params=$K=[]),$r=0;$r<$a;$r++){switch($s.getByte()){case 0:$K.push(!!$s.getByte());break;case 1:$K.push($s.getInt32());break;case 2:$K.push($s.getFloat32());break;case 3:$K.push($j._strings[$s.getUint16()]);break;default:throw new Error("unknown type.")}}$t.addEvent($m)}var $Z=$t._nodeToCachePropertyMap=new Int32Array($S),$x=$t._cachePropertyMap=new Int32Array($q),$$=$t._unCachePropertyMap=new Int32Array($u);for($q=$u=0,$U=0;$U<$S;$U++)($V=$_[$U])._cacheProperty?($Z[$U]=$q,$x[$q++]=$U):$$[$u++]=$U},$j._animationClip=null,$j._reader=null,$j._strings=[],$S($j,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $o=function(){function $V(){this.time=NaN,this.eventName=null,this.params=null}return $G($V,"laya.d3.animation.AnimationEvent"),$V}(),$J=function(){function $s(){this._childs=[],this.transform=new $WU(this)}$G($s,"laya.d3.animation.AnimationNode");var $V=$s.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.addChild=function($V){$V._parent=this,$V.transform.setParent(this.transform),this._childs.push($V)},$V.removeChild=function($V){var $U=this._childs.indexOf($V);-1!==$U&&this._childs.splice($U,1)},$V.getChildByName=function($V){for(var $U=0,$r=this._childs.length;$U<$r;$U++){var $s=this._childs[$U];if($s.name===$V)return $s}return null},$V.getChildByIndex=function($V){return this._childs[$V]},$V.getChildCount=function(){return this._childs.length},$V.cloneTo=function($V){var $U=$V;$U.name=this.name;for(var $r=0,$s=this._childs.length;$r<$s;$r++){var $p=this._childs[$r],$c=$p.clone();$U.addChild($c);var $R=$p.transform,$T=$c.transform;$T.setLocalPosition($R.getLocalPosition()),$T.setLocalRotation($R.getLocalRotation()),$T.setLocalScale($R.getLocalScale()),$T._localRotationEuler=$R._localRotationEuler,$T._setWorldMatrixIgnoreUpdate($R.getWorldMatrix())}},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$s.__init__=function(){$s.registerAnimationNodeProperty("localPosition",$s._getLocalPosition,$s._setLocalPosition),$s.registerAnimationNodeProperty("localRotation",$s._getLocalRotation,$s._setLocalRotation),$s.registerAnimationNodeProperty("localScale",$s._getLocalScale,$s._setLocalScale),$s.registerAnimationNodeProperty("localRotationEuler",$s._getLocalRotationEuler,$s._setLocalRotationEuler),$s.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$s._getParticleRenderSharedMaterialTintColor,$s._setParticleRenderSharedMaterialTintColor),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$s._getMeshRenderSharedMaterialTilingOffset,$s._setMeshRenderSharedMaterialTilingOffset),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$s._getMeshRenderSharedMaterialAlbedo,$s._setMeshRenderSharedMaterialAlbedo),$s.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$s._getSkinnedMeshRenderSharedMaterialTilingOffset,$s._setSkinnedMeshRenderSharedMaterialTilingOffset),$s.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$s._getSkinnedMeshRenderSharedMaterialAlbedo,$s._setSkinnedMeshRenderSharedMaterialAlbedo),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$s._getMeshRenderSharedMaterialAlbedo,$s._setMeshRenderSharedMaterialAlbedo),$s.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$s._getSkinnedMeshRenderSharedMaterialAlbedo,$s._setSkinnedMeshRenderSharedMaterialAlbedo),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$s._getMeshRenderSharedMaterialIntensity,$s._setMeshRenderSharedMaterialIntensity),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$s._getMeshRenderSharedMaterialAlpha,$s._setMeshRenderSharedMaterialAlpha),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$s._getMeshRenderSharedMaterialAlphaColor,$s._setMeshRenderSharedMaterialAlphaColor),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$s._getMeshRenderSharedMaterialBaseColor,$s._setMeshRenderSharedMaterialBaseColor),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$s._getMeshRenderSharedMaterialDissolve,$s._setMeshRenderSharedMaterialDissolve),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$s._getMeshRenderSharedMaterialDissolveSpeed,$s._setMeshRenderSharedMaterialDissolveSpeed),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$s._getMeshRenderSharedMaterialMMultiplier,$s._setMeshRenderSharedMaterialMMultiplier),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$s._getMeshRenderSharedMaterialBaseScrollSpeedX,$s._setMeshRenderSharedMaterialBaseScrollSpeedX),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$s._getMeshRenderSharedMaterialBaseScrollSpeedY,$s._setMeshRenderSharedMaterialBaseScrollSpeedY),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$s._getMeshRenderSharedMaterialSecondScrollSpeedX,$s._setMeshRenderSharedMaterialSecondScrollSpeedX),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$s._getMeshRenderSharedMaterialSecondScrollSpeedY,$s._setMeshRenderSharedMaterialSecondScrollSpeedY),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$s._getMeshRenderSharedMaterialDetailTilingOffset,$s._setMeshRenderSharedMaterialDetailTilingOffset),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$s._getMeshRenderSharedMaterialDissolveTilingOffset,$s._setMeshRenderSharedMaterialDissolveTilingOffset),$s.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$s._getMeshRenderSharedMaterialMaskTilingOffset,$s._setMeshRenderSharedMaterialMaskTilingOffset)},$s.registerAnimationNodeProperty=function($V,$U,$r){if($s._propertyIndexDic[$V])throw new Error("AnimationNode: this propertyName has registered.");$s._propertyIndexDic[$V]=$s._propertyIDCounter,$s._propertyGetFuncs[$s._propertyIDCounter]=$U,$s._propertySetFuncs[$s._propertyIDCounter]=$r,$s._propertyIDCounter++},$s._getLocalPosition=function($V,$U){return $V?$V.transform.getLocalPosition():$U._transform.localPosition.elements},$s._setLocalPosition=function($V,$U,$r){if($V)$V.transform.setLocalPosition($r);else{var $s=$U._transform,$p=$s.localPosition;$p.elements=$r,$s.localPosition=$p}},$s._getLocalRotation=function($V,$U){return $V?$V.transform.getLocalRotation():$U._transform.localRotation.elements},$s._setLocalRotation=function($V,$U,$r){if($V)$V.transform.setLocalRotation($r);else{var $s=$U._transform,$p=$s.localRotation;$p.elements=$r,$s.localRotation=$p}},$s._getLocalScale=function($V,$U){return $V?$V.transform.getLocalScale():$U._transform.localScale.elements},$s._setLocalScale=function($V,$U,$r){if($V)$V.transform.setLocalScale($r);else{var $s=$U._transform,$p=$s.localScale;$p.elements=$r,$s.localScale=$p}},$s._getLocalRotationEuler=function($V,$U){return $V?$V.transform.getLocalRotationEuler():$U._transform.localRotationEuler.elements},$s._setLocalRotationEuler=function($V,$U,$r){if($V)$V.transform.setLocalRotationEuler($r);else{var $s=$U._transform,$p=$s.localRotationEuler;$p.elements=$r,$s.localRotationEuler=$p}},$s._getMeshRenderSharedMaterialTilingOffset=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $U.meshRender.sharedMaterial.tilingOffset.elements},$s._setMeshRenderSharedMaterialTilingOffset=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).tilingOffset).elements=$r,$s.tilingOffset=$p)}else($p=($s=$U.meshRender.material).tilingOffset).elements=$r,$s.tilingOffset=$p},$s._getMeshRenderSharedMaterialAlbedo=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $U.meshRender.sharedMaterial.albedoColor.elements},$s._setMeshRenderSharedMaterialAlbedo=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).albedoColor).elements=$r,$s.albedoColor=$p)}else($p=($s=$U.meshRender.material).albedoColor).elements=$r,$s.albedoColor=$p},$s._getSkinnedMeshRenderSharedMaterialTilingOffset=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $U.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$s._setSkinnedMeshRenderSharedMaterialTilingOffset=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.skinnedMeshRender.material).tilingOffset).elements=$r,$s.tilingOffset=$p)}else($p=($s=$U.skinnedMeshRender.material).tilingOffset).elements=$r,$s.tilingOffset=$p},$s._getSkinnedMeshRenderSharedMaterialAlbedo=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $U.skinnedMeshRender.sharedMaterial.albedoColor.elements},$s._setSkinnedMeshRenderSharedMaterialAlbedo=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.skinnedMeshRender.material).albedoColor).elements=$r,$s.albedoColor=$p)}else($p=($s=$U.skinnedMeshRender.material).albedoColor).elements=$r,$s.albedoColor=$p},$s._getParticleRenderSharedMaterialTintColor=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.particleRender.sharedMaterial.tintColor.elements:null}return $U.particleRender.sharedMaterial.tintColor.elements},$s._setParticleRenderSharedMaterialTintColor=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.particleRender.material).tintColor).elements=$r,$s.tintColor=$p)}else($p=($s=$U.particleRender.material).tintColor).elements=$r,$s.tintColor=$p},$s._getMeshRenderSharedMaterialAlphaColor=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $U.meshRender.sharedMaterial.alphaColor.elements},$s._setMeshRenderSharedMaterialAlphaColor=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).alphaColor).elements=$r,$s.alphaColor=$p)}else($p=($s=$U.meshRender.material).alphaColor).elements=$r,$s.alphaColor=$p},$s._getMeshRenderSharedMaterialBaseColor=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseColor.elements:null}return $U.meshRender.sharedMaterial.baseColor.elements},$s._setMeshRenderSharedMaterialBaseColor=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).baseColor).elements=$r,$s.baseColor=$p)}else($p=($s=$U.meshRender.material).baseColor).elements=$r,$s.baseColor=$p},$s._getMeshRenderSharedMaterialDissolve=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolve:0}return $U.meshRender.sharedMaterial.dissolve},$s._setMeshRenderSharedMaterialDissolve=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.dissolve=$r[0])}else $U.meshRender.material.dissolve=$r[0]},$s._getMeshRenderSharedMaterialDissolveSpeed=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $U.meshRender.sharedMaterial.dissolveSpeed},$s._setMeshRenderSharedMaterialDissolveSpeed=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.dissolveSpeed=$r[0])}else $U.meshRender.material.dissolveSpeed=$r[0]},$s._getMeshRenderSharedMaterialMMultiplier=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.mMultiplier:0}return $U.meshRender.sharedMaterial.mMultiplier},$s._setMeshRenderSharedMaterialMMultiplier=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.mMultiplier=$r[0])}else $U.meshRender.material.mMultiplier=$r[0]},$s._getMeshRenderSharedMaterialBaseScrollSpeedX=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $U.meshRender.sharedMaterial.baseScrollSpeedX},$s._setMeshRenderSharedMaterialBaseScrollSpeedX=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.baseScrollSpeedX=$r[0])}else $U.meshRender.material.baseScrollSpeedX=$r[0]},$s._getMeshRenderSharedMaterialBaseScrollSpeedY=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $U.meshRender.sharedMaterial.baseScrollSpeedY},$s._setMeshRenderSharedMaterialBaseScrollSpeedY=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.baseScrollSpeedY=$r[0])}else $U.meshRender.material.baseScrollSpeedY=$r[0]},$s._getMeshRenderSharedMaterialSecondScrollSpeedX=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $U.meshRender.sharedMaterial.secondScrollSpeedX},$s._setMeshRenderSharedMaterialSecondScrollSpeedX=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.secondScrollSpeedX=$r[0])}else $U.meshRender.material.secondScrollSpeedX=$r[0]},$s._getMeshRenderSharedMaterialSecondScrollSpeedY=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $U.meshRender.sharedMaterial.secondScrollSpeedY},$s._setMeshRenderSharedMaterialSecondScrollSpeedY=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.secondScrollSpeedY=$r[0])}else $U.meshRender.material.secondScrollSpeedY=$r[0]},$s._getMeshRenderSharedMaterialAlpha=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.alpha:0}return $U.meshRender.sharedMaterial.alpha},$s._setMeshRenderSharedMaterialAlpha=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.alpha=$r[0])}else $U.meshRender.material.alpha=$r[0]},$s._getMeshRenderSharedMaterialIntensity=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.intensity:0}return $U.meshRender.sharedMaterial.intensity},$s._setMeshRenderSharedMaterialIntensity=function($V,$U,$r){if($V){var $s=$V.transform._entity;$s&&($s.owner.meshRender.material.intensity=$r[0])}else $U.meshRender.material.intensity=$r[0]},$s._getMeshRenderSharedMaterialDetailTilingOffset=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $U.meshRender.sharedMaterial.detailTilingOffset.elements},$s._setMeshRenderSharedMaterialDetailTilingOffset=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).detailTilingOffset).elements=$r,$s.detailTilingOffset=$p)}else($p=($s=$U.meshRender.material).detailTilingOffset).elements=$r,$s.detailTilingOffset=$p},$s._getMeshRenderSharedMaterialDissolveTilingOffset=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $U.meshRender.sharedMaterial.dissolveTilingOffset.elements},$s._setMeshRenderSharedMaterialDissolveTilingOffset=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).dissolveTilingOffset).elements=$r,$s.dissolveTilingOffset=$p)}else($p=($s=$U.meshRender.material).dissolveTilingOffset).elements=$r,$s.dissolveTilingOffset=$p},$s._getMeshRenderSharedMaterialMaskTilingOffset=function($V,$U){if($V){var $r=$V.transform._entity;return $r?$r.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $U.meshRender.sharedMaterial.maskTilingOffset.elements},$s._setMeshRenderSharedMaterialMaskTilingOffset=function($V,$U,$r){var $s,$p;if($V){var $c=$V.transform._entity;$c&&(($p=($s=$c.owner.meshRender.material).maskTilingOffset).elements=$r,$s.maskTilingOffset=$p)}else($p=($s=$U.meshRender.material).maskTilingOffset).elements=$r,$s.maskTilingOffset=$p},$s._propertyIDCounter=0,$s._propertyIndexDic={},$s._propertySetFuncs=[],$s._propertyGetFuncs=[],$s}(),$i=function(){function $V(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $G($V,"laya.d3.animation.Keyframe"),$V}(),$B=function(){function $V(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $G($V,"laya.d3.animation.KeyframeNode"),$V}(),$K=(function(){function $V(){this._tempVector30=new $RU,this._tempVector31=new $RU,this._tempVector32=new $RU,this._a=new $RU,this._b=new $RU,this._c=new $RU,this._d=new $RU}$G($V,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $U=$V.prototype;$U.Init=function($V,$U,$r,$s){$V.cloneTo(this._d),$U.cloneTo(this._c),$RU.scale($V,2,this._a),$RU.scale($r,2,this._tempVector30),$RU.subtract(this._a,this._tempVector30,this._a),$RU.add(this._a,$U,this._a),$RU.add(this._a,$s,this._a),$RU.scale($r,3,this._b),$RU.scale($V,3,this._tempVector30),$RU.subtract(this._b,this._tempVector30,this._b),$RU.subtract(this._b,$s,this._b),$RU.scale($U,2,this._tempVector30),$RU.subtract(this._b,this._tempVector30,this._b)},$U.Slerp=function($V,$U){$RU.scale(this._a,$V*$V*$V,this._tempVector30),$RU.scale(this._b,$V*$V,this._tempVector31),$RU.scale(this._c,$V,this._tempVector32),$RU.add(this._tempVector30,this._tempVector31,$U),$RU.add($U,this._tempVector32,$U),$RU.add($U,this._d,$U)}}(),function(){function $x($V,$U,$r,$s){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$V,this._h=$U,this._minHeight=$r,this._maxHeight=$s}$G($x,"laya.d3.core.HeightMap");var $V=$x.prototype;$V._inBounds=function($V,$U){return 0<=$V&&$V<this._h&&0<=$U&&$U<this._w},$V.getHeight=function($V,$U){return this._inBounds($V,$U)?this._datas[$V][$U]:NaN},$q(0,$V,"width",function(){return this._w}),$q(0,$V,"height",function(){return this._h}),$q(0,$V,"maxHeight",function(){return this._maxHeight}),$q(0,$V,"minHeight",function(){return this._minHeight}),$x.creatFromMesh=function($V,$U,$r,$s){for(var $p=[],$c=[],$R=$V.getSubMeshCount(),$T=0;$T<$R;$T++){for(var $N=$V.getSubMesh($T),$t=$N._getVertexBuffer(),$b=$t.getData(),$S=[],$_=0;$_<$b.length;$_+=$t.vertexDeclaration.vertexStride/4){var $G=new $RU($b[$_+0],$b[$_+1],$b[$_+2]);$S.push($G)}$p.push($S);var $q=$N._getIndexBuffer();$c.push($q.getData())}var $u=$V.boundingBox,$h=$u.min.x,$l=$u.min.z,$W=$u.max.x,$O=$u.max.z,$L=$u.min.y,$d=$u.max.y,$k=$W-$h,$y=$O-$l,$D=$s.elements[0]=$k/($U-1),$n=$s.elements[1]=$y/($r-1),$I=new $x($U,$r,$L,$d),$Q=$x._tempRay,$H=$Q.direction.elements;$H[0]=0,$H[1]=-1,$H[2]=0;var $w=$d+.1;$Q.origin.elements[1]=$w;for(var $z=0;$z<$r;$z++){var $E=$l+$z*$n;$I._datas[$z]=[];for(var $K=0;$K<$U;$K++){var $m=$h+$K*$D,$a=$Q.origin.elements;$a[0]=$m,$a[2]=$E;var $Z=$x._getPosition($Q,$p,$c);$I._datas[$z][$K]=$Z===Number.MAX_VALUE?NaN:$w-$Z}}return $I},$x.createFromImage=function($V,$U,$r){for(var $s=$V.width,$p=$V.height,$c=new $x($s,$p,$U,$r),$R=($r-$U)/254,$T=$V.getPixels(),$N=0,$t=0;$t<$p;$t++)for(var $b=$c._datas[$t]=[],$S=0;$S<$s;$S++){var $_=$T[$N++],$G=$T[$N++],$q=$T[$N++],$u=$T[$N++];$b[$S]=255==$_&&255==$G&&255==$q&&255==$u?NaN:($_+$G+$q)/3*$R+$U}return $c},$x._getPosition=function($V,$U,$r){for(var $s=Number.MAX_VALUE,$p=0;$p<$U.length;$p++)for(var $c=$U[$p],$R=$r[$p],$T=0;$T<$R.length;$T+=3){var $N=$c[$R[$T+0]],$t=$c[$R[$T+1]],$b=$c[$R[$T+2]],$S=$qU.rayIntersectsTriangle($V,$N,$t,$b);!isNaN($S)&&$S<$s&&($s=$S)}return $s},$S($x,["_tempRay",function(){return this._tempRay=new $pU(new $RU,new $RU)}])}(),function(){function $p(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$G($p,"laya.d3.core.Layer");var $V=$p.prototype;return $V._binarySearchIndex=function(){for(var $V=0,$U=$p._collsionTestList.length-1,$r=0;$V<=$U;){$r=Math.floor(($V+$U)/2);var $s=$p._collsionTestList[$r];if($s==this._number)return $r;$s>this._number?$U=$r-1:$V=$r+1}return $V},$V._addCollider=function($V){0===this._colliders.length&&$p._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$V._isRigidbody?(this._colliders.unshift($V),this._nonRigidbodyOffset++):this._colliders.push($V)},$V._removeCollider=function($V){var $U=this._colliders.indexOf($V);$U<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($U,1),0===this._colliders.length&&$p._collsionTestList.splice($p._collsionTestList.indexOf(this._number),1)},$q(0,$V,"number",function(){return this._number}),$q(0,$V,"visible",function(){return this._visible},function($V){this._visible=$V,$p._visibleLayers=$V?$p._visibleLayers|this.mask:$p._visibleLayers&~this.mask}),$q(0,$V,"mask",function(){return this._mask}),$q(1,$p,"visibleLayers",function(){return $p._visibleLayers},function($V){$p._visibleLayers=$V;for(var $U=0,$r=$p._layerList.length;$U<$r;$U++){var $s=$p._layerList[$U];$s._visible=0!=($s._mask&$p._visibleLayers)}}),$p.__init__=function(){$p._layerList.length=31;for(var $V=0;$V<31;$V++){var $U=new $p;$p._layerList[$V]=$U,0===$V?($U.name="Default Layer",$U.visible=!0):($U.name="Layer-"+$V,$U.visible=!1),$U._number=$V,$U._mask=Math.pow(2,$V)}$p.currentCreationLayer=$p._layerList[0]},$p.getLayerByNumber=function($V){if($V<0||30<$V)throw new Error("无法返回指定Layer，该number超出范围！");return $p._layerList[$V]},$p.getLayerByName=function($V){for(var $U=0;$U<31;$U++)if($p._layerList[$U].name===$V)return $p._layerList[$U];throw new Error("无法返回指定Layer,该name不存在")},$p.isVisible=function($V){return 0!=($V&$p._currentCameraCullingMask&$p._visibleLayers)},$p._layerList=[],$p._visibleLayers=2147483647,$p._collsionTestList=[],$p._currentCameraCullingMask=2147483647,$p.maxCount=31,$p.currentCreationLayer=null,$p}()),$m=(function(){function $V($V,$U,$r){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$V,this._minCount=$U,this._maxCount=$r}$G($V,"laya.d3.core.particleShuriKen.module.Burst");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.cloneTo=function($V){var $U=$V;$U._time=this._time,$U._minCount=this._minCount,$U._maxCount=this._maxCount},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"time",function(){return this._time}),$q(0,$U,"minCount",function(){return this._minCount}),$q(0,$U,"maxCount",function(){return this._maxCount})}(),function(){function $V($V){this._color=null,this.enbale=!1,this._color=$V}$G($V,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $U=$V.prototype;$U.cloneTo=function($V){var $U=$V;this._color.cloneTo($U._color),$U.enbale=this.enbale},$U.clone=function(){var $V;switch(this._color.type){case 0:$V=$Z.createByConstant(this._color.constant.clone());break;case 1:$V=$Z.createByGradient(this._color.gradient.clone());break;case 2:$V=$Z.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$V=$Z.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $U=new this.constructor($V);return $U.enbale=this.enbale,$U},$q(0,$U,"color",function(){return this._color})}(),function(){function $V(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$G($V,"laya.d3.core.particleShuriKen.module.Emission");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$U._destroy=function(){this._bursts=null,this._destroyed=!0},$U.getBurstsCount=function(){return this._bursts.length},$U.getBurstByIndex=function($V){return this._bursts[$V]},$U.addBurst=function($V){var $U=this._bursts.length;if(0<$U)for(var $r=0;$r<$U;$r++)this._bursts[$r].time>$V.time&&this._bursts.splice($r,0,$V);this._bursts.push($V)},$U.removeBurst=function($V){var $U=this._bursts.indexOf($V);-1!==$U&&this._bursts.splice($U,1)},$U.removeBurstByIndex=function($V){this._bursts.splice($V,1)},$U.clearBurst=function(){this._bursts.length=0},$U.cloneTo=function($V){var $U=$V,$r=$U._bursts;$r.length=this._bursts.length;for(var $s=0,$p=this._bursts.length;$s<$p;$s++){var $c=$r[$s];$c?this._bursts[$s].cloneTo($c):$r[$s]=this._bursts[$s].clone()}$U._emissionRate=this._emissionRate,$U.enbale=this.enbale},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"destroyed",function(){return this._destroyed}),$q(0,$U,"emissionRate",function(){return this._emissionRate},function($V){if($V<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$V})}(),function(){function $s(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$G($s,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $V=$s.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.cloneTo=function($V){var $U=$V;$U._type=this._type,$U._constant=this._constant,this._overTime.cloneTo($U._overTime),$U._constantMin=this._constantMin,$U._constantMax=this._constantMax,this._overTimeMin.cloneTo($U._overTimeMin),this._overTimeMax.cloneTo($U._overTimeMax)},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"frameOverTimeData",function(){return this._overTime}),$q(0,$V,"constant",function(){return this._constant}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"frameOverTimeDataMin",function(){return this._overTimeMin}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"frameOverTimeDataMax",function(){return this._overTimeMax}),$q(0,$V,"constantMax",function(){return this._constantMax}),$s.createByConstant=function($V){var $U=new $s;return $U._type=0,$U._constant=$V,$U},$s.createByOverTime=function($V){var $U=new $s;return $U._type=1,$U._overTime=$V,$U},$s.createByRandomTwoConstant=function($V,$U){var $r=new $s;return $r._type=2,$r._constantMin=$V,$r._constantMax=$U,$r},$s.createByRandomTwoOverTime=function($V,$U){var $r=new $s;return $r._type=3,$r._overTimeMin=$V,$r._overTimeMax=$U,$r},$s}()),$a=function(){function $t(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$G($t,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $V=$t.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.cloneTo=function($V){var $U=$V;$U._type=this._type,$U._separateAxes=this._separateAxes,$U._constant=this._constant,this._constantSeparate.cloneTo($U._constantSeparate),this._gradient.cloneTo($U._gradient),this._gradientX.cloneTo($U._gradientX),this._gradientY.cloneTo($U._gradientY),this._gradientZ.cloneTo($U._gradientZ),$U._constantMin=this._constantMin,$U._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($U._constantMinSeparate),this._constantMaxSeparate.cloneTo($U._constantMaxSeparate),this._gradientMin.cloneTo($U._gradientMin),this._gradientMax.cloneTo($U._gradientMax),this._gradientXMin.cloneTo($U._gradientXMin),this._gradientXMax.cloneTo($U._gradientXMax),this._gradientYMin.cloneTo($U._gradientYMin),this._gradientYMax.cloneTo($U._gradientYMax),this._gradientZMin.cloneTo($U._gradientZMin),this._gradientZMax.cloneTo($U._gradientZMax)},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"gradientZ",function(){return this._gradientZ}),$q(0,$V,"constant",function(){return this._constant}),$q(0,$V,"gradient",function(){return this._gradient}),$q(0,$V,"separateAxes",function(){return this._separateAxes}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"constantSeparate",function(){return this._constantSeparate}),$q(0,$V,"gradientX",function(){return this._gradientX}),$q(0,$V,"gradientY",function(){return this._gradientY}),$q(0,$V,"gradientW",function(){return this._gradientW}),$q(0,$V,"gradientMin",function(){return this._gradientMin}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"gradientMax",function(){return this._gradientMax}),$q(0,$V,"constantMax",function(){return this._constantMax}),$q(0,$V,"gradientWMin",function(){return this._gradientWMin}),$q(0,$V,"constantMinSeparate",function(){return this._constantMinSeparate}),$q(0,$V,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$q(0,$V,"gradientXMin",function(){return this._gradientXMin}),$q(0,$V,"gradientXMax",function(){return this._gradientXMax}),$q(0,$V,"gradientWMax",function(){return this._gradientWMax}),$q(0,$V,"gradientYMin",function(){return this._gradientYMin}),$q(0,$V,"gradientYMax",function(){return this._gradientYMax}),$q(0,$V,"gradientZMin",function(){return this._gradientZMin}),$q(0,$V,"gradientZMax",function(){return this._gradientZMax}),$t.createByConstant=function($V){var $U=new $t;return $U._type=0,$U._separateAxes=!1,$U._constant=$V,$U},$t.createByConstantSeparate=function($V){var $U=new $t;return $U._type=0,$U._separateAxes=!0,$U._constantSeparate=$V,$U},$t.createByGradient=function($V){var $U=new $t;return $U._type=1,$U._separateAxes=!1,$U._gradient=$V,$U},$t.createByGradientSeparate=function($V,$U,$r,$s){var $p=new $t;return $p._type=1,$p._separateAxes=!0,$p._gradientX=$V,$p._gradientY=$U,$p._gradientZ=$r,$p._gradientW=$s,$p},$t.createByRandomTwoConstant=function($V,$U){var $r=new $t;return $r._type=2,$r._separateAxes=!1,$r._constantMin=$V,$r._constantMax=$U,$r},$t.createByRandomTwoConstantSeparate=function($V,$U){var $r=new $t;return $r._type=2,$r._separateAxes=!0,$r._constantMinSeparate=$V,$r._constantMaxSeparate=$U,$r},$t.createByRandomTwoGradient=function($V,$U){var $r=new $t;return $r._type=3,$r._separateAxes=!1,$r._gradientMin=$V,$r._gradientMax=$U,$r},$t.createByRandomTwoGradientSeparate=function($V,$U,$r,$s,$p,$c,$R,$T){var $N=new $t;return $N._type=3,$N._separateAxes=!0,$N._gradientXMin=$V,$N._gradientXMax=$U,$N._gradientYMin=$r,$N._gradientYMax=$s,$N._gradientZMin=$p,$N._gradientZMax=$c,$N._gradientWMin=$R,$N._gradientWMax=$T,$N},$t}(),$Z=function(){function $s(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$G($s,"laya.d3.core.particleShuriKen.module.GradientColor");var $V=$s.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.cloneTo=function($V){var $U=$V;$U._type=this._type,this._constant.cloneTo($U._constant),this._constantMin.cloneTo($U._constantMin),this._constantMax.cloneTo($U._constantMax),this._gradient.cloneTo($U._gradient),this._gradientMin.cloneTo($U._gradientMin),this._gradientMax.cloneTo($U._gradientMax)},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"gradient",function(){return this._gradient}),$q(0,$V,"constant",function(){return this._constant}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"gradientMin",function(){return this._gradientMin}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"gradientMax",function(){return this._gradientMax}),$q(0,$V,"constantMax",function(){return this._constantMax}),$s.createByConstant=function($V){var $U=new $s;return $U._type=0,$U._constant=$V,$U},$s.createByGradient=function($V){var $U=new $s;return $U._type=1,$U._gradient=$V,$U},$s.createByRandomTwoConstant=function($V,$U){var $r=new $s;return $r._type=2,$r._constantMin=$V,$r._constantMax=$U,$r},$s.createByRandomTwoGradient=function($V,$U){var $r=new $s;return $r._type=3,$r._gradientMin=$V,$r._gradientMax=$U,$r},$s}(),$x=(function(){function $V(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$G($V,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.addAlpha=function($V,$U){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$V&&($V=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$V,this._alphaElements[this._alphaCurrentLength++]=$U):DEBUG},$U.addRGB=function($V,$U){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$V&&($V=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$V,this._rgbElements[this._rgbCurrentLength++]=$U.x,this._rgbElements[this._rgbCurrentLength++]=$U.y,this._rgbElements[this._rgbCurrentLength++]=$U.z):DEBUG},$U.cloneTo=function($V){var $U=$V,$r=0,$s=0;$U._alphaCurrentLength=this._alphaCurrentLength;var $p=$U._alphaElements;for($p.length=this._alphaElements.length,$r=0,$s=this._alphaElements.length;$r<$s;$r++)$p[$r]=this._alphaElements[$r];$U._rgbCurrentLength=this._rgbCurrentLength;var $c=$U._rgbElements;for($c.length=this._rgbElements.length,$r=0,$s=this._rgbElements.length;$r<$s;$r++)$c[$r]=this._rgbElements[$r]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$q(0,$U,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $V(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$G($V,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.add=function($V,$U){this._currentLength<8?(6===this._currentLength&&1!==$V&&($V=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$V,this._elements[this._currentLength++]=$U):console.log("Warning:data count must lessEqual than 4")},$U.cloneTo=function($V){var $U=$V;$U._currentLength=this._currentLength;var $r=$U._elements;$r.length=this._elements.length;for(var $s=0,$p=this._elements.length;$s<$p;$s++)$r[$s]=this._elements[$s]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"gradientCount",function(){return this._currentLength/2})}(),function(){function $V(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$G($V,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.add=function($V,$U){this._currentLength<8?(6===this._currentLength&&1!==$V&&($V=1,DEBUG),this._elements[this._currentLength++]=$V,this._elements[this._currentLength++]=$U):DEBUG},$U.getKeyByIndex=function($V){return this._elements[2*$V]},$U.getValueByIndex=function($V){return this._elements[2*$V+1]},$U.getAverageValue=function(){for(var $V=0,$U=this._currentLength-2;$V<$U;$V+=2){this._elements[$V+1];this._elements[$V+3],this._elements[$V+2]-this._elements[$V]}return 0},$U.cloneTo=function($V){var $U=$V;$U._currentLength=this._currentLength;var $r=$U._elements;$r.length=this._elements.length;for(var $s=0,$p=this._elements.length;$s<$p;$s++)$r[$s]=this._elements[$s]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"gradientCount",function(){return this._currentLength/2})}(),function(){function $V(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$G($V,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.add=function($V,$U){this._currentLength<8?(6===this._currentLength&&1!==$V&&($V=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$V,this._elements[this._currentLength++]=$U.x,this._elements[this._currentLength++]=$U.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$U.cloneTo=function($V){var $U=$V;$U._currentLength=this._currentLength;var $r=$U._elements;$r.length=this._elements.length;for(var $s=0,$p=this._elements.length;$s<$p;$s++)$r[$s]=this._elements[$s]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"gradientCount",function(){return this._currentLength/3})}(),function(){function $T(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$G($T,"laya.d3.core.particleShuriKen.module.GradientSize");var $V=$T.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.getMaxSizeInGradient=function(){var $V=0,$U=0,$r=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($V=0,$U=this._gradientX.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientX.getValueByIndex($V));for($V=0,$U=this._gradientY.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientY.getValueByIndex($V))}else for($V=0,$U=this._gradient.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradient.getValueByIndex($V));break;case 1:$r=this._separateAxes?($r=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$r=Math.max($r,this._constantMinSeparate.y),Math.max($r,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($V=0,$U=this._gradientXMin.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientXMin.getValueByIndex($V));for($V=0,$U=this._gradientXMax.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientXMax.getValueByIndex($V));for($V=0,$U=this._gradientYMin.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientYMin.getValueByIndex($V));for($V=0,$U=this._gradientZMax.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientZMax.getValueByIndex($V))}else{for($V=0,$U=this._gradientMin.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientMin.getValueByIndex($V));for($V=0,$U=this._gradientMax.gradientCount;$V<$U;$V++)$r=Math.max($r,this._gradientMax.getValueByIndex($V))}}return $r},$V.cloneTo=function($V){var $U=$V;$U._type=this._type,$U._separateAxes=this._separateAxes,this._gradient.cloneTo($U._gradient),this._gradientX.cloneTo($U._gradientX),this._gradientY.cloneTo($U._gradientY),this._gradientZ.cloneTo($U._gradientZ),$U._constantMin=this._constantMin,$U._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($U._constantMinSeparate),this._constantMaxSeparate.cloneTo($U._constantMaxSeparate),this._gradientMin.cloneTo($U._gradientMin),this._gradientMax.cloneTo($U._gradientMax),this._gradientXMin.cloneTo($U._gradientXMin),this._gradientXMax.cloneTo($U._gradientXMax),this._gradientYMin.cloneTo($U._gradientYMin),this._gradientYMax.cloneTo($U._gradientYMax),this._gradientZMin.cloneTo($U._gradientZMin),this._gradientZMax.cloneTo($U._gradientZMax)},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"gradientZ",function(){return this._gradientZ}),$q(0,$V,"gradient",function(){return this._gradient}),$q(0,$V,"separateAxes",function(){return this._separateAxes}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"gradientMin",function(){return this._gradientMin}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"gradientX",function(){return this._gradientX}),$q(0,$V,"gradientY",function(){return this._gradientY}),$q(0,$V,"gradientMax",function(){return this._gradientMax}),$q(0,$V,"constantMax",function(){return this._constantMax}),$q(0,$V,"constantMinSeparate",function(){return this._constantMinSeparate}),$q(0,$V,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$q(0,$V,"gradientXMin",function(){return this._gradientXMin}),$q(0,$V,"gradientXMax",function(){return this._gradientXMax}),$q(0,$V,"gradientYMin",function(){return this._gradientYMin}),$q(0,$V,"gradientYMax",function(){return this._gradientYMax}),$q(0,$V,"gradientZMin",function(){return this._gradientZMin}),$q(0,$V,"gradientZMax",function(){return this._gradientZMax}),$T.createByGradient=function($V){var $U=new $T;return $U._type=0,$U._separateAxes=!1,$U._gradient=$V,$U},$T.createByGradientSeparate=function($V,$U,$r){var $s=new $T;return $s._type=0,$s._separateAxes=!0,$s._gradientX=$V,$s._gradientY=$U,$s._gradientZ=$r,$s},$T.createByRandomTwoConstant=function($V,$U){var $r=new $T;return $r._type=1,$r._separateAxes=!1,$r._constantMin=$V,$r._constantMax=$U,$r},$T.createByRandomTwoConstantSeparate=function($V,$U){var $r=new $T;return $r._type=1,$r._separateAxes=!0,$r._constantMinSeparate=$V,$r._constantMaxSeparate=$U,$r},$T.createByRandomTwoGradient=function($V,$U){var $r=new $T;return $r._type=2,$r._separateAxes=!1,$r._gradientMin=$V,$r._gradientMax=$U,$r},$T.createByRandomTwoGradientSeparate=function($V,$U,$r,$s,$p,$c){var $R=new $T;return $R._type=2,$R._separateAxes=!0,$R._gradientXMin=$V,$R._gradientXMax=$U,$R._gradientYMin=$r,$R._gradientYMax=$s,$R._gradientZMin=$p,$R._gradientZMax=$c,$R},$T}()),$$=function(){function $T(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$G($T,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $V=$T.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.cloneTo=function($V){var $U=$V;$U._type=this._type,this._constant.cloneTo($U._constant),this._gradientX.cloneTo($U._gradientX),this._gradientY.cloneTo($U._gradientY),this._gradientZ.cloneTo($U._gradientZ),this._constantMin.cloneTo($U._constantMin),this._constantMax.cloneTo($U._constantMax),this._gradientXMin.cloneTo($U._gradientXMin),this._gradientXMax.cloneTo($U._gradientXMax),this._gradientYMin.cloneTo($U._gradientYMin),this._gradientYMax.cloneTo($U._gradientYMax),this._gradientZMin.cloneTo($U._gradientZMin),this._gradientZMax.cloneTo($U._gradientZMax)},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"gradientZ",function(){return this._gradientZ}),$q(0,$V,"constant",function(){return this._constant}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"gradientXMax",function(){return this._gradientXMax}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"gradientX",function(){return this._gradientX}),$q(0,$V,"gradientY",function(){return this._gradientY}),$q(0,$V,"gradientXMin",function(){return this._gradientXMin}),$q(0,$V,"constantMax",function(){return this._constantMax}),$q(0,$V,"gradientYMin",function(){return this._gradientYMin}),$q(0,$V,"gradientYMax",function(){return this._gradientYMax}),$q(0,$V,"gradientZMin",function(){return this._gradientZMin}),$q(0,$V,"gradientZMax",function(){return this._gradientZMax}),$T.createByConstant=function($V){var $U=new $T;return $U._type=0,$U._constant=$V,$U},$T.createByGradient=function($V,$U,$r){var $s=new $T;return $s._type=1,$s._gradientX=$V,$s._gradientY=$U,$s._gradientZ=$r,$s},$T.createByRandomTwoConstant=function($V,$U){var $r=new $T;return $r._type=2,$r._constantMin=$V,$r._constantMax=$U,$r},$T.createByRandomTwoGradient=function($V,$U,$r,$s,$p,$c){var $R=new $T;return $R._type=3,$R._gradientXMin=$V,$R._gradientXMax=$U,$R._gradientYMin=$r,$R._gradientYMax=$s,$R._gradientZMin=$p,$R._gradientZMax=$c,$R},$T}(),$j=(function(){function $V($V){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$V}$G($V,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.cloneTo=function($V){var $U=$V;this._angularVelocity.cloneTo($U._angularVelocity),$U.enbale=this.enbale},$U.clone=function(){var $V;switch(this._angularVelocity.type){case 0:$V=this._angularVelocity.separateAxes?$a.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$a.createByConstant(this._angularVelocity.constant);break;case 1:$V=this._angularVelocity.separateAxes?$a.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$a.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$V=this._angularVelocity.separateAxes?$a.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$a.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$V=this._angularVelocity.separateAxes?$a.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$a.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $U=new this.constructor($V);return $U.enbale=this.enbale,$U},$q(0,$U,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $V(){this.enable=!1,this.randomDirection=!1}$G($V,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.IClone":!0}),$U._getShapeBoundBox=function($V){throw new Error("BaseShape: must override it.")},$U._getSpeedBoundBox=function($V){throw new Error("BaseShape: must override it.")},$U.generatePositionAndDirection=function($V,$U,$r,$s){throw new Error("BaseShape: must override it.")},$U._calculateProceduralBounds=function($V,$U,$r){this._getShapeBoundBox($V);var $s=$V.min,$p=$V.max;$RU.multiply($s,$U,$s),$RU.multiply($p,$U,$p);var $c=new $gV(new $RU,new $RU);this.randomDirection?($c.min=new $RU(-1,-1,-1),$c.max=new $RU(1,1,1)):this._getSpeedBoundBox($c);var $R=new $gV(new $RU,new $RU),$T=$R.min,$N=$R.max;$RU.scale($c.min,$r.y,$T),$RU.scale($c.max,$r.y,$N),$RU.add($V.min,$T,$T),$RU.add($V.max,$N,$N),$RU.min($V.min,$T,$V.min),$RU.max($V.max,$T,$V.max);var $t=new $gV(new $RU,new $RU),$b=$t.min,$S=$t.max;$RU.scale($c.min,$r.x,$b),$RU.scale($c.max,$r.x,$S),$RU.min($t.min,$S,$T),$RU.max($t.min,$S,$N),$RU.min($V.min,$T,$V.min),$RU.max($V.max,$T,$V.max)},$U.cloneTo=function($V){$V.enable=this.enable},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$V}()),$P=function(){function $c(){}return $G($c,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$c._randomPointUnitArcCircle=function($V,$U,$r){var $s=$U.elements,$p=NaN;$p=$r?$r.getFloat()*$V:Math.random()*$V,$s[0]=Math.cos($p),$s[1]=Math.sin($p)},$c._randomPointInsideUnitArcCircle=function($V,$U,$r){var $s=$U.elements;$c._randomPointUnitArcCircle($V,$U,$r);var $p=NaN;$p=$r?Math.pow($r.getFloat(),.5):Math.pow(Math.random(),.5),$s[0]=$s[0]*$p,$s[1]=$s[1]*$p},$c._randomPointUnitCircle=function($V,$U){var $r=$V.elements,$s=NaN;$s=$U?$U.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$r[0]=Math.cos($s),$r[1]=Math.sin($s)},$c._randomPointInsideUnitCircle=function($V,$U){var $r=$V.elements;$c._randomPointUnitCircle($V);var $s=NaN;$s=$U?Math.pow($U.getFloat(),.5):Math.pow(Math.random(),.5),$r[0]=$r[0]*$s,$r[1]=$r[1]*$s},$c._randomPointUnitSphere=function($V,$U){var $r=$V.elements,$s=NaN,$p=NaN;$p=$U?($s=$r[2]=2*$U.getFloat()-1,$U.getFloat()*Math.PI*2):($s=$r[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $c=Math.sqrt(1-$s*$s);$r[0]=$c*Math.cos($p),$r[1]=$c*Math.sin($p)},$c._randomPointInsideUnitSphere=function($V,$U){var $r=$V.elements;$c._randomPointUnitSphere($V);var $s=NaN;$s=$U?Math.pow($U.getFloat(),1/3):Math.pow(Math.random(),1/3),$r[0]=$r[0]*$s,$r[1]=$r[1]*$s,$r[2]=$r[2]*$s},$c._randomPointInsideHalfUnitBox=function($V,$U){var $r=$V.elements;$U?($r[0]=$U.getFloat()-.5,$r[1]=$U.getFloat()-.5,$r[2]=$U.getFloat()-.5):($r[0]=Math.random()-.5,$r[1]=Math.random()-.5,$r[2]=Math.random()-.5)},$c}(),$M=(function(){function $V($V){this._size=null,this.enbale=!1,this._size=$V}$G($V,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.cloneTo=function($V){var $U=$V;this._size.cloneTo($U._size),$U.enbale=this.enbale},$U.clone=function(){var $V;switch(this._size.type){case 0:$V=this._size.separateAxes?$x.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$x.createByGradient(this._size.gradient.clone());break;case 1:$V=this._size.separateAxes?$x.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$x.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$V=this._size.separateAxes?$x.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$x.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $U=new this.constructor($V);return $U.enbale=this.enbale,$U},$q(0,$U,"size",function(){return this._size})}(),function(){function $s(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$G($s,"laya.d3.core.particleShuriKen.module.StartFrame");var $V=$s.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.cloneTo=function($V){var $U=$V;$U._type=this._type,$U._constant=this._constant,$U._constantMin=this._constantMin,$U._constantMax=this._constantMax},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$V,"constant",function(){return this._constant}),$q(0,$V,"type",function(){return this._type}),$q(0,$V,"constantMin",function(){return this._constantMin}),$q(0,$V,"constantMax",function(){return this._constantMax}),$s.createByConstant=function($V){var $U=new $s;return $U._type=0,$U._constant=$V,$U},$s.createByRandomTwoConstant=function($V,$U){var $r=new $s;return $r._type=1,$r._constantMin=$V,$r._constantMax=$U,$r},$s}()),$A=(function(){function $V($V,$U){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $cU(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$V,this._startFrame=$U}$G($V,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.cloneTo=function($V){var $U=$V;this.tiles.cloneTo($U.tiles),$U.type=this.type,$U.randomRow=this.randomRow,this._frame.cloneTo($U._frame),this._startFrame.cloneTo($U._startFrame),$U.cycles=this.cycles,$U.enableUVChannels=this.enableUVChannels,$U.enable=this.enable},$U.clone=function(){var $V,$U;switch(this._frame.type){case 0:$V=$m.createByConstant(this._frame.constant);break;case 1:$V=$m.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$V=$m.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$V=$m.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$U=$M.createByConstant(this._startFrame.constant);break;case 1:$U=$M.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $r=new this.constructor($V,$U);return this.tiles.cloneTo($r.tiles),$r.type=this.type,$r.randomRow=this.randomRow,$r.cycles=this.cycles,$r.enableUVChannels=this.enableUVChannels,$r.enable=this.enable,$r},$q(0,$U,"frame",function(){return this._frame}),$q(0,$U,"startFrame",function(){return this._startFrame})}(),function(){function $V($V){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$V}$G($V,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $U=$V.prototype;$d.imps($U,{"laya.d3.core.IClone":!0}),$U.cloneTo=function($V){var $U=$V;this._velocity.cloneTo($U._velocity),$U.enbale=this.enbale,$U.space=this.space},$U.clone=function(){var $V;switch(this._velocity.type){case 0:$V=$$.createByConstant(this._velocity.constant.clone());break;case 1:$V=$$.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$V=$$.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$V=$$.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $U=new this.constructor($V);return $U.enbale=this.enbale,$U.space=this.space,$U},$q(0,$U,"velocity",function(){return this._velocity})}(),function(){function $V(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $_U,this._vb=$jU.create($V._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$$U.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$ZU.nameKey.getID("LINE"),this._shaderCompile=$DU._preCompileShader[this._sharderNameID]}$G($V,"laya.d3.core.PhasorSpriter3D");var $U=$V.prototype;return $U.line=function($V,$U,$r,$s){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($V.x,$V.y,$V.z,$U.x,$U.y,$U.z,$U.w),this.addVertex($r.x,$r.y,$r.z,$s.x,$s.y,$s.z,$s.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$U.circle=function($V,$U,$r,$s,$p,$c){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$U,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$U,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$V,Math.cos(this._tempNumver0)*$V,0,$r,$s,$p,$c),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$U.plane=function($V,$U,$r,$s,$p,$c,$R,$T,$N){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$s/2,this._tempNumver1=$p/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($V-this._tempNumver0,$U+this._tempNumver1,$r,$c,$R,$T,$N),this.addVertex($V+this._tempNumver0,$U+this._tempNumver1,$r,$c,$R,$T,$N),this.addVertex($V-this._tempNumver0,$U-this._tempNumver1,$r,$c,$R,$T,$N),this.addVertex($V+this._tempNumver0,$U-this._tempNumver1,$r,$c,$R,$T,$N),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$U.box=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$s/2,this._tempNumver1=$p/2,this._tempNumver2=$c/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($V-this._tempNumver0,$U+this._tempNumver1,$r+this._tempNumver2,$R,$T,$N,$t),this.addVertex($V+this._tempNumver0,$U+this._tempNumver1,$r+this._tempNumver2,$R,$T,$N,$t),this.addVertex($V-this._tempNumver0,$U-this._tempNumver1,$r+this._tempNumver2,$R,$T,$N,$t),this.addVertex($V+this._tempNumver0,$U-this._tempNumver1,$r+this._tempNumver2,$R,$T,$N,$t),this.addVertex($V+this._tempNumver0,$U+this._tempNumver1,$r-this._tempNumver2,$R,$T,$N,$t),this.addVertex($V-this._tempNumver0,$U+this._tempNumver1,$r-this._tempNumver2,$R,$T,$N,$t),this.addVertex($V+this._tempNumver0,$U-this._tempNumver1,$r-this._tempNumver2,$R,$T,$N,$t),this.addVertex($V-this._tempNumver0,$U-this._tempNumver1,$r-this._tempNumver2,$R,$T,$N,$t),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$U.cone=function($V,$U,$r,$s,$p,$c,$R){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$r+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$r>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$r,this.addVertexIndex(0,$U,0,$s,$p,$c,$R,this._tempUint0),this.addVertexIndex(0,0,0,$s,$p,$c,$R,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$r;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($V*this._tempNumver2,0,$V*this._tempNumver3,$s,$p,$c,$R,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$r-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($V*this._tempNumver2,0,$V*this._tempNumver3,$s,$p,$c,$R,this._tempUint0+(this._tempInt0+$r)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$r-1?this.addIndexes(this._tempUint1+$r+2):this.addIndexes(this._tempUint1+this._tempInt0+$r+1),this.addIndexes(this._tempUint1+this._tempInt0+$r),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$U.boundingBoxLine=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($V,$p,$c,$R,$T,$N,$t),this.addVertex($s,$p,$c,$R,$T,$N,$t),this.addVertex($V,$U,$c,$R,$T,$N,$t),this.addVertex($s,$U,$c,$R,$T,$N,$t),this.addVertex($s,$p,$r,$R,$T,$N,$t),this.addVertex($V,$p,$r,$R,$T,$N,$t),this.addVertex($s,$U,$r,$R,$T,$N,$t),this.addVertex($V,$U,$r,$R,$T,$N,$t),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$U.addVertex=function($V,$U,$r,$s,$p,$c,$R){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$V,this._vbData[this._posInVBData+1]=$U,this._vbData[this._posInVBData+2]=$r,this._vbData[this._posInVBData+3]=$s,this._vbData[this._posInVBData+4]=$p,this._vbData[this._posInVBData+5]=$c,this._vbData[this._posInVBData+6]=$R,this._posInVBData+=this._floatSizePerVer,this},$U.addVertexIndex=function($V,$U,$r,$s,$p,$c,$R,$T){return this._hasBegun||this.addVertexIndexException(),this._vbData[$T]=$V,this._vbData[$T+1]=$U,this._vbData[$T+2]=$r,this._vbData[$T+3]=$s,this._vbData[$T+4]=$p,this._vbData[$T+5]=$c,this._vbData[$T+6]=$R,($T+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$T),this},$U.addIndexes=function($V){var $U=arguments;this._hasBegun||this.addVertexIndexException();for(var $r=0;$r<$U.length;$r++)this._ibData[this._posInIBData]=$U[$r],this._posInIBData++;return this},$U.begin=function($V,$U){return this._hasBegun&&this.beginException0(),1!==$V&&4!==$V&&this.beginException1(),this._primitiveType=$V,this._camera=$U,this._hasBegun=!0,this},$U.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$U.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($V._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$D.drawCall++,$w.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$U.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$U.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$U.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$U.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$U.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$U.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(28,[new $RV(0,"vector3",0),new $RV(12,"vector4",1)])}]),$V}()),$X=function(){function $V(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$V._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $_U}$G($V,"laya.d3.core.render.RenderElement");var $U=$V.prototype;return $U.getDynamicBatchBakedVertexs=function($V){for(var $U=this._renderObj._getVertexBuffer($V),$r=$U.getData().slice(),$s=$U.vertexDeclaration,$p=$s.getVertexElementByUsage(0).offset/4,$c=$s.getVertexElementByUsage(3).offset/4,$R=this._sprite3D.transform,$T=$R.worldMatrix,$N=$R.rotation,$t=$s.vertexStride/4,$b=0,$S=$r.length;$b<$S;$b+=$t){var $_=$b+$p,$G=$b+$c;$hU.transformVector3ArrayToVector3ArrayCoordinate($r,$_,$T,$r,$_),$hU.transformVector3ArrayByQuat($r,$G,$N,$r,$G)}return $r},$U.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$U._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$q(0,$U,"id",function(){return this._id}),$q(0,$U,"renderObj",function(){return this._renderObj},function($V){this._renderObj!==$V&&(this._renderObj=$V)}),$V._uniqueIDCounter=0,$V}(),$e=function(){function $U($V){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$U._uniqueIDCounter,this._needSort=!1,this._scene=$V,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$G($U,"laya.d3.core.render.RenderQueue");var $V=$U.prototype;return $V._sortOpaqueFunc=function($V,$U){if($V._render&&$U._render){var $r=$V._material.renderQueue-$U._material.renderQueue;return 0==$r?$V._render._distanceForSort-$U._render._distanceForSort:$r}return 0},$V._sortAlphaFunc=function($V,$U){if($V._render&&$U._render){var $r=$V._material.renderQueue-$U._material.renderQueue;return 0==$r?$U._render._distanceForSort-$V._render._distanceForSort:$r}return 0},$V._begainRenderElement=function($V,$U,$r){return!!$U._beforeRender($V)},$V._sortAlpha=function($V){$U._cameraPosition=$V,this._finalElements.sort(this._sortAlphaFunc)},$V._sortOpaque=function($V){$U._cameraPosition=$V,this._finalElements.sort(this._sortOpaqueFunc)},$V._preRender=function($V){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$V._render=function($V,$U){for(var $r,$s,$p,$c,$R,$T,$N=$D.loopCount,$t=this._scene,$b=$V.camera,$S=($b.id,!1),$_=0,$G=this._finalElements.length;$_<$G;$_++){var $q,$u,$h,$l=this._finalElements[$_];if(null!=$l._onPreRenderFunction&&$l._onPreRenderFunction.call($l._sprite3D,$V),0===$l._type){if($V.owner=$h=$l._sprite3D,$V.renderElement=$l,$h._preRenderUpdateComponents($V),$q=$l.renderObj,$u=$l._material,this._begainRenderElement($V,$q,$u)){if($r=$q._getVertexBuffers(),!($p=($s=$q._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$s.id]){this._errorRecord[$s.id]=1;var $W="vertexBuffer:"+("("+$s._destroyed+","+$s._released+","+$s._referenceCount+","+$s._buffer+")")+", material:"+($u?$u.__className+"("+$u._destroyed+","+$u._released+")":"null")+", owner:"+($h?$h.__className+"("+$h._destroyed+","+$h._activeInHierarchy+","+$h._displayedInStage+")":"null")+", renderObj:"+($q?$q.__className+"("+$q._destroyed+","+$q._released+","+$q._referenceCount+")":"")+", parent:, url:"+($h?$h.url:"")+", disposeStack:"+$s.disposeStack;$d.recordError("报错：unknown vertexDeclaration  "+$W)}continue}if($S=($c=$V._shader=$u._getShader($t._shaderDefineValue,$p.shaderDefineValue,$h._shaderDefineValue)).bind()||$N!==$c._uploadLoopCount,$r){if($c._uploadVertexBuffer!==$r||$S){for(var $O=0;$O<$r.length;$O++){var $L=$r[$O];$c.uploadAttributesX($L.vertexDeclaration.shaderValues.data,$L)}$c._uploadVertexBuffer=$r}}else($c._uploadVertexBuffer!==$s||$S)&&($c.uploadAttributes($p.shaderValues.data,null),$c._uploadVertexBuffer=$s);($c._uploadScene!==$t||$S)&&($c.uploadSceneUniforms($t._shaderValues.data),$c._uploadScene=$t),($b!==$c._uploadCamera||$c._uploadSprite3D!==$h||$S)&&($c.uploadSpriteUniforms($h._shaderValues.data),$c._uploadSprite3D=$h),($b!==$c._uploadCamera||$S)&&($c.uploadCameraUniforms($b._shaderValues.data),$c._uploadCamera=$b),($c._uploadMaterial!==$u||$S)&&($u._upload(),$c._uploadMaterial=$u),$R!==$u?($u._setRenderStateBlendDepth(),$u._setRenderStateFrontFace($U,$h.transform),$R=$u,$T=$h):$T!==$h&&($u._setRenderStateFrontFace($U,$h.transform),$T=$h),$q._render($V),$c._uploadLoopCount=$N}$h._postRenderUpdateComponents($V)}else if(2===$l._type){$l.renderObj;$V.owner=$h=$l._sprite3D,$V.renderElement=$l,$V._batchIndexStart=$l._tempBatchIndexStart,$V._batchIndexEnd=$l._tempBatchIndexEnd,$q=$l.renderObj,$u=$l._material,this._begainRenderElement($V,$q,$u)&&($p=($s=$q._getVertexBuffer(0)).vertexDeclaration,$S=($c=$V._shader=$u._getShader($t._shaderDefineValue,$p.shaderDefineValue,$h._shaderDefineValue)).bind()||$N!==$c._uploadLoopCount,($c._uploadVertexBuffer!==$s||$S)&&($c.uploadAttributes($p.shaderValues.data,null),$c._uploadVertexBuffer=$s),($c._uploadScene!==$t||$S)&&($c.uploadSceneUniforms($t._shaderValues.data),$c._uploadScene=$t),($b!==$c._uploadCamera||$c._uploadSprite3D!==$h||$S)&&($c.uploadSpriteUniforms($h._shaderValues.data),$c._uploadSprite3D=$h),($b!==$c._uploadCamera||$S)&&($c.uploadCameraUniforms($b._shaderValues.data),$c._uploadCamera=$b),($c._uploadMaterial!==$u||$S)&&($u._upload(),$c._uploadMaterial=$u),$R!==$u?($u._setRenderStateBlendDepth(),$u._setRenderStateFrontFace($U,$h.transform),$R=$u,$T=$h):$T!==$h&&($u._setRenderStateFrontFace($U,$h.transform),$T=$h),$q._render($V),$c._uploadLoopCount=$N)}}},$V._renderShadow=function($V,$U){for(var $r,$s,$p,$c,$R,$T=$D.loopCount,$N=this._scene,$t=$V.camera,$b=!1,$S=0,$_=this._finalElements.length;$S<$_;$S++){var $G,$q,$u,$h=this._finalElements[$S];0===$h._type&&($V.owner=$u=$h._sprite3D,$U||$u._projectionViewWorldUpdateCamera===$t&&$u._projectionViewWorldUpdateLoopCount===$D.loopCount||($u._render._renderUpdate($V._projectionViewMatrix),$u._projectionViewWorldUpdateLoopCount=$D.loopCount,$u._projectionViewWorldUpdateCamera=$t),$V.renderElement=$h,$u._preRenderUpdateComponents($V),$G=$h.renderObj,$q=$h._material,this._begainRenderElement($V,$G,null)&&($s=($r=$G._getVertexBuffer(0)).vertexDeclaration,$b=($p=$V._shader=$q._getShader($N._shaderDefineValue,$s.shaderDefineValue,$u._shaderDefineValue)).bind()||$T!==$p._uploadLoopCount,($p._uploadVertexBuffer!==$r||$b)&&($p.uploadAttributes($s.shaderValues.data,null),$p._uploadVertexBuffer=$r),($t!==$p._uploadCamera||$p._uploadSprite3D!==$u||$b)&&($p.uploadSpriteUniforms($u._shaderValues.data),$p._uploadSprite3D=$u),($t!==$p._uploadCamera||$b)&&($p.uploadCameraUniforms($t._shaderValues.data),$p._uploadCamera=$t),($p._uploadMaterial!==$q||$b)&&($q._upload(),$p._uploadMaterial=$q),$p._uploadRenderElement,$c!==$q?($q._setRenderStateFrontFace(!1,$u.transform),$c=$q,$R=$u):$R!==$u&&($q._setRenderStateFrontFace(!1,$u.transform),$R=$u),$G._render($V),$p._uploadLoopCount=$T),$u._postRenderUpdateComponents($V))}},$V._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$V._addRenderElement=function($V){this._renderElements.push($V),this._needSort=!0},$V._addDynamicBatchElement=function($V){this._dynamicBatchCombineRenderElements.push($V)},$q(0,$V,"id",function(){return this._id}),$U._uniqueIDCounter=0,$U._cameraPosition=null,$U}(),$F=function(){function $V(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $G($V,"laya.d3.core.render.RenderState"),$V.clientWidth=0,$V.clientHeight=0,$V}(),$g=function(){function $R($V,$U){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $YV(new $RU,0),this._corners=[new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU],this._boundingBoxCenter=new $RU,this._children=$s(8),this._objects=[],this._tempBoundBoxCorners=[new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU],this._scene=$V,this._currentDepth=$U}$G($R,"laya.d3.core.scene.OctreeNode");var $V=$R.prototype;return $d.imps($V,{"laya.d3.core.scene.ITreeNode":!0}),$V.init=function($V,$U){var $r=new $RU,$s=new $RU;$RU.scale($U,-.5,$r),$RU.scale($U,.5,$s),$RU.add($r,$V,$r),$RU.add($s,$V,$s),this.exactBox=new $gV($r,$s),this.relaxBox=new $gV($r,$s)},$V.addTreeNode=function($V){1===Collision.boxContainsBox(this._relaxBox,$V.boundingBox)?this.addNodeDown($V,0):this.addObject($V)},$V.addChild=function($V){var $U=this._children[$V];if(null==$U){$U=new $R(this._scene,this._currentDepth+1),(this._children[$V]=$U)._parent=this,$RU.subtract(this._exactBox.max,this._exactBox.min,$R.tempSize),$RU.multiply($R.tempSize,$R._octreeSplit[$V],$R.tempCenter),$RU.add(this._exactBox.min,$R.tempCenter,$R.tempCenter),$RU.scale($R.tempSize,.25,$R.tempSize);var $r=new $RU,$s=new $RU;$RU.subtract($R.tempCenter,$R.tempSize,$r),$RU.add($R.tempCenter,$R.tempSize,$s),$U.exactBox=new $gV($r,$s),$RU.scale($R.tempSize,$R.relax,$R.tempSize);var $p=new $RU,$c=new $RU;$RU.subtract($R.tempCenter,$R.tempSize,$p),$RU.add($R.tempCenter,$R.tempSize,$c),$U.relaxBox=new $gV($p,$c)}return $U},$V.addObject=function($V){($V._treeNode=this)._objects.push($V)},$V.removeObject=function($V){if($V._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $U=this._objects.indexOf($V);return-1!==$U&&(this._objects.splice($U,1),!0)},$V.clearObject=function(){this._objects.length=0},$V.addNodeUp=function($V,$U){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$V.boundingBox)?this._parent.addNodeUp($V,$U-1):this.addNodeDown($V,$U)},$V.addNodeDown=function($V,$U){if($U<this._scene.treeLevel){var $r=this.inChildIndex($V.boundingBoxCenter),$s=this.addChild($r);1===Collision.boxContainsBox($s._relaxBox,$V.boundingBox)?$s.addNodeDown($V,++$U):this.addObject($V)}else this.addObject($V)},$V.inChildIndex=function($V){return 4*($V.z<this._boundingBoxCenter.z?0:1)+2*($V.y<this._boundingBoxCenter.y?0:1)+($V.x<this._boundingBoxCenter.x?0:1)},$V.updateObject=function($V){1===Collision.boxContainsBox(this._relaxBox,$V.boundingBox)?(this.removeObject($V),$V._treeNode=null,this.addNodeDown($V,this._currentDepth)):this._parent&&(this.removeObject($V),$V._treeNode=null,this._parent.addNodeUp($V,this._currentDepth-1))},$V.cullingObjects=function($V,$U,$r,$s,$p){var $c,$R=0,$T=0,$N=0,$t=this._scene._dynamicBatchManager;for($R=0,$c=this._objects.length;$R<$c;$R++){var $b=this._objects[$R];if($K.isVisible($b._owner.layer.mask)&&$b.enable){if($U&&($D.treeSpriteCollision+=1,0===$V.containsBoundSphere($b.boundingSphere)))continue;$b._renderUpdate($p),$b._distanceForSort=$RU.distance($b.boundingSphere.center,$s)+$b.sortingFudge;var $S=$b._renderElements;for($T=0,$N=$S.length;$T<$N;$T++){var $_=$S[$T],$G=$_._staticBatch;if($G&&$G._material===$_._material)$G._addBatchRenderElement($_);else{var $q=$_.renderObj;$q.triangleCount<10&&1===$q._vertexBufferCount&&$q._getIndexBuffer()&&$_._material.renderQueue<2&&$_._canDynamicBatch&&!$b._owner.isStatic?$t._addPrepareRenderElement($_):this._scene.getRenderQueue($_._material.renderQueue)._addRenderElement($_)}}}}for($R=0;$R<8;$R++){var $u=this._children[$R];if(null!=$u){var $h=$U;if($U){var $l=$V.containsBoundBox($u._relaxBox);if($D.treeNodeCollision+=1,0===$l)continue;$h=2===$l}$u.cullingObjects($V,$h,$r,$s,$p)}}},$V.cullingShadowObjects=function($V,$U,$r,$s,$p){var $c,$R=0,$T=0,$N=0;this._scene._dynamicBatchManager;for($R=0,$c=this._objects.length;$R<$c;$R++){var $t=this._objects[$R];if($t.castShadow&&$K.isVisible($t._owner.layer.mask)&&$t.enable){if($r&&0===$V[0].containsBoundSphere($t.boundingSphere))continue;for(var $b=1,$S=$V.length;$b<$S;$b++){var $_=$U[$b-1];if(0!==$V[$b].containsBoundSphere($t.boundingSphere)){var $G=$t._renderElements;for($T=0,$N=$G.length;$T<$N;$T++)$_._addRenderElement($G[$T])}}}}for($R=0;$R<8;$R++){var $q=this._children[$R];if(null!=$q){var $u=$r;if($r){var $h=$V[0].containsBoundBox($q._relaxBox);if(0===$h)continue;$u=2===$h}$q.cullingShadowObjects($V,$U,$u,$s,$p)}}},$V.cullingShadowObjectsOnePSSM=function($V,$U,$r,$s,$p,$c){var $R,$T=$U[0],$N=0,$t=0,$b=0;for($N=0,$R=this._objects.length;$N<$R;$N++){var $S=this._objects[$N];if($S.castShadow&&$K.isVisible($S._owner.layer.mask)&&$S.enable){if($s&&0===$V.containsBoundSphere($S.boundingSphere))continue;$S._renderUpdate($r);var $_=$S._renderElements;for($t=0,$b=$_.length;$t<$b;$t++)$T._addRenderElement($_[$t])}}for($N=0;$N<8;$N++){var $G=this._children[$N];if(null!=$G){var $q=$s;if($s){var $u=$V.containsBoundBox($G._relaxBox);if(0===$u)continue;$q=2===$u}$G.cullingShadowObjectsOnePSSM($V,$U,$r,$q,$p,$c)}}},$V.renderBoudingBox=function($V){this._renderBoudingBox($V);for(var $U=0;$U<8;++$U){var $r=this._children[$U];$r&&$r.renderBoudingBox($V)}},$V.buildAllChild=function($V){if($V<this._scene.treeLevel)for(var $U=0;$U<8;$U++){this.addChild($U).buildAllChild($V+1)}},$V._renderBoudingBox=function($V){},$q(0,$V,"exactBox",function(){return this._exactBox},function($V){this._exactBox=$V,$RU.add($V.min,$V.max,this._boundingBoxCenter),$RU.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$q(0,$V,"relaxBox",function(){return this._relaxBox},function($V){(this._relaxBox=$V).getCorners(this._corners),$YV.createfromPoints(this._corners,this._boundingSphere)}),$R.debugMode=!1,$R.relax=1.15,$R.CHILDNUM=8,$S($R,["tempVector0",function(){return this.tempVector0=new $RU},"tempSize",function(){return this.tempSize=new $RU},"tempCenter",function(){return this.tempCenter=new $RU},"_octreeSplit",function(){return this._octreeSplit=[new $RU(.25,.25,.25),new $RU(.75,.25,.25),new $RU(.25,.75,.25),new $RU(.75,.75,.25),new $RU(.25,.25,.75),new $RU(.75,.25,.75),new $RU(.25,.75,.75),new $RU(.75,.75,.75)]}]),$R}(),$v=(function(){function $V(){}$G($V,"laya.d3.core.scene.SceneManager")}(),function(){function $V($V,$U,$r,$s){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$V&&($V=1),void 0===$U&&($U=1),void 0===$r&&($r=1),void 0===$s&&($s=1),this._r=$V,this._g=$U,this._b=$r,this._a=$s}return $G($V,"laya.d3.core.trail.module.Color",null,"Color$1"),$V.prototype.cloneTo=function($V){$V._r=this._r,$V._g=this._g,$V._b=this._b,$V._a=this._a},$S($V,["RED",function(){return this.RED=new $V(1,0,0,1)},"GREEN",function(){return this.GREEN=new $V(0,1,0,1)},"BLUE",function(){return this.BLUE=new $V(0,0,1,1)},"CYAN",function(){return this.CYAN=new $V(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $V(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $V(1,0,1,1)},"GRAY",function(){return this.GRAY=new $V(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $V(1,1,1,1)},"BLACK",function(){return this.BLACK=new $V(0,0,0,1)}]),$V}()),$Y=(function(){function $V(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$G($V,"laya.d3.core.trail.module.Gradient");var $U=$V.prototype;$U.setKeys=function($V,$U){var $r,$s;this._colorKeys=$V;for(var $p=this.index=0;$p<$V.length;$p++){var $c=($r=$V[$p]).color;this._colorKeyData[this.index++]=$c._r,this._colorKeyData[this.index++]=$c._g,this._colorKeyData[this.index++]=$c._b,this._colorKeyData[this.index++]=$r.time}this._alphaKeys=$U;for(var $R=this.index=0;$R<$U.length;$R++)$s=$U[$R],this._alphaKeyData[this.index++]=$s.alpha,this._alphaKeyData[this.index++]=$s.time},$U.cloneTo=function($V){var $U=0,$r=0,$s=this.colorKeys,$p=[];for($U=0,$r=$s.length;$U<$r;$U++){var $c=new $C;$s[$U].cloneTo($c),$p.push($c)}var $R=this.alphaKeys,$T=[];for($U=0,$r=$R.length;$U<$r;$U++){var $N=new $Y;$R[$U].cloneTo($N),$T.push($N)}$V.setKeys($p,$T)},$q(0,$U,"mode",function(){return this._mode},function($V){this._mode=$V}),$q(0,$U,"colorKeys",function(){return this._colorKeys},function($V){this._colorKeys=$V;for(var $U=this.index=0;$U<$V.length;$U++){var $r=$V[$U],$s=$r.color;this._colorKeyData[this.index++]=$s._r,this._colorKeyData[this.index++]=$s._g,this._colorKeyData[this.index++]=$s._b,this._colorKeyData[this.index++]=$r.time}}),$q(0,$U,"alphaKeys",function(){return this._alphaKeys},function($V){this._alphaKeys=$V;for(var $U=this.index=0;$U<$V.length;$U++){var $r=$V[$U];this._alphaKeyData[this.index++]=$r.alpha,this._alphaKeyData[this.index++]=$r.time}})}(),function(){function $V($V,$U){this._alpha=NaN,this._time=NaN,void 0===$V&&($V=0),void 0===$U&&($U=0),this._alpha=$V,this._time=$U}$G($V,"laya.d3.core.trail.module.GradientAlphaKey");var $U=$V.prototype;return $U.cloneTo=function($V){$V.alpha=this.alpha,$V.time=this.time},$q(0,$U,"alpha",function(){return this._alpha},function($V){this._alpha=$V}),$q(0,$U,"time",function(){return this._time},function($V){this._time=$V}),$V}()),$C=function(){function $V($V,$U){this._color=null,this._time=NaN,void 0===$U&&($U=0),this._color=$V||new $v,this._time=$U}$G($V,"laya.d3.core.trail.module.GradientColorKey");var $U=$V.prototype;return $U.cloneTo=function($V){this.color.cloneTo($V.color),$V.time=this.time},$q(0,$U,"color",function(){return this._color},function($V){this._color=$V}),$q(0,$U,"time",function(){return this._time},function($V){this._time=$V}),$V}(),$f=(function(){function $V(){}$G($V,"laya.d3.core.trail.module.GradientMode"),$V.Blend=0,$V.Fixed=1}(),function(){function $V(){}$G($V,"laya.d3.core.trail.module.TextureMode"),$V.Stretch=0,$V.Tile=1}(),function(){function $V(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$G($V,"laya.d3.core.trail.module.TrailKeyFrame"),$V.prototype.cloneTo=function($V){$V.time=this.time,$V.inTangent=this.inTangent,$V.outTangent=this.outTangent,$V.value=this.value}}(),function(){function $U($V){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $RU,this._curPosition=new $RU,this._delVector3=new $RU,this._lastFixedVertexPosition=new $RU,this._pointAtoBVector3=new $RU,this._pointA=new $RU,this._pointB=new $RU,this._owner=$V,this._id=$U.renderElementCount++,0==this._id?$V._owner.transform.position.cloneTo(this._lastPosition):$V._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $jU($f.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $jU($f.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$G($U,"laya.d3.core.trail.TrailRenderElement");var $V=$U.prototype;$d.imps($V,{"laya.d3.core.render.IRenderable":!0}),$V._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$V._addTrailByFirstPosition=function($V,$U){$RU.subtract($U,$V,this._delVector3),$RU.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$RU.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$RU.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($V),$V.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$V._addTrailByNextPosition=function($V){$RU.subtract($V,this._lastFixedVertexPosition,this._delVector3),$RU.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$RU.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$RU.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$RU.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$CV.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($V),$V.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($V),this._virtualVerticesCount=2)},$V._updateVerticesByPosition=function($V){this._pointe=$V.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$V._updateVertexBuffer2=function(){var $V,$U=0,$r=0,$s=0;for($s=0,$V=(this._verticesCount+this._virtualVerticesCount)/2;$s<$V;$s++)$r=0==this._owner.textureMode?(this._VerticesToTailLength[$s]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$s],this._vertices2[$U++]=1-$r,this._vertices2[$U++]=1-$r;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$V._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$V._updateDisappear=function(){var $V,$U=0;for($U=this._curDisappearIndex,$V=(this._verticesCount+this._virtualVerticesCount)/2;$U<$V;$U++)this._owner._curtime-this._everyGroupVertexBirthTime[$U]>=this._owner.time+$CV.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$V._beforeRender=function($V){return this._camera=$V.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$RU.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$V._render=function($V){this._isDead||($w.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$D.drawCall++,$D.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$V._getVertexBuffer=function($V){return void 0===$V&&($V=0),0===$V?this._vertexBuffer1:1===$V?this._vertexBuffer2:null},$V._getVertexBuffers=function(){return this._vertexBuffers},$V._getIndexBuffer=function(){return null},$V.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$V._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$q(0,$V,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$q(0,$V,"triangleCount",function(){return 0}),$U.renderElementCount=0}(),function(){function $V(){}$G($V,"laya.d3.core.trail.VertexTrail");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration1}),$q(1,$V,"vertexDeclaration1",function(){return $V._vertexDeclaration1}),$q(1,$V,"vertexDeclaration2",function(){return $V._vertexDeclaration2}),$S($V,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $cV(32,[new $RV(0,"vector3",0),new $RV(12,"vector3",41),new $RV(24,"single",33),new $RV(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $cV(4,[new $RV(0,"single",38)])}]),$V}()),$VV=function(){function $L($V){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$V}$G($L,"laya.d3.graphics.DynamicBatch");var $V=$L.prototype;return $d.imps($V,{"laya.d3.core.render.IRenderable":!0}),$V._getVertexBuffer=function($V){return void 0===$V&&($V=0),0===$V?this._vertexBuffer:null},$V._getIndexBuffer=function(){return this._indexBuffer},$V._getCombineRenderElementFromPool=function($V,$U,$r){var $s=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $s||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$s=new $X,$s._sprite3D=new $eU),$s._sprite3D._render._renderUpdate($r),$s},$V._getRenderElement=function($V,$U,$r){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$L.maxVertexCount),this._indexDatas=new Uint16Array($L.maxIndexCount),this._vertexBuffer=$jU.create(this._vertexDeclaration,$L.maxVertexCount,35048),this._indexBuffer=$$U.create("ushort",$L.maxIndexCount,35048));for(var $s=this._merageElements.length=0,$p=0,$c=0,$R=this._combineRenderElements.length;$c<$R;$c++){var $T=this._combineRenderElements[$c],$N=$T.getDynamicBatchBakedVertexs(0),$t=$T.getBakedIndices(),$b=$T._sprite3D.transform._isFrontFaceInvert,$S=$s/(this._vertexDeclaration.vertexStride/4),$_=$p,$G=$_+$t.length;$T._tempBatchIndexStart=$_,$T._tempBatchIndexEnd=$G,this._indexDatas.set($t,$p);var $q=0;if($b)for($q=$_;$q<$G;$q+=3){this._indexDatas[$q]=$S+this._indexDatas[$q];var $u=this._indexDatas[$q+1],$h=this._indexDatas[$q+2];this._indexDatas[$q+1]=$S+$h,this._indexDatas[$q+2]=$S+$u}else for($q=$_;$q<$G;$q+=3)this._indexDatas[$q]=$S+this._indexDatas[$q],this._indexDatas[$q+1]=$S+this._indexDatas[$q+1],this._indexDatas[$q+2]=$S+this._indexDatas[$q+2];$p+=$t.length,this._vertexDatas.set($N,$s),$s+=$N.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$c=this._combineRenderElementPoolIndex=0,$R=this._materials.length;$c<$R;$c++){var $l=this._getCombineRenderElementFromPool($V,$U,$r);$l._type=2,$l._staticBatch=null;var $W=($l.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$c]]._tempBatchIndexStart,$O=$c+1===this._materialToRenderElementsOffsets.length?$p:this._combineRenderElements[this._materialToRenderElementsOffsets[$c+1]]._tempBatchIndexStart;$l._tempBatchIndexStart=$W,$l._tempBatchIndexEnd=$O,$l._material=this._materials[$c],this._merageElements.push($l)}},$V._addCombineRenderObjTest=function($V){var $U=$V.renderObj,$r=this._currentCombineIndexCount+$U._getIndexBuffer().indexCount,$s=this._currentCombineVertexCount+$U._getVertexBuffer().vertexCount;return!($L.maxVertexCount<$s||$L.maxIndexCount<$r)},$V._addCombineRenderObj=function($V){var $U=$V.renderObj;this._combineRenderElements.push($V),this._currentCombineIndexCount=this._currentCombineIndexCount+$U._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$U._getVertexBuffer().vertexCount},$V._addCombineMaterial=function($V){this._materials.push($V)},$V._addMaterialToRenderElementOffset=function($V){this._materialToRenderElementsOffsets.push($V)},$V._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$V._addToRenderQueue=function($V,$U,$r,$s){this._getRenderElement($U,$r,$s);for(var $p=0,$c=this._materials.length;$p<$c;$p++)$V.getRenderQueue(this._materials[$p].renderQueue)._addDynamicBatchElement(this._merageElements[$p])},$V._beforeRender=function($V){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$V._render=function($V){var $U=$V._batchIndexEnd-$V._batchIndexStart;$w.mainContext.drawElements(4,$U,5123,2*$V._batchIndexStart),$D.drawCall++,$D.trianglesFaces+=$U/3},$V._getVertexBuffers=function(){return null},$q(0,$V,"_vertexBufferCount",function(){return 1}),$q(0,$V,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$q(0,$V,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$L.maxVertexCount=2e4,$L.maxIndexCount=4e4,$L.maxCombineTriangleCount=10,$L}(),$UV=function(){function $L(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$G($L,"laya.d3.graphics.DynamicBatchManager");var $V=$L.prototype;return $V.getDynamicBatch=function($V,$U){var $r,$s=$V.id.toString()+$U;return this._dynamicBatches[$s]?$r=this._dynamicBatches[$s]:this._dynamicBatches[$s]=$r=new $VV($V),$r},$V._garbageCollection=function(){for(var $V in this._dynamicBatches)0===this._dynamicBatches[$V].combineRenderElementsCount&&delete this._dynamicBatches[$V]},$V._addPrepareRenderElement=function($V){this._prepareDynamicBatchCombineElements.push($V)},$V._finishCombineDynamicBatch=function($V){var $U,$r,$s;this._prepareDynamicBatchCombineElements.sort($L._sortPrepareDynamicBatch);for(var $p,$c,$R,$T,$N,$t=-1,$b=!0,$S=0,$_=-1,$G=0,$q=this._prepareDynamicBatchCombineElements.length;$G<$q;$G++){var $u=($c=this._prepareDynamicBatchCombineElements[$G]).renderObj._getVertexBuffer(0).vertexDeclaration,$h=$r!==$u;$h&&($S=0,$r=$u);var $l=$S!==$t;if($l&&($t=$S),($h||$l)&&($R=this.getDynamicBatch($u,$S),$U=null),$b)if($R._addCombineRenderObjTest($c)){if($U!==($p=$c._material))$T&&($V.getRenderQueue($N._material.renderQueue)._addRenderElement($N),$N=$T=null,$_=-1),$T=$p,$_=$R.combineRenderElementsCount,$N=$c,$U=$p;else if($T){var $W=$N.renderObj,$O=$c.renderObj;$W._getVertexBuffer().vertexCount+$O._getVertexBuffer().vertexCount>$VV.maxVertexCount||$W._getIndexBuffer().indexCount+$O._getIndexBuffer().indexCount>$VV.maxIndexCount?($V.getRenderQueue($N._material.renderQueue)._addRenderElement($N),$T=$p,$_=$R.combineRenderElementsCount,$N=$c):($R._addCombineMaterial($T),$R._addMaterialToRenderElementOffset($_),$R._addCombineRenderObj($N),$N=$T=null,$_=-1,$R._addCombineRenderObj($c))}else $R._addCombineRenderObj($c);$b=!0}else $T&&($V.getRenderQueue($N._material.renderQueue)._addRenderElement($N),$N=$T=null,$_=-1),$S++,$b=!1;else $s=this._prepareDynamicBatchCombineElements[$G-1],$R._addMaterialToRenderElementOffset($R.combineRenderElementsCount),$U=$s._material,$R._addCombineMaterial($U),$R._addCombineRenderObj($s),$b=!0,$U!==($p=$c._material)?($T=$p,$_=$R.combineRenderElementsCount,$N=$c):$R._addCombineRenderObj($c),$U=$p}$T&&($V.getRenderQueue($N._material.renderQueue)._addRenderElement($N),$N=$T=null,$_=-1),this._prepareDynamicBatchCombineElements.length=0},$V._clearRenderElements=function(){for(var $V in this._dynamicBatches)this._dynamicBatches[$V]._clearRenderElements()},$V._addToRenderQueue=function($V,$U,$r,$s){for(var $p in this._dynamicBatches){var $c=this._dynamicBatches[$p];0<$c.combineRenderElementsCount&&$c._addToRenderQueue($V,$U,$r,$s)}},$V.dispose=function(){this._dynamicBatches=null},$L._sortPrepareDynamicBatch=function($V,$U){return $V._mainSortID-$U._mainSortID},$L}(),$rV=function(){function $V(){}return $G($V,"laya.d3.graphics.FrustumCulling"),$V.renderShadowObjectCulling=function($V,$U,$r,$s,$p){var $c=0,$R=0,$T=0,$N=0;for($c=0,$T=$r.length;$c<$T;$c++){var $t=$r[$c];$t&&$t._clearRenderElements()}var $b,$S,$_,$G=$V._cullingRenders;if(1<$p){for($c=0,$T=$V._cullingRendersLength;$c<$T;$c++)if(($b=$G[$c]).castShadow&&$K.isVisible($b._owner.layer.mask)&&$b.enable)for(var $q=1,$u=$U.length;$q<$u;$q++)if($S=$r[$q-1],0!==$U[$q].containsBoundSphere($b.boundingSphere))for($R=0,$N=($_=$b._renderElements).length;$R<$N;$R++)$S._addRenderElement($_[$R])}else for($c=0,$T=$V._cullingRendersLength;$c<$T;$c++)if(($b=$G[$c]).castShadow&&$K.isVisible($b._owner.layer.mask)&&$b.enable&&0!==$U[0].containsBoundSphere($b.boundingSphere))for($b._renderUpdate($s),$S=$r[0],$R=0,$N=($_=$b._renderElements).length;$R<$N;$R++)$S._addRenderElement($_[$R])},$V.renderShadowObjectCullingOctree=function($V,$U,$r,$s,$p){for(var $c=0,$R=$r.length;$c<$R;$c++){var $T=$r[$c];$T&&$T._clearRenderElements()}1<$p?$V.treeRoot.cullingShadowObjects($U,$r,!0,0,$V):$V.treeRoot.cullingShadowObjectsOnePSSM($U[0],$r,$s,!0,0,$V)},$V.renderObjectCulling=function($V,$U,$r,$s,$p,$c){var $R=0,$T=0,$N=0,$t=0,$b=$U._quenes,$S=$U._dynamicBatchManager,$_=$U._cullingRenders;for($R=0,$T=$b.length;$R<$T;$R++){var $G=$b[$R];$G&&$G._clearRenderElements()}var $q=$sV._staticBatchManagers;for($R=0,$T=$q.length;$R<$T;$R++)$q[$R]._clearRenderElements();$S._clearRenderElements();var $u=$r.transform.position;for($R=0,$T=$U._cullingRendersLength;$R<$T;$R++){var $h=$_[$R];if($K.isVisible($h._owner.layer.mask)&&$h.enable&&0!==$V.containsBoundSphere($h.boundingSphere)&&$h._renderUpdate($c)){$h._distanceForSort=$RU.distance($h.boundingSphere.center,$u)+$h.sortingFudge;var $l=$h._renderElements;for($N=0,$t=$l.length;$N<$t;$N++){var $W=$l[$N],$O=$W._staticBatch;if($O&&$O._material===$W._material)$O._addBatchRenderElement($W);else{var $L=$W.renderObj;$L.triangleCount<10&&1===$L._vertexBufferCount&&$L._getIndexBuffer()&&$W._material.renderQueue<2&&$W._canDynamicBatch&&!$h._owner.isStatic?$S._addPrepareRenderElement($W):$U.getRenderQueue($W._material.renderQueue)._addRenderElement($W)}}}}for($R=0,$T=$q.length;$R<$T;$R++)$q[$R]._addToRenderQueue($U,$s,$p,$c);$S._finishCombineDynamicBatch($U),$S._addToRenderQueue($U,$s,$p,$c)},$V.renderObjectCullingOctree=function($V,$U,$r,$s,$p,$c){var $R=0,$T=0,$N=$U._quenes,$t=$U._dynamicBatchManager;for($R=0,$T=$N.length;$R<$T;$R++){var $b=$N[$R];$b&&$b._clearRenderElements()}var $S=$sV._staticBatchManagers;for($R=0,$T=$S.length;$R<$T;$R++)$S[$R]._clearRenderElements();for($t._clearRenderElements(),$U._cullingRenders.length=0,$U.treeRoot.cullingObjects($V,!0,0,$r.transform.position,$c),$R=0,$T=$S.length;$R<$T;$R++)$S[$R]._addToRenderQueue($U,$s,$p,$c);$t._finishCombineDynamicBatch($U),$t._addToRenderQueue($U,$s,$p,$c)},$V.renderObjectCullingNoBoundFrustum=function($V,$U,$r,$s,$p){var $c=0,$R=0,$T=0,$N=0,$t=$V._quenes,$b=$V._dynamicBatchManager,$S=$V._cullingRenders;for($c=0,$R=$t.length;$c<$R;$c++){var $_=$t[$c];$_&&$_._clearRenderElements()}var $G=$sV._staticBatchManagers;for($c=0,$R=$G.length;$c<$R;$c++)$G[$c]._clearRenderElements();$b._clearRenderElements();var $q=$U.transform.position;for($c=0,$R=$V._cullingRendersLength;$c<$R;$c++){var $u=$S[$c];if($K.isVisible($u._owner.layer.mask)&&$u.enable){$u._renderUpdate($p),$u._distanceForSort=$RU.distance($u.boundingSphere.center,$q)+$u.sortingFudge;var $h=$u._renderElements;for($T=0,$N=$h.length;$T<$N;$T++){var $l=$h[$T],$W=$l._staticBatch;if($W&&$W._material===$l._material)$W._addBatchRenderElement($l);else{var $O=$l.renderObj;$O.triangleCount<10&&1===$O._vertexBufferCount&&$O._getIndexBuffer()&&$l._material.renderQueue<2&&$l._canDynamicBatch&&!$u._owner.isStatic?$b._addPrepareRenderElement($l):$V.getRenderQueue($l._material.renderQueue)._addRenderElement($l)}}}}for($c=0,$R=$G.length;$c<$R;$c++)$G[$c]._addToRenderQueue($V,$r,$s,$p);$b._finishCombineDynamicBatch($V),$b._addToRenderQueue($V,$r,$s,$p)},$V}(),$sV=function(){function $c(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$G($c,"laya.d3.graphics.StaticBatchManager");var $V=$c.prototype;return $V._finishInit=function(){for(var $V in this._staticBatches)this._staticBatches[$V]._finishInit();this._initBatchRenderElements.length=0},$V._initStaticBatchs=function($V){throw new Error("StaticBatchManager:must override this function.")},$V._addInitBatchSprite=function($V){for(var $U=$V._render._renderElements,$r=0,$s=$U.length;$r<$s;$r++)this._initBatchRenderElements.push($U[$r])},$V._clearRenderElements=function(){for(var $V in this._staticBatches)this._staticBatches[$V]._clearRenderElements()},$V._garbageCollection=function($V){var $U=$V._staticBatch,$r=$U._initBatchRenderElements,$s=$r.indexOf($V);$r.splice($s,1),0===$r.length&&($U.dispose(),delete this._staticBatches[$U._key])},$V._addToRenderQueue=function($V,$U,$r,$s){for(var $p in this._staticBatches){var $c=this._staticBatches[$p];0<$c._batchRenderElements.length&&$c._updateToRenderQueue($V,$s)}},$V.dispose=function(){this._staticBatches=null},$c._addToStaticBatchQueue=function($V){$V instanceof laya.d3.core.RenderableSprite3D&&$V._addToInitStaticBatchManager();for(var $U=0,$r=$V.numChildren;$U<$r;$U++)$c._addToStaticBatchQueue($V._childs[$U])},$c.combine=function($V,$U){var $r,$s=0,$p=0;if($U)for($s=0,$p=$U.length;$s<$p;$s++){$U[$s]._addToInitStaticBatchManager()}else $V&&$c._addToStaticBatchQueue($V);for($s=0,$p=$c._staticBatchManagers.length;$s<$p;$s++)($r=$c._staticBatchManagers[$s])._initStaticBatchs($V),$r._finishInit()},$c._staticBatchManagers=[],$c}(),$pV=function(){function $V($V,$U,$r){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$V,this._manager=$U,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$r}$G($V,"laya.d3.graphics.StaticBatch");var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$U._binarySearch=function($V){for(var $U=0,$r=this._batchRenderElements.length-1,$s=0;$U<=$r;)$s=Math.floor(($U+$r)/2),this._compareBatchRenderElement(this._batchRenderElements[$s],$V)?$r=$s-1:$U=$s+1;return $U},$U._compareBatchRenderElement=function($V,$U){throw new Error("StaticBatch:must override this function.")},$U._getVertexDecLightMap=function($V){return $V===$$V.vertexDeclaration?$KV.vertexDeclaration:$V===$xV.vertexDeclaration?$EV.vertexDeclaration:$V===$nV.vertexDeclaration?$LV.vertexDeclaration:$V===$iV.vertexDeclaration?null:$V===$uV.vertexDeclaration?$hV.vertexDeclaration:$V===$oV.vertexDeclaration?$aV.vertexDeclaration:$V===$wV.vertexDeclaration?$zV.vertexDeclaration:$V===$jV.vertexDeclaration?$mV.vertexDeclaration:$V===$xV.vertexDeclaration?$EV.vertexDeclaration:$V===$IV.vertexDeclaration?$dV.vertexDeclaration:$V===$iV.vertexDeclaration?null:$V===$uV.vertexDeclaration?$hV.vertexDeclaration:$V===$JV.vertexDeclaration?$ZV.vertexDeclaration:$V===$wV.vertexDeclaration?$zV.vertexDeclaration:$V},$U._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$U._addBatchRenderElement=function($V){this._batchRenderElements.splice(this._binarySearch($V),0,$V)},$U._updateToRenderQueue=function($V,$U){this._combineRenderElementPoolIndex=0,this._getRenderElement($V.getRenderQueue(this._material.renderQueue)._renderElements,$V,$U)},$U._getRenderElement=function($V,$U,$r){throw new Error("StaticBatch:must override this function.")},$U._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$U._clearRenderElements=function(){this._batchRenderElements.length=0},$U.dispose=function(){},$U._getVertexBuffer=function($V){return void 0===$V&&($V=0),null},$U._getIndexBuffer=function(){return null},$U._beforeRender=function($V){return!0},$U._render=function($V){},$U._getVertexBuffers=function(){return null},$q(0,$U,"_vertexBufferCount",function(){return 1}),$q(0,$U,"triangleCount",function(){return 0}),$V.combine=function($V){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$sV.combine($V)},$V.maxBatchVertexCount=65535,$V}(),$cV=function(){function $R($V,$U){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$R._uniqueIDCounter,this._id>$R.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$R.maxVertexDeclaration);this._shaderValues=new $_U,this._vertexElementsDic={},this._vertexStride=$V,this._vertexElements=$U;for(var $r=0;$r<$U.length;$r++){var $s=$U[$r],$p=$s.elementUsage;this._vertexElementsDic[$p]=$s;var $c=[$R._getTypeSize($s.elementFormat)/4,5126,!1,this._vertexStride,$s.offset];switch(this._shaderValues.setValue($p,$c),$p){case 1:this._addShaderDefine($DU.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($DU.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($DU.SHADERDEFINE_UV1)}}}$G($R,"laya.d3.graphics.VertexDeclaration");var $V=$R.prototype;return $V._addShaderDefine=function($V){this._shaderDefineValue|=$V},$V._removeShaderDefine=function($V){this._shaderDefineValue&=~$V},$V.getVertexElements=function(){return this._vertexElements.slice()},$V.getVertexElementByUsage=function($V){return this._vertexElementsDic[$V]},$V.unBinding=function(){},$q(0,$V,"shaderDefineValue",function(){return this._shaderDefineValue}),$q(0,$V,"id",function(){return this._id}),$q(0,$V,"vertexStride",function(){return this._vertexStride}),$q(0,$V,"shaderValues",function(){return this._shaderValues}),$R._getTypeSize=function($V){switch($V){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$R.getVertexStride=function($V){for(var $U=0,$r=0;$r<$V.Length;$r++){var $s=$V[$r],$p=$s.offset+$R._getTypeSize($s.elementFormat);$U<$p&&($U=$p)}return $U},$R._maxVertexDeclarationBit=1e3,$R._uniqueIDCounter=1,$S($R,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$R}(),$RV=function(){function $V($V,$U,$r){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$V,this.elementFormat=$U,this.elementUsage=$r}return $G($V,"laya.d3.graphics.VertexElement"),$V}(),$TV=(function(){function $V(){}$G($V,"laya.d3.graphics.VertexElementFormat"),$V.Single="single",$V.Vector2="vector2",$V.Vector3="vector3",$V.Vector4="vector4",$V.Color="color",$V.Byte4="byte4",$V.Short2="short2",$V.Short4="short4",$V.NormalizedShort2="normalizedshort2",$V.NormalizedShort4="normalizedshort4",$V.HalfVector2="halfvector2",$V.HalfVector4="halfvector4"}(),function(){function $V(){}$G($V,"laya.d3.graphics.VertexElementUsage"),$V.POSITION0=0,$V.COLOR0=1,$V.TEXTURECOORDINATE0=2,$V.NORMAL0=3,$V.BINORMAL0=4,$V.TANGENT0=5,$V.BLENDINDICES0=6,$V.BLENDWEIGHT0=7,$V.DEPTH0=8,$V.FOG0=9,$V.POINTSIZE0=10,$V.SAMPLE0=11,$V.TESSELLATEFACTOR0=12,$V.COLOR1=13,$V.NEXTTEXTURECOORDINATE0=14,$V.TEXTURECOORDINATE1=15,$V.NEXTTEXTURECOORDINATE1=16,$V.CORNERTEXTURECOORDINATE0=17,$V.VELOCITY0=18,$V.STARTCOLOR0=19,$V.STARTSIZE=20,$V.AGEADDSCALE0=21,$V.STARTROTATION=22,$V.ENDCOLOR0=23,$V.STARTLIFETIME=24,$V.TIME0=33,$V.SHAPEPOSITIONSTARTLIFETIME=30,$V.DIRECTIONTIME=32,$V.SIZEROTATION0=27,$V.RADIUS0=28,$V.RADIAN0=29,$V.STARTSPEED=31,$V.RANDOM0=34,$V.RANDOM1=35,$V.SIMULATIONWORLDPOSTION=36,$V.SIMULATIONWORLDROTATION=37,$V.TEXTURECOORDINATE0X=38,$V.TEXTURECOORDINATE0X1=39,$V.TEXTURECOORDINATE0Y=40,$V.OFFSETVECTOR=41}(),function(){function $V($V,$U,$r){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$V,this._textureCoordinate0=$U,this._time=$r}$G($V,"laya.d3.graphics.VertexGlitter");var $U=$V.prototype;$d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate0}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"time",function(){return this._time}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(24,[new $RV(0,"vector3",0),new $RV(12,"vector2",2),new $RV(20,"single",33)])}])}(),function(){function $V($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$V,this._position=$U,this._velocity=$r,this._startColor=$s,this._endColor=$p,this._sizeRotation=$c,this._radius=$R,this._radian=$T,this._ageAddScale=$N,this._time=$t}$G($V,"laya.d3.graphics.VertexParticle");var $U=$V.prototype;$d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"endColor",function(){return this._endColor}),$q(0,$U,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$q(0,$U,"sizeRotation",function(){return this._sizeRotation}),$q(0,$U,"velocity",function(){return this._velocity}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"startColor",function(){return this._startColor}),$q(0,$U,"radius",function(){return this._radius}),$q(0,$U,"radian",function(){return this._radian}),$q(0,$U,"ageAddScale",function(){return this._ageAddScale}),$q(0,$U,"time",function(){return this._time}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(116,[new $RV(0,"vector4",17),new $RV(16,"vector3",0),new $RV(28,"vector3",18),new $RV(40,"vector4",19),new $RV(56,"vector4",23),new $RV(72,"vector3",27),new $RV(84,"vector2",28),new $RV(92,"vector4",29),new $RV(108,"single",24),new $RV(112,"single",33)])}])}(),function(){function $V($V){this._position=null,this._position=$V}$G($V,"laya.d3.graphics.VertexPosition");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(12,[new $RV(0,"vector3",0)])}]),$V}()),$NV=function(){function $V($V,$U){this._position=null,this._normal=null,this._position=$V,this._normal=$U}$G($V,"laya.d3.graphics.VertexPositionNormal");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(24,[new $RV(0,"vector3",0),new $RV(12,"vector3",3)])}]),$V}(),$tV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._color=null,this._position=$V,this._normal=$U,this._color=$r}$G($V,"laya.d3.graphics.VertexPositionNormalColor");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(40,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1)])}]),$V}(),$bV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$V,this._normal=$U,this._color=$r,this._blendIndex=$s,this._blendWeight=$p}$G($V,"laya.d3.graphics.VertexPositionNormalColorSkin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(72,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector4",7),new $RV(56,"vector4",6)])}]),$V}(),$SV=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._tangent=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(88,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector4",7),new $RV(56,"vector4",6),new $RV(72,"vector4",5)])}]),$V}(),$_V=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._tangent=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(84,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector4",7),new $RV(56,"vector4",6),new $RV(72,"vector3",5)])}]),$V}(),$GV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._tangent=$s}$G($V,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(56,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector4",5)])}]),$V}(),$qV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._tangent=$s}$G($V,"laya.d3.graphics.VertexPositionNormalColorTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(52,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector3",5)])}]),$V}(),$uV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(48,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2)])}]),$V}(),$hV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(56,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15)])}]),$V}(),$lV=function(){function $V($V,$U,$r,$s,$p,$c,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._blendIndex=$c,this._blendWeight=$R}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(88,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15),new $RV(56,"vector4",7),new $RV(72,"vector4",6)])}]),$V}(),$WV=function(){function $V($V,$U,$r,$s,$p,$c,$R,$T){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._tangent=$c,this._blendIndex=$R,this._blendWeight=$T}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(104,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15),new $RV(56,"vector4",7),new $RV(72,"vector4",6),new $RV(88,"vector4",5)])}]),$V}(),$OV=function(){function $V(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$U.VertexPositionNormalColorTexture0SkinTangent=function($V,$U,$r,$s,$p,$c,$R,$T){this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._tangent=$c,this._blendIndex=$R,this._blendWeight=$T},$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(100,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15),new $RV(56,"vector4",7),new $RV(72,"vector4",6),new $RV(88,"vector3",5)])}]),$V}(),$LV=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._tangent=$c}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(72,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15),new $RV(56,"vector4",5)])}]),$V}(),$dV=function(){function $V(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$G($V,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$U.VertexPositionNormalColorTexture0Tangent=function($V,$U,$r,$s,$p,$c){this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._tangent=$c},$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(68,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector2",15),new $RV(56,"vector3",5)])}]),$V}(),$kV=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(80,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector4",7),new $RV(64,"vector4",6)])}]),$V}(),$yV=function(){function $V($V,$U,$r,$s,$p,$c,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s,this._tangent=$p,this._blendIndex=$c,this._blendWeight=$R}$G($V,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(96,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector4",7),new $RV(64,"vector4",6),new $RV(80,"vector4",5)])}]),$V}(),$DV=function(){function $V($V,$U,$r,$s,$p,$c,$R){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s,this._tangent=$p,this._blendIndex=$c,this._blendWeight=$R}$G($V,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(92,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector4",7),new $RV(64,"vector4",6),new $RV(80,"vector3",5)])}]),$V}(),$nV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s,this._tangent=$p}$G($V,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(64,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector4",5)])}]),$V}(),$IV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$V,this._normal=$U,this._color=$r,this._textureCoordinate=$s,this._tangent=$p}$G($V,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"color",function(){return this._color}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(60,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",1),new $RV(40,"vector2",2),new $RV(48,"vector3",5)])}]),$V}(),$QV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._tangent=null,this._position=$V,this._normal=$U,this._tangent=$r}$G($V,"laya.d3.graphics.VertexPositionNormalSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(40,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector4",5)])}]),$V}(),$HV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._tangent=null,this._position=$V,this._normal=$U,this._tangent=$r}$G($V,"laya.d3.graphics.VertexPositionNormalTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(36,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector3",5)])}]),$V}(),$wV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r}$G($V,"laya.d3.graphics.VertexPositionNormalTexture");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(32,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2)])}]),$V}(),$zV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(40,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15)])}]),$V}(),$EV=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(72,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15),new $RV(40,"vector4",7),new $RV(56,"vector4",6)])}]),$V}(),$KV=function(){function $V($V,$U,$r,$s,$p,$c,$R){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s,this._tangent=$p,this._blendIndex=$c,this._blendWeight=$R}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(88,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15),new $RV(40,"vector4",7),new $RV(56,"vector4",6),new $RV(72,"vector4",5)])}]),$V}(),$mV=function(){function $V(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$U.VertexPositionNormalTexture0SkinTangent=function($V,$U,$r,$s,$p,$c,$R){this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s,this._tangent=$p,this._blendIndex=$c,this._blendWeight=$R},$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(84,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15),new $RV(40,"vector4",7),new $RV(56,"vector4",6),new $RV(72,"vector3",5)])}]),$V}(),$aV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s,this._tangent=$p}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(56,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15),new $RV(40,"vector4",5)])}]),$V}(),$ZV=function(){function $V(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$G($V,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$U.VertexPositionNormalTexture0Tangent=function($V,$U,$r,$s,$p){this._position=$V,this._normal=$U,this._textureCoordinate0=$r,this._textureCoordinate1=$s,this._tangent=$p},$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(52,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15),new $RV(40,"vector3",5)])}]),$V}(),$xV=function(){function $V($V,$U,$r,$s,$p){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r,this._blendIndex=$s,this._blendWeight=$p}$G($V,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(64,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector4",7),new $RV(48,"vector4",6)])}]),$V}(),$$V=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r,this._tangent=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(80,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector4",7),new $RV(48,"vector4",6),new $RV(64,"vector4",5)])}]),$V}(),$jV=function(){function $V($V,$U,$r,$s,$p,$c){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r,this._tangent=$s,this._blendIndex=$p,this._blendWeight=$c}$G($V,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(76,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector4",7),new $RV(48,"vector4",6),new $RV(64,"vector3",5)])}]),$V}(),$oV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r,this._tangent=$s}$G($V,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(48,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector4",5)])}]),$V}(),$JV=function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r,this._tangent=$s}$G($V,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(44,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector3",5)])}]),$V}(),$iV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r}$G($V,"laya.d3.graphics.VertexPositionNTBTexture");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(56,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector3",5),new $RV(36,"vector3",4),new $RV(48,"vector2",2)])}]),$V}(),$BV=function(){function $V($V,$U,$r,$s,$p,$c,$R,$T){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$V,this._normal=$U,this._textureCoordinate0=$s,this._textureCoordinate1=$p,this._tangent=$c,$r=$r,this._blendIndex=$R,this._blendWeight=$T}$G($V,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"tangent",function(){return this._tangent}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(0,$U,"textureCoordinate1",function(){return this._textureCoordinate1}),$q(0,$U,"blendIndex",function(){return this._blendIndex}),$q(0,$U,"blendWeight",function(){return this._blendWeight}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(96,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector3",5),new $RV(36,"vector3",4),new $RV(48,"vector2",2),new $RV(56,"vector2",15),new $RV(64,"vector4",7),new $RV(80,"vector4",6)])}]),$V}(),$PV=function(){function $V($V,$U,$r){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$V,this._normal=$U,this._textureCoordinate=$r}$G($V,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"textureCoordinate",function(){return this._textureCoordinate}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(88,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector3",5),new $RV(36,"vector3",4),new $RV(48,"vector2",2),new $RV(56,"vector4",7),new $RV(72,"vector4",6)])}]),$V}(),$MV=(function(){function $V($V,$U,$r,$s){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$V,this._normal=$U,this._textureCoord0=$r,this._textureCoord1=$s}$G($V,"laya.d3.graphics.VertexPositionTerrain");var $U=$V.prototype;$d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"normal",function(){return this._normal}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoord0",function(){return this._textureCoord0}),$q(0,$U,"textureCoord1",function(){return this._textureCoord1}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(40,[new $RV(0,"vector3",0),new $RV(12,"vector3",3),new $RV(24,"vector2",2),new $RV(32,"vector2",15)])}])}(),function(){function $V($V,$U){this._position=null,this._textureCoordinate0=null,this._position=$V,this._textureCoordinate0=$U}$G($V,"laya.d3.graphics.VertexPositionTexture0");var $U=$V.prototype;return $d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"position",function(){return this._position}),$q(0,$U,"textureCoordinate0",function(){return this._textureCoordinate0}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(20,[new $RV(0,"vector3",0),new $RV(12,"vector2",2)])}]),$V}()),$AV=(function(){function $V($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S,$_,$G){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$V,this._positionStartLifeTime=$U,this._velocity=$r,this._startColor=$s,this._startSize=$p,this._startRotation0=$c,this._startRotation1=$R,this._startRotation2=$T,this._startLifeTime=$N,this._time=$t,this._startSpeed=$b,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$G}$G($V,"laya.d3.graphics.VertexShurikenParticleBillboard");var $U=$V.prototype;$d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$q(0,$U,"random1",function(){return this._randoms1}),$q(0,$U,"startRotation2",function(){return this._startRotation2}),$q(0,$U,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$q(0,$U,"velocity",function(){return this._velocity}),$q(0,$U,"random0",function(){return this._randoms0}),$q(0,$U,"startSize",function(){return this._startSize}),$q(0,$U,"startColor",function(){return this._startColor}),$q(0,$U,"startRotation0",function(){return this._startRotation0}),$q(0,$U,"startRotation1",function(){return this._startRotation1}),$q(0,$U,"startLifeTime",function(){return this._startLifeTime}),$q(0,$U,"time",function(){return this._time}),$q(0,$U,"startSpeed",function(){return this._startSpeed}),$q(0,$U,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(152,[new $RV(0,"vector4",17),new $RV(16,"vector4",30),new $RV(32,"vector4",32),new $RV(48,"vector4",19),new $RV(64,"vector3",20),new $RV(76,"vector3",22),new $RV(88,"single",31),new $RV(92,"vector4",34),new $RV(108,"vector4",35),new $RV(124,"vector3",36),new $RV(136,"vector4",37)])}])}(),function(){function $V($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S,$_,$G){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$V,this._positionStartLifeTime=$U,this._velocity=$r,this._startColor=$s,this._startSize=$p,this._startRotation0=$c,this._startRotation1=$R,this._startRotation2=$T,this._startLifeTime=$N,this._time=$t,this._startSpeed=$b,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$G}$G($V,"laya.d3.graphics.VertexShurikenParticleMesh");var $U=$V.prototype;$d.imps($U,{"laya.d3.graphics.IVertex":!0}),$q(0,$U,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$q(0,$U,"velocity",function(){return this._velocity}),$q(0,$U,"position",function(){return this._positionStartLifeTime}),$q(0,$U,"random0",function(){return this._randoms0}),$q(0,$U,"startSize",function(){return this._startSize}),$q(0,$U,"startColor",function(){return this._startColor}),$q(0,$U,"startRotation0",function(){return this._startRotation0}),$q(0,$U,"startRotation1",function(){return this._startRotation1}),$q(0,$U,"random1",function(){return this._randoms1}),$q(0,$U,"startRotation2",function(){return this._startRotation2}),$q(0,$U,"startLifeTime",function(){return this._startLifeTime}),$q(0,$U,"time",function(){return this._time}),$q(0,$U,"startSpeed",function(){return this._startSpeed}),$q(0,$U,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$q(0,$U,"vertexDeclaration",function(){return $V._vertexDeclaration}),$q(1,$V,"vertexDeclaration",function(){return $V._vertexDeclaration}),$S($V,["_vertexDeclaration",function(){return this._vertexDeclaration=new $cV(172,[new $RV(0,"vector3",0),new $RV(12,"vector4",1),new $RV(28,"vector2",2),new $RV(36,"vector4",30),new $RV(52,"vector4",32),new $RV(68,"vector4",19),new $RV(84,"vector3",20),new $RV(96,"vector3",22),new $RV(108,"single",31),new $RV(112,"vector4",34),new $RV(128,"vector4",35),new $RV(144,"vector3",36),new $RV(156,"vector4",37)])}])}(),function(){function $O($V,$U,$r,$s,$p,$c){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$r,this._materials=$s,this._subMeshes=$p,this._materialMap=$c,this._version=$U,this._onLoaded($V)}$G($O,"laya.d3.loaders.LoadModelV01");var $V=$O.prototype;return $V._onLoaded=function($V){this._readData=$V,this.READ_BLOCK();for(var $U=0;$U<this._BLOCK.count;$U++){var $r=this._readData.getUint16(),$s=this._strings[$r],$p=this["READ_"+$s];if(null==$p)throw new Error("model file err,no this function:"+$r+" "+$s);if(!$p.call(this))break}return this._mesh},$V.onError=function(){},$V._readString=function(){return this._strings[this._readData.getUint16()]},$V.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$V.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$V.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $V=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $U=0;$U<this._STRINGS.size;$U++)this._strings[$U]=this._readData.readUTFString();return this._readData.pos=$V,!0},$V.READ_MATERIAL=function(){var $V=this._readData.getUint16(),$U=(this._readString(),this._readString());return this._materials[$V]="null"!==$U?$l.getRes(this._materialMap[$U]):new $HU,!0},$V.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $V,$U=this._readData.__getBuffer(),$r=0,$s=this._readData.getUint32(),$p=this._readData.getUint32(),$c=(new Float32Array($U.slice($s+this._DATA.offset,$s+this._DATA.offset+$p)),this._readData.getUint32()),$R=this._readData.getUint32(),$T=new Float32Array($U.slice($c+this._DATA.offset,$c+this._DATA.offset+$R));for(this.mesh._inverseBindPoses=[],$r=0,$V=$T.length;$r<$V;$r+=16){var $N=new $VU($T[$r+0],$T[$r+1],$T[$r+2],$T[$r+3],$T[$r+4],$T[$r+5],$T[$r+6],$T[$r+7],$T[$r+8],$T[$r+9],$T[$r+10],$T[$r+11],$T[$r+12],$T[$r+13],$T[$r+14],$T[$r+15]);this.mesh._inverseBindPoses.push($N)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$V.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $V=this._readString();this._shaderAttributes=$V.match($O._attrReg);var $U=this._readData.getUint32(),$r=this._readData.getUint32(),$s=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$p=this._readData.getUint32(),$c=this._readData.getUint32(),$R=this._readData.getUint32(),$T=this._readData.__getBuffer(),$N=new $tU(this._mesh),$t=this._getVertexDeclaration(),$b=$jU.create($t,$p/$t.vertexStride,35044,!0),$S=$s+this._DATA.offset,$_=$T.slice($S,$S+$p);$b.setData(new Float32Array($_));for(var $G=($N._vertexBuffer=$b).vertexDeclaration.getVertexElements(),$q=0;$q<$G.length;$q++)$N._bufferUsage[$G[$q].elementUsage]=$b;var $u=$$U.create("ushort",$r/2,35044,!0),$h=$U+this._DATA.offset,$l=$T.slice($h,$h+$r);$u.setData(new Uint16Array($l)),$N._indexBuffer=$u;var $W=$T.slice($c+this._DATA.offset,$c+this._DATA.offset+$R);return $N._boneIndicesList[0]=new Uint8Array($W),this._subMeshes.push($N),!0},$V.READ_DATAAREA=function(){return!1},$V._getVertexDeclaration=function(){for(var $V,$U=!1,$r=!1,$s=!1,$p=!1,$c=!1,$R=!1,$T=!1,$N=!1,$t=!1,$b=0;$b<this._shaderAttributes.length;$b+=8)switch(this._shaderAttributes[$b]){case"POSITION":$U=!0;break;case"NORMAL":$r=!0;break;case"COLOR":$s=!0;break;case"UV":$p=!0;break;case"UV1":$c=!0;break;case"BLENDWEIGHT":$T=!0;break;case"BLENDINDICES":$N=!0;break;case"TANGENT":$R=!0;break;case"BINORMAL":$t=!0}return $U&&$r&&$s&&$p&&$c&&$T&&$N&&$R?$V=$OV.vertexDeclaration:$U&&$r&&$s&&$p&&$c&&$T&&$N?$V=$lV.vertexDeclaration:$U&&$r&&$p&&$c&&$T&&$N&&$R?$V=$mV.vertexDeclaration:$U&&$r&&$p&&$c&&$T&&$N?$V=$EV.vertexDeclaration:$U&&$r&&$s&&$p&&$T&&$N&&$R?$V=$DV.vertexDeclaration:$U&&$r&&$s&&$p&&$T&&$N?$V=$kV.vertexDeclaration:$U&&$r&&$R&&$t&&$p&&$T&&$N?$V=$PV.vertexDeclaration:$U&&$r&&$p&&$T&&$N&&$R?$V=$jV.vertexDeclaration:$U&&$r&&$p&&$T&&$N?$V=$xV.vertexDeclaration:$U&&$r&&$s&&$T&&$N&&$R?$V=$_V.vertexDeclaration:$U&&$r&&$s&&$T&&$N?$V=$bV.vertexDeclaration:$U&&$r&&$s&&$p&&$c&&$R?$V=$dV.vertexDeclaration:$U&&$r&&$s&&$p&&$c?$V=$hV.vertexDeclaration:$U&&$r&&$p&&$c&&$R?$V=$ZV.vertexDeclaration:$U&&$r&&$p&&$c?$V=$zV.vertexDeclaration:$U&&$r&&$s&&$p&&$R?$V=$IV.vertexDeclaration:$U&&$r&&$p&&$R&&$t?$V=$iV.vertexDeclaration:$U&&$r&&$s&&$p?$V=$uV.vertexDeclaration:$U&&$r&&$p&&$R?$V=$JV.vertexDeclaration:$U&&$r&&$p?$V=$wV.vertexDeclaration:$U&&$r&&$s&&$R?$V=$qV.vertexDeclaration:$U&&$r&&$s&&($V=$tV.vertexDeclaration),$V},$q(0,$V,"mesh",function(){return this._mesh}),$O._attrReg=new RegExp("(\\w+)|([:,;])","g"),$O}()),$XV=function(){function $y(){}return $G($y,"laya.d3.loaders.LoadModelV02"),$y.parse=function($V,$U,$r,$s,$p,$c){$y._mesh=$r,$y._materials=$s,$y._subMeshes=$p,$y._materialMap=$c,$y._version=$U,$y._readData=$V,$y.READ_DATA(),$y.READ_BLOCK(),$y.READ_STRINGS();for(var $R=0,$T=$y._BLOCK.count;$R<$T;$R++){$y._readData.pos=$y._BLOCK.blockStarts[$R];var $N=$y._readData.getUint16(),$t=$y._strings[$N],$b=$y["READ_"+$t];if(null==$b)throw new Error("model file err,no this function:"+$N+" "+$t);$b.call()}$y._strings.length=0,$y._readData=null,$y._version=null,$y._mesh=null,$y._materials=null,$y._subMeshes=null,$y._materialMap=null},$y._readString=function(){return $y._strings[$y._readData.getUint16()]},$y.READ_DATA=function(){$y._DATA.offset=$y._readData.getUint32(),$y._DATA.size=$y._readData.getUint32()},$y.READ_BLOCK=function(){for(var $V=$y._BLOCK.count=$y._readData.getUint16(),$U=$y._BLOCK.blockStarts=[],$r=$y._BLOCK.blockLengths=[],$s=0;$s<$V;$s++)$U.push($y._readData.getUint32()),$r.push($y._readData.getUint32())},$y.READ_STRINGS=function(){var $V=$y._readData.getUint32(),$U=$y._readData.getUint16(),$r=$y._readData.pos;$y._readData.pos=$V+$y._DATA.offset;for(var $s=0;$s<$U;$s++)$y._strings[$s]=$y._readData.readUTFString();$y._readData.pos=$r},$y.READ_MATERIAL=function(){$y._readString(),$y._readString();var $V=$y._readString();return""!==$V&&$y._materials.push($l.getRes($y._materialMap[$V])),!0},$y.READ_MESH=function(){$y._readString();var $V,$U=$y._readData.__getBuffer(),$r=0,$s=$y._readData.getInt16(),$p=$y._DATA.offset;for($r=0;$r<$s;$r++){var $c=$p+$y._readData.getUint32(),$R=$y._readData.getUint32(),$T=new Float32Array($U.slice($c,$c+$R)),$N=$y._readString().match($y._attrReg),$t=$y._getVertexDeclaration($N),$b=$jU.create($t,4*$T.length/$t.vertexStride,35044,!0);$b.setData($T),$y._mesh._vertexBuffers.push($b)}var $S=$p+$y._readData.getUint32(),$_=$y._readData.getUint32(),$G=new Uint16Array($U.slice($S,$S+$_)),$q=$$U.create("ushort",$_/2,35044,!0);$q.setData($G),$y._mesh._indexBuffer=$q;var $u=$y._mesh._boneNames=[],$h=$y._readData.getUint16();for($u.length=$h,$r=0;$r<$h;$r++)$u[$r]=$y._strings[$y._readData.getUint16()];var $l=$y._readData.getUint32(),$W=$y._readData.getUint32(),$O=(new Float32Array($U.slice($p+$l,$p+$l+$W)),$y._readData.getUint32()),$L=$y._readData.getUint32(),$d=new Float32Array($U.slice($p+$O,$p+$O+$L));for($y._mesh._inverseBindPoses=[],$r=0,$V=$d.length;$r<$V;$r+=16){var $k=new $VU($d[$r+0],$d[$r+1],$d[$r+2],$d[$r+3],$d[$r+4],$d[$r+5],$d[$r+6],$d[$r+7],$d[$r+8],$d[$r+9],$d[$r+10],$d[$r+11],$d[$r+12],$d[$r+13],$d[$r+14],$d[$r+15]);$y._mesh._inverseBindPoses.push($k)}return $y._mesh._skinnedDatas=new Float32Array(16*$d.length),!0},$y.READ_SUBMESH=function(){var $V=$y._readData.__getBuffer(),$U=new $tU($y._mesh),$r=$y._readData.getInt16(),$s=$y._readData.getUint32(),$p=$y._readData.getUint32();$U._vertexBuffer=$y._mesh._vertexBuffers[$r],$U._vertexStart=$s,$U._vertexCount=$p;var $c=$y._readData.getUint32(),$R=$y._readData.getUint32(),$T=$y._mesh._indexBuffer;$U._indexBuffer=$T,$U._indexStart=$c,$U._indexCount=$R,$U._indices=new Uint16Array($T.getData().buffer,2*$c,$R);var $N=$y._DATA.offset,$t=$U._subIndexBufferStart,$b=$U._subIndexBufferCount,$S=$U._boneIndicesList,$_=$y._readData.getUint16();$t.length=$_,$b.length=$_,$S.length=$_;for(var $G=0;$G<$_;$G++){$t[$G]=$y._readData.getUint32(),$b[$G]=$y._readData.getUint32();var $q=$y._readData.getUint32(),$u=$y._readData.getUint32();$U._boneIndicesList[$G]=new Uint8Array($V.slice($N+$q,$N+$q+$u))}return $y._subMeshes.push($U),!0},$y._getVertexDeclaration=function($V){for(var $U,$r=!1,$s=!1,$p=!1,$c=!1,$R=!1,$T=!1,$N=!1,$t=!1,$b=!1,$S=0;$S<$V.length;$S++)switch($V[$S]){case"POSITION":$r=!0;break;case"NORMAL":$s=!0;break;case"COLOR":$p=!0;break;case"UV":$c=!0;break;case"UV1":$R=!0;break;case"BLENDWEIGHT":$N=!0;break;case"BLENDINDICES":$t=!0;break;case"TANGENT":$T=!0;break;case"BINORMAL":$b=!0}return $r&&$s&&$p&&$c&&$R&&$N&&$t&&$T?$U=$OV.vertexDeclaration:$r&&$s&&$p&&$c&&$R&&$N&&$t?$U=$lV.vertexDeclaration:$r&&$s&&$c&&$R&&$N&&$t&&$T?$U=$mV.vertexDeclaration:$r&&$s&&$c&&$R&&$N&&$t?$U=$EV.vertexDeclaration:$r&&$s&&$p&&$c&&$N&&$t&&$T?$U=$DV.vertexDeclaration:$r&&$s&&$p&&$c&&$N&&$t?$U=$kV.vertexDeclaration:$r&&$s&&$c&&$N&&$t&&$T?$U=$jV.vertexDeclaration:$r&&$s&&$c&&$N&&$t?$U=$xV.vertexDeclaration:$r&&$s&&$p&&$N&&$t&&$T?$U=$_V.vertexDeclaration:$r&&$s&&$p&&$N&&$t?$U=$bV.vertexDeclaration:$r&&$s&&$p&&$c&&$R&&$T?$U=$dV.vertexDeclaration:$r&&$s&&$p&&$c&&$R?$U=$hV.vertexDeclaration:$r&&$s&&$c&&$R&&$T?$U=$ZV.vertexDeclaration:$r&&$s&&$c&&$R?$U=$zV.vertexDeclaration:$r&&$s&&$p&&$c&&$T?$U=$IV.vertexDeclaration:$r&&$s&&$c&&$T&&$b?$U=$iV.vertexDeclaration:$r&&$s&&$p&&$c?$U=$uV.vertexDeclaration:$r&&$s&&$c&&$T?$U=$JV.vertexDeclaration:$r&&$s&&$c?$U=$wV.vertexDeclaration:$r&&$s&&$p&&$T?$U=$qV.vertexDeclaration:$r&&$s&&$p&&($U=$tV.vertexDeclaration),$U},$y._attrReg=new RegExp("(\\w+)|([:,;])","g"),$y._strings=[],$y._readData=null,$y._version=null,$y._mesh=null,$y._materials=null,$y._subMeshes=null,$y._materialMap=null,$S($y,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$y}(),$eV=function(){function $k(){}return $G($k,"laya.d3.loaders.LoadModelV03"),$k.parse=function($V,$U,$r,$s,$p){$k._mesh=$r,$k._subMeshes=$s,$k._materialMap=$p,$k._version=$U,$k._readData=$V,$k.READ_DATA(),$k.READ_BLOCK(),$k.READ_STRINGS();for(var $c=0,$R=$k._BLOCK.count;$c<$R;$c++){$k._readData.pos=$k._BLOCK.blockStarts[$c];var $T=$k._readData.getUint16(),$N=$k._strings[$T],$t=$k["READ_"+$N];if(null==$t)throw new Error("model file err,no this function:"+$T+" "+$N);$t.call()}$k._strings.length=0,$k._readData=null,$k._version=null,$k._mesh=null,$k._subMeshes=null,$k._materialMap=null},$k._readString=function(){return $k._strings[$k._readData.getUint16()]},$k.READ_DATA=function(){$k._DATA.offset=$k._readData.getUint32(),$k._DATA.size=$k._readData.getUint32()},$k.READ_BLOCK=function(){for(var $V=$k._BLOCK.count=$k._readData.getUint16(),$U=$k._BLOCK.blockStarts=[],$r=$k._BLOCK.blockLengths=[],$s=0;$s<$V;$s++)$U.push($k._readData.getUint32()),$r.push($k._readData.getUint32())},$k.READ_STRINGS=function(){var $V=$k._readData.getUint32(),$U=$k._readData.getUint16(),$r=$k._readData.pos;$k._readData.pos=$V+$k._DATA.offset;for(var $s=0;$s<$U;$s++)$k._strings[$s]=$k._readData.readUTFString();$k._readData.pos=$r},$k.READ_MESH=function(){var $V,$U=$k._readString(),$r=$k._readData.__getBuffer(),$s=0,$p=$k._readData.getInt16(),$c=$k._DATA.offset;for($s=0;$s<$p;$s++){var $R,$T=$c+$k._readData.getUint32(),$N=$k._readData.getUint32(),$t=new Float32Array($r.slice($T,$T+$N)),$b=$k._readString();switch($k._version){case"LAYAMODEL:03":$R=$k._vertexDeclarationMap_Discard[$b];break;case"LAYAMODEL:0301":$R=$k._vertexDeclarationMap[$b];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$R)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$k._version+"  bufferAttribute="+$b+"  name="+$U+"  url="+($k._mesh?$k._mesh.url:"null"));var $S=$jU.create($R,4*$t.length/$R.vertexStride,35044,!0,$k._mesh._url+"_"+$s);$S.setData($t),$k._mesh._vertexBuffers.push($S)}var $_=$c+$k._readData.getUint32(),$G=$k._readData.getUint32(),$q=new Uint16Array($r.slice($_,$_+$G)),$u=$$U.create("ushort",$G/2,35044,!0,$k._mesh._url);$u.setData($q),$k._mesh._indexBuffer=$u;var $h=$k._mesh._boneNames=[],$l=$k._readData.getUint16();for($h.length=$l,$s=0;$s<$l;$s++)$h[$s]=$k._strings[$k._readData.getUint16()];$k._readData.pos+=8;var $W=$k._readData.getUint32(),$O=$k._readData.getUint32(),$L=new Float32Array($r.slice($c+$W,$c+$W+$O));for($k._mesh._inverseBindPoses=[],$s=0,$V=$L.length;$s<$V;$s+=16){var $d=new $VU($L[$s+0],$L[$s+1],$L[$s+2],$L[$s+3],$L[$s+4],$L[$s+5],$L[$s+6],$L[$s+7],$L[$s+8],$L[$s+9],$L[$s+10],$L[$s+11],$L[$s+12],$L[$s+13],$L[$s+14],$L[$s+15]);$k._mesh._inverseBindPoses.push($d)}return $k._mesh._skinnedDatas=new Float32Array(16*$L.length),!0},$k.READ_SUBMESH=function(){var $V=$k._readData.__getBuffer(),$U=new $tU($k._mesh),$r=$k._readData.getInt16(),$s=$k._readData.getUint32(),$p=$k._readData.getUint32();$U._vertexBuffer=$k._mesh._vertexBuffers[$r],$U._vertexStart=$s,$U._vertexCount=$p;var $c=$k._readData.getUint32(),$R=$k._readData.getUint32(),$T=$k._mesh._indexBuffer;$U._indexBuffer=$T,$U._indexStart=$c,$U._indexCount=$R,$U._indices=new Uint16Array($T.getData().buffer,2*$c,$R);var $N=$k._DATA.offset,$t=$U._subIndexBufferStart,$b=$U._subIndexBufferCount,$S=$U._boneIndicesList,$_=$k._readData.getUint16();$t.length=$_,$b.length=$_,$S.length=$_;for(var $G=0;$G<$_;$G++){$t[$G]=$k._readData.getUint32(),$b[$G]=$k._readData.getUint32();var $q=$k._readData.getUint32(),$u=$k._readData.getUint32();$S[$G]=new Uint8Array($V.slice($N+$q,$N+$q+$u))}return $k._subMeshes.push($U),!0},$k._strings=[],$k._readData=null,$k._version=null,$k._mesh=null,$k._subMeshes=null,$k._materialMap=null,$S($k,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$OV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$lV.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$BV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$mV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$EV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$DV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$kV.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$jV.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$xV.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$_V.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$bV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$dV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$hV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$ZV.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$zV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$IV.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$iV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$uV.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$JV.vertexDeclaration,"POSITION,NORMAL,UV":$wV.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$qV.vertexDeclaration,"POSITION,NORMAL,COLOR":$tV.vertexDeclaration,"POSITION,NORMAL,TANGENT":$HV.vertexDeclaration,"POSITION,NORMAL":$NV.vertexDeclaration,"POSITION,UV":$MV.vertexDeclaration,POSITION:$TV.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$WV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$lV.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$BV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$KV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$EV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$yV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$kV.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$$V.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$xV.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$SV.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$bV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$LV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$hV.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$aV.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$zV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$nV.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$iV.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$uV.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$oV.vertexDeclaration,"POSITION,NORMAL,UV":$wV.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$GV.vertexDeclaration,"POSITION,NORMAL,COLOR":$tV.vertexDeclaration,"POSITION,NORMAL,TANGENT":$QV.vertexDeclaration,"POSITION,NORMAL":$NV.vertexDeclaration,"POSITION,UV":$MV.vertexDeclaration,POSITION:$TV.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$k}(),$FV=function(){function $T(){}return $G($T,"laya.d3.loaders.MeshReader"),$T.read=function($V,$U,$r,$s,$p){var $c=new $k($V);$c.pos=0;var $R=$c.readUTFString();switch($R){case"LAYAMODEL:01":case"LAYASKINANI:01":$T._readVersion01($c,$R,$U,$r,$s,$p);break;case"LAYAMODEL:02":$XV.parse($c,$R,$U,$r,$s,$p);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$eV.parse($c,$R,$U,$s,$p);break;default:throw new Error("MeshReader: unknown mesh version.")}$U._setSubMeshes($s)},$T._readVersion01=function($V,$U,$r,$s,$p,$c){new $AV($V,$U,$r,$s,$p,$c)},$T}(),$gV=function(){function $V($V,$U){this.min=null,this.max=null,this.min=$V,this.max=$U}$G($V,"laya.d3.math.BoundBox");var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.IClone":!0}),$U.getCorners=function($V){$V.length=8;var $U=this.min.elements,$r=this.max.elements,$s=$U[0],$p=$U[1],$c=$U[2],$R=$r[0],$T=$r[1],$N=$r[2];$V[0]=new $RU($s,$T,$N),$V[1]=new $RU($R,$T,$N),$V[2]=new $RU($R,$p,$N),$V[3]=new $RU($s,$p,$N),$V[4]=new $RU($s,$T,$c),$V[5]=new $RU($R,$T,$c),$V[6]=new $RU($R,$p,$c),$V[7]=new $RU($s,$p,$c)},$U.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$U.cloneTo=function($V){var $U=$V;this.min.cloneTo($U.min),this.max.cloneTo($U.max)},$U.clone=function(){var $V=new this.constructor(new $RU,new $RU);return this.cloneTo($V),$V},$V.createfromPoints=function($V,$U){if(null==$V)throw new Error("points");var $r=$U.min,$s=$U.max,$p=$r.elements;$p[0]=Number.MAX_VALUE,$p[1]=Number.MAX_VALUE,$p[2]=Number.MAX_VALUE;var $c=$s.elements;$c[0]=-Number.MAX_VALUE,$c[1]=-Number.MAX_VALUE,$c[2]=-Number.MAX_VALUE;for(var $R=0,$T=$V.length;$R<$T;++$R)$RU.min($r,$V[$R],$r),$RU.max($s,$V[$R],$s)},$V.merge=function($V,$U,$r){$RU.min($V.min,$U.min,$r.min),$RU.max($V.max,$U.max,$r.max)},$V}(),$vV=function(){function $t($V){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$V,this._near=new $UU(new $RU),this._far=new $UU(new $RU),this._left=new $UU(new $RU),this._right=new $UU(new $RU),this._top=new $UU(new $RU),this._bottom=new $UU(new $RU),$t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$G($t,"laya.d3.math.BoundFrustum");var $V=$t.prototype;return $V.equalsBoundFrustum=function($V){return this._matrix.equalsOtherMatrix($V.matrix)},$V.equalsObj=function($V){if($V instanceof laya.d3.math.BoundFrustum){var $U=$V;return this.equalsBoundFrustum($U)}return!1},$V.getPlane=function($V){switch($V){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$V.getCorners=function($V){$t._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($V[0]),$t._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($V[1]),$t._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($V[2]),$t._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($V[3]),$t._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($V[4]),$t._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($V[5]),$t._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($V[6]),$t._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($V[7])},$V.containsPoint=function($V){for(var $U=$UU.PlaneIntersectionType_Front,$r=$UU.PlaneIntersectionType_Front,$s=0;$s<6;$s++){switch($s){case 0:$r=Collision.intersectsPlaneAndPoint(this._near,$V);break;case 1:$r=Collision.intersectsPlaneAndPoint(this._far,$V);break;case 2:$r=Collision.intersectsPlaneAndPoint(this._left,$V);break;case 3:$r=Collision.intersectsPlaneAndPoint(this._right,$V);break;case 4:$r=Collision.intersectsPlaneAndPoint(this._top,$V);break;case 5:$r=Collision.intersectsPlaneAndPoint(this._bottom,$V)}switch($r){case $UU.PlaneIntersectionType_Back:return 0;case $UU.PlaneIntersectionType_Intersecting:$U=$UU.PlaneIntersectionType_Intersecting}}switch($U){case $UU.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$V.containsBoundBox=function($V){for(var $U,$r=$t._tempV30,$s=$t._tempV31,$p=1,$c=0;$c<6;$c++){if($U=this.getPlane($c),this._getBoxToPlanePVertexNVertex($V,$U.normal,$r,$s),Collision.intersectsPlaneAndPoint($U,$r)===$UU.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($U,$s)===$UU.PlaneIntersectionType_Back&&($p=2)}return $p},$V.containsBoundSphere=function($V){for(var $U=$UU.PlaneIntersectionType_Front,$r=$UU.PlaneIntersectionType_Front,$s=0;$s<6;$s++){switch($s){case 0:$r=Collision.intersectsPlaneAndSphere(this._near,$V);break;case 1:$r=Collision.intersectsPlaneAndSphere(this._far,$V);break;case 2:$r=Collision.intersectsPlaneAndSphere(this._left,$V);break;case 3:$r=Collision.intersectsPlaneAndSphere(this._right,$V);break;case 4:$r=Collision.intersectsPlaneAndSphere(this._top,$V);break;case 5:$r=Collision.intersectsPlaneAndSphere(this._bottom,$V)}switch($r){case $UU.PlaneIntersectionType_Back:return 0;case $UU.PlaneIntersectionType_Intersecting:$U=$UU.PlaneIntersectionType_Intersecting}}switch($U){case $UU.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$V._getBoxToPlanePVertexNVertex=function($V,$U,$r,$s){var $p=$V.min,$c=$p.elements,$R=$V.max,$T=$R.elements,$N=$U.elements,$t=$N[0],$b=$N[1],$S=$N[2];$p.cloneTo($r);var $_=$r.elements;0<=$t&&($_[0]=$T[0]),0<=$b&&($_[1]=$T[1]),0<=$S&&($_[2]=$T[2]),$R.cloneTo($s);var $G=$s.elements;0<=$t&&($G[0]=$c[0]),0<=$b&&($G[1]=$c[1]),0<=$S&&($G[2]=$c[2])},$q(0,$V,"top",function(){return this._top}),$q(0,$V,"matrix",function(){return this._matrix},function($V){this._matrix=$V,$t._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$q(0,$V,"near",function(){return this._near}),$q(0,$V,"far",function(){return this._far}),$q(0,$V,"left",function(){return this._left}),$q(0,$V,"right",function(){return this._right}),$q(0,$V,"bottom",function(){return this._bottom}),$t._getPlanesFromMatrix=function($V,$U,$r,$s,$p,$c,$R){var $T=$V.elements,$N=$T[0],$t=$T[1],$b=$T[2],$S=$T[3],$_=$T[4],$G=$T[5],$q=$T[6],$u=$T[7],$h=$T[8],$l=$T[9],$W=$T[10],$O=$T[11],$L=$T[12],$d=$T[13],$k=$T[14],$y=$T[15],$D=$U.normal.elements;$D[0]=$S+$b,$D[1]=$u+$q,$D[2]=$O+$W,$U.distance=$y+$k,$U.normalize();var $n=$r.normal.elements;$n[0]=$S-$b,$n[1]=$u-$q,$n[2]=$O-$W,$r.distance=$y-$k,$r.normalize();var $I=$s.normal.elements;$I[0]=$S+$N,$I[1]=$u+$_,$I[2]=$O+$h,$s.distance=$y+$L,$s.normalize();var $Q=$p.normal.elements;$Q[0]=$S-$N,$Q[1]=$u-$_,$Q[2]=$O-$h,$p.distance=$y-$L,$p.normalize();var $H=$c.normal.elements;$H[0]=$S-$t,$H[1]=$u-$G,$H[2]=$O-$l,$c.distance=$y-$d,$c.normalize();var $w=$R.normal.elements;$w[0]=$S+$t,$w[1]=$u+$G,$w[2]=$O+$l,$R.distance=$y+$d,$R.normalize()},$t._get3PlaneInterPoint=function($V,$U,$r){var $s=$V.normal,$p=$U.normal,$c=$r.normal;$RU.cross($p,$c,$t._tempV30),$RU.cross($c,$s,$t._tempV31),$RU.cross($s,$p,$t._tempV32);var $R=$RU.dot($s,$t._tempV30),$T=$RU.dot($p,$t._tempV31),$N=$RU.dot($c,$t._tempV32);return $RU.scale($t._tempV30,-$V.distance/$R,$t._tempV33),$RU.scale($t._tempV31,-$U.distance/$T,$t._tempV34),$RU.scale($t._tempV32,-$r.distance/$N,$t._tempV35),$RU.add($t._tempV33,$t._tempV34,$t._tempV36),$RU.add($t._tempV35,$t._tempV36,$t._tempV37),$t._tempV37},$S($t,["_tempV30",function(){return this._tempV30=new $RU},"_tempV31",function(){return this._tempV31=new $RU},"_tempV32",function(){return this._tempV32=new $RU},"_tempV33",function(){return this._tempV33=new $RU},"_tempV34",function(){return this._tempV34=new $RU},"_tempV35",function(){return this._tempV35=new $RU},"_tempV36",function(){return this._tempV36=new $RU},"_tempV37",function(){return this._tempV37=new $RU}]),$t}(),$YV=function(){function $b($V,$U){this.center=null,this.radius=NaN,this.center=$V,this.radius=$U}$G($b,"laya.d3.math.BoundSphere");var $V=$b.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.toDefault=function(){this.center.toDefault(),this.radius=0},$V.intersectsRayDistance=function($V){return Collision.intersectsRayAndSphereRD($V,this)},$V.intersectsRayPoint=function($V,$U){return Collision.intersectsRayAndSphereRP($V,this,$U)},$V.cloneTo=function($V){var $U=$V;this.center.cloneTo($U.center),$U.radius=this.radius},$V.clone=function(){var $V=new this.constructor(new $RU,new $RU);return this.cloneTo($V),$V},$b.createFromSubPoints=function($V,$U,$r,$s){if(null==$V)throw new Error("points");if($U<0||$U>=$V.length)throw new Error("start"+$U+"Must be in the range [0, "+($V.length-1)+"]");if($r<0||$U+$r>$V.length)throw new Error("count"+$r+"Must be in the range <= "+$V.length+"}");var $p=$U+$r,$c=$b._tempVector3;$c.elements[0]=0,$c.elements[1]=0,$c.elements[2]=0;for(var $R=$U;$R<$p;++$R)$RU.add($V[$R],$c,$c);var $T=$s.center;$RU.scale($c,1/$r,$T);var $N=0;for($R=$U;$R<$p;++$R){var $t=$RU.distanceSquared($T,$V[$R]);$N<$t&&($N=$t)}$s.radius=Math.sqrt($N)},$b.createfromPoints=function($V,$U){if(null==$V)throw new Error("points");$b.createFromSubPoints($V,0,$V.length,$U)},$S($b,["_tempVector3",function(){return this._tempVector3=new $RU}]),$b}(),$CV=(function(){function $V(){}$G($V,"laya.d3.math.ContainmentType"),$V.Disjoint=0,$V.Contains=1,$V.Intersects=2}(),function(){function $r(){}return $G($r,"laya.d3.math.MathUtils3D"),$r.isZero=function($V){return Math.abs($V)<$r.zeroTolerance},$r.nearEqual=function($V,$U){return!!$r.isZero($V-$U)},$r.fastInvSqrt=function($V){return $r.isZero($V)?$V:1/Math.sqrt($V)},$S($r,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$r}()),$fV=function(){function $N(){var $V=this.elements=new Float32Array(9);$V[0]=1,$V[1]=0,$V[2]=0,$V[3]=0,$V[4]=1,$V[5]=0,$V[6]=0,$V[7]=0,$V[8]=1}$G($N,"laya.d3.math.Matrix3x3");var $V=$N.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.determinant=function(){var $V=this.elements,$U=$V[0],$r=$V[1],$s=$V[2],$p=$V[3],$c=$V[4],$R=$V[5],$T=$V[6],$N=$V[7],$t=$V[8];return $U*($t*$c-$R*$N)+$r*(-$t*$p+$R*$T)+$s*($N*$p-$c*$T)},$V.translate=function($V,$U){var $r=$U.elements,$s=this.elements,$p=$V.elements,$c=$s[0],$R=$s[1],$T=$s[2],$N=$s[3],$t=$s[4],$b=$s[5],$S=$s[6],$_=$s[7],$G=$s[8],$q=$p[0],$u=$p[1];$r[0]=$c,$r[1]=$R,$r[2]=$T,$r[3]=$N,$r[4]=$t,$r[5]=$b,$r[6]=$q*$c+$u*$N+$S,$r[7]=$q*$R+$u*$t+$_,$r[8]=$q*$T+$u*$b+$G},$V.rotate=function($V,$U){var $r=$U.elements,$s=this.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=$s[4],$t=$s[5],$b=$s[6],$S=$s[7],$_=$s[8],$G=Math.sin($V),$q=Math.cos($V);$r[0]=$q*$p+$G*$T,$r[1]=$q*$c+$G*$N,$r[2]=$q*$R+$G*$t,$r[3]=$q*$T-$G*$p,$r[4]=$q*$N-$G*$c,$r[5]=$q*$t-$G*$R,$r[6]=$b,$r[7]=$S,$r[8]=$_},$V.scale=function($V,$U){var $r=$U.elements,$s=this.elements,$p=$V.elements,$c=$p[0],$R=$p[1];$r[0]=$c*$s[0],$r[1]=$c*$s[1],$r[2]=$c*$s[2],$r[3]=$R*$s[3],$r[4]=$R*$s[4],$r[5]=$R*$s[5],$r[6]=$s[6],$r[7]=$s[7],$r[8]=$s[8]},$V.invert=function($V){var $U=$V.elements,$r=this.elements,$s=$r[0],$p=$r[1],$c=$r[2],$R=$r[3],$T=$r[4],$N=$r[5],$t=$r[6],$b=$r[7],$S=$r[8],$_=$S*$T-$N*$b,$G=-$S*$R+$N*$t,$q=$b*$R-$T*$t,$u=$s*$_+$p*$G+$c*$q;$u||($V=null),$u=1/$u,$U[0]=$_*$u,$U[1]=(-$S*$p+$c*$b)*$u,$U[2]=($N*$p-$c*$T)*$u,$U[3]=$G*$u,$U[4]=($S*$s-$c*$t)*$u,$U[5]=(-$N*$s+$c*$R)*$u,$U[6]=$q*$u,$U[7]=(-$b*$s+$p*$t)*$u,$U[8]=($T*$s-$p*$R)*$u},$V.transpose=function($V){var $U=$V.elements,$r=this.elements;if($V===this){var $s=$r[1],$p=$r[2],$c=$r[5];$U[1]=$r[3],$U[2]=$r[6],$U[3]=$s,$U[5]=$r[7],$U[6]=$p,$U[7]=$c}else $U[0]=$r[0],$U[1]=$r[3],$U[2]=$r[6],$U[3]=$r[1],$U[4]=$r[4],$U[5]=$r[7],$U[6]=$r[2],$U[7]=$r[5],$U[8]=$r[8]},$V.identity=function(){var $V=this.elements;$V[0]=1,$V[1]=0,$V[2]=0,$V[3]=0,$V[4]=1,$V[5]=0,$V[6]=0,$V[7]=0,$V[8]=1},$V.cloneTo=function($V){var $U,$r,$s;if(($r=this.elements)!==($s=$V.elements))for($U=0;$U<9;++$U)$s[$U]=$r[$U]},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$N.createFromTranslation=function($V,$U){$U.elements;var $r=$V.elements;$U[0]=1,$U[1]=0,$U[2]=0,$U[3]=0,$U[4]=1,$U[5]=0,$U[6]=$r[0],$U[7]=$r[1],$U[8]=1},$N.createFromRotation=function($V,$U){var $r=$U.elements,$s=Math.sin($V),$p=Math.cos($V);$r[0]=$p,$r[1]=$s,$r[2]=0,$r[3]=-$s,$r[4]=$p,$r[5]=0,$r[6]=0,$r[7]=0,$r[8]=1},$N.createFromScaling=function($V,$U){var $r=$U.elements,$s=$V.elements;$r[0]=$s[0],$r[1]=0,$r[2]=0,$r[3]=0,$r[4]=$s[1],$r[5]=0,$r[6]=0,$r[7]=0,$r[8]=1},$N.createFromMatrix4x4=function($V,$U){$U[0]=$V[0],$U[1]=$V[1],$U[2]=$V[2],$U[3]=$V[4],$U[4]=$V[5],$U[5]=$V[6],$U[6]=$V[8],$U[7]=$V[9],$U[8]=$V[10]},$N.multiply=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements,$R=$p[0],$T=$p[1],$N=$p[2],$t=$p[3],$b=$p[4],$S=$p[5],$_=$p[6],$G=$p[7],$q=$p[8],$u=$c[0],$h=$c[1],$l=$c[2],$W=$c[3],$O=$c[4],$L=$c[5],$d=$c[6],$k=$c[7],$y=$c[8];$s[0]=$u*$R+$h*$t+$l*$_,$s[1]=$u*$T+$h*$b+$l*$G,$s[2]=$u*$N+$h*$S+$l*$q,$s[3]=$W*$R+$O*$t+$L*$_,$s[4]=$W*$T+$O*$b+$L*$G,$s[5]=$W*$N+$O*$S+$L*$q,$s[6]=$d*$R+$k*$t+$y*$_,$s[7]=$d*$T+$k*$b+$y*$G,$s[8]=$d*$N+$k*$S+$y*$q},$N.lookAt=function($V,$U,$r,$s){$RU.subtract($V,$U,$N._tempV30),$RU.normalize($N._tempV30,$N._tempV30),$RU.cross($r,$N._tempV30,$N._tempV31),$RU.normalize($N._tempV31,$N._tempV31),$RU.cross($N._tempV30,$N._tempV31,$N._tempV32);var $p=$N._tempV30.elements,$c=$N._tempV31.elements,$R=$N._tempV32.elements,$T=$s.elements;$T[0]=$c[0],$T[3]=$c[1],$T[6]=$c[2],$T[1]=$R[0],$T[4]=$R[1],$T[7]=$R[2],$T[2]=$p[0],$T[5]=$p[1],$T[8]=$p[2]},$N.DEFAULT=new $N,$S($N,["_tempV30",function(){return this._tempV30=new $RU},"_tempV31",function(){return this._tempV31=new $RU},"_tempV32",function(){return this._tempV32=new $RU}]),$N}(),$VU=function(){function $n($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S,$_,$G,$q,$u){void 0===$V&&($V=1),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$c&&($c=1),void 0===$R&&($R=0),void 0===$T&&($T=0),void 0===$N&&($N=0),void 0===$t&&($t=0),void 0===$b&&($b=1),void 0===$S&&($S=0),void 0===$_&&($_=0),void 0===$G&&($G=0),void 0===$q&&($q=0),void 0===$u&&($u=1);var $h=this.elements=new Float32Array(16);$h[0]=$V,$h[1]=$U,$h[2]=$r,$h[3]=$s,$h[4]=$p,$h[5]=$c,$h[6]=$R,$h[7]=$T,$h[8]=$N,$h[9]=$t,$h[10]=$b,$h[11]=$S,$h[12]=$_,$h[13]=$G,$h[14]=$q,$h[15]=$u}$G($n,"laya.d3.math.Matrix4x4");var $V=$n.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.getElementByRowColumn=function($V,$U){if($V<0||3<$V)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($U<0||3<$U)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$V+$U]},$V.setElementByRowColumn=function($V,$U,$r){if($V<0||3<$V)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($U<0||3<$U)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$V+$U]=$r},$V.equalsOtherMatrix=function($V){var $U=this.elements,$r=$V.elements;return $CV.nearEqual($U[0],$r[0])&&$CV.nearEqual($U[1],$r[1])&&$CV.nearEqual($U[2],$r[2])&&$CV.nearEqual($U[3],$r[3])&&$CV.nearEqual($U[4],$r[4])&&$CV.nearEqual($U[5],$r[5])&&$CV.nearEqual($U[6],$r[6])&&$CV.nearEqual($U[7],$r[7])&&$CV.nearEqual($U[8],$r[8])&&$CV.nearEqual($U[9],$r[9])&&$CV.nearEqual($U[10],$r[10])&&$CV.nearEqual($U[11],$r[11])&&$CV.nearEqual($U[12],$r[12])&&$CV.nearEqual($U[13],$r[13])&&$CV.nearEqual($U[14],$r[14])&&$CV.nearEqual($U[15],$r[15])},$V.decomposeTransRotScale=function($V,$U,$r){var $s=$n._tempMatrix4x4;return this.decomposeTransRotMatScale($V,$s,$r)?($rU.createFromMatrix4x4($s,$U),!0):($U.identity(),!1)},$V.decomposeTransRotMatScale=function($V,$U,$r){var $s=this.elements,$p=$V.elements,$c=$U.elements,$R=$r.elements;$p[0]=$s[12],$p[1]=$s[13],$p[2]=$s[14];var $T=$s[0],$N=$s[1],$t=$s[2],$b=$s[4],$S=$s[5],$_=$s[6],$G=$s[8],$q=$s[9],$u=$s[10],$h=$R[0]=Math.sqrt($T*$T+$N*$N+$t*$t),$l=$R[1]=Math.sqrt($b*$b+$S*$S+$_*$_),$W=$R[2]=Math.sqrt($G*$G+$q*$q+$u*$u);if($CV.isZero($h)||$CV.isZero($l)||$CV.isZero($W))return $c[1]=$c[2]=$c[3]=$c[4]=$c[6]=$c[7]=$c[8]=$c[9]=$c[11]=$c[12]=$c[13]=$c[14]=0,$c[0]=$c[5]=$c[10]=$c[15]=1,!1;var $O=$n._tempVector0,$L=$O.elements;$L[0]=$G/$W,$L[1]=$q/$W,$L[2]=$u/$W;var $d=$n._tempVector1,$k=$d.elements;$k[0]=$T/$h,$k[1]=$N/$h,$k[2]=$t/$h;var $y=$n._tempVector2;$RU.cross($O,$d,$y);var $D=$n._tempVector1;return $RU.cross($y,$O,$D),$c[3]=$c[7]=$c[11]=$c[12]=$c[13]=$c[14]=0,$c[15]=1,$c[0]=$D.x,$c[1]=$D.y,$c[2]=$D.z,$c[4]=$y.x,$c[5]=$y.y,$c[6]=$y.z,$c[8]=$O.x,$c[9]=$O.y,$c[10]=$O.z,$c[0]*$T+$c[1]*$N+$c[2]*$t<0&&($R[0]=-$h),$c[4]*$b+$c[5]*$S+$c[6]*$_<0&&($R[1]=-$l),$c[8]*$G+$c[9]*$q+$c[10]*$u<0&&($R[2]=-$W),!0},$V.decomposeYawPitchRoll=function($V){var $U=$V.elements,$r=Math.asin(-this.elements[9]);$U[1]=$r,Math.cos($r)>$CV.zeroTolerance?($U[2]=Math.atan2(this.elements[1],this.elements[5]),$U[0]=Math.atan2(this.elements[8],this.elements[10])):($U[2]=Math.atan2(-this.elements[4],this.elements[0]),$U[0]=0)},$V.normalize=function(){var $V=this.elements,$U=$V[0],$r=$V[1],$s=$V[2],$p=Math.sqrt($U*$U+$r*$r+$s*$s);if(!$p)return $V[0]=0,$V[1]=0,void($V[2]=0);1!=$p&&($p=1/$p,$V[0]=$U*$p,$V[1]=$r*$p,$V[2]=$s*$p)},$V.transpose=function(){var $V,$U;return $U=($V=this.elements)[1],$V[1]=$V[4],$V[4]=$U,$U=$V[2],$V[2]=$V[8],$V[8]=$U,$U=$V[3],$V[3]=$V[12],$V[12]=$U,$U=$V[6],$V[6]=$V[9],$V[9]=$U,$U=$V[7],$V[7]=$V[13],$V[13]=$U,$U=$V[11],$V[11]=$V[14],$V[14]=$U,this},$V.invert=function($V){var $U=this.elements,$r=$V.elements,$s=$U[0],$p=$U[1],$c=$U[2],$R=$U[3],$T=$U[4],$N=$U[5],$t=$U[6],$b=$U[7],$S=$U[8],$_=$U[9],$G=$U[10],$q=$U[11],$u=$U[12],$h=$U[13],$l=$U[14],$W=$U[15],$O=$s*$N-$p*$T,$L=$s*$t-$c*$T,$d=$s*$b-$R*$T,$k=$p*$t-$c*$N,$y=$p*$b-$R*$N,$D=$c*$b-$R*$t,$n=$S*$h-$_*$u,$I=$S*$l-$G*$u,$Q=$S*$W-$q*$u,$H=$_*$l-$G*$h,$w=$_*$W-$q*$h,$z=$G*$W-$q*$l,$E=$O*$z-$L*$w+$d*$H+$k*$Q-$y*$I+$D*$n;0!==Math.abs($E)&&($E=1/$E,$r[0]=($N*$z-$t*$w+$b*$H)*$E,$r[1]=($c*$w-$p*$z-$R*$H)*$E,$r[2]=($h*$D-$l*$y+$W*$k)*$E,$r[3]=($G*$y-$_*$D-$q*$k)*$E,$r[4]=($t*$Q-$T*$z-$b*$I)*$E,$r[5]=($s*$z-$c*$Q+$R*$I)*$E,$r[6]=($l*$d-$u*$D-$W*$L)*$E,$r[7]=($S*$D-$G*$d+$q*$L)*$E,$r[8]=($T*$w-$N*$Q+$b*$n)*$E,$r[9]=($p*$Q-$s*$w-$R*$n)*$E,$r[10]=($u*$y-$h*$d+$W*$O)*$E,$r[11]=($_*$d-$S*$y-$q*$O)*$E,$r[12]=($N*$I-$T*$H-$t*$n)*$E,$r[13]=($s*$H-$p*$I+$c*$n)*$E,$r[14]=($h*$L-$u*$k-$l*$O)*$E,$r[15]=($S*$k-$_*$L+$G*$O)*$E)},$V.identity=function(){var $V=this.elements;$V[1]=$V[2]=$V[3]=$V[4]=$V[6]=$V[7]=$V[8]=$V[9]=$V[11]=$V[12]=$V[13]=$V[14]=0,$V[0]=$V[5]=$V[10]=$V[15]=1},$V.cloneTo=function($V){var $U,$r,$s;if(($r=this.elements)!==($s=$V.elements))for($U=0;$U<16;++$U)$s[$U]=$r[$U]},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$V.getTranslationVector=function($V){var $U=this.elements,$r=$V.elements;$r[0]=$U[12],$r[1]=$U[13],$r[2]=$U[14]},$V.setTranslationVector=function($V){var $U=this.elements,$r=$V.elements;$U[12]=$r[0],$U[13]=$r[1],$U[14]=$r[2]},$V.getForward=function($V){var $U=this.elements,$r=$V.elements;$r[0]=-$U[8],$r[1]=-$U[9],$r[2]=-$U[10]},$V.setForward=function($V){var $U=this.elements,$r=$V.elements;$U[8]=-$r[0],$U[9]=-$r[1],$U[10]=-$r[2]},$n.createRotationX=function($V,$U){var $r=$U.elements,$s=Math.sin($V),$p=Math.cos($V);$r[1]=$r[2]=$r[3]=$r[4]=$r[7]=$r[8]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[0]=$r[15]=1,$r[5]=$r[10]=$p,$r[6]=$s,$r[9]=-$s},$n.createRotationY=function($V,$U){var $r=$U.elements,$s=Math.sin($V),$p=Math.cos($V);$r[1]=$r[3]=$r[4]=$r[6]=$r[7]=$r[9]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[5]=$r[15]=1,$r[0]=$r[10]=$p,$r[2]=-$s,$r[8]=$s},$n.createRotationZ=function($V,$U){var $r=$U.elements,$s=Math.sin($V),$p=Math.cos($V);$r[2]=$r[3]=$r[6]=$r[7]=$r[8]=$r[9]=$r[11]=$r[12]=$r[13]=$r[14]=0,$r[10]=$r[15]=1,$r[0]=$r[5]=$p,$r[1]=$s,$r[4]=-$s},$n.createRotationYawPitchRoll=function($V,$U,$r,$s){$rU.createFromYawPitchRoll($V,$U,$r,$n._tempQuaternion),$n.createRotationQuaternion($n._tempQuaternion,$s)},$n.createRotationAxis=function($V,$U,$r){var $s=$V.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=Math.cos($U),$N=Math.sin($U),$t=$p*$p,$b=$c*$c,$S=$R*$R,$_=$p*$c,$G=$p*$R,$q=$c*$R,$u=$r.elements;$u[3]=$u[7]=$u[11]=$u[12]=$u[13]=$u[14]=0,$u[15]=1,$u[0]=$t+$T*(1-$t),$u[1]=$_-$T*$_+$N*$R,$u[2]=$G-$T*$G-$N*$c,$u[4]=$_-$T*$_-$N*$R,$u[5]=$b+$T*(1-$b),$u[6]=$q-$T*$q+$N*$p,$u[8]=$G-$T*$G+$N*$c,$u[9]=$q-$T*$q-$N*$p,$u[10]=$S+$T*(1-$S)},$n.createRotationQuaternion=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0],$c=$r[1],$R=$r[2],$T=$r[3],$N=$p*$p,$t=$c*$c,$b=$R*$R,$S=$p*$c,$_=$R*$T,$G=$R*$p,$q=$c*$T,$u=$c*$R,$h=$p*$T;$s[3]=$s[7]=$s[11]=$s[12]=$s[13]=$s[14]=0,$s[15]=1,$s[0]=1-2*($t+$b),$s[1]=2*($S+$_),$s[2]=2*($G-$q),$s[4]=2*($S-$_),$s[5]=1-2*($b+$N),$s[6]=2*($u+$h),$s[8]=2*($G+$q),$s[9]=2*($u-$h),$s[10]=1-2*($t+$N)},$n.createTranslate=function($V,$U){var $r=$V.elements,$s=$U.elements;$s[4]=$s[8]=$s[1]=$s[9]=$s[2]=$s[6]=$s[3]=$s[7]=$s[11]=0,$s[0]=$s[5]=$s[10]=$s[15]=1,$s[12]=$r[0],$s[13]=$r[1],$s[14]=$r[2]},$n.createScaling=function($V,$U){var $r=$V.elements,$s=$U.elements;$s[0]=$r[0],$s[5]=$r[1],$s[10]=$r[2],$s[1]=$s[4]=$s[8]=$s[12]=$s[9]=$s[13]=$s[2]=$s[6]=$s[14]=$s[3]=$s[7]=$s[11]=0,$s[15]=1},$n.multiply=function($V,$U,$r){var $s,$p,$c,$R,$T,$N,$t,$b;for($p=$r.elements,$c=$V.elements,$p===($R=$U.elements)&&($R=$R.slice()),$s=0;$s<4;$s++)$T=$c[$s],$N=$c[$s+4],$t=$c[$s+8],$b=$c[$s+12],$p[$s]=$T*$R[0]+$N*$R[1]+$t*$R[2]+$b*$R[3],$p[$s+4]=$T*$R[4]+$N*$R[5]+$t*$R[6]+$b*$R[7],$p[$s+8]=$T*$R[8]+$N*$R[9]+$t*$R[10]+$b*$R[11],$p[$s+12]=$T*$R[12]+$N*$R[13]+$t*$R[14]+$b*$R[15]},$n.createFromQuaternion=function($V,$U){var $r=$U.elements,$s=$V.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=$p+$p,$t=$c+$c,$b=$R+$R,$S=$p*$N,$_=$c*$N,$G=$c*$t,$q=$R*$N,$u=$R*$t,$h=$R*$b,$l=$T*$N,$W=$T*$t,$O=$T*$b;$r[0]=1-$G-$h,$r[1]=$_+$O,$r[2]=$q-$W,$r[3]=0,$r[4]=$_-$O,$r[5]=1-$S-$h,$r[6]=$u+$l,$r[7]=0,$r[8]=$q+$W,$r[9]=$u-$l,$r[10]=1-$S-$G,$r[11]=0,$r[12]=0,$r[13]=0,$r[14]=0,$r[15]=1},$n.createAffineTransformation=function($V,$U,$r,$s){var $p=$V.elements,$c=$U.elements,$R=$r.elements,$T=$s.elements,$N=$c[0],$t=$c[1],$b=$c[2],$S=$c[3],$_=$N+$N,$G=$t+$t,$q=$b+$b,$u=$N*$_,$h=$N*$G,$l=$N*$q,$W=$t*$G,$O=$t*$q,$L=$b*$q,$d=$S*$_,$k=$S*$G,$y=$S*$q,$D=$R[0],$n=$R[1],$I=$R[2];$T[0]=(1-($W+$L))*$D,$T[1]=($h+$y)*$D,$T[2]=($l-$k)*$D,$T[3]=0,$T[4]=($h-$y)*$n,$T[5]=(1-($u+$L))*$n,$T[6]=($O+$d)*$n,$T[7]=0,$T[8]=($l+$k)*$I,$T[9]=($O-$d)*$I,$T[10]=(1-($u+$W))*$I,$T[11]=0,$T[12]=$p[0],$T[13]=$p[1],$T[14]=$p[2],$T[15]=1},$n.createLookAt=function($V,$U,$r,$s){var $p=$s.elements,$c=$n._tempVector0,$R=$n._tempVector1,$T=$n._tempVector2;$RU.subtract($V,$U,$T),$RU.normalize($T,$T),$RU.cross($r,$T,$c),$RU.normalize($c,$c),$RU.cross($T,$c,$R),$s.identity(),$p[0]=$c.x,$p[4]=$c.y,$p[8]=$c.z,$p[1]=$R.x,$p[5]=$R.y,$p[9]=$R.z,$p[2]=$T.x,$p[6]=$T.y,$p[10]=$T.z,$p[12]=-$RU.dot($c,$V),$p[13]=-$RU.dot($R,$V),$p[14]=-$RU.dot($T,$V)},$n.createPerspective=function($V,$U,$r,$s,$p){var $c=$p.elements,$R=1/Math.tan($V/2),$T=1/($r-$s);$c[0]=$R/$U,$c[5]=$R,$c[10]=($s+$r)*$T,$c[11]=-1,$c[14]=2*$s*$r*$T,$c[1]=$c[2]=$c[3]=$c[4]=$c[6]=$c[7]=$c[8]=$c[9]=$c[12]=$c[13]=$c[15]=0},$n.createOrthoOffCenterRH=function($V,$U,$r,$s,$p,$c,$R){var $T=$R.elements,$N=1/($V-$U),$t=1/($r-$s),$b=1/($p-$c);$T[1]=$T[2]=$T[3]=$T[4]=$T[6]=$T[7]=$T[8]=$T[9]=$T[11]=0,$T[15]=1,$T[0]=-2*$N,$T[5]=-2*$t,$T[10]=2*$b,$T[12]=($V+$U)*$N,$T[13]=($s+$r)*$t,$T[14]=($c+$p)*$b},$n.translation=function($V,$U){var $r=$V.elements,$s=$U.elements;$s[0]=$s[5]=$s[10]=$s[15]=1,$s[12]=$r[0],$s[13]=$r[1],$s[14]=$r[2]},$S($n,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $n},"_tempVector0",function(){return this._tempVector0=new $RU},"_tempVector1",function(){return this._tempVector1=new $RU},"_tempVector2",function(){return this._tempVector2=new $RU},"_tempQuaternion",function(){return this._tempQuaternion=new $rU},"DEFAULT",function(){return this.DEFAULT=new $n},"ZERO",function(){return this.ZERO=new $n(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$n}(),$UU=(function(){function $O($V,$U){this.extents=null,this.transformation=null,this.extents=$V,this.transformation=$U}$G($O,"laya.d3.math.OrientedBoundBox");var $V=$O.prototype;$V.getCorners=function($V){var $U=$O._tempV30.elements,$r=$O._tempV31.elements,$s=$O._tempV32.elements,$p=this.extents.elements;$U[0]=$p[0],$U[1]=$U[2]=0,$r[1]=$p[1],$r[0]=$r[2]=0,$s[2]=$p[2],$s[0]=$s[1]=0,$RU.TransformNormal($O._tempV30,this.transformation,$O._tempV30),$RU.TransformNormal($O._tempV31,this.transformation,$O._tempV31),$RU.TransformNormal($O._tempV32,this.transformation,$O._tempV32);var $c=$O._tempV33;this.transformation.getTranslationVector($c),$V.length=8,$RU.add($c,$O._tempV30,$O._tempV34),$RU.add($O._tempV34,$O._tempV31,$O._tempV34),$RU.add($O._tempV34,$O._tempV32,$V[0]),$RU.add($c,$O._tempV30,$O._tempV34),$RU.add($O._tempV34,$O._tempV31,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV32,$V[1]),$RU.subtract($c,$O._tempV30,$O._tempV34),$RU.add($O._tempV34,$O._tempV31,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV32,$V[2]),$RU.subtract($c,$O._tempV30,$O._tempV34),$RU.add($O._tempV34,$O._tempV31,$O._tempV34),$RU.add($O._tempV34,$O._tempV32,$V[3]),$RU.add($c,$O._tempV30,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV31,$O._tempV34),$RU.add($O._tempV34,$O._tempV32,$V[4]),$RU.add($c,$O._tempV30,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV31,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV32,$V[5]),$RU.subtract($c,$O._tempV30,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV31,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV32,$V[6]),$RU.subtract($c,$O._tempV30,$O._tempV34),$RU.subtract($O._tempV34,$O._tempV31,$O._tempV34),$RU.add($O._tempV34,$O._tempV32,$V[7])},$V.transform=function($V){$VU.multiply(this.transformation,$V,this.transformation)},$V.scale=function($V){$RU.multiply(this.extents,$V,this.extents)},$V.translate=function($V){this.transformation.getTranslationVector($O._tempV30),$RU.add($O._tempV30,$V,$O._tempV31),this.transformation.setTranslationVector($O._tempV31)},$V.Size=function($V){$RU.scale(this.extents,2,$V)},$V.getSize=function($V){var $U=this.extents.elements;$O._tempV30.x=$U[0],$O._tempV31.y=$U[1],$O._tempV32.z=$U[2],$RU.TransformNormal($O._tempV30,this.transformation,$O._tempV30),$RU.TransformNormal($O._tempV31,this.transformation,$O._tempV31),$RU.TransformNormal($O._tempV31,this.transformation,$O._tempV32);var $r=$V.elements;$r[0]=$RU.scalarLength($O._tempV30),$r[1]=$RU.scalarLength($O._tempV31),$r[2]=$RU.scalarLength($O._tempV32)},$V.getSizeSquared=function($V){var $U=this.extents.elements;$O._tempV30.x=$U[0],$O._tempV31.y=$U[1],$O._tempV32.z=$U[2],$RU.TransformNormal($O._tempV30,this.transformation,$O._tempV30),$RU.TransformNormal($O._tempV31,this.transformation,$O._tempV31),$RU.TransformNormal($O._tempV31,this.transformation,$O._tempV32);var $r=$V.elements;$r[0]=$RU.scalarLengthSquared($O._tempV30),$r[1]=$RU.scalarLengthSquared($O._tempV31),$r[2]=$RU.scalarLengthSquared($O._tempV32)},$V.getCenter=function($V){this.transformation.getTranslationVector($V)},$V.containsPoint=function($V){var $U=this.extents.elements,$r=$U[0],$s=$U[1],$p=$U[2];this.transformation.invert($O._tempM0),$RU.transformCoordinate($V,$O._tempM0,$O._tempV30);var $c=$O._tempV30.elements,$R=Math.abs($c[0]),$T=Math.abs($c[1]),$N=Math.abs($c[2]);return $CV.nearEqual($R,$r)&&$CV.nearEqual($T,$s)&&$CV.nearEqual($N,$p)?2:$R<$r&&$T<$s&&$N<$p?1:0},$V.containsPoints=function($V){var $U=this.extents.elements,$r=$U[0],$s=$U[1],$p=$U[2];this.transformation.invert($O._tempM0);for(var $c=!0,$R=!1,$T=0;$T<$V.length;$T++){$RU.transformCoordinate($V[$T],$O._tempM0,$O._tempV30);var $N=$O._tempV30.elements,$t=Math.abs($N[0]),$b=Math.abs($N[1]),$S=Math.abs($N[2]);$CV.nearEqual($t,$r)&&$CV.nearEqual($b,$s)&&$CV.nearEqual($S,$p)&&($R=!0),$t<$r&&$b<$s&&$S<$p?$R=!0:$c=!1}return $c?1:$R?2:0},$V.containsSphere=function($V,$U){void 0===$U&&($U=!1);var $r=this.extents.elements,$s=$r[0],$p=$r[1],$c=$r[2],$R=$V.radius;this.transformation.invert($O._tempM0),$RU.transformCoordinate($V.center,$O._tempM0,$O._tempV30);var $T=NaN;if($T=$U?$R:($RU.scale($RU.UnitX,$R,$O._tempV31),$RU.TransformNormal($O._tempV31,$O._tempM0,$O._tempV31),$RU.scalarLength($O._tempV31)),$RU.scale(this.extents,-1,$O._tempV32),$RU.Clamp($O._tempV30,$O._tempV32,this.extents,$O._tempV33),$T*$T<$RU.distanceSquared($O._tempV30,$O._tempV33))return 0;var $N=$O._tempV30.elements,$t=$N[0],$b=$N[1],$S=$N[2],$_=$O._tempV32.elements,$G=$_[0],$q=$_[1],$u=$_[2];return $G+$T<=$t&&$t<=$s-$T&&$T<$s-$G&&$q+$T<=$b&&$b<=$p-$T&&$T<$p-$q&&$u+$T<=$S&&$S<=$c-$T&&$T<$c-$u?1:2},$V.containsOrientedBoundBox=function($V){var $U=0,$r=0;$V.getCorners($O._corners);var $s=this.containsPoints($O._corners);if(0!=$s)return $s;var $p=this.extents.elements;$V.extents.cloneTo($O._tempV35);var $c=$O._tempV35.elements;$O._getRows(this.transformation,$O._rows1),$O._getRows($V.transformation,$O._rows2);var $R=NaN;for($U=0;$U<4;$U++)for($r=0;$r<4;$r++)3==$U||3==$r?($O._tempM0.setElementByRowColumn($U,$r,0),$O._tempM1.setElementByRowColumn($U,$r,0)):($R=$RU.dot($O._rows1[$U],$O._rows2[$r]),$O._tempM0.setElementByRowColumn($U,$r,$R),$O._tempM1.setElementByRowColumn($U,$r,Math.abs($R)));$V.getCenter($O._tempV34),this.getCenter($O._tempV36),$RU.subtract($O._tempV34,$O._tempV36,$O._tempV30);var $T=$O._tempV31.elements;$T[0]=$RU.dot($O._tempV30,$O._rows1[0]),$T[1]=$RU.dot($O._tempV30,$O._rows1[1]),$T[2]=$RU.dot($O._tempV30,$O._rows1[2]);var $N=$O._tempV32.elements,$t=$O._tempV33.elements;for($U=0;$U<3;$U++)if($N[0]=$O._tempM1.getElementByRowColumn($U,0),$N[1]=$O._tempM1.getElementByRowColumn($U,1),$N[2]=$O._tempM1.getElementByRowColumn($U,2),$p[$U]+$RU.dot($O._tempV35,$O._tempV32)<Math.abs($T[$U]))return 0;for($r=0;$r<3;$r++)if($N[0]=$O._tempM1.getElementByRowColumn(0,$r),$N[1]=$O._tempM1.getElementByRowColumn(1,$r),$N[2]=$O._tempM1.getElementByRowColumn(2,$r),$t[0]=$O._tempM0.getElementByRowColumn(0,$r),$t[1]=$O._tempM0.getElementByRowColumn(1,$r),$t[2]=$O._tempM0.getElementByRowColumn(2,$r),$RU.dot(this.extents,$O._tempV32)+$c[$r]<Math.abs($RU.dot($O._tempV31,$O._tempV33)))return 0;for($U=0;$U<3;$U++)for($r=0;$r<3;$r++){var $b=($U+1)%3,$S=($U+2)%3,$_=($r+1)%3,$G=($r+2)%3;if($p[$b]*$O._tempM1.getElementByRowColumn($S,$r)+$p[$S]*$O._tempM1.getElementByRowColumn($b,$r)+($c[$_]*$O._tempM1.getElementByRowColumn($U,$G)+$c[$G]*$O._tempM1.getElementByRowColumn($U,$_))<Math.abs($T[$S]*$O._tempM0.getElementByRowColumn($b,$r)-$T[$b]*$O._tempM0.getElementByRowColumn($S,$r)))return 0}return 2},$V.containsLine=function($V,$U){$O._corners[0]=$V,$O._corners[1]=$U;var $r=this.containsPoints($O._corners);if(0!=$r)return $r;var $s=this.extents.elements,$p=$s[0],$c=$s[1],$R=$s[2];this.transformation.invert($O._tempM0),$RU.transformCoordinate($V,$O._tempM0,$O._tempV30),$RU.transformCoordinate($U,$O._tempM0,$O._tempV31),$RU.add($O._tempV30,$O._tempV31,$O._tempV32),$RU.scale($O._tempV32,.5,$O._tempV32),$RU.subtract($O._tempV30,$O._tempV32,$O._tempV33);var $T=$O._tempV33.elements,$N=$T[0],$t=$T[1],$b=$T[2],$S=$O._tempV34.elements,$_=$S[0]=Math.abs($T[0]),$G=$S[1]=Math.abs($T[1]),$q=$S[2]=Math.abs($T[2]),$u=$O._tempV32.elements,$h=$u[0],$l=$u[1],$W=$u[2];return Math.abs($h)>$p+$_?0:Math.abs($l)>$c+$G?0:Math.abs($W)>$R+$q?0:Math.abs($l*$b-$W*$t)>$c*$q+$R*$G?0:Math.abs($h*$b-$W*$N)>$p*$q+$R*$_?0:Math.abs($h*$t-$l*$N)>$p*$G+$c*$_?0:2},$V.containsBoundBox=function($V){var $U=0,$r=0,$s=$V.min,$p=$V.max;$V.getCorners($O._corners);var $c=this.containsPoints($O._corners);if(0!=$c)return $c;$RU.subtract($p,$s,$O._tempV30),$RU.scale($O._tempV30,.5,$O._tempV30),$RU.add($s,$O._tempV30,$O._tempV30),$RU.subtract($p,$O._tempV30,$O._tempV31);var $R=this.extents.elements,$T=$O._tempV31.elements;$O._getRows(this.transformation,$O._rows1),this.transformation.invert($O._tempM0);for($U=0;$U<3;$U++)for($r=0;$r<3;$r++)$O._tempM1.setElementByRowColumn($U,$r,Math.abs($O._tempM0.getElementByRowColumn($U,$r)));this.getCenter($O._tempV35),$RU.subtract($O._tempV30,$O._tempV35,$O._tempV32);var $N=$O._tempV31.elements;$N[0]=$RU.dot($O._tempV32,$O._rows1[0]),$N[1]=$RU.dot($O._tempV32,$O._rows1[1]),$N[2]=$RU.dot($O._tempV32,$O._rows1[2]);var $t=$O._tempV33.elements,$b=$O._tempV34.elements;for($U=0;$U<3;$U++)if($t[0]=$O._tempM1.getElementByRowColumn($U,0),$t[1]=$O._tempM1.getElementByRowColumn($U,1),$t[2]=$O._tempM1.getElementByRowColumn($U,2),$R[$U]+$RU.dot($O._tempV31,$O._tempV33)<Math.abs($N[$U]))return 0;for($r=0;$r<3;$r++)if($t[0]=$O._tempM1.getElementByRowColumn(0,$r),$t[1]=$O._tempM1.getElementByRowColumn(1,$r),$t[2]=$O._tempM1.getElementByRowColumn(2,$r),$b[0]=$O._tempM0.getElementByRowColumn(0,$r),$b[1]=$O._tempM0.getElementByRowColumn(1,$r),$b[2]=$O._tempM0.getElementByRowColumn(2,$r),$RU.dot(this.extents,$O._tempV33)+$T[$r]<Math.abs($RU.dot($O._tempV31,$O._tempV34)))return 0;for($U=0;$U<3;$U++)for($r=0;$r<3;$r++){var $S=($U+1)%3,$_=($U+2)%3,$G=($r+1)%3,$q=($r+2)%3;if($R[$S]*$O._tempM1.getElementByRowColumn($_,$r)+$R[$_]*$O._tempM1.getElementByRowColumn($S,$r)+($T[$G]*$O._tempM1.getElementByRowColumn($U,$q)+$T[$q]*$O._tempM1.getElementByRowColumn($U,$G))<Math.abs($N[$_]*$O._tempM0.getElementByRowColumn($S,$r)-$N[$S]*$O._tempM0.getElementByRowColumn($_,$r)))return 0}return 2},$V.intersectsRay=function($V,$U){$RU.scale(this.extents,-1,$O._tempV30),this.transformation.invert($O._tempM0),$RU.TransformNormal($V.direction,$O._tempM0,$O._ray.direction),$RU.transformCoordinate($V.origin,$O._tempM0,$O._ray.origin),$O._boxBound1.min=$O._tempV30,$O._boxBound1.max=this.extents;var $r=Collision.intersectsRayAndBoxRP($O._ray,$O._boxBound1,$U);return-1!==$r&&$RU.transformCoordinate($U,this.transformation,$U),$r},$V._getLocalCorners=function($V){$V.length=8;var $U=this.extents.elements;$O._tempV30.x=$U[0],$O._tempV31.y=$U[1],$O._tempV32.z=$U[2],$RU.add($O._tempV30,$O._tempV31,$O._tempV33),$RU.add($O._tempV33,$O._tempV32,$V[0]),$RU.add($O._tempV30,$O._tempV31,$O._tempV33),$RU.subtract($O._tempV33,$O._tempV32,$V[1]),$RU.subtract($O._tempV31,$O._tempV30,$O._tempV33),$RU.subtract($O._tempV33,$O._tempV30,$V[2]),$RU.subtract($O._tempV31,$O._tempV30,$O._tempV33),$RU.add($O._tempV33,$O._tempV32,$V[3]),$RU.subtract($O._tempV30,$O._tempV31,$O._tempV33),$RU.add($O._tempV33,$O._tempV32,$V[4]),$RU.subtract($O._tempV30,$O._tempV31,$O._tempV33),$RU.subtract($O._tempV33,$O._tempV32,$V[5]),$RU.scale($V[0],-1,$V[6]),$RU.subtract($O._tempV32,$O._tempV30,$O._tempV33),$RU.subtract($O._tempV33,$O._tempV31,$V[7])},$V.equals=function($V){return this.extents==$V.extents&&this.transformation==$V.transformation},$V.cloneTo=function($V){var $U=$V;this.extents.cloneTo($U.extents),this.transformation.cloneTo($U.transformation)},$O.createByBoundBox=function($V,$U){var $r=$V.min,$s=$V.max;$RU.subtract($s,$r,$O._tempV30),$RU.scale($O._tempV30,.5,$O._tempV30),$RU.add($r,$O._tempV30,$O._tempV31),$RU.subtract($s,$O._tempV31,$O._tempV32),$VU.translation($O._tempV31,$O._tempM0);var $p=$O._tempV32.clone(),$c=$O._tempM0.clone();$U.extents=$p,$U.transformation=$c},$O.createByMinAndMaxVertex=function($V,$U){return $RU.subtract($U,$V,$O._tempV30),$RU.scale($O._tempV30,.5,$O._tempV30),$RU.add($V,$O._tempV30,$O._tempV31),$RU.subtract($U,$O._tempV31,$O._tempV32),$VU.translation($O._tempV31,$O._tempM0),new $O($O._tempV32,$O._tempM0)},$O._getRows=function($V,$U){$U.length=3;var $r=$V.elements,$s=$U[0].elements;$s[0]=$r[0],$s[1]=$r[1],$s[2]=$r[2];var $p=$U[1].elements;$p[0]=$r[4],$p[1]=$r[5],$p[2]=$r[6];var $c=$U[2].elements;$c[0]=$r[8],$c[1]=$r[9],$c[2]=$r[10]},$O.getObbtoObbMatrix4x4=function($V,$U,$r,$s){var $p=$V.transformation,$c=$U.transformation;if($r){$O._getRows($p,$O._rows1),$O._getRows($c,$O._rows2);for(var $R=0;$R<3;$R++)for(var $T=0;$T<3;$T++)$s.setElementByRowColumn($R,$T,$RU.dot($O._rows2[$R],$O._rows1[$T]));$U.getCenter($O._tempV30),$V.getCenter($O._tempV31),$RU.subtract($O._tempV30,$O._tempV31,$O._tempV32);var $N=$s.elements;$N[12]=$RU.dot($O._tempV32,$O._rows1[0]),$N[13]=$RU.dot($O._tempV32,$O._rows1[1]),$N[14]=$RU.dot($O._tempV32,$O._rows1[2]),$N[15]=1}else $p.invert($O._tempM0),$VU.multiply($c,$O._tempM0,$s)},$O.merge=function($V,$U,$r){var $s=$V.extents,$p=$V.transformation;$O.getObbtoObbMatrix4x4($V,$U,$r,$O._tempM0),$U._getLocalCorners($O._corners),$RU.transformCoordinate($O._corners[0],$O._tempM0,$O._corners[0]),$RU.transformCoordinate($O._corners[1],$O._tempM0,$O._corners[1]),$RU.transformCoordinate($O._corners[2],$O._tempM0,$O._corners[2]),$RU.transformCoordinate($O._corners[3],$O._tempM0,$O._corners[3]),$RU.transformCoordinate($O._corners[4],$O._tempM0,$O._corners[4]),$RU.transformCoordinate($O._corners[5],$O._tempM0,$O._corners[5]),$RU.transformCoordinate($O._corners[6],$O._tempM0,$O._corners[6]),$RU.transformCoordinate($O._corners[7],$O._tempM0,$O._corners[7]),$RU.scale($s,-1,$O._boxBound1.min),$s.cloneTo($O._boxBound1.max),$gV.createfromPoints($O._corners,$O._boxBound2),$gV.merge($O._boxBound2,$O._boxBound1,$O._boxBound3);var $c=$O._boxBound3.min,$R=$O._boxBound3.max;$RU.subtract($R,$c,$O._tempV30),$RU.scale($O._tempV30,.5,$O._tempV30),$RU.add($c,$O._tempV30,$O._tempV32),$RU.subtract($R,$O._tempV32,$s),$RU.transformCoordinate($O._tempV32,$p,$O._tempV33)},$S($O,["_tempV30",function(){return this._tempV30=new $RU},"_tempV31",function(){return this._tempV31=new $RU},"_tempV32",function(){return this._tempV32=new $RU},"_tempV33",function(){return this._tempV33=new $RU},"_tempV34",function(){return this._tempV34=new $RU},"_tempV35",function(){return this._tempV35=new $RU},"_tempV36",function(){return this._tempV36=new $RU},"_tempM0",function(){return this._tempM0=new $VU},"_tempM1",function(){return this._tempM1=new $VU},"_corners",function(){return this._corners=[new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU]},"_rows1",function(){return this._rows1=[new $RU,new $RU,new $RU]},"_rows2",function(){return this._rows2=[new $RU,new $RU,new $RU]},"_ray",function(){return this._ray=new $pU(new $RU,new $RU)},"_boxBound1",function(){return this._boxBound1=new $gV(new $RU,new $RU)},"_boxBound2",function(){return this._boxBound2=new $gV(new $RU,new $RU)},"_boxBound3",function(){return this._boxBound3=new $gV(new $RU,new $RU)}])}(),function(){function $d($V,$U){this.normal=null,this.distance=NaN,void 0===$U&&($U=0),this.normal=$V,this.distance=$U}return $G($d,"laya.d3.math.Plane"),$d.prototype.normalize=function(){var $V=this.normal.elements,$U=$V[0],$r=$V[1],$s=$V[2],$p=1/Math.sqrt($U*$U+$r*$r+$s*$s);$V[0]=$U*$p,$V[1]=$r*$p,$V[2]=$s*$p,this.distance*=$p},$d.createPlaneBy3P=function($V,$U,$r){var $s=$V.elements,$p=$U.elements,$c=$r.elements,$R=$p[0]-$s[0],$T=$p[1]-$s[1],$N=$p[2]-$s[2],$t=$c[0]-$s[0],$b=$c[1]-$s[1],$S=$c[2]-$s[2],$_=$T*$S-$N*$b,$G=$N*$t-$R*$S,$q=$R*$b-$T*$t,$u=1/Math.sqrt($_*$_+$G*$G+$q*$q),$h=$_*$u,$l=$G*$u,$W=$q*$u,$O=$d._TEMPVec3.elements;$O[0]=$h,$O[1]=$l,$O[2]=$W;var $L=-($h*$s[0]+$l*$s[1]+$W*$s[2]);return new $d($d._TEMPVec3,$L)},$d.PlaneIntersectionType_Back=0,$d.PlaneIntersectionType_Front=1,$d.PlaneIntersectionType_Intersecting=2,$S($d,["_TEMPVec3",function(){return this._TEMPVec3=new $RU}]),$d}()),$rU=function(){function $p($V,$U,$r,$s){this.elements=new Float32Array(4),void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=1),this.elements[0]=$V,this.elements[1]=$U,this.elements[2]=$r,this.elements[3]=$s}$G($p,"laya.d3.math.Quaternion");var $V=$p.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.scaling=function($V,$U){var $r=$U.elements,$s=this.elements;$r[0]=$s[0]*$V,$r[1]=$s[1]*$V,$r[2]=$s[2]*$V,$r[3]=$s[3]*$V},$V.normalize=function($V){var $U=$V.elements,$r=this.elements,$s=$r[0],$p=$r[1],$c=$r[2],$R=$r[3],$T=$s*$s+$p*$p+$c*$c+$R*$R;0<$T&&($T=1/Math.sqrt($T),$U[0]=$s*$T,$U[1]=$p*$T,$U[2]=$c*$T,$U[3]=$R*$T)},$V.length=function(){var $V=this.elements,$U=$V[0],$r=$V[1],$s=$V[2],$p=$V[3];return Math.sqrt($U*$U+$r*$r+$s*$s+$p*$p)},$V.rotateX=function($V,$U){var $r=$U.elements,$s=this.elements;$V*=.5;var $p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=Math.sin($V),$t=Math.cos($V);$r[0]=$p*$t+$T*$N,$r[1]=$c*$t+$R*$N,$r[2]=$R*$t-$c*$N,$r[3]=$T*$t-$p*$N},$V.rotateY=function($V,$U){var $r=$U.elements,$s=this.elements;$V*=.5;var $p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=Math.sin($V),$t=Math.cos($V);$r[0]=$p*$t-$R*$N,$r[1]=$c*$t+$T*$N,$r[2]=$R*$t+$p*$N,$r[3]=$T*$t-$c*$N},$V.rotateZ=function($V,$U){var $r=$U.elements,$s=this.elements;$V*=.5;var $p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=Math.sin($V),$t=Math.cos($V);$r[0]=$p*$t+$c*$N,$r[1]=$c*$t-$p*$N,$r[2]=$R*$t+$T*$N,$r[3]=$T*$t-$R*$N},$V.getYawPitchRoll=function($V){$RU.transformQuat($RU.ForwardRH,this,$p.TEMPVector31),$RU.transformQuat($RU.Up,this,$p.TEMPVector32);var $U=$p.TEMPVector32.elements;$p.angleTo($RU.ZERO,$p.TEMPVector31,$p.TEMPVector33);var $r=$p.TEMPVector33.elements;$r[0]==Math.PI/2?($r[1]=$p.arcTanAngle($U[2],$U[0]),$r[2]=0):$r[0]==-Math.PI/2?($r[1]=$p.arcTanAngle(-$U[2],-$U[0]),$r[2]=0):($VU.createRotationY(-$r[1],$p.TEMPMatrix0),$VU.createRotationX(-$r[0],$p.TEMPMatrix1),$RU.transformCoordinate($p.TEMPVector32,$p.TEMPMatrix0,$p.TEMPVector32),$RU.transformCoordinate($p.TEMPVector32,$p.TEMPMatrix1,$p.TEMPVector32),$r[2]=$p.arcTanAngle($U[1],-$U[0])),$r[1]<=-Math.PI&&($r[1]=Math.PI),$r[2]<=-Math.PI&&($r[2]=Math.PI),$r[1]>=Math.PI&&$r[2]>=Math.PI&&($r[1]=0,$r[2]=0,$r[0]=Math.PI-$r[0]);var $s=$V.elements;$s[0]=$r[1],$s[1]=$r[0],$s[2]=$r[2]},$V.invert=function($V){var $U=$V.elements,$r=this.elements,$s=$r[0],$p=$r[1],$c=$r[2],$R=$r[3],$T=$s*$s+$p*$p+$c*$c+$R*$R,$N=$T?1/$T:0;$U[0]=-$s*$N,$U[1]=-$p*$N,$U[2]=-$c*$N,$U[3]=$R*$N},$V.identity=function(){var $V=this.elements;$V[0]=0,$V[1]=0,$V[2]=0,$V[3]=1},$V.fromArray=function($V,$U){void 0===$U&&($U=0),this.elements[0]=$V[$U+0],this.elements[1]=$V[$U+1],this.elements[2]=$V[$U+2],this.elements[3]=$V[$U+3]},$V.cloneTo=function($V){var $U,$r,$s;if(($r=this.elements)!==($s=$V.elements))for($U=0;$U<4;++$U)$s[$U]=$r[$U]},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$V.equals=function($V){var $U=this.elements,$r=$V.elements;return $CV.nearEqual($U[0],$r[0])&&$CV.nearEqual($U[1],$r[1])&&$CV.nearEqual($U[2],$r[2])&&$CV.nearEqual($U[3],$r[3])},$V.lengthSquared=function(){var $V=this.elements[0],$U=this.elements[1],$r=this.elements[2],$s=this.elements[3];return $V*$V+$U*$U+$r*$r+$s*$s},$q(0,$V,"x",function(){return this.elements[0]}),$q(0,$V,"y",function(){return this.elements[1]}),$q(0,$V,"z",function(){return this.elements[2]}),$q(0,$V,"w",function(){return this.elements[3]}),$p.createFromYawPitchRoll=function($V,$U,$r,$s){var $p=.5*$r,$c=.5*$U,$R=.5*$V,$T=Math.sin($p),$N=Math.cos($p),$t=Math.sin($c),$b=Math.cos($c),$S=Math.sin($R),$_=Math.cos($R),$G=$s.elements;$G[0]=$_*$t*$N+$S*$b*$T,$G[1]=$S*$b*$N-$_*$t*$T,$G[2]=$_*$b*$T-$S*$t*$N,$G[3]=$_*$b*$N+$S*$t*$T},$p.multiply=function($V,$U,$r){var $s=$V.elements,$p=$U.elements,$c=$r.elements,$R=$s[0],$T=$s[1],$N=$s[2],$t=$s[3],$b=$p[0],$S=$p[1],$_=$p[2],$G=$p[3],$q=$T*$_-$N*$S,$u=$N*$b-$R*$_,$h=$R*$S-$T*$b,$l=$R*$b+$T*$S+$N*$_;$c[0]=$R*$G+$b*$t+$q,$c[1]=$T*$G+$S*$t+$u,$c[2]=$N*$G+$_*$t+$h,$c[3]=$t*$G-$l},$p.arcTanAngle=function($V,$U){return 0==$V?1==$U?Math.PI/2:-Math.PI/2:0<$V?Math.atan($U/$V):$V<0?0<$U?Math.atan($U/$V)+Math.PI:Math.atan($U/$V)-Math.PI:0},$p.angleTo=function($V,$U,$r){$RU.subtract($U,$V,$p.TEMPVector30),$RU.normalize($p.TEMPVector30,$p.TEMPVector30),$r.elements[0]=Math.asin($p.TEMPVector30.y),$r.elements[1]=$p.arcTanAngle(-$p.TEMPVector30.z,-$p.TEMPVector30.x)},$p.createFromAxisAngle=function($V,$U,$r){var $s=$r.elements,$p=$V.elements;$U*=.5;var $c=Math.sin($U);$s[0]=$c*$p[0],$s[1]=$c*$p[1],$s[2]=$c*$p[2],$s[3]=Math.cos($U)},$p.createFromMatrix3x3=function($V,$U){var $r,$s=$U.elements,$p=$V.elements,$c=$p[0]+$p[4]+$p[8];if(0<$c)$r=Math.sqrt($c+1),$s[3]=.5*$r,$r=.5/$r,$s[0]=($p[5]-$p[7])*$r,$s[1]=($p[6]-$p[2])*$r,$s[2]=($p[1]-$p[3])*$r;else{var $R=0;$p[4]>$p[0]&&($R=1),$p[8]>$p[3*$R+$R]&&($R=2);var $T=($R+1)%3,$N=($R+2)%3;$r=Math.sqrt($p[3*$R+$R]-$p[3*$T+$T]-$p[3*$N+$N]+1),$s[$R]=.5*$r,$r=.5/$r,$s[3]=($p[3*$T+$N]-$p[3*$N+$T])*$r,$s[$T]=($p[3*$T+$R]+$p[3*$R+$T])*$r,$s[$N]=($p[3*$N+$R]+$p[3*$R+$N])*$r}},$p.createFromMatrix4x4=function($V,$U){var $r,$s,$p=$V.elements,$c=$U.elements,$R=$p[0]+$p[5]+$p[10];0<$R?($r=Math.sqrt($R+1),$c[3]=.5*$r,$r=.5/$r,$c[0]=($p[6]-$p[9])*$r,$c[1]=($p[8]-$p[2])*$r,$c[2]=($p[1]-$p[4])*$r):$p[0]>=$p[5]&&$p[0]>=$p[10]?($s=.5/($r=Math.sqrt(1+$p[0]-$p[5]-$p[10])),$c[0]=.5*$r,$c[1]=($p[1]+$p[4])*$s,$c[2]=($p[2]+$p[8])*$s,$c[3]=($p[6]-$p[9])*$s):$p[5]>$p[10]?($s=.5/($r=Math.sqrt(1+$p[5]-$p[0]-$p[10])),$c[0]=($p[4]+$p[1])*$s,$c[1]=.5*$r,$c[2]=($p[9]+$p[6])*$s,$c[3]=($p[8]-$p[2])*$s):($s=.5/($r=Math.sqrt(1+$p[10]-$p[0]-$p[5])),$c[0]=($p[8]+$p[2])*$s,$c[1]=($p[9]+$p[6])*$s,$c[2]=.5*$r,$c[3]=($p[1]-$p[4])*$s)},$p.slerp=function($V,$U,$r,$s){var $p,$c,$R,$T,$N,$t=$V.elements,$b=$U.elements,$S=$s.elements,$_=$t[0],$G=$t[1],$q=$t[2],$u=$t[3],$h=$b[0],$l=$b[1],$W=$b[2],$O=$b[3];return($c=$_*$h+$G*$l+$q*$W+$u*$O)<0&&($c=-$c,$h=-$h,$l=-$l,$W=-$W,$O=-$O),$N=1e-6<1-$c?($p=Math.acos($c),$R=Math.sin($p),$T=Math.sin((1-$r)*$p)/$R,Math.sin($r*$p)/$R):($T=1-$r,$r),$S[0]=$T*$_+$N*$h,$S[1]=$T*$G+$N*$l,$S[2]=$T*$q+$N*$W,$S[3]=$T*$u+$N*$O,$S},$p.lerp=function($V,$U,$r,$s){var $p=$s.elements,$c=$V.elements,$R=$U.elements,$T=$c[0],$N=$c[1],$t=$c[2],$b=$c[3];$p[0]=$T+$r*($R[0]-$T),$p[1]=$N+$r*($R[1]-$N),$p[2]=$t+$r*($R[2]-$t),$p[3]=$b+$r*($R[3]-$b)},$p.add=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]+$c[0],$s[1]=$p[1]+$c[1],$s[2]=$p[2]+$c[2],$s[3]=$p[3]+$c[3]},$p.dot=function($V,$U){var $r=$V.elements,$s=$U.elements;return $r[0]*$s[0]+$r[1]*$s[1]+$r[2]*$s[2]+$r[3]*$s[3]},$p.rotationLookAt=function($V,$U,$r){$p.lookAt($RU.ZERO,$V,$U,$r)},$p.lookAt=function($V,$U,$r,$s){$fV.lookAt($V,$U,$r,$p._tempMatrix3x3),$p.rotationMatrix($p._tempMatrix3x3,$s)},$p.invert=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$V.lengthSquared();$CV.isZero($p)||($p=1/$p,$s[0]=-$r[0]*$p,$s[1]=-$r[1]*$p,$s[2]=-$r[2]*$p,$s[3]=$r[3]*$p)},$p.rotationMatrix=function($V,$U){var $r=$V.elements,$s=$r[0],$p=$r[1],$c=$r[2],$R=$r[3],$T=$r[4],$N=$r[5],$t=$r[6],$b=$r[7],$S=$r[8],$_=$U.elements,$G=NaN,$q=NaN,$u=$s+$T+$S;0<$u?($G=Math.sqrt($u+1),$_[3]=.5*$G,$G=.5/$G,$_[0]=($N-$b)*$G,$_[1]=($t-$c)*$G,$_[2]=($p-$R)*$G):$T<=$s&&$S<=$s?($q=.5/($G=Math.sqrt(1+$s-$T-$S)),$_[0]=.5*$G,$_[1]=($p+$R)*$q,$_[2]=($c+$t)*$q,$_[3]=($N-$b)*$q):$S<$T?($q=.5/($G=Math.sqrt(1+$T-$s-$S)),$_[0]=($R+$p)*$q,$_[1]=.5*$G,$_[2]=($b+$N)*$q,$_[3]=($t-$c)*$q):($q=.5/($G=Math.sqrt(1+$S-$s-$T)),$_[0]=($t+$c)*$q,$_[1]=($b+$N)*$q,$_[2]=.5*$G,$_[3]=($p-$R)*$q)},$p.DEFAULT=new $p,$S($p,["TEMPVector30",function(){return this.TEMPVector30=new $RU},"TEMPVector31",function(){return this.TEMPVector31=new $RU},"TEMPVector32",function(){return this.TEMPVector32=new $RU},"TEMPVector33",function(){return this.TEMPVector33=new $RU},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $VU},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $VU},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $fV},"NAN",function(){return this.NAN=new $p(NaN,NaN,NaN,NaN)}]),$p}(),$sU=function(){function $V($V){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$V,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$G($V,"laya.d3.math.Rand");var $U=$V.prototype;return $U.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$U.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$U.getSignedFloat=function(){return 2*this.getFloat()-1},$q(0,$U,"seed",function(){return this.seeds[0]},function($V){this.seeds[0]=$V,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$V.getFloatFromInt=function($V){return 1/8388607*(8388607&$V)},$V.getByteFromInt=function($V){return(8388607&$V)>>>15},$V}(),$pU=(function(){function $p($V){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($V instanceof Array)||4!==$V.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$V[0],this._state0L=0|$V[1],this._state1U=0|$V[2],this._state1L=0|$V[3]}$G($p,"laya.d3.math.RandX");var $V=$p.prototype;$V.randomint=function(){var $V=this._state0U,$U=this._state0L,$r=this._state1U,$s=this._state1L,$p=($s>>>0)+($U>>>0),$c=$r+$V+($p/2>>>31)>>>0,$R=$p>>>0,$T=0,$N=0;$T=($V^=$T=$V<<23|(-512&$U)>>>9)^(this._state0U=$r),$N=($U^=$N=$U<<23)^(this._state0L=$s);$T^=$V>>>18,$N^=$U>>>18|(262143&$V)<<14;return $T^=$r>>>5,$N^=$s>>>5|(31&$r)<<27,this._state1U=$T,this._state1L=$N,[$c,$R]},$V.random=function(){var $V=this.randomint(),$U=$V[0],$r=1023<<20|$U>>>12,$s=0|($V[1]>>>12|(4095&$U)<<20);return $p._CONVERTION_BUFFER.setUint32(0,$r,!1),$p._CONVERTION_BUFFER.setUint32(4,$s,!1),$sU._CONVERTION_BUFFER.getFloat64(0,!1)-1},$S($p,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $sU([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $V($V,$U){this.origin=null,this.direction=null,this.origin=$V,this.direction=$U}return $G($V,"laya.d3.math.Ray"),$V}()),$cU=function(){function $V($V,$U){this.elements=new Float32Array(2),void 0===$V&&($V=0),void 0===$U&&($U=0);var $r=this.elements;$r[0]=$V,$r[1]=$U}$G($V,"laya.d3.math.Vector2");var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.IClone":!0}),$U.fromArray=function($V,$U){void 0===$U&&($U=0),this.elements[0]=$V[$U+0],this.elements[1]=$V[$U+1]},$U.cloneTo=function($V){var $U=$V.elements,$r=this.elements;$U[0]=$r[0],$U[1]=$r[1]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"x",function(){return this.elements[0]},function($V){this.elements[0]=$V}),$q(0,$U,"y",function(){return this.elements[1]},function($V){this.elements[1]=$V}),$V.scale=function($V,$U,$r){var $s=$r.elements,$p=$V.elements;$s[0]=$p[0]*$U,$s[1]=$p[1]*$U},$S($V,["ZERO",function(){return this.ZERO=new $V(0,0)},"ONE",function(){return this.ONE=new $V(1,1)}]),$V}(),$RU=function(){function $b($V,$U,$r){this.elements=new Float32Array(3),void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0);var $s=this.elements;$s[0]=$V,$s[1]=$U,$s[2]=$r}$G($b,"laya.d3.math.Vector3");var $V=$b.prototype;return $d.imps($V,{"laya.d3.core.IClone":!0}),$V.fromArray=function($V,$U){void 0===$U&&($U=0),this.elements[0]=$V[$U+0],this.elements[1]=$V[$U+1],this.elements[2]=$V[$U+2]},$V.cloneTo=function($V){var $U=$V.elements,$r=this.elements;$U[0]=$r[0],$U[1]=$r[1],$U[2]=$r[2]},$V.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$V.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$V.reset=function($V,$U,$r){this.elements[0]=$V,this.elements[1]=$U,this.elements[2]=$r},$q(0,$V,"x",function(){return this.elements[0]},function($V){this.elements[0]=$V}),$q(0,$V,"y",function(){return this.elements[1]},function($V){this.elements[1]=$V}),$q(0,$V,"z",function(){return this.elements[2]},function($V){this.elements[2]=$V}),$b.distanceSquared=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0]-$s[0],$c=$r[1]-$s[1],$R=$r[2]-$s[2];return $p*$p+$c*$c+$R*$R},$b.distance=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0]-$s[0],$c=$r[1]-$s[1],$R=$r[2]-$s[2];return Math.sqrt($p*$p+$c*$c+$R*$R)},$b.min=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=Math.min($p[0],$c[0]),$s[1]=Math.min($p[1],$c[1]),$s[2]=Math.min($p[2],$c[2])},$b.max=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=Math.max($p[0],$c[0]),$s[1]=Math.max($p[1],$c[1]),$s[2]=Math.max($p[2],$c[2])},$b.transformQuat=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements,$R=$p[0],$T=$p[1],$N=$p[2],$t=$c[0],$b=$c[1],$S=$c[2],$_=$c[3],$G=$_*$R+$b*$N-$S*$T,$q=$_*$T+$S*$R-$t*$N,$u=$_*$N+$t*$T-$b*$R,$h=-$t*$R-$b*$T-$S*$N;$s[0]=$G*$_+$h*-$t+$q*-$S-$u*-$b,$s[1]=$q*$_+$h*-$b+$u*-$t-$G*-$S,$s[2]=$u*$_+$h*-$S+$G*-$b-$q*-$t},$b.scalarLength=function($V){var $U=$V.elements,$r=$U[0],$s=$U[1],$p=$U[2];return Math.sqrt($r*$r+$s*$s+$p*$p)},$b.scalarLengthSquared=function($V){var $U=$V.elements,$r=$U[0],$s=$U[1],$p=$U[2];return $r*$r+$s*$s+$p*$p},$b.normalize=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0],$c=$r[1],$R=$r[2],$T=$p*$p+$c*$c+$R*$R;0<$T&&($T=1/Math.sqrt($T),$s[0]=$r[0]*$T,$s[1]=$r[1]*$T,$s[2]=$r[2]*$T)},$b.multiply=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]*$c[0],$s[1]=$p[1]*$c[1],$s[2]=$p[2]*$c[2]},$b.scale=function($V,$U,$r){var $s=$r.elements,$p=$V.elements;$s[0]=$p[0]*$U,$s[1]=$p[1]*$U,$s[2]=$p[2]*$U},$b.lerp=function($V,$U,$r,$s){var $p=$s.elements,$c=$V.elements,$R=$U.elements,$T=$c[0],$N=$c[1],$t=$c[2];$p[0]=$T+$r*($R[0]-$T),$p[1]=$N+$r*($R[1]-$N),$p[2]=$t+$r*($R[2]-$t)},$b.transformV3ToV3=function($V,$U,$r){var $s=$b._tempVector4;$b.transformV3ToV4($V,$U,$s);var $p=$s.elements,$c=$r.elements;$c[0]=$p[0],$c[1]=$p[1],$c[2]=$p[2]},$b.transformV3ToV4=function($V,$U,$r){var $s=$V.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=$U.elements,$N=$r.elements;$N[0]=$p*$T[0]+$c*$T[4]+$R*$T[8]+$T[12],$N[1]=$p*$T[1]+$c*$T[5]+$R*$T[9]+$T[13],$N[2]=$p*$T[2]+$c*$T[6]+$R*$T[10]+$T[14],$N[3]=$p*$T[3]+$c*$T[7]+$R*$T[11]+$T[15]},$b.TransformNormal=function($V,$U,$r){var $s=$V.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=$U.elements,$N=$r.elements;$N[0]=$p*$T[0]+$c*$T[4]+$R*$T[8],$N[1]=$p*$T[1]+$c*$T[5]+$R*$T[9],$N[2]=$p*$T[2]+$c*$T[6]+$R*$T[10]},$b.transformCoordinate=function($V,$U,$r){var $s=$b._tempVector4.elements,$p=$V.elements,$c=$p[0],$R=$p[1],$T=$p[2],$N=$U.elements;$s[0]=$c*$N[0]+$R*$N[4]+$T*$N[8]+$N[12],$s[1]=$c*$N[1]+$R*$N[5]+$T*$N[9]+$N[13],$s[2]=$c*$N[2]+$R*$N[6]+$T*$N[10]+$N[14],$s[3]=1/($c*$N[3]+$R*$N[7]+$T*$N[11]+$N[15]);var $t=$r.elements;$t[0]=$s[0]*$s[3],$t[1]=$s[1]*$s[3],$t[2]=$s[2]*$s[3]},$b.Clamp=function($V,$U,$r,$s){var $p=$V.elements,$c=$p[0],$R=$p[1],$T=$p[2],$N=$U.elements,$t=$N[0],$b=$N[1],$S=$N[2],$_=$r.elements,$G=$_[0],$q=$_[1],$u=$_[2],$h=$s.elements;$c=($c=$G<$c?$G:$c)<$t?$t:$c,$R=($R=$q<$R?$q:$R)<$b?$b:$R,$T=($T=$u<$T?$u:$T)<$S?$S:$T,$h[0]=$c,$h[1]=$R,$h[2]=$T},$b.add=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]+$c[0],$s[1]=$p[1]+$c[1],$s[2]=$p[2]+$c[2]},$b.subtract=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]-$c[0],$s[1]=$p[1]-$c[1],$s[2]=$p[2]-$c[2]},$b.cross=function($V,$U,$r){var $s=$V.elements,$p=$U.elements,$c=$r.elements,$R=$s[0],$T=$s[1],$N=$s[2],$t=$p[0],$b=$p[1],$S=$p[2];$c[0]=$T*$S-$N*$b,$c[1]=$N*$t-$R*$S,$c[2]=$R*$b-$T*$t},$b.dot=function($V,$U){var $r=$V.elements,$s=$U.elements;return $r[0]*$s[0]+$r[1]*$s[1]+$r[2]*$s[2]},$b.equals=function($V,$U){var $r=$V.elements,$s=$U.elements;return $CV.nearEqual(Math.abs($r[0]),Math.abs($s[0]))&&$CV.nearEqual(Math.abs($r[1]),Math.abs($s[1]))&&$CV.nearEqual(Math.abs($r[2]),Math.abs($s[2]))},$b.ZERO=new $b(0,0,0),$b.ONE=new $b(1,1,1),$b.NegativeUnitX=new $b(-1,0,0),$b.UnitX=new $b(1,0,0),$b.UnitY=new $b(0,1,0),$b.UnitZ=new $b(0,0,1),$b.ForwardRH=new $b(0,0,-1),$b.ForwardLH=new $b(0,0,1),$b.Up=new $b(0,1,0),$b.NAN=new $b(NaN,NaN,NaN),$S($b,["_tempVector4",function(){return this._tempVector4=new $TU}]),$b}(),$TU=function(){function $V($V,$U,$r,$s){this.elements=new Float32Array(4),void 0===$V&&($V=0),void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=0);var $p=this.elements;$p[0]=$V,$p[1]=$U,$p[2]=$r,$p[3]=$s}$G($V,"laya.d3.math.Vector4");var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.IClone":!0}),$U.fromArray=function($V,$U){void 0===$U&&($U=0),this.elements[0]=$V[$U+0],this.elements[1]=$V[$U+1],this.elements[2]=$V[$U+2],this.elements[3]=$V[$U+3]},$U.cloneTo=function($V){var $U=$V.elements,$r=this.elements;$U[0]=$r[0],$U[1]=$r[1],$U[2]=$r[2],$U[3]=$r[3]},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$U.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$U.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$q(0,$U,"x",function(){return this.elements[0]},function($V){this.elements[0]=$V}),$q(0,$U,"y",function(){return this.elements[1]},function($V){this.elements[1]=$V}),$q(0,$U,"z",function(){return this.elements[2]},function($V){this.elements[2]=$V}),$q(0,$U,"w",function(){return this.elements[3]},function($V){this.elements[3]=$V}),$V.lerp=function($V,$U,$r,$s){var $p=$s.elements,$c=$V.elements,$R=$U.elements,$T=$c[0],$N=$c[1],$t=$c[2],$b=$c[3];$p[0]=$T+$r*($R[0]-$T),$p[1]=$N+$r*($R[1]-$N),$p[2]=$t+$r*($R[2]-$t),$p[3]=$b+$r*($R[3]-$b)},$V.transformByM4x4=function($V,$U,$r){var $s=$V.elements,$p=$s[0],$c=$s[1],$R=$s[2],$T=$s[3],$N=$U.elements,$t=$r.elements;$t[0]=$p*$N[0]+$c*$N[4]+$R*$N[8]+$T*$N[12],$t[1]=$p*$N[1]+$c*$N[5]+$R*$N[9]+$T*$N[13],$t[2]=$p*$N[2]+$c*$N[6]+$R*$N[10]+$T*$N[14],$t[3]=$p*$N[3]+$c*$N[7]+$R*$N[11]+$T*$N[15]},$V.equals=function($V,$U){var $r=$V.elements,$s=$U.elements;return $CV.nearEqual(Math.abs($r[0]),Math.abs($s[0]))&&$CV.nearEqual(Math.abs($r[1]),Math.abs($s[1]))&&$CV.nearEqual(Math.abs($r[2]),Math.abs($s[2]))&&$CV.nearEqual(Math.abs($r[3]),Math.abs($s[3]))},$V.normalize=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$V.length();0<$p&&($s[0]=$r[0]*$p,$s[1]=$r[1]*$p,$s[2]=$r[2]*$p,$s[3]=$r[3]*$p)},$V.add=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]+$c[0],$s[1]=$p[1]+$c[1],$s[2]=$p[2]+$c[2],$s[3]=$p[3]+$c[3]},$V.subtract=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]-$c[0],$s[1]=$p[1]-$c[1],$s[2]=$p[2]-$c[2],$s[3]=$p[3]-$c[3]},$V.multiply=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=$p[0]*$c[0],$s[1]=$p[1]*$c[1],$s[2]=$p[2]*$c[2],$s[3]=$p[3]*$c[3]},$V.scale=function($V,$U,$r){var $s=$r.elements,$p=$V.elements;$s[0]=$p[0]*$U,$s[1]=$p[1]*$U,$s[2]=$p[2]*$U,$s[3]=$p[3]*$U},$V.Clamp=function($V,$U,$r,$s){var $p=$V.elements,$c=$p[0],$R=$p[1],$T=$p[2],$N=$p[3],$t=$U.elements,$b=$t[0],$S=$t[1],$_=$t[2],$G=$t[3],$q=$r.elements,$u=$q[0],$h=$q[1],$l=$q[2],$W=$q[3],$O=$s.elements;$c=($c=$u<$c?$u:$c)<$b?$b:$c,$R=($R=$h<$R?$h:$R)<$S?$S:$R,$T=($T=$l<$T?$l:$T)<$_?$_:$T,$N=($N=$W<$N?$W:$N)<$G?$G:$N,$O[0]=$c,$O[1]=$R,$O[2]=$T,$O[3]=$N},$V.distanceSquared=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0]-$s[0],$c=$r[1]-$s[1],$R=$r[2]-$s[2],$T=$r[3]-$s[3];return $p*$p+$c*$c+$R*$R+$T*$T},$V.distance=function($V,$U){var $r=$V.elements,$s=$U.elements,$p=$r[0]-$s[0],$c=$r[1]-$s[1],$R=$r[2]-$s[2],$T=$r[3]-$s[3];return Math.sqrt($p*$p+$c*$c+$R*$R+$T*$T)},$V.dot=function($V,$U){var $r=$V.elements,$s=$U.elements;return $r[0]*$s[0]+$r[1]*$s[1]+$r[2]*$s[2]+$r[3]*$s[3]},$V.min=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=Math.min($p[0],$c[0]),$s[1]=Math.min($p[1],$c[1]),$s[2]=Math.min($p[2],$c[2]),$s[3]=Math.min($p[3],$c[3])},$V.max=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U.elements;$s[0]=Math.max($p[0],$c[0]),$s[1]=Math.max($p[1],$c[1]),$s[2]=Math.max($p[2],$c[2]),$s[3]=Math.max($p[3],$c[3])},$S($V,["ZERO",function(){return this.ZERO=new $V},"ONE",function(){return this.ONE=new $V(1,1,1,1)},"UnitX",function(){return this.UnitX=new $V(1,0,0,0)},"UnitY",function(){return this.UnitY=new $V(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $V(0,0,1,0)},"UnitW",function(){return this.UnitW=new $V(0,0,0,1)}]),$V}(),$NU=function(){function $c($V,$U,$r,$s){this.minDepth=0,this.maxDepth=1,this.x=$V,this.y=$U,this.width=$r,this.height=$s}$G($c,"laya.d3.math.Viewport");var $V=$c.prototype;return $V.project=function($V,$U,$r){$RU.transformV3ToV3($V,$U,$r);var $s=$V.elements,$p=$U.elements,$c=$r.elements,$R=$s[0]*$p[3]+$s[1]*$p[7]+$s[2]*$p[11]+$p[15];1!==$R&&($c[0]=$c[0]/$R,$c[1]=$c[1]/$R,$c[2]=$c[2]/$R),$c[0]=.5*($c[0]+1)*this.width+this.x,$c[1]=.5*(1-$c[1])*this.height+this.y,$c[2]=$c[2]*(this.maxDepth-this.minDepth)+this.minDepth},$V.unprojectFromMat=function($V,$U,$r){var $s=$V.elements,$p=$U.elements,$c=$r.elements;$c[0]=($s[0]-this.x)/this.width*2-1,$c[1]=-(($s[1]-this.y)/this.height*2-1);var $R=(this.maxDepth-this.minDepth)/2;$c[2]=($s[2]-this.minDepth-$R)/$R;var $T=$c[0]*$p[3]+$c[1]*$p[7]+$c[2]*$p[11]+$p[15];$RU.transformV3ToV3($r,$U,$r),1!==$T&&($c[0]=$c[0]/$T,$c[1]=$c[1]/$T,$c[2]=$c[2]/$T)},$V.unprojectFromWVP=function($V,$U,$r,$s,$p){$VU.multiply($U,$r,$c._tempMatrix4x4),$s&&$VU.multiply($c._tempMatrix4x4,$s,$c._tempMatrix4x4),$c._tempMatrix4x4.invert($c._tempMatrix4x4),this.unprojectFromMat($V,$c._tempMatrix4x4,$p)},$S($c,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $VU}]),$c}(),$tU=function(){function $H($V){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$V,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$G($H,"laya.d3.resource.models.SubMesh");var $V=$H.prototype;return $d.imps($V,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$V._getVertexBuffer=function($V){return void 0===$V&&($V=0),0===$V?this._vertexBuffer:null},$V._getIndexBuffer=function(){return this._indexBuffer},$V._getStaticBatchBakedVertexs=function($V,$U){var $r,$s,$p=this._vertexBuffer,$c=$p.vertexDeclaration,$R=$c.getVertexElementByUsage(0).offset/4,$T=$c.getVertexElementByUsage(3).offset/4,$N=$U.meshRender.lightmapScaleOffset,$t=0,$b=0,$S=0,$_=0,$G=0,$q=0;if($N)if($s=$c.getVertexElementByUsage(15))$S=$c.vertexStride/4,$r=0<this._vertexCount?$p.getData().slice(this._vertexStart*$S,(this._vertexStart+this._vertexCount)*$S):$p.getData().slice(),$_=$s.offset/4;else{$S=($q=$c.vertexStride/4)+2,$r=this._vertexCount?new Float32Array(this._vertexCount*($p.vertexDeclaration.vertexStride/4+2)):new Float32Array($p.vertexCount*($p.vertexDeclaration.vertexStride/4+2)),$_=($G=$c.getVertexElementByUsage(2).offset/4)+2;var $u=$p.getData();for($t=0,$b=$u.length/$q;$t<$b;$t++){var $h=0;$h=0<this._vertexCount?(this._vertexStart+$t)*$q:$t*$q;var $l=$t*$S,$W=0;for($W=0;$W<$_;$W++)$r[$l+$W]=$u[$h+$W];for($W=$_;$W<$q;$W++)$r[$l+$W+2]=$u[$h+$W]}}else $S=$c.vertexStride/4,$r=this._vertexCount?$p.getData().slice(this._vertexStart*$S,(this._vertexStart+this._vertexCount)*$S):$p.getData().slice();if($V){var $O=$V.worldMatrix,$L=$H._tempMatrix4x40;$O.invert($L);var $d=$H._tempMatrix4x41,$k=$U.transform.worldMatrix;$VU.multiply($L,$k,$d)}else $d=$U.transform.worldMatrix;var $y=$H._tempQuaternion0;for($d.decomposeTransRotScale($H._tempVector30,$y,$H._tempVector31),$t=0,$b=$r.length/$S;$t<$b;$t++){var $D=$t*$S+$R,$n=$t*$S+$T;if($hU.transformVector3ArrayToVector3ArrayCoordinate($r,$D,$d,$r,$D),$hU.transformVector3ArrayByQuat($r,$n,$y,$r,$n),$N){var $I=$t*$S+$_;if($s)$hU.transformLightingMapTexcoordByUV1Array($r,$I,$N,$r,$I);else{var $Q=$t*$q+$G;$hU.transformLightingMapTexcoordByUV0Array($u,$Q,$N,$r,$I)}}}return $r},$V._getVertexBuffers=function(){return null},$V._beforeRender=function($V){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$V._render=function($V){var $U,$r=0,$s=$V.renderElement;if(1<this._indexCount){var $p=this._boneIndicesList.length;if(1<$p){for(var $c=0;$c<$p;$c++)($U=$s._skinAnimationDatas||this._skinAnimationDatas)&&($s._shaderValue.setValue(0,$U[$c]),$V._shader.uploadRenderElementUniforms($s._shaderValue.data)),$w.mainContext.drawElements(4,this._subIndexBufferCount[$c],5123,2*this._subIndexBufferStart[$c]);$D.drawCall+=$p}else($U=$s._skinAnimationDatas||this._skinAnimationDatas)&&($s._shaderValue.setValue(0,$U[0]),$V._shader.uploadRenderElementUniforms($s._shaderValue.data)),$w.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$D.drawCall++;$r=this._indexCount}else $r=this._indexBuffer.indexCount,($U=$s._skinAnimationDatas||this._skinAnimationDatas)&&($s._shaderValue.setValue(0,$U[0]),$V._shader.uploadRenderElementUniforms($s._shaderValue.data)),$w.mainContext.drawElements(4,$r,5123,0),$D.drawCall++;$D.trianglesFaces+=$r/3},$V.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$V.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$q(0,$V,"_vertexBufferCount",function(){return 1}),$q(0,$V,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$S($H,["_tempVector30",function(){return this._tempVector30=new $RU},"_tempVector31",function(){return this._tempVector31=new $RU},"_tempQuaternion0",function(){return this._tempQuaternion0=new $rU},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $VU},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $VU}]),$H}(),$bU=function(){function $V($V){this.defineCounter=0,this.defines=null,$V?(this.defineCounter=$V.defineCounter,this.defines=$V.defines.slice()):(this.defineCounter=0,this.defines=[])}return $G($V,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$V.prototype.registerDefine=function($V){var $U=Math.pow(2,this.defineCounter++);return this.defines[$U]=$V,$U},$V}(),$SU=function(){function $V(){}return $G($V,"laya.d3.shader.ShaderInit3D"),$V.__init__=function(){var $V,$U;$DU._globalRegDefine("HIGHPRECISION",$DU.SHADERDEFINE_HIGHPRECISION),$DU._globalRegDefine("FOG",$DU.SHADERDEFINE_FOG),$DU._globalRegDefine("DIRECTIONLIGHT",$DU.SHADERDEFINE_DIRECTIONLIGHT),$DU._globalRegDefine("POINTLIGHT",$DU.SHADERDEFINE_POINTLIGHT),$DU._globalRegDefine("SPOTLIGHT",$DU.SHADERDEFINE_SPOTLIGHT),$DU._globalRegDefine("UV",$DU.SHADERDEFINE_UV0),$DU._globalRegDefine("COLOR",$DU.SHADERDEFINE_COLOR),$DU._globalRegDefine("UV1",$DU.SHADERDEFINE_UV1),$DU._globalRegDefine("CASTSHADOW",$GU.SHADERDEFINE_CAST_SHADOW),$DU._globalRegDefine("SHADOWMAP_PSSM1",$GU.SHADERDEFINE_SHADOW_PSSM1),$DU._globalRegDefine("SHADOWMAP_PSSM2",$GU.SHADERDEFINE_SHADOW_PSSM2),$DU._globalRegDefine("SHADOWMAP_PSSM3",$GU.SHADERDEFINE_SHADOW_PSSM3),$DU._globalRegDefine("SHADOWMAP_PCF_NO",$GU.SHADERDEFINE_SHADOW_PCF_NO),$DU._globalRegDefine("SHADOWMAP_PCF1",$GU.SHADERDEFINE_SHADOW_PCF1),$DU._globalRegDefine("SHADOWMAP_PCF2",$GU.SHADERDEFINE_SHADOW_PCF2),$DU._globalRegDefine("SHADOWMAP_PCF3",$GU.SHADERDEFINE_SHADOW_PCF3),$DU._globalRegDefine("DEPTHFOG",$DU.SAHDERDEFINE_DEPTHFOG),$ZU.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$ZU.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$V={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$U={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $r=$ZU.nameKey.add("SIMPLE");shaderCompile=$DU.add($r,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$V,$U),$xU.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$xU.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$xU.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$xU.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$xU.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$xU.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$xU.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$xU.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$xU.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$V}(),$_U=function(){function $V(){this._data=null,this._data=[]}$G($V,"laya.d3.shader.ValusArray");var $U=$V.prototype;return $U.setValue=function($V,$U){this._data[$V]=$U},$q(0,$U,"data",function(){return this._data}),$V}(),$GU=function(){function $V(){}return $V.SHADERDEFINE_RECEIVE_SHADOW=1,$V.SHADERDEFINE_CAST_SHADOW=512,$V.SHADERDEFINE_SHADOW_PSSM1=1024,$V.SHADERDEFINE_SHADOW_PSSM2=2048,$V.SHADERDEFINE_SHADOW_PSSM3=4096,$V.SHADERDEFINE_SHADOW_PCF_NO=8192,$V.SHADERDEFINE_SHADOW_PCF1=16384,$V.SHADERDEFINE_SHADOW_PCF2=32768,$V.SHADERDEFINE_SHADOW_PCF3=65536,$V.MAX_PSSM_COUNT=3,$V}(),$qU=function(){function $e(){}return $G($e,"laya.d3.utils.Picker"),$e.calculateCursorRay=function($V,$U,$r,$s,$p,$c){var $R=$V.elements[0],$T=$V.elements[1],$N=$e._tempVector30,$t=$N.elements;$t[0]=$R,$t[1]=$T,$t[2]=$U.minDepth;var $b=$e._tempVector31,$S=$b.elements;$S[0]=$R,$S[1]=$T,$S[2]=$U.maxDepth;var $_=$c.origin,$G=$e._tempVector32;$U.unprojectFromWVP($N,$r,$s,$p,$_),$U.unprojectFromWVP($b,$r,$s,$p,$G);var $q=$c.direction.elements;$q[0]=$G.x-$_.x,$q[1]=$G.y-$_.y,$q[2]=$G.z-$_.z,$RU.normalize($c.direction,$c.direction)},$e.rayIntersectsPositionsAndIndices=function($V,$U,$r,$s,$p){for(var $c=$r.vertexStride/4,$R=$r.getVertexElementByUsage(0).offset/4,$T=Number.MAX_VALUE,$N=-1,$t=-1,$b=-1,$S=0;$S<$s.length;$S+=3){var $_=$e._tempVector35,$G=$_.elements,$q=$s[$S]*$c,$u=$q+$R;$G[0]=$U[$u],$G[1]=$U[1+$u],$G[2]=$U[2+$u];var $h=$e._tempVector36,$l=$h.elements,$W=$s[$S+1]*$c,$O=$W+$R;$l[0]=$U[$O],$l[1]=$U[1+$O],$l[2]=$U[2+$O];var $L=$e._tempVector37,$d=$L.elements,$k=$s[$S+2]*$c,$y=$k+$R;$d[0]=$U[$y],$d[1]=$U[1+$y],$d[2]=$U[2+$y];var $D=laya.d3.utils.Picker.rayIntersectsTriangle($V,$_,$h,$L);!isNaN($D)&&$D<$T&&($T=$D,$N=$q,$t=$W,$b=$k)}if($T===Number.MAX_VALUE)return $p.position.toDefault(),$p.distance=Number.MAX_VALUE,$p.trianglePositions[0].toDefault(),$p.trianglePositions[1].toDefault(),$p.trianglePositions[2].toDefault(),$p.triangleNormals[0].toDefault(),$p.triangleNormals[1].toDefault(),$p.triangleNormals[2].toDefault(),!1;$p.distance=$T,$RU.scale($V.direction,$T,$p.position),$RU.add($V.origin,$p.position,$p.position);var $n=$p.trianglePositions,$I=$n[0],$Q=$n[1],$H=$n[2],$w=$I.elements,$z=$Q.elements,$E=$H.elements,$K=$N+$R;$w[0]=$U[$K],$w[1]=$U[$K+1],$w[2]=$U[$K+2];var $m=$t+$R;$z[0]=$U[$m],$z[1]=$U[$m+1],$z[2]=$U[$m+2];var $a=$b+$R;$E[0]=$U[$a],$E[1]=$U[$a+1],$E[2]=$U[$a+2];var $Z=$r.getVertexElementByUsage(3);if($Z){var $x=$Z.offset/4,$$=$p.triangleNormals,$j=$$[0],$o=$$[1],$J=$$[2],$i=$j.elements,$B=$o.elements,$P=$J.elements,$M=$N+$x;$i[0]=$U[$M],$i[1]=$U[$M+1],$i[2]=$U[$M+2];var $A=$t+$x;$B[0]=$U[$A],$B[1]=$U[$A+1],$B[2]=$U[$A+2];var $X=$b+$x;$P[0]=$U[$X],$P[1]=$U[$X+1],$P[2]=$U[$X+2]}return!0},$e.rayIntersectsTriangle=function($V,$U,$r,$s){var $p=$e._tempVector30,$c=$e._tempVector31;$RU.subtract($r,$U,$p),$RU.subtract($s,$U,$c);var $R,$T=$e._tempVector32;if($RU.cross($V.direction,$c,$T),($R=$RU.dot($p,$T))>-Number.MIN_VALUE&&$R<Number.MIN_VALUE)return Number.NaN;var $N,$t=1/$R,$b=$e._tempVector33;if($RU.subtract($V.origin,$U,$b),$N=$RU.dot($b,$T),($N*=$t)<0||1<$N)return Number.NaN;var $S,$_,$G=$e._tempVector34;return $RU.cross($b,$p,$G),$S=$RU.dot($V.direction,$G),($S*=$t)<0||1<$N+$S?Number.NaN:($_=$RU.dot($c,$G),($_*=$t)<0?Number.NaN:$_)},$S($e,["_tempVector30",function(){return this._tempVector30=new $RU},"_tempVector31",function(){return this._tempVector31=new $RU},"_tempVector32",function(){return this._tempVector32=new $RU},"_tempVector33",function(){return this._tempVector33=new $RU},"_tempVector34",function(){return this._tempVector34=new $RU},"_tempVector35",function(){return this._tempVector35=new $RU},"_tempVector36",function(){return this._tempVector36=new $RU},"_tempVector37",function(){return this._tempVector37=new $RU}]),$e}(),$uU=(function(){function $V(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $RU,new $RU,new $RU],this.trianglePositions.length=3,this.triangleNormals=[new $RU,new $RU,new $RU],this.triangleNormals.length=3,this.position=new $RU}$G($V,"laya.d3.utils.RaycastHit"),$V.prototype.cloneTo=function($V){$V.distance=this.distance,this.trianglePositions[0].cloneTo($V.trianglePositions[0]),this.trianglePositions[1].cloneTo($V.trianglePositions[1]),this.trianglePositions[2].cloneTo($V.trianglePositions[2]),this.triangleNormals[0].cloneTo($V.triangleNormals[0]),this.triangleNormals[1].cloneTo($V.triangleNormals[1]),this.triangleNormals[2].cloneTo($V.triangleNormals[2]),this.position.cloneTo($V.position),$V.sprite3D=this.sprite3D}}(),function(){function $V($V,$U){this._width=0,this._height=0,this._width=$V,this._height=$U}$G($V,"laya.d3.utils.Size");var $U=$V.prototype;return $q(0,$U,"width",function(){return-1===this._width?$F.clientWidth:this._width}),$q(0,$U,"height",function(){return-1===this._height?$F.clientHeight:this._height}),$q(1,$V,"fullScreen",function(){return new $V(-1,-1)}),$V}()),$hU=function(){function $K(){}return $G($K,"laya.d3.utils.Utils3D"),$K._rotationTransformScaleSkinAnimation=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S){var $_,$G,$q,$u,$h,$l=$K._tempArray16_0,$W=$K._tempArray16_1,$O=$K._tempArray16_2,$L=$s+$s,$d=$p+$p,$k=$c+$c,$y=$s*$L,$D=$p*$L,$n=$p*$d,$I=$c*$L,$Q=$c*$d,$H=$c*$k,$w=$R*$L,$z=$R*$d,$E=$R*$k;for($l[15]=1,$l[0]=1-$n-$H,$l[1]=$D+$E,$l[2]=$I-$z,$l[4]=$D-$E,$l[5]=1-$y-$H,$l[6]=$Q+$w,$l[8]=$I+$z,$l[9]=$Q-$w,$l[10]=1-$y-$n,$W[15]=1,$W[0]=$T,$W[5]=$N,$W[10]=$t,$_=0;$_<4;$_++)$G=$l[$_],$q=$l[$_+4],$u=$l[$_+8],$h=$l[$_+12],$O[$_]=$G,$O[$_+4]=$q,$O[$_+8]=$u,$O[$_+12]=$G*$V+$q*$U+$u*$r+$h;for($_=0;$_<4;$_++)$G=$O[$_],$q=$O[$_+4],$u=$O[$_+8],$h=$O[$_+12],$b[$_+$S]=$G*$W[0]+$q*$W[1]+$u*$W[2]+$h*$W[3],$b[$_+$S+4]=$G*$W[4]+$q*$W[5]+$u*$W[6]+$h*$W[7],$b[$_+$S+8]=$G*$W[8]+$q*$W[9]+$u*$W[10]+$h*$W[11],$b[$_+$S+12]=$G*$W[12]+$q*$W[13]+$u*$W[14]+$h*$W[15]},$K._createNodeByJson=function($V,$U,$r,$s){if(!$r)switch($U.type){case"Sprite3D":$r=new $aU;break;case"MeshSprite3D":$r=new $eU;break;case"SkinnedMeshSprite3D":$r=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$r=new ShuriKenParticle3D;break;case"TrailSprite3D":$r=new TrailSprite3D;break;case"Terrain":$r=new Terrain;break;case"Camera":$r=new $XU;break;case"DirectionLight":$r=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $p=$U.props;if($p)for(var $c in $p)$r[$c]=$p[$c];var $R=$U.customProps;$R&&($r instanceof laya.d3.core.Sprite3D?($r._parseBaseCustomProps($R),$r._parseCustomProps($V,$s,$R,$U),$r._parseCustomComponent($V,$s,$U.components)):$r._parseCustomProps($V,$s,$R,$U));var $T=$U.child;if($T)for(var $N=0,$t=$T.length;$N<$t;$N++){var $b=$K._createNodeByJson($V,$T[$N],null,$s);$r.addChild($b)}return $r},$K._computeBoneAndAnimationDatasByBindPoseMatrxix=function($V,$U,$r,$s,$p,$c){var $R,$T,$N=0,$t=0,$b=$V.length;for($R=0;$R<$b;$N+=$V[$R].keyframeWidth,$t+=16,$R++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($U[$N+0],$U[$N+1],$U[$N+2],$U[$N+3],$U[$N+4],$U[$N+5],$U[$N+6],$U[$N+7],$U[$N+8],$U[$N+9],$s,$t),0!=$R&&($T=16*$V[$R].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($s,$T,$s,$t,$s,$t));var $S=$r.length;for($R=0;$R<$S;$R++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($s,16*$c[$R],$r[$R],$p,16*$R)},$K._computeAnimationDatasByArrayAndMatrixFast=function($V,$U,$r,$s){for(var $p=0,$c=$V.length;$p<$c;$p++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($U,16*$s[$p],$V[$p],$r,16*$p)},$K._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($V,$U,$r,$s,$p){var $c,$R,$T=0,$N=0,$t=$V.length;for($c=0;$c<$t;$T+=$V[$c].keyframeWidth,$N+=16,$c++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($U[$T+7],$U[$T+8],$U[$T+9],$U[$T+3],$U[$T+4],$U[$T+5],$U[$T+6],$U[$T+0],$U[$T+1],$U[$T+2],$s,$N),0!=$c&&($R=16*$V[$c].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($s,$R,$s,$N,$s,$N));var $b=$r.length;for($c=0;$c<$b;$c++){var $S=16*$c;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($s,$S,$r[$c],$p,$S)}},$K._computeAnimationDatasByArrayAndMatrixFastOld=function($V,$U,$r){for(var $s=$V.length,$p=0;$p<$s;$p++){var $c=16*$p;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($U,$c,$V[$p],$r,$c)}},$K._computeRootAnimationData=function($V,$U,$r){for(var $s=0,$p=0,$c=0,$R=$V.length;$s<$R;$p+=$V[$s].keyframeWidth,$c+=16,$s++)laya.d3.utils.Utils3D.createAffineTransformationArray($U[$p+0],$U[$p+1],$U[$p+2],$U[$p+3],$U[$p+4],$U[$p+5],$U[$p+6],$U[$p+7],$U[$p+8],$U[$p+9],$r,$c)},$K.transformVector3ArrayByQuat=function($V,$U,$r,$s,$p){var $c=$r.elements,$R=$V[$U],$T=$V[$U+1],$N=$V[$U+2],$t=$c[0],$b=$c[1],$S=$c[2],$_=$c[3],$G=$_*$R+$b*$N-$S*$T,$q=$_*$T+$S*$R-$t*$N,$u=$_*$N+$t*$T-$b*$R,$h=-$t*$R-$b*$T-$S*$N;$s[$p]=$G*$_+$h*-$t+$q*-$S-$u*-$b,$s[$p+1]=$q*$_+$h*-$b+$u*-$t-$G*-$S,$s[$p+2]=$u*$_+$h*-$S+$G*-$b-$q*-$t},$K.mulMatrixByArray=function($V,$U,$r,$s,$p,$c){var $R,$T,$N,$t,$b;if($p===$r){for($r=$K._tempArray16_3,$R=0;$R<16;++$R)$r[$R]=$p[$c+$R];$s=0}for($R=0;$R<4;$R++)$T=$V[$U+$R],$N=$V[$U+$R+4],$t=$V[$U+$R+8],$b=$V[$U+$R+12],$p[$c+$R]=$T*$r[$s+0]+$N*$r[$s+1]+$t*$r[$s+2]+$b*$r[$s+3],$p[$c+$R+4]=$T*$r[$s+4]+$N*$r[$s+5]+$t*$r[$s+6]+$b*$r[$s+7],$p[$c+$R+8]=$T*$r[$s+8]+$N*$r[$s+9]+$t*$r[$s+10]+$b*$r[$s+11],$p[$c+$R+12]=$T*$r[$s+12]+$N*$r[$s+13]+$t*$r[$s+14]+$b*$r[$s+15]},$K.mulMatrixByArrayFast=function($V,$U,$r,$s,$p,$c){var $R,$T,$N,$t,$b;for($R=0;$R<4;$R++)$T=$V[$U+$R],$N=$V[$U+$R+4],$t=$V[$U+$R+8],$b=$V[$U+$R+12],$p[$c+$R]=$T*$r[$s+0]+$N*$r[$s+1]+$t*$r[$s+2]+$b*$r[$s+3],$p[$c+$R+4]=$T*$r[$s+4]+$N*$r[$s+5]+$t*$r[$s+6]+$b*$r[$s+7],$p[$c+$R+8]=$T*$r[$s+8]+$N*$r[$s+9]+$t*$r[$s+10]+$b*$r[$s+11],$p[$c+$R+12]=$T*$r[$s+12]+$N*$r[$s+13]+$t*$r[$s+14]+$b*$r[$s+15]},$K.mulMatrixByArrayAndMatrixFast=function($V,$U,$r,$s,$p){var $c,$R,$T,$N,$t,$b=$r.elements,$S=$b[0],$_=$b[1],$G=$b[2],$q=$b[3],$u=$b[4],$h=$b[5],$l=$b[6],$W=$b[7],$O=$b[8],$L=$b[9],$d=$b[10],$k=$b[11],$y=$b[12],$D=$b[13],$n=$b[14],$I=$b[15],$Q=$U,$H=$U+4,$w=$U+8,$z=$U+12,$E=$p,$K=$p+4,$m=$p+8,$a=$p+12;for($c=0;$c<4;$c++)$R=$V[$Q+$c],$T=$V[$H+$c],$N=$V[$w+$c],$t=$V[$z+$c],$s[$E+$c]=$R*$S+$T*$_+$N*$G+$t*$q,$s[$K+$c]=$R*$u+$T*$h+$N*$l+$t*$W,$s[$m+$c]=$R*$O+$T*$L+$N*$d+$t*$k,$s[$a+$c]=$R*$y+$T*$D+$N*$n+$t*$I},$K.createAffineTransformationArray=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S){var $_=$s+$s,$G=$p+$p,$q=$c+$c,$u=$s*$_,$h=$s*$G,$l=$s*$q,$W=$p*$G,$O=$p*$q,$L=$c*$q,$d=$R*$_,$k=$R*$G,$y=$R*$q;$b[$S+0]=(1-($W+$L))*$T,$b[$S+1]=($h+$y)*$T,$b[$S+2]=($l-$k)*$T,$b[$S+3]=0,$b[$S+4]=($h-$y)*$N,$b[$S+5]=(1-($u+$L))*$N,$b[$S+6]=($O+$d)*$N,$b[$S+7]=0,$b[$S+8]=($l+$k)*$t,$b[$S+9]=($O-$d)*$t,$b[$S+10]=(1-($u+$W))*$t,$b[$S+11]=0,$b[$S+12]=$V,$b[$S+13]=$U,$b[$S+14]=$r,$b[$S+15]=1},$K.transformVector3ArrayToVector3ArrayCoordinate=function($V,$U,$r,$s,$p){var $c=$K._tempArray4_0,$R=$V[$U+0],$T=$V[$U+1],$N=$V[$U+2],$t=$r.elements;$c[0]=$R*$t[0]+$T*$t[4]+$N*$t[8]+$t[12],$c[1]=$R*$t[1]+$T*$t[5]+$N*$t[9]+$t[13],$c[2]=$R*$t[2]+$T*$t[6]+$N*$t[10]+$t[14],$c[3]=1/($R*$t[3]+$T*$t[7]+$N*$t[11]+$t[15]),$s[$p+0]=$c[0]*$c[3],$s[$p+1]=$c[1]*$c[3],$s[$p+2]=$c[2]*$c[3]},$K.transformLightingMapTexcoordByUV0Array=function($V,$U,$r,$s,$p){var $c=$r.elements;$s[$p+0]=$V[$U+0]*$c[0]+$c[2],$s[$p+1]=($V[$U+1]-1)*$c[1]+$c[3]},$K.transformLightingMapTexcoordByUV1Array=function($V,$U,$r,$s,$p){var $c=$r.elements;$s[$p+0]=$V[$U+0]*$c[0]+$c[2],$s[$p+1]=1+$V[$U+1]*$c[1]+$c[3]},$K.getURLVerion=function($V){var $U=$V.indexOf("?");return 0<=$U?$V.substr($U):null},$K._quaternionCreateFromYawPitchRollArray=function($V,$U,$r,$s){var $p=.5*$r,$c=.5*$U,$R=.5*$V,$T=Math.sin($p),$N=Math.cos($p),$t=Math.sin($c),$b=Math.cos($c),$S=Math.sin($R),$_=Math.cos($R);$s[0]=$_*$t*$N+$S*$b*$T,$s[1]=$S*$b*$N-$_*$t*$T,$s[2]=$_*$b*$T-$S*$t*$N,$s[3]=$_*$b*$N+$S*$t*$T},$K._createAffineTransformationArray=function($V,$U,$r,$s){var $p=$U[0],$c=$U[1],$R=$U[2],$T=$U[3],$N=$p+$p,$t=$c+$c,$b=$R+$R,$S=$p*$N,$_=$p*$t,$G=$p*$b,$q=$c*$t,$u=$c*$b,$h=$R*$b,$l=$T*$N,$W=$T*$t,$O=$T*$b,$L=$r[0],$d=$r[1],$k=$r[2];$s[0]=(1-($q+$h))*$L,$s[1]=($_+$O)*$L,$s[2]=($G-$W)*$L,$s[3]=0,$s[4]=($_-$O)*$d,$s[5]=(1-($S+$h))*$d,$s[6]=($u+$l)*$d,$s[7]=0,$s[8]=($G+$W)*$k,$s[9]=($u-$l)*$k,$s[10]=(1-($S+$q))*$k,$s[11]=0,$s[12]=$V[0],$s[13]=$V[1],$s[14]=$V[2],$s[15]=1},$K._mulMatrixArray=function($V,$U,$r,$s){var $p,$c,$R,$T,$N,$t=$U.elements,$b=$t[0],$S=$t[1],$_=$t[2],$G=$t[3],$q=$t[4],$u=$t[5],$h=$t[6],$l=$t[7],$W=$t[8],$O=$t[9],$L=$t[10],$d=$t[11],$k=$t[12],$y=$t[13],$D=$t[14],$n=$t[15],$I=$s,$Q=$s+4,$H=$s+8,$w=$s+12;for($p=0;$p<4;$p++)$c=$V[$p],$R=$V[$p+4],$T=$V[$p+8],$N=$V[$p+12],$r[$I+$p]=$c*$b+$R*$S+$T*$_+$N*$G,$r[$Q+$p]=$c*$q+$R*$u+$T*$h+$N*$l,$r[$H+$p]=$c*$W+$R*$O+$T*$L+$N*$d,$r[$w+$p]=$c*$k+$R*$y+$T*$D+$N*$n},$K.getYawPitchRoll=function($V,$U){$K.transformQuat($RU.ForwardRH,$V,$rU.TEMPVector31),$K.transformQuat($RU.Up,$V,$rU.TEMPVector32);var $r=$rU.TEMPVector32.elements;$K.angleTo($RU.ZERO,$rU.TEMPVector31,$rU.TEMPVector33);var $s=$rU.TEMPVector33.elements;$s[0]==Math.PI/2?($s[1]=$K.arcTanAngle($r[2],$r[0]),$s[2]=0):$s[0]==-Math.PI/2?($s[1]=$K.arcTanAngle(-$r[2],-$r[0]),$s[2]=0):($VU.createRotationY(-$s[1],$rU.TEMPMatrix0),$VU.createRotationX(-$s[0],$rU.TEMPMatrix1),$RU.transformCoordinate($rU.TEMPVector32,$rU.TEMPMatrix0,$rU.TEMPVector32),$RU.transformCoordinate($rU.TEMPVector32,$rU.TEMPMatrix1,$rU.TEMPVector32),$s[2]=$K.arcTanAngle($r[1],-$r[0])),$s[1]<=-Math.PI&&($s[1]=Math.PI),$s[2]<=-Math.PI&&($s[2]=Math.PI),$s[1]>=Math.PI&&$s[2]>=Math.PI&&($s[1]=0,$s[2]=0,$s[0]=Math.PI-$s[0]),$U[0]=$s[1],$U[1]=$s[0],$U[2]=$s[2]},$K.arcTanAngle=function($V,$U){return 0==$V?1==$U?Math.PI/2:-Math.PI/2:0<$V?Math.atan($U/$V):$V<0?0<$U?Math.atan($U/$V)+Math.PI:Math.atan($U/$V)-Math.PI:0},$K.angleTo=function($V,$U,$r){$RU.subtract($U,$V,$rU.TEMPVector30),$RU.normalize($rU.TEMPVector30,$rU.TEMPVector30),$r.elements[0]=Math.asin($rU.TEMPVector30.y),$r.elements[1]=$K.arcTanAngle(-$rU.TEMPVector30.z,-$rU.TEMPVector30.x)},$K.transformQuat=function($V,$U,$r){var $s=$r.elements,$p=$V.elements,$c=$U,$R=$p[0],$T=$p[1],$N=$p[2],$t=$c[0],$b=$c[1],$S=$c[2],$_=$c[3],$G=$_*$R+$b*$N-$S*$T,$q=$_*$T+$S*$R-$t*$N,$u=$_*$N+$t*$T-$b*$R,$h=-$t*$R-$b*$T-$S*$N;$s[0]=$G*$_+$h*-$t+$q*-$S-$u*-$b,$s[1]=$q*$_+$h*-$b+$u*-$t-$G*-$S,$s[2]=$u*$_+$h*-$S+$G*-$b-$q*-$t},$K.quaterionNormalize=function($V,$U){var $r=$V[0],$s=$V[1],$p=$V[2],$c=$V[3],$R=$r*$r+$s*$s+$p*$p+$c*$c;0<$R&&($R=1/Math.sqrt($R),$U[0]=$r*$R,$U[1]=$s*$R,$U[2]=$p*$R,$U[3]=$c*$R)},$K.matrix4x4MultiplyFFF=function($V,$U,$r){var $s,$p,$c,$R,$T;if($r===$U)for($U=new Float32Array(16),$s=0;$s<16;++$s)$U[$s]=$r[$s];for($s=0;$s<4;$s++)$p=$V[$s],$c=$V[$s+4],$R=$V[$s+8],$T=$V[$s+12],$r[$s]=$p*$U[0]+$c*$U[1]+$R*$U[2]+$T*$U[3],$r[$s+4]=$p*$U[4]+$c*$U[5]+$R*$U[6]+$T*$U[7],$r[$s+8]=$p*$U[8]+$c*$U[9]+$R*$U[10]+$T*$U[11],$r[$s+12]=$p*$U[12]+$c*$U[13]+$R*$U[14]+$T*$U[15]},$K.matrix4x4MultiplyMFM=function($V,$U,$r){$K.matrix4x4MultiplyFFF($V.elements,$U,$r.elements)},$S($K,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $RU},"_tempVector3_1",function(){return this._tempVector3_1=new $RU},"_tempVector3_2",function(){return this._tempVector3_2=new $RU},"_tempVector3_3",function(){return this._tempVector3_3=new $RU},"_tempVector3_4",function(){return this._tempVector3_4=new $RU},"_tempVector3_5",function(){return this._tempVector3_5=new $RU},"_tempVector3_6",function(){return this._tempVector3_6=new $RU},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$K}(),$lU=function(){function $z(){}return $G($z,"Laya3D"),$z._cancelLoadByUrl=function($V){$d.loader.cancelLoadByUrl($V),$z._innerFirstLevelLoaderManager.cancelLoadByUrl($V),$z._innerSecondLevelLoaderManager.cancelLoadByUrl($V),$z._innerThirdLevelLoaderManager.cancelLoadByUrl($V),$z._innerFourthLevelLoaderManager.cancelLoadByUrl($V)},$z._changeWebGLSize=function($V,$U){$w.onStageResize($V,$U),$F.clientWidth=$V,$F.clientHeight=$U},$z.__init__=function(){var $V=$U.createMap;$V.lh=[$aU,"SPRITE3DHIERARCHY"],$V.ls=[$mU,"SPRITE3DHIERARCHY"],$V.lm=[$iU,"MESH"],$V.lmat=[$xU,"MATERIAL"],$V.jpg=[$PU,"nativeimage"],$V.jpeg=[$PU,"nativeimage"],$V.png=[$PU,"nativeimage"],$V.pkm=[$PU,"arraybuffer"],$V.raw=[$oU,"arraybuffer"],$V.mipmaps=[$oU,"arraybuffer"],$l.parserMap.SPRITE3DHIERARCHY=$z._loadHierarchy,$l.parserMap.MESH=$z._loadMesh,$l.parserMap.MATERIAL=$z._loadMaterial,$l.parserMap.TEXTURECUBE=$z._loadTextureCube,$l.parserMap.TERRAIN=$z._loadTerrain,$z._innerFirstLevelLoaderManager.on("error",null,$z._eventLoadManagerError),$z._innerSecondLevelLoaderManager.on("error",null,$z._eventLoadManagerError),$z._innerThirdLevelLoaderManager.on("error",null,$z._eventLoadManagerError),$z._innerFourthLevelLoaderManager.on("error",null,$z._eventLoadManagerError)},$z.READ_BLOCK=function(){return $z._readData.pos+=4,!0},$z.READ_DATA=function(){return $z._DATA.offset=$z._readData.getUint32(),$z._DATA.size=$z._readData.getUint32(),!0},$z.READ_STRINGS=function(){var $V=[],$U={offset:0,size:0};$U.offset=$z._readData.getUint16(),$U.size=$z._readData.getUint16();$z._readData.pos;$z._readData.pos=$U.offset+$z._DATA.offset;for(var $r=0;$r<$U.size;$r++){var $s=$z._readData.readUTFString();-1===$s.lastIndexOf(".lmat")&&-1===$s.lastIndexOf(".lpbr")||$V.push($s)}return $V},$z.formatRelativePath=function($V,$U){var $r;if("."===$U.charAt(0)){for(var $s=($V+$U).split("/"),$p=0,$c=$s.length;$p<$c;$p++)if(".."==$s[$p]){var $R=$p-1;0<$R&&".."!==$s[$R]&&($s.splice($R,2),$p-=2)}$r=$s.join("/")}else $r=$V+$U;return null!=$H.customFormat&&($r=$H.customFormat($r,null)),$r},$z._eventLoadManagerError=function($V){$d.loader.event("error",$V)},$z._addHierarchyInnerUrls=function($V,$U,$r,$s,$p,$c){var $R=$z.formatRelativePath($s,$p);$r&&($R+=$r),$V.push({url:$R,clas:$c}),$U[$p]=$R},$z._getSprite3DHierarchyInnerUrls=function($V,$U,$r,$s,$p,$c,$R){var $T,$N=0,$t=0;switch($V.type){case"Scene":var $b=$V.customProps.lightmaps;for($N=0,$t=$b.length;$N<$t;$N++){var $S=$b[$N].replace(".exr",".png");$z._addHierarchyInnerUrls($s,$p,$c,$R,$S,$PU)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $_;if($V.instanceParams)($_=$V.instanceParams.loadPath)&&$z._addHierarchyInnerUrls($U,$p,$c,$R,$_,$iU);else{($_=($T=$V.customProps).meshPath)&&$z._addHierarchyInnerUrls($U,$p,$c,$R,$_,$iU);var $G=$T.materials;if($G)for($N=0,$t=$G.length;$N<$t;$N++){for(var $q=$G[$N],$u=$q.type.split("."),$h=$E.window,$l=0,$W=$u.length;$l<$W;++$l){$h=$h[this.clasPaths[$l]]}if("function"!=typeof $h)throw"_getSprite3DHierarchyInnerUrls 错误: "+$q.type+" 不是类";$z._addHierarchyInnerUrls($r,$p,$c,$R,$q.path,$h)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $O=($T=$V.customProps).meshPath;$O&&$z._addHierarchyInnerUrls($U,$p,$c,$R,$O,$iU);var $L=$T.material;if($L){$u=$L.type.split("."),$h=$E.window;for($l=0,$W=$u.length;$l<$W;++$l){$h=$h[this.clasPaths[$l]]}$z._addHierarchyInnerUrls($r,$p,$c,$R,$L.path,$h)}else{var $d=$T.materialPath;if($d)$z._addHierarchyInnerUrls($r,$p,$c,$R,$d,ShurikenParticleMaterial);else{var $k=$T.texturePath;$k&&$z._addHierarchyInnerUrls($s,$p,$c,$R,$k,$PU)}}break;case"Terrain":$z._addHierarchyInnerUrls($s,$p,$c,$R,$V.customProps.dataPath,TerrainRes)}var $y=$V.components;for(var $D in $y){var $n=$y[$D];switch($D){case"Animator":var $I=$n.avatarPath;if($I)$z._addHierarchyInnerUrls($s,$p,$c,$R,$I,Avatar);else{var $Q=$n.avatar;$Q&&$z._addHierarchyInnerUrls($s,$p,$c,$R,$Q.path,Avatar)}var $H=$n.clipPaths;for($N=0,$t=$H.length;$N<$t;$N++)$z._addHierarchyInnerUrls($s,$p,$c,$R,$H[$N],AnimationClip)}}var $w=$V.child;for($N=0,$t=$w.length;$N<$t;$N++)$z._getSprite3DHierarchyInnerUrls($w[$N],$U,$r,$s,$p,$c,$R)},$z._loadHierarchy=function($V){$V.on("loaded",null,$z._onHierarchylhLoaded,[$V,$V._class._getGroup()]),$V.load($V.url,"json",!1,null,!0)},$z._onHierarchylhLoaded=function($V,$U,$r){if($V._class.destroyed)$V.endLoad();else{var $s=$V.url,$p=$hU.getURLVerion($s),$c=$H.getPath($s),$R=[],$T=[],$N=[],$t={};$z._getSprite3DHierarchyInnerUrls($r,$R,$T,$N,$t,$p,$c);var $b=$R.length+$T.length+$N.length,$S=$b+1,$_=1/$S;if($z._onProcessChange($V,0,$_,1),0<$N.length){var $G=$b/$S,$q=$Q.create(null,$z._onProcessChange,[$V,$_,$G],!1);$z._innerFourthLevelLoaderManager.create($N,$Q.create(null,$z._onHierarchyInnerForthLevResouLoaded,[$V,$U,$q,$r,$t,$R,$T,$_+$G*$N.length,$G]),$q,null,null,1,!0,$U)}else $z._onHierarchyInnerForthLevResouLoaded($V,$U,null,$r,$t,$R,$T,$_,$G)}},$z._onHierarchyInnerForthLevResouLoaded=function($V,$U,$r,$s,$p,$c,$R,$T,$N){if($V._class.destroyed)$V.endLoad();else if($r&&$r.recover(),0<$R.length){var $t=$Q.create(null,$z._onProcessChange,[$V,$T,$N],!1);$z._innerSecondLevelLoaderManager.create($R,$Q.create(null,$z._onHierarchyInnerSecondLevResouLoaded,[$V,$U,$t,$s,$p,$c,$T+$N*$R.length,$N]),$r,null,null,1,!0,$U)}else $z._onHierarchyInnerSecondLevResouLoaded($V,$U,null,$s,$p,$c,$T,$N)},$z._onHierarchyInnerSecondLevResouLoaded=function($V,$U,$r,$s,$p,$c,$R,$T){if($V._class.destroyed)$V.endLoad();else if($r&&$r.recover(),0<$c.length){var $N=$Q.create(null,$z._onProcessChange,[$V,$R,$T],!1);$z._innerFirstLevelLoaderManager.create($c,$Q.create(null,$z._onHierarchyInnerFirstLevResouLoaded,[$V,$N,$s,$p]),$r,null,null,1,!0,$U)}else $z._onHierarchyInnerFirstLevResouLoaded($V,null,$s,$p)},$z._onHierarchyInnerFirstLevResouLoaded=function($V,$U,$r,$s){$U&&$U.recover(),$V.endLoad([$r,$s])},$z._loadTerrain=function($V){$V.on("loaded",null,$z._onTerrainLtLoaded,[$V,$V._class._getGroup()]),$V.load($V.url,"json",!1,null,!0)},$z._onTerrainLtLoaded=function($V,$U,$r){if($V._class.destroyed)$V.endLoad();else{var $s,$p,$c=$V.url,$R=$hU.getURLVerion($c),$T=$H.getPath($c),$N=[],$t={},$b=0,$S=0,$_=$r.heightData;$s=$_.url,$p=$z.formatRelativePath($T,$s),$R&&($p+=$R),$s=$t[$s]=$p;var $G=$r.detailTexture;for($b=0,$S=$G.length;$b<$S;$b++)$N.push({url:$G[$b].diffuse});var $q=$r.normalMap;for($b=0,$S=$q.length;$b<$S;$b++)$N.push({url:$q[$b]});var $u=$r.alphaMap;for($b=0,$S=$u.length;$b<$S;$b++)$N.push({url:$u[$b],params:[!1,!1,6408,!0]});for($b=0,$S=$N.length;$b<$S;$b++){var $h=$N[$b].url;$p=$z.formatRelativePath($T,$h),$R&&($p+=$R),$N[$b].url=$p,$t[$h]=$p}var $l=$N.length,$W=$l+2,$O=1/$W;$z._onProcessChange($V,0,$O,1);var $L={heightMapLoaded:!1,texturesLoaded:!1},$d=$Q.create(null,$z._onProcessChange,[$V,$O,$O],!1);$z._innerFourthLevelLoaderManager.create($s,$Q.create(null,$z._onTerrainHeightMapLoaded,[$V,$d,$r,$t,$L]),$d,null,[$_.numX,$_.numZ,$_.bitType,$_.value],1,!0,$U);var $k=$Q.create(null,$z._onProcessChange,[$V,2*$O,$l/$W],!1);$z._innerFourthLevelLoaderManager.create($N,$Q.create(null,$z._onTerrainTexturesLoaded,[$V,$k,$r,$t,$L]),$k,null,null,1,!0,$U)}},$z._onTerrainHeightMapLoaded=function($V,$U,$r,$s,$p){$p.heightMapLoaded=!0,$p.texturesLoaded&&($V.endLoad([$r,$s]),$U.recover())},$z._onTerrainTexturesLoaded=function($V,$U,$r,$s,$p){$p.texturesLoaded=!0,$p.heightMapLoaded&&($V.endLoad([$r,$s]),$U.recover())},$z._loadMesh=function($V){$V.on("loaded",null,$z._onMeshLmLoaded,[$V,$V._class._getGroup()]),$V.load($V.url,"arraybuffer",!1,null,!0)},$z._onMeshLmLoaded=function($V,$U,$r){if($V._class.destroyed)$V.endLoad();else{var $s,$p,$c,$R=$V.url,$T=$hU.getURLVerion($R),$N=$H.getPath($R),$t={},$b=0,$S=0;switch(($z._readData=new $k($r)).pos=0,$z._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $_=$z._readData.getUint32();$z._readData.pos=$z._readData.pos+4,$S=$z._readData.getUint16(),$z._readData.pos=$z._readData.pos+8*$S;var $G=$z._readData.getUint32();for($S=$z._readData.getUint16(),$z._readData.pos=$_+$G,$s=[],$b=0;$b<$S;$b++){var $q=$z._readData.readUTFString();-1!==$q.lastIndexOf(".lmat")&&$s.push($q)}break;default:for($z.READ_BLOCK(),$b=0;$b<2;$b++){var $u=$z._readData.getUint16(),$h=$z._strings[$u],$l=$z["READ_"+$h];if(null==$l)throw new Error("model file err,no this function:"+$u+" "+$h);1===$b?$s=$l.call():$l.call()}}for($b=0,$c=$s.length;$b<$c;$b++){var $W=$s[$b];$p=$z.formatRelativePath($N,$W),$T&&($p+=$T),$s[$b]=$p,$t[$W]=$p}if(0<$s.length){$z._onProcessChange($V,0,.5,1);var $O=$Q.create(null,$z._onProcessChange,[$V,.5,.5],!1);$z._innerSecondLevelLoaderManager.create($s,$Q.create(null,$z._onMeshMateialLoaded,[$V,$O,$r,$t]),$O,null,null,1,!0,$U)}else $V.endLoad([$r,$t])}},$z._onMeshMateialLoaded=function($V,$U,$r,$s){$V.endLoad([$r,$s]),$U.recover()},$z._getMaterialTexturePath=function($V,$U,$r){var $s=$V.length-4;return $V.indexOf(".dds")!=$s&&$V.indexOf(".tga")!=$s&&$V.indexOf(".exr")!=$s&&$V.indexOf(".DDS")!=$s&&$V.indexOf(".TGA")!=$s&&$V.indexOf(".EXR")!=$s||($V=$V.substr(0,$s)+".png"),$V=$z.formatRelativePath($r,$V),$U&&($V+=$U),$V},$z._loadMaterial=function($V){$V.on("loaded",null,$z._onMaterilLmatLoaded,[$V,$V._class._getGroup()]),$V.load($V.url,"json",!1,null,!0)},$z._onMaterilLmatLoaded=function($V,$U,$r){if($V._class.destroyed)$V.endLoad();else{var $s,$p=$V.url,$c=$hU.getURLVerion($p),$R=$H.getPath($p),$T=[],$N={},$t=$r.customProps,$b=$r.version;if($b)switch($b){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $S=$r.props.textures,$_=0,$G=$S.length;$_<$G;$_++){var $q=$S[$_],$u=$q.path;if($u){var $h=$u.length-4;$u.indexOf(".exr")!=$h&&$u.indexOf(".EXR")!=$h||($u=$u.substr(0,$h)+".png"),$s=$z.formatRelativePath($R,$u),$c&&($s+=$c),$T.push({url:$s,params:$q.params}),$N[$u]=$s}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $l=$t.diffuseTexture.texture2D;if($l&&($s=$z._getMaterialTexturePath($l,$c,$R),$T.push($s),$N[$l]=$s),$t.normalTexture){var $W=$t.normalTexture.texture2D;$W&&($s=$z._getMaterialTexturePath($W,$c,$R),$T.push($s),$N[$W]=$s)}if($t.specularTexture){var $O=$t.specularTexture.texture2D;$O&&($s=$z._getMaterialTexturePath($O,$c,$R),$T.push($s),$N[$O]=$s)}if($t.emissiveTexture){var $L=$t.emissiveTexture.texture2D;$L&&($s=$z._getMaterialTexturePath($L,$c,$R),$T.push($s),$N[$L]=$s)}if($t.ambientTexture){var $d=$t.ambientTexture.texture2D;$d&&($s=$z._getMaterialTexturePath($d,$c,$R),$T.push($s),$N[$d]=$s)}if($t.reflectTexture){var $k=$t.reflectTexture.texture2D;$k&&($s=$z._getMaterialTexturePath($k,$c,$R),$T.push($s),$N[$k]=$s)}}var $y=$T.length,$D=$y+1,$n=1/$D;if($z._onProcessChange($V,0,$n,1),0<$y){var $I=$Q.create(null,$z._onProcessChange,[$V,$n,$y/$D],!1);$z._innerFourthLevelLoaderManager.create($T,$Q.create(null,$z._onMateialTexturesLoaded,[$V,$I,$r,$N]),$I,$PU,null,1,!0,$U)}else $z._onMateialTexturesLoaded($V,null,$r,null)}},$z._onMateialTexturesLoaded=function($V,$U,$r,$s){$V.endLoad([$r,$s]),$U&&$U.recover()},$z._loadTextureCube=function($V){$V.on("loaded",null,$z._onTextureCubeLtcLoaded,[$V]),$V.load($V.url,"json",!1,null,!0)},$z._onTextureCubeLtcLoaded=function($V,$U){if($V._class.destroyed)$V.endLoad();else{var $r=$H.getPath($V.url),$s=[$z.formatRelativePath($r,$U.px),$z.formatRelativePath($r,$U.nx),$z.formatRelativePath($r,$U.py),$z.formatRelativePath($r,$U.ny),$z.formatRelativePath($r,$U.pz),$z.formatRelativePath($r,$U.nz)];$z._onProcessChange($V,0,1/7,1);var $p=$Q.create(null,$z._onProcessChange,[$V,1/7,6/7],!1);$z._innerFourthLevelLoaderManager.load($s,$Q.create(null,$z._onTextureCubeImagesLoaded,[$V,$s,$p]),$p,"nativeimage")}},$z._onTextureCubeImagesLoaded=function($V,$U,$r){var $s=[];$s.length=6;for(var $p=0;$p<6;$p++){var $c=$U[$p];$s[$p]=$l.getRes($c),$l.clearRes($c)}$V.endLoad($s),$r.recover()},$z._onProcessChange=function($V,$U,$r,$s){($s=$U+$s*$r)<1&&$V.event("progress",$s)},$z.init=function($V,$U,$r,$s,$p,$c){if(void 0===$r&&($r=!1),void 0===$s&&($s=!1),void 0===$p&&($p=!0),void 0===$c&&($c=!0),$W.update3DLoop=function(){},$W.cancelLoadByUrl=function($V){$z._cancelLoadByUrl($V)},$N.isAntialias=$r,$N.isAlpha=$s,$N.premultipliedAlpha=$p,$N.isStencil=$c,!$w.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$W.changeWebGLSize=$z._changeWebGLSize,$u.is3DMode=!0,$d.init($V,$U),$K.__init__(),$SU.__init__(),$eU.__init__(),$J.__init__(),$z.__init__(),$R.maxTextureCount=2,($z.debugMode||$g.debugMode)&&($z._debugPhasorSprite=new $A)},$z.HIERARCHY="SPRITE3DHIERARCHY",$z.MESH="MESH",$z.MATERIAL="MATERIAL",$z.PBRMATERIAL="PBRMTL",$z.TEXTURECUBE="TEXTURECUBE",$z.TERRAIN="TERRAIN",$z._readData=null,$z._debugPhasorSprite=null,$z.debugMode=!1,$S($z,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $U},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $U},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $U},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $U}]),$z}(),$WU=function($V){function $p($V){$p.__super.call(this),this._owner=$V,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$G($p,"laya.d3.animation.AnimationTransform3D",$c);var $U=$p.prototype;return $U._getlocalMatrix=function(){return this._localUpdate&&($hU._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$U._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldTransform()}},$U._setWorldMatrixAndUpdate=function($V){if(this._worldMatrix=$V,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $U=this._getlocalMatrix(),$r=0;$r<16;++$r)this._worldMatrix[$r]=$U[$r];else $hU.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$U._setWorldMatrixNoUpdate=function($V){this._worldMatrix=$V},$U._setWorldMatrixIgnoreUpdate=function($V){this._worldMatrix=$V,this._worldUpdate=!1},$U.getLocalPosition=function(){return this._localPosition},$U.setLocalPosition=function($V){if(this._parent)this._localPosition=$V,this._localUpdate=!0,this._onWorldTransform();else{var $U=this._entity.owner._transform,$r=this._entity.localPosition,$s=$r.elements;$s[0]=$V[0],$s[1]=$V[1],$s[2]=$V[2],$U.localPosition=$r}},$U.getLocalRotation=function(){if(this._localQuaternionUpdate){var $V=this._localRotationEuler;$hU._quaternionCreateFromYawPitchRollArray($V[1]/$p._angleToRandin,$V[0]/$p._angleToRandin,$V[2]/$p._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$U.setLocalRotation=function($V){if(this._parent)this._localRotation=$V,$hU.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $U=this._entity.owner._transform,$r=this._entity.localRotation,$s=$r.elements;$s[0]=$V[0],$s[1]=$V[1],$s[2]=$V[2],$s[3]=$V[3],$U.localRotation=$r}},$U.getLocalScale=function(){return this._localScale},$U.setLocalScale=function($V){if(this._parent)this._localScale=$V,this._localUpdate=!0,this._onWorldTransform();else{var $U=this._entity.owner._transform,$r=this._entity.localScale,$s=$r.elements;$s[0]=$V[0],$s[1]=$V[1],$s[2]=$V[2],$U.localScale=$r}},$U.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$hU.getYawPitchRoll(this._localRotation,$p._tempVector3);var $V=$p._tempVector3,$U=this._localRotationEuler;$U[0]=$V[1]*$p._angleToRandin,$U[1]=$V[0]*$p._angleToRandin,$U[2]=$V[2]*$p._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$U.setLocalRotationEuler=function($V){if(this._parent)$hU._quaternionCreateFromYawPitchRollArray($V[1]/$p._angleToRandin,$V[0]/$p._angleToRandin,$V[2]/$p._angleToRandin,this._localRotation),this._localRotationEuler=$V,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $U=this._entity.owner._transform,$r=this._entity.localRotationEuler,$s=$r.elements;$s[0]=$V[0],$s[1]=$V[1],$s[2]=$V[2],$U.localRotationEuler=$r}},$U.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$hU.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $V=this._getlocalMatrix(),$U=0;$U<16;++$U)this._worldMatrix[$U]=$V[$U];this._worldUpdate=!1}return this._worldMatrix},$U.setParent=function($V){if(this._parent!==$V){if(this._parent){var $U=this._parent._childs,$r=$U.indexOf(this);$U.splice($r,1)}$V&&($V._childs.push(this),$V&&this._onWorldTransform()),this._parent=$V}},$S($p,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$p}(),$OU=function($V){function $U(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$U.__super.call(this),this._destroyed=!1,this._id=$U._uniqueIDCounter,$U._uniqueIDCounter++}$G($U,"laya.d3.component.Component3D",$c);var $r=$U.prototype;return $d.imps($r,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$r._initialize=function($V){this._owner=$V,this._enable=!0,this.started=!1,this._load($V)},$r._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$r._load=function($V){},$r._start=function($V){},$r._update=function($V){},$r._lateUpdate=function($V){},$r._preRenderUpdate=function($V){},$r._postRenderUpdate=function($V){},$r._unload=function($V){this.offAll()},$r._cloneTo=function($V){},$q(0,$r,"id",function(){return this._id}),$q(0,$r,"destroyed",function(){return this._destroyed}),$q(0,$r,"owner",function(){return this._owner}),$q(0,$r,"enable",function(){return this._enable},function($V){this._enable!==$V&&(this._enable=$V,this.event("enablechanged",this._enable))}),$q(0,$r,"isSingleton",function(){return $U._isSingleton}),$U._isSingleton=!0,$U._uniqueIDCounter=1,$U}(),$LU=function($V){function $U(){this._destroyed=!1,$U.__super.call(this),this._destroyed=!1}$G($U,"laya.d3.core.GeometryFilter",$c);var $r=$U.prototype;return $d.imps($r,{"laya.resource.IDestroy":!0}),$r._destroy=function(){this.offAll(),this._destroyed=!0},$q(0,$r,"_isAsyncLoaded",function(){return!0}),$q(0,$r,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$q(0,$r,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$q(0,$r,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$q(0,$r,"destroyed",function(){return this._destroyed}),$U}(),$dU=function($V){function $s($V){$s.__super.call(this),this._id=++$s._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $gV(new $RU,new $RU),this._boundingBoxCenter=new $RU,this._boundingSphere=new $YV(new $RU,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$V,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$G($s,"laya.d3.core.render.BaseRender",$c);var $U=$s.prototype;return $d.imps($U,{"laya.resource.IDestroy":!0}),$U._changeMaterialReference=function($V,$U){$V&&$V._removeReference(),$U._addReference()},$U._getInstanceMaterial=function($V,$U){var $r=new $V.constructor;return $V.cloneTo($r),$r.name=$r.name+"(Instance)",this._materialsInstance[$U]=!0,this._changeMaterialReference(this._materials[$U],$r),this._materials[$U]=$r},$U._setShaderValuelightMap=function($V){this._setShaderValueTexture(3,$V)},$U._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$U._renderRenderableBoundBox=function(){var $V=$lU._debugPhasorSprite,$U=this.boundingBox,$r=$s._tempBoundBoxCorners;$U.getCorners($r),$V.line($r[0],$s._greenColor,$r[1],$s._greenColor),$V.line($r[2],$s._greenColor,$r[3],$s._greenColor),$V.line($r[4],$s._greenColor,$r[5],$s._greenColor),$V.line($r[6],$s._greenColor,$r[7],$s._greenColor),$V.line($r[0],$s._greenColor,$r[3],$s._greenColor),$V.line($r[1],$s._greenColor,$r[2],$s._greenColor),$V.line($r[2],$s._greenColor,$r[6],$s._greenColor),$V.line($r[3],$s._greenColor,$r[7],$s._greenColor),$V.line($r[0],$s._greenColor,$r[4],$s._greenColor),$V.line($r[1],$s._greenColor,$r[5],$s._greenColor),$V.line($r[4],$s._greenColor,$r[7],$s._greenColor),$V.line($r[5],$s._greenColor,$r[6],$s._greenColor)},$U._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$U._calculateBoundingBox=function(){throw"BaseRender: must override it."},$U._setShaderValueTexture=function($V,$U){this._owner._shaderValues.setValue($V,$U)},$U._setShaderValueMatrix4x4=function($V,$U){this._owner._shaderValues.setValue($V,$U?$U.elements:null)},$U._setShaderValueColor=function($V,$U){this._owner._shaderValues.setValue($V,$U?$U.elements:null)},$U._setShaderValueBuffer=function($V,$U){this._owner._shaderValues.setValue($V,$U)},$U._setShaderValueInt=function($V,$U){this._owner._shaderValues.setValue($V,$U)},$U._setShaderValueBool=function($V,$U){this._owner._shaderValues.setValue($V,$U)},$U._setShaderValueNumber=function($V,$U){this._owner._shaderValues.setValue($V,$U)},$U._setShaderValueVector2=function($V,$U){this._owner._shaderValues.setValue($V,$U?$U.elements:null)},$U._addShaderDefine=function($V){this._owner._shaderDefineValue|=$V},$U._removeShaderDefine=function($V){this._owner._shaderDefineValue&=~$V},$U._renderUpdate=function($V){return!0},$U._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $V=this._owner.scene;if($V){var $U=$V.getlightmaps()[this._lightmapIndex];$U?(this._addShaderDefine($AU.SAHDERDEFINE_LIGHTMAP),$U.loaded?this._setShaderValuelightMap($U):$U.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($AU.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($AU.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($AU.SAHDERDEFINE_LIGHTMAP)},$U._updateOctreeNode=function(){var $V=this._treeNode;$V&&this._octreeNodeNeedChange&&($V.updateObject(this),this._octreeNodeNeedChange=!1)},$U._destroy=function(){this.offAll();var $V=0,$U=0;for($V=0,$U=this._renderElements.length;$V<$U;$V++)this._renderElements[$V]._destroy();for($V=0,$U=this._materials.length;$V<$U;$V++)this._materials[$V]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$q(0,$U,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$q(0,$U,"id",function(){return this._id}),$q(0,$U,"material",function(){var $V=this._materials[0];if($V&&!this._materialsInstance[0]){var $U=this._getInstanceMaterial($V,0);this.event("materialchanged",[this,0,$U])}return this._materials[0]},function($V){this.sharedMaterial=$V}),$q(0,$U,"sharedMaterial",function(){return this._materials[0]},function($V){var $U=this._materials[0];$U!==$V&&(this._materials[0]=$V,this._materialsInstance[0]=!1,this._changeMaterialReference($U,$V),this.event("materialchanged",[this,0,$V]))}),$q(0,$U,"lightmapIndex",function(){return this._lightmapIndex},function($V){this._lightmapIndex=$V,this._applyLightMapParams()}),$q(0,$U,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($V){this._lightmapScaleOffset=$V,this._setShaderValueColor(2,$V),this._addShaderDefine($AU.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$q(0,$U,"enable",function(){return this._enable},function($V){this._enable=$V,this.event("enablechanged",[this,$V])}),$q(0,$U,"materials",function(){for(var $V=0,$U=this._materials.length;$V<$U;$V++)if(!this._materialsInstance[$V]){var $r=this._getInstanceMaterial(this._materials[$V],$V);this.event("materialchanged",[this,$V,$r])}return this._materials.slice()},function($V){this.sharedMaterials=$V}),$q(0,$U,"sharedMaterials",function(){return this._materials.slice()},function($V){if(!$V)throw new Error("MeshRender: shadredMaterials value can't be null.");var $U=$V.length;this._materialsInstance.length=$U;for(var $r=0;$r<$U;$r++){var $s=this._materials[$r];$s!==$V[$r]&&(this._materialsInstance[$r]=!1,this._changeMaterialReference($s,$V[$r]),this.event("materialchanged",[this,$r,$V[$r]]))}this._materials=$V}),$q(0,$U,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$q(0,$U,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $V=this.boundingBox;$RU.add($V.min,$V.max,this._boundingBoxCenter),$RU.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$q(0,$U,"receiveShadow",function(){return this._receiveShadow},function($V){this._receiveShadow!==$V&&((this._receiveShadow=$V)?this._addShaderDefine($GU.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($GU.SHADERDEFINE_RECEIVE_SHADOW))}),$q(0,$U,"destroyed",function(){return this._destroyed}),$s._uniqueIDCounter=0,$S($s,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU,new $RU]},"_greenColor",function(){return this._greenColor=new $TU(0,1,0,1)}]),$s}(),$kU=function($V){function $T($V){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$T.__super.call(this),this._localPosition=new $RU,this._localRotation=new $rU(0,0,0,1),this._localScale=new $RU(1,1,1),this._localRotationEuler=new $RU,this._localMatrix=new $VU,this._position=new $RU,this._rotation=new $rU(0,0,0,1),this._scale=new $RU(1,1,1),this._worldMatrix=new $VU,this._forward=new $RU,this._up=new $RU,this._right=new $RU,this._owner=$V,this._childs=[]}$G($T,"laya.d3.core.Transform3D",$c);var $U=$T.prototype;return $U._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$VU.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $V=$T._tempVector30;$RU.multiply(this.pivot,this._localScale,$V);var $U=$T._tempVector31;$RU.subtract($V,this.pivot,$U);var $r=$T._tempVector32,$s=this.localRotation;$RU.transformQuat($V,$s,$r),$RU.subtract($r,$V,$r);var $p=$T._tempVector33;$RU.subtract(this._localPosition,$U,$p),$RU.subtract($p,$r,$p),$VU.createAffineTransformation($p,$s,this._localScale,this._localMatrix)}},$U._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldPositionRotationTransform()}},$U._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldPositionScaleTransform()}},$U._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldPositionTransform()}},$U._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldPositionRotationTransform()}},$U._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldPositionScaleTransform()}},$U._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._onWorldTransform()}},$U.translate=function($V,$U){void 0===$U&&($U=!0),$U?($VU.createFromQuaternion(this.localRotation,$T._tempMatrix0),$RU.transformCoordinate($V,$T._tempMatrix0,$T._tempVector30),$RU.add(this.localPosition,$T._tempVector30,this._localPosition),this.localPosition=this._localPosition):($RU.add(this.position,$V,this._position),this.position=this._position)},$U.rotate=function($V,$U,$r){var $s;void 0===$U&&($U=!0),void 0===$r&&($r=!0),$s=$r?$V:($RU.scale($V,Math.PI/180,$T._tempVector30),$T._tempVector30),$rU.createFromYawPitchRoll($s.y,$s.x,$s.z,$T._tempQuaternion0),$U?($rU.multiply(this._localRotation,$T._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($rU.multiply($T._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$U.lookAt=function($V,$U,$r){void 0===$r&&($r=!1);var $s,$p=$V.elements;if($r){if($s=this._localPosition.elements,Math.abs($s[0]-$p[0])<$CV.zeroTolerance&&Math.abs($s[1]-$p[1])<$CV.zeroTolerance&&Math.abs($s[2]-$p[2])<$CV.zeroTolerance)return;$rU.lookAt(this._localPosition,$V,$U,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $c=this.position;if($s=$c.elements,Math.abs($s[0]-$p[0])<$CV.zeroTolerance&&Math.abs($s[1]-$p[1])<$CV.zeroTolerance&&Math.abs($s[2]-$p[2])<$CV.zeroTolerance)return;$rU.lookAt($c,$V,$U,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$q(0,$U,"_isFrontFaceInvert",function(){var $V=this.scale,$U=$V.x<0;return $V.y<0&&($U=!$U),$V.z<0&&($U=!$U),$U}),$q(0,$U,"owner",function(){return this._owner}),$q(0,$U,"localRotation",function(){if(this._localQuaternionUpdate){var $V=this._localRotationEuler.elements;$rU.createFromYawPitchRoll($V[1]/$T._angleToRandin,$V[0]/$T._angleToRandin,$V[2]/$T._angleToRandin,this._localRotation)}return this._localRotation},function($V){this._localRotation=$V,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$q(0,$U,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$VU.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($V){null===this._parent?$V.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$VU.multiply(this._localMatrix,$V,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$V,this._worldUpdate=!1}),$q(0,$U,"worldNeedUpdate",function(){return this._worldUpdate}),$q(0,$U,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($V){this._localMatrix=$V,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$q(0,$U,"dummy",function(){return this._dummy},function($V){this._dummy!==$V&&(this._dummy&&(this._dummy._entity=null),$V&&($V._entity=this),this._dummy=$V)}),$q(0,$U,"localPosition",function(){return this._localPosition},function($V){this._localPosition=$V,this._localUpdate=!0,this._onWorldPositionTransform()}),$q(0,$U,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $V=this._parent.position;$RU.multiply(this._localPosition,this._parent.scale,$T._tempVector30),$RU.transformQuat($T._tempVector30,this._parent.rotation,$T._tempVector30),$RU.add($V,$T._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($V){if(null!=this._parent){$RU.subtract($V,this._parent.position,this._localPosition);var $U=this._parent.scale.elements,$r=$U[0],$s=$U[1],$p=$U[2];if(1!==$r||1!==$s||1!==$p){var $c=$T._tempVector30,$R=$c.elements;$R[0]=1/$r,$R[1]=1/$s,$R[2]=1/$p,$RU.multiply(this._localPosition,$c,this._localPosition)}this._parent.rotation.invert($T._tempQuaternion0),$RU.transformQuat(this._localPosition,$T._tempQuaternion0,this._localPosition)}else $V.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$V,this._positionUpdate=!1}),$q(0,$U,"localScale",function(){return this._localScale},function($V){this._localScale=$V,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$q(0,$U,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($T._tempVector30);var $V=$T._tempVector30.elements,$U=this._localRotationEuler.elements;$U[0]=$V[1]*$T._angleToRandin,$U[1]=$V[0]*$T._angleToRandin,$U[2]=$V[2]*$T._angleToRandin}return this._localRotationEuler},function($V){this._localRotationEuler=$V,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$q(0,$U,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$rU.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($V){null!=this._parent?(this._parent.rotation.invert($T._tempQuaternion0),$rU.multiply($V,$T._tempQuaternion0,this._localRotation)):$V.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$V,this._rotationUpdate=!1}),$q(0,$U,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$RU.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($V){if(null!==this._parent){var $U=this._parent.scale.elements,$r=$T._tempVector30.elements;$r[0]=1/$U[0],$r[1]=1/$U[1],$r[2]=1/$U[2],$RU.multiply($V,$T._tempVector30,this._localScale)}else $V.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$V,this._scaleUpdate=!1}),$q(0,$U,"rotationEuler",null,function($V){$rU.createFromYawPitchRoll($V.y,$V.x,$V.z,this._rotation),this.rotation=this._rotation}),$q(0,$U,"forward",function(){var $V=this.worldMatrix.elements;return this._forward.elements[0]=-$V[8],this._forward.elements[1]=-$V[9],this._forward.elements[2]=-$V[10],this._forward}),$q(0,$U,"up",function(){var $V=this.worldMatrix.elements;return this._up.elements[0]=$V[4],this._up.elements[1]=$V[5],this._up.elements[2]=$V[6],this._up}),$q(0,$U,"right",function(){var $V=this.worldMatrix.elements;return this._right.elements[0]=$V[0],this._right.elements[1]=$V[1],this._right.elements[2]=$V[2],this._right}),$q(0,$U,"parent",function(){return this._parent},function($V){if(this._parent!==$V){if(this._parent){var $U=this._parent._childs,$r=$U.indexOf(this);$U.splice($r,1)}$V&&($V._childs.push(this),$V&&this._onWorldTransform()),this._parent=$V}}),$S($T,["_tempVector30",function(){return this._tempVector30=new $RU},"_tempVector31",function(){return this._tempVector31=new $RU},"_tempVector32",function(){return this._tempVector32=new $RU},"_tempVector33",function(){return this._tempVector33=new $RU},"_tempQuaternion0",function(){return this._tempQuaternion0=new $rU},"_tempMatrix0",function(){return this._tempMatrix0=new $VU},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$T}(),$yU=(function($V){function $U(){this._rotation=0,this._matNeedUpdte=!1,$U.__super.call(this),this._matrix=new $VU,this._offset=new $cU,this._tiling=new $cU(1,1)}$G($U,"laya.d3.core.TransformUV",$c);var $r=$U.prototype;$d.imps($r,{"laya.d3.core.IClone":!0}),$r._updateMatrix=function(){$U._tempOffsetV3.elements[0]=this._offset.x,$U._tempOffsetV3.elements[1]=this._offset.y,$rU.createFromYawPitchRoll(0,0,this._rotation,$U._tempRotationQua),$U._tempTitlingV3.elements[0]=this._tiling.x,$U._tempTitlingV3.elements[1]=this._tiling.y,$VU.createAffineTransformation($U._tempOffsetV3,$U._tempRotationQua,$U._tempTitlingV3,this._matrix)},$r.cloneTo=function($V){$V._matrix=this._matrix.clone(),$V._offset=this._offset.clone(),$V._rotation=this._rotation,$V._tiling=this._tiling.clone()},$r.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$r,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$q(0,$r,"tiling",function(){return this._tiling},function($V){this._tiling=$V,this._matNeedUpdte=!0}),$q(0,$r,"offset",function(){return this._offset},function($V){this._offset=$V,this._matNeedUpdte=!0}),$q(0,$r,"rotation",function(){return this._rotation},function($V){this._rotation=$V,this._matNeedUpdte=!0}),$S($U,["_tempOffsetV3",function(){return this._tempOffsetV3=new $RU(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $rU},"_tempTitlingV3",function(){return this._tempTitlingV3=new $RU(1,1,1)}])}(),function($r){function $V(){this.x=NaN,this.y=NaN,this.z=NaN,$V.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$G($V,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$r);var $U=$V.prototype;$U._getShapeBoundBox=function($V){var $U=$V.min.elements;$U[0]=.5*-this.x,$U[1]=.5*-this.y,$U[2]=.5*-this.z;var $r=$V.max.elements;$r[0]=.5*this.x,$r[1]=.5*this.y,$r[2]=.5*this.z},$U._getSpeedBoundBox=function($V){var $U=$V.min.elements;$U[0]=0,$U[1]=0,$U[2]=0;var $r=$V.max.elements;$r[0]=0,$r[1]=1,$r[2]=0},$U.generatePositionAndDirection=function($V,$U,$r,$s){var $p=$V.elements,$c=$U.elements;$r?($r.seed=$s[16],$P._randomPointInsideHalfUnitBox($V,$r),$s[16]=$r.seed):$P._randomPointInsideHalfUnitBox($V),$p[0]=this.x*$p[0],$p[1]=this.y*$p[1],$p[2]=this.z*$p[2],this.randomDirection?$r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U):($c[0]=0,$c[1]=0,$c[2]=1)},$U.cloneTo=function($V){$r.prototype.cloneTo.call(this,$V);var $U=$V;$U.x=this.x,$U.y=this.y,$U.z=this.z,$U.randomDirection=this.randomDirection}}($j),function($r){function $R(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$R.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$G($R,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$r);var $V=$R.prototype;$V._getShapeBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[2]=-this.radius,$U[1]=0;var $r=$V.max.elements;$r[0]=$r[2]=this.radius,$r[1]=0},$V._getSpeedBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[1]=-1,$U[2]=0;var $r=$V.max.elements;$r[0]=$r[1]=1,$r[2]=0},$V.generatePositionAndDirection=function($V,$U,$r,$s){var $p=$V.elements,$c=$R._tempPositionPoint.elements;$r?($r.seed=$s[16],this.emitFromEdge?$P._randomPointUnitArcCircle(this.arc,$R._tempPositionPoint,$r):$P._randomPointInsideUnitArcCircle(this.arc,$R._tempPositionPoint,$r),$s[16]=$r.seed):this.emitFromEdge?$P._randomPointUnitArcCircle(this.arc,$R._tempPositionPoint):$P._randomPointInsideUnitArcCircle(this.arc,$R._tempPositionPoint),$p[0]=-$c[0],$p[1]=$c[1],$p[2]=0,$RU.scale($V,this.radius,$V),this.randomDirection?$r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U):$V.cloneTo($U)},$V.cloneTo=function($V){$r.prototype.cloneTo.call(this,$V);var $U=$V;$U.radius=this.radius,$U.arc=this.arc,$U.emitFromEdge=this.emitFromEdge,$U.randomDirection=this.randomDirection},$S($R,["_tempPositionPoint",function(){return this._tempPositionPoint=new $cU}])}($j),function($r){function $_(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$_.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$G($_,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$r);var $V=$_.prototype;$V._getShapeBoundBox=function($V){var $U=this.radius+this.length*Math.sin(this.angle),$r=this.length*Math.cos(this.angle),$s=$V.min.elements;$s[0]=$s[1]=-$U,$s[2]=0;var $p=$V.max.elements;$p[0]=$p[1]=$U,$p[2]=$r},$V._getSpeedBoundBox=function($V){var $U=Math.sin(this.angle),$r=$V.min.elements;$r[0]=$r[1]=-$U,$r[2]=0;var $s=$V.max.elements;$s[0]=$r[1]=$U,$s[2]=1},$V.generatePositionAndDirection=function($V,$U,$r,$s){var $p,$c=$V.elements,$R=$U.elements,$T=$_._tempPositionPoint.elements,$N=NaN,$t=NaN,$b=Math.cos(this.angle),$S=Math.sin(this.angle);switch(this.emitType){case 0:$r?($r.seed=$s[16],$P._randomPointInsideUnitCircle($_._tempPositionPoint,$r),$s[16]=$r.seed):$P._randomPointInsideUnitCircle($_._tempPositionPoint),$N=$T[0],$t=$T[1],$c[0]=$N*this.radius,$c[1]=$t*this.radius,$c[2]=0,this.randomDirection?($r?($r.seed=$s[17],$P._randomPointInsideUnitCircle($_._tempDirectionPoint,$r),$s[17]=$r.seed):$P._randomPointInsideUnitCircle($_._tempDirectionPoint),$p=$_._tempDirectionPoint.elements,$R[0]=$p[0]*$S,$R[1]=$p[1]*$S):($R[0]=$N*$S,$R[1]=$t*$S),$R[2]=$b;break;case 1:$r?($r.seed=$s[16],$P._randomPointUnitCircle($_._tempPositionPoint,$r),$s[16]=$r.seed):$P._randomPointUnitCircle($_._tempPositionPoint),$N=$T[0],$t=$T[1],$c[0]=$N*this.radius,$c[1]=$t*this.radius,$c[2]=0,this.randomDirection?($r?($r.seed=$s[17],$P._randomPointInsideUnitCircle($_._tempDirectionPoint,$r),$s[17]=$r.seed):$P._randomPointInsideUnitCircle($_._tempDirectionPoint),$p=$_._tempDirectionPoint.elements,$R[0]=$p[0]*$S,$R[1]=$p[1]*$S):($R[0]=$N*$S,$R[1]=$t*$S),$R[2]=$b;break;case 2:$r?($r.seed=$s[16],$P._randomPointInsideUnitCircle($_._tempPositionPoint,$r)):$P._randomPointInsideUnitCircle($_._tempPositionPoint),$N=$T[0],$t=$T[1],$c[0]=$N*this.radius,$c[1]=$t*this.radius,$R[$c[2]=0]=$N*$S,$R[1]=$t*$S,$R[2]=$b,$RU.normalize($U,$U),$r?($RU.scale($U,this.length*$r.getFloat(),$U),$s[16]=$r.seed):$RU.scale($U,this.length*Math.random(),$U),$RU.add($V,$U,$V),this.randomDirection&&($r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U));break;case 3:$r?($r.seed=$s[16],$P._randomPointUnitCircle($_._tempPositionPoint,$r)):$P._randomPointUnitCircle($_._tempPositionPoint),$N=$T[0],$t=$T[1],$c[0]=$N*this.radius,$c[1]=$t*this.radius,$R[$c[2]=0]=$N*$S,$R[1]=$t*$S,$R[2]=$b,$RU.normalize($U,$U),$r?($RU.scale($U,this.length*$r.getFloat(),$U),$s[16]=$r.seed):$RU.scale($U,this.length*Math.random(),$U),$RU.add($V,$U,$V),this.randomDirection&&($r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U));break;default:throw new Error("ConeShape:emitType is invalid.")}},$V.cloneTo=function($V){$r.prototype.cloneTo.call(this,$V);var $U=$V;$U.angle=this.angle,$U.radius=this.radius,$U.length=this.length,$U.emitType=this.emitType,$U.randomDirection=this.randomDirection},$S($_,["_tempPositionPoint",function(){return this._tempPositionPoint=new $cU},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $cU}])}($j),function($r){function $V(){this.radius=NaN,this.emitFromShell=!1,$V.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$G($V,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$r);var $U=$V.prototype;$U._getShapeBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[1]=$U[2]=-this.radius;var $r=$V.max.elements;$r[0]=$r[1]=this.radius,$r[2]=0},$U._getSpeedBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[1]=-1,$U[2]=0;var $r=$V.max.elements;$r[0]=$r[1]=$r[2]=1},$U.generatePositionAndDirection=function($V,$U,$r,$s){var $p=$V.elements;$r?($r.seed=$s[16],this.emitFromShell?$P._randomPointUnitSphere($V,$r):$P._randomPointInsideUnitSphere($V,$r),$s[16]=$r.seed):this.emitFromShell?$P._randomPointUnitSphere($V):$P._randomPointInsideUnitSphere($V),$RU.scale($V,this.radius,$V);var $c=$p[2];$c<0&&($p[2]=-1*$c),this.randomDirection?$r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U):$V.cloneTo($U)},$U.cloneTo=function($V){$r.prototype.cloneTo.call(this,$V);var $U=$V;$U.radius=this.radius,$U.emitFromShell=this.emitFromShell,$U.randomDirection=this.randomDirection}}($j),function($r){function $V(){this.radius=NaN,this.emitFromShell=!1,$V.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$G($V,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$r);var $U=$V.prototype;$U._getShapeBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[1]=$U[2]=-this.radius;var $r=$V.max.elements;$r[0]=$r[1]=$r[2]=this.radius},$U._getSpeedBoundBox=function($V){var $U=$V.min.elements;$U[0]=$U[1]=$U[2]=-1;var $r=$V.max.elements;$r[0]=$r[1]=$r[2]=1},$U.generatePositionAndDirection=function($V,$U,$r,$s){$r?($r.seed=$s[16],this.emitFromShell?$P._randomPointUnitSphere($V,$r):$P._randomPointInsideUnitSphere($V,$r),$s[16]=$r.seed):this.emitFromShell?$P._randomPointUnitSphere($V):$P._randomPointInsideUnitSphere($V),$RU.scale($V,this.radius,$V),this.randomDirection?$r?($r.seed=$s[17],$P._randomPointUnitSphere($U,$r),$s[17]=$r.seed):$P._randomPointUnitSphere($U):$V.cloneTo($U)},$U.cloneTo=function($V){$r.prototype.cloneTo.call(this,$V);var $U=$V;$U.radius=this.radius,$U.emitFromShell=this.emitFromShell,$U.randomDirection=this.randomDirection}}($j),function($V){function $U(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$U.__super.call(this)}return $G($U,"laya.d3.core.render.SubMeshRenderElement",$X),$U}()),$DU=function($V){function $h($V,$U,$r,$s,$p,$c){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$V,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$GU.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$AU.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$AU.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$HU.SHADERDEFINE_ALPHATEST]="ALPHATEST";$h.__super.call(this,$V,$U,$r,null,{}),this._attributeMap=$s;var $R;for($R in $p){var $T=$p[$R];switch($T[1]){case 0:this._renderElementUniformMap[$R]=$T[0];break;case 1:this._materialUniformMap[$R]=$T[0];break;case 2:this._spriteUniformMap[$R]=$T[0];break;case 3:this._cameraUniformMap[$R]=$T[0];break;case 4:this._sceneUniformMap[$R]=$T[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$G($h,"laya.d3.shader.ShaderCompile3D",$O);var $U=$h.prototype;return $U._definesToNameDic=function($V,$U){for(var $r={},$s=1,$p=0;$p<32&&!($V<($s=1<<$p));$p++)if($V&$s){var $c=$U[$s];$c&&($r[$c]="")}return $r},$U.withCompile=function($V,$U,$r,$s){var $p,$c,$R;if($c=this.sharders[$V])if($R=$c[$U]){if($p=$R[$r])return $p}else $R=$c[$U]=[];else $R=($c=this.sharders[$V]=[])[$U]=[];var $T,$N=this._definesToNameDic($V,$h._globalInt2name),$t=this._definesToNameDic($U,this._spriteInt2name),$b=this._definesToNameDic($r,this._materialInt2name),$S={},$_="";if($N)for($T in $N)$_+="#define "+$T+"\n",$S[$T]=!0;if($t)for($T in $t)$_+="#define "+$T+"\n",$S[$T]=!0;if($b)for($T in $b)$_+="#define "+$T+"\n",$S[$T]=!0;var $G=$ZU.nameKey.getName(this._name)+" compile ("+$V+","+$U+","+$r+")",$q=this._VS.toscript($S,[]),$u=this._PS.toscript($S,[]);$E.now();if($p=$ZU.create($_+$q.join("\n"),$_+$u.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$s,$G),$R[$r]=$p,laya.d3.shader.ShaderCompile3D.debugMode)$E.now();return $p},$U.precompileShaderWithShaderDefine=function($V,$U,$r){this.withCompile($V,$U,$r,!0)},$U.addMaterialDefines=function($V){var $U=$V.defines;for(var $r in $U){var $s=$U[$r],$p=parseInt($r);this._materialInt2name[$p]=$s,this._materialName2Int[$s]=$p}},$U.addSpriteDefines=function($V){var $U=$V.defines;for(var $r in $U){var $s=$U[$r],$p=parseInt($r);this._spriteInt2name[$p]=$s,this._spriteName2Int[$s]=$p}},$U.getMaterialDefineByName=function($V){return this._materialName2Int[$V]},$U.registerMaterialDefine=function($V){var $U=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$U]=$V,this._materialName2Int[$V]=$U},$U.registerSpriteDefine=function($V){var $U=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$U]=$V,this._spriteName2Int[$V]=$U},$h._globalRegDefine=function($V,$U){$h._globalInt2name[$U]=$V},$h.add=function($V,$U,$r,$s,$p){return laya.d3.shader.ShaderCompile3D._preCompileShader[$V]=new $h($V,$U,$r,$s,$p,$O.includes)},$h.get=function($V){return laya.d3.shader.ShaderCompile3D._preCompileShader[$ZU.nameKey.getID($V)]},$h._preCompileShader={},$h._globalInt2name=[],$h.debugMode=!1,$h.SHADERDEFINE_HIGHPRECISION=1,$h.SHADERDEFINE_FOG=4,$h.SHADERDEFINE_DIRECTIONLIGHT=8,$h.SHADERDEFINE_POINTLIGHT=16,$h.SHADERDEFINE_SPOTLIGHT=32,$h.SHADERDEFINE_UV0=64,$h.SHADERDEFINE_COLOR=128,$h.SHADERDEFINE_UV1=256,$h.SAHDERDEFINE_DEPTHFOG=131072,$h}(),$nU=function($V){function $q(){$q.__super.call(this)}$G($q,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$sV);var $U=$q.prototype;return $U._getStaticBatch=function($V,$U,$r,$s){var $p,$c;return $c=$V?$V.id.toString()+$r.id.toString()+$U.id.toString()+$s.toString():$r.id.toString()+$U.id.toString()+$s.toString(),this._staticBatches[$c]?$p=this._staticBatches[$c]:this._staticBatches[$c]=$p=new $IU($c,this,$V,$U,$r),$p},$U._initStaticBatchs=function($V){var $U,$r;this._initBatchRenderElements.sort($q._sortPrepareStaticBatch);for(var $s,$p=!1,$c=0,$R=0,$T=this._initBatchRenderElements.length;$R<$T;$R++){var $N,$t=this._initBatchRenderElements[$R],$b=$t.renderObj._getVertexBuffer(0);$t._sprite3D;if($r===$b.vertexDeclaration&&$U===$t._material)if($p)$s._addCombineBatchRenderObjTest($t)?($N=$t._staticBatch)!==$s&&($N&&$N._deleteCombineBatchRenderObj($t),$s._addCombineBatchRenderObj($t)):($p=!1,$c++);else{var $S=this._initBatchRenderElements[$R-1],$_=$S.renderObj,$G=$t.renderObj;$p=!(65535<$_._getVertexBuffer().vertexCount+$G._getVertexBuffer().vertexCount)&&($s=this._getStaticBatch($V,$r,$U,$c),($N=$S._staticBatch)!==$s&&($N&&$N._deleteCombineBatchRenderObj($S),$s._addCombineBatchRenderObj($S)),($N=$t._staticBatch)!==$s&&($N&&$N._deleteCombineBatchRenderObj($t),$s._addCombineBatchRenderObj($t)),!0)}else $p=!1,$c=0;$U=$t._material,$r=$b.vertexDeclaration}},$q._sortPrepareStaticBatch=function($V,$U){var $r=$V._render,$s=$U._render,$p=$r.lightmapIndex-$s.lightmapIndex;if(0!=$p)return $p;var $c=$r.receiveShadow-$s.receiveShadow;if(0!=$c)return $c;var $R=$V._mainSortID-$U._mainSortID;return 0==$R?$V.renderObj.triangleCount-$U.renderObj.triangleCount:$R},$q}(),$IU=function($V){function $c($V,$U,$r,$s,$p){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$c.__super.call(this,$V,$U,$r),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$s,this._material=$p}$G($c,"laya.d3.graphics.SubMeshStaticBatch",$pV);var $U=$c.prototype;return $U._compareBatchRenderElement=function($V,$U){return $V._batchIndexStart>$U._batchIndexStart},$U._addCombineBatchRenderObjTest=function($V){var $U=$V.renderObj._vertexCount;return!(65535<(0<$U?this._currentCombineVertexCount+$U:this._currentCombineVertexCount+$V.renderObj._getVertexBuffer().vertexCount))},$U._addCombineBatchRenderObj=function($V){var $U=$V.renderObj,$r=$U._vertexCount;this._initBatchRenderElements.push($V),$V._staticBatch=this,0<$r?(this._currentCombineIndexCount+=$U._indexCount,this._currentCombineVertexCount+=$r):(this._currentCombineIndexCount=this._currentCombineIndexCount+$U._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$U._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$U._deleteCombineBatchRenderObj=function($V){var $U=$V.renderObj,$r=this._initBatchRenderElements.indexOf($V);if(-1!==$r){this._initBatchRenderElements.splice($r,1),$V._staticBatch=null;var $s=$U._vertexCount;0<$s?(this._currentCombineIndexCount=this._currentCombineIndexCount-$U._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$s):(this._currentCombineIndexCount=this._currentCombineIndexCount-$U._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$U._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$U._finishInit=function(){if(this._needFinishCombine){var $V=0,$U=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $r=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$s=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$jU.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$$U.create("ushort",this._currentCombineIndexCount,35044);for(var $p=0,$c=this._initBatchRenderElements.length;$p<$c;$p++){var $R=this._initBatchRenderElements[$p],$T=$R.renderObj,$N=$T._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$R._sprite3D),$t=$T.getIndices(),$b=$R._sprite3D.transform._isFrontFaceInvert,$S=$V/(this._vertexDeclaration.vertexStride/4)-$T._vertexStart,$_=$U,$G=$_+$t.length;$R._batchIndexStart=$_,$R._batchIndexEnd=$G,$s.set($t,$U);var $q=0;if($b)for($q=$_;$q<$G;$q+=3){$s[$q]=$S+$s[$q];var $u=$s[$q+1],$h=$s[$q+2];$s[$q+1]=$S+$h,$s[$q+2]=$S+$u}else for($q=$_;$q<$G;$q+=3)$s[$q]=$S+$s[$q],$s[$q+1]=$S+$s[$q+1],$s[$q+2]=$S+$s[$q+2];$U+=$t.length,$r.set($N,$V),$V+=$N.length}this._vertexBuffer.setData($r),this._indexBuffer.setData($s),this._needFinishCombine=!1}},$U._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $yU)},$U._getRenderElement=function($V,$U,$r){for(var $s,$p,$c=this._batchRenderElements.length,$R=!0,$T=0;$T<$c;$T++){var $N,$t,$b=($p=this._batchRenderElements[$T])._sprite3D._render;if(0!==$T&&($R=($N=($s=this._batchRenderElements[$T-1])._sprite3D._render).lightmapIndex!==$b.lightmapIndex||$N.receiveShadow!==$b.receiveShadow||$s._batchIndexEnd!==$p._batchIndexStart),$R){($t=this._getCombineRenderElementFromPool()).renderObj=this,$t._material=this._material,$t._batchIndexStart=$p._batchIndexStart,$t._batchIndexEnd=$p._batchIndexEnd;var $S=$b.lightmapIndex,$_=$S+1,$G=this._batchOwnerIndices[$_];$G||($G=this._batchOwnerIndices[$_]=[]);var $q,$u=$G[$p._render.receiveShadow?1:0];void 0===$u?($G[$b.receiveShadow?1:0]=this._batchOwners.length,($q=new $eU(null,"StaticBatchMeshSprite3D"))._scene=$U,$q._transform=this._rootOwner?this._rootOwner._transform:null,$q._render.lightmapIndex=$S,$q._render.receiveShadow=$p._render.receiveShadow,this._batchOwners.push($q)):$q=this._batchOwners[$u],$q._render._renderUpdate($r),$t._sprite3D=$q,$V.push($t)}else $t._batchIndexEnd=$p._batchIndexEnd}},$U._beforeRender=function($V){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$U._render=function($V){var $U=$V.renderElement,$r=$U._batchIndexStart,$s=$U._batchIndexEnd-$r;$w.mainContext.drawElements(4,$s,5123,2*$r),$D.drawCall++,$D.trianglesFaces+=$s/3},$U.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$U._getVertexBuffer=function($V){return void 0===$V&&($V=0),this._vertexBuffer},$c}(),$QU=function($V){function $U(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$U.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$G($U,"laya.d3.core.ComponentNode",$t);var $r=$U.prototype;return $r.addComponent=function($V){var $U,$r=this._componentsMap.indexOf($V);if(-1===$r)$U=[],this._componentsMap.push($V),this._typeComponentsIndices.push($U);else if($U=this._typeComponentsIndices[$r],this._components[$U[0]].isSingleton)throw new Error("无法单实例创建"+$V+"组件，"+$V+"组件已存在！");var $s=$p.getInstance($V);return $U.push(this._components.length),this._components.push($s),$s instanceof laya.d3.component.Script&&this._scripts.push($s),$s._initialize(this),$s},$r._removeComponent=function($V,$U){var $r=this._typeComponentsIndices[$V],$s=$r[$U],$p=this._components[$s];this._components.splice($s,1),$p instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($p),1),$r.splice($U,1),0===$r.length&&(this._typeComponentsIndices.splice($V,1),this._componentsMap.splice($V,1));for(var $c=0,$R=this._componentsMap.length;$c<$R;$c++)for(var $T=($r=this._typeComponentsIndices[$c]).length-1;0<=$T;$T--){var $N=$r[$T];if(!($s<$N))break;$r[$T]=--$N}$p._destroy()},$r.getComponentByType=function($V,$U){void 0===$U&&($U=0);var $r=this._componentsMap.indexOf($V);return-1===$r?null:this._components[this._typeComponentsIndices[$r][$U]]},$r.getComponentsByType=function($V,$U){var $r=this._componentsMap.indexOf($V);if(-1!==$r){var $s=this._typeComponentsIndices[$r],$p=$s.length;$U.length=$p;for(var $c=0;$c<$p;$c++)$U[$c]=this._components[$s[$c]]}else $U.length=0},$r.getComponentByIndex=function($V){return this._components[$V]},$r.removeComponentByType=function($V,$U){void 0===$U&&($U=0);var $r=this._componentsMap.indexOf($V);-1!==$r&&this._removeComponent($r,$U)},$r.removeComponentsByType=function($V){var $U=this._componentsMap.indexOf($V);if(-1!==$U)for(var $r=this._typeComponentsIndices[$U],$s=0,$p=$r.length;$s<$p;$r.length<$p?$p--:$s++)this._removeComponent($U,$s)},$r.removeAllComponent=function(){for(var $V=0,$U=this._componentsMap.length;$V<$U;this._componentsMap.length<$U?$U--:$V++)this.removeComponentsByType(this._componentsMap[$V])},$r._updateComponents=function($V){for(var $U=0,$r=this._components.length;$U<$r;$U++){var $s=this._components[$U];!$s.started&&($s._start($V),$s.started=!0),$s.enable&&$s._update($V)}},$r._lateUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._lateUpdate($V)}},$r._preRenderUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._preRenderUpdate($V)}},$r._postRenderUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._postRenderUpdate($V)}},$U}(),$HU=function($s){function $V(){$V.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $_U,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $TU(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$G($V,"laya.d3.core.material.BaseMaterial",$s);var $U=$V.prototype;return $d.imps($U,{"laya.d3.core.IClone":!0}),$U._addShaderDefine=function($V){this._shaderDefineValue|=$V},$U._removeShaderDefine=function($V){this._shaderDefineValue&=~$V},$U._addDisablePublicShaderDefine=function($V){this._disablePublicShaderDefine|=$V},$U._removeDisablePublicShaderDefine=function($V){this._disablePublicShaderDefine&=~$V},$U._setBuffer=function($V,$U){this._shaderValues.setValue($V,$U),this._values[$V]=$U},$U._getBuffer=function($V){return this._values[$V]},$U._setMatrix4x4=function($V,$U){this._shaderValues.setValue($V,$U?$U.elements:null),this._values[$V]=$U},$U._getMatrix4x4=function($V){return this._values[$V]},$U._setInt=function($V,$U){this._shaderValues.setValue($V,$U),this._values[$V]=$U},$U._getInt=function($V){return this._values[$V]},$U._setNumber=function($V,$U){this._shaderValues.setValue($V,$U),this._values[$V]=$U},$U._getNumber=function($V){return this._values[$V]},$U._setBool=function($V,$U){this._shaderValues.setValue($V,$U),this._values[$V]=$U},$U._getBool=function($V){return this._values[$V]},$U._setVector2=function($V,$U){this._shaderValues.setValue($V,$U?$U.elements:null),this._values[$V]=$U},$U._getVector2=function($V){return this._values[$V]},$U._setColor=function($V,$U){this._shaderValues.setValue($V,$U?$U.elements:null),this._values[$V]=$U},$U._getColor=function($V){return this._values[$V]},$U._setTexture=function($V,$U){var $r=this._values[$V];this._values[$V]=$U,this._shaderValues.setValue($V,$U),0<this.referenceCount&&($r&&$r._removeReference(),$U&&$U._addReference())},$U._getTexture=function($V){return this._values[$V]},$U._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$U._getShader=function($V,$U,$r){var $s=($V|$U)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($s,$r,this._shaderDefineValue),this._shader},$U._setRenderStateBlendDepth=function(){var $V=$w.mainContext;switch($z.setDepthMask($V,this.depthWrite),0===this.depthTest?$z.setDepthTest($V,!1):($z.setDepthTest($V,!0),$z.setDepthFunc($V,this.depthTest)),this.blend){case 0:$z.setBlend($V,!1);break;case 1:$z.setBlend($V,!0),$z.setBlendFunc($V,this.srcBlend,this.dstBlend);break;case 2:$z.setBlend($V,!0)}},$U._setRenderStateFrontFace=function($V,$U){var $r=$w.mainContext,$s=0;switch(this.cull){case 0:$z.setCullFace($r,!1);break;case 1:$z.setCullFace($r,!0),$s=$V?$U&&$U._isFrontFaceInvert?2305:2304:$U&&$U._isFrontFaceInvert?2304:2305,$z.setFrontFace($r,$s);break;case 2:$z.setCullFace($r,!0),$s=$V?$U&&$U._isFrontFaceInvert?2304:2305:$U&&$U._isFrontFaceInvert?2305:2304,$z.setFrontFace($r,$s)}},$U.onAsynLoaded=function($V,$U,$r){var $s=$U[0],$p=$U[1];switch($s.version){case"LAYAMATERIAL:01":var $c=0,$R=0,$T=$s.props;for(var $N in $T)switch($N){case"vectors":var $t=$T[$N];for($c=0,$R=$t.length;$c<$R;$c++){var $b=$t[$c],$S=$b.value;switch($S.length){case 2:this[$b.name]=new $cU($S[0],$S[1]);break;case 3:this[$b.name]=new $RU($S[0],$S[1],$S[2]);break;case 4:this[$b.name]=new $TU($S[0],$S[1],$S[2],$S[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $_=$T[$N];for($c=0,$R=$_.length;$c<$R;$c++){var $G=$_[$c],$q=$G.path;$q&&(this[$G.name]=$l.getRes($p[$q]))}break;case"defines":var $u=$T[$N];for($c=0,$R=$u.length;$c<$R;$c++){var $h=this._shaderCompile.getMaterialDefineByName($u[$c]);this._addShaderDefine($h)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$N]=$T[$N];break;case"renderQueue":switch($T[$N]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$N]=$T[$N]}break;case"LAYAMATERIAL:02":for($N in $T=$s.props)switch($N){case"vectors":for($c=0,$R=($t=$T[$N]).length;$c<$R;$c++)switch(($S=($b=$t[$c]).value).length){case 2:this[$b.name]=new $cU($S[0],$S[1]);break;case 3:this[$b.name]=new $RU($S[0],$S[1],$S[2]);break;case 4:this[$b.name]=new $TU($S[0],$S[1],$S[2],$S[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($c=0,$R=($_=$T[$N]).length;$c<$R;$c++)($q=($G=$_[$c]).path)&&(this[$G.name]=$l.getRes($p[$q]));break;case"defines":for($c=0,$R=($u=$T[$N]).length;$c<$R;$c++)$h=this._shaderCompile.getMaterialDefineByName($u[$c]),this._addShaderDefine($h);break;default:this[$N]=$T[$N]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$U._addReference=function(){$s.prototype._addReference.call(this);for(var $V=0,$U=this._values.length;$V<$U;$V++){var $r=this._values[$V];$r&&$r instanceof laya.d3.resource.BaseTexture&&$r._addReference()}},$U._removeReference=function(){$s.prototype._removeReference.call(this);for(var $V=0,$U=this._values.length;$V<$U;$V++){var $r=this._values[$V];$r&&$r instanceof laya.d3.resource.BaseTexture&&$r._removeReference()}},$U.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$U.setShaderName=function($V){var $U=$ZU.nameKey.getID($V);if(-1===$U)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$DU._preCompileShader[$U]},$U.cloneTo=function($V){var $U=$V;$U.name=this.name,$U.cull=this.cull,$U.blend=this.blend,$U.srcBlend=this.srcBlend,$U.dstBlend=this.dstBlend,$U.srcBlendRGB=this.srcBlendRGB,$U.dstBlendRGB=this.dstBlendRGB,$U.srcBlendAlpha=this.srcBlendAlpha,$U.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($U.blendConstColor),$U.blendEquation=this.blendEquation,$U.blendEquationRGB=this.blendEquationRGB,$U.blendEquationAlpha=this.blendEquationAlpha,$U.depthTest=this.depthTest,$U.depthWrite=this.depthWrite,$U.renderQueue=this.renderQueue,$U._shader=this._shader,$U._disablePublicShaderDefine=this._disablePublicShaderDefine,$U._shaderDefineValue=this._shaderDefineValue;var $r,$s=0,$p=$U._shaderValues;$U._shaderValues.data.length=this._shaderValues.data.length;var $c=this._values.length,$R=$U._values;for($s=0,$r=$R.length=$c;$s<$r;$s++){var $T=this._values[$s];if($T)if("number"==typeof $T)$R[$s]=$T,$p.data[$s]=$T;else if("number"==typeof $T&&Math.floor($T)==$T)$R[$s]=$T,$p.data[$s]=$T;else if("boolean"==typeof $T)$R[$s]=$T,$p.data[$s]=$T;else if($T instanceof laya.d3.math.Vector2){var $N=$R[$s]||($R[$s]=new $cU);$T.cloneTo($N),$p.data[$s]=$N.elements}else if($T instanceof laya.d3.math.Vector3){var $t=$R[$s]||($R[$s]=new $RU);$T.cloneTo($t),$p.data[$s]=$t.elements}else if($T instanceof laya.d3.math.Vector4){var $b=$R[$s]||($R[$s]=new $TU);$T.cloneTo($b),$p.data[$s]=$b.elements}else if($T instanceof laya.d3.math.Matrix4x4){var $S=$R[$s]||($R[$s]=new $VU);$T.cloneTo($S),$p.data[$s]=$S.elements}else $T instanceof laya.d3.resource.BaseTexture&&($R[$s]=$T,$p.data[$s]=$T)}},$U.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$q(0,$U,"alphaTestValue",function(){return this._getNumber(0)},function($V){this._setNumber(0,$V)}),$q(0,$U,"alphaTest",function(){return this._alphaTest},function($V){(this._alphaTest=$V)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$V.__init__=function(){$V.SHADERDEFINE_ALPHATEST=$V.shaderDefines.registerDefine("ALPHATEST")},$V.RENDERQUEUE_OPAQUE=2e3,$V.RENDERQUEUE_ALPHATEST=2450,$V.RENDERQUEUE_TRANSPARENT=3e3,$V.CULL_NONE=0,$V.CULL_FRONT=1,$V.CULL_BACK=2,$V.BLEND_DISABLE=0,$V.BLEND_ENABLE_ALL=1,$V.BLEND_ENABLE_SEPERATE=2,$V.BLENDPARAM_ZERO=0,$V.BLENDPARAM_ONE=1,$V.BLENDPARAM_SRC_COLOR=768,$V.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$V.BLENDPARAM_DST_COLOR=774,$V.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$V.BLENDPARAM_SRC_ALPHA=770,$V.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$V.BLENDPARAM_DST_ALPHA=772,$V.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$V.BLENDPARAM_SRC_ALPHA_SATURATE=776,$V.BLENDEQUATION_ADD=0,$V.BLENDEQUATION_SUBTRACT=1,$V.BLENDEQUATION_REVERSE_SUBTRACT=2,$V.DEPTHTEST_OFF=0,$V.DEPTHTEST_NEVER=512,$V.DEPTHTEST_LESS=513,$V.DEPTHTEST_EQUAL=514,$V.DEPTHTEST_LEQUAL=515,$V.DEPTHTEST_GREATER=516,$V.DEPTHTEST_NOTEQUAL=517,$V.DEPTHTEST_GEQUAL=518,$V.DEPTHTEST_ALWAYS=519,$V.SHADERDEFINE_ALPHATEST=1,$V.ALPHATESTVALUE=0,$S($V,["shaderDefines",function(){return this.shaderDefines=new $bU}]),$V}($h),$wU=function($V){function $U(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$U.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$G($U,"laya.d3.resource.BaseTexture",$h);var $r=$U.prototype;return $q(0,$r,"width",function(){return this._width}),$q(0,$r,"repeat",function(){return this._repeat},function($V){if(this._repeat!==$V&&(this._repeat=$V,this._source)){var $U=$w.mainContext;$z.bindTexture($U,this._type,this._source),$L.isPOT(this._width,this._height)&&this._repeat?($U.texParameteri(this._type,10242,10497),$U.texParameteri(this._type,10243,10497)):($U.texParameteri(this._type,10242,33071),$U.texParameteri(this._type,10243,33071))}}),$q(0,$r,"height",function(){return this._height}),$q(0,$r,"magFifter",function(){return this._magFifter},function($V){(this._magFifter=$V)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($V)}),$q(0,$r,"wrapModeV",function(){return this._wrapModeV}),$q(0,$r,"size",function(){return this._size}),$q(0,$r,"wrapModeU",function(){return this._wrapModeU}),$q(0,$r,"mipmap",function(){return this._mipmap},function($V){this._mipmap=$V,this._mipmap!=$V&&this._conchTexture&&this._conchTexture.setMipMap($V)}),$q(0,$r,"minFifter",function(){return this._minFifter},function($V){this._minFifter=$V,this._minFifter!=$V&&this._conchTexture&&this._conchTexture.setMinFifter($V)}),$q(0,$r,"format",function(){return this._format}),$q(0,$r,"source",function(){return this.activeResource(),this._source}),$q(0,$r,"defaulteTexture",function(){return $BU.grayTexture}),$U.WARPMODE_REPEAT=0,$U.WARPMODE_CLAMP=1,$U}(),$zU=function($V){function $U(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$U.__super.call(this),this._boundingBoxCorners=$s(8,null)}$G($U,"laya.d3.resource.models.BaseMesh",$h);var $r=$U.prototype;return $r._getPositions=function(){throw new Error("未Override,请重载该属性！")},$r._generateBoundingObject=function(){this._boundingSphere=new $YV(new $RU,0),$YV.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $gV(new $RU,new $RU),$gV.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$r.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$r.getRenderElement=function($V){throw new Error("未Override,请重载该属性！")},$q(0,$r,"subMeshCount",function(){return this._subMeshCount}),$q(0,$r,"boundingBox",function(){return this._boundingBox}),$q(0,$r,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$q(0,$r,"boundingSphere",function(){return this._boundingSphere}),$U}(),$EU=(function($V){function $U(){$U.__super.call(this)}$G($U,"laya.d3.component.Script",$OU);var $r=$U.prototype;$r.onTriggerEnter=function($V){},$r.onTriggerExit=function($V){},$r.onTriggerStay=function($V){},$q(0,$r,"isSingleton",function(){return $U._isSingleton}),$U._isSingleton=!1}(),function($V){function $U($V){this._owner=null,this._sharedMesh=null,$U.__super.call(this),this._owner=$V}$G($U,"laya.d3.core.MeshFilter",$V);var $r=$U.prototype;return $r._sharedMeshLoaded=function(){this.event("loaded")},$r._destroy=function(){$V.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$q(0,$r,"sharedMesh",function(){return this._sharedMesh},function($V){var $U=this._sharedMesh;$U&&$U._removeReference(),(this._sharedMesh=$V)._addReference(),this.event("meshchanged",[this,$U,$V]),$V.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$q(0,$r,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$q(0,$r,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$q(0,$r,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$q(0,$r,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$U}($LU)),$KU=function($V){function $U($V){$U.__super.call(this,$V),$V.meshFilter.on("meshchanged",this,this._onMeshChanged)}$G($U,"laya.d3.core.MeshRender",$dU);var $r=$U.prototype;return $r._onMeshChanged=function($V,$U,$r){$r.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$r.once("loaded",this,this._onMeshLoaed)},$r._onMeshLoaed=function($V,$U){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$r._calculateBoundingSphereByInitSphere=function($V){var $U=NaN,$r=this._owner.transform,$s=$r.scale.elements,$p=Math.abs($s[0]),$c=Math.abs($s[1]),$R=Math.abs($s[2]);$U=$c<=$p&&$R<=$p?$p:$R<=$c?$c:$R,$RU.transformCoordinate($V.center,$r.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$V.radius*$U},$r._calculateBoundBoxByInitCorners=function($V){for(var $U=this._owner.transform.worldMatrix,$r=0;$r<8;$r++)$RU.transformCoordinate($V[$r],$U,$dU._tempBoundBoxCorners[$r]);$gV.createfromPoints($dU._tempBoundBoxCorners,this._boundingBox)},$r._calculateBoundingSphere=function(){var $V=this._owner.meshFilter.sharedMesh;null==$V||null==$V.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($V.boundingSphere)},$r._calculateBoundingBox=function(){var $V=this._owner.meshFilter.sharedMesh;null==$V||null==$V.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($V.boundingBoxCorners)},$r._renderUpdate=function($V){var $U=this._owner.transform;if($U){this._setShaderValueMatrix4x4(0,$U.worldMatrix);var $r=this._owner.getProjectionViewWorldMatrix($V);this._setShaderValueMatrix4x4(1,$r)}else this._setShaderValueMatrix4x4(0,$VU.DEFAULT),this._setShaderValueMatrix4x4(1,$V);return $lU.debugMode&&this._renderRenderableBoundBox(),!0},$U}(),$mU=function($U){function $s(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$s.__super.call(this),this._renderState=new $F,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $_U,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $UV,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $RU(.7,.7,.7),this.ambientColor=new $RU(.212,.227,.259),$w.shaderHighPrecision&&this.addShaderDefine($DU.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$G($s,"laya.d3.core.scene.Scene",$U);var $V=$s.prototype;return $d.imps($V,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$V._setUrl=function($V){this._url=$V},$V._getGroup=function(){return this._group},$V._setGroup=function($V){this._group=$V},$V._display=function(){$d.stage._scenes.push(this),$d.stage._scenes.sort($s._sortScenes);for(var $V=0,$U=this._childs.length;$V<$U;$V++){var $r=this._childs[$V];$r.active&&$r._activeHierarchy()}},$V._unDisplay=function(){var $V=$d.stage._scenes;$V.splice($V.indexOf(this),1);for(var $U=0,$r=this._childs.length;$U<$r;$U++){var $s=this._childs[$U];$s.active&&$s._inActiveHierarchy()}},$V._addChild3D=function($V){$V.transform._onWorldTransform(),$V._setBelongScene(this),this.displayedInStage&&$V.active&&$V._activeHierarchy()},$V._removeChild3D=function($V){$V.transform.parent=null,this.displayedInStage&&$V.active&&$V._inActiveHierarchy(),$V._setUnBelongScene()},$V.initOctree=function($V,$U,$r,$s,$p){void 0===$p&&($p=6),this.treeSize=new $RU($V,$U,$r),this.treeLevel=$p,this.treeRoot=new $g(this,0),this.treeRoot.init($s,this.treeSize)},$V._prepareUpdateToRenderState=function($V,$U){$U.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$U.scene=this},$V._prepareSceneToRender=function($V){var $U=this._lights.length;if(0<$U)for(var $r=0,$s=0;$s<$U&&!(this._lights[$s]._prepareToScene($V)&&++$r>=this._enableLightCount);$s++);},$V._updateChilds=function($V){for(var $U=0,$r=this._childs.length;$U<$r;++$U)this._childs[$U]._update($V)},$V._preRenderScene=function($V,$U,$r){var $s,$p=$U._viewMatrix,$c=$U._projectionMatrix,$R=$U._projectionViewMatrix,$T=0,$N=$U.camera;for($N.useOcclusionCulling?this.treeRoot?$rV.renderObjectCullingOctree($r,this,$N,$p,$c,$R):$rV.renderObjectCulling($r,this,$N,$p,$c,$R):$rV.renderObjectCullingNoBoundFrustum(this,$N,$p,$c,$R),$T=0,$s=this._quenes.length;$T<$s;$T++)this._quenes[$T]&&this._quenes[$T]._preRender($U)},$V._clear=function($V,$U){var $r=$U._viewport,$s=$U.camera,$p=$r.x,$c=$s.renderTargetSize.height-$r.y-$r.height,$R=$r.width,$T=$r.height;$V.viewport($p,$c,$R,$T);var $N=256,$t=$s.renderTarget;switch($s.clearFlag){case 0:var $b=$s.clearColor;if($b){$V.enable(3089),$V.scissor($p,$c,$R,$T);var $S=$b.elements;$V.clearColor($S[0],$S[1],$S[2],$S[3]),$N|=16384}if($t)switch($b||($N=16384),$t.depthStencilFormat){case 33189:$N|=256;break;case 36168:$N|=1024;break;case 34041:$N|=256,$N|=1024}$V.clear($N),$b&&$V.disable(3089);break;case 1:case 2:if($t)switch($N=16384,$t.depthStencilFormat){case 33189:$N|=256;break;case 36168:$N|=1024;break;case 34041:$N|=256,$N|=1024}$V.clear($N);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$V._renderScene=function($V,$U){var $r,$s,$p=$U.camera,$c=0;for($c=0;$c<2;$c++)($s=this._quenes[$c])&&($p.renderTarget?$s._render($U,!0):$s._render($U,!1));if(1===$p.clearFlag){var $R=$p.sky;$R&&($z.setCullFace($V,!1),$z.setDepthFunc($V,515),$z.setDepthMask($V,!1),$R._render($U),$z.setDepthFunc($V,513),$z.setDepthMask($V,!0))}for($c=2,$r=this._quenes.length;$c<$r;$c++)($s=this._quenes[$c])&&($s._sortAlpha($U.camera.transform.position),$p.renderTarget?$s._render($U,!0):$s._render($U,!1))},$V._set3DRenderConfig=function($V){$V.disable(3042),$z._blend=!1,$V.blendFunc(770,771),$z._sFactor=770,$z._dFactor=771,$V.disable(2929),$z._depthTest=!1,$V.enable(2884),$z._cullFace=!0,$V.depthMask(1),$z._depthMask=!0,$V.frontFace(2304),$z._frontFace=2304},$V._set2DRenderConfig=function($V){$z.setBlend($V,!0),$z.setBlendFunc($V,1,771),$z.setDepthTest($V,!1),$z.setCullFace($V,!1),$z.setDepthMask($V,!0),$z.setFrontFace($V,2305),$V.viewport(0,0,$b.width,$b.height)},$V._parseCustomProps=function($V,$U,$r,$s){var $p=$s.customProps.lightmaps,$c=$p.length,$R=this._lightmaps;$R.length=$c;for(var $T=0;$T<$c;$T++)$R[$T]=$l.getRes($U[$p[$T].replace(".exr",".png")]);this.setlightmaps($R);var $N=$s.customProps.ambientColor;$N&&(this.ambientColor=new $RU($N[0],$N[1],$N[2]));var $t=$s.customProps.fogColor;$t&&(this.fogColor=new $RU($t[0],$t[1],$t[2]))},$V._addLight=function($V){this._lights.indexOf($V)<0&&this._lights.push($V)},$V._removeLight=function($V){var $U=this._lights.indexOf($V);0<=$U&&this._lights.splice($U,1)},$V._updateScene=function(){var $V=this._renderState;this._prepareUpdateToRenderState($w.mainContext,$V),this._updateComponents($V),this._updateChilds($V),this._lateUpdateComponents($V),this._time+=$V.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$V._updateSceneConch=function(){var $V=this._renderState;this._prepareUpdateToRenderState($w.mainContext,$V),this._updateComponents($V),this._lateUpdateComponents($V),this._prepareSceneToRender($V);for(var $U=0,$r=this._cameraPool.length;$U<$r;$U++){var $s=this._cameraPool[$U];($V.camera=$s)._prepareCameraToRender()}},$V._preRenderShadow=function($V,$U,$r,$s,$p){this.treeRoot?$rV.renderShadowObjectCullingOctree(this,$U,$r,$s,$p):$rV.renderShadowObjectCulling(this,$U,$r,$s,$p);for(var $c=0,$R=$r.length;$c<$R;$c++)$r[$c]&&$r[$c]._preRender($V)},$V._renderShadowMap=function($V,$U,$r){var $s=this.parallelSplitShadowMaps[0];$s._calcAllLightCameraInfo($r);var $p,$c,$R,$T=$s.PSSMNum;if(this._preRenderShadow($U,$s._lightCulling,$s._shadowQuenes,$s._lightVPMatrix[0],$T),this.addShaderDefine($GU.SHADERDEFINE_CAST_SHADOW),1<$T)for(var $N=0;$N<$T;$N++)$p=$s.getRenderTarget($N+1),$s.beginRenderTarget($N+1),$V.clearColor(1,1,1,1),$V.clear(16640),$V.viewport(0,0,$p.width,$p.height),$U.camera=$R=$s.getLightCamera($N),$R._prepareCameraToRender(),$R._prepareCameraViewProject($R.viewMatrix,$R.projectionMatrix),$U._projectionViewMatrix=$s._lightVPMatrix[$N+1],($c=$s._shadowQuenes[$N])._preRender($U),$c._renderShadow($U,!1),$s.endRenderTarget($N+1);else $p=$s.getRenderTarget(1),$s.beginRenderTarget(1),$V.clearColor(1,1,1,1),$V.clear(16640),$V.viewport(0,0,$p.width,$p.height),$U.camera=$R=$s.getLightCamera(0),$R._prepareCameraToRender(),$R._prepareCameraViewProject($R.viewMatrix,$R.projectionMatrix),$U._projectionViewMatrix=$s._lightVPMatrix[0],($c=$s._shadowQuenes[0])._preRender($U),$c._renderShadow($U,!0),$s.endRenderTarget(1);this.removeShaderDefine($GU.SHADERDEFINE_CAST_SHADOW)},$V.addTreeNode=function($V){this.treeRoot.addTreeNode($V)},$V.removeTreeNode=function($V){this.treeSize&&$V._treeNode&&$V._treeNode.removeObject($V)},$V.setlightmaps=function($V){this._lightmaps=$V;for(var $U=0,$r=this._renderableSprite3Ds.length;$U<$r;$U++)this._renderableSprite3Ds[$U]._render._applyLightMapParams()},$V.getlightmaps=function(){return this._lightmaps},$V.addChildAt=function($V,$U){if(!($V instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($V&&$V.__className));if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),0<=$U&&$U<=this._childs.length){if($V._parent===this){var $r=this.getChildIndex($V);this._childs.splice($r,1),this._childs.splice($U,0,$V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,$U)),this._childChanged()}else $V.parent&&$V.parent.removeChild($V),this._childs===$t.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($U,0,$V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,$U),($V.parent=this)._addChild3D($V);return $V}throw new Error("appendChildAt:The index is out of bounds")},$V.addChild=function($V){if(!($V instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),$V._parent===this){var $U=this.getChildIndex($V);$U!==this._childs.length-1&&(this._childs.splice($U,1),this._childs.push($V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,this._childs.length-1)),this._childChanged())}else $V.parent&&$V.parent.removeChild($V),this._childs===$t.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,this._childs.length-1),($V.parent=this)._childChanged(),this._addChild3D($V);return $V},$V.removeChildAt=function($V){var $U=this.getChildAt($V);return $U&&(this._removeChild3D($U),this._childs.splice($V,1),this.conchModel&&this.conchModel.removeChild($U.conchModel),$U.parent=null),$U},$V.removeChildren=function($V,$U){if(void 0===$V&&($V=0),void 0===$U&&($U=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$V&&$c<=$U){var $s=$r;this._childs=$t.ARRAY_EMPTY}else $s=$r.splice($V,$U-$V);for(var $p=0,$c=$s.length;$p<$c;$p++)this._removeChild3D($s[$p]),$s[$p].parent=null,this.conchModel&&this.conchModel.removeChild($s[$p].conchModel)}return this},$V.addFrustumCullingObject=function($V){this.treeRoot?this.addTreeNode($V):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($V):this._cullingRenders[this._cullingRendersLength]=$V,$V._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$V.removeFrustumCullingObject=function($V){if(this.treeRoot)this.removeTreeNode($V);else{this._cullingRendersLength--;var $U=$V._indexInSceneFrustumCullingObjects;if($U!==this._cullingRendersLength){var $r=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$U]=$r)._indexInSceneFrustumCullingObjects=$U,$V._indexInSceneFrustumCullingObjects=-1}}},$V.getRenderQueue=function($V){return $V<3e3?this._quenes[1]||(this._quenes[1]=new $e(this)):this._quenes[2]||(this._quenes[2]=new $e(this))},$V.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $e(this)},$V.addShaderDefine=function($V){this._shaderDefineValue|=$V},$V.removeShaderDefine=function($V){this._shaderDefineValue&=~$V},$V.addScript=function($V){return this._addComponent($V)},$V.getScriptByType=function($V,$U){return void 0===$U&&($U=0),this._getComponentByType($V,$U)},$V.getScriptsByType=function($V,$U){this._getComponentsByType($V,$U)},$V.getScriptByIndex=function($V){return this._getComponentByIndex($V)},$V.removeScriptByType=function($V,$U){void 0===$U&&($U=0),this._removeComponentByType($V,$U)},$V.removeScriptsByType=function($V){this._removeComponentByType($V)},$V.removeAllScript=function(){this._removeAllComponent()},$V.render=function($V,$U,$r){($u._context.ctx._renderKey=0)<this._childs.length&&$V.addRenderObject(this)},$V.renderSubmit=function(){var $V=$w.mainContext,$U=this._renderState;this._set3DRenderConfig($V),this._prepareSceneToRender(this._renderState);var $r,$s=0,$p=0;if($lU.debugMode||$g.debugMode)for($s=0,$p=this._cameraPool.length;$s<$p;$s++)$r=this._cameraPool[$s],$lU._debugPhasorSprite.begin(1,$r),$r.activeInHierarchy&&$r._renderCamera($V,$U,this),$lU._debugPhasorSprite.end();else for($s=0,$p=this._cameraPool.length;$s<$p;$s++)($r=this._cameraPool[$s]).activeInHierarchy&&$r._renderCamera($V,$U,this);return this._set2DRenderConfig($V),1},$V.onAsynLoaded=function($V,$U,$r){var $s=$U[0];if("Scene"!==$s.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $p=$U[1];$hU._createNodeByJson(this,$s,this,$p),this.event("hierarchyloaded",[this]),this.__loaded=!0},$V.destroy=function($V){void 0===$V&&($V=!0),this.destroyed||($U.prototype.destroy.call(this,$V),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$l.clearRes(this.url),this.loaded||$lU._cancelLoadByUrl(this.url))},$V.getRenderType=function(){return 0},$V.releaseRender=function(){},$V._addComponent=function($V){var $U,$r=this._componentsMap.indexOf($V);if(-1===$r)$U=[],this._componentsMap.push($V),this._typeComponentsIndices.push($U);else if($U=this._typeComponentsIndices[$r],this._components[$U[0]].isSingleton)throw new Error("无法单实例创建"+$V+"组件，"+$V+"组件已存在！");var $s=$p.getInstance($V);$U.push(this._components.length),this._components.push($s);return $s._initialize(this),$s},$V._removeComponent=function($V,$U){var $r=this._typeComponentsIndices[$V],$s=$r[$U],$p=this._components[$s];this._components.splice($s,1),$r.splice($U,1),0===$r.length&&(this._typeComponentsIndices.splice($V,1),this._componentsMap.splice($V,1));for(var $c=0,$R=this._componentsMap.length;$c<$R;$c++)for(var $T=($r=this._typeComponentsIndices[$c]).length-1;0<=$T;$T--){var $N=$r[$T];if(!($s<$N))break;$r[$T]=--$N}$p._destroy()},$V._getComponentByType=function($V,$U){void 0===$U&&($U=0);var $r=this._componentsMap.indexOf($V);return-1===$r?null:this._components[this._typeComponentsIndices[$r][$U]]},$V._getComponentsByType=function($V,$U){var $r=this._componentsMap.indexOf($V);if(-1!==$r){var $s=this._typeComponentsIndices[$r],$p=$s.length;$U.length=$p;for(var $c=0;$c<$p;$c++)$U[$c]=this._components[$s[$c]]}else $U.length=0},$V._getComponentByIndex=function($V){return this._components[$V]},$V._removeComponentByType=function($V,$U){void 0===$U&&($U=0);var $r=this._componentsMap.indexOf($V);-1!==$r&&this._removeComponent($r,$U)},$V._removeComponentsByType=function($V){var $U=this._componentsMap.indexOf($V);if(-1!==$U)for(var $r=this._typeComponentsIndices[$U],$s=0,$p=$r.length;$s<$p;$r.length<$p?$p--:$s++)this._removeComponent($U,$s)},$V._removeAllComponent=function(){for(var $V=0,$U=this._componentsMap.length;$V<$U;this._componentsMap.length<$U?$U--:$V++)this._removeComponentsByType(this._componentsMap[$V])},$V._updateComponents=function($V){for(var $U=0,$r=this._components.length;$U<$r;$U++){var $s=this._components[$U];!$s.started&&($s._start($V),$s.started=!0),$s.enable&&$s._update($V)}},$V._lateUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._lateUpdate($V)}},$V._preRenderUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._preRenderUpdate($V)}},$V._postRenderUpdateComponents=function($V){for(var $U=0;$U<this._components.length;$U++){var $r=this._components[$U];!$r.started&&($r._start($V),$r.started=!0),$r.enable&&$r._postRenderUpdate($V)}},$q(0,$V,"_loaded",null,function($V){this.__loaded=$V}),$q(0,$V,"fogColor",function(){return this._fogColor},function($V){this._fogColor=$V,this._shaderValues.setValue(0,$V.elements)}),$q(0,$V,"enableFog",function(){return this._enableFog},function($V){this._enableFog!==$V&&((this._enableFog=$V)?(this.addShaderDefine($DU.SHADERDEFINE_FOG),this.removeShaderDefine($DU.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($DU.SHADERDEFINE_FOG))}),$q(0,$V,"url",function(){return this._url}),$q(0,$V,"loaded",function(){return this.__loaded}),$q(0,$V,"enableDepthFog",function(){return this._enableDepthFog},function($V){this._enableDepthFog!=$V&&((this._enableDepthFog=$V)?(this.addShaderDefine($DU.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($DU.SHADERDEFINE_FOG)):this.removeShaderDefine($DU.SAHDERDEFINE_DEPTHFOG))}),$q(0,$V,"fogStart",function(){return this._fogStart},function($V){this._fogStart=$V,this._shaderValues.setValue(1,$V)}),$q(0,$V,"fogRange",function(){return this._fogRange},function($V){this._fogRange=$V,this._shaderValues.setValue(2,$V)}),$q(0,$V,"ambientColor",function(){return this._ambientColor},function($V){this._ambientColor=$V,this._shaderValues.setValue(21,$V.elements)}),$q(0,$V,"scene",function(){return this}),$q(0,$V,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$s._sortScenes=function($V,$U){if($V.parent!==$d.stage||$U.parent!==$d.stage)return $V.parent!==$d.stage&&$U.parent!==$d.stage?$s._sortScenes($V.parent,$U.parent):$V.parent===$d.stage?-1:1;var $r=$d.stage._childs;return $r.indexOf($V)-$r.indexOf($U)},$s.load=function($V){return $d.loader.create($V,null,null,$s)},$s.FOGCOLOR=0,$s.FOGSTART=1,$s.FOGRANGE=2,$s.LIGHTDIRECTION=3,$s.LIGHTDIRCOLOR=4,$s.POINTLIGHTPOS=5,$s.POINTLIGHTRANGE=6,$s.POINTLIGHTATTENUATION=7,$s.POINTLIGHTCOLOR=8,$s.SPOTLIGHTPOS=9,$s.SPOTLIGHTDIRECTION=10,$s.SPOTLIGHTSPOT=11,$s.SPOTLIGHTRANGE=12,$s.SPOTLIGHTATTENUATION=13,$s.SPOTLIGHTCOLOR=14,$s.SHADOWDISTANCE=15,$s.SHADOWLIGHTVIEWPROJECT=16,$s.SHADOWMAPPCFOFFSET=17,$s.SHADOWMAPTEXTURE1=18,$s.SHADOWMAPTEXTURE2=19,$s.SHADOWMAPTEXTURE3=20,$s.AMBIENTCOLOR=21,$s.TIME=22,$s}($y),$aU=function($V){function $U($V){$U.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $VU,this._shaderValues=new $_U,this._colliders=[],this._id=++$U._uniqueIDCounter,this._transform=new $kU(this),this.name=$V||"Sprite3D-"+$U._nameNumberCounter++,this.layer=$K.currentCreationLayer,this.active=!0}$G($U,"laya.d3.core.Sprite3D",$QU);var $r=$U.prototype;return $d.imps($r,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$r._setUrl=function($V){this._url=$V},$r._getGroup=function(){return this._group},$r._setGroup=function($V){this._group=$V},$r._addChild3D=function($V){$V.transform.parent=this.transform,this._hierarchyAnimator&&(!$V._hierarchyAnimator&&$V._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($V,!0,[$V.name])),this._scene&&($V._setBelongScene(this._scene),this._activeInHierarchy&&$V._active&&$V._activeHierarchy())},$r._removeChild3D=function($V){$V.transform.parent=null,this._scene&&(this._activeInHierarchy&&$V._active&&$V._inActiveHierarchy(),$V._setUnBelongScene()),this._hierarchyAnimator&&($V._hierarchyAnimator==this._hierarchyAnimator&&$V._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($V,!1,[$V.name]))},$r._parseBaseCustomProps=function($V){var $U=this.transform.localPosition;$V.translate?($U.fromArray($V.translate),$U.x*=100,$U.y*=100,$U.z*=100):$U.elements.fill(0),this.transform.localPosition=$U;var $r=this.transform.localRotation;$V.rotation?$r.fromArray($V.rotation):$r.fromArray([0,0,0,-1]),this.transform.localRotation=$r;var $s=this.transform.localScale;$V.scale?$s.fromArray($V.scale):$s.elements.fill(1),this.transform.localScale=$s;var $p=$V.layer;null!=$p&&(this.layer=$K.getLayerByNumber($p))},$r._parseCustomComponent=function($V,$U,$r){for(var $s in $r){var $p=$r[$s];switch($s){case"Animator":var $c=this.addComponent(Animator);if($p.avatarPath)$c.avatar=$l.getRes($U[$p.avatarPath]);else{var $R=$p.avatar;if($R){$c.avatar=$l.getRes($U[$R.path]);var $T=$R.linkSprites;$T&&$V.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$c,$T])}}for(var $N=$p.clipPaths,$t=$N.length,$b=0;$b<$t;$b++)$c.addClip($l.getRes($U[$N[$b]]));$c.clip=$l.getRes($U[$N[0]]);var $S=$p.playOnWake;void 0!==$S&&($c.playOnWake=$S);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $_=this.addComponent(SphereCollider);$_.isTrigger=$p.isTrigger;var $G=$_.center;$G.fromArray($p.center),$_.center=$G,$_.radius=$p.radius;break;case"BoxCollider":var $q=this.addComponent(BoxCollider);$q.isTrigger=$p.isTrigger,$q.center.fromArray($p.center);var $u=$q.size;$u.fromArray($p.size),$q.size=$u;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$r._onRootNodeHierarchyLoaded=function($V,$U){for(var $r in $U){for(var $s=this,$p=$U[$r],$c=0,$R=$p.length;$c<$R;$c++){var $T=$p[$c];if(""===$T)break;if(!($s=$s.getChildByName($T)))break}$s&&$V.linkSprite3DToAvatarNode($r,$s)}},$r._setHierarchyAnimator=function($V,$U){this._changeHierarchyAnimator($V);for(var $r=0,$s=this._childs.length;$r<$s;$r++){var $p=this._childs[$r];$p._hierarchyAnimator==$U&&$p._setHierarchyAnimator($V,$U)}},$r._clearHierarchyAnimator=function($V,$U){this._changeHierarchyAnimator($U);for(var $r=0,$s=this._childs.length;$r<$s;$r++){var $p=this._childs[$r];$p._hierarchyAnimator==$V&&$p._clearHierarchyAnimator($V,$U)}},$r._getAnimatorToLinkSprite3D=function($V,$U,$r){var $s=this.getComponentByType(Animator);if($s&&($s.avatar?$s.avatar._version||$V._setAnimatorToLinkAvatar($s,$U):$V._setAnimatorToLinkSprite3DNoAvatar($s,$U,$r)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$r.unshift(this._parent.name);var $p=this._parent;$p._hierarchyAnimator&&$p._getAnimatorToLinkSprite3D($V,$U,$r)}},$r._setAnimatorToLinkSprite3DNoAvatar=function($V,$U,$r){var $s=0,$p=0;for($s=0,$p=$V.getClipCount();$s<$p;$s++)$V._handleSpriteOwnersBySprite($s,$U,$r,this);for($s=0,$p=this._childs.length;$s<$p;$s++){var $c=this._childs[$s],$R=$r.length;$r.push($c.name),$c._setAnimatorToLinkSprite3DNoAvatar($V,$U,$r),$r.splice($R,1)}},$r._changeHierarchyAnimator=function($V){this._hierarchyAnimator=$V},$r._isLinkSpriteToAnimationNode=function($V,$U,$r){var $s=$V._avatarNodes.indexOf($U),$p=$V._cacheSpriteToNodesMap;if($r)this._transform.dummy=$U.transform,$V._cacheNodesToSpriteMap[$s]=$p.length,$p.push($s);else{this._transform.dummy=null;var $c=$V._cacheNodesToSpriteMap[$s];$V._cacheNodesToSpriteMap[$s]=null,$p.splice($c,1)}},$r._setBelongScene=function($V){this._scene=$V;for(var $U=0,$r=this._childs.length;$U<$r;$U++)this._childs[$U]._setBelongScene($V)},$r._setUnBelongScene=function(){this._scene=null;for(var $V=0,$U=this._childs.length;$V<$U;$V++)this._childs[$V]._setUnBelongScene()},$r._activeHierarchy=function(){var $V=0,$U=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$V=0,$U=this._colliders.length;$V<$U;$V++)this._layer._addCollider(this._colliders[$V]);for(this.event("activeinhierarchychanged",!0),$V=0,$U=this._childs.length;$V<$U;$V++){var $r=this._childs[$V];$r._active&&$r._activeHierarchy()}},$r._inActiveHierarchy=function(){var $V=0,$U=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$V=0,$U=this._colliders.length;$V<$U;$V++){var $r=this._colliders[$V];$r._clearCollsionMap(),this._layer._removeCollider($r)}for(this.event("activeinhierarchychanged",!1),$V=0,$U=this._childs.length;$V<$U;$V++){var $s=this._childs[$V];$s._active&&$s._inActiveHierarchy()}},$r.addComponent=function($V){var $U,$r=this._componentsMap.indexOf($V);if(-1===$r)$U=[],this._componentsMap.push($V),this._typeComponentsIndices.push($U);else if($U=this._typeComponentsIndices[$r],this._components[$U[0]].isSingleton)throw new Error("无法单实例创建"+$V+"组件，"+$V+"组件已存在！");var $s=$p.getInstance($V);return $U.push(this._components.length),this._components.push($s),$s instanceof laya.d3.component.Script&&this._scripts.push($s),$s._initialize(this),$s},$r._removeComponent=function($V,$U){var $r,$s=0,$p=this._typeComponentsIndices[$V],$c=$p[$U],$R=this._components[$c];for($R instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($R),1),$p.splice($U,1),0===$p.length&&(this._typeComponentsIndices.splice($V,1),this._componentsMap.splice($V,1)),$s=0,$r=this._componentsMap.length;$s<$r;$s++)for(var $T=($p=this._typeComponentsIndices[$s]).length-1;0<=$T;$T--){var $N=$p[$T];if(!($c<$N))break;$p[$T]=--$N}$R._destroy()},$r._clearSelfRenderObjects=function(){},$r._addSelfRenderObjects=function(){},$r._parseCustomProps=function($V,$U,$r,$s){},$r._updateChilds=function($V){var $U=this._childs.length;if(0!==$U)for(var $r=0;$r<$U;++$r)this._childs[$r]._update($V)},$r._getSortID=function($V,$U){return 1e3*$U.id+$V._getVertexBuffer().vertexDeclaration.id},$r._update=function($V){($V.owner=this)._activeInHierarchy&&(this._updateComponents($V),this._lateUpdateComponents($V),$D.spriteCount++,this._childs.length&&this._updateChilds($V))},$r.getProjectionViewWorldMatrix=function($V){return $VU.multiply($V,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$r.loadHierarchy=function($V){this.addChild(laya.d3.core.Sprite3D.load($V))},$r.addChildAt=function($V,$U){if(!($V instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),0<=$U&&$U<=this._childs.length){if($V._parent===this){var $r=this.getChildIndex($V);this._childs.splice($r,1),this._childs.splice($U,0,$V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,$U)),this._childChanged()}else $V.parent&&$V.parent.removeChild($V),this._childs===$t.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($U,0,$V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,$U),($V.parent=this)._addChild3D($V);return $V}throw new Error("appendChildAt:The index is out of bounds")},$r.addChild=function($V){if(!($V instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$V||this.destroyed||$V===this)return $V;if($V.zOrder&&this._set$P("hasZorder",!0),$V._parent===this){var $U=this.getChildIndex($V);$U!==this._childs.length-1&&(this._childs.splice($U,1),this._childs.push($V),this.conchModel&&(this.conchModel.removeChild($V.conchModel),this.conchModel.addChildAt($V.conchModel,this._childs.length-1)),this._childChanged())}else $V.parent&&$V.parent.removeChild($V),this._childs===$t.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($V),this.conchModel&&this.conchModel.addChildAt($V.conchModel,this._childs.length-1),($V.parent=this)._childChanged(),this._addChild3D($V);return $V},$r.removeChildAt=function($V){var $U=this.getChildAt($V);return $U&&(this._removeChild3D($U),this._childs.splice($V,1),this.conchModel&&this.conchModel.removeChild($U.conchModel),$U.parent=null),$U},$r.removeChildren=function($V,$U){if(void 0===$V&&($V=0),void 0===$U&&($U=2147483647),this._childs&&0<this._childs.length){var $r=this._childs;if(0===$V&&$c<=$U){var $s=$r;this._childs=$t.ARRAY_EMPTY}else $s=$r.splice($V,$U-$V);for(var $p=0,$c=$s.length;$p<$c;$p++)this._removeChild3D($s[$p]),$s[$p].parent=null,this.conchModel&&this.conchModel.removeChild($s[$p].conchModel)}return this},$r.onAsynLoaded=function($V,$U,$r){var $s=$U[0];if("Sprite3D"!==$s.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $p=$U[1];$hU._createNodeByJson(this,$s,this,$p),this.event("hierarchyloaded",[this]),this.__loaded=!0},$r.cloneTo=function($V){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $U=$V;$U.name=this.name,$U._destroyed=this._destroyed,$U.timer=this.timer,$U._$P=this._$P,$U.active=this._active;var $r=$U.transform.localPosition;this.transform.localPosition.cloneTo($r),$U.transform.localPosition=$r;var $s=$U.transform.localRotation;this.transform.localRotation.cloneTo($s),$U.transform.localRotation=$s;var $p=$U.transform.localScale;this.transform.localScale.cloneTo($p),$U.transform.localScale=$p,$U.isStatic=this.isStatic;var $c=0,$R=0;for($c=0,$R=this._componentsMap.length;$c<$R;$c++){var $T=$U.addComponent(this._componentsMap[$c]);this._components[$c]._cloneTo($T)}for($c=0,$R=this._childs.length;$c<$R;$c++)$U.addChild(this._childs[$c].clone());var $N=$U.getComponentByType(Animator);if($N){var $t=$N._linkSpritesData;if($t)for(var $b in $t){for(var $S=$t[$b],$_=$U,$G=0,$q=$S.length;$G<$q&&($_=$_.getChildByName($S[$G]));$G++);if($_){var $u=$N._avatarNodeMap[$b];$_._isLinkSpriteToAnimationNode($N,$u,!0)}}}},$r.clone=function(){var $V=new this.constructor;return this.cloneTo($V),$V},$r.destroy=function($V){if(void 0===$V&&($V=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$V);var $U,$r=0;for($r=0,$U=this._components.length;$r<$U;$r++)this._components[$r]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$l.clearRes(this.url),this.loaded||$lU._cancelLoadByUrl(this.url)}},$r._handleSpriteToAvatar=function($V,$U){$V._avatarNodes;var $r=$V._avatarNodeMap[this.name];$r&&$r.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($V,$r,$U)},$r._setAnimatorToLinkAvatar=function($V,$U){this._handleSpriteToAvatar($V,$U);for(var $r=0,$s=this._childs.length;$r<$s;$r++){this._childs[$r]._setAnimatorToLinkAvatar($V,$U)}},$q(0,$r,"activeInHierarchy",function(){return this._activeInHierarchy}),$q(0,$r,"_loaded",null,function($V){this.__loaded=$V}),$q(0,$r,"active",function(){return this._active},function($V){this._active!==$V&&(this._active=$V,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($V?this._activeHierarchy():this._inActiveHierarchy()))}),$q(0,$r,"componentsCount",function(){return this._components.length}),$q(0,$r,"loaded",function(){return this.__loaded}),$q(0,$r,"id",function(){return this._id}),$q(0,$r,"url",function(){return this._url}),$q(0,$r,"layer",function(){return this._layer},function($V){if(this._layer!==$V){if(!$V)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $U=0,$r=this._colliders.length;if(this._layer)for($U=0;$U<$r;$U++)this._layer._removeCollider(this._colliders[$U]);for($U=0;$U<$r;$U++)$V._addCollider(this._colliders[$U])}this._layer=$V,this.event("layerchanged",$V)}}),$q(0,$r,"scene",function(){return this._scene}),$q(0,$r,"transform",function(){return this._transform}),$U.instantiate=function($V,$U,$r,$s,$p){void 0===$r&&($r=!0);var $c=$V.clone();$U&&$U.addChild($c);var $R=$c.transform;if($r){var $T=$R.worldMatrix;$V.transform.worldMatrix.cloneTo($T),$R.worldMatrix=$T}else $s&&($R.position=$s),$p&&($R.rotation=$p);return $c},$U.load=function($V){return $d.loader.create($V,null,null,$U)},$U.WORLDMATRIX=0,$U.MVPMATRIX=1,$U._uniqueIDCounter=0,$U._nameNumberCounter=0,$U}(),$ZU=function($V){function $b($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$b.__super.call(this),!$V||!$U)throw"Shader Error";this._id=++$b._count,this._vs=$V,this._ps=$U,this._attributeMap=$r,this._sceneUniformMap=$s,this._cameraUniformMap=$p,this._spriteUniformMap=$c,this._materialUniformMap=$R,this._renderElementUniformMap=$T,this._precompile=$N,this._define=$t,this._precompile&&$b.extCompileObj&&$b.extCompileFunc?$b.extCompileFunc.call($b.extCompileObj,$V,$U,$t):this.recreateResource()}$G($b,"laya.d3.shader.Shader3D",$r);var $U=$b.prototype;return $U.recreateResource=function(){$E.now();this._compile(),this.completeCreate(),this.memorySize=0},$U.disposeResource=function(){$w.mainContext.deleteShader(this._vshader),$w.mainContext.deleteShader(this._pshader),$w.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$U._compile=function(){if(!$w.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $V=[this._vs,this._ps],$U=$w.mainContext;if(this._program=$U.createProgram(),this._vshader=$b._createShader($U,$V[0],35633),this._pshader=$b._createShader($U,$V[1],35632),$U.attachShader(this._program,this._vshader),$U.attachShader(this._program,this._pshader),$U.linkProgram(this._program),!$u.isConchApp&&$DU.debugMode&&!$U.getProgramParameter(this._program,35714))throw $U.getProgramInfoLog(this._program);var $r,$s=0,$p=0,$c=0;for($c=$u.isConchApp?$U.getProgramParameterEx(this._vs,this._ps,"",35721):$U.getProgramParameter(this._program,35721),$s=0;$s<$c;$s++){var $R=null;$r={vartype:"attribute",ivartype:0,attrib:$R=$u.isConchApp?$U.getActiveAttribEx(this._vs,this._ps,"",$s):$U.getActiveAttrib(this._program,$s),location:$U.getAttribLocation(this._program,$R.name),name:$R.name,type:$R.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($r)}var $T=0;for($T=$u.isConchApp?$U.getProgramParameterEx(this._vs,this._ps,"",35718):$U.getProgramParameter(this._program,35718),$s=0;$s<$T;$s++){var $N=null;$N=$u.isConchApp?$U.getActiveUniformEx(this._vs,this._ps,"",$s):$U.getActiveUniform(this._program,$s),0<($r={vartype:"uniform",ivartype:1,attrib:$R,location:$U.getUniformLocation(this._program,$N.name),name:$N.name,type:$N.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($r.name=$r.name.substr(0,$r.name.length-3),$r.isArray=!0,$r.location=$U.getUniformLocation(this._program,$r.name)),this._uniformParams.push($r)}for($s=0,$p=this._attributeParams.length;$s<$p;$s++)($r=this._attributeParams[$s]).indexOfParams=$s,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,$r.name=null!=this._attributeMap[$r.codename]?this._attributeMap[$r.codename]:$r.codename,this._attributeParamsMap.push($r.name),this._attributeParamsMap.push($r),$r._this=this,$r.uploadedValue=[],$r.fun=this._attribute;for($s=0,$p=this._uniformParams.length;$s<$p;$s++)switch(($r=this._uniformParams[$s]).indexOfParams=$s,$r.index=1,$r.value=[$r.location,null],$r.codename=$r.name,null!=this._sceneUniformMap[$r.codename]?($r.name=this._sceneUniformMap[$r.codename],this._sceneUniformParamsMap.push($r.name),this._sceneUniformParamsMap.push($r)):null!=this._cameraUniformMap[$r.codename]?($r.name=this._cameraUniformMap[$r.codename],this._cameraUniformParamsMap.push($r.name),this._cameraUniformParamsMap.push($r)):null!=this._spriteUniformMap[$r.codename]?($r.name=this._spriteUniformMap[$r.codename],this._spriteUniformParamsMap.push($r.name),this._spriteUniformParamsMap.push($r)):null!=this._materialUniformMap[$r.codename]?($r.name=this._materialUniformMap[$r.codename],this._materialUniformParamsMap.push($r.name),this._materialUniformParamsMap.push($r)):null!=this._renderElementUniformMap[$r.codename]?($r.name=this._renderElementUniformMap[$r.codename],this._renderElementUniformParamsMap.push($r.name),this._renderElementUniformParamsMap.push($r)):console.log("Shader:can't find uinform name:"+$r.codename+" in shader file."),$r._this=this,$r.uploadedValue=[],$r.type){case 5124:$r.fun=$r.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$r.fun=$r.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$r.fun=$r.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$r.fun=$r.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$r.fun=$r.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$r.fun=this._uniform_sampler2D;break;case 35680:$r.fun=this._uniform_samplerCube;break;case 35676:$r.fun=this._uniformMatrix4fv;break;case 35670:$r.fun=this._uniform1i;break;case 35674:$r.fun=this._uinformMatrix2fv;break;case 35675:$r.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$U._attribute=function($V,$U){var $r=$w.mainContext,$s=$T._enableAtributes,$p=$V.location;return $s[$p]||$r.enableVertexAttribArray($p),$r.vertexAttribPointer($p,$U[0],$U[1],$U[2],$U[3],$U[4]),$s[$p]=$T._bindVertexBuffer,1},$U._uniform1f=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U?($w.mainContext.uniform1f($V.location,$r[0]=$U),1):0},$U._uniform1fv=function($V,$U){if($U.length<4){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($w.mainContext.uniform1fv($V.location,$U),$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3],1):0}return $w.mainContext.uniform1fv($V.location,$U),1},$U._uniform_vec2=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]?($w.mainContext.uniform2f($V.location,$r[0]=$U[0],$r[1]=$U[1]),1):0},$U._uniform_vec2v=function($V,$U){if($U.length<2){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($w.mainContext.uniform2fv($V.location,$U),$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3],1):0}return $w.mainContext.uniform2fv($V.location,$U),1},$U._uniform_vec3=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]?($w.mainContext.uniform3f($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2]),1):0},$U._uniform_vec3v=function($V,$U){return $w.mainContext.uniform3fv($V.location,$U),1},$U._uniform_vec4=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($w.mainContext.uniform4f($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3]),1):0},$U._uniform_vec4v=function($V,$U){return $w.mainContext.uniform4fv($V.location,$U),1},$U._uniformMatrix2fv=function($V,$U){return $w.mainContext.uniformMatrix2fv($V.location,!1,$U),1},$U._uniformMatrix3fv=function($V,$U){return $w.mainContext.uniformMatrix3fv($V.location,!1,$U),1},$U._uniformMatrix4fv=function($V,$U){return $w.mainContext.uniformMatrix4fv($V.location,!1,$U),1},$U._uinformMatrix2fv=function($V,$U){return $w.mainContext.uniformMatrix2fv($V.location,!1,$U),1},$U._uinformMatrix3fv=function($V,$U){return $w.mainContext.uniformMatrix3fv($V.location,!1,$U),1},$U._uniform1i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U?($w.mainContext.uniform1i($V.location,$r[0]=$U),1):0},$U._uniform1iv=function($V,$U){return $w.mainContext.uniform1iv($V.location,$U),1},$U._uniform_ivec2=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]?($w.mainContext.uniform2i($V.location,$r[0]=$U[0],$r[1]=$U[1]),1):0},$U._uniform_ivec2v=function($V,$U){return $w.mainContext.uniform2iv($V.location,$U),1},$U._uniform_vec3i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]?($w.mainContext.uniform3i($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2]),1):0},$U._uniform_vec3vi=function($V,$U){return $w.mainContext.uniform3iv($V.location,$U),1},$U._uniform_vec4i=function($V,$U){var $r=$V.uploadedValue;return $r[0]!==$U[0]||$r[1]!==$U[1]||$r[2]!==$U[2]||$r[3]!==$U[3]?($w.mainContext.uniform4i($V.location,$r[0]=$U[0],$r[1]=$U[1],$r[2]=$U[2],$r[3]=$U[3]),1):0},$U._uniform_vec4vi=function($V,$U){return $w.mainContext.uniform4iv($V.location,$U),1},$U._uniform_sampler2D=function($V,$U){var $r=$U.source||$U.defaulteTexture.source,$s=$w.mainContext,$p=$V.uploadedValue;if(null!=$p[0])return $s.activeTexture($b._TEXTURES[$p[0]]),$r&&$z.bindTexture($s,3553,$r),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $p[0]=this._curActTexIndex,$s.uniform1i($V.location,this._curActTexIndex),$s.activeTexture($b._TEXTURES[this._curActTexIndex]),$r&&$z.bindTexture($s,3553,$r),this._curActTexIndex++,1},$U._uniform_samplerCube=function($V,$U){var $r=$U.source||$U.defaulteTexture.source,$s=$w.mainContext,$p=$V.uploadedValue;if(null!=$p[0])return $s.activeTexture($b._TEXTURES[$p[0]]),$r?$z.bindTexture($s,34067,$r):$z.bindTexture($s,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $p[0]=this._curActTexIndex,$s.uniform1i($V.location,this._curActTexIndex),$s.activeTexture($b._TEXTURES[this._curActTexIndex]),$r?$z.bindTexture($s,34067,$r):$z.bindTexture($s,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$U._noSetValue=function($V){console.log("no....:"+$V.name)},$U.bind=function(){return $r.activeShader=this,($r.bindShader=this).activeResource(),$z.UseProgram(this._program)},$U.uploadAttributes=function($V,$U){for(var $r,$s,$p=0,$c=0,$R=this._attributeParamsMap.length;$c<$R;$c+=2)$s=this._attributeParamsMap[$c+1],null!=($r=$V[this._attributeParamsMap[$c]])&&($U&&$U[$s.name]&&$U[$s.name].bind(),$p+=$s.fun.call(this,$s,$r));$D.shaderCall+=$p},$U.uploadAttributesX=function($V,$U){for(var $r,$s,$p=0,$c=0,$R=this._attributeParamsMap.length;$c<$R;$c+=2)$s=this._attributeParamsMap[$c+1],null!=($r=$V[this._attributeParamsMap[$c]])&&($U._bind(),$p+=$s.fun.call(this,$s,$r));$D.shaderCall+=$p},$U.uploadSceneUniforms=function($V){for(var $U,$r,$s=0,$p=0,$c=this._sceneUniformParamsMap.length;$p<$c;$p+=2)$r=this._sceneUniformParamsMap[$p+1],null!=($U=$V[this._sceneUniformParamsMap[$p]])&&($s+=$r.fun.call(this,$r,$U));$D.shaderCall+=$s},$U.uploadCameraUniforms=function($V){for(var $U,$r,$s=0,$p=0,$c=this._cameraUniformParamsMap.length;$p<$c;$p+=2)$r=this._cameraUniformParamsMap[$p+1],null!=($U=$V[this._cameraUniformParamsMap[$p]])&&($s+=$r.fun.call(this,$r,$U));$D.shaderCall+=$s},$U.uploadSpriteUniforms=function($V){for(var $U,$r,$s=0,$p=0,$c=this._spriteUniformParamsMap.length;$p<$c;$p+=2)$r=this._spriteUniformParamsMap[$p+1],null!=($U=$V[this._spriteUniformParamsMap[$p]])&&($s+=$r.fun.call(this,$r,$U));$D.shaderCall+=$s},$U.uploadMaterialUniforms=function($V){for(var $U,$r,$s=0,$p=0,$c=this._materialUniformParamsMap.length;$p<$c;$p+=2)$r=this._materialUniformParamsMap[$p+1],null!=($U=$V[this._materialUniformParamsMap[$p]])&&($s+=$r.fun.call(this,$r,$U));$D.shaderCall+=$s},$U.uploadRenderElementUniforms=function($V){for(var $U,$r,$s=0,$p=0,$c=this._renderElementUniformParamsMap.length;$p<$c;$p+=2)$r=this._renderElementUniformParamsMap[$p+1],null!=($U=$V[this._renderElementUniformParamsMap[$p]])&&($s+=$r.fun.call(this,$r,$U));$D.shaderCall+=$s},$b.create=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return new $b($V,$U,$r,$s,$p,$c,$R,$T,$N,$t)},$b.addInclude=function($V,$U){$O.addInclude($V,$U)},$b._createShader=function($V,$U,$r){var $s=$V.createShader($r);if($V.shaderSource($s,$U),$V.compileShader($s),$DU.debugMode&&!$V.getShaderParameter($s,35713))throw $V.getShaderInfoLog($s);return $s},$b.PERIOD_RENDERELEMENT=0,$b.PERIOD_MATERIAL=1,$b.PERIOD_SPRITE=2,$b.PERIOD_CAMERA=3,$b.PERIOD_SCENE=4,$b._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$b._count=0,$b._preCompile=!1,$b.extCompileFunc=null,$b.extCompileObj=null,$S($b,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $n}]),$b}(),$xU=function($T){function $N(){this._transformUV=null,$N.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $RU(.6,.6,.6)),this._setColor(10,new $RU(1,1,1)),this._setColor(11,new $TU(1,1,1,8)),this._setColor(12,new $RU(1,1,1)),this._setColor(7,new $TU(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $TU(1,1,0,0)),this.renderMode=1}$G($N,"laya.d3.core.material.StandardMaterial",$T);var $V=$N.prototype;return $V.disableLight=function(){this._addDisablePublicShaderDefine($DU.SHADERDEFINE_POINTLIGHT|$DU.SHADERDEFINE_SPOTLIGHT|$DU.SHADERDEFINE_DIRECTIONLIGHT)},$V.disableFog=function(){this._addDisablePublicShaderDefine($DU.SHADERDEFINE_FOG)},$V.onAsynLoaded=function($V,$U,$r){var $s=$U[0];if($s.version)$T.prototype.onAsynLoaded.call(this,$V,$U,$r);else{var $p=$U[1],$c=$s.props;for(var $R in $c)this[$R]=$c[$R];$N._parseStandardMaterial($p,this,$s),this._endLoaded()}},$V.cloneTo=function($V){$T.prototype.cloneTo.call(this,$V);var $U=$V;this._transformUV&&($U._transformUV=this._transformUV.clone())},$q(0,$V,"ambientColor",function(){return this._getColor(9)},function($V){this._setColor(9,$V)}),$q(0,$V,"ambientTexture",function(){return this._getTexture(5)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$V)}),$q(0,$V,"renderMode",null,function($V){switch($V){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($N.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($V)}),$q(0,$V,"reflectColor",function(){return this._getColor(12)},function($V){this._setColor(12,$V)}),$q(0,$V,"tilingOffset",function(){return this._getColor(15)},function($V){if($V){var $U=$V.elements;1!=$U[0]||1!=$U[1]||0!=$U[2]||0!=$U[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$V)}),$q(0,$V,"albedo",function(){return this._getColor(7)},function($V){this._setColor(7,$V)}),$q(0,$V,"diffuseColor",function(){return this._getColor(10)},function($V){this._setColor(10,$V)}),$q(0,$V,"albedoColor",function(){return this._getColor(7)},function($V){this._setColor(7,$V)}),$q(0,$V,"specularColor",function(){return this._getColor(11)},function($V){this._setColor(11,$V)}),$q(0,$V,"diffuseTexture",function(){return this._getTexture(1)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$V)}),$q(0,$V,"normalTexture",function(){return this._getTexture(2)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$V)}),$q(0,$V,"specularTexture",function(){return this._getTexture(3)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$V)}),$q(0,$V,"emissiveTexture",function(){return this._getTexture(4)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$V)}),$q(0,$V,"reflectTexture",function(){return this._getTexture(6)},function($V){$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$V)}),$q(0,$V,"transformUV",function(){return this._transformUV},function($V){this._transformUV=$V,this._setMatrix4x4(13,$V.matrix),$V?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$V.matrix.elements,0)}),$N.__init__=function(){$N.SHADERDEFINE_DIFFUSEMAP=$N.shaderDefines.registerDefine("DIFFUSEMAP"),$N.SHADERDEFINE_NORMALMAP=$N.shaderDefines.registerDefine("NORMALMAP"),$N.SHADERDEFINE_SPECULARMAP=$N.shaderDefines.registerDefine("SPECULARMAP"),$N.SHADERDEFINE_EMISSIVEMAP=$N.shaderDefines.registerDefine("EMISSIVEMAP"),$N.SHADERDEFINE_AMBIENTMAP=$N.shaderDefines.registerDefine("AMBIENTMAP"),$N.SHADERDEFINE_REFLECTMAP=$N.shaderDefines.registerDefine("REFLECTMAP"),$N.SHADERDEFINE_UVTRANSFORM=$N.shaderDefines.registerDefine("UVTRANSFORM"),$N.SHADERDEFINE_TILINGOFFSET=$N.shaderDefines.registerDefine("TILINGOFFSET"),$N.SHADERDEFINE_ADDTIVEFOG=$N.shaderDefines.registerDefine("ADDTIVEFOG")},$N.load=function($V){return $d.loader.create($V,null,null,$N)},$N._parseStandardMaterial=function($V,$U,$r){var $s=$r.customProps,$p=$s.ambientColor;$U.ambientColor=new $RU($p[0],$p[1],$p[2]);var $c=$s.diffuseColor;$U.diffuseColor=new $RU($c[0],$c[1],$c[2]);var $R=$s.specularColor;$U.specularColor=new $TU($R[0],$R[1],$R[2],$R[3]);var $T=$s.reflectColor;$U.reflectColor=new $RU($T[0],$T[1],$T[2]);var $N=$s.albedoColor;$N&&($U.albedo=new $TU($N[0],$N[1],$N[2],$N[3]));var $t=$s.diffuseTexture.texture2D;$t&&($U.diffuseTexture=$l.getRes($V[$t]));var $b=$s.normalTexture.texture2D;$b&&($U.normalTexture=$l.getRes($V[$b]));var $S=$s.specularTexture.texture2D;$S&&($U.specularTexture=$l.getRes($V[$S]));var $_=$s.emissiveTexture.texture2D;$_&&($U.emissiveTexture=$l.getRes($V[$_]));var $G=$s.ambientTexture.texture2D;$G&&($U.ambientTexture=$l.getRes($V[$G]));var $q=$s.reflectTexture.texture2D;$q&&($U.reflectTexture=$l.getRes($V[$q]))},$N.RENDERMODE_OPAQUE=1,$N.RENDERMODE_OPAQUEDOUBLEFACE=2,$N.RENDERMODE_CUTOUT=3,$N.RENDERMODE_CUTOUTDOUBLEFACE=4,$N.RENDERMODE_TRANSPARENT=13,$N.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$N.RENDERMODE_ADDTIVE=15,$N.RENDERMODE_ADDTIVEDOUBLEFACE=16,$N.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$N.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$N.RENDERMODE_DEPTHREAD_ADDTIVE=7,$N.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$N.RENDERMODE_NONDEPTH_TRANSPARENT=9,$N.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$N.RENDERMODE_NONDEPTH_ADDTIVE=11,$N.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$N.SHADERDEFINE_DIFFUSEMAP=0,$N.SHADERDEFINE_NORMALMAP=0,$N.SHADERDEFINE_SPECULARMAP=0,$N.SHADERDEFINE_EMISSIVEMAP=0,$N.SHADERDEFINE_AMBIENTMAP=0,$N.SHADERDEFINE_REFLECTMAP=0,$N.SHADERDEFINE_UVTRANSFORM=0,$N.SHADERDEFINE_TILINGOFFSET=0,$N.SHADERDEFINE_ADDTIVEFOG=0,$N.DIFFUSETEXTURE=1,$N.NORMALTEXTURE=2,$N.SPECULARTEXTURE=3,$N.EMISSIVETEXTURE=4,$N.AMBIENTTEXTURE=5,$N.REFLECTTEXTURE=6,$N.ALBEDO=7,$N.UVANIAGE=8,$N.MATERIALAMBIENT=9,$N.MATERIALDIFFUSE=10,$N.MATERIALSPECULAR=11,$N.MATERIALREFLECT=12,$N.UVMATRIX=13,$N.UVAGE=14,$N.TILINGOFFSET=15,$S($N,["defaultMaterial",function(){var $V=new $N;return $V.lock=!0,this.defaultMaterial=$V},"shaderDefines",function(){return this.shaderDefines=new $bU($HU.shaderDefines)}]),$N}($HU),$$U=function($V){function $R($V,$U,$r,$s,$p){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$r&&($r=35044),void 0===$s&&($s=!1),$R.__super.call(this),this._indexType=$V,this._indexCount=$U,this._bufferUsage=$r,this._bufferType=34963,this._canRead=$s;var $c;if("ushort"==$V)this._indexTypeByteCount=2;else{if("ubyte"!=$V)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$c=this._indexTypeByteCount*$U,this._byteLength=$c,this._bind(),$T._gl.bufferData(this._bufferType,$c,this._bufferUsage),this.uri=$p,$s?("ushort"==$V?this._buffer=new Uint16Array($U):"ubyte"==$V&&(this._buffer=new Uint8Array($U)),this.memorySize=2*$c):this.memorySize=$c}$G($R,"laya.d3.graphics.IndexBuffer3D",$V);var $U=$R.prototype;return $U.setData=function($V,$U,$r,$s){void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=4294967295);var $p=0;if("ushort"==this._indexType?($p=2,0===$r&&4294967295===$s||($V=new Uint16Array($V.buffer,$r*$p,$s))):"ubyte"==this._indexType&&($p=1,0===$r&&4294967295===$s||($V=new Uint8Array($V.buffer,$r*$p,$s))),this._bind(),$T._gl.bufferSubData(this._bufferType,$U*$p,$V),this._canRead)if(0!==$U||0!==$r||4294967295!==$s){var $c=this._buffer.length-$U;$c<$s&&($s=$c);for(var $R=0;$R<$s;$R++)this._buffer[$U+$R]=$V[$R]}else this._buffer=$V},$U.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$U.disposeResource=function(){$V.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$q(0,$U,"indexType",function(){return this._indexType}),$q(0,$U,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$q(0,$U,"indexCount",function(){return this._indexCount}),$q(0,$U,"canRead",function(){return this._canRead}),$R.INDEXTYPE_UBYTE="ubyte",$R.INDEXTYPE_USHORT="ushort",$R.create=function($V,$U,$r,$s,$p){return void 0===$r&&($r=35044),void 0===$s&&($s=!1),new $R($V,$U,$r,$s,$p)},$R}($T),$jU=function($c){function $R($V,$U,$r,$s,$p){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$s&&($s=!1),$R.__super.call(this),this._vertexDeclaration=$V,this._vertexCount=$U,this._bufferUsage=$r,this._bufferType=34962,this._canRead=$s,this.uri=$p,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$U,this._bind(),$T._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$s&&(this._buffer=new Float32Array(this._byteLength/4))}$G($R,"laya.d3.graphics.VertexBuffer3D",$c);var $V=$R.prototype;return $V.bindWithIndexBuffer=function($V){$V&&$V._bind(),this._bind()},$V.setData=function($V,$U,$r,$s){if(void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=4294967295),0===$r&&4294967295===$s||($V=new Float32Array($V.buffer,4*$r,$s)),this._bind(),$T._gl.bufferSubData(this._bufferType,4*$U,$V),this._canRead)if(0!==$U||0!==$r||4294967295!==$s){var $p=this._buffer.length-$U;$p<$s&&($s=$p);for(var $c=0;$c<$s;$c++)this._buffer[$U+$c]=$V[$c]}else this._buffer=$V},$V.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$V.disposeResource=function(){for(var $V=$w.mainContext,$U=this._vertexDeclaration.getVertexElements(),$r=$T._enableAtributes,$s=0,$p=$U.length;$s<$p;$s++)$r[$s]===this._glBuffer&&($V.disableVertexAttribArray($s),$r[$s]=null);$c.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$q(0,$V,"vertexDeclaration",function(){return this._vertexDeclaration}),$q(0,$V,"vertexCount",function(){return this._vertexCount}),$q(0,$V,"canRead",function(){return this._canRead}),$R.create=function($V,$U,$r,$s,$p){return void 0===$r&&($r=35044),void 0===$s&&($s=!1),new $R($V,$U,$r,$s,$p)},$R}($T),$oU=function($V){function $O(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$O.__super.call(this),this._type=3553}$G($O,"laya.d3.resource.DataTexture2D",$wU);var $U=$O.prototype;return $U.genDebugMipmaps=function(){var $V=[];return $V.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$V.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$V.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$V.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$V.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$V.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$V.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$V.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$V.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$V.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$V},$U._onTextureLoaded=function($V){},$U._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $V=$w.mainContext,$U=this._source=$V.createTexture(),$r=this._width,$s=this._height,$p=$z.curBindTexTarget,$c=$z.curBindTexValue,$R=!1;if($z.bindTexture($V,this._type,$U),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $T=0;$V.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $N=0;$N<this._mipmaps.length;$N++){if(this._mipmaps[$N].byteLength!=$t*$b*4)throw"mipmap size error  level:"+$N;$V.texSubImage2D(this._type,0,$O.simLodRect[$T++],$O.simLodRect[$T++],$O.simLodRect[$T++],$O.simLodRect[$T++],6408,5121,new Uint8Array(this._mipmaps[$N]))}this.minFifter=9729,this.magFifter=9729}else{var $t=this._width,$b=this._height;for($T=0,$V.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$N=0;$N<this._mipmaps.length;$N++){if(this._mipmaps[$N].byteLength!=$t*$b*4)throw"mipmap size error  level:"+$N;$V.texImage2D(this._type,$N,6408,$t,$b,0,6408,5121,new Uint8Array(this._mipmaps[$N])),($t/=2)<1&&($t=1),($b/=2)<1&&($b=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$V.pixelStorei($V.UNPACK_ALIGNMENT,1),$V.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $S=0,$_=!1,$G=!1;this._buffer.byteLength==4*$r*$s?($S=6408,$_=!0):this._buffer.byteLength==3*$r*$s?($S=6407,$G=!0):$S=this._format,$_||$G?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$G&&$V.pixelStorei($V.UNPACK_ALIGNMENT,1),$V.texImage2D(this._type,0,$S,$r,$s,0,$S,5121,this._buffer)):$V&&$S==$V.ALPHA?($V.texImage2D(3553,0,$S,$r,$s,0,$S,$V.UNSIGNED_BYTE,this._buffer),$R=!0):0!=$S&&($V.compressedTexImage2D(3553,0,$S,$r,$s,0,this._buffer),$R=!0)}var $q=this._minFifter,$u=this._magFifter,$h=0==this._wrapModeU?10497:33071,$l=0==this._wrapModeV?10497:33071,$W=$L.isPOT($r,$s);$W?(this._mipmap||this._mipmaps?-1!==$q||($q=9987):-1!==$q||($q=9729),-1!==$u||($u=9729),$V.texParameteri(this._type,10241,$q),$V.texParameteri(this._type,10240,$u),$V.texParameteri(this._type,10242,$h),$V.texParameteri(this._type,10243,$l),this._mipmap&&$V.generateMipmap(this._type)):(-1!==$q||($q=9729),-1!==$u||($u=9729),$V.texParameteri(this._type,10241,$q),$V.texParameteri(this._type,10240,$u),$V.texParameteri(this._type,10242,33071),$V.texParameteri(this._type,10243,33071)),$p&&$c&&$z.bindTexture($V,$p,$c),this.memorySize=$R?this._buffer.length:$W?$r*$s*4*(1+1/3):$r*$s*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$U.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$U.onAsynLoaded=function($V,$U,$r){var $s;$r&&($s=$r[0].call(this,$U)),$s&&(this._width=$s.width,this._height=$s.height,this._buffer=$s.data),this._src=$V,this._size=new $uU(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$U.getPixels=function(){return new Uint8Array(this._buffer)},$U.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($w.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$q(0,$U,"src",function(){return this._src}),$O.create=function($V,$U,$r,$s,$p,$c,$R){if(void 0===$s&&($s=9729),void 0===$p&&($p=9729),void 0===$c&&($c=!0),!$V||$V.byteLength<$U*$r*4)throw"DataTexture2D create error";var $T=new $O;return $T.uri=$R,$T._buffer=$V,$T._width=$U,$T._height=$r,$T._mipmap=$c,$T._magFifter=$s,$T._minFifter=$p,$T._size=new $uU($T._width,$T._height),$T._conchTexture?alert("怎么给runtime传递datatexture数据"):$T.activeResource(),$T},$O.load=function($V,$U,$r,$s,$p){if(void 0===$U&&($U=0),void 0===$r&&($r=0),void 0===$s&&($s=9729),void 0===$p&&($p=9729),"mipmaps"===$I.getFileExtension($V)){var $c=$d.loader.create($V,null,null,$O,[function($V){this._mipmaps=[];var $U=new Uint32Array($V);this._width=$U[0];var $r=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$r=1024),this._width!=$r)throw"现在只支持512x256的环境贴图。当前的是"+$U[0];this._height=$U[1];for(var $s=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$p=this._height,$c=8;;){var $R=$s*$p*4;if($c+$R>$V.byteLength)throw"load mipmaps data size error ";var $T=new Uint8Array($V,$c,$R);if(this._mipmaps.push($T),$c+=$R,1==$s&&1==$p)break;($s/=2)<1&&($s=1),($p/=2)<1&&($p=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$c.simLodInfo=new Float32Array(40);for(var $R=0;$R<$c.simLodInfo.length;)$c.simLodInfo[$R]=($O.simLodRect[$R]+.5)/1024,$R++,$c.simLodInfo[$R]=($O.simLodRect[$R]+.5)/256,$R++,$c.simLodInfo[$R]=Math.max($O.simLodRect[$R]-1,.1)/1024,$R++,$c.simLodInfo[$R]=Math.max($O.simLodRect[$R]-1.5,.1)/256,$R++}return $c}if("number"==typeof $U)return $d.loader.create($V,null,null,$O,[function($V){return this._width=$U,this._height=$r,this._buffer=$V,null}]);if("function"==typeof $U)return $d.loader.create($V,null,null,$O,[$U]);throw new Error("unknown params.")},$O.lodasatlas=!1,$S($O,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$O}(),$JU=function($V){function $U(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$U.__super.call(this)}$G($U,"laya.d3.resource.models.PrimitiveMesh",$zU);var $r=$U.prototype;return $d.imps($r,{"laya.d3.core.render.IRenderable":!0}),$r._getVertexBuffer=function($V){return void 0===$V&&($V=0),0===$V?this._vertexBuffer:null},$r._getVertexBuffers=function(){return null},$r._getIndexBuffer=function(){return this._indexBuffer},$r._getPositions=function(){var $V,$U=[],$r=this._vertexBuffer.vertexDeclaration.getVertexElements(),$s=0;for($s=0;$s<$r.length;$s++){var $p=$r[$s];if("vector3"===$p.elementFormat&&0===$p.elementUsage){$V=$p;break}}var $c=this._vertexBuffer.getData();for($s=0;$s<$c.length;$s+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $R=$s+$V.offset/4,$T=new $RU($c[$R+0],$c[$R+1],$c[$R+2]);$U.push($T)}return $U},$r.getRenderElement=function($V){return this},$r.getRenderElementsCount=function(){return 1},$r.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$r._beforeRender=function($V){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$r._render=function($V){$w.mainContext.drawElements(4,this._numberIndices,5123,0),$D.drawCall++,$D.trianglesFaces+=this._numberIndices/3},$q(0,$r,"_vertexBufferCount",function(){return 1}),$q(0,$r,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$U}(),$iU=function($V){function $U(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$U.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$G($U,"laya.d3.resource.models.Mesh",$zU);var $r=$U.prototype;return $r._getPositions=function(){var $V,$U,$r,$s,$p,$c=[],$R=0,$T=0,$N=0;if(0!==this._vertexBuffers.length){var $t=this._vertexBuffers.length;for($R=0;$R<$t;$R++){for($r=($V=this._vertexBuffers[$R]).vertexDeclaration.getVertexElements(),$T=0;$T<$r.length;$T++)if("vector3"===($s=$r[$T]).elementFormat&&0===$s.elementUsage){$U=$s;break}for($p=$V.getData(),$T=0;$T<$p.length;$T+=$V.vertexDeclaration.vertexStride/4)$N=$T+$U.offset/4,$c.push(new $RU($p[$N+0],$p[$N+1],$p[$N+2]))}}else{var $b=this._subMeshes.length;for($R=0;$R<$b;$R++){for($r=($V=this._subMeshes[$R]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$T=0;$T<$r.length;$T++)if("vector3"===($s=$r[$T]).elementFormat&&0===$s.elementUsage){$U=$s;break}for($p=$V.getData(),$T=0;$T<$p.length;$T+=$V.vertexDeclaration.vertexStride/4)$N=$T+$U.offset/4,$c.push(new $RU($p[$N+0],$p[$N+1],$p[$N+2]))}}return $c},$r._setSubMeshes=function($V){this._subMeshes=$V,this._subMeshCount=$V.length;for(var $U=0;$U<this._subMeshCount;$U++)$V[$U]._indexInMesh=$U;this._positions=this._getPositions(),this._generateBoundingObject()},$r.onAsynLoaded=function($V,$U,$r){var $s=$U[0],$p=$U[1];$FV.read($s,this,this._materials,this._subMeshes,$p),this.completeCreate(),this._endLoaded()},$r.getSubMesh=function($V){return this._subMeshes[$V]},$r.getSubMeshCount=function(){return this._subMeshes.length},$r.getRenderElementsCount=function(){return this._subMeshes.length},$r.getRenderElement=function($V){return this._subMeshes[$V]},$r.disposeResource=function(){for(var $V=0;$V<this._subMeshes.length;$V++)this._subMeshes[$V].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$q(0,$r,"materials",function(){return this._materials.slice()}),$q(0,$r,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$U.load=function($V){return $d.loader.create($V,null,null,$U)},$U}(),$BU=(function($V){function $t($V,$U,$r,$s,$p,$c,$R,$T,$N){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$r&&($r=6408),void 0===$s&&($s=5121),void 0===$p&&($p=33189),void 0===$c&&($c=!1),void 0===$R&&($R=!1),void 0===$T&&($T=-1),void 0===$N&&($N=-1),$t.__super.call(this),this._type=3553,this._width=$V,this._height=$U,this._size=new $uU($V,$U),this._surfaceFormat=$r,this._surfaceType=$s,this._depthStencilFormat=$p,$u.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$c,this._repeat=$R,this._minFifter=$T,this._magFifter=$N,this.activeResource(),this._alreadyResolved=!0}$G($t,"laya.d3.resource.RenderTexture",$wU);var $U=$t.prototype;$U.recreateResource=function(){var $V=$w.mainContext;this._frameBuffer=$V.createFramebuffer(),this._source=$V.createTexture();var $U=$z.curBindTexTarget,$r=$z.curBindTexValue;$z.bindTexture($V,this._type,this._source),$V.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $s=this._minFifter,$p=this._magFifter,$c=this._repeat?10497:33071;if($L.isPOT(this._width,this._height)?(this._mipmap?-1!==$s||($s=9987):-1!==$s||($s=9729),-1!==$p||($p=9729),$V.texParameteri(this._type,10241,$s),$V.texParameteri(this._type,10240,$p),$V.texParameteri(this._type,10242,$c),$V.texParameteri(this._type,10243,$c),this._mipmap&&$V.generateMipmap(this._type)):(-1!==$s||($s=9729),-1!==$p||($p=9729),$V.texParameteri(this._type,10241,$s),$V.texParameteri(this._type,10240,$p),$V.texParameteri(this._type,10242,33071),$V.texParameteri(this._type,10243,33071)),$U&&$r&&$z.bindTexture($V,$U,$r),$V.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$V.createRenderbuffer(),$V.bindRenderbuffer(36161,this._depthStencilBuffer),$V.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$V.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$V.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$V.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$V.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$V.framebufferTexture2D(36160,36064,3553,this._source,0),$V.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$U.start=function(){$w.mainContext.bindFramebuffer(36160,this.frameBuffer),($t._currentRenderTarget=this)._alreadyResolved=!1},$U.end=function(){$w.mainContext.bindFramebuffer(36160,null),$t._currentRenderTarget=null,this._alreadyResolved=!0},$U.getData=function($V,$U,$r,$s){var $p=$w.mainContext;if($p.bindFramebuffer(36160,this._frameBuffer),!(36053===$p.checkFramebufferStatus(36160)))return $p.bindFramebuffer(36160,null),null;var $c=new Uint8Array(this._width*this._height*4);return $p.readPixels($V,$U,$r,$s,this._surfaceFormat,this._surfaceType,$c),$p.bindFramebuffer(36160,null),$c},$U.disposeResource=function(){if(this._frameBuffer){var $V=$w.mainContext;$V.deleteTexture(this._source),$V.deleteFramebuffer(this._frameBuffer),$V.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$q(0,$U,"surfaceFormat",function(){return this._surfaceFormat}),$q(0,$U,"surfaceType",function(){return this._surfaceType}),$q(0,$U,"depthStencilFormat",function(){return this._depthStencilFormat}),$q(0,$U,"source",function(){return this._alreadyResolved?$d.superGet($wU,this,"source"):null}),$q(0,$U,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$q(0,$U,"frameBuffer",function(){return this._frameBuffer}),$t._currentRenderTarget=null}(),function($V){function $U($V){this._color=null,this._pixels=null,$U.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $uU(this.width,this.height),this._color=$V,this._pixels=new Uint8Array([255*$V.x,255*$V.y,255*$V.z,255*$V.w]),this.uri="SolidColorTexture2D_"+this.id}$G($U,"laya.d3.resource.SolidColorTexture2D",$wU);var $r=$U.prototype;return $r._createWebGlTexture=function(){var $V=$w.mainContext,$U=this._source=$V.createTexture(),$r=this._width,$s=this._height,$p=$z.curBindTexTarget,$c=$z.curBindTexValue;$z.bindTexture($V,this._type,$U),$V.texImage2D(this._type,0,6408,$r,$s,0,6408,5121,this._pixels);var $R=this._minFifter,$T=this._magFifter,$N=this._repeat?10497:33071,$t=$L.isPOT($r,$s);$t?(this._mipmap?-1!==$R||($R=9987):-1!==$R||($R=9729),-1!==$T||($T=9729),$V.texParameteri(this._type,10241,$R),$V.texParameteri(this._type,10240,$T),$V.texParameteri(this._type,10242,$N),$V.texParameteri(this._type,10243,$N),this._mipmap&&$V.generateMipmap(this._type)):(-1!==$R||($R=9729),-1!==$T||($T=9729),$V.texParameteri(this._type,10241,$R),$V.texParameteri(this._type,10240,$T),$V.texParameteri(this._type,10242,33071),$V.texParameteri(this._type,10243,33071)),$p&&$c&&$z.bindTexture($V,$p,$c),this.memorySize=$t?$r*$s*4*(1+1/3):$r*$s*4},$r.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$r.disposeResource=function(){this._source&&($w.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$S($U,["magentaTexture",function(){var $V=new $U(new $TU(1,0,1,1));return $V.lock=!0,this.magentaTexture=$V},"grayTexture",function(){var $V=new $U(new $TU(.5,.5,.5,1));return $V.lock=!0,this.grayTexture=$V}]),$U}()),$PU=function($V){function $p($V,$U,$r,$s){this._canRead=!1,this._image=null,this._pixels=null,void 0===$V&&($V=!1),void 0===$U&&($U=!0),void 0===$r&&($r=6408),void 0===$s&&($s=!0),$p.__super.call(this),this._type=3553,this._repeat=$U,this._canRead=$V,this._format=$r,this._mipmap=$s}$G($p,"laya.d3.resource.Texture2D",$wU);var $U=$p.prototype;return $U._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $V=$w.mainContext,$U=this._source=$V.createTexture(),$r=this._width,$s=this._height,$p=$z.curBindTexTarget,$c=$z.curBindTexValue;switch($z.bindTexture($V,this._type,$U),this._format){case 6407:case 6408:this._canRead?$V.texImage2D(this._type,0,this._format,$r,$s,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$V.texImage2D(this._type,0,this._image._format,$r,$s,0,this._image._format,5121,this._image.atlasSource):$V.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $w.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$V.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $R=this._minFifter,$T=this._magFifter,$N=this._repeat?10497:33071,$t=0==this._wrapModeU?10497:33071,$b=0==this._wrapModeV?10497:33071,$S=$L.isPOT($r,$s);$S?(this._mipmap?-1!==$R||($R=9987):-1!==$R||($R=9729),-1!==$T||($T=9729),$V.texParameteri(this._type,10241,$R),$V.texParameteri(this._type,10240,$T),$V.texParameteri(this._type,10242,$N),$V.texParameteri(this._type,10243,$N),$V.texParameteri(this._type,10242,$t),$V.texParameteri(this._type,10243,$b),this._mipmap&&$V.generateMipmap(this._type)):(-1!==$R||($R=9729),-1!==$T||($T=9729),$V.texParameteri(this._type,10241,$R),$V.texParameteri(this._type,10240,$T),$V.texParameteri(this._type,10242,33071),$V.texParameteri(this._type,10243,33071)),$p&&$c&&$z.bindTexture($V,$p,$c),this._image.onload=null,this._image=null,this.memorySize=$S?$r*$s*4*(1+1/3):$r*$s*4},$U.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$U.onAsynLoaded=function($V,$U,$r){if($r){var $s=$r[0];void 0!==$s&&(this._canRead=$s);var $p=$r[1];void 0!==$p&&(this._repeat=$p);var $c=$r[2];void 0!==$c&&(this._format=$c);var $R=$r[3];void 0!==$R&&(this._mipmap=$R);var $T=$r.wrapModeU;void 0!==$T&&(this._wrapModeU=$T);var $N=$r.wrapModeV;void 0!==$N&&(this._wrapModeV=$N)}switch(this._format){case 6407:case 6408:var $t=(this._image=$U).width,$b=$U.height;this._width=$t,this._height=$b,this._size=new $uU($t,$b),this._canRead&&($u.isConchApp?$U instanceof $_.HTMLElement&&(this._pixels=new Uint8Array($U.getImageData(0,0,$t,$b))):($E.canvas.size($t,$b),$E.canvas.clear(),$E.context.drawImage($U,0,0,$t,$b),this._pixels=new Uint8Array($E.context.getImageData(0,0,$t,$b).data.buffer)));break;case $w.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $S=new $k($U);$S.readUTFBytes(4),$S.readUTFBytes(2),$S.getInt16();$S.endian="bigEndian",this._width=$S.getInt16(),this._height=$S.getInt16(),this._size=new $uU(this._width,this._height);$S.getInt16(),$S.getInt16();this._image=new Uint8Array($U,$S.pos)}this.recreateResource(),this._endLoaded()},$U.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$U.disposeResource=function(){this._source&&($w.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$q(0,$U,"_src",function(){return this.url}),$q(0,$U,"src",function(){return this.url}),$p.load=function($V){return $d.loader.create($V,null,null,$p)},$p}(),$MU=function($U){function $r($V,$U){$r.__super.call(this),void 0===$V&&($V=.3),void 0===$U&&($U=1e3),this._tempVector3=new $RU,this._position=new $RU,this._up=new $RU,this._forward=new $RU,this._right=new $RU,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$uU.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$V,this._farPlane=$U,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$d.stage.on("resize",this,this._onScreenSizeChanged)}$G($r,"laya.d3.core.BaseCamera",$U);var $V=$r.prototype;return $V._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $V=this.scene._cameraPool,$U=$V.length-1,$r=0;$r<$U;$r++)if($V[$r].renderingOrder>$V[$U].renderingOrder){var $s=$V[$r];$V[$r]=$V[$U],$V[$U]=$s}},$V._calculateProjectionMatrix=function(){},$V._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$V._prepareCameraToRender=function(){$K._currentCameraCullingMask=this.cullingMask;var $V=this._shaderValues;$V.setValue(0,this.transform.position.elements),$V.setValue(5,this.forward.elements),$V.setValue(6,this.up.elements)},$V._prepareCameraViewProject=function($V,$U){var $r=this._shaderValues;$r.setValue(1,$V.elements),$r.setValue(2,$U.elements)},$V._renderCamera=function($V,$U,$r){},$V.addLayer=function($V){29!==$V.number&&30!=$V.number&&(this.cullingMask=this.cullingMask|$V.mask)},$V.removeLayer=function($V){29!==$V.number&&30!=$V.number&&(this.cullingMask=this.cullingMask&~$V.mask)},$V.addAllLayers=function(){this.cullingMask=2147483647},$V.removeAllLayers=function(){this.cullingMask=0|$K.getLayerByNumber(29).mask|$K.getLayerByNumber(30).mask},$V.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$V.moveForward=function($V){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$V,this.transform.translate(this._tempVector3)},$V.moveRight=function($V){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$V,this.transform.translate(this._tempVector3)},$V.moveVertical=function($V){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$V,this.transform.translate(this._tempVector3,!1)},$V._addSelfRenderObjects=function(){var $V=this.scene._cameraPool,$U=$V.length;if(0<$U){for(var $r=$U-1;0<=$r;$r--)if(this.renderingOrder<=$V[$r].renderingOrder){$V.splice($r+1,0,this);break}}else $V.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$V._clearSelfRenderObjects=function(){var $V=this.scene._cameraPool;$V.splice($V.indexOf(this),1)},$V.destroy=function($V){void 0===$V&&($V=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$d.stage.off("resize",this,this._onScreenSizeChanged),$U.prototype.destroy.call(this,$V)},$q(0,$V,"sky",function(){return this._sky},function($V){(this._sky=$V)._ownerCamera=this}),$q(0,$V,"forward",function(){var $V=this.transform.worldMatrix.elements,$U=this._forward.elements;return $U[0]=-$V[8],$U[1]=-$V[9],$U[2]=-$V[10],this._forward}),$q(0,$V,"position",function(){var $V=this.transform.worldMatrix.elements,$U=this._position.elements;return $U[0]=$V[12],$U[1]=$V[13],$U[2]=$V[14],this._position}),$q(0,$V,"renderTarget",function(){return this._renderTarget},function($V){null!=(this._renderTarget=$V)&&(this._renderTargetSize=$V.size)}),$q(0,$V,"up",function(){var $V=this.transform.worldMatrix.elements,$U=this._up.elements;return $U[0]=$V[4],$U[1]=$V[5],$U[2]=$V[6],this._up}),$q(0,$V,"right",function(){var $V=this.transform.worldMatrix.elements,$U=this._right.elements;return $U[0]=$V[0],$U[1]=$V[1],$U[2]=$V[2],this._right}),$q(0,$V,"renderTargetSize",function(){return this._renderTargetSize},function($V){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$V,this._calculateProjectionMatrix()}),$q(0,$V,"fieldOfView",function(){return this._fieldOfView},function($V){this._fieldOfView=$V,this._calculateProjectionMatrix()}),$q(0,$V,"nearPlane",function(){return this._nearPlane},function($V){this._nearPlane=$V,this._calculateProjectionMatrix()}),$q(0,$V,"farPlane",function(){return this._farPlane},function($V){this._farPlane=$V,this._calculateProjectionMatrix()}),$q(0,$V,"orthographic",function(){return this._orthographic},function($V){this._orthographic=$V,this._calculateProjectionMatrix()}),$q(0,$V,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($V){this._orthographicVerticalSize=$V,this._calculateProjectionMatrix()}),$q(0,$V,"renderingOrder",function(){return this._renderingOrder},function($V){this._renderingOrder=$V,this._sortCamerasByRenderingOrder()}),$r.CAMERAPOS=0,$r.VIEWMATRIX=1,$r.PROJECTMATRIX=2,$r.VPMATRIX=3,$r.VPMATRIX_NO_TRANSLATE=4,$r.CAMERADIRECTION=5,$r.CAMERAUP=6,$r.ENVIRONMENTDIFFUSE=7,$r.ENVIRONMENTSPECULAR=8,$r.SIMLODINFO=9,$r.DIFFUSEIRRADMATR=10,$r.DIFFUSEIRRADMATG=11,$r.DIFFUSEIRRADMATB=12,$r.HDREXPOSURE=13,$r.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$r.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$r.CLEARFLAG_SOLIDCOLOR=0,$r.CLEARFLAG_SKY=1,$r.CLEARFLAG_DEPTHONLY=2,$r.CLEARFLAG_NONE=3,$S($r,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $VU(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $VU},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $VU}]),$r}($aU),$AU=function($r){function $U($V){this._render=null,this._geometryFilter=null,$U.__super.call(this,$V)}$G($U,"laya.d3.core.RenderableSprite3D",$r);var $V=$U.prototype;return $V._addToInitStaticBatchManager=function(){},$V._setBelongScene=function($V){$r.prototype._setBelongScene.call(this,$V),$V._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$V._setUnBelongScene=function(){var $V=this._scene._renderableSprite3Ds,$U=$V.indexOf(this);$V.splice($U,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$r.prototype._setUnBelongScene.call(this)},$V._update=function($V){($V.owner=this)._activeInHierarchy&&(this._updateComponents($V),this._render._updateOctreeNode(),this._lateUpdateComponents($V),$D.spriteCount++,this._childs.length&&this._updateChilds($V))},$V.destroy=function($V){void 0===$V&&($V=!0),$r.prototype.destroy.call(this,$V),this._render._destroy(),this._render=null},$U.__init__=function(){$U.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$U.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$U.SAHDERDEFINE_LIGHTMAP=$U.shaderDefines.registerDefine("LIGHTMAP")},$U.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$U.SAHDERDEFINE_LIGHTMAP=4,$U.LIGHTMAPSCALEOFFSET=2,$U.LIGHTMAP=3,$S($U,["shaderDefines",function(){return this.shaderDefines=new $bU}]),$U}($aU),$XU=(function($V){function $s($V,$U,$r){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$V&&($V=1),void 0===$U&&($U=1),void 0===$r&&($r=1),$s.__super.call(this),this._long=$V,this._width=$U,this._height=$r,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$G($s,"laya.d3.resource.models.BoxMesh",$JU);var $U=$s.prototype;$U.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $V=$wV.vertexDeclaration,$U=($V.vertexStride,this._long/2),$r=this._height/2,$s=this._width/2,$p=new Float32Array([-$U,$r,-$s,0,1,0,0,0,$U,$r,-$s,0,1,0,1,0,$U,$r,$s,0,1,0,1,1,-$U,$r,$s,0,1,0,0,1,-$U,-$r,-$s,0,-1,0,0,1,$U,-$r,-$s,0,-1,0,1,1,$U,-$r,$s,0,-1,0,1,0,-$U,-$r,$s,0,-1,0,0,0,-$U,$r,-$s,-1,0,0,0,0,-$U,$r,$s,-1,0,0,1,0,-$U,-$r,$s,-1,0,0,1,1,-$U,-$r,-$s,-1,0,0,0,1,$U,$r,-$s,1,0,0,1,0,$U,$r,$s,1,0,0,0,0,$U,-$r,$s,1,0,0,0,1,$U,-$r,-$s,1,0,0,1,1,-$U,$r,$s,0,0,1,0,0,$U,$r,$s,0,0,1,1,0,$U,-$r,$s,0,0,1,1,1,-$U,-$r,$s,0,0,1,0,1,-$U,$r,-$s,0,0,-1,1,0,$U,$r,-$s,0,0,-1,0,0,$U,-$r,-$s,0,0,-1,0,1,-$U,-$r,-$s,0,0,-1,1,1]),$c=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $jU($V,this._numberVertices,35044,!0),this._indexBuffer=new $$U("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($p),this._indexBuffer.setData($c),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$q(0,$U,"long",function(){return this._long},function($V){this._long!==$V&&(this._long=$V,this.releaseResource(),this.activeResource())}),$q(0,$U,"width",function(){return this._width},function($V){this._width!==$V&&(this._width=$V,this.releaseResource(),this.activeResource())}),$q(0,$U,"height",function(){return this._height},function($V){this._height!==$V&&(this._height=$V,this.releaseResource(),this.activeResource())})}(),function($V){function $p($V,$U,$r,$s){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$V&&($V=10),void 0===$U&&($U=10),void 0===$r&&($r=10),void 0===$s&&($s=10),$p.__super.call(this),this._long=$V,this._width=$U,this._stacks=$r,this._slices=$s,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$G($p,"laya.d3.resource.models.PlaneMesh",$JU);var $U=$p.prototype;$U.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $V=new Uint16Array(this._numberIndices),$U=$wV.vertexDeclaration,$r=$U.vertexStride/4,$s=new Float32Array(this._numberVertices*$r),$p=this._long/2,$c=this._width/2,$R=this._long/this._stacks,$T=this._width/this._slices,$N=0,$t=0;$t<=this._slices;$t++)for(var $b=0;$b<=this._stacks;$b++)$s[$N++]=$b*$R-$p,$s[$N++]=0,$s[$N++]=$t*$T-$c,$s[$N++]=0,$s[$N++]=1,$s[$N++]=0,$s[$N++]=1*$b/this._stacks,$s[$N++]=1*$t/this._slices;var $S=0;for($t=0;$t<this._slices;$t++)for($b=0;$b<this._stacks;$b++)$V[$S++]=($t+1)*(this._stacks+1)+$b,$V[$S++]=$t*(this._stacks+1)+$b,$V[$S++]=($t+1)*(this._stacks+1)+$b+1,$V[$S++]=$t*(this._stacks+1)+$b,$V[$S++]=$t*(this._stacks+1)+$b+1,$V[$S++]=($t+1)*(this._stacks+1)+$b+1;this._vertexBuffer=new $jU($U,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $$U("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($s),this._indexBuffer.setData($V),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$q(0,$U,"long",function(){return this._long},function($V){this._long!==$V&&(this._long=$V,this.releaseResource(),this.activeResource())}),$q(0,$U,"width",function(){return this._width},function($V){this._width!==$V&&(this._width=$V,this.releaseResource(),this.activeResource())}),$q(0,$U,"stacks",function(){return this._stacks},function($V){this._stacks!==$V&&(this._stacks=$V,this.releaseResource(),this.activeResource())}),$q(0,$U,"slices",function(){return this._slices},function($V){this._slices!==$V&&(this._slices=$V,this.releaseResource(),this.activeResource())})}(),function($V){function $R($V,$U,$r){void 0===$V&&($V=0),void 0===$U&&($U=.3),void 0===$r&&($r=1e3),this._viewMatrix=new $VU,this._projectionMatrix=new $VU,this._projectionViewMatrix=new $VU,this._viewport=new $NU(0,0,0,0),this._normalizedViewport=new $NU(0,0,1,1),this._aspectRatio=$V,this._boundFrustumUpdate=!0,this._boundFrustum=new $vV($VU.DEFAULT),$R.__super.call(this,$U,$r),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$G($R,"laya.d3.core.Camera",$MU);var $U=$R.prototype;return $U._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$U._parseCustomProps=function($V,$U,$r,$s){var $p=$r.clearColor;this.clearColor=new $TU($p[0],$p[1],$p[2],$p[3]);var $c=$r.viewport;this.normalizedViewport=new $NU($c[0],$c[1],$c[2],$c[3])},$U._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $V=this.orthographicVerticalSize*this.aspectRatio*.5,$U=.5*this.orthographicVerticalSize;$VU.createOrthoOffCenterRH(-$V,$V,-$U,$U,this.nearPlane,this.farPlane,this._projectionMatrix)}else $VU.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$U._update=function($V){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$V)},$U._renderCamera=function($V,$U,$r){var $s,$p;$r.parallelSplitShadowMaps[0]&&$r._renderShadowMap($V,$U,this),($U.camera=this)._prepareCameraToRender(),$r._preRenderUpdateComponents($U),$s=$U._viewMatrix=this.viewMatrix;var $c=this._renderTarget;$c?($c.start(),$VU.multiply($MU._invertYScaleMatrix,this._projectionMatrix,$MU._invertYProjectionMatrix),$VU.multiply($MU._invertYScaleMatrix,this.projectionViewMatrix,$MU._invertYProjectionViewMatrix),$p=$U._projectionMatrix=$MU._invertYProjectionMatrix,$U._projectionViewMatrix=$MU._invertYProjectionViewMatrix):($p=$U._projectionMatrix=this._projectionMatrix,$U._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($s,$p),$U._viewport=this.viewport,$r._preRenderScene($V,$U,this.boundFrustum),$r._clear($V,$U),$r._renderScene($V,$U),$r._postRenderUpdateComponents($U),$c&&$c.end()},$U.viewportPointToRay=function($V,$U){$qU.calculateCursorRay($V,this.viewport,this._projectionMatrix,this.viewMatrix,null,$U)},$U.normalizedViewportPointToRay=function($V,$U){var $r=$R._tempVector20,$s=this.viewport,$p=$V.elements,$c=$r.elements;$c[0]=$p[0]*$s.width,$c[1]=$p[1]*$s.height,$qU.calculateCursorRay($r,this.viewport,this._projectionMatrix,this.viewMatrix,null,$U)},$U.worldToViewportPoint=function($V,$U){$VU.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($V,this._projectionViewMatrix,$U);var $r=$U.elements;$r[0]=$r[0]/$d.stage.clientScaleX,$r[1]=$r[1]/$d.stage.clientScaleY},$U.worldToNormalizedViewportPoint=function($V,$U){$VU.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($V,this._projectionViewMatrix,$U);var $r=$U.elements;$r[0]=$r[0]/$d.stage.clientScaleX,$r[1]=$r[1]/$d.stage.clientScaleY},$U.convertScreenCoordToOrthographicCoord=function($V,$U){if(this._orthographic){var $r=$F.clientWidth,$s=$F.clientHeight,$p=this.orthographicVerticalSize*this.aspectRatio/$r,$c=this.orthographicVerticalSize/$s,$R=$V.elements,$T=$U.elements;return $T[0]=(-$r/2+$R[0])*$p,$T[1]=($s/2-$R[1])*$c,$T[2]=(this.nearPlane-this.farPlane)*($R[2]+1)/2-this.nearPlane,$RU.transformCoordinate($U,this.transform.worldMatrix,$U),!0}return!1},$q(0,$U,"projectionViewMatrix",function(){return $VU.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$q(0,$U,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $V=this.viewport;return $V.width/$V.height},function($V){if($V<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$V,this._calculateProjectionMatrix()}),$q(0,$U,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$q(0,$U,"needViewport",function(){var $V=this.normalizedViewport;return 0===$V.x&&0===$V.y&&1===$V.width&&1===$V.height}),$q(0,$U,"viewport",function(){if(this._viewportExpressedInClipSpace){var $V=this._normalizedViewport,$U=this.renderTargetSize,$r=$U.width,$s=$U.height;this._viewport.x=$V.x*$r,this._viewport.y=$V.y*$s,this._viewport.width=$V.width*$r,this._viewport.height=$V.height*$s}return this._viewport},function($V){if(null!=this.renderTarget&&($V.x<0||$V.y<0||0==$V.width||0==$V.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$V,this._calculateProjectionMatrix()}),$q(0,$U,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $V=this._viewport,$U=this.renderTargetSize,$r=$U.width,$s=$U.height;this._normalizedViewport.x=$V.x/$r,this._normalizedViewport.y=$V.y/$s,this._normalizedViewport.width=$V.width/$r,this._normalizedViewport.height=$V.height/$s}return this._normalizedViewport},function($V){$V.x<0&&($V.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$V.y<0&&($V.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$V.x+$V.width&&($V.width=1-$V.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$V.y+$V.height&&($V.height=1-$V.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$V,this._calculateProjectionMatrix()}),$q(0,$U,"projectionMatrix",function(){return this._projectionMatrix},function($V){this._projectionMatrix=$V,this._useUserProjectionMatrix=!0}),$q(0,$U,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$S($R,["_tempVector20",function(){return this._tempVector20=new $cU}]),$R}()),$eU=function($r){function $s($V,$U){$s.__super.call(this,$U),this._geometryFilter=new $EU(this),this._render=new $KU(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$V&&(this._geometryFilter.sharedMesh=$V)instanceof laya.d3.resource.models.Mesh&&($V.loaded?this._render.sharedMaterials=$V.materials:$V.once("loaded",this,this._applyMeshMaterials))}$G($s,"laya.d3.core.MeshSprite3D",$r);var $V=$s.prototype;return $V._changeRenderObjectByMesh=function($V){var $U=this._render._renderElements,$r=$U[$V];$r||($r=$U[$V]=new $yU),$r._render=this._render;var $s=this._render.sharedMaterials[$V];$s||($s=$xU.defaultMaterial);var $p=this._geometryFilter.sharedMesh.getRenderElement($V);return $r._mainSortID=this._getSortID($p,$s),$r._sprite3D=this,$r.renderObj=$p,$r._material=$s,$r},$V._changeRenderObjectByMaterial=function($V,$U){var $r=this._render._renderElements[$V];$U||($U=$xU.defaultMaterial);var $s=this._geometryFilter.sharedMesh.getRenderElement($V);return $r._mainSortID=this._getSortID($s,$U),$r._sprite3D=this,$r.renderObj=$s,$r._material=$U,$r},$V._changeRenderObjectsByMesh=function(){var $V=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$V;for(var $U=0;$U<$V;$U++)this._changeRenderObjectByMesh($U)},$V._onMeshChanged=function($V){var $U=$V.sharedMesh;$U.loaded?this._changeRenderObjectsByMesh():$U.once("loaded",this,this._onMeshLoaded)},$V._onMeshLoaded=function($V){$V===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$V._onMaterialChanged=function($V,$U,$r){$U<this._render._renderElements.length&&this._changeRenderObjectByMaterial($U,$r)},$V._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$V._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$V._parseCustomProps=function($V,$U,$r,$s){var $p=this.meshRender,$c=$r.lightmapIndex;null!=$c&&($p.lightmapIndex=$c);var $R,$T,$N=$r.lightmapScaleOffset;if($N&&($p.lightmapScaleOffset=new $TU($N[0],$N[1],$N[2],$N[3])),$s.instanceParams)($R=$s.instanceParams.loadPath)&&($T=$l.getRes($U[$R]),(this.meshFilter.sharedMesh=$T).loaded?$p.sharedMaterials=$T.materials:$T.once("loaded",this,this._applyMeshMaterials));else{($R=$r.meshPath)&&($T=$l.getRes($U[$R]),this.meshFilter.sharedMesh=$T);var $t=$r.materials;if($t){var $b=$p.sharedMaterials,$S=$t.length;$b.length=$S;for(var $_=0;$_<$S;$_++)$b[$_]=$l.getRes($U[$t[$_].path]);$p.sharedMaterials=$b}}},$V._applyMeshMaterials=function($V){for(var $U=this._render.sharedMaterials,$r=$V.materials,$s=0,$p=$r.length;$s<$p;$s++)$U[$s]||($U[$s]=$r[$s]);this._render.sharedMaterials=$U},$V._addToInitStaticBatchManager=function(){$s._staticBatchManager._addInitBatchSprite(this)},$V.cloneTo=function($V){var $U=$V;$U._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $r=this._render,$s=$U._render;$s.enable=$r.enable,$s.sharedMaterials=$r.sharedMaterials,$s.castShadow=$r.castShadow;var $p=$r.lightmapScaleOffset;$p&&($s.lightmapScaleOffset=$p.clone()),$s.lightmapIndex=$r.lightmapIndex,$s.receiveShadow=$r.receiveShadow,$s.sortingFudge=$r.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$V)},$V.destroy=function($V){if(void 0===$V&&($V=!0),!this.destroyed){var $U=this.meshFilter.sharedMesh;null!=$U&&($U.loaded||$U.off("loaded",this,this._applyMeshMaterials)),$r.prototype.destroy.call(this,$V),this._geometryFilter._destroy()}},$q(0,$V,"meshFilter",function(){return this._geometryFilter}),$q(0,$V,"meshRender",function(){return this._render}),$s.__init__=function(){$sV._staticBatchManagers.push($s._staticBatchManager)},$s.load=function($V){return $d.loader.create($V,null,null,$s)},$S($s,["_staticBatchManager",function(){return this._staticBatchManager=new $nU}]),$s}($AU)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}}),function($V,$U,$pV){$pV.un,$pV.uns;var $r=$pV.static,$s=$pV.class,$c=$pV.getset,$u=$pV.__newvec,$T=laya.maths.Bezier,$S=laya.utils.Browser,$wV=laya.utils.Byte,$p=(laya.events.Event,laya.events.EventDispatcher),$R=laya.display.Graphics,$N=(laya.resource.HTMLCanvas,laya.utils.Handler),$t=laya.net.Loader,$_=laya.maths.MathUtil,$zV=laya.maths.Matrix,$h=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$b=(laya.renders.RenderContext,laya.resource.Resource),$G=laya.utils.RunDriver,$cV=laya.display.Sprite,$q=laya.utils.Stat,$EV=laya.resource.Texture,$l=(laya.net.URL,laya.utils.Utils),$z=function(){function $V(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $s($V,"laya.ani.AnimationContent"),$V}(),$E=function(){function $V(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $s($V,"laya.ani.AnimationNodeContent"),$V}(),$O=function(){function $V(){}return $s($V,"laya.ani.AnimationParser01"),$V.parse=function($V,$U){var $r=$U.__getBuffer(),$s=0,$p=0,$c=0,$R=0,$T=0,$N=0,$t=0,$b=$U.readUTFString();$V._aniClassName=$b;var $S,$_=$U.readUTFString().split("\n"),$G=$U.getUint8(),$q=$U.getUint32(),$u=$U.getUint32();0<$q&&($S=$r.slice($q,$u));var $h=new $wV($S);for(0<$u&&($V._publicExtData=$r.slice($u,$r.byteLength)),$V._useParent=!!$U.getUint8(),$V._anis.length=$G,$s=0;$s<$G;$s++){var $l=$V._anis[$s]=new $z;$l.nodes=new Array;var $W=$l.name=$_[$U.getUint16()];$V._aniMap[$W]=$s,$l.bone3DMap={},$l.playTime=$U.getFloat32(),$l.playTime<=0&&console.error("播放时间不能为0  url="+$V.url+" name="+$l.name);var $O=$l.nodes.length=$U.getUint8();for($p=$l.totalKeyframeDatasLength=0;$p<$O;$p++){var $L=$l.nodes[$p]=new $E;$L.childs=[];var $d=$U.getInt16();0<=$d&&($L.name=$_[$d],$l.bone3DMap[$L.name]=$p),$L.keyFrame=new Array,$L.parentIndex=$U.getInt16(),-1==$L.parentIndex?$L.parent=null:$L.parent=$l.nodes[$L.parentIndex],$L.lerpType=$U.getUint8();var $k=$U.getUint32();$h.pos=$k;var $y=$L.keyframeWidth=$h.getUint16();if($l.totalKeyframeDatasLength+=$y,0===$L.lerpType||1===$L.lerpType)for($L.interpolationMethod=[],$L.interpolationMethod.length=$y,$c=0;$c<$y;$c++)$L.interpolationMethod[$c]=$a.interpolation[$h.getUint8()];null!=$L.parent&&$L.parent.childs.push($L);var $D=$U.getUint16();0<$D&&($L.extenData=$r.slice($U.pos,$U.pos+$D),$U.pos+=$D);var $n,$I=$U.getUint16(),$Q=0;for($c=0,$R=$L.keyFrame.length=$I;$c<$R;$c++){if(($n=$L.keyFrame[$c]=new $K).duration=$U.getFloat32(),$n.startTime=$Q,2===$L.lerpType){$n.interpolationData=[];var $H,$w=$U.getUint8();switch($H=$U.getFloat32()){case 254:for($n.interpolationData.length=$y,$t=0;$t<$y;$t++)$n.interpolationData[$t]=0;break;case 255:for($n.interpolationData.length=$y,$t=0;$t<$y;$t++)$n.interpolationData[$t]=5;break;default:for($n.interpolationData.push($H),$N=1;$N<$w;$N++)$n.interpolationData.push($U.getFloat32())}}for($n.data=new Float32Array($y),$T=0;$T<$y;$T++)$n.data[$T]=$U.getFloat32(),-1e-8<$n.data[$T]&&$n.data[$T]<1e-8&&($n.data[$T]=0);$Q+=$n.duration}$n.startTime=$l.playTime,$L.playTime=$l.playTime,$V._calculateKeyFrame($L,$I,$y)}}},$V}(),$L=function(){function $d(){}return $s($d,"laya.ani.AnimationParser02"),$d.READ_DATA=function(){$d._DATA.offset=$d._reader.getUint32(),$d._DATA.size=$d._reader.getUint32()},$d.READ_BLOCK=function(){for(var $V=$d._BLOCK.count=$d._reader.getUint16(),$U=$d._BLOCK.blockStarts=[],$r=$d._BLOCK.blockLengths=[],$s=0;$s<$V;$s++)$U.push($d._reader.getUint32()),$r.push($d._reader.getUint32())},$d.READ_STRINGS=function(){var $V=$d._reader.getUint32(),$U=$d._reader.getUint16(),$r=$d._reader.pos;$d._reader.pos=$V+$d._DATA.offset;for(var $s=0;$s<$U;$s++)$d._strings[$s]=$d._reader.readUTFString();$d._reader.pos=$r},$d.parse=function($V,$U){$d._templet=$V;($d._reader=$U).__getBuffer();$d.READ_DATA(),$d.READ_BLOCK(),$d.READ_STRINGS();for(var $r=0,$s=$d._BLOCK.count;$r<$s;$r++){var $p=$U.getUint16(),$c=$d._strings[$p],$R=$d["READ_"+$c];if(null==$R)throw new Error("model file err,no this function:"+$p+" "+$c);$R.call()}},$d.READ_ANIMATIONS=function(){var $V=$d._reader,$U=$V.__getBuffer(),$r=0,$s=0,$p=0,$c=0,$R=$V.getUint16(),$T=[];for($T.length=$R,$r=0;$r<$R;$r++)$T[$r]=$a.interpolation[$V.getByte()];var $N=$V.getUint8();for($d._templet._anis.length=$N,$r=0;$r<$N;$r++){var $t=$d._templet._anis[$r]={};$t.nodes=new Array;var $b=$t.name=$d._strings[$V.getUint16()];$d._templet._aniMap[$b]=$r,$t.bone3DMap={},$t.playTime=$V.getFloat32();var $S=$t.nodes.length=$V.getInt16();for($s=$t.totalKeyframeDatasLength=0;$s<$S;$s++){var $_=$t.nodes[$s]={};$_.keyframeWidth=$R,$_.childs=[];var $G=$V.getUint16();0<=$G&&($_.name=$d._strings[$G],$t.bone3DMap[$_.name]=$s),$_.keyFrame=new Array,$_.parentIndex=$V.getInt16(),-1==$_.parentIndex?$_.parent=null:$_.parent=$t.nodes[$_.parentIndex],$t.totalKeyframeDatasLength+=$R,$_.interpolationMethod=$T,null!=$_.parent&&$_.parent.childs.push($_);var $q=$V.getUint16(),$u=null,$h=null;for($p=0,$c=$_.keyFrame.length=$q;$p<$c;$p++){($u=$_.keyFrame[$p]={}).startTime=$V.getFloat32(),$h&&($h.duration=$u.startTime-$h.startTime);var $l=$d._DATA.offset,$W=$V.getUint32(),$O=4*$R,$L=$U.slice($l+$W,$l+$W+$O);$u.data=new Float32Array($L),$h=$u}$u.duration=0,$_.playTime=$t.playTime,$d._templet._calculateKeyFrame($_,$q,$R)}}},$d._templet=null,$d._reader=null,$d._strings=[],$r($d,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$d}(),$KV=(function(){function $V(){}$s($V,"laya.ani.AnimationState"),$V.stopped=0,$V.paused=1,$V.playing=2}(),function(){function $p(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $AV,this.resultMatrix=new $zV,this._children=[]}$s($p,"laya.ani.bone.Bone");var $V=$p.prototype;return $V.setTempMatrix=function($V){this._tempMatrix=$V;var $U,$r=0;for($r=0,$U=this._children.length;$r<$U;$r++)this._children[$r].setTempMatrix(this._tempMatrix)},$V.update=function($V){var $U;if(this.rotation=this.transform.skX,$V)$U=this.resultTransform.getMatrix(),$zV.mul($U,$V,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$U=this.resultTransform.getMatrix(),$zV.mul($U,this.parentBone.resultMatrix,this.resultMatrix);else{var $r=this.parentBone,$s=NaN,$p=NaN,$c=NaN,$R=this.parentBone.resultMatrix;$U=this.resultTransform.getMatrix();var $T=$R.a*$U.tx+$R.c*$U.ty+$R.tx,$N=$R.b*$U.tx+$R.d*$U.ty+$R.ty,$t=new $zV;this.inheritRotation?($s=Math.atan2($r.resultMatrix.b,$r.resultMatrix.a),$p=Math.cos($s),$c=Math.sin($s),$t.setTo($p,$c,-$c,$p,0,0),$zV.mul(this._tempMatrix,$t,$zV.TEMP),$zV.TEMP.copyTo($t),$U=this.resultTransform.getMatrix(),$zV.mul($U,$t,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$U=this.resultTransform.getMatrix(),$zV.TEMP.identity(),$zV.TEMP.d=this.d,$zV.mul($U,$zV.TEMP,this.resultMatrix)),this.resultMatrix.tx=$T,this.resultMatrix.ty=$N}else($U=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $b,$S=0;for($S=0,$b=this._children.length;$S<$b;$S++)this._children[$S].update()},$V.updateChild=function(){var $V,$U=0;for($U=0,$V=this._children.length;$U<$V;$U++)this._children[$U].update()},$V.setRotation=function($V){this._sprite&&(this._sprite.rotation=180*$V/Math.PI)},$V.updateDraw=function($V,$U){$p.ShowBones&&!$p.ShowBones[this.name]||(this._sprite||(this._sprite=new $cV,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$pV.stage.addChild(this._sprite)),this._sprite.x=$V+this.resultMatrix.tx,this._sprite.y=$U+this.resultMatrix.ty);var $r,$s=0;for($s=0,$r=this._children.length;$s<$r;$s++)this._children[$s].updateDraw($V,$U)},$V.addChild=function($V){this._children.push($V),$V.parentBone=this},$V.findBone=function($V){if(this.name==$V)return this;var $U,$r,$s=0;for($s=0,$U=this._children.length;$s<$U;$s++)if($r=this._children[$s].findBone($V))return $r;return null},$V.localToWorld=function($V){var $U=$V[0],$r=$V[1];$V[0]=$U*this.resultMatrix.a+$r*this.resultMatrix.c+this.resultMatrix.tx,$V[1]=$U*this.resultMatrix.b+$r*this.resultMatrix.d+this.resultMatrix.ty},$p.ShowBones={},$p}()),$mV=function(){function $u(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$s($u,"laya.ani.bone.BoneSlot");var $V=$u.prototype;return $V.showSlotData=function($V,$U){void 0===$U&&($U=!0),this.currSlotData=$V,$U&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$V.showDisplayByName=function($V){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($V))},$V.replaceDisplayByName=function($V,$U){if(this.currSlotData){var $r;$r=this.currSlotData.getDisplayByName($V);var $s;$s=this.currSlotData.getDisplayByName($U),this.replaceDisplayByIndex($r,$s)}},$V.replaceDisplayByIndex=function($V,$U){this.currSlotData&&(this._replaceDic[$V]=$U,this.displayIndex==$V&&this.showDisplayByIndex($V))},$V.showDisplayByIndex=function($V){if(null!=this._replaceDic[$V]&&($V=this._replaceDic[$V]),this.currSlotData&&-1<$V&&$V<this.currSlotData.displayArr.length){if(this.displayIndex=$V,this.currDisplayData=this.currSlotData.displayArr[$V],this.currDisplayData){var $U=this.currDisplayData.name;this.currTexture=this.templet.getTexture($U),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$h.isConchApp||$h.isConchApp&&"0.9.15"<$cV.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$V.replaceSkin=function($V){this._diyTexture=$V,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$V.setParentMatrix=function($V){this._parentMatrix=$V},$V.draw=function($V,$U,$r,$s){if(void 0===$r&&($r=!1),void 0===$s&&($s=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $p,$c=this.currTexture;switch(this._diyTexture&&($c=this._diyTexture),this.currDisplayData.type){case 0:if($V){var $R=this.getDisplayMatrix();if(this._parentMatrix){var $T=!1;if($R){var $N;if($zV.mul($R,this._parentMatrix,$zV.TEMP),$N=$r?(null==this._resultMatrix&&(this._resultMatrix=new $zV),this._resultMatrix):new $zV,!$h.isWebGL&&this.currDisplayData.uvs||$h.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $t=$u._tempMatrix;$t.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($t.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($T=!0,$t.rotate(-Math.PI/2)),$zV.mul($t,$zV.TEMP,$N)}else $zV.TEMP.copyTo($N);$T?$V.drawTexture($c,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$N):$V.drawTexture($c,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$N)}}}break;case 1:if(null==($p=$r?(null==this._skinSprite&&(this._skinSprite=$u.createSkinMesh()),this._skinSprite):$u.createSkinMesh()))return;var $b;if(null==this.currDisplayData.bones){var $S,$_=this.currDisplayData.weights;this.deformData&&($_=this.deformData),$S=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$_;this.currDisplayData.triangles.length;$b=this.currDisplayData.triangles,$p.init2($c,null,$b,this._mVerticleArr,$S);var $G,$q=this.getDisplayMatrix();if(this._parentMatrix)if($q)$zV.mul($q,this._parentMatrix,$zV.TEMP),$G=$r?(null==this._resultMatrix&&(this._resultMatrix=new $zV),this._resultMatrix):new $zV,$zV.TEMP.copyTo($G),$p.transform=$G}else this.skinMesh($U,$p,$s);$V.drawSkin($p);break;case 2:if(null==($p=$r?(null==this._skinSprite&&(this._skinSprite=$u.createSkinMesh()),this._skinSprite):$u.createSkinMesh()))return;this.skinMesh($U,$p,$s),$V.drawSkin($p)}}},$V.skinMesh=function($V,$U,$r){var $s,$p=this.currTexture,$c=this.currDisplayData.bones;$s=this._diyTexture?($p=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$y.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$y.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $R,$T,$N=this.currDisplayData.weights,$t=this.currDisplayData.triangles,$b=0,$S=0,$_=0,$G=NaN,$q=NaN,$u=0,$h=0,$l=[],$W=0,$O=0;if(this.deformData&&0<this.deformData.length){var $L=0;for($W=0,$O=$c.length;$W<$O;){for($_=$c[$W++]+$W,$S=$b=0;$W<$_;$W++)$T=$V[$c[$W]],$G=$N[$u]+this.deformData[$L++],$q=$N[$u+1]+this.deformData[$L++],$h=$N[$u+2],$b+=($G*$T.a+$q*$T.c+$T.tx)*$h,$S+=($G*$T.b+$q*$T.d+$T.ty)*$h,$u+=3;$l.push($b,$S)}}else for($W=0,$O=$c.length;$W<$O;){for($_=$c[$W++]+$W,$S=$b=0;$W<$_;$W++)$T=$V[$c[$W]],$G=$N[$u],$q=$N[$u+1],$h=$N[$u+2],$b+=($G*$T.a+$q*$T.c+$T.tx)*$h,$S+=($G*$T.b+$q*$T.d+$T.ty)*$h,$u+=3;$l.push($b,$S)}this._mVerticleArr=$l,$R=$t,$U.init2($p,null,$R,this._mVerticleArr,$s)},$V.drawBonePoint=function($V){$V&&this._parentMatrix&&$V.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$V.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$V.getMatrix=function(){return this._resultMatrix},$V.copy=function(){var $V=new $u;return $V.type="copy",$V.name=this.name,$V.attachmentName=this.attachmentName,$V.srcDisplayIndex=this.srcDisplayIndex,$V.parent=this.parent,$V.displayIndex=this.displayIndex,$V.templet=this.templet,$V.currSlotData=this.currSlotData,$V.currTexture=this.currTexture,$V.currDisplayData=this.currDisplayData,$V},$u.createSkinMesh=function(){return $h.isWebGL||$h.isConchApp?$G.skinAniSprite():($h.isWebGL,null)},$r($u,["_tempMatrix",function(){return this._tempMatrix=new $zV}]),$u}(),$aV=function(){function $V(){this.skinName=null,this.deformSlotDataList=[]}return $s($V,"laya.ani.bone.DeformAniData"),$V}(),$ZV=function(){function $V(){this.deformSlotDisplayList=[]}return $s($V,"laya.ani.bone.DeformSlotData"),$V}(),$xV=function(){function $V(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$s($V,"laya.ani.bone.DeformSlotDisplayData");var $U=$V.prototype;return $U.binarySearch1=function($V,$U){var $r=0,$s=$V.length-2;if(0==$s)return 1;for(var $p=$s>>>1;;){if($V[Math.floor($p+1)]<=$U?$r=$p+1:$s=$p,$r==$s)return $r+1;$p=$r+$s>>>1}return 0},$U.apply=function($V,$U,$r){if(void 0===$r&&($r=1),$V+=.05,!(this.timeList.length<=0)){var $s=0;if(!($V<this.timeList[0])){var $p=this.vectices[0].length,$c=[],$R=this.binarySearch1(this.timeList,$V);if(this.frameIndex=$R,$V>=this.timeList[this.timeList.length-1]){var $T=this.vectices[this.vectices.length-1];if($r<1)for($s=0;$s<$p;$s++)$c[$s]+=($T[$s]-$c[$s])*$r;else for($s=0;$s<$p;$s++)$c[$s]=$T[$s];this.deformData=$c}else{this.tweenKeyList[this.frameIndex];var $N=this.vectices[this.frameIndex-1],$t=this.vectices[this.frameIndex],$b=this.timeList[this.frameIndex-1],$S=this.timeList[this.frameIndex];$r=this.tweenKeyList[$R-1]?($V-$b)/($S-$b):0;var $_=NaN;for($s=0;$s<$p;$s++)$_=$N[$s],$c[$s]=$_+($t[$s]-$_)*$r;this.deformData=$c}}}},$V}(),$$V=function(){function $V(){this.time=NaN,this.drawOrder=[]}return $s($V,"laya.ani.bone.DrawOrderData"),$V}(),$jV=function(){function $V(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $s($V,"laya.ani.bone.EventData"),$V}(),$W=function(){function $sV($V,$U){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$V,this._targetBone=$U[$V.targetBoneIndex],this.isSpine=$V.isSpine,null==this._bones&&(this._bones=[]);for(var $r=this._bones.length=0,$s=$V.boneIndexs.length;$r<$s;$r++)this._bones.push($U[$V.boneIndexs[$r]]);this.name=$V.name,this.mix=$V.mix,this.bendDirection=$V.bendDirection}$s($sV,"laya.ani.bone.IkConstraint");var $V=$sV.prototype;return $V.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$V._applyIk1=function($V,$U,$r,$s){var $p=$V.parentBone,$c=1/($p.resultMatrix.a*$p.resultMatrix.d-$p.resultMatrix.b*$p.resultMatrix.c),$R=$U-$p.resultMatrix.tx,$T=$r-$p.resultMatrix.ty,$N=($R*$p.resultMatrix.d-$T*$p.resultMatrix.c)*$c-$V.transform.x,$t=($T*$p.resultMatrix.a-$R*$p.resultMatrix.b)*$c-$V.transform.y,$b=Math.atan2($t,$N)*$sV.radDeg-0-$V.transform.skX;$V.transform.scX<0&&($b+=180),180<$b?$b-=360:$b<-180&&($b+=360),$V.transform.skX=$V.transform.skY=$V.transform.skX+$b*$s,$V.update()},$V.updatePos=function($V,$U){this._sp&&this._sp.pos($V,$U)},$V._applyIk2=function($V,$U,$r,$s,$p,$c){if(0!=$c){var $R=$V.resultTransform.x,$T=$V.resultTransform.y,$N=$V.transform.scX,$t=$V.transform.scY,$b=$U.transform.scX,$S=0,$_=0,$G=0;$G=$N<0?($N=-$N,$S=180,-1):($S=0,1),$t<0&&($t=-$t,$G=-$G),$_=$b<0?($b=-$b,180):0;var $q=$U.resultTransform.x,$u=NaN,$h=NaN,$l=NaN,$W=$V.resultMatrix.a,$O=$V.resultMatrix.c,$L=$V.resultMatrix.b,$d=$V.resultMatrix.d,$k=Math.abs($N-$t)<=1e-4;$l=$k?($h=$W*$q+$O*($u=$U.resultTransform.y)+$V.resultMatrix.tx,$L*$q+$d*$u+$V.resultMatrix.ty):($u=0,$h=$W*$q+$V.resultMatrix.tx,$L*$q+$V.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $cV,$pV.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($r,$s,15,"#ffff00"),this._sp.graphics.drawCircle($h,$l,15,"#ff00ff")),$V.setRotation(Math.atan2($l-$V.resultMatrix.ty,$h-$V.resultMatrix.tx));var $y=$V.parentBone;$W=$y.resultMatrix.a,$O=$y.resultMatrix.c,$L=$y.resultMatrix.b;var $D=1/($W*($d=$y.resultMatrix.d)-$O*$L),$n=$r-$y.resultMatrix.tx,$I=$s-$y.resultMatrix.ty,$Q=($n*$d-$I*$O)*$D-$R,$H=($I*$W-$n*$L)*$D-$T,$w=(($n=$h-$y.resultMatrix.tx)*$d-($I=$l-$y.resultMatrix.ty)*$O)*$D-$R,$z=($I*$W-$n*$L)*$D-$T,$E=Math.sqrt($w*$w+$z*$z),$K=$U.length*$b,$m=NaN,$a=NaN;if($k){var $Z=($Q*$Q+$H*$H-$E*$E-($K*=$N)*$K)/(2*$E*$K);$Z<-1?$Z=-1:1<$Z&&($Z=1),$a=Math.acos($Z)*$p,$W=$E+$K*$Z,$O=$K*Math.sin($a),$m=Math.atan2($H*$W-$Q*$O,$Q*$W+$H*$O)}else{var $x=($W=$N*$K)*$W,$$=($O=$t*$K)*$O,$j=$Q*$Q+$H*$H,$o=Math.atan2($H,$Q),$J=-2*$$*$E,$i=$$-$x;if(0<($d=$J*$J-4*$i*($L=$$*$E*$E+$x*$j-$x*$$))){var $B=Math.sqrt($d);$J<0&&($B=-$B);var $P=($B=-($J+$B)/2)/$i,$M=$L/$B,$A=Math.abs($P)<Math.abs($M)?$P:$M;$A*$A<=$j&&($I=Math.sqrt($j-$A*$A)*$p,$m=$o-Math.atan2($I,$A),$a=Math.atan2($I/$t,($A-$E)/$N))}var $X=0,$e=Number.MAX_VALUE,$F=0,$g=0,$v=0,$Y=0,$C=0,$f=0;$Y<($d=($n=$E+$W)*$n)&&($v=0,$Y=$d,$C=$n),($d=($n=$E-$W)*$n)<$e&&($X=Math.PI,$e=$d,$F=$n);var $VV=Math.acos(-$W*$E/($x-$$));($d=($n=$W*Math.cos($VV)+$E)*$n+($I=$O*Math.sin($VV))*$I)<$e&&($X=$VV,$e=$d,$F=$n,$g=$I),$Y<$d&&($v=$VV,$Y=$d,$C=$n,$f=$I),$a=$j<=($e+$Y)/2?($m=$o-Math.atan2($g*$p,$F),$X*$p):($m=$o-Math.atan2($f*$p,$C),$v*$p)}var $UV=Math.atan2($u,$q)*$G,$rV=$V.resultTransform.skX;180<($m=($m-$UV)*$sV.radDeg+$S-$rV)?$m-=360:$m<-180&&($m+=360),$V.resultTransform.x=$R,$V.resultTransform.y=$T,$V.resultTransform.skX=$V.resultTransform.skY=$rV+$m*$c,$rV=$U.resultTransform.skX,180<($a=(($a+$UV)*$sV.radDeg-0)*$G+$_-($rV%=360))?$a-=360:$a<-180&&($a+=360),$U.resultTransform.x=$q,$U.resultTransform.y=$u,$U.resultTransform.skX=$U.resultTransform.skY=$U.resultTransform.skY+$a*$c,$V.update()}},$V._applyIk3=function($V,$U,$r,$s,$p,$c){if(0!=$c){var $R,$T,$N=$U.resultMatrix.a*$U.length,$t=$U.resultMatrix.b*$U.length,$b=$N*$N+$t*$t,$S=Math.sqrt($b),$_=$V.resultMatrix.tx,$G=$V.resultMatrix.ty,$q=$U.resultMatrix.tx,$u=$U.resultMatrix.ty,$h=$q-$_,$l=$u-$G,$W=$h*$h+$l*$l,$O=Math.sqrt($W),$L=($h=$r-$V.resultMatrix.tx)*$h+($l=$s-$V.resultMatrix.ty)*$l,$d=Math.sqrt($L);if($S+$O<=$d||$d+$S<=$O||$d+$O<=$S){var $k=NaN;$q=$_+($k=$S+$O<=$d?1:-1)*($r-$_)*$O/$d,$u=$G+$k*($s-$G)*$O/$d}else{var $y=($W-$b+$L)/(2*$L),$D=Math.sqrt($W-$y*$y*$L)/$d,$n=$_+$h*$y,$I=$G+$l*$y,$Q=-$l*$D,$H=$h*$D;$u=0<$p?($q=$n-$Q,$I-$H):($q=$n+$Q,$I+$H)}$R=$q,$T=$u,this.isDebug&&(this._sp||(this._sp=new $cV,$pV.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($_,$G,15,"#ff00ff"),this._sp.graphics.drawCircle($r,$s,15,"#ffff00"),this._sp.graphics.drawCircle($R,$T,15,"#ff00ff"));var $w,$z;$w=Math.atan2($T-$V.resultMatrix.ty,$R-$V.resultMatrix.tx),$V.setRotation($w),($z=$sV._tempMatrix).identity(),$z.rotate($w),$z.scale($V.resultMatrix.getScaleX(),$V.resultMatrix.getScaleY()),$z.translate($V.resultMatrix.tx,$V.resultMatrix.ty),$z.copyTo($V.resultMatrix),$V.updateChild();var $E,$K;$E=Math.atan2($s-$T,$r-$R),$U.setRotation($E),($K=$sV._tempMatrix).identity(),$K.rotate($E),$K.scale($U.resultMatrix.getScaleX(),$U.resultMatrix.getScaleY()),$K.translate($R,$T),$z.copyTo($U.resultMatrix),$U.updateChild()}},$r($sV,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $zV}]),$sV}(),$oV=function(){function $V(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $s($V,"laya.ani.bone.IkConstraintData"),$V}(),$d=function(){function $K($V,$U){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$V,this.position=$V.position,this.spacing=$V.spacing,this.rotateMix=$V.rotateMix,this.translateMix=$V.translateMix,this.bones=[];for(var $r=this.data.bones,$s=0,$p=$r.length;$s<$p;$s++)this.bones.push($U[$r[$s]])}$s($K,"laya.ani.bone.PathConstraint");var $V=$K.prototype;return $V.apply=function($V,$U){if(this.target){var $r=this.translateMix,$s=this.translateMix,$p=0<$s,$c=this.data.spacingMode,$R="length"==$c,$T=this.data.rotateMode,$N="tangent"==$T,$t="chainScale"==$T,$b=[],$S=this.bones.length,$_=$N?$S:$S+1,$G=[];(this._spaces=$G)[0]=this.position;var $q=this.spacing;if($t||$R)for(var $u=0,$h=$_-1;$u<$h;){var $l=this.bones[$u],$W=$l.length,$O=$W*$l.resultMatrix.a,$L=$W*$l.resultMatrix.b;$W=Math.sqrt($O*$O+$L*$L),$t&&($b[$u]=$W),$G[++$u]=$R?Math.max(0,$W+$q):$q}else for($u=1;$u<$_;$u++)$G[$u]=$q;var $d=this.computeWorldPositions(this.target,$V,$U,$_,$N,"percent"==this.data.positionMode,"percent"==$c);if(this._debugKey){for($u=0;$u<$d.length;$u++)$U.drawCircle($d[$u++],$d[$u++],5,"#00ff00");var $k=[];for($u=0;$u<$d.length;$u++)$k.push($d[$u++],$d[$u++]);$U.drawLines(0,0,$k,"#ff0000")}var $y=$d[0],$D=$d[1],$n=this.data.offsetRotation,$I="chain"==$T&&0==$n,$Q=NaN;for($u=0,$Q=3;$u<$S;$u++,$Q+=3){($l=this.bones[$u]).resultMatrix.tx+=($y-$l.resultMatrix.tx)*$r,$l.resultMatrix.ty+=($D-$l.resultMatrix.ty)*$r;var $H=($O=$d[$Q])-$y,$w=($L=$d[$Q+1])-$D;if($t&&0!=($W=$b[$u])){var $z=(Math.sqrt($H*$H+$w*$w)/$W-1)*$s+1;$l.resultMatrix.a*=$z,$l.resultMatrix.c*=$z}if($y=$O,$D=$L,$p){var $E=$l.resultMatrix.a,$K=$l.resultMatrix.c,$m=$l.resultMatrix.b,$a=$l.resultMatrix.d,$Z=NaN,$x=NaN,$$=NaN;$Z=$N?$d[$Q-1]:0==$G[$u+1]?$d[$Q+2]:Math.atan2($w,$H),$Z-=Math.atan2($m,$E)-$n/180*Math.PI,$I&&($x=Math.cos($Z),$$=Math.sin($Z),$y+=(($W=$l.length)*($x*$E-$$*$m)-$H)*$s,$D+=($W*($$*$E+$x*$m)-$w)*$s),$Z>Math.PI?$Z-=2*Math.PI:$Z<-Math.PI&&($Z+=2*Math.PI),$Z*=$s,$x=Math.cos($Z),$$=Math.sin($Z),$l.resultMatrix.a=$x*$E-$$*$m,$l.resultMatrix.c=$x*$K-$$*$a,$l.resultMatrix.b=$$*$E+$x*$m,$l.resultMatrix.d=$$*$K+$x*$a}}}},$V.computeWorldVertices2=function($V,$U,$r,$s,$p,$c){var $R,$T,$N=$V.currDisplayData.bones,$t=$V.currDisplayData.weights,$b=$V.currDisplayData.triangles,$S=0,$_=0,$G=0,$q=0,$u=0,$h=0,$l=0,$W=0,$O=0,$L=0,$d=0;if(null!=$N){for($S=0;$S<$r;$S+=2)$_+=($q=$N[$_])+1,$G+=$q;var $k=$U;for($u=$c,$h=3*$G;$u<$s;$u+=2){for($W=$l=0,$q=$N[$_++],$q+=$_;$_<$q;$_++,$h+=3){$R=$k[$N[$_]].resultMatrix,$O=$t[$h],$L=$t[$h+1];var $y=$t[$h+2];$l+=($O*$R.a+$L*$R.c+$R.tx)*$y,$W+=($O*$R.b+$L*$R.d+$R.ty)*$y}$p[$u]=$l,$p[$u+1]=$W}}else{var $D,$n;if($b||($b=$t),$V.deformData&&($b=$V.deformData),$D=$V.parent,$U)for($d=$U.length,$S=0;$S<$d;$S++)if($U[$S].name==$D){$T=$U[$S];break}$T&&($n=$T.resultMatrix),$n||($n=$K._tempMt);var $I=$n.tx,$Q=$n.ty,$H=$n.a,$w=$n.b,$z=$n.c,$E=$n.d;for($T&&($E*=$T.d),$_=$r,$u=$c;$u<$s;$_+=2,$u+=2)$O=$b[$_],$L=$b[$_+1],$p[$u]=$O*$H+$L*$w+$I,$p[$u+1]=-($O*$z+$L*$E+$Q)}},$V.computeWorldPositions=function($V,$U,$r,$s,$p,$c,$R){$V.currDisplayData.bones,$V.currDisplayData.weights,$V.currDisplayData.triangles;var $T=[],$N=0,$t=$V.currDisplayData.verLen,$b=this.position,$S=this._spaces,$_=[],$G=[],$q=$t/6,$u=-1,$h=NaN,$l=0,$W=0,$O=NaN,$L=NaN,$d=NaN,$k=NaN;if($q--,$t-=4,this.computeWorldVertices2($V,$U,2,$t,$T,0),this._debugKey)for($N=0;$N<$T.length;)$r.drawCircle($T[$N++],$T[$N++],10,"#ff0000");$_=$T,this._curves.length=$q;var $y=this._curves,$D=$_[$h=0],$n=$_[1],$I=0,$Q=0,$H=0,$w=0,$z=0,$E=0,$K=NaN,$m=NaN,$a=NaN,$Z=NaN,$x=NaN,$$=NaN,$j=NaN,$o=NaN,$J=0;for($N=0,$J=2;$N<$q;$N++,$J+=6)$I=$_[$J],$Q=$_[$J+1],$H=$_[$J+2],$w=$_[$J+3],$x=2*($K=.1875*($D-2*$I+$H))+($a=.09375*(3*($I-$H)-$D+($z=$_[$J+4]))),$$=2*($m=.1875*($n-2*$Q+$w))+($Z=.09375*(3*($Q-$w)-$n+($E=$_[$J+5]))),$j=.75*($I-$D)+$K+.16666667*$a,$o=.75*($Q-$n)+$m+.16666667*$Z,$h+=Math.sqrt($j*$j+$o*$o),$j+=$x,$o+=$$,$x+=$a,$$+=$Z,$h+=Math.sqrt($j*$j+$o*$o),$j+=$x,$o+=$$,$h+=Math.sqrt($j*$j+$o*$o),$j+=$x+$a,$o+=$$+$Z,$h+=Math.sqrt($j*$j+$o*$o),$y[$N]=$h,$D=$z,$n=$E;if($c&&($b*=$h),$R)for($N=0;$N<$s;$N++)$S[$N]*=$h;var $i=this._segments,$B=0,$P=0;for($P=$W=$l=$N=0;$N<$s;$N++,$l+=3)if(($O=$b+=$L=$S[$N])<0)this.addBeforePosition($O,$_,0,$G,$l);else if($h<$O)this.addAfterPosition($O-$h,$_,$t-4,$G,$l);else{for(;;$W++)if(!(($k=$y[$W])<$O)){0==$W?$O/=$k:$O=($O-($d=$y[$W-1]))/($k-$d);break}if($W!=$u){var $M=6*($u=$W);for($D=$_[$M],$n=$_[$M+1],$I=$_[$M+2],$Q=$_[$M+3],$H=$_[$M+4],$w=$_[$M+5],$x=2*($K=.03*($D-2*$I+$H))+($a=.006*(3*($I-$H)-$D+($z=$_[$M+6]))),$$=2*($m=.03*($n-2*$Q+$w))+($Z=.006*(3*($Q-$w)-$n+($E=$_[$M+7]))),$j=.3*($I-$D)+$K+.16666667*$a,$o=.3*($Q-$n)+$m+.16666667*$Z,$B=Math.sqrt($j*$j+$o*$o),$i[0]=$B,$M=1;$M<8;$M++)$j+=$x,$o+=$$,$x+=$a,$$+=$Z,$B+=Math.sqrt($j*$j+$o*$o),$i[$M]=$B;$j+=$x,$o+=$$,$B+=Math.sqrt($j*$j+$o*$o),$i[8]=$B,$j+=$x+$a,$o+=$$+$Z,$B+=Math.sqrt($j*$j+$o*$o),$i[9]=$B,$P=0}for($O*=$B;;$P++)if(!(($k=$i[$P])<$O)){0==$P?$O/=$k:$O=$P+($O-($d=$i[$P-1]))/($k-$d);break}this.addCurvePosition(.1*$O,$D,$n,$I,$Q,$H,$w,$z,$E,$G,$l,$p||0<$N&&0==$L)}return $G},$V.addBeforePosition=function($V,$U,$r,$s,$p){var $c=$U[$r],$R=$U[$r+1],$T=$U[$r+2]-$c,$N=$U[$r+3]-$R,$t=Math.atan2($N,$T);$s[$p]=$c+$V*Math.cos($t),$s[$p+1]=$R+$V*Math.sin($t),$s[$p+2]=$t},$V.addAfterPosition=function($V,$U,$r,$s,$p){var $c=$U[$r+2],$R=$U[$r+3],$T=$c-$U[$r],$N=$R-$U[$r+1],$t=Math.atan2($N,$T);$s[$p]=$c+$V*Math.cos($t),$s[$p+1]=$R+$V*Math.sin($t),$s[$p+2]=$t},$V.addCurvePosition=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b,$S){0==$V&&($V=1e-4);var $_=$V*$V,$G=$_*$V,$q=1-$V,$u=$q*$q,$h=$u*$q,$l=$q*$V,$W=3*$l,$O=$q*$W,$L=$W*$V,$d=$U*$h+$s*$O+$c*$L+$T*$G,$k=$r*$h+$p*$O+$R*$L+$N*$G;$t[$b]=$d,$t[$b+1]=$k,$t[$b+2]=$S?Math.atan2($k-($r*$u+$p*$l*2+$R*$_),$d-($U*$u+$s*$l*2+$c*$_)):0},$K.NONE=-1,$K.BEFORE=-2,$K.AFTER=-3,$r($K,["_tempMt",function(){return this._tempMt=new $zV}]),$K}(),$JV=function(){function $V(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $s($V,"laya.ani.bone.PathConstraintData"),$V}(),$iV=function(){function $V(){this.name=null,this.slotArr=[]}return $s($V,"laya.ani.bone.SkinData"),$V}(),$BV=function(){function $V(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$s($V,"laya.ani.bone.SkinSlotDisplayData");var $U=$V.prototype;return $U.createTexture=function($V){return this.texture||(this.texture=new $EV($V.bitmap,this.uvs),$V.bitmap.alphaTexture&&(this.texture.alphaTexture=new $EV($V.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$V.height,this.texture.height=$V.width,this.texture.offsetX=-$V.offsetX,this.texture.offsetY=-$V.offsetY,this.texture.sourceWidth=$V.sourceHeight,this.texture.sourceHeight=$V.sourceWidth):(this.texture.width=$V.width,this.texture.height=$V.height,this.texture.offsetX=-$V.offsetX,this.texture.offsetY=-$V.offsetY,this.texture.sourceWidth=$V.sourceWidth,this.texture.sourceHeight=$V.sourceHeight),$h.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$U.destory=function(){this.texture&&this.texture.destroy()},$V}(),$PV=function(){function $V(){this.name=null,this.displayArr=[]}return $s($V,"laya.ani.bone.SlotData"),$V.prototype.getDisplayByName=function($V){for(var $U=0,$r=this.displayArr.length;$U<$r;$U++)if(this.displayArr[$U].attachmentName==$V)return $U;return-1},$V}(),$k=function(){function $V($V,$U){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$u(2,0),this._data=$V,null==this._bones&&(this._bones=[]),this.target=$U[$V.targetIndex];var $r,$s=0;for($s=0,$r=$V.boneIndexs.length;$s<$r;$s++)this._bones.push($U[$V.boneIndexs[$s]]);this.rotateMix=$V.rotateMix,this.translateMix=$V.translateMix,this.scaleMix=$V.scaleMix,this.shearMix=$V.shearMix}return $s($V,"laya.ani.bone.TfConstraint"),$V.prototype.apply=function(){for(var $V,$U=this.target.resultMatrix.a,$r=this.target.resultMatrix.b,$s=this.target.resultMatrix.c,$p=this.target.resultMatrix.d,$c=0,$R=this._bones.length;$c<$R;$c++){if($V=this._bones[$c],0<this.rotateMix){var $T=$V.resultMatrix.a,$N=$V.resultMatrix.b,$t=$V.resultMatrix.c,$b=$V.resultMatrix.d,$S=Math.atan2($s,$U)-Math.atan2($t,$T)+this._data.offsetRotation*Math.PI/180;$S>Math.PI?$S-=2*Math.PI:$S<-Math.PI&&($S+=2*Math.PI),$S*=this.rotateMix;var $_=Math.cos($S),$G=Math.sin($S);$V.resultMatrix.a=$_*$T-$G*$t,$V.resultMatrix.b=$_*$N-$G*$b,$V.resultMatrix.c=$G*$T+$_*$t,$V.resultMatrix.d=$G*$N+$_*$b}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$V.resultMatrix.tx+=(this._temp[0]-$V.resultMatrix.tx)*this.translateMix,$V.resultMatrix.ty+=(this._temp[1]-$V.resultMatrix.ty)*this.translateMix,$V.updateChild()),0<this.scaleMix){var $q=Math.sqrt($V.resultMatrix.a*$V.resultMatrix.a+$V.resultMatrix.c*$V.resultMatrix.c),$u=Math.sqrt($U*$U+$s*$s),$h=1e-5<$q?($q+($u-$q+this._data.offsetScaleX)*this.scaleMix)/$q:0;$V.resultMatrix.a*=$h,$V.resultMatrix.c*=$h,$q=Math.sqrt($V.resultMatrix.b*$V.resultMatrix.b+$V.resultMatrix.d*$V.resultMatrix.d),$u=Math.sqrt($r*$r+$p*$p),$h=1e-5<$q?($q+($u-$q+this._data.offsetScaleY)*this.scaleMix)/$q:0,$V.resultMatrix.b*=$h,$V.resultMatrix.d*=$h}if(0<this.shearMix){$N=$V.resultMatrix.b,$b=$V.resultMatrix.d;var $l=Math.atan2($b,$N);($S=Math.atan2($p,$r)-Math.atan2($s,$U)-($l-Math.atan2($V.resultMatrix.c,$V.resultMatrix.a)))>Math.PI?$S-=2*Math.PI:$S<-Math.PI&&($S+=2*Math.PI),$S=$l+($S+this._data.offsetShearY*Math.PI/180)*this.shearMix,$h=Math.sqrt($N*$N+$b*$b),$V.resultMatrix.b=Math.cos($S)*$h,$V.resultMatrix.d=Math.sin($S)*$h}}},$V}(),$MV=function(){function $V(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $s($V,"laya.ani.bone.TfConstraintData"),$V}(),$AV=function(){function $V(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$s($V,"laya.ani.bone.Transform");var $U=$V.prototype;return $U.initData=function($V){null!=$V.x&&(this.x=$V.x),null!=$V.y&&(this.y=$V.y),null!=$V.skX&&(this.skX=$V.skX),null!=$V.skY&&(this.skY=$V.skY),null!=$V.scX&&(this.scX=$V.scX),null!=$V.scY&&(this.scY=$V.scY)},$U.getMatrix=function(){var $V;return($V=this.mMatrix?this.mMatrix:this.mMatrix=new $zV).identity(),$V.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($V,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$V.rotate(this.skX*Math.PI/180),$V.translate(this.x,this.y),$V},$U.skew=function($V,$U,$r){var $s=Math.sin($r),$p=Math.cos($r),$c=Math.sin($U),$R=Math.cos($U);return $V.setTo($V.a*$R-$V.b*$s,$V.a*$c+$V.b*$p,$V.c*$R-$V.d*$s,$V.c*$c+$V.d*$p,$V.tx*$R-$V.ty*$s,$V.tx*$c+$V.ty*$p),$V},$V}(),$y=function(){function $V(){}return $s($V,"laya.ani.bone.UVTools"),$V.getRelativeUV=function($V,$U,$r){var $s=$V[0],$p=$V[2]-$V[0],$c=$V[1],$R=$V[5]-$V[1];$r||($r=[]),$r.length=$U.length;var $T,$N=0;$T=$r.length;var $t=1/$p,$b=1/$R;for($N=0;$N<$T;$N+=2)$r[$N]=($U[$N]-$s)*$t,$r[$N+1]=($U[$N+1]-$c)*$b;return $r},$V.getAbsoluteUV=function($V,$U,$r){if(0==$V[0]&&0==$V[1]&&1==$V[4]&&1==$V[5])return $r?($l.copyArray($r,$U),$r):$U;var $s=$V[0],$p=$V[2]-$V[0],$c=$V[1],$R=$V[5]-$V[1];$r||($r=[]),$r.length=$U.length;var $T,$N=0;for($T=$r.length,$N=0;$N<$T;$N+=2)$r[$N]=$U[$N]*$p+$s,$r[$N+1]=$U[$N+1]*$R+$c;return $r},$V}(),$K=function(){function $V(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $s($V,"laya.ani.KeyFramesContent"),$V}(),$D=function(){function $b(){}return $s($b,"laya.ani.math.BezierLerp"),$b.getBezierRate=function($V,$U,$r,$s,$p){var $c=$b._getBezierParamKey($U,$r,$s,$p),$R=100*$c+$V;if($b._bezierResultCache[$R])return $b._bezierResultCache[$R];var $T,$N=$b._getBezierPoints($U,$r,$s,$p,$c),$t=0;for($T=$N.length,$t=0;$t<$T;$t+=2)if($V<=$N[$t])return $b._bezierResultCache[$R]=$N[$t+1],$N[$t+1];return $b._bezierResultCache[$R]=1},$b._getBezierParamKey=function($V,$U,$r,$s){return 100*(100*(100*(100*$V+$U)+$r)+$s)},$b._getBezierPoints=function($V,$U,$r,$s,$p){return $b._bezierPointsCache[$p]?$b._bezierPointsCache[$p]:($c=[0,0,$V,$U,$r,$s,1,1],$R=(new $T).getBezierPoints($c,100,3),$b._bezierPointsCache[$p]=$R);var $c,$R},$b._bezierResultCache={},$b._bezierPointsCache={},$b}(),$n=function($V){function $U(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$U.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$s($U,"laya.ani.AnimationPlayer",$p);var $r=$U.prototype;return $pV.imps($r,{"laya.resource.IDestroy":!0}),$r._onTempletLoadedComputeFullKeyframeIndices=function($V,$U,$r){this._templet===$r&&this._cachePlayRate===$V&&this._cacheFrameRate===$U&&this._computeFullKeyframeIndices()},$r._computeFullKeyframeIndices=function(){for(var $V=this._fullFrames=[],$U=this._templet,$r=this._cacheFrameRateInterval*this._cachePlayRate,$s=0,$p=$U.getAnimationCount();$s<$p;$s++){for(var $c=[],$R=0,$T=$U.getAnimation($s).nodes.length;$R<$T;$R++){for(var $N=$U.getAnimation($s).nodes[$R],$t=Math.floor($N.playTime/$r+.01),$b=new Uint16Array($t+1),$S=-1,$_=0,$G=$N.keyFrame.length;$_<$G;$_++){var $q=$N.keyFrame[$_],$u=$q.startTime,$h=$u+$q.duration+$r;do{for(var $l=Math.floor($u/$r+.5),$W=$S+1;$W<$l;$W++)$b[$W]=$_;$b[$S=$l]=$_,$u+=$r}while($u<=$h)}$c.push($b)}$V.push($c)}},$r._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$r._calculatePlayDuration=function(){if(0!==this.state){var $V=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$V),this._playEnd>$V&&(this._playEnd=$V),this._playDuration=this._playEnd-this._playStart}},$r._setPlayParams=function($V,$U){this._currentTime=$V,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$U+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$U},$r._setPlayParamsWhenStop=function($V,$U){this._currentTime=$V,this._currentKeyframeIndex=Math.max(Math.floor($V/$U+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$U,this._currentAnimationClipIndex=-1},$r._update=function($V){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $U=this._cacheFrameRateInterval*this._cachePlayRate,$r=0;this._startUpdateLoopCount!==$q.loopCount&&($r=$V*this.playbackRate,this._elapsedPlaybackTime+=$r);var $s=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$s)return this._setPlayParamsWhenStop($s,$U),void this.event("stopped");if($r+=this._currentTime,0<$s)if($s<=$r)do{if($r-=$s,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($s,$U),this._stopWhenCircleFinish=!1,void this.event("stopped");$r<$s&&(this._setPlayParams($r,$U),this.event("complete"))}while($s<=$r);else this._setPlayParams($r,$U);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($s,$U),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$r._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$r.play=function($V,$U,$r,$s,$p){if(void 0===$V&&($V=0),void 0===$U&&($U=1),void 0===$r&&($r=2147483647),void 0===$s&&($s=0),void 0===$p&&($p=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($r<0||$s<0||$p<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$p&&$p<$s)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$U,this._overallDuration=$r,this._playStart=$s,this._playEnd=$p,this._paused=!1,this._currentAnimationClipIndex=$V,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$q.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$r.playByFrame=function($V,$U,$r,$s,$p,$c){void 0===$V&&($V=0),void 0===$U&&($U=1),void 0===$r&&($r=2147483647),void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$c&&($c=30);var $R=1e3/$c;this.play($V,$U,$r,$s*$R,$p*$R)},$r.stop=function($V){void 0===$V&&($V=!0),$V?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$c(0,$r,"playEnd",function(){return this._playEnd}),$c(0,$r,"templet",function(){return this._templet},function($V){0===!this.state&&this.stop(!0),this._templet!==$V&&((this._templet=$V).loaded?this._computeFullKeyframeIndices():$V.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$c(0,$r,"playStart",function(){return this._playStart}),$c(0,$r,"playDuration",function(){return this._playDuration}),$c(0,$r,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$c(0,$r,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$c(0,$r,"overallDuration",function(){return this._overallDuration}),$c(0,$r,"currentFrameTime",function(){return this._currentFrameTime}),$c(0,$r,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$c(0,$r,"currentPlayTime",function(){return this._currentTime+this._playStart}),$c(0,$r,"cachePlayRate",function(){return this._cachePlayRate},function($V){this._cachePlayRate!==$V&&(this._cachePlayRate=$V,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$V,this._cacheFrameRate])))}),$c(0,$r,"cacheFrameRate",function(){return this._cacheFrameRate},function($V){this._cacheFrameRate!==$V&&(this._cacheFrameRate=$V,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$V])))}),$c(0,$r,"currentTime",null,function($V){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($V<this._playStart||$V>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$q.loopCount;var $U=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$V,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$U),0),this._currentFrameTime=this._currentKeyframeIndex*$U}}),$c(0,$r,"paused",function(){return this._paused},function($V){(this._paused=$V)&&this.event("paused")}),$c(0,$r,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$c(0,$r,"destroyed",function(){return this._destroyed}),$U}(),$m=function($V){function $U(){$U.__super.call(this),$h.isConchNode&&(this.drawSkin=function($V){$V.transform||($V.transform=$zV.EMPTY),this._addCmd([$V]),this.setSkinMesh&&this.setSkinMesh($V._ps,$V.mVBData,$V.mEleNum,0,$V.mTexture,$V.transform)})}return $s($U,"laya.ani.GraphicsAni",$R),$U.prototype.drawSkin=function($V){var $U=[$V];this._saveToCmd($h._context._drawSkin,$U)},$U.create=function(){return $U._caches.pop()||new $U},$U.recycle=function($V){$V.clear(),$U._caches.push($V)},$U._caches=[],$U}(),$a=function($V){function $W(){this._aniMap={},this.unfixedLastAniIndex=-1,$W.__super.call(this),this._anis=new Array}$s($W,"laya.ani.AnimationTemplet",$b);var $U=$W.prototype;return $U.parse=function($V){var $U=new $wV($V);this._aniVersion=$U.readUTFString(),$O.parse(this,$U)},$U._calculateKeyFrame=function($V,$U,$r){var $s=$V.keyFrame;$s[$U]=$s[0];for(var $p=0;$p<$U;$p++){var $c=$s[$p];$c.nextData=0===$c.duration?$c.data:$s[$p+1].data}$s.length--},$U.onAsynLoaded=function($V,$U,$r){var $s=new $wV($U);switch(this._aniVersion=$s.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$L.parse(this,$s);break;default:$O.parse(this,$s)}this._endLoaded()},$U.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$U.getAnimationCount=function(){return this._anis.length},$U.getAnimation=function($V){return this._anis[$V]},$U.getAniDuration=function($V){return this._anis[$V].playTime},$U.getNodes=function($V){return this._anis[$V].nodes},$U.getNodeIndexWithName=function($V,$U){return this._anis[$V].bone3DMap[$U]},$U.getNodeCount=function($V){return this._anis[$V].nodes.length},$U.getTotalkeyframesLength=function($V){return this._anis[$V].totalKeyframeDatasLength},$U.getPublicExtData=function(){return this._publicExtData},$U.getAnimationDataWithCache=function($V,$U,$r,$s){var $p=$U[$r];if($p){var $c=$p[$V];return $c?$c[$s]:null}return null},$U.setAnimationDataWithCache=function($V,$U,$r,$s,$p){var $c=$U[$r]||($U[$r]={});($c[$V]||($c[$V]=[]))[$s]=$p},$U.getOriginalData=function($V,$U,$r,$s,$p){for(var $c=this._anis[$V].nodes,$R=0,$T=0,$N=$c.length,$t=0;$T<$N;$T++){var $b,$S=$c[$T];$b=$S.keyFrame[$r[$T][$s]],$S.dataOffset=$t;var $_=$p-$b.startTime,$G=$S.lerpType;if($G)switch($G){case 0:case 1:for($R=0;$R<$S.keyframeWidth;)$R+=$S.interpolationMethod[$R]($S,$R,$U,$t+$R,$b.data,$_,null,$b.duration,$b.nextData);break;case 2:var $q=$b.interpolationData,$u=$q.length,$h=0;for($R=0;$R<$u;){var $l=$q[$R];switch($l){case 6:case 7:$R+=$W.interpolation[$l]($S,$h,$U,$t+$h,$b.data,$_,null,$b.duration,$b.nextData,$q,$R+1);break;default:$R+=$W.interpolation[$l]($S,$h,$U,$t+$h,$b.data,$_,null,$b.duration,$b.nextData)}$h++}}else for($R=0;$R<$S.keyframeWidth;)$R+=$S.interpolationMethod[$R]($S,$R,$U,$t+$R,$b.data,$_,null,$b.duration,$b.nextData);$t+=$S.keyframeWidth}},$U.getNodesCurrentFrameIndex=function($V,$U){var $r=this._anis[$V].nodes;$V!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($r.length),this.unfixedCurrentTimes=new Float32Array($r.length),this.unfixedLastAniIndex=$V);for(var $s=0,$p=$r.length;$s<$p;$s++){var $c=$r[$s];for($U<this.unfixedCurrentTimes[$s]&&(this.unfixedCurrentFrameIndexes[$s]=0),this.unfixedCurrentTimes[$s]=$U;this.unfixedCurrentFrameIndexes[$s]<$c.keyFrame.length&&!($c.keyFrame[this.unfixedCurrentFrameIndexes[$s]].startTime>this.unfixedCurrentTimes[$s]);)this.unfixedCurrentFrameIndexes[$s]++;this.unfixedCurrentFrameIndexes[$s]--}return this.unfixedCurrentFrameIndexes},$U.getOriginalDataUnfixedRate=function($V,$U,$r){var $s=this._anis[$V].nodes;$V!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($s.length),this.unfixedCurrentTimes=new Float32Array($s.length),this.unfixedKeyframes=$u($s.length),this.unfixedLastAniIndex=$V);for(var $p=0,$c=0,$R=$s.length,$T=0;$c<$R;$c++){var $N=$s[$c];for($r<this.unfixedCurrentTimes[$c]&&(this.unfixedCurrentFrameIndexes[$c]=0),this.unfixedCurrentTimes[$c]=$r;this.unfixedCurrentFrameIndexes[$c]<$N.keyFrame.length&&!($N.keyFrame[this.unfixedCurrentFrameIndexes[$c]].startTime>this.unfixedCurrentTimes[$c]);)this.unfixedKeyframes[$c]=$N.keyFrame[this.unfixedCurrentFrameIndexes[$c]],this.unfixedCurrentFrameIndexes[$c]++;var $t=this.unfixedKeyframes[$c];$N.dataOffset=$T;var $b=$r-$t.startTime;if($N.lerpType)switch($N.lerpType){case 0:case 1:for($p=0;$p<$N.keyframeWidth;)$p+=$N.interpolationMethod[$p]($N,$p,$U,$T+$p,$t.data,$b,null,$t.duration,$t.nextData);break;case 2:var $S=$t.interpolationData,$_=$S.length,$G=0;for($p=0;$p<$_;){var $q=$S[$p];switch($q){case 6:case 7:$p+=$W.interpolation[$q]($N,$G,$U,$T+$G,$t.data,$b,null,$t.duration,$t.nextData,$S,$p+1);break;default:$p+=$W.interpolation[$q]($N,$G,$U,$T+$G,$t.data,$b,null,$t.duration,$t.nextData)}$G++}}else for($p=0;$p<$N.keyframeWidth;)$p+=$N.interpolationMethod[$p]($N,$p,$U,$T+$p,$t.data,$b,null,$t.duration,$t.nextData);$T+=$N.keyframeWidth}},$W._LinearInterpolation_0=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){var $b=0===$T?0:$c/$T;return $r[$s]=(1-$b)*$p[$U]+$b*$N[$U],1},$W._QuaternionInterpolation_1=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){var $b=0===$T?0:$c/$T;return $_.slerpQuaternionArray($p,$U,$N,$U,$b,$r,$s),4},$W._AngleInterpolation_2=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return 0},$W._RadiansInterpolation_3=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return 0},$W._Matrix4x4Interpolation_4=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){for(var $b=0;$b<16;$b++,$U++)$r[$s+$b]=$p[$U]+$c*$R[$U];return 16},$W._NoInterpolation_5=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t){return $r[$s]=$p[$U],1},$W._BezierInterpolation_6=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b){return void 0===$b&&($b=0),$r[$s]=$p[$U]+($N[$U]-$p[$U])*$D.getBezierRate($c/$T,$t[$b],$t[$b+1],$t[$b+2],$t[$b+3]),5},$W._BezierInterpolation_7=function($V,$U,$r,$s,$p,$c,$R,$T,$N,$t,$b){return void 0===$b&&($b=0),$r[$s]=$t[$b+4]+$t[$b+5]*$D.getBezierRate((.001*$c+$t[$b+6])/$t[$b+7],$t[$b],$t[$b+1],$t[$b+2],$t[$b+3]),9},$W.load=function($V){return $pV.loader.create($V,null,null,$W)},$W.interpolation=[$W._LinearInterpolation_0,$W._QuaternionInterpolation_1,$W._AngleInterpolation_2,$W._RadiansInterpolation_3,$W._Matrix4x4Interpolation_4,$W._NoInterpolation_5,$W._BezierInterpolation_6,$W._BezierInterpolation_7],$W}(),$I=function($U){function $r($V,$U){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$r.__super.call(this),void 0===$U&&($U=0),$V&&this.init($V,$U)}$s($r,"laya.ani.bone.Skeleton",$U);var $V=$r.prototype;return $V.init=function($V,$U){void 0===$U&&($U=0);var $r,$s,$p,$c=0,$R=0;if(1==$U)for(this._graphicsCache=[],$c=0,$R=$V.getAnimationCount();$c<$R;$c++)this._graphicsCache.push([]);if(this._yReverseMatrix=$V.yReverseMatrix,this._aniMode=$U,this._templet=$V,this._player=new $n,this._player.cacheFrameRate=$V.rate,this._player.templet=$V,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$V.mBoneArr,this._rootBone=$V.mRootBone,this._aniSectionDic=$V.aniSectionDic,0<$V.ikArr.length)for(this._ikArr=[],$c=0,$R=$V.ikArr.length;$c<$R;$c++)this._ikArr.push(new $W($V.ikArr[$c],this._boneList));if(0<$V.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$c=0,$R=$V.pathArr.length;$c<$R;$c++)$r=$V.pathArr[$c],$s=new $d($r,this._boneList),($p=this._boneSlotDic[$r.name])&&(($s=new $d($r,this._boneList)).target=$p),this._pathDic[$r.name]=$s;if(0<$V.tfArr.length)for(this._tfArr=[],$c=0,$R=$V.tfArr.length;$c<$R;$c++)this._tfArr.push(new $k($V.tfArr[$c],this._boneList));if(0<$V.skinDataArray.length){var $T=this._templet.skinDataArray[this._skinIndex];this._skinName=$T.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$V.load=function($V,$U,$r){},$V._onLoaded=function(){},$V._parseComplete=function(){var $V=$Q.TEMPLET_DICTIONARY[this._aniPath];$V&&(this.init($V,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$V._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$V._onPlay=function(){this.event("played")},$V._onStop=function(){var $V,$U=this._templet.eventAniArr[this._aniClipIndex];if($U&&this._eventIndex<$U.length)for(;this._eventIndex<$U.length;this._eventIndex++)($V=$U[this._eventIndex]).time>=this._player.playStart&&$V.time<=this._player.playEnd&&this.event("label",$V);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$V._onPause=function(){this.event("paused")},$V._parseSrcBoneMatrix=function(){var $V=0,$U=0;for($U=this._templet.srcBoneMatrixArr.length,$V=0;$V<$U;$V++)this._boneMatrixArray.push(new $zV);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $r,$s,$p=this._templet.boneSlotArray;for($V=0,$U=$p.length;$V<$U;$V++)$r=$p[$V],null==($s=this._bindBoneBoneSlotDic[$r.parent])&&(this._bindBoneBoneSlotDic[$r.parent]=$s=[]),this._boneSlotDic[$r.name]=$r=$r.copy(),$s.push($r),this._boneSlotArray.push($r)}},$V._emitMissedEvents=function($V,$U,$r){void 0===$r&&($r=0);var $s=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($s){var $p,$c,$R=0;for($p=$s.length,$R=$r;$R<$p;$R++)($c=$s[$R]).time>=this._player.playStart&&$c.time<=this._player.playEnd&&this.event("label",$c)}},$V._update=function($V){if(void 0===$V&&($V=!0),!(this._pause||$V&&this._indexControl)){var $U=this.timer.currTimer,$r=this._player.currentKeyframeIndex,$s=$U-this._lastTime;if($V?this._player._update($s):$r=-1,this._lastTime=$U,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$s&&this._clipIndex==$r&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $p;this._lastUpdateAniClipIndex=this._aniClipIndex,$r>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $c,$R=this._templet.eventAniArr[this._aniClipIndex];if($R&&this._eventIndex<$R.length&&(($p=$R[this._eventIndex]).time>=this._player.playStart&&$p.time<=this._player.playEnd?this._player.currentPlayTime>=$p.time&&(this.event("label",$p),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($c=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$c&&(this.graphics=$c));var $T=0,$N=0;for($N=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$N-1)&&0<$N;)$N--;if($N<this._clipIndex)for($T=$N;$T<this._clipIndex;$T++)this._createGraphics($T)}else if(1==this._aniMode){if($c=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$c&&(this.graphics=$c));for($N=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$N-1)&&0<$N;)$N--;if($N<this._clipIndex)for($T=$N;$T<this._clipIndex;$T++)this._createGraphics($T)}this._createGraphics()}}},$V._createGraphics=function($V){void 0===$V&&($V=-1),-1==$V&&($V=this._clipIndex);var $U,$r,$s=$V*this._player.cacheFrameRateInterval,$p=this._templet.drawOrderAniArr[this._aniClipIndex];if($p&&0<$p.length)for(this._drawOrderIndex=0,$U=$p[this._drawOrderIndex];$s>=$U.time&&(this._drawOrder=$U.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$p.length));)$U=$p[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$m.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$m.create(),$r=this.graphics;var $c=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$V,$s);var $R,$T,$N,$t,$b=this._aniSectionDic[this._aniClipIndex],$S=0,$_=0,$G=0,$q=0,$u=0,$h=this._templet.srcBoneMatrixArr.length;for($u=$b[$_=0];$_<$h;$_++)$t=this._boneList[$_],$N=this._templet.srcBoneMatrixArr[$_],$t.resultTransform.scX=$N.scX*this._curOriginalData[$S++],$t.resultTransform.skX=$N.skX+this._curOriginalData[$S++],$t.resultTransform.skY=$N.skY+this._curOriginalData[$S++],$t.resultTransform.scY=$N.scY*this._curOriginalData[$S++],$t.resultTransform.x=$N.x+this._curOriginalData[$S++],$t.resultTransform.y=$N.y+this._curOriginalData[$S++],8===this._templet.tMatrixDataLen&&($t.resultTransform.skewX=$N.skewX+this._curOriginalData[$S++],$t.resultTransform.skewY=$N.skewY+this._curOriginalData[$S++]);var $l,$W={},$O={};for($u+=$b[1];$_<$u;$_++)$W[($l=$c[$_]).name]=this._curOriginalData[$S++],$O[$l.name]=this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++];var $L,$d,$k={},$y={};for($u+=$b[2];$_<$u;$_++)$k[($l=$c[$_]).name]=this._curOriginalData[$S++],$y[$l.name]=this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++],this._curOriginalData[$S++];if(this._pathDic)for($u+=$b[3];$_<$u;$_++){if($l=$c[$_],$L=this._pathDic[$l.name])switch(new $wV($l.extenData).getByte()){case 1:$L.position=this._curOriginalData[$S++];break;case 2:$L.spacing=this._curOriginalData[$S++];break;case 3:$L.rotateMix=this._curOriginalData[$S++],$L.translateMix=this._curOriginalData[$S++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($zV.TEMP.identity()),this._ikArr)for($_=0,$u=this._ikArr.length;$_<$u;$_++)$d=this._ikArr[$_],$k.hasOwnProperty($d.name)&&($d.bendDirection=$k[$d.name]),$y.hasOwnProperty($d.name)&&($d.mix=$y[$d.name]),$d.apply();if(this._pathDic)for(var $D in this._pathDic)($L=this._pathDic[$D]).apply(this._boneList,$r);if(this._tfArr)for($_=0,$q=this._tfArr.length;$_<$q;$_++)this._tfArr[$_].apply();for($_=0,$q=this._boneList.length;$_<$q;$_++)if($t=this._boneList[$_],$T=this._bindBoneBoneSlotDic[$t.name],$t.resultMatrix.copyTo(this._boneMatrixArray[$_]),$T)for($G=0,$u=$T.length;$G<$u;$G++)($R=$T[$G])&&$R.setParentMatrix($t.resultMatrix);var $n,$I,$Q,$H,$w={},$z=this._templet.deformAniArr;if($z&&0<$z.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$_=0,$u=this._boneSlotArray.length;$_<$u;$_++)($R=this._boneSlotArray[$_]).deformData=null;var $E,$K=$z[this._aniClipIndex];for($E in $n=$K.default,this._setDeform($n,$w,this._boneSlotArray,$s),$K)"default"!=$E&&$E!=this._skinName&&($n=$K[$E],this._setDeform($n,$w,this._boneSlotArray,$s));$n=$K[this._skinName],this._setDeform($n,$w,this._boneSlotArray,$s)}if(this._drawOrder)for($_=0,$u=this._drawOrder.length;$_<$u;$_++)$I=$W[($R=this._boneSlotArray[this._drawOrder[$_]]).name],$Q=$O[$R.name],isNaN($Q)||($r.save(),$r.alpha($Q)),isNaN($I)||-2==$I||(this._templet.attachmentNames?$R.showDisplayByName(this._templet.attachmentNames[$I]):$R.showDisplayByIndex($I)),$w[this._drawOrder[$_]]?($H=$w[this._drawOrder[$_]],$R.currDisplayData&&$H[$R.currDisplayData.attachmentName]?$R.deformData=$H[$R.currDisplayData.attachmentName]:$R.deformData=null):$R.deformData=null,isNaN($Q)?$R.draw($r,this._boneMatrixArray,2==this._aniMode):$R.draw($r,this._boneMatrixArray,2==this._aniMode,$Q),isNaN($Q)||$r.restore();else for($_=0,$u=this._boneSlotArray.length;$_<$u;$_++)$I=$W[($R=this._boneSlotArray[$_]).name],$Q=$O[$R.name],isNaN($Q)||($r.save(),$r.alpha($Q)),isNaN($I)||-2==$I||(this._templet.attachmentNames?$R.showDisplayByName(this._templet.attachmentNames[$I]):$R.showDisplayByIndex($I)),$w[$_]?($H=$w[$_],$R.currDisplayData&&$H[$R.currDisplayData.attachmentName]?$R.deformData=$H[$R.currDisplayData.attachmentName]:$R.deformData=null):$R.deformData=null,isNaN($Q)?$R.draw($r,this._boneMatrixArray,2==this._aniMode):$R.draw($r,this._boneMatrixArray,2==this._aniMode,$Q),isNaN($Q)||$r.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$V,$r):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$V,$r)},$V._setDeform=function($V,$U,$r,$s){if($V){var $p,$c,$R,$T=0,$N=0,$t=0;if($V)for($T=0,$N=$V.deformSlotDataList.length;$T<$N;$T++)for($p=$V.deformSlotDataList[$T],$t=0;$t<$p.deformSlotDisplayList.length;$t++)$R=$r[($c=$p.deformSlotDisplayList[$t]).slotIndex],$c.apply($s,$R),$U[$c.slotIndex]||($U[$c.slotIndex]={}),$U[$c.slotIndex][$c.attachment]=$c.deformData}},$V.getAnimNum=function(){return this._templet.getAnimationCount()},$V.getAniNameByIndex=function($V){return this._templet.getAniNameByIndex($V)},$V.getSlotByName=function($V){return this._boneSlotDic[$V]},$V.showSkinByName=function($V,$U){void 0===$U&&($U=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($V),$U)},$V.showSkinByIndex=function($V,$U){void 0===$U&&($U=!0);for(var $r=0;$r<this._boneSlotArray.length;$r++)this._boneSlotArray[$r].showSlotData(null,$U);if(this._templet.showSkinByIndex(this._boneSlotDic,$V,$U)){var $s=this._templet.skinDataArray[$V];this._skinIndex=$V,this._skinName=$s.name}this._clearCache()},$V.showSlotSkinByIndex=function($V,$U){if(0!=this._aniMode){var $r=this.getSlotByName($V);$r&&$r.showDisplayByIndex($U),this._clearCache()}},$V.showSlotSkinByName=function($V,$U){if(0!=this._aniMode){var $r=this.getSlotByName($V);$r&&$r.showDisplayByName($U),this._clearCache()}},$V.replaceSlotSkinName=function($V,$U,$r){if(0!=this._aniMode){var $s=this.getSlotByName($V);$s&&$s.replaceDisplayByName($U,$r),this._clearCache()}},$V.replaceSlotSkinByIndex=function($V,$U,$r){if(0!=this._aniMode){var $s=this.getSlotByName($V);$s&&$s.replaceDisplayByIndex($U,$r),this._clearCache()}},$V.setSlotSkin=function($V,$U){if(0!=this._aniMode){var $r=this.getSlotByName($V);$r&&$r.replaceSkin($U),this._clearCache()}},$V._clearCache=function(){if(1==this._aniMode)for(var $V=0,$U=this._graphicsCache.length;$V<$U;$V++){for(var $r=0,$s=this._graphicsCache[$V].length;$r<$s;$r++){var $p=this._graphicsCache[$V][$r];$p!=this.graphics&&$m.recycle($p)}this._graphicsCache[$V].length=0}},$V.play=function($V,$U,$r,$s,$p,$c){void 0===$r&&($r=!0),void 0===$s&&($s=0),void 0===$p&&($p=0),void 0===$c&&($c=!0),this._indexControl=!1;var $R=-1,$T=NaN;if($T=$U?2147483647:0,"string"==typeof $V)for(var $N=0,$t=this._templet.getAnimationCount();$N<$t;$N++){var $b=this._templet.getAnimation($N);if($b&&$V==$b.name){$R=$N;break}}else $R=$V;-1<$R&&$R<this.getAnimNum()&&(this._aniClipIndex=$R,($r||this._pause||this._currAniIndex!=$R)&&(this._currAniIndex=$R,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($R)),this._drawOrder=null,this._eventIndex=0,this._player.play($R,this._player.playbackRate,$T,$s,$p),$c&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$S.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$V.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$V.playbackRate=function($V){this._player&&(this._player.playbackRate=$V)},$V.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$V.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$S.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$V._getGrahicsDataWithCache=function($V,$U){return this._graphicsCache[$V][$U]},$V._setGrahicsDataWithCache=function($V,$U,$r){this._graphicsCache[$V][$U]=$r},$V.destroy=function($V){void 0===$V&&($V=!0),$U.prototype.destroy.call(this,$V),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$c(0,$V,"url",function(){return this._aniPath},function($V){this.load($V)}),$c(0,$V,"index",function(){return this._index},function($V){this.player&&(this._index=$V,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$c(0,$V,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$c(0,$V,"templet",function(){return this._templet}),$c(0,$V,"player",function(){return this._player}),$r.useSimpleMeshInCanvas=!1,$r}($cV),$Q=function($U){function $p(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$p.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$s($p,"laya.ani.bone.Templet",$U);var $V=$p.prototype;return $V.getLoadList=function(){return this._loadList},$V.loadAni=function($V){this._skBufferUrl=$V,$pV.loader.load($V,$N.create(this,this.onComplete),null,"arraybuffer")},$V.onComplete=function($V){if(this._isDestroyed)this.destroy();else{var $U=$t.getRes(this._skBufferUrl);$U?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$U)):this.event("error","load failed:"+this._skBufferUrl)}},$V.parseData=function($V,$U,$r){void 0===$r&&($r=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$V,this._mainTexture&&$h.isWebGL&&$V.bitmap&&($V.bitmap.enableMerageInAtlas=!1),this._rate=$r,this.parse($U)},$V.buildArmature=function($V){return void 0===$V&&($V=0),new $I(this,$V)},$V.parse=function($V){$U.prototype.parse.call(this,$V),this._endLoaded(),this._aniVersion!=$p.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$p.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$V._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $V=0;this._loadList=[];var $U,$r=new $wV(this.getPublicExtData()),$s=0,$p=0,$c=0,$R=$r.getInt32(),$T=$r.readUTFString(),$N=$T.split("\n");for($V=0;$V<$R;$V++)$U=this._path+$N[2*$V],$T=$N[2*$V+1],$r.getFloat32(),$r.getFloat32(),$s=$r.getFloat32(),$p=$r.getFloat32(),$c=$r.getFloat32(),isNaN($c)?0:$c,$c=$r.getFloat32(),isNaN($c)?0:$c,$c=$r.getFloat32(),isNaN($c)?$s:$c,$c=$r.getFloat32(),isNaN($c)?$p:$c,-1==this._loadList.indexOf($U)&&this._loadList.push($U);this.event("inited",this)}},$V._textureComplete=function(){for(var $V,$U,$r=0,$s=this._loadList.length;$r<$s;$r++)$U=this._loadList[$r],$V=this._textureDic[$U]=$t.getRes($U),$h.isWebGL&&$V&&$V.bitmap&&($V.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$V._parsePublicExtData=function(){var $V=0,$U=0,$r=0,$s=0,$p=0;for($V=0,$p=this.getAnimationCount();$V<$p;$V++)this._graphicsCache.push([]);var $c;$c="Dragon"!=this._aniClassName;var $R,$T,$N=new $wV(this.getPublicExtData()),$t=0,$b=0,$S=0,$_=0,$G=0,$q=0,$u=0,$h=0,$l=0,$W=$N.getInt32(),$O=$N.readUTFString(),$L=$O.split("\n");for($V=0;$V<$W;$V++){if($R=this._mainTexture,$T=this._path+$L[2*$V],$O=$L[2*$V+1],null==this._mainTexture&&($R=this._textureDic[$T]),!$R)return this.event("error",this),void(this.isParseFail=!0);$t=$N.getFloat32(),$b=$N.getFloat32(),$S=$N.getFloat32(),$_=$N.getFloat32(),$l=$N.getFloat32(),$G=isNaN($l)?0:$l,$l=$N.getFloat32(),$q=isNaN($l)?0:$l,$l=$N.getFloat32(),$u=isNaN($l)?$S:$l,$l=$N.getFloat32(),$h=isNaN($l)?$_:$l,this.subTextureDic[$O]=$EV.create($R,$t,$b,$S,$_,-$G,-$q,$u,$h),$R.alphaTexture&&(this.subTextureDic[$O].alphaTexture=$EV.create($R.alphaTexture,$t,$b,$S,$_,-$G,-$q,$u,$h))}this._mainTexture=$R;var $d,$k,$y,$D,$n,$I=$N.getUint16();for($V=0;$V<$I;$V++)($d=[]).push($N.getUint16()),$d.push($N.getUint16()),$d.push($N.getUint16()),$d.push($N.getUint16()),this.aniSectionDic[$V]=$d;var $Q,$H=$N.getInt16(),$w={};for($V=0;$V<$H;$V++)$k=new $KV,0==$V?$Q=$k:$k.root=$Q,$k.d=$c?-1:1,$D=$N.readUTFString(),$n=$N.readUTFString(),$k.length=$N.getFloat32(),1==$N.getByte()&&($k.inheritRotation=!1),1==$N.getByte()&&($k.inheritScale=!1),$k.name=$D,$n&&(($y=$w[$n])?$y.addChild($k):this.mRootBone=$k),$w[$D]=$k,this.mBoneArr.push($k);this.tMatrixDataLen=$N.getUint16();var $z,$E,$K=$N.getUint16(),$m=Math.floor($K/this.tMatrixDataLen),$a=this.srcBoneMatrixArr;for($V=0;$V<$m;$V++)($z=new $AV).scX=$N.getFloat32(),$z.skX=$N.getFloat32(),$z.skY=$N.getFloat32(),$z.scY=$N.getFloat32(),$z.x=$N.getFloat32(),$z.y=$N.getFloat32(),8===this.tMatrixDataLen&&($z.skewX=$N.getFloat32(),$z.skewY=$N.getFloat32()),$a.push($z),($k=this.mBoneArr[$V]).transform=$z;var $Z,$x=$N.getUint16(),$$=0;for($V=0;$V<$x;$V++){for($E=new $oV,$$=$N.getUint16(),$U=0;$U<$$;$U++)$E.boneNames.push($N.readUTFString()),$E.boneIndexs.push($N.getInt16());$E.name=$N.readUTFString(),$E.targetBoneName=$N.readUTFString(),$E.targetBoneIndex=$N.getInt16(),$E.bendDirection=$N.getFloat32(),$E.mix=$N.getFloat32(),$E.isSpine=$c,this.ikArr.push($E)}var $j,$o=$N.getUint16(),$J=0;for($V=0;$V<$o;$V++){for($Z=new $MV,$J=$N.getUint16(),$U=0;$U<$J;$U++)$Z.boneIndexs.push($N.getInt16());$Z.name=$N.getUTFString(),$Z.targetIndex=$N.getInt16(),$Z.rotateMix=$N.getFloat32(),$Z.translateMix=$N.getFloat32(),$Z.scaleMix=$N.getFloat32(),$Z.shearMix=$N.getFloat32(),$Z.offsetRotation=$N.getFloat32(),$Z.offsetX=$N.getFloat32(),$Z.offsetY=$N.getFloat32(),$Z.offsetScaleX=$N.getFloat32(),$Z.offsetScaleY=$N.getFloat32(),$Z.offsetShearY=$N.getFloat32(),this.tfArr.push($Z)}var $i=$N.getUint16(),$B=0;for($V=0;$V<$i;$V++){for(($j=new $JV).name=$N.readUTFString(),$B=$N.getUint16(),$U=0;$U<$B;$U++)$j.bones.push($N.getInt16());$j.target=$N.readUTFString(),$j.positionMode=$N.readUTFString(),$j.spacingMode=$N.readUTFString(),$j.rotateMode=$N.readUTFString(),$j.offsetRotation=$N.getFloat32(),$j.position=$N.getFloat32(),$j.spacing=$N.getFloat32(),$j.rotateMix=$N.getFloat32(),$j.translateMix=$N.getFloat32(),this.pathArr.push($j)}var $P,$M,$A,$X,$e,$F=0,$g=0,$v=0,$Y=NaN,$C=0,$f=$N.getInt16();for($V=0;$V<$f;$V++){var $VV=$N.getUint8(),$UV={};this.deformAniArr.push($UV);for(var $rV=0;$rV<$VV;$rV++)for(($P=new $aV).skinName=$N.getUTFString(),$UV[$P.skinName]=$P,$F=$N.getInt16(),$U=0;$U<$F;$U++)for($M=new $ZV,$P.deformSlotDataList.push($M),$g=$N.getInt16(),$r=0;$r<$g;$r++)for($A=new $xV,$M.deformSlotDisplayList.push($A),$A.slotIndex=$N.getInt16(),$A.attachment=$N.getUTFString(),$v=$N.getInt16(),$s=0;$s<$v;$s++)for(1==$N.getByte()?$A.tweenKeyList.push(!0):$A.tweenKeyList.push(!1),$Y=$N.getFloat32(),$A.timeList.push($Y),$X=[],$A.vectices.push($X),$C=$N.getInt16(),$p=0;$p<$C;$p++)$X.push($N.getFloat32())}var $sV,$pV,$cV=$N.getInt16(),$RV=0,$TV=0;for($V=0;$V<$cV;$V++){for($RV=$N.getInt16(),$e=[],$U=0;$U<$RV;$U++){for(($sV=new $$V).time=$N.getFloat32(),$TV=$N.getInt16(),$r=0;$r<$TV;$r++)$sV.drawOrder.push($N.getInt16());$e.push($sV)}this.drawOrderAniArr.push($e)}var $NV,$tV=$N.getInt16(),$bV=0;for($V=0;$V<$tV;$V++){for($bV=$N.getInt16(),$pV=[],$U=0;$U<$bV;$U++)($NV=new $jV).name=$N.getUTFString(),$NV.intValue=$N.getInt32(),$NV.floatValue=$N.getFloat32(),$NV.stringValue=$N.getUTFString(),$NV.time=$N.getFloat32(),$pV.push($NV);this.eventAniArr.push($pV)}var $SV=$N.getInt16();if(0<$SV)for(this.attachmentNames=[],$V=0;$V<$SV;$V++)this.attachmentNames.push($N.getUTFString());var $_V,$GV,$qV=$N.getInt16();for($V=0;$V<$qV;$V++)($_V=new $mV).name=$N.readUTFString(),$_V.parent=$N.readUTFString(),$_V.attachmentName=$N.readUTFString(),$_V.srcDisplayIndex=$_V.displayIndex=$N.getInt16(),($_V.templet=this).boneSlotDic[$_V.name]=$_V,null==($GV=this.bindBoneBoneSlotDic[$_V.parent])&&(this.bindBoneBoneSlotDic[$_V.parent]=$GV=[]),$GV.push($_V),this.boneSlotArray.push($_V);var $uV,$hV,$lV,$WV=$N.readUTFString().split("\n"),$OV=0,$LV=$N.getUint8(),$dV=0,$kV=0,$yV=0,$DV=0,$nV=0,$IV=0,$QV=0;for($V=0;$V<$LV;$V++){for(($uV=new $iV).name=$WV[$OV++],$dV=$N.getUint8(),$U=0;$U<$dV;$U++){for(($hV=new $PV).name=$WV[$OV++],$_V=this.boneSlotDic[$hV.name],$kV=$N.getUint8(),$r=0;$r<$kV;$r++){if($lV=new $BV,this.skinSlotDisplayDataArr.push($lV),$lV.name=$WV[$OV++],$lV.attachmentName=$WV[$OV++],$lV.transform=new $AV,$lV.transform.scX=$N.getFloat32(),$lV.transform.skX=$N.getFloat32(),$lV.transform.skY=$N.getFloat32(),$lV.transform.scY=$N.getFloat32(),$lV.transform.x=$N.getFloat32(),$lV.transform.y=$N.getFloat32(),$hV.displayArr.push($lV),$lV.width=$N.getFloat32(),$lV.height=$N.getFloat32(),$lV.type=$N.getUint8(),$lV.verLen=$N.getUint16(),0<($H=$N.getUint16()))for($lV.bones=[],$s=0;$s<$H;$s++){var $HV=$N.getUint16();$lV.bones.push($HV)}if(0<($yV=$N.getUint16()))for($lV.uvs=[],$s=0;$s<$yV;$s++)$lV.uvs.push($N.getFloat32());if(0<($DV=$N.getUint16()))for($lV.weights=[],$s=0;$s<$DV;$s++)$lV.weights.push($N.getFloat32());if(0<($nV=$N.getUint16()))for($lV.triangles=[],$s=0;$s<$nV;$s++)$lV.triangles.push($N.getUint16());if(0<($IV=$N.getUint16()))for($lV.vertices=[],$s=0;$s<$IV;$s++)$lV.vertices.push($N.getFloat32());if(0<($QV=$N.getUint16()))for($lV.lengths=[],$s=0;$s<$QV;$s++)$lV.lengths.push($N.getFloat32())}$uV.slotArr.push($hV)}this.skinDic[$uV.name]=$uV,this.skinDataArray.push($uV)}1==$N.getUint8()?(this.yReverseMatrix=new $zV(1,0,0,-1,0,0),$Q&&$Q.setTempMatrix(this.yReverseMatrix)):$Q&&$Q.setTempMatrix(new $zV),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$V.getTexture=function($V){var $U=this.subTextureDic[$V];return $U||($U=this.subTextureDic[$V.substr(0,$V.length-1)]),null==$U?this._mainTexture:$U},$V.showSkinByIndex=function($V,$U,$r){if(void 0===$r&&($r=!0),$U<0&&$U>=this.skinDataArray.length)return!1;var $s,$p,$c=0,$R=0,$T=this.skinDataArray[$U];if($T){for($c=0,$R=$T.slotArr.length;$c<$R;$c++)($p=$T.slotArr[$c])&&($s=$V[$p.name])&&($s.showSlotData($p,$r),$r&&"undefined"!=$s.attachmentName&&"null"!=$s.attachmentName?$s.showDisplayByName($s.attachmentName):$s.showDisplayByIndex($s.displayIndex));return!0}return!1},$V.getSkinIndexByName=function($V){for(var $U=0,$r=this.skinDataArray.length;$U<$r;$U++)if(this.skinDataArray[$U].name==$V)return $U;return-1},$V.getGrahicsDataWithCache=function($V,$U){return this._graphicsCache[$V][$U]},$V.setGrahicsDataWithCache=function($V,$U,$r){this._graphicsCache[$V][$U]=$r},$V.destroy=function(){var $V;for(var $U in this._isDestroyed=!0,this.subTextureDic)($V=this.subTextureDic[$U])&&$V.destroy();for($U in this._textureDic)($V=this._textureDic[$U])&&$V.destroy();for(var $r=0,$s=this.skinSlotDisplayDataArr.length;$r<$s;$r++)this.skinSlotDisplayDataArr[$r].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $p.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$V.getAniNameByIndex=function($V){var $U=this.getAnimation($V);return $U?$U.name:null},$c(0,$V,"rate",function(){return this._rate},function($V){this._rate=$V}),$p.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$p.TEMPLET_DICTIONARY=null,$p}($a)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($V,$U){"use strict";for(var $r in Object.defineProperty($U,"__esModule",{value:!0}),Laya){var $s=Laya[$r];$s&&$s.__isclass&&($U[$r]=$s)}});