var O=wx.$C;!function(o,l){l.un,l.uns;var e=l.static,a=l.class,n=l.getset,r=(l.__newvec,laya.utils.Browser),t=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,i=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),m=laya.utils.RunDriver,v=(laya.media.Sound,laya.media.SoundChannel),p=laya.media.SoundManager,g=(laya.display.Stage,laya.net.URL),y=laya.utils.Utils,s=(a(ko5mtl,"laya.wx.mini.MiniAdpter"),ko5mtl.getJson=function(e){return JSON.parse(e)},ko5mtl.init=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),ko5mtl._inited||(ko5mtl.window=o).navigator.userAgent.indexOf("MiniGame")<0||(ko5mtl._inited=!0,ko5mtl.isZiYu=n,ko5mtl.isPosMsgYu=e,ko5mtl.EnvConfig={},ko5mtl.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,c.create(ko5mtl,ko5mtl.onMkdirCallBack))),ko5mtl.window.focus=function(){},l.getUrlPath=function(){},ko5mtl.window.logtime=function(e){},ko5mtl.window.alertTimeLog=function(e){},ko5mtl.window.resetShareInfo=function(){},ko5mtl.window.CanvasRenderingContext2D=function(){},ko5mtl.window.CanvasRenderingContext2D.prototype=ko5mtl.window.wx.createCanvas().getContext("2d").__proto__,ko5mtl.window.document.body.appendChild=function(){},ko5mtl.EnvConfig.pixelRatioInt=0,m.getPixelRatio=ko5mtl.pixelRatio,ko5mtl._preCreateElement=r.createElement,r.createElement=ko5mtl.createElement,m.createShaderCondition=ko5mtl.createShaderCondition,y.parseXMLFromString=ko5mtl.parseXMLFromString,i._createInputElement=E._createInputElement,ko5mtl.EnvConfig.load=f.prototype.load,f.prototype.load=w.prototype.load,ko5mtl.isZiYu&&e&&wx.onMessage(function(e){e.isLoad&&(u.ziyuFileData[e.url]=e.data)}))},ko5mtl.onMkdirCallBack=function(e,n){e||(u.filesListObj=JSON.parse(n.data))},ko5mtl.pixelRatio=function(){if(!ko5mtl.EnvConfig.pixelRatioInt)try{var e=wx.getSystemInfoSync();return ko5mtl.EnvConfig.pixelRatioInt=e.pixelRatio,e.pixelRatio}catch(e){}return ko5mtl.EnvConfig.pixelRatioInt},ko5mtl.createElement=function(e){return"canvas"!=e?"textarea"==e||"input"==e?ko5mtl.onCreateInput(e):"div"==e?((t=ko5mtl._preCreateElement(e)).contains=function(e){return null},t.removeChild=function(e){},t):ko5mtl._preCreateElement(e):(1==ko5mtl.idx?ko5mtl.isZiYu?(n=sharedCanvas).style={}:n=o.canvas:n=o.wx.createCanvas(),ko5mtl.idx++,n);var n;var t},ko5mtl.onCreateInput=function(e){e=ko5mtl._preCreateElement(e);return e.focus=E.wxinputFocus,e.blur=E.wxinputblur,e.style={},e.value=0,e.parentElement={},e.placeholder={},e.type={},e.setColor=function(e){},e.setType=function(e){},e.setFontFace=function(e){},e.addEventListener=function(e){},e.contains=function(e){return null},e.removeChild=function(e){},e},ko5mtl.createShaderCondition=function(e){var n=this;return function(){return n[e.replace("this.","")]}},ko5mtl.EnvConfig=null,ko5mtl.window=null,ko5mtl._preCreateElement=null,ko5mtl._inited=!1,ko5mtl.wxRequest=null,ko5mtl.systemInfo=null,ko5mtl.version="0.0.1",ko5mtl.isZiYu=!1,ko5mtl.isPosMsgYu=!1,ko5mtl.parseXMLFromString=function(e){var n;e=e.replace(/>\s+</g,"><");try{n=(new o.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},ko5mtl.idx=1,ko5mtl),E=(a(vn,"laya.wx.mini.MiniImage"),vn.prototype._loadImage=function(e){var n=!1;-1==e.indexOf("layaNativeDir/")&&(n=!0,e=g.formatURL(e)),u.getFileInfo(e)?vn.onCreateImage(e,this,!n):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?u.downImg(e,new c(vn,vn.onDownImgCallBack,[e,this]),e):vn.onCreateImage(e,this,!0)},vn.onDownImgCallBack=function(e,n,t){t?n.onError(null):vn.onCreateImage(e,n)},vn.onCreateImage=function(n,t,e){var i;function qd0hx(){i.onload=null,i.onerror=null,delete t.imgCache[n]}e=(e=void 0===e?!1:e)?n:(e=u.getFileInfo(n).md5,u.getFileNativePath(e)),null==t.imgCache&&(t.imgCache={});function za(){qd0hx(),t.onLoaded(i)}function Aa(){qd0hx(),t.event("error","Load image failed")}"nativeimage"==t._type?((i=new r.window.Image).crossOrigin="",i.onload=za,i.onerror=Aa,i.src=e,t.imgCache[n]=i):new d.create(e,{onload:za,onerror:Aa,onCreate:function(e){i=e,t.imgCache[n]=e}})},a(gvf34_,"laya.wx.mini.MiniInput"),gvf34_._createInputElement=function(){i._initInput(i.area=r.createElement("textarea")),i._initInput(i.input=r.createElement("input")),i.inputContainer=r.createElement("div"),i.inputContainer.style.position="absolute",i.inputContainer.style.zIndex=1e5,r.container.appendChild(i.inputContainer),i.inputContainer.setPos=function(e,n){i.inputContainer.style.left=e+"px",i.inputContainer.style.top=n+"px"},l.stage.on("resize",null,gvf34_._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){o.dispatchEvent&&o.dispatchEvent("resize")}),p._soundClass=_,p._musicClass=_,o._videoClass=C},gvf34_._onStageResize=function(){l.stage._canvasTransform.identity().scale(r.width/h.canvas.width/m.getPixelRatio(),r.height/h.canvas.height/m.getPixelRatio())},gvf34_.wxinputFocus=function(e){var n=i.inputElement.target;n&&!n.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(e){},fail:function(e){}}),s.window.wx.onKeyboardConfirm(function(e){e=e?e.value:"";n.text=e,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(e){e=e?e.value:"";n.multiline||-1==e.indexOf("\n")?(n.text=e,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},gvf34_.inputEnter=function(){i.inputElement.target.focus=!1},gvf34_.wxinputblur=function(){gvf34_.hideKeyboard()},gvf34_.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(e){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(e){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(e?e.errMsg:""))}})},gvf34_),w=(a(q4f713,"laya.wx.mini.MiniLoader"),(z=q4f713.prototype).load=function(e,n,t,i,o){void 0===t&&(t=!0),void 0===o&&(o=!1);var l=this;0===(l._url=e).indexOf("data:image")?l._type=n="image":l._type=n=n||l.getTypeFromUrl(e),l._cache=t,l._data=null;var a="ascii";-1!=e.indexOf(".fnt")?a="utf8":"arraybuffer"==n&&(a="");var r=y.getFileExtension(e);if(-1!=q4f713._fileTypeArr.indexOf(r))s.EnvConfig.load.call(this,e,n,t,i,o);else if(u.getFileInfo(e))s.EnvConfig.load.call(this,e,n,t,i,o);else{if(-1!=e.indexOf("layaNativeDir/"))return s.isZiYu?(r=u.ziyuFileData[e],void l.onLoaded(r)):(cosnole.log("read read"),void u.read(e,a,new c(q4f713,q4f713.onReadNativeCallBack,[a,e,n,t,i,o,l])));r=""==g.rootPath?e:e.split(g.rootPath)[0],-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?s.EnvConfig.load.call(l,e,n,t,i,o):u.readFile(r,a,new c(q4f713,q4f713.onReadNativeCallBack,[a,e,n,t,i,o,l]),e)}},z.resMgrLoad=function(e,i,n,t,o,l,a){void 0===n&&(n=0),void 0===t&&(t=!1),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===a&&(a=3),-1!=e.indexOf("mpack")&&console.log("=============resMgrLoad url:",e),s.EnvConfig.resMgrLoad(e,(e,n,t)=>{q4f713.prototype.resMgrLoadCallBack(e,n,t,i)},n,t,o,l,a)},z.resMgrLoadCallBack=function(e,n,t,i){console.log("buff:::",e,t,u.fileNativeDir+"///"+u.fileListName),i(e,n,t)},z.clearRes=function(e,n){this.clearRes(e,n=void 0===n?!1:n);n=u.getFileInfo(e);!n||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(e=n.md5,n=u.getFileNativePath(e),u.remove(n))},q4f713.onReadNativeCallBack=function(e,n,t,i,o,l,a,r,u){void 0===i&&(i=!0),void 0===l&&(l=!1),(r=void 0===r?0:r)?1==r&&s.EnvConfig.load.call(a,n,t,i,o,l):(r="json"==t||"atlas"==t?s.getJson(u.data):"xml"==t?y.parseXMLFromString(u.data):u.data,a.onLoaded(r),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=t&&wx.postMessage({url:n,data:r,isLoad:!0}))},e(q4f713,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),q4f713),u=(a($8r9zu,"laya.wx.mini.MiniFileMgr",t),$8r9zu.isLoadFile=function(e){return-1!=$8r9zu._fileTypeArr.indexOf(e)},$8r9zu.getFileInfo=function(e){e=e.split("?")[0],e=$8r9zu.filesListObj[e];return null==e?null:e},$8r9zu.onFileUpdate=function(e,n){var e=e.split("/"),e=e[e.length-1],t=$8r9zu.getFileInfo(n);null==t?$8r9zu.onSaveFile(n,e):t.readyUrl!=n&&$8r9zu.remove(e,n)},$8r9zu.exits=function(e,n){e=$8r9zu.getFileNativePath(e);$8r9zu.fs.getFileInfo({filePath:e,success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){null!=n&&n.runWith([1,e])}})},$8r9zu.read=function(e,n,t,i){void 0===n&&(n="ascill"),e=""!=(i=void 0===i?"":i)?$8r9zu.getFileNativePath(e):e,$8r9zu.fs.readFile({filePath:e,encoding:n,success:function(e){null!=t&&t.runWith([0,e])},fail:function(e){e&&""!=i?$8r9zu.down(i,n,t,i):null!=t&&t.runWith([1])}})},$8r9zu.readNativeFile=function(e,n){$8r9zu.fs.readFile({filePath:e,encoding:"",success:function(e){null!=n&&n.runWith([0])},fail:function(e){null!=n&&n.runWith([1])}})},$8r9zu.down=function(e,n,t,i){void 0===n&&(n="ascill"),void 0===i&&(i="");var o=$8r9zu.getFileNativePath(i);$8r9zu.wxdown({url:e,filePath:o,success:function(e){200===e.statusCode&&$8r9zu.readFile(e.filePath,n,t,i)},fail:function(e){null!=t&&t.runWith([1,e])}}).onProgressUpdate(function(e){null!=t&&t.runWith([2,e.progress])})},$8r9zu.readFile=function(n,e,t,i){void 0===i&&(i=""),$8r9zu.fs.readFile({filePath:n,encoding:e=void 0===e?"ascill":e,success:function(e){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||$8r9zu.onFileUpdate(n,i),null!=t&&t.runWith([0,e])},fail:function(e){e&&null!=t&&t.runWith([1,e])}})},$8r9zu.downImg=function(e,n,t){void 0===t&&(t="");$8r9zu.wxdown({url:e,success:function(e){200===e.statusCode&&$8r9zu.copyFile(e.tempFilePath,t,n)},fail:function(e){null!=n&&n.runWith([1,e])}})},$8r9zu.copyFile=function(e,n,t){var i=e.split("/"),o=i[i.length-1],l=(n.split("?")[0],$8r9zu.getFileInfo(n)),i=$8r9zu.getFileNativePath(o);$8r9zu.fs.copyFile({srcPath:e,destPath:i,success:function(e){l?l.readyUrl!=n&&$8r9zu.remove(o,n,t):($8r9zu.onSaveFile(n,o),null!=t&&t.runWith([0]))},fail:function(e){null!=t&&t.runWith([1,e])}})},$8r9zu.getFileNativePath=function(e){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},$8r9zu.remove=function(n,t,i){void 0===t&&(t="");var e=$8r9zu.getFileInfo(t),o=$8r9zu.getFileNativePath(e.md5);l.loader.clearRes(e.readyUrl),$8r9zu.fs.unlink({filePath:o,success:function(e){""!=t&&$8r9zu.onSaveFile(t,n),null!=i&&i.runWith([0])},fail:function(e){}})},$8r9zu.onSaveFile=function(e,n){var t=e.split("?")[0];$8r9zu.filesListObj[t]={md5:n,readyUrl:e},$8r9zu.fs.writeFile({filePath:$8r9zu.fileNativeDir+"/"+$8r9zu.fileListName,encoding:"utf8",data:JSON.stringify($8r9zu.filesListObj),success:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",e)},fail:function(e){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",e)}})},$8r9zu.existDir=function(e,n){$8r9zu.fs.mkdir({dirPath:e,success:function(e){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?$8r9zu.readSync($8r9zu.fileListName,"utf8",n):null!=n&&n.runWith([1,e])}})},$8r9zu.readSync=function(e,n,t,i){void 0===n&&(n="ascill"),void 0===i&&(i="");var o,n=$8r9zu.getFileNativePath(e);try{o=$8r9zu.fs.readFileSync(n),null!=t&&t.runWith([0,{data:o}])}catch(e){null!=t&&t.runWith([1])}},$8r9zu.readCache=function(){},$8r9zu.writeCache=function(e){var n=readyUrl.split("?")[0];$8r9zu.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},$8r9zu.fs.writeFile({filePath:$8r9zu.fileNativeDir+"/"+$8r9zu.fileListName,encoding:"utf8",data:JSON.stringify($8r9zu.filesListObj),success:function(e){},fail:function(e){}})},$8r9zu.setNativeFileDir=function(e){$8r9zu.fileNativeDir=wx.env.USER_DATA_PATH+e},$8r9zu.filesListObj={},$8r9zu.fileNativeDir=null,$8r9zu.fileListName="layaairfiles.txt",$8r9zu.ziyuFileData={},e($8r9zu,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),$8r9zu),_=(a(crp8u,"laya.wx.mini.MiniSound",t),(z=crp8u.prototype).load=function(e){var n;e=g.formatURL(e),this.url=e,crp8u._audioCache[e]?this.event("complete"):(this._sound.onCanplay(function(){n.loaded=!0,n.event("complete"),crp8u._audioCache[n.url]=n}),this._sound.onError(function(e){console.error("errCode="+e.errCode+"  errMsg="+e.errMsg),n.event("error")}),this._sound.src=e,n=this)},z.play=function(e,n){var t,i;return void 0===e&&(e=0),void 0===n&&(n=0),i=(t=this.url==p._tMusic?(crp8u._musicAudio||(crp8u._musicAudio=this._sound),crp8u._musicAudio):this._sound,this._chanell),t.src=this.url,t.startTime=0,i.isStopped&&(i.url=this.url,i.loops=n,i.startTime=e,i.play(),p.addChannel(i)),i},z.dispose=function(){var e=crp8u._audioCache[this.url];e&&(e.src="",delete crp8u._audioCache[this.url])},n(0,z,"duration",function(){return this._sound.duration}),crp8u._createSound=function(){return crp8u._id++,s.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},crp8u._musicAudio=null,crp8u._id=0,crp8u._audioCache={},crp8u._null=void 0,crp8u),x=(a(p$cr8,"laya.wx.mini.MiniSoundChannel",v),(e=p$cr8.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(l.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},e.__onNull=function(){},e.play=function(){this.isStopped=!1,p.addChannel(this),this._audio&&this._audio.play()},e.stop=function(){this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},e.pause=function(){this.isStopped=!0,this._audio.pause()},e.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},n(0,e,"position",function(){return this._audio?this._audio.currentTime:0}),n(0,e,"duration",function(){return this._audio?this._audio.duration:0}),n(0,e,"volume",function(){return 1},function(e){}),p$cr8._null=void 0,p$cr8),C=(a(up$8zr,"laya.wx.mini.MiniVideo"),(t=up$8zr.prototype).on=function(e,n,t){"loadedmetadata"==e?(this.onPlayFunc=t.bind(n),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=t.bind(n),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},t.onTimeUpdateFunc=function(e){this.position=e.position,this._duration=e.duration},t.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},t.onended=function(e,n){this.onEndedFunC=n.bind(e),this.videoElement.onended=this.onEndedFunction.bind(this)},t.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},t.off=function(e,n,t){"loadedmetadata"==e?(this.onPlayFunc=t.bind(n),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=t.bind(n),this.videoElement.offEnded=this.onEndedFunction.bind(this))},t.load=function(e){this.videoElement&&(this.videoElement.src=e)},t.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},t.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},t.size=function(e,n){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=n)},t.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},t.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},n(0,t,"duration",function(){return this._duration}),n(0,t,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(e){this.videoElement&&(this.videoElement.initialTime=e)}),n(0,t,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),n(0,t,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),n(0,t,"ended",function(){return this.videoend}),n(0,t,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(e){this.videoElement&&(this.videoElement.loop=e)}),n(0,t,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(e){this.videoElement&&(this.videoElement.playbackRate=e)}),n(0,t,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(e){this.videoElement&&(this.videoElement.muted=e)}),n(0,t,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),n(0,t,"x",function(){return this.videoElement?this.videoElement.x:0},function(e){this.videoElement&&(this.videoElement.x=e)}),n(0,t,"y",function(){return this.videoElement?this.videoElement.y:0},function(e){this.videoElement&&(this.videoElement.y=e)}),n(0,t,"currentSrc",function(){return this.videoElement.src}),n(0,t,"src",function(){return this.videoElement?this.videoElement.src:0},function(e){this.videoElement&&(this.videoElement.src=e)}),n(0,t,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(e){this.videoElement&&(this.videoElement.controls=e)}),n(0,t,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(e){this.videoElement&&(this.videoElement.autoplay=e)}),up$8zr);function up$8zr(){this.videoend=!1,this.videourl="",this.videoElement=s.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function p$cr8(e){this._audio=null,this._onEnd=null,p$cr8.__super.call(this),this.isStopped=!0,this._audio=e,this._onEnd=y.bind(this.__onEnd,this),e.onEnded(this._onEnd)}function crp8u(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,crp8u.__super.call(this),this._sound=crp8u._createSound(),this._chanell=new x(this._sound)}function $8r9zu(){$8r9zu.__super.call(this)}function q4f713(){}var z;function gvf34_(){}function vn(){}function ko5mtl(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,n){"use strict";for(var t in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var i=Laya[t];i&&i.__isclass&&(n[t]=i)}});