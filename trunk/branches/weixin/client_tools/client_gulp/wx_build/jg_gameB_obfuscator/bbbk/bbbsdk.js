var _=wx.y$;import Dall from"./bbbhelp";var config={game_id:_[30566],game_pkg:_[30567],partner_id:"19",game_ver:_[30568],is_auth:!1,from:null,tmpId:{1:_[30569],2:_[30570],3:_[30571],4:_[30572]},min_app_id:""};window.config=config;var p$ADEBC=p$AECBD();var HOST=_[30552];var t;var t_second=0;var t_max=300;var p$ADECB=null;var p$AEBCD=null;var p$AEBDC=null;var checkHandler=null;var loginHandler=null;var requestCallback=!1;var ad_info=null;function p$AECBD(){var i={};return{order_data:{},init:function(e,t){e=e&&e.game_ver?e.game_ver:0;console.log(_[30573]);var o=this;var n=wx.getStorageSync(_[30574]);var r;r=n?0:(n=o.uuid(16,32),wx.setStorageSync(_[30574],n),1),wx.getStorageSync(_[30575])||(a=o.uuid(16,32),wx.setStorageSync(_[30575],a));var a=wx.getLaunchOptionsSync();var i=a.scene||"";console.log(_[30576]),console.log(a),r&&a.query&&a.query.ad_code&&wx.setStorageSync(_[30577],a.query.ad_code),a.query&&a.query.from&&""!=a.query.from?(r&&wx.setStorageSync(_[30578],a.query.from),config.from=a.query.from):(s=wx.getStorageSync(_[30578]))||""==s||(config.from=s),console.log(_[30579]+config.from),o.log(_[282],{install:r,scene:i}),wx.showShareMenu();var s=a.query&&a.query.invite?a.query.invite:"";o=a.query&&a.query.invite_type?a.query.invite_type:"";s&&(p$AEBCD={invite:s,invite_type:o,is_new:r,scene:i}),e&&this.checkGameVersion(e,function(e){t&&t(e)}),ad_info={temp_info:a,temp_uuid:n,temp_is_new:r}},adLog:function(e){var t=ad_info.temp_info;var o=ad_info.temp_is_new;var n=ad_info.temp_uuid;t.query.hasOwnProperty(_[30580])&&t.query.hasOwnProperty(_[30581])&&o&&((o=t.query)[_[30582]]=n,o[_[30583]]=e,t=_[30584]+this.convertObj(o),console.log(_[30585]+t),wx.request({url:t}))},convertObj:function(e){var t=[];for(var o in e){var n=e[o];n.constructor==Array?n.forEach(function(e){t.push(o+"="+e)}):t.push(o+"="+n)}return t.join("&")},login:function(e,t){console.log(_[30586]);var o=this;i[_[30587]]=typeof t==_[30176]?t:null,config.is_auth?wx.getSetting({success:function(e){var t;e.authSetting[_[30588]]?(console.log(_[30589]),o.do_login()):(console.log(_[30590]),wx.hideLoading({}),(e=wx.getSystemInfoSync()).screenWidth,e.screenHeight,(t=wx.createUserInfoButton({type:_[4663],text:_[30591],withCredentials:!1,style:{top:e.windowHeight/2+e.windowHeight/4,left:e.windowWidth/2-100,width:200,height:40,lineHeight:40,backgroundColor:_[30592],color:_[4687],textAlign:_[1622],fontSize:16,borderRadius:4}})).show(),t.onTap(e=>{console.log(e),p$BDCE({title:_[30593]}),e.errMsg==_[30594]?o.do_login({head_img:e.userInfo.avatarUrl||"",nick_name:e.userInfo.nickName||""}):o.do_login(),t.destroy()}))},fail:function(){console.log(_[30595]),o.do_login()}}):(console.log(_[30596]+config.is_auth),o.do_login())},do_login:function(o){var a=this;wx.login({success:function(e){if(console.log(_[30597]+JSON.stringify(e)),e.code){var n=a.getPublicData();if(n[_[30598]]=1,n[_[24507]]=e.code,n[_[30599]]=o?o.nick_name:"",n[_[30600]]=o?o.head_img:"",p$AEBCD&&typeof p$AEBCD==_[277])for(var t in p$AEBCD)n[t]=p$AEBCD[t];var r;config.is_auth?wx.getUserInfo({success:function(e){var t=e.encryptedData;var o=e.iv;e=e.signature;n[_[30601]]=t,n.iv=o,n[_[30602]]=e,wx.request({url:_[26449]+HOST+_[30603],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:n,success:function(e){if(console.log(_[30604]),console.log(e),200==e.statusCode){e=e.data;if(e.state){var t={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0"};try{a.adLog(e.data.openid)}catch(e){console.log(_[30605]+JSON.stringify(e))}try{wx.setStorageSync(_[30606],e.data.sdk_token),wx.setStorageSync(_[30607],e.data.user_id),wx.setStorageSync(_[30553],e.data.username),e.data.ext&&wx.setStorageSync(_[30608],e.data.ext),wx.setStorageSync(_[30558],e.data.navigate_app_id)}catch(e){}i[_[30587]]&&i[_[30587]](0,t)}else i[_[30587]]&&i[_[30587]](1,{errMsg:e.msg});a.getShareInfo(_[30609],function(e){console.log(_[30610]),wx.onShareAppMessage(function(){return a.logStartShare(_[30609]),{title:e.title,imageUrl:e.img,query:e.query}})})}else i[_[30587]]&&i[_[30587]](1,{errMsg:_[30611]})},fail:function(e){i[_[30587]]&&i[_[30587]](1,{errMsg:e.errMsg})}})},fail:function(e){i[_[30587]]&&i[_[30587]](1,{errMsg:e.errMsg})}}):(r=Date.now(),wx.request({url:_[26449]+HOST+_[30603],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:n,success:function(e){if(console.log(_[30604]),console.log(e),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,200==e.statusCode){var t=e.data;if(t.state){var o={userid:t.data.user_id,account:t.data.nick_name,token:t.data.token,invite_uid:t.data.invite_uid||"",invite_nickname:t.data.invite_nickname||"",invite_head_img:t.data.invite_head_img||"",head_img:t.data.head_img||"",is_client:t.data.is_client||"0",ios_pay:t.data.ios_pay||"0"};try{a.adLog(t.data.openid)}catch(e){console.log(_[30605]+JSON.stringify(e))}try{wx.setStorageSync(_[30606],t.data.sdk_token),wx.setStorageSync(_[30607],t.data.user_id),wx.setStorageSync(_[30553],t.data.username),t.data.ext&&wx.setStorageSync(_[30608],t.data.ext),wx.setStorageSync(_[30558],t.data.navigate_app_id)}catch(e){}i[_[30587]]&&i[_[30587]](0,o)}else i[_[30587]]&&i[_[30587]](1,{type:_[30612],errMsg:t.msg,time:Date.now()-r,res:e});a.getShareInfo(_[30609],function(e){console.log(_[30610]),wx.onShareAppMessage(function(){return a.logStartShare(_[30609]),{title:e.title,imageUrl:e.img,query:e.query}})})}else i[_[30587]]&&i[_[30587]](1,{type:_[30612],errMsg:_[30611],time:Date.now()-r,res:e})},fail:function(e){console.log(_[30613]),console.log(e),a.log(_[507],{event:_[30614]}),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,i[_[30587]]&&i[_[30587]](1,{type:_[30615],errMsg:e.errMsg,time:Date.now()-r,res:e})}}),requestCallback||(loginHandler=setTimeout(function(){console.log(_[30616]),a.log(_[507],{event:_[30617]}),i[_[30587]]&&i[_[30587]](1,{type:_[30618],errMsg:_[30619],time:Date.now()-r}),i[_[30587]]=null},2e4)))}else i[_[30587]]&&i[_[30587]](1,{type:_[30620],errMsg:e.errMsg,res:e})},fail:function(e){console.log(_[30621]+JSON.stringify(e)),-1<e.errMsg.indexOf(_[30622])||e.errMsg.indexOf(_[30623]),i[_[30587]]&&i[_[30587]](1,{type:_[30624],errMsg:e.errMsg,res:e})}})},share:function(e){i[_[30625]]=typeof callback==_[30176]?callback:null;var t=e.type||_[30625];console.log(_[30626]+t);var o=this;this.getShareInfo(t,function(e){o.logStartShare(t),wx.shareAppMessage({title:e.title,imageUrl:e.img,query:e.query})})},logStartShare:function(e){var t=wx.getStorageSync(_[30606]);wx.request({url:_[26449]+HOST+_[30627],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:t,server_id:p$ADECB?p$ADECB.server_id:"",role_id:p$ADECB?p$ADECB.role_id:"",type:e},success:function(e){}})},openService:function(){wx.openCustomerServiceConversation()},checkGameVersion:function(e,t){console.log(_[30628]),i[_[7415]]=typeof t==_[30176]?t:null;wx.getStorageSync(_[30606]);wx.request({url:_[26449]+HOST+_[30629],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){console.log(_[30630]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,200==e.statusCode?(e=e.data,config.min_app_id=e.data.min_app_id,e.state?i[_[7415]]&&i[_[7415]](e.data):i[_[7415]]&&i[_[7415]]({develop:0})):i[_[7415]]&&i[_[7415]]({develop:0})},fail:function(e){console.log(_[30631]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,i[_[7415]]&&i[_[7415]]({develop:0})}}),requestCallback||(checkHandler=setTimeout(function(){console.log(_[30632]),i[_[7415]]&&i[_[7415]]({develop:0}),i[_[7415]]=null},1e4))},getShareInfo:function(e,t){console.log(_[30633]);var o=wx.getStorageSync(_[30606]);wx.request({url:_[26449]+HOST+_[30634],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:o,type:e,server_id:p$ADECB?p$ADECB.server_id:"",role_id:p$ADECB?p$ADECB.role_id:"",no_log:1},success:function(e){console.log(_[30635]),console.log(e),200==e.statusCode?(e=e.data).state?t&&t(e.data):i[_[30625]]&&i[_[30625]](1,{errMsg:_[30636]+e.msg}):i[_[30625]]&&i[_[30625]](1,{errMsg:_[30637]})}})},updateShare:function(e,t,o,n,r,a){console.log(_[30638]);var i=wx.getStorageSync(_[30606]);wx.request({url:_[26449]+HOST+_[30639],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:t,is_new:o,role_id:n,sever_id:r,scene:a},success:function(e){console.log(_[30640]),console.log(e)}})},msgCheck:function(e,t){console.log(_[30641]);var o=wx.getStorageSync(_[30606]);wx.request({url:_[26449]+HOST+_[30642],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:o,content:e},success:function(e){console.log(_[30643]),console.log(e),t&&t(e)}})},pay:function(e,t){var o=this;wx.checkSession({success:function(){o.startPay(e,t)},fail:function(){console.log(_[30644]),o.login({},function(){o.startPay(e,t)})}})},startPay:function(e,t){console.log(_[30645]),console.log(e);var o=this;i[_[30646]]=typeof t==_[30176]?t:null;t=wx.getStorageSync(_[30606]);var n=wx.getStorageSync(_[30608]);var r;t&&n?(r=wx.getSystemInfoSync(),e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:t,session_key:n,platform:r.platform},o.order_data=e,(t=o.getPublicData())[_[30648]]=JSON.stringify(e),t[_[30598]]=1,wx.request({url:_[26449]+HOST+_[30649],method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:t,success:function(e){console.log(_[30650]),console.log(e),200==e.statusCode?(e=e.data).state?typeof wx.requestPayment==_[30128]?r.platform==_[30651]||r.platform==_[30652]?e.data.is_android_pay?1==e.data.ios_pay_type?o.kfPay(e.data):2==e.data.ios_pay_type&&o.xiaoPay(e.data):o.gamePay(e.data):e.data.is_ios_pay?1==e.data.ios_pay_type?o.kfPay(e.data):2==e.data.ios_pay_type&&o.xiaoPay(e.data):wx.showModal({title:_[30653],content:_[30654],confirmText:_[30655],showCancel:!1}):o.minPay(e.data):i[_[30646]]&&i[_[30646]](1,{errMsg:e.msg}):i[_[30646]]&&i[_[30646]](1,{errMsg:_[30611]})}})):i[_[30646]]&&i[_[30646]](1,{errMsg:_[30647]})},xiaoPay:function(e){wx.navigateToMiniProgram({appId:config.min_app_id,path:_[30656]+e.orderId+_[30657]+e.money,extraData:{},envVersion:_[30564],success(e){}})},minPay:function(t){var o=this;wx.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(e){e.errMsg==_[30658]&&(e={cpOrderNo:o.order_data.cpbill,orderNo:t.orderId,amount:o.order_data.price,extension:o.order_data.extension},i[_[30646]]&&i[_[30646]](0,e))},fail:function(e){e.errMsg==_[30659]?i[_[30646]]&&i[_[30646]](2,{errMsg:_[30660]}):i[_[30646]]&&i[_[30646]](1,{errMsg:_[30661]+e.err_desc})},complete:function(e){}})},gamePay:function(t){var o=this;t.buyQuantity<=t.balance?(console.log(_[30662]),wx.showModal({title:_[30653],content:_[30663]+t.balance+_[30664]+t.buyQuantity+_[30665],showCancel:!1,confirmText:_[30655],success:function(){o.gameGoPay(t)}})):(console.log(_[30666]),wx.requestMidasPayment({mode:_[30667],env:t.env,offerId:t.offerId,currencyType:t.currencyType,platform:t.platform,buyQuantity:t.buyQuantity,zoneId:t.zoneId,success:function(e){e.errMsg==_[30668]&&o.gameGoPay(t)},fail:function(e){-1!==e.errMsg.indexOf(_[30669])?i[_[30646]]&&i[_[30646]](2,{errMsg:_[30660]}):i[_[30646]]&&i[_[30646]](1,{errMsg:_[30661]+e.errMsg})},complete:function(e){}}))},kfPay:function(e){p$AEBDC=e.orderId,wx.showModal({title:_[30653],content:_[30670],showCancel:!1,confirmText:_[30655],success:function(){var e={showMessageCard:!0,sendMessageTitle:_[30671],sendMessageImg:_[30672]};wx.openCustomerServiceConversation(e)}})},gameGoPay:function(t,e){console.log(_[30673]);var o=this;var n=wx.getStorageSync(_[30608]);wx.request({url:_[26449]+HOST+_[30674]+config.partner_id+"/"+config.game_pkg+"/",method:_[30556],dataType:_[6094],header:{"content-type":_[30557]},data:{order_id:t.orderId,time:t.time,sign:t.sign,session_key:n},success:function(e){console.log(_[30675]),console.log(e),200==e.statusCode&&(1==e.data.state?(e={cpOrderNo:o.order_data.cpbill,orderNo:t.orderId,amount:o.order_data.price,extension:o.order_data.extension},i[_[30646]]&&i[_[30646]](0,e)):i[_[30646]]&&i[_[30646]](1,{errMsg:_[30676]}))},fail:function(){}})},logCreateRole:function(e){var t=wx.getStorageSync(_[30607]);var o=wx.getStorageSync(_[30553]);var n={};n[_[30677]]=t,n[_[30678]]=o,n[_[11240]]=e.roleid,n[_[30679]]=e.rolelevel,n[_[30680]]=e.rolename,n[_[11916]]=e.serverid,e.roleid&&e.serverid&&(p$ADECB={role_id:e.roleid,server_id:e.serverid}),this.log(_[6],n)},logEnterGame:function(e){var t=wx.getStorageSync(_[30607]);var o=wx.getStorageSync(_[30553]);var n={};n[_[30677]]=t,n[_[30678]]=o,n[_[11240]]=e.roleid,n[_[30679]]=e.rolelevel,n[_[30680]]=e.rolename,n[_[11916]]=e.serverid,e.roleid&&e.serverid&&(p$ADECB={role_id:e.roleid,server_id:e.serverid}),this.log(_[5976],n),p$AEBCD&&this.updateShare(p$AEBCD.invite,p$AEBCD.invite_type,p$AEBCD.is_new,e.roleid,e.serverid,p$AEBCD.scene)},logRoleUpLevel:function(e){var t=wx.getStorageSync(_[30607]);var o=wx.getStorageSync(_[30553]);var n={};n[_[30677]]=t,n[_[30678]]=o,n[_[11240]]=e.roleid,n[_[30679]]=e.rolelevel,n[_[30680]]=e.rolename,n[_[11916]]=e.serverid,e.roleid&&e.serverid&&(p$ADECB={role_id:e.roleid,server_id:e.serverid}),this.log(_[30681],n)},uuid:function(e,t){var o=_[30682].split("");var n,r=[];var a;if(e=e||o.length,t)for(n=0;n<t;n++)r[n]=o[0|Math.random()*e];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;n<36;n++)r[n]||(a=0|16*Math.random(),r[n]=o[19==n?3&a|8:a]);return r.join("")},getPublicData:function(){var e=wx.getSystemInfoSync();var t=wx.getStorageSync(_[30574]);var o=wx.getStorageSync(_[30575]);var n=wx.getStorageSync(_[30577]);var r=wx.getStorageSync(_[78]);return r||(r=wx.getLaunchOptionsSync(),wx.setStorageSync(_[78],r)),{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,ad_code:n,uuid:t,idfv:o,dname:e.model,mac:_[30683],net_type:0==e.wifiSignal?"4G":_[30684],os_ver:e.system,sdk_ver:e.version,game_ver:config.game_ver,device:e.platform==_[30651]?1:2,scene:r.scene,query:JSON.stringify(r.query)}},subscribeWhatsNew:function(e,t){wx.requestSubscribeWhatsNew({msgType:1,success(e){console.log(e),t(e.confirm)},fail(e){console.error(e),t(!1)}})},subscriptionsSetting:function(e,t){wx.getWhatsNewSubscriptionsSetting({msgType:1,success(e){console.log(e),t(e.status)},fail(e){console.error(e),t(0)}})},log:function(e,t){var o=this.getPublicData();for(var n in t)o[n]=t[n];console.log(_[30685]+e),console.log(o),wx.request({url:_[26449]+HOST+_[30686]+e+_[30687]+encodeURIComponent(JSON.stringify(o))})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()},subscribeMessage:function(e,t){console.log(_[30688]+e),i[_[30689]]=typeof t==_[30176]?t:null,wx.requestSubscribeMessage({tmplIds:e,success(e){console.log(_[30690]),console.log(e),i[_[30689]]&&i[_[30689]](e)},fail(e){console.log(_[30691]),console.log(e),i[_[30689]]&&i[_[30689]](e)}})},weiduanHelper:function(){(new Dall).stebutonanimation(config.partner_id,config.game_pkg,config.game_id)}}}function run(e,t,o){e in p$ADEBC&&p$ADEBC[e](t,o)}exports.init=function(e,t){run(_[363],e,t)},exports.login=function(e){run(_[30587],"",e)},exports.pay=function(e,t){run(_[30646],e,t)},exports.openService=function(){run(_[24503])},exports.logCreateRole=function(e,t,o,n,r){run(_[30692],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:r})},exports.logEnterGame=function(e,t,o,n,r){run(_[30693],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:r})},exports.logRoleUpLevel=function(e,t,o,n,r){run(_[30694],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:r})},exports.share=function(e){run(_[30625],{type:e})},exports.msgCheck=function(e,t){run(_[12621],e,t)},exports.downloadClient=function(){run(_[30695])},exports.subscribeMessage=function(e,t){run(_[30689],e,t)},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(_[30696])},exports.weiduanHelper=function(){run(_[24393])},exports.subscribeWhatsNew=function(e,t){run(_[30697],e,t)},exports.subscriptionsSetting=function(e,t){run(_[30698],e,t)};