var _=wx.y$;!function(o,s){s.un,s.uns;var n=s.static,r=s.class,t=s.getset,a=(s.__newvec,laya.utils.Browser),e=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,c=laya.utils.Handler,i=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),v=laya.utils.RunDriver,p=(laya.media.Sound,laya.media.SoundChannel),m=laya.media.SoundManager,w=(laya.display.Stage,laya.net.URL),x=laya.utils.Utils,u=(r(wvtx,"laya.wx.mini.MiniAdpter"),wvtx.getJson=function(n){return JSON.parse(n)},wvtx.init=function(n,t){void 0===n&&(n=!1),void 0===t&&(t=!1),wvtx._inited||(wvtx.window=o).navigator.userAgent.indexOf("MiniGame")<0||(wvtx._inited=!0,wvtx.isZiYu=t,wvtx.isPosMsgYu=n,wvtx.EnvConfig={},wvtx.isZiYu||(l.setNativeFileDir("/layaairGame"),l.existDir(l.fileNativeDir,c.create(wvtx,wvtx.onMkdirCallBack))),wvtx.window.focus=function(){},s.getUrlPath=function(){},wvtx.window.logtime=function(n){},wvtx.window.alertTimeLog=function(n){},wvtx.window.resetShareInfo=function(){},wvtx.window.CanvasRenderingContext2D=function(){},wvtx.window.CanvasRenderingContext2D.prototype=wvtx.window.wx.createCanvas().getContext("2d").__proto__,wvtx.window.document.body.appendChild=function(){},wvtx.EnvConfig.pixelRatioInt=0,v.getPixelRatio=wvtx.pixelRatio,wvtx._preCreateElement=a.createElement,a.createElement=wvtx.createElement,v.createShaderCondition=wvtx.createShaderCondition,x.parseXMLFromString=wvtx.parseXMLFromString,i._createInputElement=y._createInputElement,wvtx.EnvConfig.load=f.prototype.load,f.prototype.load=g.prototype.load,wvtx.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(l.ziyuFileData[n.url]=n.data)}))},wvtx.onMkdirCallBack=function(n,t){n||(l.filesListObj=JSON.parse(t.data))},wvtx.pixelRatio=function(){if(!wvtx.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return wvtx.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return wvtx.EnvConfig.pixelRatioInt},wvtx.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?wvtx.onCreateInput(n):"div"==n?((e=wvtx._preCreateElement(n)).contains=function(n){return null},e.removeChild=function(n){},e):wvtx._preCreateElement(n):(1==wvtx.idx?wvtx.isZiYu?(t=sharedCanvas).style={}:t=o.canvas:t=o.wx.createCanvas(),wvtx.idx++,t);var t;var e},wvtx.onCreateInput=function(n){n=wvtx._preCreateElement(n);return n.focus=y.wxinputFocus,n.blur=y.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},wvtx.createShaderCondition=function(n){var t=this;return function(){return t[n.replace("this.","")]}},wvtx.EnvConfig=null,wvtx.window=null,wvtx._preCreateElement=null,wvtx._inited=!1,wvtx.wxRequest=null,wvtx.systemInfo=null,wvtx.version="0.0.1",wvtx.isZiYu=!1,wvtx.isPosMsgYu=!1,wvtx.parseXMLFromString=function(n){var t;n=n.replace(/>\s+</g,"><");try{t=(new o.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return t},wvtx.idx=1,wvtx),y=(r(_$xzy,"laya.wx.mini.MiniImage"),_$xzy.prototype._loadImage=function(n){var t=!1;-1==n.indexOf("layaNativeDir/")&&(t=!0,n=w.formatURL(n)),l.getFileInfo(n)?_$xzy.onCreateImage(n,this,!t):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?l.downImg(n,new c(_$xzy,_$xzy.onDownImgCallBack,[n,this]),n):_$xzy.onCreateImage(n,this,!0)},_$xzy.onDownImgCallBack=function(n,t,e){e?t.onError(null):_$xzy.onCreateImage(n,t)},_$xzy.onCreateImage=function(t,e,n){var i;function _z(){i.onload=null,i.onerror=null,delete e.imgCache[t]}n=(n=void 0===n?!1:n)?t:(n=l.getFileInfo(t).md5,l.getFileNativePath(n)),null==e.imgCache&&(e.imgCache={});function As(){_z(),e.onLoaded(i)}function Ds(){_z(),e.event("error","Load image failed")}"nativeimage"==e._type?((i=new a.window.Image).crossOrigin="",i.onload=As,i.onerror=Ds,i.src=n,e.imgCache[t]=i):new d.create(n,{onload:As,onerror:Ds,onCreate:function(n){i=n,e.imgCache[t]=n}})},r(rqtops,"laya.wx.mini.MiniInput"),rqtops._createInputElement=function(){i._initInput(i.area=a.createElement("textarea")),i._initInput(i.input=a.createElement("input")),i.inputContainer=a.createElement("div"),i.inputContainer.style.position="absolute",i.inputContainer.style.zIndex=1e5,a.container.appendChild(i.inputContainer),i.inputContainer.setPos=function(n,t){i.inputContainer.style.left=n+"px",i.inputContainer.style.top=t+"px"},s.stage.on("resize",null,rqtops._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){o.dispatchEvent&&o.dispatchEvent("resize")}),m._soundClass=E,m._musicClass=E,o._videoClass=q},rqtops._onStageResize=function(){s.stage._canvasTransform.identity().scale(a.width/h.canvas.width/v.getPixelRatio(),a.height/h.canvas.height/v.getPixelRatio())},rqtops.wxinputFocus=function(n){var t=i.inputElement.target;t&&!t.editable||(u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.showKeyboard({defaultValue:t.text,maxLength:t.maxChars,multiple:t.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),u.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";t.text=n,t.event("input"),laya.wx.mini.MiniInput.inputEnter()}),u.window.wx.onKeyboardInput(function(n){n=n?n.value:"";t.multiline||-1==n.indexOf("\n")?(t.text=n,t.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},rqtops.inputEnter=function(){i.inputElement.target.focus=!1},rqtops.wxinputblur=function(){rqtops.hideKeyboard()},rqtops.hideKeyboard=function(){u.window.wx.offKeyboardConfirm(),u.window.wx.offKeyboardInput(),u.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},rqtops),g=(r(svuwr,"laya.wx.mini.MiniLoader"),(C=svuwr.prototype).load=function(n,t,e,i,o){void 0===e&&(e=!0),void 0===o&&(o=!1);var s=this;0===(s._url=n).indexOf("data:image")?s._type=t="image":s._type=t=t||s.getTypeFromUrl(n),s._cache=e,s._data=null;var r="ascii";-1!=n.indexOf(".fnt")?r="utf8":"arraybuffer"==t&&(r="");var a=x.getFileExtension(n);if(-1!=svuwr._fileTypeArr.indexOf(a))u.EnvConfig.load.call(this,n,t,e,i,o);else if(l.getFileInfo(n))u.EnvConfig.load.call(this,n,t,e,i,o);else{if(-1!=n.indexOf("layaNativeDir/"))return u.isZiYu?(a=l.ziyuFileData[n],void s.onLoaded(a)):(cosnole.log("read read"),void l.read(n,r,new c(svuwr,svuwr.onReadNativeCallBack,[r,n,t,e,i,o,s])));a=""==w.rootPath?n:n.split(w.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?u.EnvConfig.load.call(s,n,t,e,i,o):l.readFile(a,r,new c(svuwr,svuwr.onReadNativeCallBack,[r,n,t,e,i,o,s]),n)}},C.resMgrLoad=function(n,i,t,e,o,s,r){void 0===t&&(t=0),void 0===e&&(e=!1),void 0===o&&(o=!1),void 0===s&&(s=0),void 0===r&&(r=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),u.EnvConfig.resMgrLoad(n,(n,t,e)=>{svuwr.prototype.resMgrLoadCallBack(n,t,e,i)},t,e,o,s,r)},C.resMgrLoadCallBack=function(n,t,e,i){console.log("buff:::",n,e,l.fileNativeDir+"///"+l.fileListName),i(n,t,e)},C.clearRes=function(n,t){this.clearRes(n,t=void 0===t?!1:t);t=l.getFileInfo(n);!t||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=t.md5,t=l.getFileNativePath(n),l.remove(t))},svuwr.onReadNativeCallBack=function(n,t,e,i,o,s,r,a,l){void 0===i&&(i=!0),void 0===s&&(s=!1),(a=void 0===a?0:a)?1==a&&u.EnvConfig.load.call(r,t,e,i,o,s):(a="json"==e||"atlas"==e?u.getJson(l.data):"xml"==e?x.parseXMLFromString(l.data):l.data,r.onLoaded(a),!u.isZiYu&&u.isPosMsgYu&&"arraybuffer"!=e&&wx.postMessage({url:t,data:a,isLoad:!0}))},n(svuwr,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),svuwr),l=(r(pnqsro,"laya.wx.mini.MiniFileMgr",e),pnqsro.isLoadFile=function(n){return-1!=pnqsro._fileTypeArr.indexOf(n)},pnqsro.getFileInfo=function(n){n=n.split("?")[0],n=pnqsro.filesListObj[n];return null==n?null:n},pnqsro.onFileUpdate=function(n,t){var n=n.split("/"),n=n[n.length-1],e=pnqsro.getFileInfo(t);null==e?pnqsro.onSaveFile(t,n):e.readyUrl!=t&&pnqsro.remove(n,t)},pnqsro.exits=function(n,t){n=pnqsro.getFileNativePath(n);pnqsro.fs.getFileInfo({filePath:n,success:function(n){null!=t&&t.runWith([0,n])},fail:function(n){null!=t&&t.runWith([1,n])}})},pnqsro.read=function(n,t,e,i){void 0===t&&(t="ascill"),n=""!=(i=void 0===i?"":i)?pnqsro.getFileNativePath(n):n,pnqsro.fs.readFile({filePath:n,encoding:t,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){n&&""!=i?pnqsro.down(i,t,e,i):null!=e&&e.runWith([1])}})},pnqsro.readNativeFile=function(n,t){pnqsro.fs.readFile({filePath:n,encoding:"",success:function(n){null!=t&&t.runWith([0])},fail:function(n){null!=t&&t.runWith([1])}})},pnqsro.down=function(n,t,e,i){void 0===t&&(t="ascill"),void 0===i&&(i="");var o=pnqsro.getFileNativePath(i);pnqsro.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&pnqsro.readFile(n.filePath,t,e,i)},fail:function(n){null!=e&&e.runWith([1,n])}}).onProgressUpdate(function(n){null!=e&&e.runWith([2,n.progress])})},pnqsro.readFile=function(t,n,e,i){void 0===i&&(i=""),pnqsro.fs.readFile({filePath:t,encoding:n=void 0===n?"ascill":n,success:function(n){-1==t.indexOf("http://")&&-1==t.indexOf("https://")||pnqsro.onFileUpdate(t,i),null!=e&&e.runWith([0,n])},fail:function(n){n&&null!=e&&e.runWith([1,n])}})},pnqsro.downImg=function(n,t,e){void 0===e&&(e="");pnqsro.wxdown({url:n,success:function(n){200===n.statusCode&&pnqsro.copyFile(n.tempFilePath,e,t)},fail:function(n){null!=t&&t.runWith([1,n])}})},pnqsro.copyFile=function(n,t,e){var i=n.split("/"),o=i[i.length-1],s=(t.split("?")[0],pnqsro.getFileInfo(t)),i=pnqsro.getFileNativePath(o);pnqsro.fs.copyFile({srcPath:n,destPath:i,success:function(n){s?s.readyUrl!=t&&pnqsro.remove(o,t,e):(pnqsro.onSaveFile(t,o),null!=e&&e.runWith([0]))},fail:function(n){null!=e&&e.runWith([1,n])}})},pnqsro.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},pnqsro.remove=function(t,e,i){void 0===e&&(e="");var n=pnqsro.getFileInfo(e),o=pnqsro.getFileNativePath(n.md5);s.loader.clearRes(n.readyUrl),pnqsro.fs.unlink({filePath:o,success:function(n){""!=e&&pnqsro.onSaveFile(e,t),null!=i&&i.runWith([0])},fail:function(n){}})},pnqsro.onSaveFile=function(n,t){var e=n.split("?")[0];pnqsro.filesListObj[e]={md5:t,readyUrl:n},pnqsro.fs.writeFile({filePath:pnqsro.fileNativeDir+"/"+pnqsro.fileListName,encoding:"utf8",data:JSON.stringify(pnqsro.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},pnqsro.existDir=function(n,t){pnqsro.fs.mkdir({dirPath:n,success:function(n){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?pnqsro.readSync(pnqsro.fileListName,"utf8",t):null!=t&&t.runWith([1,n])}})},pnqsro.readSync=function(n,t,e,i){void 0===t&&(t="ascill"),void 0===i&&(i="");var o,t=pnqsro.getFileNativePath(n);try{o=pnqsro.fs.readFileSync(t),null!=e&&e.runWith([0,{data:o}])}catch(n){null!=e&&e.runWith([1])}},pnqsro.readCache=function(){},pnqsro.writeCache=function(n){var t=readyUrl.split("?")[0];pnqsro.filesListObj[t]={md5:md5Name,readyUrl:readyUrl},pnqsro.fs.writeFile({filePath:pnqsro.fileNativeDir+"/"+pnqsro.fileListName,encoding:"utf8",data:JSON.stringify(pnqsro.filesListObj),success:function(n){},fail:function(n){}})},pnqsro.setNativeFileDir=function(n){pnqsro.fileNativeDir=wx.env.USER_DATA_PATH+n},pnqsro.filesListObj={},pnqsro.fileNativeDir=null,pnqsro.fileListName="layaairfiles.txt",pnqsro.ziyuFileData={},n(pnqsro,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),pnqsro),E=(r(orqns,"laya.wx.mini.MiniSound",e),(C=orqns.prototype).load=function(n){var t;n=w.formatURL(n),this.url=n,orqns._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){t.loaded=!0,t.event("complete"),orqns._audioCache[t.url]=t}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),t.event("error")}),this._sound.src=n,t=this)},C.play=function(n,t){var e,i;return void 0===n&&(n=0),void 0===t&&(t=0),i=(e=this.url==m._tMusic?(orqns._musicAudio||(orqns._musicAudio=this._sound),orqns._musicAudio):this._sound,this._chanell),e.src=this.url,e.startTime=0,i.isStopped&&(i.url=this.url,i.loops=t,i.startTime=n,i.play(),m.addChannel(i)),i},C.dispose=function(){var n=orqns._audioCache[this.url];n&&(n.src="",delete orqns._audioCache[this.url])},t(0,C,"duration",function(){return this._sound.duration}),orqns._createSound=function(){return orqns._id++,u.window.wx.createInnerAudioContext({useWebAudioImplement:!1})},orqns._musicAudio=null,orqns._id=0,orqns._audioCache={},orqns._null=void 0,orqns),_=(r(ruwt,"laya.wx.mini.MiniSoundChannel",p),(n=ruwt.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(s.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,m.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio&&this._audio.stop()},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},t(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),t(0,n,"duration",function(){return this._audio?this._audio.duration:0}),t(0,n,"volume",function(){return 1},function(n){}),ruwt._null=void 0,ruwt),q=(r(jfihk,"laya.wx.mini.MiniVideo"),(e=jfihk.prototype).on=function(n,t,e){"loadedmetadata"==n?(this.onPlayFunc=e.bind(t),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=e.bind(t),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},e.onTimeUpdateFunc=function(n){this.position=n.position,this._duration=n.duration},e.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},e.onended=function(n,t){this.onEndedFunC=t.bind(n),this.videoElement.onended=this.onEndedFunction.bind(this)},e.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},e.off=function(n,t,e){"loadedmetadata"==n?(this.onPlayFunc=e.bind(t),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=e.bind(t),this.videoElement.offEnded=this.onEndedFunction.bind(this))},e.load=function(n){this.videoElement&&(this.videoElement.src=n)},e.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},e.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},e.size=function(n,t){this.videoElement&&(this.videoElement.width=n,this.videoElement.height=t)},e.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},e.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},t(0,e,"duration",function(){return this._duration}),t(0,e,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(n){this.videoElement&&(this.videoElement.initialTime=n)}),t(0,e,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),t(0,e,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),t(0,e,"ended",function(){return this.videoend}),t(0,e,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(n){this.videoElement&&(this.videoElement.loop=n)}),t(0,e,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(n){this.videoElement&&(this.videoElement.playbackRate=n)}),t(0,e,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(n){this.videoElement&&(this.videoElement.muted=n)}),t(0,e,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),t(0,e,"x",function(){return this.videoElement?this.videoElement.x:0},function(n){this.videoElement&&(this.videoElement.x=n)}),t(0,e,"y",function(){return this.videoElement?this.videoElement.y:0},function(n){this.videoElement&&(this.videoElement.y=n)}),t(0,e,"currentSrc",function(){return this.videoElement.src}),t(0,e,"src",function(){return this.videoElement?this.videoElement.src:0},function(n){this.videoElement&&(this.videoElement.src=n)}),t(0,e,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(n){this.videoElement&&(this.videoElement.controls=n)}),t(0,e,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(n){this.videoElement&&(this.videoElement.autoplay=n)}),jfihk);function jfihk(){this.videoend=!1,this.videourl="",this.videoElement=u.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function ruwt(n){this._audio=null,this._onEnd=null,ruwt.__super.call(this),this.isStopped=!0,this._audio=n,this._onEnd=x.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function orqns(){this._sound=null,this._chanell=null,this.url=null,this.loaded=!1,orqns.__super.call(this),this._sound=orqns._createSound(),this._chanell=new _(this._sound)}function pnqsro(){pnqsro.__super.call(this)}function svuwr(){}var C;function rqtops(){}function _$xzy(){}function wvtx(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,t){"use strict";for(var e in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var i=Laya[e];i&&i.__isclass&&(t[e]=i)}});