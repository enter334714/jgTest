var M=wx.$T;!function(o,a){a.un,a.uns;var n=a.static,r=a.class,e=a.getset,l=(a.__newvec,laya.utils.Browser),i=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,c=laya.utils.Handler,t=laya.display.Input,f=laya.net.Loader,h=(laya.maths.Matrix,laya.renders.Render),v=laya.utils.RunDriver,p=(laya.media.Sound,laya.media.SoundChannel),m=laya.media.SoundManager,g=(laya.display.Stage,laya.net.URL),b=laya.utils.Utils,d=(r(kragb,"laya.wx.mini.MiniAdpter"),kragb.getJson=function(n){return JSON.parse(n)},kragb.init=function(n,e){void 0===n&&(n=!1),void 0===e&&(e=!1),kragb._inited||(kragb.window=o).navigator.userAgent.indexOf("MiniGame")<0||(kragb._inited=!0,kragb.isZiYu=e,kragb.isPosMsgYu=n,kragb.EnvConfig={},kragb.isZiYu||(s.setNativeFileDir("/layaairGame"),s.existDir(s.fileNativeDir,c.create(kragb,kragb.onMkdirCallBack))),kragb.window.focus=function(){},a.getUrlPath=function(){},kragb.window.logtime=function(n){},kragb.window.alertTimeLog=function(n){},kragb.window.resetShareInfo=function(){},kragb.window.CanvasRenderingContext2D=function(){},kragb.window.CanvasRenderingContext2D.prototype=kragb.window.wx.createCanvas().getContext("2d").__proto__,kragb.window.document.body.appendChild=function(){},kragb.EnvConfig.pixelRatioInt=0,v.getPixelRatio=kragb.pixelRatio,kragb._preCreateElement=l.createElement,l.createElement=kragb.createElement,v.createShaderCondition=kragb.createShaderCondition,b.parseXMLFromString=kragb.parseXMLFromString,t._createInputElement=y._createInputElement,kragb.EnvConfig.load=f.prototype.load,f.prototype.load=k.prototype.load,kragb.isZiYu&&n&&wx.onMessage(function(n){n.isLoad&&(s.ziyuFileData[n.url]=n.data)}))},kragb.onMkdirCallBack=function(n,e){n||(s.filesListObj=JSON.parse(e.data))},kragb.pixelRatio=function(){if(!kragb.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return kragb.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return kragb.EnvConfig.pixelRatioInt},kragb.createElement=function(n){return"canvas"!=n?"textarea"==n||"input"==n?kragb.onCreateInput(n):"div"==n?((i=kragb._preCreateElement(n)).contains=function(n){return null},i.removeChild=function(n){},i):kragb._preCreateElement(n):(1==kragb.idx?kragb.isZiYu?(e=sharedCanvas).style={}:e=o.canvas:e=o.wx.createCanvas(),kragb.idx++,e);var e;var i},kragb.onCreateInput=function(n){n=kragb._preCreateElement(n);return n.focus=y.wxinputFocus,n.blur=y.wxinputblur,n.style={},n.value=0,n.parentElement={},n.placeholder={},n.type={},n.setColor=function(n){},n.setType=function(n){},n.setFontFace=function(n){},n.addEventListener=function(n){},n.contains=function(n){return null},n.removeChild=function(n){},n},kragb.createShaderCondition=function(n){var e=this;return function(){return e[n.replace("this.","")]}},kragb.EnvConfig=null,kragb.window=null,kragb._preCreateElement=null,kragb._inited=!1,kragb.wxRequest=null,kragb.systemInfo=null,kragb.version="0.0.1",kragb.isZiYu=!1,kragb.isPosMsgYu=!1,kragb.parseXMLFromString=function(n){var e;n=n.replace(/>\s+</g,"><");try{e=(new o.Parser.DOMParser).parseFromString(n,"text/xml")}catch(n){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return e},kragb.idx=1,kragb),y=(r(vd9ic$,"laya.wx.mini.MiniImage"),vd9ic$.prototype._loadImage=function(n){var e=!1;-1==n.indexOf("layaNativeDir/")&&(e=!0,n=g.formatURL(n)),s.getFileInfo(n)?vd9ic$.onCreateImage(n,this,!e):-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?s.downImg(n,new c(vd9ic$,vd9ic$.onDownImgCallBack,[n,this]),n):vd9ic$.onCreateImage(n,this,!0)},vd9ic$.onDownImgCallBack=function(n,e,i){i?e.onError(null):vd9ic$.onCreateImage(n,e)},vd9ic$.onCreateImage=function(e,i,n){var t;function itc92v(){t.onload=null,t.onerror=null,delete i.imgCache[e]}n=(n=void 0===n?!1:n)?e:(n=s.getFileInfo(e).md5,s.getFileNativePath(n)),null==i.imgCache&&(i.imgCache={});function za(){itc92v(),i.onLoaded(t)}function Aa(){itc92v(),i.event("error","Load image failed")}"nativeimage"==i._type?((t=new l.window.Image).crossOrigin="",t.onload=za,t.onerror=Aa,t.src=n,i.imgCache[e]=t):new u.create(n,{onload:za,onerror:Aa,onCreate:function(n){t=n,i.imgCache[e]=n}})},r(sjarb,"laya.wx.mini.MiniInput"),sjarb._createInputElement=function(){t._initInput(t.area=l.createElement("textarea")),t._initInput(t.input=l.createElement("input")),t.inputContainer=l.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,l.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(n,e){t.inputContainer.style.left=n+"px",t.inputContainer.style.top=e+"px"},a.stage.on("resize",null,sjarb._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(n){o.dispatchEvent&&o.dispatchEvent("resize")}),m._soundClass=E,m._musicClass=E,o._videoClass=w},sjarb._onStageResize=function(){a.stage._canvasTransform.identity().scale(l.width/h.canvas.width/v.getPixelRatio(),l.height/h.canvas.height/v.getPixelRatio())},sjarb.wxinputFocus=function(n){var e=t.inputElement.target;e&&!e.editable||(d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),d.window.wx.onKeyboardConfirm(function(n){n=n?n.value:"";e.text=n,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),d.window.wx.onKeyboardInput(function(n){n=n?n.value:"";e.multiline||-1==n.indexOf("\n")?(e.text=n,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},sjarb.inputEnter=function(){t.inputElement.target.focus=!1},sjarb.wxinputblur=function(){sjarb.hideKeyboard()},sjarb.hideKeyboard=function(){d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.hideKeyboard({success:function(n){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(n){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(n?n.errMsg:""))}})},sjarb),k=(r(e7oq0x,"laya.wx.mini.MiniLoader"),(x=e7oq0x.prototype).load=function(n,e,i,t,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var a=this;0===(a._url=n).indexOf("data:image")?a._type=e="image":a._type=e=e||a.getTypeFromUrl(n),a._cache=i,a._data=null;var r="ascii";-1!=n.indexOf(".fnt")?r="utf8":"arraybuffer"==e&&(r="");var l=b.getFileExtension(n);if(-1!=e7oq0x._fileTypeArr.indexOf(l))d.EnvConfig.load.call(this,n,e,i,t,o);else if(s.getFileInfo(n))d.EnvConfig.load.call(this,n,e,i,t,o);else{if(-1!=n.indexOf("layaNativeDir/"))return d.isZiYu?(l=s.ziyuFileData[n],void a.onLoaded(l)):(cosnole.log("read read"),void s.read(n,r,new c(e7oq0x,e7oq0x.onReadNativeCallBack,[r,n,e,i,t,o,a])));l=""==g.rootPath?n:n.split(g.rootPath)[0],-1!=n.indexOf("http://")||-1!=n.indexOf("https://")?d.EnvConfig.load.call(a,n,e,i,t,o):s.readFile(l,r,new c(e7oq0x,e7oq0x.onReadNativeCallBack,[r,n,e,i,t,o,a]),n)}},x.resMgrLoad=function(n,t,e,i,o,a,r){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===r&&(r=3),-1!=n.indexOf("mpack")&&console.log("=============resMgrLoad url:",n),d.EnvConfig.resMgrLoad(n,(n,e,i)=>{e7oq0x.prototype.resMgrLoadCallBack(n,e,i,t)},e,i,o,a,r)},x.resMgrLoadCallBack=function(n,e,i,t){console.log("buff:::",n,i,s.fileNativeDir+"///"+s.fileListName),t(n,e,i)},x.clearRes=function(n,e){this.clearRes(n,e=void 0===e?!1:e);e=s.getFileInfo(n);!e||-1==n.indexOf("http://")&&-1==n.indexOf("https://")||(n=e.md5,e=s.getFileNativePath(n),s.remove(e))},e7oq0x.onReadNativeCallBack=function(n,e,i,t,o,a,r,l,s){void 0===t&&(t=!0),void 0===a&&(a=!1),(l=void 0===l?0:l)?1==l&&d.EnvConfig.load.call(r,e,i,t,o,a):(l="json"==i||"atlas"==i?d.getJson(s.data):"xml"==i?b.parseXMLFromString(s.data):s.data,r.onLoaded(l),!d.isZiYu&&d.isPosMsgYu&&"arraybuffer"!=i&&wx.postMessage({url:e,data:l,isLoad:!0}))},n(e7oq0x,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),e7oq0x),s=(r(abjrsk,"laya.wx.mini.MiniFileMgr",i),abjrsk.isLoadFile=function(n){return-1!=abjrsk._fileTypeArr.indexOf(n)},abjrsk.getFileInfo=function(n){n=n.split("?")[0],n=abjrsk.filesListObj[n];return null==n?null:n},abjrsk.onFileUpdate=function(n,e){var n=n.split("/"),n=n[n.length-1],i=abjrsk.getFileInfo(e);null==i?abjrsk.onSaveFile(e,n):i.readyUrl!=e&&abjrsk.remove(n,e)},abjrsk.exits=function(n,e){n=abjrsk.getFileNativePath(n);abjrsk.fs.getFileInfo({filePath:n,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},abjrsk.read=function(n,e,i,t){void 0===e&&(e="ascill"),n=""!=(t=void 0===t?"":t)?abjrsk.getFileNativePath(n):n,abjrsk.fs.readFile({filePath:n,encoding:e,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){n&&""!=t?abjrsk.down(t,e,i,t):null!=i&&i.runWith([1])}})},abjrsk.readNativeFile=function(n,e){abjrsk.fs.readFile({filePath:n,encoding:"",success:function(n){null!=e&&e.runWith([0])},fail:function(n){null!=e&&e.runWith([1])}})},abjrsk.down=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var o=abjrsk.getFileNativePath(t);abjrsk.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&abjrsk.readFile(n.filePath,e,i,t)},fail:function(n){null!=i&&i.runWith([1,n])}}).onProgressUpdate(function(n){null!=i&&i.runWith([2,n.progress])})},abjrsk.readFile=function(e,n,i,t){void 0===t&&(t=""),abjrsk.fs.readFile({filePath:e,encoding:n=void 0===n?"ascill":n,success:function(n){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||abjrsk.onFileUpdate(e,t),null!=i&&i.runWith([0,n])},fail:function(n){n&&null!=i&&i.runWith([1,n])}})},abjrsk.downImg=function(n,e,i){void 0===i&&(i="");abjrsk.wxdown({url:n,success:function(n){200===n.statusCode&&abjrsk.copyFile(n.tempFilePath,i,e)},fail:function(n){null!=e&&e.runWith([1,n])}})},abjrsk.copyFile=function(n,e,i){var t=n.split("/"),o=t[t.length-1],a=(e.split("?")[0],abjrsk.getFileInfo(e)),t=abjrsk.getFileNativePath(o);abjrsk.fs.copyFile({srcPath:n,destPath:t,success:function(n){a?a.readyUrl!=e&&abjrsk.remove(o,e,i):(abjrsk.onSaveFile(e,o),null!=i&&i.runWith([0]))},fail:function(n){null!=i&&i.runWith([1,n])}})},abjrsk.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},abjrsk.remove=function(e,i,t){void 0===i&&(i="");var n=abjrsk.getFileInfo(i),o=abjrsk.getFileNativePath(n.md5);a.loader.clearRes(n.readyUrl),abjrsk.fs.unlink({filePath:o,success:function(n){""!=i&&abjrsk.onSaveFile(i,e),null!=t&&t.runWith([0])},fail:function(n){}})},abjrsk.onSaveFile=function(n,e){var i=n.split("?")[0];abjrsk.filesListObj[i]={md5:e,readyUrl:n},abjrsk.fs.writeFile({filePath:abjrsk.fileNativeDir+"/"+abjrsk.fileListName,encoding:"utf8",data:JSON.stringify(abjrsk.filesListObj),success:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",n)},fail:function(n){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",n)}})},abjrsk.existDir=function(n,e){abjrsk.fs.mkdir({dirPath:n,success:function(n){null!=e&&e.runWith([0,{data:JSON.stringify({})}])},fail:function(n){-1!=n.errMsg.indexOf("file already exists")?abjrsk.readSync(abjrsk.fileListName,"utf8",e):null!=e&&e.runWith([1,n])}})},abjrsk.readSync=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var o,e=abjrsk.getFileNativePath(n);try{o=abjrsk.fs.readFileSync(e),null!=i&&i.runWith([0,{data:o}])}catch(n){null!=i&&i.runWith([1])}},abjrsk.readCache=function(){},abjrsk.writeCache=function(n){var e=readyUrl.split("?")[0];abjrsk.filesListObj[e]={md5:md5Name,readyUrl:readyUrl},abjrsk.fs.writeFile({filePath:abjrsk.fileNativeDir+"/"+abjrsk.fileListName,encoding:"utf8",data:JSON.stringify(abjrsk.filesListObj),success:function(n){},fail:function(n){}})},abjrsk.setNativeFileDir=function(n){abjrsk.fileNativeDir=wx.env.USER_DATA_PATH+n},abjrsk.filesListObj={},abjrsk.fileNativeDir=null,abjrsk.fileListName="layaairfiles.txt",abjrsk.ziyuFileData={},n(abjrsk,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),abjrsk),E=(r(f7dzp$,"laya.wx.mini.MiniSound",i),(x=f7dzp$.prototype).load=function(n){var e=this;var i;function od7fz(){if(null!=f7dzp$._null)e._sound.onCanplay(f7dzp$._null),e._sound.onError(f7dzp$._null);else try{e._sound.onCanplay(null),e._sound.onError(null),f7dzp$._null=null}catch(n){console.warn("[wxmini] _clearSound:"+n),e._sound.onCanplay(yw5_),e._sound.onError(yw5_),f7dzp$._null=yw5_}}function yw5_(){}n=g.formatURL(n),this.url=n,f7dzp$._audioCache[n]?this.event("complete"):(this._sound.onCanplay(function(){od7fz(),i.loaded=!0,i.event("complete"),f7dzp$._audioCache[i.url]=i}),this._sound.onError(function(n){console.error("errCode="+n.errCode+"  errMsg="+n.errMsg),od7fz(),i.event("error")}),this._sound.src=n,i=this)},x.play=function(n,e){void 0===n&&(n=0),void 0===e&&(e=0),(i=this.url==m._tMusic?(f7dzp$._musicAudio||(f7dzp$._musicAudio=f7dzp$._createSound()),f7dzp$._musicAudio):f7dzp$._createSound()).src=this.url;var i=new _(i);return i.url=this.url,i.loops=e,i.startTime=n,i.play(),m.addChannel(i),i},x.dispose=function(){var n=f7dzp$._audioCache[this.url];n&&(n.src="",delete f7dzp$._audioCache[this.url])},e(0,x,"duration",function(){return this._sound.duration}),f7dzp$._createSound=function(){return f7dzp$._id++,d.window.wx.createInnerAudioContext()},f7dzp$._musicAudio=null,f7dzp$._id=0,f7dzp$._audioCache={},f7dzp$._null=void 0,f7dzp$),_=(r(jrna,"laya.wx.mini.MiniSoundChannel",p),(n=jrna.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},n.__onNull=function(){},n.play=function(){this.isStopped=!1,m.addChannel(this),this._audio&&this._audio.play()},n.stop=function(){if(this.isStopped=!0,m.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=jrna._null)this._audio.onEnded(jrna._null);else try{this._audio.onEnded(null),jrna._null=null}catch(n){console.warn("[wxmini] stop:"+n),this._audio.onEnded(b.bind(this.__onNull,this)),jrna._null=b.bind(this.__onNull,this)}this._audio=null}},n.pause=function(){this.isStopped=!0,this._audio.pause()},n.resume=function(){this._audio&&(this.isStopped=!1,m.addChannel(this),this._audio.play())},e(0,n,"position",function(){return this._audio?this._audio.currentTime:0}),e(0,n,"duration",function(){return this._audio?this._audio.duration:0}),e(0,n,"volume",function(){return 1},function(n){}),jrna._null=void 0,jrna),w=(r(grbnja,"laya.wx.mini.MiniVideo"),(i=grbnja.prototype).on=function(n,e,i){"loadedmetadata"==n?(this.onPlayFunc=i.bind(e),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=i.bind(e),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},i.onTimeUpdateFunc=function(n){this.position=n.position,this._duration=n.duration},i.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====\u89c6\u9891\u52a0\u8f7d\u5b8c\u6210========"),null!=this.onPlayFunc&&this.onPlayFunc()},i.onended=function(n,e){this.onEndedFunC=e.bind(n),this.videoElement.onended=this.onEndedFunction.bind(this)},i.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====\u89c6\u9891\u64ad\u653e\u5b8c\u6bd5========"),null!=this.onEndedFunC&&this.onEndedFunC())},i.off=function(n,e,i){"loadedmetadata"==n?(this.onPlayFunc=i.bind(e),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==n&&(this.onEndedFunC=i.bind(e),this.videoElement.offEnded=this.onEndedFunction.bind(this))},i.load=function(n){this.videoElement&&(this.videoElement.src=n)},i.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},i.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},i.size=function(n,e){this.videoElement&&(this.videoElement.width=n,this.videoElement.height=e)},i.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},i.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},e(0,i,"duration",function(){return this._duration}),e(0,i,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(n){this.videoElement&&(this.videoElement.initialTime=n)}),e(0,i,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),e(0,i,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),e(0,i,"ended",function(){return this.videoend}),e(0,i,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(n){this.videoElement&&(this.videoElement.loop=n)}),e(0,i,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(n){this.videoElement&&(this.videoElement.playbackRate=n)}),e(0,i,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(n){this.videoElement&&(this.videoElement.muted=n)}),e(0,i,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),e(0,i,"x",function(){return this.videoElement?this.videoElement.x:0},function(n){this.videoElement&&(this.videoElement.x=n)}),e(0,i,"y",function(){return this.videoElement?this.videoElement.y:0},function(n){this.videoElement&&(this.videoElement.y=n)}),e(0,i,"currentSrc",function(){return this.videoElement.src}),e(0,i,"src",function(){return this.videoElement?this.videoElement.src:0},function(n){this.videoElement&&(this.videoElement.src=n)}),e(0,i,"controls",function(){if(this.videoElement)return this.videoElement.controls},function(n){this.videoElement&&(this.videoElement.controls=n)}),e(0,i,"autoplay",function(){if(this.videoElement)return this.videoElement.autoplay},function(n){this.videoElement&&(this.videoElement.autoplay=n)}),grbnja);function grbnja(){this.videoend=!1,this.videourl="",this.videoElement=d.window.wx.createVideo({showCenterPlayBtn:!1,showProgressInControlMode:!1,objectFit:"fill"})}function jrna(n){this._audio=null,this._onEnd=null,jrna.__super.call(this),this._audio=n,this._onEnd=b.bind(this.__onEnd,this),n.onEnded(this._onEnd)}function f7dzp$(){this._sound=null,this.url=null,this.loaded=!1,f7dzp$.__super.call(this),this._sound=f7dzp$._createSound()}function abjrsk(){abjrsk.__super.call(this)}function e7oq0x(){}var x;function sjarb(){}function vd9ic$(){}function kragb(){}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var t=Laya[i];t&&t.__isclass&&(e[i]=t)}});