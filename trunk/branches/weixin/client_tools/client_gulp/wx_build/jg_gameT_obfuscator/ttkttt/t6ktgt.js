var M=wx.$T;import Dall from"./ttsstt";var config={game_id:M[1768],game_pkg:M[1769],partner_id:"19",game_ver:M[1770],is_auth:!1,from:null,tmpId:{1:M[1771],2:M[1772],3:M[1773]},min_app_id:""};window.config=config;var t_FZKM6=t_FK6MZ();var HOST=M[1774];var t;var t_second=0;var t_max=300;var t_FZK6M=null;var t_FKM6Z=null;var t_FKMZ6=null;var checkHandler=null;var loginHandler=null;var requestCallback=!1;var ad_info=null;function t_FK6MZ(){var i={};return{order_data:{},init:function(e,t){e=e&&e.game_ver?e.game_ver:0;console.log(M[1775]);var o=this;var n=wx.getStorageSync("plat_uuid");var a;a=n?0:(n=o.uuid(16,32),wx.setStorageSync("plat_uuid",n),1),wx.getStorageSync("plat_idfv")||(r=o.uuid(16,32),wx.setStorageSync("plat_idfv",r));var r=wx.getLaunchOptionsSync();var i=r.scene||"";console.log(M[1776]),console.log(r),a&&r.query&&r.query.ad_code&&wx.setStorageSync("plat_ad_code",r.query.ad_code),r.query&&r.query.from&&""!=r.query.from?(a&&wx.setStorageSync("plat_from",r.query.from),config.from=r.query.from):(s=wx.getStorageSync("plat_from"))||""==s||(config.from=s),console.log(M[1777]+config.from),o.log(M[1778],{install:a,scene:i}),wx.showShareMenu();var s=r.query&&r.query.invite?r.query.invite:"";o=r.query&&r.query.invite_type?r.query.invite_type:"";s&&(t_FKM6Z={invite:s,invite_type:o,is_new:a,scene:i}),e&&this.checkGameVersion(e,function(e){t&&t(e)}),ad_info={temp_info:r,temp_uuid:n,temp_is_new:a}},adLog:function(e){var t=ad_info.temp_info;var o=ad_info.temp_is_new;var n=ad_info.temp_uuid;t.query.hasOwnProperty(M[1779])&&t.query.hasOwnProperty(M[1780])&&o&&((o=t.query)[M[1781]]=n,o[M[1782]]=e,t=M[1783]+this.convertObj(o),console.log(M[1784]+t),wx.request({url:t}))},convertObj:function(e){var t=[];for(var o in e){var n=e[o];n.constructor==Array?n.forEach(function(e){t.push(o+"="+e)}):t.push(o+"="+n)}return t.join("&")},login:function(e,t){console.log(M[1785]);var o=this;i[M[1162]]=typeof t==M[130]?t:null,config.is_auth?wx.getSetting({success:function(e){var t;e.authSetting[M[1786]]?(console.log(M[1787]),o.do_login()):(console.log(M[1788]),wx.hideLoading({}),(e=wx.getSystemInfoSync()).screenWidth,e.screenHeight,(t=wx.createUserInfoButton({type:M[1291],text:M[1789],withCredentials:!1,style:{top:e.windowHeight/2+e.windowHeight/4,left:e.windowWidth/2-100,width:200,height:40,lineHeight:40,backgroundColor:M[1790],color:M[1453],textAlign:M[1410],fontSize:16,borderRadius:4}})).show(),t.onTap(e=>{console.log(e),t_MZ6K({title:M[1791]}),e.errMsg==M[1792]?o.do_login({head_img:e.userInfo.avatarUrl||"",nick_name:e.userInfo.nickName||""}):o.do_login(),t.destroy()}))},fail:function(){console.log(M[1793]),o.do_login()}}):(console.log(M[1794]+config.is_auth),o.do_login())},do_login:function(o){var r=this;wx.login({success:function(e){if(console.log(M[1795]+JSON.stringify(e)),e.code){var n=r.getPublicData();if(n[M[1796]]=1,n[M[1797]]=e.code,n[M[1798]]=o?o.nick_name:"",n[M[1799]]=o?o.head_img:"",t_FKM6Z&&typeof t_FKM6Z==M[13])for(var t in t_FKM6Z)n[t]=t_FKM6Z[t];var a;config.is_auth?wx.getUserInfo({success:function(e){var t=e.encryptedData;var o=e.iv;e=e.signature;n[M[1800]]=t,n.iv=o,n[M[1801]]=e,wx.request({url:M[1802]+HOST+M[1803],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:n,success:function(e){if(console.log(M[1804]),console.log(e),200==e.statusCode){e=e.data;if(e.state){var t={userid:e.data.user_id,account:e.data.nick_name,token:e.data.token,invite_uid:e.data.invite_uid||"",invite_nickname:e.data.invite_nickname||"",invite_head_img:e.data.invite_head_img||"",head_img:e.data.head_img||"",is_client:e.data.is_client||"0",ios_pay:e.data.ios_pay||"0"};try{r.adLog(e.data.openid)}catch(e){console.log(M[1805]+JSON.stringify(e))}try{wx.setStorageSync("plat_sdk_token",e.data.sdk_token),wx.setStorageSync("plat_uid",e.data.user_id),wx.setStorageSync("plat_username",e.data.username),e.data.ext&&wx.setStorageSync("plat_session_key",e.data.ext)}catch(e){}i[M[1162]]&&i[M[1162]](0,t)}else i[M[1162]]&&i[M[1162]](1,{errMsg:e.msg});r.getShareInfo(M[1806],function(e){console.log(M[1807]),wx.onShareAppMessage(function(){return r.logStartShare(M[1806]),{title:e.title,imageUrl:e.img,query:e.query}})})}else i[M[1162]]&&i[M[1162]](1,{errMsg:M[1808]})},fail:function(e){i[M[1162]]&&i[M[1162]](1,{errMsg:e.errMsg})}})},fail:function(e){i[M[1162]]&&i[M[1162]](1,{errMsg:e.errMsg})}}):(a=Date.now(),wx.request({url:M[1802]+HOST+M[1803],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:n,success:function(e){if(console.log(M[1804]),console.log(e),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,200==e.statusCode){var t=e.data;if(t.state){var o={userid:t.data.user_id,account:t.data.nick_name,token:t.data.token,invite_uid:t.data.invite_uid||"",invite_nickname:t.data.invite_nickname||"",invite_head_img:t.data.invite_head_img||"",head_img:t.data.head_img||"",is_client:t.data.is_client||"0",ios_pay:t.data.ios_pay||"0"};try{r.adLog(t.data.openid)}catch(e){console.log(M[1805]+JSON.stringify(e))}try{wx.setStorageSync("plat_sdk_token",t.data.sdk_token),wx.setStorageSync("plat_uid",t.data.user_id),wx.setStorageSync("plat_username",t.data.username),t.data.ext&&wx.setStorageSync("plat_session_key",t.data.ext)}catch(e){}i[M[1162]]&&i[M[1162]](0,o)}else i[M[1162]]&&i[M[1162]](1,{type:M[1809],errMsg:t.msg,time:Date.now()-a,res:e});r.getShareInfo(M[1806],function(e){console.log(M[1807]),wx.onShareAppMessage(function(){return r.logStartShare(M[1806]),{title:e.title,imageUrl:e.img,query:e.query}})})}else i[M[1162]]&&i[M[1162]](1,{type:M[1809],errMsg:M[1808],time:Date.now()-a,res:e})},fail:function(e){console.log(M[1810]),console.log(e),r.log(M[1541],{event:M[1811]}),requestCallback=!0,loginHandler&&clearTimeout(loginHandler),loginHandler=null,i[M[1162]]&&i[M[1162]](1,{type:M[1812],errMsg:e.errMsg,time:Date.now()-a,res:e})}}),requestCallback||(loginHandler=setTimeout(function(){console.log(M[1813]),r.log(M[1541],{event:M[1814]}),i[M[1162]]&&i[M[1162]](1,{type:M[1815],errMsg:M[1816],time:Date.now()-a}),i[M[1162]]=null},2e4)))}else i[M[1162]]&&i[M[1162]](1,{type:M[1817],errMsg:e.errMsg,res:e})},fail:function(e){console.log(M[1818]+JSON.stringify(e)),-1<e.errMsg.indexOf(M[1819])||e.errMsg.indexOf(M[1820]),i[M[1162]]&&i[M[1162]](1,{type:M[1821],errMsg:e.errMsg,res:e})}})},share:function(e){i[M[1261]]=typeof callback==M[130]?callback:null;var t=e.type||M[1261];console.log(M[1822]+t);var o=this;this.getShareInfo(t,function(e){o.logStartShare(t),wx.shareAppMessage({title:e.title,imageUrl:e.img,query:e.query})})},logStartShare:function(e){var t=wx.getStorageSync("plat_sdk_token");wx.request({url:M[1802]+HOST+M[1823],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:t,server_id:t_FZK6M?t_FZK6M.server_id:"",role_id:t_FZK6M?t_FZK6M.role_id:"",type:e},success:function(e){}})},openService:function(){wx.openCustomerServiceConversation()},checkGameVersion:function(e,t){console.log(M[1824]),i[M[1825]]=typeof t==M[130]?t:null;wx.getStorageSync("plat_sdk_token");wx.request({url:M[1802]+HOST+M[1826],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,game_ver:e},success:function(e){console.log(M[1827]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,200==e.statusCode?(e=e.data,config.min_app_id=e.data.min_app_id,e.state?i[M[1825]]&&i[M[1825]](e.data):i[M[1825]]&&i[M[1825]]({develop:0})):i[M[1825]]&&i[M[1825]]({develop:0})},fail:function(e){console.log(M[1828]),console.log(e),requestCallback=!0,checkHandler&&clearTimeout(checkHandler),checkHandler=null,i[M[1825]]&&i[M[1825]]({develop:0})}}),requestCallback||(checkHandler=setTimeout(function(){console.log(M[1829]),i[M[1825]]&&i[M[1825]]({develop:0}),i[M[1825]]=null},1e4))},getShareInfo:function(e,t){console.log(M[1830]);var o=wx.getStorageSync("plat_sdk_token");wx.request({url:M[1802]+HOST+M[1831],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:o,type:e,server_id:t_FZK6M?t_FZK6M.server_id:"",role_id:t_FZK6M?t_FZK6M.role_id:"",no_log:1},success:function(e){console.log(M[1832]),console.log(e),200==e.statusCode?(e=e.data).state?t&&t(e.data):i[M[1261]]&&i[M[1261]](1,{errMsg:M[1833]+e.msg}):i[M[1261]]&&i[M[1261]](1,{errMsg:M[1834]})}})},updateShare:function(e,t,o,n,a,r){console.log(M[1835]);var i=wx.getStorageSync("plat_sdk_token");wx.request({url:M[1802]+HOST+M[1836],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:i,invite:e,invite_type:t,is_new:o,role_id:n,sever_id:a,scene:r},success:function(e){console.log(M[1837]),console.log(e)}})},msgCheck:function(e,t){console.log(M[1838]);var o=wx.getStorageSync("plat_sdk_token");wx.request({url:M[1802]+HOST+M[1839],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{game_pkg:config.game_pkg,partner_id:config.partner_id,sdk_token:o,content:e},success:function(e){console.log(M[1840]),console.log(e),t&&t(e)}})},pay:function(e,t){var o=this;wx.checkSession({success:function(){o.startPay(e,t)},fail:function(){console.log(M[1841]),o.login({},function(){o.startPay(e,t)})}})},startPay:function(e,t){console.log(M[1842]),console.log(e);var o=this;i[M[1243]]=typeof t==M[130]?t:null;t=wx.getStorageSync("plat_sdk_token");var n=wx.getStorageSync("plat_session_key");var a;t&&n?(a=wx.getSystemInfoSync(),e={cpbill:e.cpbill,productid:e.productid,productname:e.productname,productdesc:e.productdesc,serverid:e.serverid,servername:e.servername,roleid:e.roleid,rolename:e.rolename,rolelevel:e.rolelevel,price:e.price,extension:e.extension,sdk_token:t,session_key:n,platform:a.platform},o.order_data=e,(t=o.getPublicData())[M[1844]]=JSON.stringify(e),t[M[1796]]=1,wx.request({url:M[1802]+HOST+M[1845],method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:t,success:function(e){console.log(M[1846]),console.log(e),200==e.statusCode?(e=e.data).state?typeof wx.requestPayment==M[9]?a.platform==M[1023]||a.platform==M[1026]?e.data.is_android_pay?1==e.data.ios_pay_type?o.kfPay(e.data):2==e.data.ios_pay_type&&o.xiaoPay(e.data):o.gamePay(e.data):e.data.is_ios_pay?1==e.data.ios_pay_type?o.kfPay(e.data):2==e.data.ios_pay_type&&o.xiaoPay(e.data):wx.showModal({title:M[1847],content:M[1848],confirmText:M[1849],showCancel:!1}):o.minPay(e.data):i[M[1243]]&&i[M[1243]](1,{errMsg:e.msg}):i[M[1243]]&&i[M[1243]](1,{errMsg:M[1808]})}})):i[M[1243]]&&i[M[1243]](1,{errMsg:M[1843]})},xiaoPay:function(e){wx.navigateToMiniProgram({appId:config.min_app_id,path:M[1850]+e.orderId+M[1851]+e.money,extraData:{},envVersion:M[1852],success(e){}})},minPay:function(t){var o=this;wx.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(e){e.errMsg==M[1853]&&(e={cpOrderNo:o.order_data.cpbill,orderNo:t.orderId,amount:o.order_data.price,extension:o.order_data.extension},i[M[1243]]&&i[M[1243]](0,e))},fail:function(e){e.errMsg==M[1854]?i[M[1243]]&&i[M[1243]](2,{errMsg:M[1855]}):i[M[1243]]&&i[M[1243]](1,{errMsg:M[1856]+e.err_desc})},complete:function(e){}})},gamePay:function(t){var o=this;t.buyQuantity<=t.balance?(console.log(M[1857]),wx.showModal({title:M[1847],content:M[1858]+t.balance+M[1859]+t.buyQuantity+M[1860],showCancel:!1,confirmText:M[1849],success:function(){o.gameGoPay(t)}})):(console.log(M[1861]),wx.requestMidasPayment({mode:M[1862],env:t.env,offerId:t.offerId,currencyType:t.currencyType,platform:t.platform,buyQuantity:t.buyQuantity,zoneId:t.zoneId,success:function(e){e.errMsg==M[1863]&&o.gameGoPay(t)},fail:function(e){-1!==e.errMsg.indexOf(M[1864])?i[M[1243]]&&i[M[1243]](2,{errMsg:M[1855]}):i[M[1243]]&&i[M[1243]](1,{errMsg:M[1856]+e.errMsg})},complete:function(e){}}))},kfPay:function(e){t_FKMZ6=e.orderId,wx.showModal({title:M[1847],content:M[1865],showCancel:!1,confirmText:M[1849],success:function(){var e={showMessageCard:!0,sendMessageTitle:M[1866],sendMessageImg:M[1867]};wx.openCustomerServiceConversation(e)}})},gameGoPay:function(t,e){console.log(M[1868]);var o=this;var n=wx.getStorageSync("plat_session_key");wx.request({url:M[1802]+HOST+M[1869]+config.partner_id+"/"+config.game_pkg+"/",method:M[1132],dataType:M[393],header:{"content-type":M[1299]},data:{order_id:t.orderId,time:t.time,sign:t.sign,session_key:n},success:function(e){console.log(M[1870]),console.log(e),200==e.statusCode&&(1==e.data.state?(e={cpOrderNo:o.order_data.cpbill,orderNo:t.orderId,amount:o.order_data.price,extension:o.order_data.extension},i[M[1243]]&&i[M[1243]](0,e)):i[M[1243]]&&i[M[1243]](1,{errMsg:M[1871]}))},fail:function(){}})},logCreateRole:function(e){var t=wx.getStorageSync("plat_uid");var o=wx.getStorageSync("plat_username");var n={};n[M[1872]]=t,n[M[1873]]=o,n[M[1874]]=e.roleid,n[M[1875]]=e.rolelevel,n[M[1876]]=e.rolename,n[M[943]]=e.serverid,e.roleid&&e.serverid&&(t_FZK6M={role_id:e.roleid,server_id:e.serverid}),this.log(M[14],n)},logEnterGame:function(e){var t=wx.getStorageSync("plat_uid");var o=wx.getStorageSync("plat_username");var n={};n[M[1872]]=t,n[M[1873]]=o,n[M[1874]]=e.roleid,n[M[1875]]=e.rolelevel,n[M[1876]]=e.rolename,n[M[943]]=e.serverid,e.roleid&&e.serverid&&(t_FZK6M={role_id:e.roleid,server_id:e.serverid}),this.log(M[1877],n),t_FKM6Z&&this.updateShare(t_FKM6Z.invite,t_FKM6Z.invite_type,t_FKM6Z.is_new,e.roleid,e.serverid,t_FKM6Z.scene)},logRoleUpLevel:function(e){var t=wx.getStorageSync("plat_uid");var o=wx.getStorageSync("plat_username");var n={};n[M[1872]]=t,n[M[1873]]=o,n[M[1874]]=e.roleid,n[M[1875]]=e.rolelevel,n[M[1876]]=e.rolename,n[M[943]]=e.serverid,e.roleid&&e.serverid&&(t_FZK6M={role_id:e.roleid,server_id:e.serverid}),this.log(M[1878],n)},uuid:function(e,t){var o=M[1879].split("");var n,a=[];var r;if(e=e||o.length,t)for(n=0;n<t;n++)a[n]=o[0|Math.random()*e];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",n=0;n<36;n++)a[n]||(r=0|16*Math.random(),a[n]=o[19==n?3&r|8:r]);return a.join("")},getPublicData:function(){var e=wx.getSystemInfoSync();var t=wx.getStorageSync("plat_uuid");var o=wx.getStorageSync("plat_idfv");var n=wx.getStorageSync("plat_ad_code");return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id,ad_code:n,uuid:t,idfv:o,dname:e.model,mac:M[1880],net_type:0==e.wifiSignal?"4G":M[1881],os_ver:e.system,sdk_ver:e.version,game_ver:config.game_ver,device:e.platform==M[1023]?1:2}},subscribeWhatsNew:function(e,t){wx.requestSubscribeWhatsNew({msgType:1,success(e){console.log(e),t(e.confirm)},fail(e){console.error(e),t(!1)}})},subscriptionsSetting:function(e,t){wx.getWhatsNewSubscriptionsSetting({msgType:1,success(e){console.log(e),t(e.status)},fail(e){console.error(e),t(0)}})},log:function(e,t){var o=this.getPublicData();for(var n in t)o[n]=t[n];console.log(M[1882]+e),console.log(o),wx.request({url:M[1802]+HOST+M[1883]+e+M[1884]+encodeURIComponent(JSON.stringify(o)),success:function(e){},fail:function(e){}})},getDate:function(){var e=new Date;return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},downloadClient:function(){wx.openCustomerServiceConversation()},subscribeMessage:function(e,t){console.log(M[1885]+e),i[M[1271]]=typeof t==M[130]?t:null,wx.requestSubscribeMessage({tmplIds:e,success(e){console.log(M[1886]),console.log(e),i[M[1271]]&&i[M[1271]](e)},fail(e){console.log(M[1887]),console.log(e),i[M[1271]]&&i[M[1271]](e)}})},weiduanHelper:function(){(new Dall).stebutonanimation(config.partner_id,config.game_pkg,config.game_id)}}}function run(e,t,o){e in t_FZKM6&&t_FZKM6[e](t,o)}exports.init=function(e,t){run(M[1143],e,t)},exports.login=function(e){run(M[1162],"",e)},exports.pay=function(e,t){run(M[1243],e,t)},exports.openService=function(){run(M[1262])},exports.logCreateRole=function(e,t,o,n,a){run(M[1256],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:a})},exports.logEnterGame=function(e,t,o,n,a){run(M[1258],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:a})},exports.logRoleUpLevel=function(e,t,o,n,a){run(M[1260],{serverid:e,servername:t,roleid:o,rolename:n,rolelevel:a})},exports.share=function(e){run(M[1261],{type:e})},exports.msgCheck=function(e,t){run(M[1111],e,t)},exports.downloadClient=function(){run(M[1888])},exports.subscribeMessage=function(e,t){run(M[1271],e,t)},exports.getConfig=function(){return{game_id:config.game_id,game_pkg:config.game_pkg,partner_id:config.partner_id}},exports.getPublicData=function(){run(M[1889])},exports.weiduanHelper=function(){run(M[1264])},exports.subscribeWhatsNew=function(e,t){run(M[1224],e,t)},exports.subscriptionsSetting=function(e,t){run(M[1277],e,t)};