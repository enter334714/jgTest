var P=wx.$y;var config_form_onefive={sdkVersion:"1.0.0",url:"https://minigame.15yx.com/",channel:0,appID:1000134,urlParam:"",switch:1,platform:3,shareInfo:{}};const requestFunction=o=>(console.log(config_form_onefive.url+o.path),new Promise((a,n)=>{wx.request({url:config_form_onefive.url+o.path,data:JSON.stringify(o.data),method:"POST",dataType:"json",success:function(e){a(e)},fail:function(e){console.log("[SDK]"+o.path+"\u53d1\u8d77\u8bf7\u6c42\u5931\u8d25"),n(e)}})}));var callbacks_from_onefive={};class ONEFIVE{constructor(){config_form_onefive.urlParam=config_form_onefive.appID}init(e,a){var n=this;console.log("[SDK]\u8c03\u7528init\u521d\u59cb\u5316\u63a5\u53e3");var o=n.getLaunchOptionsAndSystem();console.log(o),wx.getStorageSync("minigame_allInfo")||wx.setStorageSync("minigame_allInfo",JSON.stringify(o)),config_form_onefive.allInfoCache=JSON.parse(wx.getStorageSync("minigame_allInfo")),callbacks_from_onefive.init="function"==typeof a?a:null,n.getShareConfig(),wx.showShareMenu({withShareTicket:!0}),wx.getStorageSync("minigame_sdk_thd")||wx.login({success:function(e){e={path:"channel/login/openid/"+config_form_onefive.urlParam,data:{code:e.code,allInfoCache:config_form_onefive.allInfoCache,allInfo:o,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};requestFunction(e).then(e=>{1==e.data.code?(console.info("[SDK]\u670d\u52a1\u7aef\u83b7\u53d6\u5fae\u4fe1\u4fe1\u606f\u6210\u529f\uff1a"+JSON.stringify(e.data)),wx.setStorageSync("minigame_sdk_thd",e.data.data.thd),wx.setStorageSync("minigame_sdk_thdu",e.data.data.thdu)):(console.error("[SDK]\u670d\u52a1\u7aef\u83b7\u53d6\u5fae\u4fe1\u4fe1\u606f\u5931\u8d25\uff1a"+JSON.stringify(e.data)),callbacks_from_onefive.init&&callbacks_from_onefive.init(0,{msg:"\u521d\u59cb\u5316\u5931\u8d25\uff0c\u83b7\u53d6\u5fae\u4fe1\u4fe1\u606f\u5931\u8d25"}))}).catch(e=>{console.error("[SDK]\u670d\u52a1\u7aef\u83b7\u53d6\u5fae\u4fe1\u4fe1\u606f\u5f02\u5e38\uff1a"+JSON.stringify(e.data))})},fail:function(e){console.error("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25\uff0c\u8fd4\u56de"+JSON.stringify(e)),(-1<e.errMsg.indexOf("auth deny")||-1<e.errMsg.indexOf("auth denied"))&&callbacks_from_onefive.init&&callbacks_from_onefive.init(0,{msg:e.msg}),console.error("[SDK]\u83b7\u53d6\u5fae\u4fe1\u7528\u6237\u6388\u6743\u5931\u8d25")}});a=Date.parse(new Date)/1e3;wx.setStorageSync("minigame_enter_time",a),wx.onShow(function(e){var a=Date.parse(new Date)/1e3;wx.setStorageSync("minigame_enter_time",a)}),wx.onHide(function(e){wx.setStorageSync("minigame_left_time",0),wx.setStorageSync("minigame_left_time",Date.parse(new Date)/1e3),n.recordLog()}),callbacks_from_onefive.init&&callbacks_from_onefive.init(1,{})}login(e){console.log("[SDK]\u8c03\u8d77\u767b\u5f55");var n=this;callbacks_from_onefive.login="function"==typeof e?e:null,wx.login({success:function(e){var a=n.getLaunchOptionsAndSystem();e={path:"channel/login/"+config_form_onefive.urlParam,data:{code:e.code,channel:a.LaunchOptions.query.channel||config_form_onefive.channel,scene:a.LaunchOptions.scene,brand:a.wxSystemInfo.brand,model:a.wxSystemInfo.model,osVersion:a.wxSystemInfo.system,isWifi:a.wxSystemInfo.wifiEnabled,os:a.wxSystemInfo.platform,sdkVersion:config_form_onefive.sdkVersion,allInfoCache:config_form_onefive.allInfoCache,allInfo:a,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};requestFunction(e).then(e=>{1==e.data.code?(console.info("[SDK]\u767b\u5f55\u6210\u529f\uff1a"+JSON.stringify(e.data)),wx.setStorageSync("minigame_sdk_token",e.data.data.sid),wx.setStorageSync("minigame_sdk_userId",e.data.data.sdkUserID),wx.setStorageSync("minigame_sdk_account",e.data.data.sdkUserName),wx.setStorageSync("minigame_sdk_thd",e.data.data.thd),wx.setStorageSync("minigame_sdk_thdu",e.data.data.thdu),wx.setStorageSync("minigame_token",e.data.data.token),wx.setStorageSync("minigame_userId",e.data.data.userID),e.data.data.extension&&wx.setStorageSync("minigame_userInfo_extension",e.data.data.extension),callbacks_from_onefive.login&&callbacks_from_onefive.login(1,{userId:e.data.data.userID,token:e.data.data.token})):(console.error("[SDK]\u767b\u5f55\u5931\u8d25\uff1a"+JSON.stringify(e.data)),callbacks_from_onefive.login&&callbacks_from_onefive.login(0,{msg:e.data.msg}))})},fail:function(e){console.log("\u5fae\u4fe1\u767b\u5f55\u5931\u8d25\uff0c\u8fd4\u56de"+JSON.stringify(e)),(-1<e.errMsg.indexOf("auth deny")||-1<e.errMsg.indexOf("auth denied"))&&callbacks_from_onefive.login&&callbacks_from_onefive.login(0,{msg:e.errMsg}),console.error("[SDK]\u83b7\u53d6\u5fae\u4fe1\u7528\u6237\u6388\u6743\u5931\u8d25")}})}roleLog(a){console.info("[SDK]\u8c03\u7528\u89d2\u8272\u4fe1\u606f\u63a5\u53e3");var n=this;wx.checkSession({success:function(){n.postRole(a)},fail:function(){console.info("[SDK]\u8c03\u7528\u89d2\u8272\u4fe1\u606f\u63a5\u53e3session\u8fc7\u671f\u9700\u8981\u91cd\u65b0\u767b\u5f55"),n.login(function(e){1==e&&n.postRole(a)})}})}postRole(a){console.log("[SDK]\u8c03\u7528\u89d2\u8272\u4e0a\u4f20"+JSON.stringify(a));var n=this;var e=n.getLaunchOptionsAndSystem();e={token:wx.getStorageSync("minigame_token"),sid:wx.getStorageSync("minigame_sdk_token"),userID:wx.getStorageSync("minigame_userId"),uid:wx.getStorageSync("minigame_sdk_userId"),userAcount:wx.getStorageSync("minigame_sdk_account"),thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),roleID:a.roleId,roleName:a.roleName,roleLevel:a.roleLevel,dataType:a.dataType,serverID:a.serverId,serverName:a.serverName,payLevel:a.payLevel,roleCreateTime:a.createTime,brand:e.wxSystemInfo.brand,model:e.wxSystemInfo.model,osVersion:e.wxSystemInfo.system,isWifi:e.wxSystemInfo.wifiEnabled,os:e.wxSystemInfo.platform,sdkVersion:config_form_onefive.sdkVersion,platform:config_form_onefive.platform};(n.sdk_user_game_info=e).token&&e.userID||(console.error("\u7528\u6237\u4fe1\u606f\u8fc7\u671f\u5bfc\u81f4\u7528\u6237\u8c03\u8d77\u89d2\u8272\u4fe1\u606f\u63a5\u53e3\u5931\u8d25"),n.login(function(e){1==e&&n.postRole(a)}));e={path:"channel/role/"+config_form_onefive.urlParam,data:e};requestFunction(e).then(e=>{console.log(e)})}userShare(e,a){var n=this.getLaunchOptionsAndSystem();console.log("[SDK]CP\u8c03\u7528\u5206\u4eab"+JSON.stringify(e)),callbacks_from_onefive.share="function"==typeof a?a:null;e={path:"channel/util/share/"+config_form_onefive.urlParam,data:{userID:wx.getStorageSync("minigame_userId"),uid:wx.getStorageSync("minigame_sdk_userId"),token:wx.getStorageSync("minigame_token"),sid:wx.getStorageSync("minigame_sdk_token"),thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),channel:n.LaunchOptions.query.channel,type:"diybtn",brand:n.wxSystemInfo.brand,model:n.wxSystemInfo.model,osVersion:n.wxSystemInfo.system,isWifi:n.wxSystemInfo.wifiEnabled,os:n.wxSystemInfo.platform,version:n.wxSystemInfo.version,sdkVersion:config_form_onefive.sdkVersion,allInfoCache:config_form_onefive.allInfoCache,allInfo:n,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};Object.assign(e.data,this.sdk_user_game_info),requestFunction(e).then(e=>{1==e.data.code?callbacks_from_onefive.share&&callbacks_from_onefive.share(1,{title:e.data.data.title,imageUrl:e.data.data.imageUrl,imageUrlId:e.data.data.imageUrlId,query:e.data.data.query}):callbacks_from_onefive.share&&callbacks_from_onefive.share(0,{msg:e.data.msg})})}appShare(e){console.log("[SDK]\u53f3\u4e0a\u89d2\u4e3b\u52a8\u5206\u4eab\u4e0a\u62a5");var a=this;var n=a.getLaunchOptionsAndSystem();callbacks_from_onefive.appShare="function"==typeof e?e:null;e={path:"channel/util/share/"+config_form_onefive.urlParam,data:{type:"right",thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),channel:n.LaunchOptions.query.channel,brand:n.wxSystemInfo.brand,model:n.wxSystemInfo.model,osVersion:n.wxSystemInfo.system,isWifi:n.wxSystemInfo.wifiEnabled,os:n.wxSystemInfo.platform,version:n.wxSystemInfo.version,sdkVersion:config_form_onefive.sdkVersion,allInfoCache:config_form_onefive.allInfoCache,allInfo:n,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};null!=a.sdk_user_game_info&&(e.data.roleId=a.sdk_user_game_info.roleID,e.data.roleName=a.sdk_user_game_info.roleName,e.data.roleLevel=a.sdk_user_game_info.roleLevel,e.data.serverID=a.sdk_user_game_info.serverID,e.data.serverName=a.sdk_user_game_info.serverName),requestFunction(e).then(e=>{callbacks_from_onefive.appShare&&callbacks_from_onefive.appShare(1,e.data.data)})}pay(a,n){console.info("[SDK]\u8c03\u7528\u652f\u4ed8\u4e0b\u5355:"+JSON.stringify(a));var o=this;wx.checkSession({success:function(){o.startPay(a,n)},fail:function(){console.log("[SDK]\u652f\u4ed8\u4e0b\u5355\u53d1\u73b0\u7528\u6237session\u8fc7\u671f\u9700\u8981\u91cd\u65b0\u767b\u5f55"),o.login(function(e){1==e&&o.startPay(a,n)})}})}startPay(o,e){var t=this;callbacks_from_onefive.pay="function"==typeof e?e:null;e=this.getLaunchOptionsAndSystem();e={path:"channel/pay/"+config_form_onefive.urlParam,data:{isWifi:e.wxSystemInfo.wifiEnabled,os:e.wxSystemInfo.platform,channel:e.LaunchOptions.query.channel||config_form_onefive.channel,brand:e.wxSystemInfo.brand,model:e.wxSystemInfo.model,osVersion:e.wxSystemInfo.system,token:wx.getStorageSync("minigame_token"),sid:wx.getStorageSync("minigame_sdk_token"),userID:wx.getStorageSync("minigame_userId"),uid:wx.getStorageSync("minigame_sdk_userId"),userAcount:wx.getStorageSync("minigame_sdk_account"),thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),sdkVersion:config_form_onefive.sdkVersion,cpOrder:o.cpOrder,serverId:o.serverId,serverName:o.serverName,productId:o.productId,productName:o.productName,roleId:o.roleId,roleName:o.roleName,roleLevel:o.roleLevel,price:o.price,extension:o.extension,notifyUrl:o.notifyUrl,allInfoCache:config_form_onefive.allInfoCache,allInfo:e,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};requestFunction(e).then(a=>{return console.log(a.data),0==a.data.code?("\u4ee4\u724c\u6821\u9a8c\u5931\u8d25"==a.data.msg?(console.log("[SDK]\u4ee4\u724c\u6821\u9a8c\u5931\u8d25\uff0c\u91cd\u65b0\u767b\u5f55"),t.login(function(e){1==e&&t.startPay(o)})):(t.showTips(a.data.msg),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:a.data.msg})),!1):(n={cpOrder:a.data.data.cpOrder,orderId:a.data.data.orderID,subOrderId:a.data.data.subOrderId,price:a.data.data.price,extension:a.data.data.extension,text:a.data.data.text},1==a.data.data.isSwitch?(a.data.data.sessionFrom?t.showModel().then(e=>{wx.openCustomerServiceConversation({showMessageCard:!0,sendMessageTitle:a.data.data.title,sendMessageImg:a.data.data.img,sessionFrom:JSON.stringify(a.data.data.sessionFrom),success:function(){console.log("[SDK]\u901a\u77e5\u7ed3\u679c"),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(1,n)},fail:function(e){if(console.log(e),-1<e.errMsg.indexOf("fail cancel"))return callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:"\u53d6\u6d88\u5ba2\u670d\u4f1a\u8bdd"}),!1;callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:"\u8c03\u8d77\u5ba2\u670d\u4f1a\u8bdd\u5931\u8d25"})}})}):(t.showTips(a.data.msg),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:"\u53c2\u6570\u4e22\u5931"})),!1):void(a.data.data.buyQuantity<=a.data.data.balance&&0!=a.data.data.buyQuantity&&0!=a.data.data.balance?(console.log("[SDK]\u4f59\u989d\u5145\u8db3\uff0c\u6e38\u620f\u5e01\u76f4\u63a5\u6263\u9664"),wx.showModal({title:"\u652f\u4ed8\u63d0\u793a",content:"\u60a8\u8fd8\u6709"+a.data.data.balance+"\u4e2a\u6e38\u620f\u5e01\u672a\u6d88\u8d39\uff0c\u672c\u6b21\u652f\u4ed8\u5c06\u6263\u9664"+a.data.data.buyQuantity+"\u6e38\u620f\u5e01",showCancel:!1,confirmText:"\u6211\u77e5\u9053\u4e86",success:function(){t.gameGoPay(a.data.data,function(e){console.log("[SDK]\u4f59\u989d\u670d\u52a1\u7aef\u6263\u8d39"+JSON.stringify(e)),t.payCallBak(e)})}})):(console.log(a.data.data),t.MidasPay(a.data.data).then(e=>(console.log("[SDK]\u8c03\u8d77\u7c73\u5927\u5e08\u652f\u4ed8\u7ed3\u679c"+JSON.stringify(e)),"requestMidasPayment:ok"==e.errMsg&&t.gameGoPay(a.data.data,function(e){console.log("[SDK]\u5145\u503c\u540e\u670d\u52a1\u7aef\u6263\u8d39"+JSON.stringify(e)),t.payCallBak(e)}),!1)).catch(e=>{if(console.log("[SDK]\u8c03\u8d77\u7c73\u5927\u5e08\u652f\u4ed8\u7ed3\u679c\u5f02\u5e38"+JSON.stringify(e)),void 0!==e.errMsg&&-1!==e.errMsg.indexOf("\u7528\u6237\u53d6\u6d88"))return t.showTips("\u5df2\u53d6\u6d88\u8d2d\u4e70"),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:"\u7528\u6237\u53d6\u6d88\u652f\u4ed8"}),!1;t.showTips("\u652f\u4ed8\u5931\u8d25"+e.errMsg),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{msg:"\u652f\u4ed8\u5931\u8d25:"+e.errMsg})}))));var n})}MidasPay(e){return new Promise((a,n)=>{wx.requestMidasPayment({mode:"game",env:e.env,offerId:e.offerId,currencyType:e.currencyType,platform:e.platform,buyQuantity:e.buyQuantity,zoneId:e.zoneId,success:function(e){a(e)},fail:function(e){n(e)}})})}gameGoPay(n,o){var t=this;var e=t.getLaunchOptionsAndSystem();e={path:"channel/checkPay/"+config_form_onefive.urlParam,data:{platform:config_form_onefive.platform,os:e.wxSystemInfo.platform,uid:wx.getStorageSync("minigame_sdk_userId"),userAcount:wx.getStorageSync("minigame_sdk_account"),sdkVersion:config_form_onefive.sdkVersion,subOrderId:n.subOrderId,orderID:n.orderID}};requestFunction(e).then(a=>{if(console.log("[SDK]\u7c73\u5927\u5e08\u652f\u4ed8\u7ed3\u679c\uff1a"+JSON.stringify(a)),"\u7528\u6237session\u5df2\u5931\u6548,\u8bf7\u91cd\u65b0\u767b\u5f55"==a.data.msg)return t.login(function(e){1==e&&t.gameGoPay(n,o(a.data))}),!1;o(a.data)})}payCallBak(e){1==e.code?(this.showTips("\u652f\u4ed8\u6210\u529f"),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(1,e.data)):(this.showTips("\u652f\u4ed8\u5931\u8d25"+e.msg),callbacks_from_onefive.pay&&callbacks_from_onefive.pay(0,{errMsg:"\u652f\u4ed8\u5931\u8d25:"+e.msg}))}getLaunchOptionsAndSystem(){return{wxSystemInfo:wx.getSystemInfoSync(),LaunchOptions:wx.getLaunchOptionsSync()}}getPayState(e,a){callbacks_from_onefive.payState="function"==typeof a?a:null;a=this.getLaunchOptionsAndSystem();e={path:"channel/pay/payState/"+config_form_onefive.urlParam,data:{platform:config_form_onefive.platform,sdkVersion:config_form_onefive.sdkVersion,token:wx.getStorageSync("minigame_token"),sid:wx.getStorageSync("minigame_sdk_token"),userID:wx.getStorageSync("minigame_userId"),uid:wx.getStorageSync("minigame_sdk_userId"),userAcount:wx.getStorageSync("minigame_sdk_account"),thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),os:a.wxSystemInfo.platform,cpData:e,allInfoCache:config_form_onefive.allInfoCache,allInfo:a,enterInfo:wx.getEnterOptionsSync()}};requestFunction(e).then(e=>(callbacks_from_onefive.payState&&callbacks_from_onefive.payState(1,e.data.data),!1)).catch(e=>(callbacks_from_onefive.payState&&callbacks_from_onefive.payState(0,e),!1))}recordLog(){console.log("[SDK]\u8bbf\u95ee\u65e5\u5fd7\u4e0a\u62a5");var e=this.getLaunchOptionsAndSystem();e={path:"channel/util/visit/"+config_form_onefive.urlParam,data:{platform:config_form_onefive.platform,enterTime:wx.getStorageSync("minigame_enter_time"),leftTime:wx.getStorageSync("minigame_left_time"),channel:e.LaunchOptions.query.channel,model:e.wxSystemInfo.model,brand:e.wxSystemInfo.brand,system:e.wxSystemInfo.system,scene:e.LaunchOptions.scene,thd:wx.getStorageSync("minigame_sdk_thd"),thdu:wx.getStorageSync("minigame_sdk_thdu"),shareOpenId:e.LaunchOptions.query.onefiveOpenId,shareTime:e.LaunchOptions.query.oneFiveShareTime,shareId:e.LaunchOptions.query.oneFiveShareId,version:e.wxSystemInfo.version,allInfoCache:config_form_onefive.allInfoCache,allInfo:e,enterInfo:wx.getEnterOptionsSync()}};requestFunction(e).then(e=>{1==e.data.code?console.log("[SDK]\u8bbf\u95ee\u8bb0\u5f55\u4e0a\u62a5\u6210\u529f"+JSON.stringify(e.data)):console.log("[SDK]\u8bbf\u95ee\u8bb0\u5f55\u4e0a\u62a5\u5931\u8d25\uff1a"+JSON.stringify(e.data))}).catch(e=>{console.log("[SDK]\u8bbf\u95ee\u8bb0\u5f55\u4e0a\u62a5\u5931\u8d25"+JSON.stringify(e))})}showModel(){return new Promise((a,n)=>{wx.showModal({title:"\u6e29\u99a8\u63d0\u793a",content:"\u8bf7\u8fdb\u5165\u3010\u5ba2\u670d\u4f1a\u8bdd\u3011\u7a97\u53e3\u70b9\u51fb\u53f3\u4e0b\u89d2\u5361\u7247\u83b7\u53d6\u652f\u4ed8\u94fe\u63a5",showCancel:!0,confirmText:"\u524d\u5f80\u5145\u503c",success:function(e){console.log(e),!0===e.confirm?a(e):!0===e.cancel&&n(e)},fail:function(e){n(e)}})})}showTips(e){wx.showModal({title:"\u6e29\u99a8\u63d0\u793a",content:e,showCancel:!1,success:function(e){},fail:function(){}})}getShareConfig(){var e=this.getLaunchOptionsAndSystem();e={path:"channel/util/getShareConfig/"+config_form_onefive.urlParam,data:{allInfoCache:config_form_onefive.allInfoCache,allInfo:e,enterInfo:wx.getEnterOptionsSync(),platform:config_form_onefive.platform}};requestFunction(e).then(e=>{config_form_onefive.shareInfo=e.data.data})}onShareAppMessage(o){var t=this;wx.onShareAppMessage(function(){var e=config_form_onefive.shareInfo;var a=Math.floor(Math.random()*e.title.length);var n=Math.floor(Math.random()*e.imageUrl.length);return t.appShare(),o=o||"",{title:e.title[a],imageUrl:e.imageUrl[n],query:"onefiveOpenId="+wx.getStorageSync("minigame_sdk_thd")+"&"+o}})}}export default ONEFIVE;