var Laya=window.Laya=function($U,$i){var $d={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function($i,$p){return 1==arguments.length?$d.__presubstr.call(this,$i):$d.__presubstr.call(this,$i,0<$p?$p:this.length+$p)},__init:function($i){$i.forEach(function($i){$i.__init$&&$i.__init$()})},__isClass:function($i){return $i&&($i.__isclass||$i==Object||$i==String||$i==Array)},__newvec:function($i,$p){var $F=[];$F.length=$i;for(var $J=0;$J<$i;$J++)$F[$J]=$p;return $F},__extend:function($i,$p){for(var $F in $p)if($p.hasOwnProperty($F)){var $J=Object.getOwnPropertyDescriptor($p,$F),$A=$J.get,$t=$J.set;$A||$t?$A&&$t?Object.defineProperty($i,$F,$J):($A&&Object.defineProperty($i,$F,$A),$t&&Object.defineProperty($i,$F,$t)):$i[$F]=$p[$F]}function $q(){$d.un(this,"constructor",$i)}$q.prototype=$p.prototype,$i.prototype=new $q,$d.un($i.prototype,"__imps",$d.__copy({},$p.prototype.__imps))},__copy:function($i,$p){if(!$p)return null;for(var $F in $i=$i||{},$p)$i[$F]=$p[$F];return $i},__package:function($i,$p){if(!$d.__packages[$i]){$d.__packages[$i]=!0;var $F=$U,$J=$i.split(".");if(1<$J.length)for(var $A=0,$t=$J.length-1;$A<$t;$A++){var $q=$F[$J[$A]];$F=$q||($F[$J[$A]]={})}$F[$J[$J.length-1]]||($F[$J[$J.length-1]]=$p||{})}},__hasOwnProperty:function($i,$p){return $p=$p||this,Object.hasOwnProperty.call($p,$i)||function $i($p,$F){if(Object.hasOwnProperty.call($F.prototype,$p))return!0;var $J=$F.prototype.__super;return null==$J?null:$i($p,$J)}($i,$p.__class)},__typeof:function($i,$p){if(!$i||!$p)return!1;if($p===String)return"string"==typeof $i;if($p===Number)return"number"==typeof $i;if($p.__interface__)$p=$p.__interface__;else if("string"!=typeof $p)return $i instanceof $p;return $i.__imps&&$i.__imps[$p]||$i.__class==$p},__as:function($i,$p){return this.__typeof($i,$p)?$i:null},__int:function($i){return $i?parseInt($i):0},interface:function($i,$p){$d.__package($i,{});var $F=$d.__internals,$J=$F[$i]=$F[$i]||{self:$i};if($p){var $A=$p.split(",");$J.extend=[];for(var $t=0;$t<$A.length;$t++){var $q=$A[$t];$F[$q]=$F[$q]||{self:$q},$J.extend.push($F[$q])}}var $B=$U,$O=$i.split(".");for($t=0;$t<$O.length-1;$t++)$B=$B[$O[$t]];$B[$O[$O.length-1]]={__interface__:$i}},class:function($i,$p,$F,$J){if($F&&$d.__extend($i,$F),$p)if($d.__package($p,$i),$d.__classmap[$p]=$i,0<$p.indexOf(".")){if(0==$p.indexOf("laya.")){var $A=$p.split(".");$J=$J||$A[$A.length-1],$d[$J]&&console.log("Warning!,this class["+$J+"] already exist:",$d[$J]),$d[$J]=$i}}else"Main"==$p?$U.Main=$i:"MainWX"==$p?$U.MainWX=$i:($d[$p]&&console.log("Error!,this class["+$p+"] already exist:",$d[$p]),$d[$p]=$i);var $t=$d.un,$q=$i.prototype;$t($q,"hasOwnProperty",$d.__hasOwnProperty),$t($q,"__class",$i),$t($q,"__super",$F),$t($q,"__className",$p),$t($i,"__super",$F),$t($i,"__className",$p),$t($i,"__isclass",!0),$t($i,"super",function($i){this.__super.call($i)})},imps:function($i,$p){if(!$p)return null;var $A=$i.__imps||$d.un($i,"__imps",{});function $t($i){var $p,$F;if(($p=$d.__internals[$i])&&($A[$i]=!0,$F=$p.extend))for(var $J=0;$J<$F.length;$J++)$t($F[$J].self)}for(var $F in $p)$t($F)},superSet:function($i,$p,$F,$J){var $A=$i.prototype["_$set_"+$F];$A&&$A.call($p,$J)},superGet:function($i,$p,$F){var $J=$i.prototype["_$get_"+$F];return $J?$J.call($p):null},getset:function($i,$p,$F,$J,$A){$i?($J&&($p["_$GET_"+$F]=$J),$A&&($p["_$SET_"+$F]=$A)):($J&&$d.un($p,"_$get_"+$F,$J),$A&&$d.un($p,"_$set_"+$F,$A)),$J&&$A?Object.defineProperty($p,$F,{get:$J,set:$A,enumerable:!1,configurable:!0}):($J&&Object.defineProperty($p,$F,{get:$J,enumerable:!1,configurable:!0}),$A&&Object.defineProperty($p,$F,{set:$A,enumerable:!1,configurable:!0}))},static:function($F,$J){for(var $A=0,$i=$J.length;$A<$i;$A+=2)if("length"==$J[$A])$F.length=$J[$A+1].call($F);else{function $p(){var $p=$J[$A],$i=$J[$A+1];Object.defineProperty($F,$p,{get:function(){return delete this[$p],this[$p]=$i.call(this)},set:function($i){delete this[$p],this[$p]=$i},enumerable:!0,configurable:!0})}$p()}},un:function($i,$p,$F){return $F||($F=$i[$p]),$d.__propun.value=$F,Object.defineProperty($i,$p,$d.__propun),$F},uns:function($p,$i){$i.forEach(function($i){$d.un($p,$i)})}};return $U.console=$U.console||{log:function(){}},$U.trace=$U.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),$d}(window,document);!function($i,$p,$F){$F.un,$F.uns,$F.static,$F.class,$F.getset,$F.__newvec}(window,document,Laya),function($q,$p,$a){$a.un,$a.uns;var $O=$a.static,$x=$a.class,$d=$a.getset;$a.__newvec;$a.interface("laya.runtime.IMarket"),$a.interface("laya.filters.IFilter"),$a.interface("laya.display.ILayout"),$a.interface("laya.resource.IDispose"),$a.interface("laya.runtime.IPlatform"),$a.interface("laya.resource.IDestroy"),$a.interface("laya.runtime.IConchNode"),$a.interface("laya.filters.IFilterAction"),$a.interface("laya.runtime.ICPlatformClass"),$a.interface("laya.resource.ICreateResource"),$a.interface("laya.runtime.IConchRenderObject"),$a.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var $h=function(){function $t(){}return $x($t,"laya.utils.RunDriver"),$t.FILTER_ACTIONS=[],$t.pixelRatio=-1,$t._charSizeTestDiv=null,$t.now=function(){return Date.now()},$t.getWindow=function(){return $q},$t.getPixelRatio=function(){if($t.pixelRatio<0){var $i=$o.context,$p=$i.backingStorePixelRatio||$i.webkitBackingStorePixelRatio||$i.mozBackingStorePixelRatio||$i.msBackingStorePixelRatio||$i.oBackingStorePixelRatio||$i.backingStorePixelRatio||1;($t.pixelRatio=($o.window.devicePixelRatio||1)/$p)<1&&($t.pixelRatio=1)}return $t.pixelRatio},$t.getIncludeStr=function($i){return null},$t.createShaderCondition=function($i){var $p="(function() {return "+$i+";})";return $a._runScript($p)},$t.fontMap=[],$t.measureText=function($i,$p){var $F=$t.hanzi.test($i);if($F&&$t.fontMap[$p])return $t.fontMap[$p];var $J=$o.context;$J.font=$p;var $A=$J.measureText($i);return $A||($A={width:16,height:16}),$F&&($t.fontMap[$p]=$A),$A},$t.getWebGLContext=function($i){},$t.beginFlush=function(){},$t.endFinish=function(){},$t.addToAtlas=null,$t.flashFlushImage=function($i){},$t.drawToCanvas=function($i,$p,$F,$J,$A,$t){var $q=$Di.create("2D"),$B=new $_($F,$J,$q);return $y.renders[$p]._fun($i,$B,$A,$t),$q},$t.createParticleTemplate2D=null,$t.createGLTextur=null,$t.createWebGLContext2D=null,$t.changeWebGLSize=function($i,$p){},$t.createRenderSprite=function($i,$p){return new $y($i,$p)},$t.createFilterAction=function($i){return new $D},$t.createGraphics=function(){return new $S},$t.clear=function($i){$G._context.ctx.clear()},$t.cancelLoadByUrl=function($i){},$t.clearAtlas=function($i){},$t.isAtlas=function($i){return!1},$t.addTextureToAtlas=function($i){},$t.getTexturePixels=function($i,$p,$F,$J,$A){return null},$t.skinAniSprite=function(){return null},$t.update3DLoop=function(){},$O($t,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),$t}(),$J=($d(1,$a,"alertGlobalError",null,function($i){var $t=0;$o.window.onerror=$i?function($i,$p,$F,$J,$A){$t++<5&&$A&&alert($A.stack||$A)}:null}),$a.init=function($i,$p,$F){for(var $J=[],$A=2,$t=arguments.length;$A<$t;$A++)$J.push(arguments[$A]);if(!$a._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=$a._arrayBufferSlice),$a._isinit=!0,$o.__init__(),$N.__init__(),$S.__init__(),$a.timer=new $X,$a.scaleTimer=new $X,$a.loader=new $Oi,$l.__init__(),$A=0;for(var $q=$J.length;$A<$q;$A++)$J[$A].enable&&$J[$A].enable();return $Z.__init__(),$B.__init__(),$f.__init__(),$L.beginCheck(),$a._currentStage=$a.stage=new $ri,$a.stage.conchModel&&$a.stage.conchModel.setRootNode(),$a._getUrlPath(),$a.render=new $G(0,0),$a.stage.size($i,$p),$y.__init__(),$u.__init__(),$s.instance.__init__($a.stage,$G.canvas),$vi.__init__(),$c.autoStopMusic=!0,$P.__init__(),$G.canvas}},$a._getUrlPath=function(){var $i=$o.window.location,$p=$i.pathname;$p=$p&&":"==$p.charAt(2)?$p.substring(1):$p,$I.rootPath=$I.basePath=$I.getPath("file:"==$i.protocol?$p:$i.protocol+"//"+$i.host+$i.pathname)},$a._arrayBufferSlice=function($i,$p){var $F=new Uint8Array(this,$i,$p-$i),$J=new Uint8Array($F.length);return $J.set($F),$J.buffer},$a._runScript=function($i){return $o.window[$a._evcode]($i)},$a.stage=null,$a.timer=null,$a.scaleTimer=null,$a.loader=null,$a.version="1.8.6",$a.render=null,$a._currentStage=null,$a._isinit=!1,$a.isDebug=!1,$a.MiniAdpter={init:function(){$q.navigator&&$q.navigator.userAgent&&-1<$q.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},$O($a,["conchMarket",function(){return this.conchMarket=$q.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=$q.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function $i(){}return $x($i,"Config"),$i.WebGLTextCacheCount=500,$i.atlasEnable=!1,$i.showCanvasMark=!1,$i.animationInterval=50,$i.isAntialias=!1,$i.isAlpha=!1,$i.premultipliedAlpha=!0,$i.isStencil=!0,$i.preserveDrawingBuffer=!1,$i}()),$U=function(){function $U(){this._events=null}$x($U,"laya.events.EventDispatcher");var $i=$U.prototype;return $i.hasListener=function($i){return!!(this._events&&this._events[$i])},$i.getListener=function($i){return this._events?this._events[$i]:null},$i.event=function($i,$p){if(!this._events||!this._events[$i])return!1;var $F=this._events[$i];if($F.lock)$F.queue||($F.queue=[]),$F.queue.push($p);else{var $J;for($F.lock=!0,$F.cursor=$F.head;$F.cursor;)($J=$F.cursor).recover?($F.head=$F.tail=$F.cursor=null,console.error("node is recover："+$J.id)):($F.cursor=$J.next,$J.once&&$U.delNode($F,$J),$J.method&&(null!=$p?$J.args?$J.method.apply($J.caller,$J.args.concat($p)):$p instanceof Array?$J.method.apply($J.caller,$p):$J.caller?$J.method.call($J.caller,$p):$a.recordError("事件派发错误","node.caller:"+$J.caller+"node.method:"+$J.method+"data:"+$p+"node.prev"+$J.prev):$J.method.apply($J.caller,$J.args)),$J.once&&$U.recoverHandler($J));$F.lock=!1,!$F.head&&this._events&&this._events[$i]==$F&&delete this._events[$i],$F.queue&&$F.queue.length&&this.event($i,$F.queue.shift())}return!0},$i.on=function($i,$p,$F,$J){return this._createListener($i,$p,$F,$J,!1)},$i.once=function($i,$p,$F,$J){return this._createListener($i,$p,$F,$J,!0)},$i._createListener=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=!0),$t&&this.off($i,$p,$F,$A);var $q=$U.createHandler($p||this,$F,$J,$A);this._events||(this._events={});var $B=this._events,$O=$B[$i];return $O?$O.tail?($q.prev=$O.tail,$O.tail.next=$q,$O.tail=$q):$O.head=$O.tail=$q:$B[$i]={head:$q,tail:$q,cursor:null,lock:!1},this},$i.off=function($i,$p,$F,$J){if(void 0===$J&&($J=!1),!this._events||!this._events[$i])return this;for(var $A=this._events[$i],$t=$A.head;$t;){if((!$p||$t.caller===$p)&&$t.method===$F&&(!$J||$t.once)){$U.delNode($A,$t),$A.cursor==$t&&($A.cursor=$t.next),$U.recoverHandler($t);break}$t=$t.next}return this},$i.offAll=function($i){var $p=this._events;if(!$p)return this;if($i)this._recoverHandlers($p[$i]),delete $p[$i];else{for(var $F in $p)this._recoverHandlers($p[$F]);this._events=null}return this},$i._recoverHandlers=function($i){if($i){for(var $p=$i.head;$p;){$U.delNode($i,$p);var $F=$p.next;$U.recoverHandler($p),$p=$F}$i.cursor=null}},$i.isMouseEvent=function($i){return $U.MOUSE_EVENTS[$i]},$U.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},$U.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},$U.delNode=function($i,$p){$p.prev?$p.prev.next=$p.next:$i.head=$p.next,$p.next?$p.next.prev=$p.prev:$i.tail=$p.prev},$U.createHandler=function($i,$p,$F,$J){var $A=500<$U._freeHandler.length?$U._freeHandler.shift():null;if($A)if($A.recover)$A.recover=!1,$A.caller=$i,$A.method=$p,$A.args=$F,$A.once=$J;else{var $t="";try{arguments.propertyIsEnumerable.caller}catch($i){$t=$i.stack}var $q=$A.caller?($A.caller.__proto__&&$A.caller.__proto__.constructor&&$A.caller.__proto__.constructor.name)+"|"+$A.caller.__className+"|"+$A.caller.name:"",$B=$A.method?$A.method.name:"";$a.recordError("EventDispatcher重复创建","caller="+$q+"  method="+$B+"  stack="+$t),$A={id:++$U._nodeCount,caller:$i,method:$p,args:$F,once:$J,recover:!1}}else $A={id:++$U._nodeCount,caller:$i,method:$p,args:$F,once:$J,recover:!1};return $A.prev=$A.next=null,$A},$U.recoverHandler=function($i){if($i.recover){if($U._errorCount<5){$U._errorCount++;var $p="";try{arguments.propertyIsEnumerable.caller}catch($i){$p=$i.stack}var $F=$i.caller?($i.caller.__proto__&&$i.caller.__proto__.constructor&&$i.caller.__proto__.constructor.name)+"|"+$i.caller.__className+"|"+$i.caller.name:"",$J=$i.method?$i.method.name:"";$a.recordError("EventDispatcher重复回收","id="+$i.id+"  caller="+$F+"  method="+$J+"  stack="+$p)}$i.caller=$i.method=$i.args=$i.prev=null}else $i.recover=!0,$i.caller=$i.method=$i.args=$i.prev=$i.next=null,$U._freeHandler&&$U._freeHandler.length<3e3&&$U._freeHandler.push($i)},$U._freeHandler=[],$U._nodeCount=0,$U._errorCount=0,$U}(),$M=function(){function $A($i,$p,$F,$J){this.once=!1,void(this._id=0)===$J&&($J=!1),this.setTo($i,$p,$F,$J)}$x($A,"laya.utils.Handler");var $i=$A.prototype;return $i.setTo=function($i,$p,$F,$J){return this._id=$A._gid++,this.caller=$i,this.method=$p,this.args=$F,this.once=$J,this},$i.run=function(){if(null==this.method)return null;var $i=this._id,$p=this.method.apply(this.caller,this.args);return this._id===$i&&this.once&&this.recover(),$p},$i.runWith=function($i){if(null==this.method)return null;var $p=this._id;if(null==$i)var $F=this.method.apply(this.caller,this.args);else $F=this.args||$i.unshift?this.args?this.method.apply(this.caller,this.args.concat($i)):this.method.apply(this.caller,$i):this.method.call(this.caller,$i);return this._id===$p&&this.once&&this.recover(),$F},$i.clear=function(){return this.caller=null,this.method=null,this.args=null,this},$i.recover=function(){0<this._id&&(this._id=0,this.clear())},$A.create=function($i,$p,$F,$J){return void 0===$J&&($J=!0),new $A($i,$p,$F,$J)},$A._gid=1,$A}(),$Y=function(){function $i(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}$x($i,"laya.display.BitmapFont");var $p=$i.prototype;return $p.loadFont=function($i,$p){this._path=$i,this._complete=$p,$a.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],$M.create(this,this.onLoaded))},$p.onLoaded=function(){this.parseFont($Bi.getRes(this._path),$Bi.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},$p.parseFont=function($i,$p){if(null!=$i&&null!=$p){this._texture=$p;var $F=$i.getElementsByTagName("info");if(!$F[0].getAttributeNode)return this.parseFont2($i,$p);this.fontSize=parseInt($F[0].getAttributeNode("size").nodeValue);var $J,$A=$F[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt($A[0]),parseInt($A[1]),parseInt($A[2]),parseInt($A[3])],$J=$i.getElementsByTagName("char");var $t=0;for($t=0;$t<$J.length;$t++){var $q=$J[$t],$B=parseInt($q.getAttributeNode("id").nodeValue),$O=parseInt($q.getAttributeNode("xoffset").nodeValue)/1,$U=parseInt($q.getAttributeNode("yoffset").nodeValue)/1,$d=parseInt($q.getAttributeNode("xadvance").nodeValue)/1,$u=new $Q;$u.x=parseInt($q.getAttributeNode("x").nodeValue),$u.y=parseInt($q.getAttributeNode("y").nodeValue),$u.width=parseInt($q.getAttributeNode("width").nodeValue),$u.height=parseInt($q.getAttributeNode("height").nodeValue);var $S=$di.create($p,$u.x,$u.y,$u.width,$u.height,$O,$U);this._maxWidth=Math.max(this._maxWidth,$d+this.letterSpacing),this._fontCharDic[$B]=$S,this._fontWidthMap[$B]=$d}}},$p.parseFont2=function($i,$p){if(null!=$i&&null!=$p){this._texture=$p;var $F=$i.getElementsByTagName("info");this.fontSize=parseInt($F[0].attributes.size.nodeValue);var $J=$F[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt($J[0]),parseInt($J[1]),parseInt($J[2]),parseInt($J[3])];var $A=$i.getElementsByTagName("char"),$t=0;for($t=0;$t<$A.length;$t++){var $q=$A[$t].attributes,$B=parseInt($q.id.nodeValue),$O=parseInt($q.xoffset.nodeValue)/1,$U=parseInt($q.yoffset.nodeValue)/1,$d=parseInt($q.xadvance.nodeValue)/1,$u=new $Q;$u.x=parseInt($q.x.nodeValue),$u.y=parseInt($q.y.nodeValue),$u.width=parseInt($q.width.nodeValue),$u.height=parseInt($q.height.nodeValue);var $S=$di.create($p,$u.x,$u.y,$u.width,$u.height,$O,$U);this._maxWidth=Math.max(this._maxWidth,$d+this.letterSpacing),this._fontCharDic[$B]=$S,this._fontWidthMap[$B]=$d}}},$p.getCharTexture=function($i){return this._fontCharDic[$i.charCodeAt(0)]},$p.destroy=function(){if(this._texture){for(var $i in this._fontCharDic){var $p=this._fontCharDic[$i];$p&&$p.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},$p.setSpaceWidth=function($i){this._spaceWidth=$i},$p.getCharWidth=function($i){var $p=$i.charCodeAt(0);return this._fontWidthMap[$p]?this._fontWidthMap[$p]+this.letterSpacing:" "==$i?this._spaceWidth+this.letterSpacing:0},$p.getTextWidth=function($i){for(var $p=0,$F=0,$J=$i.length;$F<$J;$F++)$p+=this.getCharWidth($i.charAt($F));return $p},$p.getMaxWidth=function(){return this._maxWidth},$p.getMaxHeight=function(){return this.fontSize},$p.drawText=function($i,$p,$F,$J,$A,$t){var $q,$B=this.getTextWidth($i),$O=0;"center"===$A&&($O=($t-$B)/2),"right"===$A&&($O=$t-$B);for(var $U=0,$d=0,$u=$i.length;$d<$u;$d++)($q=this.getCharTexture($i.charAt($d)))&&($p.graphics.drawTexture($q,$F+$U+$O,$J),$U+=this.getCharWidth($i.charAt($d)))},$i}(),$B=function(){function $F(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=$F._TF_EMPTY}$x($F,"laya.display.css.Style");var $i=$F.prototype;return $i.getTransform=function(){return this._tf},$i.setTransform=function($i){this._tf="none"!==$i&&$i?$i:$F._TF_EMPTY},$i.setTranslateX=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.translateX=$i},$i.setTranslateY=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.translateY=$i},$i.setScaleX=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.scaleX=$i},$i.setScale=function($i,$p){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.scaleX=$i,this._tf.scaleY=$p},$i.setScaleY=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.scaleY=$i},$i.setRotate=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.rotate=$i},$i.setSkewX=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.skewX=$i},$i.setSkewY=function($i){this._tf===$F._TF_EMPTY&&(this._tf=new $A),this._tf.skewY=$i},$i.destroy=function(){this.scrollRect=null},$i.render=function($i,$p,$F,$J){},$i.getCSSStyle=function(){return $pi.EMPTY},$i._enableLayout=function(){return!1},$d(0,$i,"scaleX",function(){return this._tf.scaleX},function($i){this.setScaleX($i)}),$d(0,$i,"transform",function(){return this.getTransform()},function($i){this.setTransform($i)}),$d(0,$i,"translateX",function(){return this._tf.translateX},function($i){this.setTranslateX($i)}),$d(0,$i,"translateY",function(){return this._tf.translateY},function($i){this.setTranslateY($i)}),$d(0,$i,"scaleY",function(){return this._tf.scaleY},function($i){this.setScaleY($i)}),$d(0,$i,"block",function(){return 0!=(1&this._type)}),$d(0,$i,"skewY",function(){return this._tf.skewY},function($i){this.setSkewY($i)}),$d(0,$i,"rotate",function(){return this._tf.rotate},function($i){this.setRotate($i)}),$d(0,$i,"skewX",function(){return this._tf.skewX},function($i){this.setSkewX($i)}),$d(0,$i,"paddingLeft",function(){return 0}),$d(0,$i,"paddingTop",function(){return 0}),$d(0,$i,"absolute",function(){return!0}),$F.__init__=function(){$F._TF_EMPTY=new $A,$F.EMPTY=new $F},$F.EMPTY=null,$F._TF_EMPTY=null,$F}(),$Z=function(){function $p($i){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=$K.create($p.defaultColor),this.family=$p.defaultFamily,this.stroke=$p._STROKE,this.size=$p.defaultSize,$i&&$i!==$p.EMPTY&&$i.copyTo(this)}$x($p,"laya.display.css.Font");var $i=$p.prototype;return $i.set=function($i){this._text=null;for(var $p=$i.split(" "),$F=0,$J=$p.length;$F<$J;$F++){var $A=$p[$F];switch($A){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<$A.indexOf("px")&&(this.size=parseInt($A),this.family=$p[$F+1],$F++)}},$i.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},$i.copyTo=function($i){$i._type=this._type,$i._text=this._text,$i._weight=this._weight,$i._color=this._color,$i.family=this.family,$i.stroke=this.stroke!=$p._STROKE?this.stroke.slice():$p._STROKE,$i.indent=this.indent,$i.size=this.size},$d(0,$i,"password",function(){return 0!=(1024&this._type)},function($i){$i?this._type|=1024:this._type&=-1025}),$d(0,$i,"color",function(){return this._color.strColor},function($i){this._color=$K.create($i)}),$d(0,$i,"italic",function(){return 0!=(512&this._type)},function($i){$i?this._type|=512:this._type&=-513}),$d(0,$i,"bold",function(){return 0!=(2048&this._type)},function($i){$i?this._type|=2048:this._type&=-2049}),$d(0,$i,"weight",function(){return""+this._weight},function($i){var $p=0;switch($i){case"normal":break;case"bold":this.bold=!0,$p=700;break;case"bolder":$p=800;break;case"lighter":$p=100;break;default:$p=parseInt($i)}this._weight=$p,this._text=null}),$d(0,$i,"decoration",function(){return this._decoration?this._decoration.value:null},function($i){var $p=$i.split(" ");switch(this._decoration||(this._decoration={}),$p[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=$p[0]}$p[1]&&(this._decoration.color=$K.create($p)),this._decoration.value=$i}),$p.__init__=function(){$p.EMPTY=new $p(null)},$p.EMPTY=null,$p.defaultColor="#000000",$p.defaultSize=12,$p.defaultFamily="Arial",$p.defaultFont="12px Arial",$p._STROKE=[0,"#000000"],$p._ITALIC=512,$p._PASSWORD=1024,$p._BOLD=2048,$p}(),$A=function(){function $i(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return $x($i,"laya.display.css.TransformInfo"),$i}(),$S=function(){function $u(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,$G.isConchNode){this._nativeObj=new $q._conchGraphics,this.id=this._nativeObj.conchID}}$x($u,"laya.display.Graphics");var $i=$u.prototype;return $i.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},$i.clear=function($i){void 0===$i&&($i=!1);var $p=0,$F=0;if($i){var $J=this._one;if(this._cmds){for($F=this._cmds.length,$p=0;$p<$F;$p++)!($J=this._cmds[$p])||$J.callee!==$G._context._drawTexture&&$J.callee!==$G._context._drawTextureWithTransform||($J[0]=null,$u._cache.push($J));this._cmds.length=0}else $J&&(!$J||$J.callee!==$G._context._drawTexture&&$J.callee!==$G._context._drawTextureWithTransform||($J[0]=null,$u._cache.push($J)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for($p=0,$F=this._vectorgraphArray.length;$p<$F;$p++)$z.getInstance().deleteShape(this._vectorgraphArray[$p]);this._vectorgraphArray.length=0}},$i._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},$i._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new $F,this._graphicBounds._graphics=this)},$i._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},$i._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},$i.getBounds=function($i){return void 0===$i&&($i=!1),this._initGraphicBounds(),this._graphicBounds.getBounds($i)},$i.getBoundPoints=function($i){return void 0===$i&&($i=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints($i)},$i._addCmd=function($i){this._cmds=this._cmds||[],$i.callee=$i.shift(),this._cmds.push($i)},$i.setFilters=function($i){this._saveToCmd($G._context._setFilters,$i)},$i.drawTexture=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$q&&($q=1),!$i||$q<.01)return null;$J||($J=$i.sourceWidth),$A||($A=$i.sourceHeight),$q=$q<0?0:1<$q?1:$q;var $B,$O=!$G.isWebGL&&($o.onFirefox||$o.onEdge||$o.onIE||$o.onSafari)?.5:0,$U=$J/$i.sourceWidth,$d=$A/$i.sourceHeight;return $J=$i.width*$U,$A=$i.height*$d,$i.loaded&&($J<=0||$A<=0)?null:($p+=$i.offsetX*$U,$F+=$i.offsetY*$d,this._sp&&(this._sp._renderType|=512),$p-=$O,$F-=$O,$J+=2*$O,$A+=2*$O,$u._cache.length?(($B=$u._cache.pop())[0]=$i,$B[1]=$p,$B[2]=$F,$B[3]=$J,$B[4]=$A,$B[5]=$t,$B[6]=$q):$B=[$i,$p,$F,$J,$A,$t,$q],$B.callee=$t||1!=$q?$G._context._drawTextureWithTransform:$G._context._drawTexture,null!=this._one||$t||1!=$q?this._saveToCmd($B.callee,$B):(this._one=$B,this._render=this._renderOneImg),$i.loaded||$i.once("loaded",this,this._textureLoaded,[$i,$B]),this._repaint(),$B)},$i.cleanByTexture=function($i,$p,$F,$J,$A){if(void 0===$J&&($J=0),void 0===$A&&($A=0),!$i)return this.clear();if(this._one&&this._render===this._renderOneImg){$J||($J=$i.sourceWidth),$A||($A=$i.sourceHeight);var $t=$J/$i.sourceWidth,$q=$A/$i.sourceHeight;$J=$i.width*$t,$A=$i.height*$q,$p+=$i.offsetX*$t,$F+=$i.offsetY*$q,this._one[0]=$i,this._one[1]=$p,this._one[2]=$F,this._one[3]=$J,this._one[4]=$A,this._repaint()}else this.clear(),$i&&this.drawTexture($i,$p,$F,$J,$A)},$i.drawTextures=function($i,$p){$i&&this._saveToCmd($G._context._drawTextures,[$i,$p])},$i.fillTexture=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$t&&($t="repeat"),$i){var $B=[$i,$p,$F,$J,$A,$t,$q||$R.EMPTY,{}];$i.loaded||$i.once("loaded",this,this._textureLoaded,[$i,$B]),this._saveToCmd($G._context._fillTexture,$B)}},$i._textureLoaded=function($i,$p){$p[3]=$p[3]||$i.width,$p[4]=$p[4]||$i.height,this._repaint()},$i.fillCircle=function($i,$p,$F,$J,$A,$t,$q){$F.bitmap.enableMerageInAtlas=!1;var $B=new Float32Array(2*($q+1)),$O=new Float32Array(2*($q+1)),$U=new Uint16Array(3*$q),$d=2*Math.PI/$q,$u=0;$B[0]=$J,$B[1]=$A,$O[0]=$J/$F.width,$O[1]=$A/$F.height;for(var $S=2,$Z=0;$Z<$q;$Z++){var $s=$t*Math.cos($u)+$J,$x=$t*Math.sin($u)+$A;$B[$S]=$s,$B[$S+1]=$x,$O[$S]=$s/$F.width,$O[$S+1]=$x/$F.height,$u+=$d,$S+=2}for($Z=$S=0;$Z<$q;$Z++)$U[$S++]=0,$U[$S++]=$Z+1,$U[$S++]=$q+1<=$Z+2?1:$Z+2;this.drawTriangles($F,$i,$p,$B,$O,$U)},$i.drawTriangles=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){void 0===$B&&($B=1),this._saveToCmd($G._context.drawTriangles,[$i,$p,$F,$J,$A,$t,$q,$B,$O,$U])},$i._saveToCmd=function($i,$p){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=$p,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push($p)),$p.callee=$i,this._repaint(),$p},$i.clipRect=function($i,$p,$F,$J){this._saveToCmd($G._context._clipRect,[$i,$p,$F,$J])},$i.fillText=function($i,$p,$F,$J,$A,$t,$q){void 0===$q&&($q=0),this._saveToCmd($G._context._fillText,[$i,$p,$F,$J||$Z.defaultFont,$A,$t])},$i.fillBorderText=function($i,$p,$F,$J,$A,$t,$q,$B){this._saveToCmd($G._context._fillBorderText,[$i,$p,$F,$J||$Z.defaultFont,$A,$t,$q,$B])},$i.strokeText=function($i,$p,$F,$J,$A,$t,$q){this._saveToCmd($G._context._strokeText,[$i,$p,$F,$J||$Z.defaultFont,$A,$t,$q])},$i.alpha=function($i){$i=$i<0?0:1<$i?1:$i,this._saveToCmd($G._context._alpha,[$i])},$i.setAlpha=function($i){$i=$i<0?0:1<$i?1:$i,this._saveToCmd($G._context._setAlpha,[$i])},$i.transform=function($i,$p,$F){void 0===$p&&($p=0),void 0===$F&&($F=0),this._saveToCmd($G._context._transform,[$i,$p,$F])},$i.rotate=function($i,$p,$F){void 0===$p&&($p=0),void 0===$F&&($F=0),this._saveToCmd($G._context._rotate,[$i,$p,$F])},$i.scale=function($i,$p,$F,$J){void 0===$F&&($F=0),void 0===$J&&($J=0),this._saveToCmd($G._context._scale,[$i,$p,$F,$J])},$i.translate=function($i,$p){this._saveToCmd($G._context._translate,[$i,$p])},$i.save=function(){this._saveToCmd($G._context._save,[])},$i.restore=function(){this._saveToCmd($G._context._restore,[])},$i.replaceText=function($i){this._repaint();var $p=this._cmds;if($p){for(var $F=$p.length-1;-1<$F;$F--)if(this._isTextCmd($p[$F].callee))return $p[$F][0].toUpperCase?$p[$F][0]=$i:$p[$F][0].setText($i),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=$i:this._one[0].setText($i),!0;return!1},$i._isTextCmd=function($i){return $i===$G._context._fillText||$i===$G._context._fillBorderText||$i===$G._context._strokeText},$i.replaceTextColor=function($i){this._repaint();var $p=this._cmds;if($p)for(var $F=$p.length-1;-1<$F;$F--)this._isTextCmd($p[$F].callee)&&($p[$F][4]=$i,$p[$F][0].toUpperCase||($p[$F][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=$i,this._one[0].toUpperCase||(this._one[0].changed=!0))},$i.loadImage=function($i,$p,$F,$J,$A,$t){var $q=this;void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),void 0===$A&&($A=0);var $B=$Bi.getRes($i);function $O($i){$i&&($q.drawTexture($i,$p,$F,$J,$A),null!=$t&&$t.call($q._sp,$i))}$B?$O($B):$a.loader.load($i,$M.create(null,$O),null,"image")},$i._renderEmpty=function($i,$p,$F,$J){},$i._renderAll=function($i,$p,$F,$J){for(var $A,$t=this._cmds,$q=0,$B=$t.length;$q<$B;$q++)($A=$t[$q]).callee.call($p,$F,$J,$A)},$i._renderOne=function($i,$p,$F,$J){this._one.callee.call($p,$F,$J,this._one)},$i._renderOneImg=function($i,$p,$F,$J){this._one.callee.call($p,$F,$J,this._one),2305!==$i._renderType&&($i._renderType|=1)},$i.drawLine=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=1);var $q=0;$G.isWebGL&&($q=$z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($q));var $B=$t%2==0?0:.5,$O=[$i+$B,$p+$B,$F+$B,$J+$B,$A,$t,$q];this._saveToCmd($G._context._drawLine,$O)},$i.drawLines=function($i,$p,$F,$J,$A){void 0===$A&&($A=1);var $t=0;if($F&&!($F.length<4)){$G.isWebGL&&($t=$z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($t));var $q=$A%2==0?0:.5,$B=[$i+$q,$p+$q,$F,$J,$A,$t];this._saveToCmd($G._context._drawLines,$B)}},$i.drawCurves=function($i,$p,$F,$J,$A){void 0===$A&&($A=1);var $t=[$i,$p,$F,$J,$A];this._saveToCmd($G._context._drawCurves,$t)},$i.drawRect=function($i,$p,$F,$J,$A,$t,$q){void 0===$q&&($q=1);var $B=$t?$q/2:0,$O=$t?$q:0,$U=[$i+$B,$p+$B,$F-$O,$J-$O,$A,$t,$q];this._saveToCmd($G._context._drawRect,$U)},$i.drawCircle=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=1);var $q=$A?$t/2:0,$B=0;$G.isWebGL&&($B=$z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($B));var $O=[$i,$p,$F-$q,$J,$A,$t,$B];this._saveToCmd($G._context._drawCircle,$O)},$i.drawPie=function($i,$p,$F,$J,$A,$t,$q,$B){void 0===$B&&($B=1);var $O=$q?$B/2:0,$U=$q?$B:0,$d=0;$G.isWebGL&&($d=$z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($d));var $u=[$i+$O,$p+$O,$F-$U,$J,$A,$t,$q,$B,$d];$u[3]=$b.toRadian($J),$u[4]=$b.toRadian($A),this._saveToCmd($G._context._drawPie,$u)},$i.drawPoly=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=1);var $q=0,$B=!1;$G.isWebGL&&($q=$z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push($q),$B=!(6<$F.length));var $O=$A?$t%2==0?0:.5:0,$U=[$i+$O,$p+$O,$F,$J,$A,$t,$q,$B];this._saveToCmd($G._context._drawPoly,$U)},$i.drawPath=function($i,$p,$F,$J,$A){var $t=[$i,$p,$F,$J,$A];this._saveToCmd($G._context._drawPath,$t)},$d(0,$i,"cmds",function(){return this._cmds},function($i){this._sp&&(this._sp._renderType|=512),this._cmds=$i,this._render=this._renderAll,this._repaint()}),$u.__init__=function(){if($G.isConchNode){for(var $i=laya.display.Graphics.prototype,$p=$o.window.ConchGraphics.prototype,$F=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],$J=0,$A=$F.length;$J<=$A;$J++){var $t=$F[$J];$i[$t]=$p[$t]}$i._saveToCmd=null,$p.drawImageS&&($i.drawTextures=function($i,$p){if($i&&$i.loaded&&$i.bitmap&&$i.source){var $F=$i.uv,$J=$i.bitmap.width,$A=$i.bitmap.height;this.drawImageS($i.bitmap.source,$F[0]*$J,$F[1]*$A,($F[2]-$F[0])*$J,($F[5]-$F[3])*$A,$i.offsetX,$i.offsetY,$i.width,$i.height,$p)}}),$i.drawTexture=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$q&&($q=1),$i)if($i.loaded){if($i.loaded&&$i.bitmap&&$i.source&&($J||($J=$i.sourceWidth),$A||($A=$i.sourceHeight),$q=$q<0?0:1<$q?1:$q,$J=$J-$i.sourceWidth+$i.width,$A=$A-$i.sourceHeight+$i.height,!($J<=0||$A<=0))){$p+=$i.offsetX,$F+=$i.offsetY;var $B=$i.uv,$O=$i.bitmap.width,$U=$i.bitmap.height;$B[4]<$B[0]&&$B[5]<$B[1]?this.drawImageM($i.bitmap.source,$B[4]*$O,$B[5]*$U,($B[0]-$B[4])*$O,($B[1]-$B[5])*$U,$p,$F,$J,$A,$t,$q):this.drawImageM($i.bitmap.source,$B[0]*$O,$B[1]*$U,($B[2]-$B[0])*$O,($B[5]-$B[3])*$U,$p,$F,$J,$A,$t,$q),this._repaint()}}else $i.once("loaded",this,function(){this.drawTexture($i,$p,$F,$J,$A,$t)})},$i.fillTexture=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$t&&($t="repeat"),$i&&$i.loaded){var $B,$O=$G._context.ctx,$U=$i.bitmap.width,$d=$i.bitmap.height,$u=$i.uv;$B=$i.uv!=$di.DEF_UV?$O.createPattern($i.bitmap.source,$t,$u[0]*$U,$u[1]*$d,($u[2]-$u[0])*$U,($u[5]-$u[3])*$d):$O.createPattern($i.bitmap.source,$t);var $S=0,$Z=0;$q&&($p+=$q.x%$i.width,$F+=$q.y%$i.height,$S-=$q.x%$i.width,$Z-=$q.y%$i.height),this._fillImage($B,$p,$F,$S,$Z,$J,$A)}}}},$u._cache=[],$u}(),$F=function(){function $D(){this._cacheBoundsType=!1}$x($D,"laya.display.GraphicsBounds");var $i=$D.prototype;return $i.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},$i.reset=function(){this._temp&&(this._temp.length=0)},$i.getBounds=function($i){return void 0===$i&&($i=!1),(!this._bounds||!this._temp||this._temp.length<1||$i!=this._cacheBoundsType)&&(this._bounds=$Q._getWrapRec(this.getBoundPoints($i),this._bounds)),this._cacheBoundsType=$i,this._bounds},$i.getBoundPoints=function($i){return void 0===$i&&($i=!1),(!this._temp||this._temp.length<1||$i!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints($i)),this._cacheBoundsType=$i,this._rstBoundPoints=$b.copyArray(this._rstBoundPoints,this._temp)},$i._getCmdPoints=function($i){void 0===$i&&($i=!1);var $p,$F,$J=$G._context,$A=this._graphics.cmds;if(($p=this._temp||(this._temp=[])).length=0,$A||null==this._graphics._one||($D._tempCmds.length=0,$D._tempCmds.push(this._graphics._one),$A=$D._tempCmds),!$A)return $p;($F=$D._tempMatrixArrays).length=0;var $t=$D._initMatrix;$t.identity();for(var $q,$B,$O=$D._tempMatrix,$U=NaN,$d=NaN,$u=NaN,$S=NaN,$Z=NaN,$s=NaN,$x=0,$j=$A.length;$x<$j;$x++)if(($q=$A[$x]).callee)switch($q.callee){case $J._save:case 7:$F.push($t),$t=$t.clone();break;case $J._restore:case 8:$t=$F.pop();break;case $J._scale:case 5:$O.identity(),$O.translate(-$q[2],-$q[3]),$O.scale($q[0],$q[1]),$O.translate($q[2],$q[3]),this._switchMatrix($t,$O);break;case $J._rotate:case 3:$O.identity(),$O.translate(-$q[1],-$q[2]),$O.rotate($q[0]),$O.translate($q[1],$q[2]),this._switchMatrix($t,$O);break;case $J._translate:case 6:$O.identity(),$O.translate($q[0],$q[1]),this._switchMatrix($t,$O);break;case $J._transform:case 4:$O.identity(),$O.translate(-$q[1],-$q[2]),$O.concat($q[0]),$O.translate($q[1],$q[2]),this._switchMatrix($t,$O);break;case 16:case 24:$D._addPointArrToRst($p,$Q._getBoundPointS($q[0],$q[1],$q[2],$q[3]),$t);break;case 17:$t.copyTo($O),$O.concat($q[4]),$D._addPointArrToRst($p,$Q._getBoundPointS($q[0],$q[1],$q[2],$q[3]),$O);break;case $J._drawTexture:$B=$q[0],$i?$q[3]&&$q[4]?$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$q[3],$q[4]),$t):($B=$q[0],$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$B.width,$B.height),$t)):($U=($q[3]||$B.sourceWidth)/$B.width,$d=($q[4]||$B.sourceHeight)/$B.height,$u=$U*$B.sourceWidth,$S=$d*$B.sourceHeight,$Z=0<$B.offsetX?$B.offsetX:0,$s=0<$B.offsetY?$B.offsetY:0,$Z*=$U,$s*=$d,$D._addPointArrToRst($p,$Q._getBoundPointS($q[1]-$Z,$q[2]-$s,$u,$S),$t));break;case $J._fillTexture:$q[3]&&$q[4]?$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$q[3],$q[4]),$t):($B=$q[0],$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$B.width,$B.height),$t));break;case $J._drawTextureWithTransform:var $r;$r=$q[5]?($t.copyTo($O),$O.concat($q[5]),$O):$t,$i?$q[3]&&$q[4]?$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$q[3],$q[4]),$r):($B=$q[0],$D._addPointArrToRst($p,$Q._getBoundPointS($q[1],$q[2],$B.width,$B.height),$r)):($B=$q[0],$U=($q[3]||$B.sourceWidth)/$B.width,$d=($q[4]||$B.sourceHeight)/$B.height,$u=$U*$B.sourceWidth,$S=$d*$B.sourceHeight,$Z=0<$B.offsetX?$B.offsetX:0,$s=0<$B.offsetY?$B.offsetY:0,$Z*=$U,$s*=$d,$D._addPointArrToRst($p,$Q._getBoundPointS($q[1]-$Z,$q[2]-$s,$u,$S),$r));break;case $J._drawRect:case 13:$D._addPointArrToRst($p,$Q._getBoundPointS($q[0],$q[1],$q[2],$q[3]),$t);break;case $J._drawCircle:case $J._fillCircle:case 14:$D._addPointArrToRst($p,$Q._getBoundPointS($q[0]-$q[2],$q[1]-$q[2],$q[2]+$q[2],$q[2]+$q[2]),$t);break;case $J._drawLine:case 20:$D._tempPoints.length=0;var $M;$M=.5*$q[5],$q[0]==$q[2]?$D._tempPoints.push($q[0]+$M,$q[1],$q[2]+$M,$q[3],$q[0]-$M,$q[1],$q[2]-$M,$q[3]):$q[1]==$q[3]?$D._tempPoints.push($q[0],$q[1]+$M,$q[2],$q[3]+$M,$q[0],$q[1]-$M,$q[2],$q[3]-$M):$D._tempPoints.push($q[0],$q[1],$q[2],$q[3]),$D._addPointArrToRst($p,$D._tempPoints,$t);break;case $J._drawCurves:case 22:$D._addPointArrToRst($p,$E.I.getBezierPoints($q[2]),$t,$q[0],$q[1]);break;case $J._drawPoly:case $J._drawLines:case 18:$D._addPointArrToRst($p,$q[2],$t,$q[0],$q[1]);break;case $J._drawPath:case 19:$D._addPointArrToRst($p,this._getPathPoints($q[2]),$t,$q[0],$q[1]);break;case $J._drawPie:case 15:$D._addPointArrToRst($p,this._getPiePoints($q[0],$q[1],$q[2],$q[3],$q[4]),$t)}return 200<$p.length?$p=$b.copyArray($p,$Q._getWrapRec($p)._getBoundPoints()):8<$p.length&&($p=$v.scanPList($p)),$p},$i._switchMatrix=function($i,$p){$p.concat($i),$p.copyTo($i)},$i._getPiePoints=function($i,$p,$F,$J,$A){var $t=$D._tempPoints;$D._tempPoints.length=0,$t.push($i,$p);var $q=($A-$J)%(2*Math.PI)/10,$B=NaN,$O=$J;for($B=0;$B<=10;$B++)$t.push($i+$F*Math.cos($O),$p+$F*Math.sin($O)),$O+=$q;return $t},$i._getPathPoints=function($i){var $p,$F,$J=0,$A=$D._tempPoints;for($A.length=0,$p=$i.length,$J=0;$J<$p;$J++)1<($F=$i[$J]).length&&($A.push($F[1],$F[2]),3<$F.length&&$A.push($F[3],$F[4]));return $A},$D._addPointArrToRst=function($i,$p,$F,$J,$A){void 0===$J&&($J=0),void 0===$A&&($A=0);var $t,$q=0;for($t=$p.length,$q=0;$q<$t;$q+=2)$D._addPointToRst($i,$p[$q]+$J,$p[$q+1]+$A,$F)},$D._addPointToRst=function($i,$p,$F,$J){var $A=$R.TEMP;$A.setTo($p||0,$F||0),$J.transformPoint($A),$i.push($A.x,$A.y)},$D._tempPoints=[],$D._tempMatrixArrays=[],$D._tempCmds=[],$O($D,["_tempMatrix",function(){return this._tempMatrix=new $m},"_initMatrix",function(){return this._initMatrix=new $m}]),$D}(),$t=function(){function $i(){}$x($i,"laya.events.Event");var $p=$i.prototype;return $p.setTo=function($i,$p,$F){return this.type=$i,this.currentTarget=$p,this.target=$F,this},$p.stopPropagation=function(){this._stoped=!0},$d(0,$p,"stageY",function(){return $a.stage.mouseY}),$d(0,$p,"charCode",function(){return this.nativeEvent.charCode}),$d(0,$p,"touches",function(){var $i=this.nativeEvent.touches;if($i)for(var $p=$a.stage,$F=0,$J=$i.length;$F<$J;$F++){var $A=$i[$F],$t=$R.TEMP;$t.setTo($A.clientX,$A.clientY),$p._canvasTransform.invertTransformPoint($t),$p.transform.invertTransformPoint($t),$A.stageX=$t.x,$A.stageY=$t.y}return $i}),$d(0,$p,"keyLocation",function(){return this.nativeEvent.keyLocation}),$d(0,$p,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),$d(0,$p,"altKey",function(){return this.nativeEvent.altKey}),$d(0,$p,"shiftKey",function(){return this.nativeEvent.shiftKey}),$d(0,$p,"stageX",function(){return $a.stage.mouseX}),$i.EMPTY=new $i,$i.MOUSE_DOWN="mousedown",$i.MOUSE_UP="mouseup",$i.CLICK="click",$i.RIGHT_MOUSE_DOWN="rightmousedown",$i.RIGHT_MOUSE_UP="rightmouseup",$i.RIGHT_CLICK="rightclick",$i.MOUSE_MOVE="mousemove",$i.MOUSE_OVER="mouseover",$i.MOUSE_OUT="mouseout",$i.MOUSE_WHEEL="mousewheel",$i.ROLL_OVER="mouseover",$i.ROLL_OUT="mouseout",$i.DOUBLE_CLICK="doubleclick",$i.CHANGE="change",$i.CHANGED="changed",$i.RESIZE="resize",$i.ADDED="added",$i.REMOVED="removed",$i.DISPLAY="display",$i.UNDISPLAY="undisplay",$i.ERROR="error",$i.COMPLETE="complete",$i.LOADED="loaded",$i.INITED="inited",$i.PROGRESS="progress",$i.INPUT="input",$i.RENDER="render",$i.OPEN="open",$i.MESSAGE="message",$i.CLOSE="close",$i.KEY_DOWN="keydown",$i.KEY_PRESS="keypress",$i.KEY_UP="keyup",$i.FRAME="enterframe",$i.DRAG_START="dragstart",$i.DRAG_MOVE="dragmove",$i.DRAG_END="dragend",$i.ENTER="enter",$i.SELECT="select",$i.BLUR="blur",$i.FOCUS="focus",$i.VISIBILITY_CHANGE="visibilitychange",$i.FOCUS_CHANGE="focuschange",$i.PLAYED="played",$i.PAUSED="paused",$i.STOPPED="stopped",$i.START="start",$i.END="end",$i.ENABLE_CHANGED="enablechanged",$i.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",$i.COMPONENT_ADDED="componentadded",$i.COMPONENT_REMOVED="componentremoved",$i.LAYER_CHANGED="layerchanged",$i.HIERARCHY_LOADED="hierarchyloaded",$i.RECOVERED="recovered",$i.RELEASED="released",$i.LINK="link",$i.LABEL="label",$i.FULL_SCREEN_CHANGE="fullscreenchange",$i.DEVICE_LOST="devicelost",$i.MESH_CHANGED="meshchanged",$i.MATERIAL_CHANGED="materialchanged",$i.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",$i.ANIMATION_CHANGED="animationchanged",$i.TRIGGER_ENTER="triggerenter",$i.TRIGGER_STAY="triggerstay",$i.TRIGGER_EXIT="triggerexit",$i.TRAIL_FILTER_CHANGE="trailfilterchange",$i.DOMINO_FILTER_CHANGE="dominofilterchange",$i}(),$u=(function(){function $i(){}$x($i,"laya.events.Keyboard"),$i.NUMBER_0=48,$i.NUMBER_1=49,$i.NUMBER_2=50,$i.NUMBER_3=51,$i.NUMBER_4=52,$i.NUMBER_5=53,$i.NUMBER_6=54,$i.NUMBER_7=55,$i.NUMBER_8=56,$i.NUMBER_9=57,$i.A=65,$i.B=66,$i.C=67,$i.D=68,$i.E=69,$i.F=70,$i.G=71,$i.H=72,$i.I=73,$i.J=74,$i.K=75,$i.L=76,$i.M=77,$i.N=78,$i.O=79,$i.P=80,$i.Q=81,$i.R=82,$i.S=83,$i.T=84,$i.U=85,$i.V=86,$i.W=87,$i.X=88,$i.Y=89,$i.Z=90,$i.F1=112,$i.F2=113,$i.F3=114,$i.F4=115,$i.F5=116,$i.F6=117,$i.F7=118,$i.F8=119,$i.F9=120,$i.F10=121,$i.F11=122,$i.F12=123,$i.F13=124,$i.F14=125,$i.F15=126,$i.NUMPAD=21,$i.NUMPAD_0=96,$i.NUMPAD_1=97,$i.NUMPAD_2=98,$i.NUMPAD_3=99,$i.NUMPAD_4=100,$i.NUMPAD_5=101,$i.NUMPAD_6=102,$i.NUMPAD_7=103,$i.NUMPAD_8=104,$i.NUMPAD_9=105,$i.NUMPAD_ADD=107,$i.NUMPAD_DECIMAL=110,$i.NUMPAD_DIVIDE=111,$i.NUMPAD_ENTER=108,$i.NUMPAD_MULTIPLY=106,$i.NUMPAD_SUBTRACT=109,$i.SEMICOLON=186,$i.EQUAL=187,$i.COMMA=188,$i.MINUS=189,$i.PERIOD=190,$i.SLASH=191,$i.BACKQUOTE=192,$i.LEFTBRACKET=219,$i.BACKSLASH=220,$i.RIGHTBRACKET=221,$i.QUOTE=222,$i.ALTERNATE=18,$i.BACKSPACE=8,$i.CAPS_LOCK=20,$i.COMMAND=15,$i.CONTROL=17,$i.DELETE=46,$i.ENTER=13,$i.ESCAPE=27,$i.PAGE_UP=33,$i.PAGE_DOWN=34,$i.END=35,$i.HOME=36,$i.LEFT=37,$i.UP=38,$i.RIGHT=39,$i.DOWN=40,$i.SHIFT=16,$i.SPACE=32,$i.TAB=9,$i.INSERT=45}(),function(){function $A(){}return $x($A,"laya.events.KeyBoardManager"),$A.__init__=function(){$A._addEvent("keydown"),$A._addEvent("keypress"),$A._addEvent("keyup")},$A._addEvent=function($p){$o.document.addEventListener($p,function($i){laya.events.KeyBoardManager._dispatch($i,$p)},!0)},$A._dispatch=function($i,$p){if($A.enabled){$A._event._stoped=!1,$A._event.nativeEvent=$i,$A._event.keyCode=$i.keyCode||$i.which||$i.charCode,"keydown"===$p?$A._pressKeys[$A._event.keyCode]=!0:"keyup"===$p&&($A._pressKeys[$A._event.keyCode]=null);for(var $F=$a.stage.focus&&null!=$a.stage.focus.event&&$a.stage.focus.displayedInStage?$a.stage.focus:$a.stage,$J=$F;$J;)$J.event($p,$A._event.setTo($p,$J,$F)),$J=$J.parent}},$A.hasKeyDown=function($i){return $A._pressKeys[$i]},$A._pressKeys={},$A.enabled=!0,$O($A,["_event",function(){return this._event=new $t}]),$A}()),$s=(function(){function $i(){}$x($i,"laya.events.KeyLocation"),$i.STANDARD=0,$i.LEFT=1,$i.RIGHT=2,$i.NUM_PAD=3}(),function(){function $d(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=$o.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new $t,this._matrix=new $m,this._point=new $R,this._rect=new $Q,this._prePoint=new $R,this._curTouchID=NaN}$x($d,"laya.events.MouseManager");var $i=$d.prototype;return $i.__init__=function($i,$p){var $F=this;this._stage=$i;var $J=this,$A=this._eventList;$p.oncontextmenu=function($i){if($d.enabled)return!1},$p.addEventListener("mousedown",function($i){$d.enabled&&($o.onIE||$i.preventDefault(),$A.push($i),$J.mouseDownTime=$o.now())}),$p.addEventListener("mouseup",function($i){$d.enabled&&($i.preventDefault(),$A.push($i),$J.mouseDownTime=-$o.now())},!0),$p.addEventListener("mousemove",function($i){if($d.enabled){$i.preventDefault();var $p=$o.now();if($p-$J._lastMoveTimer<10)return;$J._lastMoveTimer=$p,$A.push($i)}},!0),$p.addEventListener("mouseout",function($i){$d.enabled&&$A.push($i)}),$p.addEventListener("mouseover",function($i){$d.enabled&&$A.push($i)}),$p.addEventListener("touchstart",function($i){$d.enabled&&($A.push($i),$d._isFirstTouch||$vi.isInputting||$i.preventDefault(),$J.mouseDownTime=$o.now())}),$p.addEventListener("touchend",function($i){$d.enabled?($d._isFirstTouch||$vi.isInputting||$i.preventDefault(),$d._isFirstTouch=!1,$A.push($i),$J.mouseDownTime=-$o.now()):$F._curTouchID=NaN},!0),$p.addEventListener("touchmove",function($i){$d.enabled&&($i.preventDefault(),$A.push($i))},!0),$p.addEventListener("touchcancel",function($i){$d.enabled?($i.preventDefault(),$A.push($i)):$F._curTouchID=NaN},!0),$p.addEventListener("mousewheel",function($i){$d.enabled&&$A.push($i)}),$p.addEventListener("DOMMouseScroll",function($i){$d.enabled&&$A.push($i)})},$i.initEvent=function($i,$p){var $F;this._event._stoped=!1,this._event.nativeEvent=$p||$i,this._target=null,this._point.setTo($i.pageX||$i.clientX,$i.pageY||$i.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=$i.identifier||0,this._tTouchID=this._event.touchId,($F=$j.I._event)._stoped=!1,$F.nativeEvent=this._event.nativeEvent,$F.touchId=this._event.touchId},$i.checkMouseWheel=function($i){this._event.delta=$i.wheelDelta?.025*$i.wheelDelta:-$i.detail;for(var $p=$j.I.getLastOvers(),$F=0,$J=$p.length;$F<$J;$F++){var $A=$p[$F];$A.event("mousewheel",this._event.setTo("mousewheel",$A,this._target))}},$i.onMouseMove=function($i){$j.I.onMouseMove($i,this._tTouchID)},$i.onMouseDown=function($i){if($vi.isInputting&&$a.stage.focus&&$a.stage.focus.focus&&!$a.stage.focus.contains(this._target)){var $p=$a.stage.focus._tf||$a.stage.focus,$F=$i._tf||$i;$F instanceof laya.display.Input&&$F.multiline==$p.multiline?$p._focusOut():$p.focus=!1}$j.I.onMouseDown($i,this._tTouchID,this._isLeftMouse)},$i.onMouseUp=function($i){$j.I.onMouseUp($i,this._tTouchID,this._isLeftMouse)},$i.check=function($i,$p,$F,$J){this._point.setTo($p,$F),$i.fromParentPoint(this._point),$p=this._point.x,$F=this._point.y;var $A=$i.scrollRect;if($A&&(this._rect.setTo($A.x,$A.y,$A.width,$A.height),!this._rect.contains($p,$F)))return!1;if(!this.disableMouseEvent){if($i.hitTestPrior&&!$i.mouseThrough&&!this.hitTest($i,$p,$F))return!1;for(var $t=$i._childs.length-1;-1<$t;$t--){var $q=$i._childs[$t];if(!$q.destroyed&&$q.mouseEnabled&&$q.visible&&this.check($q,$p,$F,$J))return!0}}var $B=!(!$i.hitTestPrior||$i.mouseThrough||this.disableMouseEvent)||this.hitTest($i,$p,$F);return $B?(this._target=$i,$J.call(this,$i)):$J===this.onMouseUp&&$i===this._stage&&(this._target=this._stage,$J.call(this,this._target)),$B},$i.hitTest=function($i,$p,$F){var $J=!1;if($i.scrollRect&&($p-=$i.scrollRect.x,$F-=$i.scrollRect.y),$i.hitArea instanceof laya.utils.HitArea)return $i.hitArea.isHit($p,$F);if(0<$i.width&&0<$i.height||$i.mouseThrough||$i.hitArea)if($i.mouseThrough)$J=$i.getGraphicBounds().contains($p,$F);else{var $A=this._rect;$i.hitArea?$A=$i.hitArea:$A.setTo(0,0,$i.width,$i.height),$J=$A.contains($p,$F)}return $J},$i.runEvent=function(){var $i=this._eventList.length;if($i){var $p=this;$p.mouseEventTime=$o.now();var $F,$J=0,$A=0,$t=0;try{for(;$J<$i;){var $q=this._eventList[$J];switch("mousemove"!==$q.type&&(this._prePoint.x=this._prePoint.y=-1e6),$q.type){case"mousedown":this._touchIDs[0]=this._id++,$d._isTouchRespond?$d._isTouchRespond=!1:($p._isLeftMouse=0===$q.button,$p.initEvent($q),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseDown));break;case"mouseup":$p._isLeftMouse=0===$q.button,$p.initEvent($q),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-$q.clientX)+Math.abs(this._prePoint.y-$q.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=$q.clientX,this._prePoint.y=$q.clientY,$p.initEvent($q),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseMove));break;case"touchstart":$d._isTouchRespond=!0,$p._isLeftMouse=!0;var $B=$q.changedTouches;for($A=0,$t=$B.length;$A<$t;$A++)$F=$B[$A],($d.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=$F.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[$F.identifier]=this._id++,$p.initEvent($F,$q),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseDown));break;case"touchend":case"touchcancel":$d._isTouchRespond=!0,$p._isLeftMouse=!0;var $O=$q.changedTouches;for($A=0,$t=$O.length;$A<$t;$A++)if($F=$O[$A],$d.multiTouchEnabled||$F.identifier==this._curTouchID){this._curTouchID=NaN,$p.initEvent($F,$q);$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseUp)||$p.onMouseUp(null)}break;case"touchmove":var $U=$q.changedTouches;for($A=0,$t=$U.length;$A<$t;$A++)$F=$U[$A],($d.multiTouchEnabled||$F.identifier==this._curTouchID)&&($p.initEvent($F,$q),$p.check($p._stage,$p.mouseX,$p.mouseY,$p.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":$p.checkMouseWheel($q);break;case"mouseout":$j.I.stageMouseOut();break;case"mouseover":$p._stage.event("mouseover",$p._event.setTo("mouseover",$p._stage,$p._stage))}$J++}}catch($i){throw this._eventList.length=0,$i}this._eventList.length=0}},$d.enabled=!0,$d.multiTouchEnabled=!0,$d._isTouchRespond=!1,$d._isFirstTouch=!0,$O($d,["instance",function(){return this.instance=new $d}]),$d}()),$j=function(){function $s(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new $t}$x($s,"laya.events.TouchManager");var $i=$s.prototype;return $i._clearTempArrs=function(){$s._oldArr.length=0,$s._newArr.length=0,$s._tEleArr.length=0},$i.getTouchFromArr=function($i,$p){var $F,$J,$A=0;for($F=$p.length,$A=0;$A<$F;$A++)if(($J=$p[$A]).id==$i)return $J;return null},$i.removeTouchFromArr=function($i,$p){var $F=0;for($F=$p.length-1;0<=$F;$F--)$p[$F].id==$i&&$p.splice($F,1)},$i.createTouchO=function($i,$p){var $F;return($F=$w.getItem("TouchData")||{}).id=$p,$F.tar=$i,$F},$i.onMouseDown=function($i,$p,$F){var $J,$A,$t,$q;(void 0===$F&&($F=!1),this.enable)&&($J=this.getTouchFromArr($p,this.preOvers),$t=this.getEles($i,null,$s._tEleArr),$J?$J.tar=$i:($A=this.createTouchO($i,$p),this.preOvers.push($A)),$o.onMobile&&this.sendEvents($t,"mouseover",$p),$q=$F?this.preDowns:this.preRightDowns,($J=this.getTouchFromArr($p,$q))?$J.tar=$i:($A=this.createTouchO($i,$p),$q.push($A)),this.sendEvents($t,$F?"mousedown":"rightmousedown",$p),this._clearTempArrs())},$i.sendEvents=function($i,$p,$F){void 0===$F&&($F=0);var $J,$A,$t,$q=0;for($J=$i.length,this._event._stoped=!1,$A=$i[0],$q=0;$q<$J;$q++){if(($t=$i[$q]).destroyed)return;if($t.event($p,this._event.setTo($p,$t,$A)),this._event._stoped)break}},$i.getEles=function($i,$p,$F){for($F?$F.length=0:$F=[];$i&&$i!=$p;)$F.push($i),$i=$i.parent;return $F},$i.checkMouseOutAndOverOfMove=function($i,$p,$F){if(void 0===$F&&($F=0),$p!=$i){var $J,$A,$t=0,$q=0;if($p.contains($i))$A=this.getEles($i,$p,$s._tEleArr),this.sendEvents($A,"mouseover",$F);else if($i.contains($p))$A=this.getEles($p,$i,$s._tEleArr),this.sendEvents($A,"mouseout",$F);else{var $B,$O;($A=$s._tEleArr).length=0,$B=this.getEles($p,null,$s._oldArr),$O=this.getEles($i,null,$s._newArr),$q=$B.length;var $U=0;for($t=0;$t<$q;$t++){if($J=$B[$t],0<=($U=$O.indexOf($J))){$O.splice($U,$O.length-$U);break}$A.push($J)}0<$A.length&&this.sendEvents($A,"mouseout",$F),0<$O.length&&this.sendEvents($O,"mouseover",$F)}}},$i.onMouseMove=function($i,$p){var $F,$J;this.enable&&(($F=this.getTouchFromArr($p,this.preOvers))?(this.checkMouseOutAndOverOfMove($i,$F.tar),$F.tar=$i,$J=this.getEles($i,null,$s._tEleArr)):($J=this.getEles($i,null,$s._tEleArr),this.sendEvents($J,"mouseover",$p),this.preOvers.push(this.createTouchO($i,$p))),this.sendEvents($J,"mousemove",$p),this._clearTempArrs())},$i.getLastOvers=function(){return($s._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,$s._tEleArr):($s._tEleArr.push($a.stage),$s._tEleArr)},$i.stageMouseOut=function(){var $i;$i=this.getLastOvers(),this.preOvers.length=0,this.sendEvents($i,"mouseout",0)},$i.onMouseUp=function($i,$p,$F){if(void 0===$F&&($F=!1),this.enable){var $J,$A,$t,$q,$B,$O,$U=0,$d=0,$u=$o.onMobile;if($A=this.getEles($i,null,$s._tEleArr),this.sendEvents($A,$F?"mouseup":"rightmouseup",$p),$O=$F?this.preDowns:this.preRightDowns,$J=this.getTouchFromArr($p,$O)){var $S,$Z=$o.now();if($S=$Z-this._lastClickTime<300,this._lastClickTime=$Z,$i==$J.tar)$B=$A;else for($t=this.getEles($J.tar,null,$s._oldArr),($B=$s._newArr).length=0,$d=$t.length,$U=0;$U<$d;$U++)$q=$t[$U],0<=$A.indexOf($q)&&$B.push($q);0<$B.length&&this.sendEvents($B,$F?"click":"rightclick",$p),$F&&$S&&this.sendEvents($B,"doubleclick",$p),this.removeTouchFromArr($p,$O),$J.tar=null,$w.recover("TouchData",$J)}else;($J=this.getTouchFromArr($p,this.preOvers))&&$u&&(($B=this.getEles($J.tar,null,$B))&&0<$B.length&&this.sendEvents($B,"mouseout",$p),this.removeTouchFromArr($p,this.preOvers),$J.tar=null,$w.recover("TouchData",$J)),this._clearTempArrs()}},$s._oldArr=[],$s._newArr=[],$s._tEleArr=[],$O($s,["I",function(){return this.I=new $s}]),$s}(),$r=function(){function $i(){this._action=null}$x($i,"laya.filters.Filter");var $p=$i.prototype;return $a.imps($p,{"laya.filters.IFilter":!0}),$p.callNative=function($i){},$d(0,$p,"type",function(){return-1}),$d(0,$p,"action",function(){return this._action}),$i.BLUR=16,$i.COLOR=32,$i.GLOW=8,$i._filterStart=null,$i._filterEnd=null,$i._EndTarget=null,$i._recycleScope=null,$i._filter=null,$i._useSrc=null,$i._endSrc=null,$i._useOut=null,$i._endOut=null,$i}(),$D=function(){function $i(){this.data=null}$x($i,"laya.filters.ColorFilterAction");var $p=$i.prototype;return $a.imps($p,{"laya.filters.IFilterAction":!0}),$p.apply=function($i){var $p=$i.ctx.ctx,$F=$i.ctx.ctx.canvas;if(0==$F.width||0==$F.height)return $F;for(var $J,$A=$p.getImageData(0,0,$F.width,$F.height),$t=$A.data,$q=0,$B=$t.length;$q<$B;$q+=4)$J=this.getColor($t[$q],$t[$q+1],$t[$q+2],$t[$q+3]),0!=$t[$q+3]&&($t[$q]=$J[0],$t[$q+1]=$J[1],$t[$q+2]=$J[2],$t[$q+3]=$J[3]);return $p.putImageData($A,0,0),$i},$p.getColor=function($i,$p,$F,$J){var $A=[];if(this.data._mat&&this.data._alpha){var $t=this.data._mat,$q=this.data._alpha;$A[0]=$t[0]*$i+$t[1]*$p+$t[2]*$F+$t[3]*$J+$q[0],$A[1]=$t[4]*$i+$t[5]*$p+$t[6]*$F+$t[7]*$J+$q[1],$A[2]=$t[8]*$i+$t[9]*$p+$t[10]*$F+$t[11]*$J+$q[2],$A[3]=$t[12]*$i+$t[13]*$p+$t[14]*$F+$t[15]*$J+$q[3]}return $A},$i}(),$E=(function(){function $i(){}$x($i,"laya.maths.Arith"),$i.formatR=function($i){return $i>Math.PI&&($i-=2*Math.PI),$i<-Math.PI&&($i+=2*Math.PI),$i},$i.isPOT=function($i,$p){return 0<$i&&0==($i&$i-1)&&0<$p&&0==($p&$p-1)},$i.setMatToArray=function($i,$p){$i.a,$i.b,$i.c,$i.d,$i.tx,$i.ty,$p[0]=$i.a,$p[1]=$i.b,$p[4]=$i.c,$p[5]=$i.d,$p[12]=$i.tx,$p[13]=$i.ty}}(),function(){function $i(){this._controlPoints=[new $R,new $R,new $R],this._calFun=this.getPoint2}$x($i,"laya.maths.Bezier");var $p=$i.prototype;return $p._switchPoint=function($i,$p){var $F=this._controlPoints.shift();$F.setTo($i,$p),this._controlPoints.push($F)},$p.getPoint2=function($i,$p){var $F=this._controlPoints[0],$J=this._controlPoints[1],$A=this._controlPoints[2],$t=Math.pow(1-$i,2)*$F.x+2*$i*(1-$i)*$J.x+Math.pow($i,2)*$A.x,$q=Math.pow(1-$i,2)*$F.y+2*$i*(1-$i)*$J.y+Math.pow($i,2)*$A.y;$p.push($t,$q)},$p.getPoint3=function($i,$p){var $F=this._controlPoints[0],$J=this._controlPoints[1],$A=this._controlPoints[2],$t=this._controlPoints[3],$q=Math.pow(1-$i,3)*$F.x+3*$J.x*$i*(1-$i)*(1-$i)+3*$A.x*$i*$i*(1-$i)+$t.x*Math.pow($i,3),$B=Math.pow(1-$i,3)*$F.y+3*$J.y*$i*(1-$i)*(1-$i)+3*$A.y*$i*$i*(1-$i)+$t.y*Math.pow($i,3);$p.push($q,$B)},$p.insertPoints=function($i,$p){var $F,$J=NaN;for($F=1/($i=0<$i?$i:5),$J=0;$J<=1;$J+=$F)this._calFun($J,$p)},$p.getBezierPoints=function($i,$p,$F){void 0===$p&&($p=5),void 0===$F&&($F=2);var $J,$A,$t=0;if(($J=$i.length)<2*($F+1))return[];switch($A=[],$F){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=$F;)this._controlPoints.push(new $R);for($t=0;$t<2*$F;$t+=2)this._switchPoint($i[$t],$i[$t+1]);for($t=2*$F;$t<$J;$t+=2)this._switchPoint($i[$t],$i[$t+1]),$t/2%$F==0&&this.insertPoints($p,$A);return $A},$O($i,["I",function(){return this.I=new $i}]),$i}()),$v=function(){function $U(){}return $x($U,"laya.maths.GrahamScan"),$U.multiply=function($i,$p,$F){return($i.x-$F.x)*($p.y-$F.y)-($p.x-$F.x)*($i.y-$F.y)},$U.dis=function($i,$p){return($i.x-$p.x)*($i.x-$p.x)+($i.y-$p.y)*($i.y-$p.y)},$U._getPoints=function($i,$p,$F){for(void 0===$p&&($p=!1),$U._mPointList||($U._mPointList=[]);$U._mPointList.length<$i;)$U._mPointList.push(new $R);return $F||($F=[]),$F.length=0,$p?$U.getFrom($F,$U._mPointList,$i):$U.getFromR($F,$U._mPointList,$i),$F},$U.getFrom=function($i,$p,$F){var $J=0;for($J=0;$J<$F;$J++)$i.push($p[$J]);return $i},$U.getFromR=function($i,$p,$F){var $J=0;for($J=0;$J<$F;$J++)$i.push($p.pop());return $i},$U.pListToPointList=function($i,$p){void 0===$p&&($p=!1);var $F=0,$J=$i.length/2,$A=$U._getPoints($J,$p,$U._tempPointList);for($F=0;$F<$J;$F++)$A[$F].setTo($i[$F+$F],$i[$F+$F+1]);return $A},$U.pointListToPlist=function($i){var $p,$F=0,$J=$i.length,$A=$U._temPList;for($F=$A.length=0;$F<$J;$F++)$p=$i[$F],$A.push($p.x,$p.y);return $A},$U.scanPList=function($i){return $b.copyArray($i,$U.pointListToPlist($U.scan($U.pListToPointList($i,!0))))},$U.scan=function($i){var $p,$F,$J,$A=0,$t=0,$q=0,$B=$i.length,$O={};for(($F=$U._temArr).length=0,$A=($B=$i.length)-1;0<=$A;$A--)$J=($p=$i[$A]).x+"_"+$p.y,$O.hasOwnProperty($J)||($O[$J]=!0,$F.push($p));for($B=$F.length,$b.copyArray($i,$F),$A=1;$A<$B;$A++)($i[$A].y<$i[$q].y||$i[$A].y==$i[$q].y&&$i[$A].x<$i[$q].x)&&($q=$A);for($p=$i[0],$i[0]=$i[$q],$i[$q]=$p,$A=1;$A<$B-1;$A++){for($t=($q=$A)+1;$t<$B;$t++)(0<$U.multiply($i[$t],$i[$q],$i[0])||0==$U.multiply($i[$t],$i[$q],$i[0])&&$U.dis($i[0],$i[$t])<$U.dis($i[0],$i[$q]))&&($q=$t);$p=$i[$A],$i[$A]=$i[$q],$i[$q]=$p}if(($F=$U._temArr).length=0,$i.length<3)return $b.copyArray($F,$i);for($F.push($i[0],$i[1],$i[2]),$A=3;$A<$B;$A++){for(;2<=$F.length&&0<=$U.multiply($i[$A],$F[$F.length-1],$F[$F.length-2]);)$F.pop();$i[$A]&&$F.push($i[$A])}return $F},$U._mPointList=null,$U._tempPointList=[],$U._temPList=[],$U._temArr=[],$U}(),$g=function(){function $A(){}return $x($A,"laya.maths.MathUtil"),$A.subtractVector3=function($i,$p,$F){$F[0]=$i[0]-$p[0],$F[1]=$i[1]-$p[1],$F[2]=$i[2]-$p[2]},$A.lerp=function($i,$p,$F){return $i*(1-$F)+$p*$F},$A.scaleVector3=function($i,$p,$F){$F[0]=$i[0]*$p,$F[1]=$i[1]*$p,$F[2]=$i[2]*$p},$A.lerpVector3=function($i,$p,$F,$J){var $A=$i[0],$t=$i[1],$q=$i[2];$J[0]=$A+$F*($p[0]-$A),$J[1]=$t+$F*($p[1]-$t),$J[2]=$q+$F*($p[2]-$q)},$A.lerpVector4=function($i,$p,$F,$J){var $A=$i[0],$t=$i[1],$q=$i[2],$B=$i[3];$J[0]=$A+$F*($p[0]-$A),$J[1]=$t+$F*($p[1]-$t),$J[2]=$q+$F*($p[2]-$q),$J[3]=$B+$F*($p[3]-$B)},$A.slerpQuaternionArray=function($i,$p,$F,$J,$A,$t,$q){var $B,$O,$U,$d,$u,$S=$i[$p+0],$Z=$i[$p+1],$s=$i[$p+2],$x=$i[$p+3],$j=$F[$J+0],$r=$F[$J+1],$M=$F[$J+2],$D=$F[$J+3];return($O=$S*$j+$Z*$r+$s*$M+$x*$D)<0&&($O=-$O,$j=-$j,$r=-$r,$M=-$M,$D=-$D),$u=1e-6<1-$O?($B=Math.acos($O),$U=Math.sin($B),$d=Math.sin((1-$A)*$B)/$U,Math.sin($A*$B)/$U):($d=1-$A,$A),$t[$q+0]=$d*$S+$u*$j,$t[$q+1]=$d*$Z+$u*$r,$t[$q+2]=$d*$s+$u*$M,$t[$q+3]=$d*$x+$u*$D,$t},$A.getRotation=function($i,$p,$F,$J){return Math.atan2($J-$p,$F-$i)/Math.PI*180},$A.sortBigFirst=function($i,$p){return $i==$p?0:$i<$p?1:-1},$A.sortSmallFirst=function($i,$p){return $i==$p?0:$i<$p?-1:1},$A.sortNumBigFirst=function($i,$p){return parseFloat($p)-parseFloat($i)},$A.sortNumSmallFirst=function($i,$p){return parseFloat($i)-parseFloat($p)},$A.sortByKey=function($F,$i,$p){var $J;return void 0===$i&&($i=!1),void 0===$p&&($p=!0),$J=$i?$p?$A.sortNumBigFirst:$A.sortBigFirst:$p?$A.sortNumSmallFirst:$A.sortSmallFirst,function($i,$p){return $J($i[$F],$p[$F])}},$A}(),$m=function(){function $F($i,$p,$F,$J,$A,$t){this.inPool=!1,this.bTransform=!1,void 0===$i&&($i=1),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=1),void 0===$A&&($A=0),void 0===$t&&($t=0),this.a=$i,this.b=$p,this.c=$F,this.d=$J,this.tx=$A,this.ty=$t,this._checkTransform()}$x($F,"laya.maths.Matrix");var $i=$F.prototype;return $i.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},$i._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},$i.setTranslate=function($i,$p){return this.tx=$i,this.ty=$p,this},$i.translate=function($i,$p){return this.tx+=$i,this.ty+=$p,this},$i.scale=function($i,$p){this.a*=$i,this.d*=$p,this.c*=$i,this.b*=$p,this.tx*=$i,this.ty*=$p,this.bTransform=!0},$i.rotate=function($i){var $p=Math.cos($i),$F=Math.sin($i),$J=this.a,$A=this.c,$t=this.tx;this.a=$J*$p-this.b*$F,this.b=$J*$F+this.b*$p,this.c=$A*$p-this.d*$F,this.d=$A*$F+this.d*$p,this.tx=$t*$p-this.ty*$F,this.ty=$t*$F+this.ty*$p,this.bTransform=!0},$i.skew=function($i,$p){var $F=Math.tan($i),$J=Math.tan($p),$A=this.a,$t=this.b;return this.a+=$J*this.c,this.b+=$J*this.d,this.c+=$F*$A,this.d+=$F*$t,this},$i.invertTransformPoint=function($i){var $p=this.a,$F=this.b,$J=this.c,$A=this.d,$t=this.tx,$q=$p*$A-$F*$J,$B=$A/$q,$O=-$F/$q,$U=-$J/$q,$d=$p/$q,$u=($J*this.ty-$A*$t)/$q,$S=-($p*this.ty-$F*$t)/$q;return $i.setTo($B*$i.x+$U*$i.y+$u,$O*$i.x+$d*$i.y+$S)},$i.transformPoint=function($i){return $i.setTo(this.a*$i.x+this.c*$i.y+this.tx,this.b*$i.x+this.d*$i.y+this.ty)},$i.transformPointN=function($i){return $i.setTo(this.a*$i.x+this.c*$i.y,this.b*$i.x+this.d*$i.y)},$i.transformPointArray=function($i,$p){for(var $F=$i.length,$J=0;$J<$F;$J+=2){var $A=$i[$J],$t=$i[$J+1];$p[$J]=this.a*$A+this.c*$t+this.tx,$p[$J+1]=this.b*$A+this.d*$t+this.ty}return $p},$i.transformPointArrayScale=function($i,$p){for(var $F=$i.length,$J=0;$J<$F;$J+=2){var $A=$i[$J],$t=$i[$J+1];$p[$J]=this.a*$A+this.c*$t,$p[$J+1]=this.b*$A+this.d*$t}return $p},$i.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},$i.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},$i.invert=function(){var $i=this.a,$p=this.b,$F=this.c,$J=this.d,$A=this.tx,$t=$i*$J-$p*$F;return this.a=$J/$t,this.b=-$p/$t,this.c=-$F/$t,this.d=$i/$t,this.tx=($F*this.ty-$J*$A)/$t,this.ty=-($i*this.ty-$p*$A)/$t,this},$i.setTo=function($i,$p,$F,$J,$A,$t){return this.a=$i,this.b=$p,this.c=$F,this.d=$J,this.tx=$A,this.ty=$t,this},$i.concat=function($i){var $p=this.a,$F=this.c,$J=this.tx;return this.a=$p*$i.a+this.b*$i.c,this.b=$p*$i.b+this.b*$i.d,this.c=$F*$i.a+this.d*$i.c,this.d=$F*$i.b+this.d*$i.d,this.tx=$J*$i.a+this.ty*$i.c+$i.tx,this.ty=$J*$i.b+this.ty*$i.d+$i.ty,this},$i.scaleEx=function($i,$p){var $F=this.a,$J=this.b,$A=this.c,$t=this.d;0!==$J||0!==$A?(this.a=$i*$F,this.b=$i*$J,this.c=$p*$A):(this.a=$i*$F,this.b=0*$t,this.c=0*$F),this.d=$p*$t,this.bTransform=!0},$i.rotateEx=function($i){var $p=Math.cos($i),$F=Math.sin($i),$J=this.a,$A=this.b,$t=this.c,$q=this.d;0!==$A||0!==$t?(this.a=$p*$J+$F*$t,this.b=$p*$A+$F*$q,this.c=-$F*$J+$p*$t,this.d=-$F*$A+$p*$q):(this.a=$p*$J,this.b=$F*$q,this.c=-$F*$J,this.d=$p*$q),this.bTransform=!0},$i.clone=function(){var $i=$F.create();return $i.a=this.a,$i.b=this.b,$i.c=this.c,$i.d=this.d,$i.tx=this.tx,$i.ty=this.ty,$i.bTransform=this.bTransform,$i},$i.copyTo=function($i){return $i.a=this.a,$i.b=this.b,$i.c=this.c,$i.d=this.d,$i.tx=this.tx,$i.ty=this.ty,$i.bTransform=this.bTransform,$i},$i.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},$i.destroy=function(){if(!this.inPool){var $i=$F._cache;this.inPool=!0,$i._length||($i._length=0),($i[$i._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},$F.mul=function($i,$p,$F){var $J=$i.a,$A=$i.b,$t=$i.c,$q=$i.d,$B=$i.tx,$O=$i.ty,$U=$p.a,$d=$p.b,$u=$p.c,$S=$p.d,$Z=$p.tx,$s=$p.ty;return 0!==$d||0!==$u?($F.a=$J*$U+$A*$u,$F.b=$J*$d+$A*$S,$F.c=$t*$U+$q*$u,$F.d=$t*$d+$q*$S,$F.tx=$U*$B+$u*$O+$Z,$F.ty=$d*$B+$S*$O+$s):($F.a=$J*$U,$F.b=$A*$S,$F.c=$t*$U,$F.d=$q*$S,$F.tx=$U*$B+$Z,$F.ty=$S*$O+$s),$F},$F.mul16=function($i,$p,$F){var $J=$i.a,$A=$i.b,$t=$i.c,$q=$i.d,$B=$i.tx,$O=$i.ty,$U=$p.a,$d=$p.b,$u=$p.c,$S=$p.d,$Z=$p.tx,$s=$p.ty;return 0!==$d||0!==$u?($F[0]=$J*$U+$A*$u,$F[1]=$J*$d+$A*$S,$F[4]=$t*$U+$q*$u,$F[5]=$t*$d+$q*$S,$F[12]=$U*$B+$u*$O+$Z,$F[13]=$d*$B+$S*$O+$s):($F[0]=$J*$U,$F[1]=$A*$S,$F[4]=$t*$U,$F[5]=$q*$S,$F[12]=$U*$B+$Z,$F[13]=$S*$O+$s),$F},$F.mulPre=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=$i.a,$U=$i.b,$d=$i.c,$u=$i.d,$S=$i.tx,$Z=$i.ty;return 0!==$F||0!==$J?($B.a=$O*$p+$U*$J,$B.b=$O*$F+$U*$A,$B.c=$d*$p+$u*$J,$B.d=$d*$F+$u*$A,$B.tx=$p*$S+$J*$Z+$t,$B.ty=$F*$S+$A*$Z+$q):($B.a=$O*$p,$B.b=$U*$A,$B.c=$d*$p,$B.d=$u*$A,$B.tx=$p*$S+$t,$B.ty=$A*$Z+$q),$B},$F.mulPos=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=$i.a,$U=$i.b,$d=$i.c,$u=$i.d,$S=$i.tx,$Z=$i.ty;return 0!==$U||0!==$d?($B.a=$p*$O+$F*$d,$B.b=$p*$U+$F*$u,$B.c=$J*$O+$A*$d,$B.d=$J*$U+$A*$u,$B.tx=$O*$t+$d*$q+$S,$B.ty=$U*$t+$u*$q+$Z):($B.a=$p*$O,$B.b=$F*$u,$B.c=$J*$O,$B.d=$A*$u,$B.tx=$O*$t+$S,$B.ty=$u*$q+$Z),$B},$F.preMul=function($i,$p,$F){var $J=$i.a,$A=$i.b,$t=$i.c,$q=$i.d,$B=$p.a,$O=$p.b,$U=$p.c,$d=$p.d,$u=$p.tx,$S=$p.ty;return $F.a=$B*$J,$F.b=$F.c=0,$F.d=$d*$q,$F.tx=$u*$J+$i.tx,$F.ty=$S*$q+$i.ty,0===$O&&0===$U&&0===$A&&0===$t||($F.a+=$O*$t,$F.d+=$U*$A,$F.b+=$B*$A+$O*$q,$F.c+=$U*$J+$d*$t,$F.tx+=$S*$t,$F.ty+=$u*$A),$F},$F.preMulXY=function($i,$p,$F,$J){var $A=$i.a,$t=$i.b,$q=$i.c,$B=$i.d;return $J.a=$A,$J.b=$t,$J.c=$q,$J.d=$B,$J.tx=$p*$A+$i.tx+$F*$q,$J.ty=$F*$B+$i.ty+$p*$t,$J},$F.create=function(){var $i=$F._cache,$p=$i._length?$i[--$i._length]:new $F;return $p.inPool=!1,$p},$F.EMPTY=new $F,$F.TEMP=new $F,$F._cache=[],$F}(),$R=function(){function $i($i,$p){void 0===$i&&($i=0),void 0===$p&&($p=0),this.x=$i,this.y=$p}$x($i,"laya.maths.Point");var $p=$i.prototype;return $p.setTo=function($i,$p){return this.x=$i,this.y=$p,this},$p.distance=function($i,$p){return Math.sqrt((this.x-$i)*(this.x-$i)+(this.y-$p)*(this.y-$p))},$p.toString=function(){return this.x+","+this.y},$p.normalize=function(){var $i=Math.sqrt(this.x*this.x+this.y*this.y);if(0<$i){var $p=1/$i;this.x*=$p,this.y*=$p}},$i.TEMP=new $i,$i.EMPTY=new $i,$i}(),$Q=function(){function $U($i,$p,$F,$J){void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),this.x=$i,this.y=$p,this.width=$F,this.height=$J}$x($U,"laya.maths.Rectangle");var $i=$U.prototype;return $i.setTo=function($i,$p,$F,$J){return this.x=$i,this.y=$p,this.width=$F,this.height=$J,this},$i.copyFrom=function($i){return this.x=$i.x,this.y=$i.y,this.width=$i.width,this.height=$i.height,this},$i.contains=function($i,$p){return!(this.width<=0||this.height<=0)&&($i>=this.x&&$i<this.right&&$p>=this.y&&$p<this.bottom)},$i.intersects=function($i){return!($i.x>this.x+this.width||$i.x+$i.width<this.x||$i.y>this.y+this.height||$i.y+$i.height<this.y)},$i.intersection=function($i,$p){return this.intersects($i)?($p||($p=new $U),$p.x=Math.max(this.x,$i.x),$p.y=Math.max(this.y,$i.y),$p.width=Math.min(this.right,$i.right)-$p.x,$p.height=Math.min(this.bottom,$i.bottom)-$p.y,$p):null},$i.union=function($i,$p){return $p||($p=new $U),this.clone($p),$i.width<=0||$i.height<=0?$p:($p.addPoint($i.x,$i.y),$p.addPoint($i.right,$i.bottom),this)},$i.clone=function($i){return $i||($i=new $U),$i.x=this.x,$i.y=this.y,$i.width=this.width,$i.height=this.height,$i},$i.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},$i.equals=function($i){return!(!$i||$i.x!==this.x||$i.y!==this.y||$i.width!==this.width||$i.height!==this.height)},$i.addPoint=function($i,$p){return this.x>$i&&(this.width+=this.x-$i,this.x=$i),this.y>$p&&(this.height+=this.y-$p,this.y=$p),this.width<$i-this.x&&(this.width=$i-this.x),this.height<$p-this.y&&(this.height=$p-this.y),this},$i._getBoundPoints=function(){var $i=$U._temB;return($i.length=0)==this.width||0==this.height||$i.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),$i},$i.isEmpty=function(){return this.width<=0||this.height<=0},$d(0,$i,"right",function(){return this.x+this.width}),$d(0,$i,"bottom",function(){return this.y+this.height}),$U._getBoundPointS=function($i,$p,$F,$J){var $A=$U._temA;return($A.length=0)==$F||0==$J||$A.push($i,$p,$i+$F,$p,$i,$p+$J,$i+$F,$p+$J),$A},$U._getWrapRec=function($i,$p){if(!$i||$i.length<1)return $p?$p.setTo(0,0,0,0):$U.TEMP.setTo(0,0,0,0);$p=$p||new $U;var $F,$J,$A,$t,$q,$B=$i.length,$O=$R.TEMP;for($A=$q=-($J=$t=99999),$F=0;$F<$B;$F+=2)$O.x=$i[$F],$O.y=$i[$F+1],$J=$J<$O.x?$J:$O.x,$t=$t<$O.y?$t:$O.y,$A=$A>$O.x?$A:$O.x,$q=$q>$O.y?$q:$O.y;return $p.setTo($J,$t,$A-$J,$q-$t)},$U.EMPTY=new $U,$U.TEMP=new $U,$U._temB=[],$U._temA=[],$U}(),$c=function(){function $O(){}return $x($O,"laya.media.SoundManager"),$d(1,$O,"useAudioMusic",function(){return $O._useAudioMusic},function($i){$O._useAudioMusic=$i,$O._musicClass=$i?$Fi:null}),$d(1,$O,"autoStopMusic",function(){return $O._autoStopMusic},function($i){$a.stage.off("blur",null,$O._stageOnBlur),$a.stage.off("focus",null,$O._stageOnFocus),$a.stage.off("visibilitychange",null,$O._visibilityChange),($O._autoStopMusic=$i)&&($a.stage.on("blur",null,$O._stageOnBlur),$a.stage.on("focus",null,$O._stageOnFocus),$a.stage.on("visibilitychange",null,$O._visibilityChange))}),$d(1,$O,"muted",function(){return $O._muted},function($i){$i!=$O._muted&&($i&&$O.stopAllSound(),$O.musicMuted=$i,$O._muted=$i)}),$d(1,$O,"musicMuted",function(){return $O._musicMuted},function($i){$i!=$O._musicMuted&&($i?($O._tMusic&&$O._musicChannel&&!$O._musicChannel.isStopped?$O._musicChannel.pause():$O._musicChannel=null,$O._musicMuted=$i):($O._musicMuted=$i,$O._tMusic&&$O._musicChannel&&$O._musicChannel.resume()))}),$d(1,$O,"soundMuted",function(){return $O._soundMuted},function($i){$O._soundMuted=$i}),$O.addChannel=function($i){0<=$O._channels.indexOf($i)||($O._channels.push($i),$O.autoReleaseSound&&0!=$O._notUsedCount&&$O._notUsedUrls[$i.url]&&(delete $O._notUsedUrls[$i.url],0==--$O._notUsedCount&&$a.timer.clear($O,$O.disposeSoundIfNotUsed)))},$O.removeChannel=function($i){var $p=$O._channels,$F=$p.indexOf($i);if(-1!=$F&&($p.splice($F,1),$O.autoReleaseSound)){var $J=$i.url,$A=$O.defaultIntervals[$J]||2e4;if(0<$A){var $t=!0;for($F=$p.length-1;0<=$F;$F--)if($p[$F].url==$J){$t=!1;break}$t&&($O._notUsedUrls[$J]=Date.now()+$A,0==$O._notUsedCount++&&$a.timer.loop(1e4,$O,$O.disposeSoundIfNotUsed))}}},$O.disposeSoundIfNotUsed=function(){var $i=$O._notUsedUrls;if(0!=$O._notUsedCount){var $p=Date.now();for(var $F in $i)$p>=$i[$F]&&(delete $i[$F],--$O._notUsedCount,$O.destroySound($F));if(0!=$O._notUsedCount)return}$a.timer.clear($O,$O.disposeSoundIfNotUsed)},$O._visibilityChange=function(){$a.stage.isVisibility?$O._stageOnFocus():$O._stageOnBlur()},$O._stageOnBlur=function(){$O._isActive=!1,$O._musicChannel&&($O._musicChannel.isStopped||($O._blurPaused=!0,$O._musicChannel.pause())),$O.stopAllSound(),$a.stage.once("mousedown",null,$O._stageOnFocus)},$O._recoverWebAudio=function(){$ti.ctx&&"running"!=$ti.ctx.state&&$ti.ctx.resume&&$ti.ctx.resume()},$O._stageOnFocus=function(){if($O._isActive=!0,$O._recoverWebAudio(),$a.stage.off("mousedown",null,$O._stageOnFocus),$O._blurPaused){var $i=$O._musicChannel;$i&&$O._music&&$i.isStopped&&($O._blurPaused=!1,$O._music._disposed?$O.playMusic($i.url,$i.loops,$i.startHandler,$i.completeHandler,$i.startTime):$i.audioBuffer?$i.resume():$O._music.play($i.startTime,$i.loops,$i.startHandler,$i))}},$O.playSound=function($i,$p,$F,$J,$A,$t){if(void 0===$p&&($p=1),void 0===$t&&($t=0),!$i)return null;if($O._muted)return null;if($O._recoverWebAudio(),$i==$O._tMusic){if($O._musicMuted)return null}else{if(!$O._isActive)return null;if($O._soundMuted)return null}var $q,$B=$O._pool[$i];return $A||($A=$O._soundClass),$B||(($B=new $A).load($i),$O._pool[$i]=$B),($q=$B.play($t,$p,$F))?($i==$O._tMusic&&($O._music=$B,$O._isActive||($O._blurPaused=!0,$q.pause())),$q.url=$i,$q.volume=$i==$O._tMusic?$O.musicVolume:$O.soundVolume,$q.completeHandler=$J,$q):null},$O.destroySound=function($i){var $p=$O._pool[$i];$p&&(delete $O._pool[$i],$p.dispose())},$O.playMusic=function($i,$p,$F,$J,$A){return void 0===$p&&($p=0),void 0===$A&&($A=0),$O._tMusic=$i,$O._musicChannel&&$O._musicChannel.stop(),$O._musicChannel=$O.playSound($i,$p,$F,$J,null,$A)},$O.stopSound=function($i){for(var $p,$F=$O._channels.length-1;0<=$F;$F--)($p=$O._channels[$F]).url==$i&&$p.stop()},$O.stopAll=function(){$O._tMusic=null;var $i=0;for($i=$O._channels.length-1;0<=$i;$i--)$O._channels[$i].stop()},$O.stopAllSound=function(){var $i,$p=0;for($p=$O._channels.length-1;0<=$p;$p--)($i=$O._channels[$p]).url!=$O._tMusic&&$i.stop()},$O.stopMusic=function(){$O._musicChannel&&$O._musicChannel.stop(),$O._tMusic=null},$O.setSoundVolume=function($i,$p){if($p)$O._setVolume($p,$i);else{$O.soundVolume=$i;var $F,$J=0;for($J=$O._channels.length-1;0<=$J;$J--)($F=$O._channels[$J]).url!=$O._tMusic&&($F.volume=$i)}},$O.setMusicVolume=function($i){$O.musicVolume=$i,$O._setVolume($O._tMusic,$i)},$O._setVolume=function($i,$p){for(var $F,$J=$O._channels.length-1;0<=$J;$J--)($F=$O._channels[$J]).url==$i&&($F.volume=$p)},$O.musicVolume=1,$O.soundVolume=1,$O.playbackRate=1,$O._useAudioMusic=!0,$O._muted=!1,$O._soundMuted=!1,$O._musicMuted=!1,$O._tMusic=null,$O._musicChannel=null,$O._music=null,$O._channels=[],$O._autoStopMusic=!1,$O._blurPaused=!1,$O._isActive=!0,$O._soundClass=null,$O._musicClass=null,$O.autoReleaseSound=!0,$O._pool={},$O.defaultIntervals={},$O._notUsedUrls={},$O._notUsedCount=0,$O}(),$P=function(){var $i;function $F(){}return $x($F,"laya.net.LocalStorage"),$F.__init__=function(){$F._baseClass||($F._baseClass=$i).init(),$F.items=$F._baseClass.items,$F.support=$F._baseClass.support},$F.setItem=function($i,$p){$F._baseClass.setItem($i,$p)},$F.getItem=function($i){return $F._baseClass.getItem($i)},$F.setJSON=function($i,$p){$F._baseClass.setJSON($i,$p)},$F.getJSON=function($i){return $F._baseClass.getJSON($i)},$F.removeItem=function($i){$F._baseClass.removeItem($i)},$F.clear=function(){$F._baseClass.clear()},$F._baseClass=null,$F.items=null,$F.support=!1,$F.__init$=function(){$i=function(){function $F(){}return $x($F,""),$F.init=function(){try{$F.support=!0,$F.items=$q.localStorage,$F.setItem("laya","1"),$F.removeItem("laya")}catch($i){$F.support=!1}$F.support||console.log("LocalStorage is not supprot or browser is private mode.")},$F.setItem=function($i,$p){try{$F.support&&$F.items.setItem($i,$p)}catch($i){console.warn("set localStorage failed",$i)}},$F.getItem=function($i){return $F.support?$F.items.getItem($i):null},$F.setJSON=function($i,$p){try{$F.support&&$F.items.setItem($i,JSON.stringify($p))}catch($i){console.warn("set localStorage failed",$i)}},$F.getJSON=function($i){return JSON.parse($F.support?$F.items.getItem($i):null)},$F.removeItem=function($i){$F.support&&$F.items.removeItem($i)},$F.clear=function(){$F.support&&$F.items.clear()},$F.items=null,$F.support=!1,$F}()},$F}(),$n=(function(){function $J(){}$x($J,"laya.net.ResourceVersion"),$J.enable=function($i,$p,$F){void 0===$F&&($F=2),laya.net.ResourceVersion.type=$F,$a.loader.load($i,$M.create(null,$J.onManifestLoaded,[$p]),null,"json"),$I.customFormat=$J.addVersionPrefix},$J.onManifestLoaded=function($i,$p){$J.manifest=$p,$i.run(),$p||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},$J.addVersionPrefix=function($i){return $J.manifest&&$J.manifest[$i]?2==$J.type?$J.manifest[$i]:$J.manifest[$i]+"/"+$i:$i},$J.FOLDER_VERSION=1,$J.FILENAME_VERSION=2,$J.manifest=null,$J.type=1}(),function(){function $i(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}$x($i,"laya.net.TTFLoader");var $p=$i.prototype;return $p.load=function($i){var $p=(this._url=$i).split(".ttf")[0].split("/");this.fontName=$p[$p.length-1],$o.window.conch?this._loadConch():$o.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},$p._loadConch=function(){this._http=new $qi,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},$p._onHttpLoaded=function($i){$o.window.conch.setFontFaceFromBuffer(this.fontName,$i),this._clearHttp(),this._complete()},$p._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},$p._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},$p._complete=function(){$a.timer.clear(this,this._complete),$a.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},$p._checkComplete=function(){$h.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},$p._loadWithFontFace=function(){var $i=new $o.window.FontFace(this.fontName,"url('"+this._url+"')");$o.window.document.fonts.add($i);var $p=this;$i.loaded.then(function(){$p._complete()}),$i.load()},$p._createDiv=function(){this._div=$o.createElement("div"),this._div.innerHTML="laya";var $i=this._div.style;$i.fontFamily=this.fontName,$i.position="absolute",$i.left="-100px",$i.top="-100px",$o.document.body.appendChild(this._div)},$p._loadWithCSS=function(){var $i=this,$p=$o.createElement("style");$p.type="text/css",$o.document.body.appendChild($p),$p.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=$h.measureText("LayaTTFFont",this._fontTxt).width;var $F=this;$p.onload=function(){$a.timer.once(1e4,$F,$i._complete)},$a.timer.loop(20,this,this._checkComplete),this._createDiv()},$i._testString="LayaTTFFont",$i}()),$I=function(){function $J($i){this._url=null,this._path=null,this._url=$J.formatURL($i),this._path=$J.getPath($i)}$x($J,"laya.net.URL");var $i=$J.prototype;return $d(0,$i,"path",function(){return this._path}),$d(0,$i,"url",function(){return this._url}),$J.formatURL=function($i,$p){if(!$i)return"null path";if(0<$i.indexOf(":"))return $i;null!=$J.customFormat&&($i=$J.customFormat($i,$p));var $F=$i.charAt(0);if("."===$F)return $J.formatRelativePath(($p||$J.basePath)+$i);if("~"===$F)return $J.rootPath+$i.substring(1);if("d"===$F){if(0===$i.indexOf("data:image"))return $i}else if("/"===$F)return $i;return($p||$J.basePath)+$i},$J.formatRelativePath=function($i){for(var $p=$i.split("/"),$F=0,$J=$p.length;$F<$J;$F++)".."==$p[$F]&&($p.splice($F-1,2),$F-=2);return $p.join("/")},$J.isAbsolute=function($i){return 0<$i.indexOf(":")||"/"==$i.charAt(0)},$J.getPath=function($i){var $p=$i.lastIndexOf("/");return 0<$p?$i.substr(0,$p+1):""},$J.getFileName=function($i){var $p=$i.lastIndexOf("/");return 0<$p?$i.substr($p+1):$i},$J.version={},$J.basePath="",$J.rootPath="",$J.customFormat=function($i){var $p=$J.version[$i];return!$G.isConchApp&&$p&&($i+="?v="+$p),$i},$J}(),$G=function(){function $A($i,$p){this._timeId=0;var $F=$A._mainCanvas.source.style;$F.position="absolute",$F.top=$F.left="0px",$F.background="#000000",$A._mainCanvas.source.id="layaCanvas";var $J=laya.renders.Render.isWebGL;$A._mainCanvas.source.width=$i,$A._mainCanvas.source.height=$p,$J&&$A.WebGL.init($A._mainCanvas,$i,$p),$o.container.appendChild($A._mainCanvas.source),($A._context=new $_($i,$p,$J?null:$A._mainCanvas)).ctx.setIsMainContext(),$o.window.requestAnimationFrame(function $i($p){$o.window.requestAnimationFrame($i);$a.stage._loop()}),$a.stage.on("visibilitychange",this,this._onVisibilitychange)}$x($A,"laya.renders.Render");var $i=$A.prototype;return $i._onVisibilitychange=function(){$a.stage.isVisibility?0!=this._timeId&&$o.window.clearInterval(this._timeId):this._timeId=$o.window.setInterval(this._enterFrame,1e3)},$i._enterFrame=function($i){$a.stage._loop()},$d(1,$A,"context",function(){return $A._context}),$d(1,$A,"canvas",function(){return $A._mainCanvas.source}),$A._context=null,$A._mainCanvas=null,$A.WebGL=null,$A.isConchNode=!1,$A.isConchApp=!1,$A.isConchWebGL=!1,$A.isWebGL=!1,$A.is3DMode=!1,$A.optimizeTextureMemory=function($i,$p){return!0},$A.__init$=function(){$q.ConchRenderType=$q.ConchRenderType||1,$q.ConchRenderType|=$q.conch?4:0,$A.isConchNode=5==(5&$q.ConchRenderType),$A.isConchApp=4==(4&$q.ConchRenderType),$A.isConchWebGL=6==$q.ConchRenderType},$A}(),$_=function(){function $q($i,$p,$F){this.x=0,this.y=0,this._drawTexture=function($i,$p,$F){$F[0].loaded&&this.ctx.drawTexture($F[0],$F[1],$F[2],$F[3],$F[4],$i,$p)},this._fillTexture=function($i,$p,$F){$F[0].loaded&&this.ctx.fillTexture($F[0],$F[1]+$i,$F[2]+$p,$F[3],$F[4],$F[5],$F[6],$F[7])},this._drawTextureWithTransform=function($i,$p,$F){$F[0].loaded&&this.ctx.drawTextureWithTransform($F[0],$F[1],$F[2],$F[3],$F[4],$F[5],$i,$p,$F[6])},this._fillQuadrangle=function($i,$p,$F){this.ctx.fillQuadrangle($F[0],$F[1],$F[2],$F[3],$F[4])},this._drawRect=function($i,$p,$F){var $J=this.ctx;null!=$F[4]&&($J.fillStyle=$F[4],$J.fillRect($i+$F[0],$p+$F[1],$F[2],$F[3],null)),null!=$F[5]&&($J.strokeStyle=$F[5],$J.lineWidth=$F[6],$J.strokeRect($i+$F[0],$p+$F[1],$F[2],$F[3],$F[6]))},this._drawPie=function($i,$p,$F){var $J=this.ctx;$G.isWebGL&&$J.setPathId($F[8]),$J.beginPath(),$G.isWebGL?($J.movePath($F[0]+$i,$F[1]+$p),$J.moveTo(0,0)):$J.moveTo($i+$F[0],$p+$F[1]),$J.arc($i+$F[0],$p+$F[1],$F[2],$F[3],$F[4]),$J.closePath(),this._fillAndStroke($F[5],$F[6],$F[7],!0)},this._clipRect=function($i,$p,$F){this.ctx.clipRect($i+$F[0],$p+$F[1],$F[2],$F[3])},this._fillRect=function($i,$p,$F){this.ctx.fillRect($i+$F[0],$p+$F[1],$F[2],$F[3],$F[4])},this._drawCircle=function($i,$p,$F){var $J=this.ctx;$G.isWebGL&&$J.setPathId($F[6]),$$.drawCall++,$J.beginPath(),$G.isWebGL&&$J.movePath($F[0]+$i,$F[1]+$p),$J.arc($F[0]+$i,$F[1]+$p,$F[2],0,$q.PI2),$J.closePath(),this._fillAndStroke($F[3],$F[4],$F[5],!0)},this._fillCircle=function($i,$p,$F){$$.drawCall++;var $J=this.ctx;$J.beginPath(),$J.fillStyle=$F[3],$J.arc($F[0]+$i,$F[1]+$p,$F[2],0,$q.PI2),$J.fill()},this._setShader=function($i,$p,$F){this.ctx.setShader($F[0])},this._drawLine=function($i,$p,$F){var $J=this.ctx;$G.isWebGL&&$J.setPathId($F[6]),$J.beginPath(),$J.strokeStyle=$F[4],$J.lineWidth=$F[5],$G.isWebGL?($J.movePath($i,$p),$J.moveTo($F[0],$F[1]),$J.lineTo($F[2],$F[3])):($J.moveTo($i+$F[0],$p+$F[1]),$J.lineTo($i+$F[2],$p+$F[3])),$J.stroke()},this._drawLines=function($i,$p,$F){var $J=this.ctx;$G.isWebGL&&$J.setPathId($F[5]),$J.beginPath(),$i+=$F[0],$p+=$F[1],$G.isWebGL&&$J.movePath($i,$p),$J.strokeStyle=$F[3],$J.lineWidth=$F[4];var $A=$F[2],$t=2,$q=$A.length;if($G.isWebGL)for($J.moveTo($A[0],$A[1]);$t<$q;)$J.lineTo($A[$t++],$A[$t++]);else for($J.moveTo($i+$A[0],$p+$A[1]);$t<$q;)$J.lineTo($i+$A[$t++],$p+$A[$t++]);$J.stroke()},this._drawLinesWebGL=function($i,$p,$F){this.ctx.drawLines($i+this.x+$F[0],$p+this.y+$F[1],$F[2],$F[3],$F[4])},this._drawCurves=function($i,$p,$F){this.ctx.drawCurves($i,$p,$F)},this._draw=function($i,$p,$F){$F[0].call(null,this,$i,$p)},this._transformByMatrix=function($i,$p,$F){this.ctx.transformByMatrix($F[0])},this._setTransform=function($i,$p,$F){this.ctx.setTransform($F[0],$F[1],$F[2],$F[3],$F[4],$F[5])},this._setTransformByMatrix=function($i,$p,$F){this.ctx.setTransformByMatrix($F[0])},this._save=function($i,$p,$F){this.ctx.save()},this._restore=function($i,$p,$F){this.ctx.restore()},this._translate=function($i,$p,$F){this.ctx.translate($F[0],$F[1])},this._transform=function($i,$p,$F){this.ctx.translate($F[1]+$i,$F[2]+$p);var $J=$F[0];this.ctx.transform($J.a,$J.b,$J.c,$J.d,$J.tx,$J.ty),this.ctx.translate(-$i-$F[1],-$p-$F[2])},this._rotate=function($i,$p,$F){this.ctx.translate($F[1]+$i,$F[2]+$p),this.ctx.rotate($F[0]),this.ctx.translate(-$i-$F[1],-$p-$F[2])},this._scale=function($i,$p,$F){this.ctx.translate($F[2]+$i,$F[3]+$p),this.ctx.scale($F[0],$F[1]),this.ctx.translate(-$i-$F[2],-$p-$F[3])},this._alpha=function($i,$p,$F){this.ctx.globalAlpha*=$F[0]},this._setAlpha=function($i,$p,$F){this.ctx.globalAlpha=$F[0]},this._fillText=function($i,$p,$F){this.ctx.fillText($F[0],$F[1]+$i,$F[2]+$p,$F[3],$F[4],$F[5])},this._strokeText=function($i,$p,$F){this.ctx.strokeText($F[0],$F[1]+$i,$F[2]+$p,$F[3],$F[4],$F[5],$F[6])},this._fillBorderText=function($i,$p,$F){this.ctx.fillBorderText($F[0],$F[1]+$i,$F[2]+$p,$F[3],$F[4],$F[5],$F[6],$F[7])},this._blendMode=function($i,$p,$F){this.ctx.globalCompositeOperation=$F[0]},this._beginClip=function($i,$p,$F){this.ctx.beginClip&&this.ctx.beginClip($i+$F[0],$p+$F[1],$F[2],$F[3])},this._setIBVB=function($i,$p,$F){this.ctx.setIBVB($F[0]+$i,$F[1]+$p,$F[2],$F[3],$F[4],$F[5],$F[6],$F[7])},this._fillTrangles=function($i,$p,$F){this.ctx.fillTrangles($F[0],$F[1]+$i,$F[2]+$p,$F[3],$F[4])},this._drawPath=function($i,$p,$F){var $J=this.ctx;$G.isWebGL&&$J.setPathId(-1),$J.beginPath(),$i+=$F[0],$p+=$F[1],$G.isWebGL&&$J.movePath($i,$p);for(var $A=$F[2],$t=0,$q=$A.length;$t<$q;$t++){var $B=$A[$t];switch($B[0]){case"moveTo":$G.isWebGL?$J.moveTo($B[1],$B[2]):$J.moveTo($i+$B[1],$p+$B[2]);break;case"lineTo":$G.isWebGL?$J.lineTo($B[1],$B[2]):$J.lineTo($i+$B[1],$p+$B[2]);break;case"arcTo":$G.isWebGL?$J.arcTo($B[1],$B[2],$B[3],$B[4],$B[5]):$J.arcTo($i+$B[1],$p+$B[2],$i+$B[3],$p+$B[4],$B[5]);break;case"closePath":$J.closePath()}}var $O=$F[3];null!=$O&&($J.fillStyle=$O.fillStyle,$J.fill());var $U=$F[4];null!=$U&&($J.strokeStyle=$U.strokeStyle,$J.lineWidth=$U.lineWidth||1,$J.lineJoin=$U.lineJoin,$J.lineCap=$U.lineCap,$J.miterLimit=$U.miterLimit,$J.stroke())},this.drawPoly=function($i,$p,$F){this.ctx.drawPoly($i+this.x+$F[0],$p+this.y+$F[1],$F[2],$F[3],$F[4],$F[5],$F[6])},this._drawPoly=function($i,$p,$F){var $J=this.ctx,$A=$F[2],$t=2,$q=$A.length;if($G.isWebGL)for($J.setPathId($F[6]),$J.beginPath(),$i+=$F[0],$p+=$F[1],$J.movePath($i,$p),$J.moveTo($A[0],$A[1]);$t<$q;)$J.lineTo($A[$t++],$A[$t++]);else for($J.beginPath(),$i+=$F[0],$p+=$F[1],$J.moveTo($i+$A[0],$p+$A[1]);$t<$q;)$J.lineTo($i+$A[$t++],$p+$A[$t++]);$J.closePath(),this._fillAndStroke($F[3],$F[4],$F[5],$F[7])},this._drawSkin=function($i,$p,$F){var $J=$F[0];if($J){var $A=this.ctx;$J.render($A,$i,$p)}},this._drawParticle=function($i,$p,$F){this.ctx.drawParticle($i+this.x,$p+this.y,$F[0])},this._setFilters=function($i,$p,$F){this.ctx.setFilters($F)},$F?this.ctx=$F.getContext("2d"):($F=$Di.create("3D"),this.ctx=$h.createWebGLContext2D($F),$F._setContext(this.ctx)),$F.size($i,$p),this.canvas=$F}$x($q,"laya.renders.RenderContext");var $i=$q.prototype;return $i.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},$i.drawTexture=function($i,$p,$F,$J,$A){$i.loaded&&this.ctx.drawTexture($i,$p,$F,$J,$A,this.x,this.y)},$i._drawTextures=function($i,$p,$F){$F[0].loaded&&this.ctx.drawTextures($F[0],$F[1],$i+this.x,$p+this.y)},$i.drawTextureWithTransform=function($i,$p,$F,$J,$A,$t,$q){$i.loaded&&this.ctx.drawTextureWithTransform($i,$p,$F,$J,$A,$t,this.x,this.y,$q)},$i.fillQuadrangle=function($i,$p,$F,$J,$A){this.ctx.fillQuadrangle($i,$p,$F,$J,$A)},$i.drawCanvas=function($i,$p,$F,$J,$A){this.ctx.drawCanvas($i,$p+this.x,$F+this.y,$J,$A)},$i.drawRect=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=1);var $q=this.ctx;$q.strokeStyle=$A,$q.lineWidth=$t,$q.strokeRect($i+this.x,$p+this.y,$F,$J,$t)},$i._fillAndStroke=function($i,$p,$F,$J){void 0===$J&&($J=!1);var $A=this.ctx;null!=$i&&($A.fillStyle=$i,$G.isWebGL?$A.fill($J):$A.fill()),null!=$p&&0<$F&&($A.strokeStyle=$p,$A.lineWidth=$F,$A.stroke())},$i.clipRect=function($i,$p,$F,$J){this.ctx.clipRect($i+this.x,$p+this.y,$F,$J)},$i.fillRect=function($i,$p,$F,$J,$A){this.ctx.fillRect($i+this.x,$p+this.y,$F,$J,$A)},$i.drawCircle=function($i,$p,$F,$J,$A){void 0===$A&&($A=1),$$.drawCall++;var $t=this.ctx;$t.beginPath(),$t.strokeStyle=$J,$t.lineWidth=$A,$t.arc($i+this.x,$p+this.y,$F,0,$q.PI2),$t.stroke()},$i.drawTriangles=function($i,$p,$F){if($G.isWebGL)this.ctx.drawTriangles($F[0],$i+$F[1],$p+$F[2],$F[3],$F[4],$F[5],$F[6],$F[7],$F[8],$F[9]);else{var $J=$F[5],$A=0,$t=$J.length,$q=this.ctx;for($A=0;$A<$t;$A+=3){var $B=2*$J[$A],$O=2*$J[$A+1],$U=2*$J[$A+2];$q.drawTriangle($F[0],$F[3],$F[4],$B,$O,$U,$F[6],!0)}}},$i.fillCircle=function($i,$p,$F,$J){$$.drawCall++;var $A=this.ctx;$A.beginPath(),$A.fillStyle=$J,$A.arc($i+this.x,$p+this.y,$F,0,$q.PI2),$A.fill()},$i.setShader=function($i){this.ctx.setShader($i)},$i.drawLine=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=1);var $q=this.ctx;$q.beginPath(),$q.strokeStyle=$A,$q.lineWidth=$t,$q.moveTo(this.x+$i,this.y+$p),$q.lineTo(this.x+$F,this.y+$J),$q.stroke()},$i.clear=function(){this.ctx.clear()},$i.transformByMatrix=function($i){this.ctx.transformByMatrix($i)},$i.setTransform=function($i,$p,$F,$J,$A,$t){this.ctx.setTransform($i,$p,$F,$J,$A,$t)},$i.setTransformByMatrix=function($i){this.ctx.setTransformByMatrix($i)},$i.save=function(){this.ctx.save()},$i.restore=function(){this.ctx.restore()},$i.translate=function($i,$p){this.ctx.translate($i,$p)},$i.transform=function($i,$p,$F,$J,$A,$t){this.ctx.transform($i,$p,$F,$J,$A,$t)},$i.rotate=function($i){this.ctx.rotate($i)},$i.scale=function($i,$p){this.ctx.scale($i,$p)},$i.alpha=function($i){this.ctx.globalAlpha*=$i},$i.setAlpha=function($i){this.ctx.globalAlpha=$i},$i.fillWords=function($i,$p,$F,$J,$A,$t){void 0===$t&&($t=0),this.ctx.fillWords($i,$p,$F,$J,$A,$t)},$i.fillBorderWords=function($i,$p,$F,$J,$A,$t,$q){this.ctx.fillBorderWords($i,$p,$F,$J,$A,$t,$q)},$i.fillText=function($i,$p,$F,$J,$A,$t){this.ctx.fillText($i,$p+this.x,$F+this.y,$J,$A,$t)},$i.strokeText=function($i,$p,$F,$J,$A,$t,$q){this.ctx.strokeText($i,$p+this.x,$F+this.y,$J,$A,$t,$q)},$i.blendMode=function($i){this.ctx.globalCompositeOperation=$i},$i.flush=function(){this.ctx.flush&&this.ctx.flush()},$i.addRenderObject=function($i){this.ctx.addRenderObject($i)},$i.beginClip=function($i,$p,$F,$J){this.ctx.beginClip&&this.ctx.beginClip($i,$p,$F,$J)},$i.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},$i.fillTrangles=function($i,$p,$F){this.ctx.fillTrangles($F[0],$F[1],$F[2],$F[3],4<$F.length?$F[4]:null)},$q.PI2=2*Math.PI,$q}(),$y=function(){function $q($i,$p){switch(this._next=$p||$q.NORENDER,$i){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=$r._filter);case 69905:return void(this._fun=$q._initRenderFun)}this.onCreate($i)}$x($q,"laya.renders.RenderSprite");var $i=$q.prototype;return $i.onCreate=function($i){},$i._style=function($i,$p,$F,$J){$i._style.render($i,$p,$F,$J);var $A=this._next;$A._fun.call($A,$i,$p,$F,$J)},$i._no=function($i,$p,$F,$J){},$i._custom=function($i,$p,$F,$J){$i.customRender($p,$F,$J);var $A=$i._style._tf;this._next._fun.call(this._next,$i,$p,$F-$A.translateX,$J-$A.translateY)},$i._clip=function($i,$p,$F,$J){var $A=this._next;if($A!=$q.NORENDER){var $t=$i._style.scrollRect;$p.ctx.save(),$p.ctx.clipRect($F,$J,$t.width,$t.height),$A._fun.call($A,$i,$p,$F-$t.x,$J-$t.y),$p.ctx.restore()}},$i._blend=function($i,$p,$F,$J){var $A=$i._style;$A.blendMode&&($p.ctx.globalCompositeOperation=$A.blendMode);var $t=this._next;$t._fun.call($t,$i,$p,$F,$J),$p.ctx.globalCompositeOperation="source-over"},$i._mask=function($i,$p,$F,$J){var $A=this._next;$A._fun.call($A,$i,$p,$F,$J);var $t=$i.mask;$t&&($p.ctx.globalCompositeOperation="destination-in",(0<$t.numChildren||!$t.graphics._isOnlyOne())&&($t.cacheAsBitmap=!0),$t.render($p,$F-$i.pivotX,$J-$i.pivotY)),$p.ctx.globalCompositeOperation="source-over"},$i._graphics=function($i,$p,$F,$J){var $A=$i._style._tf;$i._graphics&&$i._graphics._render($i,$p,$F-$A.translateX,$J-$A.translateY);var $t=this._next;$t._fun.call($t,$i,$p,$F,$J)},$i._image=function($i,$p,$F,$J){var $A=$i._style;$p.ctx.drawTexture2($F,$J,$A._tf.translateX,$A._tf.translateY,$i.transform,$A.alpha,$A.blendMode,$i._graphics._one)},$i._image2=function($i,$p,$F,$J){var $A=$i._style._tf;$p.ctx.drawTexture2($F,$J,$A.translateX,$A.translateY,$i.transform,1,null,$i._graphics._one)},$i._alpha=function($i,$p,$F,$J){var $A;if(.01<($A=$i._style.alpha)||$i._needRepaint()){var $t=$p.ctx.globalAlpha;$p.ctx.globalAlpha*=$A;var $q=this._next;$q._fun.call($q,$i,$p,$F,$J),$p.ctx.globalAlpha=$t}},$i._transform=function($i,$p,$F,$J){var $A=$i.transform,$t=this._next;$A&&$t!=$q.NORENDER?($p.save(),$p.transform($A.a,$A.b,$A.c,$A.d,$A.tx+$F,$A.ty+$J),$t._fun.call($t,$i,$p,0,0),$p.restore()):$t._fun.call($t,$i,$p,$F,$J)},$i._childs=function($i,$p,$F,$J){var $A=$i._style,$t=$A._tf;if($F=$F-$t.translateX+$A.paddingLeft,$J=$J-$t.translateY+$A.paddingTop,$A._calculation){var $q=$i._getWords();if($q){var $B=$A;$B&&($B.stroke?$p.fillBorderWords($q,$F,$J,$B.font,$B.color,$B.strokeColor,$B.stroke):$p.fillWords($q,$F,$J,$B.font,$B.color,"none"!=$B.textDecoration&&$B.underLine?1:0))}}var $O,$U=$i._childs,$d=$U.length;if($i.viewport||$i.optimizeScrollRect&&$i._style.scrollRect){var $u=$i.viewport||$i._style.scrollRect,$S=$u.x,$Z=$u.y,$s=$u.right,$x=$u.bottom,$j=NaN,$r=NaN;for($M=0;$M<$d;++$M)($O=$U[$M]).visible&&($j=$O._x)<$s&&$j+$O.width>$S&&($r=$O._y)<$x&&$r+$O.height>$Z&&$O.render($p,$F,$J)}else for(var $M=0;$M<$d;++$M)($O=$U[$M])._style.visible&&$O.render($p,$F,$J)},$i._canvas=function($i,$p,$F,$J){var $A=$i._$P.cacheCanvas;if($A){"bitmap"===$A.type?$$.canvasBitmap++:$$.canvasNormal++;var $t=$A.ctx;if($i._needRepaint()||!$t)this._canvas_repaint($i,$p,$F,$J);else{var $q=$A._cacheRec;$p.drawCanvas($t.canvas,$F+$q.x,$J+$q.y,$q.width,$q.height)}}else this._next._fun.call(this._next,$i,$p,$F,$J)},$i._canvas_repaint=function($i,$p,$F,$J){var $A=$i._$P.cacheCanvas,$t=this._next;if($A){var $q,$B,$O,$U,$d=$A.ctx,$u=$i._needRepaint()||!$d,$S=$A.type;if("bitmap"===$S?$$.canvasBitmap++:$$.canvasNormal++,$u){var $Z,$s;$A._cacheRec||($A._cacheRec=new $Q),$G.isWebGL&&"bitmap"!==$S?$A._cacheRec.setTo(-$i.pivotX,-$i.pivotY,1,1):(($U=$i.getSelfBounds()).x=$U.x-$i.pivotX,$U.y=$U.y-$i.pivotY,$U.x=$U.x-16,$U.y=$U.y-16,$U.width=$U.width+32,$U.height=$U.height+32,$U.x=Math.floor($U.x+$F)-$F,$U.y=Math.floor($U.y+$J)-$J,$U.width=Math.floor($U.width),$U.height=Math.floor($U.height),$A._cacheRec.copyFrom($U)),$U=$A._cacheRec;var $x,$j=$G.isWebGL?1:$o.pixelRatio*$a.stage.clientScaleX,$r=$G.isWebGL?1:$o.pixelRatio*$a.stage.clientScaleY;if(!$G.isWebGL){var $M,$D=1,$E=1;for($M=$i;$M&&$M!=$a.stage;)$D*=$M.scaleX,$E*=$M.scaleY,$M=$M.parent;$G.isWebGL?($D<1&&($j*=$D),$E<1&&($r*=$E)):(1<$D&&($j*=$D),1<$E&&($r*=$E))}if($i.scrollRect){var $v=$i.scrollRect;$U.x-=$v.x,$U.y-=$v.y}if($Z=$U.width*$j,$s=$U.height*$r,$B=$U.x,$O=$U.y,$G.isWebGL&&"bitmap"===$S&&(2048<$Z||2048<$s))return console.warn("cache bitmap size larger than 2048,cache ignored"),$A.ctx&&($w.recover("RenderContext",$A.ctx),$A.ctx.canvas.size(0,0),$A.ctx=null),void $t._fun.call($t,$i,$p,$F,$J);if($d||($d=$A.ctx=$w.getItem("RenderContext")||new $_($Z,$s,$Di.create("AUTO"))),$d.ctx.sprite=$i,($q=$d.canvas).clear(),($q.width!=$Z||$q.height!=$s)&&$q.size($Z,$s),"bitmap"===$S?$q.context.asBitmap=!0:"normal"===$S&&($q.context.asBitmap=!1),1!=$j||1!=$r){var $g=$d.ctx;$g.save(),$g.scale($j,$r),!$G.isConchWebGL&&$G.isConchApp&&($x=$i._$P.cf)&&$g.setFilterMatrix&&$g.setFilterMatrix($x._mat,$x._alpha),$t._fun.call($t,$i,$d,-$B,-$O),$g.restore(),$G.isConchApp&&!$G.isConchWebGL||$i._applyFilters()}else $g=$d.ctx,!$G.isConchWebGL&&$G.isConchApp&&($x=$i._$P.cf)&&$g.setFilterMatrix&&$g.setFilterMatrix($x._mat,$x._alpha),$t._fun.call($t,$i,$d,-$B,-$O),$G.isConchApp&&!$G.isConchWebGL||$i._applyFilters();$i._$P.staticCache&&($A.reCache=!1),$$.canvasReCache++}else $B=($U=$A._cacheRec).x,$O=$U.y,$q=$d.canvas;$p.drawCanvas($q,$F+$B,$J+$O,$U.width,$U.height)}else $t._fun.call($t,$i,$d,$F,$J)},$q.__init__=function(){var $i,$p,$F=0;for($p=$h.createRenderSprite(69905,null),$i=$q.renders.length=4096,$F=0;$F<$i;$F++)$q.renders[$F]=$p;$q.renders[0]=$h.createRenderSprite(0,null),function($i,$p){for(var $F=0,$J=0;$J<$i.length;$J++)$F|=$i[$J],$q.renders[$F]=$p}([1,512,4,2],new $q(1,null)),$q.renders[513]=$h.createRenderSprite(513,null),$q.renders[517]=new $q(517,null)},$q._initRenderFun=function($i,$p,$F,$J){var $A=$i._renderType;($q.renders[$A]=$q._getTypeRender($A))._fun($i,$p,$F,$J)},$q._getTypeRender=function($i){for(var $p=null,$F=2048;1<$F;)$F&$i&&($p=$h.createRenderSprite($F,$p)),$F>>=1;return $p},$q.IMAGE=1,$q.ALPHA=2,$q.TRANSFORM=4,$q.BLEND=8,$q.CANVAS=16,$q.FILTERS=32,$q.MASK=64,$q.CLIP=128,$q.STYLE=256,$q.GRAPHICS=512,$q.CUSTOM=1024,$q.CHILDS=2048,$q.INIT=69905,$q.renders=[],$q.NORENDER=new $q(0,null),$q}(),$N=function(){function $B(){this._repaint=!1}$x($B,"laya.resource.Context");var $i=$B.prototype;return $i.replaceReset=function(){var $i,$p,$F=0;for($i=$B.replaceKeys.length,$F=0;$F<$i;$F++)$p=$B.replaceKeys[$F],this[$B.newKeys[$F]]=this[$p]},$i.replaceResotre=function(){this.__restore(),this.__reset()},$i.setIsMainContext=function(){},$i.drawTextures=function($i,$p,$F,$J){$$.drawCall+=$p.length/2;for(var $A=$i.width,$t=$i.height,$q=0,$B=$p.length;$q<$B;$q+=2)this.drawTexture($i,$p[$q],$p[$q+1],$A,$t,$F,$J)},$i.drawCanvas=function($i,$p,$F,$J,$A){$$.drawCall++,this.drawImage($i.source,$p,$F,$J,$A)},$i.fillRect=function($i,$p,$F,$J,$A){$$.drawCall++,$A&&(this.fillStyle=$A),this.__fillRect($i,$p,$F,$J)},$i.fillText=function($i,$p,$F,$J,$A,$t){$$.drawCall++,3<arguments.length&&null!=$J&&(this.font=$J,this.fillStyle=$A,this.textAlign=$t,this.textBaseline="top"),this.__fillText($i,$p,$F)},$i.fillBorderText=function($i,$p,$F,$J,$A,$t,$q,$B){$$.drawCall++,this.font=$J,this.fillStyle=$A,this.textBaseline="top",this.strokeStyle=$t,this.lineWidth=$q,this.textAlign=$B,this.__strokeText($i,$p,$F),this.__fillText($i,$p,$F)},$i.strokeText=function($i,$p,$F,$J,$A,$t,$q){$$.drawCall++,3<arguments.length&&null!=$J&&(this.font=$J,this.strokeStyle=$A,this.lineWidth=$t,this.textAlign=$q,this.textBaseline="top"),this.__strokeText($i,$p,$F)},$i.transformByMatrix=function($i){this.transform($i.a,$i.b,$i.c,$i.d,$i.tx,$i.ty)},$i.setTransformByMatrix=function($i){this.setTransform($i.a,$i.b,$i.c,$i.d,$i.tx,$i.ty)},$i.clipRect=function($i,$p,$F,$J){$$.drawCall++,this.beginPath(),this.rect($i,$p,$F,$J),this.clip()},$i.drawTexture=function($i,$p,$F,$J,$A,$t,$q){$$.drawCall++;var $B=$i.uv,$O=$i.bitmap.width,$U=$i.bitmap.height;this.drawImage($i.source,$B[0]*$O,$B[1]*$U,($B[2]-$B[0])*$O,($B[5]-$B[3])*$U,$p+$t,$F+$q,$J,$A)},$i.drawTextureWithTransform=function($i,$p,$F,$J,$A,$t,$q,$B,$O){$$.drawCall++;var $U=$i.uv,$d=$i.bitmap.width,$u=$i.bitmap.height;this.save(),1!=$O&&(this.globalAlpha*=$O),$t?(this.transform($t.a,$t.b,$t.c,$t.d,$t.tx+$q,$t.ty+$B),this.drawImage($i.source,$U[0]*$d,$U[1]*$u,($U[2]-$U[0])*$d,($U[5]-$U[3])*$u,$p,$F,$J,$A)):this.drawImage($i.source,$U[0]*$d,$U[1]*$u,($U[2]-$U[0])*$d,($U[5]-$U[3])*$u,$p+$q,$F+$B,$J,$A),this.restore()},$i.drawTexture2=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=$B[0];if($O.loaded&&$O.bitmap&&$O.source){$$.drawCall++;var $U=1!==$t;if($U){var $d=this.globalAlpha;this.globalAlpha*=$t}var $u=$O.uv,$S=$O.bitmap.width,$Z=$O.bitmap.height;$A?(this.save(),this.transform($A.a,$A.b,$A.c,$A.d,$A.tx+$i,$A.ty+$p),this.drawImage($O.source,$u[0]*$S,$u[1]*$Z,($u[2]-$u[0])*$S,($u[5]-$u[3])*$Z,$B[1]-$F,$B[2]-$J,$B[3],$B[4]),this.restore()):this.drawImage($O.source,$u[0]*$S,$u[1]*$Z,($u[2]-$u[0])*$S,($u[5]-$u[3])*$Z,$B[1]-$F+$i,$B[2]-$J+$p,$B[3],$B[4]),$U&&(this.globalAlpha=$d)}},$i.fillTexture=function($i,$p,$F,$J,$A,$t,$q,$B){if(!$B.pat){if($i.uv!=$di.DEF_UV){var $O=new $Di("2D");$O.getContext("2d"),$O.size($i.width,$i.height),$O.context.drawTexture($i,0,0,$i.width,$i.height,0,0),$i=new $di($O)}$B.pat=this.createPattern($i.bitmap.source,$t)}var $U=$p,$d=$F,$u=0,$S=0;$q&&($U+=$q.x%$i.width,$d+=$q.y%$i.height,$u-=$q.x%$i.width,$S-=$q.y%$i.height),this.translate($U,$d),this.fillRect($u,$S,$J,$A,$B.pat),this.translate(-$U,-$d)},$i.drawTriangle=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=$i.bitmap,$U=$O.source,$d=$i.width,$u=$i.height,$S=$O.width,$Z=$O.height,$s=$F[$J]*$S,$x=$F[$A]*$S,$j=$F[$t]*$S,$r=$F[$J+1]*$Z,$M=$F[$A+1]*$Z,$D=$F[$t+1]*$Z,$E=$p[$J],$v=$p[$A],$g=$p[$t],$a=$p[$J+1],$R=$p[$A+1],$Q=$p[$t+1];if($B){var $P=($E+$v+$g)/3,$Y=($a+$R+$Q)/3,$c=$E-$P,$h=$a-$Y,$m=Math.sqrt($c*$c+$h*$h);$E=$P+$c/$m*($m+1),$a=$Y+$h/$m*($m+1),$h=$R-$Y,$v=$P+($c=$v-$P)/($m=Math.sqrt($c*$c+$h*$h))*($m+1),$R=$Y+$h/$m*($m+1),$h=$Q-$Y,$g=$P+($c=$g-$P)/($m=Math.sqrt($c*$c+$h*$h))*($m+1),$Q=$Y+$h/$m*($m+1)}this.save(),$q&&this.transform($q.a,$q.b,$q.c,$q.d,$q.tx,$q.ty),this.beginPath(),this.moveTo($E,$a),this.lineTo($v,$R),this.lineTo($g,$Q),this.closePath(),this.clip();var $n=1/($s*$M+$r*$j+$x*$D-$M*$j-$r*$x-$s*$D),$I=$E*$M+$r*$g+$v*$D-$M*$g-$r*$v-$E*$D,$G=$s*$v+$E*$j+$x*$g-$v*$j-$E*$x-$s*$g,$_=$s*$M*$g+$r*$v*$j+$E*$x*$D-$E*$M*$j-$r*$x*$g-$s*$v*$D,$y=$a*$M+$r*$Q+$R*$D-$M*$Q-$r*$R-$a*$D,$N=$s*$R+$a*$j+$x*$Q-$R*$j-$a*$x-$s*$Q,$f=$s*$M*$Q+$r*$R*$j+$a*$x*$D-$a*$M*$j-$r*$x*$Q-$s*$R*$D;this.transform($I*$n,$y*$n,$G*$n,$N*$n,$_*$n,$f*$n),this.drawImage($U,$i.uv[0]*$S,$i.uv[1]*$Z,$d,$u,$i.uv[0]*$S,$i.uv[1]*$Z,$d,$u),this.restore()},$i.flush=function(){return 0},$i.fillWords=function($i,$p,$F,$J,$A,$t){$J&&(this.font=$J),$A&&(this.fillStyle=$A);this.textBaseline="top",this.textAlign="left";for(var $q=0,$B=$i.length;$q<$B;$q++){var $O=$i[$q];if(this.__fillText($O.char,$O.x+$p,$O.y+$F),1===$t){var $U=$O.height,$d=.5*$O.style.letterSpacing;$d||($d=0),this.beginPath(),this.strokeStyle=$A,this.lineWidth=1,this.moveTo($p+$O.x-$d+.5,$F+$O.y+$U+.5),this.lineTo($p+$O.x+$O.width+$d+.5,$F+$O.y+$U+.5),this.stroke()}}},$i.fillBorderWords=function($i,$p,$F,$J,$A,$t,$q){$J&&(this.font=$J),$A&&(this.fillStyle=$A),this.textBaseline="top",this.lineWidth=$q,this.textAlign="left",this.strokeStyle=$t;for(var $B=0,$O=$i.length;$B<$O;$B++){var $U=$i[$B];this.__strokeText($U.char,$U.x+$p,$U.y+$F),this.__fillText($U.char,$U.x+$p,$U.y+$F)}},$i.destroy=function(){this.canvas.width=this.canvas.height=0},$i.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},$i.drawCurves=function($i,$p,$F){this.beginPath(),this.strokeStyle=$F[3],this.lineWidth=$F[4];var $J=$F[2];$i+=$F[0],$p+=$F[1],this.moveTo($i+$J[0],$p+$J[1]);for(var $A=2,$t=$J.length;$A<$t;)this.quadraticCurveTo($i+$J[$A++],$p+$J[$A++],$i+$J[$A++],$p+$J[$A++]);this.stroke()},$B.__init__=function($p){var $F=laya.resource.Context.prototype;if(!($p=$p||CanvasRenderingContext2D.prototype).inited){$p.inited=!0,$p.__fillText=$p.fillText,$p.__fillRect=$p.fillRect,$p.__strokeText=$p.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function($i){$p[$i]=$F[$i]})}},$B.replaceCanvasGetSet=function($i,$p){var $F=Object.getOwnPropertyDescriptor($i,$p);if(!$F||!$F.configurable)return!1;var $J,$A={};for($J in $F)"set"!=$J&&($A[$J]=$F[$J]);var $t=$F.set;return $A.set=function($i){$t.call(this,$i);var $p=this.getContext("2d");$p&&"__reset"in $p&&$p.__reset()},Object.defineProperty($i,$p,$A),!0},$B.replaceGetSet=function($i,$p){var $F=Object.getOwnPropertyDescriptor($i,$p);if(!$F||!$F.configurable)return!1;var $J,$A={};for($J in $F)"set"!=$J&&($A[$J]=$F[$J]);var $t=$F.set,$q="___"+$p+"__";return $B.newKeys.push($q),$A.set=function($i){$i!=this[$q]&&(this[$q]=$i,$t.call(this,$i))},Object.defineProperty($i,$p,$A),!0},$B._default=new $B,$B.newKeys=[],$O($B,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),$B}(),$f=function(){function $t($i){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++$t._uniqueIDCounter,this._name=$i||"Content Manager",$t._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,$t._resourceManagers.push(this),this._resources=[],this._records={}}$x($t,"laya.resource.ResourceManager");var $i=$t.prototype;return $a.imps($i,{"laya.resource.IDispose":!0}),$i.getResourceByIndex=function($i){return this._resources[$i]},$i.getResourcesLength=function(){return this._resources.length},$i.addResource=function($i){return $i.resourceManager&&$i.resourceManager.removeResource($i),-1===this._resources.indexOf($i)&&(($i._resourceManager=this)._resources.push($i),this.addRecord($i.uri,$i.__className,$i.memorySize),this.addSize($i.memorySize),!0)},$i.removeResource=function($i){var $p=this._resources.indexOf($i);return-1!==$p&&(this._resources.splice($p,1),$i._resourceManager=null,this._memorySize-=$i.memorySize,this.addRecord($i.uri,$i.__className,-$i.memorySize),!0)},$i.unload=function(){for(var $i=this._resources.slice(0,this._resources.length),$p=0;$p<$i.length;$p++){$i[$p].destroy()}$i.length=0},$i.dispose=function(){if(this===$t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");$t._resourceManagers.splice($t._resourceManagers.indexOf(this),1),$t._isResourceManagersSorted=!1;for(var $i=this._resources.slice(0,this._resources.length),$p=0;$p<$i.length;$p++){var $F=$i[$p];$F.resourceManager.removeResource($F),$F.destroy()}$i.length=0},$i.addSize=function($i){$i&&(this.autoRelease&&0<$i&&this._memorySize+$i>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=$i)},$i.addRecord=function($i,$p,$F){DEBUG&&$F&&!$i&&console.error($i,$p,$F)},$i.garbageCollection=function($i){var $p=this._resources;($p=$p.slice()).sort(function($i,$p){if(!$i||!$p)throw new Error("a或b不能为空！");return $i.released&&$p.released?0:$i.released?1:$p.released?-1:$i._lastUseFrameCount-$p._lastUseFrameCount});for(var $F=$$.loopCount,$J=0,$A=$p.length;$J<$A;$J++){var $t=$p[$J];if(!(1<$F-$t._lastUseFrameCount))return void(this._memorySize>=$i&&(this._isOverflow=!0));if($t.releaseResource(),this._memorySize<$i)return void(this._isOverflow=!1)}},$d(0,$i,"id",function(){return this._id}),$d(0,$i,"name",function(){return this._name},function($i){!$i&&""===$i||this._name===$i||(this._name=$i,$t._isResourceManagersSorted=!1)}),$d(0,$i,"memorySize",function(){return this._memorySize}),$d(0,$i,"records",function(){return this._records}),$d(1,$t,"systemResourceManager",function(){return $t._systemResourceManager}),$t.__init__=function(){$t.currentResourceManager=$t.systemResourceManager},$t.getLoadedResourceManagerByIndex=function($i){return $t._resourceManagers[$i]},$t.getLoadedResourceManagersCount=function(){return $t._resourceManagers.length},$t.recreateContentManagers=function($i){void 0===$i&&($i=!1);for(var $p=$t.currentResourceManager,$F=0;$F<$t._resourceManagers.length;$F++){$t.currentResourceManager=$t._resourceManagers[$F];for(var $J=0;$J<$t.currentResourceManager._resources.length;$J++)$t.currentResourceManager._resources[$J].releaseResource($i),$t.currentResourceManager._resources[$J].activeResource($i)}$t.currentResourceManager=$p},$t.releaseContentManagers=function($i){void 0===$i&&($i=!1);for(var $p=$t.currentResourceManager,$F=0;$F<$t._resourceManagers.length;$F++){$t.currentResourceManager=$t._resourceManagers[$F];for(var $J=0;$J<$t.currentResourceManager._resources.length;$J++){var $A=$t.currentResourceManager._resources[$J];!$A.released&&$A.releaseResource($i)}}$t.currentResourceManager=$p},$t._uniqueIDCounter=0,$t._isResourceManagersSorted=!1,$t._resourceManagers=[],$O($t,["_systemResourceManager",function(){return this._systemResourceManager=new $t("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=$t._systemResourceManager}]),$t}(),$o=(function(){function $i(){}$x($i,"laya.system.System"),$i.changeDefinition=function($i,$p){$a[$i]=$p;var $F=$i+"=classObj";$a._runScript($F)},$i.__init__=function(){$G.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function $F(){}return $x($F,"laya.utils.Browser"),$d(1,$F,"pixelRatio",function(){return $F.__init__(),-1<$F.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:$h.getPixelRatio()}),$d(1,$F,"height",function(){return $F.__init__(),($a.stage&&$a.stage.canvasRotation?$F.clientWidth:$F.clientHeight)*$F.pixelRatio}),$d(1,$F,"clientWidth",function(){return $F.__init__(),$F.window.innerWidth||$F.document.body.clientWidth}),$d(1,$F,"window",function(){return $F.__init__(),$F._window}),$d(1,$F,"clientHeight",function(){return $F.__init__(),$F.window.innerHeight||$F.document.body.clientHeight||$F.document.documentElement.clientHeight}),$d(1,$F,"width",function(){return $F.__init__(),($a.stage&&$a.stage.canvasRotation?$F.clientHeight:$F.clientWidth)*$F.pixelRatio}),$d(1,$F,"container",function(){return $F.__init__(),$F._container||(($F._container=$F.createElement("div")).id="layaContainer",$F.document.body.appendChild($F._container)),$F._container},function($i){$F._container=$i}),$d(1,$F,"document",function(){return $F.__init__(),$F._document}),$F.__init__=function(){if(!$F._window){$F._window=$h.getWindow(),$F._document=$F.window.document,$F._window.addEventListener("message",function($i){laya.utils.Browser._onMessage($i)},!1),$F.document.__createElement=$F.document.createElement,$q.requestAnimationFrame=$q.requestAnimationFrame||$q.webkitRequestAnimationFrame||$q.mozRequestAnimationFrame||$q.oRequestAnimationFrame||$q.msRequestAnimationFrame||function($i){return $q.setTimeout($i,1e3/60)};var $i=$q.document.body.style;$i["-webkit-user-select"]="none",$i["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",$F.userAgent=$F.window.navigator.userAgent,$F.onIOS=!!($F.u=$F.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),$F.onMobile=-1<$F.u.indexOf("Mobile"),$F.onIPhone=-1<$F.u.indexOf("iPhone"),$F.onMac=-1<$F.u.indexOf("Mac OS X"),$F.onIPad=-1<$F.u.indexOf("iPad"),$F.onAndroid=-1<$F.u.indexOf("Android")||-1<$F.u.indexOf("Adr"),$F.onWP=-1<$F.u.indexOf("Windows Phone"),$F.onQQBrowser=-1<$F.u.indexOf("QQBrowser"),$F.onMQQBrowser=-1<$F.u.indexOf("MQQBrowser")||-1<$F.u.indexOf("Mobile")&&-1<$F.u.indexOf("QQ"),$F.onIE=!!$F.window.ActiveXObject||"ActiveXObject"in $F.window,$F.onWeiXin=-1<$F.u.indexOf("MicroMessenger"),$F.onPC=!$F.onMobile,$F.onSafari=-1<$F.u.indexOf("Safari"),$F.onFirefox=-1<$F.u.indexOf("Firefox"),$F.onEdge=-1<$F.u.indexOf("Edge"),$F.onMiniGame=-1<$F.u.indexOf("MiniGame"),$F.onLimixiu=-1<$F.u.indexOf("limixiu"),$F.httpProtocol="http:"==$F.window.location.protocol,$F.onMiniGame&&null==$F.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),$F.webAudioEnabled=!!($F.window.AudioContext||$F.window.webkitAudioContext||$F.window.mozAudioContext),$F.soundType=$F.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",$Ai=$F.webAudioEnabled?$ti:$Fi,$F.webAudioEnabled&&$ti.initWebAudio(),$Fi._initMusicAudio(),$F.enableTouch="ontouchstart"in $q||$q.DocumentTouch&&$p instanceof DocumentTouch,$q.focus(),$c._soundClass=$Ai,$c._musicClass=$Fi,$G._mainCanvas=$G._mainCanvas||$Di.create("2D"),$F.canvas||($F.canvas=$Di.create("2D"),$F.context=$F.canvas.getContext("2d"))}},$F._onMessage=function($i){if($i.data&&"size"==$i.data.name){if($F.window.innerWidth=$i.data.width,$F.window.innerHeight=$i.data.height,$F.window.__innerHeight=$i.data.clientHeight,!$F.document.createEvent)return void console.warn("no document.createEvent");var $p=$F.document.createEvent("HTMLEvents");return $p.initEvent("resize",!1,!1),void $F.window.dispatchEvent($p)}},$F.createElement=function($i){return $F.__init__(),$F.document.__createElement($i)},$F.getElementById=function($i){return $F.__init__(),$F.document.getElementById($i)},$F.removeElement=function($i){$i&&$i.parentNode&&$i.parentNode.removeChild($i)},$F.now=function(){return $h.now()},$F._window=null,$F._document=null,$F._container=null,$F.userAgent=null,$F.u=null,$F.onIOS=!1,$F.onMac=!1,$F.onMobile=!1,$F.onIPhone=!1,$F.onIPad=!1,$F.onAndroid=!1,$F.onWP=!1,$F.onQQBrowser=!1,$F.onMQQBrowser=!1,$F.onSafari=!1,$F.onFirefox=!1,$F.onEdge=!1,$F.onIE=!1,$F.onWeiXin=!1,$F.onMiniGame=!1,$F.onLimixiu=!1,$F.onPC=!1,$F.httpProtocol=!1,$F.webAudioEnabled=!1,$F.soundType=null,$F.enableTouch=!1,$F.canvas=null,$F.context=null,$F.__init$=function(){},$F}()),$W=function(){function $p($i){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,$i?(this._u8d_=new Uint8Array($i),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}$x($p,"laya.utils.Byte");var $i=$p.prototype;return $i.___resizeBuffer=function($p){try{var $i=new Uint8Array($p);null!=this._u8d_&&(this._u8d_.length<=$p?$i.set(this._u8d_):$i.set(this._u8d_.subarray(0,$p))),this._u8d_=$i,this._d_=new DataView($i.buffer)}catch($i){throw"___resizeBuffer err:"+$p}},$i.getString=function(){return this.rUTF(this.getUint16())},$i.getFloat32Array=function($i,$p){var $F=$i+$p;$F=$F>this._length?this._length:$F;var $J=new Float32Array(this._d_.buffer.slice($i,$F));return this._pos_=$F,$J},$i.getUint8Array=function($i,$p){var $F=$i+$p;$F=$F>this._length?this._length:$F;var $J=new Uint8Array(this._d_.buffer.slice($i,$F));return this._pos_=$F,$J},$i.getInt16Array=function($i,$p){var $F=$i+$p;$F=$F>this._length?this._length:$F;var $J=new Int16Array(this._d_.buffer.slice($i,$F));return this._pos_=$F,$J},$i.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var $i=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,$i},$i.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var $i=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,$i},$i.writeFloat32=function($i){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,$i,this._xd_),this._pos_+=4},$i.writeFloat64=function($i){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,$i,this._xd_),this._pos_+=8},$i.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var $i=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,$i},$i.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var $i=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,$i},$i.writeInt32=function($i){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,$i,this._xd_),this._pos_+=4},$i.writeUint32=function($i){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,$i,this._xd_),this._pos_+=4},$i.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var $i=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,$i},$i.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var $i=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,$i},$i.writeUint16=function($i){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,$i,this._xd_),this._pos_+=2},$i.writeInt16=function($i){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,$i,this._xd_),this._pos_+=2},$i.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},$i.writeUint8=function($i){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,$i),this._pos_++},$i._getUInt8=function($i){return this._d_.getUint8($i)},$i._getUint16=function($i){return this._d_.getUint16($i,this._xd_)},$i._getMatrix=function(){return new $m(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},$i.rUTF=function($i){for(var $p=[],$F=this._pos_+$i,$J=0,$A=0,$t=0,$q=String.fromCharCode,$B=this._u8d_;this._pos_<$F;)($J=$B[this._pos_++])<128?0!=$J&&$p.push($q($J)):$J<224?$p.push($q((63&$J)<<6|127&$B[this._pos_++])):$J<240?($A=$B[this._pos_++],$p.push($q((31&$J)<<12|(127&$A)<<6|127&$B[this._pos_++]))):($A=$B[this._pos_++],$t=$B[this._pos_++],$p.push($q((15&$J)<<18|(127&$A)<<12|$t<<6&127|127&$B[this._pos_++]))),0;return $p.join("")},$i.getCustomString=function($i){for(var $p=[],$F=0,$J=0,$A=0,$t=String.fromCharCode,$q=this._u8d_;0<$i;)if(($J=$q[this._pos_])<128)$p.push($t($J)),this._pos_++,$i--;else for($F=$J-128,this._pos_++,$i-=$F;0<$F;)$J=$q[this._pos_++],$A=$q[this._pos_++],$p.push($t($A<<8|$J)),$F--;return $p.join("")},$i.clear=function(){this._pos_=0,this.length=0},$i.__getBuffer=function(){return this._d_.buffer},$i.writeUTFBytes=function($i){for(var $p=0,$F=($i+="").length;$p<$F;$p++){var $J=$i.charCodeAt($p);$J<=127?this.writeByte($J):$J<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|$J>>6,128|63&$J],this._pos_),this._pos_+=2):$J<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|$J>>12,128|$J>>6&63,128|63&$J],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|$J>>18,128|$J>>12&63,128|$J>>6&63,128|63&$J],this._pos_),this._pos_+=4)}},$i.writeUTFString=function($i){var $p=this.pos;this.writeUint16(1),this.writeUTFBytes($i);var $F=this.pos-$p-2;if(65536<=$F)throw"writeUTFString byte len more than 65536";this._d_.setUint16($p,$F,this._xd_)},$i.readUTFString=function(){return this.readUTFBytes(this.getUint16())},$i.getUTFString=function(){return this.readUTFString()},$i.readUTFBytes=function($i){if(void 0===$i&&($i=-1),0==$i)return"";var $p=this.bytesAvailable;if($p<$i)throw"readUTFBytes error - Out of bounds";return $i=0<$i?$i:$p,this.rUTF($i)},$i.getUTFBytes=function($i){return void 0===$i&&($i=-1),this.readUTFBytes($i)},$i.writeByte=function($i){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,$i),this._pos_+=1},$i.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},$i.getByte=function(){return this.readByte()},$i.ensureWrite=function($i){this._length<$i&&(this._length=$i),this._allocated_<$i&&(this.length=$i)},$i.writeArrayBuffer=function($i,$p,$F){if(void 0===$p&&($p=0),void 0===$F&&($F=0),$p<0||$F<0)throw"writeArrayBuffer error - Out of bounds";0==$F&&($F=$i.byteLength-$p),this.ensureWrite(this._pos_+$F);var $J=new Uint8Array($i);this._u8d_.set($J.subarray($p,$p+$F),this._pos_),this._pos_+=$F},$d(0,$i,"buffer",function(){var $i=this._d_.buffer;return $i.byteLength==this.length?$i:$i.slice(0,this.length)}),$d(0,$i,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function($i){this._xd_="littleEndian"==$i}),$d(0,$i,"length",function(){return this._length},function($i){this._allocated_<$i?this.___resizeBuffer(this._allocated_=Math.floor(Math.max($i,2*this._allocated_))):this._allocated_>$i&&this.___resizeBuffer(this._allocated_=$i),this._length=$i}),$d(0,$i,"pos",function(){return this._pos_},function($i){this._pos_=$i}),$d(0,$i,"bytesAvailable",function(){return this._length-this._pos_}),$p.getSystemEndian=function(){if(!$p._sysEndian){var $i=new ArrayBuffer(2);new DataView($i).setInt16(0,256,!0),$p._sysEndian=256===new Int16Array($i)[0]?"littleEndian":"bigEndian"}return $p._sysEndian},$p.BIG_ENDIAN="bigEndian",$p.LITTLE_ENDIAN="littleEndian",$p._sysEndian=null,$p}(),$L=function(){function $A(){}return $x($A,"laya.utils.CacheManager"),$A.regCacheByFunction=function($i,$p){var $F;$A.unRegCacheByFunction($i,$p),$F={tryDispose:$i,getCacheList:$p},$A._cacheList.push($F)},$A.unRegCacheByFunction=function($i,$p){var $F,$J=0;for($F=$A._cacheList.length,$J=0;$J<$F;$J++)if($A._cacheList[$J].tryDispose==$i&&$A._cacheList[$J].getCacheList==$p)return void $A._cacheList.splice($J,1)},$A.forceDispose=function(){var $i=0,$p=$A._cacheList.length;for($i=0;$i<$p;$i++)$A._cacheList[$i].tryDispose(!0)},$A.beginCheck=function($i){void 0===$i&&($i=15e3),$a.timer.loop($i,null,$A._checkLoop)},$A.stopCheck=function(){$a.timer.clear(null,$A._checkLoop)},$A._checkLoop=function(){var $i=$A._cacheList;if(!($i.length<1)){var $p,$F=$o.now(),$J=0;for($p=$J=$i.length;0<$J&&($i[$A._index=++$A._index%$p].tryDispose(!1),!($o.now()-$F>$A.loopTimeLimit));)$J--}},$A.loopTimeLimit=2,$A._cacheList=[],$A._index=0,$A}(),$C=function(){function $Z(){}return $x($Z,"laya.utils.ClassUtils"),$Z.regClass=function($i,$p){$Z._classMap[$i]=$p},$Z.getRegClass=function($i){return $Z._classMap[$i]},$Z.getInstance=function($i){var $p=$Z.getClass($i);return $p?new $p:(console.warn("[error] Undefined class:",$i),null)},$Z.createByJson=function($i,$p,$F,$J,$A){"string"==typeof $i&&($i=JSON.parse($i));var $t=$i.props;if(!$p&&!($p=$A?$A.runWith($i):$Z.getInstance($t.runtime||$i.type)))return null;var $q=$i.child;if($q)for(var $B=0,$O=$q.length;$B<$O;$B++){var $U=$q[$B];if("render"!==$U.props.name&&"render"!==$U.props.renderType||!$p._$set_itemRender)if("Graphic"==$U.type)$Z.addGraphicsToSprite($U,$p);else if($Z.isDrawType($U.type))$Z.addGraphicToSprite($U,$p,!0);else{var $d=$Z.createByJson($U,null,$F,$J,$A);"Script"==$U.type?$d.hasOwnProperty("owner")?$d.owner=$p:$d.hasOwnProperty("target")&&($d.target=$p):"mask"==$U.props.renderType?$p.mask=$d:$p.addChild($d)}else $p.itemRender=$U}if($t)for(var $u in $t){var $S=$t[$u];"var"===$u&&$F?$F[$S]=$p:$S instanceof Array&&"function"==typeof $p[$u]?$p[$u].apply($p,$S):$p[$u]=$S}return $J&&$i.customProps&&$J.runWith([$p,$i]),$p.created&&$p.created(),$p},$Z.addGraphicsToSprite=function($i,$p){var $F;if(($F=$i.child)&&!($F.length<1)){var $J;$J=$Z._getGraphicsFromSprite($i,$p);var $A=0,$t=0;$i.props&&($A=$Z._getObjVar($i.props,"x",0),$t=$Z._getObjVar($i.props,"y",0)),0!=$A&&0!=$t&&$J.translate($A,$t);var $q,$B=0;for($q=$F.length,$B=0;$B<$q;$B++)$Z._addGraphicToGraphics($F[$B],$J);0!=$A&&0!=$t&&$J.translate(-$A,-$t)}},$Z.addGraphicToSprite=function($i,$p,$F){var $J;void 0===$F&&($F=!1),$J=$F?$Z._getGraphicsFromSprite($i,$p):$p.graphics,$Z._addGraphicToGraphics($i,$J)},$Z._getGraphicsFromSprite=function($i,$p){var $F,$J;if(!$i||!$i.props)return $p.graphics;switch($J=$i.props.renderType){case"hit":case"unHit":var $A;$p.hitArea||($p.hitArea=new $k),($A=$p.hitArea)[$J]||($A[$J]=new $S),$F=$A[$J]}return $F||($F=$p.graphics),$F},$Z._getTransformData=function($i){var $p;($i.hasOwnProperty("pivotX")||$i.hasOwnProperty("pivotY"))&&($p=$p||new $m).translate(-$Z._getObjVar($i,"pivotX",0),-$Z._getObjVar($i,"pivotY",0));var $F=$Z._getObjVar($i,"scaleX",1),$J=$Z._getObjVar($i,"scaleY",1),$A=$Z._getObjVar($i,"rotation",0);$Z._getObjVar($i,"skewX",0),$Z._getObjVar($i,"skewY",0);return 1==$F&&1==$J&&0==$A||(($p=$p||new $m).scale($F,$J),$p.rotate(.0174532922222222*$A)),$p},$Z._addGraphicToGraphics=function($i,$p){var $F,$J;if(($F=$i.props)&&($J=$Z.DrawTypeDic[$i.type])){var $A,$t;$A=$p;var $q=$Z._getParams($F,$J[1],$J[2],$J[3]);(($t=$Z._tM)||1!=$Z._alpha)&&($A.save(),$t&&$A.transform($t),1!=$Z._alpha&&$A.alpha($Z._alpha)),$A[$J[0]].apply($A,$q),($t||1!=$Z._alpha)&&$A.restore()}},$Z._adptLineData=function($i){return $i[2]=parseFloat($i[0])+parseFloat($i[2]),$i[3]=parseFloat($i[1])+parseFloat($i[3]),$i},$Z._adptTextureData=function($i){return $i[0]=$Bi.getRes($i[0]),$i},$Z._adptLinesData=function($i){return $i[2]=$Z._getPointListByStr($i[2]),$i},$Z.isDrawType=function($i){return"Image"!=$i&&$Z.DrawTypeDic.hasOwnProperty($i)},$Z._getParams=function($i,$p,$F,$J){var $A;void 0===$F&&($F=0),($A=$Z._temParam).length=$p.length;var $t,$q,$B=0;for($t=$p.length,$B=0;$B<$t;$B++)$A[$B]=$Z._getObjVar($i,$p[$B][0],$p[$B][1]);return $Z._alpha=$Z._getObjVar($i,"alpha",1),$q=$Z._getTransformData($i),$Z._tM=$q?($F||($F=0),$q.translate($A[$F],$A[$F+1]),$A[$F]=$A[$F+1]=0,$q):null,$J&&$Z[$J]&&($A=$Z[$J]($A)),$A},$Z._getPointListByStr=function($i){var $p,$F,$J=0;for($F=($p=$i.split(",")).length,$J=0;$J<$F;$J++)$p[$J]=parseFloat($p[$J]);return $p},$Z._getObjVar=function($i,$p,$F){return $i.hasOwnProperty($p)?$i[$p]:$F},$Z._temParam=[],$Z._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},$Z.getClass=function($i){var $p=$Z._classMap[$i]||$i;return"string"==typeof $p?$a.__classmap[$p]:$p},$Z._tM=null,$Z._alpha=NaN,$O($Z,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),$Z}(),$K=function(){function $t($i){if(this._color=[],"string"==typeof $i){null===(this.strColor=$i)&&($i="#000000"),"#"==$i.charAt(0)&&($i=$i.substr(1));var $p=$i.length;if(3==$p||4==$p){for(var $F="",$J=0;$J<$p;$J++)$F+=$i[$J]+$i[$J];$i=$F}var $A=this.numColor=parseInt($i,16);if(8==$i.length)return void(this._color=[parseInt($i.substr(0,2),16)/255,((16711680&$A)>>16)/255,((65280&$A)>>8)/255,(255&$A)/255])}else $A=this.numColor=$i,this.strColor=$b.toHexColor($A);this._color=[((16711680&$A)>>16)/255,((65280&$A)>>8)/255,(255&$A)/255,1],this._color.__id=++$t._COLODID}return $x($t,"laya.utils.Color"),$t._initDefault=function(){for(var $i in $t._DEFAULT={},$t._COLOR_MAP)$t._SAVE[$i]=$t._DEFAULT[$i]=new $t($t._COLOR_MAP[$i]);return $t._DEFAULT},$t._initSaveMap=function(){for(var $i in $t._SAVE_SIZE=0,$t._SAVE={},$t._DEFAULT)$t._SAVE[$i]=$t._DEFAULT[$i]},$t.create=function($i){var $p=$t._SAVE[$i+""];return null!=$p?$p:($t._SAVE_SIZE<1e3||$t._initSaveMap(),$t._SAVE[$i+""]=new $t($i))},$t._SAVE={},$t._SAVE_SIZE=0,$t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},$t._DEFAULT=$t._initDefault(),$t._COLODID=1,$t}(),$V=(function(){function $i(){this._values=[],this._keys=[]}$x($i,"laya.utils.Dictionary");var $p=$i.prototype;$p.set=function($i,$p){var $F=this.indexOf($i);0<=$F?this._values[$F]=$p:(this._keys.push($i),this._values.push($p))},$p.indexOf=function($i){var $p=this._keys.indexOf($i);return 0<=$p?$p:($i="string"==typeof $i?Number($i):"number"==typeof $i?$i.toString():$i,this._keys.indexOf($i))},$p.get=function($i){var $p=this.indexOf($i);return $p<0?null:this._values[$p]},$p.remove=function($i){var $p=this.indexOf($i);return 0<=$p&&(this._keys.splice($p,1),this._values.splice($p,1),!0)},$p.clear=function(){this._values.length=0,this._keys.length=0},$d(0,$p,"values",function(){return this._values}),$d(0,$p,"keys",function(){return this._keys})}(),function(){function $i(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}$x($i,"laya.utils.Dragging");var $p=$i.prototype;return $p.start=function($i,$p,$F,$J,$A,$t,$q,$B){void 0===$B&&($B=.92),this.clearTimer(),this.target=$i,this.area=$p,this.hasInertia=$F,this.elasticDistance=$p?$J:0,this.elasticBackTime=$A,this.data=$t,this._disableMouseEvent=$q,this.ratio=$B,1!=$i.globalScaleX||1!=$i.globalScaleY?this._parent=$i.parent:this._parent=$a.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,$a.stage.on("mouseup",this,this.onStageMouseUp),$a.stage.on("mouseout",this,this.onStageMouseUp),$a.timer.frameLoop(1,this,this.loop)},$p.clearTimer=function(){$a.timer.clear(this,this.loop),$a.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},$p.stop=function(){this._dragging&&($s.instance.disableMouseEvent=!1,$a.stage.off("mouseup",this,this.onStageMouseUp),$a.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},$p.loop=function(){var $i=this._parent.getMousePoint(),$p=$i.x,$F=$i.y,$J=$p-this._lastX,$A=$F-this._lastY;if(this._clickOnly){if(!(1<Math.abs($J*$a.stage._canvasTransform.getScaleX())||1<Math.abs($A*$a.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),$s.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push($J,$A);0==$J&&0==$A||(this._lastX=$p,this._lastY=$F,this.target.x+=$J*this._elasticRateX,this.target.y+=$A*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},$p.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var $i=this.area.x-this.target.x;else $i=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-$i/this.elasticDistance),this.target.y<this.area.y)var $p=this.area.y-this.target.y;else $p=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-$p/this.elasticDistance)}},$p.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},$p.onStageMouseUp=function($i){if($s.instance.disableMouseEvent=!1,$a.stage.off("mouseup",this,this.onStageMouseUp),$a.stage.off("mouseout",this,this.onStageMouseUp),$a.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var $p=this._offsets.length,$F=Math.min($p,6),$J=this._offsets.length-$F,$A=$p-1;$J<$A;$A--)this._offsetY+=this._offsets[$A--],this._offsetX+=this._offsets[$A];this._offsetX=this._offsetX/$F*2,this._offsetY=this._offsetY/$F*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),$a.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},$p.checkElastic=function(){var $i=NaN,$p=NaN;if(this.target.x<this.area.x?$i=this.area.x:this.target.x>this.area.x+this.area.width&&($i=this.area.x+this.area.width),this.target.y<this.area.y?$p=this.area.y:this.target.y>this.area.y+this.area.height&&($p=this.area.y+this.area.height),isNaN($i)&&isNaN($p))this.clear();else{var $F={};isNaN($i)||($F.x=$i),isNaN($p)||($F.y=$p),this._tween=$e.to(this.target,$F,this.elasticBackTime,$T.sineOut,$M.create(this,this.clear),0,!1,!1)}},$p.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&($a.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},$p.clear=function(){if(this.target){this.clearTimer();var $i=this.target;this.target=null,this._parent=null,$i.event("dragend",this.data)}},$i}()),$T=function(){function $B(){}return $x($B,"laya.utils.Ease"),$B.linearNone=function($i,$p,$F,$J){return $F*$i/$J+$p},$B.linearIn=function($i,$p,$F,$J){return $F*$i/$J+$p},$B.linearInOut=function($i,$p,$F,$J){return $F*$i/$J+$p},$B.linearOut=function($i,$p,$F,$J){return $F*$i/$J+$p},$B.bounceIn=function($i,$p,$F,$J){return $F-$B.bounceOut($J-$i,0,$F,$J)+$p},$B.bounceInOut=function($i,$p,$F,$J){return $i<.5*$J?.5*$B.bounceIn(2*$i,0,$F,$J)+$p:.5*$B.bounceOut(2*$i-$J,0,$F,$J)+.5*$F+$p},$B.bounceOut=function($i,$p,$F,$J){return($i/=$J)<1/2.75?$F*(7.5625*$i*$i)+$p:$i<2/2.75?$F*(7.5625*($i-=1.5/2.75)*$i+.75)+$p:$i<2.5/2.75?$F*(7.5625*($i-=2.25/2.75)*$i+.9375)+$p:$F*(7.5625*($i-=2.625/2.75)*$i+.984375)+$p},$B.backIn=function($i,$p,$F,$J,$A){return void 0===$A&&($A=1.70158),$F*($i/=$J)*$i*(($A+1)*$i-$A)+$p},$B.backInOut=function($i,$p,$F,$J,$A){return void 0===$A&&($A=1.70158),($i/=.5*$J)<1?.5*$F*($i*$i*((1+($A*=1.525))*$i-$A))+$p:$F/2*(($i-=2)*$i*((1+($A*=1.525))*$i+$A)+2)+$p},$B.backOut=function($i,$p,$F,$J,$A){return void 0===$A&&($A=1.70158),$F*(($i=$i/$J-1)*$i*(($A+1)*$i+$A)+1)+$p},$B.elasticIn=function($i,$p,$F,$J,$A,$t){var $q;return void 0===$A&&($A=0),void 0===$t&&($t=0),0==$i?$p:1==($i/=$J)?$p+$F:($t||($t=.3*$J),$q=!$A||0<$F&&$A<$F||$F<0&&$A<-$F?($A=$F,$t/4):$t/$B.PI2*Math.asin($F/$A),-$A*Math.pow(2,10*($i-=1))*Math.sin(($i*$J-$q)*$B.PI2/$t)+$p)},$B.elasticInOut=function($i,$p,$F,$J,$A,$t){var $q;return void 0===$A&&($A=0),void 0===$t&&($t=0),0==$i?$p:2==($i/=.5*$J)?$p+$F:($t||($t=$J*(.3*1.5)),$q=!$A||0<$F&&$A<$F||$F<0&&$A<-$F?($A=$F,$t/4):$t/$B.PI2*Math.asin($F/$A),$i<1?$A*Math.pow(2,10*($i-=1))*Math.sin(($i*$J-$q)*$B.PI2/$t)*-.5+$p:$A*Math.pow(2,-10*($i-=1))*Math.sin(($i*$J-$q)*$B.PI2/$t)*.5+$F+$p)},$B.elasticOut=function($i,$p,$F,$J,$A,$t){var $q;return void 0===$A&&($A=0),void 0===$t&&($t=0),0==$i?$p:1==($i/=$J)?$p+$F:($t||($t=.3*$J),$q=!$A||0<$F&&$A<$F||$F<0&&$A<-$F?($A=$F,$t/4):$t/$B.PI2*Math.asin($F/$A),$A*Math.pow(2,-10*$i)*Math.sin(($i*$J-$q)*$B.PI2/$t)+$F+$p)},$B.strongIn=function($i,$p,$F,$J){return $F*($i/=$J)*$i*$i*$i*$i+$p},$B.strongInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*$F*$i*$i*$i*$i*$i+$p:.5*$F*(($i-=2)*$i*$i*$i*$i+2)+$p},$B.strongOut=function($i,$p,$F,$J){return $F*(($i=$i/$J-1)*$i*$i*$i*$i+1)+$p},$B.sineInOut=function($i,$p,$F,$J){return.5*-$F*(Math.cos(Math.PI*$i/$J)-1)+$p},$B.sineIn=function($i,$p,$F,$J){return-$F*Math.cos($i/$J*$B.HALF_PI)+$F+$p},$B.sineOut=function($i,$p,$F,$J){return $F*Math.sin($i/$J*$B.HALF_PI)+$p},$B.quintIn=function($i,$p,$F,$J){return $F*($i/=$J)*$i*$i*$i*$i+$p},$B.quintInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*$F*$i*$i*$i*$i*$i+$p:.5*$F*(($i-=2)*$i*$i*$i*$i+2)+$p},$B.quintOut=function($i,$p,$F,$J){return $F*(($i=$i/$J-1)*$i*$i*$i*$i+1)+$p},$B.quartIn=function($i,$p,$F,$J){return $F*($i/=$J)*$i*$i*$i+$p},$B.quartInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*$F*$i*$i*$i*$i+$p:.5*-$F*(($i-=2)*$i*$i*$i-2)+$p},$B.quartOut=function($i,$p,$F,$J){return-$F*(($i=$i/$J-1)*$i*$i*$i-1)+$p},$B.cubicIn=function($i,$p,$F,$J){return $F*($i/=$J)*$i*$i+$p},$B.cubicInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*$F*$i*$i*$i+$p:.5*$F*(($i-=2)*$i*$i+2)+$p},$B.cubicOut=function($i,$p,$F,$J){return $F*(($i=$i/$J-1)*$i*$i+1)+$p},$B.quadIn=function($i,$p,$F,$J){return $F*($i/=$J)*$i+$p},$B.quadInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*$F*$i*$i+$p:.5*-$F*(--$i*($i-2)-1)+$p},$B.quadOut=function($i,$p,$F,$J){return-$F*($i/=$J)*($i-2)+$p},$B.expoIn=function($i,$p,$F,$J){return 0==$i?$p:$F*Math.pow(2,10*($i/$J-1))+$p-.001*$F},$B.expoInOut=function($i,$p,$F,$J){return 0==$i?$p:$i==$J?$p+$F:($i/=.5*$J)<1?.5*$F*Math.pow(2,10*($i-1))+$p:.5*$F*(2-Math.pow(2,-10*--$i))+$p},$B.expoOut=function($i,$p,$F,$J){return $i==$J?$p+$F:$F*(1-Math.pow(2,-10*$i/$J))+$p},$B.circIn=function($i,$p,$F,$J){return-$F*(Math.sqrt(1-($i/=$J)*$i)-1)+$p},$B.circInOut=function($i,$p,$F,$J){return($i/=.5*$J)<1?.5*-$F*(Math.sqrt(1-$i*$i)-1)+$p:.5*$F*(Math.sqrt(1-($i-=2)*$i)+1)+$p},$B.circOut=function($i,$p,$F,$J){return $F*Math.sqrt(1-($i=$i/$J-1)*$i)+$p},$B.HALF_PI=.5*Math.PI,$B.PI2=2*Math.PI,$B}(),$k=function(){function $u(){this._hit=null,this._unHit=null}$x($u,"laya.utils.HitArea");var $i=$u.prototype;return $i.isHit=function($i,$p){return!!$u.isHitGraphic($i,$p,this.hit)&&!$u.isHitGraphic($i,$p,this.unHit)},$i.contains=function($i,$p){return this.isHit($i,$p)},$d(0,$i,"hit",function(){return this._hit||(this._hit=new $S),this._hit},function($i){this._hit=$i}),$d(0,$i,"unHit",function(){return this._unHit||(this._unHit=new $S),this._unHit},function($i){this._unHit=$i}),$u.isHitGraphic=function($i,$p,$F){if(!$F)return!1;var $J;if(!($J=$F.cmds)&&$F._one&&(($J=$u._cmds).length=1,$J[0]=$F._one),!$J)return!1;var $A,$t,$q=0;for($A=$J.length,$q=0;$q<$A;$q++)if($t=$J[$q]){var $B=$G._context;switch($t.callee){case $B._translate:case 6:$i-=$t[0],$p-=$t[1]}if($u.isHitCmd($i,$p,$t))return!0}return!1},$u.isHitCmd=function($i,$p,$F){if(!$F)return!1;var $J=$G._context,$A=!1;switch($F.callee){case $J._drawRect:case 13:$u._rec.setTo($F[0],$F[1],$F[2],$F[3]),$A=$u._rec.contains($i,$p);break;case $J._drawCircle:case $J._fillCircle:case 14:$A=($i-=$F[0])*$i+($p-=$F[1])*$p<$F[2]*$F[2];break;case $J._drawPoly:case 18:$i-=$F[0],$p-=$F[1],$A=$u.ptInPolygon($i,$p,$F[2])}return $A},$u.ptInPolygon=function($i,$p,$F){var $J;($J=$u._ptPoint).setTo($i,$p);var $A,$t=0,$q=NaN,$B=NaN,$O=NaN,$U=NaN;$A=$F.length;for(var $d=0;$d<$A;$d+=2){if($q=$F[$d],$B=$F[$d+1],$O=$F[($d+2)%$A],$B!=($U=$F[($d+3)%$A]))if(!($J.y<Math.min($B,$U)))if(!($J.y>=Math.max($B,$U)))($J.y-$B)*($O-$q)/($U-$B)+$q>$J.x&&$t++}return $t%2==1},$u._cmds=[],$O($u,["_rec",function(){return this._rec=new $Q},"_ptPoint",function(){return this._ptPoint=new $R}]),$u}(),$w=(function(){function $A($i,$p,$F,$J){this.char=$i,this.charNum=$i.charCodeAt(0),this._x=this._y=0,this.width=$p,this.height=$F,this.style=$J,this.isWord=!$A._isWordRegExp.test($i)}$x($A,"laya.utils.HTMLChar");var $i=$A.prototype;$a.imps($i,{"laya.display.ILayout":!0}),$i.setSprite=function($i){this._sprite=$i},$i.getSprite=function(){return this._sprite},$i._isChar=function(){return!0},$i._getCSSStyle=function(){return this.style},$d(0,$i,"width",function(){return this._w},function($i){this._w=$i}),$d(0,$i,"x",function(){return this._x},function($i){this._sprite&&(this._sprite.x=$i),this._x=$i}),$d(0,$i,"y",function(){return this._y},function($i){this._sprite&&(this._sprite.y=$i),this._y=$i}),$d(0,$i,"height",function(){return this._h},function($i){this._h=$i}),$A._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function $p(){}$x($p,"laya.utils.Log"),$p.enable=function(){$p._logdiv||($p._logdiv=$o.window.document.createElement("div"),$o.window.document.body.appendChild($p._logdiv),$p._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},$p.toggle=function(){var $i=$p._logdiv.style;"1px"==$i.width?$i.width=$i.height="50%":$i.width=$i.height="1px"},$p.print=function($i){$p._logdiv&&($p.maxCount<=$p._count&&$p.clear(),$p._count++,$p._logdiv.innerText+=$i+"\n",$p._logdiv.scrollTop=$p._logdiv.scrollHeight)},$p.clear=function(){$p._logdiv.innerText="",$p._count=0},$p._logdiv=null,$p._count=0,$p.maxCount=20}(),function(){function $p(){}$x($p,"laya.utils.Mouse"),$d(1,$p,"cursor",function(){return $p._style.cursor},function($i){$p._style.cursor=$i}),$p.hide=function(){"none"!=$p.cursor&&($p._preCursor=$p.cursor,$p.cursor="none")},$p.show=function(){"none"==$p.cursor&&($p.cursor=$p._preCursor?$p._preCursor:"auto")},$p._preCursor=null,$O($p,["_style",function(){return this._style=$o.document.body.style}])}(),function(){function $t(){}return $x($t,"laya.utils.Pool"),$t.getPoolBySign=function($i){return $t._poolDic[$i]||($t._poolDic[$i]=[])},$t.clearBySign=function($i){$t._poolDic[$i]&&($t._poolDic[$i].length=0)},$t.recover=function($i,$p){$p.__InPool||($p.__InPool=!0,$t.getPoolBySign($i).push($p))},$t.getItemByClass=function($i,$p){var $F=$t.getPoolBySign($i),$J=$F.length?$F.pop():new $p;return $J.__InPool=!1,$J},$t.getItemByCreateFun=function($i,$p,$F){var $J=$t.getPoolBySign($i),$A=$J.length?$J.pop():$p.call($F);return $A.__InPool=!1,$A},$t.getItem=function($i){var $p=$t.getPoolBySign($i),$F=$p.length?$p.pop():null;return $F&&($F.__InPool=!1),$F},$t._poolDic={},$t.InPoolSign="__InPool",$t}()),$$=function(){function $O(){}return $x($O,"laya.utils.Stat"),$d(1,$O,"onclick",null,function($i){$O._sp&&$O._sp.on("click",$O._sp,$i),$O._canvas&&($O._canvas.source.onclick=$i,$O._canvas.source.style.pointerEvents="")}),$O.show=function($i,$p,$F){if(void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),!$G.isConchApp||$G.isConchWebGL){if($G.isConchWebGL||$o.onMiniGame||$o.onLimixiu||($O._useCanvas=!0),$O._show=!0,$O._fpsData.length=60,$O._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},$O._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},$O._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},$O._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},$G.isWebGL)if($O._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},$G.is3DMode){if($O._view[0].title="FPS(3D)",$O._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},$O._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},$O._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==$F){var $J=8;$O._view[$J++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},$O._view[$J++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},$O._view[$J++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==$F){$J=8;$O._view[$J++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},$O._view[$J++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},$O._view[$J++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},$O._view[$J++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},$O._view[$J++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},$O._view[$J++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},$O._view[$J++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else $O._view[0].title="FPS(WebGL)",$O._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else $O._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};$O._useCanvas?$O.createUIPre($i,$p):$O.createUI($i,$p),$O.enable()}else $o.window.conch.showFPS&&$o.window.conch.showFPS($i,$p)},$O.createUIPre=function($i,$p){var $F=$o.pixelRatio;$O._width=170*$F,$O._vx=75*$F,$O._height=$F*(12*$O._view.length+3*$F)+4,$O._fontSize=12*$F;for(var $J=0;$J<$O._view.length;$J++)$O._view[$J].x=4,$O._view[$J].y=$J*$O._fontSize+2*$F;$O._canvas||(($O._canvas=new $Di("2D")).size($O._width,$O._height),($O._ctx=$O._canvas.getContext("2d")).textBaseline="top",$O._ctx.font=$O._fontSize+"px Sans-serif",$O._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+$i+"px;top:"+$p+"px;width:"+$O._width/$F+"px;height:"+$O._height/$F+"px;"),$O._first=!0,$O.loop(),$O._first=!1,$o.container.appendChild($O._canvas.source)},$O.createUI=function($i,$p){var $F=$O._sp,$J=$o.pixelRatio;$F||($F=new $ui,($O._leftText=new $ji).pos(5,5),$O._leftText.color="#ffffff",$F.addChild($O._leftText),($O._txt=new $ji).pos(80*$J,5),$O._txt.color="#ffffff",$F.addChild($O._txt),$O._sp=$F),$F.pos($i,$p);for(var $A="",$t=0;$t<$O._view.length;$t++){$A+=$O._view[$t].title+"\n"}$O._leftText.text=$A;var $q=170*$J,$B=$J*(12*$O._view.length+3*$J)+4;$O._txt.fontSize=$O._fontSize*$J,$O._leftText.fontSize=$O._fontSize*$J,$F.size($q,$B),$F.graphics.clear(),$F.graphics.setAlpha(.5),$F.graphics.drawRect(0,0,$q,$B,"#999999"),$F.graphics.setAlpha(1),$O.loop()},$O.enable=function(){$a.timer.frameLoop(1,$O,$O.loop)},$O.hide=function(){$O._show=!1,$a.timer.clear($O,$O.loop),$O._canvas&&$o.removeElement($O._canvas.source)},$O.clear=function(){$O.trianglesFaces=$O.drawCall=$O.shaderCall=$O.spriteCount=$O.spriteRenderUseCacheCount=$O.treeNodeCollision=$O.treeSpriteCollision=$O.canvasNormal=$O.canvasBitmap=$O.canvasReCache=0},$O.loop=function(){$O._count++;var $i=$o.now();if(!($i-$O._timer<1e3)){var $p=$O._count;if($O.FPS=Math.round(1e3*$p/($i-$O._timer)),$O._show){$O.trianglesFaces=Math.round($O.trianglesFaces/$p),$O.spriteCount=$O._useCanvas?($O.drawCall=Math.round($O.drawCall/$p)-2,$O.shaderCall=Math.round($O.shaderCall/$p),Math.round($O.spriteCount/$p)-1):($O.drawCall=Math.round($O.drawCall/$p)-2,$O.shaderCall=Math.round($O.shaderCall/$p)-4,Math.round($O.spriteCount/$p)-4),$O.spriteRenderUseCacheCount=Math.round($O.spriteRenderUseCacheCount/$p),$O.canvasNormal=Math.round($O.canvasNormal/$p),$O.canvasBitmap=Math.round($O.canvasBitmap/$p),$O.canvasReCache=Math.ceil($O.canvasReCache/$p),$O.treeNodeCollision=Math.round($O.treeNodeCollision/$p),$O.treeSpriteCollision=Math.round($O.treeSpriteCollision/$p);var $F=0<$O.FPS?Math.floor(1e3/$O.FPS).toString():" ";$O._fpsStr=$O.FPS+($O.renderSlow?" slow":"")+" "+$F,$O._spriteStr=$O.spriteCount+($O.spriteRenderUseCacheCount?"/"+$O.spriteRenderUseCacheCount:""),$O._canvasStr=$O.canvasReCache+"/"+$O.canvasNormal+"/"+$O.canvasBitmap,$O.currentMemorySize=$f.systemResourceManager.memorySize,$O._useCanvas?$O.renderInfoPre():$O.renderInfo(),$O.clear()}$O._count=0,$O._timer=$i}},$O.renderInfoPre=function(){if($O._canvas){var $i=$O._ctx;$i.clearRect($O._first?0:$O._vx,0,$O._width,$O._height);for(var $p=$G.WebGL.mainContext,$F=0;$F<$O._view.length;$F++){var $J=$O._view[$F];$O._first&&($i.fillStyle="white",$i.fillText($J.title,$J.x,$J.y,null,null,null)),$i.fillStyle=$J.color;var $A=-1;if(($J=$O._view[$F]).varying){if($p)switch($J.varying){case 1:$A=$p.getParameter($p[$J.value]);break;case 2:$A=$p.getExtension($J.value)}}else $A=$O[$J.value];"M"==$J.units&&($A=Math.floor($A/1048576*100)/100+" M"),"K"==$J.units&&($A=Math.floor($A/1024*100)/100+" K"),"string"==$J.units&&($A=$A.match(/\d+\.?\d/i)),$i.fillText($A+"",$J.x+$O._vx,$J.y,null,null,null)}}},$O.renderInfo=function(){for(var $i="",$p=$G.WebGL.mainContext,$F=0;$F<$O._view.length;$F++){var $J=$O._view[$F],$A=-1;if($J.varying){if($p)switch($J.varying){case 1:$A=$p.getParameter($p[$J.value]);break;case 2:$A=$p.getExtension($J.value)}}else $A=$O[$J.value];"M"==$J.units&&($A=Math.floor($A/1048576*100)/100+" M"),"K"==$J.units&&($A=Math.floor($A/1024*100)/100+" K"),"string"==$J.units&&($A=$A.match(/\d+\.?\d/i)),$i+=$A+"\n"}$O._txt.text=$i},$O.FPS=0,$O.loopCount=0,$O.shaderCall=0,$O.drawCall=0,$O.trianglesFaces=0,$O.spriteCount=0,$O.spriteRenderUseCacheCount=0,$O.treeNodeCollision=0,$O.treeSpriteCollision=0,$O.canvasNormal=0,$O.canvasBitmap=0,$O.canvasReCache=0,$O.renderSlow=!1,$O.currentMemorySize=0,$O._fpsStr=null,$O._canvasStr=null,$O._spriteStr=null,$O._fpsData=[],$O._timer=0,$O._count=0,$O._view=[],$O._fontSize=12,$O._txt=null,$O._leftText=null,$O._sp=null,$O._show=!1,$O._useCanvas=!1,$O._canvas=null,$O._ctx=null,$O._first=!1,$O._vx=NaN,$O._width=0,$O._height=100,$O}(),$X=(function(){function $i(){this._strsToID={},this._idToStrs=[],this._length=0}$x($i,"laya.utils.StringKey");var $p=$i.prototype;$p.add=function($i){var $p=this._strsToID[$i];return null!=$p?$p:(this._idToStrs[this._length]=$i,this._strsToID[$i]=this._length++)},$p.getID=function($i){var $p=this._strsToID[$i];return null==$p?-1:$p},$p.getName=function($i){var $p=this._idToStrs[$i];return null==$p?void 0:$p}}(),function(){var $U;function $i(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}$x($i,"laya.utils.Timer");var $p=$i.prototype;return $p._init=function(){$a.timer&&$a.timer.frameLoop(1,this,this._update)},$p._now=function(){return Date.now()},$p._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var $i=this.currFrame=this.currFrame+this.scale,$p=this._now();this._delta=($p-this._lastTimer)*this.scale;var $F=this.currTimer=this.currTimer+this._delta;$a.isDebug&&6e4<Math.abs($p-this._lastTimer)&&console.error("系统时间错误！"+($p-this._lastTimer)),this._lastTimer=$p;var $J=this._handlers;for($q=this._count=0,$B=$J.length;$q<$B;$q++)if(null!==($O=$J[$q]).method){var $A=$O.userFrame?$i:$F;if($A>=$O.exeTime)if($O.repeat)if($O.jumpFrame)for(;$A>=$O.exeTime;)$O.exeTime+=$O.delay,$O.run(!1);else $O.exeTime+=$O.delay,$O.run(!1),$A>$O.exeTime&&($O.exeTime+=Math.ceil(($A-$O.exeTime)/$O.delay)*$O.delay);else $O.run(!0)}else this._count++;(30<this._count||$i%200==0)&&this._clearHandlers();for(var $t=this._laters,$q=0,$B=$t.length-1;$q<=$B;$q++){var $O=$t[$q];this._isIgnoreRecover($O)||(null!==$O.method&&(delete this._map[$O.key],$O.run(!1)),this._recoverHandler($O)),$q===$B&&($B=$t.length-1)}$t.length=0}},$p._clearHandlers=function(){for(var $i=this._handlers,$p=0,$F=$i.length;$p<$F;$p++){var $J=$i[$p];null!==$J.method?this._temp.push($J):this._isIgnoreRecover($J)?this._temp.push($J):this._recoverHandler($J)}this._handlers=this._temp,this._temp=$i,this._temp.length=0},$p._recoverHandler=function($i){this._map[$i.key]==$i&&delete this._map[$i.key],$i.recover()},$p._create=function($i,$p,$F,$J,$A,$t,$q,$B){if(!$F)return $A.apply($J,$t),null;if($q){var $O=this._getHandler($J,$A);if($O)return $O.repeat=$p,$O.userFrame=$i,$O.delay=$F,$O.ignoreRecover=$B,$O.caller=$J,$O.method=$A,$O.args=$t,$O.exeTime=$F+($i?this.currFrame:this.currTimer+this._now()-this._lastTimer),$O}return($O=$U.create()).repeat=$p,$O.userFrame=$i,$O.delay=$F,$O.ignoreRecover=$B,$O.caller=$J,$O.method=$A,$O.args=$t,$O.exeTime=$F+($i?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler($O),this._handlers.push($O),$O},$p._indexHandler=function($i){var $p=$i.caller,$F=$i.method,$J=$p?$p.$_GID||($p.$_GID=$b.getGID()):0,$A=$F.$_TID||($F.$_TID=this._mid++);$i.key=$J+"_"+$A,this._map[$i.key]=$i},$p.once=function($i,$p,$F,$J,$A){void 0===$A&&($A=!0),this._create(!1,!1,$i,$p,$F,$J,$A,!1)},$p.loop=function($i,$p,$F,$J,$A,$t,$q){void 0===$A&&($A=!0),void 0===$t&&($t=!1),void 0===$q&&($q=!1);var $B=this._create(!1,!0,$i,$p,$F,$J,$A,$q);$B&&($B.jumpFrame=$t)},$p.frameOnce=function($i,$p,$F,$J,$A){void 0===$A&&($A=!0),this._create(!0,!1,$i,$p,$F,$J,$A,!1)},$p.frameLoop=function($i,$p,$F,$J,$A,$t){void 0===$A&&($A=!0),void 0===$t&&($t=!1),this._create(!0,!0,$i,$p,$F,$J,$A,$t)},$p.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+$U._freeCount},$p.clear=function($i,$p){var $F=this._getHandler($i,$p);return!(!$F||this._isIgnoreRecover($F))&&(delete this._map[$F.key],$F.key=null,$F.clear(),!0)},$p.clearAll=function($i){if($i)for(var $p=0,$F=this._handlers.length;$p<$F;$p++){var $J=this._handlers[$p];$J.caller===$i&&(this._isIgnoreRecover($J)||(delete this._map[$J.key],$J.key=null,$J.clear()))}},$p._getHandler=function($i,$p){var $F=$i?$i.$_GID||($i.$_GID=$b.getGID()):0,$J=$p.$_TID||($p.$_TID=this._mid++);return this._map[$F+"_"+$J]},$p._isIgnoreRecover=function($i){if($i.ignoreRecover||$i.caller&&"IgnoreRecover"==$i.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var $p="";try{arguments.propertyIsEnumerable.caller}catch($i){$p=$i.stack}$a.recordError("报错：核心定时器销毁忽略  "+$p)}return!0}return!1},$p.hasHandler=function($i,$p){return this._map[$i.$_GID+"_"+$p.$_TID]},$p.callLater=function($i,$p,$F){if(null==this._getHandler($i,$p)){var $J=$U.create();$J.caller=$i,$J.method=$p,$J.args=$F,this._indexHandler($J),this._laters.push($J)}},$p.runCallLater=function($i,$p){var $F=this._getHandler($i,$p);$F&&null!=$F.method&&(this._isIgnoreRecover($F)||(delete this._map[$F.key],$F.run(!0)))},$p.runTimer=function($i,$p){this.runCallLater($i,$p)},$d(0,$p,"delta",function(){return this._delta}),$i.__init$=function(){$U=function(){function $p(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}$x($p,"");var $i=$p.prototype;return $i.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},$i.recover=function(){this.clear(),this.args=$p._freeHandler,$p._freeHandler=this,$p._freeCount++},$i.run=function($i){var $p=this.caller;if($p&&$p.destroyed)return this.clear();var $F=this.method,$J=this.args;$i&&this.clear(),null!=$F&&($J?$F.apply($p,$J):$F.call($p))},$p._freeHandler=null,$p._freeCount=0,$p.create=function(){var $i=$p._freeHandler;return $i?($p._freeHandler=$i.args,--$p._freeCount,$i.args=null,$i):new $p},$p}()},$i}()),$e=function(){function $u(){this.gid=0}$x($u,"laya.utils.Tween");var $i=$u.prototype;return $i.to=function($i,$p,$F,$J,$A,$t,$q){return void 0===$t&&($t=0),void 0===$q&&($q=!1),this._create($i,$p,$F,$J,$A,$t,$q,!0,!1,!0)},$i.from=function($i,$p,$F,$J,$A,$t,$q){return void 0===$t&&($t=0),void 0===$q&&($q=!1),this._create($i,$p,$F,$J,$A,$t,$q,!1,!1,!0)},$i._create=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){if(!$i)throw new Error("Tween:target is null");this._target=$i,this._duration=$F,this._ease=$J||$p.ease||$u.easeNone,this._complete=$A||$p.complete,this._delay=$t,this._props=[],this._usedTimer=0,this._startTimer=$o.now(),this._usedPool=$O,this._delayParam=null,this.update=$p.update;var $d=$i.$_GID||($i.$_GID=$b.getGID());return $u.tweenMap[$d]?($q&&$u.clearTween($i),$u.tweenMap[$d].push(this)):$u.tweenMap[$d]=[this],$U?$t<=0?this.firstStart($i,$p,$B):(this._delayParam=[$i,$p,$B],$a.scaleTimer.once($t,this,this.firstStart,this._delayParam)):this._initProps($i,$p,$B),this},$i.firstStart=function($i,$p,$F){this._delayParam=null,$i.destroyed?this.clear():(this._initProps($i,$p,$F),this._beginLoop())},$i._initProps=function($i,$p,$F){for(var $J in $p)if("number"==typeof $i[$J]){var $A=$F?$i[$J]:$p[$J],$t=$F?$p[$J]:$i[$J];this._props.push([$J,$A,$t-$A]),$F||($i[$J]=$A)}},$i._beginLoop=function(){$a.scaleTimer.frameLoop(1,this,this._doEase)},$i._doEase=function(){this._updateEase($o.now())},$i._updateEase=function($i){var $p=this._target;if($p){if($p.destroyed)return $u.clearTween($p);var $F=this._usedTimer=$i-this._startTimer-this._delay;if(!($F<0)){if($F>=this._duration)return this.complete();for(var $J=0<$F?this._ease($F,0,1,this._duration):0,$A=this._props,$t=0,$q=$A.length;$t<$q;$t++){var $B=$A[$t];$p[$B[0]]=$B[1]+$J*$B[2]}this.update&&this.update.run()}}},$i.complete=function(){if(this._target){$a.scaleTimer.runTimer(this,this.firstStart);for(var $i=this._target,$p=this._props,$F=this._complete,$J=0,$A=$p.length;$J<$A;$J++){var $t=$p[$J];$i[$t[0]]=$t[1]+$t[2]}this.update&&this.update.run(),this.clear(),$F&&$F.run()}},$i.pause=function(){$a.scaleTimer.clear(this,this._beginLoop),$a.scaleTimer.clear(this,this._doEase),$a.scaleTimer.clear(this,this.firstStart);var $i;($i=$o.now()-this._startTimer-this._delay)<0&&(this._usedTimer=$i)},$i.setStartTime=function($i){this._startTimer=$i},$i.clear=function(){this._target&&(this._remove(),this._clear())},$i._clear=function(){this.pause(),$a.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,$w.recover("tween",this))},$i.recover=function(){this._usedPool=!0,this._clear()},$i._remove=function(){var $i=$u.tweenMap[this._target.$_GID];if($i)for(var $p=0,$F=$i.length;$p<$F;$p++)if($i[$p]===this){$i.splice($p,1);break}},$i.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=$o.now(),this._delayParam)$a.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var $i=this._props,$p=0,$F=$i.length;$p<$F;$p++){var $J=$i[$p];this._target[$J[0]]=$J[1]}$a.scaleTimer.once(this._delay,this,this._beginLoop)}},$i.resume=function(){this._usedTimer>=this._duration||(this._startTimer=$o.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?$a.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},$d(0,$i,"progress",null,function($i){var $p=$i*this._duration;this._startTimer=$o.now()-this._delay-$p}),$u.to=function($i,$p,$F,$J,$A,$t,$q,$B){return void 0===$t&&($t=0),void 0===$q&&($q=!1),void 0===$B&&($B=!0),$w.getItemByClass("tween",$u)._create($i,$p,$F,$J,$A,$t,$q,!0,$B,!0)},$u.from=function($i,$p,$F,$J,$A,$t,$q,$B){return void 0===$t&&($t=0),void 0===$q&&($q=!1),void 0===$B&&($B=!0),$w.getItemByClass("tween",$u)._create($i,$p,$F,$J,$A,$t,$q,!1,$B,!0)},$u.clearAll=function($i){if($i&&$i.$_GID){var $p=$u.tweenMap[$i.$_GID];if($p){for(var $F=0,$J=$p.length;$F<$J;$F++)$p[$F]._clear();$p.length=0}}},$u.clear=function($i){$i.clear()},$u.clearTween=function($i){$u.clearAll($i)},$u.easeNone=function($i,$p,$F,$J){return $F*$i/$J+$p},$u.tweenMap={},$u}(),$b=function(){function $B(){}return $x($B,"laya.utils.Utils"),$B.toRadian=function($i){return $i*$B._pi2},$B.toAngle=function($i){return $i*$B._pi},$B.toHexColor=function($i){if($i<0||isNaN($i))return null;for(var $p=$i.toString(16);$p.length<6;)$p="0"+$p;return"#"+$p},$B.getGID=function(){return $B._gid++},$B.concatArray=function($i,$p){if(!$p)return $i;if(!$i)return $p;var $F=0,$J=$p.length;for($F=0;$F<$J;$F++)$i.push($p[$F]);return $i},$B.clearArray=function($i){return $i&&($i.length=0),$i},$B.copyArray=function($i,$p){if($i||($i=[]),!$p)return $i;$i.length=$p.length;var $F=0,$J=$p.length;for($F=0;$F<$J;$F++)$i[$F]=$p[$F];return $i},$B.getGlobalRecByPoints=function($i,$p,$F,$J,$A){var $t,$q;return $t=new $R($p,$F),$t=$i.localToGlobal($t),$q=new $R($J,$A),$q=$i.localToGlobal($q),$Q._getWrapRec([$t.x,$t.y,$q.x,$q.y])},$B.getGlobalPosAndScale=function($i){return $B.getGlobalRecByPoints($i,0,0,1,1)},$B.bind=function($i,$p){return $i.bind($p)},$B.measureText=function($i,$p){return $h.measureText($i,$p)},$B.contextMeasureText=function($i){var $p=$o.context.measureText($i);return $p||($p={width:16,height:16}),$p},$B.updateOrder=function($i){if(!$i||$i.length<2)return!1;for(var $p,$F=1,$J=0,$A=$i.length,$t=NaN;$F<$A;){for($p=$i[$J=$F],$t=$i[$J]._zOrder;-1<--$J&&$i[$J]._zOrder>$t;)$i[$J+1]=$i[$J];$i[$J+1]=$p,$F++}var $q=$p.parent.conchModel;if($q)if(null!=$q.updateZOrder)$q.updateZOrder();else{for($F=0;$F<$A;$F++)$q.removeChild($i[$F].conchModel);for($F=0;$F<$A;$F++)$q.addChildAt($i[$F].conchModel,$F)}return!0},$B.transPointList=function($i,$p,$F){var $J=0,$A=$i.length;for($J=0;$J<$A;$J+=2)$i[$J]+=$p,$i[$J+1]+=$F},$B.parseInt=function($i,$p){void 0===$p&&($p=0);var $F=$o.window.parseInt($i,$p);return isNaN($F)?0:$F},$B.getFileExtension=function($i){$B._extReg.lastIndex=$i.lastIndexOf(".");var $p=$B._extReg.exec($i);return $p&&1<$p.length?$p[1].toLowerCase():null},$B.getTransformRelativeToWindow=function($i,$p,$F){var $J=$a.stage,$A=laya.utils.Utils.getGlobalPosAndScale($i),$t=$J._canvasTransform.clone(),$q=$t.tx,$B=$t.ty;$t.rotate(-Math.PI/180*$a.stage.canvasDegree),$t.scale($a.stage.clientScaleX,$a.stage.clientScaleY);var $O=$a.stage.canvasDegree%180!=0,$U=NaN,$d=NaN;$O?($U=$F+$A.y,$d=$p+$A.x,$U*=$t.d,$d*=$t.a,90==$a.stage.canvasDegree?($U=$q-$U,$d+=$B):($U+=$q,$d=$B-$d)):($U=$p+$A.x,$d=$F+$A.y,$U*=$t.a,$d*=$t.d,$U+=$q,$d+=$B);var $u=NaN,$S=NaN;return $S=$O?($u=$t.d*$A.height,$t.a*$A.width):($u=$t.a*$A.width,$t.d*$A.height),{x:$U,y:$d,scaleX:$u,scaleY:$S}},$B.fitDOMElementInArea=function($i,$p,$F,$J,$A,$t){$i._fitLayaAirInitialized||($i._fitLayaAirInitialized=!0,$i.style.transformOrigin=$i.style.webKittransformOrigin="left top",$i.style.position="absolute");var $q=$B.getTransformRelativeToWindow($p,$F,$J);$i.style.transform=$i.style.webkitTransform="scale("+$q.scaleX+","+$q.scaleY+") rotate("+$a.stage.canvasDegree+"deg)",$i.style.width=$A+"px",$i.style.height=$t+"px",$i.style.left=$q.x+"px",$i.style.top=$q.y+"px"},$B.isOkTextureList=function($i){if(!$i)return!1;var $p,$F=0,$J=$i.length;for($F=0;$F<$J;$F++)if(!($p=$i[$F])||!$p.source)return!1;return!0},$B.isOKCmdList=function($i){if(!$i)return!1;var $p,$F,$J=0,$A=$i.length,$t=$G._context;for($J=0;$J<$A;$J++)switch(($p=$i[$J]).callee){case $t._drawTexture:case $t._fillTexture:case $t._drawTextureWithTransform:if(!($F=$p[0])||!$F.source)return!1}return!0},$B._gid=1,$B._pi=180/Math.PI,$B._pi2=Math.PI/180,$B._extReg=/\.(\w+)\??/g,$B.parseXMLFromString=function($i){var $p;if($i=$i.replace(/>\s+</g,"><"),-1<($p=(new DOMParser).parseFromString($i,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error($p.firstChild.firstChild.textContent);return $p},$B}(),$z=function(){function $i(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],$G.isWebGL&&$L.regCacheByFunction($b.bind(this.startDispose,this),$b.bind(this.getCacheList,this))}$x($i,"laya.utils.VectorGraphManager");var $p=$i.prototype;return $p.getId=function(){return this._id++},$p.addShape=function($i,$p){this.shapeDic[$i]=$p,this.useDic[$i]||(this.useDic[$i]=!0)},$p.addLine=function($i,$p){this.shapeLineDic[$i]=$p,this.shapeLineDic[$i]||(this.shapeLineDic[$i]=!0)},$p.getShape=function($i){this._checkKey&&null!=this.useDic[$i]&&(this.useDic[$i]=!0)},$p.deleteShape=function($i){this.shapeDic[$i]&&(this.shapeDic[$i]=null,delete this.shapeDic[$i]),this.shapeLineDic[$i]&&(this.shapeLineDic[$i]=null,delete this.shapeLineDic[$i]),null!=this.useDic[$i]&&delete this.useDic[$i]},$p.getCacheList=function(){var $i,$p=[];for($i in this.shapeDic)$p.push(this.shapeDic[$i]);for($i in this.shapeLineDic)$p.push(this.shapeLineDic[$i]);return $p},$p.startDispose=function($i){var $p;for($p in this.useDic)this.useDic[$p]=!1;this._checkKey=!0},$p.endDispose=function(){if(this._checkKey){var $i;for($i in this.useDic)this.useDic[$i]||this.deleteShape($i);this._checkKey=!1}},$i.getInstance=function(){return $i.instance=$i.instance||new $i},$i.instance=null,$i}(),$l=function(){function $J(){this._obj=null,this._obj=$J.supportWeakMap?new $o.window.WeakMap:{},$J.supportWeakMap||$J._maps.push(this)}$x($J,"laya.utils.WeakObject");var $i=$J.prototype;return $i.set=function($i,$p){if(null!=$i)if($J.supportWeakMap){var $F=$i;"string"!=typeof $i&&"number"!=typeof $i||($F=$J._keys[$i])||($F=$J._keys[$i]={k:$i}),this._obj.set($F,$p)}else"string"==typeof $i||"number"==typeof $i?this._obj[$i]=$p:($i.$_GID||($i.$_GID=$b.getGID()),this._obj[$i.$_GID]=$p)},$i.get=function($i){if(null==$i)return null;if($J.supportWeakMap){var $p="string"==typeof $i||"number"==typeof $i?$J._keys[$i]:$i;return $p?this._obj.get($p):null}return"string"==typeof $i||"number"==typeof $i?this._obj[$i]:this._obj[$i.$_GID]},$i.del=function($i){if(null!=$i)if($J.supportWeakMap){var $p="string"==typeof $i||"number"==typeof $i?$J._keys[$i]:$i;if(!$p)return;this._obj.delete($p)}else"string"==typeof $i||"number"==typeof $i?delete this._obj[$i]:delete this._obj[this._obj.$_GID]},$i.has=function($i){if(null==$i)return!1;if($J.supportWeakMap){var $p="string"==typeof $i||"number"==typeof $i?$J._keys[$i]:$i;return this._obj.has($p)}return"string"==typeof $i||"number"==typeof $i?null!=this._obj[$i]:null!=this._obj[this._obj.$_GID]},$J.__init__=function(){($J.supportWeakMap=null!=$o.window.WeakMap)||$a.timer.loop($J.delInterval,null,$J.clearCache)},$J.clearCache=function(){for(var $i=0,$p=$J._maps.length;$i<$p;$i++){$J._maps[$i]._obj={}}},$J.supportWeakMap=!1,$J.delInterval=3e5,$J._keys={},$J._maps=[],$O($J,["I",function(){return this.I=new $J}]),$J}(),$H=function(){function $i(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}$x($i,"laya.utils.WordText");var $p=$i.prototype;return $p.setText=function($i){this.changed=!0,this._text=$i},$p.toString=function(){return this._text},$p.charCodeAt=function($i){return this._text?this._text.charCodeAt($i):NaN},$p.charAt=function($i){return this._text?this._text.charAt($i):null},$d(0,$p,"length",function(){return this._text?this._text.length:0}),$i}(),$ii=function($i){function $q(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,$q.__super.call(this),this._childs=$q.ARRAY_EMPTY,this._$P=$q.PROP_EMPTY,this.timer=$a.scaleTimer,this.conchModel=$G.isConchNode?this.createConchModel():null}$x($q,"laya.display.Node",$U);var $p=$q.prototype;return $p._setBit=function($i,$p){1==$i&&(this._getBit($i)!=$p&&this._updateDisplayedInstage());$p?this._bits|=$i:this._bits&=~$i},$p._getBit=function($i){return 0!=(this._bits&$i)},$p._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},$p._setUpNoticeType=function($i){var $p=this;for($p._setBit($i,!0),$p=$p.parent;$p;){if($p._getBit($i))return;$p._setBit($i,!0),$p=$p.parent}},$p.on=function($i,$p,$F,$J){return"display"!==$i&&"undisplay"!==$i||this._getBit(1)||this._setUpNoticeType(1),this._createListener($i,$p,$F,$J,!1)},$p.once=function($i,$p,$F,$J){return"display"!==$i&&"undisplay"!==$i||this._getBit(1)||this._setUpNoticeType(1),this._createListener($i,$p,$F,$J,!0)},$p.createConchModel=function(){return null},$p.destroy=function($i){void 0===$i&&($i=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&($i?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},$p.destroyChildren=function(){if(this._childs)for(var $i=this._childs.length-1;-1<$i;$i--)this._childs[$i].destroy(!0)},$p.addChild=function($i){if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),$i._parent===this){var $p=this.getChildIndex($i);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,this._childs.length-1)),this._childChanged())}else $i.parent&&$i.parent.removeChild($i),this._childs===$q.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,this._childs.length-1),($i.parent=this)._childChanged();return $i},$p.addChildren=function($i){for(var $p=arguments,$F=0,$J=$p.length;$F<$J;)this.addChild($p[$F++])},$p.addChildAt=function($i,$p){if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($i._parent===this){var $F=this.getChildIndex($i);this._childs.splice($F,1),this._childs.splice($p,0,$i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,$p)),this._childChanged()}else $i.parent&&$i.parent.removeChild($i),this._childs===$q.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,$p),$i.parent=this;return $i}throw new Error("appendChildAt:The index is out of bounds")},$p.getChildIndex=function($i){return this._childs.indexOf($i)},$p.getChildByName=function($i){var $p=this._childs;if($p)for(var $F=0,$J=$p.length;$F<$J;$F++){var $A=$p[$F];if($A.name===$i)return $A}return null},$p._get$P=function($i){return this._$P[$i]},$p._set$P=function($i,$p){return this.destroyed||(this._$P===$q.PROP_EMPTY&&(this._$P={}),this._$P[$i]=$p),$p},$p.getChildAt=function($i){return this._childs[$i]},$p.setChildIndex=function($i,$p){var $F=this._childs;if($p<0||$p>=$F.length)throw new Error("setChildIndex:The index is out of bounds.");var $J=this.getChildIndex($i);if($J<0)throw new Error("setChildIndex:node is must child of this object.");return $F.splice($J,1),$F.splice($p,0,$i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,$p)),this._childChanged(),$i},$p._childChanged=function($i){},$p.removeChild=function($i){if(!this._childs)return $i;var $p=this._childs.indexOf($i);return this.removeChildAt($p)},$p.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},$p.removeChildByName=function($i){var $p=this.getChildByName($i);return $p&&this.removeChild($p),$p},$p.removeChildAt=function($i){var $p=this.getChildAt($i);if($p){for(var $F=this._childs.length-1,$J=$i;$J<$F;++$J)this._childs[$J]=this._childs[$J+1];this._childs.length=$F,this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null}return $p},$p.removeChildren=function($i,$p){if(void 0===$i&&($i=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $F=this._childs;if(0===$i&&$t<=$p){var $J=$F;this._childs=$q.ARRAY_EMPTY}else $J=$F.splice($i,$p-$i);for(var $A=0,$t=$J.length;$A<$t;$A++)$J[$A].parent=null,this.conchModel&&this.conchModel.removeChild($J[$A].conchModel)}return this},$p.replaceChild=function($i,$p){var $F=this._childs.indexOf($p);return-1<$F?(this._childs.splice($F,1,$i),this.conchModel&&(this.conchModel.removeChild($p.conchModel),this.conchModel.addChildAt($i.conchModel,$F)),$p.parent=null,$i.parent=this,$i):null},$p._updateDisplayedInstage=function(){var $i;$i=this;var $p=$a.stage;for(this._displayedInStage=!1;$i;){if($i._getBit(1)){this._displayedInStage=$i._displayedInStage;break}if($i==$p||$i._displayedInStage){this._displayedInStage=!0;break}$i=$i.parent}},$p._setDisplay=function($i){this._displayedInStage!==$i&&((this._displayedInStage=$i)?this.event("display"):this.event("undisplay"))},$p._displayChild=function($i,$p){var $F=$i._childs;if($F)for(var $J=0;$J<$F.length;$J++){var $A=$F[$J];$A&&$A._getBit(1)&&(0<$A._childs.length?this._displayChild($A,$p):$A._setDisplay($p))}$i._setDisplay($p)},$p.contains=function($i){if($i===this)return!0;for(;$i;){if($i.parent===this)return!0;$i=$i.parent}return!1},$p.timerLoop=function($i,$p,$F,$J,$A,$t){void 0===$A&&($A=!0),void 0===$t&&($t=!1),this.timer.loop($i,$p,$F,$J,$A,$t)},$p.timerOnce=function($i,$p,$F,$J,$A){void 0===$A&&($A=!0),this.timer._create(!1,!1,$i,$p,$F,$J,$A)},$p.frameLoop=function($i,$p,$F,$J,$A){void 0===$A&&($A=!0),this.timer._create(!0,!0,$i,$p,$F,$J,$A)},$p.frameOnce=function($i,$p,$F,$J,$A){void 0===$A&&($A=!0),this.timer._create(!0,!1,$i,$p,$F,$J,$A)},$p.clearTimer=function($i,$p){this.timer.clear($i,$p)},$d(0,$p,"numChildren",function(){return this._childs.length}),$d(0,$p,"destroyed",function(){return this._destroyed}),$d(0,$p,"parent",function(){return this._parent},function($i){this._parent!==$i&&($i?(this._parent=$i,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),$i.displayedInStage&&this._displayChild(this,!0)),$i._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=$i))}),$d(0,$p,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),$q.ARRAY_EMPTY=[],$q.PROP_EMPTY={},$q.NOTICE_DISPLAY=1,$q.MOUSEENABLE=2,$q}(),$pi=function($i){function $S($i){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,$S.__super.call(this),this._padding=$S._PADDING,this._spacing=$S._SPACING,this._aligns=$S._ALIGNS,this._font=$Z.EMPTY,this._ower=$i}$x($S,"laya.display.css.CSSStyle",$i);var $p=$S.prototype;return $p.destroy=function(){this._ower=null,this._font=null,this._rect=null},$p.inherit=function($i){this._font=$i._font,this._spacing=$i._spacing===$S._SPACING?$S._SPACING:$i._spacing.slice(),this.lineHeight=$i.lineHeight},$p._widthAuto=function(){return 0!=(262144&this._type)},$p.widthed=function($i){return 0!=(8&this._type)},$p._calculation=function($i,$p){if($p.indexOf("%")<0)return!1;var $J=this._ower,$A=$J.parent,$t=this._rect;function $q($i,$p,$F){return $i*$F[0]+$p*$F[1]+$F[2]}function $F($i){var $p=$A.width,$F=$J.width;$t.width&&($J.width=$q($p,$F,$t.width)),$t.height&&($J.height=$q($p,$F,$t.height)),$t.left&&($J.x=$q($p,$F,$t.left)),$t.top&&($J.y=$q($p,$F,$t.top))}null===$t&&($A._getCSSStyle()._type|=524288,$A.on("resize",this,$F),this._rect=$t={input:{}});var $B=$p.split(" ");return $B[0]=parseFloat($B[0])/100,1==$B.length?$B[1]=$B[2]=0:($B[1]=parseFloat($B[1])/100,$B[2]=parseFloat($B[2])),$t[$i]=$B,$t.input[$i]=$p,$F(),!0},$p.heighted=function($i){return 0!=(8192&this._type)},$p.size=function($i,$p){var $F=this._ower,$J=!1;-1!==$i&&$i!=this._ower.width&&(this._type|=8,this._ower.width=$i,$J=!0),-1!==$p&&$p!=this._ower.height&&(this._type|=8192,this._ower.height=$p,$J=!0),$J&&($F._layoutLater(),524288&this._type&&$F.event("resize",this))},$p._getAlign=function(){return this._aligns[0]},$p._getValign=function(){return this._aligns[1]},$p._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},$p._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new $Z(this._font))},$p.render=function($i,$p,$F,$J){var $A=$i.width,$t=$i.height;$F-=$i.pivotX,$J-=$i.pivotY,this._bgground&&null!=this._bgground.color&&$p.ctx.fillRect($F,$J,$A,$t,this._bgground.color),this._border&&this._border.color&&$p.drawRect($F,$J,$A,$t,this._border.color.strColor,this._border.size)},$p.getCSSStyle=function(){return this},$p.cssText=function($i){this.attrs($S.parseOneCSS($i,";"))},$p.attrs=function($i){if($i)for(var $p=0,$F=$i.length;$p<$F;$p++){var $J=$i[$p];this[$J[0]]=$J[1]}},$p.setTransform=function($i){"none"===$i?this._tf=$B._TF_EMPTY:this.attrs($S.parseOneCSS($i,","))},$p.translate=function($i,$p){this._tf===$B._TF_EMPTY&&(this._tf=new $A),this._tf.translateX=$i,this._tf.translateY=$p},$p.scale=function($i,$p){this._tf===$B._TF_EMPTY&&(this._tf=new $A),this._tf.scaleX=$i,this._tf.scaleY=$p},$p._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},$d(0,$p,"block",$i.prototype._$get_block,function($i){$i?this._type|=1:this._type&=-2}),$d(0,$p,"valign",function(){return $S._valigndef[this._aligns[1]]},function($i){this._aligns===$S._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=$S._valigndef[$i]}),$d(0,$p,"height",null,function($i){if(this._type|=8192,"string"==typeof $i){if(this._calculation("height",$i))return;$i=parseInt($i)}this.size(-1,$i)}),$d(0,$p,"width",null,function($i){if(this._type|=8,"string"==typeof $i){var $p=$i.indexOf("auto");if(0<=$p&&(this._type|=262144,$i=$i.substr(0,$p)),this._calculation("width",$i))return;$i=parseInt($i)}this.size($i,-1)}),$d(0,$p,"fontWeight",function(){return this._font.weight},function($i){this._createFont().weight=$i}),$d(0,$p,"left",null,function($i){var $p=this._ower;if("string"==typeof $i){if("center"===$i?$i="50% -50% 0":"right"===$i&&($i="100% -100% 0"),this._calculation("left",$i))return;$i=parseInt($i)}$p.x=$i}),$d(0,$p,"_translate",null,function($i){this.translate($i[0],$i[1])}),$d(0,$p,"absolute",function(){return 0!=(4&this._type)}),$d(0,$p,"top",null,function($i){var $p=this._ower;if("string"==typeof $i){if("middle"===$i?$i="50% -50% 0":"bottom"===$i&&($i="100% -100% 0"),this._calculation("top",$i))return;$i=parseInt($i)}$p.y=$i}),$d(0,$p,"align",function(){return $S._aligndef[this._aligns[0]]},function($i){this._aligns===$S._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=$S._aligndef[$i]}),$d(0,$p,"bold",function(){return this._font.bold},function($i){this._createFont().bold=$i}),$d(0,$p,"padding",function(){return this._padding},function($i){this._padding=$i}),$d(0,$p,"leading",function(){return this._spacing[1]},function($i){"string"==typeof $i&&($i=parseInt($i+"")),this._spacing===$S._SPACING&&(this._spacing=[0,0]),this._spacing[1]=$i}),$d(0,$p,"lineElement",function(){return 0!=(65536&this._type)},function($i){$i?this._type|=65536:this._type&=-65537}),$d(0,$p,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function($i){this.lineElement=!1,"right"===$i?this._type|=32768:this._type&=-32769}),$d(0,$p,"textDecoration",function(){return this._font.decoration},function($i){this._createFont().decoration=$i}),$d(0,$p,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function($i){"nowrap"===$i&&(this._type|=131072),"none"===$i&&(this._type&=-131073)}),$d(0,$p,"background",null,function($i){$i?(this._bgground||(this._bgground={}),this._bgground.color=$i,this._ower.conchModel&&this._ower.conchModel.bgColor($i),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),$d(0,$p,"wordWrap",function(){return 0==(131072&this._type)},function($i){$i?this._type&=-131073:this._type|=131072}),$d(0,$p,"color",function(){return this._font.color},function($i){this._createFont().color=$i}),$d(0,$p,"password",function(){return this._font.password},function($i){this._createFont().password=$i}),$d(0,$p,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function($i){"none"===$i?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=$i),this._ower.conchModel&&this._ower.conchModel.bgColor($i),this._ower._renderType|=256}),$d(0,$p,"font",function(){return this._font.toString()},function($i){this._createFont().set($i)}),$d(0,$p,"weight",null,function($i){this._createFont().weight=$i}),$d(0,$p,"letterSpacing",function(){return this._spacing[0]},function($i){"string"==typeof $i&&($i=parseInt($i+"")),this._spacing===$S._SPACING&&(this._spacing=[0,0]),this._spacing[0]=$i}),$d(0,$p,"fontSize",function(){return this._font.size},function($i){this._createFont().size=$i}),$d(0,$p,"italic",function(){return this._font.italic},function($i){this._createFont().italic=$i}),$d(0,$p,"fontFamily",function(){return this._font.family},function($i){this._createFont().family=$i}),$d(0,$p,"stroke",function(){return this._font.stroke[0]},function($i){this._createFont().stroke===$Z._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=$i}),$d(0,$p,"strokeColor",function(){return this._font.stroke[1]},function($i){this._createFont().stroke===$Z._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=$i}),$d(0,$p,"border",function(){return this._border?this._border.value:""},function($i){if("none"!=$i){this._border||(this._border={});var $p=(this._border.value=$i).split(" ");if(this._border.color=$K.create($p[$p.length-1]),1==$p.length)return this._border.size=1,void(this._border.type="solid");var $F=0;0<$p[0].indexOf("px")?(this._border.size=parseInt($p[0]),$F++):this._border.size=1,this._border.type=$p[$F],this._ower._renderType|=256}else this._border=null}),$d(0,$p,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function($i){$i?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==$i?null:$K.create($i),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),$d(0,$p,"position",function(){return 4&this._type?"absolute":""},function($i){"absolute"==$i?this._type|=4:this._type&=-5}),$d(0,$p,"display",null,function($i){switch($i){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),$d(0,$p,"paddingLeft",function(){return this.padding[3]}),$d(0,$p,"paddingTop",function(){return this.padding[0]}),$d(0,$p,"_scale",null,function($i){this._ower.scale($i[0],$i[1])}),$d(0,$p,"_rotate",null,function($i){this._ower.rotation=$i}),$S.parseOneCSS=function($i,$p){for(var $F,$J=[],$A=$i.split($p),$t=0,$q=$A.length;$t<$q;$t++){var $B=$A[$t],$O=$B.indexOf(":"),$U=$B.substr(0,$O).replace(/^\s+|\s+$/g,"");if(0!=$U.length){var $d=$B.substr($O+1).replace(/^\s+|\s+$/g,""),$u=[$U,$d];switch($U){case"italic":case"bold":$u[1]="true"==$d;break;case"line-height":$u[0]="lineHeight",$u[1]=parseInt($d);break;case"font-size":$u[0]="fontSize",$u[1]=parseInt($d);break;case"padding":1<($F=$d.split(" ")).length||($F[1]=$F[2]=$F[3]=$F[0]),$u[1]=[parseInt($F[0]),parseInt($F[1]),parseInt($F[2]),parseInt($F[3])];break;case"rotate":$u[0]="_rotate",$u[1]=parseFloat($d);break;case"scale":$F=$d.split(" "),$u[0]="_scale",$u[1]=[parseFloat($F[0]),parseFloat($F[1])];break;case"translate":$F=$d.split(" "),$u[0]="_translate",$u[1]=[parseInt($F[0]),parseInt($F[1])];break;default:($u[0]=$S._CSSTOVALUE[$U])||($u[0]=$U)}$J.push($u)}}return $J},$S.parseCSS=function($i,$p){for(var $F;null!=($F=$S._parseCSSRegExp.exec($i));)$S.styleSheets[$F[1]]=$S.parseOneCSS($F[2],";")},$S.EMPTY=new $S(null),$S._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},$S._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),$S._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},$S._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},$S.styleSheets={},$S.ALIGN_CENTER=1,$S.ALIGN_RIGHT=2,$S.VALIGN_MIDDLE=1,$S.VALIGN_BOTTOM=2,$S._CSS_BLOCK=1,$S._DISPLAY_NONE=2,$S._ABSOLUTE=4,$S._WIDTH_SET=8,$S._PADDING=[0,0,0,0],$S._RECT=[-1,-1,-1,-1],$S._SPACING=[0,0],$S._ALIGNS=[0,0,0],$S.ADDLAYOUTED=512,$S._NEWFONT=4096,$S._HEIGHT_SET=8192,$S._BACKGROUND_SET=16384,$S._FLOAT_RIGHT=32768,$S._LINE_ELEMENT=65536,$S._NOWARP=131072,$S._WIDTHAUTO=262144,$S._LISTERRESZIE=524288,$S}($B),$Fi=function($i){function $q(){this.url=null,this.audio=null,this.loaded=!1,$q.__super.call(this)}$x($q,"laya.media.h5audio.AudioSound",$U);var $p=$q.prototype;return $p.dispose=function(){var $i=$q._audioCache[this.url];$i&&($i.src="",delete $q._audioCache[this.url])},$p.load=function($i){var $p;if($i=$I.formatURL($i),(this.url=$i)==$c._tMusic?($q._initMusicAudio(),($p=$q._musicAudio).src!=$i&&($q._audioCache[$p.src]=null,$p=null)):$p=$q._audioCache[$i],$p&&2<=$p.readyState)this.event("complete");else{$p||($p=$i==$c._tMusic?($q._initMusicAudio(),$q._musicAudio):$o.createElement("audio"),($q._audioCache[$i]=$p).src=$i),$p.addEventListener("canplaythrough",$J),$p.addEventListener("error",$A);var $F=this;(this.audio=$p).load?$p.load():$A()}function $J(){$t(),$F.loaded=!0,$F.event("complete")}function $A(){$p.load=null,$t(),$F.event("error")}function $t(){$p.removeEventListener("canplaythrough",$J),$p.removeEventListener("error",$A)}},$p.play=function($i,$p,$F){if(void 0===$i&&($i=0),void 0===$p&&($p=0),!this.url)return null;var $J,$A;if(!($J=this.url==$c._tMusic?$q._musicAudio:$q._audioCache[this.url]))return null;$A=$w.getItem("audio:"+this.url),$G.isConchApp?$A||(($A=$o.createElement("audio")).src=this.url):this.url==$c._tMusic?($q._initMusicAudio(),($A=$q._musicAudio).src=this.url):$A=$A||$J.cloneNode(!0);var $t=new $Si($A);return $t.url=this.url,$t.loops=$p,$t.startTime=$i,$t.startHandler=$F,$t.play(!1),$c.addChannel($t),$t},$d(0,$p,"duration",function(){var $i;return($i=$q._audioCache[this.url])?$i.duration:0}),$q._initMusicAudio=function(){$q._musicAudio||($q._musicAudio||($q._musicAudio=$o.createElement("audio")),$G.isConchApp||$o.document.addEventListener("mousedown",$q._makeMusicOK))},$q._makeMusicOK=function(){$o.document.removeEventListener("mousedown",$q._makeMusicOK),$q._musicAudio.src?$q._musicAudio.play():($q._musicAudio.src="",$q._musicAudio.load())},$q._audioCache={},$q._musicAudio=null,$q}(),$Ji=function($i){function $p(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,$p.__super.call(this)}$x($p,"laya.media.SoundChannel",$U);var $F=$p.prototype;return $F.play=function(){},$F.stop=function(){},$F.pause=function(){},$F.resume=function(){},$F.__runComplete=function($i){$i&&$i.run()},$d(0,$F,"volume",function(){return 1},function($i){}),$d(0,$F,"position",function(){return 0}),$d(0,$F,"duration",function(){return 0}),$p}(),$Ai=function($i){function $p(){$p.__super.call(this)}$x($p,"laya.media.Sound",$U);var $F=$p.prototype;return $F.load=function($i){},$F.play=function($i,$p,$F){return void 0===$i&&($i=0),void 0===$p&&($p=0),null},$F.dispose=function(){},$d(0,$F,"duration",function(){return 0}),$p}(),$ti=function($i){function $A(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,$A.__super.call(this)}$x($A,"laya.media.webaudio.WebAudioSound",$U);var $p=$A.prototype;return $p.load=function($i){this.url=$i,this.audioBuffer=$A._dataCache[$i],this.audioBuffer?this._loaded(this.audioBuffer):($A.e.on("loaded:"+$i,this,this._loaded),$A.e.on("err:"+$i,this,this._err),$A.__loadingSound[$i]||($A.__loadingSound[$i]=!0,$a.loader.load($i,$M.create(this,this.onloaded),null,$Bi.BUFFER,4,!1,null,!0)))},$p.onloaded=function($i){$i||this._err(),this._disposed?this._removeLoadEvents():(this.data=$i,$A.buffs.push({buffer:this.data,url:this.url}),$A.decode())},$p._err=function(){if(this._removeLoadEvents(),$A.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var $i,$p,$F,$J=0;for($i=($p=this.__toPlays).length,$J=0;$J<$i;$J++)($F=$p[$J])[3]&&!$F[3].isStopped&&$F[3].event("error");this.__toPlays.length=0}},$p._loaded=function($i){this._removeLoadEvents(),this._disposed||(this.audioBuffer=$i,this.loaded=!0,this.event("complete"))},$p._removeLoadEvents=function(){$A.e.off("loaded:"+this.url,this,this._loaded),$A.e.off("err:"+this.url,this,this._err)},$p.__playAfterLoaded=function(){if(this.__toPlays){var $i,$p,$F,$J=0;for($i=($p=this.__toPlays).length,$J=0;$J<$i;$J++)($F=$p[$J])[3]&&!$F[3].isStopped&&this.play($F[0],$F[1],$F[2],$F[3]);this.__toPlays.length=0}},$p.play=function($i,$p,$F,$J){return void 0===$i&&($i=0),void 0===$p&&($p=0),$J=$J||new $Zi,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([$i,$p,$F,$J]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),$J.url=this.url,$J.loops=$p,$J.audioBuffer=this.audioBuffer,$J.startTime=$i,$J.startHandler=$F,$J.play(!1),$c.addChannel($J),$J},$p.dispose=function(){this._disposed=!0,delete $A._dataCache[this.url],delete $A.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},$d(0,$p,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$A.decode=function(){if(!($A.buffs.length<=0||$A.isDecoding))if($A.isDecoding=!0,($A.tInfo=$A.buffs.shift())&&$A.tInfo.buffer&&$A.tInfo.buffer.byteLength)try{$A.ctx.decodeAudioData($A.tInfo.buffer,$A._done,$A._fail)}catch($i){console.error("decodeAudioData error  byteLength:"+$A.tInfo.buffer.byteLength+"  url:"+$A.tInfo.url)}else $A._fail()},$A._done=function($i){$A.e.event("loaded:"+$A.tInfo.url,$i),$A._dataCache[$A.tInfo.url]=$i,$A.isDecoding=!1,$A.decode()},$A._fail=function(){$A.e.event("err:"+$A.tInfo.url,null),$A.isDecoding=!1,$A.decode()},$A._playEmptySound=function(){if(null!=$A.ctx){if($A._emptySource&&($A._emptySource.stop(),$A._emptySource.disconnect(0),!$Zi._tryCleanFailed))try{$A._emptySource.buffer=null}catch($i){$Zi._tryCleanFailed=!0}var $i=$A.ctx.createBufferSource();$i.buffer=$A._miniBuffer,$i.connect($A.ctx.destination),$i.start(0,0,0),$A._emptySource=$i}},$A._unlock=function(){$A._unlocked||($A._playEmptySound(),"running"==$A.ctx.state?($o.document.removeEventListener("mousedown",$A._unlock,!0),$o.document.removeEventListener("touchend",$A._unlock,!0),$o.document.removeEventListener("touchstart",$A._unlock,!0),$A._unlocked=!0):"suspended"==$A.ctx.state&&$c._recoverWebAudio())},$A.initWebAudio=function(){"running"!=$A.ctx.state&&($A._unlock(),$o.document.addEventListener("mousedown",$A._unlock,!0),$o.document.addEventListener("touchend",$A._unlock,!0),$o.document.addEventListener("touchstart",$A._unlock,!0))},$A._emptySource=null,$A._dataCache={},$A.buffs=[],$A.isDecoding=!1,$A._unlocked=!1,$A.tInfo=null,$A.__loadingSound={},$O($A,["window",function(){return this.window=$o.window},"webAudioEnabled",function(){return this.webAudioEnabled=$A.window.AudioContext||$A.window.webkitAudioContext||$A.window.mozAudioContext},"ctx",function(){return this.ctx=$A.webAudioEnabled?new($A.window.AudioContext||$A.window.webkitAudioContext||$A.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=$A.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new $U}]),$A}(),$qi=function($i){function $p(){this._responseType=null,this._data=null,$p.__super.call(this),this._http=new $o.window.XMLHttpRequest}$x($p,"laya.net.HttpRequest",$U);var $F=$p.prototype;return $F.send=function($i,$p,$F,$J,$A){void 0===$F&&($F="get"),void 0===$J&&($J="text"),this._responseType=$J,this._data=null;var $t=this,$q=this._http;if($q.open($F,$i,!0),$A)for(var $B=0;$B<$A.length;$B++)$q.setRequestHeader($A[$B++],$A[$B]);else $G.isConchApp||($p&&"string"!=typeof $p?$q.setRequestHeader("Content-Type","application/json"):$q.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));$q.responseType="arraybuffer"!==$J?"text":"arraybuffer",$q.onerror=function($i){$t._onError($i)},$q.onabort=function($i){$t._onAbort($i)},$q.onprogress=function($i){$t._onProgress($i)},$q.onload=function($i){$t._onLoad($i)},$q.send($p)},$F._onProgress=function($i){$i&&$i.lengthComputable&&this.event("progress",$i.loaded/$i.total)},$F._onAbort=function($i){this.error("Request was aborted by user")},$F._onError=function($i){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},$F._onLoad=function($i){var $p=this._http,$F=void 0!==$p.status?$p.status:200;200===$F||204===$F||0===$F?this.complete():this.error("["+$p.status+"]"+$p.statusText+":"+$p.responseURL)},$F.error=function($i){this.clear(),this.event("error",$i)},$F.complete=function(){this.clear();var $p=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=$b.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch($i){$p=!1,this.error($i.message)}$p&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},$F.clear=function(){var $i=this._http;$i.onerror=$i.onabort=$i.onprogress=$i.onload=null},$d(0,$F,"url",function(){return this._http.responseURL}),$d(0,$F,"http",function(){return this._http}),$d(0,$F,"data",function(){return this._data}),$p}(),$Bi=function($i){function $P(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,$P.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1,this._base64=!1}$x($P,"laya.net.Loader",$U);var $p=$P.prototype;return $p.load=function($i,$p,$F,$J,$A){if($i&&""!=$i||console.error("Loader 加载的url不合法 "+$i),void 0===$F&&($F=!0),void 0===$A&&($A=!1),this._url=$i,this._base64=!1,0===$i.indexOf("data:image")?(this._base64=!0,this._type=$p="image"):this._type=$p||($p=this.getTypeFromUrl($i)),this._cache=$F,this._data=null,!$A&&$P.loadedMap[$i])return this._data=$P.loadedMap[$i],this.event("progress",1),void this.event("complete",this._data);if($J&&$P.setGroup($i,$J),null!=$P.parserMap[$p])return this._customParse=!0,void($P.parserMap[$p]instanceof laya.utils.Handler?$P.parserMap[$p].runWith(this):$P.parserMap[$p].call(null,this));if("image"===$p||"htmlimage"===$p||"nativeimage"===$p)return this._loadImage($i);if("ttf"===$p)return this._loadTTF($i);switch($p){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:$p}$P.preLoadedMap[$i]?this.onLoaded($P.preLoadedMap[$i]):$q.resMgrLoad($i,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},$p.getTypeFromUrl=function($i){var $p=$b.getFileExtension($i);return $p?$P.typeMap[$p]:(console.warn("Not recognize the resources suffix",$i),"text")},$p._loadTTF=function($i){$i=$I.formatURL($i);var $p=new $n;$p.complete=$M.create(this,this.onLoaded),$p.load($i)},$p._loadBase64Image=function($p){$p=$I.formatURL($p);var $F,$i=this;function $J(){$F.onload=null,$F.onerror=null,delete $P.imgCache[$p]}function $A(){$J(),$i.onLoaded($F)}function $t(){$J(),$i.event("error","Load image failed")}"nativeimage"===this._type?(($F=new $o.window.Image).crossOrigin="",$F.onload=$A,$F.onerror=$t,$F.src=$p,$P.imgCache[$p]=$F):new $gi.create($p,{onload:$A,onerror:$t,onCreate:function($i){$F=$i,$P.imgCache[$p]=$i}})},$p._loadImage=function($i){this._base64?this._loadBase64Image($i):$q.imgMgrLoad($i,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},$p._loadImageComplete=function($i,$p,$F){if(null!=$F)if($F instanceof ArrayBuffer){var $J=new DataView($F),$A=new laya.webgl.resource.WebGLImage(new Uint8Array($F,8),$i,0,!1,$J.getUint32(0),$J.getUint32(4));this.onLoaded($A)}else if($F instanceof $di)$P.imgMgrSet[$i]=$p,$q.imgMgrLock($i,$P.imgMgrSet[$i]),this._url=$i,this.complete($F);else{var $t=-1!=$i.indexOf(".png",$i.length-4)?6408:6407;$A=new laya.webgl.resource.WebGLImage($F,$i,$t,!1,$F.width,$F.height);this.onLoaded($A)}else this.event("error","Load image failed")},$p.imageCancel=function($i,$p,$F){$q.imgMgrCancel&&$q.imgMgrCancel($i,this._onImageCallback)},$p._loadSound=function($i){var $p=new $c._soundClass,$F=this;function $J(){$p.offAll()}$p.on("complete",this,function(){$J(),$F.onLoaded($p)}),$p.on("error",this,function(){$J(),$p.dispose(),$F.event("error","Load sound failed")}),$p.load($i)},$p.onProgress=function($i){"atlas"===this._type?this.event("progress",.3*$i):this.event("progress",$i)},$p.onError=function($i){this.event("error",$i)},$p._loadedComplete=function($i,$p,$F){if(null!=$F)switch(this._type){case"atlas":case"plf":case"json":var $J=new $W($F);this.onLoaded(JSON.parse($J.readUTFBytes()));break;case"font":$J=new $W($F);this.onLoaded($b.parseXMLFromString($J.readUTFBytes()));break;default:this.onLoaded($F)}else this.event("error",$i)},$p.onLoaded=function($i){var $p=this._type;if("plf"==$p)this.parsePLFData($i),this.complete($i);else if("image"===$p){var $F=new $di($i);$F.url=this._url,this.complete($F)}else if("sound"===$p||"htmlimage"===$p||"nativeimage"===$p)this.complete($i);else if("atlas"===$p){if(!$i.src&&!$i._setContext){if(!this._data){if((this._data=$i).meta&&$i.meta.image)for(var $J=$i.meta.image.split(","),$A=0<=this._url.indexOf("/")?"/":"\\",$t=this._url.lastIndexOf($A),$q=0<=$t?this._url.substr(0,$t+1):"",$B=0,$O=$J.length;$B<$O;$B++)$J[$B]=$q+$J[$B];else $J=[this._url.replace(".json",".png")];$J.reverse(),$i.toLoads=$J,$i.pics=[]}return this.event("progress",.3+1/$J.length*.6),this._loadImage($J.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push($i),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var $U=this._data.frames,$d=this._url.split("?")[0],$u=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:$d.substring(0,$d.lastIndexOf("."))+"/",$S=this._data.pics,$Z=$I.formatURL(this._url),$s=$P.atlasMap[$Z]||($P.atlasMap[$Z]=[]);$s.dir=$u;var $x=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var $j in $x=parseFloat(this._data.meta.scale),$U){var $r,$M=$U[$j],$D=$S[$M.frame.idx?$M.frame.idx:0],$E=$I.formatURL($u+$j);$D.scaleRate=$x,$r=$di.create($D,$M.frame.x,$M.frame.y,$M.frame.w,$M.frame.h,$M.spriteSourceSize.x,$M.spriteSourceSize.y,$M.sourceSize.w,$M.sourceSize.h),$P.cacheRes($E,$r),$P.keepCache(this._url,$u+$j),$r.url=$E,$s.push($E)}else for($j in $U)$D=$S[($M=$U[$j]).frame.idx?$M.frame.idx:0],$E=$I.formatURL($u+$j),$P.cacheRes($E,$di.create($D,$M.frame.x,$M.frame.y,$M.frame.w,$M.frame.h,$M.spriteSourceSize.x,$M.spriteSourceSize.y,$M.sourceSize.w,$M.sourceSize.h)),$P.loadedMap[$E].url=$E,$P.keepCache(this._url,$u+$j),$s.push($E);delete this._data.pics,this.complete(this._data)}else if("font"==$p){if(!$i.src)return this._data=$i,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var $v=new $Y;$v.parseFont(this._data,$i);var $g=this._url.split(".fnt")[0].split("/"),$a=$g[$g.length-1];$ji.registerBitmapFont($a,$v),this._data=$v,this.complete(this._data)}else if("pkm"==$p){var $R=$gi.create($i,this._url),$Q=new $di($R);$Q.url=this._url,this.complete($Q)}else this.complete($i)},$p.parsePLFData=function($i){var $p,$F,$J;for($p in $i)switch($J=$i[$p],$p){case"json":case"text":for($F in $J)$P.preLoadedMap[$I.formatURL($F)]=$J[$F];break;default:for($F in $J)$P.preLoadedMap[$I.formatURL($F)]=$J[$F]}},$p.complete=function($i){this._data=$i,this._customParse?this.event("loaded",$i instanceof Array?[$i]:$i):($P._loaders.push(this),$P._isWorking||$P.checkNext())},$p.endLoad=function($i){$i&&(this._data=$i),this._cache&&$P.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},$d(0,$p,"url",function(){return this._url}),$d(0,$p,"data",function(){return this._data}),$d(0,$p,"cache",function(){return this._cache}),$d(0,$p,"type",function(){return this._type}),$P.checkNext=function(){$P._isWorking=!0;for(var $i=$o.now();$P._startIndex<$P._loaders.length;)if($o.now(),$P._loaders[$P._startIndex].endLoad(),$P._startIndex++,$o.now()-$i>$P.maxTimeOut)return console.warn("loader callback cost a long time:"+($o.now()-$i)+" url="+$P._loaders[$P._startIndex-1].url),void $a.timer.frameOnce(1,null,$P.checkNext);$P._loaders.length=0,$P._startIndex=0,$P._isWorking=!1},$P.clearRes=function($i,$p){if(null!=$i){void 0===$p&&($p=!1),$i=$I.formatURL($i);var $F=$P.getAtlas($i);if($F){for(var $J=0,$A=$F.length;$J<$A;$J++){var $t=$F[$J],$q=$P.getRes($t);delete $P.loadedMap[$t],$P.clearCache($i.substring($I.basePath.length),$t.substring($I.basePath.length)),$q&&$q.destroy($p)}$F.length=0,delete $P.atlasMap[$i],delete $P.loadedMap[$i]}else{var $B=$P.loadedMap[$i];$B&&(delete $P.loadedMap[$i],$B instanceof laya.resource.Texture&&$B.bitmap&&$B.destroy($p))}}},$P.clearTextureRes=function($i){$i=$I.formatURL($i);var $p=laya.net.Loader.getAtlas($i),$F=$p&&0<$p.length?laya.net.Loader.getRes($p[0]):laya.net.Loader.getRes($i);$F&&$F.bitmap&&($G.isConchApp&&!$G.isConchWebGL?$F.bitmap.source.releaseTexture&&$F.bitmap.source.releaseTexture():null==$F.bitmap._atlaser&&$F.bitmap.releaseResource(!0))},$P.getRes=function($i){return $P.loadedMap[$I.formatURL($i)]},$P.getAtlas=function($i){return $P.atlasMap[$I.formatURL($i)]},$P.cacheRes=function($i,$p){$i=$I.formatURL($i),null!=$P.loadedMap[$i]?console.warn("Resources already exist,is repeated loading:",$i):$P.loadedMap[$i]=$p},$P.setGroup=function($i,$p){$P.groupMap[$p]||($P.groupMap[$p]=[]),$P.groupMap[$p].push($i)},$P.clearResByGroup=function($i){if($P.groupMap[$i]){var $p=$P.groupMap[$i],$F=0,$J=$p.length;for($F=0;$F<$J;$F++)$P.clearRes($p[$F]);$p.length=0}},$P.keepCache=function($i,$p){if($i&&$p){var $F=$P.cacheSet[$p];$F?-1==$F.indexOf($i)&&$F.push($i):$P.cacheSet[$p]=[$i]}},$P.clearCache=function($i,$p){if($i&&$p){var $F=$P.cacheSet[$p];if($F){var $J=$F.indexOf($i);if(-1!==$J){var $A=$F.length-1;0==$A?(delete $P.cacheSet[$p],0<$P.imgMgrSet[$p]?$q.imgMgrFree($p,$P.imgMgrSet[$p]):$P.clearRes($p,!0)):($F[$J]=$F[$A],$F.length=$A)}}}},$P.saveObject=function($i,$p,$F){if($p&&$i){var $J=$P.objectSet[$i];$J?(console.warn("Loader.saveObject: "+$i),$J[0]=$p,$J[1]=$F):$P.objectSet[$i]=[$p,$F,[]]}},$P.findObject=function($i){if($i){var $p=$P.objectSet[$i];if($p)return $p[0]}return null},$P.keepObject=function($i,$p){if($i&&$p){var $F=$P.objectSet[$p];$F&&-1===$F[2].indexOf($i)&&$F[2].push($i)}},$P.clearObject=function($i,$p){if($i&&$p){var $F=$P.objectSet[$p];if($F){var $J=$F[2],$A=$J.indexOf($i);if(-1!==$A){var $t=$J.length-1;0==$t?(delete $P.objectSet[$p],$F[1]&&$F[1].call(null,$F[0])):($J[$A]=$J[$t],$J.length=$t)}}}},$P.TEXT="text",$P.JSON="json",$P.XML="xml",$P.BUFFER="arraybuffer",$P.IMAGE="image",$P.SOUND="sound",$P.ATLAS="atlas",$P.FONT="font",$P.TTF="ttf",$P.PLF="plf",$P.PKM="pkm",$P.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},$P.parserMap={},$P.groupMap={},$P.maxTimeOut=100,$P.loadedMap={},$P.preLoadedMap={},$P.atlasMap={},$P._loaders=[],$P._isWorking=!1,$P._startIndex=0,$P.imgCache={},$P.cacheSet={},$P.objectSet={},$P.imgMgrSet={},$P}(),$Oi=function($i){var $S;function $Z(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},$Z.__super.call(this);for(var $i=0;$i<this._maxPriority;$i++)this._resInfos[$i]=[]}$x($Z,"laya.net.LoaderManager",$U);var $p=$Z.prototype;return $p.create=function($i,$F,$p,$J,$A,$t,$q,$B){if(null==$t&&($t=2),null==$q&&($q=!0),$i instanceof Array){var $O=$i,$U=$O.length,$d=0;if($p)var $u=$M.create($p.caller,$p.method,$p.args,!1);for(var $S=0;$S<$U;$S++){var $Z=$O[$S];"string"==typeof $Z&&($Z=$O[$S]={url:$Z}),$Z.progress=0}for($S=0;$S<$U;$S++){$Z=$O[$S];var $s=$p?$M.create(null,$r,[$Z],!1):null,$x=$p||$F?$M.create(null,$j,[$Z]):null;this._create($Z.url,$x,$s,$Z.clas||$J,$Z.params||$A,null!=$Z.priority&&0<=$Z.priority?$Z.priority:$t,$q,$Z.group||$B)}function $j($i,$p){$d++,$i.progress=1,$d===$U&&$F&&$F.run()}function $r($i,$p){$i.progress=$p;for(var $F=0,$J=0;$J<$U;$J++){$F+=$O[$J].progress}var $A=$F/$U;$u.runWith($A)}return!0}return this._create($i,$F,$p,$J,$A,$t,$q,$B)},$p._create=function($p,$F,$i,$J,$A,$t,$q,$B){$p&&""!=$p||console.error("加载的url不合法 "+$p),null==$t&&($t=2),null==$q&&($q=!0);var $O=$I.formatURL($p),$U=this.getRes($O);if($U)!$U.hasOwnProperty("loaded")||$U.loaded?($i&&$i.runWith(1),$F&&$F.run()):$F&&$a.loader._createListener($p,$F.caller,$F.method,$F.args,!0,!1);else{var $d=$b.getFileExtension($p),$u=$Z.createMap[$d];if(!$u)throw new Error("LoaderManager:unknown file("+$p+") extension with: "+$d+".");$J||($J=$u[0]);var $S=$u[1];if("atlas"==$d)this.load($p,$F,$i,$S,$t,$q);else{$J===$di&&($S="htmlimage"),($U=$J?new $J:null).hasOwnProperty("_loaded")&&($U._loaded=!1),$U._setUrl($p),$B&&$U._setGroup($B),this._createLoad($U,$p,$M.create(null,function($i){$U&&!$U.destroyed&&$i&&$U.onAsynLoaded.call($U,$p,$i,$A),$F&&$F.run();$a.loader.event($p)}),$i,$S,$t,!1,$B,!0),$q&&this.cacheRes($O,$U)}}return $U},$p.load=function($i,$p,$F,$J,$A,$t,$q,$B){$i&&""!=$i||console.error("加载的url不合法 "+$i);var $O=this;if(null==$A&&($A=2),null==$t&&($t=!0),void 0===$B&&($B=!1),$i instanceof Array)return this._loadAssets($i,$p,$F,$J,$A,$t,$q);var $U=$Bi.getRes($i);if(null!=$U)$a.timer.frameOnce(1,null,function(){$F&&$F.runWith(1),$p&&$p.runWith($U),$O._loaderCount||$O.event("complete")});else{var $d=$Z._resMap[$i];$d?($p&&$d._createListener("complete",$p.caller,$p.method,$p.args,!1,!1),$F&&$d._createListener("progress",$F.caller,$F.method,$F.args,!1,!1)):(($d=this._infoPool.length?this._infoPool.pop():new $S).url=$i,$d.clas=null,$d.type=$J,$d.cache=$t,$d.group=$q,$d.ignoreCache=$B,$d.priority=$A,$p&&$d.on("complete",$p.caller,$p.method,$p.args),$F&&$d.on("progress",$F.caller,$F.method,$F.args),$Z._resMap[$i]=$d,$A=$A<this._maxPriority?0<=$A?$A:0:this._maxPriority-1,this._resInfos[$A].push($d),this._next())}return this},$p.cancel=function($i,$p,$F){if($U=$Z._resMap[$i]){$p&&$U.off("complete",$p.caller,$p.method,!1),$F&&$U.off("progress",$F.caller,$F.method,!1);var $J=$U.getListener("complete"),$A=$U.getListener("progress");if(!($J&&$J.head||$A&&$A.head)){if($U.loader){var $t=$U.loader;$t.imageCancel($i),$t.offAll(),$t._data=null,$t._customParse=!1,$t._url=null,$t._class=null,$t._type=null,this._loaders.push($t),this._loaderCount--,delete this._loaderMap[$U.url]}for(var $q=0;$q<this._maxPriority;$q++)for(var $B=this._resInfos[$q],$O=$B.length-1;-1<$O;$O--){var $U;($U=$B[$O])&&$U.url===$i&&($B[$O]=null,$U.destroy(),$U.offAll(),this._infoPool.push($U))}delete $Z._resMap[$i],this._next()}}},$p._createLoad=function($i,$p,$F,$J,$A,$t,$q,$B,$O){var $U=this;if(null==$t&&($t=2),null==$q&&($q=!0),void 0===$O&&($O=!1),$p instanceof Array)return this._loadAssets($p,$F,$J,$A,$t,$q,$B);var $d=$Bi.getRes($p);if(null!=$d)$a.timer.frameOnce(1,null,function(){$J&&$J.runWith(1),$F&&$F.runWith($d),$U._loaderCount||$U.event("complete")});else{var $u=$Z._resMap[$p];$u?($F&&$u._createListener("complete",$F.caller,$F.method,$F.args,!1,!1),$J&&$u._createListener("progress",$J.caller,$J.method,$J.args,!1,!1)):(($u=this._infoPool.length?this._infoPool.pop():new $S).url=$p,$u.clas=$i,$u.type=$A,$u.cache=$q,$u.group=$B,$u.ignoreCache=$O,$u.priority=$t,$F&&$u.on("complete",$F.caller,$F.method,$F.args),$J&&$u.on("progress",$J.caller,$J.method,$J.args),$Z._resMap[$p]=$u,$t=$t<this._maxPriority?0<=$t?$t:0:this._maxPriority-1,this._resInfos[$t].push($u),this._next())}return this},$p._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var $i=0;$i<this._maxPriority;$i++)for(var $p=this._resInfos[$i];0<$p.length;){var $F=$p.shift();if($F)return this._doLoad($F)}this._loaderCount||this.event("complete")}},$p._doLoad=function($p){var $F=this._loaders.length?this._loaders.pop():new $Bi;this._loaderCount++,(this._loaderMap[$p.url]=$F).on("complete",null,$A),$F.on("progress",null,function($i){$p.event("progress",$i)}),$F.on("error",null,function($i){$A(null)}),$p.loader=$F;var $J=this;function $A($i){$F.offAll(),$F._data=null,$F._customParse=!1,$F._url=null,$F._class=null,$F._type=null,$J._loaders.push($F),$J._loaderCount--,delete $J._loaderMap[$p.url],$J._endLoad($p,$i instanceof Array?[$i]:$i),$J._next()}$F._class=$p.clas,1<=$p.priority?($F.priority=$p.priority,$F.realTime=!1):($F.priority=0,$F.realTime=!0),$F.load($p.url,$p.type,$p.cache,$p.group,$p.ignoreCache)},$p._endLoad=function($i,$p){var $F=$i.url;if(null==$p){var $J=this._failRes[$F]||0;if($J<this.retryNum)return console.warn("[warn]Retry to load:",$F),this._failRes[$F]=$J+1,void $a.timer.once(this.retryDelay,this,this._addReTry,[$i],!1);console.warn("[error]Failed to load:",$F),this.event("error",$F)}this._failRes[$F]&&(this._failRes[$F]=0),delete $Z._resMap[$F],$i.event("complete",$p),$i.destroy(),$i.offAll(),this._infoPool.push($i)},$p._addReTry=function($i){this._resInfos[this._maxPriority-1].push($i),this._next()},$p.clearRes=function($i,$p){void 0===$p&&($p=!1),$Bi.clearRes($i,$p)},$p.getRes=function($i){return $Bi.getRes($i)},$p.cacheRes=function($i,$p){$Bi.cacheRes($i,$p)},$p.clearTextureRes=function($i){$Bi.clearTextureRes($i)},$p.setGroup=function($i,$p){$Bi.setGroup($i,$p)},$p.clearResByGroup=function($i){$Bi.clearResByGroup($i)},$p.clearUnLoaded=function(){for(var $i=0;$i<this._maxPriority;$i++){for(var $p=this._resInfos[$i],$F=$p.length-1;-1<$F;$F--){var $J=$p[$F];$J&&($J.destroy(),$J.offAll(),this._infoPool.push($J))}$p.length=0}this._loaderCount=0,$Z._resMap={}},$p.cancelLoadByUrls=function($i){if($i)for(var $p=0,$F=$i.length;$p<$F;$p++)this.cancelLoadByUrl($i[$p])},$p.cancelLoadByUrl=function($i){for(var $p=0;$p<this._maxPriority;$p++)for(var $F=this._resInfos[$p],$J=$F.length-1;-1<$J;$J--){var $A=$F[$J];$A&&$A.url===$i&&($F[$J]=null,$A.destroy(),$A.offAll(),this._infoPool.push($A))}$Z._resMap[$i]&&delete $Z._resMap[$i]},$p._loadAssets=function($i,$F,$q,$p,$J,$A,$t){null==$J&&($J=2),null==$A&&($A=!0);for(var $B=$i.length,$O=0,$U=0,$d=[],$u=!0,$S=0;$S<$B;$S++){var $Z=$i[$S];if(!$Z)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+$i);"string"==typeof $Z&&($Z={url:$Z,type:$p,size:1,priority:$J}),$Z.size||($Z.size=1),$Z.progress=0,$U+=$Z.size,$d.push($Z);var $s=$q?$M.create(null,$r,[$Z],!1):null,$x=$F||$q?$M.create(null,$j,[$Z]):null;this.load($Z.url,$x,$s,$Z.type,null!=$Z.priority&&0<=$Z.priority?$Z.priority:2,$A,$Z.group||$t)}function $j($i,$p){$O++,$i.progress=1,$p||($u=!1),$O===$B&&$F&&$F.runWith($u)}function $r($i,$p){if(null!=$q){$i.progress=$p;for(var $F=0,$J=0;$J<$d.length;$J++){var $A=$d[$J];$F+=$A.size*$A.progress}var $t=$F/$U;$q.runWith($t)}}return this},$Z.cacheRes=function($i,$p){$Bi.cacheRes($i,$p)},$Z._resMap={},$O($Z,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),$Z.__init$=function(){$S=function($i){function $p(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,$p.__super.call(this)}return $x($p,"",$U),$p.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},$p}()},$Z}(),$Ui=(function($i){function $A($i){$A.__super.call(this),$i||($i=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var $p=0,$F=0,$J=0;$J<20;$J++)$J%5!=4?this._mat[$p++]=$i[$J]:this._alpha[$F++]=$i[$J];this._action=$h.createFilterAction(32),this._action.data=this}$x($A,"laya.filters.ColorFilter",$r);var $p=$A.prototype;$a.imps($p,{"laya.filters.IFilter":!0}),$p.callNative=function($i){$i._$P.cf=this;$i.conchModel&&$i.conchModel.setFilterMatrix&&$i.conchModel.setFilterMatrix(this._mat,this._alpha)},$d(0,$p,"type",function(){return 32}),$d(0,$p,"action",function(){return this._action})}(),function($i){function $J($i,$p,$F){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===$p&&($p=0),$J.__super.call(this),this._byteClass=$F||$W,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,$i&&0<$p&&$p<65535&&this.connect($i,$p)}$x($J,"laya.net.Socket",$U);var $p=$J.prototype;$p.connect=function($i,$p){var $F="ws://"+$i+":"+$p;$F="https:"==$o.window.location.protocol?"wss://"+$i+":"+$p:"ws://"+$i+":"+$p,this.connectByUrl($F)},$p.connectByUrl=function($i){var $p=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new $o.window.WebSocket($i,this.protocols):this._socket=new $o.window.WebSocket($i),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function($i){$p._onOpen($i)},this._socket.onmessage=function($i){$p._onMessage($i)},this._socket.onclose=function($i){$p._onClose($i)},this._socket.onerror=function($i){$p._onError($i)}},$p.cleanSocket=function(){try{this._socket.close()}catch($i){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},$p.close=function(){if(null!=this._socket)try{this._socket.close()}catch($i){}},$p._onOpen=function($i){this._connected=!0,this.event("open",$i)},$p._onMessage=function($i){if($i&&$i.data){var $p=$i.data;if(this.disableInput&&$p)this.event("message",$p);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var $F=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,$p&&("string"==typeof $p?this._input.writeUTFBytes($p):this._input.writeArrayBuffer($p),this._addInputPosition=this._input.pos,this._input.pos=$F),this.event("message",$p)}}},$p._onClose=function($i){this._connected=!1,this.event("close",$i)},$p._onError=function($i){this.event("error",$i)},$p.send=function($i){this._socket.send($i)},$p.flush=function(){if(this._output&&0<this._output.length){var $p;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch($i){$p=$i}this._output.endian=this.endian,this._output.clear(),$p&&this.event("error",$p)}},$d(0,$p,"input",function(){return this._input}),$d(0,$p,"output",function(){return this._output}),$d(0,$p,"connected",function(){return this._connected}),$d(0,$p,"endian",function(){return this._endian},function($i){this._endian=$i,null!=this._input&&(this._input.endian=$i),null!=this._output&&(this._output.endian=$i)}),$J.LITTLE_ENDIAN="littleEndian",$J.BIG_ENDIAN="bigEndian"}(),function($i){function $B(){$B.__super.call(this),this._$1__id=++$B._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,($B._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,$f.currentResourceManager&&$f.currentResourceManager.addResource(this)}$x($B,"laya.resource.Resource",$U);var $p=$B.prototype;return $a.imps($p,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),$p._setUrl=function($i){var $p;this._url!==$i&&(this._url&&(($p=$B._urlResourcesMap[this._url]).splice($p.indexOf(this),1),0===$p.length&&delete $B._urlResourcesMap[this._url]),$i&&(($p=$B._urlResourcesMap[$i])||($B._urlResourcesMap[$i]=$p=[]),$p.push(this)),this._url=$i)},$p._getGroup=function(){return this._group},$p._setGroup=function($i){var $p;this._group!==$i&&(this._group&&(($p=$B._groupResourcesMap[this._group]).splice($p.indexOf(this),1),0===$p.length&&delete $B._groupResourcesMap[this._group]),$i&&(($p=$B._groupResourcesMap[$i])||($B._groupResourcesMap[$i]=$p=[]),$p.push(this)),this._group=$i)},$p._addReference=function(){this._referenceCount++},$p._removeReference=function(){this._referenceCount--},$p._clearReference=function(){this._referenceCount=0},$p._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},$p.recreateResource=function(){this.completeCreate()},$p.disposeResource=function(){},$p.activeResource=function($i){void 0===$i&&($i=!1),this._lastUseFrameCount=$$.loopCount,!this._destroyed&&this.__loaded&&(this._released||$i)&&this.recreateResource()},$p.releaseResource=function($i){return void 0===$i&&($i=!0),!(!$i&&this.lock)&&(!(this._released&&!$i)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},$p.onAsynLoaded=function($i,$p,$F){throw new Error("Resource: must override this function!")},$p.destroy=function(){var $i;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete $B._idResourcesMap[this.id],this._url&&(($i=$B._urlResourcesMap[this._url])&&($i.splice($i.indexOf(this),1),0===$i.length&&delete $B._urlResourcesMap[this.url]),$Bi.clearRes(this._url),this.__loaded||$h.cancelLoadByUrl(this._url)),this._group&&(($i=$B._groupResourcesMap[this._group]).splice($i.indexOf(this),1),0===$i.length&&delete $B._groupResourcesMap[this.url]))},$p.completeCreate=function(){this._released=!1,this.event("recovered",this)},$p.dispose=function(){this.destroy()},$d(0,$p,"memorySize",function(){return this._memorySize},function($i){var $p=$i-this._memorySize;this._memorySize=$i,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,$p),this.resourceManager&&this.resourceManager.addSize($p)}),$d(0,$p,"_loaded",null,function($i){this.__loaded=$i}),$d(0,$p,"loaded",function(){return this.__loaded}),$d(0,$p,"id",function(){return this._$1__id}),$d(0,$p,"destroyed",function(){return this._destroyed}),$d(0,$p,"group",function(){return this._getGroup()},function($i){this._setGroup($i)}),$d(0,$p,"resourceManager",function(){return this._resourceManager}),$d(0,$p,"url",function(){return this._url}),$d(0,$p,"released",function(){return this._released}),$d(0,$p,"referenceCount",function(){return this._referenceCount}),$B.getResourceByID=function($i){return $B._idResourcesMap[$i]},$B.getResourceByURL=function($i,$p){return void 0===$p&&($p=0),null==$B._urlResourcesMap[$i]?null:$B._urlResourcesMap[$i][$p]},$B.getResourceCountByURL=function($i){return $B._urlResourcesMap[$i].length},$B.destroyUnusedResources=function($i){var $p;if($i){var $F=$B._groupResourcesMap[$i];if($F)for(var $J=$F.slice(),$A=0,$t=$J.length;$A<$t;$A++)($p=$J[$A]).lock||0!==$p._referenceCount||$p.destroy()}else for(var $q in $B._idResourcesMap)($p=$B._idResourcesMap[$q]).lock||0!==$p._referenceCount||$p.destroy()},$B._uniqueIDCounter=0,$B._idResourcesMap={},$B._urlResourcesMap={},$B._groupResourcesMap={},$B}()),$di=function($i){function $P($i,$p){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,$P.__super.call(this),$i&&null!=$i._addReference&&$i._addReference(),this.setTo($i,$p)}$x($P,"laya.resource.Texture",$U);var $p=$P.prototype;return $p._setUrl=function($i){this.url=$i},$p.setTo=function($i,$p){if($i instanceof $q.HTMLElement){var $F=$Di.create("2D",$i);this.bitmap=$F}else this.bitmap=$i;if(this.uv=$p||$P.DEF_UV,$i){this._w=$i.width,this._h=$i.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var $J=this;if(this._loaded)$h.addToAtlas&&$h.addToAtlas($J);else{var $A=$i;$A instanceof laya.resource.HTMLImage&&$A.image&&$A.image.addEventListener("load",function($i){$h.addToAtlas&&$h.addToAtlas($J)},!1)}}},$p.active=function(){this.bitmap&&this.bitmap.activeResource()},$p.destroy=function($i){if(void 0===$i&&($i=!1),this.alphaTexture&&(this.alphaTexture.destroy($i),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var $p=this.bitmap;$i?($G.isConchApp&&$p.source&&$p.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$p.dispose(),$p._clearReference()):($p._removeReference(),0==$p.referenceCount&&($G.isConchApp&&$p.source&&$p.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,$p.dispose())),this.url&&this===$a.loader.getRes(this.url)&&$a.loader.clearRes(this.url,$i),this._loaded=!1}},$p.load=function($i){var $p=this;this._loaded=!1,$i=$I.customFormat($i);var $F=this.bitmap||(this.bitmap=$gi.create($i));$F.uri=$i,$F&&$F._addReference();var $J=this;$F.onload=function(){$F.onload=null,$J._loaded=!0,$p.sourceWidth=$p._w=$F.width,$p.sourceHeight=$p._h=$F.height,$J.event("loaded",this),$h.addToAtlas&&$h.addToAtlas($J)}},$p.addTextureToAtlas=function($i){$h.addTextureToAtlas(this)},$p.getPixels=function($i,$p,$F,$J){if($G.isConchApp){var $A=this.bitmap;if($A.source&&$A.source.getImageData){var $t=$A.source.getImageData($i,$p,$F,$J),$q=new Uint8Array($t);return Array.from($q)}return null}return $G.isWebGL?$h.getTexturePixels(this,$i,$p,$F,$J):($o.canvas.size($F,$J),$o.canvas.clear(),$o.context.drawTexture(this,-$i,-$p,this.width,this.height,0,0),$o.context.getImageData(0,0,$F,$J).data)},$p.onAsynLoaded=function($i,$p){if($p){if("function"!=typeof $p._addReference)throw new Error("bitmap._addReference is not a function. "+$p.className+" "+typeof $p._addReference+" "+$p.constructor);$p._addReference()}this.setTo($p,this.uv),this._loaded&&this.event("loaded",this)},$d(0,$p,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),$d(0,$p,"loaded",function(){return this._loaded}),$d(0,$p,"released",function(){return!this.bitmap||this.bitmap.released}),$d(0,$p,"width",function(){return this._w?this._w:this.uv&&this.uv!==$P.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function($i){this._w=$i,this.sourceWidth||(this.sourceWidth=$i)}),$d(0,$p,"repeat",function(){return!$G.isWebGL||!this.bitmap||this.bitmap.repeat},function($i){$i&&$G.isWebGL&&this.bitmap&&(this.bitmap.repeat=$i)&&(this.bitmap.enableMerageInAtlas=!1)}),$d(0,$p,"height",function(){return this._h?this._h:this.uv&&this.uv!==$P.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function($i){this._h=$i,this.sourceHeight||(this.sourceHeight=$i)}),$d(0,$p,"isLinearSampling",function(){return!$G.isWebGL||9728!=this.bitmap.minFifter},function($i){!$i&&$G.isWebGL&&($i||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),$P.moveUV=function($i,$p,$F){for(var $J=0;$J<8;$J+=2)$F[$J]+=$i,$F[$J+1]+=$p;return $F},$P.create=function($i,$p,$F,$J,$A,$t,$q,$B,$O){void 0===$t&&($t=0),void 0===$q&&($q=0),void 0===$B&&($B=0),void 0===$O&&($O=0);var $U=$i instanceof laya.resource.Texture,$d=$U?$i.uv:$P.DEF_UV,$u=$U?$i.bitmap:$i,$S=$h.isAtlas($u);if($S){var $Z=$u._atlaser,$s=$i._atlasID;if(-1==$s)throw new Error("create texture error");$u=$Z._inAtlasTextureBitmapValue[$s],$d=$Z._inAtlasTextureOriUVValue[$s]}var $x=new $P($u,null);$u.width&&$p+$J>$u.width&&($J=$u.width-$p),$u.height&&$F+$A>$u.height&&($A=$u.height-$F),$x.width=$J,$x.height=$A,$x.offsetX=$t,$x.offsetY=$q,$x.sourceWidth=$B||$J,$x.sourceHeight=$O||$A;var $j=1/$u.width,$r=1/$u.height;$p*=$j,$F*=$r,$J*=$j,$A*=$r;var $M=$x.uv[0],$D=$x.uv[1],$E=$x.uv[4],$v=$x.uv[5],$g=$E-$M,$a=$v-$D,$R=$P.moveUV($d[0],$d[1],[$p,$F,$p+$J,$F,$p+$J,$F+$A,$p,$F+$A]);$x.uv=[$M+$R[0]*$g,$D+$R[1]*$a,$E-(1-$R[2])*$g,$D+$R[3]*$a,$E-(1-$R[4])*$g,$v-(1-$R[5])*$a,$M+$R[6]*$g,$v-(1-$R[7])*$a],$S&&$x.addTextureToAtlas();var $Q=$u.scaleRate;return $Q&&1!=$Q?($x.sourceWidth/=$Q,$x.sourceHeight/=$Q,$x.width/=$Q,$x.height/=$Q,$x.scaleRate=$Q,$x.offsetX/=$Q,$x.offsetY/=$Q):$x.scaleRate=1,$x},$P.createFromTexture=function($i,$p,$F,$J,$A){var $t=$i.scaleRate;1!=$t&&($p*=$t,$F*=$t,$J*=$t,$A*=$t);var $q=$Q.TEMP.setTo($p-$i.offsetX,$F-$i.offsetY,$J,$A),$B=$q.intersection($P._rect1.setTo(0,0,$i.width,$i.height),$P._rect2);if(!$B)return null;var $O=$P.create($i,$B.x,$B.y,$B.width,$B.height,$B.x-$q.x,$B.y-$q.y,$J,$A);if($O.bitmap&&$O.bitmap._removeReference)return $O.bitmap._removeReference(),$O;var $U="bitmap:"+($O.bitmap?$O.bitmap.constructor?$O.bitmap.constructor.name:$O.bitmap.__className:"")+", url:"+($i.url+" | "+($O.bitmap?$O.bitmap.url:$i.url))+", x="+$p+",y="+$F+",width="+$J+",height="+$A+", result="+($B?$B.x+","+$B.y+","+$B.width+","+$B.height:"null")+", rect="+$q.x+","+$q.y+","+$q.width+","+$q.height;throw new Error("报错：bitmap._removeReference is not a function  "+$U)},$P.DEF_UV=[0,0,1,0,1,1,0,1],$P.INV_UV=[0,1,1,1,1,0,0,0],$P._rect1=new $Q,$P._rect2=new $Q,$P}(),$i=function($i){var $B;function $t(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,$t.__super.call(this)}$x($t,"laya.utils.TimeLine",$U);var $p=$t.prototype;return $p.to=function($i,$p,$F,$J,$A){return void 0===$A&&($A=0),this._create($i,$p,$F,$J,$A,!0)},$p.from=function($i,$p,$F,$J,$A){return void 0===$A&&($A=0),this._create($i,$p,$F,$J,$A,!1)},$p._create=function($i,$p,$F,$J,$A,$t){var $q=$w.getItemByClass("tweenData",$B);return $q.isTo=$t,$q.type=0,$q.target=$i,$q.duration=$F,$q.data=$p,$q.startTime=this._startTime+$A,$q.endTime=$q.startTime+$q.duration,$q.ease=$J,this._startTime=Math.max($q.endTime,this._startTime),this._tweenDataList.push($q),this._startTimeSort=!0,this._endTimeSort=!0,this},$p.addLabel=function($i,$p){var $F=$w.getItemByClass("tweenData",$B);return $F.type=1,$F.data=$i,$F.endTime=$F.startTime=this._startTime+$p,this._labelDic||(this._labelDic={}),this._labelDic[$i]=$F,this._tweenDataList.push($F),this},$p.removeLabel=function($i){if(this._labelDic&&this._labelDic[$i]){var $p=this._labelDic[$i];if($p){var $F=this._tweenDataList.indexOf($p);-1<$F&&this._tweenDataList.splice($F,1)}delete this._labelDic[$i]}},$p.gotoTime=function($i){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var $p,$F,$J,$A;for(var $t in this._firstTweenDic)if($F=this._firstTweenDic[$t])for(var $q in $F)$F.diyTarget.hasOwnProperty($q)&&($F.diyTarget[$q]=$F[$q]);for($t in this._tweenDic)($p=this._tweenDic[$t]).clear(),delete this._tweenDic[$t];if(this._index=0,this._gidIndex=0,this._currTime=$i,this._lastTime=$o.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=$J=this._tweenDataList.concat(),$J.sort(function($i,$p){return $i.endTime>$p.endTime?1:$i.endTime<$p.endTime?-1:0})}else $J=this._endTweenDataList;for(var $B=0,$O=$J.length;$B<$O;$B++)if(0==($A=$J[$B]).type){if(!($i>=$A.endTime))break;this._index=Math.max(this._index,$B+1);var $U=$A.data;if($A.isTo)for(var $d in $U)$A.target[$d]=$U[$d]}for($B=0,$O=this._tweenDataList.length;$B<$O;$B++)0==($A=this._tweenDataList[$B]).type&&$i>=$A.startTime&&$i<$A.endTime&&(this._index=Math.max(this._index,$B+1),this._gidIndex++,($p=$w.getItemByClass("tween",$e))._create($A.target,$A.data,$A.duration,$A.ease,$M.create(this,this._animComplete,[this._gidIndex]),0,!1,$A.isTo,!0,!1),$p.setStartTime(this._currTime-($i-$A.startTime)),$p._updateEase(this._currTime),$p.gid=this._gidIndex,this._tweenDic[this._gidIndex]=$p)}},$p.gotoLabel=function($i){if(null!=this._labelDic){var $p=this._labelDic[$i];$p&&this.gotoTime($p.startTime)}},$p.pause=function(){$a.timer.clear(this,this._update)},$p.resume=function(){this.play(this._currTime,this._loopKey)},$p.play=function($i,$p){if(void 0===$i&&($i=0),void 0===$p&&($p=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function($i,$p){return $i.startTime>$p.startTime?1:$i.startTime<$p.startTime?-1:0});for(var $F=0,$J=this._tweenDataList.length;$F<$J;$F++){var $A=this._tweenDataList[$F];if(null!=$A&&0==$A.type){var $t=$A.target,$q=$t.$_GID||($t.$_GID=$b.getGID()),$B=null;for(var $O in null==this._firstTweenDic[$q]?(($B={}).diyTarget=$t,this._firstTweenDic[$q]=$B):$B=this._firstTweenDic[$q],$A.data)null==$B[$O]&&($B[$O]=$t[$O])}}}"string"==typeof $i?this.gotoLabel($i):this.gotoTime($i),this._loopKey=$p,this._lastTime=$o.now(),$a.timer.frameLoop(1,this,this._update)}},$p._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var $i in this._tweenDic)($p=this._tweenDic[$i]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var $p,$F=$o.now(),$J=$F-this._lastTime,$A=this._currTime+=$J*this.scale;for($i in this._lastTime=$F,this._tweenDic)($p=this._tweenDic[$i])._updateEase($A);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var $t=this._tweenDataList[this._index];$A>=$t.startTime&&(this._index++,0==$t.type?(this._gidIndex++,($p=$w.getItemByClass("tween",$e))._create($t.target,$t.data,$t.duration,$t.ease,$M.create(this,this._animComplete,[this._gidIndex]),0,!1,$t.isTo,!0,!1),$p.setStartTime($A),$p.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=$p)._updateEase($A)):this.event("label",$t.data))}},$p._animComplete=function($i){this._tweenDic[$i]&&delete this._tweenDic[$i]},$p._complete=function(){this.event("complete")},$p.reset=function(){var $i;if(this._labelDic)for($i in this._labelDic)delete this._labelDic[$i];for($i in this._tweenDic)this._tweenDic[$i].clear(),delete this._tweenDic[$i];for($i in this._firstTweenDic)delete this._firstTweenDic[$i];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var $p,$F=0;for($p=this._tweenDataList.length,$F=0;$F<$p;$F++)this._tweenDataList[$F]&&this._tweenDataList[$F].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,$a.timer.clear(this,this._update)},$p.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},$d(0,$p,"index",function(){return this._frameIndex},function($i){this._frameIndex=$i,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),$d(0,$p,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),$t.to=function($i,$p,$F,$J,$A){return void 0===$A&&($A=0),(new $t).to($i,$p,$F,$J,$A)},$t.from=function($i,$p,$F,$J,$A){return void 0===$A&&($A=0),(new $t).from($i,$p,$F,$J,$A)},$t.__init$=function(){$B=function(){function $i(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return $x($i,""),$i.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,$w.recover("tweenData",this)},$i}()},$t}(),$ui=function($A){function $F(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,$F.__super.call(this),this._style=$B.EMPTY}$x($F,"laya.display.Sprite",$A);var $i=$F.prototype;return $a.imps($i,{"laya.display.ILayout":!0}),$i.createConchModel=function(){return new ConchNode},$i.destroy=function($i){if(void 0===$i&&($i=!0),this._releaseMem(),!this._destroyed){this.filters=null;var $p=this.mask;$p&&(this.mask=null,$p.destroy($i))}$A.prototype.destroy.call(this,$i),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},$i.updateZOrder=function(){$b.updateOrder(this._childs)&&this.repaint()},$i.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},$i.setBounds=function($i){this._set$P("uBounds",$i)},$i.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new $Q),$Q._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},$i.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new $Q),$Q._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},$i._boundPointsToParent=function($i){void 0===$i&&($i=!1);var $p=0,$F=0;this._style&&($p=this._style._tf.translateX,$F=this._style._tf.translateY,$i=$i||0!==this._style._tf.rotate,this._style.scrollRect&&($p+=this._style.scrollRect.x,$F+=this._style.scrollRect.y));var $J=this._getBoundPointsM($i);if(!$J||$J.length<1)return $J;if(8!=$J.length&&($J=$i?$v.scanPList($J):$Q._getWrapRec($J,$Q.TEMP)._getBoundPoints()),!this.transform)return $b.transPointList($J,this._x-$p,this._y-$F),$J;var $A=$R.TEMP,$t=0,$q=$J.length;for($t=0;$t<$q;$t+=2)$A.x=$J[$t],$A.y=$J[$t+1],this.toParentPoint($A),$J[$t]=$A.x,$J[$t+1]=$A.y;return $J},$i.getGraphicBounds=function($i){return void 0===$i&&($i=!1),this._graphics?this._graphics.getBounds($i):$Q.TEMP.setTo(0,0,0,0)},$i._getBoundPointsM=function($i){if(void 0===$i&&($i=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var $p=$b.clearArray(this._$P.temBM),$F=$Q.TEMP;return $F.copyFrom(this.scrollRect),$b.concatArray($p,$F._getBoundPoints()),$p}for(var $J,$A,$t,$q=this._graphics?this._graphics.getBoundPoints():$b.clearArray(this._$P.temBM),$B=0,$O=($t=this._childs).length;$B<$O;$B++)($J=$t[$B])instanceof laya.display.Sprite&&1==$J.visible&&($A=$J._boundPointsToParent($i))&&($q=$q?$b.concatArray($q,$A):$A);return $q},$i.getStyle=function(){return this._style===$B.EMPTY&&(this._style=new $B),this._style},$i.setStyle=function($i){this._style=$i},$i._adjustTransform=function(){this._tfChanged=!1;var $i,$p=this._style._tf,$F=$p.scaleX,$J=$p.scaleY;if($p.rotate||1!==$F||1!==$J||$p.skewX||$p.skewY){($i=this._transform||(this._transform=$m.create())).bTransform=!0;var $A=.0174532922222222*($p.rotate-$p.skewX),$t=.0174532922222222*($p.rotate+$p.skewY),$q=Math.cos($t),$B=Math.sin($t),$O=Math.sin($A),$U=Math.cos($A);return $i.a=$F*$q,$i.b=$F*$B,$i.c=-$J*$O,$i.d=$J*$U,$i.tx=$i.ty=0,$i}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,$i},$i.pos=function($i,$p,$F){if(void 0===$F&&($F=!1),this._x!==$i||this._y!==$p){if(this.destroyed)return this;if($F){this._x=$i,this._y=$p,this.conchModel&&this.conchModel.pos(this._x,this._y);var $J=this._parent;$J&&0===$J._repaint&&($J._repaint=1,$J.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=$i,this.y=$p}return this},$i.pivot=function($i,$p){return this.pivotX=$i,this.pivotY=$p,this},$i.size=function($i,$p){return this.width=$i,this.height=$p,this},$i.scale=function($i,$p,$F){void 0===$F&&($F=!1);var $J=this.getStyle(),$A=$J._tf;if($A.scaleX!=$i||$A.scaleY!=$p){if(this.destroyed)return this;if($F){$J.setScale($i,$p),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($i,$p),this._renderType|=4;var $t=this._parent;$t&&0===$t._repaint&&($t._repaint=1,$t.parentRepaint())}else this.scaleX=$i,this.scaleY=$p}return this},$i.skew=function($i,$p){return this.skewX=$i,this.skewY=$p,this},$i.render=function($i,$p,$F){$$.spriteCount++,$y.renders[this._renderType]._fun(this,$i,$p+this._x,$F+this._y),this._repaint=0},$i.drawToCanvas=function($i,$p,$F,$J){if($G.isConchNode){var $A=$Di.create("2D");return new $_($i,$p,$A).ctx.setCanvasType(1),this.conchModel.drawToCanvas($A.source,$F,$J),$A}return $h.drawToCanvas(this,this._renderType,$i,$p,$F,$J)},$i.customRender=function($i,$p,$F){this._renderType|=1024},$i._applyFilters=function(){var $i;if(!$G.isWebGL&&(($i=this._$P.filters)&&!($i.length<1)))for(var $p=0,$F=$i.length;$p<$F;$p++)$i[$p].action.apply(this._$P.cacheCanvas)},$i._isHaveGlowFilter=function(){var $i,$p=0;if(this.filters)for($p=0;$p<this.filters.length;$p++)if(8==this.filters[$p].type)return!0;for($p=0,$i=this._childs.length;$p<$i;$p++)if(this._childs[$p]._isHaveGlowFilter())return!0;return!1},$i.localToGlobal=function($i,$p){void 0===$p&&($p=!1),!0===$p&&($i=new $R($i.x,$i.y));for(var $F=this;$F&&$F!=$a.stage;)$i=$F.toParentPoint($i),$F=$F.parent;return $i},$i.globalToLocal=function($i,$p){void 0===$p&&($p=!1),$p&&($i=new $R($i.x,$i.y));for(var $F=this,$J=[];$F&&$F!=$a.stage;)$J.push($F),$F=$F.parent;for(var $A=$J.length-1;0<=$A;)$i=($F=$J[$A]).fromParentPoint($i),$A--;return $i},$i.toParentPoint=function($i){if(!$i)return $i;$i.x-=this.pivotX,$i.y-=this.pivotY,this.transform&&this._transform.transformPoint($i),$i.x+=this._x,$i.y+=this._y;var $p=this._style.scrollRect;return $p&&($i.x-=$p.x,$i.y-=$p.y),$i},$i.fromParentPoint=function($i){if(!$i)return $i;$i.x-=this._x,$i.y-=this._y;var $p=this._style.scrollRect;return $p&&($i.x+=$p.x,$i.y+=$p.y),this.transform&&this._transform.invertTransformPoint($i),$i.x+=this.pivotX,$i.y+=this.pivotY,$i},$i.on=function($i,$p,$F,$J){return 1!==this._mouseEnableState&&this.isMouseEvent($i)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($i,$p,$F,$J,!1)):$A.prototype.on.call(this,$i,$p,$F,$J)},$i.once=function($i,$p,$F,$J){return 1!==this._mouseEnableState&&this.isMouseEvent($i)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener($i,$p,$F,$J,!0)):$A.prototype.once.call(this,$i,$p,$F,$J)},$i._$2__onDisplay=function(){if(1!==this._mouseEnableState){var $i=this;for($i=$i.parent;$i&&1!==$i._mouseEnableState&&!$i._getBit(2);)$i.mouseEnabled=!0,$i._setBit(2,!0),$i=$i.parent}},$i.loadImage=function($i,$p,$F,$J,$A,$t){var $q=this;return void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),void 0===$A&&($A=0),this.graphics.loadImage($i,$p,$F,$J,$A,function($i){$q.destroyed||($q.size($p+($J||$i.width),$F+($A||$i.height)),$q.repaint(),$t&&$t.runWith($i))}),this},$i.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},$i._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},$i._childChanged=function($i){this._childs.length?this._renderType|=2048:this._renderType&=-2049,$i&&this._get$P("hasZorder")&&$a.timer.callLater(this,this.updateZOrder),this.repaint()},$i.parentRepaint=function(){var $i=this._parent;$i&&0===$i._repaint&&($i._repaint=1,$i.parentRepaint())},$i.startDrag=function($i,$p,$F,$J,$A,$t,$q){void 0===$p&&($p=!1),void 0===$F&&($F=0),void 0===$J&&($J=300),void 0===$t&&($t=!1),void 0===$q&&($q=.92),this._$P.dragging||this._set$P("dragging",new $V),this._$P.dragging.start(this,$i,$p,$F,$J,$A,$t,$q)},$i.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},$i._releaseMem=function(){if(this._$P){var $i=this._$P.cacheCanvas;$i&&$i.ctx&&($w.recover("RenderContext",$i.ctx),$i.ctx.canvas.size(0,0),$i.ctx=null);var $p=this._$P._filterCache;$p&&($p.destroy(),$p.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},$i._setDisplay=function($i){$i||this._releaseMem(),$A.prototype._setDisplay.call(this,$i)},$i.hitTestPoint=function($i,$p){var $F=this.globalToLocal($R.TEMP.setTo($i,$p));return $i=$F.x,$p=$F.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?$Q.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains($i,$p)},$i.getMousePoint=function(){return this.globalToLocal($R.TEMP.setTo($a.stage.mouseX,$a.stage.mouseY))},$i._getWords=function(){return null},$i._addChildsToLayout=function($i){var $p=this._getWords();if(null==$p&&0==this._childs.length)return!1;if($p)for(var $F=0,$J=$p.length;$F<$J;$F++)$i.push($p[$F]);$F=0;for(var $A=this._childs.length;$F<$A;++$F){var $t=this._childs[$F];$t._style._enableLayout()&&$t._addToLayout($i)}return!0},$i._addToLayout=function($i){this._style.absolute||(this._style.block?$i.push(this):this._addChildsToLayout($i)&&(this.x=this.y=0))},$i._isChar=function(){return!1},$i._getCSSStyle=function(){return this._style.getCSSStyle()},$i._setAttributes=function($i,$p){switch($i){case"x":this.x=parseFloat($p);break;case"y":this.y=parseFloat($p);break;case"width":this.width=parseFloat($p);break;case"height":this.height=parseFloat($p);break;default:this[$i]=$p}},$i._layoutLater=function(){this.parent&&this.parent._layoutLater()},$d(0,$i,"optimizeScrollRect",function(){return this._optimizeScrollRect},function($i){this._optimizeScrollRect!=$i&&(this._optimizeScrollRect=$i,this.conchModel&&this.conchModel.optimizeScrollRect($i))}),$d(0,$i,"customRenderEnable",null,function($i){if($i&&(this._renderType|=1024,$G.isConchNode)){$F.CustomList.push(this);var $p=new $Di("2d");$p._setContext(new CanvasRenderingContext2D),this.customContext=new $_(0,0,$p),$p.context.setCanvasType&&$p.context.setCanvasType(2),this.conchModel.custom($p.context)}}),$d(0,$i,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function($i){this.cacheAs=$i?this._$P.hasFilter?"none":"normal":"none"}),$d(0,$i,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function($i){var $p=this._$P.cacheCanvas;if($i!==($p?$p.type:"none")){if("none"!==$i)this._getBit(1)||this._setUpNoticeType(1),$p||($p=this._set$P("cacheCanvas",$w.getItemByClass("cacheCanvas",Object))),$p.type=$i,$p.reCache=!0,this._renderType|=16,"bitmap"==$i&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if($p){var $F=$p;$F&&$F.ctx&&($w.recover("RenderContext",$F.ctx),$F.ctx.canvas.size(0,0),$F.ctx=null),$w.recover("cacheCanvas",$p)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),$d(0,$i,"zOrder",function(){return this._zOrder},function($i){this._zOrder!=$i&&(this._zOrder=$i,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder($i),this._parent&&($i&&this._parent._set$P("hasZorder",!0),$a.timer.callLater(this._parent,this.updateZOrder)))}),$d(0,$i,"rotation",function(){return this._style._tf.rotate},function($i){var $p=this.getStyle();if($p._tf.rotate!==$i){$p.setRotate($i),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate($i),this._renderType|=4;var $F=this._parent;$F&&0===$F._repaint&&($F._repaint=1,$F.parentRepaint())}}),$d(0,$i,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($i){this._width!==$i&&(this._width=$i,this.conchModel&&this.conchModel.size($i,this._height),this.repaint())}),$d(0,$i,"x",function(){return this._x},function($i){if(this._x!==$i){if(this.destroyed)return;this._x=$i,this.conchModel&&this.conchModel.pos($i,this._y);var $p=this._parent;$p&&0===$p._repaint&&($p._repaint=1,$p.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$d(0,$i,"globalScaleY",function(){for(var $i=1,$p=this;$p&&$p!==$a.stage;)$i*=$p.scaleY,$p=$p.parent;return $i}),$d(0,$i,"hitArea",function(){return this._$P.hitArea},function($i){this._set$P("hitArea",$i)}),$d(0,$i,"staticCache",function(){return this._$P.staticCache},function($i){this._set$P("staticCache",$i),$i||this.reCache()}),$d(0,$i,"texture",function(){return this._texture},function($i){this._texture!=$i&&(this._texture=$i,this.graphics.cleanByTexture($i,0,0))}),$d(0,$i,"y",function(){return this._y},function($i){if(this._y!==$i){if(this.destroyed)return;this._y=$i,this.conchModel&&this.conchModel.pos(this._x,$i);var $p=this._parent;$p&&0===$p._repaint&&($p._repaint=1,$p.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),$d(0,$i,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($i){this._height!==$i&&(this._height=$i,this.conchModel&&this.conchModel.size(this._width,$i),this.repaint())}),$d(0,$i,"blendMode",function(){return this._style.blendMode},function($i){this.getStyle().blendMode=$i,this.conchModel&&this.conchModel.blendMode($i),$i&&"source-over"!=$i?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),$d(0,$i,"scaleX",function(){return this._style._tf.scaleX},function($i){var $p=this.getStyle();if($p._tf.scaleX!==$i){$p.setScaleX($i),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($i,$p._tf.scaleY),this._renderType|=4;var $F=this._parent;$F&&0===$F._repaint&&($F._repaint=1,$F.parentRepaint())}}),$d(0,$i,"scaleY",function(){return this._style._tf.scaleY},function($i){var $p=this.getStyle();if($p._tf.scaleY!==$i){$p.setScaleY($i),this._tfChanged=!0,this.conchModel&&this.conchModel.scale($p._tf.scaleX,$i),this._renderType|=4;var $F=this._parent;$F&&0===$F._repaint&&($F._repaint=1,$F.parentRepaint())}}),$d(0,$i,"stage",function(){return $a.stage}),$d(0,$i,"skewX",function(){return this._style._tf.skewX},function($i){var $p=this.getStyle();if($p._tf.skewX!==$i){$p.setSkewX($i),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($i,$p._tf.skewY),this._renderType|=4;var $F=this._parent;$F&&0===$F._repaint&&($F._repaint=1,$F.parentRepaint())}}),$d(0,$i,"scrollRect",function(){return this._style.scrollRect},function($i){this.getStyle().scrollRect=$i,this.repaint(),$i?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect($i.x,$i.y,$i.width,$i.height)):(this._renderType&=-129,this.conchModel&&($F.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),$d(0,$i,"skewY",function(){return this._style._tf.skewY},function($i){var $p=this.getStyle();if($p._tf.skewY!==$i){$p.setSkewY($i),this._tfChanged=!0,this.conchModel&&this.conchModel.skew($p._tf.skewX,$i),this._renderType|=4;var $F=this._parent;$F&&0===$F._repaint&&($F._repaint=1,$F.parentRepaint())}}),$d(0,$i,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function($i){this._tfChanged=!1,(this._transform=$i)&&(this._x=$i.tx,this._y=$i.ty,$i.tx=$i.ty=0,this.conchModel&&this.conchModel.transform($i.a,$i.b,$i.c,$i.d,this._x,this._y)),$i?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),$d(0,$i,"pivotX",function(){return this._style._tf.translateX},function($i){this.getStyle().setTranslateX($i),this.conchModel&&this.conchModel.pivot($i,this._style._tf.translateY),this.repaint()}),$d(0,$i,"pivotY",function(){return this._style._tf.translateY},function($i){this.getStyle().setTranslateY($i),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,$i),this.repaint()}),$d(0,$i,"alpha",function(){return this._style.alpha},function($i){this._style&&this._style.alpha!==$i&&($i=$i<0?0:1<$i?1:$i,this.getStyle().alpha=$i,this.conchModel&&this.conchModel.alpha($i),1!==$i?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),$d(0,$i,"visible",function(){return this._style.visible},function($i){this._style&&this._style.visible!==$i&&(this.getStyle().visible=$i,this.conchModel&&this.conchModel.visible($i),this.parentRepaint())}),$d(0,$i,"graphics",function(){return this._graphics||(this.graphics=$h.createGraphics())},function($i){this._graphics&&(this._graphics._sp=null),(this._graphics=$i)?(this._renderType&=-2,this._renderType|=512,($i._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&($F.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),$d(0,$i,"filters",function(){return this._$P.filters},function($i){$i&&0===$i.length&&($i=null),this._$P.filters!=$i&&(this._set$P("filters",$i?$i.slice():null),$G.isConchApp&&(this.conchModel&&($F.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),$G.isWebGL&&($i&&$i.length?this._renderType|=32:this._renderType&=-33),$i&&0<$i.length?(this._getBit(1)||this._setUpNoticeType(1),$G.isWebGL&&1==$i.length&&$i[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&($G.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),$d(0,$i,"parent",$A.prototype._$get_parent,function($i){$a.superSet($ii,this,"parent",$i),$i&&this._getBit(2)&&this._$2__onDisplay()}),$d(0,$i,"mask",function(){return this._$P._mask},function($i){$i&&this.mask&&this.mask._$P.maskParent||($i?(this.cacheAs="bitmap",this._set$P("_mask",$i),$i._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",$i),this.cacheAs="none"),this.conchModel&&this.conchModel.mask($i?$i.conchModel:null),this._renderType|=64,this.parentRepaint())}),$d(0,$i,"mouseEnabled",function(){return 1<this._mouseEnableState},function($i){this._mouseEnableState=$i?2:1}),$d(0,$i,"globalScaleX",function(){for(var $i=1,$p=this;$p&&$p!==$a.stage;)$i*=$p.scaleX,$p=$p.parent;return $i}),$d(0,$i,"mouseX",function(){return this.getMousePoint().x}),$d(0,$i,"mouseY",function(){return this.getMousePoint().y}),$F.fromImage=function($i){return(new $F).loadImage($i)},$F._cachePool=[],$F.CustomList=[],$O($F,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=$q.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),$F}($ii),$Si=function($i){function $p($i){this._audio=null,this._onEnd=null,this._resumePlay=null,$p.__super.call(this),this._onEnd=$b.bind(this.__onEnd,this),this._resumePlay=$b.bind(this.__resumePlay,this),$i.addEventListener("ended",this._onEnd),this._audio=$i}$x($p,"laya.media.h5audio.AudioSoundChannel",$Ji);var $F=$p.prototype;return $F.__onEnd=function(){if(1==this.loops)return this.completeHandler&&($a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$F.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,$o.container.appendChild(this._audio),this._audio.play()}catch($i){this.event("error")}},$F.play=function($i){this.isStopped=!1;try{this._audio.playbackRate=$c.playbackRate,this._audio.currentTime=this.startTime}catch($i){return void this._audio.addEventListener("canplay",this._resumePlay)}$c.addChannel(this),$o.container.appendChild(this._audio),!$i&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},$F.stop=function(){this.isStopped=!0,$c.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&$G.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),$o.onIE||this._audio!=$Fi._musicAudio&&$w.recover("audio:"+this.url,this._audio),$o.removeElement(this._audio),this._audio=null)},$F.pause=function(){this.isStopped=!0,$c.removeChannel(this),"pause"in this._audio&&this._audio.pause()},$F.resume=function(){this._audio&&(this.isStopped=!1,$c.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},$d(0,$F,"position",function(){return this._audio?this._audio.currentTime:0}),$d(0,$F,"duration",function(){return this._audio?this._audio.duration:0}),$d(0,$F,"volume",function(){return this._audio?this._audio.volume:1},function($i){this._audio&&(this._audio.volume=$i)}),$p}(),$Zi=function($i){function $p(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=$ti.ctx,$p.__super.call(this),this._onPlayEnd=$b.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}$x($p,"laya.media.webaudio.WebAudioSoundChannel",$Ji);var $F=$p.prototype;return $F.play=function($i){if($c.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var $p=this.context,$F=this.gain,$J=$p.createBufferSource();(this.bufferSource=$J).buffer=this.audioBuffer,$J.connect($F),$F&&$F.disconnect(),$F.connect($p.destination),$J.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=$o.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&($J.loop=!0),$J.playbackRate.setTargetAtTime?$J.playbackRate.setTargetAtTime($c.playbackRate,this.context.currentTime,.1):$J.playbackRate.value=$c.playbackRate,$J.start(0,this.startTime),!$i&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},$F.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&($a.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},$F._clearBufferSource=function(){if(this.bufferSource){var $i=this.bufferSource;$i.stop?$i.stop(0):$i.noteOff(0),$i.disconnect(0),$i.onended=null,$p._tryCleanFailed||this._tryClearBuffer($i),this.bufferSource=null}},$F._tryClearBuffer=function($i){try{$i.buffer=null}catch($i){$p._tryCleanFailed=!0}},$F.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,$c.removeChannel(this),this.startHandler=null,this.completeHandler=null},$F.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,$c.removeChannel(this)},$F.resume=function(){this.startTime=this._pauseTime,this.play(!1)},$d(0,$F,"position",function(){return this.bufferSource?($o.now()-this._startTime)/1e3+this.startTime:0}),$d(0,$F,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),$d(0,$F,"volume",function(){return this._volume},function($i){this.isStopped||(this._volume=$i,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime($i,this.context.currentTime,.1):this.gain.gain.value=$i)}),$p._tryCleanFailed=!1,$p}(),$si=function($i){function $p(){$p.__super.call(this),this._w=0,this._h=0}$x($p,"laya.resource.Bitmap",$Ui);var $F=$p.prototype;return $d(0,$F,"width",function(){return this._w}),$d(0,$F,"height",function(){return this._h}),$d(0,$F,"source",function(){return this._source}),$p}(),$xi=function($p){function $i(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,$i.__super.call(this),this._interval=$J.animationInterval,this._setUpNoticeType(1)}$x($i,"laya.display.AnimationPlayerBase",$p);var $F=$i.prototype;return $F.play=function($i,$p,$F,$J){void 0===$i&&($i=0),void 0===$p&&($p=!0),void 0===$F&&($F=""),void 0===$J&&($J=!0),this._isPlaying=!0,this.index="string"==typeof $i?this._getFrameByLabel($i):$i,this.loop=$p,this._actionName=$F,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$F._getFrameByLabel=function($i){var $p=0;for($p=0;$p<this._count;$p++)if(this._labels[$p]&&0<=this._labels[$p].indexOf($i))return $p;return 0},$F._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},$F._setControlNode=function($i){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=$i)&&$i!=this&&($i.on("display",this,this._checkResumePlaying),$i.on("undisplay",this,this._checkResumePlaying))},$F._setDisplay=function($i){$p.prototype._setDisplay.call(this,$i),this._checkResumePlaying()},$F._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},$F.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},$F.addLabel=function($i,$p){this._labels||(this._labels={}),this._labels[$p]||(this._labels[$p]=[]),this._labels[$p].push($i)},$F.removeLabel=function($i){if($i){if(this._labels)for(var $p in this._labels)this._removeLabelFromLabelList(this._labels[$p],$i)}else this._labels=null},$F._removeLabelFromLabelList=function($i,$p){if($i)for(var $F=$i.length-1;0<=$F;$F--)$i[$F]==$p&&$i.splice($F,1)},$F.gotoAndStop=function($i){this.index="string"==typeof $i?this._getFrameByLabel($i):$i,this.stop()},$F._displayToIndex=function($i){},$F.clear=function(){this.stop(),this._labels=null},$d(0,$F,"interval",function(){return this._interval},function($i){this._interval!=$i&&(this._frameRateChanged=!0,this._interval=$i,this._isPlaying&&0<$i&&this.timerLoop($i,this,this._frameLoop,null,!0,!0))}),$d(0,$F,"isPlaying",function(){return this._isPlaying}),$d(0,$F,"index",function(){return this._index},function($i){if(this._index=$i,this._displayToIndex($i),this._labels&&this._labels[$i])for(var $p=this._labels[$i],$F=0,$J=$p.length;$F<$J;$F++)this.event("label",$p[$F])}),$d(0,$F,"count",function(){return this._count}),$i.WRAP_POSITIVE=0,$i.WRAP_REVERSE=1,$i.WRAP_PINGPONG=2,$i}($ui),$ji=function($p){function $Z(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,$Z.__super.call(this),this.overflow=$Z.VISIBLE,this._style=new $pi(this),this._style.wordWrap=!1}$x($Z,"laya.display.Text",$p);var $i=$Z.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._lines=null,this._words&&(this._words.length=0,this._words=null)},$i._getBoundPointsM=function($i){void 0===$i&&($i=!1);var $p=$Q.TEMP;return $p.setTo(0,0,this.width,this.height),$p._getBoundPoints()},$i.getGraphicBounds=function($i){void 0===$i&&($i=!1);var $p=$Q.TEMP;return $p.setTo(0,0,this.width,this.height),$p},$i._getCSSStyle=function(){return this._style},$i.lang=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d){if($i=$Z.langPacks&&$Z.langPacks[$i]?$Z.langPacks[$i]:$i,arguments.length<2)this._text=$i;else{for(var $u=0,$S=arguments.length;$u<$S;$u++)$i=$i.replace("{"+$u+"}",arguments[$u+1]);this._text=$i}},$i._isPassWordMode=function(){var $i=this._style.password;return"prompt"in this&&this.prompt==this._text&&($i=!1),$i},$i._getPassWordTxt=function($i){var $p;$p="";for(var $F=$i.length;0<$F;$F--)$p+="●";return $p},$i.renderText=function($i,$p){var $F=this.graphics;$F.clear(!0);var $J=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+($o.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);$o.context.font=$J;var $A=this.padding,$t=$A[3],$q="left",$B=this._lines,$O=this.leading+this._charSize.height,$U=this._currBitmapFont;$U&&($O=this.leading+$U.getMaxHeight());var $d=$A[0];if(!$U&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?($q="right",$t=this._width-$A[1]):"center"==this.align&&($q="center",$t=.5*this._width+$A[3]-$A[1])),0<this._height){var $u=this._textHeight>this._height?"top":this.valign;"middle"===$u?$d=.5*(this._height-$p*$O)+$A[0]-$A[2]:"bottom"===$u&&($d=this._height-$p*$O-$A[2])}var $S=this._style;if($U&&$U.autoScaleSize)var $Z=$U.fontSize/this.fontSize;if(this._clipPoint)if($F.save(),$U&&$U.autoScaleSize){var $s=0,$x=0;$s=this._width?this._width-$A[3]-$A[1]:this._textWidth,$x=this._height?this._height-$A[0]-$A[2]:this._textHeight,$s*=$Z,$x*=$Z,$F.clipRect($A[3],$A[0],$s,$x)}else $F.clipRect($A[3],$A[0],this._width?this._width-$A[3]-$A[1]:this._textWidth,this._height?this._height-$A[0]-$A[2]:this._textHeight);var $j=$S.password;"prompt"in this&&this.prompt==this._text&&($j=!1);for(var $r=0,$M=0,$D=Math.min(this._lines.length,$p+$i)||1,$E=$i;$E<$D;$E++){var $v,$g=$B[$E];if($j){var $a=$g.length;$g="";for(var $R=$a;0<$R;$R--)$g+="●"}if($r=$t-(this._clipPoint?this._clipPoint.x:0),$M=$d+$O*$E-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline($q,$r,$M,$E),$U){var $Q=this.width;$U.autoScaleSize&&($Q=this.width*$Z),$U.drawText($g,this,$r,$M,this.align,$Q)}else $G.isWebGL?(this._words||(this._words=[]),($v=this._words.length>$E-$i?this._words[$E-$i]:new $H).setText($g)):$v=$g,$S.stroke?$F.fillBorderText($v,$r,$M,$J,this.color,$S.strokeColor,$S.stroke,$q):$F.fillText($v,$r,$M,$J,this.color,$q)}if($U&&$U.autoScaleSize){var $P=1/$Z;this.scale($P,$P)}this._clipPoint&&$F.restore(),this._startX=$t,this._startY=$d},$i.drawUnderline=function($i,$p,$F,$J){var $A=this._lineWidths[$J];switch($i){case"center":$p-=$A/2;break;case"right":$p-=$A}$F+=this._charSize.height,this._graphics.drawLine($p,$F,$p+$A,$F,this.underlineColor||this.color,1)},$i.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);$o.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new $R(0,0)):this._clipPoint=null;var $i=this._lines.length;if(this.overflow!=$Z.VISIBLE){var $p=this.overflow==$Z.HIDDEN?Math.floor:Math.ceil;$i=Math.min($i,$p((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var $F=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText($F,$i),this.repaint()},$i.evalTextSize=function(){var $i,$p=NaN;$i=Math.max.apply(this,this._lineWidths),$p=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],$i==this._textWidth&&$p==this._textHeight||(this._textWidth=$i,this._textHeight=$p,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},$i.checkEnabledViewportOrNot=function(){return this.overflow==$Z.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},$i.changeText=function($i){this._text!==$i&&(this.lang($i+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},$i.parseLines=function($i){var $p=this.wordWrap||this.overflow==$Z.HIDDEN;if($p)var $F=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var $J=$b.contextMeasureText($Z._testWord);$G.isConchApp&&0===$J.width&&0===$J.height&&($J=$b.contextMeasureText("W")),this._charSize.width=$J.width,this._charSize.height=$J.height||this.fontSize}for(var $A=$i.replace(/\r\n/g,"\n").split("\n"),$t=0,$q=$A.length;$t<$q;$t++){var $B=$A[$t];$p?this.parseLine($B,$F):(this._lineWidths.push(this.getTextWidth($B)),this._lines.push($B))}},$i.parseLine=function($i,$p){$o.context;var $F,$J=this._lines,$A=0,$t=NaN,$q=NaN,$B=0;if(($t=this.getTextWidth($i))<=$p)return $J.push($i),void this._lineWidths.push($t);$t=this._charSize.width,0==($A=Math.floor($p/$t))&&($A=1),$q=$t=this.getTextWidth($i.substring(0,$A));for(var $O=$A,$U=$i.length;$O<$U;$O++)if($p<($q+=$t=this.getTextWidth($i.charAt($O))))if(this.wordWrap){var $d=$i.substring($B,$O);if($d.charCodeAt($d.length-1)<255?($F=/(?:\w|-)+$/.exec($d))&&($O=$F.index+$B,0==$F.index?$O+=$d.length:$d=$i.substring($B,$O)):$Z.RightToLeft&&($F=/([\u0600-\u06FF])+$/.exec($d))&&($O=$F.index+$B,0==$F.index?$O+=$d.length:$d=$i.substring($B,$O)),$J.push($d),this._lineWidths.push($q-$t),!(($B=$O)+$A<$U)){$J.push($i.substring($B,$U)),this._lineWidths.push(this.getTextWidth($J[$J.length-1])),$B=-1;break}$O+=$A,$q=$t=this.getTextWidth($i.substring($B,$O)),$O--}else if(this.overflow==$Z.HIDDEN)return $J.push($i.substring(0,$O)),void this._lineWidths.push(this.getTextWidth($J[$J.length-1]));this.wordWrap&&-1!=$B&&($J.push($i.substring($B,$U)),this._lineWidths.push(this.getTextWidth($J[$J.length-1])))},$i.getTextWidth=function($i){return this._currBitmapFont?this._currBitmapFont.getTextWidth($i):$b.contextMeasureText($i).width},$i.getWordWrapWidth=function(){var $i=this.padding,$p=NaN;return($p=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&($p=this.wordWrap?100:$o.width),$p<=0&&($p=100),$p-$i[3]-$i[1]},$i.getCharPoint=function($i,$p){this._isChanged&&$a.timer.runCallLater(this,this.typeset);for(var $F=0,$J=this._lines,$A=0,$t=0,$q=$J.length;$t<$q;$t++){if($i<($F+=$J[$t].length)){var $B=$t;break}$A=$F}var $O=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;$o.context.font=$O;var $U=this.getTextWidth(this._text.substring($A,$i));return($p||new $R).setTo(this._startX+$U-(this._clipPoint?this._clipPoint.x:0),this._startY+$B*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},$d(0,$i,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function($i){$i!=this._width&&($a.superSet($ui,this,"width",$i),this.isChanged=!0)}),$d(0,$i,"textWidth",function(){return this._isChanged&&$a.timer.runCallLater(this,this.typeset),this._textWidth}),$d(0,$i,"height",function(){return this._height?this._height:this.textHeight},function($i){$i!=this._height&&($a.superSet($ui,this,"height",$i),this.isChanged=!0)}),$d(0,$i,"textHeight",function(){return this._isChanged&&$a.timer.runCallLater(this,this.typeset),this._textHeight}),$d(0,$i,"padding",function(){return this._getCSSStyle().padding},function($i){this._getCSSStyle().padding=$i,this.isChanged=!0}),$d(0,$i,"bold",function(){return this._getCSSStyle().bold},function($i){this._getCSSStyle().bold=$i,this.isChanged=!0}),$d(0,$i,"text",function(){return this._text||""},function($i){this._text!==$i&&(this.lang($i+""),this.isChanged=!0,this.event("change"))}),$d(0,$i,"color",function(){return this._getCSSStyle().color},function($i){this._getCSSStyle().color!=$i&&(this._getCSSStyle().color=$i,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),$d(0,$i,"font",function(){return this._getCSSStyle().fontFamily},function($i){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),$Z._bitmapFonts&&$Z._bitmapFonts[$i]&&(this._currBitmapFont=$Z._bitmapFonts[$i]),this._getCSSStyle().fontFamily=$i,this.isChanged=!0}),$d(0,$i,"fontSize",function(){return this._getCSSStyle().fontSize},function($i){this._getCSSStyle().fontSize=$i,this.isChanged=!0}),$d(0,$i,"italic",function(){return this._getCSSStyle().italic},function($i){this._getCSSStyle().italic=$i,this.isChanged=!0}),$d(0,$i,"align",function(){return this._getCSSStyle().align},function($i){this._getCSSStyle().align=$i,this.isChanged=!0}),$d(0,$i,"valign",function(){return this._getCSSStyle().valign},function($i){this._getCSSStyle().valign=$i,this.isChanged=!0}),$d(0,$i,"wordWrap",function(){return this._getCSSStyle().wordWrap},function($i){this._getCSSStyle().wordWrap=$i,this.isChanged=!0}),$d(0,$i,"leading",function(){return this._getCSSStyle().leading},function($i){this._getCSSStyle().leading=$i,this.isChanged=!0}),$d(0,$i,"bgColor",function(){return this._getCSSStyle().backgroundColor},function($i){this._getCSSStyle().backgroundColor=$i,this.isChanged=!0}),$d(0,$i,"borderColor",function(){return this._getCSSStyle().borderColor},function($i){this._getCSSStyle().borderColor=$i,this.isChanged=!0}),$d(0,$i,"stroke",function(){return this._getCSSStyle().stroke},function($i){this._getCSSStyle().stroke=$i,this.isChanged=!0}),$d(0,$i,"strokeColor",function(){return this._getCSSStyle().strokeColor},function($i){this._getCSSStyle().strokeColor=$i,this.isChanged=!0}),$d(0,$i,"isChanged",null,function($i){this._isChanged!==$i&&(this._isChanged=$i)&&$a.timer.callLater(this,this.typeset)}),$d(0,$i,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function($i){if(!(this.overflow!=$Z.SCROLL||this.textWidth<this._width)&&this._clipPoint){$i=$i<this.padding[3]?this.padding[3]:$i;var $p=this._textWidth-this._width;$i=$p<$i?$p:$i;var $F=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=$i,this.renderText(this._lastVisibleLineIndex,$F)}}),$d(0,$i,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function($i){if(!(this.overflow!=$Z.SCROLL||this.textHeight<this._height)&&this._clipPoint){$i=$i<this.padding[0]?this.padding[0]:$i;var $p=this._textHeight-this._height,$F=($i=$p<$i?$p:$i)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=$F;var $J=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=$i,this.renderText($F,$J)}}),$d(0,$i,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),$d(0,$i,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),$d(0,$i,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),$d(0,$i,"underlineColor",function(){return this._underlineColor},function($i){this._underlineColor=$i,this._isChanged=!0,this.typeset()}),$Z.registerBitmapFont=function($i,$p){$Z._bitmapFonts||($Z._bitmapFonts={}),$Z._bitmapFonts[$i]=$p},$Z.unregisterBitmapFont=function($i,$p){if(void 0===$p&&($p=!0),$Z._bitmapFonts&&$Z._bitmapFonts[$i]){var $F=$Z._bitmapFonts[$i];$p&&$F.destroy(),delete $Z._bitmapFonts[$i]}},$Z.setTextRightToLeft=function(){var $i;($i=$o.canvas.source.style).display="none",$i.position="absolute",$i.direction="rtl",$G._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,$o.document.body.appendChild($o.canvas.source)},$Z.supportFont=function($i){$o.context.font="10px sans-serif";var $p=$b.contextMeasureText("abcji").width;$o.context.font="10px "+$i;var $F=$b.contextMeasureText("abcji").width;return console.log($p,$F),$p!==$F},$Z._testWord="游",$Z.langPacks=null,$Z.VISIBLE="visible",$Z.SCROLL="scroll",$Z.HIDDEN="hidden",$Z.CharacterCache=!0,$Z.RightToLeft=!1,$Z._bitmapFonts=null,$O($Z,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),$Z}($ui),$ri=function($u){function $q(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",$q.__super.call(this),this.offset=new $R,this._canvasTransform=new $m,this._previousOrientation=$o.window.orientation;var $p=this;this.transform=$m.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var $i=$o.window,$F=this;$i.addEventListener("focus",function(){$p._isFocused=!0,$F.event("focus"),$F.event("focuschange")}),$i.addEventListener("blur",function(){$p._isFocused=!1,$F.event("blur"),$F.event("focuschange"),$F._isInputting()&&($vi.inputElement.target.focus=!1)});var $J="visibilityState",$A="visibilitychange",$t=$i.document;void 0!==$t.hidden?($A="visibilitychange",$J="visibilityState"):void 0!==$t.mozHidden?($A="mozvisibilitychange",$J="mozVisibilityState"):void 0!==$t.msHidden?($A="msvisibilitychange",$J="msVisibilityState"):void 0!==$t.webkitHidden&&($A="webkitvisibilitychange",$J="webkitVisibilityState"),$i.document.addEventListener($A,function(){"hidden"==$o.document[$J]?$F._setStageVisible(!1):$F._setStageVisible(!0)}),$i.document.addEventListener("qbrowserVisibilityChange",function($i){$F._setStageVisible(!$i.hidden)}),$i.addEventListener("resize",function(){var $i=$o.window.orientation;null!=$i&&$i!=$p._previousOrientation&&$F._isInputting()&&($vi.inputElement.target.focus=!1),$p._previousOrientation=$i,$F._isInputting()||$F._resetCanvas()}),$i.addEventListener("orientationchange",function($i){$F._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),$o.onMobile&&this.on("mousedown",this,this._onmouseMove)}$x($q,"laya.display.Stage",$u);var $i=$q.prototype;return $i._setStageVisible=function($i){this._isVisibility!=$i&&(this._isVisibility=$i,this._isVisibility||this._isInputting()&&($vi.inputElement.target.focus=!1),this.event("visibilitychange"))},$i._isInputting=function(){return $o.onMobile&&$vi.isInputting},$i._changeCanvasSize=function(){this.setScreenSize($o.clientWidth*$o.pixelRatio,$o.clientHeight*$o.pixelRatio)},$i._resetCanvas=function(){if(this.screenAdaptationEnabled){var $i=$G._mainCanvas;$i.source.style;$i.size(1,1),$a.timer.once(100,this,this._changeCanvasSize)}},$i.setScreenSize=function($i,$p){var $F=!1;if("none"!==this._screenMode&&($F=($i/$p<1?"vertical":"horizontal")!==this._screenMode)){var $J=$p;$p=$i,$i=$J}this.canvasRotation=$F;var $A=$G._mainCanvas,$t=$A.source.style,$q=this._canvasTransform.identity(),$B=this._scaleMode,$O=$i/this.designWidth,$U=$p/this.designHeight,$d=this.designWidth,$u=this.designHeight,$S=$i,$Z=$p,$s=$o.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,$B){case"noscale":$O=$U=1,$S=this.designWidth,$Z=this.designHeight;break;case"showall":$O=$U=Math.min($O,$U),$d=$S=Math.round(this.designWidth*$O),$u=$Z=Math.round(this.designHeight*$U);break;case"noborder":$O=$U=Math.max($O,$U),$S=Math.round(this.designWidth*$O),$Z=Math.round(this.designHeight*$U);break;case"full":$O=$U=1,this._width=$d=$i,this._height=$u=$p;break;case"fixedwidth":$U=$O,this._height=$u=Math.round($p/$O);break;case"fixedheight":$O=$U,this._width=$d=Math.round($i/$U);break;case"fixedauto":$i/$p<this.designWidth/this.designHeight?($U=$O,this._height=$u=Math.round($p/$O)):($O=$U,this._width=$d=Math.round($i/$U))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,$d=$d+1&2147483646,$u=$u+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),$O*=this.scaleX,$U*=this.scaleY,1===$O&&1===$U?this.transform.identity():(this.transform.a=this._formatData($O/($S/$d)),this.transform.d=this._formatData($U/($Z/$u)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),$A.size($d,$u),$h.changeWebGLSize($d,$u),$q.scale($S/$d/$s,$Z/$u/$s),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=($i-$S)/$s:this.offset.x=.5*($i-$S)/$s,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=($p-$Z)/$s:this.offset.y=.5*($p-$Z)/$s,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),$q.translate(this.offset.x,this.offset.y),this.canvasDegree=0,$F&&("horizontal"===this._screenMode?($q.rotate(Math.PI/2),$q.translate($p/$s,0),this.canvasDegree=90):($q.rotate(-Math.PI/2),$q.translate(0,$i/$s),this.canvasDegree=-90)),$q.a=this._formatData($q.a),$q.d=this._formatData($q.d),$q.tx=this._formatData($q.tx),$q.ty=this._formatData($q.ty),$t.transformOrigin=$t.webkitTransformOrigin=$t.msTransformOrigin=$t.mozTransformOrigin=$t.oTransformOrigin="0px 0px 0px",$t.transform=$t.webkitTransform=$t.msTransform=$t.mozTransform=$t.oTransform="matrix("+$q.toString()+")",$q.translate(parseInt($t.left)||0,parseInt($t.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},$i._formatData=function($i){return Math.abs($i)<1e-6?0:Math.abs(1-$i)<.001?0<$i?1:-1:$i},$i.getMousePoint=function(){return $R.TEMP.setTo(this.mouseX,this.mouseY)},$i.repaint=function(){this._repaint=1},$i.parentRepaint=function(){},$i._loop=function(){return this.render($G.context,0,0),!0},$i._onmouseMove=function($i){this._mouseMoveTime=$o.now()},$i.getTimeFromFrameStart=function(){return $o.now()-this._frameStartTime},$i.render=function($i,$p,$F){if("sleep"===this._frameRate&&!$G.isConchApp){var $J=$o.now();if(!(1e3<=$J-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&($$.loopCount++,$s.instance.runEvent(),$a.timer._update()));this._frameStartTime=$J}if(this._renderCount++,$G.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=$o.now();var $A="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),$t=this._renderCount%2==0;if($$.renderSlow=!$A,$A||$t||$G.isConchApp){var $q;$$.loopCount++,$s.instance.runEvent(),$a.timer._update(),$h.update3DLoop();var $B=0,$O=0;if($G.isConchNode)for($B=0,$O=this._scenes.length;$B<$O;$B++)($q=this._scenes[$B])&&$q._updateSceneConch();else for($B=0,$O=this._scenes.length;$B<$O;$B++)($q=this._scenes[$B])&&$q._updateScene();if($G.isConchNode){var $U=$ui.CustomList;for($B=0,$O=$U.length;$B<$O;$B++){var $d=$U[$B];$d.customRender($d.customContext,0,0)}return}}$G.isConchNode||this.renderingEnabled&&($A||!$t||$G.isConchWebGL)&&($G.isWebGL?$G.WebGL.mainContext&&!$G.WebGL.mainContext.isContextLost()&&($i.clear(),$u.prototype.render.call(this,$i,$p,$F),$$._show&&$$._sp&&$$._sp.render($i,$p,$F),$h.clear(this._bgColor),$h.beginFlush(),$i.flush(),$h.endFinish(),$z.instance&&$z.getInstance().endDispose()):($h.clear(this._bgColor),$u.prototype.render.call(this,$i,$p,$F),$$._show&&$$._sp&&$$._sp.render($i,$p,$F)))}else this._renderCount%5==0&&($$.loopCount++,$s.instance.runEvent(),$a.timer._update())},$i._requestFullscreen=function(){var $i=$o.document.documentElement;$i.requestFullscreen?$i.requestFullscreen():$i.mozRequestFullScreen?$i.mozRequestFullScreen():$i.webkitRequestFullscreen?$i.webkitRequestFullscreen():$i.msRequestFullscreen&&$i.msRequestFullscreen()},$i._fullScreenChanged=function(){$a.stage.event("fullscreenchange")},$i.exitFullscreen=function(){var $i=$o.document;$i.exitFullscreen?$i.exitFullscreen():$i.mozCancelFullScreen?$i.mozCancelFullScreen():$i.webkitExitFullscreen&&$i.webkitExitFullscreen()},$d(0,$i,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),$d(0,$i,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),$d(0,$i,"frameRate",function(){return this._frameRate},function($i){if(this._frameRate=$i,$G.isConchApp)switch(this._frameRate){case"slow":$o.window.conch&&$o.window.conchConfig.setSlowFrame&&$o.window.conchConfig.setSlowFrame(!0);break;case"fast":$o.window.conch&&$o.window.conchConfig.setSlowFrame&&$o.window.conchConfig.setSlowFrame(!1);break;case"mouse":$o.window.conch&&$o.window.conchConfig.setMouseFrame&&$o.window.conchConfig.setMouseFrame(2e3);break;case"sleep":$o.window.conch&&$o.window.conchConfig.setLimitFPS&&$o.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),$d(0,$i,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),$d(0,$i,"width",$u.prototype._$get_width,function($i){this.designWidth=$i,$a.superSet($ui,this,"width",$i),$a.timer.callLater(this,this._changeCanvasSize)}),$d(0,$i,"alignH",function(){return this._alignH},function($i){this._alignH=$i,$a.timer.callLater(this,this._changeCanvasSize)}),$d(0,$i,"isFocused",function(){return this._isFocused}),$d(0,$i,"height",$u.prototype._$get_height,function($i){this.designHeight=$i,$a.superSet($ui,this,"height",$i),$a.timer.callLater(this,this._changeCanvasSize)}),$d(0,$i,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||$m.create()},$u.prototype._$set_transform),$d(0,$i,"isVisibility",function(){return this._isVisibility}),$d(0,$i,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),$d(0,$i,"scaleMode",function(){return this._scaleMode},function($i){this._scaleMode=$i,$a.timer.callLater(this,this._changeCanvasSize)}),$d(0,$i,"alignV",function(){return this._alignV},function($i){this._alignV=$i,$a.timer.callLater(this,this._changeCanvasSize)}),$d(0,$i,"bgColor",function(){return this._bgColor},function($i){this._bgColor=$i,this.conchModel&&this.conchModel.bgColor($i),$G.isWebGL&&($i?$q._wgColor=$K.create($i)._color:$o.onMiniGame||($q._wgColor=null)),$o.onLimixiu?$q._wgColor=$K.create($i)._color:$G.canvas.style.background=$i||"none"}),$d(0,$i,"mouseX",function(){return Math.round($s.instance.mouseX/this.clientScaleX)}),$d(0,$i,"mouseY",function(){return Math.round($s.instance.mouseY/this.clientScaleY)}),$d(0,$i,"screenMode",function(){return this._screenMode},function($i){this._screenMode=$i}),$d(0,$i,"visible",$u.prototype._$get_visible,function($i){this.visible!==$i&&($a.superSet($ui,this,"visible",$i),$G._mainCanvas.source.style.visibility=$i?"visible":"hidden")}),$d(0,$i,"fullScreenEnabled",null,function($i){var $p=$o.document,$F=$G.canvas;$i?($F.addEventListener("mousedown",this._requestFullscreen),$F.addEventListener("touchstart",this._requestFullscreen),$p.addEventListener("fullscreenchange",this._fullScreenChanged),$p.addEventListener("mozfullscreenchange",this._fullScreenChanged),$p.addEventListener("webkitfullscreenchange",this._fullScreenChanged),$p.addEventListener("msfullscreenchange",this._fullScreenChanged)):($F.removeEventListener("mousedown",this._requestFullscreen),$F.removeEventListener("touchstart",this._requestFullscreen),$p.removeEventListener("fullscreenchange",this._fullScreenChanged),$p.removeEventListener("mozfullscreenchange",this._fullScreenChanged),$p.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),$p.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),$q.SCALE_NOSCALE="noscale",$q.SCALE_EXACTFIT="exactfit",$q.SCALE_SHOWALL="showall",$q.SCALE_NOBORDER="noborder",$q.SCALE_FULL="full",$q.SCALE_FIXED_WIDTH="fixedwidth",$q.SCALE_FIXED_HEIGHT="fixedheight",$q.SCALE_FIXED_AUTO="fixedauto",$q.ALIGN_LEFT="left",$q.ALIGN_RIGHT="right",$q.ALIGN_CENTER="center",$q.ALIGN_TOP="top",$q.ALIGN_MIDDLE="middle",$q.ALIGN_BOTTOM="bottom",$q.SCREEN_NONE="none",$q.SCREEN_HORIZONTAL="horizontal",$q.SCREEN_VERTICAL="vertical",$q.FRAME_FAST="fast",$q.FRAME_SLOW="slow",$q.FRAME_MOUSE="mouse",$q.FRAME_SLEEP="sleep",$q.FRAME_MOUSE_THREDHOLD=2e3,$O($q,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),$q}($ui),$Mi=(function($i){function $p(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,$p.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}$x($p,"laya.media.SoundNode",$ui);var $F=$p.prototype;$F._onParentChange=function(){this.target=this.parent},$F.play=function($i,$p){void 0===$i&&($i=1),isNaN($i)&&($i=1),this.url&&(this.stop(),this._channel=$c.playSound(this.url,$i,null,$p))},$F.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},$F._setPlayAction=function($i,$p,$F,$J){void 0===$J&&($J=!0),this[$F]&&$i&&($J?$i.on($p,this,this[$F]):$i.off($p,this,this[$F]))},$F._setPlayActions=function($i,$p,$F,$J){if(void 0===$J&&($J=!0),$i&&$p){var $A,$t=$p.split(","),$q=0;for($A=$t.length,$q=0;$q<$A;$q++)this._setPlayAction($i,$t[$q],$F,$J)}},$d(0,$F,"playEvent",null,function($i){(this._playEvents=$i)&&this._tar&&this._setPlayActions(this._tar,$i,"play")}),$d(0,$F,"target",null,function($i){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=$i,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),$d(0,$F,"stopEvent",null,function($i){(this._stopEvents=$i)&&this._tar&&this._setPlayActions(this._tar,$i,"stop")})}(),function($i){function $p(){this._src=null,this._onload=null,this._onerror=null,$p.__super.call(this)}$x($p,"laya.resource.FileBitmap",$si);var $F=$p.prototype;return $d(0,$F,"src",function(){return this._src},function($i){this._src=$i}),$d(0,$F,"onload",null,function($i){}),$d(0,$F,"onerror",null,function($i){}),$p}()),$Di=function($i){function $F($i,$p){this._is2D=!1,$F.__super.call(this);var $J=this;if(this._source=this,"2D"===$i||"AUTO"===$i&&!$G.isWebGL){this._is2D=!0,this._source=$p||$o.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var $A=this;$A.getContext=function($i,$p){if($J._ctx)return $J._ctx;var $F=$J._ctx=$J._source.getContext($i,$p);return $F&&($F._canvas=$A,$G.isFlash||$o.onLimixiu||($F.size=function($i,$p){})),$F}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}$x($F,"laya.resource.HTMLCanvas",$si);var $p=$F.prototype;return $p.clear=function(){this._ctx&&this._ctx.clear()},$p.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$p.release=function(){},$p._setContext=function($i){this._ctx=$i},$p.getContext=function($i,$p){return this._ctx?this._ctx:this._ctx=$F._createContext(this)},$p.getMemSize=function(){return 0},$p.size=function($i,$p){(this._w!=$i||this._h!=$p||this._source&&(this._source.width!=$i||this._source.height!=$p))&&(this._w=$i,this._h=$p,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size($i,$p),this._source&&(this._source.height=$p,this._source.width=$i))},$p.getCanvas=function(){return this._source},$p.toBase64=function($i,$p,$F){if(this._source)if($G.isConchApp&&this._source.toBase64)this._source.toBase64($i,$p,$F);else{var $J=this._source.toDataURL($i,$p);$F.call(this,$J)}},$d(0,$p,"context",function(){return this._ctx}),$d(0,$p,"asBitmap",null,function($i){}),$F.create=function($i,$p){return new $F($i,$p)},$F.TYPE2D="2D",$F.TYPE3D="3D",$F.TYPEAUTO="AUTO",$F._createContext=null,$F}(),$Ei=(function($i){function $O($i,$p,$F,$J,$A,$t,$q,$B){throw $O.__super.call(this),new Error("不允许new！")}$x($O,"laya.resource.HTMLSubImage",$si),$O.create=function($i,$p,$F,$J,$A,$t,$q,$B){return void 0===$B&&($B=!1),new $O($i,$p,$F,$J,$A,$t,$q,$B)}}(),function($i){function $u(){this._frames=null,this._url=null,$u.__super.call(this),this._setControlNode(this)}$x($u,"laya.display.Animation",$i);var $p=$u.prototype;$p.destroy=function($i){void 0===$i&&($i=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,$i),this._frames=null,this._labels=null},$p.play=function($i,$p,$F,$J){void 0===$i&&($i=0),void 0===$p&&($p=!0),void 0===$F&&($F=""),void 0===$J&&($J=!0),$F&&this._setFramesFromCache($F,$J),this._isPlaying=!0,this.index="string"==typeof $i?this._getFrameByLabel($i):$i,this.loop=$p,this._actionName=$F,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},$p._setFramesFromCache=function($i,$p){var $F;return void 0===$p&&($p=!1),this._url&&($i=this._url+"#"+$i),$i&&$u.framesMap[$i]?(($F=$u.framesMap[$i])instanceof Array?(this._frames=$u.framesMap[$i],this._count=this._frames.length):($F.nodeRoot&&($u.framesMap[$i]=this._parseGraphicAnimationByData($F),$F=$u.framesMap[$i]),this._frames=$F.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=$F.interval),this._labels=this._copyLabels($F.labels)),!0):($p&&console.log("ani not found:",$i),!1)},$p._copyLabels=function($i){if(!$i)return null;var $p,$F;for($F in $p={},$i)$p[$F]=$b.copyArray([],$i[$F]);return $p},$p._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&$i.prototype._frameLoop.call(this)},$p._displayToIndex=function($i){this._frames&&(this.graphics=this._frames[$i])},$p.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},$p.loadImages=function($i,$p){return void 0===$p&&($p=""),this._url="",this._setFramesFromCache($p)||(this.frames=$u.framesMap[$p]?$u.framesMap[$p]:$u.createFrames($i,$p)),this},$p.loadAtlas=function($p,$F,$J){void 0===$J&&($J=""),this._url="";var $A=this;function $i($i){$p===$i&&($A.frames=$u.framesMap[$J]?$u.framesMap[$J]:$u.createFrames($p,$J),$F&&$F.run())}return $A._setFramesFromCache($J)||($Bi.getAtlas($p)?$i($p):$a.loader.load($p,$M.create(null,$i,[$p]),null,"atlas")),this},$p.loadAnimation=function($i,$p,$F){this._url=$i;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,$p&&$p.run()):!$F||$Bi.getAtlas($F)?this._loadAnimationData($i,$p,$F):$a.loader.load($F,$M.create(this,this._loadAnimationData,[$i,$p,$F]),null,"atlas"),this},$p._loadAnimationData=function($B,$O,$i){var $U=this;if(!$i||$Bi.getAtlas($i)){var $d=this;$Bi.getRes($B)?$p($B):$a.loader.load($B,$M.create(null,$p,[$B]),null,"json"),$Bi.clearRes($B)}else console.warn("atlas load fail:"+$i);function $p($i){if($Bi.getRes($i)&&$B===$i){var $p;if($u.framesMap[$B+"#"])$d._setFramesFromCache($U._actionName,!0),$U.index=0,$U._checkResumePlaying();else{var $F=$d._parseGraphicAnimation($Bi.getRes($B));if(!$F)return;var $J,$A=$F.animationList,$t=0,$q=$A.length;for($t=0;$t<$q;$t++)$p=$A[$t],$u.framesMap[$B+"#"+$p.name]=$p,$J||($J=$p);$J&&($u.framesMap[$B+"#"]=$J,$d._setFramesFromCache($U._actionName,!0),$U.index=0),$U._checkResumePlaying()}$O&&$O.run()}}},$p._parseGraphicAnimation=function($i){return $ai.parseAnimationData($i)},$p._parseGraphicAnimationByData=function($i){return $ai.parseAnimationByData($i)},$d(0,$p,"frames",function(){return this._frames},function($i){(this._frames=$i)&&(this._count=$i.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),$d(0,$p,"autoPlay",null,function($i){$i?this.play():this.stop()}),$d(0,$p,"source",null,function($i){-1<$i.indexOf(".ani")?this.loadAnimation($i):-1<$i.indexOf(".json")||-1<$i.indexOf("als")||-1<$i.indexOf("atlas")?this.loadAtlas($i):this.loadImages($i.split(","))}),$d(0,$p,"autoAnimation",null,function($i){this.play(0,!0,$i,!1)}),$u.createFrames=function($i,$p){var $F,$J,$A=0,$t=0;if("string"==typeof $i){var $q=$Bi.getAtlas($i);if($q&&$q.length)for($F=[],$A=0,$t=$q.length;$A<$t;$A++)($J=new $h.createGraphics).drawTexture($Bi.getRes($q[$A]),0,0),$F.push($J)}else if($i instanceof Array)for($F=[],$A=0,$t=$i.length;$A<$t;$A++)($J=new $h.createGraphics).loadImage($i[$A],0,0),$F.push($J);return $p&&($u.framesMap[$p]=$F),$F},$u.clearCache=function($i){var $p,$F=$u.framesMap,$J=$i+"#";for($p in $F)$p!==$i&&0!=$p.indexOf($J)||delete $u.framesMap[$p]},$u.framesMap={}}($xi),function($i){function $t(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,$t.__super.call(this),null==$t._sortIndexFun&&($t._sortIndexFun=$g.sortByKey("index",!1,!0))}$x($t,"laya.display.FrameAnimation",$i);var $p=$t.prototype;return $p._setUp=function($i,$p){this._labels=null,this._animationNewFrames=null,this._targetDic=$i,this._animationData=$p,this.interval=1e3/$p.frameRate,$p.parsed?(this._count=$p.count,this._labels=$p.labels,this._animationNewFrames=$p.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),$p.parsed=!0,$p.labels=this._labels,$p.count=this._count,$p.animationNewFrames=this._animationNewFrames},$p.clear=function(){$i.prototype.clear.call(this),this._targetDic=null,this._animationData=null},$p._displayToIndex=function($i){if(this._animationData){$i<0&&($i=0),$i>this._count&&($i=this._count);var $p=this._animationData.nodes,$F=0,$J=$p.length;for($F=0;$F<$J;$F++)this._displayNodeToFrame($p[$F],$i)}},$p._displayNodeToFrame=function($i,$p,$F){$F||($F=this._targetDic);var $J=$F[$i.target];if($J){var $A,$t,$q,$B=$i.frames,$O=$i.keys,$U=0,$d=$O.length;for($U=0;$U<$d;$U++)$q=($t=$B[$A=$O[$U]]).length>$p?$t[$p]:$t[$t.length-1],$J[$A]=$q}},$p._calculateDatas=function(){if(this._animationData){var $i,$p=this._animationData.nodes,$F=0,$J=$p.length;for($F=this._count=0;$F<$J;$F++)$i=$p[$F],this._calculateNodeKeyFrames($i);this._count+=1}},$p._calculateNodeKeyFrames=function($i){var $p,$F,$J=$i.keyframes,$A=$i.target;for($p in $i.frames||($i.frames={}),$i.keys?$i.keys.length=0:$i.keys=[],$i.initValues||($i.initValues={}),$J)$F=$J[$p],$i.frames[$p]||($i.frames[$p]=[]),this._targetDic&&this._targetDic[$A]&&($i.initValues[$p]=this._targetDic[$A][$p]),$F.sort($t._sortIndexFun),$i.keys.push($p),this._calculateNodePropFrames($F,$i.frames[$p],$p,$A)},$p.resetToInitState=function(){if(this._targetDic&&this._animationData){var $i,$p,$F=this._animationData.nodes,$J=0,$A=$F.length;for($J=0;$J<$A;$J++)if($p=($i=$F[$J]).initValues){var $t,$q=this._targetDic[$i.target];if($q)for($t in $p)$q[$t]=$p[$t]}}},$p._calculateNodePropFrames=function($i,$p,$F,$J){var $A=0,$t=$i.length-1;if(0<$t){for($p.length=$i[$t].index+1,$A=0;$A<$t;$A++)this._dealKeyFrame($i[$A]),this._calculateFrameValues($i[$A],$i[$A+1],$p);this._dealKeyFrame($i[$A])}0==$t&&($p[$i[0].index]=$i[0].value,this._animationNewFrames&&(this._animationNewFrames[$i[0].index]=!0))},$p._dealKeyFrame=function($i){$i.label&&""!=$i.label&&this.addLabel($i.label,$i.index)},$p._calculateFrameValues=function($i,$p,$F){var $J,$A=0,$t=$i.index,$q=$p.index,$B=$i.value,$O=$p.value-$i.value,$U=$q-$t;if($q>this._count&&(this._count=$q),$i.tween)for(null==($J=$T[$i.tweenMethod])&&($J=$T.linearNone),$A=$t;$A<$q;$A++)$F[$A]=$J($A-$t,$B,$O,$U),this._animationNewFrames&&(this._animationNewFrames[$A]=!0);else for($A=$t;$A<$q;$A++)$F[$A]=$B;this._animationNewFrames&&(this._animationNewFrames[$i.index]=!0,this._animationNewFrames[$p.index]=!0),$F[$p.index]=$p.value},$t._sortIndexFun=null,$t}($xi)),$vi=function($p){function $A(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",$A.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=$ji.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}$x($A,"laya.display.Input",$p);var $i=$A.prototype;return $i.setSelection=function($i,$p){this.focus=!0,laya.display.Input.inputElement.selectionStart=$i,laya.display.Input.inputElement.selectionEnd=$p},$i._onUnDisplay=function($i){this.focus=!1},$i._onMouseDown=function($i){this.focus=!0},$i._syncInputTransform=function(){var $i=this.nativeInput,$p=$b.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),$F=this._width-this.padding[1]-this.padding[3],$J=this._height-this.padding[0]-this.padding[2];$G.isConchApp?($i.setScale($p.scaleX,$p.scaleY),$i.setSize($F,$J),$i.setPos($p.x,$p.y)):($A.inputContainer.style.transform=$A.inputContainer.style.webkitTransform="scale("+$p.scaleX+","+$p.scaleY+") rotate("+$a.stage.canvasDegree+"deg)",$i.style.width=$F+"px",$i.style.height=$J+"px",$A.inputContainer.style.left=$p.x+"px",$A.inputContainer.style.top=$p.y+"px")},$i.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},$i._setInputMethod=function(){$A.input.parentElement&&$A.inputContainer.removeChild($A.input),$A.area.parentElement&&$A.inputContainer.removeChild($A.area),$A.inputElement=this._multiline?$A.area:$A.input,$A.inputContainer.appendChild($A.inputElement),$ji.RightToLeft&&($A.inputElement.style.direction="rtl")},$i._focusIn=function(){laya.display.Input.isInputting=!0;var $i=this.nativeInput;this._focus=!0;var $p=$i.style;$p.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),$i.readOnly=!this._editable,$G.isConchApp&&($i.setType(this._type),$i.setForbidEdit(!this._editable)),$i.maxLength=this._maxChars;this.padding;if($i.type=this._type,$i.value=this._content,$i.placeholder=this._prompt,$a.stage.off("keydown",this,this._onKeyDown),$a.stage.on("keydown",this,this._onKeyDown),($a.stage.focus=this).event("focus"),$o.onPC&&$i.focus(),!$o.onMiniGame){this._text;this._text=null}this.typeset(),$i.setColor(this._originColor),$i.setFontSize(this.fontSize),$i.setFontFace($o.onIPhone&&$ji._fontFamilyMap[this.font]||this.font),$G.isConchApp&&$i.setMultiAble&&$i.setMultiAble(this._multiline),$p.lineHeight=this.leading+this.fontSize+"px",$p.fontStyle=this.italic?"italic":"normal",$p.fontWeight=this.bold?"bold":"normal",$p.textAlign=this.align,$p.padding="0 0",this._syncInputTransform(),!$G.isConchApp&&$o.onPC&&$a.timer.frameLoop(1,this,this._syncInputTransform)},$i._setPromptColor=function(){($A.promptStyleDOM=$o.getElementById("promptStyle"))||(($A.promptStyleDOM=$o.createElement("style")).setAttribute("id","promptStyle"),$o.document.head.appendChild($A.promptStyleDOM)),$A.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},$i._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?($a.superSet($ji,this,"text",this._content),$a.superSet($ji,this,"color",this._originColor)):($a.superSet($ji,this,"text",this._prompt),$a.superSet($ji,this,"color",this._promptColor)),$a.stage.off("keydown",this,this._onKeyDown),$a.stage.focus=null,this.event("blur"),$G.isConchApp&&this.nativeInput.blur(),$o.onPC&&$a.timer.clear(this,this._syncInputTransform)},$i._onKeyDown=function($i){13===$i.keyCode&&($o.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},$i.changeText=function($i){this._content=$i,this._focus?(this.nativeInput.value=$i||"",this.event("change")):$p.prototype.changeText.call(this,$i)},$d(0,$i,"color",$p.prototype._$get_color,function($i){this._focus&&this.nativeInput.setColor($i),$a.superSet($ji,this,"color",this._content?$i:this._promptColor),this._originColor=$i}),$d(0,$i,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function($i){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),$d(0,$i,"multiline",function(){return this._multiline},function($i){this._multiline=$i,this.valign=$i?"top":"middle"}),$d(0,$i,"maxChars",function(){return this._maxChars},function($i){$i<=0&&($i=1e5),this._maxChars=$i}),$d(0,$i,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function($i){$a.superSet($ji,this,"color",this._originColor),$i+="",this._focus?(this.nativeInput.value=$i||"",this.event("change")):(this._multiline||($i=$i.replace(/\r?\n/g,"")),(this._content=$i)?$a.superSet($ji,this,"text",$i):($a.superSet($ji,this,"text",this._prompt),$a.superSet($ji,this,"color",this.promptColor)))}),$d(0,$i,"nativeInput",function(){return this._multiline?$A.area:$A.input}),$d(0,$i,"prompt",function(){return this._prompt},function($i){!this._text&&$i&&$a.superSet($ji,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?$a.superSet($ji,this,"text",this._text==this._prompt?$i:this._text):$a.superSet($ji,this,"text",$i),this._prompt=$ji.langPacks&&$ji.langPacks[$i]?$ji.langPacks[$i]:$i}),$d(0,$i,"focus",function(){return this._focus},function($i){var $p=this.nativeInput;this._focus!==$i&&($i?($p.target?$p.target._focusOut():this._setInputMethod(),($p.target=this)._focusIn()):($p.target=null,this._focusOut(),$o.document.body.scrollTop=0,$p.blur(),$G.isConchApp?$p.setPos(-1e4,-1e4):$A.inputContainer.contains($p)&&$A.inputContainer.removeChild($p)))}),$d(0,$i,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function($i){$i?(-1<($i="[^"+$i+"]").indexOf("^^")&&($i=$i.replace("^^","")),this._restrictPattern=new RegExp($i,"g")):this._restrictPattern=null}),$d(0,$i,"editable",function(){return this._editable},function($i){this._editable=$i,$G.isConchApp&&$A.input.setForbidEdit(!$i)}),$d(0,$i,"promptColor",function(){return this._promptColor},function($i){this._promptColor=$i,this._content||$a.superSet($ji,this,"color",$i)}),$d(0,$i,"type",function(){return this._type},function($i){this._getCSSStyle().password="password"==$i,this._type=$i,$G.isConchApp&&this.nativeInput.setType($i)}),$d(0,$i,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function($i){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),$d(0,$i,"asPassword",function(){return this._getCSSStyle().password},function($i){this._getCSSStyle().password=$i,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),$A.__init__=function(){$A._createInputElement(),$o.onMobile&&$G.canvas.addEventListener($A.IOS_IFRAME?$o.onMiniGame?"touchend":"click":"touchend",$A._popupInputMethod)},$A._popupInputMethod=function($i){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},$A._createInputElement=function(){$A._initInput($A.area=$o.createElement("textarea")),$A._initInput($A.input=$o.createElement("input")),($A.inputContainer=$o.createElement("div")).style.position="absolute",$A.inputContainer.style.zIndex=1e5,$o.container.appendChild($A.inputContainer),$A.inputContainer.setPos=function($i,$p){$A.inputContainer.style.left=$i+"px",$A.inputContainer.style.top=$p+"px"}},$A._initInput=function($p){var $i=$p.style;$i.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",$i.resize="none",$i.backgroundColor="transparent",$i.border="none",$i.outline="none",$i.zIndex=1,$p.addEventListener("input",$A._processInputting),$p.addEventListener("mousemove",$A._stopEvent),$p.addEventListener("mousedown",$A._stopEvent),$p.addEventListener("touchmove",$A._stopEvent),$p.setFontFace=function($i){$p.style.fontFamily=$i},$G.isConchApp||($p.setColor=function($i){$p.style.color=$i},$p.setFontSize=function($i){$p.style.fontSize=$i+"px"})},$A._processInputting=function($i){var $p=laya.display.Input.inputElement.target;if($p){var $F=laya.display.Input.inputElement.value;$p._restrictPattern&&($F=$F.replace(/\u2006|\x27/g,""),$p._restrictPattern.test($F)&&($F=$F.replace($p._restrictPattern,""),laya.display.Input.inputElement.value=$F)),$p._text=$F,$p.event("input")}},$A._stopEvent=function($i){"touchmove"==$i.type&&$i.preventDefault(),$i.stopPropagation&&$i.stopPropagation()},$A.TYPE_TEXT="text",$A.TYPE_PASSWORD="password",$A.TYPE_EMAIL="email",$A.TYPE_URL="url",$A.TYPE_NUMBER="number",$A.TYPE_RANGE="range",$A.TYPE_DATE="date",$A.TYPE_MONTH="month",$A.TYPE_WEEK="week",$A.TYPE_TIME="time",$A.TYPE_DATE_TIME="datetime",$A.TYPE_DATE_TIME_LOCAL="datetime-local",$A.TYPE_SEARCH="search",$A.input=null,$A.area=null,$A.inputElement=null,$A.inputContainer=null,$A.confirmButton=null,$A.promptStyleDOM=null,$A.inputHeight=45,$A.isInputting=!1,$A.stageMatrix=null,$O($A,["IOS_IFRAME",function(){return this.IOS_IFRAME=$o.onIOS&&$o.window.top!=$o.window.self}]),$A}($ji),$gi=function($i){function $F($i,$p){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,$F.__super.call(this),$i&&this._init_($i,$p)}$x($F,"laya.resource.HTMLImage",$Mi);var $p=$F.prototype;return $p._init_=function($i,$p){this._src=$i,this._source=new $o.window.Image,$p&&($p.onload&&(this.onload=$p.onload),$p.onerror&&(this.onerror=$p.onerror),$p.onCreate&&$p.onCreate(this)),0!=$i.indexOf("data:image")&&(this._source.crossOrigin=""),$i&&(this._source.src=$i)},$p.recreateResource=function(){var $i=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var $p=this;this._source=new $o.window.Image,this._source.crossOrigin="",this._source.onload=function(){if($p._needReleaseAgain)return $p._needReleaseAgain=!1,$p._source.onload=null,void($p._source=null);$p._source.onload=null,$p.memorySize=$i._w*$i._h*4,$p._recreateLock=!1,$p.completeCreate()},this._source.src=this._src}},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},$p.onresize=function(){this._w=this._source.width,this._h=this._source.height},$d(0,$p,"onload",null,function($i){var $p=this;this._onload=$i,this._source&&(this._source.onload=null!=this._onload?function(){$p.onresize(),$p._onload()}:null)}),$d(0,$p,"onerror",null,function($i){var $p=this;this._onerror=$i,this._source&&(this._source.onerror=null!=this._onerror?function(){$p._onerror()}:null)}),$d(0,$p,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($i){this._enableMerageInAtlas=$i,$G.isConchApp&&this._source&&(this._source.enableMerageInAtlas=$i)}),$F.create=function($i,$p){return new $F($i,$p)},$F}(),$ai=(function($t){function $i(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,$i.__super.call(this)}$x($i,"laya.display.EffectAnimation",$t);var $p=$i.prototype;$p._onOtherBegin=function($i){$i!=this&&this.stop()},$p.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},$p._onPlayAction=function(){this.play(0,!1)},$p.play=function($i,$p,$F,$J){void 0===$i&&($i=0),void 0===$p&&($p=!0),void 0===$F&&($F=""),void 0===$J&&($J=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,$i,$p,$F,$J))},$p._recordInitData=function(){if(this._aniKeys){var $i,$p,$F=0;for($i=this._aniKeys.length,$F=0;$F<$i;$F++)$p=this._aniKeys[$F],this._initData[$p]=this._target[$p]}},$p._displayToIndex=function($i){if(this._animationData){$i<0&&($i=0),$i>this._count&&($i=this._count);var $p=this._animationData.nodes,$F=0,$J=$p.length;for($J=1<$J?1:$J,$F=0;$F<$J;$F++)this._displayNodeToFrame($p[$F],$i)}},$p._displayNodeToFrame=function($i,$p,$F){if(this._target){var $J;$J=this._target;var $A,$t,$q,$B,$O=$i.frames,$U=$i.keys,$d=0,$u=$U.length;$B=$i.secondFrames;var $S,$Z,$s,$x,$j=0;for($d=0;$d<$u;$d++)$t=$O[$A=$U[$d]],$q=-1==($j=$B[$A])?this._initData[$A]:$p<$j?($s=($Z=$i.keyframes[$A])[0]).tween?(null==($S=$T[$s.tweenMethod])&&($S=$T.linearNone),$x=$Z[1],$S($p,this._initData[$A],$x.value-this._initData[$A],$x.index)):this._initData[$A]:$t.length>$p?$t[$p]:$t[$t.length-1],$J[$A]=$q}},$p._calculateNodeKeyFrames=function($i){$t.prototype._calculateNodeKeyFrames.call(this,$i);var $p,$F,$J,$A=$i.keyframes;$i.target;for($p in $J={},$i.secondFrames=$J,$A)($F=$A[$p]).length<=1?$J[$p]=-1:$J[$p]=$F[1].index},$d(0,$p,"target",function(){return this._target},function($i){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=$i,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),$d(0,$p,"playEvent",null,function($i){(this._playEvents=$i)&&this.addEvent()}),$d(0,$p,"effectData",null,function($i){var $p;$i&&(($p=$i.animations)&&$p[0]&&(this._setUp({},$p[0]),$p[0].nodes&&$p[0].nodes[0]&&(this._aniKeys=$p[0].nodes[0].keys)))}),$d(0,$p,"effectClass",null,function($i){var $p,$F;(this._effectClass=$C.getClass($i),this._effectClass)&&(($p=this._effectClass.uiView)&&($F=$p.animations)&&$F[0]&&(this._setUp({},$F[0]),$F[0].nodes&&$F[0].nodes[0]&&(this._aniKeys=$F[0].nodes[0].keys)))}),$i.EffectAnimationBegin="effectanimationbegin"}($Ei),function($p){var $Y;function $c(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,$c.__super.call(this)}$x($c,"laya.utils.GraphicAnimation",$p);var $i=$c.prototype;return $i._parseNodeList=function($i){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[$i.compId]=$i.props,$i.compId&&this._nodeList.push($i.compId);var $p=$i.child;if($p){var $F=0,$J=$p.length;for($F=0;$F<$J;$F++)this._parseNodeList($p[$F])}},$i._calGraphicData=function($i){var $p;if(this._setUp(null,$i),this._createGraphicData(),this._nodeIDAniDic)for($p in this._nodeIDAniDic)this._nodeIDAniDic[$p]=null},$i._createGraphicData=function(){var $i,$p=[],$F=0,$J=this.count,$A=this._animationNewFrames;for($A||($A=[]),$F=0;$F<$J;$F++)!$A[$F]&&$i||($i=this._createFrameGraphic($F)),$p.push($i);this._gList=$p},$i._createFrameGraphic=function($i){var $p=$h.createGraphics();return $c._rootMatrix||($c._rootMatrix=new $m),this._updateNodeGraphic(this._rootNode,$i,$c._rootMatrix,$p),$p},$i._updateNodeGraphic=function($i,$p,$F,$J,$A){var $t;void 0===$A&&($A=1);var $q,$B,$O,$U=($t=this._nodeGDic[$i.compId]=this._getNodeGraphicData($i.compId,$p,this._nodeGDic[$i.compId])).alpha*$A;if(!($U<.01)&&($t.resultTransform||($t.resultTransform=$m.create()),$q=$t.resultTransform,$m.mul($t.transform,$F,$q),$t.skin&&($B=this._getTextureByUrl($t.skin))&&($q._checkTransform()?($J.drawTexture($B,0,0,$t.width,$t.height,$q,$U),$t.resultTransform=null):$J.drawTexture($B,$q.tx,$q.ty,$t.width,$t.height,null,$U)),$O=$i.child)){var $d,$u=0;for($d=$O.length,$u=0;$u<$d;$u++)this._updateNodeGraphic($O[$u],$p,$q,$J,$U)}},$i._updateNoChilds=function($i,$p){if($i.skin){var $F=this._getTextureByUrl($i.skin);if($F){var $J=$i.transform;$J._checkTransform();!$J.bTransform?$p.drawTexture($F,$J.tx,$J.ty,$i.width,$i.height,null,$i.alpha):$p.drawTexture($F,0,0,$i.width,$i.height,$J.clone(),$i.alpha)}}},$i._updateNodeGraphic2=function($i,$p,$F){var $J;if($J=this._nodeGDic[$i.compId]=this._getNodeGraphicData($i.compId,$p,this._nodeGDic[$i.compId]),$i.child){var $A=$J.transform;$A._checkTransform();var $t,$q;$q=($t=!$A.bTransform)&&(0!=$A.tx||0!=$A.ty);var $B,$O,$U;if(($B=$A.bTransform||1!=$J.alpha)&&$F.save(),1!=$J.alpha&&$F.alpha($J.alpha),$t?$q&&$F.translate($A.tx,$A.ty):$F.transform($A.clone()),$O=$i.child,$J.skin&&($U=this._getTextureByUrl($J.skin))&&$F.drawTexture($U,0,0,$J.width,$J.height),$O){var $d,$u=0;for($d=$O.length,$u=0;$u<$d;$u++)this._updateNodeGraphic2($O[$u],$p,$F)}$B?$F.restore():$t?$q&&$F.translate(-$A.tx,-$A.ty):$F.transform($A.clone().invert())}else this._updateNoChilds($J,$F)},$i._calculateNodeKeyFrames=function($i){$p.prototype._calculateNodeKeyFrames.call(this,$i),this._nodeIDAniDic[$i.target]=$i},$i.getNodeDataByID=function($i){return this._nodeIDAniDic[$i]},$i._getParams=function($i,$p,$F,$J){var $A=$c._temParam;$A.length=$p.length;var $t=0,$q=$p.length;for($t=0;$t<$q;$t++)$A[$t]=this._getObjVar($i,$p[$t][0],$F,$p[$t][1],$J);return $A},$i._getObjVar=function($i,$p,$F,$J,$A){if($i.hasOwnProperty($p)){var $t=$i[$p];if($F>=$t.length&&($F=$t.length-1),null!=$i[$p][$F])return $i[$p][$F]}return $A.hasOwnProperty($p)?$A[$p]:$J},$i._getNodeGraphicData=function($i,$p,$F){$F||($F=$Y.create()),$F.transform?$F.transform.identity():$F.transform=$m.create();var $J=this.getNodeDataByID($i);if(!$J)return $F;var $A,$t,$q=$J.frames,$B=this._getParams($q,$c._drawTextureCmd,$p,this._nodeDefaultProps[$i]),$O=$B[0],$U=NaN,$d=NaN,$u=$B[5],$S=$B[6],$Z=$B[13],$s=$B[14],$x=$B[7],$j=$B[8],$r=$B[9],$M=$B[11],$D=$B[12];$U=$B[3],$d=$B[4],0!=$U&&0!=$d||($O=null),-1==$U&&($U=0),-1==$d&&($d=0),$F.skin=$O,$F.width=$U,$F.height=$d,$O&&(($A=this._getTextureByUrl($O))?($U||($U=$A.sourceWidth),$d||($d=$A.sourceHeight)):console.warn("lost skin:",$O,",you may load pics first")),$F.alpha=$B[10],$t=$F.transform,0!=$Z&&($u=$Z*$U),0!=$s&&($S=$s*$d),0==$u&&0==$S||$t.translate(-$u,-$S);var $E=null;if($r||1!==$x||1!==$j||$M||$D){($E=$c._tempMt).identity(),$E.bTransform=!0;var $v=.0174532922222222*($r-$M),$g=.0174532922222222*($r+$D),$a=Math.cos($g),$R=Math.sin($g),$Q=Math.sin($v),$P=Math.cos($v);$E.a=$x*$a,$E.b=$x*$R,$E.c=-$j*$Q,$E.d=$j*$P,$E.tx=$E.ty=0}return $E&&($t=$m.mul($t,$E,$t)),$t.translate($B[1],$B[2]),$F},$i._getTextureByUrl=function($i){return $Bi.getRes($i)},$i.setAniData=function($i,$p){if($i.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$i,this._parseNodeList($i);var $F,$J={},$A=[],$t=$i.animations,$q=0,$B=$t.length;for($q=0;$q<$B;$q++)if($F=$t[$q],this._labels=null,(!$p||$p==$F.name)&&$F){try{this._calGraphicData($F)}catch($i){console.warn("parse animation fail:"+$F.name+",empty animation created"),this._gList=[]}var $O={};$O.interval=1e3/$F.frameRate,$O.frames=this._gList,$O.labels=this._labels,$O.name=$F.name,$A.push($O),$J[$F.name]=$O}this.animationList=$A,this.animationDic=$J}$c._temParam.length=0},$i.parseByData=function($i){var $p,$F;$p=$i.nodeRoot,$F=$i.aniO,delete $i.nodeRoot,delete $i.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=$p,this._parseNodeList($p),this._labels=null;try{this._calGraphicData($F)}catch($i){console.warn("parse animation fail:"+$F.name+",empty animation created"),this._gList=[]}var $J=$i;return $J.interval=1e3/$F.frameRate,$J.frames=this._gList,$J.labels=this._labels,$J.name=$F.name,$J},$i.setUpAniData=function($i){if($i.animations){var $p,$F={},$J=[],$A=$i.animations,$t=0,$q=$A.length;for($t=0;$t<$q;$t++)if($p=$A[$t]){var $B={};$B.name=$p.name,$B.aniO=$p,$B.nodeRoot=$i,$J.push($B),$F[$p.name]=$B}this.animationList=$J,this.animationDic=$F}},$i._clear=function(){var $i,$p;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for($i in this._nodeGDic)($p=this._nodeGDic[$i])&&$p.recover();this._nodeGDic=null},$c.parseAnimationByData=function($i){var $p;return $c._I||($c._I=new $c),$p=$c._I.parseByData($i),$c._I._clear(),$p},$c.parseAnimationData=function($i){var $p;return $c._I||($c._I=new $c),$c._I.setUpAniData($i),($p={}).animationList=$c._I.animationList,$p.animationDic=$c._I.animationDic,$c._I._clear(),$p},$c._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],$c._temParam=[],$c._I=null,$c._rootMatrix=null,$O($c,["_tempMt",function(){return this._tempMt=new $m}]),$c.__init$=function(){$Y=function(){function $i(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return $x($i,""),$i.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),$w.recover("GraphicNode",this)},$i.create=function(){return $w.getItemByClass("GraphicNode",$i)},$i}()},$c}($Ei));$a.__init([$U,$Oi,$G,$o,$X,$P,$i,$ai])}(window,document,Laya),function($i,$p,$F){$F.un,$F.uns,$F.static;var $J=$F.class;$F.getset,$F.__newvec;new(function(){function $i(){}return $J($i,"LayaMain"),$i}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}}),function($i,$p,$g){$g.un,$g.uns;var $q=$g.static,$S=$g.class,$J=$g.getset,$t=$g.__newvec,$d=laya.maths.Arith,$u=laya.maths.Bezier,$F=laya.resource.Bitmap,$Z=laya.utils.Browser,$O=laya.utils.Byte,$s=laya.utils.Color,$a=(laya.filters.ColorFilter,$g.Config),$A=laya.resource.Context,$R=(laya.events.Event,laya.filters.Filter),$B=laya.display.Graphics,$U=laya.resource.HTMLCanvas,$x=(laya.utils.HTMLChar,laya.resource.HTMLImage),$j=laya.resource.HTMLSubImage,$Q=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),$P=laya.maths.Point,$Y=laya.maths.Rectangle,$r=laya.renders.Render,$M=(laya.renders.RenderContext,laya.renders.RenderSprite),$D=laya.resource.Resource,$E=laya.resource.ResourceManager,$v=laya.utils.RunDriver,$c=laya.display.Sprite,$h=laya.display.Stage,$m=laya.utils.Stat,$n=laya.utils.StringKey,$I=(laya.display.css.Style,laya.system.System),$G=laya.display.Text,$_=laya.resource.Texture,$y=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),$N=laya.utils.VectorGraphManager;laya.utils.WordText;$g.interface("laya.webgl.shapes.IShape"),$g.interface("laya.webgl.submit.ISubmit"),$g.interface("laya.webgl.text.ICharSegment"),$g.interface("laya.webgl.canvas.save.ISaveData"),$g.interface("laya.webgl.resource.IMergeAtlasBitmap"),$g.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var $f=function(){function $i(){}$S($i,"laya.filters.webgl.FilterActionGL");var $p=$i.prototype;return $g.imps($p,{"laya.filters.IFilterActionGL":!0}),$p.setValue=function($i){},$p.setValueMix=function($i){},$p.apply3d=function($i,$p,$F,$J,$A){return null},$p.apply=function($i){return null},$J(0,$p,"typeMix",function(){return 0}),$i}(),$o=function(){function $i(){}return $S($i,"laya.webgl.shader.ShaderValue"),$i}(),$W=function(){var $J,$A;function $i($i,$p,$F){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new $A,void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),this._cells=null,this._rowInfo=null,this._init($i,$p),this._atlasID=$F}$S($i,"laya.webgl.atlas.AtlasGrid");var $p=$i.prototype;return $p.getAltasID=function(){return this._atlasID},$p.setAltasID=function($i){0<=$i&&(this._atlasID=$i)},$p.addTex=function($i,$p,$F){var $J=this._get($p,$F);return 0==$J.ret||(this._fill($J.x,$J.y,$p,$F,$i),this._texCount++),$J},$p._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},$p._init=function($i,$p){if(this._width=$i,this._height=$p,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=$t(this._height);for(var $F=0;$F<this._height;$F++)this._rowInfo[$F]=new $J;return this._clear(),!0},$p._get=function($i,$p){var $F=new $C;if($i>=this._failSize.width&&$p>=this._failSize.height)return $F;for(var $J=-1,$A=-1,$t=this._width,$q=this._height,$B=this._cells,$O=0;$O<$q;$O++)if(!(this._rowInfo[$O].spaceCount<$i))for(var $U=0;$U<$t;){var $d=3*($O*$t+$U);if(0!=$B[$d]||$B[1+$d]<$i||$B[2+$d]<$p)$U+=$B[1+$d];else{$J=$U,$A=$O;for(var $u=0;$u<$i;$u++)if($B[3*$u+$d+2]<$p){$J=-1;break}if(!($J<0))return $F.ret=!0,$F.x=$J,$F.y=$A,$F;$U+=$B[1+$d]}}return $F},$p._fill=function($i,$p,$F,$J,$A){var $t=this._width,$q=this._height;this._check($i+$F<=$t&&$p+$J<=$q);for(var $B=$p;$B<$J+$p;++$B){this._check(this._rowInfo[$B].spaceCount>=$F),this._rowInfo[$B].spaceCount-=$F;for(var $O=0;$O<$F;$O++){var $U=3*($i+$B*$t+$O);this._check(0==this._cells[$U]),this._cells[$U]=$A,this._cells[1+$U]=$F,this._cells[2+$U]=$J}}if(0<$i)for($B=0;$B<$J;++$B){var $d=0;for($O=$i-1;0<=$O&&0==this._cells[3*(($p+$B)*$t+$O)];--$O,++$d);for($O=$d;0<$O;--$O)this._cells[3*(($p+$B)*$t+$i-$O)+1]=$O,this._check(0<$O)}if(0<$p)for($O=$i;$O<$i+$F;++$O){for($d=0,$B=$p-1;0<=$B&&0==this._cells[3*($O+$B*$t)];--$B,$d++);for($B=$d;0<$B;--$B)this._cells[3*($O+($p-$B)*$t)+2]=$B,this._check(0<$B)}},$p._check=function($i){0==$i&&console.log("xtexMerger 错误啦")},$p._clear=function(){for(var $i=this._texCount=0;$i<this._height;$i++)this._rowInfo[$i].spaceCount=this._width;for(var $p=0;$p<this._height;$p++)for(var $F=0;$F<this._width;$F++){var $J=3*($p*this._width+$F);this._cells[$J]=0,this._cells[1+$J]=this._width-$F,this._cells[2+$J]=this._width-$p}this._failSize.width=this._width+1,this._failSize.height=this._height+1},$i.__init$=function(){$J=function(){function $i(){this.spaceCount=0}return $S($i,""),$i}(),$A=function(){function $i(){this.width=0,this.height=0}return $S($i,""),$i}()},$i}(),$L=function(){function $r($i,$p,$F,$J){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=$i,this._height=$p,this._gridSize=$F,this._maxAtlaserCount=$J,this._gridNumX=$i/$F,this._gridNumY=$p/$F,this._curAtlasIndex=0,this._atlaserArray=[]}$S($r,"laya.webgl.atlas.AtlasResourceManager");var $i=$r.prototype;return $i.setAtlasParam=function($i,$p,$F,$J){if(1==this._setAtlasParam)return $r._sid_=0,this._width=$i,this._height=$p,this._gridSize=$F,this._maxAtlaserCount=$J,this._gridNumX=$i/$F,this._gridNumY=$p/$F,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},$i.pushData=function($i){var $p,$F=$i.bitmap,$J=-1,$A=null,$t=0,$q=0;for($t=0,$p=this._atlaserArray.length;$t<$p&&($q=(this._curAtlasIndex+$t)%$p,-1==($J=($A=this._atlaserArray[$q]).findBitmapIsExist($F)));$t++);if(-1!=$J){var $B=$A.InAtlasWebGLImagesOffsetValue[$J];return $s=$B[0],$x=$B[1],$A.addToAtlas($i,$s,$x),!0}this._setAtlasParam=!1;for(var $O=Math.ceil(($i.bitmap.width+2)/this._gridSize),$U=Math.ceil(($i.bitmap.height+2)/this._gridSize),$d=!1,$u=0;$u<2;$u++){var $S=this._maxAtlaserCount;for($t=0;$t<$S;$t++){$q=(this._curAtlasIndex+$t)%$S,this._atlaserArray.length-1>=$q||this._atlaserArray.push(new $Yi(this._gridNumX,this._gridNumY,this._width,this._height,$r._sid_++));var $Z=this._atlaserArray[$q],$s=0,$x=0,$j=$Z.addTex(1,$O,$U);if($j.ret){$s=$j.x*this._gridSize+1,$x=$j.y*this._gridSize+1,$F.lock=!0,$Z.addToAtlasTexture($F,$s,$x),$Z.addToAtlas($i,$s,$x),$d=!0,this._curAtlasIndex=$q;break}}if($d)break;this._atlaserArray.push(new $Yi(this._gridNumX,this._gridNumY,this._width,this._height,$r._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return $d||console.log(">>>AtlasManager pushData error"),$d},$i.addToAtlas=function($i){laya.webgl.atlas.AtlasResourceManager.instance.pushData($i)},$i.garbageCollection=function(){if(!0===this._needGC){for(var $i=this._atlaserArray.length-this._maxAtlaserCount,$p=0;$p<$i;$p++)this._atlaserArray[$p].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+$i),this._atlaserArray.splice(0,$i),this._needGC=!1}return!0},$i.freeAll=function(){for(var $i=0,$p=this._atlaserArray.length;$i<$p;$i++)this._atlaserArray[$i].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},$i.getAtlaserCount=function(){return this._atlaserArray.length},$i.getAtlaserByIndex=function($i){return this._atlaserArray[$i]},$J(1,$r,"instance",function(){return $r._Instance||($r._Instance=new $r(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),$r._Instance}),$J(1,$r,"enabled",function(){return $a.atlasEnable}),$J(1,$r,"atlasLimitWidth",function(){return $r._atlasLimitWidth},function($i){$r._atlasLimitWidth=$i}),$J(1,$r,"atlasLimitHeight",function(){return $r._atlasLimitHeight},function($i){$r._atlasLimitHeight=$i}),$r._enable=function(){$a.atlasEnable=!0},$r._disable=function(){$a.atlasEnable=!1},$r.__init__=function(){$r.atlasTextureWidth=2048,$r.atlasTextureHeight=2048,$r.maxTextureCount=6,$r.atlasLimitWidth=512,$r.atlasLimitHeight=512},$r._atlasLimitWidth=0,$r._atlasLimitHeight=0,$r.gridSize=16,$r.atlasTextureWidth=0,$r.atlasTextureHeight=0,$r.maxTextureCount=0,$r._atlasRestore=0,$r.BOARDER_TYPE_NO=0,$r.BOARDER_TYPE_RIGHT=1,$r.BOARDER_TYPE_LEFT=2,$r.BOARDER_TYPE_BOTTOM=4,$r.BOARDER_TYPE_TOP=8,$r.BOARDER_TYPE_ALL=15,$r._sid_=0,$r._Instance=null,$r}(),$C=function(){function $i(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return $S($i,"laya.webgl.atlas.MergeFillInfo"),$i}(),$K=function(){function $p(){}return $S($p,"laya.webgl.canvas.BlendMode"),$p._init_=function($i){$p.fns=[$p.BlendNormal,$p.BlendAdd,$p.BlendMultiply,$p.BlendScreen,$p.BlendOverlay,$p.BlendLight,$p.BlendMask,$p.BlendDestinationOut],$p.targetFns=[$p.BlendNormalTarget,$p.BlendAddTarget,$p.BlendMultiplyTarget,$p.BlendScreenTarget,$p.BlendOverlayTarget,$p.BlendLightTarget,$p.BlendMask,$p.BlendDestinationOut]},$p.BlendNormal=function($i){$i.blendFunc(1,771)},$p.BlendAdd=function($i){$i.blendFunc(1,772)},$p.BlendMultiply=function($i){$i.blendFunc(774,771)},$p.BlendScreen=function($i){$i.blendFunc(1,1)},$p.BlendOverlay=function($i){$i.blendFunc(1,769)},$p.BlendLight=function($i){$i.blendFunc(1,1)},$p.BlendNormalTarget=function($i){$i.blendFunc(1,771)},$p.BlendAddTarget=function($i){$i.blendFunc(1,772)},$p.BlendMultiplyTarget=function($i){$i.blendFunc(774,771)},$p.BlendScreenTarget=function($i){$i.blendFunc(1,1)},$p.BlendOverlayTarget=function($i){$i.blendFunc(1,769)},$p.BlendLightTarget=function($i){$i.blendFunc(1,1)},$p.BlendMask=function($i){$i.blendFunc(0,770)},$p.BlendDestinationOut=function($i){$i.blendFunc(0,0)},$p.activeBlendFunction=null,$p.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],$p.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},$p.NORMAL="normal",$p.ADD="add",$p.MULTIPLY="multiply",$p.SCREEN="screen",$p.LIGHT="light",$p.OVERLAY="overlay",$p.DESTINATIONOUT="destination-out",$p.fns=[],$p.targetFns=[],$p}(),$V=function(){function $F($i){this._color=$s.create("black"),this.setValue($i)}$S($F,"laya.webgl.canvas.DrawStyle");var $i=$F.prototype;return $i.setValue=function($i){if($i){if("string"==typeof $i)return void(this._color=$s.create($i));if($i instanceof laya.utils.Color)return void(this._color=$i)}},$i.reset=function(){this._color=$s.create("black")},$i.equal=function($i){return"string"==typeof $i?this._color.strColor===$i:$i instanceof laya.utils.Color&&this._color.numColor===$i.numColor},$i.toColorStr=function(){return this._color.strColor},$F.create=function($i){var $p;if($i&&("string"==typeof $i?$p=$s.create($i):$i instanceof laya.utils.Color&&($p=$i),$p))return $p._drawStyle||($p._drawStyle=new $F($i));return laya.webgl.canvas.DrawStyle.DEFAULT},$q($F,["DEFAULT",function(){return this.DEFAULT=new $F("#000000")}]),$F}(),$T=function(){function $i(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];$Ei.mainContext;this.ib=$li.create(35048),this.vb=$Hi.create(5)}$S($i,"laya.webgl.canvas.Path");var $p=$i.prototype;return $p.addPoint=function($i,$p){this.tempArray.push($i,$p)},$p.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},$p.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},$p.polygon=function($i,$p,$F,$J,$A,$t){var $q;return this.geomatrys.push(this._curGeomatry=$q=new $ni($i,$p,$F,$J,$A,$t)),$J||($q.fill=!1),null==$t&&($q.borderWidth=0),$q},$p.setGeomtry=function($i){this.geomatrys.push(this._curGeomatry=$i)},$p.drawLine=function($i,$p,$F,$J,$A){var $t;return this.closePath?this.geomatrys.push(this._curGeomatry=$t=new $mi($i,$p,$F,$J,$A)):this.geomatrys.push(this._curGeomatry=$t=new $hi($i,$p,$F,$J,$A)),$t.fill=!1,$t},$p.update=function(){var $i=this.ib._byteLength,$p=this.geomatrys.length;this.offset=$i;for(var $F=this.geoStart;$F<$p;$F++)this.geomatrys[$F].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=$p,this.count=(this.ib._byteLength-$i)/$xi.BYTES_PIDX},$p.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},$p.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},$i}(),$k=function(){function $B(){}$S($B,"laya.webgl.canvas.save.SaveBase");var $i=$B.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!1},$i.restore=function($i){this._dataObj[this._valueName]=this._value,($B._cache[$B._cache._length++]=this)._newSubmit&&($i._curSubmit=$ti.RENDERBASE,$i._renderKey=0)},$B._createArray=function(){var $i=[];return $i._length=0,$i},$B._init=function(){var $i=$B._namemap={};return $i[1]="ALPHA",$i[2]="fillStyle",$i[8]="font",$i[256]="lineWidth",$i[512]="strokeStyle",$i[8192]="_mergeID",$i[1024]=$i[2048]=$i[4096]=[],$i[16384]="textBaseline",$i[32768]="textAlign",$i[65536]="_nBlendType",$i[1048576]="shader",$i[2097152]="filters",$i},$B.save=function($i,$p,$F,$J){if(($i._saveMark._saveuse&$p)!==$p){$i._saveMark._saveuse|=$p;var $A=$B._cache,$t=0<$A._length?$A[--$A._length]:new $B;$t._value=$F[$t._valueName=$B._namemap[$p]],$t._dataObj=$F,$t._newSubmit=$J;var $q=$i._save;$q[$q._length++]=$t}},$B._cache=laya.webgl.canvas.save.SaveBase._createArray(),$B._namemap=$B._init(),$B}(),$w=function(){function $t(){this._clipRect=new $Y}$S($t,"laya.webgl.canvas.save.SaveClipRect");var $i=$t.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!1},$i.restore=function($i){$i._clipRect=this._clipSaveRect,($t._cache[$t._cache._length++]=this)._submitScissor.submitLength=$i._submits._length-this._submitScissor.submitIndex,$i._curSubmit=$ti.RENDERBASE,$i._renderKey=0},$t.save=function($i,$p){if(131072!=(131072&$i._saveMark._saveuse)){$i._saveMark._saveuse|=131072;var $F=$t._cache,$J=0<$F._length?$F[--$F._length]:new $t;$J._clipSaveRect=$i._clipRect,$i._clipRect=$J._clipRect.copyFrom($i._clipRect),$J._submitScissor=$p;var $A=$i._save;$A[$A._length++]=$J}},$q($t,["_cache",function(){return this._cache=$k._createArray()}]),$t}(),$$=function(){function $Z(){this._contextX=0,this._contextY=0,this._clipRect=new $Y,this._rect=new $Y,this._matrix=new $Q}$S($Z,"laya.webgl.canvas.save.SaveClipRectStencil");var $i=$Z.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!1},$i.restore=function($i){$di.restore($i,this._rect,this._saveMatrix,this._contextX,this._contextY),$i._clipRect=this._clipSaveRect,$i._curMat=this._saveMatrix,$i._x=this._contextX,$i._y=this._contextY,$Z._cache[$Z._cache._length++]=this,$i._curSubmit=$ti.RENDERBASE},$Z.save=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){if(262144!=(262144&$i._saveMark._saveuse)){$i._saveMark._saveuse|=262144;var $d=$Z._cache,$u=0<$d._length?$d[--$d._length]:new $Z;$u._clipSaveRect=$i._clipRect,$u._clipRect.setTo($q,$B,$O,$U),$i._clipRect=$u._clipRect,$u._rect.x=$F,$u._rect.y=$J,$u._rect.width=$A,$u._rect.height=$t,$u._contextX=$i._x,$u._contextY=$i._y,$u._saveMatrix=$i._curMat,$i._curMat.copyTo($u._matrix),$i._curMat=$u._matrix,$u._submitStencil=$p;var $S=$i._save;$S[$S._length++]=$u}},$q($Z,["_cache",function(){return this._cache=$k._createArray()}]),$Z}(),$X=function(){function $J(){this._saveuse=0}$S($J,"laya.webgl.canvas.save.SaveMark");var $i=$J.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!0},$i.restore=function($i){$i._saveMark=this._preSaveMark,$J._no[$J._no._length++]=this},$J.Create=function($i){var $p=$J._no,$F=0<$p._length?$p[--$p._length]:new $J;return $F._saveuse=0,$F._preSaveMark=$i._saveMark,$i._saveMark=$F},$q($J,["_no",function(){return this._no=$k._createArray()}]),$J}(),$e=function(){function $t(){this._matrix=new $Q}$S($t,"laya.webgl.canvas.save.SaveTransform");var $i=$t.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!1},$i.restore=function($i){$i._curMat=this._savematrix,$t._no[$t._no._length++]=this},$t.save=function($i){var $p=$i._saveMark;if(2048!=(2048&$p._saveuse)){$p._saveuse|=2048;var $F=$t._no,$J=0<$F._length?$F[--$F._length]:new $t;$J._savematrix=$i._curMat,$i._curMat=$i._curMat.copyTo($J._matrix);var $A=$i._save;$A[$A._length++]=$J}},$q($t,["_no",function(){return this._no=$k._createArray()}]),$t}(),$b=function(){function $A(){}$S($A,"laya.webgl.canvas.save.SaveTranslate");var $i=$A.prototype;return $g.imps($i,{"laya.webgl.canvas.save.ISaveData":!0}),$i.isSaveMark=function(){return!1},$i.restore=function($i){$i._curMat;$i._x=this._x,$i._y=this._y,$A._no[$A._no._length++]=this},$A.save=function($i){var $p=$A._no,$F=0<$p._length?$p[--$p._length]:new $A;$F._x=$i._x,$F._y=$i._y;var $J=$i._save;$J[$J._length++]=$F},$q($A,["_no",function(){return this._no=$k._createArray()}]),$A}(),$z=function(){function $i(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new $Y}$S($i,"laya.webgl.resource.RenderTargetMAX");var $p=$i.prototype;return $p.setSP=function($i){this._sp=$i},$p.size=function($i,$p){var $F=this;this._width!==$i||this._height!==$p?(this.repaint=!0,this._width=$i,this._height=$p,this.target?this.target.size($i,$p):this.target=$Ni.create($i,$p),this.target.hasListener("recovered")||this.target.on("recovered",this,function($i){$g.timer.callLater($F._sp,$F._sp.repaint)})):this.target.size($i,$p)},$p._flushToTarget=function($i,$p){if(!$p._destroy){var $F=$Mi.worldScissorTest,$J=$Mi.worldClipRect;$Mi.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,$Mi.worldScissorTest=!1,$Ei.mainContext.disable(3089);var $A=$Mi.worldAlpha,$t=$Mi.worldMatrix4,$q=$Mi.worldMatrix,$B=$Mi.worldFilters,$O=$Mi.worldShaderDefines;if($Mi.worldMatrix=$Q.EMPTY,$Mi.restoreTempArray(),$Mi.worldMatrix4=$Mi.TEMPMAT4_ARRAY,$Mi.worldAlpha=1,$Mi.worldFilters=null,$Mi.worldShaderDefines=null,$yi.activeShader=null,$p.start(),$a.showCanvasMark?$p.clear(0,1,0,.3):$p.clear(0,0,0,0),$i.flush(),$p.end(),$yi.activeShader=null,$Mi.worldAlpha=$A,$Mi.worldMatrix4=$t,$Mi.worldMatrix=$q,$Mi.worldFilters=$B,$Mi.worldShaderDefines=$O,$Mi.worldScissorTest=$F){var $U=$Mi.height-$J.y-$J.height;$Ei.mainContext.scissor($J.x,$U,$J.width,$J.height),$Ei.mainContext.enable(3089)}$Mi.worldClipRect=$J}},$p.flush=function($i){this.repaint&&(this._flushToTarget($i,this.target),this.repaint=!1)},$p.drawTo=function($i,$p,$F,$J,$A){$i.drawTexture(this.target.getTexture(),$p,$F,$J,$A,0,0)},$p.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},$i}(),$l=function(){function $i(){this.ALPHA=1,this.shaderType=0,this.defines=new $ci}return $S($i,"laya.webgl.shader.d2.Shader2D"),$i.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},$i.__init__=function(){var $i,$p;$Xi.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),$Xi.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),$Xi.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),$Xi.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),$Xi.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),$Xi.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),$Xi.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),$Xi.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),$i="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$p='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Xi.preCompile2D(0,1,$i,$p,null),$i="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",$p='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',$Xi.preCompile2D(0,2,$i,$p,null),$i="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",$p="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",$Xi.preCompile2D(0,4,$i,$p,null),$i="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",$p='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',$Xi.preCompile2D(0,256,$i,$p,null),$i="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",$p="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",$Xi.preCompile2D(0,512,$i,$p,null)},$i}(),$H=function(){function $p($i,$p,$F){this._value=0,this._name2int=$i,this._int2name=$p,this._int2nameMap=$F}$S($p,"laya.webgl.shader.ShaderDefines");var $i=$p.prototype;return $i.add=function($i){return"string"==typeof $i&&($i=this._name2int[$i]),this._value|=$i,this._value},$i.addInt=function($i){return this._value|=$i,this._value},$i.remove=function($i){return"string"==typeof $i&&($i=this._name2int[$i]),this._value&=~$i,this._value},$i.isDefine=function($i){return(this._value&$i)===$i},$i.getValue=function(){return this._value},$i.setValue=function($i){this._value=$i},$i.toNameDic=function(){var $i=this._int2nameMap[this._value];return $i||$p._toText(this._value,this._int2name,this._int2nameMap)},$p._reg=function($i,$p,$F,$J){$J[$F[$i]=$p]=$i},$p._toText=function($i,$p,$F){var $J=$F[$i];if($J)return $J;for(var $A={},$t=1,$q=0;$q<32&&!($i<($t=1<<$q));$q++)if($i&$t){var $B=$p[$t];$B&&($A[$B]="")}return $F[$i]=$A},$p._toInt=function($i,$p){for(var $F=$i.split("."),$J=0,$A=0,$t=$F.length;$A<$t;$A++){var $q=$p[$F[$A]];if(!$q)throw new Error("Defines to int err:"+$i+"/"+$F[$A]);$J|=$q}return $J},$p}(),$ii=function(){function $q(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new $Q}$S($q,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var $i=$q.prototype;return $i.init=function($i,$p,$F){if($p)this._vs=$p;else{this._vs=[];var $J=$i.width,$A=$i.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push($J,0,1,0,1,1,1,1),this._vs.push($J,$A,1,1,1,1,1,1),this._vs.push(0,$A,0,1,1,1,1,1)}$F?this._ps=$F:($q._defaultPS||($q._defaultPS=[]).push(0,1,3,3,1,2),this._ps=$q._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=$i},$i.init2=function($i,$p,$F,$J,$A){this.transform&&(this.transform=null),$F?this._ps=$F:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=$J,this._uvs=$A,this.mEleNum=this._ps.length,this.mTexture=$i,($r.isConchNode||$r.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},$i._initMyData=function(){var $i=0,$p=0,$F=4*this._verticles.length;this._vs=$q._tempVS;var $J=!1;if($r.isConchNode||$r.isConchApp?(this._vs.length=$F,$J=!0):this._vs.length<$F&&(this._vs.length=$F,$J=!0),$q._tVSLen=$F,$J)for(;$i<$F;)this._vs[$i]=this._verticles[$p],this._vs[$i+1]=this._verticles[$p+1],this._vs[$i+2]=this._uvs[$p],this._vs[$i+3]=this._uvs[$p+1],this._vs[$i+4]=1,this._vs[$i+5]=1,this._vs[$i+6]=1,this._vs[$i+7]=1,$i+=8,$p+=2;else for(;$i<$F;)this._vs[$i]=this._verticles[$p],this._vs[$i+1]=this._verticles[$p+1],this._vs[$i+2]=this._uvs[$p],this._vs[$i+3]=this._uvs[$p+1],$i+=8,$p+=2},$i.getData2=function($i,$p,$F){var $J;this.mVBBuffer=$i,this.mIBBuffer=$p,this._initMyData(),$i.appendEx2(this._vs,Float32Array,$q._tVSLen,4),this._indexStart=$p._byteLength,($J=$q._tempIB).length<this._ps.length&&($J.length=this._ps.length);for(var $A=0,$t=this._ps.length;$A<$t;$A++)$J[$A]=this._ps[$A]+$F;$p.appendEx2($J,Uint16Array,this._ps.length,2)},$i.getData=function($i,$p,$F){if(this.mVBBuffer=$i,this.mIBBuffer=$p,$i.append(this.mVBData),this._indexStart=$p._byteLength,this.mIBData.start!=$F){for(var $J=0,$A=this._ps.length;$J<$A;$J++)this.mIBData[$J]=this._ps[$J]+$F;this.mIBData.start=$F}$p.append(this.mIBData)},$i.render=function($i,$p,$F){if($r.isWebGL&&this.mTexture){$i._renderKey=0,$i._shader2D.glTexture=null,$pi.getInstance().addSkinMesh(this);var $J=$ti.createShape($i,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,$Ri.create(512,0));this.transform||(this.transform=$Q.EMPTY),this.transform.translate($p,$F),$Q.mul(this.transform,$i._curMat,this._tempMatrix),this.transform.translate(-$p,-$F);var $A=$J.shaderValue,$t=$A.u_mmat2||$Mi.getMatrArray();$Mi.mat2MatArray(this._tempMatrix,$t),$A.textureHost=this.mTexture,$A.offsetX=0,$A.offsetY=0,$A.u_mmat2=$t,$A.ALPHA=$i._shader2D.ALPHA,$i._submits[$i._submits._length++]=$J}else $r.isConchApp&&this.mTexture&&(this.transform||(this.transform=$Q.EMPTY),$i.setSkinMesh&&$i.setSkinMesh($p,$F,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},$q._tempVS=[],$q._tempIB=[],$q._defaultPS=null,$q._tVSLen=0,$q}(),$pi=function(){function $i(){this.ib=null,this.vb=null;$Ei.mainContext;this.ib=$li.create(35048),this.vb=$Hi.create(8)}$S($i,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var $p=$i.prototype;return $p.addSkinMesh=function($i){$i.getData2(this.vb,this.ib,this.vb._byteLength/32)},$p.reset=function(){this.vb.clear(),this.ib.clear()},$i.getInstance=function(){return $i.instance=$i.instance||new $i},$i.instance=null,$i}(),$Fi=function(){function $i($i,$p,$F,$J,$A,$t,$q,$B,$O){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===$O&&($O=0),this.x=$i,this.y=$p,this.width=$F,this.height=$J,this.edges=$A,this.color=$t,this.borderWidth=$q,this.borderColor=$B}$S($i,"laya.webgl.shapes.BasePoly");var $p=$i.prototype;return $g.imps($p,{"laya.webgl.shapes.IShape":!0}),$p.getData=function($i,$p,$F){},$p.rebuild=function($i){},$p.setMatrix=function($i){},$p.needUpdate=function($i){return!0},$p.sector=function($i,$p,$F){var $J=this.x,$A=this.y,$t=this.edges,$q=(this.r1-this.r0)/$t,$B=this.width,$O=this.height,$U=this.color,$d=($U>>16&255)/255,$u=($U>>8&255)/255,$S=(255&$U)/255;$i.push($J,$A,$d,$u,$S);for(var $Z=0;$Z<$t+1;$Z++)$i.push($J+Math.sin($q*$Z+this.r0)*$B,$A+Math.cos($q*$Z+this.r0)*$O),$i.push($d,$u,$S);for($Z=0;$Z<$t;$Z++)$p.push($F,$F+$Z+1,$F+$Z+2)},$p.createLine2=function($i,$p,$F,$J,$A,$t){var $q,$B,$O,$U,$d,$u,$S,$Z,$s,$x,$j,$r,$M,$D,$E,$v,$g,$a,$R,$Q,$P=$i.concat(),$Y=$A,$c=this.borderColor,$h=($c>>16&255)/255,$m=($c>>8&255)/255,$n=(255&$c)/255,$I=$P.length/2,$G=$J,$_=$F/2;$O=$P[0],$U=$P[1],$x=$O-($d=$P[2]),$s=($s=-($U-($u=$P[3])))/($Q=Math.sqrt($s*$s+$x*$x))*$_,$x=$x/$Q*$_,$Y.push($O-$s+this.x,$U-$x+this.y,$h,$m,$n,$O+$s+this.x,$U+$x+this.y,$h,$m,$n);for(var $y=1;$y<$I-1;$y++)$O=$P[2*($y-1)],$U=$P[2*($y-1)+1],$d=$P[2*$y],$u=$P[2*$y+1],$S=$P[2*($y+1)],$Z=$P[2*($y+1)+1],$x=$O-$d,$r=$d-$S,$E=(-($s=($s=-($U-$u))/($Q=Math.sqrt($s*$s+$x*$x))*$_)+$O)*(-($x=$x/$Q*$_)+$u)-(-$s+$d)*(-$x+$U),$a=(-($j=($j=-($u-$Z))/($Q=Math.sqrt($j*$j+$r*$r))*$_)+$S)*(-($r=$r/$Q*$_)+$u)-(-$j+$d)*(-$r+$Z),$R=($M=-$x+$U-(-$x+$u))*($g=-$j+$d-(-$j+$S))-($v=-$r+$Z-(-$r+$u))*($D=-$s+$d-(-$s+$O)),Math.abs($R)<.1?($R+=10.1,$Y.push($d-$s+this.x,$u-$x+this.y,$h,$m,$n,$d+$s+this.x,$u+$x+this.y,$h,$m,$n)):((($q=($D*$a-$g*$E)/$R)-$d)*($q-$d)+(($B=($v*$E-$M*$a)/$R)-$u)+($B-$u),$Y.push($q+this.x,$B+this.y,$h,$m,$n,$d-($q-$d)+this.x,$u-($B-$u)+this.y,$h,$m,$n));$O=$P[$P.length-4],$U=$P[$P.length-3],$x=$O-($d=$P[$P.length-2]),$s=($s=-($U-($u=$P[$P.length-1])))/($Q=Math.sqrt($s*$s+$x*$x))*$_,$x=$x/$Q*$_,$Y.push($d-$s+this.x,$u-$x+this.y,$h,$m,$n,$d+$s+this.x,$u+$x+this.y,$h,$m,$n);var $N=$t;for($y=1;$y<$N;$y++)$p.push($G+2*($y-1),$G+2*($y-1)+1,$G+2*$y+1,$G+2*$y+1,$G+2*$y,$G+2*($y-1));return $Y},$p.createLine=function($i,$p,$F,$J){var $A=$i.concat(),$t=$i,$q=this.borderColor,$B=($q>>16&255)/255,$O=($q>>8&255)/255,$U=(255&$q)/255;$A.splice(0,5);var $d,$u,$S,$Z,$s,$x,$j,$r,$M,$D,$E,$v,$g,$a,$R,$Q,$P,$Y,$c,$h,$m=$A.length/5,$n=$J,$I=$F/2;$S=$A[0],$Z=$A[1],$D=$S-($s=$A[5]),$M=($M=-($Z-($x=$A[6])))/($h=Math.sqrt($M*$M+$D*$D))*$I,$D=$D/$h*$I,$t.push($S-$M,$Z-$D,$B,$O,$U,$S+$M,$Z+$D,$B,$O,$U);for(var $G=1;$G<$m-1;$G++)$S=$A[5*($G-1)],$Z=$A[5*($G-1)+1],$s=$A[5*$G],$x=$A[5*$G+1],$j=$A[5*($G+1)],$r=$A[5*($G+1)+1],$D=$S-$s,$v=$s-$j,$R=(-($M=($M=-($Z-$x))/($h=Math.sqrt($M*$M+$D*$D))*$I)+$S)*(-($D=$D/$h*$I)+$x)-(-$M+$s)*(-$D+$Z),$Y=(-($E=($E=-($x-$r))/($h=Math.sqrt($E*$E+$v*$v))*$I)+$j)*(-($v=$v/$h*$I)+$x)-(-$E+$s)*(-$v+$r),$c=($g=-$D+$Z-(-$D+$x))*($P=-$E+$s-(-$E+$j))-($Q=-$v+$r-(-$v+$x))*($a=-$M+$s-(-$M+$S)),Math.abs($c)<.1?($c+=10.1,$t.push($s-$M,$x-$D,$B,$O,$U,$s+$M,$x+$D,$B,$O,$U)):((($d=($a*$Y-$P*$R)/$c)-$s)*($d-$s)+(($u=($Q*$R-$g*$Y)/$c)-$x)+($u-$x),$t.push($d,$u,$B,$O,$U,$s-($d-$s),$x-($u-$x),$B,$O,$U));$S=$A[$A.length-10],$Z=$A[$A.length-9],$D=$S-($s=$A[$A.length-5]),$M=($M=-($Z-($x=$A[$A.length-4])))/($h=Math.sqrt($M*$M+$D*$D))*$I,$D=$D/$h*$I,$t.push($s-$M,$x-$D,$B,$O,$U,$s+$M,$x+$D,$B,$O,$U);var $_=this.edges+1;for($G=1;$G<$_;$G++)$p.push($n+2*($G-1),$n+2*($G-1)+1,$n+2*$G+1,$n+2*$G+1,$n+2*$G,$n+2*($G-1));return $t},$p.createLoopLine=function($i,$p,$F,$J,$A,$t){var $q=$i.concat(),$B=$A||$i,$O=this.borderColor,$U=($O>>16&255)/255,$d=($O>>8&255)/255,$u=(255&$O)/255;$q.splice(0,5);var $S=[$q[0],$q[1]],$Z=[$q[$q.length-5],$q[$q.length-4]],$s=$Z[0]+.5*($S[0]-$Z[0]),$x=$Z[1]+.5*($S[1]-$Z[1]);$q.unshift($s,$x,0,0,0),$q.push($s,$x,0,0,0);var $j,$r,$M,$D,$E,$v,$g,$a,$R,$Q,$P,$Y,$c,$h,$m,$n,$I,$G,$_,$y,$N=$q.length/5,$f=$J,$o=$F/2;$M=$q[0],$D=$q[1],$Q=$M-($E=$q[5]),$R=($R=-($D-($v=$q[6])))/($y=Math.sqrt($R*$R+$Q*$Q))*$o,$Q=$Q/$y*$o,$B.push($M-$R,$D-$Q,$U,$d,$u,$M+$R,$D+$Q,$U,$d,$u);for(var $W=1;$W<$N-1;$W++)$M=$q[5*($W-1)],$D=$q[5*($W-1)+1],$E=$q[5*$W],$v=$q[5*$W+1],$g=$q[5*($W+1)],$a=$q[5*($W+1)+1],$Q=$M-$E,$Y=$E-$g,$m=(-($R=($R=-($D-$v))/($y=Math.sqrt($R*$R+$Q*$Q))*$o)+$M)*(-($Q=$Q/$y*$o)+$v)-(-$R+$E)*(-$Q+$D),$G=(-($P=($P=-($v-$a))/($y=Math.sqrt($P*$P+$Y*$Y))*$o)+$g)*(-($Y=$Y/$y*$o)+$v)-(-$P+$E)*(-$Y+$a),$_=($c=-$Q+$D-(-$Q+$v))*($I=-$P+$E-(-$P+$g))-($n=-$Y+$a-(-$Y+$v))*($h=-$R+$E-(-$R+$M)),Math.abs($_)<.1?($_+=10.1,$B.push($E-$R,$v-$Q,$U,$d,$u,$E+$R,$v+$Q,$U,$d,$u)):((($j=($h*$G-$I*$m)/$_)-$E)*($j-$E)+(($r=($n*$m-$c*$G)/$_)-$v)+($r-$v),$B.push($j,$r,$U,$d,$u,$E-($j-$E),$v-($r-$v),$U,$d,$u));$t&&($p=$t);var $L=this.edges+1;for($W=1;$W<$L;$W++)$p.push($f+2*($W-1),$f+2*($W-1)+1,$f+2*$W+1,$f+2*$W+1,$f+2*$W,$f+2*($W-1));return $p.push($f+2*($W-1),$f+2*($W-1)+1,$f+1,$f+1,$f,$f+2*($W-1)),$B},$i}(),$Ji=function(){function $x(){}return $S($x,"laya.webgl.shapes.Earcut"),$x.earcut=function($i,$p,$F){$F=$F||2;var $J,$A,$t,$q,$B,$O,$U,$d=$p&&$p.length,$u=$d?$p[0]*$F:$i.length,$S=$x.linkedList($i,0,$u,$F,!0),$Z=[];if(!$S)return $Z;if($d&&($S=$x.eliminateHoles($i,$p,$S,$F)),$i.length>80*$F){$J=$t=$i[0],$A=$q=$i[1];for(var $s=$F;$s<$u;$s+=$F)($B=$i[$s])<$J&&($J=$B),($O=$i[$s+1])<$A&&($A=$O),$t<$B&&($t=$B),$q<$O&&($q=$O);$U=0!==($U=Math.max($t-$J,$q-$A))?1/$U:0}return $x.earcutLinked($S,$Z,$F,$J,$A,$U),$Z},$x.linkedList=function($i,$p,$F,$J,$A){var $t,$q;if($A===0<$x.signedArea($i,$p,$F,$J))for($t=$p;$t<$F;$t+=$J)$q=$x.insertNode($t,$i[$t],$i[$t+1],$q);else for($t=$F-$J;$p<=$t;$t-=$J)$q=$x.insertNode($t,$i[$t],$i[$t+1],$q);return $q&&$x.equals($q,$q.next)&&($x.removeNode($q),$q=$q.next),$q},$x.filterPoints=function($i,$p){if(!$i)return $i;$p||($p=$i);var $F,$J=$i;do{if($F=!1,$J.steiner||!$x.equals($J,$J.next)&&0!==$x.area($J.prev,$J,$J.next))$J=$J.next;else{if($x.removeNode($J),($J=$p=$J.prev)===$J.next)break;$F=!0}}while($F||$J!==$p);return $p},$x.earcutLinked=function($i,$p,$F,$J,$A,$t,$q){if($i){!$q&&$t&&$x.indexCurve($i,$J,$A,$t);for(var $B,$O,$U=$i;$i.prev!==$i.next;)if($B=$i.prev,$O=$i.next,$t?$x.isEarHashed($i,$J,$A,$t):$x.isEar($i))$p.push($B.i/$F),$p.push($i.i/$F),$p.push($O.i/$F),$x.removeNode($i),$i=$O.next,$U=$O.next;else if(($i=$O)===$U){$q?1===$q?($i=$x.cureLocalIntersections($i,$p,$F),$x.earcutLinked($i,$p,$F,$J,$A,$t,2)):2===$q&&$x.splitEarcut($i,$p,$F,$J,$A,$t):$x.earcutLinked($x.filterPoints($i,null),$p,$F,$J,$A,$t,1);break}}},$x.isEar=function($i){var $p=$i.prev,$F=$i,$J=$i.next;if(0<=$x.area($p,$F,$J))return!1;for(var $A=$i.next.next;$A!==$i.prev;){if($x.pointInTriangle($p.x,$p.y,$F.x,$F.y,$J.x,$J.y,$A.x,$A.y)&&0<=$x.area($A.prev,$A,$A.next))return!1;$A=$A.next}return!0},$x.isEarHashed=function($i,$p,$F,$J){var $A=$i.prev,$t=$i,$q=$i.next;if(0<=$x.area($A,$t,$q))return!1;for(var $B=$A.x<$t.x?$A.x<$q.x?$A.x:$q.x:$t.x<$q.x?$t.x:$q.x,$O=$A.y<$t.y?$A.y<$q.y?$A.y:$q.y:$t.y<$q.y?$t.y:$q.y,$U=$A.x>$t.x?$A.x>$q.x?$A.x:$q.x:$t.x>$q.x?$t.x:$q.x,$d=$A.y>$t.y?$A.y>$q.y?$A.y:$q.y:$t.y>$q.y?$t.y:$q.y,$u=$x.zOrder($B,$O,$p,$F,$J),$S=$x.zOrder($U,$d,$p,$F,$J),$Z=$i.nextZ;$Z&&$Z.z<=$S;){if($Z!==$i.prev&&$Z!==$i.next&&$x.pointInTriangle($A.x,$A.y,$t.x,$t.y,$q.x,$q.y,$Z.x,$Z.y)&&0<=$x.area($Z.prev,$Z,$Z.next))return!1;$Z=$Z.nextZ}for($Z=$i.prevZ;$Z&&$Z.z>=$u;){if($Z!==$i.prev&&$Z!==$i.next&&$x.pointInTriangle($A.x,$A.y,$t.x,$t.y,$q.x,$q.y,$Z.x,$Z.y)&&0<=$x.area($Z.prev,$Z,$Z.next))return!1;$Z=$Z.prevZ}return!0},$x.cureLocalIntersections=function($i,$p,$F){var $J=$i;do{var $A=$J.prev,$t=$J.next.next;!$x.equals($A,$t)&&$x.intersects($A,$J,$J.next,$t)&&$x.locallyInside($A,$t)&&$x.locallyInside($t,$A)&&($p.push($A.i/$F),$p.push($J.i/$F),$p.push($t.i/$F),$x.removeNode($J),$x.removeNode($J.next),$J=$i=$t),$J=$J.next}while($J!==$i);return $J},$x.splitEarcut=function($i,$p,$F,$J,$A,$t){var $q=$i;do{for(var $B=$q.next.next;$B!==$q.prev;){if($q.i!==$B.i&&$x.isValidDiagonal($q,$B)){var $O=$x.splitPolygon($q,$B);return $q=$x.filterPoints($q,$q.next),$O=$x.filterPoints($O,$O.next),$x.earcutLinked($q,$p,$F,$J,$A,$t),void $x.earcutLinked($O,$p,$F,$J,$A,$t)}$B=$B.next}$q=$q.next}while($q!==$i)},$x.eliminateHoles=function($i,$p,$F,$J){var $A,$t,$q,$B,$O,$U=[];for($A=0,$t=$p.length;$A<$t;$A++)$q=$p[$A]*$J,$B=$A<$t-1?$p[$A+1]*$J:$i.length,($O=$x.linkedList($i,$q,$B,$J,!1))===$O.next&&($O.steiner=!0),$U.push($x.getLeftmost($O));for($U.sort($x.compareX),$A=0;$A<$U.length;$A++)$x.eliminateHole($U[$A],$F),$F=$x.filterPoints($F,$F.next);return $F},$x.compareX=function($i,$p){return $i.x-$p.x},$x.eliminateHole=function($i,$p){if($p=$x.findHoleBridge($i,$p)){var $F=$x.splitPolygon($p,$i);$x.filterPoints($F,$F.next)}},$x.findHoleBridge=function($i,$p){var $F,$J=$p,$A=$i.x,$t=$i.y,$q=-1/0;do{if($t<=$J.y&&$t>=$J.next.y&&$J.next.y!==$J.y){var $B=$J.x+($t-$J.y)*($J.next.x-$J.x)/($J.next.y-$J.y);if($B<=$A&&$q<$B){if(($q=$B)===$A){if($t===$J.y)return $J;if($t===$J.next.y)return $J.next}$F=$J.x<$J.next.x?$J:$J.next}}$J=$J.next}while($J!==$p);if(!$F)return null;if($A===$q)return $F.prev;var $O,$U=$F,$d=$F.x,$u=$F.y,$S=1/0;for($J=$F.next;$J!==$U;)$A>=$J.x&&$J.x>=$d&&$A!==$J.x&&$x.pointInTriangle($t<$u?$A:$q,$t,$d,$u,$t<$u?$q:$A,$t,$J.x,$J.y)&&(($O=Math.abs($t-$J.y)/($A-$J.x))<$S||$O===$S&&$J.x>$F.x)&&$x.locallyInside($J,$i)&&($F=$J,$S=$O),$J=$J.next;return $F},$x.indexCurve=function($i,$p,$F,$J){for(var $A=$i;null===$A.z&&($A.z=$x.zOrder($A.x,$A.y,$p,$F,$J)),$A.prevZ=$A.prev,$A.nextZ=$A.next,($A=$A.next)!==$i;);$A.prevZ.nextZ=null,$A.prevZ=null,$x.sortLinked($A)},$x.sortLinked=function($i){var $p,$F,$J,$A,$t,$q,$B,$O,$U=1;do{for($F=$i,$t=$i=null,$q=0;$F;){for($q++,$J=$F,$p=$B=0;$p<$U&&($B++,$J=$J.nextZ);$p++);for($O=$U;0<$B||0<$O&&$J;)0!==$B&&(0===$O||!$J||$F.z<=$J.z)?($F=($A=$F).nextZ,$B--):($J=($A=$J).nextZ,$O--),$t?$t.nextZ=$A:$i=$A,$A.prevZ=$t,$t=$A;$F=$J}$t.nextZ=null,$U*=2}while(1<$q);return $i},$x.zOrder=function($i,$p,$F,$J,$A){return($i=1431655765&(($i=858993459&(($i=252645135&(($i=16711935&(($i=32767*($i-$F)*$A)|$i<<8))|$i<<4))|$i<<2))|$i<<1))|($p=1431655765&(($p=858993459&(($p=252645135&(($p=16711935&(($p=32767*($p-$J)*$A)|$p<<8))|$p<<4))|$p<<2))|$p<<1))<<1},$x.getLeftmost=function($i){for(var $p=$i,$F=$i;$p.x<$F.x&&($F=$p),($p=$p.next)!==$i;);return $F},$x.pointInTriangle=function($i,$p,$F,$J,$A,$t,$q,$B){return 0<=($A-$q)*($p-$B)-($i-$q)*($t-$B)&&0<=($i-$q)*($J-$B)-($F-$q)*($p-$B)&&0<=($F-$q)*($t-$B)-($A-$q)*($J-$B)},$x.isValidDiagonal=function($i,$p){return $i.next.i!==$p.i&&$i.prev.i!==$p.i&&!$x.intersectsPolygon($i,$p)&&$x.locallyInside($i,$p)&&$x.locallyInside($p,$i)&&$x.middleInside($i,$p)},$x.area=function($i,$p,$F){return($p.y-$i.y)*($F.x-$p.x)-($p.x-$i.x)*($F.y-$p.y)},$x.equals=function($i,$p){return $i.x===$p.x&&$i.y===$p.y},$x.intersects=function($i,$p,$F,$J){return!!($x.equals($i,$p)&&$x.equals($F,$J)||$x.equals($i,$J)&&$x.equals($F,$p))||0<$x.area($i,$p,$F)!=0<$x.area($i,$p,$J)&&0<$x.area($F,$J,$i)!=0<$x.area($F,$J,$p)},$x.intersectsPolygon=function($i,$p){var $F=$i;do{if($F.i!==$i.i&&$F.next.i!==$i.i&&$F.i!==$p.i&&$F.next.i!==$p.i&&$x.intersects($F,$F.next,$i,$p))return!0;$F=$F.next}while($F!==$i);return!1},$x.locallyInside=function($i,$p){return $x.area($i.prev,$i,$i.next)<0?0<=$x.area($i,$p,$i.next)&&0<=$x.area($i,$i.prev,$p):$x.area($i,$p,$i.prev)<0||$x.area($i,$i.next,$p)<0},$x.middleInside=function($i,$p){for(var $F=$i,$J=!1,$A=($i.x+$p.x)/2,$t=($i.y+$p.y)/2;$F.y>$t!=$F.next.y>$t&&$F.next.y!==$F.y&&$A<($F.next.x-$F.x)*($t-$F.y)/($F.next.y-$F.y)+$F.x&&($J=!$J),($F=$F.next)!==$i;);return $J},$x.splitPolygon=function($i,$p){var $F=new $Ai($i.i,$i.x,$i.y),$J=new $Ai($p.i,$p.x,$p.y),$A=$i.next,$t=$p.prev;return($i.next=$p).prev=$i,($F.next=$A).prev=$F,($J.next=$F).prev=$J,($t.next=$J).prev=$t,$J},$x.insertNode=function($i,$p,$F,$J){var $A=new $Ai($i,$p,$F);return $J?($A.next=$J.next,($A.prev=$J).next.prev=$A,$J.next=$A):($A.prev=$A).next=$A,$A},$x.removeNode=function($i){$i.next.prev=$i.prev,$i.prev.next=$i.next,$i.prevZ&&($i.prevZ.nextZ=$i.nextZ),$i.nextZ&&($i.nextZ.prevZ=$i.prevZ)},$x.signedArea=function($i,$p,$F,$J){for(var $A=0,$t=$p,$q=$F-$J;$t<$F;$t+=$J)$A+=($i[$q]-$i[$t])*($i[$t+1]+$i[$q+1]),$q=$t;return $A},$x}(),$Ai=function(){function $i($i,$p,$F){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=$i,this.x=$p,this.y=$F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return $S($i,"laya.webgl.shapes.EarcutNode"),$i}(),$ti=(function(){function $i($i,$p,$F,$J,$A,$t,$q){this.lineWidth=$i,this.lineColor=$p,this.lineAlpha=$F,this.fillColor=$J,this.fillAlpha=$A,this.shape=$q,this.fill=$t}$S($i,"laya.webgl.shapes.GeometryData");var $p=$i.prototype;$p.clone=function(){return new $i(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},$p.getIndexData=function(){return null},$p.getVertexData=function(){return null},$p.destroy=function(){this.shape=null}}(),function(){function $i($i){if($i instanceof Float32Array)this.points=$i;else if($i instanceof Array){$i.length;this.points=new Float32Array($i)}}$S($i,"laya.webgl.shapes.Vertex");var $p=$i.prototype;$g.imps($p,{"laya.webgl.shapes.IShape":!0}),$p.getData=function($i,$p,$F){},$p.needUpdate=function($i){return!1},$p.rebuild=function($i){},$p.setMatrix=function($i){}}(),function(){function $O($i){void 0===$i&&($i=1e4),this._renderType=$i}$S($O,"laya.webgl.submit.Submit");var $i=$O.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i.releaseRender=function(){var $i=$O._cache;($i[$i._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$i.getRenderType=function(){return this._renderType},$i.renderSubmit=function(){if(0===this._numEle)return 1;var $i=this.shaderValue.textureHost;if($i){var $p=$i.source;if(!$i.bitmap||!$p)return 1;this.shaderValue.texture=$p,$i.alphaTexture&&$i.alphaTexture.source&&(this.shaderValue.texture1=$i.alphaTexture.source)}this._vb.bind_upload(this._ib);var $F=$Ei.mainContext;return this.shaderValue.upload(),$K.activeBlendFunction!==this._blendFn&&($F.enable(3042),this._blendFn($F),$K.activeBlendFunction=this._blendFn),$m.drawCall++,$m.trianglesFaces+=this._numEle/3,$F.drawElements(4,this._numEle,5123,this._startIdx),1},$O.__init__=function(){var $i=$O.RENDERBASE=new $O(-1);$i.shaderValue=new $Ri(0,0),$i.shaderValue.ALPHA=-1234},$O.createSubmit=function($i,$p,$F,$J,$A){var $t=$O._cache._length?$O._cache[--$O._cache._length]:new $O;null==$F&&(($F=$t._selfVb||($t._selfVb=$Hi.create(-1))).clear(),$J=0),$t._ib=$p,$t._vb=$F,$t._startIdx=$J*$xi.BYTES_PIDX,$t._numEle=0;var $q=$i._nBlendType;$t._blendFn=$i._targets?$K.targetFns[$q]:$K.fns[$q],$t.shaderValue=$A,$t.shaderValue.setValue($i._shader2D);var $B=$i._shader2D.filters;return $B&&$t.shaderValue.setFilters($B),$t},$O.createShape=function($i,$p,$F,$J,$A,$t){var $q=$O._cache._length?$O._cache[--$O._cache._length]:new $O;$q._ib=$p,$q._vb=$F,$q._numEle=$J,$q._startIdx=$A,$q.shaderValue=$t,$q.shaderValue.setValue($i._shader2D);var $B=$i._nBlendType;return $q._blendFn=$i._targets?$K.targetFns[$B]:$K.fns[$B],$q},$O.TYPE_2D=1e4,$O.TYPE_CANVAS=10003,$O.TYPE_CMDSETRT=10004,$O.TYPE_CUSTOM=10005,$O.TYPE_BLURRT=10006,$O.TYPE_CMDDESTORYPRERT=10007,$O.TYPE_DISABLESTENCIL=10008,$O.TYPE_OTHERIBVB=10009,$O.TYPE_PRIMITIVE=10010,$O.TYPE_RT=10011,$O.TYPE_BLUR_RT=10012,$O.TYPE_TARGET=10013,$O.TYPE_CHANGE_VALUE=10014,$O.TYPE_SHAPE=10015,$O.TYPE_TEXTURE=10016,$O.TYPE_FILLTEXTURE=10017,$O.RENDERBASE=null,$O._cache=(($O._cache=[])._length=0,$O._cache),$O}()),$qi=function(){function $J(){this.fun=null,this.args=null}$S($J,"laya.webgl.submit.SubmitCMD");var $i=$J.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i.renderSubmit=function(){return this.fun.apply(null,this.args),1},$i.getRenderType=function(){return 0},$i.releaseRender=function(){var $i=$J._cache;$i[$i._length++]=this},$J.create=function($i,$p){var $F=$J._cache._length?$J._cache[--$J._cache._length]:new $J;return $F.fun=$p,$F.args=$i,$F},$J._cache=(($J._cache=[])._length=0,$J._cache),$J}(),$Bi=function(){function $p(){this.variables={}}$S($p,"laya.webgl.submit.SubmitCMDScope");var $i=$p.prototype;return $i.getValue=function($i){return this.variables[$i]},$i.addValue=function($i,$p){return this.variables[$i]=$p},$i.setValue=function($i,$p){return this.variables.hasOwnProperty($i)?this.variables[$i]=$p:null},$i.clear=function(){for(var $i in this.variables)delete this.variables[$i]},$i.recycle=function(){this.clear(),$p.POOL.push(this)},$p.create=function(){var $i=$p.POOL.pop();return $i||($i=new $p),$i},$p.POOL=[],$p}(),$Oi=function(){function $u(){this.offset=0,this.startIndex=0,this._mat=$Q.create()}$S($u,"laya.webgl.submit.SubmitOtherIBVB");var $i=$u.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i.releaseRender=function(){var $i=$u._cache;($i[$i._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$i.getRenderType=function(){return 10009},$i.renderSubmit=function(){var $i=this._shaderValue.textureHost;if($i){var $p=$i.source;if(!$i.bitmap||!$p)return 1;this._shaderValue.texture=$p}this._vb.bind_upload(this._ib);var $F=$Mi.worldMatrix4,$J=$Q.TEMP;$Q.mulPre(this._mat,$F[0],$F[1],$F[4],$F[5],$F[12],$F[13],$J);var $A=$Mi.worldMatrix4=$u.tempMatrix4;$A[0]=$J.a,$A[1]=$J.b,$A[4]=$J.c,$A[5]=$J.d,$A[12]=$J.tx,$A[13]=$J.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var $t=$Ei.mainContext;return $K.activeBlendFunction!==this._blendFn&&($t.enable(3042),this._blendFn($t),$K.activeBlendFunction=this._blendFn),$m.drawCall++,$m.trianglesFaces+=this._numEle/3,$t.drawElements(4,this._numEle,5123,this.startIndex),$Mi.worldMatrix4=$F,$yi.activeShader=null,1},$u.create=function($i,$p,$F,$J,$A,$t,$q,$B,$O){void 0===$O&&($O=0);var $U=$u._cache._length?$u._cache[--$u._cache._length]:new $u;$U._ib=$F,$U._vb=$p,$U._numEle=$J,$U._shader=$A,$U._shaderValue=$t;var $d=$i._nBlendType;switch($U._blendFn=$i._targets?$K.targetFns[$d]:$K.fns[$d],$O){case 0:$U.offset=0,$U.startIndex=$B/($xi.BYTES_PE*$p.vertexStride)*1.5,$U.startIndex*=$xi.BYTES_PIDX;break;case 1:$U.startIndex=$q,$U.offset=$B}return $U},$u._cache=(($u._cache=[])._length=0,$u._cache),$u.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$u}(),$Ui=function(){function $F(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new $Y,this.screenRect=new $Y}$S($F,"laya.webgl.submit.SubmitScissor");var $i=$F.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i._scissor=function($i,$p,$F,$J){var $A=$Mi.worldMatrix4,$t=$A[0],$q=$A[5],$B=$A[12],$O=$A[13];if($J*=$q,($F*=$t)<1||$J<1)return!1;var $U=($i=$i*$t+$B)+$F,$d=($p=$p*$q+$O)+$J;$i<0&&($F=$U-($i=0)),$p<0&&($J=$d-($p=0));var $u=$Mi.worldClipRect;if($i=Math.max($i,$u.x),$p=Math.max($p,$u.y),$F=Math.min($U,$u.right)-$i,$J=Math.min($d,$u.bottom)-$p,$F<1||$J<1)return!1;var $S=$Mi.worldScissorTest;return this.screenRect.copyFrom($u),$u.x=$i,$u.y=$p,$u.width=$F,$u.height=$J,$Mi.worldScissorTest=!0,$p=$Mi.height-$p-$J,$Ei.mainContext.scissor($i,$p,$F,$J),$Ei.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$S?($p=$Mi.height-this.screenRect.y-this.screenRect.height,$Ei.mainContext.scissor(this.screenRect.x,$p,this.screenRect.width,this.screenRect.height),$Ei.mainContext.enable(3089)):($Ei.mainContext.disable(3089),$Mi.worldScissorTest=!1),$u.copyFrom(this.screenRect),!0},$i._scissorWithTagart=function($i,$p,$F,$J){if($F<1||$J<1)return!1;var $A=$i+$F,$t=$p+$J;$i<0&&($F=$A-($i=0)),$p<0&&($J=$t-($p=0));var $q=$Mi.worldClipRect;if($i=Math.max($i,$q.x),$p=Math.max($p,$q.y),$F=Math.min($A,$q.right)-$i,$J=Math.min($t,$q.bottom)-$p,$F<1||$J<1)return!1;var $B=$Mi.worldScissorTest;return this.screenRect.copyFrom($q),$Mi.worldScissorTest=!0,$q.x=$i,$q.y=$p,$q.width=$F,$q.height=$J,$p=$Mi.height-$p-$J,$Ei.mainContext.scissor($i,$p,$F,$J),$Ei.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),$B?($p=$Mi.height-this.screenRect.y-this.screenRect.height,$Ei.mainContext.scissor(this.screenRect.x,$p,this.screenRect.width,this.screenRect.height),$Ei.mainContext.enable(3089)):($Ei.mainContext.disable(3089),$Mi.worldScissorTest=!1),$q.copyFrom(this.screenRect),!0},$i.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},$i.getRenderType=function(){return 0},$i.releaseRender=function(){var $i=$F._cache;($i[$i._length++]=this).context=null},$F.create=function($i){var $p=$F._cache._length?$F._cache[--$F._cache._length]:new $F;return $p.context=$i,$p},$F._cache=(($F._cache=[])._length=0,$F._cache),$F}(),$di=function(){function $O(){this.step=0,this.blendMode=null,this.level=0}$S($O,"laya.webgl.submit.SubmitStencil");var $i=$O.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},$i.getRenderType=function(){return 0},$i.releaseRender=function(){var $i=$O._cache;$i[$i._length++]=this},$i.do1=function(){var $i=$Ei.mainContext;$i.enable(2960),$i.clear(1024),$i.colorMask(!1,!1,!1,!1),$i.stencilFunc(514,this.level,255),$i.stencilOp(7680,7680,7682)},$i.do2=function(){var $i=$Ei.mainContext;$i.stencilFunc(514,this.level+1,255),$i.colorMask(!0,!0,!0,!0),$i.stencilOp(7680,7680,7680)},$i.do3=function(){var $i=$Ei.mainContext;$i.colorMask(!0,!0,!0,!0),$i.stencilOp(7680,7680,7680),$i.clear(1024),$i.disable(2960)},$i.do4=function(){var $i=$Ei.mainContext;0==this.level&&($i.enable(2960),$i.clear(1024)),$i.colorMask(!1,!1,!1,!1),$i.stencilFunc(519,0,255),$i.stencilOp(7680,7680,7682)},$i.do5=function(){var $i=$Ei.mainContext;$i.stencilFunc(514,this.level,255),$i.colorMask(!0,!0,!0,!0),$i.stencilOp(7680,7680,7680)},$i.do6=function(){var $i=$Ei.mainContext;$K.targetFns[$K.TOINT[this.blendMode]]($i)},$i.do7=function(){var $i=$Ei.mainContext;$i.colorMask(!1,!1,!1,!1),$i.stencilOp(7680,7680,7683)},$i.do8=function(){var $i=$Ei.mainContext;$i.colorMask(!0,!0,!0,!0),$i.stencilFunc(514,this.level,255),$i.stencilOp(7680,7680,7680)},$O.restore=function($i,$p,$F,$J,$A){var $t;if(($i._renderKey=0)<$O._mask&&$O._mask--,0==$O._mask)$t=laya.webgl.submit.SubmitStencil.create(3),$i.addRenderObject($t),$i._curSubmit=$ti.RENDERBASE;else{$t=laya.webgl.submit.SubmitStencil.create(7),$i.addRenderObject($t);var $q=$i._vb;$q._byteLength;if($ji.fillRectImgVb($q,null,$p.x,$p.y,$p.width,$p.height,$_.DEF_UV,$F,$J,$A,0,0)){$i._shader2D.glTexture=null;var $B=$i._curSubmit=$ti.createSubmit($i,$i._ib,$q,($q._byteLength-64)/32*3,$Ri.create(2,0));$B.shaderValue.ALPHA=1,$i._submits[$i._submits._length++]=$B,$i._curSubmit._numEle+=6,$i._curSubmit=$ti.RENDERBASE}else alert("clipRect calc stencil rect error");$t=laya.webgl.submit.SubmitStencil.create(8),$i.addRenderObject($t)}},$O.restore2=function($i,$p){var $F;($i._renderKey=0)<$O._mask&&$O._mask--,0==$O._mask?($F=laya.webgl.submit.SubmitStencil.create(3),$i.addRenderObject($F),$i._curSubmit=$ti.RENDERBASE):($F=laya.webgl.submit.SubmitStencil.create(7),$i.addRenderObject($F),$i._submits[$i._submits._length++]=$p,$F=laya.webgl.submit.SubmitStencil.create(8),$i.addRenderObject($F))},$O.create=function($i){var $p=$O._cache._length?$O._cache[--$O._cache._length]:new $O;return 5==($p.step=$i)&&++$O._mask,$p.level=$O._mask,$p},$O._cache=(($O._cache=[])._length=0,$O._cache),$O._mask=0,$O}(),$ui=function(){function $B(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}$S($B,"laya.webgl.submit.SubmitTarget");var $i=$B.prototype;return $g.imps($i,{"laya.webgl.submit.ISubmit":!0}),$i.renderSubmit=function(){this._vb.bind_upload(this._ib);var $i=this.scope.getValue(this.proName);return $i&&(this.shaderValue.texture=$i.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[$i.width,$i.height]),this.shaderValue.upload(),this.blend(),$m.drawCall++,$m.trianglesFaces+=this._numEle/3,$Ei.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},$i.blend=function(){if($K.activeBlendFunction!==$K.fns[this.blendType]){var $i=$Ei.mainContext;$i.enable(3042),$K.fns[this.blendType]($i),$K.activeBlendFunction=$K.fns[this.blendType]}},$i.getRenderType=function(){return 0},$i.releaseRender=function(){var $i=$B._cache;($i[$i._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},$B.create=function($i,$p,$F,$J,$A,$t){var $q=$B._cache._length?$B._cache[--$B._cache._length]:new $B;return $q._ib=$p,$q._vb=$F,$q.proName=$t,$q._startIdx=$J*$xi.BYTES_PIDX,$q._numEle=0,$q.blendType=$i._nBlendType,$q.shaderValue=$A,$q.shaderValue.setValue($i._shader2D),$q},$B._cache=(($B._cache=[])._length=0,$B._cache),$B}(),$Si=function(){function $i(){this._sourceStr=null}$S($i,"laya.webgl.text.CharSegment");var $p=$i.prototype;return $g.imps($p,{"laya.webgl.text.ICharSegment":!0}),$p.textToSpit=function($i){this._sourceStr=$i},$p.getChar=function($i){return this._sourceStr.charAt($i)},$p.getCharCode=function($i){return this._sourceStr.charCodeAt($i)},$p.length=function(){return this._sourceStr.length},$i}(),$Zi=function(){var $i;function $m(){}return $S($m,"laya.webgl.text.DrawText"),$m.__init__=function(){$m._charsTemp=new Array,$m._drawValue=new $i,$m._charSeg=new $Si},$m.customCharSeg=function($i){$m._charSeg=$i},$m.getChar=function($i,$p,$F){var $J=$ki.createOneChar($i,$F);return-1!=$p&&($m._charsCache[$p]=$J),$J},$m._drawSlow=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u,$S,$Z,$s){var $x,$j,$r=$m._drawValue.value($t,$B,$O,$U,$S,$Z,$s),$M=0,$D=0,$E=$m._charsTemp,$v=0,$g=NaN;if($J)for($E.length=$J.length,$M=0,$D=$J.length;$M<$D;$M++)($j=$J[$M])&&($g=$j.charNum+$r.txtID,$E[$M]=$x=$m._charsCache[$g]||$m.getChar($j.char,$g,$r),$x.active());else{var $a=$F instanceof laya.utils.WordText?$F.toString():$F;if($G.CharacterCache){$m._charSeg.textToSpit($a);var $R=$m._charSeg.length();for($M=0,$D=$E.length=$R;$M<$D;$M++)$g=$m._charSeg.getCharCode($M)+$r.txtID,$E[$M]=$x=$m._charsCache[$g]||$m.getChar($m._charSeg.getChar($M),$g,$r),$x.active(),$v+=$x.cw}else $E.length=0,($x=$m.getChar($a,-1,$r)).active(),$v+=$x.cw,$E[0]=$x}var $Q=0;null!==$q&&"left"!==$q&&($Q=-("center"==$q?$v/2:$v));var $P,$Y,$c=NaN,$h=0;if($J)for($M=0,$D=$E.length;$M<$D;$M++)$x=$E[$M],$j=$J[$M],$x&&$j&&!$x.isSpace&&($c=$x.borderSize,$P=$x.texture,$p._drawText($P,$d+$Q+$j.x*$S-$c,$u+$j.y*$Z-$c,$P.width,$P.height,$A,0,0,0,0));else{for($M=0,$D=$E.length;$M<$D;$M++)($x=$E[$M])&&!$x.isSpace&&($c=$x.borderSize,$P=$x.texture,$p._drawText($P,$d+$Q-$c,$u-$c,$P.width,$P.height,$A,0,0,0,0),$i&&(($Y=$i[$h++])||($Y=$i[$h-1]=[]),$Y[0]=$P,$Y[1]=$Q-$c,$Y[2]=-$c)),$Q+=$x.cw;$i&&($i.length=$h)}},$m._drawFast=function($i,$p,$F,$J,$A){for(var $t,$q,$B=0,$O=$i.length;$B<$O;$B++)($t=($q=$i[$B])[0]).active(),$p._drawText($t,$J+$q[1],$A+$q[2],$t.width,$t.height,$F,0,0,0,0)},$m.drawText=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u){if(void 0===$u&&($u=0),!($p&&0===$p.length||$F&&0===$F.length)){var $S=$J.a,$Z=$J.d;(0!==$J.b||0!==$J.c)&&($S=$Z=1);var $s=1!==$S||1!==$Z;if($s&&$g.stage.transform){var $x=$g.stage.transform;$s=$x.a===$S&&$x.d===$Z}else $s=!1;if($s){var $j=($J=$J.copyTo($ai._tmpMatrix)).tx,$r=$J.ty;$J.scale(1/$S,1/$Z),$J._checkTransform(),$U*=$S,$d*=$Z,$U+=$j-$J.tx,$d+=$r-$J.ty}else $S=$Z=1;if($F)$m._drawSlow(null,$i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$S,$Z,$u);else{if(null===$p.toUpperCase){var $M=$S+1e5*$Z,$D=$p;return void($D.changed||$D.id!==$M?($D.id=$M,$D.changed=!1,$m._drawSlow($D.save,$i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$S,$Z,$u)):$m._drawFast($D.save,$i,$J,$U,$d))}var $E=$p+$A.toString()+$q+$B+$O+$S+$Z+$t,$v=$m._textsCache[$E];$G.CharacterCache?$v?$m._drawFast($v,$i,$J,$U,$d):($m._textsCache.__length||($m._textsCache.__length=0),$m._textsCache.__length>$a.WebGLTextCacheCount&&(($m._textsCache={}).__length=0,$m._curPoolIndex=0),$m._textCachesPool[$m._curPoolIndex]?($v=$m._textsCache[$E]=$m._textCachesPool[$m._curPoolIndex]).length=0:$m._textCachesPool[$m._curPoolIndex]=$v=$m._textsCache[$E]=[],$m._textsCache.__length++,$m._curPoolIndex++,$m._drawSlow($v,$i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$S,$Z,$u)):$m._drawSlow($v,$i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$S,$Z,$u)}}},$m._charsTemp=null,$m._textCachesPool=[],$m._curPoolIndex=0,$m._charsCache={},$m._textsCache={},$m._drawValue=null,$m.d=[],$m._charSeg=null,$m.__init$=function(){$i=function(){function $O(){}return $S($O,""),$O.prototype.value=function($i,$p,$F,$J,$A,$t,$q){this.font=$i,this.fillColor=$p,this.borderColor=$F,this.lineWidth=$J,this.scaleX=$A,this.scaleY=$t,this.underLine=$q;var $B=$i.toString()+$A+$t+$J+($p?$p.toLowerCase():" ")+($F?$F.toLowerCase():" ")+$q;return this.txtID=$O._keymap[$B],this.txtID||(this.txtID=1e-7*++$O._keymapCount,$O._keymap[$B]=this.txtID),this},$O.clear=function(){$O._keymap={},$O._keymapCount=1},$O._keymap={},$O._keymapCount=1,$O}()},$m}(),$si=function(){function $A($i){this._index=0,this._size=14,this._italic=-2,$A._cache2=$A._cache2||[],this.setFont($i||"14px Arial")}$S($A,"laya.webgl.text.FontInContext");var $i=$A.prototype;return $i.setFont=function($i){var $p=$A._cache2[$i];if($p)this._words=$p[0],this._size=$p[1];else{this._words=$i.split(" ");for(var $F=0,$J=this._words.length;$F<$J;$F++)if(0<this._words[$F].indexOf("px")){this._index=$F;break}this._size=parseInt(this._words[this._index]),$A._cache2[$i]=[this._words,this._size]}this._text=null,this._italic=-2},$i.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},$i.hasType=function($i){for(var $p=0,$F=this._words.length;$p<$F;$p++)if(this._words[$p]===$i)return $p;return-1},$i.removeType=function($i){for(var $p=0,$F=this._words.length;$p<$F;$p++)if(this._words[$p]===$i){this._words.splice($p,1),this._index>$p&&this._index--;break}this._text=null,this._italic=-2},$i.copyTo=function($i){return $i._text=this._text,$i._size=this._size,$i._index=this._index,$i._words=this._words.slice(),$i._italic=-2,$i},$i.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},$J(0,$i,"size",function(){return this._size},function($i){this._size=$i,this._words[this._index]=$i+"px",this._text=null}),$A.create=function($i){var $p=$A._cache[$i];return $p||($p=$A._cache[$i]=new $A($i))},$A.EMPTY=new $A,$A._cache={},$A._cache2=null,$A}(),$xi=function(){function $i(){}return $S($i,"laya.webgl.utils.CONST3D2D"),$i.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$i.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],$i.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],$i._TMPARRAY=[],$i._OFFSETX=0,$i._OFFSETY=0,$q($i,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),$i}(),$ji=function(){function $s(){}return $S($s,"laya.webgl.utils.GlUtils"),$s.make2DProjection=function($i,$p,$F){return[2/$i,0,0,0,0,-2/$p,0,0,0,0,2/$F,0,-1,1,0,1]},$s.fillIBQuadrangle=function($i,$p){if(65535/4<$p)throw Error("IBQuadrangle count:"+$p+" must<:"+Math.floor(65535/4));$p=Math.floor($p),$i._resizeBuffer(6*($p+1)*2,!1),$i.byteLength=$i.bufferLength;for(var $F=$i.getUint16Array(),$J=0,$A=0;$A<$p;$A++)$F[$J++]=4*$A,$F[$J++]=4*$A+2,$F[$J++]=4*$A+1,$F[$J++]=4*$A,$F[$J++]=4*$A+3,$F[$J++]=4*$A+2;return $i.setNeedUpload(),!0},$s.expandIBQuadrangle=function($i,$p){$i.bufferLength>=6*$p*2||$s.fillIBQuadrangle($i,$p)},$s.mathCeilPowerOfTwo=function($i){return $i--,$i|=$i>>1,$i|=$i>>2,$i|=$i>>4,$i|=$i>>8,$i|=$i>>16,++$i},$s.fillQuadrangleImgVb=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=16+($i._byteLength>>2);$i.byteLength=$O<<2;var $U=$i.getFloat32Array();$U[($O-=16)+2]=$A[0],$U[$O+3]=$A[1],$U[$O+6]=$A[2],$U[$O+7]=$A[3],$U[$O+10]=$A[4],$U[$O+11]=$A[5],$U[$O+14]=$A[6],$U[$O+15]=$A[7];var $d=$t.a,$u=$t.b,$S=$t.c,$Z=$t.d;if(1!==$d||0!==$u||0!==$S||1!==$Z){$t.bTransform=!0;var $s=$t.tx+$q,$x=$t.ty+$B;$U[$O]=($J[0]+$p)*$d+($J[1]+$F)*$S+$s,$U[$O+1]=($J[0]+$p)*$u+($J[1]+$F)*$Z+$x,$U[$O+4]=($J[2]+$p)*$d+($J[3]+$F)*$S+$s,$U[$O+5]=($J[2]+$p)*$u+($J[3]+$F)*$Z+$x,$U[$O+8]=($J[4]+$p)*$d+($J[5]+$F)*$S+$s,$U[$O+9]=($J[4]+$p)*$u+($J[5]+$F)*$Z+$x,$U[$O+12]=($J[6]+$p)*$d+($J[7]+$F)*$S+$s,$U[$O+13]=($J[6]+$p)*$u+($J[7]+$F)*$Z+$x}else $t.bTransform=!1,$p+=$t.tx+$q,$F+=$t.ty+$B,$U[$O]=$p+$J[0],$U[$O+1]=$F+$J[1],$U[$O+4]=$p+$J[2],$U[$O+5]=$F+$J[3],$U[$O+8]=$p+$J[4],$U[$O+9]=$F+$J[5],$U[$O+12]=$p+$J[6],$U[$O+13]=$F+$J[7];return $i._upload=!0},$s.fillTranglesVB=function($i,$p,$F,$J,$A,$t,$q){var $B=($i._byteLength>>2)+$J.length;$i.byteLength=$B<<2;var $O=$i.getFloat32Array();$B-=$J.length;for(var $U=$J.length,$d=$A.a,$u=$A.b,$S=$A.c,$Z=$A.d,$s=0;$s<$U;$s+=4)if($O[$B+$s+2]=$J[$s+2],$O[$B+$s+3]=$J[$s+3],1!==$d||0!==$u||0!==$S||1!==$Z){$A.bTransform=!0;var $x=$A.tx+$t,$j=$A.ty+$q;$O[$B+$s]=($J[$s]+$p)*$d+($J[$s+1]+$F)*$S+$x,$O[$B+$s+1]=($J[$s]+$p)*$u+($J[$s+1]+$F)*$Z+$j}else $A.bTransform=!1,$p+=$A.tx+$t,$F+=$A.ty+$q,$O[$B+$s]=$p+$J[$s],$O[$B+$s+1]=$F+$J[$s+1];return $i._upload=!0},$s.copyPreImgVb=function($i,$p,$F){var $J=$i._byteLength>>2;$i.byteLength=$J+16<<2;for(var $A=$i.getFloat32Array(),$t=0,$q=$J-16;$t<4;$t++)$A[$J]=$A[$q]+$p,++$q,$A[++$J]=$A[$q]+$F,++$q,$A[++$J]=$A[$q],++$q,$A[++$J]=$A[$q],++$J,++$q;$i._upload=!0},$s.fillRectImgVb=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u,$S){void 0===$S&&($S=!1);var $Z,$s,$x,$j,$r,$M,$D,$E,$v,$g,$a,$R,$Q,$P,$Y,$c,$h=1,$m=$B.a,$n=$B.b,$I=$B.c,$G=$B.d,$_=$p&&$p.width<99999999;if(1!==$m||0!==$n||0!==$I||1!==$G?($B.bTransform=!0,0===$n&&0===$I&&($h=23,$v=$A+$F,$g=$t+$J,$Z=$m*$F+($a=$B.tx+$O),$x=$m*$v+$a,$s=$G*$J+($R=$B.ty+$U),$j=$G*$g+$R)):($h=23,$B.bTransform=!1,$x=($Z=$F+$B.tx+$O)+$A,$j=($s=$J+$B.ty+$U)+$t),$_&&($r=$p.x,$M=$p.y,$D=$p.width+$r,$E=$p.height+$M),1!==$h){if(Math.min($Z,$x)>=$D)return!1;if(Math.min($s,$j)>=$E)return!1;if(Math.max($x,$Z)<=$r)return!1;if(Math.max($j,$s)<=$M)return!1}var $y=$i._byteLength>>2;$i.byteLength=16+$y<<2;var $N=$i.getFloat32Array();switch($N[2+$y]=$q[0],$N[3+$y]=$q[1],$N[6+$y]=$q[2],$N[7+$y]=$q[3],$N[10+$y]=$q[4],$N[11+$y]=$q[5],$N[14+$y]=$q[6],$N[15+$y]=$q[7],$h){case 1:$a=$B.tx+$O,$R=$B.ty+$U;var $f=$m*$F,$o=$I*$J,$W=$G*$J,$L=$n*$F,$C=$m*($v=$A+$F),$K=$I*($g=$t+$J),$V=$G*$g,$T=$n*$v;$S?($Q=$f+$o+$a,$Y=Math.round($Q)-$Q,$P=$W+$L+$R,$c=Math.round($P)-$P,$N[$y]=$Q+$Y,$N[1+$y]=$P+$c,$N[4+$y]=$C+$o+$a+$Y,$N[5+$y]=$W+$T+$R+$c,$N[8+$y]=$C+$K+$a+$Y,$N[9+$y]=$V+$T+$R+$c,$N[12+$y]=$f+$K+$a+$Y,$N[13+$y]=$V+$L+$R+$c):($N[$y]=$f+$o+$a,$N[1+$y]=$W+$L+$R,$N[4+$y]=$C+$o+$a,$N[5+$y]=$W+$T+$R,$N[8+$y]=$C+$K+$a,$N[9+$y]=$V+$T+$R,$N[12+$y]=$f+$K+$a,$N[13+$y]=$V+$L+$R);break;case 23:$S?($Q=$Z+$d,$Y=Math.round($Q)-$Q,$P=$s,$c=Math.round($P)-$P,$N[$y]=$Q+$Y,$N[1+$y]=$P+$c,$N[4+$y]=$x+$d+$Y,$N[5+$y]=$s+$c,$N[8+$y]=$x+$Y,$N[9+$y]=$j+$c,$N[12+$y]=$Z+$Y,$N[13+$y]=$j+$c):($N[$y]=$Z+$d,$N[1+$y]=$s,$N[4+$y]=$x+$d,$N[5+$y]=$s,$N[8+$y]=$x,$N[9+$y]=$j,$N[12+$y]=$Z,$N[13+$y]=$j)}return $i._upload=!0},$s.fillLineVb=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=.5*$q,$U=$s._fillLineArray,$d=-($J-$t),$u=$F-$A,$S=Math.sqrt($d*$d+$u*$u);$d/=$S,$u/=$S,$d*=$O,$u*=$O,$U[0]=$F-$d,$U[1]=$J-$u,$U[4]=$F+$d,$U[5]=$J+$u,$U[8]=$A+$d,$U[9]=$t+$u,$U[12]=$A-$d,$U[13]=$t-$u,$B&&$B.transformPointArray($U,$U);var $Z=16+($i._byteLength>>2);return $i.byteLength=$Z<<2,$i.insertData($U,$Z-16),!0},$s._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$s}(),$ri=(function(){function $O(){}$S($O,"laya.webgl.utils.MatirxArray"),$O.ArrayMul=function($i,$p,$F){if($i)if($p)for(var $J=NaN,$A=NaN,$t=NaN,$q=NaN,$B=0;$B<4;$B++)$J=$i[$B],$A=$i[$B+4],$t=$i[$B+8],$q=$i[$B+12],$F[$B]=$J*$p[0]+$A*$p[1]+$t*$p[2]+$q*$p[3],$F[$B+4]=$J*$p[4]+$A*$p[5]+$t*$p[6]+$q*$p[7],$F[$B+8]=$J*$p[8]+$A*$p[9]+$t*$p[10]+$q*$p[11],$F[$B+12]=$J*$p[12]+$A*$p[13]+$t*$p[14]+$q*$p[15];else $O.copyArray($i,$F);else $O.copyArray($p,$F)},$O.copyArray=function($i,$p){if($i&&$p)for(var $F=0;$F<$i.length;$F++)$p[$F]=$i[$F]}}(),function(){function $p($i,$p,$F){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=$i,this._vb=new $Hi($i,35048),$p&&this._vb._resizeBuffer($p,!1),this._ib=new $li,$F&&this._ib._resizeBuffer($F,!1)}$S($p,"laya.webgl.utils.Mesh2D");var $i=$p.prototype;return $i.cloneWithNewVB=function(){var $i=new $p(this._stride,0,0);return $i._ib=this._ib,$i._quadNum=this._quadNum,$i._attribInfo=this._attribInfo,$i},$i.cloneWithNewVBIB=function(){var $i=new $p(this._stride,0,0);return $i._attribInfo=this._attribInfo,$i},$i.getVBW=function(){return this._vb.setNeedUpload(),this._vb},$i.getVBR=function(){return this._vb},$i.getIBR=function(){return this._ib},$i.getIBW=function(){return this._ib.setNeedUpload(),this._ib},$i.createQuadIB=function($i){this._quadNum=$i,this._ib._resizeBuffer(6*$i*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var $p=this._ib.getUint16Array(),$F=0,$J=0,$A=0;$A<$i;$A++)$p[$F++]=$J,$p[$F++]=$J+2,$p[$F++]=$J+1,$p[$F++]=$J,$p[$F++]=$J+3,$p[$F++]=$J+2,$J+=4;this._ib.setNeedUpload()},$i.setAttributes=function($i){if(this._attribInfo=$i,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},$i.getEleNum=function(){return this._ib.getBuffer().byteLength/2},$i.releaseMesh=function(){},$i.destroy=function(){},$i.clearVB=function(){this._vb.clear()},$p._gvaoid=0,$p}()),$Mi=function(){function $A(){}return $S($A,"laya.webgl.utils.RenderState2D"),$A.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},$A.mat2MatArray=function($i,$p){var $F=$i,$J=$p;return $J[0]=$F.a,$J[1]=$F.b,$J[2]=$A.EMPTYMAT4_ARRAY[2],$J[3]=$A.EMPTYMAT4_ARRAY[3],$J[4]=$F.c,$J[5]=$F.d,$J[6]=$A.EMPTYMAT4_ARRAY[6],$J[7]=$A.EMPTYMAT4_ARRAY[7],$J[8]=$A.EMPTYMAT4_ARRAY[8],$J[9]=$A.EMPTYMAT4_ARRAY[9],$J[10]=$A.EMPTYMAT4_ARRAY[10],$J[11]=$A.EMPTYMAT4_ARRAY[11],$J[12]=$F.tx,$J[13]=$F.ty,$J[14]=$A.EMPTYMAT4_ARRAY[14],$J[15]=$A.EMPTYMAT4_ARRAY[15],$p},$A.restoreTempArray=function(){$A.TEMPMAT4_ARRAY[0]=1,$A.TEMPMAT4_ARRAY[1]=0,$A.TEMPMAT4_ARRAY[4]=0,$A.TEMPMAT4_ARRAY[5]=1,$A.TEMPMAT4_ARRAY[12]=0,$A.TEMPMAT4_ARRAY[13]=0},$A.clear=function(){$A.worldScissorTest=!1,$A.worldShaderDefines=null,$A.worldFilters=null,$A.worldAlpha=1,$A.worldClipRect.x=$A.worldClipRect.y=0,$A.worldClipRect.width=$A.width,$A.worldClipRect.height=$A.height,$A.curRenderTarget=null},$A._MAXSIZE=99999999,$A.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$A.worldMatrix4=$A.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$A.worldAlpha=1,$A.worldScissorTest=!1,$A.worldFilters=null,$A.worldShaderDefines=null,$A.curRenderTarget=null,$A.width=0,$A.height=0,$q($A,["worldMatrix",function(){return this.worldMatrix=new $Q},"worldClipRect",function(){return this.worldClipRect=new $Y(0,0,99999999,99999999)}]),$A}(),$Di=function(){var $M,$F;function $D($i,$p,$F,$J,$A){var $t=this;function $q($i){var $p=[],$F=new $M($p);return $t._compileToTree($F,$i.split("\n"),0,$p,$A),$F}var $B=$Z.now();this._VS=$q($p),this._PS=$q($F),this._nameMap=$J,2<$Z.now()-$B&&console.log("ShaderCompile use time:"+($Z.now()-$B)+"  size:"+$p.length+"/"+$F.length)}$S($D,"laya.webgl.utils.ShaderCompile");var $i=$D.prototype;return $i._compileToTree=function($i,$p,$F,$J,$A){var $t,$q,$B,$O,$U,$d,$u,$S=0,$Z=0,$s=0,$x=0;for($Z=$F;$Z<$p.length;$Z++)if(!(($B=$p[$Z]).length<1)&&0!==($S=$B.indexOf("//"))){if(0<=$S&&($B=$B.substr(0,$S)),$t=$u||new $M($J),$u=null,$t.text=$B,$t.noCompile=!0,0<=($S=$B.indexOf("#"))){for($O="#",$x=$S+1,$s=$B.length;$x<$s;$x++){var $j=$B.charAt($x);if(" "===$j||"\t"===$j||"\r"===$j||"\n"===$j||"?"===$j)break;$O+=$j}switch($t.name=$O){case"#ifdef":case"#ifndef":if($t.src=$B,$t.noCompile=null!=$B.match(/[!&|()=<>]/),$t.noCompile?console.log("function():Boolean{return "+$B.substr($S+$t.name.length)+"}"):($d=$B.replace(/^\s*/,"").split(/\s+/),$t.setCondition($d[1],"#ifdef"===$O?1:2),$t.text="//"+$t.text),$t.setParent($i),$i=$t,$A)for($d=$B.substr($x).split($D._splitToWordExps3),$x=0;$x<$d.length;$x++)($B=$d[$x]).length&&($A[$B]=!0);continue;case"#if":if($t.src=$B,$t.noCompile=!0,$t.setParent($i),$i=$t,$A)for($d=$B.substr($x).split($D._splitToWordExps3),$x=0;$x<$d.length;$x++)($B=$d[$x]).length&&"defined"!=$B&&($A[$B]=!0);continue;case"#else":$t.src=$B,$q=($i=$i.parent).childs[$i.childs.length-1],$t.noCompile=$q.noCompile,$t.noCompile||($t.condition=$q.condition,$t.conditionType=1==$q.conditionType?2:1,$t.text="//"+$t.text+" "+$q.text+" "+$t.conditionType),$t.setParent($i),$i=$t;continue;case"#endif":$q=($i=$i.parent).childs[$i.childs.length-1],$t.noCompile=$q.noCompile,$t.noCompile||($t.text="//"+$t.text),$t.setParent($i);continue;case"#include":$d=$D.splitToWords($B,null);var $r=$D.includes[$d[1]];if(!$r)throw"ShaderCompile error no this include file:"+$d[1];if(($S=$d[0].indexOf("?"))<0){$t.setParent($i),$B=$r.getWith("with"==$d[2]?$d[3]:null),this._compileToTree($t,$B.split("\n"),0,$J,$A),$t.text="";continue}$t.setCondition($d[0].substr($S+1),1),$t.text=$r.getWith("with"==$d[2]?$d[3]:null);break;case"#import":$U=($d=$D.splitToWords($B,null))[1],$J.push({node:$t,file:$D.includes[$U],ofs:$t.text.length});continue}}else{if(($q=$i.childs[$i.childs.length-1])&&!$q.name){0<$J.length&&$D.splitToWords($B,$q),$u=$t,$q.text+="\n"+$B;continue}0<$J.length&&$D.splitToWords($B,$t)}$t.setParent($i)}},$i.createShader=function($i,$p,$F){var $J={},$A="";if($i)for(var $t in $i)$A+="#define "+$t+"\n",$J[$t]=!0;var $q=this._VS.toscript($J,[]),$B=this._PS.toscript($J,[]);return($F||$Xi.create)($A+$q.join("\n"),$A+$B.join("\n"),$p,this._nameMap)},$D._parseOne=function($i,$p,$F,$J,$A,$t){var $q={type:$D.shaderParamsMap[$F[$J+1]],name:$F[$J+2],size:isNaN(parseInt($F[$J+3]))?1:parseInt($F[$J+3])};return $t&&("attribute"==$A?$i.push($q):$p.push($q)),":"==$F[$J+3]&&($q.type=$F[$J+4],$J+=2),$J+=2},$D.addInclude=function($i,$p){if(!$p||0===$p.length)throw new Error("add shader include file err:"+$i);if($D.includes[$i])throw new Error("add shader include file err, has add:"+$i);$D.includes[$i]=new $F($p)},$D.preGetParams=function($i,$p){var $F=[$i,$p],$J={},$A=[],$t=[],$q={},$B=[];$J.attributes=$A,$J.uniforms=$t,$J.defines=$q;for(var $O=0,$U=0,$d=0;$d<2;$d++){$F[$d]=$F[$d].replace($D._removeAnnotation,"");var $u,$S=$F[$d].match($D._reg);for($O=0,$U=$S.length;$O<$U;$O++){var $Z=$S[$O];if("attribute"==$Z||"uniform"==$Z)$O=$D._parseOne($A,$t,$S,$O,$Z,!0);else{if("#define"==$Z){$B[$Z=$S[++$O]]=1;continue}if("#ifdef"==$Z){$q[$u=$S[++$O]]=$q[$u]||[];for($O++;$O<$U;$O++)if("attribute"==($Z=$S[$O])||"uniform"==$Z)$O=$D._parseOne($A,$t,$S,$O,$Z,$B[$u]);else if("#else"==$Z)for($O++;$O<$U;$O++)if("attribute"==($Z=$S[$O])||"uniform"==$Z)$O=$D._parseOne($A,$t,$S,$O,$Z,!$B[$u]);else if("#endif"==$Z)break}}}}return $J},$D.splitToWords=function($i,$p){for(var $F,$J,$A=[],$t=-1,$q=0,$B=$i.length;$q<$B;$q++)if($F=$i.charAt($q),0<=" \t=+-*/&%!<>()'\",;".indexOf($F)){if(0<=$t&&1<$q-$t&&($J=$i.substr($t,$q-$t),$A.push($J)),'"'==$F||"'"==$F){var $O=$i.indexOf($F,$q+1);if($O<0)throw"Sharder err:"+$i;$A.push($i.substr($q+1,$O-$q-1)),$q=$O,$t=-1;continue}"("==$F&&$p&&0<$A.length&&($J=$A[$A.length-1]+";","vec4;main;".indexOf($J)<0&&($p.useFuns+=$J)),$t=-1}else $t<0&&($t=$q);return $t<$B&&1<$B-$t&&($J=$i.substr($t,$B-$t),$A.push($J)),$A},$D.IFDEF_NO=0,$D.IFDEF_YES=1,$D.IFDEF_ELSE=2,$D.IFDEF_PARENT=3,$D._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),$D._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),$D._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),$D.includes={},$q($D,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),$D.__init$=function(){$M=function(){function $F($i){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=$i}$S($F,"");var $i=$F.prototype;return $i.setParent=function($i){$i.childs.push(this),this.z=$i.z+1,this.parent=$i},$i.setCondition=function($i,$p){$i&&(this.conditionType=$p,$i=$i.replace(/(\s*$)/g,""),this.condition=function(){return this[$i]},this.condition.__condition=$i)},$i.toscript=function($i,$p){return this._toscript($i,$p,++$F.__id)},$i._toscript=function($J,$A,$t){if(this.childs.length<1&&!this.text)return $A;$A.length;if(this.condition){var $i=!!this.condition.call($J);if(2===this.conditionType&&($i=!$i),!$i)return $A}if(this.text&&$A.push(this.text),0<this.childs.length&&this.childs.forEach(function($i,$p,$F){$i._toscript($J,$A,$t)}),0<this.includefiles.length&&0<this.useFuns.length)for(var $p,$F=0,$q=this.includefiles.length;$F<$q;$F++)this.includefiles[$F].curUseID!=$t&&0<($p=this.includefiles[$F].file.getFunsScript(this.useFuns)).length&&(this.includefiles[$F].curUseID=$t,$A[0]=$p+$A[0]);return $A},$F.__id=1,$F}(),$F=function(){function $i($i){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=$i;for(var $p=0,$F=0,$J=0;!(($p=$i.indexOf("#begin",$p))<0);){for($J=$p+5;!(($J=$i.indexOf("#end",$J))<0)&&"i"===$i.charAt($J+4);)$J+=5;if($J<0)throw"add include err,no #end:"+$i;$F=$i.indexOf("\n",$p);var $A=$D.splitToWords($i.substr($p,$F-$p),null);"code"==$A[1]?this.codes[$A[2]]=$i.substr($F+1,$J-$F-1):"function"==$A[1]&&($F=$i.indexOf("function",$p),$F+="function".length,this.funs[$A[3]]=$i.substr($F+1,$J-$F-1),this.funnames+=$A[3]+";"),$p=$J+1}}$S($i,"");var $p=$i.prototype;return $p.getWith=function($i){var $p=$i?this.codes[$i]:this.script;if(!$p)throw"get with error:"+$i;return $p},$p.getFunsScript=function($i){var $p="";for(var $F in this.funs)0<=$i.indexOf($F+";")&&($p+=this.funs[$F]);return $p},$i}()},$D}(),$Ei=function(){function $q(){}return $S($q,"laya.webgl.WebGL"),$q._uint8ArraySlice=function(){for(var $i=this.length,$p=new Uint8Array(this.length),$F=0;$F<$i;$F++)$p[$F]=this[$F];return $p},$q._float32ArraySlice=function(){for(var $i=this.length,$p=new Float32Array(this.length),$F=0;$F<$i;$F++)$p[$F]=this[$F];return $p},$q._uint16ArraySlice=function($i){var $p,$F=arguments,$J=0,$A=0;if(0===$F.length)for($J=this.length,$p=new Uint16Array($J),$A=0;$A<$J;$A++)$p[$A]=this[$A];else if(2===$F.length){var $t=$F[0],$q=$F[1];if($t<$q)for($J=$q-$t,$p=new Uint16Array($J),$A=$t;$A<$q;$A++)$p[$A-$t]=this[$A];else $p=new Uint16Array(0)}return $p},$q.expandContext=function(){var $i=$A.prototype,$p=CanvasRenderingContext2D.prototype;$p.fillTrangles=$i.fillTrangles,$ei.__int__(null),$p.setIBVB=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){void 0===$O&&($O=0),void 0===$U&&($U=0),null===$F&&(this._ib=this._ib||$li.QuadrangleIB,$F=this._ib,$ji.expandIBQuadrangle($F,$J._byteLength/64+8)),this._setIBVB($i,$p,$F,$J,$A,$t,$q,$B,$O,$U)},$p.fillTrangles=function($i,$p,$F,$J,$A){this._curMat=this._curMat||$Q.create(),this._vb=this._vb||$Hi.create(),this._ib||(this._ib=$li.create(),$ji.fillIBQuadrangle(this._ib,$q/4));var $t=this._vb,$q=$J.length>>4;$ji.fillTranglesVB($t,$p,$F,$J,$A||this._curMat,0,0),$ji.expandIBQuadrangle(this._ib,$t._byteLength/64+8);var $B=new $Ri(1,0);$B.textureHost=$i;var $O=new $zi("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");$t._vertType=3,this._setIBVB($p,$F,this._ib,$t,6*$q,$A,$O,$B,0,0)}},$q.enable=function(){if($Z.__init__(),$r.isConchApp&&!$r.isConchWebGL)return $v.skinAniSprite=function(){return new $ii},$q.expandContext(),!1;if($v.getWebGLContext=function($i){for(var $p,$F=["webgl","experimental-webgl","webkit-3d","moz-webgl"],$J=0;$J<$F.length;$J++){try{$p=$i.getContext($F[$J],{stencil:$a.isStencil,alpha:$a.isAlpha,antialias:$a.isAntialias,premultipliedAlpha:$a.premultipliedAlpha,preserveDrawingBuffer:$a.preserveDrawingBuffer})}catch($i){}if($p)return $p}return null},null==($q.mainContext=$q.mainContext||$v.getWebGLContext($r._mainCanvas)))return!1;if($r.isWebGL)return!0;$x.create=function($i,$p){return new $ip($i,$p)},$j.create=function($i,$p,$F,$J,$A,$t,$q){return new $$i($i,$p,$F,$J,$A,$t,$q)},$r.WebGL=$q,$r.isWebGL=!0,$Zi.__init__(),$v.createRenderSprite=function($i,$p){return new $Qi($i,$p)},$v.createWebGLContext2D=function($i){return new $ai($i)},$v.changeWebGLSize=function($i,$p){laya.webgl.WebGL.onStageResize($i,$p)},$v.createGraphics=function(){return new $gi};var $i=$v.createFilterAction;return $v.createFilterAction=$i||function($i){return new $Pi},$v.clear=function($i){$Mi.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var $p=$r.context.ctx,$F=0==$p._submits._length||$a.preserveDrawingBuffer?$s.create($i)._color:$h._wgColor;$F&&$p.clearBG($F[0],$F[1],$F[2],$F[3]),$Mi.clear()},$v.addToAtlas=function($i,$p){void 0===$p&&($p=!1);var $F=$i.bitmap;$r.optimizeTextureMemory($i.url,$i)?$g.__typeof($F,"laya.webgl.resource.IMergeAtlasBitmap")&&$F.allowMerageInAtlas&&$F.on("recovered",$i,$i.addTextureToAtlas):$F.enableMerageInAtlas=!1},$v.isAtlas=function($i){return $i instanceof laya.webgl.atlas.AtlasWebGLCanvas},$L._enable(),$v.beginFlush=function(){for(var $i=$L.instance,$p=$i.getAtlaserCount(),$F=0;$F<$p;$F++){var $J=$i.getAtlaserByIndex($F).texture;$J._flashCacheImageNeedFlush&&$v.flashFlushImage($J)}},$v.drawToCanvas=function($i,$p,$F,$J,$A,$t){($F<=0||$J<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),$F|=0,$J|=0,$A|=0,$t|=0;var $q=$Ni.create($F,$J,6408,5121,0,!1);$q.start(),$q.clear(0,0,0,0),$r.context.clear(),$M.renders[$p]._fun($i,$r.context,$A,$Mi.height-$J+$t),$r.context.flush(),$q.end();var $B=$q.getData(0,0,$F,$J);if($q.recycle(),$B.byteLength==$F*$J*4){var $O=new $Ti;$O._canvas=$Z.createElement("canvas"),$O.size($F,$J);var $U=$O._canvas.getContext("2d");$Z.canvas.size($F,$J);var $d=$Z.context,$u=$d.createImageData($F,$J);return $u.data.set(new Uint8ClampedArray($B.buffer)),$O._imgData=$u,$d.putImageData($u,0,0),$U.save(),$U.translate(0,$J),$U.scale(1,-1),$U.drawImage($Z.canvas.source,0,0),$U.restore(),$O}console.log("drawToCanvas error: w:"+$F+",h:"+$J+",datalen:"+$B.byteLength)},$v.createFilterAction=function($i){var $p;switch($i){case 32:$p=new $Pi}return $p},$v.addTextureToAtlas=function($i){$i._uvID++,$L._atlasRestore++,$i.bitmap.enableMerageInAtlas&&$L.instance.addToAtlas($i)},$v.getTexturePixels=function($i,$p,$F,$J,$A){$r.context.ctx.clear();var $t=new $c;$t.graphics.drawTexture($i,-$p,-$F);var $q=$Ni.create($J,$A);$q.start(),$q.clear(0,0,0,0),$t.render($r.context,0,0),$r.context.ctx.flush(),$q.end();for(var $B=$q.getData(0,0,$J,$A),$O=[],$U=0,$d=$A-1;0<=$d;$d--)for(var $u=0;$u<$J;$u++)$U=4*($d*$J+$u),$O.push($B[$U]),$O.push($B[$U+1]),$O.push($B[$U+2]),$O.push($B[$U+3]);return $O},$v.skinAniSprite=function(){return new $ii},$U.create=function($i,$p){var $F=new $Ti;return $F._imgData=$p,$F.flipY=!1,$F},$R._filterStart=function($i,$p,$F,$J,$A){var $t=$i.getValue("bounds"),$q=$Ni.create($t.width,$t.height);if($q.start(),$q.clear(0,0,0,0),$i.addValue("src",$q),$i.addValue("ScissorTest",$Mi.worldScissorTest),$Mi.worldScissorTest){var $B=new $Y;$B.copyFrom($F.ctx._clipRect),$i.addValue("clipRect",$B),$Mi.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},$R._filterEnd=function($i,$p,$F,$J,$A){var $t=$i.getValue("bounds");$i.getValue("src").end();var $q=$Ni.create($t.width,$t.height);$q.start(),$q.clear(0,0,0,0),$i.addValue("out",$q),$p._set$P("_filterCache",$q),$p._set$P("_isHaveGlowFilter",$i.getValue("_isHaveGlowFilter"))},$R._EndTarget=function($i,$p){if($i.getValue("src").recycle(),$i.getValue("out").end(),$i.getValue("ScissorTest")){$Mi.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),$p.ctx.save();var $F=$i.getValue("clipRect");$p.ctx.clipRect($F.x,$F.y,$F.width,$F.height)}},$R._useSrc=function($i){var $p=$i.getValue("out");$p.end(),($p=$i.getValue("src")).start(),$p.clear(0,0,0,0)},$R._endSrc=function($i){$i.getValue("src").end()},$R._useOut=function($i){var $p=$i.getValue("src");$p.end(),($p=$i.getValue("out")).start(),$p.clear(0,0,0,0)},$R._endOut=function($i){$i.getValue("out").end()},$R._recycleScope=function($i){$i.recycle()},$R._filter=function($i,$p,$F,$J){var $A=this._next;if($A){var $t,$q,$B=$i.filters,$O=$B.length;if(1==$O&&32==$B[0].type)return $p.ctx.save(),$p.ctx.setFilters([$B[0]]),$A._fun.call($A,$i,$p,$F,$J),void $p.ctx.restore();var $U=$Bi.create(),$d=$P.TEMP,$u=$p.ctx._getTransformMatrix(),$S=$Q.create();$u.copyTo($S);var $Z=0,$s=0,$x=!1,$j=$i._$P._filterCache?$i._$P._filterCache:null;if(!$j||$i._repaint){$x=$i._isHaveGlowFilter(),$U.addValue("_isHaveGlowFilter",$x),$x&&($Z=50,$s=25),($q=new $Y).copyFrom($i.getSelfBounds()),$q.x+=$i.x,$q.y+=$i.y,$q.x-=$i.pivotX+4,$q.y-=$i.pivotY+4;var $r=$q.x,$M=$q.y;if($q.width+=$Z+8,$q.height+=$Z+8,$d.x=$q.x*$S.a+$q.y*$S.c,$d.y=$q.y*$S.d+$q.x*$S.b,$q.x=$d.x,$q.y=$d.y,$d.x=$q.width*$S.a+$q.height*$S.c,$d.y=$q.height*$S.d+$q.width*$S.b,$q.width=$d.x,$q.height=$d.y,$q.width<=0||$q.height<=0)return;$j&&$j.recycle(),$U.addValue("bounds",$q);var $D=$qi.create([$U,$i,$p,0,0],$R._filterStart);$p.addRenderObject($D),$p.ctx._renderKey=0,$p.ctx._shader2D.glTexture=null;var $E=$i.x-$r+$s,$v=$i.y-$M+$s;$A._fun.call($A,$i,$p,$E,$v),$D=$qi.create([$U,$i,$p,0,0],$R._filterEnd),$p.addRenderObject($D);for(var $g=0;$g<$O;$g++){0!=$g&&($D=$qi.create([$U],$R._useSrc),$p.addRenderObject($D),$t=$Ri.create(1,0),$Q.TEMP.identity(),$p.ctx.drawTarget($U,0,0,$q.width,$q.height,$Q.TEMP,"out",$t,null,$K.TOINT.overlay),$D=$qi.create([$U],$R._useOut),$p.addRenderObject($D)),$B[$g].action.apply3d($U,$i,$p,0,0)}$D=$qi.create([$U,$p],$R._EndTarget),$p.addRenderObject($D)}else{if(($x=!!$i._$P._isHaveGlowFilter&&$i._$P._isHaveGlowFilter)&&($Z=50,$s=25),($q=$i.getBounds()).width<=0||$q.height<=0)return;$q.width+=$Z,$q.height+=$Z,$d.x=$q.x*$S.a+$q.y*$S.c,$d.y=$q.y*$S.d+$q.x*$S.b,$q.x=$d.x,$q.y=$d.y,$d.x=$q.width*$S.a+$q.height*$S.c,$d.y=$q.height*$S.d+$q.width*$S.b,$q.width=$d.x,$q.height=$d.y,$U.addValue("out",$j)}$F=$F-$s-$i.x,$J=$J-$s-$i.y,$d.setTo($F,$J),$S.transformPoint($d),$F=$d.x+$q.x,$J=$d.y+$q.y,$t=$Ri.create(1,0),$Q.TEMP.identity(),$p.ctx.drawTarget($U,$F,$J,$q.width,$q.height,$Q.TEMP,"out",$t,null,$K.TOINT.overlay),$D=$qi.create([$U],$R._recycleScope),$p.addRenderObject($D),$S.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=$q._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=$q._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=$q._uint8ArraySlice),!0},$q.onStageResize=function($i,$p){null!=$q.mainContext&&($q.mainContext.viewport(0,0,$i,$p),$Mi.width=$i,$Mi.height=$p)},$q.onInvalidGLRes=function(){$L.instance.freeAll(),$E.releaseContentManagers(!0),$q.doNodeRepaint($g.stage),$q.mainContext.viewport(0,0,$Mi.width,$Mi.height),$g.stage.event("devicelost")},$q.doNodeRepaint=function($i){0==$i.numChildren&&$i.repaint();for(var $p=0;$p<$i.numChildren;$p++)$q.doNodeRepaint($i.getChildAt($p))},$q.init=function($i,$p,$F){$q.mainCanvas=$i,$U._createContext=function($i){return new $ai($i)},$Ti._createContext=function($i){return new $ai($i)};var $J=laya.webgl.WebGL.mainContext;if(null!=$J.getShaderPrecisionFormat){var $A=$J.getShaderPrecisionFormat(35633,36338),$t=$J.getShaderPrecisionFormat(35632,36338);$q.shaderHighPrecision=!(!$A.precision||!$t.precision)}else $q.shaderHighPrecision=!1;if($q.compressAstc=$J.getExtension("WEBGL_compressed_texture_astc"),$q.compressAtc=$J.getExtension("WEBGL_compressed_texture_atc"),$q.compressEtc=$J.getExtension("WEBGL_compressed_texture_etc"),$q.compressEtc1=$J.getExtension("WEBGL_compressed_texture_etc1"),$q.compressPvrtc=$J.getExtension("WEBGL_compressed_texture_pvrtc"),$q.compressS3tc=$J.getExtension("WEBGL_compressed_texture_s3tc"),$q.compressS3tc_srgb=$J.getExtension("WEBGL_compressed_texture_s3tc_srgb"),$q.compressAstc=$q.compressAstc?$q.compressAstc:{},$q.compressAtc=$q.compressAtc?$q.compressAtc:{},$q.compressEtc=$q.compressEtc?$q.compressEtc:{},$q.compressEtc1=$q.compressEtc1?$q.compressEtc1:{},$q.compressPvrtc=$q.compressPvrtc?$q.compressPvrtc:{},$q.compressS3tc=$q.compressS3tc?$q.compressS3tc:{},$q.compressS3tc_srgb=$q.compressS3tc_srgb?$q.compressS3tc_srgb:{},$J.deleteTexture1=$J.deleteTexture,$J.deleteTexture=function($i){$i==$vi.curBindTexValue&&($vi.curBindTexValue=null),$J.deleteTexture1($i)},$q.onStageResize($p,$F),null==$q.mainContext)throw new Error("webGL getContext err!");$I.__init__(),$L.__init__(),$ci.__init__(),$ti.__init__(),$ai.__init__(),$Ri.__init__(),$l.__init__(),$ei.__int__($J),$K._init_($J),$r.isConchApp&&conch.setOnInvalidGLRes($q.onInvalidGLRes)},$q.mainCanvas=null,$q.antialias=!0,$q.shaderHighPrecision=!1,$q._bg_null=[0,0,0,0],$q}(),$vi=function(){function $J(){}return $S($J,"laya.webgl.WebGLContext"),$J.UseProgram=function($i){return $J._useProgram!==$i&&($Ei.mainContext.useProgram($i),$J._useProgram=$i,!0)},$J.setDepthTest=function($i,$p){$p!==$J._depthTest&&(($J._depthTest=$p)?$i.enable(2929):$i.disable(2929))},$J.setDepthMask=function($i,$p){$p!==$J._depthMask&&($J._depthMask=$p,$i.depthMask($p))},$J.setDepthFunc=function($i,$p){$p!==$J._depthFunc&&($J._depthFunc=$p,$i.depthFunc($p))},$J.setBlend=function($i,$p){$p!==$J._blend&&(($J._blend=$p)?$i.enable(3042):$i.disable(3042))},$J.setBlendFunc=function($i,$p,$F){($p!==$J._sFactor||$F!==$J._dFactor)&&($J._sFactor=$p,$J._dFactor=$F,$i.blendFunc($p,$F))},$J.setCullFace=function($i,$p){$p!==$J._cullFace&&(($J._cullFace=$p)?$i.enable(2884):$i.disable(2884))},$J.setFrontFace=function($i,$p){$p!==$J._frontFace&&($J._frontFace=$p,$i.frontFace($p))},$J.bindTexture=function($i,$p,$F){$i.bindTexture($p,$F),$J.curBindTexTarget=$p,$J.curBindTexValue=$F},$J.DEPTH_BUFFER_BIT=256,$J.STENCIL_BUFFER_BIT=1024,$J.COLOR_BUFFER_BIT=16384,$J.POINTS=0,$J.LINES=1,$J.LINE_LOOP=2,$J.LINE_STRIP=3,$J.TRIANGLES=4,$J.TRIANGLE_STRIP=5,$J.TRIANGLE_FAN=6,$J.ZERO=0,$J.ONE=1,$J.SRC_COLOR=768,$J.ONE_MINUS_SRC_COLOR=769,$J.SRC_ALPHA=770,$J.ONE_MINUS_SRC_ALPHA=771,$J.DST_ALPHA=772,$J.ONE_MINUS_DST_ALPHA=773,$J.DST_COLOR=774,$J.ONE_MINUS_DST_COLOR=775,$J.SRC_ALPHA_SATURATE=776,$J.FUNC_ADD=32774,$J.BLEND_EQUATION=32777,$J.BLEND_EQUATION_RGB=32777,$J.BLEND_EQUATION_ALPHA=34877,$J.FUNC_SUBTRACT=32778,$J.FUNC_REVERSE_SUBTRACT=32779,$J.BLEND_DST_RGB=32968,$J.BLEND_SRC_RGB=32969,$J.BLEND_DST_ALPHA=32970,$J.BLEND_SRC_ALPHA=32971,$J.CONSTANT_COLOR=32769,$J.ONE_MINUS_CONSTANT_COLOR=32770,$J.CONSTANT_ALPHA=32771,$J.ONE_MINUS_CONSTANT_ALPHA=32772,$J.BLEND_COLOR=32773,$J.ARRAY_BUFFER=34962,$J.ELEMENT_ARRAY_BUFFER=34963,$J.ARRAY_BUFFER_BINDING=34964,$J.ELEMENT_ARRAY_BUFFER_BINDING=34965,$J.STREAM_DRAW=35040,$J.STATIC_DRAW=35044,$J.DYNAMIC_DRAW=35048,$J.BUFFER_SIZE=34660,$J.BUFFER_USAGE=34661,$J.CURRENT_VERTEX_ATTRIB=34342,$J.FRONT=1028,$J.BACK=1029,$J.CULL_FACE=2884,$J.FRONT_AND_BACK=1032,$J.BLEND=3042,$J.DITHER=3024,$J.STENCIL_TEST=2960,$J.DEPTH_TEST=2929,$J.SCISSOR_TEST=3089,$J.POLYGON_OFFSET_FILL=32823,$J.SAMPLE_ALPHA_TO_COVERAGE=32926,$J.SAMPLE_COVERAGE=32928,$J.NO_ERROR=0,$J.INVALID_ENUM=1280,$J.INVALID_VALUE=1281,$J.INVALID_OPERATION=1282,$J.OUT_OF_MEMORY=1285,$J.CW=2304,$J.CCW=2305,$J.LINE_WIDTH=2849,$J.ALIASED_POINT_SIZE_RANGE=33901,$J.ALIASED_LINE_WIDTH_RANGE=33902,$J.CULL_FACE_MODE=2885,$J.FRONT_FACE=2886,$J.DEPTH_RANGE=2928,$J.DEPTH_WRITEMASK=2930,$J.DEPTH_CLEAR_VALUE=2931,$J.DEPTH_FUNC=2932,$J.STENCIL_CLEAR_VALUE=2961,$J.STENCIL_FUNC=2962,$J.STENCIL_FAIL=2964,$J.STENCIL_PASS_DEPTH_FAIL=2965,$J.STENCIL_PASS_DEPTH_PASS=2966,$J.STENCIL_REF=2967,$J.STENCIL_VALUE_MASK=2963,$J.STENCIL_WRITEMASK=2968,$J.STENCIL_BACK_FUNC=34816,$J.STENCIL_BACK_FAIL=34817,$J.STENCIL_BACK_PASS_DEPTH_FAIL=34818,$J.STENCIL_BACK_PASS_DEPTH_PASS=34819,$J.STENCIL_BACK_REF=36003,$J.STENCIL_BACK_VALUE_MASK=36004,$J.STENCIL_BACK_WRITEMASK=36005,$J.VIEWPORT=2978,$J.SCISSOR_BOX=3088,$J.COLOR_CLEAR_VALUE=3106,$J.COLOR_WRITEMASK=3107,$J.UNPACK_ALIGNMENT=3317,$J.PACK_ALIGNMENT=3333,$J.MAX_TEXTURE_SIZE=3379,$J.MAX_VIEWPORT_DIMS=3386,$J.SUBPIXEL_BITS=3408,$J.RED_BITS=3410,$J.GREEN_BITS=3411,$J.BLUE_BITS=3412,$J.ALPHA_BITS=3413,$J.DEPTH_BITS=3414,$J.STENCIL_BITS=3415,$J.POLYGON_OFFSET_UNITS=10752,$J.POLYGON_OFFSET_FACTOR=32824,$J.TEXTURE_BINDING_2D=32873,$J.SAMPLE_BUFFERS=32936,$J.SAMPLES=32937,$J.SAMPLE_COVERAGE_VALUE=32938,$J.SAMPLE_COVERAGE_INVERT=32939,$J.NUM_COMPRESSED_TEXTURE_FORMATS=34466,$J.COMPRESSED_TEXTURE_FORMATS=34467,$J.DONT_CARE=4352,$J.FASTEST=4353,$J.NICEST=4354,$J.GENERATE_MIPMAP_HINT=33170,$J.BYTE=5120,$J.UNSIGNED_BYTE=5121,$J.SHORT=5122,$J.UNSIGNED_SHORT=5123,$J.INT=5124,$J.UNSIGNED_INT=5125,$J.FLOAT=5126,$J.DEPTH_COMPONENT=6402,$J.ALPHA=6406,$J.RGB=6407,$J.RGBA=6408,$J.LUMINANCE=6409,$J.LUMINANCE_ALPHA=6410,$J.UNSIGNED_SHORT_4_4_4_4=32819,$J.UNSIGNED_SHORT_5_5_5_1=32820,$J.UNSIGNED_SHORT_5_6_5=33635,$J.FRAGMENT_SHADER=35632,$J.VERTEX_SHADER=35633,$J.MAX_VERTEX_ATTRIBS=34921,$J.MAX_VERTEX_UNIFORM_VECTORS=36347,$J.MAX_VARYING_VECTORS=36348,$J.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,$J.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,$J.MAX_TEXTURE_IMAGE_UNITS=34930,$J.MAX_FRAGMENT_UNIFORM_VECTORS=36349,$J.SHADER_TYPE=35663,$J.DELETE_STATUS=35712,$J.LINK_STATUS=35714,$J.VALIDATE_STATUS=35715,$J.ATTACHED_SHADERS=35717,$J.ACTIVE_UNIFORMS=35718,$J.ACTIVE_ATTRIBUTES=35721,$J.SHADING_LANGUAGE_VERSION=35724,$J.CURRENT_PROGRAM=35725,$J.NEVER=512,$J.LESS=513,$J.EQUAL=514,$J.LEQUAL=515,$J.GREATER=516,$J.NOTEQUAL=517,$J.GEQUAL=518,$J.ALWAYS=519,$J.KEEP=7680,$J.REPLACE=7681,$J.INCR=7682,$J.DECR=7683,$J.INVERT=5386,$J.INCR_WRAP=34055,$J.DECR_WRAP=34056,$J.VENDOR=7936,$J.RENDERER=7937,$J.VERSION=7938,$J.NEAREST=9728,$J.LINEAR=9729,$J.NEAREST_MIPMAP_NEAREST=9984,$J.LINEAR_MIPMAP_NEAREST=9985,$J.NEAREST_MIPMAP_LINEAR=9986,$J.LINEAR_MIPMAP_LINEAR=9987,$J.TEXTURE_MAG_FILTER=10240,$J.TEXTURE_MIN_FILTER=10241,$J.TEXTURE_WRAP_S=10242,$J.TEXTURE_WRAP_T=10243,$J.TEXTURE_2D=3553,$J.TEXTURE=5890,$J.TEXTURE_CUBE_MAP=34067,$J.TEXTURE_BINDING_CUBE_MAP=34068,$J.TEXTURE_CUBE_MAP_POSITIVE_X=34069,$J.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,$J.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,$J.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,$J.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,$J.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,$J.MAX_CUBE_MAP_TEXTURE_SIZE=34076,$J.TEXTURE0=33984,$J.TEXTURE1=33985,$J.TEXTURE2=33986,$J.TEXTURE3=33987,$J.TEXTURE4=33988,$J.TEXTURE5=33989,$J.TEXTURE6=33990,$J.TEXTURE7=33991,$J.TEXTURE8=33992,$J.TEXTURE9=33993,$J.TEXTURE10=33994,$J.TEXTURE11=33995,$J.TEXTURE12=33996,$J.TEXTURE13=33997,$J.TEXTURE14=33998,$J.TEXTURE15=33999,$J.TEXTURE16=34e3,$J.TEXTURE17=34001,$J.TEXTURE18=34002,$J.TEXTURE19=34003,$J.TEXTURE20=34004,$J.TEXTURE21=34005,$J.TEXTURE22=34006,$J.TEXTURE23=34007,$J.TEXTURE24=34008,$J.TEXTURE25=34009,$J.TEXTURE26=34010,$J.TEXTURE27=34011,$J.TEXTURE28=34012,$J.TEXTURE29=34013,$J.TEXTURE30=34014,$J.TEXTURE31=34015,$J.ACTIVE_TEXTURE=34016,$J.REPEAT=10497,$J.CLAMP_TO_EDGE=33071,$J.MIRRORED_REPEAT=33648,$J.FLOAT_VEC2=35664,$J.FLOAT_VEC3=35665,$J.FLOAT_VEC4=35666,$J.INT_VEC2=35667,$J.INT_VEC3=35668,$J.INT_VEC4=35669,$J.BOOL=35670,$J.BOOL_VEC2=35671,$J.BOOL_VEC3=35672,$J.BOOL_VEC4=35673,$J.FLOAT_MAT2=35674,$J.FLOAT_MAT3=35675,$J.FLOAT_MAT4=35676,$J.SAMPLER_2D=35678,$J.SAMPLER_CUBE=35680,$J.VERTEX_ATTRIB_ARRAY_ENABLED=34338,$J.VERTEX_ATTRIB_ARRAY_SIZE=34339,$J.VERTEX_ATTRIB_ARRAY_STRIDE=34340,$J.VERTEX_ATTRIB_ARRAY_TYPE=34341,$J.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,$J.VERTEX_ATTRIB_ARRAY_POINTER=34373,$J.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,$J.COMPILE_STATUS=35713,$J.LOW_FLOAT=36336,$J.MEDIUM_FLOAT=36337,$J.HIGH_FLOAT=36338,$J.LOW_INT=36339,$J.MEDIUM_INT=36340,$J.HIGH_INT=36341,$J.FRAMEBUFFER=36160,$J.RENDERBUFFER=36161,$J.RGBA4=32854,$J.RGB5_A1=32855,$J.RGB565=36194,$J.DEPTH_COMPONENT16=33189,$J.STENCIL_INDEX=6401,$J.STENCIL_INDEX8=36168,$J.DEPTH_STENCIL=34041,$J.RENDERBUFFER_WIDTH=36162,$J.RENDERBUFFER_HEIGHT=36163,$J.RENDERBUFFER_INTERNAL_FORMAT=36164,$J.RENDERBUFFER_RED_SIZE=36176,$J.RENDERBUFFER_GREEN_SIZE=36177,$J.RENDERBUFFER_BLUE_SIZE=36178,$J.RENDERBUFFER_ALPHA_SIZE=36179,$J.RENDERBUFFER_DEPTH_SIZE=36180,$J.RENDERBUFFER_STENCIL_SIZE=36181,$J.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,$J.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,$J.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,$J.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,$J.COLOR_ATTACHMENT0=36064,$J.DEPTH_ATTACHMENT=36096,$J.STENCIL_ATTACHMENT=36128,$J.DEPTH_STENCIL_ATTACHMENT=33306,$J.NONE=0,$J.FRAMEBUFFER_COMPLETE=36053,$J.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,$J.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,$J.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,$J.FRAMEBUFFER_UNSUPPORTED=36061,$J.FRAMEBUFFER_BINDING=36006,$J.RENDERBUFFER_BINDING=36007,$J.MAX_RENDERBUFFER_SIZE=34024,$J.INVALID_FRAMEBUFFER_OPERATION=1286,$J.UNPACK_FLIP_Y_WEBGL=37440,$J.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,$J.CONTEXT_LOST_WEBGL=37442,$J.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,$J.BROWSER_DEFAULT_WEBGL=37444,$J._useProgram=null,$J._depthTest=!0,$J._depthMask=!0,$J._blend=!1,$J._cullFace=!1,$J.curBindTexTarget=null,$J.curBindTexValue=null,$q($J,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),$J}(),$gi=function($i){function $p(){$p.__super.call(this)}$S($p,"laya.webgl.display.GraphicsGL",$B);var $F=$p.prototype;return $F.setShader=function($i){this._saveToCmd($r.context._setShader,[$i])},$F.setIBVB=function($i,$p,$F,$J,$A,$t){this._saveToCmd($r.context._setIBVB,[$i,$p,$F,$J,$A,$t])},$F.drawParticle=function($i,$p,$F){var $J=$v.createParticleTemplate2D($F);$J.x=$i,$J.y=$p,this._saveToCmd($r.context._drawParticle,[$J])},$p}(),$ai=function($i){var $F;function $W($i){this._x=0,this._y=0,this._id=++$W._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,$W.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=$W.MAXCLIPRECT,this.mOutPoint,this._canvas=$i,this._canvas._addReference(),$W._contextcount++,$r.isFlash?(this._ib=$li.create(35044),$ji.fillIBQuadrangle(this._ib,16)):this._ib=$li.QuadrangleIB,this.clear()}$S($W,"laya.webgl.canvas.WebGLContext2D",$A);var $p=$W.prototype;return $p.setIsMainContext=function(){this._isMain=!0},$p.clearBG=function($i,$p,$F,$J){var $A=$Ei.mainContext;$A.clearColor($i,$p,$F,$J),$A.clear(16384)},$p._getSubmits=function(){return this._submits},$p._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var $i=0,$p=this._submits._length;$i<$p;$i++)this._submits[$i].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},$p.destroy=function(){--$W._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=$li.QuadrangleIB&&this._ib.releaseResource()},$p.clear=function(){this._submits||(this._other=$F.DEFAULT,this._curMat=$Q.create(),this._vb=$Hi.create(-1),this._submits=[],this._save=[$X.Create(this)],this._save.length=10,this._shader2D=new $l,this._triangleMesh=$_i.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=$F.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=$W.MAXCLIPRECT,this._curSubmit=$ti.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=$V.DEFAULT;for(var $i=0,$p=this._submits._length;$i<$p;$i++)this._submits[$i].releaseRender(),this._submits[$i]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},$p.size=function($i,$p){if(this._width!=$i||this._height!=$p)if(0==$i||0==$p){0!=this._vb._byteLength&&(this._width=$i,this._height=$p,this._vb.clear(),this._vb.upload());for(var $F=0,$J=this._submits._length;$F<$J;$F++)this._submits[$F].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=$i,this._height=$p,this._targets&&this._targets.size($i,$p),this._canvas.memorySize-=this._canvas.memorySize;0===$i&&0===$p&&this._releaseMem()},$p._getTransformMatrix=function(){return this._curMat},$p.translate=function($i,$p){0===$i&&0===$p||($b.save(this),this._curMat.bTransform&&($e.save(this),this._curMat.transformPointN($P.TEMP.setTo($i,$p)),$i=$P.TEMP.x,$p=$P.TEMP.y),this._x+=$i,this._y+=$p)},$p.save=function(){this._save[this._save._length++]=$X.Create(this)},$p.restore=function(){var $i=this._save._length;if(!($i<1))for(var $p=$i-1;0<=$p;$p--){var $F=this._save[$p];if($F.restore(this),$F.isSaveMark())return void(this._save._length=$p)}},$p._fillText=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){void 0===$U&&($U=0);var $d=this._shader2D,$u=this._curSubmit.shaderValue,$S=$A?$si.create($A):this._other.font;if($L.enabled)$d.ALPHA!==$u.ALPHA&&($d.glTexture=null),$Zi.drawText(this,$i,$p,this._curMat,$S,$O||this._other.textAlign,$t,$q,$B,$F,$J,$U);else{this._shader2D.defines.getValue();var $Z=$t?$s.create($t)._color:$d.colorAdd;$d.ALPHA===$u.ALPHA&&$Z===$d.colorAdd&&$u.colorAdd===$d.colorAdd||($d.glTexture=null,$d.colorAdd=$Z),$Zi.drawText(this,$i,$p,this._curMat,$S,$O||this._other.textAlign,$t,$q,$B,$F,$J,$U)}},$p.fillWords=function($i,$p,$F,$J,$A,$t){this._fillText(null,$i,$p,$F,$J,$A,null,-1,null,$t)},$p.fillBorderWords=function($i,$p,$F,$J,$A,$t,$q){this._fillBorderText(null,$i,$p,$F,$J,$A,$t,$q,null)},$p.fillText=function($i,$p,$F,$J,$A,$t){this._fillText($i,null,$p,$F,$J,$A,null,-1,$t)},$p.strokeText=function($i,$p,$F,$J,$A,$t,$q){this._fillText($i,null,$p,$F,$J,null,$A,$t||1,$q)},$p.fillBorderText=function($i,$p,$F,$J,$A,$t,$q,$B){this._fillBorderText($i,null,$p,$F,$J,$A,$t,$q,$B)},$p._fillBorderText=function($i,$p,$F,$J,$A,$t,$q,$B,$O){if(!$L.enabled)return this._fillText($i,$p,$F,$J,$A,null,$q,$B||1,$O),void this._fillText($i,$p,$F,$J,$A,$t,null,-1,$O);var $U=this._shader2D,$d=this._curSubmit.shaderValue;$U.ALPHA!==$d.ALPHA&&($U.glTexture=null);var $u=$A?($W._fontTemp.setFont($A),$W._fontTemp):this._other.font;$Zi.drawText(this,$i,$p,this._curMat,$u,$O||this._other.textAlign,$t,$q,$B||1,$F,$J,0)},$p.fillRect=function($i,$p,$F,$J,$A){var $t=this._vb;if($ji.fillRectImgVb($t,this._clipRect,$i,$p,$F,$J,$_.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $q=this._shader2D.fillStyle;$A&&(this._shader2D.fillStyle=$V.create($A));var $B=this._shader2D,$O=this._curSubmit.shaderValue;if($B.fillStyle!==$O.fillStyle||$B.ALPHA!==$O.ALPHA){$B.glTexture=null;var $U=this._curSubmit=$ti.createSubmit(this,this._ib,$t,($t._byteLength-64)/32*3,$Ri.create(2,0));$U.shaderValue.color=$B.fillStyle._color._color,$U.shaderValue.ALPHA=$B.ALPHA,this._submits[this._submits._length++]=$U}this._curSubmit._numEle+=6,this._shader2D.fillStyle=$q}},$p.fillTexture=function($i,$p,$F,$J,$A,$t,$q,$B){if($i.loaded&&$i.bitmap&&$i.source){var $O=this._vb,$U=$i.bitmap.width,$d=$i.bitmap.height,$u=$i.uv,$S=$q.x%$i.width,$Z=$q.y%$i.height;if($U!=$B.w||$d!=$B.h){if(!$B.w&&!$B.h)switch($B.oy=$B.ox=0,$t){case"repeat":$B.width=$J,$B.height=$A;break;case"repeat-x":$B.width=$J,$Z<0?$i.height+$Z>$A?$B.height=$A:$B.height=$i.height+$Z:($B.oy=$Z,$i.height+$Z>$A?$B.height=$A-$Z:$B.height=$i.height);break;case"repeat-y":$S<0?$i.width+$S>$J?$B.width=$J:$B.width=$i.width+$S:($B.ox=$S,$i.width+$S>$J?$B.width=$J-$S:$B.width=$i.width),$B.height=$A;break;case"no-repeat":$S<0?$i.width+$S>$J?$B.width=$J:$B.width=$i.width+$S:($B.ox=$S,$i.width+$S>$J?$B.width=$J-$S:$B.width=$i.width),$Z<0?$i.height+$Z>$A?$B.height=$A:$B.height=$i.height+$Z:($B.oy=$Z,$i.height+$Z>$A?$B.height=$A-$Z:$B.height=$i.height);break;default:$B.width=$J,$B.height=$A}$B.w=$U,$B.h=$d,$B.uv=[0,0,$B.width/$U,0,$B.width/$U,$B.height/$d,0,$B.height/$d]}if($p+=$B.ox,$F+=$B.oy,$S-=$B.ox,$Z-=$B.oy,$ji.fillRectImgVb($O,this._clipRect,$p,$F,$B.width,$B.height,$B.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var $s=$Gi.create(this,this._ib,$O,($O._byteLength-64)/32*3,$Ri.create(256,0)),$x=(this._submits[this._submits._length++]=$s).shaderValue;$x.textureHost=$i;var $j=$u[0]*$U,$r=$u[1]*$d,$M=($u[2]-$u[0])*$U,$D=($u[5]-$u[3])*$d,$E=-$S/$U,$v=-$Z/$d;$x.u_TexRange[0]=$j/$U,$x.u_TexRange[1]=$M/$U,$x.u_TexRange[2]=$r/$d,$x.u_TexRange[3]=$D/$d,$x.u_offset[0]=$E,$x.u_offset[1]=$v,$L.enabled&&!this._isMain&&$s.addTexture($i,($O._byteLength>>2)-16),(this._curSubmit=$s)._renderType=10017,$s._numEle+=6}}else this.sprite&&$g.timer.callLater(this,this._repaintSprite)},$p.setShader=function($i){$k.save(this,1048576,this._shader2D,!0),this._shader2D.shader=$i},$p.setFilters=function($i){$k.save(this,2097152,this._shader2D,!0),this._shader2D.filters=$i,this._curSubmit=$ti.RENDERBASE,this._renderKey=0,this._drawCount++},$p.drawTexture=function($i,$p,$F,$J,$A,$t,$q){this._drawTextureM($i,$p,$F,$J,$A,$t,$q,null,1)},$p.addTextureVb=function($i,$p,$F){var $J=this._curSubmit._vb||this._vb,$A=$J._byteLength>>2;$J.byteLength=$A+16<<2;for(var $t=$J.getFloat32Array(),$q=0;$q<16;$q+=4)$t[$A++]=$i[$q]+$p,$t[$A++]=$i[$q+1]+$F,$t[$A++]=$i[$q+2],$t[$A++]=$i[$q+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),$J._upload=!0},$p.willDrawTexture=function($i,$p){if(!($i.loaded&&$i.bitmap&&$i.source))return this.sprite&&$g.timer.callLater(this,this._repaintSprite),0;var $F=$i.bitmap,$J=$F.id+this._shader2D.ALPHA*$p+10016;if($J==this._renderKey)return $J;var $A=this._shader2D,$t=$A.ALPHA,$q=this._curSubmit.shaderValue;$A.ALPHA*=$p,this._renderKey=$J,this._drawCount++,$A.glTexture=$F;var $B=this._vb,$O=null,$U=$B._byteLength/32*3,$d=$q.textureHost&&$q.textureHost==$i&&$q.textureHost.alphaTexture==$i.alphaTexture;return $O=$Gi.create(this,this._ib,$B,$U,$Ri.create(1,0)),(this._submits[this._submits._length++]=$O).shaderValue.textureHost=$i,$O._renderType=10016,$O._preIsSameTextureShader=10016===this._curSubmit._renderType&&$A.ALPHA===$q.ALPHA&&$d,this._curSubmit=$O,$A.ALPHA=$t,$J},$p.drawTextures=function($i,$p,$F,$J){if($i.loaded&&$i.bitmap&&$i.source){var $A=this._clipRect;if(this._clipRect=$W.MAXCLIPRECT,this._drawTextureM($i,$p[0],$p[1],$i.width,$i.height,$F,$J,null,1)){if(this._clipRect=$A,$m.drawCall++,!($p.length<4)){for(var $t=this._curSubmit._vb||this._vb,$q=this._curMat.a,$B=this._curMat.d,$O=2,$U=$p.length;$O<$U;$O+=2)$ji.copyPreImgVb($t,($p[$O]-$p[$O-2])*$q,($p[$O+1]-$p[$O-1])*$B),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&$g.timer.callLater(this,this._repaintSprite)},$p._drawTextureM=function($i,$p,$F,$J,$A,$t,$q,$B,$O){if(!$i.loaded||!$i.source)return this.sprite&&$g.timer.callLater(this,this._repaintSprite),!1;var $U=this._curSubmit._vb||this._vb,$d=$i.bitmap;$p+=$t,$F+=$q,this._drawCount++;var $u=$d.id+this._shader2D.ALPHA*$O+10016;if($u!=this._renderKey){this._renderKey=$u;var $S=this._curSubmit.shaderValue,$Z=this._shader2D,$s=$Z.ALPHA;$Z.ALPHA*=$O,$Z.glTexture=$d;var $x=this._vb,$j=null,$r=$x._byteLength/32*3,$M=$S.textureHost&&$S.textureHost==$i&&$S.textureHost.alphaTexture==$i.alphaTexture;$j=$Gi.create(this,this._ib,$x,$r,$Ri.create(1,0)),(this._submits[this._submits._length++]=$j).shaderValue.textureHost=$i,$j._renderType=10016,$j._preIsSameTextureShader=10016===this._curSubmit._renderType&&$Z.ALPHA===$S.ALPHA&&$M,this._curSubmit=$j,$U=this._curSubmit._vb||this._vb,$Z.ALPHA=$s}return!!$ji.fillRectImgVb($U,this._clipRect,$p,$F,$J||$i.width,$A||$i.height,$i.uv,$B||this._curMat,this._x,this._y,0,0)&&($L.enabled&&!this._isMain&&this._curSubmit.addTexture($i,($U._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},$p._repaintSprite=function(){this.sprite&&this.sprite.repaint()},$p._drawText=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){var $d=$i.bitmap;this._drawCount++;var $u=$d.id+this._shader2D.ALPHA+10016;if($u!=this._renderKey){this._renderKey=$u;var $S=this._curSubmit.shaderValue,$Z=this._shader2D;$Z.glTexture=$d;var $s=this._vb,$x=null,$j=$s._byteLength/32*3,$r=$S.textureHost&&$S.textureHost==$i&&$S.textureHost.alphaTexture==$i.alphaTexture;($x=$L.enabled?$Gi.create(this,this._ib,$s,$j,$Ri.create(1,0)):$Gi.create(this,this._ib,$s,$j,$bi.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&$Z.ALPHA===$S.ALPHA&&$r,(this._submits[this._submits._length++]=$x).shaderValue.textureHost=$i,$x._renderType=10016,this._curSubmit=$x}$i.active();var $M=this._curSubmit._vb||this._vb;$ji.fillRectImgVb($M,this._clipRect,$p+$q,$F+$B,$J||$i.width,$A||$i.height,$i.uv,$t||this._curMat,this._x,this._y,$O,$U,!0)&&($L.enabled&&!this._isMain&&this._curSubmit.addTexture($i,($M._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},$p.drawTextureWithTransform=function($i,$p,$F,$J,$A,$t,$q,$B,$O){if($t){var $U=this._curMat,$d=this._x,$u=this._y;(0!==$q||0!==$B)&&(this._x=$q*$U.a+$B*$U.c,this._y=$B*$U.d+$q*$U.b),$t&&$U.bTransform?($Q.mul($t,$U,$W._tmpMatrix),($t=$W._tmpMatrix)._checkTransform()):(this._x+=$U.tx,this._y+=$U.ty),this._drawTextureM($i,$p,$F,$J,$A,0,0,$t,$O),this._x=$d,this._y=$u}else this._drawTextureM($i,$p,$F,$J,$A,$q,$B,null,$O)},$p.fillQuadrangle=function($i,$p,$F,$J,$A){var $t=this._curSubmit,$q=this._vb,$B=this._shader2D,$O=$t.shaderValue;if(this._renderKey=0,$i.bitmap){var $U=$i.bitmap;$B.glTexture==$U&&$B.ALPHA===$O.ALPHA||($B.glTexture=$U,($t=this._curSubmit=$ti.createSubmit(this,this._ib,$q,$q._byteLength/32*3,$Ri.create(1,0))).shaderValue.glTexture=$U,this._submits[this._submits._length++]=$t),$ji.fillQuadrangleImgVb($q,$p,$F,$J,$i.uv,$A||this._curMat,this._x,this._y)}else $t.shaderValue.fillStyle&&$t.shaderValue.fillStyle.equal($i)&&$B.ALPHA===$O.ALPHA||($B.glTexture=null,($t=this._curSubmit=$ti.createSubmit(this,this._ib,$q,$q._byteLength/32*3,$Ri.create(2,0))).shaderValue.defines.add(2),$t.shaderValue.fillStyle=$V.create($i),this._submits[this._submits._length++]=$t),$ji.fillQuadrangleImgVb($q,$p,$F,$J,$_.DEF_UV,$A||this._curMat,this._x,this._y);$t._numEle+=6},$p.drawTexture2=function($i,$p,$F,$J,$A,$t,$q,$B){if(0!=$t){var $O=this._curMat;if(this._x=$i*$O.a+$p*$O.c,this._y=$p*$O.d+$i*$O.b,$A&&($A=$O.bTransform||$A.bTransform?($Q.mul($A,$O,$W._tmpMatrix),$W._tmpMatrix):(this._x+=$A.tx+$O.tx,this._y+=$A.ty+$O.ty,$Q.EMPTY)),1!==$t||$q){var $U=this._shader2D.ALPHA,$d=this._nBlendType;this._shader2D.ALPHA=$t,$q&&(this._nBlendType=$K.TOINT($q)),this._drawTextureM($B[0],$B[1]-$F,$B[2]-$J,$B[3],$B[4],0,0,$A,1),this._shader2D.ALPHA=$U,this._nBlendType=$d}else this._drawTextureM($B[0],$B[1]-$F,$B[2]-$J,$B[3],$B[4],0,0,$A,1);this._x=this._y=0}},$p.drawCanvas=function($i,$p,$F,$J,$A){var $t=$i.context;if(this._renderKey=0,$t._targets)this._submits[this._submits._length++]=$Ii.create($t,0,null),this._curSubmit=$ti.RENDERBASE,$t._targets.drawTo(this,$p,$F,$J,$A);else{var $q=this._submits[this._submits._length++]=$Ii.create($t,this._shader2D.ALPHA,this._shader2D.filters),$B=$J/$i.width,$O=$A/$i.height,$U=$q._matrix;this._curMat.copyTo($U),1!=$B&&1!=$O&&$U.scale($B,$O);var $d=$U.tx,$u=$U.ty;$U.tx=$U.ty=0,$U.transformPoint($P.TEMP.setTo($p,$F)),$U.translate($P.TEMP.x+$d,$P.TEMP.y+$u),this._curSubmit=$ti.RENDERBASE}$a.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=$t._targets?"yellow":"green",this.strokeRect($p-1,$F-1,$J+2,$A+2,1),this.strokeRect($p,$F,$J,$A,1),this.restore())},$p.drawTarget=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){void 0===$U&&($U=-1);var $d=this._vb;if($ji.fillRectImgVb($d,this._clipRect,$p,$F,$J,$A,$O||$_.DEF_UV,$t||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var $u=this._curSubmit=$ui.create(this,this._ib,$d,($d._byteLength-64)/32*3,$B,$q);$u.blendType=-1==$U?this._nBlendType:$U,$u.scope=$i,this._submits[this._submits._length++]=$u,this._curSubmit._numEle+=6}},$p.mixRGBandAlpha=function($i){return this._mixRGBandAlpha($i,this._shader2D.ALPHA)},$p._mixRGBandAlpha=function($i,$p){var $F=(4278190080&$i)>>>24;return 0!=$F?$F*=$p:$F=255*$p,16777215&$i|$F<<24},$p.drawTriangles=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){if(!$i.loaded||!$i.source)return this.sprite&&$g.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;$i.bitmap;var $d=this._mixRGBandAlpha(4294967295,$B),$u=($J.length,$t.length);this._renderKey=-1;var $S=this._curSubmit=$Gi.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,$Ri.create(1,0));return $S.shaderValue.textureHost=$i,$S._renderType=10016,this._submits[this._submits._length++]=$S,$q?($W._tmpMatrix.a=$q.a,$W._tmpMatrix.b=$q.b,$W._tmpMatrix.c=$q.c,$W._tmpMatrix.d=$q.d,$W._tmpMatrix.tx=$q.tx+$p,$W._tmpMatrix.ty=$q.ty+$F,$Q.mul($W._tmpMatrix,this._curMat,$W._tmpMatrix)):($W._tmpMatrix.a=this._curMat.a,$W._tmpMatrix.b=this._curMat.b,$W._tmpMatrix.c=this._curMat.c,$W._tmpMatrix.d=this._curMat.d,$W._tmpMatrix.tx=this._curMat.tx+$p,$W._tmpMatrix.ty=this._curMat.ty+$F),this._triangleMesh.addData($J,$A,$t,$W._tmpMatrix,$d,this),this._curSubmit._numEle+=$u,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},$p.transform=function($i,$p,$F,$J,$A,$t){$e.save(this),$Q.mul($Q.TEMP.setTo($i,$p,$F,$J,$A,$t),this._curMat,this._curMat),this._curMat._checkTransform()},$p.setTransformByMatrix=function($i){$i.copyTo(this._curMat)},$p.transformByMatrix=function($i){$e.save(this),$Q.mul($i,this._curMat,this._curMat),this._curMat._checkTransform()},$p.rotate=function($i){$e.save(this),this._curMat.rotateEx($i)},$p.scale=function($i,$p){$e.save(this),this._curMat.scaleEx($i,$p)},$p.clipRect=function($i,$p,$F,$J){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var $A=$di.create(4);this.addRenderObject($A);var $t=this._vb,$q=$t._byteLength>>2;if($ji.fillRectImgVb($t,null,$i,$p,$F,$J,$_.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var $B=this._curSubmit=$ti.createSubmit(this,this._ib,$t,($t._byteLength-64)/32*3,$Ri.create(2,0));$B.shaderValue.ALPHA=1,this._submits[this._submits._length++]=$B,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var $O=$di.create(5);this.addRenderObject($O);var $U=$t.getFloat32Array(),$d=Math.min(Math.min(Math.min($U[0+$q],$U[4+$q]),$U[8+$q]),$U[12+$q]),$u=Math.max(Math.max(Math.max($U[0+$q],$U[4+$q]),$U[8+$q]),$U[12+$q]),$S=Math.min(Math.min(Math.min($U[1+$q],$U[5+$q]),$U[9+$q]),$U[13+$q]),$Z=Math.max(Math.max(Math.max($U[1+$q],$U[5+$q]),$U[9+$q]),$U[13+$q]);$$.save(this,$O,$i,$p,$F,$J,$d,$S,$u-$d,$Z-$S),this._curSubmit=$ti.RENDERBASE}else{$F*=this._curMat.a,$J*=this._curMat.d;var $s=$P.TEMP;this._curMat.transformPoint($s.setTo($i,$p)),$F<0&&($s.x=$s.x+$F,$F=-$F),$J<0&&($s.y=$s.y+$J,$J=-$J),this._renderKey=0;var $x=this._curSubmit=$Ui.create(this);(this._submits[this._submits._length++]=$x).submitIndex=this._submits._length,$x.submitLength=9999999,$w.save(this,$x);var $j=this._clipRect,$r=$j.x,$M=$j.y,$D=$s.x+$F,$E=$s.y+$J;$r<$s.x&&($j.x=$s.x),$M<$s.y&&($j.y=$s.y),$j.width=Math.min($D,$r+$j.width)-$j.x,$j.height=Math.min($E,$M+$j.height)-$j.y,this._shader2D.glTexture=null,$x.clipRect.copyFrom($j),this._curSubmit=$ti.RENDERBASE}},$p.setIBVB=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d){if(void 0===$O&&($O=0),void 0===$U&&($U=0),void 0===$d&&($d=0),null===$F){if($r.isFlash){var $u=$J;$u._selfIB||($u._selfIB=$li.create(35044)),$u._selfIB.clear(),$F=$u._selfIB}else $F=this._ib;$ji.expandIBQuadrangle($F,$J._byteLength/(4*$J.vertexStride*4))}if(!$B||!$q)throw Error("setIBVB must input:shader shaderValues");var $S=$Oi.create(this,$J,$F,$A,$q,$B,$O,$U,$d);$t||($t=$Q.EMPTY),$t.translate($i,$p),$Q.mul($t,this._curMat,$S._mat),$t.translate(-$i,-$p),this._submits[this._submits._length++]=$S,this._curSubmit=$ti.RENDERBASE,this._renderKey=0},$p.addRenderObject=function($i){this._submits[this._submits._length++]=$i},$p.fillTrangles=function($i,$p,$F,$J,$A){var $t=this._curSubmit,$q=this._vb,$B=this._shader2D,$O=$t.shaderValue,$U=$J.length>>4,$d=$i.bitmap;this._renderKey=0,$B.glTexture==$d&&$B.ALPHA===$O.ALPHA||(($t=this._curSubmit=$ti.createSubmit(this,this._ib,$q,$q._byteLength/32*3,$Ri.create(1,0))).shaderValue.textureHost=$i,this._submits[this._submits._length++]=$t),$ji.fillTranglesVB($q,$p,$F,$J,$A||this._curMat,this._x,this._y),$t._numEle+=6*$U},$p.submitElement=function($i,$p){var $F=this._submits;for($p<0&&($p=$F._length);$i<$p;)$i+=$F[$i].renderSubmit()},$p.finish=function(){$Ei.mainContext.finish()},$p.flush=function(){var $i=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if($i>this._ib.bufferLength/12&&$ji.expandIBQuadrangle(this._ib,$i),!this._isMain&&$L.enabled&&$L._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=$L._atlasRestore;for(var $p=this._submits,$F=0,$J=$p._length;$F<$J;$F++){var $A=$p[$F];10016===$A.getRenderType()&&$A.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),$pi.instance&&$pi.getInstance().reset();var $t;for($F=0,$t=this.meshlist.length;$F<$t;$F++){var $q=this.meshlist[$F];$q.canReuse?$q.releaseMesh():$q.destroy()}return this.meshlist.length=0,this._curSubmit=$ti.RENDERBASE,this._renderKey=0,this._triangleMesh=$_i.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},$p.setPathId=function($i){if(this.mId=$i,-1!=this.mId){this.mHaveKey=!1;var $p=$N.getInstance();$p.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,$p.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},$p.movePath=function($i,$p){var $F=$i,$J=$p;$i=this._curMat.a*$F+this._curMat.c*$J+this._curMat.tx,$p=this._curMat.b*$F+this._curMat.d*$J+this._curMat.ty,this.mX+=$i,this.mY+=$p},$p.beginPath=function(){var $i=this._getPath();$i.tempArray.length=0,$i.closePath=!1,this.mX=0,this.mY=0},$p.closePath=function(){this._path.closePath=!0},$p.fill=function($i){void 0===$i&&($i=!1);var $p=this._getPath();this.drawPoly(0,0,$p.tempArray,this.fillStyle._color.numColor,0,0,$i)},$p.stroke=function(){var $i=this._getPath();if(0<this.lineWidth){if(-1==this.mId)$i.drawLine(0,0,$i.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var $p=$N.getInstance().shapeLineDic[this.mId];$p.rebuild($i.tempArray),$i.setGeomtry($p)}else $N.getInstance().addLine(this.mId,$i.drawLine(0,0,$i.tempArray,this.lineWidth,this.strokeStyle._color.numColor));$i.update();var $F=[this.mX,this.mY],$J=$ti.createShape(this,$i.ib,$i.vb,$i.count,$i.offset,$Ri.create(4,0));$J.shaderValue.ALPHA=this._shader2D.ALPHA,$J.shaderValue.u_pos=$F,$J.shaderValue.u_mmat2=$Mi.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=$J,this._renderKey=-1}},$p.line=function($i,$p,$F,$J,$A,$t){var $q=this._curSubmit,$B=this._vb;if($ji.fillLineVb($B,this._clipRect,$i,$p,$F,$J,$A,$t)){this._renderKey=0;var $O=this._shader2D,$U=$q.shaderValue;$O.strokeStyle===$U.strokeStyle&&$O.ALPHA===$U.ALPHA||($O.glTexture=null,($q=this._curSubmit=$ti.createSubmit(this,this._ib,$B,($B._byteLength-64)/32*3,$Ri.create(2,0))).shaderValue.strokeStyle=$O.strokeStyle,$q.shaderValue.mainID=2,$q.shaderValue.ALPHA=$O.ALPHA,this._submits[this._submits._length++]=$q),$q._numEle+=6}},$p.moveTo=function($i,$p,$F){void 0===$F&&($F=!0);var $J=this._getPath();if($F){var $A=$i,$t=$p;$i=this._curMat.a*$A+this._curMat.c*$t,$p=this._curMat.b*$A+this._curMat.d*$t}$J.addPoint($i,$p)},$p.lineTo=function($i,$p,$F){void 0===$F&&($F=!0);var $J=this._getPath();if($F){var $A=$i,$t=$p;$i=this._curMat.a*$A+this._curMat.c*$t,$p=this._curMat.b*$A+this._curMat.d*$t}$J.addPoint($i,$p)},$p.drawCurves=function($i,$p,$F){this.setPathId(-1),this.beginPath(),this.strokeStyle=$F[3],this.lineWidth=$F[4];var $J=$F[2];$i+=$F[0],$p+=$F[1],this.movePath($i,$p),this.moveTo($J[0],$J[1]);for(var $A=2,$t=$J.length;$A<$t;)this.quadraticCurveTo($J[$A++],$J[$A++],$J[$A++],$J[$A++]);this.stroke()},$p.arcTo=function($i,$p,$F,$J,$A){if(-1==this.mId||!this.mHaveKey){var $t=0,$q=0,$B=0,$O=this._getPath();this._curMat.copyTo($W._tmpMatrix),$W._tmpMatrix.tx=$W._tmpMatrix.ty=0,$W._tempPoint.setTo($O.getEndPointX(),$O.getEndPointY()),$W._tmpMatrix.invertTransformPoint($W._tempPoint);var $U=$W._tempPoint.x-$i,$d=$W._tempPoint.y-$p,$u=Math.sqrt($U*$U+$d*$d);if(!($u<=1e-6)){var $S=$U/$u,$Z=$d/$u,$s=$F-$i,$x=$J-$p,$j=$s*$s+$x*$x,$r=Math.sqrt($j);if(!($r<=1e-6)){var $M=$s/$r,$D=$x/$r,$E=$S+$M,$v=$Z+$D,$g=Math.sqrt($E*$E+$v*$v);if(!($g<=1e-6)){var $a=$E/$g,$R=$v/$g,$Q=Math.acos($a*$S+$R*$Z),$P=Math.PI/2-$Q,$Y=($u=$A/Math.tan($P))*$S+$i,$c=$u*$Z+$p,$h=Math.sqrt($u*$u+$A*$A),$m=$i+$a*$h,$n=$p+$R*$h,$I=0,$G=0;if(0<=$S*$D-$Z*$M){var $_=2*$P/$W.SEGNUM;$I=Math.sin($_),$G=Math.cos($_)}else $_=2*-$P/$W.SEGNUM,$I=Math.sin($_),$G=Math.cos($_);$q=this._curMat.a*$Y+this._curMat.c*$c,$B=this._curMat.b*$Y+this._curMat.d*$c,$q==this._path.getEndPointX()&&$B==this._path.getEndPointY()||$O.addPoint($q,$B);var $y=$Y-$m,$N=$c-$n;for($t=0;$t<$W.SEGNUM;$t++){var $f=$y*$G+$N*$I,$o=-$y*$I+$N*$G;$q=$f+$m,$B=$o+$n,$i=this._curMat.a*$q+this._curMat.c*$B,$B=$p=this._curMat.b*$q+this._curMat.d*$B,($q=$i)==this._path.getEndPointX()&&$B==this._path.getEndPointY()||$O.addPoint($q,$B),$y=$f,$N=$o}}}}}},$p.arc=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$t&&($t=!1),void 0===$q&&($q=!0),-1!=this.mId){var $B=$N.getInstance().shapeDic[this.mId];if($B&&this.mHaveKey&&!$B.needUpdate(this._curMat))return;$p=$i=0}var $O,$U=0,$d=0,$u=0,$S=0,$Z=0,$s=0,$x=0;if($d=$A-$J,$t)if(Math.abs($d)>=2*Math.PI)$d=2*-Math.PI;else for(;0<$d;)$d-=2*Math.PI;else if(Math.abs($d)>=2*Math.PI)$d=2*Math.PI;else for(;$d<0;)$d+=2*Math.PI;$O=$d/($x=$F<101?Math.max(10,$d*$F/5):$F<201?Math.max(10,$d*$F/20):Math.max(10,$d*$F/40))/2,$u=Math.abs(4/3*(1-Math.cos($O))/Math.sin($O)),$t&&($u=-$u);var $j=this._getPath(),$r=NaN,$M=NaN;for($s=0;$s<=$x;$s++)$U=$J+$d*($s/$x),$S=$i+Math.cos($U)*$F,$Z=$p+Math.sin($U)*$F,$q&&($r=$S,$M=$Z,$S=this._curMat.a*$r+this._curMat.c*$M,$Z=this._curMat.b*$r+this._curMat.d*$M),$S==this._path.getEndPointX()&&$Z==this._path.getEndPointY()||$j.addPoint($S,$Z);$S=$i+Math.cos($A)*$F,$Z=$p+Math.sin($A)*$F,$q&&($r=$S,$M=$Z,$S=this._curMat.a*$r+this._curMat.c*$M,$Z=this._curMat.b*$r+this._curMat.d*$M),$S==this._path.getEndPointX()&&$Z==this._path.getEndPointY()||$j.addPoint($S,$Z)},$p.quadraticCurveTo=function($i,$p,$F,$J){var $A=$u.I,$t=$F,$q=$J;$F=this._curMat.a*$t+this._curMat.c*$q,$J=this._curMat.b*$t+this._curMat.d*$q,$t=$i,$q=$p,$i=this._curMat.a*$t+this._curMat.c*$q,$p=this._curMat.b*$t+this._curMat.d*$q;for(var $B=$A.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),$i,$p,$F,$J],30,2),$O=0,$U=$B.length/2;$O<$U;$O++)this.lineTo($B[2*$O],$B[2*$O+1],!1);this.lineTo($F,$J,!1)},$p.rect=function($i,$p,$F,$J){this._other=this._other.make(),this._other.path||(this._other.path=new $T),this._other.path.rect($i,$p,$F,$J)},$p.strokeRect=function($i,$p,$F,$J,$A){var $t=.5*$A;this.line($i-$t,$p,$i+$F+$t,$p,$A,this._curMat),this.line($i+$F,$p,$i+$F,$p+$J,$A,this._curMat),this.line($i,$p,$i,$p+$J,$A,this._curMat),this.line($i-$t,$p+$J,$i+$F+$t,$p+$J,$A,this._curMat)},$p.clip=function(){},$p.drawPoly=function($i,$p,$F,$J,$A,$t,$q){void 0===$q&&($q=!1),this._renderKey=0,this._shader2D.glTexture=null;var $B=this._getPath();if(-1==this.mId)$B.polygon($i,$p,$F,$J,$A||1,$t);else if(this.mHaveKey){var $O=$N.getInstance().shapeDic[this.mId];$O.setMatrix(this._curMat),$O.rebuild($B.tempArray),$B.setGeomtry($O)}else{var $U=$B.polygon($i,$p,$F,$J,$A||1,$t);$N.getInstance().addShape(this.mId,$U),$U.setMatrix(this._curMat)}$B.update();var $d,$u=[this.mX,this.mY];if(($d=$ti.createShape(this,$B.ib,$B.vb,$B.count,$B.offset,$Ri.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$d.shaderValue.u_pos=$u,$d.shaderValue.u_mmat2=$Mi.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$d,0<$A){if(this.mHaveLineKey){var $S=$N.getInstance().shapeLineDic[this.mId];$S.rebuild($B.tempArray),$B.setGeomtry($S)}else $N.getInstance().addShape(this.mId,$B.drawLine($i,$p,$F,$A,$t));$B.update(),($d=$ti.createShape(this,$B.ib,$B.vb,$B.count,$B.offset,$Ri.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,$d.shaderValue.u_mmat2=$Mi.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=$d}},$p.drawParticle=function($i,$p,$F){$F.x=$i,$F.y=$p,this._submits[this._submits._length++]=$F},$p._getPath=function(){return this._path||(this._path=new $T)},$J(0,$p,"globalCompositeOperation",function(){return $K.NAMES[this._nBlendType]},function($i){var $p=$K.TOINT[$i];null==$p||this._nBlendType===$p||($k.save(this,65536,this,!0),this._curSubmit=$ti.RENDERBASE,this._renderKey=0,this._nBlendType=$p)}),$J(0,$p,"strokeStyle",function(){return this._shader2D.strokeStyle},function($i){this._shader2D.strokeStyle.equal($i)||($k.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=$V.create($i))}),$J(0,$p,"globalAlpha",function(){return this._shader2D.ALPHA},function($i){($i=Math.floor(1e3*$i)/1e3)!=this._shader2D.ALPHA&&($k.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=$i)}),$J(0,$p,"asBitmap",null,function($i){if($i){if(this._targets||(this._targets=new $z),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),$J(0,$p,"fillStyle",function(){return this._shader2D.fillStyle},function($i){this._shader2D.fillStyle.equal($i)||($k.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=$V.create($i))}),$J(0,$p,"textAlign",function(){return this._other.textAlign},function($i){this._other.textAlign===$i||(this._other=this._other.make(),$k.save(this,32768,this._other,!1),this._other.textAlign=$i)}),$J(0,$p,"lineWidth",function(){return this._other.lineWidth},function($i){this._other.lineWidth===$i||(this._other=this._other.make(),$k.save(this,256,this._other,!1),this._other.lineWidth=$i)}),$J(0,$p,"textBaseline",function(){return this._other.textBaseline},function($i){this._other.textBaseline===$i||(this._other=this._other.make(),$k.save(this,16384,this._other,!1),this._other.textBaseline=$i)}),$J(0,$p,"font",null,function($i){$i!=this._other.font.toString()&&(this._other=this._other.make(),$k.save(this,8,this._other,!1),this._other.font===$si.EMPTY?this._other.font=new $si($i):this._other.font.setFont($i))}),$W.__init__=function(){$F.DEFAULT=new $F},$W._tempPoint=new $P,$W._SUBMITVBSIZE=32e3,$W._MAXSIZE=99999999,$W._RECTVBSIZE=16,$W.MAXCLIPRECT=new $Y(0,0,99999999,99999999),$W._COUNT=0,$W._tmpMatrix=new $Q,$W.SEGNUM=32,$W._contextcount=0,$q($W,["_fontTemp",function(){return this._fontTemp=new $si},"_drawStyleTemp",function(){return this._drawStyleTemp=new $V(null)}]),$W.__init$=function(){$F=function(){function $i(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=$si.EMPTY}$S($i,"");var $p=$i.prototype;return $p.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=$si.EMPTY},$p.make=function(){return this===$i.DEFAULT?new $i:this},$i.DEFAULT=null,$i}()},$W}(),$Ri=function($i){function $J($i,$p){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,$J.__super.call(this),this.defines=new $ci,this.position=$J._POSITION,this.mainID=$i,this.subID=$p,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=$i|$p,this._inClassCache=$J._cache[this._cacheID],0<$i&&!this._inClassCache&&(this._inClassCache=$J._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}$S($J,"laya.webgl.shader.d2.value.Value2D",$o);var $p=$J.prototype;return $p.setValue=function($i){},$p.refresh=function(){var $i=this.size;return $i[0]=$Mi.width,$i[1]=$Mi.height,this.alpha=this.ALPHA*$Mi.worldAlpha,this.mmat=$Mi.worldMatrix4,this},$p._ShaderWithCompile=function(){return $Xi.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,$zi.create)},$p._withWorldShaderDefines=function(){var $i=$Mi.worldShaderDefines,$p=$Xi.sharders[this.mainID|this.defines._value|$i.getValue()];if(!$p){var $F,$J={};for($F in this.defines.toNameDic())$J[$F]="";for($F in $i.toNameDic())$J[$F]="";$p=$Xi.withCompile2D(0,this.mainID,$J,this.mainID|this.defines._value|$i.getValue(),$zi.create)}var $A=$Mi.worldFilters;if(!$A)return $p;for(var $t,$q=$A.length,$B=0;$B<$q;$B++)($t=$A[$B])&&$t.action.setValue(this);return $p},$p.upload=function(){var $i=$Mi;this.alpha=this.ALPHA*$i.worldAlpha,$Mi.worldMatrix4!==$Mi.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),$Ei.shaderHighPrecision&&this.defines.add(1024);var $p,$F=$i.worldShaderDefines?this._withWorldShaderDefines():$Xi.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=$i.width,this.size[1]=$i.height,this.mmat=$i.worldMatrix4,$yi.activeShader!==$F?$F._shaderValueWidth!==$i.width||$F._shaderValueHeight!==$i.height?($F._shaderValueWidth=$i.width,$F._shaderValueHeight=$i.height):$p=$F._params2dQuick2||$F._make2dQuick2():$F._shaderValueWidth!==$i.width||$F._shaderValueHeight!==$i.height?($F._shaderValueWidth=$i.width,$F._shaderValueHeight=$i.height):$p=$F._params2dQuick1||$F._make2dQuick1(),$F.upload(this,$p)},$p.setFilters=function($i){if(this.filters=$i)for(var $p,$F=$i.length,$J=0;$J<$F;$J++)($p=$i[$J])&&(this.defines.add($p.type),$p.action.setValue(this))},$p.clear=function(){this.defines.setValue(this.subID)},$p.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},$J._initone=function($i,$p){$J._typeClass[$i]=$p,$J._cache[$i]=[],$J._cache[$i]._length=0},$J.__init__=function(){$J._POSITION=[2,5126,!1,4*$xi.BYTES_PE,0],$J._TEXCOORD=[2,5126,!1,4*$xi.BYTES_PE,2*$xi.BYTES_PE],$J._initone(2,$Wi),$J._initone(4,$Ki),$J._initone(256,$Li),$J._initone(512,$oi),$J._initone(1,$Ci),$J._initone(65,$bi),$J._initone(9,$Ci)},$J.create=function($i,$p){var $F=$J._cache[$i|$p];return $F._length?$F[--$F._length]:new $J._typeClass[$i|$p]($p)},$J._POSITION=null,$J._TEXCOORD=null,$J._cache=[],$J._typeClass=[],$J.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$J}(),$Qi=function($i){function $j($i,$p){$j.__super.call(this,$i,$p)}$S($j,"laya.webgl.utils.RenderSprite3D",$M);var $p=$j.prototype;return $p.onCreate=function($i){switch($i){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},$p._mask=function($i,$p,$F,$J){var $A,$t,$q=this._next,$B=$i.mask;if($B){$p.ctx.save();var $O=$p.ctx.globalCompositeOperation,$U=new $Y;if($U.copyFrom($B.getBounds()),$U.width=Math.round($U.width),$U.height=Math.round($U.height),$U.x=Math.round($U.x),$U.y=Math.round($U.y),0<$U.width&&0<$U.height){var $d=$i._style._tf,$u=$Bi.create();$u.addValue("bounds",$U),$A=$qi.create([$u,$p],laya.webgl.utils.RenderSprite3D.tmpTarget),$p.addRenderObject($A),$B.render($p,-$U.x,-$U.y),$A=$qi.create([$u],laya.webgl.utils.RenderSprite3D.endTmpTarget),$p.addRenderObject($A),$p.ctx.save(),$p.clipRect($F-$d.translateX+$U.x,$J-$d.translateY+$U.y,$U.width,$U.height),$q._fun.call($q,$i,$p,$F,$J),$p.ctx.restore(),$t=$di.create(6),$O=$p.ctx.globalCompositeOperation,$t.blendMode="mask",$p.addRenderObject($t),$Q.TEMP.identity();var $S=$Ri.create(1,0),$Z=$_.INV_UV,$s=$U.width,$x=$U.height;($U.width<32||$U.height<32)&&(($Z=$j.tempUV)[0]=0,$Z[1]=0,$Z[2]=32<=$U.width?1:$U.width/32,$Z[3]=0,$Z[4]=32<=$U.width?1:$U.width/32,$Z[5]=32<=$U.height?1:$U.height/32,$Z[6]=0,$Z[7]=32<=$U.height?1:$U.height/32,$U.width=32<=$U.width?$U.width:32,$U.height=32<=$U.height?$U.height:32,$Z[1]*=-1,$Z[3]*=-1,$Z[5]*=-1,$Z[7]*=-1,$Z[1]+=1,$Z[3]+=1,$Z[5]+=1,$Z[7]+=1),$p.ctx.drawTarget($u,$F+$U.x-$d.translateX,$J+$U.y-$d.translateY,$s,$x,$Q.TEMP,"tmpTarget",$S,$Z,6),$A=$qi.create([$u],laya.webgl.utils.RenderSprite3D.recycleTarget),$p.addRenderObject($A),($t=$di.create(6)).blendMode=$O,$p.addRenderObject($t)}$p.ctx.restore()}else $q._fun.call($q,$i,$p,$F,$J)},$p._blend=function($i,$p,$F,$J){var $A=$i._style,$t=this._next;$A.blendMode?($p.ctx.save(),$p.ctx.globalCompositeOperation=$A.blendMode,$t._fun.call($t,$i,$p,$F,$J),$p.ctx.restore()):$t._fun.call($t,$i,$p,$F,$J)},$p._transform=function($i,$p,$F,$J){var $A=$i.transform,$t=this._next;if($A&&$t!=$M.NORENDER){var $q=$p.ctx;$i._style;$A.tx=$F,$A.ty=$J;var $B=$q._getTransformMatrix(),$O=$B.clone();$Q.mul($A,$B,$B),$B._checkTransform(),$A.tx=$A.ty=0,$t._fun.call($t,$i,$p,0,0),$O.copyTo($B),$O.destroy()}else $t._fun.call($t,$i,$p,$F,$J)},$j.tmpTarget=function($i,$p){var $F=$i.getValue("bounds"),$J=$Ni.create($F.width,$F.height);$J.start(),$J.clear(0,0,0,0),$i.addValue("tmpTarget",$J)},$j.endTmpTarget=function($i){$i.getValue("tmpTarget").end()},$j.recycleTarget=function($i){$i.getValue("tmpTarget").recycle(),$i.recycle()},$q($j,["tempUV",function(){return this.tempUV=new Array(8)}]),$j}(),$Pi=function($i){function $p(){this.data=null,$p.__super.call(this)}$S($p,"laya.filters.webgl.ColorFilterActionGL",$f);var $F=$p.prototype;return $g.imps($F,{"laya.filters.IFilterActionGL":!0}),$F.setValue=function($i){$i.colorMat=this.data._mat,$i.colorAlpha=this.data._alpha},$F.apply3d=function($i,$p,$F,$J,$A){var $t=$i.getValue("bounds"),$q=$Ri.create(1,0);$q.setFilters([this.data]);var $B=$Q.TEMP;$B.identity(),$F.ctx.drawTarget($i,0,0,$t.width,$t.height,$B,"src",$q)},$p}(),$Yi=function($i){function $t($i,$p,$F,$J,$A){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,$t.__super.call(this,$i,$p,$A),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new $Vi,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=$F,this._atlasCanvas.height=$J,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}$S($t,"laya.webgl.atlas.Atlaser",$W);var $p=$t.prototype;return $p.computeUVinAtlasTexture=function($i,$p,$F,$J){var $A=$L.atlasTextureWidth,$t=$L.atlasTextureHeight,$q=$F/$A,$B=$J/$t,$O=($F+$i.bitmap.width)/$A,$U=($J+$i.bitmap.height)/$t,$d=$i.bitmap.width/$A,$u=$i.bitmap.height/$t;$i.uv=[$q+$p[0]*$d,$B+$p[1]*$u,$O-(1-$p[2])*$d,$B+$p[3]*$u,$O-(1-$p[4])*$d,$U-(1-$p[5])*$u,$q+$p[6]*$d,$U-(1-$p[7])*$u]},$p.findBitmapIsExist=function($i){if($i instanceof laya.webgl.resource.WebGLImage){var $p=$i,$F=$p.url,$J=this._InAtlasWebGLImagesKey[$F||$p.id];if($J)return $J.offsetInfoID}return-1},$p.addToAtlasTexture=function($i,$p,$F){if($i instanceof laya.webgl.resource.WebGLImage){var $J=$i,$A=$J.url;this._InAtlasWebGLImagesKey[$A||$J.id]={bitmap:$i,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([$p,$F])}this._atlasCanvas.texSubImage2D($p,$F,$i.atlasSource),$i.clearAtlasSource()},$p.addToAtlas=function($i,$p,$F){$i._atlasID=this._inAtlasTextureKey.length;var $J=$i.uv.slice(),$A=$i.bitmap;this._inAtlasTextureKey.push($i),this._inAtlasTextureOriUVValue.push($J),this._inAtlasTextureBitmapValue.push($A),this.computeUVinAtlasTexture($i,$J,$p,$F),$i.bitmap=this._atlasCanvas},$p.clear=function(){for(var $i=0,$p=this._inAtlasTextureKey.length;$i<$p;$i++)this._inAtlasTextureKey[$i].bitmap=this._inAtlasTextureBitmapValue[$i],this._inAtlasTextureKey[$i].uv=this._inAtlasTextureOriUVValue[$i],this._inAtlasTextureKey[$i]._atlasID=-1,this._inAtlasTextureKey[$i].bitmap.lock=!1,this._inAtlasTextureKey[$i].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},$p.dispose=function(){this.clear(),this._atlasCanvas.destroy()},$J(0,$p,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),$J(0,$p,"texture",function(){return this._atlasCanvas}),$J(0,$p,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),$t}(),$ci=function($i){function $F(){$F.__super.call(this,$F.__name2int,$F.__int2name,$F.__int2nameMap)}return $S($F,"laya.webgl.shader.d2.ShaderDefines2D",$H),$F.__init__=function(){$F.reg("TEXTURE2D",1),$F.reg("COLOR2D",2),$F.reg("PRIMITIVE",4),$F.reg("GLOW_FILTER",8),$F.reg("BLUR_FILTER",16),$F.reg("COLOR_FILTER",32),$F.reg("COLOR_ADD",64),$F.reg("WORLDMAT",128),$F.reg("FILLTEXTURE",256),$F.reg("FSHIGHPRECISION",1024),$F.reg("TXTALPHA",2048),$F.reg("TXTCOMPRESS",4096)},$F.reg=function($i,$p){$H._reg($i,$p,$F.__name2int,$F.__int2name)},$F.toText=function($i,$p,$F){return $H._toText($i,$p,$F)},$F.toInt=function($i){return $H._toInt($i,$F.__name2int)},$F.TEXTURE2D=1,$F.COLOR2D=2,$F.PRIMITIVE=4,$F.FILTERGLOW=8,$F.FILTERBLUR=16,$F.FILTERCOLOR=32,$F.COLORADD=64,$F.WORLDMAT=128,$F.FILLTEXTURE=256,$F.SKINMESH=512,$F.SHADERDEFINE_FSHIGHPRECISION=1024,$F.TXTALPHA=2048,$F.TXTCOMPRESS=4096,$F.__name2int={},$F.__int2name=[],$F.__int2nameMap=[],$F}(),$hi=(function($i){function $B($i,$p,$F,$J,$A,$t,$q){$B.__super.call(this,$i,$p,$F,$J,40,$A,$t,$q)}$S($B,"laya.webgl.shapes.Ellipse",$Fi)}(),function($i){function $t($i,$p,$F,$J,$A){this._points=[],this.rebuild($F),$t.__super.call(this,$i,$p,0,0,0,$A,$J,$A,0)}$S($t,"laya.webgl.shapes.Line",$Fi);var $p=$t.prototype;return $p.rebuild=function($i){var $p=$i.length;$p!=this._points.length&&(this.mUint16Array=new Uint16Array(6*($p/2-1)),this.mFloat32Array=new Float32Array(5*$p)),this._points.length=0;for(var $F=NaN,$J=NaN,$A=-1,$t=-1,$q=$i.length/2,$B=0;$B<$q;$B++)$F=$i[2*$B],$J=$i[2*$B+1],(.01<Math.abs($A-$F)||.01<Math.abs($t-$J))&&this._points.push($F,$J),$A=$F,$t=$J},$p.getData=function($i,$p,$F){var $J=[],$A=[];0<this.borderWidth&&this.createLine2(this._points,$J,this.borderWidth,$F,$A,this._points.length/2),this.mUint16Array.set($J,0),this.mFloat32Array.set($A,0),$i.append(this.mUint16Array),$p.append(this.mFloat32Array)},$t}()),$mi=function($i){function $u($i,$p,$F,$J,$A){this._points=[];for(var $t=NaN,$q=NaN,$B=-1,$O=-1,$U=$F.length/2-1,$d=0;$d<$U;$d++)$t=$F[2*$d],$q=$F[2*$d+1],(.01<Math.abs($B-$t)||.01<Math.abs($O-$q))&&this._points.push($t,$q),$B=$t,$O=$q;$t=$F[2*$U],$q=$F[2*$U+1],$B=this._points[0],$O=this._points[1],(.01<Math.abs($B-$t)||.01<Math.abs($O-$q))&&this._points.push($t,$q),$u.__super.call(this,$i,$p,0,0,this._points.length/2,0,$J,$A)}$S($u,"laya.webgl.shapes.LoopLine",$Fi);var $p=$u.prototype;return $p.getData=function($i,$p,$F){if(0<this.borderWidth){for(var $J=this.color,$A=($J>>16&255)/255,$t=($J>>8&255)/255,$q=(255&$J)/255,$B=[],$O=0,$U=0,$d=[],$u=Math.floor(this._points.length/2),$S=0;$S<$u;$S++)$O=this._points[2*$S],$U=this._points[2*$S+1],$B.push(this.x+$O,this.y+$U,$A,$t,$q);this.createLoopLine($B,$d,this.borderWidth,$F+$B.length/5),$i.append(new Uint16Array($d)),$p.append(new Float32Array($B))}},$p.createLoopLine=function($i,$p,$F,$J,$A,$t){$i.length;var $q=$i.concat(),$B=$A||$i,$O=this.borderColor,$U=($O>>16&255)/255,$d=($O>>8&255)/255,$u=(255&$O)/255,$S=[$q[0],$q[1]],$Z=[$q[$q.length-5],$q[$q.length-4]],$s=$Z[0]+.5*($S[0]-$Z[0]),$x=$Z[1]+.5*($S[1]-$Z[1]);$q.unshift($s,$x,0,0,0),$q.push($s,$x,0,0,0);var $j,$r,$M,$D,$E,$v,$g,$a,$R,$Q,$P,$Y,$c,$h,$m,$n,$I,$G,$_,$y,$N=$q.length/5,$f=$J,$o=$F/2;$M=$q[0],$D=$q[1],$Q=$M-($E=$q[5]),$R=($R=-($D-($v=$q[6])))/($y=Math.sqrt($R*$R+$Q*$Q))*$o,$Q=$Q/$y*$o,$B.push($M-$R,$D-$Q,$U,$d,$u,$M+$R,$D+$Q,$U,$d,$u);for(var $W=1;$W<$N-1;$W++)$M=$q[5*($W-1)],$D=$q[5*($W-1)+1],$E=$q[5*$W],$v=$q[5*$W+1],$g=$q[5*($W+1)],$a=$q[5*($W+1)+1],$Q=$M-$E,$Y=$E-$g,$m=(-($R=($R=-($D-$v))/($y=Math.sqrt($R*$R+$Q*$Q))*$o)+$M)*(-($Q=$Q/$y*$o)+$v)-(-$R+$E)*(-$Q+$D),$G=(-($P=($P=-($v-$a))/($y=Math.sqrt($P*$P+$Y*$Y))*$o)+$g)*(-($Y=$Y/$y*$o)+$v)-(-$P+$E)*(-$Y+$a),$_=($c=-$Q+$D-(-$Q+$v))*($I=-$P+$E-(-$P+$g))-($n=-$Y+$a-(-$Y+$v))*($h=-$R+$E-(-$R+$M)),Math.abs($_)<.1?($_+=10.1,$B.push($E-$R,$v-$Q,$U,$d,$u,$E+$R,$v+$Q,$U,$d,$u)):((($j=($h*$G-$I*$m)/$_)-$E)*($j-$E)+(($r=($n*$m-$c*$G)/$_)-$v)+($r-$v),$B.push($j,$r,$U,$d,$u,$E-($j-$E),$v-($r-$v),$U,$d,$u));$t&&($p=$t);var $L=this.edges+1;for($W=1;$W<$L;$W++)$p.push($f+2*($W-1),$f+2*($W-1)+1,$f+2*$W+1,$f+2*$W+1,$f+2*$W,$f+2*($W-1));return $p.push($f+2*($W-1),$f+2*($W-1)+1,$f+1,$f+1,$f,$f+2*($W-1)),$B},$u}(),$ni=function($i){function $q($i,$p,$F,$J,$A,$t){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=$Q.create(),this._points=$F.slice(0,$F.length),$q.__super.call(this,$i,$p,0,0,this._points.length/2,$J,$A,$t)}$S($q,"laya.webgl.shapes.Polygon",$Fi);var $p=$q.prototype;return $p.rebuild=function($i){this._repaint||(this._points.length=0,this._points=this._points.concat($i))},$p.setMatrix=function($i){$i.copyTo(this._mat)},$p.needUpdate=function($i){return this._repaint=this._mat.a==$i.a&&this._mat.b==$i.b&&this._mat.c==$i.c&&this._mat.d==$i.d&&this._mat.tx==$i.tx&&this._mat.ty==$i.ty,!this._repaint},$p.getData=function($i,$p,$F){var $J,$A=0,$t=this._points,$q=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=$F){for(this._start=$F,$J=[],$q=this.earcutTriangles.length,$A=0;$A<$q;$A++)$J.push(this.earcutTriangles[$A]+$F);this.mUint16Array=new Uint16Array($J)}}else{this._start=$F,$J=[];var $B=[],$O=[],$U=this.color,$d=($U>>16&255)/255,$u=($U>>8&255)/255,$S=(255&$U)/255;for($q=Math.floor($t.length/2),$A=0;$A<$q;$A++)$B.push(this.x+$t[2*$A],this.y+$t[2*$A+1],$d,$u,$S),$O.push(this.x+$t[2*$A],this.y+$t[2*$A+1]);for(this.earcutTriangles=$Ji.earcut($O,null,2),$q=this.earcutTriangles.length,$A=0;$A<$q;$A++)$J.push(this.earcutTriangles[$A]+$F);this.mUint16Array=new Uint16Array($J),this.mFloat32Array=new Float32Array($B)}$i.append(this.mUint16Array),$p.append(this.mFloat32Array)},$q}(),$Ii=function($i){function $t(){this._matrix=new $Q,this._matrix4=$xi.defaultMatrix4.concat(),$t.__super.call(this,1e4),this.shaderValue=new $Ri(0,0)}$S($t,"laya.webgl.submit.SubmitCanvas",$ti);var $p=$t.prototype;return $p.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var $i=$Mi.worldAlpha,$p=$Mi.worldMatrix4,$F=$Mi.worldMatrix,$J=$Mi.worldFilters,$A=$Mi.worldShaderDefines,$t=this.shaderValue,$q=this._matrix,$B=this._matrix4,$O=$Q.TEMP;return $Q.mul($q,$F,$O),$B[0]=$O.a,$B[1]=$O.b,$B[4]=$O.c,$B[5]=$O.d,$B[12]=$O.tx,$B[13]=$O.ty,$Mi.worldMatrix=$O.clone(),$Mi.worldMatrix4=$B,$Mi.worldAlpha=$Mi.worldAlpha*$t.alpha,$t.filters&&$t.filters.length&&($Mi.worldFilters=$t.filters,$Mi.worldShaderDefines=$t.defines),this._ctx_src.flush(),$Mi.worldAlpha=$i,$Mi.worldMatrix4=$p,$Mi.worldMatrix.destroy(),$Mi.worldMatrix=$F,$Mi.worldFilters=$J,$Mi.worldShaderDefines=$A,1},$p.releaseRender=function(){var $i=$t._cache;this._ctx_src=null,$i[$i._length++]=this},$p.getRenderType=function(){return 10003},$t.create=function($i,$p,$F){var $J=$t._cache._length?$t._cache[--$t._cache._length]:new $t;$J._ctx_src=$i;var $A=$J.shaderValue;return $A.alpha=$p,$A.defines.setValue(0),$F&&$F.length&&$A.setFilters($F),$J},$t._cache=(($t._cache=[])._length=0,$t._cache),$t}(),$Gi=function($i){function $U($i){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===$i&&($i=1e4),$U.__super.call(this,$i)}$S($U,"laya.webgl.submit.SubmitTexture",$ti);var $p=$U.prototype;return $p.releaseRender=function(){var $i=$U._cache;($i[$i._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},$p.addTexture=function($i,$p){this._texsID[this._texs.length]=$i._uvID,this._texs.push($i),this._vbPos.push($p)},$p.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var $i=this.shaderValue.textureHost.bitmap;if(null!==$i)for(var $p=this._vb.getFloat32Array(),$F=0,$J=this._texs.length;$F<$J;$F++){var $A=this._texs[$F];$A.active();var $t=$A.uv;if(this._texsID[$F]!==$A._uvID){this._texsID[$F]=$A._uvID;var $q=this._vbPos[$F];$p[$q+2]=$t[0],$p[$q+3]=$t[1],$p[$q+6]=$t[2],$p[$q+7]=$t[3],$p[$q+10]=$t[4],$p[$q+11]=$t[5],$p[$q+14]=$t[6],$p[$q+15]=$t[7],this._vb.setNeedUpload()}$A.bitmap!==$i&&(this._isSameTexture=!1)}}},$p.renderSubmit=function(){if(0===this._numEle)return $U._shaderSet=!1,1;var $i=this.shaderValue.textureHost;if($i){var $p=$i.source;if(!$i.bitmap||!$p)return $U._shaderSet=!1,1;this.shaderValue.texture=$p,$i.alphaTexture&&$i.alphaTexture.source&&(this.shaderValue.texture1=$i.alphaTexture.source)}this._vb.bind_upload(this._ib);var $F=$Ei.mainContext;if($K.activeBlendFunction!==this._blendFn&&($F.enable(3042),this._blendFn($F),$K.activeBlendFunction=this._blendFn),$m.drawCall++,$m.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&$yi.activeShader&&$U._shaderSet?($yi.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&$yi.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),$U._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var $J=$i.bitmap,$A=0,$t=$yi.activeShader,$q=0,$B=this._texs.length;$q<$B;$q++){var $O=this._texs[$q];$O.bitmap===$J&&$q+1!==$B||($t.uploadTexture2D($O.source),$F.drawElements(4,6*($q-$A+1),5123,this._startIdx+6*$A*$xi.BYTES_PIDX),$J=$O.bitmap,$A=$q)}else $F.drawElements(4,this._numEle,5123,this._startIdx);return 1},$U.create=function($i,$p,$F,$J,$A){var $t=$U._cache._length?$U._cache[--$U._cache._length]:new $U;null==$F&&(($F=$t._selfVb||($t._selfVb=$Hi.create(-1))).clear(),$J=0),$t._ib=$p,$t._vb=$F,$t._startIdx=$J*$xi.BYTES_PIDX,$t._numEle=0;var $q=$i._nBlendType;$t._blendFn=$i._targets?$K.targetFns[$q]:$K.fns[$q],$t.shaderValue=$A,$t.shaderValue.setValue($i._shader2D);var $B=$i._shader2D.filters;return $B&&$t.shaderValue.setFilters($B),$t},$U._cache=(($U._cache=[])._length=0,$U._cache),$U._shaderSet=!0,$U}(),$_i=function($i){function $r(){$r.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}$S($r,"laya.webgl.utils.MeshTexture",$ri);var $p=$r.prototype;return $p.addData=function($i,$p,$F,$J,$A,$t){for(var $q=$i.length/2,$B=this._vb.needSize($q*$r.const_stride)>>2,$O=this._vb.getFloat32Array(),$U=0,$d=0;$d<$q;$d++){var $u=$i[$U],$S=$i[$U+1],$Z=$u*$J.a+$S*$J.c+$J.tx,$s=$u*$J.b+$S*$J.d+$J.ty;$O[$B++]=$Z,$O[$B++]=$s,$O[$B++]=$p[$U],$O[$B++]=$p[$U+1],$U+=2}this._vb.setNeedUpload();var $x=this.vertNum;if(0<$x){($q=$F.length)>$r.tmpIdx.length&&($r.tmpIdx=new Uint16Array($q));for(var $j=0;$j<$q;$j++)$r.tmpIdx[$j]=$F[$j]+$x;this._ib.appendU16Array($r.tmpIdx,$F.length)}else this._ib.append($F);this._ib.setNeedUpload(),this.vertNum+=$q,this.indexNum+=$F.length},$p.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},$p.destroy=function(){this._ib.destroy(),this._vb.destroy()},$r.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new $r},$r.const_stride=16,$r._POOL=[],$q($r,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),$r}(),$yi=function($i){function $p(){$p.__super.call(this),this.lock=!0}return $S($p,"laya.webgl.shader.BaseShader",$D),$p.activeShader=null,$p.bindShader=null,$p}(),$Ni=function($p){function $d($i,$p,$F,$J,$A,$t,$q,$B,$O){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===$F&&($F=6408),void 0===$J&&($J=5121),void 0===$A&&($A=34041),void 0===$t&&($t=!1),void 0===$q&&($q=!1),void 0===$B&&($B=-1),void 0===$O&&($O=-1),this._type=1,this._w=$i,this._h=$p,this._surfaceFormat=$F,this._surfaceType=$J,this._depthStencilFormat=$A,$r.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=$t,this._repeat=$q,this._minFifter=$B,this._magFifter=$O,this._createWebGLRenderTarget(),this.bitmap.lock=!0,$d.__super.call(this,this.bitmap,$_.INV_UV)}$S($d,"laya.webgl.resource.RenderTarget2D",$p);var $i=$d.prototype;return $g.imps($i,{"laya.resource.IDispose":!0}),$i.getType=function(){return this._type},$i.getTexture=function(){return this},$i.size=function($i,$p){this._w==$i&&this._h==$p||(this._w=$i,this._h=$p,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},$i.release=function(){this.destroy()},$i.recycle=function(){$d.POOL.push(this)},$i.start=function(){var $i=$Ei.mainContext;return this._preRenderTarget=$Mi.curRenderTarget,$Mi.curRenderTarget=this,$i.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&($i.viewport(0,0,this._w,this._h),this._svWidth=$Mi.width,this._svHeight=$Mi.height,$Mi.width=this._w,$Mi.height=this._h,$yi.activeShader=null),this},$i.clear=function($i,$p,$F,$J){void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=1);var $A=$Ei.mainContext;$A.clearColor($i,$p,$F,$J);var $t=16384;switch(this._depthStencilFormat){case 33189:$t|=256;break;case 36168:$t|=1024;break;case 34041:$t|=256,$t|=1024}$A.clear($t)},$i.end=function(){var $i=$Ei.mainContext;$i.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,$Mi.curRenderTarget=this._preRenderTarget,1==this._type?($i.viewport(0,0,this._svWidth,this._svHeight),$Mi.width=this._svWidth,$Mi.height=this._svHeight,$yi.activeShader=null):$i.viewport(0,0,$g.stage.width,$g.stage.height)},$i.getData=function($i,$p,$F,$J){var $A=$Ei.mainContext;if($A.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===$A.checkFramebufferStatus(36160)))return $A.bindFramebuffer(36160,null),null;var $t=new Uint8Array(this._w*this._h*4);return $A.readPixels($i,$p,$F,$J,this._surfaceFormat,this._surfaceType,$t),$A.bindFramebuffer(36160,null),$t},$i.destroy=function($i){void 0===$i&&($i=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,$p.prototype.destroy.call(this))},$i.dispose=function(){},$i._createWebGLRenderTarget=function(){this.bitmap=new $wi(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function($i){this.event("recovered")})},$J(0,$i,"surfaceFormat",function(){return this._surfaceFormat}),$J(0,$i,"magFifter",function(){return this._magFifter}),$J(0,$i,"surfaceType",function(){return this._surfaceType}),$J(0,$i,"mipMap",function(){return this._mipMap}),$J(0,$i,"depthStencilFormat",function(){return this._depthStencilFormat}),$J(0,$i,"minFifter",function(){return this._minFifter}),$J(0,$i,"source",function(){return this._alreadyResolved?$g.superGet($_,this,"source"):null}),$d.create=function($i,$p,$F,$J,$A,$t,$q,$B,$O){void 0===$F&&($F=6408),void 0===$J&&($J=5121),void 0===$A&&($A=34041),void 0===$t&&($t=!1),void 0===$q&&($q=!1),void 0===$B&&($B=-1),void 0===$O&&($O=-1);var $U=$d.POOL.pop();return $U||($U=new $d($i,$p)),$U.bitmap&&$U._w==$i&&$U._h==$p&&$U._surfaceFormat==$F&&$U._surfaceType==$J&&$U._depthStencilFormat==$A&&$U._mipMap==$t&&$U._repeat==$q&&$U._minFifter==$B&&$U._magFifter==$O||($U._w=$i,$U._h=$p,$U._surfaceFormat=$F,$U._surfaceType=$J,$U._depthStencilFormat=$A,$r.isConchWebGL&&34041===$U._depthStencilFormat&&($U._depthStencilFormat=33189),$U._mipMap=$t,$U._repeat=$q,$U._minFifter=$B,$U._magFifter=$O,$U.release(),$U._createWebGLRenderTarget()),$U},$d.TYPE2D=1,$d.TYPE3D=2,$d.POOL=[],$d}($_),$fi=function($i){function $p(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,$p.__super.call(this),$p._gl=$Ei.mainContext}$S($p,"laya.webgl.utils.Buffer",$D);var $F=$p.prototype;return $F._bind=function(){this.activeResource(),$p._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&($p._bindVertexBuffer=this._glBuffer),$p._gl.bindBuffer(this._bufferType,$p._bindActive[this._bufferType]=this._glBuffer),$yi.activeShader=null)},$F.recreateResource=function(){this._glBuffer||(this._glBuffer=$p._gl.createBuffer()),this.completeCreate()},$F.disposeResource=function(){this._glBuffer&&($Ei.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},$J(0,$F,"bufferUsage",function(){return this._bufferUsage}),$p._gl=null,$p._bindActive={},$p._bindVertexBuffer=null,$p._enableAtributes=[],$p}(),$oi=function($i){function $F($i){this.texcoord=null,this.offsetX=300,this.offsetY=0,$F.__super.call(this,512,0);var $p=8*$xi.BYTES_PE;this.position=[2,5126,!1,$p,0],this.texcoord=[2,5126,!1,$p,2*$xi.BYTES_PE],this.color=[4,5126,!1,$p,4*$xi.BYTES_PE]}return $S($F,"laya.webgl.shader.d2.skinAnishader.SkinSV",$Ri),$F}(),$Wi=function($i){function $p($i){$p.__super.call(this,2,0),this.color=[]}return $S($p,"laya.webgl.shader.d2.value.Color2dSV",$Ri),$p.prototype.setValue=function($i){$i.fillStyle&&(this.color=$i.fillStyle._color._color),$i.strokeStyle&&(this.color=$i.strokeStyle._color._color)},$p}(),$Li=function($i){function $p($i){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=$Ri._TEXCOORD,$p.__super.call(this,256,0)}$S($p,"laya.webgl.shader.d2.value.FillTextureSV",$Ri);var $F=$p.prototype;return $F.setValue=function($i){this.ALPHA=$i.ALPHA,$i.filters&&this.setFilters($i.filters)},$F.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$p}(),$Ci=function($i){function $p($i){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=$Ri._TEXCOORD,void 0===$i&&($i=0),$p.__super.call(this,1,$i)}$S($p,"laya.webgl.shader.d2.value.TextureSV",$Ri);var $F=$p.prototype;return $F.setValue=function($i){this.ALPHA=$i.ALPHA,$i.filters&&this.setFilters($i.filters)},$F.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},$p}(),$Ki=function($i){function $p($i){this.a_color=null,this.u_pos=[0,0],$p.__super.call(this,4,0),this.position=[2,5126,!1,5*$xi.BYTES_PE,0],this.a_color=[3,5126,!1,5*$xi.BYTES_PE,2*$xi.BYTES_PE]}return $S($p,"laya.webgl.shader.d2.value.PrimitiveSV",$Ri),$p}(),$Vi=function($i){function $p(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,$p.__super.call(this)}$S($p,"laya.webgl.atlas.AtlasWebGLCanvas",$i);var $F=$p.prototype;return $F.recreateResource=function(){var $i=$Ei.mainContext,$p=this._source=$i.createTexture(),$F=$vi.curBindTexTarget,$J=$vi.curBindTexValue;$vi.bindTexture($i,3553,$p),$i.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),$i.texParameteri(3553,10241,9729),$i.texParameteri(3553,10240,9729),$i.texParameteri(3553,10242,33071),$i.texParameteri(3553,10243,33071),$F&&$J&&$vi.bindTexture($i,$F,$J),this.memorySize=this._w*this._h*4,this.completeCreate()},$F.disposeResource=function(){this._source&&($Ei.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$F.texSubImage2D=function($i,$p,$F){if($r.isFlash){this._flashCacheImage||(this._flashCacheImage=$x.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var $J=$F.bitmapdata;this._flashCacheImage._image.copyPixels($J,0,0,$J.width,$J.height,$i,$p),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var $A=$Ei.mainContext,$t=$vi.curBindTexTarget,$q=$vi.curBindTexValue;$vi.bindTexture($A,3553,this._source),$A.pixelStorei(37441,!0),0<=$i-1&&$A.texSubImage2D(3553,0,$i-1,$p,6408,5121,$F),$i+1<=this._w&&$A.texSubImage2D(3553,0,$i+1,$p,6408,5121,$F),0<=$p-1&&$A.texSubImage2D(3553,0,$i,$p-1,6408,5121,$F),$p+1<=this._h&&$A.texSubImage2D(3553,0,$i,$p+1,6408,5121,$F),$A.texSubImage2D(3553,0,$i,$p,6408,5121,$F),$A.pixelStorei(37441,!1),$t&&$q&&$vi.bindTexture($A,$t,$q)}},$F.texSubImage2DPixel=function($i,$p,$F,$J,$A){var $t=$Ei.mainContext,$q=$vi.curBindTexTarget,$B=$vi.curBindTexValue;$vi.bindTexture($t,3553,this._source);var $O=new Uint8Array($A.data);$t.pixelStorei(37441,!0),$t.texSubImage2D(3553,0,$i,$p,$F,$J,6408,5121,$O),$t.pixelStorei(37441,!1),$q&&$B&&$vi.bindTexture($t,$q,$B)},$J(0,$F,"width",$i.prototype._$get_width,function($i){this._w=$i}),$J(0,$F,"height",$i.prototype._$get_height,function($i){this._h=$i}),$p}($F),$Ti=function($i){function $A(){this.flipY=!0,this.alwaysChange=!1,$A.__super.call(this)}$S($A,"laya.webgl.resource.WebGLCanvas",$F);var $p=$A.prototype;return $p.getCanvas=function(){return this._canvas},$p.clear=function(){this._ctx&&this._ctx.clear()},$p.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},$p._setContext=function($i){this._ctx=$i},$p.getContext=function($i,$p){return this._ctx?this._ctx:this._ctx=$A._createContext(this)},$p.size=function($i,$p){this._w==$i&&this._h==$p||(this._w=$i,this._h=$p,this._ctx&&this._ctx.size($i,$p),this._canvas&&(this._canvas.height=$p,this._canvas.width=$i))},$p.activeResource=function($i){void 0===$i&&($i=!1),this._source||this.recreateResource()},$p.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},$p.disposeResource=function(){this._source&&!this.iscpuSource&&($Ei.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$p.createWebGlTexture=function(){var $i=$Ei.mainContext;this._canvas;var $p=this._source=$i.createTexture();this.iscpuSource=!1;var $F=$vi.curBindTexTarget,$J=$vi.curBindTexValue;$vi.bindTexture($i,3553,$p),$i.pixelStorei(37440,this.flipY?1:0),$A.premulAlpha&&$i.pixelStorei(37441,!0),$i.texImage2D(3553,0,6408,6408,5121,this._imgData),$A.premulAlpha&&$i.pixelStorei(37441,!1),$i.texParameteri(3553,10240,9729),$i.texParameteri(3553,10241,9729),$i.texParameteri(3553,10242,33071),$i.texParameteri(3553,10243,33071),$i.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,$F&&$J&&$vi.bindTexture($i,$F,$J)},$p.reloadCanvasData=function(){var $i=$Ei.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var $p=$vi.curBindTexTarget,$F=$vi.curBindTexValue;$vi.bindTexture($i,3553,this._source),$A.premulAlpha&&$i.pixelStorei(37441,!0),$i.texImage2D(3553,0,6408,6408,5121,this._imgData),$A.premulAlpha&&$i.pixelStorei(37441,!1),$i.pixelStorei(37440,0),$p&&$F&&$vi.bindTexture($i,$p,$F)},$p.texSubImage2D=function($i,$p,$F){var $J=$Ei.mainContext,$A=$vi.curBindTexTarget,$t=$vi.curBindTexValue;$vi.bindTexture($J,3553,this._source),$J.pixelStorei(37441,!0),$J.texSubImage2D(3553,0,$p,$F,6408,5121,$i._source),$J.pixelStorei(37441,!1),$A&&$t&&$vi.bindTexture($J,$A,$t)},$p.toBase64=function($i,$p,$F){var $J=null;this._canvas&&($J=this._canvas.toDataURL($i,$p)),$F.call(this,$J)},$J(0,$p,"context",function(){return this._ctx}),$J(0,$p,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),$J(0,$p,"asBitmap",null,function($i){this._ctx&&(this._ctx.asBitmap=$i)}),$A._createContext=null,$A.premulAlpha=!1,$A}(),$ki=function($i){function $t($i,$p){this.CborderSize=12,$t.__super.call(this),this.char=$i,this.isSpace=" "===$i,this.xs=$p.scaleX,this.ys=$p.scaleY,this.font=$p.font.toString(),this.fontSize=$p.font.size,this.fillColor=$p.fillColor,this.borderColor=$p.borderColor,this.lineWidth=$p.lineWidth,this.underLine=$p.underLine;var $F,$J=$r.isConchApp;$J?(($F=ConchTextCanvas)._source=ConchTextCanvas,$F._source.canvas=ConchTextCanvas):$F=$Z.canvas.source,this.canvas=$F,this._enableMerageInAtlas=!0,this._ctx=$J?$F:this.canvas.getContext("2d",void 0);var $A=$y.measureText(this.char,this.font);this.cw=$A.width*this.xs,this.ch=($A.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new $_(this)}$S($t,"laya.webgl.resource.WebGLCharImage",$F);var $p=$t.prototype;return $g.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p.active=function(){this.texture.active()},$p.recreateResource=function(){var $i=$r.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),$i){var $p=this.fontSize;1==this.xs&&1==this.ys||($p=parseInt($p*(this.xs>this.ys?this.xs:this.ys)+""));var $F="normal 100 "+this.font;$F=$F.replace($t._fontSizeReg,$p),this.borderColor&&($F+=" 1 "+this.borderColor),this._ctx.font=$F,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,$G.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var $J=this._ctx.measureText(this.char);$J||($J={width:16});var $A=$J.width+1;this._ctx.lineTo($A,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},$p.onresize=function($i,$p){this._w=$i,this._h=$p,this._allowMerageInAtlas=!0},$p.clearAtlasSource=function(){},$J(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$J(0,$p,"atlasSource",function(){return this.canvas}),$J(0,$p,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function($i){this._enableMerageInAtlas=$i}),$t.createOneChar=function($i,$p){return new $t($i,$p)},$t._fontSizeReg=new RegExp("\\d+(?=px)","g"),$t}(),$wi=function($i){function $U($i,$p,$F,$J,$A,$t,$q,$B,$O){void 0===$F&&($F=6408),void 0===$J&&($J=5121),void 0===$A&&($A=34041),void 0===$t&&($t=!1),void 0===$q&&($q=!1),void 0===$B&&($B=-1),void 0===$O&&($O=1),$U.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=$i,this._h=$p,this._surfaceFormat=$F,this._surfaceType=$J,this._depthStencilFormat=$A,this._mipMap=$t,this._repeat=$q,this._minFifter=$B,this._magFifter=$O}$S($U,"laya.webgl.resource.WebGLRenderTarget",$F);var $p=$U.prototype;return $p.recreateResource=function(){var $i=$Ei.mainContext;this._frameBuffer||(this._frameBuffer=$i.createFramebuffer()),this._source||(this._source=$i.createTexture());var $p=$vi.curBindTexTarget,$F=$vi.curBindTexValue;$vi.bindTexture($i,3553,this._source),$i.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var $J=this._minFifter,$A=this._magFifter,$t=this._repeat?10497:33071,$q=$d.isPOT(this._w,this._h);if($q?(this._mipMap?-1!==$J||($J=9987):-1!==$J||($J=9729),-1!==$A||($A=9729),$i.texParameteri(3553,10241,$J),$i.texParameteri(3553,10240,$A),$i.texParameteri(3553,10242,$t),$i.texParameteri(3553,10243,$t),this._mipMap&&$i.generateMipmap(3553)):(-1!==$J||($J=9729),-1!==$A||($A=9729),$i.texParameteri(3553,10241,$J),$i.texParameteri(3553,10240,$A),$i.texParameteri(3553,10242,33071),$i.texParameteri(3553,10243,33071)),$i.bindFramebuffer(36160,this._frameBuffer),$i.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=$i.createRenderbuffer()),$i.bindRenderbuffer(36161,this._depthStencilBuffer),$i.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:$i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$i.bindFramebuffer(36160,null),$p&&$F&&$vi.bindTexture($i,$p,$F),$i.bindRenderbuffer(36161,null),$q&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},$p.disposeResource=function(){this._frameBuffer&&($Ei.mainContext.deleteTexture(this._source),$Ei.mainContext.deleteFramebuffer(this._frameBuffer),$Ei.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0,this.uri=null)},$J(0,$p,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$J(0,$p,"frameBuffer",function(){return this._frameBuffer}),$U}(),$$i=function($i){function $B($i,$p,$F,$J,$A,$t,$q){this.offsetX=0,this.offsetY=0,$B.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=$t,this.canvas=$i,this._ctx=$i.getContext("2d",void 0),this._w=$J,this._h=$A,this.offsetX=$p,this.offsetY=$F,this.src=$q,this._enableMerageInAtlas=!0,$L.enabled&&this._w<$L.atlasLimitWidth&&this._h<$L.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}$S($B,"laya.webgl.resource.WebGLSubImage",$F);var $p=$B.prototype;return $g.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p.size=function($i,$p){this._w=$i,this._h=$p,this._ctx&&this._ctx.size($i,$p),this.canvas&&(this.canvas.height=$p,this.canvas.width=$i)},$p.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},$p.createWebGlTexture=function(){var $i=$Ei.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var $p=this._source=$i.createTexture(),$F=$vi.curBindTexTarget,$J=$vi.curBindTexValue;$vi.bindTexture($i,3553,$p),$i.pixelStorei(37441,!0),$i.texImage2D(3553,0,6408,6408,5121,this.canvas),$i.pixelStorei(37441,!1);var $A=this.minFifter,$t=this.magFifter,$q=this.repeat?10497:33071,$B=$d.isPOT(this.width,this.height);$B?(this.mipmap?-1!==$A||($A=9987):-1!==$A||($A=9729),-1!==$t||($t=9729),$i.texParameteri(3553,10240,$t),$i.texParameteri(3553,10241,$A),$i.texParameteri(3553,10242,$q),$i.texParameteri(3553,10243,$q),this.mipmap&&$i.generateMipmap(3553)):(-1!==$A||($A=9729),-1!==$t||($t=9729),$i.texParameteri(3553,10241,$A),$i.texParameteri(3553,10240,$t),$i.texParameteri(3553,10242,33071),$i.texParameteri(3553,10243,33071)),$F&&$J&&$vi.bindTexture($i,$F,$J),this.canvas=null,$B&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},$p.disposeResource=function(){$L.enabled&&this._allowMerageInAtlas||!this._source||($Ei.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$p.clearAtlasSource=function(){},$J(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$J(0,$p,"atlasSource",function(){return this.canvas}),$J(0,$p,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function($i){this._allowMerageInAtlas=$i}),$B}(),$Xi=function($i){function $U($i,$p,$F,$J){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,$U.__super.call(this),!$i||!$p)throw"Shader Error";this._id=++$U._count,this._vs=$i,this._ps=$p,this._nameMap=$J||{},null!=$F&&($U.sharders[$F]=this)}$S($U,"laya.webgl.shader.Shader",$yi);var $p=$U.prototype;return $p.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},$p.disposeResource=function(){$Ei.mainContext.deleteShader(this._vshader),$Ei.mainContext.deleteShader(this._pshader),$Ei.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},$p._compile=function(){if(!$Ei.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var $i=[this._vs,this._ps],$p=$Ei.mainContext;if(this._program=$p.createProgram(),this._vshader=$U._createShader($p,$i[0],35633),this._pshader=$U._createShader($p,$i[1],35632),$p.attachShader(this._program,this._vshader),$p.attachShader(this._program,this._pshader),$p.linkProgram(this._program),!$r.isConchApp&&!$p.getProgramParameter(this._program,35714))throw $p.getProgramInfoLog(this._program);var $F,$J,$A=0,$t=0;for($t=$r.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35721):$p.getProgramParameter(this._program,35721),$A=0;$A<$t;$A++){var $q=null;$F={vartype:"attribute",glfun:null,ivartype:0,attrib:$q=$r.isConchApp?$p.getActiveAttribEx(this._vs,this._ps,"",$A):$p.getActiveAttrib(this._program,$A),location:$p.getAttribLocation(this._program,$q.name),name:$q.name,type:$q.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push($F)}var $B=0;for($B=$r.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35718):$p.getProgramParameter(this._program,35718),$A=0;$A<$B;$A++){var $O=null;$O=$r.isConchApp?$p.getActiveUniformEx(this._vs,this._ps,"",$A):$p.getActiveUniform(this._program,$A),0<($F={vartype:"uniform",glfun:null,ivartype:1,attrib:$q,location:$p.getUniformLocation(this._program,$O.name),name:$O.name,type:$O.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($F.name=$F.name.substr(0,$F.name.length-3),$F.isArray=!0,$F.location=$p.getUniformLocation(this._program,$F.name)),this._params.push($F)}for($A=0,$J=this._params.length;$A<$J;$A++)if(($F=this._params[$A]).indexOfParams=$A,$F.index=1,$F.value=[$F.location,null],$F.codename=$F.name,$F.name=this._nameMap[$F.codename]?this._nameMap[$F.codename]:$F.codename,(this._paramsMap[$F.name]=$F)._this=this,$F.uploadedValue=[],"attribute"!==$F.vartype)switch($F.type){case 5124:$F.fun=$F.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$F.fun=$F.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$F.fun=$F.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$F.fun=$F.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$F.fun=$F.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$F.fun=this._uniform_sampler2D;break;case 35680:$F.fun=this._uniform_samplerCube;break;case 35676:$F.glfun=$p.uniformMatrix4fv,$F.fun=this._uniformMatrix4fv;break;case 35670:$F.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else $F.fun=this._attribute}},$p.getUniform=function($i){return this._paramsMap[$i]},$p._attribute=function($i,$p){var $F=$Ei.mainContext,$J=$fi._enableAtributes,$A=$i.location;return $J[$A]||$F.enableVertexAttribArray($A),$F.vertexAttribPointer($A,$p[0],$p[1],$p[2],$p[3],$p[4]+this._offset),$J[$A]=$fi._bindVertexBuffer,1},$p._uniform1f=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p?($Ei.mainContext.uniform1f($i.location,$F[0]=$p),1):0},$p._uniform1fv=function($i,$p){if($p.length<4){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($Ei.mainContext.uniform1fv($i.location,$p),$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3],1):0}return $Ei.mainContext.uniform1fv($i.location,$p),1},$p._uniform_vec2=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]?($Ei.mainContext.uniform2f($i.location,$F[0]=$p[0],$F[1]=$p[1]),1):0},$p._uniform_vec2v=function($i,$p){if($p.length<2){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($Ei.mainContext.uniform2fv($i.location,$p),$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3],1):0}return $Ei.mainContext.uniform2fv($i.location,$p),1},$p._uniform_vec3=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]?($Ei.mainContext.uniform3f($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2]),1):0},$p._uniform_vec3v=function($i,$p){return $Ei.mainContext.uniform3fv($i.location,$p),1},$p._uniform_vec4=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($Ei.mainContext.uniform4f($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3]),1):0},$p._uniform_vec4v=function($i,$p){return $Ei.mainContext.uniform4fv($i.location,$p),1},$p._uniformMatrix2fv=function($i,$p){return $Ei.mainContext.uniformMatrix2fv($i.location,!1,$p),1},$p._uniformMatrix3fv=function($i,$p){return $Ei.mainContext.uniformMatrix3fv($i.location,!1,$p),1},$p._uniformMatrix4fv=function($i,$p){return $Ei.mainContext.uniformMatrix4fv($i.location,!1,$p),1},$p._uniform1i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p?($Ei.mainContext.uniform1i($i.location,$F[0]=$p),1):0},$p._uniform1iv=function($i,$p){return $Ei.mainContext.uniform1iv($i.location,$p),1},$p._uniform_ivec2=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]?($Ei.mainContext.uniform2i($i.location,$F[0]=$p[0],$F[1]=$p[1]),1):0},$p._uniform_ivec2v=function($i,$p){return $Ei.mainContext.uniform2iv($i.location,$p),1},$p._uniform_vec3i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]?($Ei.mainContext.uniform3i($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2]),1):0},$p._uniform_vec3vi=function($i,$p){return $Ei.mainContext.uniform3iv($i.location,$p),1},$p._uniform_vec4i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($Ei.mainContext.uniform4i($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3]),1):0},$p._uniform_vec4vi=function($i,$p){return $Ei.mainContext.uniform4iv($i.location,$p),1},$p._uniform_sampler2D=function($i,$p){var $F=$Ei.mainContext,$J=$i.uploadedValue;return null==$J[0]?($J[0]=this._curActTexIndex,$F.uniform1i($i.location,this._curActTexIndex),$F.activeTexture($U._TEXTURES[this._curActTexIndex]),$vi.bindTexture($F,3553,$p),this._curActTexIndex++,1):($F.activeTexture($U._TEXTURES[$J[0]]),$vi.bindTexture($F,3553,$p),0)},$p._uniform_samplerCube=function($i,$p){var $F=$Ei.mainContext,$J=$i.uploadedValue;return null==$J[0]?($J[0]=this._curActTexIndex,$F.uniform1i($i.location,this._curActTexIndex),$F.activeTexture($U._TEXTURES[this._curActTexIndex]),$vi.bindTexture($F,34067,$p),this._curActTexIndex++,1):($F.activeTexture($U._TEXTURES[$J[0]]),$vi.bindTexture($F,34067,$p),0)},$p._noSetValue=function($i){console.log("no....:"+$i.name)},$p.uploadOne=function($i,$p){this.activeResource(),$vi.UseProgram(this._program);var $F=this._paramsMap[$i];$F.fun.call(this,$F,$p)},$p.uploadTexture2D=function($i){$m.shaderCall++;var $p=$Ei.mainContext;$p.activeTexture(33984),$vi.bindTexture($p,3553,$i)},$p.uploadTexture2D1=function($i){$m.shaderCall++;var $p=$Ei.mainContext;$p.activeTexture(33985),$vi.bindTexture($p,3553,$i)},$p.upload=function($i,$p){$yi.activeShader=$yi.bindShader=this,this._lastUseFrameCount===$m.loopCount||this.activeResource(),$vi.UseProgram(this._program),this._reCompile?($p=this._params,this._reCompile=!1):$p=$p||this._params;$Ei.mainContext;for(var $F,$J,$A=$p.length,$t=0,$q=0;$q<$A;$q++)null!==($J=$i[($F=$p[$q]).name])&&($t+=$F.fun.call(this,$F,$J));$m.shaderCall+=$t},$p.uploadArray=function($i,$p,$F){$yi.activeShader=this,($yi.bindShader=this).activeResource(),$vi.UseProgram(this._program);this._params;for(var $J,$A,$t=0,$q=$p-2;0<=$q;$q-=2)($A=this._paramsMap[$i[$q]])&&null!=($J=$i[$q+1])&&($F&&$F[$A.name]&&$F[$A.name].bind(),$t+=$A.fun.call(this,$A,$J));$m.shaderCall+=$t},$p.getParams=function(){return this._params},$U.getShader=function($i){return $U.sharders[$i]},$U.create=function($i,$p,$F,$J){return new $U($i,$p,$F,$J)},$U.withCompile=function($i,$p,$F,$J){if($F&&$U.sharders[$F])return $U.sharders[$F];var $A=$U._preCompileShader[2e-4*$i];if(!$A)throw new Error("withCompile shader err!"+$i);return $A.createShader($p,$F,$J)},$U.withCompile2D=function($i,$p,$F,$J,$A){if($J&&$U.sharders[$J])return $U.sharders[$J];var $t=$U._preCompileShader[2e-4*$i+$p];if(!$t)throw new Error("withCompile shader err!"+$i+" "+$p);return $t.createShader($F,$J,$A)},$U.addInclude=function($i,$p){$Di.addInclude($i,$p)},$U.preCompile=function($i,$p,$F,$J){var $A=2e-4*$i;$U._preCompileShader[$A]=new $Di($A,$p,$F,$J)},$U.preCompile2D=function($i,$p,$F,$J,$A){var $t=2e-4*$i+$p;$U._preCompileShader[$t]=new $Di($t,$F,$J,$A)},$U._createShader=function($i,$p,$F){var $J=$i.createShader($F);return $i.shaderSource($J,$p),$i.compileShader($J),$J},$U._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],$U._count=0,$U._preCompileShader={},$U.SHADERNAME2ID=2e-4,$U.sharders=(($U.sharders=[]).length=32,$U.sharders),$q($U,["nameKey",function(){return this.nameKey=new $n}]),$U}(),$ei=function($i){function $p(){this._maxsize=0,this._upload=!0,this._uploadSize=0,$p.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}$S($p,"laya.webgl.utils.Buffer2D",$i);var $F=$p.prototype;return $F.needSize=function($i){var $p=this._byteLength;if($i){var $F=this._byteLength+$i;$F<=this._buffer.byteLength||this._resizeBuffer($F<<1,!0),this._byteLength=$F}return $p},$F._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$m.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$fi._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$fi._gl.bufferSubData(this._bufferType,0,this._buffer)},$F._bufferSubData=function($i,$p,$F){if(void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$m.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,$fi._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),$p||$F){var $J=this._buffer.slice($p,$F);$fi._gl.bufferSubData(this._bufferType,$i,$J)}else $fi._gl.bufferSubData(this._bufferType,$i,this._buffer)},$F._checkArrayUse=function(){},$F._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},$F._bind_subUpload=function($i,$p,$F){return void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData($i,$p,$F),!0)},$F._resizeBuffer=function($i,$p){if($i<this._buffer.byteLength)return this;if(this.memorySize=$i,$p&&this._buffer&&0<this._buffer.byteLength){var $F=new ArrayBuffer($i);new Uint8Array($F).set(new Uint8Array(this._buffer),0),this._buffer=$F}else this._buffer=new ArrayBuffer($i);return this._checkArrayUse(),this._upload=!0,this},$F.append=function($i){this._upload=!0;var $p,$F;$p=$i.byteLength,$i instanceof Uint8Array?(this._resizeBuffer(this._byteLength+$p,!0),$F=new Uint8Array(this._buffer,this._byteLength)):$i instanceof Uint16Array?(this._resizeBuffer(this._byteLength+$p,!0),$F=new Uint16Array(this._buffer,this._byteLength)):$i instanceof Float32Array&&(this._resizeBuffer(this._byteLength+$p,!0),$F=new Float32Array(this._buffer,this._byteLength)),$F.set($i,0),this._byteLength+=$p,this._checkArrayUse()},$F.appendU16Array=function($i,$p){this._resizeBuffer(this._byteLength+2*$p,!0);for(var $F=new Uint16Array(this._buffer,this._byteLength,$p),$J=0;$J<$p;$J++)$F[$J]=$i[$J];this._byteLength+=2*$p,this._checkArrayUse()},$F.appendEx=function($i,$p){this._upload=!0;var $F;$F=$i.byteLength,this._resizeBuffer(this._byteLength+$F,!0),new $p(this._buffer,this._byteLength).set($i,0),this._byteLength+=$F,this._checkArrayUse()},$F.appendEx2=function($i,$p,$F,$J){void 0===$J&&($J=1),this._upload=!0;var $A,$t;$A=$F*$J,this._resizeBuffer(this._byteLength+$A,!0),$t=new $p(this._buffer,this._byteLength);var $q=0;for($q=0;$q<$F;$q++)$t[$q]=$i[$q];this._byteLength+=$A,this._checkArrayUse()},$F.getBuffer=function(){return this._buffer},$F.setNeedUpload=function(){this._upload=!0},$F.getNeedUpload=function(){return this._upload},$F.upload=function(){var $i=this._bind_upload();return $fi._gl.bindBuffer(this._bufferType,null),$fi._bindActive[this._bufferType]=null,$yi.activeShader=null,$i},$F.subUpload=function($i,$p,$F){void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0);var $J=this._bind_subUpload();return $fi._gl.bindBuffer(this._bufferType,null),$fi._bindActive[this._bufferType]=null,$yi.activeShader=null,$J},$F.disposeResource=function(){$i.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},$F.clear=function(){this._byteLength=0,this._upload=!0},$J(0,$F,"bufferLength",function(){return this._buffer.byteLength}),$J(0,$F,"byteLength",null,function($i){this._byteLength!==$i&&($i<=this._buffer.byteLength||this._resizeBuffer(2*$i+256,!0),this._byteLength=$i)}),$p.__int__=function($i){$li.QuadrangleIB=$li.create(35044),$ji.fillIBQuadrangle($li.QuadrangleIB,16)},$p.FLOAT32=4,$p.SHORT=2,$p}($fi),$bi=(function($p){function $F($i){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,$F.__super.call(this,9)}$S($F,"laya.webgl.shader.d2.value.GlowSV",$p);var $i=$F.prototype;$i.setValue=function($i){$p.prototype.setValue.call(this,$i)},$i.clear=function(){$p.prototype.clear.call(this)}}($Ci),function($i){function $p($i){$p.__super.call(this,64),this.defines.add(64)}$S($p,"laya.webgl.shader.d2.value.TextSV",$i);var $F=$p.prototype;return $F.release=function(){($p.pool[$p._length++]=this).clear()},$F.clear=function(){$i.prototype.clear.call(this)},$p.create=function(){return $p._length?$p.pool[--$p._length]:new $p(null)},$p.pool=[],$p._length=0,$p}($Ci)),$zi=function($i){function $A($i,$p,$F,$J){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,$A.__super.call(this,$i,$p,$F,$J)}$S($A,"laya.webgl.shader.d2.Shader2X",$i);var $p=$A.prototype;return $p.upload2dQuick1=function($i){this.upload($i,this._params2dQuick1||this._make2dQuick1())},$p._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var $i,$p=this._params,$F=0,$J=$p.length;$F<$J;$F++)$i=$p[$F],($r.isFlash||"size"!==$i.name&&"position"!==$i.name&&"texcoord"!==$i.name)&&this._params2dQuick1.push($i)}return this._params2dQuick1},$p.disposeResource=function(){$i.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},$p.upload2dQuick2=function($i){this.upload($i,this._params2dQuick2||this._make2dQuick2())},$p._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var $i,$p=this._params,$F=0,$J=$p.length;$F<$J;$F++)$i=$p[$F],($r.isFlash||"size"!==$i.name)&&this._params2dQuick2.push($i)}return this._params2dQuick2},$A.create=function($i,$p,$F,$J){return new $A($i,$p,$F,$J)},$A}($Xi),$li=function($i){function $p($i){this._uint8Array=null,this._uint16Array=null,void 0===$i&&($i=35044),$p.__super.call(this),this._bufferUsage=$i,this._bufferType=34963,$r.isFlash||(this._buffer=new ArrayBuffer(8))}$S($p,"laya.webgl.utils.IndexBuffer2D",$ei);var $F=$p.prototype;return $F._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},$F.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},$F.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},$F.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},$p.QuadrangleIB=null,$p.create=function($i){return void 0===$i&&($i=35044),new $p($i)},$p}(),$Hi=function($i){function $F($i,$p){this._floatArray32=null,this._vertexStride=0,$F.__super.call(this),this._vertexStride=$i,this._bufferUsage=$p,this._bufferType=34962,$r.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}$S($F,"laya.webgl.utils.VertexBuffer2D",$i);var $p=$F.prototype;return $p.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},$p.bind=function($i){$i&&$i._bind(),this._bind()},$p.insertData=function($i,$p){this.getFloat32Array().set($i,$p),this._upload=!0},$p.bind_upload=function($i){$i._bind_upload()||$i._bind(),this._bind_upload()||this._bind()},$p._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},$p.disposeResource=function(){$i.prototype.disposeResource.call(this)},$p.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},$J(0,$p,"vertexStride",function(){return this._vertexStride}),$F.create=function($i,$p){return void 0===$p&&($p=35048),new $F($i,$p)},$F}($ei),$ip=function($i){function $B($i,$p,$F,$J,$A,$t){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===$F&&($F=6408),void 0===$J&&($J=!0),$B.__super.call(this,$i,$p),$i){if(this._format=$F,this._mipmap=$J,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof $i)this._url=$i,this._src=$i,this._image=new $Z.window.Image,$p&&($p.onload&&(this.onload=$p.onload),$p.onerror&&(this.onerror=$p.onerror),$p.onCreate&&$p.onCreate(this)),this._image.crossOrigin=$i&&0==$i.indexOf("data:")?null:"",$i&&(this._image.src=$i);else if($i instanceof ArrayBuffer){this._src=$p,this._url=this._src;var $q=new $O($i);$q.readUTFBytes(4),$q.readUTFBytes(2),$q.getInt16();$q.endian="bigEndian",this._w=$q.getInt16(),this._h=$q.getInt16();$q.getInt16(),$q.getInt16();this._image=new Uint8Array($i,$q.pos),this._format=$Ei.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,$L.enabled&&this._w<$L.atlasLimitWidth&&this._h<$L.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!($i instanceof Uint8Array))return this._src=$p,this._url=this._src,this._image=$i.source||$i,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=$p,this._url=this._src,this._w=$A,this._h=$t,this._image=$i,this._format=0===$F?$i.byteLength/($A*$t)==4?6408:6407:$F}this._$5__enableMerageInAtlas=!0}}$S($B,"laya.webgl.resource.WebGLImage",$x);var $p=$B.prototype;return $g.imps($p,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),$p._init_=function($i,$p){},$p._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $i=$Ei.mainContext,$p=this._source=$i.createTexture(),$F=$vi.curBindTexTarget,$J=$vi.curBindTexValue;$vi.bindTexture($i,3553,$p);var $A=this.minFifter,$t=this.magFifter,$q=this.repeat?10497:33071,$B=$d.isPOT(this._w,this._h),$O=!1;switch($B?(this.mipmap?-1!==$A||($A=9987):-1!==$A||($A=9729),-1!==$t||($t=9729),$i.texParameteri(3553,10241,$A),$i.texParameteri(3553,10240,$t),$i.texParameteri(3553,10242,$q),$i.texParameteri(3553,10243,$q),this.mipmap&&$i.generateMipmap(3553)):(-1!==$A||($A=9729),-1!==$t||($t=9729),$i.texParameteri(3553,10241,$A),$i.texParameteri(3553,10240,$t),$i.texParameteri(3553,10242,33071),$i.texParameteri(3553,10243,33071)),$i.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&$i.pixelStorei($i.UNPACK_ALIGNMENT,1),$i.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&$i.pixelStorei($i.UNPACK_ALIGNMENT,1),$i.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:$O=!0,$i.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case $Ei.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$O=!0,$i.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}$i.pixelStorei(37441,!1),$F&&$J&&$vi.bindTexture($i,$F,$J),this.uri||(this.uri=this._url),$O?this.memorySize=this._image.length:$B&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},$p.recreateResource=function(){var $i=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var $p=this;this._image=new $Z.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if($p._needReleaseAgain)return $p._needReleaseAgain=!1,$p._image.onload=null,void($p._image=null);$p._allowMerageInAtlas&&$p._enableMerageInAtlas?($i.memorySize=0,$i._recreateLock=!1):$p._createWebGlTexture(),$p.completeCreate()},this._image.src=this._src}},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&$Ei.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},$p.onresize=function(){this._w=this._image.width,this._h=this._image.height,$L.enabled&&this._w<$L.atlasLimitWidth&&this._h<$L.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},$p.clearAtlasSource=function(){this._image=null},$J(0,$p,"format",function(){return this._format}),$J(0,$p,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function($i){this._$5__enableMerageInAtlas=$i}),$J(0,$p,"mipmap",function(){return this._mipmap}),$J(0,$p,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),$J(0,$p,"atlasSource",function(){return this._image}),$J(0,$p,"onload",null,function($i){var $p=this;this._onload=$i,this._image&&(this._image.onload=null!=this._onload?function(){$p.onresize(),$p._onload()}:null)}),$J(0,$p,"onerror",null,function($i){var $p=this;this._onerror=$i,this._image&&(this._image.onerror=null!=this._onerror?function(){$p._onerror()}:null)}),$B}();$g.__init([$Zi,$W,$ai,$Di])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}}),function($t,$i,$J){$J.un,$J.uns;var $A=$J.static,$q=$J.class,$B=$J.getset,$O=($J.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),$s=laya.utils.ClassUtils,$u=(laya.events.Event,laya.utils.HTMLChar),$U=laya.net.Loader,$d=(laya.display.Node,laya.maths.Rectangle),$S=laya.renders.Render,$Z=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),$x=laya.utils.Stat,$y=laya.display.Text,$j=laya.resource.Texture,$r=laya.net.URL,$M=laya.utils.Utils,$D=function(){function $Z(){}return $q($Z,"laya.html.utils.HTMLParse"),$Z.parse=function($i,$p,$F){$p=($p="<root>"+($p=$p.replace(/<br>/g,"<br/>"))+"</root>").replace($Z.spacePattern,$Z.char255);var $J=$M.parseXMLFromString($p);$Z._parseXML($i,$J.childNodes[0].childNodes,$F)},$Z._parseXML=function($i,$p,$F,$J){var $A=0,$t=0;if($p.join||$p.item)for($A=0,$t=$p.length;$A<$t;++$A)$Z._parseXML($i,$p[$A],$F,$J);else{var $q,$B,$O;if(3==$p.nodeType)return void($i instanceof laya.html.dom.HTMLDivElement?(null==$p.nodeName&&($p.nodeName="#text"),$B=$p.nodeName.toLowerCase(),0<($O=$p.textContent.replace(/^\s+|\s+$/g,"")).length&&($q=$s.getInstance($B))&&($i.addChild($q),$q.innerTEXT=$O.replace($Z.char255AndOneSpacePattern," "))):0<($O=$p.textContent.replace(/^\s+|\s+$/g,"")).length&&($i.innerTEXT=$O.replace($Z.char255AndOneSpacePattern," ")));if("#comment"==($B=$p.nodeName.toLowerCase()))return;if($q=$s.getInstance($B)){($q=$i.addChild($q)).URI=$F,$q.href=$J;var $U=$p.attributes;if($U&&0<$U.length)for($A=0,$t=$U.length;$A<$t;++$A){var $d=$U[$A],$u=$d.nodeName,$S=$d.value;$q._setAttributes($u,$S)}$Z._parseXML($q,$p.childNodes,$F,$q.href)}else $Z._parseXML($i,$p.childNodes,$F,$J)}},$Z.char255=String.fromCharCode(255),$Z.spacePattern=/&nbsp;|&#160;/g,$Z.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),$Z}(),$E=function(){function $_(){}return $q($_,"laya.html.utils.Layout"),$_.later=function($i){null==$_._will&&($_._will=[],$J.stage.frameLoop(1,null,function(){if(!($_._will.length<1)){for(var $i=0;$i<$_._will.length;$i++)laya.html.utils.Layout.layout($_._will[$i]);$_._will.length=0}})),$_._will.push($i)},$_.layout=function($i){if(!$i||!$i._style)return null;if(0==(512&$i._style._type))return null;$i.getStyle()._type&=-513;var $p=$_._multiLineLayout($i);return $S.isConchApp&&$i.layaoutCallNative&&$i.layaoutCallNative(),$p},$_._multiLineLayout=function($i){if($y.RightToLeft)return $_._multiLineLayout2($i);var $p=new Array;$i._addChildsToLayout($p);var $F,$J,$A,$t,$q,$B=0,$O=$p.length,$U=$i._getCSSStyle(),$d=$U.letterSpacing,$u=$U.leading,$S=$U.lineHeight,$Z=$U._widthAuto()||!$U.wordWrap,$s=$Z?999999:$i.width,$x=($i.height,0),$j=$U.italic?$U.fontSize/3:0,$r=$U._getAlign(),$M=$U._getValign(),$D=0!==$M||0!==$r||0!=$S,$E=0,$v=0,$g=0,$a=0,$R=new Array,$Q=$R[0]=new $N,$P=!1,$Y=!1;$Q.h=0,$U.italic&&($s-=$U.fontSize/3);var $c=0,$h=!0;function $m(){$Q.y=$v,$v+=$Q.h+$u,0==$Q.h&&($v+=$S),$Q.mWidth=$c,$c=0,$Q=new $N,$R.push($Q),$Q.h=0,$P=!($h=!($E=0))}for($B=0;$B<$O;$B++)if(null!=($F=$p[$B]))if($h=!1,$F instanceof laya.html.dom.HTMLBrElement)$m(),$Q.y=$v;else{if($F._isChar()){if(($t=$F).isWord)$P=$Y||"\n"===$t.char,$Q.wordStartIndex=$Q.elements.length;else{if($g=$t.width+$t.style.letterSpacin,0<$R.length&&$s<$E+$g&&0<$Q.wordStartIndex){var $n;$n=$Q.elements.length-$Q.wordStartIndex+1,$Q.elements.length=$Q.wordStartIndex,$B-=$n,$m();continue}$P=!1,$c+=$t.width}$g=$t.width+$d,$a=$t.height,$Y=!1,($P=$P||$s<$E+$g)&&$m(),$Q.minTextHeight=Math.min($Q.minTextHeight,$F.height)}else $J=$F._getCSSStyle(),$q=$F,$A=$J.padding,0===$J._getCssFloat()||($D=!0),$P=$Y||$J.lineElement,$g=$q.width*$q._style._tf.scaleX+$A[1]+$A[3]+$d,$a=$q.height*$q._style._tf.scaleY+$A[0]+$A[2],$Y=$J.lineElement,($P=$P||$s<$E+$g&&$J.wordWrap)&&$m();$Q.elements.push($F),$Q.h=Math.max($Q.h,$a),$F.x=$E,$F.y=$v,$E+=$g,$Q.w=$E-$d,$Q.y=$v,$x=Math.max($E+$j,$x)}else $h||($E+=$_.DIV_ELEMENT_PADDING),$Q.wordStartIndex=$Q.elements.length;if($v=$Q.y+$Q.h,$D){var $I=0,$G=$s;for($Z&&0<$i.width&&($G=$i.width),$B=0,$O=$R.length;$B<$O;$B++)$R[$B].updatePos(0,$G,$B,$I,$r,$M,$S),$I+=Math.max($S,$R[$B].h+$u);$v=$I}return $Z&&($i.width=$x),$v>$i.height&&($i.height=$v),[$x,$v]},$_._multiLineLayout2=function($i){var $p=new Array;$i._addChildsToLayout($p);var $F,$J,$A,$t,$q,$B=0,$O=$p.length,$U=$i._getCSSStyle(),$d=$U.letterSpacing,$u=$U.leading,$S=$U.lineHeight,$Z=$U._widthAuto()||!$U.wordWrap,$s=$Z?999999:$i.width,$x=($i.height,0),$j=$U.italic?$U.fontSize/3:0,$r=2-$U._getAlign(),$M=$U._getValign(),$D=0!==$M||0!=$r||0!=$S,$E=0,$v=0,$g=0,$a=0,$R=new Array,$Q=$R[0]=new $N,$P=!1,$Y=!1;$Q.h=0,$U.italic&&($s-=$U.fontSize/3);var $c=0,$h=!0;function $m(){$Q.y=$v,$v+=$Q.h+$u,0==$Q.h&&($v+=$S),$Q.mWidth=$c,$c=0,$Q=new $N,$R.push($Q),$Q.h=0,$P=!($h=!($E=0))}for($B=0;$B<$O;$B++)if(null!=($F=$p[$B]))if($h=!1,$F instanceof laya.html.dom.HTMLBrElement)$m(),$Q.y=$v;else{if($F._isChar()){if(($t=$F).isWord)$P=$Y||"\n"===$t.char,$Q.wordStartIndex=$Q.elements.length;else{if(0<$R.length&&$s<$E+$g&&0<$Q.wordStartIndex){var $n;$n=$Q.elements.length-$Q.wordStartIndex+1,$Q.elements.length=$Q.wordStartIndex,$B-=$n,$m();continue}$P=!1,$c+=$t.width}$g=$t.width+$d,$a=$t.height,$Y=!1,($P=$P||$s<$E+$g)&&$m(),$Q.minTextHeight=Math.min($Q.minTextHeight,$F.height)}else $J=$F._getCSSStyle(),$q=$F,$A=$J.padding,0===$J._getCssFloat()||($D=!0),$P=$Y||$J.lineElement,$g=$q.width*$q._style._tf.scaleX+$A[1]+$A[3]+$d,$a=$q.height*$q._style._tf.scaleY+$A[0]+$A[2],$Y=$J.lineElement,($P=$P||$s<$E+$g&&$J.wordWrap)&&$m();$Q.elements.push($F),$Q.h=Math.max($Q.h,$a),$F.x=$E,$F.y=$v,$E+=$g,$Q.w=$E-$d,$Q.y=$v,$x=Math.max($E+$j,$x)}else $h||($E+=$_.DIV_ELEMENT_PADDING),$Q.wordStartIndex=$Q.elements.length;if($v=$Q.y+$Q.h,$D){var $I=0,$G=$s;for($B=0,$O=$R.length;$B<$O;$B++)$R[$B].updatePos(0,$G,$B,$I,$r,$M,$S),$I+=Math.max($S,$R[$B].h+$u);$v=$I}for($Z&&($i.width=$x),$v>$i.height&&($i.height=$v),$B=0,$O=$R.length;$B<$O;$B++)$R[$B].revertOrder($s);return[$x,$v]},$_._will=null,$_.DIV_ELEMENT_PADDING=0,$_}(),$N=function(){function $i(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}$q($i,"laya.html.utils.LayoutLine");var $p=$i.prototype;return $p.updatePos=function($i,$p,$F,$J,$A,$t,$q){var $B,$O=0;0<this.elements.length&&($O=($B=this.elements[this.elements.length-1]).x+$B.width-this.elements[0].x);var $U=0,$d=NaN;1===$A&&($U=($p-$O)/2),2===$A&&($U=$p-$O),0===$q||0!=$t||($t=1);for(var $u=0,$S=this.elements.length;$u<$S;$u++){var $Z=($B=this.elements[$u])._getCSSStyle();switch(0!==$U&&($B.x+=$U),$Z._getValign()){case 0:$B.y=$J;break;case 1:var $s=0;99999!=this.minTextHeight&&($s=this.minTextHeight);var $x=($s+$q)/2;$x=Math.max($x,this.h),$d=(laya.html.dom.HTMLImageElement,$J+$x-$B.height),$B.y=$d;break;case 2:$B.y=$J+($q-$B.height)}}},$p.revertOrder=function($i){var $p;if(0<this.elements.length){var $F,$J=0;for($F=this.elements.length,$J=0;$J<$F;$J++)($p=this.elements[$J]).x=$i-$p.x-$p.width}},$i}(),$v=function($F){function $p(){this.URI=null,this._href=null,$p.__super.call(this),this._text=$p._EMPTYTEXT,this.setStyle(new $O(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}$q($p,"laya.html.dom.HTMLElement",$F);var $i=$p.prototype;return $i.layaoutCallNative=function(){var $i=0;if(this._childs&&0<($i=this._childs.length))for(var $p=0;$p<$i;$p++)this._childs[$p].layaoutCallNative&&this._childs[$p].layaoutCallNative();var $F=this._getWords();$F?laya.html.dom.HTMLElement.fillWords(this,$F,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},$i.appendChild=function($i){return this.addChild($i)},$i._getWords2=function(){var $i=this._text.text;if(!$i||0===$i.length)return null;var $p,$F,$J=0,$A=0;if(this._text.drawWords)$F=this._text.drawWords;else{for($A=($p=$i.split(" ")).length-1,$F=[],$J=0;$J<$A;$J++)$F.push($p[$J]," ");0<=$A&&$F.push($p[$A]),this._text.drawWords=$F}var $t,$q=this._text.words;if($q&&$q.length===$F.length)return $q;null===$q&&(this._text.words=$q=[]),$q.length=$F.length;var $B=this.style,$O=$B.font;for($J=0,$A=$F.length;$J<$A;$J++){$t=$M.measureText($F[$J],$O);var $U=$q[$J]=new $u($F[$J],$t.width,$t.height||$B.fontSize,$B);if(1<$U.char.length&&($U.charNum=$U.char),this.href){var $d=new $Z;this.addChild($d),$U.setSprite($d)}}return $q},$i._getWords=function(){if(!$y.CharacterCache)return this._getWords2();var $i=this._text.text;if(!$i||0===$i.length)return null;var $p,$F=this._text.words;if($F&&$F.length===$i.length)return $F;null===$F&&(this._text.words=$F=[]),$F.length=$i.length;for(var $J=this.style,$A=$J.font,$t=0,$q=$i.length;$t<$q;$t++)if($p=$M.measureText($i.charAt($t),$A)){var $B=$F[$t]=new $u($i.charAt($t),$p.width,$p.height||$J.fontSize,$J);if(this.href){var $O=new $Z;this.addChild($O),$B.setSprite($O)}}else console.warn("_getWords size is null"+$i.charAt($t),$A);return $F},$i.showLinkSprite=function(){var $i=this._text.words;if($i)for(var $p,$F,$J=[],$A=0;$A<$i.length;$A++)$F=$i[$A],($p=new $Z).graphics.drawRect(0,0,$F.width,$F.height,"#ff0000"),$p.width=$F.width,$p.height=$F.height,this.addChild($p),$J.push($p)},$i._layoutLater=function(){var $i=this.style;512&$i._type||($i.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&$i.block?($E.later(this),$i._type|=512):this.parent&&this.parent._layoutLater())},$i._setAttributes=function($i,$p){switch($i){case"style":return void this.style.cssText($p);case"class":return void(this.className=$p)}$F.prototype._setAttributes.call(this,$i,$p)},$i.updateHref=function(){if(null!=this._href){var $i=this._getWords();if($i)for(var $p,$F,$J=0;$J<$i.length;$J++)($F=($p=$i[$J]).getSprite())&&($F.size($p.width,$p.height),$F.on("click",this,this.onLinkHandler))}},$i.onLinkHandler=function($i){switch($i.type){case"click":for(var $p=this;$p;)$p.event("link",[this.href]),$p=$p.parent}},$i.formatURL=function($i){return this.URI?$r.formatURL($i,this.URI?this.URI.path:null):$i},$B(0,$i,"href",function(){return this._href},function($i){null!=(this._href=$i)&&(this._getCSSStyle().underLine=1,this.updateHref())}),$B(0,$i,"color",null,function($i){this.style.color=$i}),$B(0,$i,"onClick",null,function($i){$J._runScript("fn=function(event){"+$i+";}"),this.on("click",this,void 0)}),$B(0,$i,"id",null,function($i){$g.document.setElementById($i,this)}),$B(0,$i,"innerTEXT",function(){return this._text.text},function($i){this.text=$i}),$B(0,$i,"style",function(){return this._style}),$B(0,$i,"text",function(){return this._text.text},function($i){this._text==$p._EMPTYTEXT?this._text={text:$i,words:null}:(this._text.text=$i,this._text.words&&(this._text.words.length=0)),$S.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),$B(0,$i,"parent",$F.prototype._$get_parent,function($i){if($i instanceof laya.html.dom.HTMLElement){var $p=$i;this.URI||(this.URI=$p.URI),this.style.inherit($p.style)}$J.superSet($Z,this,"parent",$i)}),$B(0,$i,"className",null,function($i){this.style.attrs($g.document.styleSheets["."+$i])}),$p.fillWords=function($i,$p,$F,$J,$A,$t,$q){$i.graphics.clear();for(var $B=0,$O=$p.length;$B<$O;$B++){var $U=$p[$B];$i.graphics.fillText($U.char,$U.x+$F,$U.y+$J,$A,$t,"left",$q)}},$p._EMPTYTEXT={text:null,words:null},$p}($Z),$p=(function($i){function $p(){$p.__super.call(this),this.style.lineElement=!0,this.style.block=!0}$q($p,"laya.html.dom.HTMLBrElement",$v)}(),function($i){function $p(){this.contextHeight=NaN,this.contextWidth=NaN,$p.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}$q($p,"laya.html.dom.HTMLDivElement",$i);var $F=$p.prototype;return $F.appendHTML=function($i){$D.parse(this,$i,this.URI),this.layout()},$F._addChildsToLayout=function($p){var $i=this._getWords();if(null==$i&&0==this._childs.length)return!1;$i&&$i.forEach(function($i){$p.push($i)});for(var $F=!0,$J=0,$A=this._childs.length;$J<$A;$J++){var $t=this._childs[$J];$F?$F=!1:$p.push(null),$t._addToLayout($p)}return!0},$F._addToLayout=function($i){this.layout()},$F.layout=function(){if(this.style){this.style._type|=512;var $i=$E.layout(this);if($i){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new $d);var $p=this._$P.mHtmlBounds;$p.x=$p.y=0,$p.width=this.contextWidth=$i[0],$p.height=this.contextHeight=$i[1],this.setBounds($p)}}},$B(0,$F,"height",function(){return this._height?this._height:this.contextHeight},$i.prototype._$set_height),$B(0,$F,"innerHTML",null,function($i){this.destroyChildren(),this.appendHTML($i)}),$B(0,$F,"width",function(){return this._width?this._width:this.contextWidth},function($i){var $p=!1;$p=0===$i?$i!=this._width:$i!=this.width,$J.superSet($v,this,"width",$i),$p&&this.layout()}),$p}($v)),$g=function($i){function $p(){this.all=new Array,this.styleSheets=$O.styleSheets,$p.__super.call(this)}$q($p,"laya.html.dom.HTMLDocument",$v);var $F=$p.prototype;return $F.getElementById=function($i){return this.all[$i]},$F.setElementById=function($i,$p){this.all[$i]=$p},$A($p,["document",function(){return this.document=new $p}]),$p}();(function($i){function $p(){this._tex=null,this._url=null,this._renderArgs=[],$p.__super.call(this),this.style.block=!0}$q($p,"laya.html.dom.HTMLImageElement",$v);var $F=$p.prototype;$F._addToLayout=function($i){!this._style.absolute&&$i.push(this)},$F.render=function($i,$p,$F){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||($x.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,$i.ctx.drawTexture2($p,$F,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},$F.layaoutCallNative=function(){var $i=0;if(this._childs&&0<($i=this._childs.length))for(var $p=0;$p<$i;$p++)this._childs[$p].layaoutCallNative&&this._childs[$p].layaoutCallNative()},$B(0,$F,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function($i){this._width!==$i&&(this._width=$i,this._style.width=$i,this.repaint())}),$B(0,$F,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function($i){this._height!==$i&&(this._height=$i,this._style.height=$i,this.repaint())}),$F.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),$U.clearCache(this,this._url),this._tex=null),$v.prototype.destroy.call(this)},$F.onloaded=function(){var $i=this._style;$i&&!$i.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),$i&&!$i.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),$S.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},$F._loadImageComplete=function($i,$p,$F){if(!this._destroyed)if(null!=$F)if($F instanceof ArrayBuffer){var $J=new DataView($F);new laya.webgl.resource.WebGLImage(new Uint8Array($F,8),$i,0,!1,$J.getUint32(0),$J.getUint32(4));this.onloaded()}else if($F instanceof $j)$U.imgMgrSet[$i]=$p,$t.imgMgrLock($i,$U.imgMgrSet[$i]),this._url=$i,this._tex=$F,$U.keepCache(this,$i),$U.cacheRes($i,this._tex),this.onloaded();else{var $A=-1!=$i.indexOf(".png",$i.length-4)?6408:6407;new laya.webgl.resource.WebGLImage($F,$i,$A,!1,$F.width,$F.height);this.onloaded()}else this.event("error","Load image failed")},$B(0,$F,"src",null,function($i){($i=this.formatURL($i),this._url!=$i)&&(null!=this._tex&&($U.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=$i,(this._tex=$U.getRes($i))?($U.keepCache(this,$i),this.onloaded()):$t.imgMgrLoad($i,this._loadImageComplete.bind(this),2,!1))})})(),function($i){function $p(){this.type=null,$p.__super.call(this),this.visible=!1}$q($p,"laya.html.dom.HTMLLinkElement",$i);var $F=$p.prototype;$F._onload=function($i){switch(this.type){case"text/css":$O.parseCSS($i,this.URI)}},$B(0,$F,"href",$i.prototype._$get_href,function($i){var $p=this;$i=this.formatURL($i),this.URI=new $r($i);var $F=new $U;$F.once("complete",null,function($i){$p._onload($i)}),$F.load($i,"text")}),$p._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}($v),function($i){function $p(){$p.__super.call(this),this.visible=!1}$q($p,"laya.html.dom.HTMLStyleElement",$i),$B(0,$p.prototype,"text",$i.prototype._$get_text,function($i){$O.parseCSS($i,null)})}($v),function($i){function $p(){$p.__super.call(this),this._getCSSStyle().valign="middle"}$q($p,"laya.html.dom.HTMLIframeElement",$i),$B(0,$p.prototype,"href",$i.prototype._$get_href,function($F){var $J=this;$F=this.formatURL($F);var $i=new $U;$i.once("complete",null,function($i){var $p=$J.URI;$J.URI=new $r($F),$J.innerHTML=$i,!$p||($J.URI=$p)}),$i.load($F,"text")})}($p)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}}),function($A,$i,$x){$x.un,$x.uns;var $J=$x.static,$t=$x.class,$q=$x.getset,$F=($x.__newvec,laya.display.Animation),$j=(laya.utils.Browser,laya.utils.ClassUtils),$B=laya.filters.ColorFilter,$O=laya.utils.Ease,$U=laya.events.Event,$d=(laya.events.EventDispatcher,laya.display.css.Font),$u=laya.display.FrameAnimation,$p=laya.display.Graphics,$S=laya.utils.Handler,$Z=laya.display.Input,$M=laya.net.Loader,$s=(laya.display.Node,laya.maths.Point),$r=laya.maths.Rectangle,$D=laya.renders.Render,$E=laya.display.Sprite,$v=laya.display.Text,$g=laya.resource.Texture,$a=laya.utils.Tween,$R=laya.utils.Utils,$Q=laya.utils.WeakObject;$x.interface("laya.ui.IItem"),$x.interface("laya.ui.ISelect"),$x.interface("laya.ui.IRender"),$x.interface("laya.ui.IComponent"),$x.interface("laya.ui.IBox","IComponent");var $P=function(){function $i(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return $t($i,"laya.ui.LayoutStyle"),$J($i,["EMPTY",function(){return this.EMPTY=new $i}]),$i}(),$Y=function(){function $i(){}return $t($i,"laya.ui.Styles"),$i.labelColor="#000000",$i.buttonStateNum=3,$i.scrollBarMinNum=15,$i.scrollBarDelayTime=500,$J($i,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),$i}(),$c=function(){function $A(){}return $t($A,"laya.ui.UIUtils"),$A.fillArray=function($i,$p,$F){var $J=$i.concat();if($p)for(var $A=$p.split(","),$t=0,$q=Math.min($J.length,$A.length);$t<$q;$t++){var $B=$A[$t];$J[$t]="true"==$B||"false"!=$B&&$B,null!=$F&&($J[$t]=$F($B))}return $J},$A.toColor=function($i){return $R.toHexColor($i)},$A.gray=function($i,$p){void 0===$p&&($p=!0),$p?$A.addFilter($i,$A.grayFilter):$A.clearFilter($i,$B)},$A.addFilter=function($i,$p){var $F=$i.filters||[];$F.push($p),$i.filters=$F},$A.clearFilter=function($i,$p){var $F=$i.filters;if(null!=$F&&0<$F.length){for(var $J=$F.length-1;-1<$J;$J--){var $A=$F[$J];$x.__typeof($A,$p)&&$F.splice($J,1)}$i.filters=$F}},$A._getReplaceStr=function($i){return $A.escapeSequence[$i]},$A.adptString=function($i){return $i.replace(/\\(\w)/g,$A._getReplaceStr)},$A.getBindFun=function($i){var $p=$A._funMap.get($i);if(null==$p){var $F='"'+$i+'"',$J="(function(data){if(data==null)return;with(data){try{\nreturn "+($F=$F.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";$p=$x._runScript($J),$A._funMap.set($i,$p)}return $p},$J($A,["grayFilter",function(){return this.grayFilter=new $B([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new $Q}]),$A}(),$h=function(){function $i(){}return $t($i,"UIConfig"),$i.touchScrollEnable=!0,$i.mouseWheelEnable=!0,$i.showButtons=!0,$i.popupBgColor="#000000",$i.popupBgAlpha=.5,$i.closeDialogOnSide=!0,$i}(),$m=function($F){function $r(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,$r.__super.call(this),this._weakKeys=[]}$t($r,"laya.ui.AutoBitmap",$F);var $i=$r.prototype;return $i.destroy=function(){if($M.clearObject(this,this._weakKey),this._weakKeys){for(var $i=0,$p=this._weakKeys.length;$i<$p;++$i)$M.clearObject(this,this._weakKeys[$i]);this._weakKeys=null}$F.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},$i._setChanged=function(){this._isChanged||(this._isChanged=!0,$x.timer.callLater(this,this.changeSource))},$i.changeSource=function(){this._isChanged=!1;var $i=this._source;if($i&&$i.bitmap){var $p=this.width,$F=this.height,$J=this._sizeGrid,$A=$i.sourceWidth,$t=$i.sourceHeight;if(!$J||$A===$p&&$t===$F)this.cleanByTexture($i,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,$p,$F);else{$M.clearObject(this,this._weakKey),$i.$_GID||($i.$_GID=$R.getGID());var $q=$i.$_GID+"."+$p+"."+$F+"."+$J.join("."),$B=$M.findObject($q);if($R.isOKCmdList($B))return this._weakKey=$q,$M.keepObject(this,this._weakKey),void(this.cmds=$B);this.clear();var $O,$U,$d=$J[0],$u=$J[1],$S=$J[2],$Z=$J[3],$s=$J[4],$x=!1;if($p==$A&&($Z=$u=0),$F==$t&&($d=$S=0),$p<$Z+$u){var $j=$p;$x=!0,$p=$Z+$u,this.save(),this.clipRect(0,0,$j,$F)}$Z&&$d&&($O=$r.getTexture($i,0,0,$Z,$d),$U=this._weakKeys[0],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[0]=$O.weakKey),this.drawTexture($O,0,0,$Z,$d)):($M.clearObject(this,$U),this._weakKeys[0]="")),$u&&$d&&($O=$r.getTexture($i,$A-$u,0,$u,$d),$U=this._weakKeys[1],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[1]=$O.weakKey),this.drawTexture($O,$p-$u,0,$u,$d)):($M.clearObject(this,$U),this._weakKeys[1]="")),$Z&&$S&&($O=$r.getTexture($i,0,$t-$S,$Z,$S),$U=this._weakKeys[2],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[2]=$O.weakKey),this.drawTexture($O,0,$F-$S,$Z,$S)):($M.clearObject(this,$U),this._weakKeys[2]="")),$u&&$S&&($O=$r.getTexture($i,$A-$u,$t-$S,$u,$S),$U=this._weakKeys[3],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[3]=$O.weakKey),this.drawTexture($O,$p-$u,$F-$S,$u,$S)):($M.clearObject(this,$U),this._weakKeys[3]="")),$d&&($O=$r.getTexture($i,$Z,0,$A-$Z-$u,$d),$U=this._weakKeys[4],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[4]=$O.weakKey),this.drawBitmap($s,$O,$Z,0,$p-$Z-$u,$d)):($M.clearObject(this,$U),this._weakKeys[4]="")),$S&&($O=$r.getTexture($i,$Z,$t-$S,$A-$Z-$u,$S),$U=this._weakKeys[5],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[5]=$O.weakKey),this.drawBitmap($s,$O,$Z,$F-$S,$p-$Z-$u,$S)):($M.clearObject(this,$U),this._weakKeys[5]="")),$Z&&($O=$r.getTexture($i,0,$d,$Z,$t-$d-$S),$U=this._weakKeys[6],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[6]=$O.weakKey),this.drawBitmap($s,$O,0,$d,$Z,$F-$d-$S)):($M.clearObject(this,$U),this._weakKeys[6]="")),$u&&($O=$r.getTexture($i,$A-$u,$d,$u,$t-$d-$S),$U=this._weakKeys[7],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[7]=$O.weakKey),this.drawBitmap($s,$O,$p-$u,$d,$u,$F-$d-$S)):($M.clearObject(this,$U),this._weakKeys[7]="")),$O=$r.getTexture($i,$Z,$d,$A-$Z-$u,$t-$d-$S),$U=this._weakKeys[8],$O?($U!=$O.weakKey&&($M.clearObject(this,$U),$M.keepObject(this,$O.weakKey),this._weakKeys[8]=$O.weakKey),this.drawBitmap($s,$O,$Z,$d,$p-$Z-$u,$F-$d-$S)):($M.clearObject(this,$U),this._weakKeys[8]=""),$x&&this.restore(),this.autoCacheCmd&&!$D.isConchApp&&($M.saveObject($q,this.cmds,null),this._weakKey=$q,$M.keepObject(this,this._weakKey))}this._repaint()}},$i.drawBitmap=function($i,$p,$F,$J,$A,$t){void 0===$A&&($A=0),void 0===$t&&($t=0),$A<.1||$t<.1||(!$i||$p.width==$A&&$p.height==$t?this.drawTexture($p,$F,$J,$A,$t):this.fillTexture($p,$F,$J,$A,$t))},$i.clear=function($i){void 0===$i&&($i=!0),$F.prototype.clear.call(this,!1)},$q(0,$i,"sizeGrid",function(){return this._sizeGrid},function($i){this._sizeGrid=$i,this._setChanged()}),$q(0,$i,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function($i){this._width!=$i&&(this._width=$i,this._setChanged())}),$q(0,$i,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function($i){this._height!=$i&&(this._height=$i,this._setChanged())}),$q(0,$i,"source",function(){return this._source},function($i){$i?(this._source=$i,this._setChanged()):(this._source=null,this.clear())}),$r.getTexture=function($i,$p,$F,$J,$A){$J<=0&&($J=1),$A<=0&&($A=1),$i.$_GID||($i.$_GID=$R.getGID());var $t=$i.$_GID+"."+$p+"."+$F+"."+$J+"."+$A,$q=$M.findObject($t);if((!$q||!$q.source)&&($q=$g.createFromTexture($i,$p,$F,$J,$A))){if($i.alphaTexture){var $B=$i.width/$i.alphaTexture.width;$q.alphaTexture=$g.createFromTexture($i.alphaTexture,$p/$B,$F/$B,$J/$B,$A/$B)}$M.saveObject($t,$q),$q.weakKey=$t}return $q},$r}($p),$n=(function($i){function $p(){$p.__super.call(this)}$t($p,"laya.ui.UIEvent",$U),$p.SHOW_TIP="showtip",$p.HIDE_TIP="hidetip"}(),function($p){function $i(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,$i.__super.call(this),this._layout=$P.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}$t($i,"laya.ui.Component",$p);var $F=$i.prototype;return $x.imps($F,{"laya.ui.IComponent":!0}),$F.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},$F.preinitialize=function(){},$F.createChildren=function(){},$F.initialize=function(){},$F.callLater=function($i,$p){$x.timer.callLater(this,$i,$p)},$F.runCallLater=function($i){$x.timer.runCallLater(this,$i)},$F.commitMeasure=function(){},$F.changeSize=function(){this.event("resize")},$F.getLayout=function(){return this._layout===$P.EMPTY&&(this._layout=new $P),this._layout},$F._setLayoutEnabled=function($i){this._layout&&this._layout.enable!=$i&&(this._layout.enable=$i,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},$F.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},$F.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},$F.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},$F.resetLayoutX=function(){var $i=this._layout;if(isNaN($i.anchorX)||(this.pivotX=$i.anchorX*this.width),this.layoutEnabled){var $p=this.parent;$p&&(isNaN($i.centerX)?isNaN($i.left)?isNaN($i.right)||(this.x=Math.round($p.width-this.displayWidth-$i.right+this.pivotX*this.scaleX)):(this.x=Math.round($i.left+this.pivotX*this.scaleX),isNaN($i.right)||(this.width=($p._width-$i.left-$i.right)/(this.scaleX||.01))):this.x=Math.round(.5*($p.width-this.displayWidth)+$i.centerX+this.pivotX*this.scaleX))}},$F.resetLayoutY=function(){var $i=this._layout;if(isNaN($i.anchorY)||(this.pivotY=$i.anchorY*this.height),this.layoutEnabled){var $p=this.parent;$p&&(isNaN($i.centerY)?isNaN($i.top)?isNaN($i.bottom)||(this.y=Math.round($p.height-this.displayHeight-$i.bottom+this.pivotY*this.scaleY)):(this.y=Math.round($i.top+this.pivotY*this.scaleY),isNaN($i.bottom)||(this.height=($p._height-$i.top-$i.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*($p.height-this.displayHeight)+$i.centerY+this.pivotY*this.scaleY))}},$F.onMouseOver=function($i){$x.stage.event("showtip",this._toolTip)},$F.onMouseOut=function($i){$x.stage.event("hidetip",this._toolTip)},$q(0,$F,"displayWidth",function(){return this.width*this.scaleX}),$q(0,$F,"width",function(){return this._width?this._width:this.measureWidth},function($i){this._width!=$i&&(this._width=$i,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),$q(0,$F,"measureWidth",function(){var $i=0;this.commitMeasure();for(var $p=this.numChildren-1;-1<$p;$p--){var $F=this.getChildAt($p);$F.visible&&($i=Math.max($F.x+$F.width*$F.scaleX,$i))}return $i}),$q(0,$F,"displayHeight",function(){return this.height*this.scaleY}),$q(0,$F,"height",function(){return this._height?this._height:this.measureHeight},function($i){this._height!=$i&&(this._height=$i,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),$q(0,$F,"dataSource",function(){return this._dataSource},function($i){for(var $p in this._dataSource=$i,this._dataSource)this.hasOwnProperty($p)&&"function"!=typeof this[$p]&&(this[$p]=this._dataSource[$p])}),$q(0,$F,"scaleY",$p.prototype._$get_scaleY,function($i){$x.superGet($E,this,"scaleY")!=$i&&($x.superSet($E,this,"scaleY",$i),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),$q(0,$F,"measureHeight",function(){var $i=0;this.commitMeasure();for(var $p=this.numChildren-1;-1<$p;$p--){var $F=this.getChildAt($p);$F.visible&&($i=Math.max($F.y+$F.height*$F.scaleY,$i))}return $i}),$q(0,$F,"scaleX",$p.prototype._$get_scaleX,function($i){$x.superGet($E,this,"scaleX")!=$i&&($x.superSet($E,this,"scaleX",$i),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),$q(0,$F,"top",function(){return this._layout.top},function($i){$i!=this._layout.top&&(this.getLayout().top=$i,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$q(0,$F,"bottom",function(){return this._layout.bottom},function($i){$i!=this._layout.bottom&&(this.getLayout().bottom=$i,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$q(0,$F,"left",function(){return this._layout.left},function($i){$i!=this._layout.left&&(this.getLayout().left=$i,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$q(0,$F,"right",function(){return this._layout.right},function($i){$i!=this._layout.right&&(this.getLayout().right=$i,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$q(0,$F,"centerX",function(){return this._layout.centerX},function($i){$i!=this._layout.centerX&&(this.getLayout().centerX=$i,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$q(0,$F,"centerY",function(){return this._layout.centerY},function($i){$i!=this._layout.centerY&&(this.getLayout().centerY=$i,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$q(0,$F,"anchorX",function(){return this._layout.anchorX},function($i){$i!=this._layout.anchorX&&(this.getLayout().anchorX=$i,this._setLayoutEnabled(!0)),this.resetLayoutX()}),$q(0,$F,"anchorY",function(){return this._layout.anchorY},function($i){$i!=this._layout.anchorY&&(this.getLayout().anchorY=$i,this._setLayoutEnabled(!0)),this.resetLayoutY()}),$q(0,$F,"tag",function(){return this._tag},function($i){this._tag=$i}),$q(0,$F,"toolTip",function(){return this._toolTip},function($i){this._toolTip!=$i&&(null!=(this._toolTip=$i)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),$q(0,$F,"comXml",function(){return this._comXml},function($i){this._comXml=$i}),$q(0,$F,"gray",function(){return this._gray},function($i){$i!==this._gray&&(this._gray=$i,$c.gray(this,$i))}),$q(0,$F,"disabled",function(){return this._disabled},function($i){$i!==this._disabled&&(this.gray=this._disabled=$i,this.mouseEnabled=!$i)}),$i}($E)),$I=function($i){function $p(){this.lockLayer=null,this.popupEffect=function($i){$i.scale(1,1),$a.from($i,{x:$x.stage.width/2,y:$x.stage.height/2,scaleX:0,scaleY:0},300,$O.backOut,$S.create(this,this.doOpen,[$i]))},this.closeEffect=function($i,$p){$a.to($i,{x:$x.stage.width/2,y:$x.stage.height/2,scaleX:0,scaleY:0},300,$O.strongOut,$S.create(this,this.doClose,[$i,$p]))},$p.__super.call(this),this.maskLayer=new $E,this.popupEffectHandler=$S.create(this,this.popupEffect,null,!1),this.closeEffectHandler=$S.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,$x.stage.addChild(this),$x.stage.on("resize",this,this._onResize),$h.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}$t($p,"laya.ui.DialogManager",$E);var $F=$p.prototype;return $F._closeOnSide=function(){var $i=this.getChildAt(this.numChildren-1);$i instanceof laya.ui.Dialog&&$i.close("side")},$F.setLockView=function($i){this.lockLayer||(this.lockLayer=new $G,this.lockLayer.mouseEnabled=!0,this.lockLayer.size($x.stage.width,$x.stage.height)),this.lockLayer.removeChildren(),$i&&($i.centerX=$i.centerY=0,this.lockLayer.addChild($i))},$F._onResize=function($i){var $p=this.maskLayer.width=$x.stage.width,$F=this.maskLayer.height=$x.stage.height;this.lockLayer&&this.lockLayer.size($p,$F),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,$p,$F,$h.popupBgColor),this.maskLayer.alpha=$h.popupBgAlpha;for(var $J=this.numChildren-1;-1<$J;$J--){var $A=this.getChildAt($J);$A.popupCenter&&this._centerDialog($A)}},$F._centerDialog=function($i){$i.x=Math.round(($x.stage.width-$i.width>>1)+$i.pivotX),$i.y=Math.round(($x.stage.height-$i.height>>1)+$i.pivotY)},$F.open=function($i,$p,$F){void 0===$p&&($p=!1),void 0===$F&&($F=!1),$p&&this._closeAll(),$i.popupCenter&&this._centerDialog($i),this.addChild($i),($i.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),$F&&null!=$i.popupEffect?$i.popupEffect.runWith($i):this.doOpen($i),this.event("open")},$F.doOpen=function($i){$i.onOpened()},$F.lock=function($i){this.lockLayer&&($i?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},$F.close=function($i,$p,$F){void 0===$F&&($F=!1),$F&&null!=$i.closeEffect?$i.closeEffect.runWith([$i,$p]):this.doClose($i,$p),this.event("close")},$F.doClose=function($i,$p){$i.removeSelf(),$i.isModal&&this._checkMask(),$i.closeHandler&&$i.closeHandler.runWith($p),$i.onClosed($p)},$F.closeAll=function(){this._closeAll(),this.event("close")},$F._closeAll=function(){for(var $i=this.numChildren-1;-1<$i;$i--){var $p=this.getChildAt($i);$p&&null!=$p.close&&this.doClose($p)}},$F.getDialogsByGroup=function($i){for(var $p=[],$F=this.numChildren-1;-1<$F;$F--){var $J=this.getChildAt($F);$J&&$J.group===$i&&$p.push($J)}return $p},$F.closeByGroup=function($i){for(var $p=[],$F=this.numChildren-1;-1<$F;$F--){var $J=this.getChildAt($F);$J&&$J.group===$i&&($J.close(),$p.push($J))}return $p},$F._checkMask=function(){this.maskLayer.removeSelf();for(var $i=this.numChildren-1;-1<$i;$i--){var $p=this.getChildAt($i);if($p&&$p.isModal)return void this.addChildAt(this.maskLayer,$i)}},$p}(),$G=function($i){function $p(){$p.__super.call(this)}$t($p,"laya.ui.Box",$i);var $F=$p.prototype;return $x.imps($F,{"laya.ui.IBox":!0}),$q(0,$F,"dataSource",$i.prototype._$get_dataSource,function($i){for(var $p in this._dataSource=$i){var $F=this.getChildByName($p);$F?$F.dataSource=$i[$p]:this.hasOwnProperty($p)&&"function"!=typeof this[$p]&&(this[$p]=$i[$p])}}),$p}($n),$_=function($p){function $F($i,$p){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,$F.__super.call(this),this._labelColors=$Y.buttonLabelColors,this._stateNum=$Y.buttonStateNum,void 0===$p&&($p=""),this.skin=$i,this.label=$p}$t($F,"laya.ui.Button",$p);var $i=$F.prototype;return $x.imps($i,{"laya.ui.ISelect":!0}),$i.destroy=function($i){this.clearEvent(),$M.clearCache(this,this._skin),$M.clearObject(this,this._weakKey),void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy($i),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},$i.clearEvent=function(){this._skin&&$A.atalsNotify&&$A.atalsNotify.off(this._skin,this,this._setBtnSource)},$i.createChildren=function(){this.graphics=this._bitmap=new $m},$i.createText=function(){this._text||(this._text=new $v,this._text.overflow=$v.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},$i.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},$i.onMouse=function($i){if(!1!==this.toggle||!this._selected)return"click"===$i.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=$F.stateMap[$i.type]))},$i.changeClips=function(){var $i=$M.getRes(this._skin);if($i)if(this._skin&&""!=this._skin){$M.clearObject(this,this._weakKey);var $p=$i.sourceWidth,$F=$i.sourceHeight/this._stateNum;$i.$_GID||($i.$_GID=$R.getGID());var $J=$i.$_GID+"-"+this._stateNum,$A=$M.findObject($J);if($R.isOkTextureList($A)||($A=null),$A)this._weakKey=$J,$M.keepObject(this,this._weakKey),this._sources=$A;else{if(this._sources=[],1===this._stateNum)this._sources.push($i);else for(var $t=0;$t<this._stateNum;$t++){var $q=$g.createFromTexture($i,0,$F*$t,$p,$F);if($i.alphaTexture){var $B=$i.width/$i.alphaTexture.width;$q.alphaTexture=$g.createFromTexture($i.alphaTexture,0/$B,$F*$t/$B,$p/$B,$F/$B)}this._sources.push($q)}$M.saveObject($J,this._sources),this._weakKey=$J,$M.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||$p,this._bitmap.height=this._height||$F,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=$p)}else console.warn("lose skin ",this._skin,this.name,this.__className)},$i.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var $i=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[$i]),this.label&&(this._text.color=this._labelColors[$i],this._strokeColors&&(this._text.strokeColor=this._strokeColors[$i]))},$i._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},$q(0,$i,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function($i){this.createText(),this._text.strokeColor=$i}),$q(0,$i,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),$q(0,$i,"skin",function(){return this._skin},function($i){if(this._skin!=$i)if(this.clearEvent(),$M.clearCache(this,this._skin),this._skin=$i,$M.keepCache(this,this._skin),$M.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var $p=$A.resAtalsObj&&$A.resAtalsObj[this._skin];$p?($A.atalsNotify&&$A.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=$p.sourceW),0==this.height&&(this.height=$p.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),$i._setBtnSource=function($i,$p){$i===this._skin&&$p&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},$q(0,$i,"state",function(){return this._state},function($i){this._state!=$i&&(this._state=$i,this._setStateChanged())}),$q(0,$i,"text",function(){return this.createText(),this._text}),$q(0,$i,"stateNum",function(){return this._stateNum},function($i){"string"==typeof $i&&($i=parseInt($i)),this._stateNum!=$i&&(this._stateNum=$i<1?1:3<$i?3:$i,this.callLater(this.changeClips))}),$q(0,$i,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function($i){this._strokeColors=$c.fillArray($Y.buttonLabelColors,$i,String),this._setStateChanged()}),$q(0,$i,"labelColors",function(){return this._labelColors.join(",")},function($i){this._labelColors=$c.fillArray($Y.buttonLabelColors,$i,String),this._setStateChanged()}),$q(0,$i,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),$q(0,$i,"label",function(){return this._text?this._text.text:null},function($i){(this._text||$i)&&(this.createText(),this._text.text!=$i&&($i&&!this._text.parent&&this.addChild(this._text),this._text.text=($i+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),$q(0,$i,"selected",function(){return this._selected},function($i){this._selected!=$i&&(this._selected=$i,this.state=this._selected?2:0,this.event("change"))}),$q(0,$i,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function($i){this.createText(),this._text.padding=$c.fillArray($Y.labelPadding,$i,Number)}),$q(0,$i,"labelSize",function(){return this.createText(),this._text.fontSize},function($i){this.createText(),this._text.fontSize=$i}),$q(0,$i,"labelStroke",function(){return this.createText(),this._text.stroke},function($i){this.createText(),this._text.stroke=$i}),$q(0,$i,"labelBold",function(){return this.createText(),this._text.bold},function($i){this.createText(),this._text.bold=$i}),$q(0,$i,"labelFont",function(){return this.createText(),this._text.font},function($i){this.createText(),this._text.font=$i}),$q(0,$i,"labelAlign",function(){return this.createText(),this._text.align},function($i){this.createText(),this._text.align=$i}),$q(0,$i,"clickHandler",function(){return this._clickHandler},function($i){this._clickHandler=$i}),$q(0,$i,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($i){this._bitmap.sizeGrid=$c.fillArray($Y.defaultSizeGrid,$i,Number)}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($n,this,"width",$i),this._autoSize&&(this._bitmap.width=$i,this._text&&(this._text.width=$i))}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($n,this,"height",$i),this._autoSize&&(this._bitmap.height=$i,this._text&&(this._text.height=$i))}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)||"string"==typeof $i?this.label=$i+"":$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function($i){this._bitmap._offset=$i?$c.fillArray([1,1],$i,Number):[]}),$J($F,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),$F}($n),$y=function($p){function $J($i,$p,$F){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,$J.__super.call(this),void 0===$p&&($p=1),void 0===$F&&($F=1),this._clipX=$p,this._clipY=$F,this.skin=$i}$t($J,"laya.ui.Clip",$p);var $i=$J.prototype;return $i.destroy=function($i){this.clearEvent(),this.clearLoad(),$M.clearCache(this,this._skin),$M.clearObject(this,this._weakKey),void 0===$i&&($i=!0),$p.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},$i.dispose=function(){this.destroy(!0),$x.loader.clearRes(this._skin)},$i.createChildren=function(){this.graphics=this._bitmap=new $m},$i._onDisplay=function($i){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},$i.changeClip=function(){if(this._clipChanged=!1,this._skin){var $i=$M.getRes(this._skin);if($i)this.loadComplete(this._skin,$i);else{if($A.resAtalsObj&&$A.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=$S.create(this,this.loadComplete,[this._skin]),this._progress=null,$x.loader.load(this._skin,this._complete,this._progress)}}},$i.loadComplete=function($i,$p){if($i===this._skin&&$p){$M.clearObject(this,this._weakKey);var $F=this._clipWidth||Math.ceil($p.sourceWidth/this._clipX),$J=this._clipHeight||Math.ceil($p.sourceHeight/this._clipY),$A=this._skin+$F+$J,$t=$M.findObject($A);if($R.isOkTextureList($t)||($t=null),$t)this._weakKey=$A,$M.keepObject(this,this._weakKey),this._sources=$t;else{this._sources=[];for(var $q=0;$q<this._clipY;$q++)for(var $B=0;$B<this._clipX;$B++){var $O=$g.createFromTexture($p,$F*$B,$J*$q,$F,$J);if($p.alphaTexture){var $U=$p.width/$p.alphaTexture.width;$O.alphaTexture=$g.createFromTexture($p.alphaTexture,$F*$B/$U,$J*$q/$U,$F/$U,$J/$U)}this._sources.push($O)}$M.saveObject($A,this._sources),this._weakKey=$A,$M.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},$i.play=function($i,$p){void 0===$i&&($i=0),void 0===$p&&($p=-1),this._isPlaying=!0,this.index=$i,this._toIndex=$p,this._index++,$x.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},$i._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},$i.stop=function(){this._isPlaying=!1,$x.timer.clear(this,this._loop),this.event("complete")},$i._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},$q(0,$i,"interval",function(){return this._interval},function($i){this._interval!=$i&&(this._interval=$i,this._isPlaying&&this.play())}),$i.clearEvent=function(){this._skin&&$A.atalsNotify&&$A.atalsNotify.off(this._skin,this,this._setBtnSource)},$i.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$x.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$q(0,$i,"skin",function(){return this._skin},function($i){if(this._skin!=$i)if(this.clearLoad(),this.clearEvent(),$M.clearCache(this,this._skin),this._skin=$i){$M.keepCache(this,this._skin);var $p=$M.getRes($i),$F=$A.resAtalsObj&&$A.resAtalsObj[this._skin];!$p&&$F?$A.atalsNotify&&$A.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),$i._setBtnSource=function($i,$p){$i===this._skin&&$p&&(this.loadComplete($i,$p),this.clearEvent())},$q(0,$i,"sources",function(){return this._sources},function($i){this._sources=$i,this.index=this._index,this.event("loaded")}),$q(0,$i,"clipX",function(){return this._clipX},function($i){this._clipX=$i||1,this._setClipChanged()}),$q(0,$i,"clipY",function(){return this._clipY},function($i){this._clipY=$i||1,this._setClipChanged()}),$q(0,$i,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),$q(0,$i,"clipWidth",function(){return this._clipWidth},function($i){this._clipWidth=$i,this._setClipChanged()}),$q(0,$i,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($i){this._bitmap.sizeGrid=$c.fillArray($Y.defaultSizeGrid,$i,Number)}),$q(0,$i,"group",function(){return this._group},function($i){$i&&this._skin&&$M.setGroup(this._skin,$i),this._group=$i}),$q(0,$i,"clipHeight",function(){return this._clipHeight},function($i){this._clipHeight=$i,this._setClipChanged()}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($n,this,"width",$i),this._bitmap.width=$i}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($n,this,"height",$i),this._bitmap.height=$i}),$q(0,$i,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),$q(0,$i,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),$q(0,$i,"index",function(){return this._index},function($i){this._index=$i,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[$i]),this.event("change")}),$q(0,$i,"autoPlay",function(){return this._autoPlay},function($i){this._autoPlay!=$i&&((this._autoPlay=$i)?this.play():this.stop())}),$q(0,$i,"isPlaying",function(){return this._isPlaying},function($i){this._isPlaying=$i}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)&&Math.floor($i)==$i||"string"==typeof $i?this.index=parseInt($i):$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"bitmap",function(){return this._bitmap}),$J}($n),$N=function($p){function $i(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,$i.__super.call(this)}$t($i,"laya.ui.ColorPicker",$p);var $F=$i.prototype;return $F.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._colorPanel&&this._colorPanel.destroy($i),this._colorButton&&this._colorButton.destroy($i),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},$F.createChildren=function(){this.addChild(this._colorButton=new $_),this._colorPanel=new $G,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new $E),this._colorPanel.addChild(this._colorBlock=new $E),this._colorPanel.addChild(this._colorInput=new $Z)},$F.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},$F.onPanelMouseDown=function($i){$i.stopPropagation()},$F.changePanel=function(){this._panelChanged=!1;var $i=this._colorPanel.graphics;$i.clear(),$i.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,($i=this._colorTiles.graphics).clear();for(var $p=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],$F=0;$F<12;$F++)for(var $J=0;$J<20;$J++){var $A=0;$A=0===$J?$p[$F]:1===$J?0:51*(((3*$F+$J/6)%3<<0)+3*($F/6<<0))<<16|$J%6*51<<8|($F<<0)%6*51;var $t=$c.toColor($A);this._colors.push($t);var $q=$J*this._gridSize,$B=$F*this._gridSize;$i.drawRect($q,$B,this._gridSize,this._gridSize,$t,"#000000")}},$F.onColorButtonClick=function($i){this._colorPanel.parent?this.close():this.open()},$F.open=function(){var $i=this.localToGlobal(new $s),$p=$i.x+this._colorPanel.width<=$x.stage.width?$i.x:$x.stage.width-this._colorPanel.width,$F=$i.y+this._colorButton.height;$F=$F+this._colorPanel.height<=$x.stage.height?$F:$i.y-this._colorPanel.height,this._colorPanel.pos($p,$F),this._colorPanel.zOrder=1001,$x._currentStage.addChild(this._colorPanel),$x.stage.on("mousedown",this,this.removeColorBox)},$F.close=function(){$x.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},$F.removeColorBox=function($i){this.close()},$F.onColorFieldKeyDown=function($i){13==$i.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),$i.stopPropagation())},$F.onColorInputChange=function($i){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},$F.onColorTilesClick=function($i){this.selectedColor=this.getColorByMouse(),this.close()},$F.onColorTilesMouseMove=function($i){this._colorInput.focus=!1;var $p=this.getColorByMouse();this._colorInput.text=$p,this.drawBlock($p)},$F.getColorByMouse=function(){var $i=this._colorTiles.getMousePoint(),$p=Math.floor($i.x/this._gridSize),$F=Math.floor($i.y/this._gridSize);return this._colors[20*$F+$p]},$F.drawBlock=function($i){var $p=this._colorBlock.graphics;$p.clear();var $F=$i||"#ffffff";$p.drawRect(0,0,50,20,$F,this._borderColor),$i||$p.drawLine(0,0,50,20,"#ff0000")},$F.changeColor=function(){var $i=this.graphics;$i.clear();var $p=this._selectedColor||"#000000";$i.drawRect(0,0,this._colorButton.width,this._colorButton.height,$p)},$F._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},$q(0,$F,"inputBgColor",function(){return this._inputBgColor},function($i){this._inputBgColor=$i,this._setPanelChanged()}),$q(0,$F,"selectedColor",function(){return this._selectedColor},function($i){this._selectedColor!=$i&&(this._selectedColor=this._colorInput.text=$i,this.drawBlock($i),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",$U.EMPTY.setTo("change",this,this)))}),$q(0,$F,"skin",function(){return this._colorButton.skin},function($i){this._colorButton.skin=$i,this.changeColor()}),$q(0,$F,"bgColor",function(){return this._bgColor},function($i){this._bgColor=$i,this._setPanelChanged()}),$q(0,$F,"borderColor",function(){return this._borderColor},function($i){this._borderColor=$i,this._setPanelChanged()}),$q(0,$F,"inputColor",function(){return this._inputColor},function($i){this._inputColor=$i,this._setPanelChanged()}),$i}($n),$f=function($p){function $F($i,$p){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,$F.__super.call(this),this._itemColors=$Y.comboBoxItemColors,this.skin=$i,this.labels=$p}$t($F,"laya.ui.ComboBox",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._button&&this._button.destroy($i),this._list&&this._list.destroy($i),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},$i.createChildren=function(){this.addChild(this._button=new $_),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},$i._createList=function(){this._list=new $$,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},$i._setListEvent=function($i){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=$S.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},$i.onListDown=function($i){$i.stopPropagation()},$i.onScrollBarDown=function($i){$i.stopPropagation()},$i.onButtonMouseDown=function($i){this.callLater(this.switchTo,[!this._isOpen])},$i.changeList=function(){this._listChanged=!1;var $i=this.width-2,$p=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:$i,height:this._itemHeight,fontSize:this._itemSize,color:$p}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},$i.onlistItemMouse=function($i,$p){var $F=$i.type;if("mouseover"===$F||"mouseout"===$F){if(this._isCustomList)return;var $J=this._list.getCell($p);if(!$J)return;var $A=$J.getChildByName("label");$A&&("mouseover"===$F?($A.bgColor=this._itemColors[0],$A.color=this._itemColors[1]):($A.bgColor=null,$A.color=this._itemColors[2]))}else"click"===$F&&(this.selectedIndex=$p,this.isOpen=!1)},$i.switchTo=function($i){this.isOpen=$i},$i.changeOpen=function(){this.isOpen=!this._isOpen},$i.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var $i=this._list.graphics;$i.clear(),$i.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var $p=this._list.array||[],$F=$p.length=0,$J=this._labels.length;$F<$J;$F++)$p.push({label:this._labels[$F]});this._list.height=this._listHeight,this._list.array=$p},$i.changeSelected=function(){this._button.label=this.selectedLabel},$i._onStageMouseWheel=function($i){this._list&&!this._list.contains($i.target)&&this.removeList(null)},$i.removeList=function($i){$x.stage.off("mousedown",this,this.removeList),$x.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},$q(0,$i,"selectedIndex",function(){return this._selectedIndex},function($i){this._selectedIndex!=$i&&(this._selectedIndex=$i,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[$U.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),$q(0,$i,"measureHeight",function(){return this._button.height}),$q(0,$i,"skin",function(){return this._button.skin},function($i){this._button.skin!=$i&&(this._button.skin=$i,this._listChanged=!0)}),$q(0,$i,"measureWidth",function(){return this._button.width}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($n,this,"width",$i),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),$q(0,$i,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function($i){this.selectedIndex=this._labels.indexOf($i)}),$q(0,$i,"labels",function(){return this._labels.join(",")},function($i){0<this._labels.length&&(this.selectedIndex=-1),$i?this._labels=$i.split(","):this._labels.length=0,this._itemChanged=!0}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($n,this,"height",$i),this._button.height=this._height}),$q(0,$i,"selectHandler",function(){return this._selectHandler},function($i){this._selectHandler=$i}),$q(0,$i,"visibleNum",function(){return this._visibleNum},function($i){this._visibleNum=$i,this._listChanged=!0}),$q(0,$i,"labelBold",function(){return this._button.text.bold},function($i){this._button.text.bold=$i}),$q(0,$i,"itemColors",function(){return String(this._itemColors)},function($i){this._itemColors=$c.fillArray(this._itemColors,$i,String),this._listChanged=!0}),$q(0,$i,"itemSize",function(){return this._itemSize},function($i){this._itemSize=$i,this._listChanged=!0}),$q(0,$i,"scrollBar",function(){return this.list.scrollBar}),$q(0,$i,"isOpen",function(){return this._isOpen},function($i){if(this._isOpen!=$i)if(this._isOpen=$i,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var $p=this.localToGlobal($s.TEMP.setTo(0,0)),$F=$p.y+this._button.height;$F=$F+this._listHeight<=$x.stage.height?$F:$p.y-this._listHeight,this._list.pos($p.x,$F),this._list.zOrder=1001,$x._currentStage.addChild(this._list),$x.stage.once("mousedown",this,this.removeList),$x.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),$q(0,$i,"scrollBarSkin",function(){return this._scrollBarSkin},function($i){this._scrollBarSkin=$i}),$q(0,$i,"sizeGrid",function(){return this._button.sizeGrid},function($i){this._button.sizeGrid=$i}),$q(0,$i,"button",function(){return this._button}),$q(0,$i,"list",function(){return this._list||this._createList(),this._list},function($i){$i&&($i.removeSelf(),this._isCustomList=!0,this._list=$i,this._setListEvent($i),this._itemHeight=$i.getCell(0).height+$i.spaceY)}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)&&Math.floor($i)==$i||"string"==typeof $i?this.selectedIndex=parseInt($i):$i instanceof Array?this.labels=$i.join(","):$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"labelColors",function(){return this._button.labelColors},function($i){this._button.labelColors!=$i&&(this._button.labelColors=$i)}),$q(0,$i,"labelPadding",function(){return this._button.text.padding.join(",")},function($i){this._button.text.padding=$c.fillArray($Y.labelPadding,$i,Number)}),$q(0,$i,"labelSize",function(){return this._button.text.fontSize},function($i){this._button.text.fontSize=$i}),$q(0,$i,"labelFont",function(){return this._button.text.font},function($i){this._button.text.font=$i}),$q(0,$i,"stateNum",function(){return this._button.stateNum},function($i){this._button.stateNum=$i}),$F}($n),$o=function($p){function $F($i){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,$F.__super.call(this),this._showButtons=$h.showButtons,this._touchScrollEnable=$h.touchScrollEnable,this._mouseWheelEnable=$h.mouseWheelEnable,this.skin=$i,this.max=1}$t($F,"laya.ui.ScrollBar",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),this.stopScroll(),this.target=null,$p.prototype.destroy.call(this,$i),this.upButton&&this.upButton.destroy($i),this.downButton&&this.downButton.destroy($i),this.slider&&this.slider.destroy($i),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},$i.createChildren=function(){this.addChild(this.slider=new $W),this.addChild(this.upButton=new $_),this.addChild(this.downButton=new $_)},$i.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},$i.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},$i.onButtonMouseDown=function($i){var $p=$i.currentTarget===this.upButton;this.slide($p),$x.timer.once($Y.scrollBarDelayTime,this,this.startLoop,[$p]),$x.stage.once("mouseup",this,this.onStageMouseUp)},$i.startLoop=function($i){$x.timer.frameLoop(1,this,this.slide,[$i])},$i.slide=function($i){$i?this.value-=this._scrollSize:this.value+=this._scrollSize},$i.onStageMouseUp=function($i){$x.timer.clear(this,this.startLoop),$x.timer.clear(this,this.slide)},$i.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},$i.changeSize=function(){$p.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},$i.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},$i.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},$i.setScroll=function($i,$p,$F){this.runCallLater(this.changeSize),this.slider.setSlider($i,$p,$F),this.slider.bar.visible=0<$p,!this._hide&&this.autoHide&&(this.visible=!1)},$i.onTargetMouseWheel=function($i){this.value-=$i.delta*this._scrollSize,this.target=this._target},$i.onTargetMouseDown=function($i){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new $s),this._lastPoint.setTo($x.stage.mouseX,$x.stage.mouseY),$x.timer.clear(this,this.tweenMove),$a.clearTween(this),$x.stage.once("mouseup",this,this.onStageMouseUp2),$x.stage.once("mouseout",this,this.onStageMouseUp2),$x.timer.frameLoop(1,this,this.loop)},$i.loop=function(){var $i=$x.stage.mouseY,$p=$x.stage.mouseX;if(this._lastOffset=this.isVertical?$i-this._lastPoint.y:$p-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?$x.stage._canvasTransform.getScaleY():$x.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=$p,this._lastPoint.y=$i,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},$i.onStageMouseUp2=function($i){if($x.stage.off("mouseup",this,this.onStageMouseUp2),$x.stage.off("mouseout",this,this.onStageMouseUp2),$x.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?$a.to(this,{value:this.min},this.elasticBackTime,$O.sineOut,$S.create(this,this.elasticOver)):this._value>this.max&&$a.to(this,{value:this.max},this.elasticBackTime,$O.sineOut,$S.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?$x.stage.mouseY-this._lastPoint.y:$x.stage.mouseX-this._lastPoint.x);for(var $p=0,$F=Math.min(this._offsets.length,3),$J=0;$J<$F;$J++)$p+=this._offsets[this._offsets.length-1-$J];if(this._lastOffset=$p/$F,($p=Math.abs(this._lastOffset))<2)return void this.event("end");60<$p&&(this._lastOffset=0<this._lastOffset?60:-60);var $A=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));$x.timer.frameLoop(1,this,this.tweenMove,[$A])}},$i.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&$a.to(this,{alpha:0},500),this.event("end")},$i.tweenMove=function($i){this._lastOffset*=this.rollRatio;var $p=NaN;if(0<$i&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,$p=.5*-(this.min-$i-this.value),this._lastOffset>$p&&(this._lastOffset=$p)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,$p=.5*-(this.max+$i-this.value),this._lastOffset<$p&&(this._lastOffset=$p))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if($x.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?$a.to(this,{value:this.min},this.elasticBackTime,$O.sineOut,$S.create(this,this.elasticOver)):this._value>this.max?$a.to(this,{value:this.max},this.elasticBackTime,$O.sineOut,$S.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&$a.to(this,{alpha:0},500)}},$i.stopScroll=function(){this.onStageMouseUp2(null),$x.timer.clear(this,this.tweenMove),$a.clearTween(this)},$q(0,$i,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),$q(0,$i,"skin",function(){return this._skin},function($i){this._skin!=$i&&(this._skin=$i,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),$q(0,$i,"max",function(){return this.slider.max},function($i){this.slider.max=$i}),$q(0,$i,"showButtons",function(){return this._showButtons},function($i){this._showButtons=$i,this.callLater(this.changeScrollBar)}),$q(0,$i,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),$q(0,$i,"min",function(){return this.slider.min},function($i){this.slider.min=$i}),$q(0,$i,"value",function(){return this._value},function($i){$i!==this._value&&(this._value=$i,this._isElastic||(this.slider._value!=$i&&(this.slider._value=$i,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),$q(0,$i,"isVertical",function(){return this.slider.isVertical},function($i){this.slider.isVertical=$i}),$q(0,$i,"sizeGrid",function(){return this.slider.sizeGrid},function($i){this.slider.sizeGrid=$i}),$q(0,$i,"scrollSize",function(){return this._scrollSize},function($i){this._scrollSize=$i}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)||"string"==typeof $i?this.value=Number($i):$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"thumbPercent",function(){return this._thumbPercent},function($i){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),$i=1<=$i?.99:$i,this._thumbPercent=$i,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*$i,$Y.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*$i,$Y.scrollBarMinNum))}),$q(0,$i,"target",function(){return this._target},function($i){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=$i)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),$q(0,$i,"hide",function(){return this._hide},function($i){this._hide=$i,this.visible=!$i}),$q(0,$i,"touchScrollEnable",function(){return this._touchScrollEnable},function($i){this._touchScrollEnable=$i,this.target=this._target}),$q(0,$i,"mouseWheelEnable",function(){return this._mouseWheelEnable},function($i){this._mouseWheelEnable=$i,this.target=this._target}),$q(0,$i,"tick",function(){return this.slider.tick},function($i){this.slider.tick=$i}),$F}($n),$W=function($p){function $F($i){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,$F.__super.call(this),this.skin=$i}$t($F,"laya.ui.Slider",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._bg&&this._bg.destroy($i),this._bar&&this._bar.destroy($i),this._progress&&this._progress.destroy($i),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},$i.createChildren=function(){this.addChild(this._bg=new $L),this.addChild(this._bar=new $_)},$i.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},$i.onBarMouseDown=function($i){this._globalSacle||(this._globalSacle=new $s),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=$x.stage.mouseX,this._ty=$x.stage.mouseY,$x.stage.on("mousemove",this,this.mouseMove),$x.stage.once("mouseup",this,this.mouseUp),$x.stage.once("mouseout",this,this.mouseUp),this.showValueText()},$i.showValueText=function(){if(this.showLabel){var $i=laya.ui.Slider.label;this.addChild($i),$i.textField.changeText(this._value+""),this.isVertical?($i.x=this._bar.x+20,$i.y=.5*(this._bar.height-$i.height)+this._bar.y):($i.y=this._bar.y-20,$i.x=.5*(this._bar.width-$i.width)+this._bar.x)}},$i.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},$i.mouseUp=function($i){$x.stage.off("mousemove",this,this.mouseMove),$x.stage.off("mouseup",this,this.mouseUp),$x.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},$i.mouseMove=function($i){var $p=this._value;this.isVertical?(this._bar.y+=($x.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=($x.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=$x.stage.mouseX,this._ty=$x.stage.mouseY;var $F=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$F)/$F,this._value!=$p&&this.sendChangeEvent(),this.showValueText()},$i.sendChangeEvent=function($i){void 0===$i&&($i="change"),this.event($i),this.changeHandler&&this.changeHandler.runWith(this._value)},$i.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},$i.changeSize=function(){$p.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},$i.setSlider=function($i,$p,$F){this._value=-1,this._min=$i,this._max=$i<$p?$p:$i,this.value=$F<$i?$i:$p<$F?$p:$F},$i.changeValue=function(){var $i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*$i)/$i,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var $p=this._max-this._min;0===$p&&($p=1),this.isVertical?(this._bar.y=(this._value-this._min)/$p*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/$p*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},$i.onBgMouseDown=function($i){var $p=this._bg.getMousePoint();this.isVertical?this.value=$p.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=$p.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},$q(0,$i,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),$q(0,$i,"skin",function(){return this._skin},function($i){if(this._skin!=$i){this._skin=$i,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var $p=this._skin.replace(".png","$progress.png");$M.getRes($p)&&(this._progress||(this.addChild(this._progress=new $L),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=$p),this.setBarPoint(),this.callLater(this.changeValue)}}),$q(0,$i,"allowClickBack",function(){return this._allowClickBack},function($i){this._allowClickBack!=$i&&((this._allowClickBack=$i)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),$q(0,$i,"max",function(){return this._max},function($i){this._max!=$i&&(this._max=$i,this.callLater(this.changeValue))}),$q(0,$i,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),$q(0,$i,"tick",function(){return this._tick},function($i){this._tick!=$i&&(this._tick=$i,this.callLater(this.changeValue))}),$q(0,$i,"sizeGrid",function(){return this._bg.sizeGrid},function($i){this._bg.sizeGrid=$i,this._bar.sizeGrid=$i,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),$q(0,$i,"min",function(){return this._min},function($i){this._min!=$i&&(this._min=$i,this.callLater(this.changeValue))}),$q(0,$i,"value",function(){return this._value},function($i){if(this._value!=$i){var $p=this._value;this._value=$i,this.changeValue(),this._value!=$p&&this.sendChangeEvent()}}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)||"string"==typeof $i?this.value=Number($i):$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"bar",function(){return this._bar}),$J($F,["label",function(){return this.label=new $C}]),$F}($n),$L=function($p){function $F($i){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,$F.__super.call(this),this.skin=$i}$t($F,"laya.ui.Image",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,$M.clearCache(this,this._skin)},$i.dispose=function(){this.destroy(!0),$M.clearCache(this,this._skin),this.clearEvent()},$i.createChildren=function(){this.graphics=this._bitmap=new $m},$i.setSource=function($i,$p){this.destroyed||$i===this._skin&&$p&&(this.source=$p,this.onCompResize(),this.clearEvent())},$i.clearEvent=function(){this._skin&&$A.atalsNotify&&$A.atalsNotify.off(this._skin,this,this.setSource)},$i.clearLoad=function(){this._skin&&((this._complete||this._progress)&&$x.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},$q(0,$i,"source",function(){return this._bitmap.source},function($i){this._bitmap&&(this._bitmap.source=$i,this.event("loaded"),this.repaint())}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"string"==typeof(this._dataSource=$i)?this.skin=$i:$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"measureHeight",function(){return this._bitmap.height}),$q(0,$i,"skin",function(){return this._skin},function($i){if(this._skin!=$i)if($M.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=$i){$M.keepCache(this,this._skin);var $p=$M.getRes($i),$F=$A.resAtalsObj&&$A.resAtalsObj[this._skin];$p?(this.source=$p,this.onCompResize()):$F?($A.atalsNotify&&$A.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=$F.sourceW),0==this.height&&(this.height=$F.sourceH)):(this._complete=$S.create(this,this.setSource,[this._skin]),this._progress=null,$x.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),$q(0,$i,"group",function(){return this._group},function($i){$i&&this._skin&&$M.setGroup(this._skin,$i),this._group=$i}),$q(0,$i,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function($i){this._bitmap.sizeGrid=$c.fillArray($Y.defaultSizeGrid,$i,Number)}),$q(0,$i,"measureWidth",function(){return this._bitmap.width}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($n,this,"width",$i),this._bitmap.width=0==$i?1e-7:$i}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($n,this,"height",$i),this._bitmap.height=0==$i?1e-7:$i}),$F}($n),$C=function($p){function $F($i){this._tf=null,$F.__super.call(this),void 0===$i&&($i=""),$d.defaultColor=$Y.labelColor,this.text=$i}$t($F,"laya.ui.Label",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._tf=null},$i.createChildren=function(){this.addChild(this._tf=new $v)},$i.changeText=function($i){this._tf.changeText($i)},$q(0,$i,"padding",function(){return this._tf.padding.join(",")},function($i){this._tf.padding=$c.fillArray($Y.labelPadding,$i,Number)}),$q(0,$i,"bold",function(){return this._tf.bold},function($i){this._tf.bold=$i}),$q(0,$i,"align",function(){return this._tf.align},function($i){this._tf.align=$i}),$q(0,$i,"text",function(){return this._tf.text},function($i){this._tf.text!=$i&&($i&&($i=$c.adptString($i+"")),this._tf.text=$i,this.event("change"),this._width&&this._height||this.onCompResize())}),$q(0,$i,"italic",function(){return this._tf.italic},function($i){this._tf.italic=$i}),$q(0,$i,"wordWrap",function(){return this._tf.wordWrap},function($i){this._tf.wordWrap=$i}),$q(0,$i,"font",function(){return this._tf.font},function($i){this._tf.font=$i}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)||"string"==typeof $i?this.text=$i+"":$x.superSet($n,this,"dataSource",$i)}),$q(0,$i,"color",function(){return this._tf.color},function($i){this._tf.color=$i}),$q(0,$i,"valign",function(){return this._tf.valign},function($i){this._tf.valign=$i}),$q(0,$i,"leading",function(){return this._tf.leading},function($i){this._tf.leading=$i}),$q(0,$i,"fontSize",function(){return this._tf.fontSize},function($i){this._tf.fontSize=$i}),$q(0,$i,"bgColor",function(){return this._tf.bgColor},function($i){this._tf.bgColor=$i}),$q(0,$i,"borderColor",function(){return this._tf.borderColor},function($i){this._tf.borderColor=$i}),$q(0,$i,"stroke",function(){return this._tf.stroke},function($i){this._tf.stroke=$i}),$q(0,$i,"strokeColor",function(){return this._tf.strokeColor},function($i){this._tf.strokeColor=$i}),$q(0,$i,"textField",function(){return this._tf}),$q(0,$i,"measureWidth",function(){return this._tf.width}),$q(0,$i,"measureHeight",function(){return this._tf.height}),$q(0,$i,"width",function(){return this._width||this._tf.text?$x.superGet($n,this,"width"):0},function($i){$x.superSet($n,this,"width",$i),this._tf.width=$i}),$q(0,$i,"height",function(){return this._height||this._tf.text?$x.superGet($n,this,"height"):0},function($i){$x.superSet($n,this,"height",$i),this._tf.height=$i}),$q(0,$i,"overflow",function(){return this._tf.overflow},function($i){this._tf.overflow=$i}),$q(0,$i,"underline",function(){return this._tf.underline},function($i){this._tf.underline=$i}),$q(0,$i,"underlineColor",function(){return this._tf.underlineColor},function($i){this._tf.underlineColor=$i}),$F}($n),$K=function($p){function $F($i){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,$F.__super.call(this),this.skin=$i}$t($F,"laya.ui.ProgressBar",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._bg&&this._bg.destroy($i),this._bar&&this._bar.destroy($i),this._bg=this._bar=null,this.changeHandler=null},$i.createChildren=function(){this.addChild(this._bg=new $L),this.addChild(this._bar=new $L)},$i.changeValue=function(){if(this.sizeGrid){var $i=this.sizeGrid.split(","),$p=Number($i[3]),$F=Number($i[1]),$J=(this.width-$p-$F)*this._value;this._bar.width=$p+$F+$J,this._bar.visible=this._bar.width>$p+$F}else this._bar.width=this.width*this._value},$q(0,$i,"measureHeight",function(){return this._bg.height}),$q(0,$i,"skin",function(){return this._skin},function($i){this._skin!=$i&&(this._skin=$i,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),$q(0,$i,"measureWidth",function(){return this._bg.width}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($n,this,"height",$i),this._bg.height=this._height,this._bar.height=this._height}),$q(0,$i,"bar",function(){return this._bar}),$q(0,$i,"value",function(){return this._value},function($i){this._value!=$i&&($i=1<$i?1:$i<0?0:$i,this._value=$i,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith($i))}),$q(0,$i,"bg",function(){return this._bg}),$q(0,$i,"sizeGrid",function(){return this._bg.sizeGrid},function($i){this._bg.sizeGrid=this._bar.sizeGrid=$i}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($n,this,"width",$i),this._bg.width=this._width,this.callLater(this.changeValue)}),$q(0,$i,"dataSource",$p.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)||"string"==typeof $i?this.value=Number($i):$x.superSet($n,this,"dataSource",$i)}),$F}($n),$V=(function($i){function $F(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,$F.__super.call(this),this._tipBox=new $n,this._tipBox.addChild(this._tipText=new $v),this._tipText.x=this._tipText.y=5,this._tipText.color=$F.tipTextColor,this._defaultTipHandler=this._showDefaultTip,$x.stage.on("showtip",this,this._onStageShowTip),$x.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}$t($F,"laya.ui.TipManager",$n);var $p=$F.prototype;$p._onStageHideTip=function($i){$x.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},$p._onStageShowTip=function($i){$x.timer.once($F.tipDelay,this,this._showTip,[$i],!0)},$p._showTip=function($i){if("string"==typeof $i){var $p=String($i);Boolean($p)&&this._defaultTipHandler($p)}else $i instanceof laya.utils.Handler?$i.run():"function"==typeof $i&&$i.apply();$x.stage.on("mousemove",this,this._onStageMouseMove),$x.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},$p._onStageMouseDown=function($i){this.closeAll()},$p._onStageMouseMove=function($i){this._showToStage(this,$F.offsetX,$F.offsetY)},$p._showToStage=function($i,$p,$F){void 0===$p&&($p=0),void 0===$F&&($F=0);var $J=$i.getBounds();$i.x=$x.stage.mouseX+$p,$i.y=$x.stage.mouseY+$F,$i.x+$J.width>$x.stage.width&&($i.x-=$J.width+$p),$i.y+$J.height>$x.stage.height&&($i.y-=$J.height+$F)},$p.closeAll=function(){$x.timer.clear(this,this._showTip),$x.stage.off("mousemove",this,this._onStageMouseMove),$x.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},$p.showDislayTip=function($i){this.addChild($i),this._showToStage(this),$x._currentStage.addChild(this)},$p._showDefaultTip=function($i){this._tipText.text=$i;var $p=this._tipBox.graphics;$p.clear(),$p.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,$F.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),$x._currentStage.addChild(this)},$q(0,$p,"defaultTipHandler",function(){return this._defaultTipHandler},function($i){this._defaultTipHandler=$i}),$F.offsetX=10,$F.offsetY=15,$F.tipTextColor="#ffffff",$F.tipBackColor="#111111",$F.tipDelay=200}(),function($i){var $Z;function $s(){this._idMap=null,this._aniList=null,this._watchMap={},$s.__super.call(this)}$t($s,"laya.ui.View",$G);var $p=$s.prototype;return $p.createView=function($i){if($i.animations&&!this._idMap&&(this._idMap={}),$s.createComp($i,this,this),$i.animations){var $p,$F,$J=[],$A=$i.animations,$t=0,$q=$A.length;for($t=0;$t<$q;$t++){switch($p=new $u,$F=$A[$t],$p._setUp(this._idMap,$F),(this[$F.name]=$p)._setControlNode(this),$F.action){case 1:$p.play(0,!1);break;case 2:$p.play(0,!0)}$J.push($p)}this._aniList=$J}0<this._width&&null==$i.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},$p.onEvent=function($i,$p){},$p.loadUI=function($i){var $p=$s.uiMap[$i];$p&&this.createView($p)},$p.destroy=function($i){void 0===$i&&($i=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,$i)},$p.changeData=function($i){var $p=this._watchMap[$i];if($p){console.log("change",$i);for(var $F=0,$J=$p.length;$F<$J;$F++){$p[$F].exe(this)}}},$s._regs=function(){for(var $i in $s.uiClassMap)$j.regClass($i,$s.uiClassMap[$i])},$s.createComp=function($i,$p,$F,$J){if(!($p=$p||$s.getCompInstance($i)))return console.warn("can not create:"+$i.type),null;var $A=$i.child;if($A)for(var $t=$p instanceof laya.ui.List,$q=0,$B=$A.length;$q<$B;$q++){var $O=$A[$q];if(!$p.hasOwnProperty("itemRender")||"render"!=$O.props.name&&"render"!==$O.props.renderType)if("Graphic"==$O.type)$j.addGraphicsToSprite($O,$p);else if($j.isDrawType($O.type))$j.addGraphicToSprite($O,$p,!0);else{if($t){var $U=[],$d=$s.createComp($O,null,$F,$U);$U.length&&($d._$bindData=$U)}else $d=$s.createComp($O,null,$F,$J);"Script"==$O.type?"owner"in $d?$d.owner=$p:"target"in $d&&($d.target=$p):"mask"==$O.props.renderType||"mask"==$O.props.name?$p.mask=$d:$d instanceof laya.display.Sprite&&$p.addChild($d)}else $p.itemRender=$O}var $u=$i.props;for(var $S in $u){var $Z=$u[$S];$s.eventDic[$S]?$Z&&$F&&$p.on($S,$F,$F.onEvent,[$Z]):$s.setCompValue($p,$S,$Z,$F,$J)}return $x.__typeof($p,"laya.ui.IItem")&&$p.initItems(),$i.compId&&$F&&$F._idMap&&($F._idMap[$i.compId]=$p),$p},$s.setCompValue=function($i,$p,$F,$J,$A){if("string"==typeof $F&&-1<$F.indexOf("${")){if($s._sheet||($s._sheet=$j.getClass("laya.data.Table")),!$s._sheet)return void console.warn("Can not find class Sheet");if($A)$A.push($i,$p,$F);else if($J){-1==$F.indexOf("].")&&($F=$F.replace(".","[0]."));var $t,$q,$B=new $Z($i,$p,$F);$B.exe($J);for(var $O=$F.replace(/\[.*?\]\./g,".");null!=($t=$s._parseWatchData.exec($O));){for(var $U=$t[1];null!=($q=$s._parseKeyWord.exec($U));){var $d=$q[0],$u=$J._watchMap[$d]||($J._watchMap[$d]=[]);$u.push($B),$s._sheet.I.notifer.on($d,$J,$J.changeData,[$d])}($u=$J._watchMap[$U]||($J._watchMap[$U]=[])).push($B),$s._sheet.I.notifer.on($U,$J,$J.changeData,[$U])}}}else if("var"===$p&&$J)$J[$F]=$i;else if("onClick"==$p){var $S=$x._runScript("(function(){"+$F+"})");$i.on("click",$J,$S)}else $i[$p]="true"===$F||"false"!==$F&&$F},$s.getCompInstance=function($i){var $p,$F=$i.props?$i.props.runtime:null;return $p=$F?$s.viewClassMap[$F]||$s.uiClassMap[$F]||$x.__classmap[$F]:$s.uiClassMap[$i.type],$i.props&&$i.props.hasOwnProperty("renderType")&&"instance"==$i.props.renderType?$p.instance:$p?new $p:null},$s.regComponent=function($i,$p){$s.uiClassMap[$i]=$p,$j.regClass($i,$p)},$s.regViewRuntime=function($i,$p){$s.viewClassMap[$i]=$p},$s.uiMap={},$s.viewClassMap={},$s._sheet=null,$J($s,["uiClassMap",function(){return this.uiClassMap={ViewStack:$ii,LinkButton:$_,TextArea:$Ui,ColorPicker:$N,Box:$G,Button:$_,CheckBox:$T,Clip:$y,ComboBox:$f,Component:$n,HScrollBar:$X,HSlider:$b,Image:$L,Label:$C,List:$$,Panel:$e,ProgressBar:$K,Radio:$l,RadioGroup:$Bi,ScrollBar:$o,Slider:$W,Tab:$Oi,TextInput:$Fi,View:$s,VScrollBar:$pi,VSlider:$Ji,Tree:$H,HBox:$ti,VBox:$qi,Sprite:$E,Animation:$F,Text:$v,FontClip:$w}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),$s.__init$=function(){$s._regs(),$Z=function(){function $i($i,$p,$F){this.comp=null,this.prop=null,this.value=null,this.comp=$i,this.prop=$p,this.value=$F}return $t($i,""),$i.prototype.exe=function($i){var $p=$c.getBindFun(this.value);this.comp[this.prop]=$p.call(this,$i)},$i}()},$s}()),$T=function($i){function $F($i,$p){void 0===$p&&($p=""),$F.__super.call(this,$i,$p)}$t($F,"laya.ui.CheckBox",$i);var $p=$F.prototype;return $p.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},$p.initialize=function(){$i.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},$q(0,$p,"dataSource",$i.prototype._$get_dataSource,function($i){"boolean"==typeof(this._dataSource=$i)?this.selected=$i:"string"==typeof $i?this.selected="true"===$i:$x.superSet($_,this,"dataSource",$i)}),$F}($_),$k=function($i){function $p(){this._space=0,this._align="none",this._itemChanged=!1,$p.__super.call(this)}$t($p,"laya.ui.LayoutBox",$G);var $F=$p.prototype;return $F.addChild=function($i){return $i.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,$i)},$F.onResize=function($i){this._setItemChanged()},$F.addChildAt=function($i,$p){return $i.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,$i,$p)},$F.removeChild=function($i){return $i.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,$i)},$F.removeChildAt=function($i){return this.getChildAt($i).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,$i)},$F.refresh=function(){this._setItemChanged()},$F.changeItems=function(){this._itemChanged=!1},$F.sortItem=function($i){$i&&$i.sort(function($i,$p){return $i.y-$p.y})},$F._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},$q(0,$F,"space",function(){return this._space},function($i){this._space=$i,this._setItemChanged()}),$q(0,$F,"align",function(){return this._align},function($i){this._align=$i,this._setItemChanged()}),$p}(),$w=function($p){function $F($i,$p){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,$F.__super.call(this),$i&&(this.skin=$i),$p&&(this.sheet=$p)}$t($F,"laya.ui.FontClip",$p);var $i=$F.prototype;return $i.createChildren=function(){this._bitmap=new $m,this.on("loaded",this,this._onClipLoaded)},$i._onClipLoaded=function(){this.callLater(this.changeValue)},$i.changeValue=function(){var $i;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),$i=this._sources[0]))){var $p="horizontal"===this._direction;$p?(this._wordsW=this._valueArr.length*($i.sourceWidth+this.spaceX),this._wordsH=$i.sourceHeight):(this._wordsW=$i.sourceWidth,this._wordsH=($i.sourceHeight+this.spaceY)*this._valueArr.length);var $F=0;if(this._width)switch(this._align){case"center":$F=.5*(this._width-this._wordsW);break;case"right":$F=this._width-this._wordsW;break;default:$F=0}for(var $J=0,$A=this._valueArr.length;$J<$A;$J++){var $t=this._indexMap[this._valueArr.charAt($J)];this.sources[$t]&&($i=this.sources[$t],$p?this.graphics.drawTexture($i,$F+$J*($i.sourceWidth+this.spaceX),0,$i.sourceWidth,$i.sourceHeight):this.graphics.drawTexture($i,0+$F,$J*($i.sourceHeight+this.spaceY),$i.sourceWidth,$i.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},$i.destroy=function($i){void 0===$i&&($i=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),$p.prototype.destroy.call(this,$i)},$q(0,$i,"sheet",function(){return this._sheet},function($i){$i+="";var $p=(this._sheet=$i).split(" ");this._clipX=String($p[0]).length,this.clipY=$p.length,this._indexMap={};for(var $F=0;$F<this._clipY;$F++)for(var $J=$p[$F].split(""),$A=0,$t=$J.length;$A<$t;$A++)this._indexMap[$J[$A]]=$F*this._clipX+$A}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($y,this,"height",$i),this.callLater(this.changeValue)}),$q(0,$i,"direction",function(){return this._direction},function($i){this._direction=$i,this.callLater(this.changeValue)}),$q(0,$i,"value",function(){return this._valueArr?this._valueArr:""},function($i){$i+="",this._valueArr=$i,this.callLater(this.changeValue)}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($y,this,"width",$i),this.callLater(this.changeValue)}),$q(0,$i,"spaceX",function(){return this._spaceX},function($i){this._spaceX=$i,"horizontal"===this._direction&&this.callLater(this.changeValue)}),$q(0,$i,"spaceY",function(){return this._spaceY},function($i){this._spaceY=$i,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),$q(0,$i,"align",function(){return this._align},function($i){this._align=$i,this.callLater(this.changeValue)}),$q(0,$i,"measureWidth",function(){return this._wordsW}),$q(0,$i,"measureHeight",function(){return this._wordsH}),$F}($y),$$=function($i){function $p(){this.selectHandler=null,this.renderHandler=null,this.renderTwHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._twSwitch=!0,this._twDone=!0,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new $s,$p.__super.call(this)}$t($p,"laya.ui.List",$i);var $F=$p.prototype;return $x.imps($F,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),$F.destroy=function($i){void 0===$i&&($i=!0),this._content&&this._content.destroy($i),this._scrollBar&&this._scrollBar.destroy($i),laya.ui.Component.prototype.destroy.call(this,$i),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this._twSwitch=null,this._twDone=null,this.selectHandler=this.renderHandler=this.mouseHandler=this.renderTwHandler=null},$F.createChildren=function(){this.addChild(this._content=new $G)},$F.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$x.superGet($G,this,"cacheAs")),$x.superSet($G,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},$F.onScrollEnd=function(){$x.superSet($G,this,"cacheAs",this._$P.cacheAs)},$F._removePreScrollBar=function(){var $i=this.removeChildByName("scrollBar");$i&&$i.destroy(!0)},$F.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var $i=this._getOneCell(),$p=$i.width+this._spaceX||1,$F=$i.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/$p):Math.ceil(this._width/$p)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/$F):Math.round(this._height/$F));var $J=this._width?this._width:$p*this.repeatX-this._spaceX,$A=this._height?this._height:$F*this.repeatY-this._spaceY;this._cellSize=this._isVertical?$F:$p,this._cellOffset=this._isVertical?$F*Math.max(this._repeatY2,this._repeatY)-$A-this._spaceY:$p*Math.max(this._repeatX2,this._repeatX)-$J-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=$A:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=$J),this.setContentSize($J,$A);var $t=this._isVertical?this.repeatX:this.repeatY,$q=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,$t,$q),this._createdLine=$q,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},$F._getOneCell=function(){if(0===this._cells.length){var $i=this.createItem();if(this._offset.setTo($i.x,$i.y),this.cacheContent)return $i;this._cells.push($i)}return this._cells[0]},$F._createItems=function($i,$p,$F){var $J=this._content,$A=this._getOneCell(),$t=$A.width+this._spaceX,$q=$A.height+this._spaceY;if(this.cacheContent){var $B=new $G;$B.cacheAsBitmap=!0,$B.pos((this._isVertical?0:$i)*$t,(this._isVertical?$i:0)*$q),this._content.addChild($B),this._content.optimizeScrollRect=!0,$J=$B}else{for(var $O=[],$U=this._cells.length-1;-1<$U;$U--){var $d=this._cells[$U];$d.removeSelf(),$O.push($d)}this._cells.length=0}for(var $u=$i;$u<$F;$u++)for(var $S=0;$S<$p;$S++)($A=$O&&$O.length?$O.pop():this.createItem()).x=(this._isVertical?$S:$u)*$t-$J.x,$A.y=(this._isVertical?$u:$S)*$q-$J.y,$A.name="item"+($u*$p+$S),$J.addChild($A),this.addCell($A)},$F.createItem=function(){var $i=[];if("function"==typeof this._itemRender)var $p=new this._itemRender;else $p=$V.createComp(this._itemRender,null,null,$i);if(0==$i.length&&$p._watchMap){var $F=$p._watchMap;for(var $J in $F)for(var $A=$F[$J],$t=0;$t<$A.length;$t++){var $q=$A[$t];$i.push($q.comp,$q.prop,$q.value)}}return $i.length&&($p._$bindData=$i),$p},$F.addCell=function($i){$i.on("click",this,this.onCellMouse),$i.on("rightclick",this,this.onCellMouse),$i.on("mouseover",this,this.onCellMouse),$i.on("mouseout",this,this.onCellMouse),$i.on("mousedown",this,this.onCellMouse),$i.on("mouseup",this,this.onCellMouse),this._cells.push($i)},$F.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var $i=0,$p=$i=0;$p<1e4;$p++){var $F=this.getChildByName("item"+$p);if(!$F)break;this.addCell($F),$i++}this.repeatY=$i}},$F.setContentSize=function($i,$p){this._content.width=$i,this._content.height=$p,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new $r),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,$i,$p),this._content.scrollRect=this._content.scrollRect),this.event("resize")},$F.onCellMouse=function($i){"mousedown"===$i.type&&(this._isMoved=!1);var $p=$i.currentTarget,$F=this._startIndex+this._cells.indexOf($p);$F<0||("click"===$i.type||"rightclick"===$i.type?this.selectEnable&&!this._isMoved?this.selectedIndex=$F:this.changeCellState($p,!0,0):"mouseover"!==$i.type&&"mouseout"!==$i.type||this._selectedIndex===$F||this.changeCellState($p,"mouseover"===$i.type,0),this.mouseHandler&&this.mouseHandler.runWith([$i,$F]))},$F.changeCellState=function($i,$p,$F){var $J=$i.getChildByName("selectBox");$J&&(this.selectEnable=!0,$J.visible=$p,$J.index=$F)},$F.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},$F.onScrollBarChange=function($i){this.runCallLater(this.changeCells);var $p=this._scrollBar.value,$F=this._isVertical?this.repeatX:this.repeatY,$J=this._isVertical?this.repeatY:this.repeatX,$A=Math.floor($p/this._cellSize);if(this.cacheContent)$q=$J+1,this._createdLine-$A<$q&&(this._createItems(this._createdLine,$F,this._createdLine+$q),this.renderItems(this._createdLine*$F,0),this._createdLine+=$q);else{var $t=$A*$F,$q=0;if($t>this._startIndex){$q=$t-this._startIndex;var $B=!0,$O=this._startIndex+$F*($J+1);this._isMoved=!0}else $t<this._startIndex&&($q=this._startIndex-$t,$B=!1,$O=this._startIndex-1,this._isMoved=!0);for(var $U=0;$U<$q;$U++){if($B){var $d=this._cells.shift();this._cells[this._cells.length]=$d;var $u=$O+$U}else $d=this._cells.pop(),this._cells.unshift($d),$u=$O-$U;var $S=Math.floor($u/$F)*this._cellSize;this._isVertical?$d.y=$S:$d.x=$S,this.renderItem($d,$u)}this._startIndex=$t,this.changeSelectStatus()}var $Z=this._content.scrollRect;this._isVertical?($Z.y=$p-this._offset.y,$Z.x=-this._offset.x):($Z.y=-this._offset.y,$Z.x=$p-this._offset.x),this._content.scrollRect=$Z},$F.posCell=function($i,$p){if(this._scrollBar){var $F=this._isVertical?this.repeatX:this.repeatY,$J=(this._isVertical?this.repeatY:this.repeatX,Math.floor($p/$F)*this._cellSize);this._isVertical?$i.y=$J:$i.x=$J}},$F.changeSelectStatus=function(){for(var $i=0,$p=this._cells.length;$i<$p;$i++)this.changeCellState(this._cells[$i],this._selectedIndex===this._startIndex+$i,1)},$F.renderItems=function($i,$p){void 0===$i&&($i=0),void 0===$p&&($p=0);for(var $F=$i,$J=$p||this._cells.length;$F<$J;$F++)this.renderItem(this._cells[$F],this._startIndex+$F);this.changeSelectStatus(),this._twDone=!0},$F.renderItem=function($i,$p){this._array&&0<=$p&&$p<this._array.length?($i.visible=!0,$i._$bindData?($i._dataSource=this._array[$p],this._bindData($i,this._array[$p])):$i.dataSource=this._array[$p],this.cacheContent||this.posCell($i,$p),this.hasListener("render")&&this.event("render",[$i,$p]),this.renderHandler&&this.renderHandler.runWith([$i,$p]),this.renderTwHandler&&this.renderTwHandler.runWith([$i,$p])):($i.visible=!1,$i.dataSource=null)},$F._bindData=function($i,$p){for(var $F=$i._$bindData,$J=0,$A=$F.length;$J<$A;$J++){var $t=$F[$J++],$q=$F[$J++],$B=$F[$J],$O=$c.getBindFun($B);$t[$q]=$O.call(this,$p)}},$F.refresh=function(){this.array=this._array},$F.getItem=function($i){return-1<$i&&$i<this._array.length?this._array[$i]:null},$F.changeItem=function($i,$p){-1<$i&&$i<this._array.length&&(this._array[$i]=$p,$i>=this._startIndex&&$i<this._startIndex+this._cells.length&&this.renderItem(this.getCell($i),$i))},$F.setItem=function($i,$p){this.changeItem($i,$p)},$F.addItem=function($i){this._array.push($i),this.array=this._array},$F.addItemAt=function($i,$p){this._array.splice($p,0,$i),this.array=this._array},$F.deleteItem=function($i){this._array.splice($i,1),this.array=this._array},$F.getCell=function($i){return this.runCallLater(this.changeCells),-1<$i&&this._cells?this._cells[($i-this._startIndex)%this._cells.length]:null},$F.scrollTo=function($i){if(this._scrollBar){var $p=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor($i/$p)*this._cellSize}else this.startIndex=$i},$F.tweenTo=function($i,$p,$F){if(void 0===$p&&($p=200),this._scrollBar){var $J=this._isVertical?this.repeatX:this.repeatY;$a.to(this._scrollBar,{value:Math.floor($i/$J)*this._cellSize},$p,null,$F,0,!0)}else this.startIndex=$i,$F&&$F.run()},$F._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},$F.commitMeasure=function(){this.runCallLater(this.changeCells)},$q(0,$F,"cacheAs",$i.prototype._$get_cacheAs,function($i){$x.superSet($G,this,"cacheAs",$i),this._scrollBar&&(this._$P.cacheAs=null,"none"!==$i?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),$q(0,$F,"content",function(){return this._content}),$q(0,$F,"height",$i.prototype._$get_height,function($i){$i!=this._height&&($x.superSet($G,this,"height",$i),this._setCellChanged())}),$q(0,$F,"itemRender",function(){return this._itemRender},function($i){if(this._itemRender!=$i){this._itemRender=$i;for(var $p=this._cells.length-1;-1<$p;$p--)this._cells[$p].destroy();this._cells.length=0,this._setCellChanged()}}),$q(0,$F,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($i){this._removePreScrollBar();var $p=new $pi;$p.name="scrollBar",$p.right=0,$i&&" "!=$i&&($p.skin=$i),this.scrollBar=$p,this.addChild($p),this._setCellChanged()}),$q(0,$F,"page",function(){return this._page},function($i){this._page=$i,this._array&&(this._page=0<$i?$i:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),$q(0,$F,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function($i){this._removePreScrollBar();var $p=new $X;$p.name="scrollBar",$p.bottom=0,$i&&" "!=$i&&($p.skin=$i),this.scrollBar=$p,this.addChild($p),this._setCellChanged()}),$q(0,$F,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function($i){this._repeatX=$i,this._setCellChanged()}),$q(0,$F,"scrollBar",function(){return this._scrollBar},function($i){this._scrollBar!=$i&&(this._scrollBar=$i)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),$q(0,$F,"width",$i.prototype._$get_width,function($i){$i!=this._width&&($x.superSet($G,this,"width",$i),this._setCellChanged())}),$q(0,$F,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function($i){this._repeatY=$i,this._setCellChanged()}),$q(0,$F,"spaceX",function(){return this._spaceX},function($i){this._spaceX=$i,this._setCellChanged()}),$q(0,$F,"spaceY",function(){return this._spaceY},function($i){this._spaceY=$i,this._setCellChanged()}),$q(0,$F,"selectedIndex",function(){return this._selectedIndex},function($i){this._selectedIndex!=$i&&(this._selectedIndex=$i,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith($i),this.startIndex=this._startIndex)}),$q(0,$F,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function($i){this.selectedIndex=this._array.indexOf($i)}),$q(0,$F,"length",function(){return this._array?this._array.length:0}),$q(0,$F,"selection",function(){return this.getCell(this._selectedIndex)},function($i){this.selectedIndex=this._startIndex+this._cells.indexOf($i)}),$q(0,$F,"startIndex",function(){return this._startIndex},function($i){this._startIndex=0<$i?$i:0,this.callLater(this.renderItems)}),$q(0,$F,"twSwitch",function(){return this._twSwitch},function($i){this._twSwitch=$i}),$q(0,$F,"twDone",function(){return this._twDone},function($i){this._twDone=$i}),$q(0,$F,"array",function(){return this._array},function($i){this.runCallLater(this.changeCells),this._array=$i||[];var $p=this._array.length;if(this.totalPage=Math.ceil($p/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<$p?this._selectedIndex:$p-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var $F=this._isVertical?this.repeatX:this.repeatY,$J=this._isVertical?this.repeatY:this.repeatX,$A=Math.ceil($p/$F);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=$J/$A,this._scrollBar.setScroll(0,($A-$J)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),$q(0,$F,"dataSource",$i.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)&&Math.floor($i)==$i||"string"==typeof $i?this.selectedIndex=parseInt($i):$i instanceof Array?this.array=$i:$x.superSet($G,this,"dataSource",$i)}),$q(0,$F,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),$p}($G),$X=function($i){function $p(){$p.__super.call(this)}return $t($p,"laya.ui.HScrollBar",$i),$p.prototype.initialize=function(){$i.prototype.initialize.call(this),this.slider.isVertical=!1},$p}($o),$e=function($i){function $p(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,$p.__super.call(this),this.width=this.height=100}$t($p,"laya.ui.Panel",$i);var $F=$p.prototype;return $F.destroy=function($i){void 0===$i&&($i=!0),laya.ui.Component.prototype.destroy.call(this,$i),this._content&&this._content.destroy($i),this._vScrollBar&&this._vScrollBar.destroy($i),this._hScrollBar&&this._hScrollBar.destroy($i),this._vScrollBar=null,this._hScrollBar=null,this._content=null},$F.destroyChildren=function(){this._content.destroyChildren()},$F.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new $G)},$F.addChild=function($i){return $i.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild($i)},$F.onResize=function(){this._setScrollChanged()},$F.addChildAt=function($i,$p){return $i.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt($i,$p)},$F.removeChild=function($i){return $i.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild($i)},$F.removeChildAt=function($i){return this.getChildAt($i).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt($i)},$F.removeChildren=function($i,$p){return void 0===$i&&($i=0),void 0===$p&&($p=2147483647),this._content.removeChildren($i,$p),this._setScrollChanged(),this},$F.getChildAt=function($i){return this._content.getChildAt($i)},$F.getChildByName=function($i){return this._content.getChildByName($i)},$F.getChildIndex=function($i){return this._content.getChildIndex($i)},$F.changeScroll=function(){this._scrollChanged=!1;var $i=this.contentWidth||1,$p=this.contentHeight||1,$F=this._vScrollBar,$J=this._hScrollBar,$A=$F&&$p>this._height,$t=$J&&$i>this._width,$q=$A?this._width-$F.width:this._width,$B=$t?this._height-$J.height:this._height;$F&&($F.x=this._width-$F.width,$F.y=0,$F.height=this._height-($t?$J.height:0),$F.scrollSize=Math.max(.033*this._height,1),$F.thumbPercent=$B/$p,$F.setScroll(0,$p-$B,$F.value)),$J&&($J.x=0,$J.y=this._height-$J.height,$J.width=this._width-($A?$F.width:0),$J.scrollSize=Math.max(.033*this._width,1),$J.thumbPercent=$q/$i,$J.setScroll(0,$i-$q,$J.value))},$F.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},$F.setContentSize=function($i,$p){var $F=this._content;$F.width=$i,$F.height=$p,$F.scrollRect||($F.scrollRect=new $r),$F.scrollRect.setTo(0,0,$i,$p),$F.scrollRect=$F.scrollRect},$F.onScrollBarChange=function($i){var $p=this._content.scrollRect;if($p){var $F=Math.round($i.value);$i.isVertical?$p.y=$F:$p.x=$F,this._content.scrollRect=$p}},$F.scrollTo=function($i,$p){void 0===$i&&($i=0),void 0===$p&&($p=0),this.vScrollBar&&(this.vScrollBar.value=$p),this.hScrollBar&&(this.hScrollBar.value=$i)},$F.refresh=function(){this.changeScroll()},$F.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=$x.superGet($G,this,"cacheAs")),$x.superSet($G,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},$F.onScrollEnd=function(){$x.superSet($G,this,"cacheAs",this._$P.cacheAs)},$F._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},$q(0,$F,"numChildren",function(){return this._content.numChildren}),$q(0,$F,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($i){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new $X),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=$i}),$q(0,$F,"contentWidth",function(){for(var $i=0,$p=this._content.numChildren-1;-1<$p;$p--){var $F=this._content.getChildAt($p);$i=Math.max($F.x+$F.width*$F.scaleX,$i)}return $i}),$q(0,$F,"contentHeight",function(){for(var $i=0,$p=this._content.numChildren-1;-1<$p;$p--){var $F=this._content.getChildAt($p);$i=Math.max($F.y+$F.height*$F.scaleY,$i)}return $i}),$q(0,$F,"width",$i.prototype._$get_width,function($i){$x.superSet($G,this,"width",$i),this._setScrollChanged()}),$q(0,$F,"hScrollBar",function(){return this._hScrollBar}),$q(0,$F,"content",function(){return this._content}),$q(0,$F,"height",$i.prototype._$get_height,function($i){$x.superSet($G,this,"height",$i),this._setScrollChanged()}),$q(0,$F,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($i){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new $pi),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=$i}),$q(0,$F,"vScrollBar",function(){return this._vScrollBar}),$q(0,$F,"cacheAs",$i.prototype._$get_cacheAs,function($i){$x.superSet($G,this,"cacheAs",$i),this._$P.cacheAs=null,"none"!==$i?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),$p}($G),$b=function($i){function $p($i){$p.__super.call(this,$i),this.isVertical=!1}return $t($p,"laya.ui.HSlider",$W),$p}(),$z=function($i){function $F($i,$p){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,$F.__super.call(this),this.skin=$p,this.labels=$i}$t($F,"laya.ui.UIGroup",$i);var $p=$F.prototype;return $x.imps($p,{"laya.ui.IItem":!0}),$p.preinitialize=function(){this.mouseEnabled=!0},$p.destroy=function($i){void 0===$i&&($i=!0),laya.ui.Component.prototype.destroy.call(this,$i),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},$p.addItem=function($i,$p){void 0===$p&&($p=!0);var $F=$i,$J=this._items.length;if($F.name="item"+$J,this.addChild($F),this.initItems(),$p&&0<$J){var $A=this._items[$J-1];"horizontal"==this._direction?$F.x=$A.x+$A.width+this._space:$F.y=$A.y+$A.height+this._space}else $p&&($F.x=0,$F.y=0);return $J},$p.delItem=function($i,$p){void 0===$p&&($p=!0);var $F=this._items.indexOf($i);if(-1!=$F){var $J=$i;this.removeChild($J);for(var $A=$F+1,$t=this._items.length;$A<$t;$A++){var $q=this._items[$A];$q.name="item"+($A-1),$p&&("horizontal"==this._direction?$q.x-=$J.width+this._space:$q.y-=$J.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var $B;$B=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=$B}}},$p.initItems=function(){this._items||(this._items=[]);for(var $i=this._items.length=0;$i<1e4;$i++){var $p=this.getChildByName("item"+$i);if(null==$p)break;this._items.push($p),$p.selected=$i===this._selectedIndex,$p.clickHandler=$S.create(this,this.itemClick,[$i],!1)}},$p.itemClick=function($i){this.selectedIndex=$i},$p.setSelect=function($i,$p){this._items&&-1<$i&&$i<this._items.length&&(this._items[$i].selected=$p)},$p.createItem=function($i,$p){return null},$p.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var $i=0,$p=0,$F=this._items.length;$p<$F;$p++){var $J=this._items[$p];this._skin&&($J.skin=this._skin),this._labelColors&&($J.labelColors=this._labelColors),this._labelSize&&($J.labelSize=this._labelSize),this._labelStroke&&($J.labelStroke=this._labelStroke),this._labelStrokeColor&&($J.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&($J.strokeColors=this._strokeColors),this._labelBold&&($J.labelBold=this._labelBold),this._labelPadding&&($J.labelPadding=this._labelPadding),this._labelAlign&&($J.labelAlign=this._labelAlign),this._stateNum&&($J.stateNum=this._stateNum),this._labelFont&&($J.labelFont=this._labelFont),"horizontal"===this._direction?($J.y=0,$J.x=$i,$i+=$J.width+this._space):($J.x=0,$J.y=$i,$i+=$J.height+this._space)}this.changeSize()},$p.commitMeasure=function(){this.runCallLater(this.changeLabels)},$p._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},$q(0,$p,"labelStrokeColor",function(){return this._labelStrokeColor},function($i){this._labelStrokeColor!=$i&&(this._labelStrokeColor=$i,this._setLabelChanged())}),$q(0,$p,"skin",function(){return this._skin},function($i){this._skin!=$i&&(this._skin=$i,this._setLabelChanged())}),$q(0,$p,"selectedIndex",function(){return this._selectedIndex},function($i){this._selectedIndex!=$i&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$i,this.setSelect($i,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),$q(0,$p,"labels",function(){return this._labels},function($i){if(this._labels!=$i){if(this._labels=$i,this.removeChildren(),this._setLabelChanged(),this._labels)for(var $p=this._labels.split(","),$F=0,$J=$p.length;$F<$J;$F++){var $A=this.createItem(this._skin,$p[$F]);$A.name="item"+$F,this.addChild($A)}this.initItems()}}),$q(0,$p,"strokeColors",function(){return this._strokeColors},function($i){this._strokeColors!=$i&&(this._strokeColors=$i,this._setLabelChanged())}),$q(0,$p,"labelColors",function(){return this._labelColors},function($i){this._labelColors!=$i&&(this._labelColors=$i,this._setLabelChanged())}),$q(0,$p,"labelStroke",function(){return this._labelStroke},function($i){this._labelStroke!=$i&&(this._labelStroke=$i,this._setLabelChanged())}),$q(0,$p,"labelSize",function(){return this._labelSize},function($i){this._labelSize!=$i&&(this._labelSize=$i,this._setLabelChanged())}),$q(0,$p,"stateNum",function(){return this._stateNum},function($i){this._stateNum!=$i&&(this._stateNum=$i,this._setLabelChanged())}),$q(0,$p,"labelBold",function(){return this._labelBold},function($i){this._labelBold!=$i&&(this._labelBold=$i,this._setLabelChanged())}),$q(0,$p,"labelFont",function(){return this._labelFont},function($i){this._labelFont!=$i&&(this._labelFont=$i,this._setLabelChanged())}),$q(0,$p,"labelPadding",function(){return this._labelPadding},function($i){this._labelPadding!=$i&&(this._labelPadding=$i,this._setLabelChanged())}),$q(0,$p,"direction",function(){return this._direction},function($i){this._direction=$i,this._setLabelChanged()}),$q(0,$p,"space",function(){return this._space},function($i){this._space=$i,this._setLabelChanged()}),$q(0,$p,"items",function(){return this._items}),$q(0,$p,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($i){this.selectedIndex=this._items.indexOf($i)}),$q(0,$p,"dataSource",$i.prototype._$get_dataSource,function($i){"number"==typeof(this._dataSource=$i)&&Math.floor($i)==$i||"string"==typeof $i?this.selectedIndex=parseInt($i):$i instanceof Array?this.labels=$i.join(","):$x.superSet($G,this,"dataSource",$i)}),$F}($G),$l=function($p){function $F($i,$p){this._value=null,void 0===$p&&($p=""),$F.__super.call(this,$i,$p)}$t($F,"laya.ui.Radio",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._value=null},$i.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},$i.initialize=function(){$p.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},$i.onClick=function($i){this.selected=!0},$q(0,$i,"value",function(){return null!=this._value?this._value:this.label},function($i){this._value=$i}),$F}($_),$H=function($i){function $p(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,$p.__super.call(this),this.width=this.height=200}$t($p,"laya.ui.Tree",$i);var $F=$p.prototype;return $x.imps($F,{"laya.ui.IRender":!0}),$F.destroy=function($i){void 0===$i&&($i=!0),laya.ui.Component.prototype.destroy.call(this,$i),this._list&&this._list.destroy($i),this._list=null,this._source=null,this._renderHandler=null},$F.createChildren=function(){this.addChild(this._list=new $$),this._list.renderHandler=$S.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},$F.onListChange=function($i){this.event("change")},$F.getArray=function(){var $i,$p=[];for(var $F in this._source)$i=this._source[$F],this.getParentOpenStatus($i)&&($i.x=this._spaceLeft*this.getDepth($i),$p.push($i));return $p},$F.getDepth=function($i,$p){return void 0===$p&&($p=0),null==$i.nodeParent?$p:this.getDepth($i.nodeParent,$p+1)},$F.getParentOpenStatus=function($i){var $p=$i.nodeParent;return null==$p||!!$p.isOpen&&(null==$p.nodeParent||this.getParentOpenStatus($p))},$F.renderItem=function($i,$p){var $F=$i.dataSource;if($F){$i.left=$F.x;var $J=$i.getChildByName("arrow");$J&&($F.hasChild?($J.visible=!0,$J.index=$F.isOpen?1:0,$J.tag=$p,$J.off("click",this,this.onArrowClick),$J.on("click",this,this.onArrowClick)):$J.visible=!1);var $A=$i.getChildByName("folder");$A&&(2==$A.clipY?$A.index=$F.isDirectory?0:1:$A.index=$F.isDirectory?$F.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([$i,$p])}},$F.onArrowClick=function($i){var $p=$i.currentTarget.tag;this._list.array[$p].isOpen=!this._list.array[$p].isOpen,this.event("open"),this._list.array=this.getArray()},$F.setItemState=function($i,$p){this._list.array[$i]&&(this._list.array[$i].isOpen=$p,this._list.array=this.getArray())},$F.fresh=function(){this._list.array=this.getArray(),this.repaint()},$F.parseXml=function($i,$p,$F,$J){var $A,$t=$i.childNodes,$q=$t.length;if(!$J){$A={};var $B,$O=$i.attributes;for(var $U in $O){var $d=($B=$O[$U]).nodeName,$u=$B.nodeValue;$A[$d]="true"==$u||"false"!=$u&&$u}$A.nodeParent=$F,0<$q&&($A.isDirectory=!0),$A.hasChild=0<$q,$p.push($A)}for(var $S=0;$S<$q;$S++){var $Z=$t[$S];this.parseXml($Z,$p,$A,!1)}},$F.parseOpenStatus=function($i,$p){for(var $F=0,$J=$p.length;$F<$J;$F++){var $A=$p[$F];if($A.isDirectory)for(var $t=0,$q=$i.length;$t<$q;$t++){var $B=$i[$t];if($B.isDirectory&&this.isSameParent($B,$A)&&$A.label==$B.label){$A.isOpen=$B.isOpen;break}}}},$F.isSameParent=function($i,$p){return null==$i.nodeParent&&null==$p.nodeParent||null!=$i.nodeParent&&null!=$p.nodeParent&&($i.nodeParent.label==$p.nodeParent.label&&this.isSameParent($i.nodeParent,$p.nodeParent))},$F.filter=function($i){if(Boolean($i)){var $p=[];this.getFilterSource(this._source,$p,$i),this._list.array=$p}else this._list.array=this.getArray()},$F.getFilterSource=function($i,$p,$F){var $J;for(var $A in $F=$F.toLocaleLowerCase(),$i)!($J=$i[$A]).isDirectory&&-1<String($J.label).toLowerCase().indexOf($F)&&($J.x=0,$p.push($J)),$J.child&&0<$J.child.length&&this.getFilterSource($J.child,$p,$F)},$q(0,$F,"spaceBottom",function(){return this._list.spaceY},function($i){this._list.spaceY=$i}),$q(0,$F,"keepStatus",function(){return this._keepStatus},function($i){this._keepStatus=$i}),$q(0,$F,"itemRender",function(){return this._list.itemRender},function($i){this._list.itemRender=$i}),$q(0,$F,"array",function(){return this._list.array},function($i){this._keepStatus&&this._list.array&&$i&&this.parseOpenStatus(this._list.array,$i),this._source=$i,this._list.array=this.getArray()}),$q(0,$F,"mouseHandler",function(){return this._list.mouseHandler},function($i){this._list.mouseHandler=$i}),$q(0,$F,"dataSource",$i.prototype._$get_dataSource,function($i){this._dataSource=$i,$x.superSet($G,this,"dataSource",$i)}),$q(0,$F,"source",function(){return this._source}),$q(0,$F,"scrollBar",function(){return this._list.scrollBar}),$q(0,$F,"list",function(){return this._list}),$q(0,$F,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function($i){this._list.vScrollBarSkin=$i}),$q(0,$F,"renderHandler",function(){return this._renderHandler},function($i){this._renderHandler=$i}),$q(0,$F,"selectedIndex",function(){return this._list.selectedIndex},function($i){this._list.selectedIndex=$i}),$q(0,$F,"spaceLeft",function(){return this._spaceLeft},function($i){this._spaceLeft=$i}),$q(0,$F,"selectedItem",function(){return this._list.selectedItem},function($i){this._list.selectedItem=$i}),$q(0,$F,"width",$i.prototype._$get_width,function($i){$x.superSet($G,this,"width",$i),this._list.width=$i}),$q(0,$F,"height",$i.prototype._$get_height,function($i){$x.superSet($G,this,"height",$i),this._list.height=$i}),$q(0,$F,"xml",null,function($i){var $p=[];this.parseXml($i.childNodes[0],$p,null,!0),this.array=$p}),$q(0,$F,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),$p}($G),$ii=function($i){function $p(){this._items=null,this._selectedIndex=0,$p.__super.call(this),this._setIndexHandler=$S.create(this,this.setIndex,null,!1)}$t($p,"laya.ui.ViewStack",$i);var $F=$p.prototype;return $x.imps($F,{"laya.ui.IItem":!0}),$F.setItems=function($i){this.removeChildren();for(var $p=0,$F=0,$J=$i.length;$F<$J;$F++){var $A=$i[$F];$A&&($A.name="item"+$p,this.addChild($A),$p++)}this.initItems()},$F.addItem=function($i){$i.name="item"+this._items.length,this.addChild($i),this.initItems()},$F.initItems=function(){this._items=[];for(var $i=0;$i<1e4;$i++){var $p=this.getChildByName("item"+$i);if(null==$p)break;this._items.push($p),$p.visible=$i==this._selectedIndex}},$F.setSelect=function($i,$p){this._items&&-1<$i&&$i<this._items.length&&(this._items[$i].visible=$p)},$F.setIndex=function($i){this.selectedIndex=$i},$q(0,$F,"dataSource",$i.prototype._$get_dataSource,function($i){if("number"==typeof(this._dataSource=$i)&&Math.floor($i)==$i||"string"==typeof $i)this.selectedIndex=parseInt($i);else for(var $p in this._dataSource)this.hasOwnProperty($p)&&(this[$p]=this._dataSource[$p])}),$q(0,$F,"selectedIndex",function(){return this._selectedIndex},function($i){this._selectedIndex!=$i&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=$i,this.setSelect(this._selectedIndex,!0))}),$q(0,$F,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function($i){this.selectedIndex=this._items.indexOf($i)}),$q(0,$F,"items",function(){return this._items}),$q(0,$F,"setIndexHandler",function(){return this._setIndexHandler},function($i){this._setIndexHandler=$i}),$p}($G),$pi=function($i){function $p(){$p.__super.call(this)}return $t($p,"laya.ui.VScrollBar",$o),$p}(),$Fi=function($p){function $F($i){this._bg=null,this._skin=null,$F.__super.call(this),void 0===$i&&($i=""),this.text=$i,this.skin=this.skin}$t($F,"laya.ui.TextInput",$p);var $i=$F.prototype;return $i.preinitialize=function(){this.mouseEnabled=!0},$i.destroy=function($i){$M.clearCache(this,this._skin),void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._bg&&this._bg.destroy(),this._bg=null},$i.createChildren=function(){this.addChild(this._tf=new $Z),this._tf.padding=$Y.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},$i._onFocus=function(){this.event("focus",this)},$i._onBlur=function(){this.event("blur",this)},$i._onInput=function(){this.event("input",this)},$i._onEnter=function(){this.event("enter",this)},$i.initialize=function(){this.width=128,this.height=22},$i.select=function(){this._tf.select()},$i.setSelection=function($i,$p){this._tf.setSelection($i,$p)},$q(0,$i,"text",$p.prototype._$get_text,function($i){this._tf.text!=$i&&($i+="",this._tf.text=$i,this.event("change"))}),$q(0,$i,"bg",function(){return this._bg},function($i){this.graphics=this._bg=$i}),$q(0,$i,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function($i){this._tf.inputElementYAdjuster=$i}),$q(0,$i,"multiline",function(){return this._tf.multiline},function($i){this._tf.multiline=$i}),$q(0,$i,"skin",function(){return this._skin},function($i){this._skin!=$i&&($M.clearCache(this,this._skin),this._skin=$i,this._bg||(this.graphics=this._bg=new $m),$M.keepCache(this,this._skin),this._bg.source=$M.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),$q(0,$i,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function($i){this._bg||(this.graphics=this._bg=new $m),this._bg.sizeGrid=$c.fillArray($Y.defaultSizeGrid,$i,Number)}),$q(0,$i,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function($i){this._tf.inputElementXAdjuster=$i}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($C,this,"width",$i),this._bg&&(this._bg.width=$i)}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($C,this,"height",$i),this._bg&&(this._bg.height=$i)}),$q(0,$i,"editable",function(){return this._tf.editable},function($i){this._tf.editable=$i}),$q(0,$i,"restrict",function(){return this._tf.restrict},function($i){this._tf.restrict=$i}),$q(0,$i,"prompt",function(){return this._tf.prompt},function($i){this._tf.prompt=$i}),$q(0,$i,"promptColor",function(){return this._tf.promptColor},function($i){this._tf.promptColor=$i}),$q(0,$i,"maxChars",function(){return this._tf.maxChars},function($i){this._tf.maxChars=$i}),$q(0,$i,"focus",function(){return this._tf.focus},function($i){this._tf.focus=$i}),$q(0,$i,"type",function(){return this._tf.type},function($i){this._tf.type=$i}),$q(0,$i,"asPassword",function(){return this._tf.asPassword},function($i){this._tf.asPassword=$i}),$F}($C),$Ji=function($i){function $p(){$p.__super.call(this)}return $t($p,"laya.ui.VSlider",$W),$p}(),$Ai=function($i){function $J(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,$J.__super.call(this)}$t($J,"laya.ui.Dialog",$i);var $p=$J.prototype;return $p.initialize=function(){this.popupEffect=$J.manager.popupEffectHandler,this.closeEffect=$J.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},$p._dealDragArea=function(){var $i=this.getChildByName("drag");$i&&(this.dragArea=$i.x+","+$i.y+","+$i.width+","+$i.height,$i.removeSelf())},$p._onClick=function($i){var $p=$i.target;if($p)switch($p.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close($p.name)}},$p.show=function($i,$p){void 0===$i&&($i=!1),void 0===$p&&($p=!0),this._open(!1,$i,$p)},$p.popup=function($i,$p){void 0===$i&&($i=!1),void 0===$p&&($p=!0),this._open(!0,$i,$p)},$p._open=function($i,$p,$F){$J.manager.lock(!1),this.isModal=$i,$J.manager.open(this,$p,$F)},$p.onOpened=function(){},$p.close=function($i,$p){void 0===$p&&($p=!0),$J.manager.close(this,$i,$p)},$p.onClosed=function($i){},$p._onMouseDown=function($i){var $p=this.getMousePoint();this._dragArea.contains($p.x,$p.y)?this.startDrag():this.stopDrag()},$q(0,$p,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function($i){if($i){var $p=$c.fillArray([0,0,0,0],$i,Number);this._dragArea=new $r($p[0],$p[1],$p[2],$p[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),$q(0,$p,"isPopup",function(){return null!=this.parent}),$q(0,$p,"zOrder",$i.prototype._$get_zOrder,function($i){$x.superSet($V,this,"zOrder",$i),$J.manager._checkMask()}),$q(1,$J,"manager",function(){return $J._manager=$J._manager||new $I},function($i){$J._manager=$i}),$J.setLockView=function($i){$J.manager.setLockView($i)},$J.lock=function($i){$J.manager.lock($i)},$J.closeAll=function(){$J.manager.closeAll()},$J.getDialogsByGroup=function($i){return $J.manager.getDialogsByGroup($i)},$J.closeByGroup=function($i){return $J.manager.closeByGroup($i)},$J.CLOSE="close",$J.CANCEL="cancel",$J.SURE="sure",$J.NO="no",$J.OK="ok",$J.YES="yes",$J._manager=null,$J}($V),$ti=function($i){function $p(){$p.__super.call(this)}$t($p,"laya.ui.HBox",$i);var $F=$p.prototype;return $F.sortItem=function($i){$i&&$i.sort(function($i,$p){return $i.x-$p.x})},$F.changeItems=function(){this._itemChanged=!1;for(var $i=[],$p=0,$F=0,$J=this.numChildren;$F<$J;$F++){var $A=this.getChildAt($F);$A&&$A.layoutEnabled&&($i.push($A),$p=this._height?this._height:Math.max($p,$A.height*$A.scaleY))}this.sortItem($i);var $t=0;for($F=0,$J=$i.length;$F<$J;$F++)($A=$i[$F]).x=$t,$t+=$A.width*$A.scaleX+this._space,"top"==this._align?$A.y=0:"middle"==this._align?$A.y=.5*($p-$A.height*$A.scaleY):"bottom"==this._align&&($A.y=$p-$A.height*$A.scaleY);this.changeSize()},$q(0,$F,"height",$i.prototype._$get_height,function($i){this._height!=$i&&($x.superSet($k,this,"height",$i),this.callLater(this.changeItems))}),$p.NONE="none",$p.TOP="top",$p.MIDDLE="middle",$p.BOTTOM="bottom",$p}($k),$qi=function($i){function $p(){$p.__super.call(this)}$t($p,"laya.ui.VBox",$i);var $F=$p.prototype;return $F.changeItems=function(){this._itemChanged=!1;for(var $i=[],$p=0,$F=0,$J=this.numChildren;$F<$J;$F++){var $A=this.getChildAt($F);$A&&$A.layoutEnabled&&($i.push($A),$p=this._width?this._width:Math.max($p,$A.width*$A.scaleX))}this.sortItem($i);var $t=0;for($F=0,$J=$i.length;$F<$J;$F++)($A=$i[$F]).y=$t,$t+=$A.height*$A.scaleY+this._space,"left"==this._align?$A.x=0:"center"==this._align?$A.x=.5*($p-$A.width*$A.scaleX):"right"==this._align&&($A.x=$p-$A.width*$A.scaleX);this.changeSize()},$q(0,$F,"width",$i.prototype._$get_width,function($i){this._width!=$i&&($x.superSet($k,this,"width",$i),this.callLater(this.changeItems))}),$p.NONE="none",$p.LEFT="left",$p.CENTER="center",$p.RIGHT="right",$p}($k),$Bi=function($i){function $p(){$p.__super.call(this)}return $t($p,"laya.ui.RadioGroup",$z),$p.prototype.createItem=function($i,$p){return new $l($i,$p)},$p}(),$Oi=function($i){function $p(){$p.__super.call(this)}return $t($p,"laya.ui.Tab",$z),$p.prototype.createItem=function($i,$p){return new $_($i,$p)},$p}(),$Ui=function($p){function $F($i){this._vScrollBar=null,this._hScrollBar=null,void 0===$i&&($i=""),$F.__super.call(this,$i)}$t($F,"laya.ui.TextArea",$p);var $i=$F.prototype;return $i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},$i.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},$i.onVBarChanged=function($i){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},$i.onHBarChanged=function($i){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},$i.changeScroll=function(){var $i=this._vScrollBar&&0<this._tf.maxScrollY,$p=this._hScrollBar&&0<this._tf.maxScrollX,$F=$i?this._width-this._vScrollBar.width:this._width,$J=$p?this._height-this._hScrollBar.height:this._height,$A=this._tf.padding||$Y.labelPadding;this._tf.width=$F,this._tf.height=$J,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-$A[2],this._vScrollBar.y=$A[1],this._vScrollBar.height=this._height-($p?this._hScrollBar.height:0)-$A[1]-$A[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=$J/Math.max(this._tf.textHeight,$J),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=$i),this._hScrollBar&&(this._hScrollBar.x=$A[0],this._hScrollBar.y=this._height-this._hScrollBar.height-$A[3],this._hScrollBar.width=this._width-($i?this._vScrollBar.width:0)-$A[0]-$A[2],this._hScrollBar.scrollSize=Math.max(.033*$F,1),this._hScrollBar.thumbPercent=$F/Math.max(this._tf.textWidth,$F),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=$p)},$i.scrollTo=function($i){this.commitMeasure(),this._tf.scrollY=$i},$q(0,$i,"scrollY",function(){return this._tf.scrollY}),$q(0,$i,"width",$p.prototype._$get_width,function($i){$x.superSet($Fi,this,"width",$i),this.callLater(this.changeScroll)}),$q(0,$i,"hScrollBar",function(){return this._hScrollBar}),$q(0,$i,"height",$p.prototype._$get_height,function($i){$x.superSet($Fi,this,"height",$i),this.callLater(this.changeScroll)}),$q(0,$i,"maxScrollX",function(){return this._tf.maxScrollX}),$q(0,$i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function($i){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new $pi),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=$i}),$q(0,$i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function($i){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new $X),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=$i}),$q(0,$i,"vScrollBar",function(){return this._vScrollBar}),$q(0,$i,"maxScrollY",function(){return this._tf.maxScrollY}),$q(0,$i,"scrollX",function(){return this._tf.scrollX}),$F}($Fi);!function($i){function $p(){this._uiView=null,this.isCloseOther=!1,$p.__super.call(this)}$t($p,"laya.ui.AsynDialog",$Ai);var $F=$p.prototype;$F.createView=function($i){this._uiView=$i},$F._open=function($i,$p,$F){this.isModal=$i,this.isCloseOther=$p,$Ai.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},$F.onCreated=function(){this.createUI(),this.onOpen()},$F.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},$F.onOpen=function(){$Ai.manager.open(this,this.isCloseOther),$Ai.manager.lock(!1)},$F.close=function($i,$p){void 0===$p&&($p=!0),$Ai.manager.close(this),this.onClose()},$F.onClose=function(){},$F.destroy=function($i){void 0===$i&&($i=!0),laya.ui.View.prototype.destroy.call(this,$i),this._uiView=null,this.onDestroy()},$F.onDestroy=function(){}}();$x.__init([$V])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}}),function($S,$i,$v){$v.un,$v.uns;var $u=$v.static,$Z=$v.class,$s=$v.getset,$J=$v.__newvec,$E=laya.maths.Arith,$q=laya.webgl.atlas.AtlasResourceManager,$F=laya.webgl.shader.BaseShader,$n=laya.utils.Browser,$B=laya.webgl.utils.Buffer,$g=laya.utils.Byte,$A=laya.utils.ClassUtils,$O=$v.Config,$t=(laya.events.Event,laya.events.EventDispatcher),$Y=laya.utils.Handler,$r=laya.net.Loader,$p=laya.net.LoaderManager,$U=(laya.maths.MathUtil,laya.display.Node),$x=laya.renders.Render,$d=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),$j=laya.resource.Resource,$M=laya.utils.RunDriver,$D=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),$a=laya.display.Sprite,$R=laya.utils.Stat,$Q=laya.utils.StringKey,$c=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),$P=laya.utils.Utils,$h=laya.webgl.WebGL,$m=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;$v.interface("laya.d3.core.IClone"),$v.interface("laya.d3.graphics.IVertex"),$v.interface("laya.d3.core.render.IUpdate"),$v.interface("laya.d3.core.scene.ITreeNode"),$v.interface("laya.d3.core.render.IRenderable");(function(){function $_(){}$Z($_,"laya.d3.animation.AnimationClipParser01"),$_.READ_DATA=function(){$_._DATA.offset=$_._reader.getUint32(),$_._DATA.size=$_._reader.getUint32()},$_.READ_BLOCK=function(){for(var $i=$_._BLOCK.count=$_._reader.getUint16(),$p=$_._BLOCK.blockStarts=[],$F=$_._BLOCK.blockLengths=[],$J=0;$J<$i;$J++)$p.push($_._reader.getUint32()),$F.push($_._reader.getUint32())},$_.READ_STRINGS=function(){var $i=$_._reader.getUint32(),$p=$_._reader.getUint16(),$F=$_._reader.pos;$_._reader.pos=$i+$_._DATA.offset;for(var $J=0;$J<$p;$J++)$_._strings[$J]=$_._reader.readUTFString();$_._reader.pos=$F},$_.parse=function($i,$p){$_._animationClip=$i;($_._reader=$p).__getBuffer();$_.READ_DATA(),$_.READ_BLOCK(),$_.READ_STRINGS();for(var $F=0,$J=$_._BLOCK.count;$F<$J;$F++){var $A=$p.getUint16(),$t=$_._strings[$A],$q=$_["READ_"+$t];if(null==$q)throw new Error("model file err,no this function:"+$A+" "+$t);$q.call()}},$_.READ_ANIMATIONS=function(){var $i,$p=0,$F=0,$J=$_._reader,$A=$J.__getBuffer(),$t=[],$q=$J.getUint8();for($t.length=$q,$p=0;$p<$q;$p++)$t[$p]=$J.getUint16();var $B=[],$O=$J.getUint16();for($B.length=$O,$p=0;$p<$O;$p++)$B[$p]=$J.getFloat32();var $U=$_._animationClip;$U.name=$_._strings[$J.getUint16()];var $d=$U._duration=$J.getFloat32();$U.islooping=!!$J.getByte(),$U._frameRate=$J.getInt16();var $u=$J.getInt16(),$S=$U._nodes=new Array;$S.length=$u,($U._publicClipDatas=[]).length=$u;var $Z=$U._nodesMap={},$s=0,$x=0;for($p=0;$p<$u;$p++){$i=$S[$p]=new $K;var $j=$J.getUint16(),$r=$i.path=[];for($r.length=$j,$F=0;$F<$j;$F++)$r[$F]=$_._strings[$J.getUint16()];var $M=$r.join("/"),$D=$Z[$M];$D||($Z[$M]=$D=[]),$D.push($i);var $E=$J.getInt16();-1!==$E&&($i.componentType=$_._strings[$E]);var $v=$L._propertyIndexDic[$_._strings[$J.getUint16()]];if(null==$v)throw new Error("AnimationClipParser01:unknown property name.");var $g=$v<4,$a=!$g||$g&&""===$r[0];($i._cacheProperty=$a)?$s++:$x++,$i.propertyNameID=$v;var $R=$t[$J.getUint8()];$i.keyFrameWidth=$R/4;var $Q=$i.keyFrames=[],$P=$Q.length=$J.getUint16(),$Y=null,$c=NaN;for($F=0;$F<$P;$F++){var $h=$Q[$F]=new $C;$c=$h.startTime=$B[$J.getUint16()];var $m=$J.pos;$h.inTangent=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$m=$J.pos,$h.outTangent=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$m=$J.pos,$h.data=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$Y&&($Y.next=$h,$Y.duration=$c-$Y.startTime),$Y=$h}$h.next=null,$h.duration=$d-$c}var $n=$U._nodeToCachePropertyMap=new Int32Array($u),$I=$U._cachePropertyMap=new Int32Array($s),$G=$U._unCachePropertyMap=new Int32Array($x);for($s=$x=0,$p=0;$p<$u;$p++)($i=$S[$p])._cacheProperty?($n[$p]=$s,$I[$s++]=$p):$G[$x++]=$p},$_._animationClip=null,$_._reader=null,$_._strings=[],$u($_,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function $o(){}$Z($o,"laya.d3.animation.AnimationClipParser02"),$o.READ_DATA=function(){$o._DATA.offset=$o._reader.getUint32(),$o._DATA.size=$o._reader.getUint32()},$o.READ_BLOCK=function(){for(var $i=$o._BLOCK.count=$o._reader.getUint16(),$p=$o._BLOCK.blockStarts=[],$F=$o._BLOCK.blockLengths=[],$J=0;$J<$i;$J++)$p.push($o._reader.getUint32()),$F.push($o._reader.getUint32())},$o.READ_STRINGS=function(){var $i=$o._reader.getUint32(),$p=$o._reader.getUint16(),$F=$o._reader.pos;$o._reader.pos=$i+$o._DATA.offset;for(var $J=0;$J<$p;$J++)$o._strings[$J]=$o._reader.readUTFString();$o._reader.pos=$F},$o.parse=function($i,$p){$o._animationClip=$i;($o._reader=$p).__getBuffer();$o.READ_DATA(),$o.READ_BLOCK(),$o.READ_STRINGS();for(var $F=0,$J=$o._BLOCK.count;$F<$J;$F++){var $A=$p.getUint16(),$t=$o._strings[$A],$q=$o["READ_"+$t];if(null==$q)throw new Error("model file err,no this function:"+$A+" "+$t);$q.call()}},$o.READ_ANIMATIONS=function(){var $i,$p=0,$F=0,$J=$o._reader,$A=$J.__getBuffer(),$t=[],$q=$J.getUint8();for($t.length=$q,$p=0;$p<$q;$p++)$t[$p]=$J.getUint16();var $B=[],$O=$J.getUint16();for($B.length=$O,$p=0;$p<$O;$p++)$B[$p]=$J.getFloat32();var $U=$o._animationClip;$U.name=$o._strings[$J.getUint16()];var $d=$U._duration=$J.getFloat32();$U.islooping=!!$J.getByte(),$U._frameRate=$J.getInt16();var $u=$J.getInt16(),$S=$U._nodes=new Array;$S.length=$u,($U._publicClipDatas=[]).length=$u;var $Z=$U._nodesMap={},$s=0,$x=0;for($p=0;$p<$u;$p++){$i=$S[$p]=new $K;var $j=$J.getUint16(),$r=$i.path=[];for($r.length=$j,$F=0;$F<$j;$F++)$r[$F]=$o._strings[$J.getUint16()];var $M=$r.join("/"),$D=$Z[$M];$D||($Z[$M]=$D=[]),$D.push($i);var $E=$J.getInt16();-1!==$E&&($i.componentType=$o._strings[$E]);var $v=$L._propertyIndexDic[$o._strings[$J.getUint16()]];if(null==$v)throw new Error("AnimationClipParser02:unknown property name.");var $g=$v<4,$a=!$g||$g&&""===$r[0];($i._cacheProperty=$a)?$s++:$x++,$i.propertyNameID=$v;var $R=$t[$J.getUint8()];$i.keyFrameWidth=$R/4;var $Q=$i.keyFrames=[],$P=$Q.length=$J.getUint16(),$Y=null,$c=NaN;for($F=0;$F<$P;$F++){var $h=$Q[$F]=new $C;$c=$h.startTime=$B[$J.getUint16()];var $m=$J.pos;$h.inTangent=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$m=$J.pos,$h.outTangent=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$m=$J.pos,$h.data=new Float32Array($A.slice($m,$m+$R)),$J.pos+=$R,$Y&&($Y.next=$h,$Y.duration=$c-$Y.startTime),$Y=$h}$h.next=null,$h.duration=$d-$c}var $n=$J.getUint16();for($p=0;$p<$n;$p++){var $I,$G=new $W;$G.time=$J.getFloat32(),$G.eventName=$o._strings[$J.getUint16()];var $_=$J.getUint16();for(0<$_&&($G.params=$I=[]),$F=0;$F<$_;$F++){switch($J.getByte()){case 0:$I.push(!!$J.getByte());break;case 1:$I.push($J.getInt32());break;case 2:$I.push($J.getFloat32());break;case 3:$I.push($o._strings[$J.getUint16()]);break;default:throw new Error("unknown type.")}}$U.addEvent($G)}var $y=$U._nodeToCachePropertyMap=new Int32Array($u),$N=$U._cachePropertyMap=new Int32Array($s),$f=$U._unCachePropertyMap=new Int32Array($x);for($s=$x=0,$p=0;$p<$u;$p++)($i=$S[$p])._cacheProperty?($y[$p]=$s,$N[$s++]=$p):$f[$x++]=$p},$o._animationClip=null,$o._reader=null,$o._strings=[],$u($o,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var $W=function(){function $i(){this.time=NaN,this.eventName=null,this.params=null}return $Z($i,"laya.d3.animation.AnimationEvent"),$i}(),$L=function(){function $J(){this._childs=[],this.transform=new $Mp(this)}$Z($J,"laya.d3.animation.AnimationNode");var $i=$J.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.addChild=function($i){$i._parent=this,$i.transform.setParent(this.transform),this._childs.push($i)},$i.removeChild=function($i){var $p=this._childs.indexOf($i);-1!==$p&&this._childs.splice($p,1)},$i.getChildByName=function($i){for(var $p=0,$F=this._childs.length;$p<$F;$p++){var $J=this._childs[$p];if($J.name===$i)return $J}return null},$i.getChildByIndex=function($i){return this._childs[$i]},$i.getChildCount=function(){return this._childs.length},$i.cloneTo=function($i){var $p=$i;$p.name=this.name;for(var $F=0,$J=this._childs.length;$F<$J;$F++){var $A=this._childs[$F],$t=$A.clone();$p.addChild($t);var $q=$A.transform,$B=$t.transform;$B.setLocalPosition($q.getLocalPosition()),$B.setLocalRotation($q.getLocalRotation()),$B.setLocalScale($q.getLocalScale()),$B._localRotationEuler=$q._localRotationEuler,$B._setWorldMatrixIgnoreUpdate($q.getWorldMatrix())}},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$J.__init__=function(){$J.registerAnimationNodeProperty("localPosition",$J._getLocalPosition,$J._setLocalPosition),$J.registerAnimationNodeProperty("localRotation",$J._getLocalRotation,$J._setLocalRotation),$J.registerAnimationNodeProperty("localScale",$J._getLocalScale,$J._setLocalScale),$J.registerAnimationNodeProperty("localRotationEuler",$J._getLocalRotationEuler,$J._setLocalRotationEuler),$J.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",$J._getParticleRenderSharedMaterialTintColor,$J._setParticleRenderSharedMaterialTintColor),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",$J._getMeshRenderSharedMaterialTilingOffset,$J._setMeshRenderSharedMaterialTilingOffset),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",$J._getMeshRenderSharedMaterialAlbedo,$J._setMeshRenderSharedMaterialAlbedo),$J.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",$J._getSkinnedMeshRenderSharedMaterialTilingOffset,$J._setSkinnedMeshRenderSharedMaterialTilingOffset),$J.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",$J._getSkinnedMeshRenderSharedMaterialAlbedo,$J._setSkinnedMeshRenderSharedMaterialAlbedo),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",$J._getMeshRenderSharedMaterialAlbedo,$J._setMeshRenderSharedMaterialAlbedo),$J.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",$J._getSkinnedMeshRenderSharedMaterialAlbedo,$J._setSkinnedMeshRenderSharedMaterialAlbedo),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",$J._getMeshRenderSharedMaterialIntensity,$J._setMeshRenderSharedMaterialIntensity),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",$J._getMeshRenderSharedMaterialAlpha,$J._setMeshRenderSharedMaterialAlpha),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",$J._getMeshRenderSharedMaterialAlphaColor,$J._setMeshRenderSharedMaterialAlphaColor),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",$J._getMeshRenderSharedMaterialBaseColor,$J._setMeshRenderSharedMaterialBaseColor),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",$J._getMeshRenderSharedMaterialDissolve,$J._setMeshRenderSharedMaterialDissolve),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",$J._getMeshRenderSharedMaterialDissolveSpeed,$J._setMeshRenderSharedMaterialDissolveSpeed),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",$J._getMeshRenderSharedMaterialMMultiplier,$J._setMeshRenderSharedMaterialMMultiplier),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",$J._getMeshRenderSharedMaterialBaseScrollSpeedX,$J._setMeshRenderSharedMaterialBaseScrollSpeedX),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",$J._getMeshRenderSharedMaterialBaseScrollSpeedY,$J._setMeshRenderSharedMaterialBaseScrollSpeedY),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",$J._getMeshRenderSharedMaterialSecondScrollSpeedX,$J._setMeshRenderSharedMaterialSecondScrollSpeedX),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",$J._getMeshRenderSharedMaterialSecondScrollSpeedY,$J._setMeshRenderSharedMaterialSecondScrollSpeedY),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",$J._getMeshRenderSharedMaterialDetailTilingOffset,$J._setMeshRenderSharedMaterialDetailTilingOffset),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",$J._getMeshRenderSharedMaterialDissolveTilingOffset,$J._setMeshRenderSharedMaterialDissolveTilingOffset),$J.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",$J._getMeshRenderSharedMaterialMaskTilingOffset,$J._setMeshRenderSharedMaterialMaskTilingOffset)},$J.registerAnimationNodeProperty=function($i,$p,$F){if($J._propertyIndexDic[$i])throw new Error("AnimationNode: this propertyName has registered.");$J._propertyIndexDic[$i]=$J._propertyIDCounter,$J._propertyGetFuncs[$J._propertyIDCounter]=$p,$J._propertySetFuncs[$J._propertyIDCounter]=$F,$J._propertyIDCounter++},$J._getLocalPosition=function($i,$p){return $i?$i.transform.getLocalPosition():$p._transform.localPosition.elements},$J._setLocalPosition=function($i,$p,$F){if($i)$i.transform.setLocalPosition($F);else{var $J=$p._transform,$A=$J.localPosition;$A.elements=$F,$J.localPosition=$A}},$J._getLocalRotation=function($i,$p){return $i?$i.transform.getLocalRotation():$p._transform.localRotation.elements},$J._setLocalRotation=function($i,$p,$F){if($i)$i.transform.setLocalRotation($F);else{var $J=$p._transform,$A=$J.localRotation;$A.elements=$F,$J.localRotation=$A}},$J._getLocalScale=function($i,$p){return $i?$i.transform.getLocalScale():$p._transform.localScale.elements},$J._setLocalScale=function($i,$p,$F){if($i)$i.transform.setLocalScale($F);else{var $J=$p._transform,$A=$J.localScale;$A.elements=$F,$J.localScale=$A}},$J._getLocalRotationEuler=function($i,$p){return $i?$i.transform.getLocalRotationEuler():$p._transform.localRotationEuler.elements},$J._setLocalRotationEuler=function($i,$p,$F){if($i)$i.transform.setLocalRotationEuler($F);else{var $J=$p._transform,$A=$J.localRotationEuler;$A.elements=$F,$J.localRotationEuler=$A}},$J._getMeshRenderSharedMaterialTilingOffset=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return $p.meshRender.sharedMaterial.tilingOffset.elements},$J._setMeshRenderSharedMaterialTilingOffset=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).tilingOffset).elements=$F,$J.tilingOffset=$A)}else($A=($J=$p.meshRender.material).tilingOffset).elements=$F,$J.tilingOffset=$A},$J._getMeshRenderSharedMaterialAlbedo=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.albedoColor.elements:null}return $p.meshRender.sharedMaterial.albedoColor.elements},$J._setMeshRenderSharedMaterialAlbedo=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).albedoColor).elements=$F,$J.albedoColor=$A)}else($A=($J=$p.meshRender.material).albedoColor).elements=$F,$J.albedoColor=$A},$J._getSkinnedMeshRenderSharedMaterialTilingOffset=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return $p.skinnedMeshRender.sharedMaterial.tilingOffset.elements},$J._setSkinnedMeshRenderSharedMaterialTilingOffset=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.skinnedMeshRender.material).tilingOffset).elements=$F,$J.tilingOffset=$A)}else($A=($J=$p.skinnedMeshRender.material).tilingOffset).elements=$F,$J.tilingOffset=$A},$J._getSkinnedMeshRenderSharedMaterialAlbedo=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return $p.skinnedMeshRender.sharedMaterial.albedoColor.elements},$J._setSkinnedMeshRenderSharedMaterialAlbedo=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.skinnedMeshRender.material).albedoColor).elements=$F,$J.albedoColor=$A)}else($A=($J=$p.skinnedMeshRender.material).albedoColor).elements=$F,$J.albedoColor=$A},$J._getParticleRenderSharedMaterialTintColor=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.particleRender.sharedMaterial.tintColor.elements:null}return $p.particleRender.sharedMaterial.tintColor.elements},$J._setParticleRenderSharedMaterialTintColor=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.particleRender.material).tintColor).elements=$F,$J.tintColor=$A)}else($A=($J=$p.particleRender.material).tintColor).elements=$F,$J.tintColor=$A},$J._getMeshRenderSharedMaterialAlphaColor=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.alphaColor.elements:null}return $p.meshRender.sharedMaterial.alphaColor.elements},$J._setMeshRenderSharedMaterialAlphaColor=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).alphaColor).elements=$F,$J.alphaColor=$A)}else($A=($J=$p.meshRender.material).alphaColor).elements=$F,$J.alphaColor=$A},$J._getMeshRenderSharedMaterialBaseColor=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.baseColor.elements:null}return $p.meshRender.sharedMaterial.baseColor.elements},$J._setMeshRenderSharedMaterialBaseColor=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).baseColor).elements=$F,$J.baseColor=$A)}else($A=($J=$p.meshRender.material).baseColor).elements=$F,$J.baseColor=$A},$J._getMeshRenderSharedMaterialDissolve=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.dissolve:0}return $p.meshRender.sharedMaterial.dissolve},$J._setMeshRenderSharedMaterialDissolve=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.dissolve=$F[0])}else $p.meshRender.material.dissolve=$F[0]},$J._getMeshRenderSharedMaterialDissolveSpeed=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.dissolveSpeed:0}return $p.meshRender.sharedMaterial.dissolveSpeed},$J._setMeshRenderSharedMaterialDissolveSpeed=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.dissolveSpeed=$F[0])}else $p.meshRender.material.dissolveSpeed=$F[0]},$J._getMeshRenderSharedMaterialMMultiplier=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.mMultiplier:0}return $p.meshRender.sharedMaterial.mMultiplier},$J._setMeshRenderSharedMaterialMMultiplier=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.mMultiplier=$F[0])}else $p.meshRender.material.mMultiplier=$F[0]},$J._getMeshRenderSharedMaterialBaseScrollSpeedX=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return $p.meshRender.sharedMaterial.baseScrollSpeedX},$J._setMeshRenderSharedMaterialBaseScrollSpeedX=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.baseScrollSpeedX=$F[0])}else $p.meshRender.material.baseScrollSpeedX=$F[0]},$J._getMeshRenderSharedMaterialBaseScrollSpeedY=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return $p.meshRender.sharedMaterial.baseScrollSpeedY},$J._setMeshRenderSharedMaterialBaseScrollSpeedY=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.baseScrollSpeedY=$F[0])}else $p.meshRender.material.baseScrollSpeedY=$F[0]},$J._getMeshRenderSharedMaterialSecondScrollSpeedX=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return $p.meshRender.sharedMaterial.secondScrollSpeedX},$J._setMeshRenderSharedMaterialSecondScrollSpeedX=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.secondScrollSpeedX=$F[0])}else $p.meshRender.material.secondScrollSpeedX=$F[0]},$J._getMeshRenderSharedMaterialSecondScrollSpeedY=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return $p.meshRender.sharedMaterial.secondScrollSpeedY},$J._setMeshRenderSharedMaterialSecondScrollSpeedY=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.secondScrollSpeedY=$F[0])}else $p.meshRender.material.secondScrollSpeedY=$F[0]},$J._getMeshRenderSharedMaterialAlpha=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.alpha:0}return $p.meshRender.sharedMaterial.alpha},$J._setMeshRenderSharedMaterialAlpha=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.alpha=$F[0])}else $p.meshRender.material.alpha=$F[0]},$J._getMeshRenderSharedMaterialIntensity=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.intensity:0}return $p.meshRender.sharedMaterial.intensity},$J._setMeshRenderSharedMaterialIntensity=function($i,$p,$F){if($i){var $J=$i.transform._entity;$J&&($J.owner.meshRender.material.intensity=$F[0])}else $p.meshRender.material.intensity=$F[0]},$J._getMeshRenderSharedMaterialDetailTilingOffset=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return $p.meshRender.sharedMaterial.detailTilingOffset.elements},$J._setMeshRenderSharedMaterialDetailTilingOffset=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).detailTilingOffset).elements=$F,$J.detailTilingOffset=$A)}else($A=($J=$p.meshRender.material).detailTilingOffset).elements=$F,$J.detailTilingOffset=$A},$J._getMeshRenderSharedMaterialDissolveTilingOffset=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return $p.meshRender.sharedMaterial.dissolveTilingOffset.elements},$J._setMeshRenderSharedMaterialDissolveTilingOffset=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).dissolveTilingOffset).elements=$F,$J.dissolveTilingOffset=$A)}else($A=($J=$p.meshRender.material).dissolveTilingOffset).elements=$F,$J.dissolveTilingOffset=$A},$J._getMeshRenderSharedMaterialMaskTilingOffset=function($i,$p){if($i){var $F=$i.transform._entity;return $F?$F.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return $p.meshRender.sharedMaterial.maskTilingOffset.elements},$J._setMeshRenderSharedMaterialMaskTilingOffset=function($i,$p,$F){var $J,$A;if($i){var $t=$i.transform._entity;$t&&(($A=($J=$t.owner.meshRender.material).maskTilingOffset).elements=$F,$J.maskTilingOffset=$A)}else($A=($J=$p.meshRender.material).maskTilingOffset).elements=$F,$J.maskTilingOffset=$A},$J._propertyIDCounter=0,$J._propertyIndexDic={},$J._propertySetFuncs=[],$J._propertyGetFuncs=[],$J}(),$C=function(){function $i(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return $Z($i,"laya.d3.animation.Keyframe"),$i}(),$K=function(){function $i(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return $Z($i,"laya.d3.animation.KeyframeNode"),$i}(),$I=(function(){function $i(){this._tempVector30=new $qp,this._tempVector31=new $qp,this._tempVector32=new $qp,this._a=new $qp,this._b=new $qp,this._c=new $qp,this._d=new $qp}$Z($i,"laya.d3.core.glitter.SplineCurvePositionVelocity");var $p=$i.prototype;$p.Init=function($i,$p,$F,$J){$i.cloneTo(this._d),$p.cloneTo(this._c),$qp.scale($i,2,this._a),$qp.scale($F,2,this._tempVector30),$qp.subtract(this._a,this._tempVector30,this._a),$qp.add(this._a,$p,this._a),$qp.add(this._a,$J,this._a),$qp.scale($F,3,this._b),$qp.scale($i,3,this._tempVector30),$qp.subtract(this._b,this._tempVector30,this._b),$qp.subtract(this._b,$J,this._b),$qp.scale($p,2,this._tempVector30),$qp.subtract(this._b,this._tempVector30,this._b)},$p.Slerp=function($i,$p){$qp.scale(this._a,$i*$i*$i,this._tempVector30),$qp.scale(this._b,$i*$i,this._tempVector31),$qp.scale(this._c,$i,this._tempVector32),$qp.add(this._tempVector30,this._tempVector31,$p),$qp.add($p,this._tempVector32,$p),$qp.add($p,this._d,$p)}}(),function(){function $N($i,$p,$F,$J){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=$i,this._h=$p,this._minHeight=$F,this._maxHeight=$J}$Z($N,"laya.d3.core.HeightMap");var $i=$N.prototype;$i._inBounds=function($i,$p){return 0<=$i&&$i<this._h&&0<=$p&&$p<this._w},$i.getHeight=function($i,$p){return this._inBounds($i,$p)?this._datas[$i][$p]:NaN},$s(0,$i,"width",function(){return this._w}),$s(0,$i,"height",function(){return this._h}),$s(0,$i,"maxHeight",function(){return this._maxHeight}),$s(0,$i,"minHeight",function(){return this._minHeight}),$N.creatFromMesh=function($i,$p,$F,$J){for(var $A=[],$t=[],$q=$i.getSubMeshCount(),$B=0;$B<$q;$B++){for(var $O=$i.getSubMesh($B),$U=$O._getVertexBuffer(),$d=$U.getData(),$u=[],$S=0;$S<$d.length;$S+=$U.vertexDeclaration.vertexStride/4){var $Z=new $qp($d[$S+0],$d[$S+1],$d[$S+2]);$u.push($Z)}$A.push($u);var $s=$O._getIndexBuffer();$t.push($s.getData())}var $x=$i.boundingBox,$j=$x.min.x,$r=$x.min.z,$M=$x.max.x,$D=$x.max.z,$E=$x.min.y,$v=$x.max.y,$g=$M-$j,$a=$D-$r,$R=$J.elements[0]=$g/($p-1),$Q=$J.elements[1]=$a/($F-1),$P=new $N($p,$F,$E,$v),$Y=$N._tempRay,$c=$Y.direction.elements;$c[0]=0,$c[1]=-1,$c[2]=0;var $h=$v+.1;$Y.origin.elements[1]=$h;for(var $m=0;$m<$F;$m++){var $n=$r+$m*$Q;$P._datas[$m]=[];for(var $I=0;$I<$p;$I++){var $G=$j+$I*$R,$_=$Y.origin.elements;$_[0]=$G,$_[2]=$n;var $y=$N._getPosition($Y,$A,$t);$P._datas[$m][$I]=$y===Number.MAX_VALUE?NaN:$h-$y}}return $P},$N.createFromImage=function($i,$p,$F){for(var $J=$i.width,$A=$i.height,$t=new $N($J,$A,$p,$F),$q=($F-$p)/254,$B=$i.getPixels(),$O=0,$U=0;$U<$A;$U++)for(var $d=$t._datas[$U]=[],$u=0;$u<$J;$u++){var $S=$B[$O++],$Z=$B[$O++],$s=$B[$O++],$x=$B[$O++];$d[$u]=255==$S&&255==$Z&&255==$s&&255==$x?NaN:($S+$Z+$s)/3*$q+$p}return $t},$N._getPosition=function($i,$p,$F){for(var $J=Number.MAX_VALUE,$A=0;$A<$p.length;$A++)for(var $t=$p[$A],$q=$F[$A],$B=0;$B<$q.length;$B+=3){var $O=$t[$q[$B+0]],$U=$t[$q[$B+1]],$d=$t[$q[$B+2]],$u=$sp.rayIntersectsTriangle($i,$O,$U,$d);!isNaN($u)&&$u<$J&&($J=$u)}return $J},$u($N,["_tempRay",function(){return this._tempRay=new $Ap(new $qp,new $qp)}])}(),function(){function $A(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}$Z($A,"laya.d3.core.Layer");var $i=$A.prototype;return $i._binarySearchIndex=function(){for(var $i=0,$p=$A._collsionTestList.length-1,$F=0;$i<=$p;){$F=Math.floor(($i+$p)/2);var $J=$A._collsionTestList[$F];if($J==this._number)return $F;$J>this._number?$p=$F-1:$i=$F+1}return $i},$i._addCollider=function($i){0===this._colliders.length&&$A._collsionTestList.splice(this._binarySearchIndex(),0,this._number),$i._isRigidbody?(this._colliders.unshift($i),this._nonRigidbodyOffset++):this._colliders.push($i)},$i._removeCollider=function($i){var $p=this._colliders.indexOf($i);$p<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice($p,1),0===this._colliders.length&&$A._collsionTestList.splice($A._collsionTestList.indexOf(this._number),1)},$s(0,$i,"number",function(){return this._number}),$s(0,$i,"visible",function(){return this._visible},function($i){this._visible=$i,$A._visibleLayers=$i?$A._visibleLayers|this.mask:$A._visibleLayers&~this.mask}),$s(0,$i,"mask",function(){return this._mask}),$s(1,$A,"visibleLayers",function(){return $A._visibleLayers},function($i){$A._visibleLayers=$i;for(var $p=0,$F=$A._layerList.length;$p<$F;$p++){var $J=$A._layerList[$p];$J._visible=0!=($J._mask&$A._visibleLayers)}}),$A.__init__=function(){$A._layerList.length=31;for(var $i=0;$i<31;$i++){var $p=new $A;$A._layerList[$i]=$p,0===$i?($p.name="Default Layer",$p.visible=!0):($p.name="Layer-"+$i,$p.visible=!1),$p._number=$i,$p._mask=Math.pow(2,$i)}$A.currentCreationLayer=$A._layerList[0]},$A.getLayerByNumber=function($i){if($i<0||30<$i)throw new Error("无法返回指定Layer，该number超出范围！");return $A._layerList[$i]},$A.getLayerByName=function($i){for(var $p=0;$p<31;$p++)if($A._layerList[$p].name===$i)return $A._layerList[$p];throw new Error("无法返回指定Layer,该name不存在")},$A.isVisible=function($i){return 0!=($i&$A._currentCameraCullingMask&$A._visibleLayers)},$A._layerList=[],$A._visibleLayers=2147483647,$A._collsionTestList=[],$A._currentCameraCullingMask=2147483647,$A.maxCount=31,$A.currentCreationLayer=null,$A}()),$G=(function(){function $i($i,$p,$F){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=$i,this._minCount=$p,this._maxCount=$F}$Z($i,"laya.d3.core.particleShuriKen.module.Burst");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($i){var $p=$i;$p._time=this._time,$p._minCount=this._minCount,$p._maxCount=this._maxCount},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"time",function(){return this._time}),$s(0,$p,"minCount",function(){return this._minCount}),$s(0,$p,"maxCount",function(){return this._maxCount})}(),function(){function $i($i){this._color=null,this.enbale=!1,this._color=$i}$Z($i,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var $p=$i.prototype;$p.cloneTo=function($i){var $p=$i;this._color.cloneTo($p._color),$p.enbale=this.enbale},$p.clone=function(){var $i;switch(this._color.type){case 0:$i=$y.createByConstant(this._color.constant.clone());break;case 1:$i=$y.createByGradient(this._color.gradient.clone());break;case 2:$i=$y.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:$i=$y.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var $p=new this.constructor($i);return $p.enbale=this.enbale,$p},$s(0,$p,"color",function(){return this._color})}(),function(){function $i(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}$Z($i,"laya.d3.core.particleShuriKen.module.Emission");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),$p._destroy=function(){this._bursts=null,this._destroyed=!0},$p.getBurstsCount=function(){return this._bursts.length},$p.getBurstByIndex=function($i){return this._bursts[$i]},$p.addBurst=function($i){var $p=this._bursts.length;if(0<$p)for(var $F=0;$F<$p;$F++)this._bursts[$F].time>$i.time&&this._bursts.splice($F,0,$i);this._bursts.push($i)},$p.removeBurst=function($i){var $p=this._bursts.indexOf($i);-1!==$p&&this._bursts.splice($p,1)},$p.removeBurstByIndex=function($i){this._bursts.splice($i,1)},$p.clearBurst=function(){this._bursts.length=0},$p.cloneTo=function($i){var $p=$i,$F=$p._bursts;$F.length=this._bursts.length;for(var $J=0,$A=this._bursts.length;$J<$A;$J++){var $t=$F[$J];$t?this._bursts[$J].cloneTo($t):$F[$J]=this._bursts[$J].clone()}$p._emissionRate=this._emissionRate,$p.enbale=this.enbale},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"destroyed",function(){return this._destroyed}),$s(0,$p,"emissionRate",function(){return this._emissionRate},function($i){if($i<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=$i})}(),function(){function $J(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}$Z($J,"laya.d3.core.particleShuriKen.module.FrameOverTime");var $i=$J.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.cloneTo=function($i){var $p=$i;$p._type=this._type,$p._constant=this._constant,this._overTime.cloneTo($p._overTime),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._overTimeMin.cloneTo($p._overTimeMin),this._overTimeMax.cloneTo($p._overTimeMax)},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"frameOverTimeData",function(){return this._overTime}),$s(0,$i,"constant",function(){return this._constant}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"frameOverTimeDataMin",function(){return this._overTimeMin}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"frameOverTimeDataMax",function(){return this._overTimeMax}),$s(0,$i,"constantMax",function(){return this._constantMax}),$J.createByConstant=function($i){var $p=new $J;return $p._type=0,$p._constant=$i,$p},$J.createByOverTime=function($i){var $p=new $J;return $p._type=1,$p._overTime=$i,$p},$J.createByRandomTwoConstant=function($i,$p){var $F=new $J;return $F._type=2,$F._constantMin=$i,$F._constantMax=$p,$F},$J.createByRandomTwoOverTime=function($i,$p){var $F=new $J;return $F._type=3,$F._overTimeMin=$i,$F._overTimeMax=$p,$F},$J}()),$_=function(){function $U(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}$Z($U,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var $i=$U.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.cloneTo=function($i){var $p=$i;$p._type=this._type,$p._separateAxes=this._separateAxes,$p._constant=this._constant,this._constantSeparate.cloneTo($p._constantSeparate),this._gradient.cloneTo($p._gradient),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($p._constantMinSeparate),this._constantMaxSeparate.cloneTo($p._constantMaxSeparate),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax)},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"gradientZ",function(){return this._gradientZ}),$s(0,$i,"constant",function(){return this._constant}),$s(0,$i,"gradient",function(){return this._gradient}),$s(0,$i,"separateAxes",function(){return this._separateAxes}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"constantSeparate",function(){return this._constantSeparate}),$s(0,$i,"gradientX",function(){return this._gradientX}),$s(0,$i,"gradientY",function(){return this._gradientY}),$s(0,$i,"gradientW",function(){return this._gradientW}),$s(0,$i,"gradientMin",function(){return this._gradientMin}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"gradientMax",function(){return this._gradientMax}),$s(0,$i,"constantMax",function(){return this._constantMax}),$s(0,$i,"gradientWMin",function(){return this._gradientWMin}),$s(0,$i,"constantMinSeparate",function(){return this._constantMinSeparate}),$s(0,$i,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$s(0,$i,"gradientXMin",function(){return this._gradientXMin}),$s(0,$i,"gradientXMax",function(){return this._gradientXMax}),$s(0,$i,"gradientWMax",function(){return this._gradientWMax}),$s(0,$i,"gradientYMin",function(){return this._gradientYMin}),$s(0,$i,"gradientYMax",function(){return this._gradientYMax}),$s(0,$i,"gradientZMin",function(){return this._gradientZMin}),$s(0,$i,"gradientZMax",function(){return this._gradientZMax}),$U.createByConstant=function($i){var $p=new $U;return $p._type=0,$p._separateAxes=!1,$p._constant=$i,$p},$U.createByConstantSeparate=function($i){var $p=new $U;return $p._type=0,$p._separateAxes=!0,$p._constantSeparate=$i,$p},$U.createByGradient=function($i){var $p=new $U;return $p._type=1,$p._separateAxes=!1,$p._gradient=$i,$p},$U.createByGradientSeparate=function($i,$p,$F,$J){var $A=new $U;return $A._type=1,$A._separateAxes=!0,$A._gradientX=$i,$A._gradientY=$p,$A._gradientZ=$F,$A._gradientW=$J,$A},$U.createByRandomTwoConstant=function($i,$p){var $F=new $U;return $F._type=2,$F._separateAxes=!1,$F._constantMin=$i,$F._constantMax=$p,$F},$U.createByRandomTwoConstantSeparate=function($i,$p){var $F=new $U;return $F._type=2,$F._separateAxes=!0,$F._constantMinSeparate=$i,$F._constantMaxSeparate=$p,$F},$U.createByRandomTwoGradient=function($i,$p){var $F=new $U;return $F._type=3,$F._separateAxes=!1,$F._gradientMin=$i,$F._gradientMax=$p,$F},$U.createByRandomTwoGradientSeparate=function($i,$p,$F,$J,$A,$t,$q,$B){var $O=new $U;return $O._type=3,$O._separateAxes=!0,$O._gradientXMin=$i,$O._gradientXMax=$p,$O._gradientYMin=$F,$O._gradientYMax=$J,$O._gradientZMin=$A,$O._gradientZMax=$t,$O._gradientWMin=$q,$O._gradientWMax=$B,$O},$U}(),$y=function(){function $J(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}$Z($J,"laya.d3.core.particleShuriKen.module.GradientColor");var $i=$J.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.cloneTo=function($i){var $p=$i;$p._type=this._type,this._constant.cloneTo($p._constant),this._constantMin.cloneTo($p._constantMin),this._constantMax.cloneTo($p._constantMax),this._gradient.cloneTo($p._gradient),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax)},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"gradient",function(){return this._gradient}),$s(0,$i,"constant",function(){return this._constant}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"gradientMin",function(){return this._gradientMin}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"gradientMax",function(){return this._gradientMax}),$s(0,$i,"constantMax",function(){return this._constantMax}),$J.createByConstant=function($i){var $p=new $J;return $p._type=0,$p._constant=$i,$p},$J.createByGradient=function($i){var $p=new $J;return $p._type=1,$p._gradient=$i,$p},$J.createByRandomTwoConstant=function($i,$p){var $F=new $J;return $F._type=2,$F._constantMin=$i,$F._constantMax=$p,$F},$J.createByRandomTwoGradient=function($i,$p){var $F=new $J;return $F._type=3,$F._gradientMin=$i,$F._gradientMax=$p,$F},$J}(),$N=(function(){function $i(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}$Z($i,"laya.d3.core.particleShuriKen.module.GradientDataColor");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.addAlpha=function($i,$p){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==$i&&($i=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=$i,this._alphaElements[this._alphaCurrentLength++]=$p):DEBUG},$p.addRGB=function($i,$p){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==$i&&($i=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=$i,this._rgbElements[this._rgbCurrentLength++]=$p.x,this._rgbElements[this._rgbCurrentLength++]=$p.y,this._rgbElements[this._rgbCurrentLength++]=$p.z):DEBUG},$p.cloneTo=function($i){var $p=$i,$F=0,$J=0;$p._alphaCurrentLength=this._alphaCurrentLength;var $A=$p._alphaElements;for($A.length=this._alphaElements.length,$F=0,$J=this._alphaElements.length;$F<$J;$F++)$A[$F]=this._alphaElements[$F];$p._rgbCurrentLength=this._rgbCurrentLength;var $t=$p._rgbElements;for($t.length=this._rgbElements.length,$F=0,$J=this._rgbElements.length;$F<$J;$F++)$t[$F]=this._rgbElements[$F]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),$s(0,$p,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function $i(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$Z($i,"laya.d3.core.particleShuriKen.module.GradientDataInt");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($i,$p){this._currentLength<8?(6===this._currentLength&&1!==$i&&($i=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$i,this._elements[this._currentLength++]=$p):console.log("Warning:data count must lessEqual than 4")},$p.cloneTo=function($i){var $p=$i;$p._currentLength=this._currentLength;var $F=$p._elements;$F.length=this._elements.length;for(var $J=0,$A=this._elements.length;$J<$A;$J++)$F[$J]=this._elements[$J]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"gradientCount",function(){return this._currentLength/2})}(),function(){function $i(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}$Z($i,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($i,$p){this._currentLength<8?(6===this._currentLength&&1!==$i&&($i=1,DEBUG),this._elements[this._currentLength++]=$i,this._elements[this._currentLength++]=$p):DEBUG},$p.getKeyByIndex=function($i){return this._elements[2*$i]},$p.getValueByIndex=function($i){return this._elements[2*$i+1]},$p.getAverageValue=function(){for(var $i=0,$p=this._currentLength-2;$i<$p;$i+=2){this._elements[$i+1];this._elements[$i+3],this._elements[$i+2]-this._elements[$i]}return 0},$p.cloneTo=function($i){var $p=$i;$p._currentLength=this._currentLength;var $F=$p._elements;$F.length=this._elements.length;for(var $J=0,$A=this._elements.length;$J<$A;$J++)$F[$J]=this._elements[$J]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"gradientCount",function(){return this._currentLength/2})}(),function(){function $i(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}$Z($i,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.add=function($i,$p){this._currentLength<8?(6===this._currentLength&&1!==$i&&($i=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=$i,this._elements[this._currentLength++]=$p.x,this._elements[this._currentLength++]=$p.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},$p.cloneTo=function($i){var $p=$i;$p._currentLength=this._currentLength;var $F=$p._elements;$F.length=this._elements.length;for(var $J=0,$A=this._elements.length;$J<$A;$J++)$F[$J]=this._elements[$J]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"gradientCount",function(){return this._currentLength/3})}(),function(){function $B(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$Z($B,"laya.d3.core.particleShuriKen.module.GradientSize");var $i=$B.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.getMaxSizeInGradient=function(){var $i=0,$p=0,$F=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for($i=0,$p=this._gradientX.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientX.getValueByIndex($i));for($i=0,$p=this._gradientY.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientY.getValueByIndex($i))}else for($i=0,$p=this._gradient.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradient.getValueByIndex($i));break;case 1:$F=this._separateAxes?($F=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),$F=Math.max($F,this._constantMinSeparate.y),Math.max($F,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for($i=0,$p=this._gradientXMin.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientXMin.getValueByIndex($i));for($i=0,$p=this._gradientXMax.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientXMax.getValueByIndex($i));for($i=0,$p=this._gradientYMin.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientYMin.getValueByIndex($i));for($i=0,$p=this._gradientZMax.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientZMax.getValueByIndex($i))}else{for($i=0,$p=this._gradientMin.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientMin.getValueByIndex($i));for($i=0,$p=this._gradientMax.gradientCount;$i<$p;$i++)$F=Math.max($F,this._gradientMax.getValueByIndex($i))}}return $F},$i.cloneTo=function($i){var $p=$i;$p._type=this._type,$p._separateAxes=this._separateAxes,this._gradient.cloneTo($p._gradient),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),$p._constantMin=this._constantMin,$p._constantMax=this._constantMax,this._constantMinSeparate.cloneTo($p._constantMinSeparate),this._constantMaxSeparate.cloneTo($p._constantMaxSeparate),this._gradientMin.cloneTo($p._gradientMin),this._gradientMax.cloneTo($p._gradientMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax)},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"gradientZ",function(){return this._gradientZ}),$s(0,$i,"gradient",function(){return this._gradient}),$s(0,$i,"separateAxes",function(){return this._separateAxes}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"gradientMin",function(){return this._gradientMin}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"gradientX",function(){return this._gradientX}),$s(0,$i,"gradientY",function(){return this._gradientY}),$s(0,$i,"gradientMax",function(){return this._gradientMax}),$s(0,$i,"constantMax",function(){return this._constantMax}),$s(0,$i,"constantMinSeparate",function(){return this._constantMinSeparate}),$s(0,$i,"constantMaxSeparate",function(){return this._constantMaxSeparate}),$s(0,$i,"gradientXMin",function(){return this._gradientXMin}),$s(0,$i,"gradientXMax",function(){return this._gradientXMax}),$s(0,$i,"gradientYMin",function(){return this._gradientYMin}),$s(0,$i,"gradientYMax",function(){return this._gradientYMax}),$s(0,$i,"gradientZMin",function(){return this._gradientZMin}),$s(0,$i,"gradientZMax",function(){return this._gradientZMax}),$B.createByGradient=function($i){var $p=new $B;return $p._type=0,$p._separateAxes=!1,$p._gradient=$i,$p},$B.createByGradientSeparate=function($i,$p,$F){var $J=new $B;return $J._type=0,$J._separateAxes=!0,$J._gradientX=$i,$J._gradientY=$p,$J._gradientZ=$F,$J},$B.createByRandomTwoConstant=function($i,$p){var $F=new $B;return $F._type=1,$F._separateAxes=!1,$F._constantMin=$i,$F._constantMax=$p,$F},$B.createByRandomTwoConstantSeparate=function($i,$p){var $F=new $B;return $F._type=1,$F._separateAxes=!0,$F._constantMinSeparate=$i,$F._constantMaxSeparate=$p,$F},$B.createByRandomTwoGradient=function($i,$p){var $F=new $B;return $F._type=2,$F._separateAxes=!1,$F._gradientMin=$i,$F._gradientMax=$p,$F},$B.createByRandomTwoGradientSeparate=function($i,$p,$F,$J,$A,$t){var $q=new $B;return $q._type=2,$q._separateAxes=!0,$q._gradientXMin=$i,$q._gradientXMax=$p,$q._gradientYMin=$F,$q._gradientYMax=$J,$q._gradientZMin=$A,$q._gradientZMax=$t,$q},$B}()),$f=function(){function $B(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}$Z($B,"laya.d3.core.particleShuriKen.module.GradientVelocity");var $i=$B.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.cloneTo=function($i){var $p=$i;$p._type=this._type,this._constant.cloneTo($p._constant),this._gradientX.cloneTo($p._gradientX),this._gradientY.cloneTo($p._gradientY),this._gradientZ.cloneTo($p._gradientZ),this._constantMin.cloneTo($p._constantMin),this._constantMax.cloneTo($p._constantMax),this._gradientXMin.cloneTo($p._gradientXMin),this._gradientXMax.cloneTo($p._gradientXMax),this._gradientYMin.cloneTo($p._gradientYMin),this._gradientYMax.cloneTo($p._gradientYMax),this._gradientZMin.cloneTo($p._gradientZMin),this._gradientZMax.cloneTo($p._gradientZMax)},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"gradientZ",function(){return this._gradientZ}),$s(0,$i,"constant",function(){return this._constant}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"gradientXMax",function(){return this._gradientXMax}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"gradientX",function(){return this._gradientX}),$s(0,$i,"gradientY",function(){return this._gradientY}),$s(0,$i,"gradientXMin",function(){return this._gradientXMin}),$s(0,$i,"constantMax",function(){return this._constantMax}),$s(0,$i,"gradientYMin",function(){return this._gradientYMin}),$s(0,$i,"gradientYMax",function(){return this._gradientYMax}),$s(0,$i,"gradientZMin",function(){return this._gradientZMin}),$s(0,$i,"gradientZMax",function(){return this._gradientZMax}),$B.createByConstant=function($i){var $p=new $B;return $p._type=0,$p._constant=$i,$p},$B.createByGradient=function($i,$p,$F){var $J=new $B;return $J._type=1,$J._gradientX=$i,$J._gradientY=$p,$J._gradientZ=$F,$J},$B.createByRandomTwoConstant=function($i,$p){var $F=new $B;return $F._type=2,$F._constantMin=$i,$F._constantMax=$p,$F},$B.createByRandomTwoGradient=function($i,$p,$F,$J,$A,$t){var $q=new $B;return $q._type=3,$q._gradientXMin=$i,$q._gradientXMax=$p,$q._gradientYMin=$F,$q._gradientYMax=$J,$q._gradientZMin=$A,$q._gradientZMax=$t,$q},$B}(),$o=(function(){function $i($i){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=$i}$Z($i,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($i){var $p=$i;this._angularVelocity.cloneTo($p._angularVelocity),$p.enbale=this.enbale},$p.clone=function(){var $i;switch(this._angularVelocity.type){case 0:$i=this._angularVelocity.separateAxes?$_.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):$_.createByConstant(this._angularVelocity.constant);break;case 1:$i=this._angularVelocity.separateAxes?$_.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):$_.createByGradient(this._angularVelocity.gradient.clone());break;case 2:$i=this._angularVelocity.separateAxes?$_.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):$_.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:$i=this._angularVelocity.separateAxes?$_.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):$_.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var $p=new this.constructor($i);return $p.enbale=this.enbale,$p},$s(0,$p,"angularVelocity",function(){return this._angularVelocity})}(),function(){function $i(){this.enable=!1,this.randomDirection=!1}$Z($i,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.IClone":!0}),$p._getShapeBoundBox=function($i){throw new Error("BaseShape: must override it.")},$p._getSpeedBoundBox=function($i){throw new Error("BaseShape: must override it.")},$p.generatePositionAndDirection=function($i,$p,$F,$J){throw new Error("BaseShape: must override it.")},$p._calculateProceduralBounds=function($i,$p,$F){this._getShapeBoundBox($i);var $J=$i.min,$A=$i.max;$qp.multiply($J,$p,$J),$qp.multiply($A,$p,$A);var $t=new $ei(new $qp,new $qp);this.randomDirection?($t.min=new $qp(-1,-1,-1),$t.max=new $qp(1,1,1)):this._getSpeedBoundBox($t);var $q=new $ei(new $qp,new $qp),$B=$q.min,$O=$q.max;$qp.scale($t.min,$F.y,$B),$qp.scale($t.max,$F.y,$O),$qp.add($i.min,$B,$B),$qp.add($i.max,$O,$O),$qp.min($i.min,$B,$i.min),$qp.max($i.max,$B,$i.max);var $U=new $ei(new $qp,new $qp),$d=$U.min,$u=$U.max;$qp.scale($t.min,$F.x,$d),$qp.scale($t.max,$F.x,$u),$qp.min($U.min,$u,$B),$qp.max($U.min,$u,$O),$qp.min($i.min,$B,$i.min),$qp.max($i.max,$B,$i.max)},$p.cloneTo=function($i){$i.enable=this.enable},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$i}()),$V=function(){function $t(){}return $Z($t,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),$t._randomPointUnitArcCircle=function($i,$p,$F){var $J=$p.elements,$A=NaN;$A=$F?$F.getFloat()*$i:Math.random()*$i,$J[0]=Math.cos($A),$J[1]=Math.sin($A)},$t._randomPointInsideUnitArcCircle=function($i,$p,$F){var $J=$p.elements;$t._randomPointUnitArcCircle($i,$p,$F);var $A=NaN;$A=$F?Math.pow($F.getFloat(),.5):Math.pow(Math.random(),.5),$J[0]=$J[0]*$A,$J[1]=$J[1]*$A},$t._randomPointUnitCircle=function($i,$p){var $F=$i.elements,$J=NaN;$J=$p?$p.getFloat()*Math.PI*2:Math.random()*Math.PI*2,$F[0]=Math.cos($J),$F[1]=Math.sin($J)},$t._randomPointInsideUnitCircle=function($i,$p){var $F=$i.elements;$t._randomPointUnitCircle($i);var $J=NaN;$J=$p?Math.pow($p.getFloat(),.5):Math.pow(Math.random(),.5),$F[0]=$F[0]*$J,$F[1]=$F[1]*$J},$t._randomPointUnitSphere=function($i,$p){var $F=$i.elements,$J=NaN,$A=NaN;$A=$p?($J=$F[2]=2*$p.getFloat()-1,$p.getFloat()*Math.PI*2):($J=$F[2]=2*Math.random()-1,Math.random()*Math.PI*2);var $t=Math.sqrt(1-$J*$J);$F[0]=$t*Math.cos($A),$F[1]=$t*Math.sin($A)},$t._randomPointInsideUnitSphere=function($i,$p){var $F=$i.elements;$t._randomPointUnitSphere($i);var $J=NaN;$J=$p?Math.pow($p.getFloat(),1/3):Math.pow(Math.random(),1/3),$F[0]=$F[0]*$J,$F[1]=$F[1]*$J,$F[2]=$F[2]*$J},$t._randomPointInsideHalfUnitBox=function($i,$p){var $F=$i.elements;$p?($F[0]=$p.getFloat()-.5,$F[1]=$p.getFloat()-.5,$F[2]=$p.getFloat()-.5):($F[0]=Math.random()-.5,$F[1]=Math.random()-.5,$F[2]=Math.random()-.5)},$t}(),$T=(function(){function $i($i){this._size=null,this.enbale=!1,this._size=$i}$Z($i,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($i){var $p=$i;this._size.cloneTo($p._size),$p.enbale=this.enbale},$p.clone=function(){var $i;switch(this._size.type){case 0:$i=this._size.separateAxes?$N.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):$N.createByGradient(this._size.gradient.clone());break;case 1:$i=this._size.separateAxes?$N.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):$N.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:$i=this._size.separateAxes?$N.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):$N.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var $p=new this.constructor($i);return $p.enbale=this.enbale,$p},$s(0,$p,"size",function(){return this._size})}(),function(){function $J(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}$Z($J,"laya.d3.core.particleShuriKen.module.StartFrame");var $i=$J.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.cloneTo=function($i){var $p=$i;$p._type=this._type,$p._constant=this._constant,$p._constantMin=this._constantMin,$p._constantMax=this._constantMax},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$i,"constant",function(){return this._constant}),$s(0,$i,"type",function(){return this._type}),$s(0,$i,"constantMin",function(){return this._constantMin}),$s(0,$i,"constantMax",function(){return this._constantMax}),$J.createByConstant=function($i){var $p=new $J;return $p._type=0,$p._constant=$i,$p},$J.createByRandomTwoConstant=function($i,$p){var $F=new $J;return $F._type=1,$F._constantMin=$i,$F._constantMax=$p,$F},$J}()),$k=(function(){function $i($i,$p){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new $tp(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=$i,this._startFrame=$p}$Z($i,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($i){var $p=$i;this.tiles.cloneTo($p.tiles),$p.type=this.type,$p.randomRow=this.randomRow,this._frame.cloneTo($p._frame),this._startFrame.cloneTo($p._startFrame),$p.cycles=this.cycles,$p.enableUVChannels=this.enableUVChannels,$p.enable=this.enable},$p.clone=function(){var $i,$p;switch(this._frame.type){case 0:$i=$G.createByConstant(this._frame.constant);break;case 1:$i=$G.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:$i=$G.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:$i=$G.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:$p=$T.createByConstant(this._startFrame.constant);break;case 1:$p=$T.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var $F=new this.constructor($i,$p);return this.tiles.cloneTo($F.tiles),$F.type=this.type,$F.randomRow=this.randomRow,$F.cycles=this.cycles,$F.enableUVChannels=this.enableUVChannels,$F.enable=this.enable,$F},$s(0,$p,"frame",function(){return this._frame}),$s(0,$p,"startFrame",function(){return this._startFrame})}(),function(){function $i($i){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=$i}$Z($i,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var $p=$i.prototype;$v.imps($p,{"laya.d3.core.IClone":!0}),$p.cloneTo=function($i){var $p=$i;this._velocity.cloneTo($p._velocity),$p.enbale=this.enbale,$p.space=this.space},$p.clone=function(){var $i;switch(this._velocity.type){case 0:$i=$f.createByConstant(this._velocity.constant.clone());break;case 1:$i=$f.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:$i=$f.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:$i=$f.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var $p=new this.constructor($i);return $p.enbale=this.enbale,$p.space=this.space,$p},$s(0,$p,"velocity",function(){return this._velocity})}(),function(){function $i(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new $Sp,this._vb=$op.create($i._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=$fp.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=$yp.nameKey.getID("LINE"),this._shaderCompile=$Rp._preCompileShader[this._sharderNameID]}$Z($i,"laya.d3.core.PhasorSpriter3D");var $p=$i.prototype;return $p.line=function($i,$p,$F,$J){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($i.x,$i.y,$i.z,$p.x,$p.y,$p.z,$p.w),this.addVertex($F.x,$F.y,$F.z,$J.x,$J.y,$J.z,$J.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},$p.circle=function($i,$p,$F,$J,$A,$t){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*$p,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/$p,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*$i,Math.cos(this._tempNumver0)*$i,0,$F,$J,$A,$t),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},$p.plane=function($i,$p,$F,$J,$A,$t,$q,$B,$O){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=$J/2,this._tempNumver1=$A/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($i-this._tempNumver0,$p+this._tempNumver1,$F,$t,$q,$B,$O),this.addVertex($i+this._tempNumver0,$p+this._tempNumver1,$F,$t,$q,$B,$O),this.addVertex($i-this._tempNumver0,$p-this._tempNumver1,$F,$t,$q,$B,$O),this.addVertex($i+this._tempNumver0,$p-this._tempNumver1,$F,$t,$q,$B,$O),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},$p.box=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=$J/2,this._tempNumver1=$A/2,this._tempNumver2=$t/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($i-this._tempNumver0,$p+this._tempNumver1,$F+this._tempNumver2,$q,$B,$O,$U),this.addVertex($i+this._tempNumver0,$p+this._tempNumver1,$F+this._tempNumver2,$q,$B,$O,$U),this.addVertex($i-this._tempNumver0,$p-this._tempNumver1,$F+this._tempNumver2,$q,$B,$O,$U),this.addVertex($i+this._tempNumver0,$p-this._tempNumver1,$F+this._tempNumver2,$q,$B,$O,$U),this.addVertex($i+this._tempNumver0,$p+this._tempNumver1,$F-this._tempNumver2,$q,$B,$O,$U),this.addVertex($i-this._tempNumver0,$p+this._tempNumver1,$F-this._tempNumver2,$q,$B,$O,$U),this.addVertex($i+this._tempNumver0,$p-this._tempNumver1,$F-this._tempNumver2,$q,$B,$O,$U),this.addVertex($i-this._tempNumver0,$p-this._tempNumver1,$F-this._tempNumver2,$q,$B,$O,$U),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},$p.cone=function($i,$p,$F,$J,$A,$t,$q){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*$F+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*$F>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/$F,this.addVertexIndex(0,$p,0,$J,$A,$t,$q,this._tempUint0),this.addVertexIndex(0,0,0,$J,$A,$t,$q,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<$F;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex($i*this._tempNumver2,0,$i*this._tempNumver3,$J,$A,$t,$q,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==$F-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex($i*this._tempNumver2,0,$i*this._tempNumver3,$J,$A,$t,$q,this._tempUint0+(this._tempInt0+$F)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==$F-1?this.addIndexes(this._tempUint1+$F+2):this.addIndexes(this._tempUint1+this._tempInt0+$F+1),this.addIndexes(this._tempUint1+this._tempInt0+$F),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},$p.boundingBoxLine=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex($i,$A,$t,$q,$B,$O,$U),this.addVertex($J,$A,$t,$q,$B,$O,$U),this.addVertex($i,$p,$t,$q,$B,$O,$U),this.addVertex($J,$p,$t,$q,$B,$O,$U),this.addVertex($J,$A,$F,$q,$B,$O,$U),this.addVertex($i,$A,$F,$q,$B,$O,$U),this.addVertex($J,$p,$F,$q,$B,$O,$U),this.addVertex($i,$p,$F,$q,$B,$O,$U),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},$p.addVertex=function($i,$p,$F,$J,$A,$t,$q){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=$i,this._vbData[this._posInVBData+1]=$p,this._vbData[this._posInVBData+2]=$F,this._vbData[this._posInVBData+3]=$J,this._vbData[this._posInVBData+4]=$A,this._vbData[this._posInVBData+5]=$t,this._vbData[this._posInVBData+6]=$q,this._posInVBData+=this._floatSizePerVer,this},$p.addVertexIndex=function($i,$p,$F,$J,$A,$t,$q,$B){return this._hasBegun||this.addVertexIndexException(),this._vbData[$B]=$i,this._vbData[$B+1]=$p,this._vbData[$B+2]=$F,this._vbData[$B+3]=$J,this._vbData[$B+4]=$A,this._vbData[$B+5]=$t,this._vbData[$B+6]=$q,($B+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=$B),this},$p.addIndexes=function($i){var $p=arguments;this._hasBegun||this.addVertexIndexException();for(var $F=0;$F<$p.length;$F++)this._ibData[this._posInIBData]=$p[$F],this._posInIBData++;return this},$p.begin=function($i,$p){return this._hasBegun&&this.beginException0(),1!==$i&&4!==$i&&this.beginException1(),this._primitiveType=$i,this._camera=$p,this._hasBegun=!0,this},$p.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},$p.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes($i._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),$R.drawCall++,$h.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},$p.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},$p.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},$p.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},$p.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},$p.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},$p.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(28,[new $qi(0,"vector3",0),new $qi(12,"vector4",1)])}]),$i}()),$w=function(){function $i(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++$i._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new $Sp}$Z($i,"laya.d3.core.render.RenderElement");var $p=$i.prototype;return $p.getDynamicBatchBakedVertexs=function($i){for(var $p=this._renderObj._getVertexBuffer($i),$F=$p.getData().slice(),$J=$p.vertexDeclaration,$A=$J.getVertexElementByUsage(0).offset/4,$t=$J.getVertexElementByUsage(3).offset/4,$q=this._sprite3D.transform,$B=$q.worldMatrix,$O=$q.rotation,$U=$J.vertexStride/4,$d=0,$u=$F.length;$d<$u;$d+=$U){var $S=$d+$A,$Z=$d+$t;$jp.transformVector3ArrayToVector3ArrayCoordinate($F,$S,$B,$F,$S),$jp.transformVector3ArrayByQuat($F,$Z,$O,$F,$Z)}return $F},$p.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},$p._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},$s(0,$p,"id",function(){return this._id}),$s(0,$p,"renderObj",function(){return this._renderObj},function($i){this._renderObj!==$i&&(this._renderObj=$i)}),$i._uniqueIDCounter=0,$i}(),$$=function(){function $p($i){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++$p._uniqueIDCounter,this._needSort=!1,this._scene=$i,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}$Z($p,"laya.d3.core.render.RenderQueue");var $i=$p.prototype;return $i._sortOpaqueFunc=function($i,$p){if($i._render&&$p._render){var $F=$i._material.renderQueue-$p._material.renderQueue;return 0==$F?$i._render._distanceForSort-$p._render._distanceForSort:$F}return 0},$i._sortAlphaFunc=function($i,$p){if($i._render&&$p._render){var $F=$i._material.renderQueue-$p._material.renderQueue;return 0==$F?$p._render._distanceForSort-$i._render._distanceForSort:$F}return 0},$i._begainRenderElement=function($i,$p,$F){return!!$p._beforeRender($i)},$i._sortAlpha=function($i){$p._cameraPosition=$i,this._finalElements.sort(this._sortAlphaFunc)},$i._sortOpaque=function($i){$p._cameraPosition=$i,this._finalElements.sort(this._sortOpaqueFunc)},$i._preRender=function($i){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},$i._render=function($i,$p){for(var $F,$J,$A,$t,$q,$B,$O=$R.loopCount,$U=this._scene,$d=$i.camera,$u=($d.id,!1),$S=0,$Z=this._finalElements.length;$S<$Z;$S++){var $s,$x,$j,$r=this._finalElements[$S];if(null!=$r._onPreRenderFunction&&$r._onPreRenderFunction.call($r._sprite3D,$i),0===$r._type){if($i.owner=$j=$r._sprite3D,$i.renderElement=$r,$j._preRenderUpdateComponents($i),$s=$r.renderObj,$x=$r._material,this._begainRenderElement($i,$s,$x)){if($F=$s._getVertexBuffers(),!($A=($J=$s._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[$J.id]){this._errorRecord[$J.id]=1;var $M="vertexBuffer:"+("("+$J._destroyed+","+$J._released+","+$J._referenceCount+","+$J._buffer+")")+", material:"+($x?$x.__className+"("+$x._destroyed+","+$x._released+")":"null")+", owner:"+($j?$j.__className+"("+$j._destroyed+","+$j._activeInHierarchy+","+$j._displayedInStage+")":"null")+", renderObj:"+($s?$s.__className+"("+$s._destroyed+","+$s._released+","+$s._referenceCount+")":"")+", parent:, url:"+($j?$j.url:"")+", disposeStack:"+$J.disposeStack;$v.recordError("报错：unknown vertexDeclaration  "+$M)}continue}if($u=($t=$i._shader=$x._getShader($U._shaderDefineValue,$A.shaderDefineValue,$j._shaderDefineValue)).bind()||$O!==$t._uploadLoopCount,$F){if($t._uploadVertexBuffer!==$F||$u){for(var $D=0;$D<$F.length;$D++){var $E=$F[$D];$t.uploadAttributesX($E.vertexDeclaration.shaderValues.data,$E)}$t._uploadVertexBuffer=$F}}else($t._uploadVertexBuffer!==$J||$u)&&($t.uploadAttributes($A.shaderValues.data,null),$t._uploadVertexBuffer=$J);($t._uploadScene!==$U||$u)&&($t.uploadSceneUniforms($U._shaderValues.data),$t._uploadScene=$U),($d!==$t._uploadCamera||$t._uploadSprite3D!==$j||$u)&&($t.uploadSpriteUniforms($j._shaderValues.data),$t._uploadSprite3D=$j),($d!==$t._uploadCamera||$u)&&($t.uploadCameraUniforms($d._shaderValues.data),$t._uploadCamera=$d),($t._uploadMaterial!==$x||$u)&&($x._upload(),$t._uploadMaterial=$x),$q!==$x?($x._setRenderStateBlendDepth(),$x._setRenderStateFrontFace($p,$j.transform),$q=$x,$B=$j):$B!==$j&&($x._setRenderStateFrontFace($p,$j.transform),$B=$j),$s._render($i),$t._uploadLoopCount=$O}$j._postRenderUpdateComponents($i)}else if(2===$r._type){$r.renderObj;$i.owner=$j=$r._sprite3D,$i.renderElement=$r,$i._batchIndexStart=$r._tempBatchIndexStart,$i._batchIndexEnd=$r._tempBatchIndexEnd,$s=$r.renderObj,$x=$r._material,this._begainRenderElement($i,$s,$x)&&($A=($J=$s._getVertexBuffer(0)).vertexDeclaration,$u=($t=$i._shader=$x._getShader($U._shaderDefineValue,$A.shaderDefineValue,$j._shaderDefineValue)).bind()||$O!==$t._uploadLoopCount,($t._uploadVertexBuffer!==$J||$u)&&($t.uploadAttributes($A.shaderValues.data,null),$t._uploadVertexBuffer=$J),($t._uploadScene!==$U||$u)&&($t.uploadSceneUniforms($U._shaderValues.data),$t._uploadScene=$U),($d!==$t._uploadCamera||$t._uploadSprite3D!==$j||$u)&&($t.uploadSpriteUniforms($j._shaderValues.data),$t._uploadSprite3D=$j),($d!==$t._uploadCamera||$u)&&($t.uploadCameraUniforms($d._shaderValues.data),$t._uploadCamera=$d),($t._uploadMaterial!==$x||$u)&&($x._upload(),$t._uploadMaterial=$x),$q!==$x?($x._setRenderStateBlendDepth(),$x._setRenderStateFrontFace($p,$j.transform),$q=$x,$B=$j):$B!==$j&&($x._setRenderStateFrontFace($p,$j.transform),$B=$j),$s._render($i),$t._uploadLoopCount=$O)}}},$i._renderShadow=function($i,$p){for(var $F,$J,$A,$t,$q,$B=$R.loopCount,$O=this._scene,$U=$i.camera,$d=!1,$u=0,$S=this._finalElements.length;$u<$S;$u++){var $Z,$s,$x,$j=this._finalElements[$u];0===$j._type&&($i.owner=$x=$j._sprite3D,$p||$x._projectionViewWorldUpdateCamera===$U&&$x._projectionViewWorldUpdateLoopCount===$R.loopCount||($x._render._renderUpdate($i._projectionViewMatrix),$x._projectionViewWorldUpdateLoopCount=$R.loopCount,$x._projectionViewWorldUpdateCamera=$U),$i.renderElement=$j,$x._preRenderUpdateComponents($i),$Z=$j.renderObj,$s=$j._material,this._begainRenderElement($i,$Z,null)&&($J=($F=$Z._getVertexBuffer(0)).vertexDeclaration,$d=($A=$i._shader=$s._getShader($O._shaderDefineValue,$J.shaderDefineValue,$x._shaderDefineValue)).bind()||$B!==$A._uploadLoopCount,($A._uploadVertexBuffer!==$F||$d)&&($A.uploadAttributes($J.shaderValues.data,null),$A._uploadVertexBuffer=$F),($U!==$A._uploadCamera||$A._uploadSprite3D!==$x||$d)&&($A.uploadSpriteUniforms($x._shaderValues.data),$A._uploadSprite3D=$x),($U!==$A._uploadCamera||$d)&&($A.uploadCameraUniforms($U._shaderValues.data),$A._uploadCamera=$U),($A._uploadMaterial!==$s||$d)&&($s._upload(),$A._uploadMaterial=$s),$A._uploadRenderElement,$t!==$s?($s._setRenderStateFrontFace(!1,$x.transform),$t=$s,$q=$x):$q!==$x&&($s._setRenderStateFrontFace(!1,$x.transform),$q=$x),$Z._render($i),$A._uploadLoopCount=$B),$x._postRenderUpdateComponents($i))}},$i._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},$i._addRenderElement=function($i){this._renderElements.push($i),this._needSort=!0},$i._addDynamicBatchElement=function($i){this._dynamicBatchCombineRenderElements.push($i)},$s(0,$i,"id",function(){return this._id}),$p._uniqueIDCounter=0,$p._cameraPosition=null,$p}(),$X=function(){function $i(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return $Z($i,"laya.d3.core.render.RenderState"),$i.clientWidth=0,$i.clientHeight=0,$i}(),$e=function(){function $q($i,$p){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new $zi(new $qp,0),this._corners=[new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp],this._boundingBoxCenter=new $qp,this._children=$J(8),this._objects=[],this._tempBoundBoxCorners=[new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp],this._scene=$i,this._currentDepth=$p}$Z($q,"laya.d3.core.scene.OctreeNode");var $i=$q.prototype;return $v.imps($i,{"laya.d3.core.scene.ITreeNode":!0}),$i.init=function($i,$p){var $F=new $qp,$J=new $qp;$qp.scale($p,-.5,$F),$qp.scale($p,.5,$J),$qp.add($F,$i,$F),$qp.add($J,$i,$J),this.exactBox=new $ei($F,$J),this.relaxBox=new $ei($F,$J)},$i.addTreeNode=function($i){1===Collision.boxContainsBox(this._relaxBox,$i.boundingBox)?this.addNodeDown($i,0):this.addObject($i)},$i.addChild=function($i){var $p=this._children[$i];if(null==$p){$p=new $q(this._scene,this._currentDepth+1),(this._children[$i]=$p)._parent=this,$qp.subtract(this._exactBox.max,this._exactBox.min,$q.tempSize),$qp.multiply($q.tempSize,$q._octreeSplit[$i],$q.tempCenter),$qp.add(this._exactBox.min,$q.tempCenter,$q.tempCenter),$qp.scale($q.tempSize,.25,$q.tempSize);var $F=new $qp,$J=new $qp;$qp.subtract($q.tempCenter,$q.tempSize,$F),$qp.add($q.tempCenter,$q.tempSize,$J),$p.exactBox=new $ei($F,$J),$qp.scale($q.tempSize,$q.relax,$q.tempSize);var $A=new $qp,$t=new $qp;$qp.subtract($q.tempCenter,$q.tempSize,$A),$qp.add($q.tempCenter,$q.tempSize,$t),$p.relaxBox=new $ei($A,$t)}return $p},$i.addObject=function($i){($i._treeNode=this)._objects.push($i)},$i.removeObject=function($i){if($i._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var $p=this._objects.indexOf($i);return-1!==$p&&(this._objects.splice($p,1),!0)},$i.clearObject=function(){this._objects.length=0},$i.addNodeUp=function($i,$p){this._parent&&1!==Collision.boxContainsBox(this._exactBox,$i.boundingBox)?this._parent.addNodeUp($i,$p-1):this.addNodeDown($i,$p)},$i.addNodeDown=function($i,$p){if($p<this._scene.treeLevel){var $F=this.inChildIndex($i.boundingBoxCenter),$J=this.addChild($F);1===Collision.boxContainsBox($J._relaxBox,$i.boundingBox)?$J.addNodeDown($i,++$p):this.addObject($i)}else this.addObject($i)},$i.inChildIndex=function($i){return 4*($i.z<this._boundingBoxCenter.z?0:1)+2*($i.y<this._boundingBoxCenter.y?0:1)+($i.x<this._boundingBoxCenter.x?0:1)},$i.updateObject=function($i){1===Collision.boxContainsBox(this._relaxBox,$i.boundingBox)?(this.removeObject($i),$i._treeNode=null,this.addNodeDown($i,this._currentDepth)):this._parent&&(this.removeObject($i),$i._treeNode=null,this._parent.addNodeUp($i,this._currentDepth-1))},$i.cullingObjects=function($i,$p,$F,$J,$A){var $t,$q=0,$B=0,$O=0,$U=this._scene._dynamicBatchManager;for($q=0,$t=this._objects.length;$q<$t;$q++){var $d=this._objects[$q];if($I.isVisible($d._owner.layer.mask)&&$d.enable){if($p&&($R.treeSpriteCollision+=1,0===$i.containsBoundSphere($d.boundingSphere)))continue;$d._renderUpdate($A),$d._distanceForSort=$qp.distance($d.boundingSphere.center,$J)+$d.sortingFudge;var $u=$d._renderElements;for($B=0,$O=$u.length;$B<$O;$B++){var $S=$u[$B],$Z=$S._staticBatch;if($Z&&$Z._material===$S._material)$Z._addBatchRenderElement($S);else{var $s=$S.renderObj;$s.triangleCount<10&&1===$s._vertexBufferCount&&$s._getIndexBuffer()&&$S._material.renderQueue<2&&$S._canDynamicBatch&&!$d._owner.isStatic?$U._addPrepareRenderElement($S):this._scene.getRenderQueue($S._material.renderQueue)._addRenderElement($S)}}}}for($q=0;$q<8;$q++){var $x=this._children[$q];if(null!=$x){var $j=$p;if($p){var $r=$i.containsBoundBox($x._relaxBox);if($R.treeNodeCollision+=1,0===$r)continue;$j=2===$r}$x.cullingObjects($i,$j,$F,$J,$A)}}},$i.cullingShadowObjects=function($i,$p,$F,$J,$A){var $t,$q=0,$B=0,$O=0;this._scene._dynamicBatchManager;for($q=0,$t=this._objects.length;$q<$t;$q++){var $U=this._objects[$q];if($U.castShadow&&$I.isVisible($U._owner.layer.mask)&&$U.enable){if($F&&0===$i[0].containsBoundSphere($U.boundingSphere))continue;for(var $d=1,$u=$i.length;$d<$u;$d++){var $S=$p[$d-1];if(0!==$i[$d].containsBoundSphere($U.boundingSphere)){var $Z=$U._renderElements;for($B=0,$O=$Z.length;$B<$O;$B++)$S._addRenderElement($Z[$B])}}}}for($q=0;$q<8;$q++){var $s=this._children[$q];if(null!=$s){var $x=$F;if($F){var $j=$i[0].containsBoundBox($s._relaxBox);if(0===$j)continue;$x=2===$j}$s.cullingShadowObjects($i,$p,$x,$J,$A)}}},$i.cullingShadowObjectsOnePSSM=function($i,$p,$F,$J,$A,$t){var $q,$B=$p[0],$O=0,$U=0,$d=0;for($O=0,$q=this._objects.length;$O<$q;$O++){var $u=this._objects[$O];if($u.castShadow&&$I.isVisible($u._owner.layer.mask)&&$u.enable){if($J&&0===$i.containsBoundSphere($u.boundingSphere))continue;$u._renderUpdate($F);var $S=$u._renderElements;for($U=0,$d=$S.length;$U<$d;$U++)$B._addRenderElement($S[$U])}}for($O=0;$O<8;$O++){var $Z=this._children[$O];if(null!=$Z){var $s=$J;if($J){var $x=$i.containsBoundBox($Z._relaxBox);if(0===$x)continue;$s=2===$x}$Z.cullingShadowObjectsOnePSSM($i,$p,$F,$s,$A,$t)}}},$i.renderBoudingBox=function($i){this._renderBoudingBox($i);for(var $p=0;$p<8;++$p){var $F=this._children[$p];$F&&$F.renderBoudingBox($i)}},$i.buildAllChild=function($i){if($i<this._scene.treeLevel)for(var $p=0;$p<8;$p++){this.addChild($p).buildAllChild($i+1)}},$i._renderBoudingBox=function($i){},$s(0,$i,"exactBox",function(){return this._exactBox},function($i){this._exactBox=$i,$qp.add($i.min,$i.max,this._boundingBoxCenter),$qp.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),$s(0,$i,"relaxBox",function(){return this._relaxBox},function($i){(this._relaxBox=$i).getCorners(this._corners),$zi.createfromPoints(this._corners,this._boundingSphere)}),$q.debugMode=!1,$q.relax=1.15,$q.CHILDNUM=8,$u($q,["tempVector0",function(){return this.tempVector0=new $qp},"tempSize",function(){return this.tempSize=new $qp},"tempCenter",function(){return this.tempCenter=new $qp},"_octreeSplit",function(){return this._octreeSplit=[new $qp(.25,.25,.25),new $qp(.75,.25,.25),new $qp(.25,.75,.25),new $qp(.75,.75,.25),new $qp(.25,.25,.75),new $qp(.75,.25,.75),new $qp(.25,.75,.75),new $qp(.75,.75,.75)]}]),$q}(),$b=(function(){function $i(){}$Z($i,"laya.d3.core.scene.SceneManager")}(),function(){function $i($i,$p,$F,$J){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===$i&&($i=1),void 0===$p&&($p=1),void 0===$F&&($F=1),void 0===$J&&($J=1),this._r=$i,this._g=$p,this._b=$F,this._a=$J}return $Z($i,"laya.d3.core.trail.module.Color",null,"Color$1"),$i.prototype.cloneTo=function($i){$i._r=this._r,$i._g=this._g,$i._b=this._b,$i._a=this._a},$u($i,["RED",function(){return this.RED=new $i(1,0,0,1)},"GREEN",function(){return this.GREEN=new $i(0,1,0,1)},"BLUE",function(){return this.BLUE=new $i(0,0,1,1)},"CYAN",function(){return this.CYAN=new $i(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new $i(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new $i(1,0,1,1)},"GRAY",function(){return this.GRAY=new $i(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new $i(1,1,1,1)},"BLACK",function(){return this.BLACK=new $i(0,0,0,1)}]),$i}()),$z=(function(){function $i(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}$Z($i,"laya.d3.core.trail.module.Gradient");var $p=$i.prototype;$p.setKeys=function($i,$p){var $F,$J;this._colorKeys=$i;for(var $A=this.index=0;$A<$i.length;$A++){var $t=($F=$i[$A]).color;this._colorKeyData[this.index++]=$t._r,this._colorKeyData[this.index++]=$t._g,this._colorKeyData[this.index++]=$t._b,this._colorKeyData[this.index++]=$F.time}this._alphaKeys=$p;for(var $q=this.index=0;$q<$p.length;$q++)$J=$p[$q],this._alphaKeyData[this.index++]=$J.alpha,this._alphaKeyData[this.index++]=$J.time},$p.cloneTo=function($i){var $p=0,$F=0,$J=this.colorKeys,$A=[];for($p=0,$F=$J.length;$p<$F;$p++){var $t=new $l;$J[$p].cloneTo($t),$A.push($t)}var $q=this.alphaKeys,$B=[];for($p=0,$F=$q.length;$p<$F;$p++){var $O=new $z;$q[$p].cloneTo($O),$B.push($O)}$i.setKeys($A,$B)},$s(0,$p,"mode",function(){return this._mode},function($i){this._mode=$i}),$s(0,$p,"colorKeys",function(){return this._colorKeys},function($i){this._colorKeys=$i;for(var $p=this.index=0;$p<$i.length;$p++){var $F=$i[$p],$J=$F.color;this._colorKeyData[this.index++]=$J._r,this._colorKeyData[this.index++]=$J._g,this._colorKeyData[this.index++]=$J._b,this._colorKeyData[this.index++]=$F.time}}),$s(0,$p,"alphaKeys",function(){return this._alphaKeys},function($i){this._alphaKeys=$i;for(var $p=this.index=0;$p<$i.length;$p++){var $F=$i[$p];this._alphaKeyData[this.index++]=$F.alpha,this._alphaKeyData[this.index++]=$F.time}})}(),function(){function $i($i,$p){this._alpha=NaN,this._time=NaN,void 0===$i&&($i=0),void 0===$p&&($p=0),this._alpha=$i,this._time=$p}$Z($i,"laya.d3.core.trail.module.GradientAlphaKey");var $p=$i.prototype;return $p.cloneTo=function($i){$i.alpha=this.alpha,$i.time=this.time},$s(0,$p,"alpha",function(){return this._alpha},function($i){this._alpha=$i}),$s(0,$p,"time",function(){return this._time},function($i){this._time=$i}),$i}()),$l=function(){function $i($i,$p){this._color=null,this._time=NaN,void 0===$p&&($p=0),this._color=$i||new $b,this._time=$p}$Z($i,"laya.d3.core.trail.module.GradientColorKey");var $p=$i.prototype;return $p.cloneTo=function($i){this.color.cloneTo($i.color),$i.time=this.time},$s(0,$p,"color",function(){return this._color},function($i){this._color=$i}),$s(0,$p,"time",function(){return this._time},function($i){this._time=$i}),$i}(),$H=(function(){function $i(){}$Z($i,"laya.d3.core.trail.module.GradientMode"),$i.Blend=0,$i.Fixed=1}(),function(){function $i(){}$Z($i,"laya.d3.core.trail.module.TextureMode"),$i.Stretch=0,$i.Tile=1}(),function(){function $i(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}$Z($i,"laya.d3.core.trail.module.TrailKeyFrame"),$i.prototype.cloneTo=function($i){$i.time=this.time,$i.inTangent=this.inTangent,$i.outTangent=this.outTangent,$i.value=this.value}}(),function(){function $p($i){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new $qp,this._curPosition=new $qp,this._delVector3=new $qp,this._lastFixedVertexPosition=new $qp,this._pointAtoBVector3=new $qp,this._pointA=new $qp,this._pointB=new $qp,this._owner=$i,this._id=$p.renderElementCount++,0==this._id?$i._owner.transform.position.cloneTo(this._lastPosition):$i._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new $op($H.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new $op($H.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}$Z($p,"laya.d3.core.trail.TrailRenderElement");var $i=$p.prototype;$v.imps($i,{"laya.d3.core.render.IRenderable":!0}),$i._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},$i._addTrailByFirstPosition=function($i,$p){$qp.subtract($p,$i,this._delVector3),$qp.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$qp.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$qp.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition($i),$i.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},$i._addTrailByNextPosition=function($i){$qp.subtract($i,this._lastFixedVertexPosition,this._delVector3),$qp.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),$qp.normalize(this._pointAtoBVector3,this._pointAtoBVector3),$qp.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=$qp.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=$li.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition($i),$i.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition($i),this._virtualVerticesCount=2)},$i._updateVerticesByPosition=function($i){this._pointe=$i.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},$i._updateVertexBuffer2=function(){var $i,$p=0,$F=0,$J=0;for($J=0,$i=(this._verticesCount+this._virtualVerticesCount)/2;$J<$i;$J++)$F=0==this._owner.textureMode?(this._VerticesToTailLength[$J]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[$J],this._vertices2[$p++]=1-$F,this._vertices2[$p++]=1-$F;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},$i._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},$i._updateDisappear=function(){var $i,$p=0;for($p=this._curDisappearIndex,$i=(this._verticesCount+this._virtualVerticesCount)/2;$p<$i;$p++)this._owner._curtime-this._everyGroupVertexBirthTime[$p]>=this._owner.time+$li.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},$i._beforeRender=function($i){return this._camera=$i.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),$qp.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},$i._render=function($i){this._isDead||($h.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),$R.drawCall++,$R.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},$i._getVertexBuffer=function($i){return void 0===$i&&($i=0),0===$i?this._vertexBuffer1:1===$i?this._vertexBuffer2:null},$i._getVertexBuffers=function(){return this._vertexBuffers},$i._getIndexBuffer=function(){return null},$i.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},$i._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},$s(0,$i,"_vertexBufferCount",function(){return this._vertexBuffers.length}),$s(0,$i,"triangleCount",function(){return 0}),$p.renderElementCount=0}(),function(){function $i(){}$Z($i,"laya.d3.core.trail.VertexTrail");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration1}),$s(1,$i,"vertexDeclaration1",function(){return $i._vertexDeclaration1}),$s(1,$i,"vertexDeclaration2",function(){return $i._vertexDeclaration2}),$u($i,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new $ti(32,[new $qi(0,"vector3",0),new $qi(12,"vector3",41),new $qi(24,"single",33),new $qi(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new $ti(4,[new $qi(0,"single",38)])}]),$i}()),$ii=function(){function $E($i){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=$i}$Z($E,"laya.d3.graphics.DynamicBatch");var $i=$E.prototype;return $v.imps($i,{"laya.d3.core.render.IRenderable":!0}),$i._getVertexBuffer=function($i){return void 0===$i&&($i=0),0===$i?this._vertexBuffer:null},$i._getIndexBuffer=function(){return this._indexBuffer},$i._getCombineRenderElementFromPool=function($i,$p,$F){var $J=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return $J||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=$J=new $w,$J._sprite3D=new $$p),$J._sprite3D._render._renderUpdate($F),$J},$i._getRenderElement=function($i,$p,$F){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*$E.maxVertexCount),this._indexDatas=new Uint16Array($E.maxIndexCount),this._vertexBuffer=$op.create(this._vertexDeclaration,$E.maxVertexCount,35048),this._indexBuffer=$fp.create("ushort",$E.maxIndexCount,35048));for(var $J=this._merageElements.length=0,$A=0,$t=0,$q=this._combineRenderElements.length;$t<$q;$t++){var $B=this._combineRenderElements[$t],$O=$B.getDynamicBatchBakedVertexs(0),$U=$B.getBakedIndices(),$d=$B._sprite3D.transform._isFrontFaceInvert,$u=$J/(this._vertexDeclaration.vertexStride/4),$S=$A,$Z=$S+$U.length;$B._tempBatchIndexStart=$S,$B._tempBatchIndexEnd=$Z,this._indexDatas.set($U,$A);var $s=0;if($d)for($s=$S;$s<$Z;$s+=3){this._indexDatas[$s]=$u+this._indexDatas[$s];var $x=this._indexDatas[$s+1],$j=this._indexDatas[$s+2];this._indexDatas[$s+1]=$u+$j,this._indexDatas[$s+2]=$u+$x}else for($s=$S;$s<$Z;$s+=3)this._indexDatas[$s]=$u+this._indexDatas[$s],this._indexDatas[$s+1]=$u+this._indexDatas[$s+1],this._indexDatas[$s+2]=$u+this._indexDatas[$s+2];$A+=$U.length,this._vertexDatas.set($O,$J),$J+=$O.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),$t=this._combineRenderElementPoolIndex=0,$q=this._materials.length;$t<$q;$t++){var $r=this._getCombineRenderElementFromPool($i,$p,$F);$r._type=2,$r._staticBatch=null;var $M=($r.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[$t]]._tempBatchIndexStart,$D=$t+1===this._materialToRenderElementsOffsets.length?$A:this._combineRenderElements[this._materialToRenderElementsOffsets[$t+1]]._tempBatchIndexStart;$r._tempBatchIndexStart=$M,$r._tempBatchIndexEnd=$D,$r._material=this._materials[$t],this._merageElements.push($r)}},$i._addCombineRenderObjTest=function($i){var $p=$i.renderObj,$F=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,$J=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount;return!($E.maxVertexCount<$J||$E.maxIndexCount<$F)},$i._addCombineRenderObj=function($i){var $p=$i.renderObj;this._combineRenderElements.push($i),this._currentCombineIndexCount=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount},$i._addCombineMaterial=function($i){this._materials.push($i)},$i._addMaterialToRenderElementOffset=function($i){this._materialToRenderElementsOffsets.push($i)},$i._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},$i._addToRenderQueue=function($i,$p,$F,$J){this._getRenderElement($p,$F,$J);for(var $A=0,$t=this._materials.length;$A<$t;$A++)$i.getRenderQueue(this._materials[$A].renderQueue)._addDynamicBatchElement(this._merageElements[$A])},$i._beforeRender=function($i){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$i._render=function($i){var $p=$i._batchIndexEnd-$i._batchIndexStart;$h.mainContext.drawElements(4,$p,5123,2*$i._batchIndexStart),$R.drawCall++,$R.trianglesFaces+=$p/3},$i._getVertexBuffers=function(){return null},$s(0,$i,"_vertexBufferCount",function(){return 1}),$s(0,$i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$s(0,$i,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),$E.maxVertexCount=2e4,$E.maxIndexCount=4e4,$E.maxCombineTriangleCount=10,$E}(),$pi=function(){function $E(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}$Z($E,"laya.d3.graphics.DynamicBatchManager");var $i=$E.prototype;return $i.getDynamicBatch=function($i,$p){var $F,$J=$i.id.toString()+$p;return this._dynamicBatches[$J]?$F=this._dynamicBatches[$J]:this._dynamicBatches[$J]=$F=new $ii($i),$F},$i._garbageCollection=function(){for(var $i in this._dynamicBatches)0===this._dynamicBatches[$i].combineRenderElementsCount&&delete this._dynamicBatches[$i]},$i._addPrepareRenderElement=function($i){this._prepareDynamicBatchCombineElements.push($i)},$i._finishCombineDynamicBatch=function($i){var $p,$F,$J;this._prepareDynamicBatchCombineElements.sort($E._sortPrepareDynamicBatch);for(var $A,$t,$q,$B,$O,$U=-1,$d=!0,$u=0,$S=-1,$Z=0,$s=this._prepareDynamicBatchCombineElements.length;$Z<$s;$Z++){var $x=($t=this._prepareDynamicBatchCombineElements[$Z]).renderObj._getVertexBuffer(0).vertexDeclaration,$j=$F!==$x;$j&&($u=0,$F=$x);var $r=$u!==$U;if($r&&($U=$u),($j||$r)&&($q=this.getDynamicBatch($x,$u),$p=null),$d)if($q._addCombineRenderObjTest($t)){if($p!==($A=$t._material))$B&&($i.getRenderQueue($O._material.renderQueue)._addRenderElement($O),$O=$B=null,$S=-1),$B=$A,$S=$q.combineRenderElementsCount,$O=$t,$p=$A;else if($B){var $M=$O.renderObj,$D=$t.renderObj;$M._getVertexBuffer().vertexCount+$D._getVertexBuffer().vertexCount>$ii.maxVertexCount||$M._getIndexBuffer().indexCount+$D._getIndexBuffer().indexCount>$ii.maxIndexCount?($i.getRenderQueue($O._material.renderQueue)._addRenderElement($O),$B=$A,$S=$q.combineRenderElementsCount,$O=$t):($q._addCombineMaterial($B),$q._addMaterialToRenderElementOffset($S),$q._addCombineRenderObj($O),$O=$B=null,$S=-1,$q._addCombineRenderObj($t))}else $q._addCombineRenderObj($t);$d=!0}else $B&&($i.getRenderQueue($O._material.renderQueue)._addRenderElement($O),$O=$B=null,$S=-1),$u++,$d=!1;else $J=this._prepareDynamicBatchCombineElements[$Z-1],$q._addMaterialToRenderElementOffset($q.combineRenderElementsCount),$p=$J._material,$q._addCombineMaterial($p),$q._addCombineRenderObj($J),$d=!0,$p!==($A=$t._material)?($B=$A,$S=$q.combineRenderElementsCount,$O=$t):$q._addCombineRenderObj($t),$p=$A}$B&&($i.getRenderQueue($O._material.renderQueue)._addRenderElement($O),$O=$B=null,$S=-1),this._prepareDynamicBatchCombineElements.length=0},$i._clearRenderElements=function(){for(var $i in this._dynamicBatches)this._dynamicBatches[$i]._clearRenderElements()},$i._addToRenderQueue=function($i,$p,$F,$J){for(var $A in this._dynamicBatches){var $t=this._dynamicBatches[$A];0<$t.combineRenderElementsCount&&$t._addToRenderQueue($i,$p,$F,$J)}},$i.dispose=function(){this._dynamicBatches=null},$E._sortPrepareDynamicBatch=function($i,$p){return $i._mainSortID-$p._mainSortID},$E}(),$Fi=function(){function $i(){}return $Z($i,"laya.d3.graphics.FrustumCulling"),$i.renderShadowObjectCulling=function($i,$p,$F,$J,$A){var $t=0,$q=0,$B=0,$O=0;for($t=0,$B=$F.length;$t<$B;$t++){var $U=$F[$t];$U&&$U._clearRenderElements()}var $d,$u,$S,$Z=$i._cullingRenders;if(1<$A){for($t=0,$B=$i._cullingRendersLength;$t<$B;$t++)if(($d=$Z[$t]).castShadow&&$I.isVisible($d._owner.layer.mask)&&$d.enable)for(var $s=1,$x=$p.length;$s<$x;$s++)if($u=$F[$s-1],0!==$p[$s].containsBoundSphere($d.boundingSphere))for($q=0,$O=($S=$d._renderElements).length;$q<$O;$q++)$u._addRenderElement($S[$q])}else for($t=0,$B=$i._cullingRendersLength;$t<$B;$t++)if(($d=$Z[$t]).castShadow&&$I.isVisible($d._owner.layer.mask)&&$d.enable&&0!==$p[0].containsBoundSphere($d.boundingSphere))for($d._renderUpdate($J),$u=$F[0],$q=0,$O=($S=$d._renderElements).length;$q<$O;$q++)$u._addRenderElement($S[$q])},$i.renderShadowObjectCullingOctree=function($i,$p,$F,$J,$A){for(var $t=0,$q=$F.length;$t<$q;$t++){var $B=$F[$t];$B&&$B._clearRenderElements()}1<$A?$i.treeRoot.cullingShadowObjects($p,$F,!0,0,$i):$i.treeRoot.cullingShadowObjectsOnePSSM($p[0],$F,$J,!0,0,$i)},$i.renderObjectCulling=function($i,$p,$F,$J,$A,$t){var $q=0,$B=0,$O=0,$U=0,$d=$p._quenes,$u=$p._dynamicBatchManager,$S=$p._cullingRenders;for($q=0,$B=$d.length;$q<$B;$q++){var $Z=$d[$q];$Z&&$Z._clearRenderElements()}var $s=$Ji._staticBatchManagers;for($q=0,$B=$s.length;$q<$B;$q++)$s[$q]._clearRenderElements();$u._clearRenderElements();var $x=$F.transform.position;for($q=0,$B=$p._cullingRendersLength;$q<$B;$q++){var $j=$S[$q];if($I.isVisible($j._owner.layer.mask)&&$j.enable&&0!==$i.containsBoundSphere($j.boundingSphere)&&$j._renderUpdate($t)){$j._distanceForSort=$qp.distance($j.boundingSphere.center,$x)+$j.sortingFudge;var $r=$j._renderElements;for($O=0,$U=$r.length;$O<$U;$O++){var $M=$r[$O],$D=$M._staticBatch;if($D&&$D._material===$M._material)$D._addBatchRenderElement($M);else{var $E=$M.renderObj;$E.triangleCount<10&&1===$E._vertexBufferCount&&$E._getIndexBuffer()&&$M._material.renderQueue<2&&$M._canDynamicBatch&&!$j._owner.isStatic?$u._addPrepareRenderElement($M):$p.getRenderQueue($M._material.renderQueue)._addRenderElement($M)}}}}for($q=0,$B=$s.length;$q<$B;$q++)$s[$q]._addToRenderQueue($p,$J,$A,$t);$u._finishCombineDynamicBatch($p),$u._addToRenderQueue($p,$J,$A,$t)},$i.renderObjectCullingOctree=function($i,$p,$F,$J,$A,$t){var $q=0,$B=0,$O=$p._quenes,$U=$p._dynamicBatchManager;for($q=0,$B=$O.length;$q<$B;$q++){var $d=$O[$q];$d&&$d._clearRenderElements()}var $u=$Ji._staticBatchManagers;for($q=0,$B=$u.length;$q<$B;$q++)$u[$q]._clearRenderElements();for($U._clearRenderElements(),$p._cullingRenders.length=0,$p.treeRoot.cullingObjects($i,!0,0,$F.transform.position,$t),$q=0,$B=$u.length;$q<$B;$q++)$u[$q]._addToRenderQueue($p,$J,$A,$t);$U._finishCombineDynamicBatch($p),$U._addToRenderQueue($p,$J,$A,$t)},$i.renderObjectCullingNoBoundFrustum=function($i,$p,$F,$J,$A){var $t=0,$q=0,$B=0,$O=0,$U=$i._quenes,$d=$i._dynamicBatchManager,$u=$i._cullingRenders;for($t=0,$q=$U.length;$t<$q;$t++){var $S=$U[$t];$S&&$S._clearRenderElements()}var $Z=$Ji._staticBatchManagers;for($t=0,$q=$Z.length;$t<$q;$t++)$Z[$t]._clearRenderElements();$d._clearRenderElements();var $s=$p.transform.position;for($t=0,$q=$i._cullingRendersLength;$t<$q;$t++){var $x=$u[$t];if($I.isVisible($x._owner.layer.mask)&&$x.enable){$x._renderUpdate($A),$x._distanceForSort=$qp.distance($x.boundingSphere.center,$s)+$x.sortingFudge;var $j=$x._renderElements;for($B=0,$O=$j.length;$B<$O;$B++){var $r=$j[$B],$M=$r._staticBatch;if($M&&$M._material===$r._material)$M._addBatchRenderElement($r);else{var $D=$r.renderObj;$D.triangleCount<10&&1===$D._vertexBufferCount&&$D._getIndexBuffer()&&$r._material.renderQueue<2&&$r._canDynamicBatch&&!$x._owner.isStatic?$d._addPrepareRenderElement($r):$i.getRenderQueue($r._material.renderQueue)._addRenderElement($r)}}}}for($t=0,$q=$Z.length;$t<$q;$t++)$Z[$t]._addToRenderQueue($i,$F,$J,$A);$d._finishCombineDynamicBatch($i),$d._addToRenderQueue($i,$F,$J,$A)},$i}(),$Ji=function(){function $t(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}$Z($t,"laya.d3.graphics.StaticBatchManager");var $i=$t.prototype;return $i._finishInit=function(){for(var $i in this._staticBatches)this._staticBatches[$i]._finishInit();this._initBatchRenderElements.length=0},$i._initStaticBatchs=function($i){throw new Error("StaticBatchManager:must override this function.")},$i._addInitBatchSprite=function($i){for(var $p=$i._render._renderElements,$F=0,$J=$p.length;$F<$J;$F++)this._initBatchRenderElements.push($p[$F])},$i._clearRenderElements=function(){for(var $i in this._staticBatches)this._staticBatches[$i]._clearRenderElements()},$i._garbageCollection=function($i){var $p=$i._staticBatch,$F=$p._initBatchRenderElements,$J=$F.indexOf($i);$F.splice($J,1),0===$F.length&&($p.dispose(),delete this._staticBatches[$p._key])},$i._addToRenderQueue=function($i,$p,$F,$J){for(var $A in this._staticBatches){var $t=this._staticBatches[$A];0<$t._batchRenderElements.length&&$t._updateToRenderQueue($i,$J)}},$i.dispose=function(){this._staticBatches=null},$t._addToStaticBatchQueue=function($i){$i instanceof laya.d3.core.RenderableSprite3D&&$i._addToInitStaticBatchManager();for(var $p=0,$F=$i.numChildren;$p<$F;$p++)$t._addToStaticBatchQueue($i._childs[$p])},$t.combine=function($i,$p){var $F,$J=0,$A=0;if($p)for($J=0,$A=$p.length;$J<$A;$J++){$p[$J]._addToInitStaticBatchManager()}else $i&&$t._addToStaticBatchQueue($i);for($J=0,$A=$t._staticBatchManagers.length;$J<$A;$J++)($F=$t._staticBatchManagers[$J])._initStaticBatchs($i),$F._finishInit()},$t._staticBatchManagers=[],$t}(),$Ai=function(){function $i($i,$p,$F){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=$i,this._manager=$p,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=$F}$Z($i,"laya.d3.graphics.StaticBatch");var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$p._binarySearch=function($i){for(var $p=0,$F=this._batchRenderElements.length-1,$J=0;$p<=$F;)$J=Math.floor(($p+$F)/2),this._compareBatchRenderElement(this._batchRenderElements[$J],$i)?$F=$J-1:$p=$J+1;return $p},$p._compareBatchRenderElement=function($i,$p){throw new Error("StaticBatch:must override this function.")},$p._getVertexDecLightMap=function($i){return $i===$fi.vertexDeclaration?$Ii.vertexDeclaration:$i===$Ni.vertexDeclaration?$ni.vertexDeclaration:$i===$Qi.vertexDeclaration?$Ei.vertexDeclaration:$i===$Ci.vertexDeclaration?null:$i===$xi.vertexDeclaration?$ji.vertexDeclaration:$i===$Wi.vertexDeclaration?$_i.vertexDeclaration:$i===$hi.vertexDeclaration?$mi.vertexDeclaration:$i===$oi.vertexDeclaration?$Gi.vertexDeclaration:$i===$Ni.vertexDeclaration?$ni.vertexDeclaration:$i===$Pi.vertexDeclaration?$vi.vertexDeclaration:$i===$Ci.vertexDeclaration?null:$i===$xi.vertexDeclaration?$ji.vertexDeclaration:$i===$Li.vertexDeclaration?$yi.vertexDeclaration:$i===$hi.vertexDeclaration?$mi.vertexDeclaration:$i},$p._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},$p._addBatchRenderElement=function($i){this._batchRenderElements.splice(this._binarySearch($i),0,$i)},$p._updateToRenderQueue=function($i,$p){this._combineRenderElementPoolIndex=0,this._getRenderElement($i.getRenderQueue(this._material.renderQueue)._renderElements,$i,$p)},$p._getRenderElement=function($i,$p,$F){throw new Error("StaticBatch:must override this function.")},$p._finishInit=function(){throw new Error("StaticBatch:must override this function.")},$p._clearRenderElements=function(){this._batchRenderElements.length=0},$p.dispose=function(){},$p._getVertexBuffer=function($i){return void 0===$i&&($i=0),null},$p._getIndexBuffer=function(){return null},$p._beforeRender=function($i){return!0},$p._render=function($i){},$p._getVertexBuffers=function(){return null},$s(0,$p,"_vertexBufferCount",function(){return 1}),$s(0,$p,"triangleCount",function(){return 0}),$i.combine=function($i){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),$Ji.combine($i)},$i.maxBatchVertexCount=65535,$i}(),$ti=function(){function $q($i,$p){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++$q._uniqueIDCounter,this._id>$q.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",$q.maxVertexDeclaration);this._shaderValues=new $Sp,this._vertexElementsDic={},this._vertexStride=$i,this._vertexElements=$p;for(var $F=0;$F<$p.length;$F++){var $J=$p[$F],$A=$J.elementUsage;this._vertexElementsDic[$A]=$J;var $t=[$q._getTypeSize($J.elementFormat)/4,5126,!1,this._vertexStride,$J.offset];switch(this._shaderValues.setValue($A,$t),$A){case 1:this._addShaderDefine($Rp.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine($Rp.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine($Rp.SHADERDEFINE_UV1)}}}$Z($q,"laya.d3.graphics.VertexDeclaration");var $i=$q.prototype;return $i._addShaderDefine=function($i){this._shaderDefineValue|=$i},$i._removeShaderDefine=function($i){this._shaderDefineValue&=~$i},$i.getVertexElements=function(){return this._vertexElements.slice()},$i.getVertexElementByUsage=function($i){return this._vertexElementsDic[$i]},$i.unBinding=function(){},$s(0,$i,"shaderDefineValue",function(){return this._shaderDefineValue}),$s(0,$i,"id",function(){return this._id}),$s(0,$i,"vertexStride",function(){return this._vertexStride}),$s(0,$i,"shaderValues",function(){return this._shaderValues}),$q._getTypeSize=function($i){switch($i){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},$q.getVertexStride=function($i){for(var $p=0,$F=0;$F<$i.Length;$F++){var $J=$i[$F],$A=$J.offset+$q._getTypeSize($J.elementFormat);$p<$A&&($p=$A)}return $p},$q._maxVertexDeclarationBit=1e3,$q._uniqueIDCounter=1,$u($q,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),$q}(),$qi=function(){function $i($i,$p,$F){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=$i,this.elementFormat=$p,this.elementUsage=$F}return $Z($i,"laya.d3.graphics.VertexElement"),$i}(),$Bi=(function(){function $i(){}$Z($i,"laya.d3.graphics.VertexElementFormat"),$i.Single="single",$i.Vector2="vector2",$i.Vector3="vector3",$i.Vector4="vector4",$i.Color="color",$i.Byte4="byte4",$i.Short2="short2",$i.Short4="short4",$i.NormalizedShort2="normalizedshort2",$i.NormalizedShort4="normalizedshort4",$i.HalfVector2="halfvector2",$i.HalfVector4="halfvector4"}(),function(){function $i(){}$Z($i,"laya.d3.graphics.VertexElementUsage"),$i.POSITION0=0,$i.COLOR0=1,$i.TEXTURECOORDINATE0=2,$i.NORMAL0=3,$i.BINORMAL0=4,$i.TANGENT0=5,$i.BLENDINDICES0=6,$i.BLENDWEIGHT0=7,$i.DEPTH0=8,$i.FOG0=9,$i.POINTSIZE0=10,$i.SAMPLE0=11,$i.TESSELLATEFACTOR0=12,$i.COLOR1=13,$i.NEXTTEXTURECOORDINATE0=14,$i.TEXTURECOORDINATE1=15,$i.NEXTTEXTURECOORDINATE1=16,$i.CORNERTEXTURECOORDINATE0=17,$i.VELOCITY0=18,$i.STARTCOLOR0=19,$i.STARTSIZE=20,$i.AGEADDSCALE0=21,$i.STARTROTATION=22,$i.ENDCOLOR0=23,$i.STARTLIFETIME=24,$i.TIME0=33,$i.SHAPEPOSITIONSTARTLIFETIME=30,$i.DIRECTIONTIME=32,$i.SIZEROTATION0=27,$i.RADIUS0=28,$i.RADIAN0=29,$i.STARTSPEED=31,$i.RANDOM0=34,$i.RANDOM1=35,$i.SIMULATIONWORLDPOSTION=36,$i.SIMULATIONWORLDROTATION=37,$i.TEXTURECOORDINATE0X=38,$i.TEXTURECOORDINATE0X1=39,$i.TEXTURECOORDINATE0Y=40,$i.OFFSETVECTOR=41}(),function(){function $i($i,$p,$F){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=$i,this._textureCoordinate0=$p,this._time=$F}$Z($i,"laya.d3.graphics.VertexGlitter");var $p=$i.prototype;$v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate0}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"time",function(){return this._time}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(24,[new $qi(0,"vector3",0),new $qi(12,"vector2",2),new $qi(20,"single",33)])}])}(),function(){function $i($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=$i,this._position=$p,this._velocity=$F,this._startColor=$J,this._endColor=$A,this._sizeRotation=$t,this._radius=$q,this._radian=$B,this._ageAddScale=$O,this._time=$U}$Z($i,"laya.d3.graphics.VertexParticle");var $p=$i.prototype;$v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"endColor",function(){return this._endColor}),$s(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$p,"sizeRotation",function(){return this._sizeRotation}),$s(0,$p,"velocity",function(){return this._velocity}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"startColor",function(){return this._startColor}),$s(0,$p,"radius",function(){return this._radius}),$s(0,$p,"radian",function(){return this._radian}),$s(0,$p,"ageAddScale",function(){return this._ageAddScale}),$s(0,$p,"time",function(){return this._time}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(116,[new $qi(0,"vector4",17),new $qi(16,"vector3",0),new $qi(28,"vector3",18),new $qi(40,"vector4",19),new $qi(56,"vector4",23),new $qi(72,"vector3",27),new $qi(84,"vector2",28),new $qi(92,"vector4",29),new $qi(108,"single",24),new $qi(112,"single",33)])}])}(),function(){function $i($i){this._position=null,this._position=$i}$Z($i,"laya.d3.graphics.VertexPosition");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(12,[new $qi(0,"vector3",0)])}]),$i}()),$Oi=function(){function $i($i,$p){this._position=null,this._normal=null,this._position=$i,this._normal=$p}$Z($i,"laya.d3.graphics.VertexPositionNormal");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(24,[new $qi(0,"vector3",0),new $qi(12,"vector3",3)])}]),$i}(),$Ui=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._color=null,this._position=$i,this._normal=$p,this._color=$F}$Z($i,"laya.d3.graphics.VertexPositionNormalColor");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(40,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1)])}]),$i}(),$di=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=$i,this._normal=$p,this._color=$F,this._blendIndex=$J,this._blendWeight=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalColorSkin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(72,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector4",7),new $qi(56,"vector4",6)])}]),$i}(),$ui=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._tangent=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(88,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector4",7),new $qi(56,"vector4",6),new $qi(72,"vector4",5)])}]),$i}(),$Si=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._tangent=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(84,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector4",7),new $qi(56,"vector4",6),new $qi(72,"vector3",5)])}]),$i}(),$Zi=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._tangent=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalColorSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(56,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector4",5)])}]),$i}(),$si=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._tangent=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(52,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector3",5)])}]),$i}(),$xi=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(48,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2)])}]),$i}(),$ji=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(56,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15)])}]),$i}(),$ri=function(){function $i($i,$p,$F,$J,$A,$t,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._blendIndex=$t,this._blendWeight=$q}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(88,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15),new $qi(56,"vector4",7),new $qi(72,"vector4",6)])}]),$i}(),$Mi=function(){function $i($i,$p,$F,$J,$A,$t,$q,$B){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._tangent=$t,this._blendIndex=$q,this._blendWeight=$B}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(104,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15),new $qi(56,"vector4",7),new $qi(72,"vector4",6),new $qi(88,"vector4",5)])}]),$i}(),$Di=function(){function $i(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalColorTexture0SkinTangent=function($i,$p,$F,$J,$A,$t,$q,$B){this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._tangent=$t,this._blendIndex=$q,this._blendWeight=$B},$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(100,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15),new $qi(56,"vector4",7),new $qi(72,"vector4",6),new $qi(88,"vector3",5)])}]),$i}(),$Ei=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._tangent=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(72,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15),new $qi(56,"vector4",5)])}]),$i}(),$vi=function(){function $i(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalColorTexture0Tangent=function($i,$p,$F,$J,$A,$t){this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._tangent=$t},$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(68,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector2",15),new $qi(56,"vector3",5)])}]),$i}(),$gi=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(80,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector4",7),new $qi(64,"vector4",6)])}]),$i}(),$ai=function(){function $i($i,$p,$F,$J,$A,$t,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J,this._tangent=$A,this._blendIndex=$t,this._blendWeight=$q}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(96,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector4",7),new $qi(64,"vector4",6),new $qi(80,"vector4",5)])}]),$i}(),$Ri=function(){function $i($i,$p,$F,$J,$A,$t,$q){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J,this._tangent=$A,this._blendIndex=$t,this._blendWeight=$q}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(92,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector4",7),new $qi(64,"vector4",6),new $qi(80,"vector3",5)])}]),$i}(),$Qi=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J,this._tangent=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(64,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector4",5)])}]),$i}(),$Pi=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=$i,this._normal=$p,this._color=$F,this._textureCoordinate=$J,this._tangent=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"color",function(){return this._color}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(60,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",1),new $qi(40,"vector2",2),new $qi(48,"vector3",5)])}]),$i}(),$Yi=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._tangent=null,this._position=$i,this._normal=$p,this._tangent=$F}$Z($i,"laya.d3.graphics.VertexPositionNormalSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(40,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector4",5)])}]),$i}(),$ci=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._tangent=null,this._position=$i,this._normal=$p,this._tangent=$F}$Z($i,"laya.d3.graphics.VertexPositionNormalTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(36,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector3",5)])}]),$i}(),$hi=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(32,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2)])}]),$i}(),$mi=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(40,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15)])}]),$i}(),$ni=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(72,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15),new $qi(40,"vector4",7),new $qi(56,"vector4",6)])}]),$i}(),$Ii=function(){function $i($i,$p,$F,$J,$A,$t,$q){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J,this._tangent=$A,this._blendIndex=$t,this._blendWeight=$q}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(88,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15),new $qi(40,"vector4",7),new $qi(56,"vector4",6),new $qi(72,"vector4",5)])}]),$i}(),$Gi=function(){function $i(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalTexture0SkinTangent=function($i,$p,$F,$J,$A,$t,$q){this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J,this._tangent=$A,this._blendIndex=$t,this._blendWeight=$q},$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(84,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15),new $qi(40,"vector4",7),new $qi(56,"vector4",6),new $qi(72,"vector3",5)])}]),$i}(),$_i=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J,this._tangent=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(56,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15),new $qi(40,"vector4",5)])}]),$i}(),$yi=function(){function $i(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}$Z($i,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$p.VertexPositionNormalTexture0Tangent=function($i,$p,$F,$J,$A){this._position=$i,this._normal=$p,this._textureCoordinate0=$F,this._textureCoordinate1=$J,this._tangent=$A},$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(52,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15),new $qi(40,"vector3",5)])}]),$i}(),$Ni=function(){function $i($i,$p,$F,$J,$A){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F,this._blendIndex=$J,this._blendWeight=$A}$Z($i,"laya.d3.graphics.VertexPositionNormalTextureSkin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(64,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector4",7),new $qi(48,"vector4",6)])}]),$i}(),$fi=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F,this._tangent=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(80,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector4",7),new $qi(48,"vector4",6),new $qi(64,"vector4",5)])}]),$i}(),$oi=function(){function $i($i,$p,$F,$J,$A,$t){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F,this._tangent=$J,this._blendIndex=$A,this._blendWeight=$t}$Z($i,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(76,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector4",7),new $qi(48,"vector4",6),new $qi(64,"vector3",5)])}]),$i}(),$Wi=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F,this._tangent=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(48,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector4",5)])}]),$i}(),$Li=function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F,this._tangent=$J}$Z($i,"laya.d3.graphics.VertexPositionNormalTextureTangent");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(44,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector3",5)])}]),$i}(),$Ci=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F}$Z($i,"laya.d3.graphics.VertexPositionNTBTexture");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(56,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector3",5),new $qi(36,"vector3",4),new $qi(48,"vector2",2)])}]),$i}(),$Ki=function(){function $i($i,$p,$F,$J,$A,$t,$q,$B){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=$i,this._normal=$p,this._textureCoordinate0=$J,this._textureCoordinate1=$A,this._tangent=$t,$F=$F,this._blendIndex=$q,this._blendWeight=$B}$Z($i,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"tangent",function(){return this._tangent}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(0,$p,"textureCoordinate1",function(){return this._textureCoordinate1}),$s(0,$p,"blendIndex",function(){return this._blendIndex}),$s(0,$p,"blendWeight",function(){return this._blendWeight}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(96,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector3",5),new $qi(36,"vector3",4),new $qi(48,"vector2",2),new $qi(56,"vector2",15),new $qi(64,"vector4",7),new $qi(80,"vector4",6)])}]),$i}(),$Vi=function(){function $i($i,$p,$F){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=$i,this._normal=$p,this._textureCoordinate=$F}$Z($i,"laya.d3.graphics.VertexPositionNTBTextureSkin");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"textureCoordinate",function(){return this._textureCoordinate}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(88,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector3",5),new $qi(36,"vector3",4),new $qi(48,"vector2",2),new $qi(56,"vector4",7),new $qi(72,"vector4",6)])}]),$i}(),$Ti=(function(){function $i($i,$p,$F,$J){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=$i,this._normal=$p,this._textureCoord0=$F,this._textureCoord1=$J}$Z($i,"laya.d3.graphics.VertexPositionTerrain");var $p=$i.prototype;$v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"normal",function(){return this._normal}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoord0",function(){return this._textureCoord0}),$s(0,$p,"textureCoord1",function(){return this._textureCoord1}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(40,[new $qi(0,"vector3",0),new $qi(12,"vector3",3),new $qi(24,"vector2",2),new $qi(32,"vector2",15)])}])}(),function(){function $i($i,$p){this._position=null,this._textureCoordinate0=null,this._position=$i,this._textureCoordinate0=$p}$Z($i,"laya.d3.graphics.VertexPositionTexture0");var $p=$i.prototype;return $v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"position",function(){return this._position}),$s(0,$p,"textureCoordinate0",function(){return this._textureCoordinate0}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(20,[new $qi(0,"vector3",0),new $qi(12,"vector2",2)])}]),$i}()),$ki=(function(){function $i($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u,$S,$Z){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$i,this._positionStartLifeTime=$p,this._velocity=$F,this._startColor=$J,this._startSize=$A,this._startRotation0=$t,this._startRotation1=$q,this._startRotation2=$B,this._startLifeTime=$O,this._time=$U,this._startSpeed=$d,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$Z}$Z($i,"laya.d3.graphics.VertexShurikenParticleBillboard");var $p=$i.prototype;$v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$p,"random1",function(){return this._randoms1}),$s(0,$p,"startRotation2",function(){return this._startRotation2}),$s(0,$p,"positionStartLifeTime",function(){return this._positionStartLifeTime}),$s(0,$p,"velocity",function(){return this._velocity}),$s(0,$p,"random0",function(){return this._randoms0}),$s(0,$p,"startSize",function(){return this._startSize}),$s(0,$p,"startColor",function(){return this._startColor}),$s(0,$p,"startRotation0",function(){return this._startRotation0}),$s(0,$p,"startRotation1",function(){return this._startRotation1}),$s(0,$p,"startLifeTime",function(){return this._startLifeTime}),$s(0,$p,"time",function(){return this._time}),$s(0,$p,"startSpeed",function(){return this._startSpeed}),$s(0,$p,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(152,[new $qi(0,"vector4",17),new $qi(16,"vector4",30),new $qi(32,"vector4",32),new $qi(48,"vector4",19),new $qi(64,"vector3",20),new $qi(76,"vector3",22),new $qi(88,"single",31),new $qi(92,"vector4",34),new $qi(108,"vector4",35),new $qi(124,"vector3",36),new $qi(136,"vector4",37)])}])}(),function(){function $i($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u,$S,$Z){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=$i,this._positionStartLifeTime=$p,this._velocity=$F,this._startColor=$J,this._startSize=$A,this._startRotation0=$t,this._startRotation1=$q,this._startRotation2=$B,this._startLifeTime=$O,this._time=$U,this._startSpeed=$d,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=$Z}$Z($i,"laya.d3.graphics.VertexShurikenParticleMesh");var $p=$i.prototype;$v.imps($p,{"laya.d3.graphics.IVertex":!0}),$s(0,$p,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),$s(0,$p,"velocity",function(){return this._velocity}),$s(0,$p,"position",function(){return this._positionStartLifeTime}),$s(0,$p,"random0",function(){return this._randoms0}),$s(0,$p,"startSize",function(){return this._startSize}),$s(0,$p,"startColor",function(){return this._startColor}),$s(0,$p,"startRotation0",function(){return this._startRotation0}),$s(0,$p,"startRotation1",function(){return this._startRotation1}),$s(0,$p,"random1",function(){return this._randoms1}),$s(0,$p,"startRotation2",function(){return this._startRotation2}),$s(0,$p,"startLifeTime",function(){return this._startLifeTime}),$s(0,$p,"time",function(){return this._time}),$s(0,$p,"startSpeed",function(){return this._startSpeed}),$s(0,$p,"simulationWorldPostion",function(){return this._simulationWorldPostion}),$s(0,$p,"vertexDeclaration",function(){return $i._vertexDeclaration}),$s(1,$i,"vertexDeclaration",function(){return $i._vertexDeclaration}),$u($i,["_vertexDeclaration",function(){return this._vertexDeclaration=new $ti(172,[new $qi(0,"vector3",0),new $qi(12,"vector4",1),new $qi(28,"vector2",2),new $qi(36,"vector4",30),new $qi(52,"vector4",32),new $qi(68,"vector4",19),new $qi(84,"vector3",20),new $qi(96,"vector3",22),new $qi(108,"single",31),new $qi(112,"vector4",34),new $qi(128,"vector4",35),new $qi(144,"vector3",36),new $qi(156,"vector4",37)])}])}(),function(){function $D($i,$p,$F,$J,$A,$t){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=$F,this._materials=$J,this._subMeshes=$A,this._materialMap=$t,this._version=$p,this._onLoaded($i)}$Z($D,"laya.d3.loaders.LoadModelV01");var $i=$D.prototype;return $i._onLoaded=function($i){this._readData=$i,this.READ_BLOCK();for(var $p=0;$p<this._BLOCK.count;$p++){var $F=this._readData.getUint16(),$J=this._strings[$F],$A=this["READ_"+$J];if(null==$A)throw new Error("model file err,no this function:"+$F+" "+$J);if(!$A.call(this))break}return this._mesh},$i.onError=function(){},$i._readString=function(){return this._strings[this._readData.getUint16()]},$i.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},$i.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},$i.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var $i=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var $p=0;$p<this._STRINGS.size;$p++)this._strings[$p]=this._readData.readUTFString();return this._readData.pos=$i,!0},$i.READ_MATERIAL=function(){var $i=this._readData.getUint16(),$p=(this._readString(),this._readString());return this._materials[$i]="null"!==$p?$r.getRes(this._materialMap[$p]):new $cp,!0},$i.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var $i,$p=this._readData.__getBuffer(),$F=0,$J=this._readData.getUint32(),$A=this._readData.getUint32(),$t=(new Float32Array($p.slice($J+this._DATA.offset,$J+this._DATA.offset+$A)),this._readData.getUint32()),$q=this._readData.getUint32(),$B=new Float32Array($p.slice($t+this._DATA.offset,$t+this._DATA.offset+$q));for(this.mesh._inverseBindPoses=[],$F=0,$i=$B.length;$F<$i;$F+=16){var $O=new $ip($B[$F+0],$B[$F+1],$B[$F+2],$B[$F+3],$B[$F+4],$B[$F+5],$B[$F+6],$B[$F+7],$B[$F+8],$B[$F+9],$B[$F+10],$B[$F+11],$B[$F+12],$B[$F+13],$B[$F+14],$B[$F+15]);this.mesh._inverseBindPoses.push($O)}break;default:throw new Error("LoadModel:unknown version.")}return!0},$i.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var $i=this._readString();this._shaderAttributes=$i.match($D._attrReg);var $p=this._readData.getUint32(),$F=this._readData.getUint32(),$J=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),$A=this._readData.getUint32(),$t=this._readData.getUint32(),$q=this._readData.getUint32(),$B=this._readData.__getBuffer(),$O=new $Up(this._mesh),$U=this._getVertexDeclaration(),$d=$op.create($U,$A/$U.vertexStride,35044,!0),$u=$J+this._DATA.offset,$S=$B.slice($u,$u+$A);$d.setData(new Float32Array($S));for(var $Z=($O._vertexBuffer=$d).vertexDeclaration.getVertexElements(),$s=0;$s<$Z.length;$s++)$O._bufferUsage[$Z[$s].elementUsage]=$d;var $x=$fp.create("ushort",$F/2,35044,!0),$j=$p+this._DATA.offset,$r=$B.slice($j,$j+$F);$x.setData(new Uint16Array($r)),$O._indexBuffer=$x;var $M=$B.slice($t+this._DATA.offset,$t+this._DATA.offset+$q);return $O._boneIndicesList[0]=new Uint8Array($M),this._subMeshes.push($O),!0},$i.READ_DATAAREA=function(){return!1},$i._getVertexDeclaration=function(){for(var $i,$p=!1,$F=!1,$J=!1,$A=!1,$t=!1,$q=!1,$B=!1,$O=!1,$U=!1,$d=0;$d<this._shaderAttributes.length;$d+=8)switch(this._shaderAttributes[$d]){case"POSITION":$p=!0;break;case"NORMAL":$F=!0;break;case"COLOR":$J=!0;break;case"UV":$A=!0;break;case"UV1":$t=!0;break;case"BLENDWEIGHT":$B=!0;break;case"BLENDINDICES":$O=!0;break;case"TANGENT":$q=!0;break;case"BINORMAL":$U=!0}return $p&&$F&&$J&&$A&&$t&&$B&&$O&&$q?$i=$Di.vertexDeclaration:$p&&$F&&$J&&$A&&$t&&$B&&$O?$i=$ri.vertexDeclaration:$p&&$F&&$A&&$t&&$B&&$O&&$q?$i=$Gi.vertexDeclaration:$p&&$F&&$A&&$t&&$B&&$O?$i=$ni.vertexDeclaration:$p&&$F&&$J&&$A&&$B&&$O&&$q?$i=$Ri.vertexDeclaration:$p&&$F&&$J&&$A&&$B&&$O?$i=$gi.vertexDeclaration:$p&&$F&&$q&&$U&&$A&&$B&&$O?$i=$Vi.vertexDeclaration:$p&&$F&&$A&&$B&&$O&&$q?$i=$oi.vertexDeclaration:$p&&$F&&$A&&$B&&$O?$i=$Ni.vertexDeclaration:$p&&$F&&$J&&$B&&$O&&$q?$i=$Si.vertexDeclaration:$p&&$F&&$J&&$B&&$O?$i=$di.vertexDeclaration:$p&&$F&&$J&&$A&&$t&&$q?$i=$vi.vertexDeclaration:$p&&$F&&$J&&$A&&$t?$i=$ji.vertexDeclaration:$p&&$F&&$A&&$t&&$q?$i=$yi.vertexDeclaration:$p&&$F&&$A&&$t?$i=$mi.vertexDeclaration:$p&&$F&&$J&&$A&&$q?$i=$Pi.vertexDeclaration:$p&&$F&&$A&&$q&&$U?$i=$Ci.vertexDeclaration:$p&&$F&&$J&&$A?$i=$xi.vertexDeclaration:$p&&$F&&$A&&$q?$i=$Li.vertexDeclaration:$p&&$F&&$A?$i=$hi.vertexDeclaration:$p&&$F&&$J&&$q?$i=$si.vertexDeclaration:$p&&$F&&$J&&($i=$Ui.vertexDeclaration),$i},$s(0,$i,"mesh",function(){return this._mesh}),$D._attrReg=new RegExp("(\\w+)|([:,;])","g"),$D}()),$wi=function(){function $a(){}return $Z($a,"laya.d3.loaders.LoadModelV02"),$a.parse=function($i,$p,$F,$J,$A,$t){$a._mesh=$F,$a._materials=$J,$a._subMeshes=$A,$a._materialMap=$t,$a._version=$p,$a._readData=$i,$a.READ_DATA(),$a.READ_BLOCK(),$a.READ_STRINGS();for(var $q=0,$B=$a._BLOCK.count;$q<$B;$q++){$a._readData.pos=$a._BLOCK.blockStarts[$q];var $O=$a._readData.getUint16(),$U=$a._strings[$O],$d=$a["READ_"+$U];if(null==$d)throw new Error("model file err,no this function:"+$O+" "+$U);$d.call()}$a._strings.length=0,$a._readData=null,$a._version=null,$a._mesh=null,$a._materials=null,$a._subMeshes=null,$a._materialMap=null},$a._readString=function(){return $a._strings[$a._readData.getUint16()]},$a.READ_DATA=function(){$a._DATA.offset=$a._readData.getUint32(),$a._DATA.size=$a._readData.getUint32()},$a.READ_BLOCK=function(){for(var $i=$a._BLOCK.count=$a._readData.getUint16(),$p=$a._BLOCK.blockStarts=[],$F=$a._BLOCK.blockLengths=[],$J=0;$J<$i;$J++)$p.push($a._readData.getUint32()),$F.push($a._readData.getUint32())},$a.READ_STRINGS=function(){var $i=$a._readData.getUint32(),$p=$a._readData.getUint16(),$F=$a._readData.pos;$a._readData.pos=$i+$a._DATA.offset;for(var $J=0;$J<$p;$J++)$a._strings[$J]=$a._readData.readUTFString();$a._readData.pos=$F},$a.READ_MATERIAL=function(){$a._readString(),$a._readString();var $i=$a._readString();return""!==$i&&$a._materials.push($r.getRes($a._materialMap[$i])),!0},$a.READ_MESH=function(){$a._readString();var $i,$p=$a._readData.__getBuffer(),$F=0,$J=$a._readData.getInt16(),$A=$a._DATA.offset;for($F=0;$F<$J;$F++){var $t=$A+$a._readData.getUint32(),$q=$a._readData.getUint32(),$B=new Float32Array($p.slice($t,$t+$q)),$O=$a._readString().match($a._attrReg),$U=$a._getVertexDeclaration($O),$d=$op.create($U,4*$B.length/$U.vertexStride,35044,!0);$d.setData($B),$a._mesh._vertexBuffers.push($d)}var $u=$A+$a._readData.getUint32(),$S=$a._readData.getUint32(),$Z=new Uint16Array($p.slice($u,$u+$S)),$s=$fp.create("ushort",$S/2,35044,!0);$s.setData($Z),$a._mesh._indexBuffer=$s;var $x=$a._mesh._boneNames=[],$j=$a._readData.getUint16();for($x.length=$j,$F=0;$F<$j;$F++)$x[$F]=$a._strings[$a._readData.getUint16()];var $r=$a._readData.getUint32(),$M=$a._readData.getUint32(),$D=(new Float32Array($p.slice($A+$r,$A+$r+$M)),$a._readData.getUint32()),$E=$a._readData.getUint32(),$v=new Float32Array($p.slice($A+$D,$A+$D+$E));for($a._mesh._inverseBindPoses=[],$F=0,$i=$v.length;$F<$i;$F+=16){var $g=new $ip($v[$F+0],$v[$F+1],$v[$F+2],$v[$F+3],$v[$F+4],$v[$F+5],$v[$F+6],$v[$F+7],$v[$F+8],$v[$F+9],$v[$F+10],$v[$F+11],$v[$F+12],$v[$F+13],$v[$F+14],$v[$F+15]);$a._mesh._inverseBindPoses.push($g)}return $a._mesh._skinnedDatas=new Float32Array(16*$v.length),!0},$a.READ_SUBMESH=function(){var $i=$a._readData.__getBuffer(),$p=new $Up($a._mesh),$F=$a._readData.getInt16(),$J=$a._readData.getUint32(),$A=$a._readData.getUint32();$p._vertexBuffer=$a._mesh._vertexBuffers[$F],$p._vertexStart=$J,$p._vertexCount=$A;var $t=$a._readData.getUint32(),$q=$a._readData.getUint32(),$B=$a._mesh._indexBuffer;$p._indexBuffer=$B,$p._indexStart=$t,$p._indexCount=$q,$p._indices=new Uint16Array($B.getData().buffer,2*$t,$q);var $O=$a._DATA.offset,$U=$p._subIndexBufferStart,$d=$p._subIndexBufferCount,$u=$p._boneIndicesList,$S=$a._readData.getUint16();$U.length=$S,$d.length=$S,$u.length=$S;for(var $Z=0;$Z<$S;$Z++){$U[$Z]=$a._readData.getUint32(),$d[$Z]=$a._readData.getUint32();var $s=$a._readData.getUint32(),$x=$a._readData.getUint32();$p._boneIndicesList[$Z]=new Uint8Array($i.slice($O+$s,$O+$s+$x))}return $a._subMeshes.push($p),!0},$a._getVertexDeclaration=function($i){for(var $p,$F=!1,$J=!1,$A=!1,$t=!1,$q=!1,$B=!1,$O=!1,$U=!1,$d=!1,$u=0;$u<$i.length;$u++)switch($i[$u]){case"POSITION":$F=!0;break;case"NORMAL":$J=!0;break;case"COLOR":$A=!0;break;case"UV":$t=!0;break;case"UV1":$q=!0;break;case"BLENDWEIGHT":$O=!0;break;case"BLENDINDICES":$U=!0;break;case"TANGENT":$B=!0;break;case"BINORMAL":$d=!0}return $F&&$J&&$A&&$t&&$q&&$O&&$U&&$B?$p=$Di.vertexDeclaration:$F&&$J&&$A&&$t&&$q&&$O&&$U?$p=$ri.vertexDeclaration:$F&&$J&&$t&&$q&&$O&&$U&&$B?$p=$Gi.vertexDeclaration:$F&&$J&&$t&&$q&&$O&&$U?$p=$ni.vertexDeclaration:$F&&$J&&$A&&$t&&$O&&$U&&$B?$p=$Ri.vertexDeclaration:$F&&$J&&$A&&$t&&$O&&$U?$p=$gi.vertexDeclaration:$F&&$J&&$t&&$O&&$U&&$B?$p=$oi.vertexDeclaration:$F&&$J&&$t&&$O&&$U?$p=$Ni.vertexDeclaration:$F&&$J&&$A&&$O&&$U&&$B?$p=$Si.vertexDeclaration:$F&&$J&&$A&&$O&&$U?$p=$di.vertexDeclaration:$F&&$J&&$A&&$t&&$q&&$B?$p=$vi.vertexDeclaration:$F&&$J&&$A&&$t&&$q?$p=$ji.vertexDeclaration:$F&&$J&&$t&&$q&&$B?$p=$yi.vertexDeclaration:$F&&$J&&$t&&$q?$p=$mi.vertexDeclaration:$F&&$J&&$A&&$t&&$B?$p=$Pi.vertexDeclaration:$F&&$J&&$t&&$B&&$d?$p=$Ci.vertexDeclaration:$F&&$J&&$A&&$t?$p=$xi.vertexDeclaration:$F&&$J&&$t&&$B?$p=$Li.vertexDeclaration:$F&&$J&&$t?$p=$hi.vertexDeclaration:$F&&$J&&$A&&$B?$p=$si.vertexDeclaration:$F&&$J&&$A&&($p=$Ui.vertexDeclaration),$p},$a._attrReg=new RegExp("(\\w+)|([:,;])","g"),$a._strings=[],$a._readData=null,$a._version=null,$a._mesh=null,$a._materials=null,$a._subMeshes=null,$a._materialMap=null,$u($a,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$a}(),$$i=function(){function $g(){}return $Z($g,"laya.d3.loaders.LoadModelV03"),$g.parse=function($i,$p,$F,$J,$A){$g._mesh=$F,$g._subMeshes=$J,$g._materialMap=$A,$g._version=$p,$g._readData=$i,$g.READ_DATA(),$g.READ_BLOCK(),$g.READ_STRINGS();for(var $t=0,$q=$g._BLOCK.count;$t<$q;$t++){$g._readData.pos=$g._BLOCK.blockStarts[$t];var $B=$g._readData.getUint16(),$O=$g._strings[$B],$U=$g["READ_"+$O];if(null==$U)throw new Error("model file err,no this function:"+$B+" "+$O);$U.call()}$g._strings.length=0,$g._readData=null,$g._version=null,$g._mesh=null,$g._subMeshes=null,$g._materialMap=null},$g._readString=function(){return $g._strings[$g._readData.getUint16()]},$g.READ_DATA=function(){$g._DATA.offset=$g._readData.getUint32(),$g._DATA.size=$g._readData.getUint32()},$g.READ_BLOCK=function(){for(var $i=$g._BLOCK.count=$g._readData.getUint16(),$p=$g._BLOCK.blockStarts=[],$F=$g._BLOCK.blockLengths=[],$J=0;$J<$i;$J++)$p.push($g._readData.getUint32()),$F.push($g._readData.getUint32())},$g.READ_STRINGS=function(){var $i=$g._readData.getUint32(),$p=$g._readData.getUint16(),$F=$g._readData.pos;$g._readData.pos=$i+$g._DATA.offset;for(var $J=0;$J<$p;$J++)$g._strings[$J]=$g._readData.readUTFString();$g._readData.pos=$F},$g.READ_MESH=function(){var $i,$p=$g._readString(),$F=$g._readData.__getBuffer(),$J=0,$A=$g._readData.getInt16(),$t=$g._DATA.offset;for($J=0;$J<$A;$J++){var $q,$B=$t+$g._readData.getUint32(),$O=$g._readData.getUint32(),$U=new Float32Array($F.slice($B,$B+$O)),$d=$g._readString();switch($g._version){case"LAYAMODEL:03":$q=$g._vertexDeclarationMap_Discard[$d];break;case"LAYAMODEL:0301":$q=$g._vertexDeclarationMap[$d];break;default:throw new Error("LoadModelV03: unknown version.")}if(!$q)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+$g._version+"  bufferAttribute="+$d+"  name="+$p+"  url="+($g._mesh?$g._mesh.url:"null"));var $u=$op.create($q,4*$U.length/$q.vertexStride,35044,!0,$g._mesh._url+"_"+$J);$u.setData($U),$g._mesh._vertexBuffers.push($u)}var $S=$t+$g._readData.getUint32(),$Z=$g._readData.getUint32(),$s=new Uint16Array($F.slice($S,$S+$Z)),$x=$fp.create("ushort",$Z/2,35044,!0,$g._mesh._url);$x.setData($s),$g._mesh._indexBuffer=$x;var $j=$g._mesh._boneNames=[],$r=$g._readData.getUint16();for($j.length=$r,$J=0;$J<$r;$J++)$j[$J]=$g._strings[$g._readData.getUint16()];$g._readData.pos+=8;var $M=$g._readData.getUint32(),$D=$g._readData.getUint32(),$E=new Float32Array($F.slice($t+$M,$t+$M+$D));for($g._mesh._inverseBindPoses=[],$J=0,$i=$E.length;$J<$i;$J+=16){var $v=new $ip($E[$J+0],$E[$J+1],$E[$J+2],$E[$J+3],$E[$J+4],$E[$J+5],$E[$J+6],$E[$J+7],$E[$J+8],$E[$J+9],$E[$J+10],$E[$J+11],$E[$J+12],$E[$J+13],$E[$J+14],$E[$J+15]);$g._mesh._inverseBindPoses.push($v)}return $g._mesh._skinnedDatas=new Float32Array(16*$E.length),!0},$g.READ_SUBMESH=function(){var $i=$g._readData.__getBuffer(),$p=new $Up($g._mesh),$F=$g._readData.getInt16(),$J=$g._readData.getUint32(),$A=$g._readData.getUint32();$p._vertexBuffer=$g._mesh._vertexBuffers[$F],$p._vertexStart=$J,$p._vertexCount=$A;var $t=$g._readData.getUint32(),$q=$g._readData.getUint32(),$B=$g._mesh._indexBuffer;$p._indexBuffer=$B,$p._indexStart=$t,$p._indexCount=$q,$p._indices=new Uint16Array($B.getData().buffer,2*$t,$q);var $O=$g._DATA.offset,$U=$p._subIndexBufferStart,$d=$p._subIndexBufferCount,$u=$p._boneIndicesList,$S=$g._readData.getUint16();$U.length=$S,$d.length=$S,$u.length=$S;for(var $Z=0;$Z<$S;$Z++){$U[$Z]=$g._readData.getUint32(),$d[$Z]=$g._readData.getUint32();var $s=$g._readData.getUint32(),$x=$g._readData.getUint32();$u[$Z]=new Uint8Array($i.slice($O+$s,$O+$s+$x))}return $g._subMeshes.push($p),!0},$g._strings=[],$g._readData=null,$g._version=null,$g._mesh=null,$g._subMeshes=null,$g._materialMap=null,$u($g,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Di.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$ri.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Ki.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Gi.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$ni.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$Ri.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$gi.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$oi.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$Ni.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$Si.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$di.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$vi.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$ji.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$yi.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$mi.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$Pi.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Ci.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$xi.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Li.vertexDeclaration,"POSITION,NORMAL,UV":$hi.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$si.vertexDeclaration,"POSITION,NORMAL,COLOR":$Ui.vertexDeclaration,"POSITION,NORMAL,TANGENT":$ci.vertexDeclaration,"POSITION,NORMAL":$Oi.vertexDeclaration,"POSITION,UV":$Ti.vertexDeclaration,POSITION:$Bi.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Mi.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":$ri.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":$Ki.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":$Ii.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":$ni.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$ai.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":$gi.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":$fi.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":$Ni.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":$ui.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":$di.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":$Ei.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":$ji.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":$_i.vertexDeclaration,"POSITION,NORMAL,UV,UV1":$mi.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":$Qi.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":$Ci.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":$xi.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":$Wi.vertexDeclaration,"POSITION,NORMAL,UV":$hi.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":$Zi.vertexDeclaration,"POSITION,NORMAL,COLOR":$Ui.vertexDeclaration,"POSITION,NORMAL,TANGENT":$Yi.vertexDeclaration,"POSITION,NORMAL":$Oi.vertexDeclaration,"POSITION,UV":$Ti.vertexDeclaration,POSITION:$Bi.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$g}(),$Xi=function(){function $B(){}return $Z($B,"laya.d3.loaders.MeshReader"),$B.read=function($i,$p,$F,$J,$A){var $t=new $g($i);$t.pos=0;var $q=$t.readUTFString();switch($q){case"LAYAMODEL:01":case"LAYASKINANI:01":$B._readVersion01($t,$q,$p,$F,$J,$A);break;case"LAYAMODEL:02":$wi.parse($t,$q,$p,$F,$J,$A);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":$$i.parse($t,$q,$p,$J,$A);break;default:throw new Error("MeshReader: unknown mesh version.")}$p._setSubMeshes($J)},$B._readVersion01=function($i,$p,$F,$J,$A,$t){new $ki($i,$p,$F,$J,$A,$t)},$B}(),$ei=function(){function $i($i,$p){this.min=null,this.max=null,this.min=$i,this.max=$p}$Z($i,"laya.d3.math.BoundBox");var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.IClone":!0}),$p.getCorners=function($i){$i.length=8;var $p=this.min.elements,$F=this.max.elements,$J=$p[0],$A=$p[1],$t=$p[2],$q=$F[0],$B=$F[1],$O=$F[2];$i[0]=new $qp($J,$B,$O),$i[1]=new $qp($q,$B,$O),$i[2]=new $qp($q,$A,$O),$i[3]=new $qp($J,$A,$O),$i[4]=new $qp($J,$B,$t),$i[5]=new $qp($q,$B,$t),$i[6]=new $qp($q,$A,$t),$i[7]=new $qp($J,$A,$t)},$p.toDefault=function(){this.min.toDefault(),this.max.toDefault()},$p.cloneTo=function($i){var $p=$i;this.min.cloneTo($p.min),this.max.cloneTo($p.max)},$p.clone=function(){var $i=new this.constructor(new $qp,new $qp);return this.cloneTo($i),$i},$i.createfromPoints=function($i,$p){if(null==$i)throw new Error("points");var $F=$p.min,$J=$p.max,$A=$F.elements;$A[0]=Number.MAX_VALUE,$A[1]=Number.MAX_VALUE,$A[2]=Number.MAX_VALUE;var $t=$J.elements;$t[0]=-Number.MAX_VALUE,$t[1]=-Number.MAX_VALUE,$t[2]=-Number.MAX_VALUE;for(var $q=0,$B=$i.length;$q<$B;++$q)$qp.min($F,$i[$q],$F),$qp.max($J,$i[$q],$J)},$i.merge=function($i,$p,$F){$qp.min($i.min,$p.min,$F.min),$qp.max($i.max,$p.max,$F.max)},$i}(),$bi=function(){function $U($i){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=$i,this._near=new $pp(new $qp),this._far=new $pp(new $qp),this._left=new $pp(new $qp),this._right=new $pp(new $qp),this._top=new $pp(new $qp),this._bottom=new $pp(new $qp),$U._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}$Z($U,"laya.d3.math.BoundFrustum");var $i=$U.prototype;return $i.equalsBoundFrustum=function($i){return this._matrix.equalsOtherMatrix($i.matrix)},$i.equalsObj=function($i){if($i instanceof laya.d3.math.BoundFrustum){var $p=$i;return this.equalsBoundFrustum($p)}return!1},$i.getPlane=function($i){switch($i){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},$i.getCorners=function($i){$U._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo($i[0]),$U._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo($i[1]),$U._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo($i[2]),$U._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo($i[3]),$U._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo($i[4]),$U._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo($i[5]),$U._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo($i[6]),$U._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo($i[7])},$i.containsPoint=function($i){for(var $p=$pp.PlaneIntersectionType_Front,$F=$pp.PlaneIntersectionType_Front,$J=0;$J<6;$J++){switch($J){case 0:$F=Collision.intersectsPlaneAndPoint(this._near,$i);break;case 1:$F=Collision.intersectsPlaneAndPoint(this._far,$i);break;case 2:$F=Collision.intersectsPlaneAndPoint(this._left,$i);break;case 3:$F=Collision.intersectsPlaneAndPoint(this._right,$i);break;case 4:$F=Collision.intersectsPlaneAndPoint(this._top,$i);break;case 5:$F=Collision.intersectsPlaneAndPoint(this._bottom,$i)}switch($F){case $pp.PlaneIntersectionType_Back:return 0;case $pp.PlaneIntersectionType_Intersecting:$p=$pp.PlaneIntersectionType_Intersecting}}switch($p){case $pp.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$i.containsBoundBox=function($i){for(var $p,$F=$U._tempV30,$J=$U._tempV31,$A=1,$t=0;$t<6;$t++){if($p=this.getPlane($t),this._getBoxToPlanePVertexNVertex($i,$p.normal,$F,$J),Collision.intersectsPlaneAndPoint($p,$F)===$pp.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint($p,$J)===$pp.PlaneIntersectionType_Back&&($A=2)}return $A},$i.containsBoundSphere=function($i){for(var $p=$pp.PlaneIntersectionType_Front,$F=$pp.PlaneIntersectionType_Front,$J=0;$J<6;$J++){switch($J){case 0:$F=Collision.intersectsPlaneAndSphere(this._near,$i);break;case 1:$F=Collision.intersectsPlaneAndSphere(this._far,$i);break;case 2:$F=Collision.intersectsPlaneAndSphere(this._left,$i);break;case 3:$F=Collision.intersectsPlaneAndSphere(this._right,$i);break;case 4:$F=Collision.intersectsPlaneAndSphere(this._top,$i);break;case 5:$F=Collision.intersectsPlaneAndSphere(this._bottom,$i)}switch($F){case $pp.PlaneIntersectionType_Back:return 0;case $pp.PlaneIntersectionType_Intersecting:$p=$pp.PlaneIntersectionType_Intersecting}}switch($p){case $pp.PlaneIntersectionType_Intersecting:return 2;default:return 1}},$i._getBoxToPlanePVertexNVertex=function($i,$p,$F,$J){var $A=$i.min,$t=$A.elements,$q=$i.max,$B=$q.elements,$O=$p.elements,$U=$O[0],$d=$O[1],$u=$O[2];$A.cloneTo($F);var $S=$F.elements;0<=$U&&($S[0]=$B[0]),0<=$d&&($S[1]=$B[1]),0<=$u&&($S[2]=$B[2]),$q.cloneTo($J);var $Z=$J.elements;0<=$U&&($Z[0]=$t[0]),0<=$d&&($Z[1]=$t[1]),0<=$u&&($Z[2]=$t[2])},$s(0,$i,"top",function(){return this._top}),$s(0,$i,"matrix",function(){return this._matrix},function($i){this._matrix=$i,$U._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),$s(0,$i,"near",function(){return this._near}),$s(0,$i,"far",function(){return this._far}),$s(0,$i,"left",function(){return this._left}),$s(0,$i,"right",function(){return this._right}),$s(0,$i,"bottom",function(){return this._bottom}),$U._getPlanesFromMatrix=function($i,$p,$F,$J,$A,$t,$q){var $B=$i.elements,$O=$B[0],$U=$B[1],$d=$B[2],$u=$B[3],$S=$B[4],$Z=$B[5],$s=$B[6],$x=$B[7],$j=$B[8],$r=$B[9],$M=$B[10],$D=$B[11],$E=$B[12],$v=$B[13],$g=$B[14],$a=$B[15],$R=$p.normal.elements;$R[0]=$u+$d,$R[1]=$x+$s,$R[2]=$D+$M,$p.distance=$a+$g,$p.normalize();var $Q=$F.normal.elements;$Q[0]=$u-$d,$Q[1]=$x-$s,$Q[2]=$D-$M,$F.distance=$a-$g,$F.normalize();var $P=$J.normal.elements;$P[0]=$u+$O,$P[1]=$x+$S,$P[2]=$D+$j,$J.distance=$a+$E,$J.normalize();var $Y=$A.normal.elements;$Y[0]=$u-$O,$Y[1]=$x-$S,$Y[2]=$D-$j,$A.distance=$a-$E,$A.normalize();var $c=$t.normal.elements;$c[0]=$u-$U,$c[1]=$x-$Z,$c[2]=$D-$r,$t.distance=$a-$v,$t.normalize();var $h=$q.normal.elements;$h[0]=$u+$U,$h[1]=$x+$Z,$h[2]=$D+$r,$q.distance=$a+$v,$q.normalize()},$U._get3PlaneInterPoint=function($i,$p,$F){var $J=$i.normal,$A=$p.normal,$t=$F.normal;$qp.cross($A,$t,$U._tempV30),$qp.cross($t,$J,$U._tempV31),$qp.cross($J,$A,$U._tempV32);var $q=$qp.dot($J,$U._tempV30),$B=$qp.dot($A,$U._tempV31),$O=$qp.dot($t,$U._tempV32);return $qp.scale($U._tempV30,-$i.distance/$q,$U._tempV33),$qp.scale($U._tempV31,-$p.distance/$B,$U._tempV34),$qp.scale($U._tempV32,-$F.distance/$O,$U._tempV35),$qp.add($U._tempV33,$U._tempV34,$U._tempV36),$qp.add($U._tempV35,$U._tempV36,$U._tempV37),$U._tempV37},$u($U,["_tempV30",function(){return this._tempV30=new $qp},"_tempV31",function(){return this._tempV31=new $qp},"_tempV32",function(){return this._tempV32=new $qp},"_tempV33",function(){return this._tempV33=new $qp},"_tempV34",function(){return this._tempV34=new $qp},"_tempV35",function(){return this._tempV35=new $qp},"_tempV36",function(){return this._tempV36=new $qp},"_tempV37",function(){return this._tempV37=new $qp}]),$U}(),$zi=function(){function $d($i,$p){this.center=null,this.radius=NaN,this.center=$i,this.radius=$p}$Z($d,"laya.d3.math.BoundSphere");var $i=$d.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.toDefault=function(){this.center.toDefault(),this.radius=0},$i.intersectsRayDistance=function($i){return Collision.intersectsRayAndSphereRD($i,this)},$i.intersectsRayPoint=function($i,$p){return Collision.intersectsRayAndSphereRP($i,this,$p)},$i.cloneTo=function($i){var $p=$i;this.center.cloneTo($p.center),$p.radius=this.radius},$i.clone=function(){var $i=new this.constructor(new $qp,new $qp);return this.cloneTo($i),$i},$d.createFromSubPoints=function($i,$p,$F,$J){if(null==$i)throw new Error("points");if($p<0||$p>=$i.length)throw new Error("start"+$p+"Must be in the range [0, "+($i.length-1)+"]");if($F<0||$p+$F>$i.length)throw new Error("count"+$F+"Must be in the range <= "+$i.length+"}");var $A=$p+$F,$t=$d._tempVector3;$t.elements[0]=0,$t.elements[1]=0,$t.elements[2]=0;for(var $q=$p;$q<$A;++$q)$qp.add($i[$q],$t,$t);var $B=$J.center;$qp.scale($t,1/$F,$B);var $O=0;for($q=$p;$q<$A;++$q){var $U=$qp.distanceSquared($B,$i[$q]);$O<$U&&($O=$U)}$J.radius=Math.sqrt($O)},$d.createfromPoints=function($i,$p){if(null==$i)throw new Error("points");$d.createFromSubPoints($i,0,$i.length,$p)},$u($d,["_tempVector3",function(){return this._tempVector3=new $qp}]),$d}(),$li=(function(){function $i(){}$Z($i,"laya.d3.math.ContainmentType"),$i.Disjoint=0,$i.Contains=1,$i.Intersects=2}(),function(){function $F(){}return $Z($F,"laya.d3.math.MathUtils3D"),$F.isZero=function($i){return Math.abs($i)<$F.zeroTolerance},$F.nearEqual=function($i,$p){return!!$F.isZero($i-$p)},$F.fastInvSqrt=function($i){return $F.isZero($i)?$i:1/Math.sqrt($i)},$u($F,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),$F}()),$Hi=function(){function $O(){var $i=this.elements=new Float32Array(9);$i[0]=1,$i[1]=0,$i[2]=0,$i[3]=0,$i[4]=1,$i[5]=0,$i[6]=0,$i[7]=0,$i[8]=1}$Z($O,"laya.d3.math.Matrix3x3");var $i=$O.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.determinant=function(){var $i=this.elements,$p=$i[0],$F=$i[1],$J=$i[2],$A=$i[3],$t=$i[4],$q=$i[5],$B=$i[6],$O=$i[7],$U=$i[8];return $p*($U*$t-$q*$O)+$F*(-$U*$A+$q*$B)+$J*($O*$A-$t*$B)},$i.translate=function($i,$p){var $F=$p.elements,$J=this.elements,$A=$i.elements,$t=$J[0],$q=$J[1],$B=$J[2],$O=$J[3],$U=$J[4],$d=$J[5],$u=$J[6],$S=$J[7],$Z=$J[8],$s=$A[0],$x=$A[1];$F[0]=$t,$F[1]=$q,$F[2]=$B,$F[3]=$O,$F[4]=$U,$F[5]=$d,$F[6]=$s*$t+$x*$O+$u,$F[7]=$s*$q+$x*$U+$S,$F[8]=$s*$B+$x*$d+$Z},$i.rotate=function($i,$p){var $F=$p.elements,$J=this.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=$J[4],$U=$J[5],$d=$J[6],$u=$J[7],$S=$J[8],$Z=Math.sin($i),$s=Math.cos($i);$F[0]=$s*$A+$Z*$B,$F[1]=$s*$t+$Z*$O,$F[2]=$s*$q+$Z*$U,$F[3]=$s*$B-$Z*$A,$F[4]=$s*$O-$Z*$t,$F[5]=$s*$U-$Z*$q,$F[6]=$d,$F[7]=$u,$F[8]=$S},$i.scale=function($i,$p){var $F=$p.elements,$J=this.elements,$A=$i.elements,$t=$A[0],$q=$A[1];$F[0]=$t*$J[0],$F[1]=$t*$J[1],$F[2]=$t*$J[2],$F[3]=$q*$J[3],$F[4]=$q*$J[4],$F[5]=$q*$J[5],$F[6]=$J[6],$F[7]=$J[7],$F[8]=$J[8]},$i.invert=function($i){var $p=$i.elements,$F=this.elements,$J=$F[0],$A=$F[1],$t=$F[2],$q=$F[3],$B=$F[4],$O=$F[5],$U=$F[6],$d=$F[7],$u=$F[8],$S=$u*$B-$O*$d,$Z=-$u*$q+$O*$U,$s=$d*$q-$B*$U,$x=$J*$S+$A*$Z+$t*$s;$x||($i=null),$x=1/$x,$p[0]=$S*$x,$p[1]=(-$u*$A+$t*$d)*$x,$p[2]=($O*$A-$t*$B)*$x,$p[3]=$Z*$x,$p[4]=($u*$J-$t*$U)*$x,$p[5]=(-$O*$J+$t*$q)*$x,$p[6]=$s*$x,$p[7]=(-$d*$J+$A*$U)*$x,$p[8]=($B*$J-$A*$q)*$x},$i.transpose=function($i){var $p=$i.elements,$F=this.elements;if($i===this){var $J=$F[1],$A=$F[2],$t=$F[5];$p[1]=$F[3],$p[2]=$F[6],$p[3]=$J,$p[5]=$F[7],$p[6]=$A,$p[7]=$t}else $p[0]=$F[0],$p[1]=$F[3],$p[2]=$F[6],$p[3]=$F[1],$p[4]=$F[4],$p[5]=$F[7],$p[6]=$F[2],$p[7]=$F[5],$p[8]=$F[8]},$i.identity=function(){var $i=this.elements;$i[0]=1,$i[1]=0,$i[2]=0,$i[3]=0,$i[4]=1,$i[5]=0,$i[6]=0,$i[7]=0,$i[8]=1},$i.cloneTo=function($i){var $p,$F,$J;if(($F=this.elements)!==($J=$i.elements))for($p=0;$p<9;++$p)$J[$p]=$F[$p]},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$O.createFromTranslation=function($i,$p){$p.elements;var $F=$i.elements;$p[0]=1,$p[1]=0,$p[2]=0,$p[3]=0,$p[4]=1,$p[5]=0,$p[6]=$F[0],$p[7]=$F[1],$p[8]=1},$O.createFromRotation=function($i,$p){var $F=$p.elements,$J=Math.sin($i),$A=Math.cos($i);$F[0]=$A,$F[1]=$J,$F[2]=0,$F[3]=-$J,$F[4]=$A,$F[5]=0,$F[6]=0,$F[7]=0,$F[8]=1},$O.createFromScaling=function($i,$p){var $F=$p.elements,$J=$i.elements;$F[0]=$J[0],$F[1]=0,$F[2]=0,$F[3]=0,$F[4]=$J[1],$F[5]=0,$F[6]=0,$F[7]=0,$F[8]=1},$O.createFromMatrix4x4=function($i,$p){$p[0]=$i[0],$p[1]=$i[1],$p[2]=$i[2],$p[3]=$i[4],$p[4]=$i[5],$p[5]=$i[6],$p[6]=$i[8],$p[7]=$i[9],$p[8]=$i[10]},$O.multiply=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements,$q=$A[0],$B=$A[1],$O=$A[2],$U=$A[3],$d=$A[4],$u=$A[5],$S=$A[6],$Z=$A[7],$s=$A[8],$x=$t[0],$j=$t[1],$r=$t[2],$M=$t[3],$D=$t[4],$E=$t[5],$v=$t[6],$g=$t[7],$a=$t[8];$J[0]=$x*$q+$j*$U+$r*$S,$J[1]=$x*$B+$j*$d+$r*$Z,$J[2]=$x*$O+$j*$u+$r*$s,$J[3]=$M*$q+$D*$U+$E*$S,$J[4]=$M*$B+$D*$d+$E*$Z,$J[5]=$M*$O+$D*$u+$E*$s,$J[6]=$v*$q+$g*$U+$a*$S,$J[7]=$v*$B+$g*$d+$a*$Z,$J[8]=$v*$O+$g*$u+$a*$s},$O.lookAt=function($i,$p,$F,$J){$qp.subtract($i,$p,$O._tempV30),$qp.normalize($O._tempV30,$O._tempV30),$qp.cross($F,$O._tempV30,$O._tempV31),$qp.normalize($O._tempV31,$O._tempV31),$qp.cross($O._tempV30,$O._tempV31,$O._tempV32);var $A=$O._tempV30.elements,$t=$O._tempV31.elements,$q=$O._tempV32.elements,$B=$J.elements;$B[0]=$t[0],$B[3]=$t[1],$B[6]=$t[2],$B[1]=$q[0],$B[4]=$q[1],$B[7]=$q[2],$B[2]=$A[0],$B[5]=$A[1],$B[8]=$A[2]},$O.DEFAULT=new $O,$u($O,["_tempV30",function(){return this._tempV30=new $qp},"_tempV31",function(){return this._tempV31=new $qp},"_tempV32",function(){return this._tempV32=new $qp}]),$O}(),$ip=function(){function $Q($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u,$S,$Z,$s,$x){void 0===$i&&($i=1),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$t&&($t=1),void 0===$q&&($q=0),void 0===$B&&($B=0),void 0===$O&&($O=0),void 0===$U&&($U=0),void 0===$d&&($d=1),void 0===$u&&($u=0),void 0===$S&&($S=0),void 0===$Z&&($Z=0),void 0===$s&&($s=0),void 0===$x&&($x=1);var $j=this.elements=new Float32Array(16);$j[0]=$i,$j[1]=$p,$j[2]=$F,$j[3]=$J,$j[4]=$A,$j[5]=$t,$j[6]=$q,$j[7]=$B,$j[8]=$O,$j[9]=$U,$j[10]=$d,$j[11]=$u,$j[12]=$S,$j[13]=$Z,$j[14]=$s,$j[15]=$x}$Z($Q,"laya.d3.math.Matrix4x4");var $i=$Q.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.getElementByRowColumn=function($i,$p){if($i<0||3<$i)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($p<0||3<$p)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*$i+$p]},$i.setElementByRowColumn=function($i,$p,$F){if($i<0||3<$i)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if($p<0||3<$p)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*$i+$p]=$F},$i.equalsOtherMatrix=function($i){var $p=this.elements,$F=$i.elements;return $li.nearEqual($p[0],$F[0])&&$li.nearEqual($p[1],$F[1])&&$li.nearEqual($p[2],$F[2])&&$li.nearEqual($p[3],$F[3])&&$li.nearEqual($p[4],$F[4])&&$li.nearEqual($p[5],$F[5])&&$li.nearEqual($p[6],$F[6])&&$li.nearEqual($p[7],$F[7])&&$li.nearEqual($p[8],$F[8])&&$li.nearEqual($p[9],$F[9])&&$li.nearEqual($p[10],$F[10])&&$li.nearEqual($p[11],$F[11])&&$li.nearEqual($p[12],$F[12])&&$li.nearEqual($p[13],$F[13])&&$li.nearEqual($p[14],$F[14])&&$li.nearEqual($p[15],$F[15])},$i.decomposeTransRotScale=function($i,$p,$F){var $J=$Q._tempMatrix4x4;return this.decomposeTransRotMatScale($i,$J,$F)?($Fp.createFromMatrix4x4($J,$p),!0):($p.identity(),!1)},$i.decomposeTransRotMatScale=function($i,$p,$F){var $J=this.elements,$A=$i.elements,$t=$p.elements,$q=$F.elements;$A[0]=$J[12],$A[1]=$J[13],$A[2]=$J[14];var $B=$J[0],$O=$J[1],$U=$J[2],$d=$J[4],$u=$J[5],$S=$J[6],$Z=$J[8],$s=$J[9],$x=$J[10],$j=$q[0]=Math.sqrt($B*$B+$O*$O+$U*$U),$r=$q[1]=Math.sqrt($d*$d+$u*$u+$S*$S),$M=$q[2]=Math.sqrt($Z*$Z+$s*$s+$x*$x);if($li.isZero($j)||$li.isZero($r)||$li.isZero($M))return $t[1]=$t[2]=$t[3]=$t[4]=$t[6]=$t[7]=$t[8]=$t[9]=$t[11]=$t[12]=$t[13]=$t[14]=0,$t[0]=$t[5]=$t[10]=$t[15]=1,!1;var $D=$Q._tempVector0,$E=$D.elements;$E[0]=$Z/$M,$E[1]=$s/$M,$E[2]=$x/$M;var $v=$Q._tempVector1,$g=$v.elements;$g[0]=$B/$j,$g[1]=$O/$j,$g[2]=$U/$j;var $a=$Q._tempVector2;$qp.cross($D,$v,$a);var $R=$Q._tempVector1;return $qp.cross($a,$D,$R),$t[3]=$t[7]=$t[11]=$t[12]=$t[13]=$t[14]=0,$t[15]=1,$t[0]=$R.x,$t[1]=$R.y,$t[2]=$R.z,$t[4]=$a.x,$t[5]=$a.y,$t[6]=$a.z,$t[8]=$D.x,$t[9]=$D.y,$t[10]=$D.z,$t[0]*$B+$t[1]*$O+$t[2]*$U<0&&($q[0]=-$j),$t[4]*$d+$t[5]*$u+$t[6]*$S<0&&($q[1]=-$r),$t[8]*$Z+$t[9]*$s+$t[10]*$x<0&&($q[2]=-$M),!0},$i.decomposeYawPitchRoll=function($i){var $p=$i.elements,$F=Math.asin(-this.elements[9]);$p[1]=$F,Math.cos($F)>$li.zeroTolerance?($p[2]=Math.atan2(this.elements[1],this.elements[5]),$p[0]=Math.atan2(this.elements[8],this.elements[10])):($p[2]=Math.atan2(-this.elements[4],this.elements[0]),$p[0]=0)},$i.normalize=function(){var $i=this.elements,$p=$i[0],$F=$i[1],$J=$i[2],$A=Math.sqrt($p*$p+$F*$F+$J*$J);if(!$A)return $i[0]=0,$i[1]=0,void($i[2]=0);1!=$A&&($A=1/$A,$i[0]=$p*$A,$i[1]=$F*$A,$i[2]=$J*$A)},$i.transpose=function(){var $i,$p;return $p=($i=this.elements)[1],$i[1]=$i[4],$i[4]=$p,$p=$i[2],$i[2]=$i[8],$i[8]=$p,$p=$i[3],$i[3]=$i[12],$i[12]=$p,$p=$i[6],$i[6]=$i[9],$i[9]=$p,$p=$i[7],$i[7]=$i[13],$i[13]=$p,$p=$i[11],$i[11]=$i[14],$i[14]=$p,this},$i.invert=function($i){var $p=this.elements,$F=$i.elements,$J=$p[0],$A=$p[1],$t=$p[2],$q=$p[3],$B=$p[4],$O=$p[5],$U=$p[6],$d=$p[7],$u=$p[8],$S=$p[9],$Z=$p[10],$s=$p[11],$x=$p[12],$j=$p[13],$r=$p[14],$M=$p[15],$D=$J*$O-$A*$B,$E=$J*$U-$t*$B,$v=$J*$d-$q*$B,$g=$A*$U-$t*$O,$a=$A*$d-$q*$O,$R=$t*$d-$q*$U,$Q=$u*$j-$S*$x,$P=$u*$r-$Z*$x,$Y=$u*$M-$s*$x,$c=$S*$r-$Z*$j,$h=$S*$M-$s*$j,$m=$Z*$M-$s*$r,$n=$D*$m-$E*$h+$v*$c+$g*$Y-$a*$P+$R*$Q;0!==Math.abs($n)&&($n=1/$n,$F[0]=($O*$m-$U*$h+$d*$c)*$n,$F[1]=($t*$h-$A*$m-$q*$c)*$n,$F[2]=($j*$R-$r*$a+$M*$g)*$n,$F[3]=($Z*$a-$S*$R-$s*$g)*$n,$F[4]=($U*$Y-$B*$m-$d*$P)*$n,$F[5]=($J*$m-$t*$Y+$q*$P)*$n,$F[6]=($r*$v-$x*$R-$M*$E)*$n,$F[7]=($u*$R-$Z*$v+$s*$E)*$n,$F[8]=($B*$h-$O*$Y+$d*$Q)*$n,$F[9]=($A*$Y-$J*$h-$q*$Q)*$n,$F[10]=($x*$a-$j*$v+$M*$D)*$n,$F[11]=($S*$v-$u*$a-$s*$D)*$n,$F[12]=($O*$P-$B*$c-$U*$Q)*$n,$F[13]=($J*$c-$A*$P+$t*$Q)*$n,$F[14]=($j*$E-$x*$g-$r*$D)*$n,$F[15]=($u*$g-$S*$E+$Z*$D)*$n)},$i.identity=function(){var $i=this.elements;$i[1]=$i[2]=$i[3]=$i[4]=$i[6]=$i[7]=$i[8]=$i[9]=$i[11]=$i[12]=$i[13]=$i[14]=0,$i[0]=$i[5]=$i[10]=$i[15]=1},$i.cloneTo=function($i){var $p,$F,$J;if(($F=this.elements)!==($J=$i.elements))for($p=0;$p<16;++$p)$J[$p]=$F[$p]},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$i.getTranslationVector=function($i){var $p=this.elements,$F=$i.elements;$F[0]=$p[12],$F[1]=$p[13],$F[2]=$p[14]},$i.setTranslationVector=function($i){var $p=this.elements,$F=$i.elements;$p[12]=$F[0],$p[13]=$F[1],$p[14]=$F[2]},$i.getForward=function($i){var $p=this.elements,$F=$i.elements;$F[0]=-$p[8],$F[1]=-$p[9],$F[2]=-$p[10]},$i.setForward=function($i){var $p=this.elements,$F=$i.elements;$p[8]=-$F[0],$p[9]=-$F[1],$p[10]=-$F[2]},$Q.createRotationX=function($i,$p){var $F=$p.elements,$J=Math.sin($i),$A=Math.cos($i);$F[1]=$F[2]=$F[3]=$F[4]=$F[7]=$F[8]=$F[11]=$F[12]=$F[13]=$F[14]=0,$F[0]=$F[15]=1,$F[5]=$F[10]=$A,$F[6]=$J,$F[9]=-$J},$Q.createRotationY=function($i,$p){var $F=$p.elements,$J=Math.sin($i),$A=Math.cos($i);$F[1]=$F[3]=$F[4]=$F[6]=$F[7]=$F[9]=$F[11]=$F[12]=$F[13]=$F[14]=0,$F[5]=$F[15]=1,$F[0]=$F[10]=$A,$F[2]=-$J,$F[8]=$J},$Q.createRotationZ=function($i,$p){var $F=$p.elements,$J=Math.sin($i),$A=Math.cos($i);$F[2]=$F[3]=$F[6]=$F[7]=$F[8]=$F[9]=$F[11]=$F[12]=$F[13]=$F[14]=0,$F[10]=$F[15]=1,$F[0]=$F[5]=$A,$F[1]=$J,$F[4]=-$J},$Q.createRotationYawPitchRoll=function($i,$p,$F,$J){$Fp.createFromYawPitchRoll($i,$p,$F,$Q._tempQuaternion),$Q.createRotationQuaternion($Q._tempQuaternion,$J)},$Q.createRotationAxis=function($i,$p,$F){var $J=$i.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=Math.cos($p),$O=Math.sin($p),$U=$A*$A,$d=$t*$t,$u=$q*$q,$S=$A*$t,$Z=$A*$q,$s=$t*$q,$x=$F.elements;$x[3]=$x[7]=$x[11]=$x[12]=$x[13]=$x[14]=0,$x[15]=1,$x[0]=$U+$B*(1-$U),$x[1]=$S-$B*$S+$O*$q,$x[2]=$Z-$B*$Z-$O*$t,$x[4]=$S-$B*$S-$O*$q,$x[5]=$d+$B*(1-$d),$x[6]=$s-$B*$s+$O*$A,$x[8]=$Z-$B*$Z+$O*$t,$x[9]=$s-$B*$s-$O*$A,$x[10]=$u+$B*(1-$u)},$Q.createRotationQuaternion=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0],$t=$F[1],$q=$F[2],$B=$F[3],$O=$A*$A,$U=$t*$t,$d=$q*$q,$u=$A*$t,$S=$q*$B,$Z=$q*$A,$s=$t*$B,$x=$t*$q,$j=$A*$B;$J[3]=$J[7]=$J[11]=$J[12]=$J[13]=$J[14]=0,$J[15]=1,$J[0]=1-2*($U+$d),$J[1]=2*($u+$S),$J[2]=2*($Z-$s),$J[4]=2*($u-$S),$J[5]=1-2*($d+$O),$J[6]=2*($x+$j),$J[8]=2*($Z+$s),$J[9]=2*($x-$j),$J[10]=1-2*($U+$O)},$Q.createTranslate=function($i,$p){var $F=$i.elements,$J=$p.elements;$J[4]=$J[8]=$J[1]=$J[9]=$J[2]=$J[6]=$J[3]=$J[7]=$J[11]=0,$J[0]=$J[5]=$J[10]=$J[15]=1,$J[12]=$F[0],$J[13]=$F[1],$J[14]=$F[2]},$Q.createScaling=function($i,$p){var $F=$i.elements,$J=$p.elements;$J[0]=$F[0],$J[5]=$F[1],$J[10]=$F[2],$J[1]=$J[4]=$J[8]=$J[12]=$J[9]=$J[13]=$J[2]=$J[6]=$J[14]=$J[3]=$J[7]=$J[11]=0,$J[15]=1},$Q.multiply=function($i,$p,$F){var $J,$A,$t,$q,$B,$O,$U,$d;for($A=$F.elements,$t=$i.elements,$A===($q=$p.elements)&&($q=$q.slice()),$J=0;$J<4;$J++)$B=$t[$J],$O=$t[$J+4],$U=$t[$J+8],$d=$t[$J+12],$A[$J]=$B*$q[0]+$O*$q[1]+$U*$q[2]+$d*$q[3],$A[$J+4]=$B*$q[4]+$O*$q[5]+$U*$q[6]+$d*$q[7],$A[$J+8]=$B*$q[8]+$O*$q[9]+$U*$q[10]+$d*$q[11],$A[$J+12]=$B*$q[12]+$O*$q[13]+$U*$q[14]+$d*$q[15]},$Q.createFromQuaternion=function($i,$p){var $F=$p.elements,$J=$i.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=$A+$A,$U=$t+$t,$d=$q+$q,$u=$A*$O,$S=$t*$O,$Z=$t*$U,$s=$q*$O,$x=$q*$U,$j=$q*$d,$r=$B*$O,$M=$B*$U,$D=$B*$d;$F[0]=1-$Z-$j,$F[1]=$S+$D,$F[2]=$s-$M,$F[3]=0,$F[4]=$S-$D,$F[5]=1-$u-$j,$F[6]=$x+$r,$F[7]=0,$F[8]=$s+$M,$F[9]=$x-$r,$F[10]=1-$u-$Z,$F[11]=0,$F[12]=0,$F[13]=0,$F[14]=0,$F[15]=1},$Q.createAffineTransformation=function($i,$p,$F,$J){var $A=$i.elements,$t=$p.elements,$q=$F.elements,$B=$J.elements,$O=$t[0],$U=$t[1],$d=$t[2],$u=$t[3],$S=$O+$O,$Z=$U+$U,$s=$d+$d,$x=$O*$S,$j=$O*$Z,$r=$O*$s,$M=$U*$Z,$D=$U*$s,$E=$d*$s,$v=$u*$S,$g=$u*$Z,$a=$u*$s,$R=$q[0],$Q=$q[1],$P=$q[2];$B[0]=(1-($M+$E))*$R,$B[1]=($j+$a)*$R,$B[2]=($r-$g)*$R,$B[3]=0,$B[4]=($j-$a)*$Q,$B[5]=(1-($x+$E))*$Q,$B[6]=($D+$v)*$Q,$B[7]=0,$B[8]=($r+$g)*$P,$B[9]=($D-$v)*$P,$B[10]=(1-($x+$M))*$P,$B[11]=0,$B[12]=$A[0],$B[13]=$A[1],$B[14]=$A[2],$B[15]=1},$Q.createLookAt=function($i,$p,$F,$J){var $A=$J.elements,$t=$Q._tempVector0,$q=$Q._tempVector1,$B=$Q._tempVector2;$qp.subtract($i,$p,$B),$qp.normalize($B,$B),$qp.cross($F,$B,$t),$qp.normalize($t,$t),$qp.cross($B,$t,$q),$J.identity(),$A[0]=$t.x,$A[4]=$t.y,$A[8]=$t.z,$A[1]=$q.x,$A[5]=$q.y,$A[9]=$q.z,$A[2]=$B.x,$A[6]=$B.y,$A[10]=$B.z,$A[12]=-$qp.dot($t,$i),$A[13]=-$qp.dot($q,$i),$A[14]=-$qp.dot($B,$i)},$Q.createPerspective=function($i,$p,$F,$J,$A){var $t=$A.elements,$q=1/Math.tan($i/2),$B=1/($F-$J);$t[0]=$q/$p,$t[5]=$q,$t[10]=($J+$F)*$B,$t[11]=-1,$t[14]=2*$J*$F*$B,$t[1]=$t[2]=$t[3]=$t[4]=$t[6]=$t[7]=$t[8]=$t[9]=$t[12]=$t[13]=$t[15]=0},$Q.createOrthoOffCenterRH=function($i,$p,$F,$J,$A,$t,$q){var $B=$q.elements,$O=1/($i-$p),$U=1/($F-$J),$d=1/($A-$t);$B[1]=$B[2]=$B[3]=$B[4]=$B[6]=$B[7]=$B[8]=$B[9]=$B[11]=0,$B[15]=1,$B[0]=-2*$O,$B[5]=-2*$U,$B[10]=2*$d,$B[12]=($i+$p)*$O,$B[13]=($J+$F)*$U,$B[14]=($t+$A)*$d},$Q.translation=function($i,$p){var $F=$i.elements,$J=$p.elements;$J[0]=$J[5]=$J[10]=$J[15]=1,$J[12]=$F[0],$J[13]=$F[1],$J[14]=$F[2]},$u($Q,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $Q},"_tempVector0",function(){return this._tempVector0=new $qp},"_tempVector1",function(){return this._tempVector1=new $qp},"_tempVector2",function(){return this._tempVector2=new $qp},"_tempQuaternion",function(){return this._tempQuaternion=new $Fp},"DEFAULT",function(){return this.DEFAULT=new $Q},"ZERO",function(){return this.ZERO=new $Q(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),$Q}(),$pp=(function(){function $D($i,$p){this.extents=null,this.transformation=null,this.extents=$i,this.transformation=$p}$Z($D,"laya.d3.math.OrientedBoundBox");var $i=$D.prototype;$i.getCorners=function($i){var $p=$D._tempV30.elements,$F=$D._tempV31.elements,$J=$D._tempV32.elements,$A=this.extents.elements;$p[0]=$A[0],$p[1]=$p[2]=0,$F[1]=$A[1],$F[0]=$F[2]=0,$J[2]=$A[2],$J[0]=$J[1]=0,$qp.TransformNormal($D._tempV30,this.transformation,$D._tempV30),$qp.TransformNormal($D._tempV31,this.transformation,$D._tempV31),$qp.TransformNormal($D._tempV32,this.transformation,$D._tempV32);var $t=$D._tempV33;this.transformation.getTranslationVector($t),$i.length=8,$qp.add($t,$D._tempV30,$D._tempV34),$qp.add($D._tempV34,$D._tempV31,$D._tempV34),$qp.add($D._tempV34,$D._tempV32,$i[0]),$qp.add($t,$D._tempV30,$D._tempV34),$qp.add($D._tempV34,$D._tempV31,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV32,$i[1]),$qp.subtract($t,$D._tempV30,$D._tempV34),$qp.add($D._tempV34,$D._tempV31,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV32,$i[2]),$qp.subtract($t,$D._tempV30,$D._tempV34),$qp.add($D._tempV34,$D._tempV31,$D._tempV34),$qp.add($D._tempV34,$D._tempV32,$i[3]),$qp.add($t,$D._tempV30,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV31,$D._tempV34),$qp.add($D._tempV34,$D._tempV32,$i[4]),$qp.add($t,$D._tempV30,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV31,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV32,$i[5]),$qp.subtract($t,$D._tempV30,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV31,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV32,$i[6]),$qp.subtract($t,$D._tempV30,$D._tempV34),$qp.subtract($D._tempV34,$D._tempV31,$D._tempV34),$qp.add($D._tempV34,$D._tempV32,$i[7])},$i.transform=function($i){$ip.multiply(this.transformation,$i,this.transformation)},$i.scale=function($i){$qp.multiply(this.extents,$i,this.extents)},$i.translate=function($i){this.transformation.getTranslationVector($D._tempV30),$qp.add($D._tempV30,$i,$D._tempV31),this.transformation.setTranslationVector($D._tempV31)},$i.Size=function($i){$qp.scale(this.extents,2,$i)},$i.getSize=function($i){var $p=this.extents.elements;$D._tempV30.x=$p[0],$D._tempV31.y=$p[1],$D._tempV32.z=$p[2],$qp.TransformNormal($D._tempV30,this.transformation,$D._tempV30),$qp.TransformNormal($D._tempV31,this.transformation,$D._tempV31),$qp.TransformNormal($D._tempV31,this.transformation,$D._tempV32);var $F=$i.elements;$F[0]=$qp.scalarLength($D._tempV30),$F[1]=$qp.scalarLength($D._tempV31),$F[2]=$qp.scalarLength($D._tempV32)},$i.getSizeSquared=function($i){var $p=this.extents.elements;$D._tempV30.x=$p[0],$D._tempV31.y=$p[1],$D._tempV32.z=$p[2],$qp.TransformNormal($D._tempV30,this.transformation,$D._tempV30),$qp.TransformNormal($D._tempV31,this.transformation,$D._tempV31),$qp.TransformNormal($D._tempV31,this.transformation,$D._tempV32);var $F=$i.elements;$F[0]=$qp.scalarLengthSquared($D._tempV30),$F[1]=$qp.scalarLengthSquared($D._tempV31),$F[2]=$qp.scalarLengthSquared($D._tempV32)},$i.getCenter=function($i){this.transformation.getTranslationVector($i)},$i.containsPoint=function($i){var $p=this.extents.elements,$F=$p[0],$J=$p[1],$A=$p[2];this.transformation.invert($D._tempM0),$qp.transformCoordinate($i,$D._tempM0,$D._tempV30);var $t=$D._tempV30.elements,$q=Math.abs($t[0]),$B=Math.abs($t[1]),$O=Math.abs($t[2]);return $li.nearEqual($q,$F)&&$li.nearEqual($B,$J)&&$li.nearEqual($O,$A)?2:$q<$F&&$B<$J&&$O<$A?1:0},$i.containsPoints=function($i){var $p=this.extents.elements,$F=$p[0],$J=$p[1],$A=$p[2];this.transformation.invert($D._tempM0);for(var $t=!0,$q=!1,$B=0;$B<$i.length;$B++){$qp.transformCoordinate($i[$B],$D._tempM0,$D._tempV30);var $O=$D._tempV30.elements,$U=Math.abs($O[0]),$d=Math.abs($O[1]),$u=Math.abs($O[2]);$li.nearEqual($U,$F)&&$li.nearEqual($d,$J)&&$li.nearEqual($u,$A)&&($q=!0),$U<$F&&$d<$J&&$u<$A?$q=!0:$t=!1}return $t?1:$q?2:0},$i.containsSphere=function($i,$p){void 0===$p&&($p=!1);var $F=this.extents.elements,$J=$F[0],$A=$F[1],$t=$F[2],$q=$i.radius;this.transformation.invert($D._tempM0),$qp.transformCoordinate($i.center,$D._tempM0,$D._tempV30);var $B=NaN;if($B=$p?$q:($qp.scale($qp.UnitX,$q,$D._tempV31),$qp.TransformNormal($D._tempV31,$D._tempM0,$D._tempV31),$qp.scalarLength($D._tempV31)),$qp.scale(this.extents,-1,$D._tempV32),$qp.Clamp($D._tempV30,$D._tempV32,this.extents,$D._tempV33),$B*$B<$qp.distanceSquared($D._tempV30,$D._tempV33))return 0;var $O=$D._tempV30.elements,$U=$O[0],$d=$O[1],$u=$O[2],$S=$D._tempV32.elements,$Z=$S[0],$s=$S[1],$x=$S[2];return $Z+$B<=$U&&$U<=$J-$B&&$B<$J-$Z&&$s+$B<=$d&&$d<=$A-$B&&$B<$A-$s&&$x+$B<=$u&&$u<=$t-$B&&$B<$t-$x?1:2},$i.containsOrientedBoundBox=function($i){var $p=0,$F=0;$i.getCorners($D._corners);var $J=this.containsPoints($D._corners);if(0!=$J)return $J;var $A=this.extents.elements;$i.extents.cloneTo($D._tempV35);var $t=$D._tempV35.elements;$D._getRows(this.transformation,$D._rows1),$D._getRows($i.transformation,$D._rows2);var $q=NaN;for($p=0;$p<4;$p++)for($F=0;$F<4;$F++)3==$p||3==$F?($D._tempM0.setElementByRowColumn($p,$F,0),$D._tempM1.setElementByRowColumn($p,$F,0)):($q=$qp.dot($D._rows1[$p],$D._rows2[$F]),$D._tempM0.setElementByRowColumn($p,$F,$q),$D._tempM1.setElementByRowColumn($p,$F,Math.abs($q)));$i.getCenter($D._tempV34),this.getCenter($D._tempV36),$qp.subtract($D._tempV34,$D._tempV36,$D._tempV30);var $B=$D._tempV31.elements;$B[0]=$qp.dot($D._tempV30,$D._rows1[0]),$B[1]=$qp.dot($D._tempV30,$D._rows1[1]),$B[2]=$qp.dot($D._tempV30,$D._rows1[2]);var $O=$D._tempV32.elements,$U=$D._tempV33.elements;for($p=0;$p<3;$p++)if($O[0]=$D._tempM1.getElementByRowColumn($p,0),$O[1]=$D._tempM1.getElementByRowColumn($p,1),$O[2]=$D._tempM1.getElementByRowColumn($p,2),$A[$p]+$qp.dot($D._tempV35,$D._tempV32)<Math.abs($B[$p]))return 0;for($F=0;$F<3;$F++)if($O[0]=$D._tempM1.getElementByRowColumn(0,$F),$O[1]=$D._tempM1.getElementByRowColumn(1,$F),$O[2]=$D._tempM1.getElementByRowColumn(2,$F),$U[0]=$D._tempM0.getElementByRowColumn(0,$F),$U[1]=$D._tempM0.getElementByRowColumn(1,$F),$U[2]=$D._tempM0.getElementByRowColumn(2,$F),$qp.dot(this.extents,$D._tempV32)+$t[$F]<Math.abs($qp.dot($D._tempV31,$D._tempV33)))return 0;for($p=0;$p<3;$p++)for($F=0;$F<3;$F++){var $d=($p+1)%3,$u=($p+2)%3,$S=($F+1)%3,$Z=($F+2)%3;if($A[$d]*$D._tempM1.getElementByRowColumn($u,$F)+$A[$u]*$D._tempM1.getElementByRowColumn($d,$F)+($t[$S]*$D._tempM1.getElementByRowColumn($p,$Z)+$t[$Z]*$D._tempM1.getElementByRowColumn($p,$S))<Math.abs($B[$u]*$D._tempM0.getElementByRowColumn($d,$F)-$B[$d]*$D._tempM0.getElementByRowColumn($u,$F)))return 0}return 2},$i.containsLine=function($i,$p){$D._corners[0]=$i,$D._corners[1]=$p;var $F=this.containsPoints($D._corners);if(0!=$F)return $F;var $J=this.extents.elements,$A=$J[0],$t=$J[1],$q=$J[2];this.transformation.invert($D._tempM0),$qp.transformCoordinate($i,$D._tempM0,$D._tempV30),$qp.transformCoordinate($p,$D._tempM0,$D._tempV31),$qp.add($D._tempV30,$D._tempV31,$D._tempV32),$qp.scale($D._tempV32,.5,$D._tempV32),$qp.subtract($D._tempV30,$D._tempV32,$D._tempV33);var $B=$D._tempV33.elements,$O=$B[0],$U=$B[1],$d=$B[2],$u=$D._tempV34.elements,$S=$u[0]=Math.abs($B[0]),$Z=$u[1]=Math.abs($B[1]),$s=$u[2]=Math.abs($B[2]),$x=$D._tempV32.elements,$j=$x[0],$r=$x[1],$M=$x[2];return Math.abs($j)>$A+$S?0:Math.abs($r)>$t+$Z?0:Math.abs($M)>$q+$s?0:Math.abs($r*$d-$M*$U)>$t*$s+$q*$Z?0:Math.abs($j*$d-$M*$O)>$A*$s+$q*$S?0:Math.abs($j*$U-$r*$O)>$A*$Z+$t*$S?0:2},$i.containsBoundBox=function($i){var $p=0,$F=0,$J=$i.min,$A=$i.max;$i.getCorners($D._corners);var $t=this.containsPoints($D._corners);if(0!=$t)return $t;$qp.subtract($A,$J,$D._tempV30),$qp.scale($D._tempV30,.5,$D._tempV30),$qp.add($J,$D._tempV30,$D._tempV30),$qp.subtract($A,$D._tempV30,$D._tempV31);var $q=this.extents.elements,$B=$D._tempV31.elements;$D._getRows(this.transformation,$D._rows1),this.transformation.invert($D._tempM0);for($p=0;$p<3;$p++)for($F=0;$F<3;$F++)$D._tempM1.setElementByRowColumn($p,$F,Math.abs($D._tempM0.getElementByRowColumn($p,$F)));this.getCenter($D._tempV35),$qp.subtract($D._tempV30,$D._tempV35,$D._tempV32);var $O=$D._tempV31.elements;$O[0]=$qp.dot($D._tempV32,$D._rows1[0]),$O[1]=$qp.dot($D._tempV32,$D._rows1[1]),$O[2]=$qp.dot($D._tempV32,$D._rows1[2]);var $U=$D._tempV33.elements,$d=$D._tempV34.elements;for($p=0;$p<3;$p++)if($U[0]=$D._tempM1.getElementByRowColumn($p,0),$U[1]=$D._tempM1.getElementByRowColumn($p,1),$U[2]=$D._tempM1.getElementByRowColumn($p,2),$q[$p]+$qp.dot($D._tempV31,$D._tempV33)<Math.abs($O[$p]))return 0;for($F=0;$F<3;$F++)if($U[0]=$D._tempM1.getElementByRowColumn(0,$F),$U[1]=$D._tempM1.getElementByRowColumn(1,$F),$U[2]=$D._tempM1.getElementByRowColumn(2,$F),$d[0]=$D._tempM0.getElementByRowColumn(0,$F),$d[1]=$D._tempM0.getElementByRowColumn(1,$F),$d[2]=$D._tempM0.getElementByRowColumn(2,$F),$qp.dot(this.extents,$D._tempV33)+$B[$F]<Math.abs($qp.dot($D._tempV31,$D._tempV34)))return 0;for($p=0;$p<3;$p++)for($F=0;$F<3;$F++){var $u=($p+1)%3,$S=($p+2)%3,$Z=($F+1)%3,$s=($F+2)%3;if($q[$u]*$D._tempM1.getElementByRowColumn($S,$F)+$q[$S]*$D._tempM1.getElementByRowColumn($u,$F)+($B[$Z]*$D._tempM1.getElementByRowColumn($p,$s)+$B[$s]*$D._tempM1.getElementByRowColumn($p,$Z))<Math.abs($O[$S]*$D._tempM0.getElementByRowColumn($u,$F)-$O[$u]*$D._tempM0.getElementByRowColumn($S,$F)))return 0}return 2},$i.intersectsRay=function($i,$p){$qp.scale(this.extents,-1,$D._tempV30),this.transformation.invert($D._tempM0),$qp.TransformNormal($i.direction,$D._tempM0,$D._ray.direction),$qp.transformCoordinate($i.origin,$D._tempM0,$D._ray.origin),$D._boxBound1.min=$D._tempV30,$D._boxBound1.max=this.extents;var $F=Collision.intersectsRayAndBoxRP($D._ray,$D._boxBound1,$p);return-1!==$F&&$qp.transformCoordinate($p,this.transformation,$p),$F},$i._getLocalCorners=function($i){$i.length=8;var $p=this.extents.elements;$D._tempV30.x=$p[0],$D._tempV31.y=$p[1],$D._tempV32.z=$p[2],$qp.add($D._tempV30,$D._tempV31,$D._tempV33),$qp.add($D._tempV33,$D._tempV32,$i[0]),$qp.add($D._tempV30,$D._tempV31,$D._tempV33),$qp.subtract($D._tempV33,$D._tempV32,$i[1]),$qp.subtract($D._tempV31,$D._tempV30,$D._tempV33),$qp.subtract($D._tempV33,$D._tempV30,$i[2]),$qp.subtract($D._tempV31,$D._tempV30,$D._tempV33),$qp.add($D._tempV33,$D._tempV32,$i[3]),$qp.subtract($D._tempV30,$D._tempV31,$D._tempV33),$qp.add($D._tempV33,$D._tempV32,$i[4]),$qp.subtract($D._tempV30,$D._tempV31,$D._tempV33),$qp.subtract($D._tempV33,$D._tempV32,$i[5]),$qp.scale($i[0],-1,$i[6]),$qp.subtract($D._tempV32,$D._tempV30,$D._tempV33),$qp.subtract($D._tempV33,$D._tempV31,$i[7])},$i.equals=function($i){return this.extents==$i.extents&&this.transformation==$i.transformation},$i.cloneTo=function($i){var $p=$i;this.extents.cloneTo($p.extents),this.transformation.cloneTo($p.transformation)},$D.createByBoundBox=function($i,$p){var $F=$i.min,$J=$i.max;$qp.subtract($J,$F,$D._tempV30),$qp.scale($D._tempV30,.5,$D._tempV30),$qp.add($F,$D._tempV30,$D._tempV31),$qp.subtract($J,$D._tempV31,$D._tempV32),$ip.translation($D._tempV31,$D._tempM0);var $A=$D._tempV32.clone(),$t=$D._tempM0.clone();$p.extents=$A,$p.transformation=$t},$D.createByMinAndMaxVertex=function($i,$p){return $qp.subtract($p,$i,$D._tempV30),$qp.scale($D._tempV30,.5,$D._tempV30),$qp.add($i,$D._tempV30,$D._tempV31),$qp.subtract($p,$D._tempV31,$D._tempV32),$ip.translation($D._tempV31,$D._tempM0),new $D($D._tempV32,$D._tempM0)},$D._getRows=function($i,$p){$p.length=3;var $F=$i.elements,$J=$p[0].elements;$J[0]=$F[0],$J[1]=$F[1],$J[2]=$F[2];var $A=$p[1].elements;$A[0]=$F[4],$A[1]=$F[5],$A[2]=$F[6];var $t=$p[2].elements;$t[0]=$F[8],$t[1]=$F[9],$t[2]=$F[10]},$D.getObbtoObbMatrix4x4=function($i,$p,$F,$J){var $A=$i.transformation,$t=$p.transformation;if($F){$D._getRows($A,$D._rows1),$D._getRows($t,$D._rows2);for(var $q=0;$q<3;$q++)for(var $B=0;$B<3;$B++)$J.setElementByRowColumn($q,$B,$qp.dot($D._rows2[$q],$D._rows1[$B]));$p.getCenter($D._tempV30),$i.getCenter($D._tempV31),$qp.subtract($D._tempV30,$D._tempV31,$D._tempV32);var $O=$J.elements;$O[12]=$qp.dot($D._tempV32,$D._rows1[0]),$O[13]=$qp.dot($D._tempV32,$D._rows1[1]),$O[14]=$qp.dot($D._tempV32,$D._rows1[2]),$O[15]=1}else $A.invert($D._tempM0),$ip.multiply($t,$D._tempM0,$J)},$D.merge=function($i,$p,$F){var $J=$i.extents,$A=$i.transformation;$D.getObbtoObbMatrix4x4($i,$p,$F,$D._tempM0),$p._getLocalCorners($D._corners),$qp.transformCoordinate($D._corners[0],$D._tempM0,$D._corners[0]),$qp.transformCoordinate($D._corners[1],$D._tempM0,$D._corners[1]),$qp.transformCoordinate($D._corners[2],$D._tempM0,$D._corners[2]),$qp.transformCoordinate($D._corners[3],$D._tempM0,$D._corners[3]),$qp.transformCoordinate($D._corners[4],$D._tempM0,$D._corners[4]),$qp.transformCoordinate($D._corners[5],$D._tempM0,$D._corners[5]),$qp.transformCoordinate($D._corners[6],$D._tempM0,$D._corners[6]),$qp.transformCoordinate($D._corners[7],$D._tempM0,$D._corners[7]),$qp.scale($J,-1,$D._boxBound1.min),$J.cloneTo($D._boxBound1.max),$ei.createfromPoints($D._corners,$D._boxBound2),$ei.merge($D._boxBound2,$D._boxBound1,$D._boxBound3);var $t=$D._boxBound3.min,$q=$D._boxBound3.max;$qp.subtract($q,$t,$D._tempV30),$qp.scale($D._tempV30,.5,$D._tempV30),$qp.add($t,$D._tempV30,$D._tempV32),$qp.subtract($q,$D._tempV32,$J),$qp.transformCoordinate($D._tempV32,$A,$D._tempV33)},$u($D,["_tempV30",function(){return this._tempV30=new $qp},"_tempV31",function(){return this._tempV31=new $qp},"_tempV32",function(){return this._tempV32=new $qp},"_tempV33",function(){return this._tempV33=new $qp},"_tempV34",function(){return this._tempV34=new $qp},"_tempV35",function(){return this._tempV35=new $qp},"_tempV36",function(){return this._tempV36=new $qp},"_tempM0",function(){return this._tempM0=new $ip},"_tempM1",function(){return this._tempM1=new $ip},"_corners",function(){return this._corners=[new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp]},"_rows1",function(){return this._rows1=[new $qp,new $qp,new $qp]},"_rows2",function(){return this._rows2=[new $qp,new $qp,new $qp]},"_ray",function(){return this._ray=new $Ap(new $qp,new $qp)},"_boxBound1",function(){return this._boxBound1=new $ei(new $qp,new $qp)},"_boxBound2",function(){return this._boxBound2=new $ei(new $qp,new $qp)},"_boxBound3",function(){return this._boxBound3=new $ei(new $qp,new $qp)}])}(),function(){function $v($i,$p){this.normal=null,this.distance=NaN,void 0===$p&&($p=0),this.normal=$i,this.distance=$p}return $Z($v,"laya.d3.math.Plane"),$v.prototype.normalize=function(){var $i=this.normal.elements,$p=$i[0],$F=$i[1],$J=$i[2],$A=1/Math.sqrt($p*$p+$F*$F+$J*$J);$i[0]=$p*$A,$i[1]=$F*$A,$i[2]=$J*$A,this.distance*=$A},$v.createPlaneBy3P=function($i,$p,$F){var $J=$i.elements,$A=$p.elements,$t=$F.elements,$q=$A[0]-$J[0],$B=$A[1]-$J[1],$O=$A[2]-$J[2],$U=$t[0]-$J[0],$d=$t[1]-$J[1],$u=$t[2]-$J[2],$S=$B*$u-$O*$d,$Z=$O*$U-$q*$u,$s=$q*$d-$B*$U,$x=1/Math.sqrt($S*$S+$Z*$Z+$s*$s),$j=$S*$x,$r=$Z*$x,$M=$s*$x,$D=$v._TEMPVec3.elements;$D[0]=$j,$D[1]=$r,$D[2]=$M;var $E=-($j*$J[0]+$r*$J[1]+$M*$J[2]);return new $v($v._TEMPVec3,$E)},$v.PlaneIntersectionType_Back=0,$v.PlaneIntersectionType_Front=1,$v.PlaneIntersectionType_Intersecting=2,$u($v,["_TEMPVec3",function(){return this._TEMPVec3=new $qp}]),$v}()),$Fp=function(){function $A($i,$p,$F,$J){this.elements=new Float32Array(4),void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=1),this.elements[0]=$i,this.elements[1]=$p,this.elements[2]=$F,this.elements[3]=$J}$Z($A,"laya.d3.math.Quaternion");var $i=$A.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.scaling=function($i,$p){var $F=$p.elements,$J=this.elements;$F[0]=$J[0]*$i,$F[1]=$J[1]*$i,$F[2]=$J[2]*$i,$F[3]=$J[3]*$i},$i.normalize=function($i){var $p=$i.elements,$F=this.elements,$J=$F[0],$A=$F[1],$t=$F[2],$q=$F[3],$B=$J*$J+$A*$A+$t*$t+$q*$q;0<$B&&($B=1/Math.sqrt($B),$p[0]=$J*$B,$p[1]=$A*$B,$p[2]=$t*$B,$p[3]=$q*$B)},$i.length=function(){var $i=this.elements,$p=$i[0],$F=$i[1],$J=$i[2],$A=$i[3];return Math.sqrt($p*$p+$F*$F+$J*$J+$A*$A)},$i.rotateX=function($i,$p){var $F=$p.elements,$J=this.elements;$i*=.5;var $A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=Math.sin($i),$U=Math.cos($i);$F[0]=$A*$U+$B*$O,$F[1]=$t*$U+$q*$O,$F[2]=$q*$U-$t*$O,$F[3]=$B*$U-$A*$O},$i.rotateY=function($i,$p){var $F=$p.elements,$J=this.elements;$i*=.5;var $A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=Math.sin($i),$U=Math.cos($i);$F[0]=$A*$U-$q*$O,$F[1]=$t*$U+$B*$O,$F[2]=$q*$U+$A*$O,$F[3]=$B*$U-$t*$O},$i.rotateZ=function($i,$p){var $F=$p.elements,$J=this.elements;$i*=.5;var $A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=Math.sin($i),$U=Math.cos($i);$F[0]=$A*$U+$t*$O,$F[1]=$t*$U-$A*$O,$F[2]=$q*$U+$B*$O,$F[3]=$B*$U-$q*$O},$i.getYawPitchRoll=function($i){$qp.transformQuat($qp.ForwardRH,this,$A.TEMPVector31),$qp.transformQuat($qp.Up,this,$A.TEMPVector32);var $p=$A.TEMPVector32.elements;$A.angleTo($qp.ZERO,$A.TEMPVector31,$A.TEMPVector33);var $F=$A.TEMPVector33.elements;$F[0]==Math.PI/2?($F[1]=$A.arcTanAngle($p[2],$p[0]),$F[2]=0):$F[0]==-Math.PI/2?($F[1]=$A.arcTanAngle(-$p[2],-$p[0]),$F[2]=0):($ip.createRotationY(-$F[1],$A.TEMPMatrix0),$ip.createRotationX(-$F[0],$A.TEMPMatrix1),$qp.transformCoordinate($A.TEMPVector32,$A.TEMPMatrix0,$A.TEMPVector32),$qp.transformCoordinate($A.TEMPVector32,$A.TEMPMatrix1,$A.TEMPVector32),$F[2]=$A.arcTanAngle($p[1],-$p[0])),$F[1]<=-Math.PI&&($F[1]=Math.PI),$F[2]<=-Math.PI&&($F[2]=Math.PI),$F[1]>=Math.PI&&$F[2]>=Math.PI&&($F[1]=0,$F[2]=0,$F[0]=Math.PI-$F[0]);var $J=$i.elements;$J[0]=$F[1],$J[1]=$F[0],$J[2]=$F[2]},$i.invert=function($i){var $p=$i.elements,$F=this.elements,$J=$F[0],$A=$F[1],$t=$F[2],$q=$F[3],$B=$J*$J+$A*$A+$t*$t+$q*$q,$O=$B?1/$B:0;$p[0]=-$J*$O,$p[1]=-$A*$O,$p[2]=-$t*$O,$p[3]=$q*$O},$i.identity=function(){var $i=this.elements;$i[0]=0,$i[1]=0,$i[2]=0,$i[3]=1},$i.fromArray=function($i,$p){void 0===$p&&($p=0),this.elements[0]=$i[$p+0],this.elements[1]=$i[$p+1],this.elements[2]=$i[$p+2],this.elements[3]=$i[$p+3]},$i.cloneTo=function($i){var $p,$F,$J;if(($F=this.elements)!==($J=$i.elements))for($p=0;$p<4;++$p)$J[$p]=$F[$p]},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$i.equals=function($i){var $p=this.elements,$F=$i.elements;return $li.nearEqual($p[0],$F[0])&&$li.nearEqual($p[1],$F[1])&&$li.nearEqual($p[2],$F[2])&&$li.nearEqual($p[3],$F[3])},$i.lengthSquared=function(){var $i=this.elements[0],$p=this.elements[1],$F=this.elements[2],$J=this.elements[3];return $i*$i+$p*$p+$F*$F+$J*$J},$s(0,$i,"x",function(){return this.elements[0]}),$s(0,$i,"y",function(){return this.elements[1]}),$s(0,$i,"z",function(){return this.elements[2]}),$s(0,$i,"w",function(){return this.elements[3]}),$A.createFromYawPitchRoll=function($i,$p,$F,$J){var $A=.5*$F,$t=.5*$p,$q=.5*$i,$B=Math.sin($A),$O=Math.cos($A),$U=Math.sin($t),$d=Math.cos($t),$u=Math.sin($q),$S=Math.cos($q),$Z=$J.elements;$Z[0]=$S*$U*$O+$u*$d*$B,$Z[1]=$u*$d*$O-$S*$U*$B,$Z[2]=$S*$d*$B-$u*$U*$O,$Z[3]=$S*$d*$O+$u*$U*$B},$A.multiply=function($i,$p,$F){var $J=$i.elements,$A=$p.elements,$t=$F.elements,$q=$J[0],$B=$J[1],$O=$J[2],$U=$J[3],$d=$A[0],$u=$A[1],$S=$A[2],$Z=$A[3],$s=$B*$S-$O*$u,$x=$O*$d-$q*$S,$j=$q*$u-$B*$d,$r=$q*$d+$B*$u+$O*$S;$t[0]=$q*$Z+$d*$U+$s,$t[1]=$B*$Z+$u*$U+$x,$t[2]=$O*$Z+$S*$U+$j,$t[3]=$U*$Z-$r},$A.arcTanAngle=function($i,$p){return 0==$i?1==$p?Math.PI/2:-Math.PI/2:0<$i?Math.atan($p/$i):$i<0?0<$p?Math.atan($p/$i)+Math.PI:Math.atan($p/$i)-Math.PI:0},$A.angleTo=function($i,$p,$F){$qp.subtract($p,$i,$A.TEMPVector30),$qp.normalize($A.TEMPVector30,$A.TEMPVector30),$F.elements[0]=Math.asin($A.TEMPVector30.y),$F.elements[1]=$A.arcTanAngle(-$A.TEMPVector30.z,-$A.TEMPVector30.x)},$A.createFromAxisAngle=function($i,$p,$F){var $J=$F.elements,$A=$i.elements;$p*=.5;var $t=Math.sin($p);$J[0]=$t*$A[0],$J[1]=$t*$A[1],$J[2]=$t*$A[2],$J[3]=Math.cos($p)},$A.createFromMatrix3x3=function($i,$p){var $F,$J=$p.elements,$A=$i.elements,$t=$A[0]+$A[4]+$A[8];if(0<$t)$F=Math.sqrt($t+1),$J[3]=.5*$F,$F=.5/$F,$J[0]=($A[5]-$A[7])*$F,$J[1]=($A[6]-$A[2])*$F,$J[2]=($A[1]-$A[3])*$F;else{var $q=0;$A[4]>$A[0]&&($q=1),$A[8]>$A[3*$q+$q]&&($q=2);var $B=($q+1)%3,$O=($q+2)%3;$F=Math.sqrt($A[3*$q+$q]-$A[3*$B+$B]-$A[3*$O+$O]+1),$J[$q]=.5*$F,$F=.5/$F,$J[3]=($A[3*$B+$O]-$A[3*$O+$B])*$F,$J[$B]=($A[3*$B+$q]+$A[3*$q+$B])*$F,$J[$O]=($A[3*$O+$q]+$A[3*$q+$O])*$F}},$A.createFromMatrix4x4=function($i,$p){var $F,$J,$A=$i.elements,$t=$p.elements,$q=$A[0]+$A[5]+$A[10];0<$q?($F=Math.sqrt($q+1),$t[3]=.5*$F,$F=.5/$F,$t[0]=($A[6]-$A[9])*$F,$t[1]=($A[8]-$A[2])*$F,$t[2]=($A[1]-$A[4])*$F):$A[0]>=$A[5]&&$A[0]>=$A[10]?($J=.5/($F=Math.sqrt(1+$A[0]-$A[5]-$A[10])),$t[0]=.5*$F,$t[1]=($A[1]+$A[4])*$J,$t[2]=($A[2]+$A[8])*$J,$t[3]=($A[6]-$A[9])*$J):$A[5]>$A[10]?($J=.5/($F=Math.sqrt(1+$A[5]-$A[0]-$A[10])),$t[0]=($A[4]+$A[1])*$J,$t[1]=.5*$F,$t[2]=($A[9]+$A[6])*$J,$t[3]=($A[8]-$A[2])*$J):($J=.5/($F=Math.sqrt(1+$A[10]-$A[0]-$A[5])),$t[0]=($A[8]+$A[2])*$J,$t[1]=($A[9]+$A[6])*$J,$t[2]=.5*$F,$t[3]=($A[1]-$A[4])*$J)},$A.slerp=function($i,$p,$F,$J){var $A,$t,$q,$B,$O,$U=$i.elements,$d=$p.elements,$u=$J.elements,$S=$U[0],$Z=$U[1],$s=$U[2],$x=$U[3],$j=$d[0],$r=$d[1],$M=$d[2],$D=$d[3];return($t=$S*$j+$Z*$r+$s*$M+$x*$D)<0&&($t=-$t,$j=-$j,$r=-$r,$M=-$M,$D=-$D),$O=1e-6<1-$t?($A=Math.acos($t),$q=Math.sin($A),$B=Math.sin((1-$F)*$A)/$q,Math.sin($F*$A)/$q):($B=1-$F,$F),$u[0]=$B*$S+$O*$j,$u[1]=$B*$Z+$O*$r,$u[2]=$B*$s+$O*$M,$u[3]=$B*$x+$O*$D,$u},$A.lerp=function($i,$p,$F,$J){var $A=$J.elements,$t=$i.elements,$q=$p.elements,$B=$t[0],$O=$t[1],$U=$t[2],$d=$t[3];$A[0]=$B+$F*($q[0]-$B),$A[1]=$O+$F*($q[1]-$O),$A[2]=$U+$F*($q[2]-$U),$A[3]=$d+$F*($q[3]-$d)},$A.add=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]+$t[0],$J[1]=$A[1]+$t[1],$J[2]=$A[2]+$t[2],$J[3]=$A[3]+$t[3]},$A.dot=function($i,$p){var $F=$i.elements,$J=$p.elements;return $F[0]*$J[0]+$F[1]*$J[1]+$F[2]*$J[2]+$F[3]*$J[3]},$A.rotationLookAt=function($i,$p,$F){$A.lookAt($qp.ZERO,$i,$p,$F)},$A.lookAt=function($i,$p,$F,$J){$Hi.lookAt($i,$p,$F,$A._tempMatrix3x3),$A.rotationMatrix($A._tempMatrix3x3,$J)},$A.invert=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$i.lengthSquared();$li.isZero($A)||($A=1/$A,$J[0]=-$F[0]*$A,$J[1]=-$F[1]*$A,$J[2]=-$F[2]*$A,$J[3]=$F[3]*$A)},$A.rotationMatrix=function($i,$p){var $F=$i.elements,$J=$F[0],$A=$F[1],$t=$F[2],$q=$F[3],$B=$F[4],$O=$F[5],$U=$F[6],$d=$F[7],$u=$F[8],$S=$p.elements,$Z=NaN,$s=NaN,$x=$J+$B+$u;0<$x?($Z=Math.sqrt($x+1),$S[3]=.5*$Z,$Z=.5/$Z,$S[0]=($O-$d)*$Z,$S[1]=($U-$t)*$Z,$S[2]=($A-$q)*$Z):$B<=$J&&$u<=$J?($s=.5/($Z=Math.sqrt(1+$J-$B-$u)),$S[0]=.5*$Z,$S[1]=($A+$q)*$s,$S[2]=($t+$U)*$s,$S[3]=($O-$d)*$s):$u<$B?($s=.5/($Z=Math.sqrt(1+$B-$J-$u)),$S[0]=($q+$A)*$s,$S[1]=.5*$Z,$S[2]=($d+$O)*$s,$S[3]=($U-$t)*$s):($s=.5/($Z=Math.sqrt(1+$u-$J-$B)),$S[0]=($U+$t)*$s,$S[1]=($d+$O)*$s,$S[2]=.5*$Z,$S[3]=($A-$q)*$s)},$A.DEFAULT=new $A,$u($A,["TEMPVector30",function(){return this.TEMPVector30=new $qp},"TEMPVector31",function(){return this.TEMPVector31=new $qp},"TEMPVector32",function(){return this.TEMPVector32=new $qp},"TEMPVector33",function(){return this.TEMPVector33=new $qp},"TEMPMatrix0",function(){return this.TEMPMatrix0=new $ip},"TEMPMatrix1",function(){return this.TEMPMatrix1=new $ip},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new $Hi},"NAN",function(){return this.NAN=new $A(NaN,NaN,NaN,NaN)}]),$A}(),$Jp=function(){function $i($i){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=$i,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}$Z($i,"laya.d3.math.Rand");var $p=$i.prototype;return $p.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},$p.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},$p.getSignedFloat=function(){return 2*this.getFloat()-1},$s(0,$p,"seed",function(){return this.seeds[0]},function($i){this.seeds[0]=$i,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),$i.getFloatFromInt=function($i){return 1/8388607*(8388607&$i)},$i.getByteFromInt=function($i){return(8388607&$i)>>>15},$i}(),$Ap=(function(){function $A($i){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!($i instanceof Array)||4!==$i.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|$i[0],this._state0L=0|$i[1],this._state1U=0|$i[2],this._state1L=0|$i[3]}$Z($A,"laya.d3.math.RandX");var $i=$A.prototype;$i.randomint=function(){var $i=this._state0U,$p=this._state0L,$F=this._state1U,$J=this._state1L,$A=($J>>>0)+($p>>>0),$t=$F+$i+($A/2>>>31)>>>0,$q=$A>>>0,$B=0,$O=0;$B=($i^=$B=$i<<23|(-512&$p)>>>9)^(this._state0U=$F),$O=($p^=$O=$p<<23)^(this._state0L=$J);$B^=$i>>>18,$O^=$p>>>18|(262143&$i)<<14;return $B^=$F>>>5,$O^=$J>>>5|(31&$F)<<27,this._state1U=$B,this._state1L=$O,[$t,$q]},$i.random=function(){var $i=this.randomint(),$p=$i[0],$F=1023<<20|$p>>>12,$J=0|($i[1]>>>12|(4095&$p)<<20);return $A._CONVERTION_BUFFER.setUint32(0,$F,!1),$A._CONVERTION_BUFFER.setUint32(4,$J,!1),$Jp._CONVERTION_BUFFER.getFloat64(0,!1)-1},$u($A,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new $Jp([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function $i($i,$p){this.origin=null,this.direction=null,this.origin=$i,this.direction=$p}return $Z($i,"laya.d3.math.Ray"),$i}()),$tp=function(){function $i($i,$p){this.elements=new Float32Array(2),void 0===$i&&($i=0),void 0===$p&&($p=0);var $F=this.elements;$F[0]=$i,$F[1]=$p}$Z($i,"laya.d3.math.Vector2");var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.IClone":!0}),$p.fromArray=function($i,$p){void 0===$p&&($p=0),this.elements[0]=$i[$p+0],this.elements[1]=$i[$p+1]},$p.cloneTo=function($i){var $p=$i.elements,$F=this.elements;$p[0]=$F[0],$p[1]=$F[1]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"x",function(){return this.elements[0]},function($i){this.elements[0]=$i}),$s(0,$p,"y",function(){return this.elements[1]},function($i){this.elements[1]=$i}),$i.scale=function($i,$p,$F){var $J=$F.elements,$A=$i.elements;$J[0]=$A[0]*$p,$J[1]=$A[1]*$p},$u($i,["ZERO",function(){return this.ZERO=new $i(0,0)},"ONE",function(){return this.ONE=new $i(1,1)}]),$i}(),$qp=function(){function $d($i,$p,$F){this.elements=new Float32Array(3),void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0);var $J=this.elements;$J[0]=$i,$J[1]=$p,$J[2]=$F}$Z($d,"laya.d3.math.Vector3");var $i=$d.prototype;return $v.imps($i,{"laya.d3.core.IClone":!0}),$i.fromArray=function($i,$p){void 0===$p&&($p=0),this.elements[0]=$i[$p+0],this.elements[1]=$i[$p+1],this.elements[2]=$i[$p+2]},$i.cloneTo=function($i){var $p=$i.elements,$F=this.elements;$p[0]=$F[0],$p[1]=$F[1],$p[2]=$F[2]},$i.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$i.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},$i.reset=function($i,$p,$F){this.elements[0]=$i,this.elements[1]=$p,this.elements[2]=$F},$s(0,$i,"x",function(){return this.elements[0]},function($i){this.elements[0]=$i}),$s(0,$i,"y",function(){return this.elements[1]},function($i){this.elements[1]=$i}),$s(0,$i,"z",function(){return this.elements[2]},function($i){this.elements[2]=$i}),$d.distanceSquared=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0]-$J[0],$t=$F[1]-$J[1],$q=$F[2]-$J[2];return $A*$A+$t*$t+$q*$q},$d.distance=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0]-$J[0],$t=$F[1]-$J[1],$q=$F[2]-$J[2];return Math.sqrt($A*$A+$t*$t+$q*$q)},$d.min=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=Math.min($A[0],$t[0]),$J[1]=Math.min($A[1],$t[1]),$J[2]=Math.min($A[2],$t[2])},$d.max=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=Math.max($A[0],$t[0]),$J[1]=Math.max($A[1],$t[1]),$J[2]=Math.max($A[2],$t[2])},$d.transformQuat=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements,$q=$A[0],$B=$A[1],$O=$A[2],$U=$t[0],$d=$t[1],$u=$t[2],$S=$t[3],$Z=$S*$q+$d*$O-$u*$B,$s=$S*$B+$u*$q-$U*$O,$x=$S*$O+$U*$B-$d*$q,$j=-$U*$q-$d*$B-$u*$O;$J[0]=$Z*$S+$j*-$U+$s*-$u-$x*-$d,$J[1]=$s*$S+$j*-$d+$x*-$U-$Z*-$u,$J[2]=$x*$S+$j*-$u+$Z*-$d-$s*-$U},$d.scalarLength=function($i){var $p=$i.elements,$F=$p[0],$J=$p[1],$A=$p[2];return Math.sqrt($F*$F+$J*$J+$A*$A)},$d.scalarLengthSquared=function($i){var $p=$i.elements,$F=$p[0],$J=$p[1],$A=$p[2];return $F*$F+$J*$J+$A*$A},$d.normalize=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0],$t=$F[1],$q=$F[2],$B=$A*$A+$t*$t+$q*$q;0<$B&&($B=1/Math.sqrt($B),$J[0]=$F[0]*$B,$J[1]=$F[1]*$B,$J[2]=$F[2]*$B)},$d.multiply=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]*$t[0],$J[1]=$A[1]*$t[1],$J[2]=$A[2]*$t[2]},$d.scale=function($i,$p,$F){var $J=$F.elements,$A=$i.elements;$J[0]=$A[0]*$p,$J[1]=$A[1]*$p,$J[2]=$A[2]*$p},$d.lerp=function($i,$p,$F,$J){var $A=$J.elements,$t=$i.elements,$q=$p.elements,$B=$t[0],$O=$t[1],$U=$t[2];$A[0]=$B+$F*($q[0]-$B),$A[1]=$O+$F*($q[1]-$O),$A[2]=$U+$F*($q[2]-$U)},$d.transformV3ToV3=function($i,$p,$F){var $J=$d._tempVector4;$d.transformV3ToV4($i,$p,$J);var $A=$J.elements,$t=$F.elements;$t[0]=$A[0],$t[1]=$A[1],$t[2]=$A[2]},$d.transformV3ToV4=function($i,$p,$F){var $J=$i.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=$p.elements,$O=$F.elements;$O[0]=$A*$B[0]+$t*$B[4]+$q*$B[8]+$B[12],$O[1]=$A*$B[1]+$t*$B[5]+$q*$B[9]+$B[13],$O[2]=$A*$B[2]+$t*$B[6]+$q*$B[10]+$B[14],$O[3]=$A*$B[3]+$t*$B[7]+$q*$B[11]+$B[15]},$d.TransformNormal=function($i,$p,$F){var $J=$i.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=$p.elements,$O=$F.elements;$O[0]=$A*$B[0]+$t*$B[4]+$q*$B[8],$O[1]=$A*$B[1]+$t*$B[5]+$q*$B[9],$O[2]=$A*$B[2]+$t*$B[6]+$q*$B[10]},$d.transformCoordinate=function($i,$p,$F){var $J=$d._tempVector4.elements,$A=$i.elements,$t=$A[0],$q=$A[1],$B=$A[2],$O=$p.elements;$J[0]=$t*$O[0]+$q*$O[4]+$B*$O[8]+$O[12],$J[1]=$t*$O[1]+$q*$O[5]+$B*$O[9]+$O[13],$J[2]=$t*$O[2]+$q*$O[6]+$B*$O[10]+$O[14],$J[3]=1/($t*$O[3]+$q*$O[7]+$B*$O[11]+$O[15]);var $U=$F.elements;$U[0]=$J[0]*$J[3],$U[1]=$J[1]*$J[3],$U[2]=$J[2]*$J[3]},$d.Clamp=function($i,$p,$F,$J){var $A=$i.elements,$t=$A[0],$q=$A[1],$B=$A[2],$O=$p.elements,$U=$O[0],$d=$O[1],$u=$O[2],$S=$F.elements,$Z=$S[0],$s=$S[1],$x=$S[2],$j=$J.elements;$t=($t=$Z<$t?$Z:$t)<$U?$U:$t,$q=($q=$s<$q?$s:$q)<$d?$d:$q,$B=($B=$x<$B?$x:$B)<$u?$u:$B,$j[0]=$t,$j[1]=$q,$j[2]=$B},$d.add=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]+$t[0],$J[1]=$A[1]+$t[1],$J[2]=$A[2]+$t[2]},$d.subtract=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]-$t[0],$J[1]=$A[1]-$t[1],$J[2]=$A[2]-$t[2]},$d.cross=function($i,$p,$F){var $J=$i.elements,$A=$p.elements,$t=$F.elements,$q=$J[0],$B=$J[1],$O=$J[2],$U=$A[0],$d=$A[1],$u=$A[2];$t[0]=$B*$u-$O*$d,$t[1]=$O*$U-$q*$u,$t[2]=$q*$d-$B*$U},$d.dot=function($i,$p){var $F=$i.elements,$J=$p.elements;return $F[0]*$J[0]+$F[1]*$J[1]+$F[2]*$J[2]},$d.equals=function($i,$p){var $F=$i.elements,$J=$p.elements;return $li.nearEqual(Math.abs($F[0]),Math.abs($J[0]))&&$li.nearEqual(Math.abs($F[1]),Math.abs($J[1]))&&$li.nearEqual(Math.abs($F[2]),Math.abs($J[2]))},$d.ZERO=new $d(0,0,0),$d.ONE=new $d(1,1,1),$d.NegativeUnitX=new $d(-1,0,0),$d.UnitX=new $d(1,0,0),$d.UnitY=new $d(0,1,0),$d.UnitZ=new $d(0,0,1),$d.ForwardRH=new $d(0,0,-1),$d.ForwardLH=new $d(0,0,1),$d.Up=new $d(0,1,0),$d.NAN=new $d(NaN,NaN,NaN),$u($d,["_tempVector4",function(){return this._tempVector4=new $Bp}]),$d}(),$Bp=function(){function $i($i,$p,$F,$J){this.elements=new Float32Array(4),void 0===$i&&($i=0),void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=0);var $A=this.elements;$A[0]=$i,$A[1]=$p,$A[2]=$F,$A[3]=$J}$Z($i,"laya.d3.math.Vector4");var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.IClone":!0}),$p.fromArray=function($i,$p){void 0===$p&&($p=0),this.elements[0]=$i[$p+0],this.elements[1]=$i[$p+1],this.elements[2]=$i[$p+2],this.elements[3]=$i[$p+3]},$p.cloneTo=function($i){var $p=$i.elements,$F=this.elements;$p[0]=$F[0],$p[1]=$F[1],$p[2]=$F[2],$p[3]=$F[3]},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$p.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},$p.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},$s(0,$p,"x",function(){return this.elements[0]},function($i){this.elements[0]=$i}),$s(0,$p,"y",function(){return this.elements[1]},function($i){this.elements[1]=$i}),$s(0,$p,"z",function(){return this.elements[2]},function($i){this.elements[2]=$i}),$s(0,$p,"w",function(){return this.elements[3]},function($i){this.elements[3]=$i}),$i.lerp=function($i,$p,$F,$J){var $A=$J.elements,$t=$i.elements,$q=$p.elements,$B=$t[0],$O=$t[1],$U=$t[2],$d=$t[3];$A[0]=$B+$F*($q[0]-$B),$A[1]=$O+$F*($q[1]-$O),$A[2]=$U+$F*($q[2]-$U),$A[3]=$d+$F*($q[3]-$d)},$i.transformByM4x4=function($i,$p,$F){var $J=$i.elements,$A=$J[0],$t=$J[1],$q=$J[2],$B=$J[3],$O=$p.elements,$U=$F.elements;$U[0]=$A*$O[0]+$t*$O[4]+$q*$O[8]+$B*$O[12],$U[1]=$A*$O[1]+$t*$O[5]+$q*$O[9]+$B*$O[13],$U[2]=$A*$O[2]+$t*$O[6]+$q*$O[10]+$B*$O[14],$U[3]=$A*$O[3]+$t*$O[7]+$q*$O[11]+$B*$O[15]},$i.equals=function($i,$p){var $F=$i.elements,$J=$p.elements;return $li.nearEqual(Math.abs($F[0]),Math.abs($J[0]))&&$li.nearEqual(Math.abs($F[1]),Math.abs($J[1]))&&$li.nearEqual(Math.abs($F[2]),Math.abs($J[2]))&&$li.nearEqual(Math.abs($F[3]),Math.abs($J[3]))},$i.normalize=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$i.length();0<$A&&($J[0]=$F[0]*$A,$J[1]=$F[1]*$A,$J[2]=$F[2]*$A,$J[3]=$F[3]*$A)},$i.add=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]+$t[0],$J[1]=$A[1]+$t[1],$J[2]=$A[2]+$t[2],$J[3]=$A[3]+$t[3]},$i.subtract=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]-$t[0],$J[1]=$A[1]-$t[1],$J[2]=$A[2]-$t[2],$J[3]=$A[3]-$t[3]},$i.multiply=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=$A[0]*$t[0],$J[1]=$A[1]*$t[1],$J[2]=$A[2]*$t[2],$J[3]=$A[3]*$t[3]},$i.scale=function($i,$p,$F){var $J=$F.elements,$A=$i.elements;$J[0]=$A[0]*$p,$J[1]=$A[1]*$p,$J[2]=$A[2]*$p,$J[3]=$A[3]*$p},$i.Clamp=function($i,$p,$F,$J){var $A=$i.elements,$t=$A[0],$q=$A[1],$B=$A[2],$O=$A[3],$U=$p.elements,$d=$U[0],$u=$U[1],$S=$U[2],$Z=$U[3],$s=$F.elements,$x=$s[0],$j=$s[1],$r=$s[2],$M=$s[3],$D=$J.elements;$t=($t=$x<$t?$x:$t)<$d?$d:$t,$q=($q=$j<$q?$j:$q)<$u?$u:$q,$B=($B=$r<$B?$r:$B)<$S?$S:$B,$O=($O=$M<$O?$M:$O)<$Z?$Z:$O,$D[0]=$t,$D[1]=$q,$D[2]=$B,$D[3]=$O},$i.distanceSquared=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0]-$J[0],$t=$F[1]-$J[1],$q=$F[2]-$J[2],$B=$F[3]-$J[3];return $A*$A+$t*$t+$q*$q+$B*$B},$i.distance=function($i,$p){var $F=$i.elements,$J=$p.elements,$A=$F[0]-$J[0],$t=$F[1]-$J[1],$q=$F[2]-$J[2],$B=$F[3]-$J[3];return Math.sqrt($A*$A+$t*$t+$q*$q+$B*$B)},$i.dot=function($i,$p){var $F=$i.elements,$J=$p.elements;return $F[0]*$J[0]+$F[1]*$J[1]+$F[2]*$J[2]+$F[3]*$J[3]},$i.min=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=Math.min($A[0],$t[0]),$J[1]=Math.min($A[1],$t[1]),$J[2]=Math.min($A[2],$t[2]),$J[3]=Math.min($A[3],$t[3])},$i.max=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p.elements;$J[0]=Math.max($A[0],$t[0]),$J[1]=Math.max($A[1],$t[1]),$J[2]=Math.max($A[2],$t[2]),$J[3]=Math.max($A[3],$t[3])},$u($i,["ZERO",function(){return this.ZERO=new $i},"ONE",function(){return this.ONE=new $i(1,1,1,1)},"UnitX",function(){return this.UnitX=new $i(1,0,0,0)},"UnitY",function(){return this.UnitY=new $i(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new $i(0,0,1,0)},"UnitW",function(){return this.UnitW=new $i(0,0,0,1)}]),$i}(),$Op=function(){function $t($i,$p,$F,$J){this.minDepth=0,this.maxDepth=1,this.x=$i,this.y=$p,this.width=$F,this.height=$J}$Z($t,"laya.d3.math.Viewport");var $i=$t.prototype;return $i.project=function($i,$p,$F){$qp.transformV3ToV3($i,$p,$F);var $J=$i.elements,$A=$p.elements,$t=$F.elements,$q=$J[0]*$A[3]+$J[1]*$A[7]+$J[2]*$A[11]+$A[15];1!==$q&&($t[0]=$t[0]/$q,$t[1]=$t[1]/$q,$t[2]=$t[2]/$q),$t[0]=.5*($t[0]+1)*this.width+this.x,$t[1]=.5*(1-$t[1])*this.height+this.y,$t[2]=$t[2]*(this.maxDepth-this.minDepth)+this.minDepth},$i.unprojectFromMat=function($i,$p,$F){var $J=$i.elements,$A=$p.elements,$t=$F.elements;$t[0]=($J[0]-this.x)/this.width*2-1,$t[1]=-(($J[1]-this.y)/this.height*2-1);var $q=(this.maxDepth-this.minDepth)/2;$t[2]=($J[2]-this.minDepth-$q)/$q;var $B=$t[0]*$A[3]+$t[1]*$A[7]+$t[2]*$A[11]+$A[15];$qp.transformV3ToV3($F,$p,$F),1!==$B&&($t[0]=$t[0]/$B,$t[1]=$t[1]/$B,$t[2]=$t[2]/$B)},$i.unprojectFromWVP=function($i,$p,$F,$J,$A){$ip.multiply($p,$F,$t._tempMatrix4x4),$J&&$ip.multiply($t._tempMatrix4x4,$J,$t._tempMatrix4x4),$t._tempMatrix4x4.invert($t._tempMatrix4x4),this.unprojectFromMat($i,$t._tempMatrix4x4,$A)},$u($t,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new $ip}]),$t}(),$Up=function(){function $c($i){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=$i,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}$Z($c,"laya.d3.resource.models.SubMesh");var $i=$c.prototype;return $v.imps($i,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),$i._getVertexBuffer=function($i){return void 0===$i&&($i=0),0===$i?this._vertexBuffer:null},$i._getIndexBuffer=function(){return this._indexBuffer},$i._getStaticBatchBakedVertexs=function($i,$p){var $F,$J,$A=this._vertexBuffer,$t=$A.vertexDeclaration,$q=$t.getVertexElementByUsage(0).offset/4,$B=$t.getVertexElementByUsage(3).offset/4,$O=$p.meshRender.lightmapScaleOffset,$U=0,$d=0,$u=0,$S=0,$Z=0,$s=0;if($O)if($J=$t.getVertexElementByUsage(15))$u=$t.vertexStride/4,$F=0<this._vertexCount?$A.getData().slice(this._vertexStart*$u,(this._vertexStart+this._vertexCount)*$u):$A.getData().slice(),$S=$J.offset/4;else{$u=($s=$t.vertexStride/4)+2,$F=this._vertexCount?new Float32Array(this._vertexCount*($A.vertexDeclaration.vertexStride/4+2)):new Float32Array($A.vertexCount*($A.vertexDeclaration.vertexStride/4+2)),$S=($Z=$t.getVertexElementByUsage(2).offset/4)+2;var $x=$A.getData();for($U=0,$d=$x.length/$s;$U<$d;$U++){var $j=0;$j=0<this._vertexCount?(this._vertexStart+$U)*$s:$U*$s;var $r=$U*$u,$M=0;for($M=0;$M<$S;$M++)$F[$r+$M]=$x[$j+$M];for($M=$S;$M<$s;$M++)$F[$r+$M+2]=$x[$j+$M]}}else $u=$t.vertexStride/4,$F=this._vertexCount?$A.getData().slice(this._vertexStart*$u,(this._vertexStart+this._vertexCount)*$u):$A.getData().slice();if($i){var $D=$i.worldMatrix,$E=$c._tempMatrix4x40;$D.invert($E);var $v=$c._tempMatrix4x41,$g=$p.transform.worldMatrix;$ip.multiply($E,$g,$v)}else $v=$p.transform.worldMatrix;var $a=$c._tempQuaternion0;for($v.decomposeTransRotScale($c._tempVector30,$a,$c._tempVector31),$U=0,$d=$F.length/$u;$U<$d;$U++){var $R=$U*$u+$q,$Q=$U*$u+$B;if($jp.transformVector3ArrayToVector3ArrayCoordinate($F,$R,$v,$F,$R),$jp.transformVector3ArrayByQuat($F,$Q,$a,$F,$Q),$O){var $P=$U*$u+$S;if($J)$jp.transformLightingMapTexcoordByUV1Array($F,$P,$O,$F,$P);else{var $Y=$U*$s+$Z;$jp.transformLightingMapTexcoordByUV0Array($x,$Y,$O,$F,$P)}}}return $F},$i._getVertexBuffers=function(){return null},$i._beforeRender=function($i){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$i._render=function($i){var $p,$F=0,$J=$i.renderElement;if(1<this._indexCount){var $A=this._boneIndicesList.length;if(1<$A){for(var $t=0;$t<$A;$t++)($p=$J._skinAnimationDatas||this._skinAnimationDatas)&&($J._shaderValue.setValue(0,$p[$t]),$i._shader.uploadRenderElementUniforms($J._shaderValue.data)),$h.mainContext.drawElements(4,this._subIndexBufferCount[$t],5123,2*this._subIndexBufferStart[$t]);$R.drawCall+=$A}else($p=$J._skinAnimationDatas||this._skinAnimationDatas)&&($J._shaderValue.setValue(0,$p[0]),$i._shader.uploadRenderElementUniforms($J._shaderValue.data)),$h.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),$R.drawCall++;$F=this._indexCount}else $F=this._indexBuffer.indexCount,($p=$J._skinAnimationDatas||this._skinAnimationDatas)&&($J._shaderValue.setValue(0,$p[0]),$i._shader.uploadRenderElementUniforms($J._shaderValue.data)),$h.mainContext.drawElements(4,$F,5123,0),$R.drawCall++;$R.trianglesFaces+=$F/3},$i.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},$i.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},$s(0,$i,"_vertexBufferCount",function(){return 1}),$s(0,$i,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$u($c,["_tempVector30",function(){return this._tempVector30=new $qp},"_tempVector31",function(){return this._tempVector31=new $qp},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Fp},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new $ip},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new $ip}]),$c}(),$dp=function(){function $i($i){this.defineCounter=0,this.defines=null,$i?(this.defineCounter=$i.defineCounter,this.defines=$i.defines.slice()):(this.defineCounter=0,this.defines=[])}return $Z($i,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),$i.prototype.registerDefine=function($i){var $p=Math.pow(2,this.defineCounter++);return this.defines[$p]=$i,$p},$i}(),$up=function(){function $i(){}return $Z($i,"laya.d3.shader.ShaderInit3D"),$i.__init__=function(){var $i,$p;$Rp._globalRegDefine("HIGHPRECISION",$Rp.SHADERDEFINE_HIGHPRECISION),$Rp._globalRegDefine("FOG",$Rp.SHADERDEFINE_FOG),$Rp._globalRegDefine("DIRECTIONLIGHT",$Rp.SHADERDEFINE_DIRECTIONLIGHT),$Rp._globalRegDefine("POINTLIGHT",$Rp.SHADERDEFINE_POINTLIGHT),$Rp._globalRegDefine("SPOTLIGHT",$Rp.SHADERDEFINE_SPOTLIGHT),$Rp._globalRegDefine("UV",$Rp.SHADERDEFINE_UV0),$Rp._globalRegDefine("COLOR",$Rp.SHADERDEFINE_COLOR),$Rp._globalRegDefine("UV1",$Rp.SHADERDEFINE_UV1),$Rp._globalRegDefine("CASTSHADOW",$Zp.SHADERDEFINE_CAST_SHADOW),$Rp._globalRegDefine("SHADOWMAP_PSSM1",$Zp.SHADERDEFINE_SHADOW_PSSM1),$Rp._globalRegDefine("SHADOWMAP_PSSM2",$Zp.SHADERDEFINE_SHADOW_PSSM2),$Rp._globalRegDefine("SHADOWMAP_PSSM3",$Zp.SHADERDEFINE_SHADOW_PSSM3),$Rp._globalRegDefine("SHADOWMAP_PCF_NO",$Zp.SHADERDEFINE_SHADOW_PCF_NO),$Rp._globalRegDefine("SHADOWMAP_PCF1",$Zp.SHADERDEFINE_SHADOW_PCF1),$Rp._globalRegDefine("SHADOWMAP_PCF2",$Zp.SHADERDEFINE_SHADOW_PCF2),$Rp._globalRegDefine("SHADOWMAP_PCF3",$Zp.SHADERDEFINE_SHADOW_PCF3),$Rp._globalRegDefine("DEPTHFOG",$Rp.SAHDERDEFINE_DEPTHFOG),$yp.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),$yp.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),$i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},$p={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var $F=$yp.nameKey.add("SIMPLE");shaderCompile=$Rp.add($F,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',$i,$p),$Np.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),$Np.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),$Np.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),$Np.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),$Np.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),$Np.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),$Np.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),$Np.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),$Np.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},$i}(),$Sp=function(){function $i(){this._data=null,this._data=[]}$Z($i,"laya.d3.shader.ValusArray");var $p=$i.prototype;return $p.setValue=function($i,$p){this._data[$i]=$p},$s(0,$p,"data",function(){return this._data}),$i}(),$Zp=function(){function $i(){}return $i.SHADERDEFINE_RECEIVE_SHADOW=1,$i.SHADERDEFINE_CAST_SHADOW=512,$i.SHADERDEFINE_SHADOW_PSSM1=1024,$i.SHADERDEFINE_SHADOW_PSSM2=2048,$i.SHADERDEFINE_SHADOW_PSSM3=4096,$i.SHADERDEFINE_SHADOW_PCF_NO=8192,$i.SHADERDEFINE_SHADOW_PCF1=16384,$i.SHADERDEFINE_SHADOW_PCF2=32768,$i.SHADERDEFINE_SHADOW_PCF3=65536,$i.MAX_PSSM_COUNT=3,$i}(),$sp=function(){function $$(){}return $Z($$,"laya.d3.utils.Picker"),$$.calculateCursorRay=function($i,$p,$F,$J,$A,$t){var $q=$i.elements[0],$B=$i.elements[1],$O=$$._tempVector30,$U=$O.elements;$U[0]=$q,$U[1]=$B,$U[2]=$p.minDepth;var $d=$$._tempVector31,$u=$d.elements;$u[0]=$q,$u[1]=$B,$u[2]=$p.maxDepth;var $S=$t.origin,$Z=$$._tempVector32;$p.unprojectFromWVP($O,$F,$J,$A,$S),$p.unprojectFromWVP($d,$F,$J,$A,$Z);var $s=$t.direction.elements;$s[0]=$Z.x-$S.x,$s[1]=$Z.y-$S.y,$s[2]=$Z.z-$S.z,$qp.normalize($t.direction,$t.direction)},$$.rayIntersectsPositionsAndIndices=function($i,$p,$F,$J,$A){for(var $t=$F.vertexStride/4,$q=$F.getVertexElementByUsage(0).offset/4,$B=Number.MAX_VALUE,$O=-1,$U=-1,$d=-1,$u=0;$u<$J.length;$u+=3){var $S=$$._tempVector35,$Z=$S.elements,$s=$J[$u]*$t,$x=$s+$q;$Z[0]=$p[$x],$Z[1]=$p[1+$x],$Z[2]=$p[2+$x];var $j=$$._tempVector36,$r=$j.elements,$M=$J[$u+1]*$t,$D=$M+$q;$r[0]=$p[$D],$r[1]=$p[1+$D],$r[2]=$p[2+$D];var $E=$$._tempVector37,$v=$E.elements,$g=$J[$u+2]*$t,$a=$g+$q;$v[0]=$p[$a],$v[1]=$p[1+$a],$v[2]=$p[2+$a];var $R=laya.d3.utils.Picker.rayIntersectsTriangle($i,$S,$j,$E);!isNaN($R)&&$R<$B&&($B=$R,$O=$s,$U=$M,$d=$g)}if($B===Number.MAX_VALUE)return $A.position.toDefault(),$A.distance=Number.MAX_VALUE,$A.trianglePositions[0].toDefault(),$A.trianglePositions[1].toDefault(),$A.trianglePositions[2].toDefault(),$A.triangleNormals[0].toDefault(),$A.triangleNormals[1].toDefault(),$A.triangleNormals[2].toDefault(),!1;$A.distance=$B,$qp.scale($i.direction,$B,$A.position),$qp.add($i.origin,$A.position,$A.position);var $Q=$A.trianglePositions,$P=$Q[0],$Y=$Q[1],$c=$Q[2],$h=$P.elements,$m=$Y.elements,$n=$c.elements,$I=$O+$q;$h[0]=$p[$I],$h[1]=$p[$I+1],$h[2]=$p[$I+2];var $G=$U+$q;$m[0]=$p[$G],$m[1]=$p[$G+1],$m[2]=$p[$G+2];var $_=$d+$q;$n[0]=$p[$_],$n[1]=$p[$_+1],$n[2]=$p[$_+2];var $y=$F.getVertexElementByUsage(3);if($y){var $N=$y.offset/4,$f=$A.triangleNormals,$o=$f[0],$W=$f[1],$L=$f[2],$C=$o.elements,$K=$W.elements,$V=$L.elements,$T=$O+$N;$C[0]=$p[$T],$C[1]=$p[$T+1],$C[2]=$p[$T+2];var $k=$U+$N;$K[0]=$p[$k],$K[1]=$p[$k+1],$K[2]=$p[$k+2];var $w=$d+$N;$V[0]=$p[$w],$V[1]=$p[$w+1],$V[2]=$p[$w+2]}return!0},$$.rayIntersectsTriangle=function($i,$p,$F,$J){var $A=$$._tempVector30,$t=$$._tempVector31;$qp.subtract($F,$p,$A),$qp.subtract($J,$p,$t);var $q,$B=$$._tempVector32;if($qp.cross($i.direction,$t,$B),($q=$qp.dot($A,$B))>-Number.MIN_VALUE&&$q<Number.MIN_VALUE)return Number.NaN;var $O,$U=1/$q,$d=$$._tempVector33;if($qp.subtract($i.origin,$p,$d),$O=$qp.dot($d,$B),($O*=$U)<0||1<$O)return Number.NaN;var $u,$S,$Z=$$._tempVector34;return $qp.cross($d,$A,$Z),$u=$qp.dot($i.direction,$Z),($u*=$U)<0||1<$O+$u?Number.NaN:($S=$qp.dot($t,$Z),($S*=$U)<0?Number.NaN:$S)},$u($$,["_tempVector30",function(){return this._tempVector30=new $qp},"_tempVector31",function(){return this._tempVector31=new $qp},"_tempVector32",function(){return this._tempVector32=new $qp},"_tempVector33",function(){return this._tempVector33=new $qp},"_tempVector34",function(){return this._tempVector34=new $qp},"_tempVector35",function(){return this._tempVector35=new $qp},"_tempVector36",function(){return this._tempVector36=new $qp},"_tempVector37",function(){return this._tempVector37=new $qp}]),$$}(),$xp=(function(){function $i(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new $qp,new $qp,new $qp],this.trianglePositions.length=3,this.triangleNormals=[new $qp,new $qp,new $qp],this.triangleNormals.length=3,this.position=new $qp}$Z($i,"laya.d3.utils.RaycastHit"),$i.prototype.cloneTo=function($i){$i.distance=this.distance,this.trianglePositions[0].cloneTo($i.trianglePositions[0]),this.trianglePositions[1].cloneTo($i.trianglePositions[1]),this.trianglePositions[2].cloneTo($i.trianglePositions[2]),this.triangleNormals[0].cloneTo($i.triangleNormals[0]),this.triangleNormals[1].cloneTo($i.triangleNormals[1]),this.triangleNormals[2].cloneTo($i.triangleNormals[2]),this.position.cloneTo($i.position),$i.sprite3D=this.sprite3D}}(),function(){function $i($i,$p){this._width=0,this._height=0,this._width=$i,this._height=$p}$Z($i,"laya.d3.utils.Size");var $p=$i.prototype;return $s(0,$p,"width",function(){return-1===this._width?$X.clientWidth:this._width}),$s(0,$p,"height",function(){return-1===this._height?$X.clientHeight:this._height}),$s(1,$i,"fullScreen",function(){return new $i(-1,-1)}),$i}()),$jp=function(){function $I(){}return $Z($I,"laya.d3.utils.Utils3D"),$I._rotationTransformScaleSkinAnimation=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u){var $S,$Z,$s,$x,$j,$r=$I._tempArray16_0,$M=$I._tempArray16_1,$D=$I._tempArray16_2,$E=$J+$J,$v=$A+$A,$g=$t+$t,$a=$J*$E,$R=$A*$E,$Q=$A*$v,$P=$t*$E,$Y=$t*$v,$c=$t*$g,$h=$q*$E,$m=$q*$v,$n=$q*$g;for($r[15]=1,$r[0]=1-$Q-$c,$r[1]=$R+$n,$r[2]=$P-$m,$r[4]=$R-$n,$r[5]=1-$a-$c,$r[6]=$Y+$h,$r[8]=$P+$m,$r[9]=$Y-$h,$r[10]=1-$a-$Q,$M[15]=1,$M[0]=$B,$M[5]=$O,$M[10]=$U,$S=0;$S<4;$S++)$Z=$r[$S],$s=$r[$S+4],$x=$r[$S+8],$j=$r[$S+12],$D[$S]=$Z,$D[$S+4]=$s,$D[$S+8]=$x,$D[$S+12]=$Z*$i+$s*$p+$x*$F+$j;for($S=0;$S<4;$S++)$Z=$D[$S],$s=$D[$S+4],$x=$D[$S+8],$j=$D[$S+12],$d[$S+$u]=$Z*$M[0]+$s*$M[1]+$x*$M[2]+$j*$M[3],$d[$S+$u+4]=$Z*$M[4]+$s*$M[5]+$x*$M[6]+$j*$M[7],$d[$S+$u+8]=$Z*$M[8]+$s*$M[9]+$x*$M[10]+$j*$M[11],$d[$S+$u+12]=$Z*$M[12]+$s*$M[13]+$x*$M[14]+$j*$M[15]},$I._createNodeByJson=function($i,$p,$F,$J){if(!$F)switch($p.type){case"Sprite3D":$F=new $_p;break;case"MeshSprite3D":$F=new $$p;break;case"SkinnedMeshSprite3D":$F=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":$F=new ShuriKenParticle3D;break;case"TrailSprite3D":$F=new TrailSprite3D;break;case"Terrain":$F=new Terrain;break;case"Camera":$F=new $wp;break;case"DirectionLight":$F=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var $A=$p.props;if($A)for(var $t in $A)$F[$t]=$A[$t];var $q=$p.customProps;$q&&($F instanceof laya.d3.core.Sprite3D?($F._parseBaseCustomProps($q),$F._parseCustomProps($i,$J,$q,$p),$F._parseCustomComponent($i,$J,$p.components)):$F._parseCustomProps($i,$J,$q,$p));var $B=$p.child;if($B)for(var $O=0,$U=$B.length;$O<$U;$O++){var $d=$I._createNodeByJson($i,$B[$O],null,$J);$F.addChild($d)}return $F},$I._computeBoneAndAnimationDatasByBindPoseMatrxix=function($i,$p,$F,$J,$A,$t){var $q,$B,$O=0,$U=0,$d=$i.length;for($q=0;$q<$d;$O+=$i[$q].keyframeWidth,$U+=16,$q++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($p[$O+0],$p[$O+1],$p[$O+2],$p[$O+3],$p[$O+4],$p[$O+5],$p[$O+6],$p[$O+7],$p[$O+8],$p[$O+9],$J,$U),0!=$q&&($B=16*$i[$q].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($J,$B,$J,$U,$J,$U));var $u=$F.length;for($q=0;$q<$u;$q++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($J,16*$t[$q],$F[$q],$A,16*$q)},$I._computeAnimationDatasByArrayAndMatrixFast=function($i,$p,$F,$J){for(var $A=0,$t=$i.length;$A<$t;$A++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($p,16*$J[$A],$i[$A],$F,16*$A)},$I._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function($i,$p,$F,$J,$A){var $t,$q,$B=0,$O=0,$U=$i.length;for($t=0;$t<$U;$B+=$i[$t].keyframeWidth,$O+=16,$t++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation($p[$B+7],$p[$B+8],$p[$B+9],$p[$B+3],$p[$B+4],$p[$B+5],$p[$B+6],$p[$B+0],$p[$B+1],$p[$B+2],$J,$O),0!=$t&&($q=16*$i[$t].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray($J,$q,$J,$O,$J,$O));var $d=$F.length;for($t=0;$t<$d;$t++){var $u=16*$t;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($J,$u,$F[$t],$A,$u)}},$I._computeAnimationDatasByArrayAndMatrixFastOld=function($i,$p,$F){for(var $J=$i.length,$A=0;$A<$J;$A++){var $t=16*$A;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast($p,$t,$i[$A],$F,$t)}},$I._computeRootAnimationData=function($i,$p,$F){for(var $J=0,$A=0,$t=0,$q=$i.length;$J<$q;$A+=$i[$J].keyframeWidth,$t+=16,$J++)laya.d3.utils.Utils3D.createAffineTransformationArray($p[$A+0],$p[$A+1],$p[$A+2],$p[$A+3],$p[$A+4],$p[$A+5],$p[$A+6],$p[$A+7],$p[$A+8],$p[$A+9],$F,$t)},$I.transformVector3ArrayByQuat=function($i,$p,$F,$J,$A){var $t=$F.elements,$q=$i[$p],$B=$i[$p+1],$O=$i[$p+2],$U=$t[0],$d=$t[1],$u=$t[2],$S=$t[3],$Z=$S*$q+$d*$O-$u*$B,$s=$S*$B+$u*$q-$U*$O,$x=$S*$O+$U*$B-$d*$q,$j=-$U*$q-$d*$B-$u*$O;$J[$A]=$Z*$S+$j*-$U+$s*-$u-$x*-$d,$J[$A+1]=$s*$S+$j*-$d+$x*-$U-$Z*-$u,$J[$A+2]=$x*$S+$j*-$u+$Z*-$d-$s*-$U},$I.mulMatrixByArray=function($i,$p,$F,$J,$A,$t){var $q,$B,$O,$U,$d;if($A===$F){for($F=$I._tempArray16_3,$q=0;$q<16;++$q)$F[$q]=$A[$t+$q];$J=0}for($q=0;$q<4;$q++)$B=$i[$p+$q],$O=$i[$p+$q+4],$U=$i[$p+$q+8],$d=$i[$p+$q+12],$A[$t+$q]=$B*$F[$J+0]+$O*$F[$J+1]+$U*$F[$J+2]+$d*$F[$J+3],$A[$t+$q+4]=$B*$F[$J+4]+$O*$F[$J+5]+$U*$F[$J+6]+$d*$F[$J+7],$A[$t+$q+8]=$B*$F[$J+8]+$O*$F[$J+9]+$U*$F[$J+10]+$d*$F[$J+11],$A[$t+$q+12]=$B*$F[$J+12]+$O*$F[$J+13]+$U*$F[$J+14]+$d*$F[$J+15]},$I.mulMatrixByArrayFast=function($i,$p,$F,$J,$A,$t){var $q,$B,$O,$U,$d;for($q=0;$q<4;$q++)$B=$i[$p+$q],$O=$i[$p+$q+4],$U=$i[$p+$q+8],$d=$i[$p+$q+12],$A[$t+$q]=$B*$F[$J+0]+$O*$F[$J+1]+$U*$F[$J+2]+$d*$F[$J+3],$A[$t+$q+4]=$B*$F[$J+4]+$O*$F[$J+5]+$U*$F[$J+6]+$d*$F[$J+7],$A[$t+$q+8]=$B*$F[$J+8]+$O*$F[$J+9]+$U*$F[$J+10]+$d*$F[$J+11],$A[$t+$q+12]=$B*$F[$J+12]+$O*$F[$J+13]+$U*$F[$J+14]+$d*$F[$J+15]},$I.mulMatrixByArrayAndMatrixFast=function($i,$p,$F,$J,$A){var $t,$q,$B,$O,$U,$d=$F.elements,$u=$d[0],$S=$d[1],$Z=$d[2],$s=$d[3],$x=$d[4],$j=$d[5],$r=$d[6],$M=$d[7],$D=$d[8],$E=$d[9],$v=$d[10],$g=$d[11],$a=$d[12],$R=$d[13],$Q=$d[14],$P=$d[15],$Y=$p,$c=$p+4,$h=$p+8,$m=$p+12,$n=$A,$I=$A+4,$G=$A+8,$_=$A+12;for($t=0;$t<4;$t++)$q=$i[$Y+$t],$B=$i[$c+$t],$O=$i[$h+$t],$U=$i[$m+$t],$J[$n+$t]=$q*$u+$B*$S+$O*$Z+$U*$s,$J[$I+$t]=$q*$x+$B*$j+$O*$r+$U*$M,$J[$G+$t]=$q*$D+$B*$E+$O*$v+$U*$g,$J[$_+$t]=$q*$a+$B*$R+$O*$Q+$U*$P},$I.createAffineTransformationArray=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u){var $S=$J+$J,$Z=$A+$A,$s=$t+$t,$x=$J*$S,$j=$J*$Z,$r=$J*$s,$M=$A*$Z,$D=$A*$s,$E=$t*$s,$v=$q*$S,$g=$q*$Z,$a=$q*$s;$d[$u+0]=(1-($M+$E))*$B,$d[$u+1]=($j+$a)*$B,$d[$u+2]=($r-$g)*$B,$d[$u+3]=0,$d[$u+4]=($j-$a)*$O,$d[$u+5]=(1-($x+$E))*$O,$d[$u+6]=($D+$v)*$O,$d[$u+7]=0,$d[$u+8]=($r+$g)*$U,$d[$u+9]=($D-$v)*$U,$d[$u+10]=(1-($x+$M))*$U,$d[$u+11]=0,$d[$u+12]=$i,$d[$u+13]=$p,$d[$u+14]=$F,$d[$u+15]=1},$I.transformVector3ArrayToVector3ArrayCoordinate=function($i,$p,$F,$J,$A){var $t=$I._tempArray4_0,$q=$i[$p+0],$B=$i[$p+1],$O=$i[$p+2],$U=$F.elements;$t[0]=$q*$U[0]+$B*$U[4]+$O*$U[8]+$U[12],$t[1]=$q*$U[1]+$B*$U[5]+$O*$U[9]+$U[13],$t[2]=$q*$U[2]+$B*$U[6]+$O*$U[10]+$U[14],$t[3]=1/($q*$U[3]+$B*$U[7]+$O*$U[11]+$U[15]),$J[$A+0]=$t[0]*$t[3],$J[$A+1]=$t[1]*$t[3],$J[$A+2]=$t[2]*$t[3]},$I.transformLightingMapTexcoordByUV0Array=function($i,$p,$F,$J,$A){var $t=$F.elements;$J[$A+0]=$i[$p+0]*$t[0]+$t[2],$J[$A+1]=($i[$p+1]-1)*$t[1]+$t[3]},$I.transformLightingMapTexcoordByUV1Array=function($i,$p,$F,$J,$A){var $t=$F.elements;$J[$A+0]=$i[$p+0]*$t[0]+$t[2],$J[$A+1]=1+$i[$p+1]*$t[1]+$t[3]},$I.getURLVerion=function($i){var $p=$i.indexOf("?");return 0<=$p?$i.substr($p):null},$I._quaternionCreateFromYawPitchRollArray=function($i,$p,$F,$J){var $A=.5*$F,$t=.5*$p,$q=.5*$i,$B=Math.sin($A),$O=Math.cos($A),$U=Math.sin($t),$d=Math.cos($t),$u=Math.sin($q),$S=Math.cos($q);$J[0]=$S*$U*$O+$u*$d*$B,$J[1]=$u*$d*$O-$S*$U*$B,$J[2]=$S*$d*$B-$u*$U*$O,$J[3]=$S*$d*$O+$u*$U*$B},$I._createAffineTransformationArray=function($i,$p,$F,$J){var $A=$p[0],$t=$p[1],$q=$p[2],$B=$p[3],$O=$A+$A,$U=$t+$t,$d=$q+$q,$u=$A*$O,$S=$A*$U,$Z=$A*$d,$s=$t*$U,$x=$t*$d,$j=$q*$d,$r=$B*$O,$M=$B*$U,$D=$B*$d,$E=$F[0],$v=$F[1],$g=$F[2];$J[0]=(1-($s+$j))*$E,$J[1]=($S+$D)*$E,$J[2]=($Z-$M)*$E,$J[3]=0,$J[4]=($S-$D)*$v,$J[5]=(1-($u+$j))*$v,$J[6]=($x+$r)*$v,$J[7]=0,$J[8]=($Z+$M)*$g,$J[9]=($x-$r)*$g,$J[10]=(1-($u+$s))*$g,$J[11]=0,$J[12]=$i[0],$J[13]=$i[1],$J[14]=$i[2],$J[15]=1},$I._mulMatrixArray=function($i,$p,$F,$J){var $A,$t,$q,$B,$O,$U=$p.elements,$d=$U[0],$u=$U[1],$S=$U[2],$Z=$U[3],$s=$U[4],$x=$U[5],$j=$U[6],$r=$U[7],$M=$U[8],$D=$U[9],$E=$U[10],$v=$U[11],$g=$U[12],$a=$U[13],$R=$U[14],$Q=$U[15],$P=$J,$Y=$J+4,$c=$J+8,$h=$J+12;for($A=0;$A<4;$A++)$t=$i[$A],$q=$i[$A+4],$B=$i[$A+8],$O=$i[$A+12],$F[$P+$A]=$t*$d+$q*$u+$B*$S+$O*$Z,$F[$Y+$A]=$t*$s+$q*$x+$B*$j+$O*$r,$F[$c+$A]=$t*$M+$q*$D+$B*$E+$O*$v,$F[$h+$A]=$t*$g+$q*$a+$B*$R+$O*$Q},$I.getYawPitchRoll=function($i,$p){$I.transformQuat($qp.ForwardRH,$i,$Fp.TEMPVector31),$I.transformQuat($qp.Up,$i,$Fp.TEMPVector32);var $F=$Fp.TEMPVector32.elements;$I.angleTo($qp.ZERO,$Fp.TEMPVector31,$Fp.TEMPVector33);var $J=$Fp.TEMPVector33.elements;$J[0]==Math.PI/2?($J[1]=$I.arcTanAngle($F[2],$F[0]),$J[2]=0):$J[0]==-Math.PI/2?($J[1]=$I.arcTanAngle(-$F[2],-$F[0]),$J[2]=0):($ip.createRotationY(-$J[1],$Fp.TEMPMatrix0),$ip.createRotationX(-$J[0],$Fp.TEMPMatrix1),$qp.transformCoordinate($Fp.TEMPVector32,$Fp.TEMPMatrix0,$Fp.TEMPVector32),$qp.transformCoordinate($Fp.TEMPVector32,$Fp.TEMPMatrix1,$Fp.TEMPVector32),$J[2]=$I.arcTanAngle($F[1],-$F[0])),$J[1]<=-Math.PI&&($J[1]=Math.PI),$J[2]<=-Math.PI&&($J[2]=Math.PI),$J[1]>=Math.PI&&$J[2]>=Math.PI&&($J[1]=0,$J[2]=0,$J[0]=Math.PI-$J[0]),$p[0]=$J[1],$p[1]=$J[0],$p[2]=$J[2]},$I.arcTanAngle=function($i,$p){return 0==$i?1==$p?Math.PI/2:-Math.PI/2:0<$i?Math.atan($p/$i):$i<0?0<$p?Math.atan($p/$i)+Math.PI:Math.atan($p/$i)-Math.PI:0},$I.angleTo=function($i,$p,$F){$qp.subtract($p,$i,$Fp.TEMPVector30),$qp.normalize($Fp.TEMPVector30,$Fp.TEMPVector30),$F.elements[0]=Math.asin($Fp.TEMPVector30.y),$F.elements[1]=$I.arcTanAngle(-$Fp.TEMPVector30.z,-$Fp.TEMPVector30.x)},$I.transformQuat=function($i,$p,$F){var $J=$F.elements,$A=$i.elements,$t=$p,$q=$A[0],$B=$A[1],$O=$A[2],$U=$t[0],$d=$t[1],$u=$t[2],$S=$t[3],$Z=$S*$q+$d*$O-$u*$B,$s=$S*$B+$u*$q-$U*$O,$x=$S*$O+$U*$B-$d*$q,$j=-$U*$q-$d*$B-$u*$O;$J[0]=$Z*$S+$j*-$U+$s*-$u-$x*-$d,$J[1]=$s*$S+$j*-$d+$x*-$U-$Z*-$u,$J[2]=$x*$S+$j*-$u+$Z*-$d-$s*-$U},$I.quaterionNormalize=function($i,$p){var $F=$i[0],$J=$i[1],$A=$i[2],$t=$i[3],$q=$F*$F+$J*$J+$A*$A+$t*$t;0<$q&&($q=1/Math.sqrt($q),$p[0]=$F*$q,$p[1]=$J*$q,$p[2]=$A*$q,$p[3]=$t*$q)},$I.matrix4x4MultiplyFFF=function($i,$p,$F){var $J,$A,$t,$q,$B;if($F===$p)for($p=new Float32Array(16),$J=0;$J<16;++$J)$p[$J]=$F[$J];for($J=0;$J<4;$J++)$A=$i[$J],$t=$i[$J+4],$q=$i[$J+8],$B=$i[$J+12],$F[$J]=$A*$p[0]+$t*$p[1]+$q*$p[2]+$B*$p[3],$F[$J+4]=$A*$p[4]+$t*$p[5]+$q*$p[6]+$B*$p[7],$F[$J+8]=$A*$p[8]+$t*$p[9]+$q*$p[10]+$B*$p[11],$F[$J+12]=$A*$p[12]+$t*$p[13]+$q*$p[14]+$B*$p[15]},$I.matrix4x4MultiplyMFM=function($i,$p,$F){$I.matrix4x4MultiplyFFF($i.elements,$p,$F.elements)},$u($I,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new $qp},"_tempVector3_1",function(){return this._tempVector3_1=new $qp},"_tempVector3_2",function(){return this._tempVector3_2=new $qp},"_tempVector3_3",function(){return this._tempVector3_3=new $qp},"_tempVector3_4",function(){return this._tempVector3_4=new $qp},"_tempVector3_5",function(){return this._tempVector3_5=new $qp},"_tempVector3_6",function(){return this._tempVector3_6=new $qp},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),$I}(),$rp=function(){function $m(){}return $Z($m,"Laya3D"),$m._cancelLoadByUrl=function($i){$v.loader.cancelLoadByUrl($i),$m._innerFirstLevelLoaderManager.cancelLoadByUrl($i),$m._innerSecondLevelLoaderManager.cancelLoadByUrl($i),$m._innerThirdLevelLoaderManager.cancelLoadByUrl($i),$m._innerFourthLevelLoaderManager.cancelLoadByUrl($i)},$m._changeWebGLSize=function($i,$p){$h.onStageResize($i,$p),$X.clientWidth=$i,$X.clientHeight=$p},$m.__init__=function(){var $i=$p.createMap;$i.lh=[$_p,"SPRITE3DHIERARCHY"],$i.ls=[$Gp,"SPRITE3DHIERARCHY"],$i.lm=[$Cp,"MESH"],$i.lmat=[$Np,"MATERIAL"],$i.jpg=[$Vp,"nativeimage"],$i.jpeg=[$Vp,"nativeimage"],$i.png=[$Vp,"nativeimage"],$i.pkm=[$Vp,"arraybuffer"],$i.raw=[$Wp,"arraybuffer"],$i.mipmaps=[$Wp,"arraybuffer"],$r.parserMap.SPRITE3DHIERARCHY=$m._loadHierarchy,$r.parserMap.MESH=$m._loadMesh,$r.parserMap.MATERIAL=$m._loadMaterial,$r.parserMap.TEXTURECUBE=$m._loadTextureCube,$r.parserMap.TERRAIN=$m._loadTerrain,$m._innerFirstLevelLoaderManager.on("error",null,$m._eventLoadManagerError),$m._innerSecondLevelLoaderManager.on("error",null,$m._eventLoadManagerError),$m._innerThirdLevelLoaderManager.on("error",null,$m._eventLoadManagerError),$m._innerFourthLevelLoaderManager.on("error",null,$m._eventLoadManagerError)},$m.READ_BLOCK=function(){return $m._readData.pos+=4,!0},$m.READ_DATA=function(){return $m._DATA.offset=$m._readData.getUint32(),$m._DATA.size=$m._readData.getUint32(),!0},$m.READ_STRINGS=function(){var $i=[],$p={offset:0,size:0};$p.offset=$m._readData.getUint16(),$p.size=$m._readData.getUint16();$m._readData.pos;$m._readData.pos=$p.offset+$m._DATA.offset;for(var $F=0;$F<$p.size;$F++){var $J=$m._readData.readUTFString();-1===$J.lastIndexOf(".lmat")&&-1===$J.lastIndexOf(".lpbr")||$i.push($J)}return $i},$m.formatRelativePath=function($i,$p){var $F;if("."===$p.charAt(0)){for(var $J=($i+$p).split("/"),$A=0,$t=$J.length;$A<$t;$A++)if(".."==$J[$A]){var $q=$A-1;0<$q&&".."!==$J[$q]&&($J.splice($q,2),$A-=2)}$F=$J.join("/")}else $F=$i+$p;return null!=$c.customFormat&&($F=$c.customFormat($F,null)),$F},$m._eventLoadManagerError=function($i){$v.loader.event("error",$i)},$m._addHierarchyInnerUrls=function($i,$p,$F,$J,$A,$t){var $q=$m.formatRelativePath($J,$A);$F&&($q+=$F),$i.push({url:$q,clas:$t}),$p[$A]=$q},$m._getSprite3DHierarchyInnerUrls=function($i,$p,$F,$J,$A,$t,$q){var $B,$O=0,$U=0;switch($i.type){case"Scene":var $d=$i.customProps.lightmaps;for($O=0,$U=$d.length;$O<$U;$O++){var $u=$d[$O].replace(".exr",".png");$m._addHierarchyInnerUrls($J,$A,$t,$q,$u,$Vp)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var $S;if($i.instanceParams)($S=$i.instanceParams.loadPath)&&$m._addHierarchyInnerUrls($p,$A,$t,$q,$S,$Cp);else{($S=($B=$i.customProps).meshPath)&&$m._addHierarchyInnerUrls($p,$A,$t,$q,$S,$Cp);var $Z=$B.materials;if($Z)for($O=0,$U=$Z.length;$O<$U;$O++){for(var $s=$Z[$O],$x=$s.type.split("."),$j=$n.window,$r=0,$M=$x.length;$r<$M;++$r){$j=$j[this.clasPaths[$r]]}if("function"!=typeof $j)throw"_getSprite3DHierarchyInnerUrls 错误: "+$s.type+" 不是类";$m._addHierarchyInnerUrls($F,$A,$t,$q,$s.path,$j)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var $D=($B=$i.customProps).meshPath;$D&&$m._addHierarchyInnerUrls($p,$A,$t,$q,$D,$Cp);var $E=$B.material;if($E){$x=$E.type.split("."),$j=$n.window;for($r=0,$M=$x.length;$r<$M;++$r){$j=$j[this.clasPaths[$r]]}$m._addHierarchyInnerUrls($F,$A,$t,$q,$E.path,$j)}else{var $v=$B.materialPath;if($v)$m._addHierarchyInnerUrls($F,$A,$t,$q,$v,ShurikenParticleMaterial);else{var $g=$B.texturePath;$g&&$m._addHierarchyInnerUrls($J,$A,$t,$q,$g,$Vp)}}break;case"Terrain":$m._addHierarchyInnerUrls($J,$A,$t,$q,$i.customProps.dataPath,TerrainRes)}var $a=$i.components;for(var $R in $a){var $Q=$a[$R];switch($R){case"Animator":var $P=$Q.avatarPath;if($P)$m._addHierarchyInnerUrls($J,$A,$t,$q,$P,Avatar);else{var $Y=$Q.avatar;$Y&&$m._addHierarchyInnerUrls($J,$A,$t,$q,$Y.path,Avatar)}var $c=$Q.clipPaths;for($O=0,$U=$c.length;$O<$U;$O++)$m._addHierarchyInnerUrls($J,$A,$t,$q,$c[$O],AnimationClip)}}var $h=$i.child;for($O=0,$U=$h.length;$O<$U;$O++)$m._getSprite3DHierarchyInnerUrls($h[$O],$p,$F,$J,$A,$t,$q)},$m._loadHierarchy=function($i){$i.on("loaded",null,$m._onHierarchylhLoaded,[$i,$i._class._getGroup()]),$i.load($i.url,"json",!1,null,!0)},$m._onHierarchylhLoaded=function($i,$p,$F){if($i._class.destroyed)$i.endLoad();else{var $J=$i.url,$A=$jp.getURLVerion($J),$t=$c.getPath($J),$q=[],$B=[],$O=[],$U={};$m._getSprite3DHierarchyInnerUrls($F,$q,$B,$O,$U,$A,$t);var $d=$q.length+$B.length+$O.length,$u=$d+1,$S=1/$u;if($m._onProcessChange($i,0,$S,1),0<$O.length){var $Z=$d/$u,$s=$Y.create(null,$m._onProcessChange,[$i,$S,$Z],!1);$m._innerFourthLevelLoaderManager.create($O,$Y.create(null,$m._onHierarchyInnerForthLevResouLoaded,[$i,$p,$s,$F,$U,$q,$B,$S+$Z*$O.length,$Z]),$s,null,null,1,!0,$p)}else $m._onHierarchyInnerForthLevResouLoaded($i,$p,null,$F,$U,$q,$B,$S,$Z)}},$m._onHierarchyInnerForthLevResouLoaded=function($i,$p,$F,$J,$A,$t,$q,$B,$O){if($i._class.destroyed)$i.endLoad();else if($F&&$F.recover(),0<$q.length){var $U=$Y.create(null,$m._onProcessChange,[$i,$B,$O],!1);$m._innerSecondLevelLoaderManager.create($q,$Y.create(null,$m._onHierarchyInnerSecondLevResouLoaded,[$i,$p,$U,$J,$A,$t,$B+$O*$q.length,$O]),$F,null,null,1,!0,$p)}else $m._onHierarchyInnerSecondLevResouLoaded($i,$p,null,$J,$A,$t,$B,$O)},$m._onHierarchyInnerSecondLevResouLoaded=function($i,$p,$F,$J,$A,$t,$q,$B){if($i._class.destroyed)$i.endLoad();else if($F&&$F.recover(),0<$t.length){var $O=$Y.create(null,$m._onProcessChange,[$i,$q,$B],!1);$m._innerFirstLevelLoaderManager.create($t,$Y.create(null,$m._onHierarchyInnerFirstLevResouLoaded,[$i,$O,$J,$A]),$F,null,null,1,!0,$p)}else $m._onHierarchyInnerFirstLevResouLoaded($i,null,$J,$A)},$m._onHierarchyInnerFirstLevResouLoaded=function($i,$p,$F,$J){$p&&$p.recover(),$i.endLoad([$F,$J])},$m._loadTerrain=function($i){$i.on("loaded",null,$m._onTerrainLtLoaded,[$i,$i._class._getGroup()]),$i.load($i.url,"json",!1,null,!0)},$m._onTerrainLtLoaded=function($i,$p,$F){if($i._class.destroyed)$i.endLoad();else{var $J,$A,$t=$i.url,$q=$jp.getURLVerion($t),$B=$c.getPath($t),$O=[],$U={},$d=0,$u=0,$S=$F.heightData;$J=$S.url,$A=$m.formatRelativePath($B,$J),$q&&($A+=$q),$J=$U[$J]=$A;var $Z=$F.detailTexture;for($d=0,$u=$Z.length;$d<$u;$d++)$O.push({url:$Z[$d].diffuse});var $s=$F.normalMap;for($d=0,$u=$s.length;$d<$u;$d++)$O.push({url:$s[$d]});var $x=$F.alphaMap;for($d=0,$u=$x.length;$d<$u;$d++)$O.push({url:$x[$d],params:[!1,!1,6408,!0]});for($d=0,$u=$O.length;$d<$u;$d++){var $j=$O[$d].url;$A=$m.formatRelativePath($B,$j),$q&&($A+=$q),$O[$d].url=$A,$U[$j]=$A}var $r=$O.length,$M=$r+2,$D=1/$M;$m._onProcessChange($i,0,$D,1);var $E={heightMapLoaded:!1,texturesLoaded:!1},$v=$Y.create(null,$m._onProcessChange,[$i,$D,$D],!1);$m._innerFourthLevelLoaderManager.create($J,$Y.create(null,$m._onTerrainHeightMapLoaded,[$i,$v,$F,$U,$E]),$v,null,[$S.numX,$S.numZ,$S.bitType,$S.value],1,!0,$p);var $g=$Y.create(null,$m._onProcessChange,[$i,2*$D,$r/$M],!1);$m._innerFourthLevelLoaderManager.create($O,$Y.create(null,$m._onTerrainTexturesLoaded,[$i,$g,$F,$U,$E]),$g,null,null,1,!0,$p)}},$m._onTerrainHeightMapLoaded=function($i,$p,$F,$J,$A){$A.heightMapLoaded=!0,$A.texturesLoaded&&($i.endLoad([$F,$J]),$p.recover())},$m._onTerrainTexturesLoaded=function($i,$p,$F,$J,$A){$A.texturesLoaded=!0,$A.heightMapLoaded&&($i.endLoad([$F,$J]),$p.recover())},$m._loadMesh=function($i){$i.on("loaded",null,$m._onMeshLmLoaded,[$i,$i._class._getGroup()]),$i.load($i.url,"arraybuffer",!1,null,!0)},$m._onMeshLmLoaded=function($i,$p,$F){if($i._class.destroyed)$i.endLoad();else{var $J,$A,$t,$q=$i.url,$B=$jp.getURLVerion($q),$O=$c.getPath($q),$U={},$d=0,$u=0;switch(($m._readData=new $g($F)).pos=0,$m._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var $S=$m._readData.getUint32();$m._readData.pos=$m._readData.pos+4,$u=$m._readData.getUint16(),$m._readData.pos=$m._readData.pos+8*$u;var $Z=$m._readData.getUint32();for($u=$m._readData.getUint16(),$m._readData.pos=$S+$Z,$J=[],$d=0;$d<$u;$d++){var $s=$m._readData.readUTFString();-1!==$s.lastIndexOf(".lmat")&&$J.push($s)}break;default:for($m.READ_BLOCK(),$d=0;$d<2;$d++){var $x=$m._readData.getUint16(),$j=$m._strings[$x],$r=$m["READ_"+$j];if(null==$r)throw new Error("model file err,no this function:"+$x+" "+$j);1===$d?$J=$r.call():$r.call()}}for($d=0,$t=$J.length;$d<$t;$d++){var $M=$J[$d];$A=$m.formatRelativePath($O,$M),$B&&($A+=$B),$J[$d]=$A,$U[$M]=$A}if(0<$J.length){$m._onProcessChange($i,0,.5,1);var $D=$Y.create(null,$m._onProcessChange,[$i,.5,.5],!1);$m._innerSecondLevelLoaderManager.create($J,$Y.create(null,$m._onMeshMateialLoaded,[$i,$D,$F,$U]),$D,null,null,1,!0,$p)}else $i.endLoad([$F,$U])}},$m._onMeshMateialLoaded=function($i,$p,$F,$J){$i.endLoad([$F,$J]),$p.recover()},$m._getMaterialTexturePath=function($i,$p,$F){var $J=$i.length-4;return $i.indexOf(".dds")!=$J&&$i.indexOf(".tga")!=$J&&$i.indexOf(".exr")!=$J&&$i.indexOf(".DDS")!=$J&&$i.indexOf(".TGA")!=$J&&$i.indexOf(".EXR")!=$J||($i=$i.substr(0,$J)+".png"),$i=$m.formatRelativePath($F,$i),$p&&($i+=$p),$i},$m._loadMaterial=function($i){$i.on("loaded",null,$m._onMaterilLmatLoaded,[$i,$i._class._getGroup()]),$i.load($i.url,"json",!1,null,!0)},$m._onMaterilLmatLoaded=function($i,$p,$F){if($i._class.destroyed)$i.endLoad();else{var $J,$A=$i.url,$t=$jp.getURLVerion($A),$q=$c.getPath($A),$B=[],$O={},$U=$F.customProps,$d=$F.version;if($d)switch($d){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var $u=$F.props.textures,$S=0,$Z=$u.length;$S<$Z;$S++){var $s=$u[$S],$x=$s.path;if($x){var $j=$x.length-4;$x.indexOf(".exr")!=$j&&$x.indexOf(".EXR")!=$j||($x=$x.substr(0,$j)+".png"),$J=$m.formatRelativePath($q,$x),$t&&($J+=$t),$B.push({url:$J,params:$s.params}),$O[$x]=$J}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var $r=$U.diffuseTexture.texture2D;if($r&&($J=$m._getMaterialTexturePath($r,$t,$q),$B.push($J),$O[$r]=$J),$U.normalTexture){var $M=$U.normalTexture.texture2D;$M&&($J=$m._getMaterialTexturePath($M,$t,$q),$B.push($J),$O[$M]=$J)}if($U.specularTexture){var $D=$U.specularTexture.texture2D;$D&&($J=$m._getMaterialTexturePath($D,$t,$q),$B.push($J),$O[$D]=$J)}if($U.emissiveTexture){var $E=$U.emissiveTexture.texture2D;$E&&($J=$m._getMaterialTexturePath($E,$t,$q),$B.push($J),$O[$E]=$J)}if($U.ambientTexture){var $v=$U.ambientTexture.texture2D;$v&&($J=$m._getMaterialTexturePath($v,$t,$q),$B.push($J),$O[$v]=$J)}if($U.reflectTexture){var $g=$U.reflectTexture.texture2D;$g&&($J=$m._getMaterialTexturePath($g,$t,$q),$B.push($J),$O[$g]=$J)}}var $a=$B.length,$R=$a+1,$Q=1/$R;if($m._onProcessChange($i,0,$Q,1),0<$a){var $P=$Y.create(null,$m._onProcessChange,[$i,$Q,$a/$R],!1);$m._innerFourthLevelLoaderManager.create($B,$Y.create(null,$m._onMateialTexturesLoaded,[$i,$P,$F,$O]),$P,$Vp,null,1,!0,$p)}else $m._onMateialTexturesLoaded($i,null,$F,null)}},$m._onMateialTexturesLoaded=function($i,$p,$F,$J){$i.endLoad([$F,$J]),$p&&$p.recover()},$m._loadTextureCube=function($i){$i.on("loaded",null,$m._onTextureCubeLtcLoaded,[$i]),$i.load($i.url,"json",!1,null,!0)},$m._onTextureCubeLtcLoaded=function($i,$p){if($i._class.destroyed)$i.endLoad();else{var $F=$c.getPath($i.url),$J=[$m.formatRelativePath($F,$p.px),$m.formatRelativePath($F,$p.nx),$m.formatRelativePath($F,$p.py),$m.formatRelativePath($F,$p.ny),$m.formatRelativePath($F,$p.pz),$m.formatRelativePath($F,$p.nz)];$m._onProcessChange($i,0,1/7,1);var $A=$Y.create(null,$m._onProcessChange,[$i,1/7,6/7],!1);$m._innerFourthLevelLoaderManager.load($J,$Y.create(null,$m._onTextureCubeImagesLoaded,[$i,$J,$A]),$A,"nativeimage")}},$m._onTextureCubeImagesLoaded=function($i,$p,$F){var $J=[];$J.length=6;for(var $A=0;$A<6;$A++){var $t=$p[$A];$J[$A]=$r.getRes($t),$r.clearRes($t)}$i.endLoad($J),$F.recover()},$m._onProcessChange=function($i,$p,$F,$J){($J=$p+$J*$F)<1&&$i.event("progress",$J)},$m.init=function($i,$p,$F,$J,$A,$t){if(void 0===$F&&($F=!1),void 0===$J&&($J=!1),void 0===$A&&($A=!0),void 0===$t&&($t=!0),$M.update3DLoop=function(){},$M.cancelLoadByUrl=function($i){$m._cancelLoadByUrl($i)},$O.isAntialias=$F,$O.isAlpha=$J,$O.premultipliedAlpha=$A,$O.isStencil=$t,!$h.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");$M.changeWebGLSize=$m._changeWebGLSize,$x.is3DMode=!0,$v.init($i,$p),$I.__init__(),$up.__init__(),$$p.__init__(),$L.__init__(),$m.__init__(),$q.maxTextureCount=2,($m.debugMode||$e.debugMode)&&($m._debugPhasorSprite=new $k)},$m.HIERARCHY="SPRITE3DHIERARCHY",$m.MESH="MESH",$m.MATERIAL="MATERIAL",$m.PBRMATERIAL="PBRMTL",$m.TEXTURECUBE="TEXTURECUBE",$m.TERRAIN="TERRAIN",$m._readData=null,$m._debugPhasorSprite=null,$m.debugMode=!1,$u($m,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new $p},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new $p},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new $p},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new $p}]),$m}(),$Mp=function($i){function $A($i){$A.__super.call(this),this._owner=$i,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}$Z($A,"laya.d3.animation.AnimationTransform3D",$t);var $p=$A.prototype;return $p._getlocalMatrix=function(){return this._localUpdate&&($jp._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},$p._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldTransform()}},$p._setWorldMatrixAndUpdate=function($i){if(this._worldMatrix=$i,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var $p=this._getlocalMatrix(),$F=0;$F<16;++$F)this._worldMatrix[$F]=$p[$F];else $jp.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},$p._setWorldMatrixNoUpdate=function($i){this._worldMatrix=$i},$p._setWorldMatrixIgnoreUpdate=function($i){this._worldMatrix=$i,this._worldUpdate=!1},$p.getLocalPosition=function(){return this._localPosition},$p.setLocalPosition=function($i){if(this._parent)this._localPosition=$i,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$F=this._entity.localPosition,$J=$F.elements;$J[0]=$i[0],$J[1]=$i[1],$J[2]=$i[2],$p.localPosition=$F}},$p.getLocalRotation=function(){if(this._localQuaternionUpdate){var $i=this._localRotationEuler;$jp._quaternionCreateFromYawPitchRollArray($i[1]/$A._angleToRandin,$i[0]/$A._angleToRandin,$i[2]/$A._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},$p.setLocalRotation=function($i){if(this._parent)this._localRotation=$i,$jp.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$F=this._entity.localRotation,$J=$F.elements;$J[0]=$i[0],$J[1]=$i[1],$J[2]=$i[2],$J[3]=$i[3],$p.localRotation=$F}},$p.getLocalScale=function(){return this._localScale},$p.setLocalScale=function($i){if(this._parent)this._localScale=$i,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$F=this._entity.localScale,$J=$F.elements;$J[0]=$i[0],$J[1]=$i[1],$J[2]=$i[2],$p.localScale=$F}},$p.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){$jp.getYawPitchRoll(this._localRotation,$A._tempVector3);var $i=$A._tempVector3,$p=this._localRotationEuler;$p[0]=$i[1]*$A._angleToRandin,$p[1]=$i[0]*$A._angleToRandin,$p[2]=$i[2]*$A._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},$p.setLocalRotationEuler=function($i){if(this._parent)$jp._quaternionCreateFromYawPitchRollArray($i[1]/$A._angleToRandin,$i[0]/$A._angleToRandin,$i[2]/$A._angleToRandin,this._localRotation),this._localRotationEuler=$i,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var $p=this._entity.owner._transform,$F=this._entity.localRotationEuler,$J=$F.elements;$J[0]=$i[0],$J[1]=$i[1],$J[2]=$i[2],$p.localRotationEuler=$F}},$p.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)$jp.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var $i=this._getlocalMatrix(),$p=0;$p<16;++$p)this._worldMatrix[$p]=$i[$p];this._worldUpdate=!1}return this._worldMatrix},$p.setParent=function($i){if(this._parent!==$i){if(this._parent){var $p=this._parent._childs,$F=$p.indexOf(this);$p.splice($F,1)}$i&&($i._childs.push(this),$i&&this._onWorldTransform()),this._parent=$i}},$u($A,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$A}(),$Dp=function($i){function $p(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,$p.__super.call(this),this._destroyed=!1,this._id=$p._uniqueIDCounter,$p._uniqueIDCounter++}$Z($p,"laya.d3.component.Component3D",$t);var $F=$p.prototype;return $v.imps($F,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),$F._initialize=function($i){this._owner=$i,this._enable=!0,this.started=!1,this._load($i)},$F._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},$F._load=function($i){},$F._start=function($i){},$F._update=function($i){},$F._lateUpdate=function($i){},$F._preRenderUpdate=function($i){},$F._postRenderUpdate=function($i){},$F._unload=function($i){this.offAll()},$F._cloneTo=function($i){},$s(0,$F,"id",function(){return this._id}),$s(0,$F,"destroyed",function(){return this._destroyed}),$s(0,$F,"owner",function(){return this._owner}),$s(0,$F,"enable",function(){return this._enable},function($i){this._enable!==$i&&(this._enable=$i,this.event("enablechanged",this._enable))}),$s(0,$F,"isSingleton",function(){return $p._isSingleton}),$p._isSingleton=!0,$p._uniqueIDCounter=1,$p}(),$Ep=function($i){function $p(){this._destroyed=!1,$p.__super.call(this),this._destroyed=!1}$Z($p,"laya.d3.core.GeometryFilter",$t);var $F=$p.prototype;return $v.imps($F,{"laya.resource.IDestroy":!0}),$F._destroy=function(){this.offAll(),this._destroyed=!0},$s(0,$F,"_isAsyncLoaded",function(){return!0}),$s(0,$F,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),$s(0,$F,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),$s(0,$F,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),$s(0,$F,"destroyed",function(){return this._destroyed}),$p}(),$vp=function($i){function $J($i){$J.__super.call(this),this._id=++$J._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new $ei(new $qp,new $qp),this._boundingBoxCenter=new $qp,this._boundingSphere=new $zi(new $qp,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=$i,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}$Z($J,"laya.d3.core.render.BaseRender",$t);var $p=$J.prototype;return $v.imps($p,{"laya.resource.IDestroy":!0}),$p._changeMaterialReference=function($i,$p){$i&&$i._removeReference(),$p._addReference()},$p._getInstanceMaterial=function($i,$p){var $F=new $i.constructor;return $i.cloneTo($F),$F.name=$F.name+"(Instance)",this._materialsInstance[$p]=!0,this._changeMaterialReference(this._materials[$p],$F),this._materials[$p]=$F},$p._setShaderValuelightMap=function($i){this._setShaderValueTexture(3,$i)},$p._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},$p._renderRenderableBoundBox=function(){var $i=$rp._debugPhasorSprite,$p=this.boundingBox,$F=$J._tempBoundBoxCorners;$p.getCorners($F),$i.line($F[0],$J._greenColor,$F[1],$J._greenColor),$i.line($F[2],$J._greenColor,$F[3],$J._greenColor),$i.line($F[4],$J._greenColor,$F[5],$J._greenColor),$i.line($F[6],$J._greenColor,$F[7],$J._greenColor),$i.line($F[0],$J._greenColor,$F[3],$J._greenColor),$i.line($F[1],$J._greenColor,$F[2],$J._greenColor),$i.line($F[2],$J._greenColor,$F[6],$J._greenColor),$i.line($F[3],$J._greenColor,$F[7],$J._greenColor),$i.line($F[0],$J._greenColor,$F[4],$J._greenColor),$i.line($F[1],$J._greenColor,$F[5],$J._greenColor),$i.line($F[4],$J._greenColor,$F[7],$J._greenColor),$i.line($F[5],$J._greenColor,$F[6],$J._greenColor)},$p._calculateBoundingSphere=function(){throw"BaseRender: must override it."},$p._calculateBoundingBox=function(){throw"BaseRender: must override it."},$p._setShaderValueTexture=function($i,$p){this._owner._shaderValues.setValue($i,$p)},$p._setShaderValueMatrix4x4=function($i,$p){this._owner._shaderValues.setValue($i,$p?$p.elements:null)},$p._setShaderValueColor=function($i,$p){this._owner._shaderValues.setValue($i,$p?$p.elements:null)},$p._setShaderValueBuffer=function($i,$p){this._owner._shaderValues.setValue($i,$p)},$p._setShaderValueInt=function($i,$p){this._owner._shaderValues.setValue($i,$p)},$p._setShaderValueBool=function($i,$p){this._owner._shaderValues.setValue($i,$p)},$p._setShaderValueNumber=function($i,$p){this._owner._shaderValues.setValue($i,$p)},$p._setShaderValueVector2=function($i,$p){this._owner._shaderValues.setValue($i,$p?$p.elements:null)},$p._addShaderDefine=function($i){this._owner._shaderDefineValue|=$i},$p._removeShaderDefine=function($i){this._owner._shaderDefineValue&=~$i},$p._renderUpdate=function($i){return!0},$p._applyLightMapParams=function(){if(0<=this._lightmapIndex){var $i=this._owner.scene;if($i){var $p=$i.getlightmaps()[this._lightmapIndex];$p?(this._addShaderDefine($kp.SAHDERDEFINE_LIGHTMAP),$p.loaded?this._setShaderValuelightMap($p):$p.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine($kp.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($kp.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine($kp.SAHDERDEFINE_LIGHTMAP)},$p._updateOctreeNode=function(){var $i=this._treeNode;$i&&this._octreeNodeNeedChange&&($i.updateObject(this),this._octreeNodeNeedChange=!1)},$p._destroy=function(){this.offAll();var $i=0,$p=0;for($i=0,$p=this._renderElements.length;$i<$p;$i++)this._renderElements[$i]._destroy();for($i=0,$p=this._materials.length;$i<$p;$i++)this._materials[$i]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},$s(0,$p,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),$s(0,$p,"id",function(){return this._id}),$s(0,$p,"material",function(){var $i=this._materials[0];if($i&&!this._materialsInstance[0]){var $p=this._getInstanceMaterial($i,0);this.event("materialchanged",[this,0,$p])}return this._materials[0]},function($i){this.sharedMaterial=$i}),$s(0,$p,"sharedMaterial",function(){return this._materials[0]},function($i){var $p=this._materials[0];$p!==$i&&(this._materials[0]=$i,this._materialsInstance[0]=!1,this._changeMaterialReference($p,$i),this.event("materialchanged",[this,0,$i]))}),$s(0,$p,"lightmapIndex",function(){return this._lightmapIndex},function($i){this._lightmapIndex=$i,this._applyLightMapParams()}),$s(0,$p,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function($i){this._lightmapScaleOffset=$i,this._setShaderValueColor(2,$i),this._addShaderDefine($kp.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),$s(0,$p,"enable",function(){return this._enable},function($i){this._enable=$i,this.event("enablechanged",[this,$i])}),$s(0,$p,"materials",function(){for(var $i=0,$p=this._materials.length;$i<$p;$i++)if(!this._materialsInstance[$i]){var $F=this._getInstanceMaterial(this._materials[$i],$i);this.event("materialchanged",[this,$i,$F])}return this._materials.slice()},function($i){this.sharedMaterials=$i}),$s(0,$p,"sharedMaterials",function(){return this._materials.slice()},function($i){if(!$i)throw new Error("MeshRender: shadredMaterials value can't be null.");var $p=$i.length;this._materialsInstance.length=$p;for(var $F=0;$F<$p;$F++){var $J=this._materials[$F];$J!==$i[$F]&&(this._materialsInstance[$F]=!1,this._changeMaterialReference($J,$i[$F]),this.event("materialchanged",[this,$F,$i[$F]]))}this._materials=$i}),$s(0,$p,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),$s(0,$p,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var $i=this.boundingBox;$qp.add($i.min,$i.max,this._boundingBoxCenter),$qp.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),$s(0,$p,"receiveShadow",function(){return this._receiveShadow},function($i){this._receiveShadow!==$i&&((this._receiveShadow=$i)?this._addShaderDefine($Zp.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine($Zp.SHADERDEFINE_RECEIVE_SHADOW))}),$s(0,$p,"destroyed",function(){return this._destroyed}),$J._uniqueIDCounter=0,$u($J,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp,new $qp]},"_greenColor",function(){return this._greenColor=new $Bp(0,1,0,1)}]),$J}(),$gp=function($i){function $B($i){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,$B.__super.call(this),this._localPosition=new $qp,this._localRotation=new $Fp(0,0,0,1),this._localScale=new $qp(1,1,1),this._localRotationEuler=new $qp,this._localMatrix=new $ip,this._position=new $qp,this._rotation=new $Fp(0,0,0,1),this._scale=new $qp(1,1,1),this._worldMatrix=new $ip,this._forward=new $qp,this._up=new $qp,this._right=new $qp,this._owner=$i,this._childs=[]}$Z($B,"laya.d3.core.Transform3D",$t);var $p=$B.prototype;return $p._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)$ip.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var $i=$B._tempVector30;$qp.multiply(this.pivot,this._localScale,$i);var $p=$B._tempVector31;$qp.subtract($i,this.pivot,$p);var $F=$B._tempVector32,$J=this.localRotation;$qp.transformQuat($i,$J,$F),$qp.subtract($F,$i,$F);var $A=$B._tempVector33;$qp.subtract(this._localPosition,$p,$A),$qp.subtract($A,$F,$A),$ip.createAffineTransformation($A,$J,this._localScale,this._localMatrix)}},$p._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldPositionRotationTransform()}},$p._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldPositionScaleTransform()}},$p._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldPositionTransform()}},$p._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldPositionRotationTransform()}},$p._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldPositionScaleTransform()}},$p._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._onWorldTransform()}},$p.translate=function($i,$p){void 0===$p&&($p=!0),$p?($ip.createFromQuaternion(this.localRotation,$B._tempMatrix0),$qp.transformCoordinate($i,$B._tempMatrix0,$B._tempVector30),$qp.add(this.localPosition,$B._tempVector30,this._localPosition),this.localPosition=this._localPosition):($qp.add(this.position,$i,this._position),this.position=this._position)},$p.rotate=function($i,$p,$F){var $J;void 0===$p&&($p=!0),void 0===$F&&($F=!0),$J=$F?$i:($qp.scale($i,Math.PI/180,$B._tempVector30),$B._tempVector30),$Fp.createFromYawPitchRoll($J.y,$J.x,$J.z,$B._tempQuaternion0),$p?($Fp.multiply(this._localRotation,$B._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):($Fp.multiply($B._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},$p.lookAt=function($i,$p,$F){void 0===$F&&($F=!1);var $J,$A=$i.elements;if($F){if($J=this._localPosition.elements,Math.abs($J[0]-$A[0])<$li.zeroTolerance&&Math.abs($J[1]-$A[1])<$li.zeroTolerance&&Math.abs($J[2]-$A[2])<$li.zeroTolerance)return;$Fp.lookAt(this._localPosition,$i,$p,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var $t=this.position;if($J=$t.elements,Math.abs($J[0]-$A[0])<$li.zeroTolerance&&Math.abs($J[1]-$A[1])<$li.zeroTolerance&&Math.abs($J[2]-$A[2])<$li.zeroTolerance)return;$Fp.lookAt($t,$i,$p,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},$s(0,$p,"_isFrontFaceInvert",function(){var $i=this.scale,$p=$i.x<0;return $i.y<0&&($p=!$p),$i.z<0&&($p=!$p),$p}),$s(0,$p,"owner",function(){return this._owner}),$s(0,$p,"localRotation",function(){if(this._localQuaternionUpdate){var $i=this._localRotationEuler.elements;$Fp.createFromYawPitchRoll($i[1]/$B._angleToRandin,$i[0]/$B._angleToRandin,$i[2]/$B._angleToRandin,this._localRotation)}return this._localRotation},function($i){this._localRotation=$i,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$s(0,$p,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?$ip.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function($i){null===this._parent?$i.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),$ip.multiply(this._localMatrix,$i,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=$i,this._worldUpdate=!1}),$s(0,$p,"worldNeedUpdate",function(){return this._worldUpdate}),$s(0,$p,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function($i){this._localMatrix=$i,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),$s(0,$p,"dummy",function(){return this._dummy},function($i){this._dummy!==$i&&(this._dummy&&(this._dummy._entity=null),$i&&($i._entity=this),this._dummy=$i)}),$s(0,$p,"localPosition",function(){return this._localPosition},function($i){this._localPosition=$i,this._localUpdate=!0,this._onWorldPositionTransform()}),$s(0,$p,"position",function(){if(this._positionUpdate){if(null!=this._parent){var $i=this._parent.position;$qp.multiply(this._localPosition,this._parent.scale,$B._tempVector30),$qp.transformQuat($B._tempVector30,this._parent.rotation,$B._tempVector30),$qp.add($i,$B._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function($i){if(null!=this._parent){$qp.subtract($i,this._parent.position,this._localPosition);var $p=this._parent.scale.elements,$F=$p[0],$J=$p[1],$A=$p[2];if(1!==$F||1!==$J||1!==$A){var $t=$B._tempVector30,$q=$t.elements;$q[0]=1/$F,$q[1]=1/$J,$q[2]=1/$A,$qp.multiply(this._localPosition,$t,this._localPosition)}this._parent.rotation.invert($B._tempQuaternion0),$qp.transformQuat(this._localPosition,$B._tempQuaternion0,this._localPosition)}else $i.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=$i,this._positionUpdate=!1}),$s(0,$p,"localScale",function(){return this._localScale},function($i){this._localScale=$i,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),$s(0,$p,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll($B._tempVector30);var $i=$B._tempVector30.elements,$p=this._localRotationEuler.elements;$p[0]=$i[1]*$B._angleToRandin,$p[1]=$i[0]*$B._angleToRandin,$p[2]=$i[2]*$B._angleToRandin}return this._localRotationEuler},function($i){this._localRotationEuler=$i,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),$s(0,$p,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?$Fp.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function($i){null!=this._parent?(this._parent.rotation.invert($B._tempQuaternion0),$Fp.multiply($i,$B._tempQuaternion0,this._localRotation)):$i.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=$i,this._rotationUpdate=!1}),$s(0,$p,"scale",function(){return this._scaleUpdate&&(null!==this._parent?$qp.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function($i){if(null!==this._parent){var $p=this._parent.scale.elements,$F=$B._tempVector30.elements;$F[0]=1/$p[0],$F[1]=1/$p[1],$F[2]=1/$p[2],$qp.multiply($i,$B._tempVector30,this._localScale)}else $i.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=$i,this._scaleUpdate=!1}),$s(0,$p,"rotationEuler",null,function($i){$Fp.createFromYawPitchRoll($i.y,$i.x,$i.z,this._rotation),this.rotation=this._rotation}),$s(0,$p,"forward",function(){var $i=this.worldMatrix.elements;return this._forward.elements[0]=-$i[8],this._forward.elements[1]=-$i[9],this._forward.elements[2]=-$i[10],this._forward}),$s(0,$p,"up",function(){var $i=this.worldMatrix.elements;return this._up.elements[0]=$i[4],this._up.elements[1]=$i[5],this._up.elements[2]=$i[6],this._up}),$s(0,$p,"right",function(){var $i=this.worldMatrix.elements;return this._right.elements[0]=$i[0],this._right.elements[1]=$i[1],this._right.elements[2]=$i[2],this._right}),$s(0,$p,"parent",function(){return this._parent},function($i){if(this._parent!==$i){if(this._parent){var $p=this._parent._childs,$F=$p.indexOf(this);$p.splice($F,1)}$i&&($i._childs.push(this),$i&&this._onWorldTransform()),this._parent=$i}}),$u($B,["_tempVector30",function(){return this._tempVector30=new $qp},"_tempVector31",function(){return this._tempVector31=new $qp},"_tempVector32",function(){return this._tempVector32=new $qp},"_tempVector33",function(){return this._tempVector33=new $qp},"_tempQuaternion0",function(){return this._tempQuaternion0=new $Fp},"_tempMatrix0",function(){return this._tempMatrix0=new $ip},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),$B}(),$ap=(function($i){function $p(){this._rotation=0,this._matNeedUpdte=!1,$p.__super.call(this),this._matrix=new $ip,this._offset=new $tp,this._tiling=new $tp(1,1)}$Z($p,"laya.d3.core.TransformUV",$t);var $F=$p.prototype;$v.imps($F,{"laya.d3.core.IClone":!0}),$F._updateMatrix=function(){$p._tempOffsetV3.elements[0]=this._offset.x,$p._tempOffsetV3.elements[1]=this._offset.y,$Fp.createFromYawPitchRoll(0,0,this._rotation,$p._tempRotationQua),$p._tempTitlingV3.elements[0]=this._tiling.x,$p._tempTitlingV3.elements[1]=this._tiling.y,$ip.createAffineTransformation($p._tempOffsetV3,$p._tempRotationQua,$p._tempTitlingV3,this._matrix)},$F.cloneTo=function($i){$i._matrix=this._matrix.clone(),$i._offset=this._offset.clone(),$i._rotation=this._rotation,$i._tiling=this._tiling.clone()},$F.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$F,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),$s(0,$F,"tiling",function(){return this._tiling},function($i){this._tiling=$i,this._matNeedUpdte=!0}),$s(0,$F,"offset",function(){return this._offset},function($i){this._offset=$i,this._matNeedUpdte=!0}),$s(0,$F,"rotation",function(){return this._rotation},function($i){this._rotation=$i,this._matNeedUpdte=!0}),$u($p,["_tempOffsetV3",function(){return this._tempOffsetV3=new $qp(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new $Fp},"_tempTitlingV3",function(){return this._tempTitlingV3=new $qp(1,1,1)}])}(),function($F){function $i(){this.x=NaN,this.y=NaN,this.z=NaN,$i.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}$Z($i,"laya.d3.core.particleShuriKen.module.shape.BoxShape",$F);var $p=$i.prototype;$p._getShapeBoundBox=function($i){var $p=$i.min.elements;$p[0]=.5*-this.x,$p[1]=.5*-this.y,$p[2]=.5*-this.z;var $F=$i.max.elements;$F[0]=.5*this.x,$F[1]=.5*this.y,$F[2]=.5*this.z},$p._getSpeedBoundBox=function($i){var $p=$i.min.elements;$p[0]=0,$p[1]=0,$p[2]=0;var $F=$i.max.elements;$F[0]=0,$F[1]=1,$F[2]=0},$p.generatePositionAndDirection=function($i,$p,$F,$J){var $A=$i.elements,$t=$p.elements;$F?($F.seed=$J[16],$V._randomPointInsideHalfUnitBox($i,$F),$J[16]=$F.seed):$V._randomPointInsideHalfUnitBox($i),$A[0]=this.x*$A[0],$A[1]=this.y*$A[1],$A[2]=this.z*$A[2],this.randomDirection?$F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p):($t[0]=0,$t[1]=0,$t[2]=1)},$p.cloneTo=function($i){$F.prototype.cloneTo.call(this,$i);var $p=$i;$p.x=this.x,$p.y=this.y,$p.z=this.z,$p.randomDirection=this.randomDirection}}($o),function($F){function $q(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,$q.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}$Z($q,"laya.d3.core.particleShuriKen.module.shape.CircleShape",$F);var $i=$q.prototype;$i._getShapeBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[2]=-this.radius,$p[1]=0;var $F=$i.max.elements;$F[0]=$F[2]=this.radius,$F[1]=0},$i._getSpeedBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[1]=-1,$p[2]=0;var $F=$i.max.elements;$F[0]=$F[1]=1,$F[2]=0},$i.generatePositionAndDirection=function($i,$p,$F,$J){var $A=$i.elements,$t=$q._tempPositionPoint.elements;$F?($F.seed=$J[16],this.emitFromEdge?$V._randomPointUnitArcCircle(this.arc,$q._tempPositionPoint,$F):$V._randomPointInsideUnitArcCircle(this.arc,$q._tempPositionPoint,$F),$J[16]=$F.seed):this.emitFromEdge?$V._randomPointUnitArcCircle(this.arc,$q._tempPositionPoint):$V._randomPointInsideUnitArcCircle(this.arc,$q._tempPositionPoint),$A[0]=-$t[0],$A[1]=$t[1],$A[2]=0,$qp.scale($i,this.radius,$i),this.randomDirection?$F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p):$i.cloneTo($p)},$i.cloneTo=function($i){$F.prototype.cloneTo.call(this,$i);var $p=$i;$p.radius=this.radius,$p.arc=this.arc,$p.emitFromEdge=this.emitFromEdge,$p.randomDirection=this.randomDirection},$u($q,["_tempPositionPoint",function(){return this._tempPositionPoint=new $tp}])}($o),function($F){function $S(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,$S.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}$Z($S,"laya.d3.core.particleShuriKen.module.shape.ConeShape",$F);var $i=$S.prototype;$i._getShapeBoundBox=function($i){var $p=this.radius+this.length*Math.sin(this.angle),$F=this.length*Math.cos(this.angle),$J=$i.min.elements;$J[0]=$J[1]=-$p,$J[2]=0;var $A=$i.max.elements;$A[0]=$A[1]=$p,$A[2]=$F},$i._getSpeedBoundBox=function($i){var $p=Math.sin(this.angle),$F=$i.min.elements;$F[0]=$F[1]=-$p,$F[2]=0;var $J=$i.max.elements;$J[0]=$F[1]=$p,$J[2]=1},$i.generatePositionAndDirection=function($i,$p,$F,$J){var $A,$t=$i.elements,$q=$p.elements,$B=$S._tempPositionPoint.elements,$O=NaN,$U=NaN,$d=Math.cos(this.angle),$u=Math.sin(this.angle);switch(this.emitType){case 0:$F?($F.seed=$J[16],$V._randomPointInsideUnitCircle($S._tempPositionPoint,$F),$J[16]=$F.seed):$V._randomPointInsideUnitCircle($S._tempPositionPoint),$O=$B[0],$U=$B[1],$t[0]=$O*this.radius,$t[1]=$U*this.radius,$t[2]=0,this.randomDirection?($F?($F.seed=$J[17],$V._randomPointInsideUnitCircle($S._tempDirectionPoint,$F),$J[17]=$F.seed):$V._randomPointInsideUnitCircle($S._tempDirectionPoint),$A=$S._tempDirectionPoint.elements,$q[0]=$A[0]*$u,$q[1]=$A[1]*$u):($q[0]=$O*$u,$q[1]=$U*$u),$q[2]=$d;break;case 1:$F?($F.seed=$J[16],$V._randomPointUnitCircle($S._tempPositionPoint,$F),$J[16]=$F.seed):$V._randomPointUnitCircle($S._tempPositionPoint),$O=$B[0],$U=$B[1],$t[0]=$O*this.radius,$t[1]=$U*this.radius,$t[2]=0,this.randomDirection?($F?($F.seed=$J[17],$V._randomPointInsideUnitCircle($S._tempDirectionPoint,$F),$J[17]=$F.seed):$V._randomPointInsideUnitCircle($S._tempDirectionPoint),$A=$S._tempDirectionPoint.elements,$q[0]=$A[0]*$u,$q[1]=$A[1]*$u):($q[0]=$O*$u,$q[1]=$U*$u),$q[2]=$d;break;case 2:$F?($F.seed=$J[16],$V._randomPointInsideUnitCircle($S._tempPositionPoint,$F)):$V._randomPointInsideUnitCircle($S._tempPositionPoint),$O=$B[0],$U=$B[1],$t[0]=$O*this.radius,$t[1]=$U*this.radius,$q[$t[2]=0]=$O*$u,$q[1]=$U*$u,$q[2]=$d,$qp.normalize($p,$p),$F?($qp.scale($p,this.length*$F.getFloat(),$p),$J[16]=$F.seed):$qp.scale($p,this.length*Math.random(),$p),$qp.add($i,$p,$i),this.randomDirection&&($F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p));break;case 3:$F?($F.seed=$J[16],$V._randomPointUnitCircle($S._tempPositionPoint,$F)):$V._randomPointUnitCircle($S._tempPositionPoint),$O=$B[0],$U=$B[1],$t[0]=$O*this.radius,$t[1]=$U*this.radius,$q[$t[2]=0]=$O*$u,$q[1]=$U*$u,$q[2]=$d,$qp.normalize($p,$p),$F?($qp.scale($p,this.length*$F.getFloat(),$p),$J[16]=$F.seed):$qp.scale($p,this.length*Math.random(),$p),$qp.add($i,$p,$i),this.randomDirection&&($F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p));break;default:throw new Error("ConeShape:emitType is invalid.")}},$i.cloneTo=function($i){$F.prototype.cloneTo.call(this,$i);var $p=$i;$p.angle=this.angle,$p.radius=this.radius,$p.length=this.length,$p.emitType=this.emitType,$p.randomDirection=this.randomDirection},$u($S,["_tempPositionPoint",function(){return this._tempPositionPoint=new $tp},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new $tp}])}($o),function($F){function $i(){this.radius=NaN,this.emitFromShell=!1,$i.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$Z($i,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",$F);var $p=$i.prototype;$p._getShapeBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[1]=$p[2]=-this.radius;var $F=$i.max.elements;$F[0]=$F[1]=this.radius,$F[2]=0},$p._getSpeedBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[1]=-1,$p[2]=0;var $F=$i.max.elements;$F[0]=$F[1]=$F[2]=1},$p.generatePositionAndDirection=function($i,$p,$F,$J){var $A=$i.elements;$F?($F.seed=$J[16],this.emitFromShell?$V._randomPointUnitSphere($i,$F):$V._randomPointInsideUnitSphere($i,$F),$J[16]=$F.seed):this.emitFromShell?$V._randomPointUnitSphere($i):$V._randomPointInsideUnitSphere($i),$qp.scale($i,this.radius,$i);var $t=$A[2];$t<0&&($A[2]=-1*$t),this.randomDirection?$F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p):$i.cloneTo($p)},$p.cloneTo=function($i){$F.prototype.cloneTo.call(this,$i);var $p=$i;$p.radius=this.radius,$p.emitFromShell=this.emitFromShell,$p.randomDirection=this.randomDirection}}($o),function($F){function $i(){this.radius=NaN,this.emitFromShell=!1,$i.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}$Z($i,"laya.d3.core.particleShuriKen.module.shape.SphereShape",$F);var $p=$i.prototype;$p._getShapeBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[1]=$p[2]=-this.radius;var $F=$i.max.elements;$F[0]=$F[1]=$F[2]=this.radius},$p._getSpeedBoundBox=function($i){var $p=$i.min.elements;$p[0]=$p[1]=$p[2]=-1;var $F=$i.max.elements;$F[0]=$F[1]=$F[2]=1},$p.generatePositionAndDirection=function($i,$p,$F,$J){$F?($F.seed=$J[16],this.emitFromShell?$V._randomPointUnitSphere($i,$F):$V._randomPointInsideUnitSphere($i,$F),$J[16]=$F.seed):this.emitFromShell?$V._randomPointUnitSphere($i):$V._randomPointInsideUnitSphere($i),$qp.scale($i,this.radius,$i),this.randomDirection?$F?($F.seed=$J[17],$V._randomPointUnitSphere($p,$F),$J[17]=$F.seed):$V._randomPointUnitSphere($p):$i.cloneTo($p)},$p.cloneTo=function($i){$F.prototype.cloneTo.call(this,$i);var $p=$i;$p.radius=this.radius,$p.emitFromShell=this.emitFromShell,$p.randomDirection=this.randomDirection}}($o),function($i){function $p(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,$p.__super.call(this)}return $Z($p,"laya.d3.core.render.SubMeshRenderElement",$w),$p}()),$Rp=function($i){function $j($i,$p,$F,$J,$A,$t){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=$i,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[$Zp.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[$kp.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[$kp.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[$cp.SHADERDEFINE_ALPHATEST]="ALPHATEST";$j.__super.call(this,$i,$p,$F,null,{}),this._attributeMap=$J;var $q;for($q in $A){var $B=$A[$q];switch($B[1]){case 0:this._renderElementUniformMap[$q]=$B[0];break;case 1:this._materialUniformMap[$q]=$B[0];break;case 2:this._spriteUniformMap[$q]=$B[0];break;case 3:this._cameraUniformMap[$q]=$B[0];break;case 4:this._sceneUniformMap[$q]=$B[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}$Z($j,"laya.d3.shader.ShaderCompile3D",$D);var $p=$j.prototype;return $p._definesToNameDic=function($i,$p){for(var $F={},$J=1,$A=0;$A<32&&!($i<($J=1<<$A));$A++)if($i&$J){var $t=$p[$J];$t&&($F[$t]="")}return $F},$p.withCompile=function($i,$p,$F,$J){var $A,$t,$q;if($t=this.sharders[$i])if($q=$t[$p]){if($A=$q[$F])return $A}else $q=$t[$p]=[];else $q=($t=this.sharders[$i]=[])[$p]=[];var $B,$O=this._definesToNameDic($i,$j._globalInt2name),$U=this._definesToNameDic($p,this._spriteInt2name),$d=this._definesToNameDic($F,this._materialInt2name),$u={},$S="";if($O)for($B in $O)$S+="#define "+$B+"\n",$u[$B]=!0;if($U)for($B in $U)$S+="#define "+$B+"\n",$u[$B]=!0;if($d)for($B in $d)$S+="#define "+$B+"\n",$u[$B]=!0;var $Z=$yp.nameKey.getName(this._name)+" compile ("+$i+","+$p+","+$F+")",$s=this._VS.toscript($u,[]),$x=this._PS.toscript($u,[]);$n.now();if($A=$yp.create($S+$s.join("\n"),$S+$x.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,$J,$Z),$q[$F]=$A,laya.d3.shader.ShaderCompile3D.debugMode)$n.now();return $A},$p.precompileShaderWithShaderDefine=function($i,$p,$F){this.withCompile($i,$p,$F,!0)},$p.addMaterialDefines=function($i){var $p=$i.defines;for(var $F in $p){var $J=$p[$F],$A=parseInt($F);this._materialInt2name[$A]=$J,this._materialName2Int[$J]=$A}},$p.addSpriteDefines=function($i){var $p=$i.defines;for(var $F in $p){var $J=$p[$F],$A=parseInt($F);this._spriteInt2name[$A]=$J,this._spriteName2Int[$J]=$A}},$p.getMaterialDefineByName=function($i){return this._materialName2Int[$i]},$p.registerMaterialDefine=function($i){var $p=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[$p]=$i,this._materialName2Int[$i]=$p},$p.registerSpriteDefine=function($i){var $p=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[$p]=$i,this._spriteName2Int[$i]=$p},$j._globalRegDefine=function($i,$p){$j._globalInt2name[$p]=$i},$j.add=function($i,$p,$F,$J,$A){return laya.d3.shader.ShaderCompile3D._preCompileShader[$i]=new $j($i,$p,$F,$J,$A,$D.includes)},$j.get=function($i){return laya.d3.shader.ShaderCompile3D._preCompileShader[$yp.nameKey.getID($i)]},$j._preCompileShader={},$j._globalInt2name=[],$j.debugMode=!1,$j.SHADERDEFINE_HIGHPRECISION=1,$j.SHADERDEFINE_FOG=4,$j.SHADERDEFINE_DIRECTIONLIGHT=8,$j.SHADERDEFINE_POINTLIGHT=16,$j.SHADERDEFINE_SPOTLIGHT=32,$j.SHADERDEFINE_UV0=64,$j.SHADERDEFINE_COLOR=128,$j.SHADERDEFINE_UV1=256,$j.SAHDERDEFINE_DEPTHFOG=131072,$j}(),$Qp=function($i){function $s(){$s.__super.call(this)}$Z($s,"laya.d3.graphics.MeshSprite3DStaticBatchManager",$Ji);var $p=$s.prototype;return $p._getStaticBatch=function($i,$p,$F,$J){var $A,$t;return $t=$i?$i.id.toString()+$F.id.toString()+$p.id.toString()+$J.toString():$F.id.toString()+$p.id.toString()+$J.toString(),this._staticBatches[$t]?$A=this._staticBatches[$t]:this._staticBatches[$t]=$A=new $Pp($t,this,$i,$p,$F),$A},$p._initStaticBatchs=function($i){var $p,$F;this._initBatchRenderElements.sort($s._sortPrepareStaticBatch);for(var $J,$A=!1,$t=0,$q=0,$B=this._initBatchRenderElements.length;$q<$B;$q++){var $O,$U=this._initBatchRenderElements[$q],$d=$U.renderObj._getVertexBuffer(0);$U._sprite3D;if($F===$d.vertexDeclaration&&$p===$U._material)if($A)$J._addCombineBatchRenderObjTest($U)?($O=$U._staticBatch)!==$J&&($O&&$O._deleteCombineBatchRenderObj($U),$J._addCombineBatchRenderObj($U)):($A=!1,$t++);else{var $u=this._initBatchRenderElements[$q-1],$S=$u.renderObj,$Z=$U.renderObj;$A=!(65535<$S._getVertexBuffer().vertexCount+$Z._getVertexBuffer().vertexCount)&&($J=this._getStaticBatch($i,$F,$p,$t),($O=$u._staticBatch)!==$J&&($O&&$O._deleteCombineBatchRenderObj($u),$J._addCombineBatchRenderObj($u)),($O=$U._staticBatch)!==$J&&($O&&$O._deleteCombineBatchRenderObj($U),$J._addCombineBatchRenderObj($U)),!0)}else $A=!1,$t=0;$p=$U._material,$F=$d.vertexDeclaration}},$s._sortPrepareStaticBatch=function($i,$p){var $F=$i._render,$J=$p._render,$A=$F.lightmapIndex-$J.lightmapIndex;if(0!=$A)return $A;var $t=$F.receiveShadow-$J.receiveShadow;if(0!=$t)return $t;var $q=$i._mainSortID-$p._mainSortID;return 0==$q?$i.renderObj.triangleCount-$p.renderObj.triangleCount:$q},$s}(),$Pp=function($i){function $t($i,$p,$F,$J,$A){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,$t.__super.call(this,$i,$p,$F),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=$J,this._material=$A}$Z($t,"laya.d3.graphics.SubMeshStaticBatch",$Ai);var $p=$t.prototype;return $p._compareBatchRenderElement=function($i,$p){return $i._batchIndexStart>$p._batchIndexStart},$p._addCombineBatchRenderObjTest=function($i){var $p=$i.renderObj._vertexCount;return!(65535<(0<$p?this._currentCombineVertexCount+$p:this._currentCombineVertexCount+$i.renderObj._getVertexBuffer().vertexCount))},$p._addCombineBatchRenderObj=function($i){var $p=$i.renderObj,$F=$p._vertexCount;this._initBatchRenderElements.push($i),$i._staticBatch=this,0<$F?(this._currentCombineIndexCount+=$p._indexCount,this._currentCombineVertexCount+=$F):(this._currentCombineIndexCount=this._currentCombineIndexCount+$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+$p._getVertexBuffer().vertexCount),this._needFinishCombine=!0},$p._deleteCombineBatchRenderObj=function($i){var $p=$i.renderObj,$F=this._initBatchRenderElements.indexOf($i);if(-1!==$F){this._initBatchRenderElements.splice($F,1),$i._staticBatch=null;var $J=$p._vertexCount;0<$J?(this._currentCombineIndexCount=this._currentCombineIndexCount-$p._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$J):(this._currentCombineIndexCount=this._currentCombineIndexCount-$p._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-$p._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},$p._finishInit=function(){if(this._needFinishCombine){var $i=0,$p=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var $F=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),$J=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=$op.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=$fp.create("ushort",this._currentCombineIndexCount,35044);for(var $A=0,$t=this._initBatchRenderElements.length;$A<$t;$A++){var $q=this._initBatchRenderElements[$A],$B=$q.renderObj,$O=$B._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,$q._sprite3D),$U=$B.getIndices(),$d=$q._sprite3D.transform._isFrontFaceInvert,$u=$i/(this._vertexDeclaration.vertexStride/4)-$B._vertexStart,$S=$p,$Z=$S+$U.length;$q._batchIndexStart=$S,$q._batchIndexEnd=$Z,$J.set($U,$p);var $s=0;if($d)for($s=$S;$s<$Z;$s+=3){$J[$s]=$u+$J[$s];var $x=$J[$s+1],$j=$J[$s+2];$J[$s+1]=$u+$j,$J[$s+2]=$u+$x}else for($s=$S;$s<$Z;$s+=3)$J[$s]=$u+$J[$s],$J[$s+1]=$u+$J[$s+1],$J[$s+2]=$u+$J[$s+2];$p+=$U.length,$F.set($O,$i),$i+=$O.length}this._vertexBuffer.setData($F),this._indexBuffer.setData($J),this._needFinishCombine=!1}},$p._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new $ap)},$p._getRenderElement=function($i,$p,$F){for(var $J,$A,$t=this._batchRenderElements.length,$q=!0,$B=0;$B<$t;$B++){var $O,$U,$d=($A=this._batchRenderElements[$B])._sprite3D._render;if(0!==$B&&($q=($O=($J=this._batchRenderElements[$B-1])._sprite3D._render).lightmapIndex!==$d.lightmapIndex||$O.receiveShadow!==$d.receiveShadow||$J._batchIndexEnd!==$A._batchIndexStart),$q){($U=this._getCombineRenderElementFromPool()).renderObj=this,$U._material=this._material,$U._batchIndexStart=$A._batchIndexStart,$U._batchIndexEnd=$A._batchIndexEnd;var $u=$d.lightmapIndex,$S=$u+1,$Z=this._batchOwnerIndices[$S];$Z||($Z=this._batchOwnerIndices[$S]=[]);var $s,$x=$Z[$A._render.receiveShadow?1:0];void 0===$x?($Z[$d.receiveShadow?1:0]=this._batchOwners.length,($s=new $$p(null,"StaticBatchMeshSprite3D"))._scene=$p,$s._transform=this._rootOwner?this._rootOwner._transform:null,$s._render.lightmapIndex=$u,$s._render.receiveShadow=$A._render.receiveShadow,this._batchOwners.push($s)):$s=this._batchOwners[$x],$s._render._renderUpdate($F),$U._sprite3D=$s,$i.push($U)}else $U._batchIndexEnd=$A._batchIndexEnd}},$p._beforeRender=function($i){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$p._render=function($i){var $p=$i.renderElement,$F=$p._batchIndexStart,$J=$p._batchIndexEnd-$F;$h.mainContext.drawElements(4,$J,5123,2*$F),$R.drawCall++,$R.trianglesFaces+=$J/3},$p.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},$p._getVertexBuffer=function($i){return void 0===$i&&($i=0),this._vertexBuffer},$t}(),$Yp=function($i){function $p(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,$p.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}$Z($p,"laya.d3.core.ComponentNode",$U);var $F=$p.prototype;return $F.addComponent=function($i){var $p,$F=this._componentsMap.indexOf($i);if(-1===$F)$p=[],this._componentsMap.push($i),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$F],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$i+"组件，"+$i+"组件已存在！");var $J=$A.getInstance($i);return $p.push(this._components.length),this._components.push($J),$J instanceof laya.d3.component.Script&&this._scripts.push($J),$J._initialize(this),$J},$F._removeComponent=function($i,$p){var $F=this._typeComponentsIndices[$i],$J=$F[$p],$A=this._components[$J];this._components.splice($J,1),$A instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($A),1),$F.splice($p,1),0===$F.length&&(this._typeComponentsIndices.splice($i,1),this._componentsMap.splice($i,1));for(var $t=0,$q=this._componentsMap.length;$t<$q;$t++)for(var $B=($F=this._typeComponentsIndices[$t]).length-1;0<=$B;$B--){var $O=$F[$B];if(!($J<$O))break;$F[$B]=--$O}$A._destroy()},$F.getComponentByType=function($i,$p){void 0===$p&&($p=0);var $F=this._componentsMap.indexOf($i);return-1===$F?null:this._components[this._typeComponentsIndices[$F][$p]]},$F.getComponentsByType=function($i,$p){var $F=this._componentsMap.indexOf($i);if(-1!==$F){var $J=this._typeComponentsIndices[$F],$A=$J.length;$p.length=$A;for(var $t=0;$t<$A;$t++)$p[$t]=this._components[$J[$t]]}else $p.length=0},$F.getComponentByIndex=function($i){return this._components[$i]},$F.removeComponentByType=function($i,$p){void 0===$p&&($p=0);var $F=this._componentsMap.indexOf($i);-1!==$F&&this._removeComponent($F,$p)},$F.removeComponentsByType=function($i){var $p=this._componentsMap.indexOf($i);if(-1!==$p)for(var $F=this._typeComponentsIndices[$p],$J=0,$A=$F.length;$J<$A;$F.length<$A?$A--:$J++)this._removeComponent($p,$J)},$F.removeAllComponent=function(){for(var $i=0,$p=this._componentsMap.length;$i<$p;this._componentsMap.length<$p?$p--:$i++)this.removeComponentsByType(this._componentsMap[$i])},$F._updateComponents=function($i){for(var $p=0,$F=this._components.length;$p<$F;$p++){var $J=this._components[$p];!$J.started&&($J._start($i),$J.started=!0),$J.enable&&$J._update($i)}},$F._lateUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._lateUpdate($i)}},$F._preRenderUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._preRenderUpdate($i)}},$F._postRenderUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._postRenderUpdate($i)}},$p}(),$cp=function($J){function $i(){$i.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new $Sp,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new $Bp(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}$Z($i,"laya.d3.core.material.BaseMaterial",$J);var $p=$i.prototype;return $v.imps($p,{"laya.d3.core.IClone":!0}),$p._addShaderDefine=function($i){this._shaderDefineValue|=$i},$p._removeShaderDefine=function($i){this._shaderDefineValue&=~$i},$p._addDisablePublicShaderDefine=function($i){this._disablePublicShaderDefine|=$i},$p._removeDisablePublicShaderDefine=function($i){this._disablePublicShaderDefine&=~$i},$p._setBuffer=function($i,$p){this._shaderValues.setValue($i,$p),this._values[$i]=$p},$p._getBuffer=function($i){return this._values[$i]},$p._setMatrix4x4=function($i,$p){this._shaderValues.setValue($i,$p?$p.elements:null),this._values[$i]=$p},$p._getMatrix4x4=function($i){return this._values[$i]},$p._setInt=function($i,$p){this._shaderValues.setValue($i,$p),this._values[$i]=$p},$p._getInt=function($i){return this._values[$i]},$p._setNumber=function($i,$p){this._shaderValues.setValue($i,$p),this._values[$i]=$p},$p._getNumber=function($i){return this._values[$i]},$p._setBool=function($i,$p){this._shaderValues.setValue($i,$p),this._values[$i]=$p},$p._getBool=function($i){return this._values[$i]},$p._setVector2=function($i,$p){this._shaderValues.setValue($i,$p?$p.elements:null),this._values[$i]=$p},$p._getVector2=function($i){return this._values[$i]},$p._setColor=function($i,$p){this._shaderValues.setValue($i,$p?$p.elements:null),this._values[$i]=$p},$p._getColor=function($i){return this._values[$i]},$p._setTexture=function($i,$p){var $F=this._values[$i];this._values[$i]=$p,this._shaderValues.setValue($i,$p),0<this.referenceCount&&($F&&$F._removeReference(),$p&&$p._addReference())},$p._getTexture=function($i){return this._values[$i]},$p._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},$p._getShader=function($i,$p,$F){var $J=($i|$p)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile($J,$F,this._shaderDefineValue),this._shader},$p._setRenderStateBlendDepth=function(){var $i=$h.mainContext;switch($m.setDepthMask($i,this.depthWrite),0===this.depthTest?$m.setDepthTest($i,!1):($m.setDepthTest($i,!0),$m.setDepthFunc($i,this.depthTest)),this.blend){case 0:$m.setBlend($i,!1);break;case 1:$m.setBlend($i,!0),$m.setBlendFunc($i,this.srcBlend,this.dstBlend);break;case 2:$m.setBlend($i,!0)}},$p._setRenderStateFrontFace=function($i,$p){var $F=$h.mainContext,$J=0;switch(this.cull){case 0:$m.setCullFace($F,!1);break;case 1:$m.setCullFace($F,!0),$J=$i?$p&&$p._isFrontFaceInvert?2305:2304:$p&&$p._isFrontFaceInvert?2304:2305,$m.setFrontFace($F,$J);break;case 2:$m.setCullFace($F,!0),$J=$i?$p&&$p._isFrontFaceInvert?2304:2305:$p&&$p._isFrontFaceInvert?2305:2304,$m.setFrontFace($F,$J)}},$p.onAsynLoaded=function($i,$p,$F){var $J=$p[0],$A=$p[1];switch($J.version){case"LAYAMATERIAL:01":var $t=0,$q=0,$B=$J.props;for(var $O in $B)switch($O){case"vectors":var $U=$B[$O];for($t=0,$q=$U.length;$t<$q;$t++){var $d=$U[$t],$u=$d.value;switch($u.length){case 2:this[$d.name]=new $tp($u[0],$u[1]);break;case 3:this[$d.name]=new $qp($u[0],$u[1],$u[2]);break;case 4:this[$d.name]=new $Bp($u[0],$u[1],$u[2],$u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var $S=$B[$O];for($t=0,$q=$S.length;$t<$q;$t++){var $Z=$S[$t],$s=$Z.path;$s&&(this[$Z.name]=$r.getRes($A[$s]))}break;case"defines":var $x=$B[$O];for($t=0,$q=$x.length;$t<$q;$t++){var $j=this._shaderCompile.getMaterialDefineByName($x[$t]);this._addShaderDefine($j)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[$O]=$B[$O];break;case"renderQueue":switch($B[$O]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[$O]=$B[$O]}break;case"LAYAMATERIAL:02":for($O in $B=$J.props)switch($O){case"vectors":for($t=0,$q=($U=$B[$O]).length;$t<$q;$t++)switch(($u=($d=$U[$t]).value).length){case 2:this[$d.name]=new $tp($u[0],$u[1]);break;case 3:this[$d.name]=new $qp($u[0],$u[1],$u[2]);break;case 4:this[$d.name]=new $Bp($u[0],$u[1],$u[2],$u[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for($t=0,$q=($S=$B[$O]).length;$t<$q;$t++)($s=($Z=$S[$t]).path)&&(this[$Z.name]=$r.getRes($A[$s]));break;case"defines":for($t=0,$q=($x=$B[$O]).length;$t<$q;$t++)$j=this._shaderCompile.getMaterialDefineByName($x[$t]),this._addShaderDefine($j);break;default:this[$O]=$B[$O]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},$p._addReference=function(){$J.prototype._addReference.call(this);for(var $i=0,$p=this._values.length;$i<$p;$i++){var $F=this._values[$i];$F&&$F instanceof laya.d3.resource.BaseTexture&&$F._addReference()}},$p._removeReference=function(){$J.prototype._removeReference.call(this);for(var $i=0,$p=this._values.length;$i<$p;$i++){var $F=this._values[$i];$F&&$F instanceof laya.d3.resource.BaseTexture&&$F._removeReference()}},$p.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},$p.setShaderName=function($i){var $p=$yp.nameKey.getID($i);if(-1===$p)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=$Rp._preCompileShader[$p]},$p.cloneTo=function($i){var $p=$i;$p.name=this.name,$p.cull=this.cull,$p.blend=this.blend,$p.srcBlend=this.srcBlend,$p.dstBlend=this.dstBlend,$p.srcBlendRGB=this.srcBlendRGB,$p.dstBlendRGB=this.dstBlendRGB,$p.srcBlendAlpha=this.srcBlendAlpha,$p.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo($p.blendConstColor),$p.blendEquation=this.blendEquation,$p.blendEquationRGB=this.blendEquationRGB,$p.blendEquationAlpha=this.blendEquationAlpha,$p.depthTest=this.depthTest,$p.depthWrite=this.depthWrite,$p.renderQueue=this.renderQueue,$p._shader=this._shader,$p._disablePublicShaderDefine=this._disablePublicShaderDefine,$p._shaderDefineValue=this._shaderDefineValue;var $F,$J=0,$A=$p._shaderValues;$p._shaderValues.data.length=this._shaderValues.data.length;var $t=this._values.length,$q=$p._values;for($J=0,$F=$q.length=$t;$J<$F;$J++){var $B=this._values[$J];if($B)if("number"==typeof $B)$q[$J]=$B,$A.data[$J]=$B;else if("number"==typeof $B&&Math.floor($B)==$B)$q[$J]=$B,$A.data[$J]=$B;else if("boolean"==typeof $B)$q[$J]=$B,$A.data[$J]=$B;else if($B instanceof laya.d3.math.Vector2){var $O=$q[$J]||($q[$J]=new $tp);$B.cloneTo($O),$A.data[$J]=$O.elements}else if($B instanceof laya.d3.math.Vector3){var $U=$q[$J]||($q[$J]=new $qp);$B.cloneTo($U),$A.data[$J]=$U.elements}else if($B instanceof laya.d3.math.Vector4){var $d=$q[$J]||($q[$J]=new $Bp);$B.cloneTo($d),$A.data[$J]=$d.elements}else if($B instanceof laya.d3.math.Matrix4x4){var $u=$q[$J]||($q[$J]=new $ip);$B.cloneTo($u),$A.data[$J]=$u.elements}else $B instanceof laya.d3.resource.BaseTexture&&($q[$J]=$B,$A.data[$J]=$B)}},$p.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$s(0,$p,"alphaTestValue",function(){return this._getNumber(0)},function($i){this._setNumber(0,$i)}),$s(0,$p,"alphaTest",function(){return this._alphaTest},function($i){(this._alphaTest=$i)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),$i.__init__=function(){$i.SHADERDEFINE_ALPHATEST=$i.shaderDefines.registerDefine("ALPHATEST")},$i.RENDERQUEUE_OPAQUE=2e3,$i.RENDERQUEUE_ALPHATEST=2450,$i.RENDERQUEUE_TRANSPARENT=3e3,$i.CULL_NONE=0,$i.CULL_FRONT=1,$i.CULL_BACK=2,$i.BLEND_DISABLE=0,$i.BLEND_ENABLE_ALL=1,$i.BLEND_ENABLE_SEPERATE=2,$i.BLENDPARAM_ZERO=0,$i.BLENDPARAM_ONE=1,$i.BLENDPARAM_SRC_COLOR=768,$i.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,$i.BLENDPARAM_DST_COLOR=774,$i.BLENDPARAM_ONE_MINUS_DST_COLOR=775,$i.BLENDPARAM_SRC_ALPHA=770,$i.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,$i.BLENDPARAM_DST_ALPHA=772,$i.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,$i.BLENDPARAM_SRC_ALPHA_SATURATE=776,$i.BLENDEQUATION_ADD=0,$i.BLENDEQUATION_SUBTRACT=1,$i.BLENDEQUATION_REVERSE_SUBTRACT=2,$i.DEPTHTEST_OFF=0,$i.DEPTHTEST_NEVER=512,$i.DEPTHTEST_LESS=513,$i.DEPTHTEST_EQUAL=514,$i.DEPTHTEST_LEQUAL=515,$i.DEPTHTEST_GREATER=516,$i.DEPTHTEST_NOTEQUAL=517,$i.DEPTHTEST_GEQUAL=518,$i.DEPTHTEST_ALWAYS=519,$i.SHADERDEFINE_ALPHATEST=1,$i.ALPHATESTVALUE=0,$u($i,["shaderDefines",function(){return this.shaderDefines=new $dp}]),$i}($j),$hp=function($i){function $p(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,$p.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}$Z($p,"laya.d3.resource.BaseTexture",$j);var $F=$p.prototype;return $s(0,$F,"width",function(){return this._width}),$s(0,$F,"repeat",function(){return this._repeat},function($i){if(this._repeat!==$i&&(this._repeat=$i,this._source)){var $p=$h.mainContext;$m.bindTexture($p,this._type,this._source),$E.isPOT(this._width,this._height)&&this._repeat?($p.texParameteri(this._type,10242,10497),$p.texParameteri(this._type,10243,10497)):($p.texParameteri(this._type,10242,33071),$p.texParameteri(this._type,10243,33071))}}),$s(0,$F,"height",function(){return this._height}),$s(0,$F,"magFifter",function(){return this._magFifter},function($i){(this._magFifter=$i)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter($i)}),$s(0,$F,"wrapModeV",function(){return this._wrapModeV}),$s(0,$F,"size",function(){return this._size}),$s(0,$F,"wrapModeU",function(){return this._wrapModeU}),$s(0,$F,"mipmap",function(){return this._mipmap},function($i){this._mipmap=$i,this._mipmap!=$i&&this._conchTexture&&this._conchTexture.setMipMap($i)}),$s(0,$F,"minFifter",function(){return this._minFifter},function($i){this._minFifter=$i,this._minFifter!=$i&&this._conchTexture&&this._conchTexture.setMinFifter($i)}),$s(0,$F,"format",function(){return this._format}),$s(0,$F,"source",function(){return this.activeResource(),this._source}),$s(0,$F,"defaulteTexture",function(){return $Kp.grayTexture}),$p.WARPMODE_REPEAT=0,$p.WARPMODE_CLAMP=1,$p}(),$mp=function($i){function $p(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,$p.__super.call(this),this._boundingBoxCorners=$J(8,null)}$Z($p,"laya.d3.resource.models.BaseMesh",$j);var $F=$p.prototype;return $F._getPositions=function(){throw new Error("未Override,请重载该属性！")},$F._generateBoundingObject=function(){this._boundingSphere=new $zi(new $qp,0),$zi.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new $ei(new $qp,new $qp),$ei.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},$F.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},$F.getRenderElement=function($i){throw new Error("未Override,请重载该属性！")},$s(0,$F,"subMeshCount",function(){return this._subMeshCount}),$s(0,$F,"boundingBox",function(){return this._boundingBox}),$s(0,$F,"boundingBoxCorners",function(){return this._boundingBoxCorners}),$s(0,$F,"boundingSphere",function(){return this._boundingSphere}),$p}(),$np=(function($i){function $p(){$p.__super.call(this)}$Z($p,"laya.d3.component.Script",$Dp);var $F=$p.prototype;$F.onTriggerEnter=function($i){},$F.onTriggerExit=function($i){},$F.onTriggerStay=function($i){},$s(0,$F,"isSingleton",function(){return $p._isSingleton}),$p._isSingleton=!1}(),function($i){function $p($i){this._owner=null,this._sharedMesh=null,$p.__super.call(this),this._owner=$i}$Z($p,"laya.d3.core.MeshFilter",$i);var $F=$p.prototype;return $F._sharedMeshLoaded=function(){this.event("loaded")},$F._destroy=function(){$i.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},$s(0,$F,"sharedMesh",function(){return this._sharedMesh},function($i){var $p=this._sharedMesh;$p&&$p._removeReference(),(this._sharedMesh=$i)._addReference(),this.event("meshchanged",[this,$p,$i]),$i.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),$s(0,$F,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),$s(0,$F,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),$s(0,$F,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),$s(0,$F,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),$p}($Ep)),$Ip=function($i){function $p($i){$p.__super.call(this,$i),$i.meshFilter.on("meshchanged",this,this._onMeshChanged)}$Z($p,"laya.d3.core.MeshRender",$vp);var $F=$p.prototype;return $F._onMeshChanged=function($i,$p,$F){$F.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:$F.once("loaded",this,this._onMeshLoaed)},$F._onMeshLoaed=function($i,$p){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},$F._calculateBoundingSphereByInitSphere=function($i){var $p=NaN,$F=this._owner.transform,$J=$F.scale.elements,$A=Math.abs($J[0]),$t=Math.abs($J[1]),$q=Math.abs($J[2]);$p=$t<=$A&&$q<=$A?$A:$q<=$t?$t:$q,$qp.transformCoordinate($i.center,$F.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=$i.radius*$p},$F._calculateBoundBoxByInitCorners=function($i){for(var $p=this._owner.transform.worldMatrix,$F=0;$F<8;$F++)$qp.transformCoordinate($i[$F],$p,$vp._tempBoundBoxCorners[$F]);$ei.createfromPoints($vp._tempBoundBoxCorners,this._boundingBox)},$F._calculateBoundingSphere=function(){var $i=this._owner.meshFilter.sharedMesh;null==$i||null==$i.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere($i.boundingSphere)},$F._calculateBoundingBox=function(){var $i=this._owner.meshFilter.sharedMesh;null==$i||null==$i.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners($i.boundingBoxCorners)},$F._renderUpdate=function($i){var $p=this._owner.transform;if($p){this._setShaderValueMatrix4x4(0,$p.worldMatrix);var $F=this._owner.getProjectionViewWorldMatrix($i);this._setShaderValueMatrix4x4(1,$F)}else this._setShaderValueMatrix4x4(0,$ip.DEFAULT),this._setShaderValueMatrix4x4(1,$i);return $rp.debugMode&&this._renderRenderableBoundBox(),!0},$p}(),$Gp=function($p){function $J(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,$J.__super.call(this),this._renderState=new $X,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new $Sp,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new $pi,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new $qp(.7,.7,.7),this.ambientColor=new $qp(.212,.227,.259),$h.shaderHighPrecision&&this.addShaderDefine($Rp.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}$Z($J,"laya.d3.core.scene.Scene",$p);var $i=$J.prototype;return $v.imps($i,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),$i._setUrl=function($i){this._url=$i},$i._getGroup=function(){return this._group},$i._setGroup=function($i){this._group=$i},$i._display=function(){$v.stage._scenes.push(this),$v.stage._scenes.sort($J._sortScenes);for(var $i=0,$p=this._childs.length;$i<$p;$i++){var $F=this._childs[$i];$F.active&&$F._activeHierarchy()}},$i._unDisplay=function(){var $i=$v.stage._scenes;$i.splice($i.indexOf(this),1);for(var $p=0,$F=this._childs.length;$p<$F;$p++){var $J=this._childs[$p];$J.active&&$J._inActiveHierarchy()}},$i._addChild3D=function($i){$i.transform._onWorldTransform(),$i._setBelongScene(this),this.displayedInStage&&$i.active&&$i._activeHierarchy()},$i._removeChild3D=function($i){$i.transform.parent=null,this.displayedInStage&&$i.active&&$i._inActiveHierarchy(),$i._setUnBelongScene()},$i.initOctree=function($i,$p,$F,$J,$A){void 0===$A&&($A=6),this.treeSize=new $qp($i,$p,$F),this.treeLevel=$A,this.treeRoot=new $e(this,0),this.treeRoot.init($J,this.treeSize)},$i._prepareUpdateToRenderState=function($i,$p){$p.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,$p.scene=this},$i._prepareSceneToRender=function($i){var $p=this._lights.length;if(0<$p)for(var $F=0,$J=0;$J<$p&&!(this._lights[$J]._prepareToScene($i)&&++$F>=this._enableLightCount);$J++);},$i._updateChilds=function($i){for(var $p=0,$F=this._childs.length;$p<$F;++$p)this._childs[$p]._update($i)},$i._preRenderScene=function($i,$p,$F){var $J,$A=$p._viewMatrix,$t=$p._projectionMatrix,$q=$p._projectionViewMatrix,$B=0,$O=$p.camera;for($O.useOcclusionCulling?this.treeRoot?$Fi.renderObjectCullingOctree($F,this,$O,$A,$t,$q):$Fi.renderObjectCulling($F,this,$O,$A,$t,$q):$Fi.renderObjectCullingNoBoundFrustum(this,$O,$A,$t,$q),$B=0,$J=this._quenes.length;$B<$J;$B++)this._quenes[$B]&&this._quenes[$B]._preRender($p)},$i._clear=function($i,$p){var $F=$p._viewport,$J=$p.camera,$A=$F.x,$t=$J.renderTargetSize.height-$F.y-$F.height,$q=$F.width,$B=$F.height;$i.viewport($A,$t,$q,$B);var $O=256,$U=$J.renderTarget;switch($J.clearFlag){case 0:var $d=$J.clearColor;if($d){$i.enable(3089),$i.scissor($A,$t,$q,$B);var $u=$d.elements;$i.clearColor($u[0],$u[1],$u[2],$u[3]),$O|=16384}if($U)switch($d||($O=16384),$U.depthStencilFormat){case 33189:$O|=256;break;case 36168:$O|=1024;break;case 34041:$O|=256,$O|=1024}$i.clear($O),$d&&$i.disable(3089);break;case 1:case 2:if($U)switch($O=16384,$U.depthStencilFormat){case 33189:$O|=256;break;case 36168:$O|=1024;break;case 34041:$O|=256,$O|=1024}$i.clear($O);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},$i._renderScene=function($i,$p){var $F,$J,$A=$p.camera,$t=0;for($t=0;$t<2;$t++)($J=this._quenes[$t])&&($A.renderTarget?$J._render($p,!0):$J._render($p,!1));if(1===$A.clearFlag){var $q=$A.sky;$q&&($m.setCullFace($i,!1),$m.setDepthFunc($i,515),$m.setDepthMask($i,!1),$q._render($p),$m.setDepthFunc($i,513),$m.setDepthMask($i,!0))}for($t=2,$F=this._quenes.length;$t<$F;$t++)($J=this._quenes[$t])&&($J._sortAlpha($p.camera.transform.position),$A.renderTarget?$J._render($p,!0):$J._render($p,!1))},$i._set3DRenderConfig=function($i){$i.disable(3042),$m._blend=!1,$i.blendFunc(770,771),$m._sFactor=770,$m._dFactor=771,$i.disable(2929),$m._depthTest=!1,$i.enable(2884),$m._cullFace=!0,$i.depthMask(1),$m._depthMask=!0,$i.frontFace(2304),$m._frontFace=2304},$i._set2DRenderConfig=function($i){$m.setBlend($i,!0),$m.setBlendFunc($i,1,771),$m.setDepthTest($i,!1),$m.setCullFace($i,!1),$m.setDepthMask($i,!0),$m.setFrontFace($i,2305),$i.viewport(0,0,$d.width,$d.height)},$i._parseCustomProps=function($i,$p,$F,$J){var $A=$J.customProps.lightmaps,$t=$A.length,$q=this._lightmaps;$q.length=$t;for(var $B=0;$B<$t;$B++)$q[$B]=$r.getRes($p[$A[$B].replace(".exr",".png")]);this.setlightmaps($q);var $O=$J.customProps.ambientColor;$O&&(this.ambientColor=new $qp($O[0],$O[1],$O[2]));var $U=$J.customProps.fogColor;$U&&(this.fogColor=new $qp($U[0],$U[1],$U[2]))},$i._addLight=function($i){this._lights.indexOf($i)<0&&this._lights.push($i)},$i._removeLight=function($i){var $p=this._lights.indexOf($i);0<=$p&&this._lights.splice($p,1)},$i._updateScene=function(){var $i=this._renderState;this._prepareUpdateToRenderState($h.mainContext,$i),this._updateComponents($i),this._updateChilds($i),this._lateUpdateComponents($i),this._time+=$i.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},$i._updateSceneConch=function(){var $i=this._renderState;this._prepareUpdateToRenderState($h.mainContext,$i),this._updateComponents($i),this._lateUpdateComponents($i),this._prepareSceneToRender($i);for(var $p=0,$F=this._cameraPool.length;$p<$F;$p++){var $J=this._cameraPool[$p];($i.camera=$J)._prepareCameraToRender()}},$i._preRenderShadow=function($i,$p,$F,$J,$A){this.treeRoot?$Fi.renderShadowObjectCullingOctree(this,$p,$F,$J,$A):$Fi.renderShadowObjectCulling(this,$p,$F,$J,$A);for(var $t=0,$q=$F.length;$t<$q;$t++)$F[$t]&&$F[$t]._preRender($i)},$i._renderShadowMap=function($i,$p,$F){var $J=this.parallelSplitShadowMaps[0];$J._calcAllLightCameraInfo($F);var $A,$t,$q,$B=$J.PSSMNum;if(this._preRenderShadow($p,$J._lightCulling,$J._shadowQuenes,$J._lightVPMatrix[0],$B),this.addShaderDefine($Zp.SHADERDEFINE_CAST_SHADOW),1<$B)for(var $O=0;$O<$B;$O++)$A=$J.getRenderTarget($O+1),$J.beginRenderTarget($O+1),$i.clearColor(1,1,1,1),$i.clear(16640),$i.viewport(0,0,$A.width,$A.height),$p.camera=$q=$J.getLightCamera($O),$q._prepareCameraToRender(),$q._prepareCameraViewProject($q.viewMatrix,$q.projectionMatrix),$p._projectionViewMatrix=$J._lightVPMatrix[$O+1],($t=$J._shadowQuenes[$O])._preRender($p),$t._renderShadow($p,!1),$J.endRenderTarget($O+1);else $A=$J.getRenderTarget(1),$J.beginRenderTarget(1),$i.clearColor(1,1,1,1),$i.clear(16640),$i.viewport(0,0,$A.width,$A.height),$p.camera=$q=$J.getLightCamera(0),$q._prepareCameraToRender(),$q._prepareCameraViewProject($q.viewMatrix,$q.projectionMatrix),$p._projectionViewMatrix=$J._lightVPMatrix[0],($t=$J._shadowQuenes[0])._preRender($p),$t._renderShadow($p,!0),$J.endRenderTarget(1);this.removeShaderDefine($Zp.SHADERDEFINE_CAST_SHADOW)},$i.addTreeNode=function($i){this.treeRoot.addTreeNode($i)},$i.removeTreeNode=function($i){this.treeSize&&$i._treeNode&&$i._treeNode.removeObject($i)},$i.setlightmaps=function($i){this._lightmaps=$i;for(var $p=0,$F=this._renderableSprite3Ds.length;$p<$F;$p++)this._renderableSprite3Ds[$p]._render._applyLightMapParams()},$i.getlightmaps=function(){return this._lightmaps},$i.addChildAt=function($i,$p){if(!($i instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+($i&&$i.__className));if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($i._parent===this){var $F=this.getChildIndex($i);this._childs.splice($F,1),this._childs.splice($p,0,$i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,$p)),this._childChanged()}else $i.parent&&$i.parent.removeChild($i),this._childs===$U.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,$p),($i.parent=this)._addChild3D($i);return $i}throw new Error("appendChildAt:The index is out of bounds")},$i.addChild=function($i){if(!($i instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),$i._parent===this){var $p=this.getChildIndex($i);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,this._childs.length-1)),this._childChanged())}else $i.parent&&$i.parent.removeChild($i),this._childs===$U.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,this._childs.length-1),($i.parent=this)._childChanged(),this._addChild3D($i);return $i},$i.removeChildAt=function($i){var $p=this.getChildAt($i);return $p&&(this._removeChild3D($p),this._childs.splice($i,1),this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null),$p},$i.removeChildren=function($i,$p){if(void 0===$i&&($i=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $F=this._childs;if(0===$i&&$t<=$p){var $J=$F;this._childs=$U.ARRAY_EMPTY}else $J=$F.splice($i,$p-$i);for(var $A=0,$t=$J.length;$A<$t;$A++)this._removeChild3D($J[$A]),$J[$A].parent=null,this.conchModel&&this.conchModel.removeChild($J[$A].conchModel)}return this},$i.addFrustumCullingObject=function($i){this.treeRoot?this.addTreeNode($i):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push($i):this._cullingRenders[this._cullingRendersLength]=$i,$i._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},$i.removeFrustumCullingObject=function($i){if(this.treeRoot)this.removeTreeNode($i);else{this._cullingRendersLength--;var $p=$i._indexInSceneFrustumCullingObjects;if($p!==this._cullingRendersLength){var $F=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[$p]=$F)._indexInSceneFrustumCullingObjects=$p,$i._indexInSceneFrustumCullingObjects=-1}}},$i.getRenderQueue=function($i){return $i<3e3?this._quenes[1]||(this._quenes[1]=new $$(this)):this._quenes[2]||(this._quenes[2]=new $$(this))},$i.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new $$(this)},$i.addShaderDefine=function($i){this._shaderDefineValue|=$i},$i.removeShaderDefine=function($i){this._shaderDefineValue&=~$i},$i.addScript=function($i){return this._addComponent($i)},$i.getScriptByType=function($i,$p){return void 0===$p&&($p=0),this._getComponentByType($i,$p)},$i.getScriptsByType=function($i,$p){this._getComponentsByType($i,$p)},$i.getScriptByIndex=function($i){return this._getComponentByIndex($i)},$i.removeScriptByType=function($i,$p){void 0===$p&&($p=0),this._removeComponentByType($i,$p)},$i.removeScriptsByType=function($i){this._removeComponentByType($i)},$i.removeAllScript=function(){this._removeAllComponent()},$i.render=function($i,$p,$F){($x._context.ctx._renderKey=0)<this._childs.length&&$i.addRenderObject(this)},$i.renderSubmit=function(){var $i=$h.mainContext,$p=this._renderState;this._set3DRenderConfig($i),this._prepareSceneToRender(this._renderState);var $F,$J=0,$A=0;if($rp.debugMode||$e.debugMode)for($J=0,$A=this._cameraPool.length;$J<$A;$J++)$F=this._cameraPool[$J],$rp._debugPhasorSprite.begin(1,$F),$F.activeInHierarchy&&$F._renderCamera($i,$p,this),$rp._debugPhasorSprite.end();else for($J=0,$A=this._cameraPool.length;$J<$A;$J++)($F=this._cameraPool[$J]).activeInHierarchy&&$F._renderCamera($i,$p,this);return this._set2DRenderConfig($i),1},$i.onAsynLoaded=function($i,$p,$F){var $J=$p[0];if("Scene"!==$J.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var $A=$p[1];$jp._createNodeByJson(this,$J,this,$A),this.event("hierarchyloaded",[this]),this.__loaded=!0},$i.destroy=function($i){void 0===$i&&($i=!0),this.destroyed||($p.prototype.destroy.call(this,$i),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,$r.clearRes(this.url),this.loaded||$rp._cancelLoadByUrl(this.url))},$i.getRenderType=function(){return 0},$i.releaseRender=function(){},$i._addComponent=function($i){var $p,$F=this._componentsMap.indexOf($i);if(-1===$F)$p=[],this._componentsMap.push($i),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$F],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$i+"组件，"+$i+"组件已存在！");var $J=$A.getInstance($i);$p.push(this._components.length),this._components.push($J);return $J._initialize(this),$J},$i._removeComponent=function($i,$p){var $F=this._typeComponentsIndices[$i],$J=$F[$p],$A=this._components[$J];this._components.splice($J,1),$F.splice($p,1),0===$F.length&&(this._typeComponentsIndices.splice($i,1),this._componentsMap.splice($i,1));for(var $t=0,$q=this._componentsMap.length;$t<$q;$t++)for(var $B=($F=this._typeComponentsIndices[$t]).length-1;0<=$B;$B--){var $O=$F[$B];if(!($J<$O))break;$F[$B]=--$O}$A._destroy()},$i._getComponentByType=function($i,$p){void 0===$p&&($p=0);var $F=this._componentsMap.indexOf($i);return-1===$F?null:this._components[this._typeComponentsIndices[$F][$p]]},$i._getComponentsByType=function($i,$p){var $F=this._componentsMap.indexOf($i);if(-1!==$F){var $J=this._typeComponentsIndices[$F],$A=$J.length;$p.length=$A;for(var $t=0;$t<$A;$t++)$p[$t]=this._components[$J[$t]]}else $p.length=0},$i._getComponentByIndex=function($i){return this._components[$i]},$i._removeComponentByType=function($i,$p){void 0===$p&&($p=0);var $F=this._componentsMap.indexOf($i);-1!==$F&&this._removeComponent($F,$p)},$i._removeComponentsByType=function($i){var $p=this._componentsMap.indexOf($i);if(-1!==$p)for(var $F=this._typeComponentsIndices[$p],$J=0,$A=$F.length;$J<$A;$F.length<$A?$A--:$J++)this._removeComponent($p,$J)},$i._removeAllComponent=function(){for(var $i=0,$p=this._componentsMap.length;$i<$p;this._componentsMap.length<$p?$p--:$i++)this._removeComponentsByType(this._componentsMap[$i])},$i._updateComponents=function($i){for(var $p=0,$F=this._components.length;$p<$F;$p++){var $J=this._components[$p];!$J.started&&($J._start($i),$J.started=!0),$J.enable&&$J._update($i)}},$i._lateUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._lateUpdate($i)}},$i._preRenderUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._preRenderUpdate($i)}},$i._postRenderUpdateComponents=function($i){for(var $p=0;$p<this._components.length;$p++){var $F=this._components[$p];!$F.started&&($F._start($i),$F.started=!0),$F.enable&&$F._postRenderUpdate($i)}},$s(0,$i,"_loaded",null,function($i){this.__loaded=$i}),$s(0,$i,"fogColor",function(){return this._fogColor},function($i){this._fogColor=$i,this._shaderValues.setValue(0,$i.elements)}),$s(0,$i,"enableFog",function(){return this._enableFog},function($i){this._enableFog!==$i&&((this._enableFog=$i)?(this.addShaderDefine($Rp.SHADERDEFINE_FOG),this.removeShaderDefine($Rp.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine($Rp.SHADERDEFINE_FOG))}),$s(0,$i,"url",function(){return this._url}),$s(0,$i,"loaded",function(){return this.__loaded}),$s(0,$i,"enableDepthFog",function(){return this._enableDepthFog},function($i){this._enableDepthFog!=$i&&((this._enableDepthFog=$i)?(this.addShaderDefine($Rp.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine($Rp.SHADERDEFINE_FOG)):this.removeShaderDefine($Rp.SAHDERDEFINE_DEPTHFOG))}),$s(0,$i,"fogStart",function(){return this._fogStart},function($i){this._fogStart=$i,this._shaderValues.setValue(1,$i)}),$s(0,$i,"fogRange",function(){return this._fogRange},function($i){this._fogRange=$i,this._shaderValues.setValue(2,$i)}),$s(0,$i,"ambientColor",function(){return this._ambientColor},function($i){this._ambientColor=$i,this._shaderValues.setValue(21,$i.elements)}),$s(0,$i,"scene",function(){return this}),$s(0,$i,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),$J._sortScenes=function($i,$p){if($i.parent!==$v.stage||$p.parent!==$v.stage)return $i.parent!==$v.stage&&$p.parent!==$v.stage?$J._sortScenes($i.parent,$p.parent):$i.parent===$v.stage?-1:1;var $F=$v.stage._childs;return $F.indexOf($i)-$F.indexOf($p)},$J.load=function($i){return $v.loader.create($i,null,null,$J)},$J.FOGCOLOR=0,$J.FOGSTART=1,$J.FOGRANGE=2,$J.LIGHTDIRECTION=3,$J.LIGHTDIRCOLOR=4,$J.POINTLIGHTPOS=5,$J.POINTLIGHTRANGE=6,$J.POINTLIGHTATTENUATION=7,$J.POINTLIGHTCOLOR=8,$J.SPOTLIGHTPOS=9,$J.SPOTLIGHTDIRECTION=10,$J.SPOTLIGHTSPOT=11,$J.SPOTLIGHTRANGE=12,$J.SPOTLIGHTATTENUATION=13,$J.SPOTLIGHTCOLOR=14,$J.SHADOWDISTANCE=15,$J.SHADOWLIGHTVIEWPROJECT=16,$J.SHADOWMAPPCFOFFSET=17,$J.SHADOWMAPTEXTURE1=18,$J.SHADOWMAPTEXTURE2=19,$J.SHADOWMAPTEXTURE3=20,$J.AMBIENTCOLOR=21,$J.TIME=22,$J}($a),$_p=function($i){function $p($i){$p.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new $ip,this._shaderValues=new $Sp,this._colliders=[],this._id=++$p._uniqueIDCounter,this._transform=new $gp(this),this.name=$i||"Sprite3D-"+$p._nameNumberCounter++,this.layer=$I.currentCreationLayer,this.active=!0}$Z($p,"laya.d3.core.Sprite3D",$Yp);var $F=$p.prototype;return $v.imps($F,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),$F._setUrl=function($i){this._url=$i},$F._getGroup=function(){return this._group},$F._setGroup=function($i){this._group=$i},$F._addChild3D=function($i){$i.transform.parent=this.transform,this._hierarchyAnimator&&(!$i._hierarchyAnimator&&$i._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($i,!0,[$i.name])),this._scene&&($i._setBelongScene(this._scene),this._activeInHierarchy&&$i._active&&$i._activeHierarchy())},$F._removeChild3D=function($i){$i.transform.parent=null,this._scene&&(this._activeInHierarchy&&$i._active&&$i._inActiveHierarchy(),$i._setUnBelongScene()),this._hierarchyAnimator&&($i._hierarchyAnimator==this._hierarchyAnimator&&$i._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D($i,!1,[$i.name]))},$F._parseBaseCustomProps=function($i){var $p=this.transform.localPosition;$i.translate?($p.fromArray($i.translate),$p.x*=100,$p.y*=100,$p.z*=100):$p.elements.fill(0),this.transform.localPosition=$p;var $F=this.transform.localRotation;$i.rotation?$F.fromArray($i.rotation):$F.fromArray([0,0,0,-1]),this.transform.localRotation=$F;var $J=this.transform.localScale;$i.scale?$J.fromArray($i.scale):$J.elements.fill(1),this.transform.localScale=$J;var $A=$i.layer;null!=$A&&(this.layer=$I.getLayerByNumber($A))},$F._parseCustomComponent=function($i,$p,$F){for(var $J in $F){var $A=$F[$J];switch($J){case"Animator":var $t=this.addComponent(Animator);if($A.avatarPath)$t.avatar=$r.getRes($p[$A.avatarPath]);else{var $q=$A.avatar;if($q){$t.avatar=$r.getRes($p[$q.path]);var $B=$q.linkSprites;$B&&$i.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[$t,$B])}}for(var $O=$A.clipPaths,$U=$O.length,$d=0;$d<$U;$d++)$t.addClip($r.getRes($p[$O[$d]]));$t.clip=$r.getRes($p[$O[0]]);var $u=$A.playOnWake;void 0!==$u&&($t.playOnWake=$u);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var $S=this.addComponent(SphereCollider);$S.isTrigger=$A.isTrigger;var $Z=$S.center;$Z.fromArray($A.center),$S.center=$Z,$S.radius=$A.radius;break;case"BoxCollider":var $s=this.addComponent(BoxCollider);$s.isTrigger=$A.isTrigger,$s.center.fromArray($A.center);var $x=$s.size;$x.fromArray($A.size),$s.size=$x;break;case"MeshCollider":this.addComponent(MeshCollider)}}},$F._onRootNodeHierarchyLoaded=function($i,$p){for(var $F in $p){for(var $J=this,$A=$p[$F],$t=0,$q=$A.length;$t<$q;$t++){var $B=$A[$t];if(""===$B)break;if(!($J=$J.getChildByName($B)))break}$J&&$i.linkSprite3DToAvatarNode($F,$J)}},$F._setHierarchyAnimator=function($i,$p){this._changeHierarchyAnimator($i);for(var $F=0,$J=this._childs.length;$F<$J;$F++){var $A=this._childs[$F];$A._hierarchyAnimator==$p&&$A._setHierarchyAnimator($i,$p)}},$F._clearHierarchyAnimator=function($i,$p){this._changeHierarchyAnimator($p);for(var $F=0,$J=this._childs.length;$F<$J;$F++){var $A=this._childs[$F];$A._hierarchyAnimator==$i&&$A._clearHierarchyAnimator($i,$p)}},$F._getAnimatorToLinkSprite3D=function($i,$p,$F){var $J=this.getComponentByType(Animator);if($J&&($J.avatar?$J.avatar._version||$i._setAnimatorToLinkAvatar($J,$p):$i._setAnimatorToLinkSprite3DNoAvatar($J,$p,$F)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){$F.unshift(this._parent.name);var $A=this._parent;$A._hierarchyAnimator&&$A._getAnimatorToLinkSprite3D($i,$p,$F)}},$F._setAnimatorToLinkSprite3DNoAvatar=function($i,$p,$F){var $J=0,$A=0;for($J=0,$A=$i.getClipCount();$J<$A;$J++)$i._handleSpriteOwnersBySprite($J,$p,$F,this);for($J=0,$A=this._childs.length;$J<$A;$J++){var $t=this._childs[$J],$q=$F.length;$F.push($t.name),$t._setAnimatorToLinkSprite3DNoAvatar($i,$p,$F),$F.splice($q,1)}},$F._changeHierarchyAnimator=function($i){this._hierarchyAnimator=$i},$F._isLinkSpriteToAnimationNode=function($i,$p,$F){var $J=$i._avatarNodes.indexOf($p),$A=$i._cacheSpriteToNodesMap;if($F)this._transform.dummy=$p.transform,$i._cacheNodesToSpriteMap[$J]=$A.length,$A.push($J);else{this._transform.dummy=null;var $t=$i._cacheNodesToSpriteMap[$J];$i._cacheNodesToSpriteMap[$J]=null,$A.splice($t,1)}},$F._setBelongScene=function($i){this._scene=$i;for(var $p=0,$F=this._childs.length;$p<$F;$p++)this._childs[$p]._setBelongScene($i)},$F._setUnBelongScene=function(){this._scene=null;for(var $i=0,$p=this._childs.length;$i<$p;$i++)this._childs[$i]._setUnBelongScene()},$F._activeHierarchy=function(){var $i=0,$p=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),$i=0,$p=this._colliders.length;$i<$p;$i++)this._layer._addCollider(this._colliders[$i]);for(this.event("activeinhierarchychanged",!0),$i=0,$p=this._childs.length;$i<$p;$i++){var $F=this._childs[$i];$F._active&&$F._activeHierarchy()}},$F._inActiveHierarchy=function(){var $i=0,$p=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),$i=0,$p=this._colliders.length;$i<$p;$i++){var $F=this._colliders[$i];$F._clearCollsionMap(),this._layer._removeCollider($F)}for(this.event("activeinhierarchychanged",!1),$i=0,$p=this._childs.length;$i<$p;$i++){var $J=this._childs[$i];$J._active&&$J._inActiveHierarchy()}},$F.addComponent=function($i){var $p,$F=this._componentsMap.indexOf($i);if(-1===$F)$p=[],this._componentsMap.push($i),this._typeComponentsIndices.push($p);else if($p=this._typeComponentsIndices[$F],this._components[$p[0]].isSingleton)throw new Error("无法单实例创建"+$i+"组件，"+$i+"组件已存在！");var $J=$A.getInstance($i);return $p.push(this._components.length),this._components.push($J),$J instanceof laya.d3.component.Script&&this._scripts.push($J),$J._initialize(this),$J},$F._removeComponent=function($i,$p){var $F,$J=0,$A=this._typeComponentsIndices[$i],$t=$A[$p],$q=this._components[$t];for($q instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf($q),1),$A.splice($p,1),0===$A.length&&(this._typeComponentsIndices.splice($i,1),this._componentsMap.splice($i,1)),$J=0,$F=this._componentsMap.length;$J<$F;$J++)for(var $B=($A=this._typeComponentsIndices[$J]).length-1;0<=$B;$B--){var $O=$A[$B];if(!($t<$O))break;$A[$B]=--$O}$q._destroy()},$F._clearSelfRenderObjects=function(){},$F._addSelfRenderObjects=function(){},$F._parseCustomProps=function($i,$p,$F,$J){},$F._updateChilds=function($i){var $p=this._childs.length;if(0!==$p)for(var $F=0;$F<$p;++$F)this._childs[$F]._update($i)},$F._getSortID=function($i,$p){return 1e3*$p.id+$i._getVertexBuffer().vertexDeclaration.id},$F._update=function($i){($i.owner=this)._activeInHierarchy&&(this._updateComponents($i),this._lateUpdateComponents($i),$R.spriteCount++,this._childs.length&&this._updateChilds($i))},$F.getProjectionViewWorldMatrix=function($i){return $ip.multiply($i,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},$F.loadHierarchy=function($i){this.addChild(laya.d3.core.Sprite3D.load($i))},$F.addChildAt=function($i,$p){if(!($i instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),0<=$p&&$p<=this._childs.length){if($i._parent===this){var $F=this.getChildIndex($i);this._childs.splice($F,1),this._childs.splice($p,0,$i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,$p)),this._childChanged()}else $i.parent&&$i.parent.removeChild($i),this._childs===$U.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice($p,0,$i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,$p),($i.parent=this)._addChild3D($i);return $i}throw new Error("appendChildAt:The index is out of bounds")},$F.addChild=function($i){if(!($i instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!$i||this.destroyed||$i===this)return $i;if($i.zOrder&&this._set$P("hasZorder",!0),$i._parent===this){var $p=this.getChildIndex($i);$p!==this._childs.length-1&&(this._childs.splice($p,1),this._childs.push($i),this.conchModel&&(this.conchModel.removeChild($i.conchModel),this.conchModel.addChildAt($i.conchModel,this._childs.length-1)),this._childChanged())}else $i.parent&&$i.parent.removeChild($i),this._childs===$U.ARRAY_EMPTY&&(this._childs=[]),this._childs.push($i),this.conchModel&&this.conchModel.addChildAt($i.conchModel,this._childs.length-1),($i.parent=this)._childChanged(),this._addChild3D($i);return $i},$F.removeChildAt=function($i){var $p=this.getChildAt($i);return $p&&(this._removeChild3D($p),this._childs.splice($i,1),this.conchModel&&this.conchModel.removeChild($p.conchModel),$p.parent=null),$p},$F.removeChildren=function($i,$p){if(void 0===$i&&($i=0),void 0===$p&&($p=2147483647),this._childs&&0<this._childs.length){var $F=this._childs;if(0===$i&&$t<=$p){var $J=$F;this._childs=$U.ARRAY_EMPTY}else $J=$F.splice($i,$p-$i);for(var $A=0,$t=$J.length;$A<$t;$A++)this._removeChild3D($J[$A]),$J[$A].parent=null,this.conchModel&&this.conchModel.removeChild($J[$A].conchModel)}return this},$F.onAsynLoaded=function($i,$p,$F){var $J=$p[0];if("Sprite3D"!==$J.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var $A=$p[1];$jp._createNodeByJson(this,$J,this,$A),this.event("hierarchyloaded",[this]),this.__loaded=!0},$F.cloneTo=function($i){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var $p=$i;$p.name=this.name,$p._destroyed=this._destroyed,$p.timer=this.timer,$p._$P=this._$P,$p.active=this._active;var $F=$p.transform.localPosition;this.transform.localPosition.cloneTo($F),$p.transform.localPosition=$F;var $J=$p.transform.localRotation;this.transform.localRotation.cloneTo($J),$p.transform.localRotation=$J;var $A=$p.transform.localScale;this.transform.localScale.cloneTo($A),$p.transform.localScale=$A,$p.isStatic=this.isStatic;var $t=0,$q=0;for($t=0,$q=this._componentsMap.length;$t<$q;$t++){var $B=$p.addComponent(this._componentsMap[$t]);this._components[$t]._cloneTo($B)}for($t=0,$q=this._childs.length;$t<$q;$t++)$p.addChild(this._childs[$t].clone());var $O=$p.getComponentByType(Animator);if($O){var $U=$O._linkSpritesData;if($U)for(var $d in $U){for(var $u=$U[$d],$S=$p,$Z=0,$s=$u.length;$Z<$s&&($S=$S.getChildByName($u[$Z]));$Z++);if($S){var $x=$O._avatarNodeMap[$d];$S._isLinkSpriteToAnimationNode($O,$x,!0)}}}},$F.clone=function(){var $i=new this.constructor;return this.cloneTo($i),$i},$F.destroy=function($i){if(void 0===$i&&($i=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,$i);var $p,$F=0;for($F=0,$p=this._components.length;$F<$p;$F++)this._components[$F]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,$r.clearRes(this.url),this.loaded||$rp._cancelLoadByUrl(this.url)}},$F._handleSpriteToAvatar=function($i,$p){$i._avatarNodes;var $F=$i._avatarNodeMap[this.name];$F&&$F.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode($i,$F,$p)},$F._setAnimatorToLinkAvatar=function($i,$p){this._handleSpriteToAvatar($i,$p);for(var $F=0,$J=this._childs.length;$F<$J;$F++){this._childs[$F]._setAnimatorToLinkAvatar($i,$p)}},$s(0,$F,"activeInHierarchy",function(){return this._activeInHierarchy}),$s(0,$F,"_loaded",null,function($i){this.__loaded=$i}),$s(0,$F,"active",function(){return this._active},function($i){this._active!==$i&&(this._active=$i,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&($i?this._activeHierarchy():this._inActiveHierarchy()))}),$s(0,$F,"componentsCount",function(){return this._components.length}),$s(0,$F,"loaded",function(){return this.__loaded}),$s(0,$F,"id",function(){return this._id}),$s(0,$F,"url",function(){return this._url}),$s(0,$F,"layer",function(){return this._layer},function($i){if(this._layer!==$i){if(!$i)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var $p=0,$F=this._colliders.length;if(this._layer)for($p=0;$p<$F;$p++)this._layer._removeCollider(this._colliders[$p]);for($p=0;$p<$F;$p++)$i._addCollider(this._colliders[$p])}this._layer=$i,this.event("layerchanged",$i)}}),$s(0,$F,"scene",function(){return this._scene}),$s(0,$F,"transform",function(){return this._transform}),$p.instantiate=function($i,$p,$F,$J,$A){void 0===$F&&($F=!0);var $t=$i.clone();$p&&$p.addChild($t);var $q=$t.transform;if($F){var $B=$q.worldMatrix;$i.transform.worldMatrix.cloneTo($B),$q.worldMatrix=$B}else $J&&($q.position=$J),$A&&($q.rotation=$A);return $t},$p.load=function($i){return $v.loader.create($i,null,null,$p)},$p.WORLDMATRIX=0,$p.MVPMATRIX=1,$p._uniqueIDCounter=0,$p._nameNumberCounter=0,$p}(),$yp=function($i){function $d($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],$d.__super.call(this),!$i||!$p)throw"Shader Error";this._id=++$d._count,this._vs=$i,this._ps=$p,this._attributeMap=$F,this._sceneUniformMap=$J,this._cameraUniformMap=$A,this._spriteUniformMap=$t,this._materialUniformMap=$q,this._renderElementUniformMap=$B,this._precompile=$O,this._define=$U,this._precompile&&$d.extCompileObj&&$d.extCompileFunc?$d.extCompileFunc.call($d.extCompileObj,$i,$p,$U):this.recreateResource()}$Z($d,"laya.d3.shader.Shader3D",$F);var $p=$d.prototype;return $p.recreateResource=function(){$n.now();this._compile(),this.completeCreate(),this.memorySize=0},$p.disposeResource=function(){$h.mainContext.deleteShader(this._vshader),$h.mainContext.deleteShader(this._pshader),$h.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},$p._compile=function(){if(!$h.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var $i=[this._vs,this._ps],$p=$h.mainContext;if(this._program=$p.createProgram(),this._vshader=$d._createShader($p,$i[0],35633),this._pshader=$d._createShader($p,$i[1],35632),$p.attachShader(this._program,this._vshader),$p.attachShader(this._program,this._pshader),$p.linkProgram(this._program),!$x.isConchApp&&$Rp.debugMode&&!$p.getProgramParameter(this._program,35714))throw $p.getProgramInfoLog(this._program);var $F,$J=0,$A=0,$t=0;for($t=$x.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35721):$p.getProgramParameter(this._program,35721),$J=0;$J<$t;$J++){var $q=null;$F={vartype:"attribute",ivartype:0,attrib:$q=$x.isConchApp?$p.getActiveAttribEx(this._vs,this._ps,"",$J):$p.getActiveAttrib(this._program,$J),location:$p.getAttribLocation(this._program,$q.name),name:$q.name,type:$q.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push($F)}var $B=0;for($B=$x.isConchApp?$p.getProgramParameterEx(this._vs,this._ps,"",35718):$p.getProgramParameter(this._program,35718),$J=0;$J<$B;$J++){var $O=null;$O=$x.isConchApp?$p.getActiveUniformEx(this._vs,this._ps,"",$J):$p.getActiveUniform(this._program,$J),0<($F={vartype:"uniform",ivartype:1,attrib:$q,location:$p.getUniformLocation(this._program,$O.name),name:$O.name,type:$O.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&($F.name=$F.name.substr(0,$F.name.length-3),$F.isArray=!0,$F.location=$p.getUniformLocation(this._program,$F.name)),this._uniformParams.push($F)}for($J=0,$A=this._attributeParams.length;$J<$A;$J++)($F=this._attributeParams[$J]).indexOfParams=$J,$F.index=1,$F.value=[$F.location,null],$F.codename=$F.name,$F.name=null!=this._attributeMap[$F.codename]?this._attributeMap[$F.codename]:$F.codename,this._attributeParamsMap.push($F.name),this._attributeParamsMap.push($F),$F._this=this,$F.uploadedValue=[],$F.fun=this._attribute;for($J=0,$A=this._uniformParams.length;$J<$A;$J++)switch(($F=this._uniformParams[$J]).indexOfParams=$J,$F.index=1,$F.value=[$F.location,null],$F.codename=$F.name,null!=this._sceneUniformMap[$F.codename]?($F.name=this._sceneUniformMap[$F.codename],this._sceneUniformParamsMap.push($F.name),this._sceneUniformParamsMap.push($F)):null!=this._cameraUniformMap[$F.codename]?($F.name=this._cameraUniformMap[$F.codename],this._cameraUniformParamsMap.push($F.name),this._cameraUniformParamsMap.push($F)):null!=this._spriteUniformMap[$F.codename]?($F.name=this._spriteUniformMap[$F.codename],this._spriteUniformParamsMap.push($F.name),this._spriteUniformParamsMap.push($F)):null!=this._materialUniformMap[$F.codename]?($F.name=this._materialUniformMap[$F.codename],this._materialUniformParamsMap.push($F.name),this._materialUniformParamsMap.push($F)):null!=this._renderElementUniformMap[$F.codename]?($F.name=this._renderElementUniformMap[$F.codename],this._renderElementUniformParamsMap.push($F.name),this._renderElementUniformParamsMap.push($F)):console.log("Shader:can't find uinform name:"+$F.codename+" in shader file."),$F._this=this,$F.uploadedValue=[],$F.type){case 5124:$F.fun=$F.isArray?this._uniform1iv:this._uniform1i;break;case 5126:$F.fun=$F.isArray?this._uniform1fv:this._uniform1f;break;case 35664:$F.fun=$F.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:$F.fun=$F.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:$F.fun=$F.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:$F.fun=this._uniform_sampler2D;break;case 35680:$F.fun=this._uniform_samplerCube;break;case 35676:$F.fun=this._uniformMatrix4fv;break;case 35670:$F.fun=this._uniform1i;break;case 35674:$F.fun=this._uinformMatrix2fv;break;case 35675:$F.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},$p._attribute=function($i,$p){var $F=$h.mainContext,$J=$B._enableAtributes,$A=$i.location;return $J[$A]||$F.enableVertexAttribArray($A),$F.vertexAttribPointer($A,$p[0],$p[1],$p[2],$p[3],$p[4]),$J[$A]=$B._bindVertexBuffer,1},$p._uniform1f=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p?($h.mainContext.uniform1f($i.location,$F[0]=$p),1):0},$p._uniform1fv=function($i,$p){if($p.length<4){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($h.mainContext.uniform1fv($i.location,$p),$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3],1):0}return $h.mainContext.uniform1fv($i.location,$p),1},$p._uniform_vec2=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]?($h.mainContext.uniform2f($i.location,$F[0]=$p[0],$F[1]=$p[1]),1):0},$p._uniform_vec2v=function($i,$p){if($p.length<2){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($h.mainContext.uniform2fv($i.location,$p),$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3],1):0}return $h.mainContext.uniform2fv($i.location,$p),1},$p._uniform_vec3=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]?($h.mainContext.uniform3f($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2]),1):0},$p._uniform_vec3v=function($i,$p){return $h.mainContext.uniform3fv($i.location,$p),1},$p._uniform_vec4=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($h.mainContext.uniform4f($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3]),1):0},$p._uniform_vec4v=function($i,$p){return $h.mainContext.uniform4fv($i.location,$p),1},$p._uniformMatrix2fv=function($i,$p){return $h.mainContext.uniformMatrix2fv($i.location,!1,$p),1},$p._uniformMatrix3fv=function($i,$p){return $h.mainContext.uniformMatrix3fv($i.location,!1,$p),1},$p._uniformMatrix4fv=function($i,$p){return $h.mainContext.uniformMatrix4fv($i.location,!1,$p),1},$p._uinformMatrix2fv=function($i,$p){return $h.mainContext.uniformMatrix2fv($i.location,!1,$p),1},$p._uinformMatrix3fv=function($i,$p){return $h.mainContext.uniformMatrix3fv($i.location,!1,$p),1},$p._uniform1i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p?($h.mainContext.uniform1i($i.location,$F[0]=$p),1):0},$p._uniform1iv=function($i,$p){return $h.mainContext.uniform1iv($i.location,$p),1},$p._uniform_ivec2=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]?($h.mainContext.uniform2i($i.location,$F[0]=$p[0],$F[1]=$p[1]),1):0},$p._uniform_ivec2v=function($i,$p){return $h.mainContext.uniform2iv($i.location,$p),1},$p._uniform_vec3i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]?($h.mainContext.uniform3i($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2]),1):0},$p._uniform_vec3vi=function($i,$p){return $h.mainContext.uniform3iv($i.location,$p),1},$p._uniform_vec4i=function($i,$p){var $F=$i.uploadedValue;return $F[0]!==$p[0]||$F[1]!==$p[1]||$F[2]!==$p[2]||$F[3]!==$p[3]?($h.mainContext.uniform4i($i.location,$F[0]=$p[0],$F[1]=$p[1],$F[2]=$p[2],$F[3]=$p[3]),1):0},$p._uniform_vec4vi=function($i,$p){return $h.mainContext.uniform4iv($i.location,$p),1},$p._uniform_sampler2D=function($i,$p){var $F=$p.source||$p.defaulteTexture.source,$J=$h.mainContext,$A=$i.uploadedValue;if(null!=$A[0])return $J.activeTexture($d._TEXTURES[$A[0]]),$F&&$m.bindTexture($J,3553,$F),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $A[0]=this._curActTexIndex,$J.uniform1i($i.location,this._curActTexIndex),$J.activeTexture($d._TEXTURES[this._curActTexIndex]),$F&&$m.bindTexture($J,3553,$F),this._curActTexIndex++,1},$p._uniform_samplerCube=function($i,$p){var $F=$p.source||$p.defaulteTexture.source,$J=$h.mainContext,$A=$i.uploadedValue;if(null!=$A[0])return $J.activeTexture($d._TEXTURES[$A[0]]),$F?$m.bindTexture($J,34067,$F):$m.bindTexture($J,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return $A[0]=this._curActTexIndex,$J.uniform1i($i.location,this._curActTexIndex),$J.activeTexture($d._TEXTURES[this._curActTexIndex]),$F?$m.bindTexture($J,34067,$F):$m.bindTexture($J,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},$p._noSetValue=function($i){console.log("no....:"+$i.name)},$p.bind=function(){return $F.activeShader=this,($F.bindShader=this).activeResource(),$m.UseProgram(this._program)},$p.uploadAttributes=function($i,$p){for(var $F,$J,$A=0,$t=0,$q=this._attributeParamsMap.length;$t<$q;$t+=2)$J=this._attributeParamsMap[$t+1],null!=($F=$i[this._attributeParamsMap[$t]])&&($p&&$p[$J.name]&&$p[$J.name].bind(),$A+=$J.fun.call(this,$J,$F));$R.shaderCall+=$A},$p.uploadAttributesX=function($i,$p){for(var $F,$J,$A=0,$t=0,$q=this._attributeParamsMap.length;$t<$q;$t+=2)$J=this._attributeParamsMap[$t+1],null!=($F=$i[this._attributeParamsMap[$t]])&&($p._bind(),$A+=$J.fun.call(this,$J,$F));$R.shaderCall+=$A},$p.uploadSceneUniforms=function($i){for(var $p,$F,$J=0,$A=0,$t=this._sceneUniformParamsMap.length;$A<$t;$A+=2)$F=this._sceneUniformParamsMap[$A+1],null!=($p=$i[this._sceneUniformParamsMap[$A]])&&($J+=$F.fun.call(this,$F,$p));$R.shaderCall+=$J},$p.uploadCameraUniforms=function($i){for(var $p,$F,$J=0,$A=0,$t=this._cameraUniformParamsMap.length;$A<$t;$A+=2)$F=this._cameraUniformParamsMap[$A+1],null!=($p=$i[this._cameraUniformParamsMap[$A]])&&($J+=$F.fun.call(this,$F,$p));$R.shaderCall+=$J},$p.uploadSpriteUniforms=function($i){for(var $p,$F,$J=0,$A=0,$t=this._spriteUniformParamsMap.length;$A<$t;$A+=2)$F=this._spriteUniformParamsMap[$A+1],null!=($p=$i[this._spriteUniformParamsMap[$A]])&&($J+=$F.fun.call(this,$F,$p));$R.shaderCall+=$J},$p.uploadMaterialUniforms=function($i){for(var $p,$F,$J=0,$A=0,$t=this._materialUniformParamsMap.length;$A<$t;$A+=2)$F=this._materialUniformParamsMap[$A+1],null!=($p=$i[this._materialUniformParamsMap[$A]])&&($J+=$F.fun.call(this,$F,$p));$R.shaderCall+=$J},$p.uploadRenderElementUniforms=function($i){for(var $p,$F,$J=0,$A=0,$t=this._renderElementUniformParamsMap.length;$A<$t;$A+=2)$F=this._renderElementUniformParamsMap[$A+1],null!=($p=$i[this._renderElementUniformParamsMap[$A]])&&($J+=$F.fun.call(this,$F,$p));$R.shaderCall+=$J},$d.create=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return new $d($i,$p,$F,$J,$A,$t,$q,$B,$O,$U)},$d.addInclude=function($i,$p){$D.addInclude($i,$p)},$d._createShader=function($i,$p,$F){var $J=$i.createShader($F);if($i.shaderSource($J,$p),$i.compileShader($J),$Rp.debugMode&&!$i.getShaderParameter($J,35713))throw $i.getShaderInfoLog($J);return $J},$d.PERIOD_RENDERELEMENT=0,$d.PERIOD_MATERIAL=1,$d.PERIOD_SPRITE=2,$d.PERIOD_CAMERA=3,$d.PERIOD_SCENE=4,$d._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],$d._count=0,$d._preCompile=!1,$d.extCompileFunc=null,$d.extCompileObj=null,$u($d,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new $Q}]),$d}(),$Np=function($B){function $O(){this._transformUV=null,$O.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new $qp(.6,.6,.6)),this._setColor(10,new $qp(1,1,1)),this._setColor(11,new $Bp(1,1,1,8)),this._setColor(12,new $qp(1,1,1)),this._setColor(7,new $Bp(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new $Bp(1,1,0,0)),this.renderMode=1}$Z($O,"laya.d3.core.material.StandardMaterial",$B);var $i=$O.prototype;return $i.disableLight=function(){this._addDisablePublicShaderDefine($Rp.SHADERDEFINE_POINTLIGHT|$Rp.SHADERDEFINE_SPOTLIGHT|$Rp.SHADERDEFINE_DIRECTIONLIGHT)},$i.disableFog=function(){this._addDisablePublicShaderDefine($Rp.SHADERDEFINE_FOG)},$i.onAsynLoaded=function($i,$p,$F){var $J=$p[0];if($J.version)$B.prototype.onAsynLoaded.call(this,$i,$p,$F);else{var $A=$p[1],$t=$J.props;for(var $q in $t)this[$q]=$t[$q];$O._parseStandardMaterial($A,this,$J),this._endLoaded()}},$i.cloneTo=function($i){$B.prototype.cloneTo.call(this,$i);var $p=$i;this._transformUV&&($p._transformUV=this._transformUV.clone())},$s(0,$i,"ambientColor",function(){return this._getColor(9)},function($i){this._setColor(9,$i)}),$s(0,$i,"ambientTexture",function(){return this._getTexture(5)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,$i)}),$s(0,$i,"renderMode",null,function($i){switch($i){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine($O.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode($i)}),$s(0,$i,"reflectColor",function(){return this._getColor(12)},function($i){this._setColor(12,$i)}),$s(0,$i,"tilingOffset",function(){return this._getColor(15)},function($i){if($i){var $p=$i.elements;1!=$p[0]||1!=$p[1]||0!=$p[2]||0!=$p[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,$i)}),$s(0,$i,"albedo",function(){return this._getColor(7)},function($i){this._setColor(7,$i)}),$s(0,$i,"diffuseColor",function(){return this._getColor(10)},function($i){this._setColor(10,$i)}),$s(0,$i,"albedoColor",function(){return this._getColor(7)},function($i){this._setColor(7,$i)}),$s(0,$i,"specularColor",function(){return this._getColor(11)},function($i){this._setColor(11,$i)}),$s(0,$i,"diffuseTexture",function(){return this._getTexture(1)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,$i)}),$s(0,$i,"normalTexture",function(){return this._getTexture(2)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,$i)}),$s(0,$i,"specularTexture",function(){return this._getTexture(3)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,$i)}),$s(0,$i,"emissiveTexture",function(){return this._getTexture(4)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,$i)}),$s(0,$i,"reflectTexture",function(){return this._getTexture(6)},function($i){$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,$i)}),$s(0,$i,"transformUV",function(){return this._transformUV},function($i){this._transformUV=$i,this._setMatrix4x4(13,$i.matrix),$i?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,$i.matrix.elements,0)}),$O.__init__=function(){$O.SHADERDEFINE_DIFFUSEMAP=$O.shaderDefines.registerDefine("DIFFUSEMAP"),$O.SHADERDEFINE_NORMALMAP=$O.shaderDefines.registerDefine("NORMALMAP"),$O.SHADERDEFINE_SPECULARMAP=$O.shaderDefines.registerDefine("SPECULARMAP"),$O.SHADERDEFINE_EMISSIVEMAP=$O.shaderDefines.registerDefine("EMISSIVEMAP"),$O.SHADERDEFINE_AMBIENTMAP=$O.shaderDefines.registerDefine("AMBIENTMAP"),$O.SHADERDEFINE_REFLECTMAP=$O.shaderDefines.registerDefine("REFLECTMAP"),$O.SHADERDEFINE_UVTRANSFORM=$O.shaderDefines.registerDefine("UVTRANSFORM"),$O.SHADERDEFINE_TILINGOFFSET=$O.shaderDefines.registerDefine("TILINGOFFSET"),$O.SHADERDEFINE_ADDTIVEFOG=$O.shaderDefines.registerDefine("ADDTIVEFOG")},$O.load=function($i){return $v.loader.create($i,null,null,$O)},$O._parseStandardMaterial=function($i,$p,$F){var $J=$F.customProps,$A=$J.ambientColor;$p.ambientColor=new $qp($A[0],$A[1],$A[2]);var $t=$J.diffuseColor;$p.diffuseColor=new $qp($t[0],$t[1],$t[2]);var $q=$J.specularColor;$p.specularColor=new $Bp($q[0],$q[1],$q[2],$q[3]);var $B=$J.reflectColor;$p.reflectColor=new $qp($B[0],$B[1],$B[2]);var $O=$J.albedoColor;$O&&($p.albedo=new $Bp($O[0],$O[1],$O[2],$O[3]));var $U=$J.diffuseTexture.texture2D;$U&&($p.diffuseTexture=$r.getRes($i[$U]));var $d=$J.normalTexture.texture2D;$d&&($p.normalTexture=$r.getRes($i[$d]));var $u=$J.specularTexture.texture2D;$u&&($p.specularTexture=$r.getRes($i[$u]));var $S=$J.emissiveTexture.texture2D;$S&&($p.emissiveTexture=$r.getRes($i[$S]));var $Z=$J.ambientTexture.texture2D;$Z&&($p.ambientTexture=$r.getRes($i[$Z]));var $s=$J.reflectTexture.texture2D;$s&&($p.reflectTexture=$r.getRes($i[$s]))},$O.RENDERMODE_OPAQUE=1,$O.RENDERMODE_OPAQUEDOUBLEFACE=2,$O.RENDERMODE_CUTOUT=3,$O.RENDERMODE_CUTOUTDOUBLEFACE=4,$O.RENDERMODE_TRANSPARENT=13,$O.RENDERMODE_TRANSPARENTDOUBLEFACE=14,$O.RENDERMODE_ADDTIVE=15,$O.RENDERMODE_ADDTIVEDOUBLEFACE=16,$O.RENDERMODE_DEPTHREAD_TRANSPARENT=5,$O.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,$O.RENDERMODE_DEPTHREAD_ADDTIVE=7,$O.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,$O.RENDERMODE_NONDEPTH_TRANSPARENT=9,$O.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,$O.RENDERMODE_NONDEPTH_ADDTIVE=11,$O.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,$O.SHADERDEFINE_DIFFUSEMAP=0,$O.SHADERDEFINE_NORMALMAP=0,$O.SHADERDEFINE_SPECULARMAP=0,$O.SHADERDEFINE_EMISSIVEMAP=0,$O.SHADERDEFINE_AMBIENTMAP=0,$O.SHADERDEFINE_REFLECTMAP=0,$O.SHADERDEFINE_UVTRANSFORM=0,$O.SHADERDEFINE_TILINGOFFSET=0,$O.SHADERDEFINE_ADDTIVEFOG=0,$O.DIFFUSETEXTURE=1,$O.NORMALTEXTURE=2,$O.SPECULARTEXTURE=3,$O.EMISSIVETEXTURE=4,$O.AMBIENTTEXTURE=5,$O.REFLECTTEXTURE=6,$O.ALBEDO=7,$O.UVANIAGE=8,$O.MATERIALAMBIENT=9,$O.MATERIALDIFFUSE=10,$O.MATERIALSPECULAR=11,$O.MATERIALREFLECT=12,$O.UVMATRIX=13,$O.UVAGE=14,$O.TILINGOFFSET=15,$u($O,["defaultMaterial",function(){var $i=new $O;return $i.lock=!0,this.defaultMaterial=$i},"shaderDefines",function(){return this.shaderDefines=new $dp($cp.shaderDefines)}]),$O}($cp),$fp=function($i){function $q($i,$p,$F,$J,$A){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===$F&&($F=35044),void 0===$J&&($J=!1),$q.__super.call(this),this._indexType=$i,this._indexCount=$p,this._bufferUsage=$F,this._bufferType=34963,this._canRead=$J;var $t;if("ushort"==$i)this._indexTypeByteCount=2;else{if("ubyte"!=$i)throw new Error("unidentification index type.");this._indexTypeByteCount=1}$t=this._indexTypeByteCount*$p,this._byteLength=$t,this._bind(),$B._gl.bufferData(this._bufferType,$t,this._bufferUsage),this.uri=$A,$J?("ushort"==$i?this._buffer=new Uint16Array($p):"ubyte"==$i&&(this._buffer=new Uint8Array($p)),this.memorySize=2*$t):this.memorySize=$t}$Z($q,"laya.d3.graphics.IndexBuffer3D",$i);var $p=$q.prototype;return $p.setData=function($i,$p,$F,$J){void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=4294967295);var $A=0;if("ushort"==this._indexType?($A=2,0===$F&&4294967295===$J||($i=new Uint16Array($i.buffer,$F*$A,$J))):"ubyte"==this._indexType&&($A=1,0===$F&&4294967295===$J||($i=new Uint8Array($i.buffer,$F*$A,$J))),this._bind(),$B._gl.bufferSubData(this._bufferType,$p*$A,$i),this._canRead)if(0!==$p||0!==$F||4294967295!==$J){var $t=this._buffer.length-$p;$t<$J&&($J=$t);for(var $q=0;$q<$J;$q++)this._buffer[$p+$q]=$i[$q]}else this._buffer=$i},$p.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$p.disposeResource=function(){$i.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},$s(0,$p,"indexType",function(){return this._indexType}),$s(0,$p,"indexTypeByteCount",function(){return this._indexTypeByteCount}),$s(0,$p,"indexCount",function(){return this._indexCount}),$s(0,$p,"canRead",function(){return this._canRead}),$q.INDEXTYPE_UBYTE="ubyte",$q.INDEXTYPE_USHORT="ushort",$q.create=function($i,$p,$F,$J,$A){return void 0===$F&&($F=35044),void 0===$J&&($J=!1),new $q($i,$p,$F,$J,$A)},$q}($B),$op=function($t){function $q($i,$p,$F,$J,$A){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===$J&&($J=!1),$q.__super.call(this),this._vertexDeclaration=$i,this._vertexCount=$p,this._bufferUsage=$F,this._bufferType=34962,this._canRead=$J,this.uri=$A,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*$p,this._bind(),$B._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),$J&&(this._buffer=new Float32Array(this._byteLength/4))}$Z($q,"laya.d3.graphics.VertexBuffer3D",$t);var $i=$q.prototype;return $i.bindWithIndexBuffer=function($i){$i&&$i._bind(),this._bind()},$i.setData=function($i,$p,$F,$J){if(void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=4294967295),0===$F&&4294967295===$J||($i=new Float32Array($i.buffer,4*$F,$J)),this._bind(),$B._gl.bufferSubData(this._bufferType,4*$p,$i),this._canRead)if(0!==$p||0!==$F||4294967295!==$J){var $A=this._buffer.length-$p;$A<$J&&($J=$A);for(var $t=0;$t<$J;$t++)this._buffer[$p+$t]=$i[$t]}else this._buffer=$i},$i.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},$i.disposeResource=function(){for(var $i=$h.mainContext,$p=this._vertexDeclaration.getVertexElements(),$F=$B._enableAtributes,$J=0,$A=$p.length;$J<$A;$J++)$F[$J]===this._glBuffer&&($i.disableVertexAttribArray($J),$F[$J]=null);$t.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},$s(0,$i,"vertexDeclaration",function(){return this._vertexDeclaration}),$s(0,$i,"vertexCount",function(){return this._vertexCount}),$s(0,$i,"canRead",function(){return this._canRead}),$q.create=function($i,$p,$F,$J,$A){return void 0===$F&&($F=35044),void 0===$J&&($J=!1),new $q($i,$p,$F,$J,$A)},$q}($B),$Wp=function($i){function $D(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,$D.__super.call(this),this._type=3553}$Z($D,"laya.d3.resource.DataTexture2D",$hp);var $p=$D.prototype;return $p.genDebugMipmaps=function(){var $i=[];return $i.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),$i.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),$i.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),$i.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),$i.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),$i.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),$i.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),$i.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),$i.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),$i.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),$i},$p._onTextureLoaded=function($i){},$p._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var $i=$h.mainContext,$p=this._source=$i.createTexture(),$F=this._width,$J=this._height,$A=$m.curBindTexTarget,$t=$m.curBindTexValue,$q=!1;if($m.bindTexture($i,this._type,$p),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var $B=0;$i.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var $O=0;$O<this._mipmaps.length;$O++){if(this._mipmaps[$O].byteLength!=$U*$d*4)throw"mipmap size error  level:"+$O;$i.texSubImage2D(this._type,0,$D.simLodRect[$B++],$D.simLodRect[$B++],$D.simLodRect[$B++],$D.simLodRect[$B++],6408,5121,new Uint8Array(this._mipmaps[$O]))}this.minFifter=9729,this.magFifter=9729}else{var $U=this._width,$d=this._height;for($B=0,$i.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),$O=0;$O<this._mipmaps.length;$O++){if(this._mipmaps[$O].byteLength!=$U*$d*4)throw"mipmap size error  level:"+$O;$i.texImage2D(this._type,$O,6408,$U,$d,0,6408,5121,new Uint8Array(this._mipmaps[$O])),($U/=2)<1&&($U=1),($d/=2)<1&&($d=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&$i.pixelStorei($i.UNPACK_ALIGNMENT,1),$i.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var $u=0,$S=!1,$Z=!1;this._buffer.byteLength==4*$F*$J?($u=6408,$S=!0):this._buffer.byteLength==3*$F*$J?($u=6407,$Z=!0):$u=this._format,$S||$Z?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),$Z&&$i.pixelStorei($i.UNPACK_ALIGNMENT,1),$i.texImage2D(this._type,0,$u,$F,$J,0,$u,5121,this._buffer)):$i&&$u==$i.ALPHA?($i.texImage2D(3553,0,$u,$F,$J,0,$u,$i.UNSIGNED_BYTE,this._buffer),$q=!0):0!=$u&&($i.compressedTexImage2D(3553,0,$u,$F,$J,0,this._buffer),$q=!0)}var $s=this._minFifter,$x=this._magFifter,$j=0==this._wrapModeU?10497:33071,$r=0==this._wrapModeV?10497:33071,$M=$E.isPOT($F,$J);$M?(this._mipmap||this._mipmaps?-1!==$s||($s=9987):-1!==$s||($s=9729),-1!==$x||($x=9729),$i.texParameteri(this._type,10241,$s),$i.texParameteri(this._type,10240,$x),$i.texParameteri(this._type,10242,$j),$i.texParameteri(this._type,10243,$r),this._mipmap&&$i.generateMipmap(this._type)):(-1!==$s||($s=9729),-1!==$x||($x=9729),$i.texParameteri(this._type,10241,$s),$i.texParameteri(this._type,10240,$x),$i.texParameteri(this._type,10242,33071),$i.texParameteri(this._type,10243,33071)),$A&&$t&&$m.bindTexture($i,$A,$t),this.memorySize=$q?this._buffer.length:$M?$F*$J*4*(1+1/3):$F*$J*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},$p.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},$p.onAsynLoaded=function($i,$p,$F){var $J;$F&&($J=$F[0].call(this,$p)),$J&&(this._width=$J.width,this._height=$J.height,this._buffer=$J.data),this._src=$i,this._size=new $xp(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},$p.getPixels=function(){return new Uint8Array(this._buffer)},$p.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&($h.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},$s(0,$p,"src",function(){return this._src}),$D.create=function($i,$p,$F,$J,$A,$t,$q){if(void 0===$J&&($J=9729),void 0===$A&&($A=9729),void 0===$t&&($t=!0),!$i||$i.byteLength<$p*$F*4)throw"DataTexture2D create error";var $B=new $D;return $B.uri=$q,$B._buffer=$i,$B._width=$p,$B._height=$F,$B._mipmap=$t,$B._magFifter=$J,$B._minFifter=$A,$B._size=new $xp($B._width,$B._height),$B._conchTexture?alert("怎么给runtime传递datatexture数据"):$B.activeResource(),$B},$D.load=function($i,$p,$F,$J,$A){if(void 0===$p&&($p=0),void 0===$F&&($F=0),void 0===$J&&($J=9729),void 0===$A&&($A=9729),"mipmaps"===$P.getFileExtension($i)){var $t=$v.loader.create($i,null,null,$D,[function($i){this._mipmaps=[];var $p=new Uint32Array($i);this._width=$p[0];var $F=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,$F=1024),this._width!=$F)throw"现在只支持512x256的环境贴图。当前的是"+$p[0];this._height=$p[1];for(var $J=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,$A=this._height,$t=8;;){var $q=$J*$A*4;if($t+$q>$i.byteLength)throw"load mipmaps data size error ";var $B=new Uint8Array($i,$t,$q);if(this._mipmaps.push($B),$t+=$q,1==$J&&1==$A)break;($J/=2)<1&&($J=1),($A/=2)<1&&($A=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){$t.simLodInfo=new Float32Array(40);for(var $q=0;$q<$t.simLodInfo.length;)$t.simLodInfo[$q]=($D.simLodRect[$q]+.5)/1024,$q++,$t.simLodInfo[$q]=($D.simLodRect[$q]+.5)/256,$q++,$t.simLodInfo[$q]=Math.max($D.simLodRect[$q]-1,.1)/1024,$q++,$t.simLodInfo[$q]=Math.max($D.simLodRect[$q]-1.5,.1)/256,$q++}return $t}if("number"==typeof $p)return $v.loader.create($i,null,null,$D,[function($i){return this._width=$p,this._height=$F,this._buffer=$i,null}]);if("function"==typeof $p)return $v.loader.create($i,null,null,$D,[$p]);throw new Error("unknown params.")},$D.lodasatlas=!1,$u($D,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),$D}(),$Lp=function($i){function $p(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,$p.__super.call(this)}$Z($p,"laya.d3.resource.models.PrimitiveMesh",$mp);var $F=$p.prototype;return $v.imps($F,{"laya.d3.core.render.IRenderable":!0}),$F._getVertexBuffer=function($i){return void 0===$i&&($i=0),0===$i?this._vertexBuffer:null},$F._getVertexBuffers=function(){return null},$F._getIndexBuffer=function(){return this._indexBuffer},$F._getPositions=function(){var $i,$p=[],$F=this._vertexBuffer.vertexDeclaration.getVertexElements(),$J=0;for($J=0;$J<$F.length;$J++){var $A=$F[$J];if("vector3"===$A.elementFormat&&0===$A.elementUsage){$i=$A;break}}var $t=this._vertexBuffer.getData();for($J=0;$J<$t.length;$J+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var $q=$J+$i.offset/4,$B=new $qp($t[$q+0],$t[$q+1],$t[$q+2]);$p.push($B)}return $p},$F.getRenderElement=function($i){return this},$F.getRenderElementsCount=function(){return 1},$F.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},$F._beforeRender=function($i){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},$F._render=function($i){$h.mainContext.drawElements(4,this._numberIndices,5123,0),$R.drawCall++,$R.trianglesFaces+=this._numberIndices/3},$s(0,$F,"_vertexBufferCount",function(){return 1}),$s(0,$F,"triangleCount",function(){return this._indexBuffer.indexCount/3}),$p}(),$Cp=function($i){function $p(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,$p.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}$Z($p,"laya.d3.resource.models.Mesh",$mp);var $F=$p.prototype;return $F._getPositions=function(){var $i,$p,$F,$J,$A,$t=[],$q=0,$B=0,$O=0;if(0!==this._vertexBuffers.length){var $U=this._vertexBuffers.length;for($q=0;$q<$U;$q++){for($F=($i=this._vertexBuffers[$q]).vertexDeclaration.getVertexElements(),$B=0;$B<$F.length;$B++)if("vector3"===($J=$F[$B]).elementFormat&&0===$J.elementUsage){$p=$J;break}for($A=$i.getData(),$B=0;$B<$A.length;$B+=$i.vertexDeclaration.vertexStride/4)$O=$B+$p.offset/4,$t.push(new $qp($A[$O+0],$A[$O+1],$A[$O+2]))}}else{var $d=this._subMeshes.length;for($q=0;$q<$d;$q++){for($F=($i=this._subMeshes[$q]._getVertexBuffer()).vertexDeclaration.getVertexElements(),$B=0;$B<$F.length;$B++)if("vector3"===($J=$F[$B]).elementFormat&&0===$J.elementUsage){$p=$J;break}for($A=$i.getData(),$B=0;$B<$A.length;$B+=$i.vertexDeclaration.vertexStride/4)$O=$B+$p.offset/4,$t.push(new $qp($A[$O+0],$A[$O+1],$A[$O+2]))}}return $t},$F._setSubMeshes=function($i){this._subMeshes=$i,this._subMeshCount=$i.length;for(var $p=0;$p<this._subMeshCount;$p++)$i[$p]._indexInMesh=$p;this._positions=this._getPositions(),this._generateBoundingObject()},$F.onAsynLoaded=function($i,$p,$F){var $J=$p[0],$A=$p[1];$Xi.read($J,this,this._materials,this._subMeshes,$A),this.completeCreate(),this._endLoaded()},$F.getSubMesh=function($i){return this._subMeshes[$i]},$F.getSubMeshCount=function(){return this._subMeshes.length},$F.getRenderElementsCount=function(){return this._subMeshes.length},$F.getRenderElement=function($i){return this._subMeshes[$i]},$F.disposeResource=function(){for(var $i=0;$i<this._subMeshes.length;$i++)this._subMeshes[$i].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},$s(0,$F,"materials",function(){return this._materials.slice()}),$s(0,$F,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),$p.load=function($i){return $v.loader.create($i,null,null,$p)},$p}(),$Kp=(function($i){function $U($i,$p,$F,$J,$A,$t,$q,$B,$O){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===$F&&($F=6408),void 0===$J&&($J=5121),void 0===$A&&($A=33189),void 0===$t&&($t=!1),void 0===$q&&($q=!1),void 0===$B&&($B=-1),void 0===$O&&($O=-1),$U.__super.call(this),this._type=3553,this._width=$i,this._height=$p,this._size=new $xp($i,$p),this._surfaceFormat=$F,this._surfaceType=$J,this._depthStencilFormat=$A,$x.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=$t,this._repeat=$q,this._minFifter=$B,this._magFifter=$O,this.activeResource(),this._alreadyResolved=!0}$Z($U,"laya.d3.resource.RenderTexture",$hp);var $p=$U.prototype;$p.recreateResource=function(){var $i=$h.mainContext;this._frameBuffer=$i.createFramebuffer(),this._source=$i.createTexture();var $p=$m.curBindTexTarget,$F=$m.curBindTexValue;$m.bindTexture($i,this._type,this._source),$i.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var $J=this._minFifter,$A=this._magFifter,$t=this._repeat?10497:33071;if($E.isPOT(this._width,this._height)?(this._mipmap?-1!==$J||($J=9987):-1!==$J||($J=9729),-1!==$A||($A=9729),$i.texParameteri(this._type,10241,$J),$i.texParameteri(this._type,10240,$A),$i.texParameteri(this._type,10242,$t),$i.texParameteri(this._type,10243,$t),this._mipmap&&$i.generateMipmap(this._type)):(-1!==$J||($J=9729),-1!==$A||($A=9729),$i.texParameteri(this._type,10241,$J),$i.texParameteri(this._type,10240,$A),$i.texParameteri(this._type,10242,33071),$i.texParameteri(this._type,10243,33071)),$p&&$F&&$m.bindTexture($i,$p,$F),$i.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=$i.createRenderbuffer(),$i.bindRenderbuffer(36161,this._depthStencilBuffer),$i.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),$i.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:$i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:$i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:$i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}$i.framebufferTexture2D(36160,36064,3553,this._source,0),$i.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},$p.start=function(){$h.mainContext.bindFramebuffer(36160,this.frameBuffer),($U._currentRenderTarget=this)._alreadyResolved=!1},$p.end=function(){$h.mainContext.bindFramebuffer(36160,null),$U._currentRenderTarget=null,this._alreadyResolved=!0},$p.getData=function($i,$p,$F,$J){var $A=$h.mainContext;if($A.bindFramebuffer(36160,this._frameBuffer),!(36053===$A.checkFramebufferStatus(36160)))return $A.bindFramebuffer(36160,null),null;var $t=new Uint8Array(this._width*this._height*4);return $A.readPixels($i,$p,$F,$J,this._surfaceFormat,this._surfaceType,$t),$A.bindFramebuffer(36160,null),$t},$p.disposeResource=function(){if(this._frameBuffer){var $i=$h.mainContext;$i.deleteTexture(this._source),$i.deleteFramebuffer(this._frameBuffer),$i.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},$s(0,$p,"surfaceFormat",function(){return this._surfaceFormat}),$s(0,$p,"surfaceType",function(){return this._surfaceType}),$s(0,$p,"depthStencilFormat",function(){return this._depthStencilFormat}),$s(0,$p,"source",function(){return this._alreadyResolved?$v.superGet($hp,this,"source"):null}),$s(0,$p,"depthStencilBuffer",function(){return this._depthStencilBuffer}),$s(0,$p,"frameBuffer",function(){return this._frameBuffer}),$U._currentRenderTarget=null}(),function($i){function $p($i){this._color=null,this._pixels=null,$p.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new $xp(this.width,this.height),this._color=$i,this._pixels=new Uint8Array([255*$i.x,255*$i.y,255*$i.z,255*$i.w]),this.uri="SolidColorTexture2D_"+this.id}$Z($p,"laya.d3.resource.SolidColorTexture2D",$hp);var $F=$p.prototype;return $F._createWebGlTexture=function(){var $i=$h.mainContext,$p=this._source=$i.createTexture(),$F=this._width,$J=this._height,$A=$m.curBindTexTarget,$t=$m.curBindTexValue;$m.bindTexture($i,this._type,$p),$i.texImage2D(this._type,0,6408,$F,$J,0,6408,5121,this._pixels);var $q=this._minFifter,$B=this._magFifter,$O=this._repeat?10497:33071,$U=$E.isPOT($F,$J);$U?(this._mipmap?-1!==$q||($q=9987):-1!==$q||($q=9729),-1!==$B||($B=9729),$i.texParameteri(this._type,10241,$q),$i.texParameteri(this._type,10240,$B),$i.texParameteri(this._type,10242,$O),$i.texParameteri(this._type,10243,$O),this._mipmap&&$i.generateMipmap(this._type)):(-1!==$q||($q=9729),-1!==$B||($B=9729),$i.texParameteri(this._type,10241,$q),$i.texParameteri(this._type,10240,$B),$i.texParameteri(this._type,10242,33071),$i.texParameteri(this._type,10243,33071)),$A&&$t&&$m.bindTexture($i,$A,$t),this.memorySize=$U?$F*$J*4*(1+1/3):$F*$J*4},$F.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$F.disposeResource=function(){this._source&&($h.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},$u($p,["magentaTexture",function(){var $i=new $p(new $Bp(1,0,1,1));return $i.lock=!0,this.magentaTexture=$i},"grayTexture",function(){var $i=new $p(new $Bp(.5,.5,.5,1));return $i.lock=!0,this.grayTexture=$i}]),$p}()),$Vp=function($i){function $A($i,$p,$F,$J){this._canRead=!1,this._image=null,this._pixels=null,void 0===$i&&($i=!1),void 0===$p&&($p=!0),void 0===$F&&($F=6408),void 0===$J&&($J=!0),$A.__super.call(this),this._type=3553,this._repeat=$p,this._canRead=$i,this._format=$F,this._mipmap=$J}$Z($A,"laya.d3.resource.Texture2D",$hp);var $p=$A.prototype;return $p._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var $i=$h.mainContext,$p=this._source=$i.createTexture(),$F=this._width,$J=this._height,$A=$m.curBindTexTarget,$t=$m.curBindTexValue;switch($m.bindTexture($i,this._type,$p),this._format){case 6407:case 6408:this._canRead?$i.texImage2D(this._type,0,this._format,$F,$J,0,this._format,5121,this._pixels):this._image&&this._image instanceof laya.webgl.resource.WebGLImage?$i.texImage2D(this._type,0,this._image._format,$F,$J,0,this._image._format,5121,this._image.atlasSource):$i.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case $h.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:$i.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var $q=this._minFifter,$B=this._magFifter,$O=this._repeat?10497:33071,$U=0==this._wrapModeU?10497:33071,$d=0==this._wrapModeV?10497:33071,$u=$E.isPOT($F,$J);$u?(this._mipmap?-1!==$q||($q=9987):-1!==$q||($q=9729),-1!==$B||($B=9729),$i.texParameteri(this._type,10241,$q),$i.texParameteri(this._type,10240,$B),$i.texParameteri(this._type,10242,$O),$i.texParameteri(this._type,10243,$O),$i.texParameteri(this._type,10242,$U),$i.texParameteri(this._type,10243,$d),this._mipmap&&$i.generateMipmap(this._type)):(-1!==$q||($q=9729),-1!==$B||($B=9729),$i.texParameteri(this._type,10241,$q),$i.texParameteri(this._type,10240,$B),$i.texParameteri(this._type,10242,33071),$i.texParameteri(this._type,10243,33071)),$A&&$t&&$m.bindTexture($i,$A,$t),this._image.onload=null,this._image=null,this.memorySize=$u?$F*$J*4*(1+1/3):$F*$J*4},$p.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},$p.onAsynLoaded=function($i,$p,$F){if($F){var $J=$F[0];void 0!==$J&&(this._canRead=$J);var $A=$F[1];void 0!==$A&&(this._repeat=$A);var $t=$F[2];void 0!==$t&&(this._format=$t);var $q=$F[3];void 0!==$q&&(this._mipmap=$q);var $B=$F.wrapModeU;void 0!==$B&&(this._wrapModeU=$B);var $O=$F.wrapModeV;void 0!==$O&&(this._wrapModeV=$O)}switch(this._format){case 6407:case 6408:var $U=(this._image=$p).width,$d=$p.height;this._width=$U,this._height=$d,this._size=new $xp($U,$d),this._canRead&&($x.isConchApp?$p instanceof $S.HTMLElement&&(this._pixels=new Uint8Array($p.getImageData(0,0,$U,$d))):($n.canvas.size($U,$d),$n.canvas.clear(),$n.context.drawImage($p,0,0,$U,$d),this._pixels=new Uint8Array($n.context.getImageData(0,0,$U,$d).data.buffer)));break;case $h.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var $u=new $g($p);$u.readUTFBytes(4),$u.readUTFBytes(2),$u.getInt16();$u.endian="bigEndian",this._width=$u.getInt16(),this._height=$u.getInt16(),this._size=new $xp(this._width,this._height);$u.getInt16(),$u.getInt16();this._image=new Uint8Array($p,$u.pos)}this.recreateResource(),this._endLoaded()},$p.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},$p.disposeResource=function(){this._source&&($h.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},$s(0,$p,"_src",function(){return this.url}),$s(0,$p,"src",function(){return this.url}),$A.load=function($i){return $v.loader.create($i,null,null,$A)},$A}(),$Tp=function($p){function $F($i,$p){$F.__super.call(this),void 0===$i&&($i=.3),void 0===$p&&($p=1e3),this._tempVector3=new $qp,this._position=new $qp,this._up=new $qp,this._forward=new $qp,this._right=new $qp,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=$xp.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=$i,this._farPlane=$p,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),$v.stage.on("resize",this,this._onScreenSizeChanged)}$Z($F,"laya.d3.core.BaseCamera",$p);var $i=$F.prototype;return $i._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var $i=this.scene._cameraPool,$p=$i.length-1,$F=0;$F<$p;$F++)if($i[$F].renderingOrder>$i[$p].renderingOrder){var $J=$i[$F];$i[$F]=$i[$p],$i[$p]=$J}},$i._calculateProjectionMatrix=function(){},$i._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},$i._prepareCameraToRender=function(){$I._currentCameraCullingMask=this.cullingMask;var $i=this._shaderValues;$i.setValue(0,this.transform.position.elements),$i.setValue(5,this.forward.elements),$i.setValue(6,this.up.elements)},$i._prepareCameraViewProject=function($i,$p){var $F=this._shaderValues;$F.setValue(1,$i.elements),$F.setValue(2,$p.elements)},$i._renderCamera=function($i,$p,$F){},$i.addLayer=function($i){29!==$i.number&&30!=$i.number&&(this.cullingMask=this.cullingMask|$i.mask)},$i.removeLayer=function($i){29!==$i.number&&30!=$i.number&&(this.cullingMask=this.cullingMask&~$i.mask)},$i.addAllLayers=function(){this.cullingMask=2147483647},$i.removeAllLayers=function(){this.cullingMask=0|$I.getLayerByNumber(29).mask|$I.getLayerByNumber(30).mask},$i.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},$i.moveForward=function($i){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=$i,this.transform.translate(this._tempVector3)},$i.moveRight=function($i){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=$i,this.transform.translate(this._tempVector3)},$i.moveVertical=function($i){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=$i,this.transform.translate(this._tempVector3,!1)},$i._addSelfRenderObjects=function(){var $i=this.scene._cameraPool,$p=$i.length;if(0<$p){for(var $F=$p-1;0<=$F;$F--)if(this.renderingOrder<=$i[$F].renderingOrder){$i.splice($F+1,0,this);break}}else $i.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},$i._clearSelfRenderObjects=function(){var $i=this.scene._cameraPool;$i.splice($i.indexOf(this),1)},$i.destroy=function($i){void 0===$i&&($i=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,$v.stage.off("resize",this,this._onScreenSizeChanged),$p.prototype.destroy.call(this,$i)},$s(0,$i,"sky",function(){return this._sky},function($i){(this._sky=$i)._ownerCamera=this}),$s(0,$i,"forward",function(){var $i=this.transform.worldMatrix.elements,$p=this._forward.elements;return $p[0]=-$i[8],$p[1]=-$i[9],$p[2]=-$i[10],this._forward}),$s(0,$i,"position",function(){var $i=this.transform.worldMatrix.elements,$p=this._position.elements;return $p[0]=$i[12],$p[1]=$i[13],$p[2]=$i[14],this._position}),$s(0,$i,"renderTarget",function(){return this._renderTarget},function($i){null!=(this._renderTarget=$i)&&(this._renderTargetSize=$i.size)}),$s(0,$i,"up",function(){var $i=this.transform.worldMatrix.elements,$p=this._up.elements;return $p[0]=$i[4],$p[1]=$i[5],$p[2]=$i[6],this._up}),$s(0,$i,"right",function(){var $i=this.transform.worldMatrix.elements,$p=this._right.elements;return $p[0]=$i[0],$p[1]=$i[1],$p[2]=$i[2],this._right}),$s(0,$i,"renderTargetSize",function(){return this._renderTargetSize},function($i){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=$i,this._calculateProjectionMatrix()}),$s(0,$i,"fieldOfView",function(){return this._fieldOfView},function($i){this._fieldOfView=$i,this._calculateProjectionMatrix()}),$s(0,$i,"nearPlane",function(){return this._nearPlane},function($i){this._nearPlane=$i,this._calculateProjectionMatrix()}),$s(0,$i,"farPlane",function(){return this._farPlane},function($i){this._farPlane=$i,this._calculateProjectionMatrix()}),$s(0,$i,"orthographic",function(){return this._orthographic},function($i){this._orthographic=$i,this._calculateProjectionMatrix()}),$s(0,$i,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function($i){this._orthographicVerticalSize=$i,this._calculateProjectionMatrix()}),$s(0,$i,"renderingOrder",function(){return this._renderingOrder},function($i){this._renderingOrder=$i,this._sortCamerasByRenderingOrder()}),$F.CAMERAPOS=0,$F.VIEWMATRIX=1,$F.PROJECTMATRIX=2,$F.VPMATRIX=3,$F.VPMATRIX_NO_TRANSLATE=4,$F.CAMERADIRECTION=5,$F.CAMERAUP=6,$F.ENVIRONMENTDIFFUSE=7,$F.ENVIRONMENTSPECULAR=8,$F.SIMLODINFO=9,$F.DIFFUSEIRRADMATR=10,$F.DIFFUSEIRRADMATG=11,$F.DIFFUSEIRRADMATB=12,$F.HDREXPOSURE=13,$F.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",$F.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",$F.CLEARFLAG_SOLIDCOLOR=0,$F.CLEARFLAG_SKY=1,$F.CLEARFLAG_DEPTHONLY=2,$F.CLEARFLAG_NONE=3,$u($F,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new $ip(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new $ip},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new $ip}]),$F}($_p),$kp=function($F){function $p($i){this._render=null,this._geometryFilter=null,$p.__super.call(this,$i)}$Z($p,"laya.d3.core.RenderableSprite3D",$F);var $i=$p.prototype;return $i._addToInitStaticBatchManager=function(){},$i._setBelongScene=function($i){$F.prototype._setBelongScene.call(this,$i),$i._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},$i._setUnBelongScene=function(){var $i=this._scene._renderableSprite3Ds,$p=$i.indexOf(this);$i.splice($p,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),$F.prototype._setUnBelongScene.call(this)},$i._update=function($i){($i.owner=this)._activeInHierarchy&&(this._updateComponents($i),this._render._updateOctreeNode(),this._lateUpdateComponents($i),$R.spriteCount++,this._childs.length&&this._updateChilds($i))},$i.destroy=function($i){void 0===$i&&($i=!0),$F.prototype.destroy.call(this,$i),this._render._destroy(),this._render=null},$p.__init__=function(){$p.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=$p.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),$p.SAHDERDEFINE_LIGHTMAP=$p.shaderDefines.registerDefine("LIGHTMAP")},$p.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,$p.SAHDERDEFINE_LIGHTMAP=4,$p.LIGHTMAPSCALEOFFSET=2,$p.LIGHTMAP=3,$u($p,["shaderDefines",function(){return this.shaderDefines=new $dp}]),$p}($_p),$wp=(function($i){function $J($i,$p,$F){this._long=NaN,this._width=NaN,this._height=NaN,void 0===$i&&($i=1),void 0===$p&&($p=1),void 0===$F&&($F=1),$J.__super.call(this),this._long=$i,this._width=$p,this._height=$F,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$Z($J,"laya.d3.resource.models.BoxMesh",$Lp);var $p=$J.prototype;$p.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var $i=$hi.vertexDeclaration,$p=($i.vertexStride,this._long/2),$F=this._height/2,$J=this._width/2,$A=new Float32Array([-$p,$F,-$J,0,1,0,0,0,$p,$F,-$J,0,1,0,1,0,$p,$F,$J,0,1,0,1,1,-$p,$F,$J,0,1,0,0,1,-$p,-$F,-$J,0,-1,0,0,1,$p,-$F,-$J,0,-1,0,1,1,$p,-$F,$J,0,-1,0,1,0,-$p,-$F,$J,0,-1,0,0,0,-$p,$F,-$J,-1,0,0,0,0,-$p,$F,$J,-1,0,0,1,0,-$p,-$F,$J,-1,0,0,1,1,-$p,-$F,-$J,-1,0,0,0,1,$p,$F,-$J,1,0,0,1,0,$p,$F,$J,1,0,0,0,0,$p,-$F,$J,1,0,0,0,1,$p,-$F,-$J,1,0,0,1,1,-$p,$F,$J,0,0,1,0,0,$p,$F,$J,0,0,1,1,0,$p,-$F,$J,0,0,1,1,1,-$p,-$F,$J,0,0,1,0,1,-$p,$F,-$J,0,0,-1,1,0,$p,$F,-$J,0,0,-1,0,0,$p,-$F,-$J,0,0,-1,0,1,-$p,-$F,-$J,0,0,-1,1,1]),$t=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new $op($i,this._numberVertices,35044,!0),this._indexBuffer=new $fp("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData($A),this._indexBuffer.setData($t),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$s(0,$p,"long",function(){return this._long},function($i){this._long!==$i&&(this._long=$i,this.releaseResource(),this.activeResource())}),$s(0,$p,"width",function(){return this._width},function($i){this._width!==$i&&(this._width=$i,this.releaseResource(),this.activeResource())}),$s(0,$p,"height",function(){return this._height},function($i){this._height!==$i&&(this._height=$i,this.releaseResource(),this.activeResource())})}(),function($i){function $A($i,$p,$F,$J){this._long=NaN,this._width=NaN,this._stacks=0,void(this._slices=0)===$i&&($i=10),void 0===$p&&($p=10),void 0===$F&&($F=10),void 0===$J&&($J=10),$A.__super.call(this),this._long=$i,this._width=$p,this._stacks=$F,this._slices=$J,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}$Z($A,"laya.d3.resource.models.PlaneMesh",$Lp);var $p=$A.prototype;$p.recreateResource=function(){this.disposeResource(),this._numberVertices=(this._stacks+1)*(this._slices+1),this._numberIndices=this._stacks*this._slices*2*3;for(var $i=new Uint16Array(this._numberIndices),$p=$hi.vertexDeclaration,$F=$p.vertexStride/4,$J=new Float32Array(this._numberVertices*$F),$A=this._long/2,$t=this._width/2,$q=this._long/this._stacks,$B=this._width/this._slices,$O=0,$U=0;$U<=this._slices;$U++)for(var $d=0;$d<=this._stacks;$d++)$J[$O++]=$d*$q-$A,$J[$O++]=0,$J[$O++]=$U*$B-$t,$J[$O++]=0,$J[$O++]=1,$J[$O++]=0,$J[$O++]=1*$d/this._stacks,$J[$O++]=1*$U/this._slices;var $u=0;for($U=0;$U<this._slices;$U++)for($d=0;$d<this._stacks;$d++)$i[$u++]=($U+1)*(this._stacks+1)+$d,$i[$u++]=$U*(this._stacks+1)+$d,$i[$u++]=($U+1)*(this._stacks+1)+$d+1,$i[$u++]=$U*(this._stacks+1)+$d,$i[$u++]=$U*(this._stacks+1)+$d+1,$i[$u++]=($U+1)*(this._stacks+1)+$d+1;this._vertexBuffer=new $op($p,this._numberVertices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer=new $fp("ushort",this._numberIndices,35044,!0),this._indexBuffer._addReference(),this._vertexBuffer.setData($J),this._indexBuffer.setData($i),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},$s(0,$p,"long",function(){return this._long},function($i){this._long!==$i&&(this._long=$i,this.releaseResource(),this.activeResource())}),$s(0,$p,"width",function(){return this._width},function($i){this._width!==$i&&(this._width=$i,this.releaseResource(),this.activeResource())}),$s(0,$p,"stacks",function(){return this._stacks},function($i){this._stacks!==$i&&(this._stacks=$i,this.releaseResource(),this.activeResource())}),$s(0,$p,"slices",function(){return this._slices},function($i){this._slices!==$i&&(this._slices=$i,this.releaseResource(),this.activeResource())})}(),function($i){function $q($i,$p,$F){void 0===$i&&($i=0),void 0===$p&&($p=.3),void 0===$F&&($F=1e3),this._viewMatrix=new $ip,this._projectionMatrix=new $ip,this._projectionViewMatrix=new $ip,this._viewport=new $Op(0,0,0,0),this._normalizedViewport=new $Op(0,0,1,1),this._aspectRatio=$i,this._boundFrustumUpdate=!0,this._boundFrustum=new $bi($ip.DEFAULT),$q.__super.call(this,$p,$F),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}$Z($q,"laya.d3.core.Camera",$Tp);var $p=$q.prototype;return $p._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},$p._parseCustomProps=function($i,$p,$F,$J){var $A=$F.clearColor;this.clearColor=new $Bp($A[0],$A[1],$A[2],$A[3]);var $t=$F.viewport;this.normalizedViewport=new $Op($t[0],$t[1],$t[2],$t[3])},$p._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var $i=this.orthographicVerticalSize*this.aspectRatio*.5,$p=.5*this.orthographicVerticalSize;$ip.createOrthoOffCenterRH(-$i,$i,-$p,$p,this.nearPlane,this.farPlane,this._projectionMatrix)}else $ip.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},$p._update=function($i){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,$i)},$p._renderCamera=function($i,$p,$F){var $J,$A;$F.parallelSplitShadowMaps[0]&&$F._renderShadowMap($i,$p,this),($p.camera=this)._prepareCameraToRender(),$F._preRenderUpdateComponents($p),$J=$p._viewMatrix=this.viewMatrix;var $t=this._renderTarget;$t?($t.start(),$ip.multiply($Tp._invertYScaleMatrix,this._projectionMatrix,$Tp._invertYProjectionMatrix),$ip.multiply($Tp._invertYScaleMatrix,this.projectionViewMatrix,$Tp._invertYProjectionViewMatrix),$A=$p._projectionMatrix=$Tp._invertYProjectionMatrix,$p._projectionViewMatrix=$Tp._invertYProjectionViewMatrix):($A=$p._projectionMatrix=this._projectionMatrix,$p._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject($J,$A),$p._viewport=this.viewport,$F._preRenderScene($i,$p,this.boundFrustum),$F._clear($i,$p),$F._renderScene($i,$p),$F._postRenderUpdateComponents($p),$t&&$t.end()},$p.viewportPointToRay=function($i,$p){$sp.calculateCursorRay($i,this.viewport,this._projectionMatrix,this.viewMatrix,null,$p)},$p.normalizedViewportPointToRay=function($i,$p){var $F=$q._tempVector20,$J=this.viewport,$A=$i.elements,$t=$F.elements;$t[0]=$A[0]*$J.width,$t[1]=$A[1]*$J.height,$sp.calculateCursorRay($F,this.viewport,this._projectionMatrix,this.viewMatrix,null,$p)},$p.worldToViewportPoint=function($i,$p){$ip.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project($i,this._projectionViewMatrix,$p);var $F=$p.elements;$F[0]=$F[0]/$v.stage.clientScaleX,$F[1]=$F[1]/$v.stage.clientScaleY},$p.worldToNormalizedViewportPoint=function($i,$p){$ip.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project($i,this._projectionViewMatrix,$p);var $F=$p.elements;$F[0]=$F[0]/$v.stage.clientScaleX,$F[1]=$F[1]/$v.stage.clientScaleY},$p.convertScreenCoordToOrthographicCoord=function($i,$p){if(this._orthographic){var $F=$X.clientWidth,$J=$X.clientHeight,$A=this.orthographicVerticalSize*this.aspectRatio/$F,$t=this.orthographicVerticalSize/$J,$q=$i.elements,$B=$p.elements;return $B[0]=(-$F/2+$q[0])*$A,$B[1]=($J/2-$q[1])*$t,$B[2]=(this.nearPlane-this.farPlane)*($q[2]+1)/2-this.nearPlane,$qp.transformCoordinate($p,this.transform.worldMatrix,$p),!0}return!1},$s(0,$p,"projectionViewMatrix",function(){return $ip.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),$s(0,$p,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var $i=this.viewport;return $i.width/$i.height},function($i){if($i<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=$i,this._calculateProjectionMatrix()}),$s(0,$p,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),$s(0,$p,"needViewport",function(){var $i=this.normalizedViewport;return 0===$i.x&&0===$i.y&&1===$i.width&&1===$i.height}),$s(0,$p,"viewport",function(){if(this._viewportExpressedInClipSpace){var $i=this._normalizedViewport,$p=this.renderTargetSize,$F=$p.width,$J=$p.height;this._viewport.x=$i.x*$F,this._viewport.y=$i.y*$J,this._viewport.width=$i.width*$F,this._viewport.height=$i.height*$J}return this._viewport},function($i){if(null!=this.renderTarget&&($i.x<0||$i.y<0||0==$i.width||0==$i.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=$i,this._calculateProjectionMatrix()}),$s(0,$p,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var $i=this._viewport,$p=this.renderTargetSize,$F=$p.width,$J=$p.height;this._normalizedViewport.x=$i.x/$F,this._normalizedViewport.y=$i.y/$J,this._normalizedViewport.width=$i.width/$F,this._normalizedViewport.height=$i.height/$J}return this._normalizedViewport},function($i){$i.x<0&&($i.x=0,console.warn("Camera: viewport.x must large than 0.0.")),$i.y<0&&($i.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<$i.x+$i.width&&($i.width=1-$i.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<$i.y+$i.height&&($i.height=1-$i.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=$i,this._calculateProjectionMatrix()}),$s(0,$p,"projectionMatrix",function(){return this._projectionMatrix},function($i){this._projectionMatrix=$i,this._useUserProjectionMatrix=!0}),$s(0,$p,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),$u($q,["_tempVector20",function(){return this._tempVector20=new $tp}]),$q}()),$$p=function($F){function $J($i,$p){$J.__super.call(this,$p),this._geometryFilter=new $np(this),this._render=new $Ip(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),$i&&(this._geometryFilter.sharedMesh=$i)instanceof laya.d3.resource.models.Mesh&&($i.loaded?this._render.sharedMaterials=$i.materials:$i.once("loaded",this,this._applyMeshMaterials))}$Z($J,"laya.d3.core.MeshSprite3D",$F);var $i=$J.prototype;return $i._changeRenderObjectByMesh=function($i){var $p=this._render._renderElements,$F=$p[$i];$F||($F=$p[$i]=new $ap),$F._render=this._render;var $J=this._render.sharedMaterials[$i];$J||($J=$Np.defaultMaterial);var $A=this._geometryFilter.sharedMesh.getRenderElement($i);return $F._mainSortID=this._getSortID($A,$J),$F._sprite3D=this,$F.renderObj=$A,$F._material=$J,$F},$i._changeRenderObjectByMaterial=function($i,$p){var $F=this._render._renderElements[$i];$p||($p=$Np.defaultMaterial);var $J=this._geometryFilter.sharedMesh.getRenderElement($i);return $F._mainSortID=this._getSortID($J,$p),$F._sprite3D=this,$F.renderObj=$J,$F._material=$p,$F},$i._changeRenderObjectsByMesh=function(){var $i=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=$i;for(var $p=0;$p<$i;$p++)this._changeRenderObjectByMesh($p)},$i._onMeshChanged=function($i){var $p=$i.sharedMesh;$p.loaded?this._changeRenderObjectsByMesh():$p.once("loaded",this,this._onMeshLoaded)},$i._onMeshLoaded=function($i){$i===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},$i._onMaterialChanged=function($i,$p,$F){$p<this._render._renderElements.length&&this._changeRenderObjectByMaterial($p,$F)},$i._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},$i._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},$i._parseCustomProps=function($i,$p,$F,$J){var $A=this.meshRender,$t=$F.lightmapIndex;null!=$t&&($A.lightmapIndex=$t);var $q,$B,$O=$F.lightmapScaleOffset;if($O&&($A.lightmapScaleOffset=new $Bp($O[0],$O[1],$O[2],$O[3])),$J.instanceParams)($q=$J.instanceParams.loadPath)&&($B=$r.getRes($p[$q]),(this.meshFilter.sharedMesh=$B).loaded?$A.sharedMaterials=$B.materials:$B.once("loaded",this,this._applyMeshMaterials));else{($q=$F.meshPath)&&($B=$r.getRes($p[$q]),this.meshFilter.sharedMesh=$B);var $U=$F.materials;if($U){var $d=$A.sharedMaterials,$u=$U.length;$d.length=$u;for(var $S=0;$S<$u;$S++)$d[$S]=$r.getRes($p[$U[$S].path]);$A.sharedMaterials=$d}}},$i._applyMeshMaterials=function($i){for(var $p=this._render.sharedMaterials,$F=$i.materials,$J=0,$A=$F.length;$J<$A;$J++)$p[$J]||($p[$J]=$F[$J]);this._render.sharedMaterials=$p},$i._addToInitStaticBatchManager=function(){$J._staticBatchManager._addInitBatchSprite(this)},$i.cloneTo=function($i){var $p=$i;$p._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var $F=this._render,$J=$p._render;$J.enable=$F.enable,$J.sharedMaterials=$F.sharedMaterials,$J.castShadow=$F.castShadow;var $A=$F.lightmapScaleOffset;$A&&($J.lightmapScaleOffset=$A.clone()),$J.lightmapIndex=$F.lightmapIndex,$J.receiveShadow=$F.receiveShadow,$J.sortingFudge=$F.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,$i)},$i.destroy=function($i){if(void 0===$i&&($i=!0),!this.destroyed){var $p=this.meshFilter.sharedMesh;null!=$p&&($p.loaded||$p.off("loaded",this,this._applyMeshMaterials)),$F.prototype.destroy.call(this,$i),this._geometryFilter._destroy()}},$s(0,$i,"meshFilter",function(){return this._geometryFilter}),$s(0,$i,"meshRender",function(){return this._render}),$J.__init__=function(){$Ji._staticBatchManagers.push($J._staticBatchManager)},$J.load=function($i){return $v.loader.create($i,null,null,$J)},$u($J,["_staticBatchManager",function(){return this._staticBatchManager=new $Qp}]),$J}($kp)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}}),function($i,$p,$Ai){$Ai.un,$Ai.uns;var $F=$Ai.static,$J=$Ai.class,$t=$Ai.getset,$x=$Ai.__newvec,$B=laya.maths.Bezier,$u=laya.utils.Browser,$hi=laya.utils.Byte,$A=(laya.events.Event,laya.events.EventDispatcher),$q=laya.display.Graphics,$O=(laya.resource.HTMLCanvas,laya.utils.Handler),$U=laya.net.Loader,$S=laya.maths.MathUtil,$mi=laya.maths.Matrix,$j=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),$d=(laya.renders.RenderContext,laya.resource.Resource),$Z=laya.utils.RunDriver,$ti=laya.display.Sprite,$s=laya.utils.Stat,$ni=laya.resource.Texture,$r=(laya.net.URL,laya.utils.Utils),$m=function(){function $i(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return $J($i,"laya.ani.AnimationContent"),$i}(),$n=function(){function $i(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return $J($i,"laya.ani.AnimationNodeContent"),$i}(),$D=function(){function $i(){}return $J($i,"laya.ani.AnimationParser01"),$i.parse=function($i,$p){var $F=$p.__getBuffer(),$J=0,$A=0,$t=0,$q=0,$B=0,$O=0,$U=0,$d=$p.readUTFString();$i._aniClassName=$d;var $u,$S=$p.readUTFString().split("\n"),$Z=$p.getUint8(),$s=$p.getUint32(),$x=$p.getUint32();0<$s&&($u=$F.slice($s,$x));var $j=new $hi($u);for(0<$x&&($i._publicExtData=$F.slice($x,$F.byteLength)),$i._useParent=!!$p.getUint8(),$i._anis.length=$Z,$J=0;$J<$Z;$J++){var $r=$i._anis[$J]=new $m;$r.nodes=new Array;var $M=$r.name=$S[$p.getUint16()];$i._aniMap[$M]=$J,$r.bone3DMap={},$r.playTime=$p.getFloat32(),$r.playTime<=0&&console.error("播放时间不能为0  url="+$i.url+" name="+$r.name);var $D=$r.nodes.length=$p.getUint8();for($A=$r.totalKeyframeDatasLength=0;$A<$D;$A++){var $E=$r.nodes[$A]=new $n;$E.childs=[];var $v=$p.getInt16();0<=$v&&($E.name=$S[$v],$r.bone3DMap[$E.name]=$A),$E.keyFrame=new Array,$E.parentIndex=$p.getInt16(),-1==$E.parentIndex?$E.parent=null:$E.parent=$r.nodes[$E.parentIndex],$E.lerpType=$p.getUint8();var $g=$p.getUint32();$j.pos=$g;var $a=$E.keyframeWidth=$j.getUint16();if($r.totalKeyframeDatasLength+=$a,0===$E.lerpType||1===$E.lerpType)for($E.interpolationMethod=[],$E.interpolationMethod.length=$a,$t=0;$t<$a;$t++)$E.interpolationMethod[$t]=$_.interpolation[$j.getUint8()];null!=$E.parent&&$E.parent.childs.push($E);var $R=$p.getUint16();0<$R&&($E.extenData=$F.slice($p.pos,$p.pos+$R),$p.pos+=$R);var $Q,$P=$p.getUint16(),$Y=0;for($t=0,$q=$E.keyFrame.length=$P;$t<$q;$t++){if(($Q=$E.keyFrame[$t]=new $I).duration=$p.getFloat32(),$Q.startTime=$Y,2===$E.lerpType){$Q.interpolationData=[];var $c,$h=$p.getUint8();switch($c=$p.getFloat32()){case 254:for($Q.interpolationData.length=$a,$U=0;$U<$a;$U++)$Q.interpolationData[$U]=0;break;case 255:for($Q.interpolationData.length=$a,$U=0;$U<$a;$U++)$Q.interpolationData[$U]=5;break;default:for($Q.interpolationData.push($c),$O=1;$O<$h;$O++)$Q.interpolationData.push($p.getFloat32())}}for($Q.data=new Float32Array($a),$B=0;$B<$a;$B++)$Q.data[$B]=$p.getFloat32(),-1e-8<$Q.data[$B]&&$Q.data[$B]<1e-8&&($Q.data[$B]=0);$Y+=$Q.duration}$Q.startTime=$r.playTime,$E.playTime=$r.playTime,$i._calculateKeyFrame($E,$P,$a)}}},$i}(),$E=function(){function $v(){}return $J($v,"laya.ani.AnimationParser02"),$v.READ_DATA=function(){$v._DATA.offset=$v._reader.getUint32(),$v._DATA.size=$v._reader.getUint32()},$v.READ_BLOCK=function(){for(var $i=$v._BLOCK.count=$v._reader.getUint16(),$p=$v._BLOCK.blockStarts=[],$F=$v._BLOCK.blockLengths=[],$J=0;$J<$i;$J++)$p.push($v._reader.getUint32()),$F.push($v._reader.getUint32())},$v.READ_STRINGS=function(){var $i=$v._reader.getUint32(),$p=$v._reader.getUint16(),$F=$v._reader.pos;$v._reader.pos=$i+$v._DATA.offset;for(var $J=0;$J<$p;$J++)$v._strings[$J]=$v._reader.readUTFString();$v._reader.pos=$F},$v.parse=function($i,$p){$v._templet=$i;($v._reader=$p).__getBuffer();$v.READ_DATA(),$v.READ_BLOCK(),$v.READ_STRINGS();for(var $F=0,$J=$v._BLOCK.count;$F<$J;$F++){var $A=$p.getUint16(),$t=$v._strings[$A],$q=$v["READ_"+$t];if(null==$q)throw new Error("model file err,no this function:"+$A+" "+$t);$q.call()}},$v.READ_ANIMATIONS=function(){var $i=$v._reader,$p=$i.__getBuffer(),$F=0,$J=0,$A=0,$t=0,$q=$i.getUint16(),$B=[];for($B.length=$q,$F=0;$F<$q;$F++)$B[$F]=$_.interpolation[$i.getByte()];var $O=$i.getUint8();for($v._templet._anis.length=$O,$F=0;$F<$O;$F++){var $U=$v._templet._anis[$F]={};$U.nodes=new Array;var $d=$U.name=$v._strings[$i.getUint16()];$v._templet._aniMap[$d]=$F,$U.bone3DMap={},$U.playTime=$i.getFloat32();var $u=$U.nodes.length=$i.getInt16();for($J=$U.totalKeyframeDatasLength=0;$J<$u;$J++){var $S=$U.nodes[$J]={};$S.keyframeWidth=$q,$S.childs=[];var $Z=$i.getUint16();0<=$Z&&($S.name=$v._strings[$Z],$U.bone3DMap[$S.name]=$J),$S.keyFrame=new Array,$S.parentIndex=$i.getInt16(),-1==$S.parentIndex?$S.parent=null:$S.parent=$U.nodes[$S.parentIndex],$U.totalKeyframeDatasLength+=$q,$S.interpolationMethod=$B,null!=$S.parent&&$S.parent.childs.push($S);var $s=$i.getUint16(),$x=null,$j=null;for($A=0,$t=$S.keyFrame.length=$s;$A<$t;$A++){($x=$S.keyFrame[$A]={}).startTime=$i.getFloat32(),$j&&($j.duration=$x.startTime-$j.startTime);var $r=$v._DATA.offset,$M=$i.getUint32(),$D=4*$q,$E=$p.slice($r+$M,$r+$M+$D);$x.data=new Float32Array($E),$j=$x}$x.duration=0,$S.playTime=$U.playTime,$v._templet._calculateKeyFrame($S,$s,$q)}}},$v._templet=null,$v._reader=null,$v._strings=[],$F($v,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),$v}(),$Ii=(function(){function $i(){}$J($i,"laya.ani.AnimationState"),$i.stopped=0,$i.paused=1,$i.playing=2}(),function(){function $A(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new $ki,this.resultMatrix=new $mi,this._children=[]}$J($A,"laya.ani.bone.Bone");var $i=$A.prototype;return $i.setTempMatrix=function($i){this._tempMatrix=$i;var $p,$F=0;for($F=0,$p=this._children.length;$F<$p;$F++)this._children[$F].setTempMatrix(this._tempMatrix)},$i.update=function($i){var $p;if(this.rotation=this.transform.skX,$i)$p=this.resultTransform.getMatrix(),$mi.mul($p,$i,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)$p=this.resultTransform.getMatrix(),$mi.mul($p,this.parentBone.resultMatrix,this.resultMatrix);else{var $F=this.parentBone,$J=NaN,$A=NaN,$t=NaN,$q=this.parentBone.resultMatrix;$p=this.resultTransform.getMatrix();var $B=$q.a*$p.tx+$q.c*$p.ty+$q.tx,$O=$q.b*$p.tx+$q.d*$p.ty+$q.ty,$U=new $mi;this.inheritRotation?($J=Math.atan2($F.resultMatrix.b,$F.resultMatrix.a),$A=Math.cos($J),$t=Math.sin($J),$U.setTo($A,$t,-$t,$A,0,0),$mi.mul(this._tempMatrix,$U,$mi.TEMP),$mi.TEMP.copyTo($U),$p=this.resultTransform.getMatrix(),$mi.mul($p,$U,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,$p=this.resultTransform.getMatrix(),$mi.TEMP.identity(),$mi.TEMP.d=this.d,$mi.mul($p,$mi.TEMP,this.resultMatrix)),this.resultMatrix.tx=$B,this.resultMatrix.ty=$O}else($p=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var $d,$u=0;for($u=0,$d=this._children.length;$u<$d;$u++)this._children[$u].update()},$i.updateChild=function(){var $i,$p=0;for($p=0,$i=this._children.length;$p<$i;$p++)this._children[$p].update()},$i.setRotation=function($i){this._sprite&&(this._sprite.rotation=180*$i/Math.PI)},$i.updateDraw=function($i,$p){$A.ShowBones&&!$A.ShowBones[this.name]||(this._sprite||(this._sprite=new $ti,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),$Ai.stage.addChild(this._sprite)),this._sprite.x=$i+this.resultMatrix.tx,this._sprite.y=$p+this.resultMatrix.ty);var $F,$J=0;for($J=0,$F=this._children.length;$J<$F;$J++)this._children[$J].updateDraw($i,$p)},$i.addChild=function($i){this._children.push($i),$i.parentBone=this},$i.findBone=function($i){if(this.name==$i)return this;var $p,$F,$J=0;for($J=0,$p=this._children.length;$J<$p;$J++)if($F=this._children[$J].findBone($i))return $F;return null},$i.localToWorld=function($i){var $p=$i[0],$F=$i[1];$i[0]=$p*this.resultMatrix.a+$F*this.resultMatrix.c+this.resultMatrix.tx,$i[1]=$p*this.resultMatrix.b+$F*this.resultMatrix.d+this.resultMatrix.ty},$A.ShowBones={},$A}()),$Gi=function(){function $x(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}$J($x,"laya.ani.bone.BoneSlot");var $i=$x.prototype;return $i.showSlotData=function($i,$p){void 0===$p&&($p=!0),this.currSlotData=$i,$p&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},$i.showDisplayByName=function($i){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName($i))},$i.replaceDisplayByName=function($i,$p){if(this.currSlotData){var $F;$F=this.currSlotData.getDisplayByName($i);var $J;$J=this.currSlotData.getDisplayByName($p),this.replaceDisplayByIndex($F,$J)}},$i.replaceDisplayByIndex=function($i,$p){this.currSlotData&&(this._replaceDic[$i]=$p,this.displayIndex==$i&&this.showDisplayByIndex($i))},$i.showDisplayByIndex=function($i){if(null!=this._replaceDic[$i]&&($i=this._replaceDic[$i]),this.currSlotData&&-1<$i&&$i<this.currSlotData.displayArr.length){if(this.displayIndex=$i,this.currDisplayData=this.currSlotData.displayArr[$i],this.currDisplayData){var $p=this.currDisplayData.name;this.currTexture=this.templet.getTexture($p),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!$j.isConchApp||$j.isConchApp&&"0.9.15"<$ti.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},$i.replaceSkin=function($i){this._diyTexture=$i,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},$i.setParentMatrix=function($i){this._parentMatrix=$i},$i.draw=function($i,$p,$F,$J){if(void 0===$F&&($F=!1),void 0===$J&&($J=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var $A,$t=this.currTexture;switch(this._diyTexture&&($t=this._diyTexture),this.currDisplayData.type){case 0:if($i){var $q=this.getDisplayMatrix();if(this._parentMatrix){var $B=!1;if($q){var $O;if($mi.mul($q,this._parentMatrix,$mi.TEMP),$O=$F?(null==this._resultMatrix&&(this._resultMatrix=new $mi),this._resultMatrix):new $mi,!$j.isWebGL&&this.currDisplayData.uvs||$j.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var $U=$x._tempMatrix;$U.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($U.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&($B=!0,$U.rotate(-Math.PI/2)),$mi.mul($U,$mi.TEMP,$O)}else $mi.TEMP.copyTo($O);$B?$i.drawTexture($t,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,$O):$i.drawTexture($t,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,$O)}}}break;case 1:if(null==($A=$F?(null==this._skinSprite&&(this._skinSprite=$x.createSkinMesh()),this._skinSprite):$x.createSkinMesh()))return;var $d;if(null==this.currDisplayData.bones){var $u,$S=this.currDisplayData.weights;this.deformData&&($S=this.deformData),$u=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$a.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$a.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=$S;this.currDisplayData.triangles.length;$d=this.currDisplayData.triangles,$A.init2($t,null,$d,this._mVerticleArr,$u);var $Z,$s=this.getDisplayMatrix();if(this._parentMatrix)if($s)$mi.mul($s,this._parentMatrix,$mi.TEMP),$Z=$F?(null==this._resultMatrix&&(this._resultMatrix=new $mi),this._resultMatrix):new $mi,$mi.TEMP.copyTo($Z),$A.transform=$Z}else this.skinMesh($p,$A,$J);$i.drawSkin($A);break;case 2:if(null==($A=$F?(null==this._skinSprite&&(this._skinSprite=$x.createSkinMesh()),this._skinSprite):$x.createSkinMesh()))return;this.skinMesh($p,$A,$J),$i.drawSkin($A)}}},$i.skinMesh=function($i,$p,$F){var $J,$A=this.currTexture,$t=this.currDisplayData.bones;$J=this._diyTexture?($A=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=$a.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=$a.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var $q,$B,$O=this.currDisplayData.weights,$U=this.currDisplayData.triangles,$d=0,$u=0,$S=0,$Z=NaN,$s=NaN,$x=0,$j=0,$r=[],$M=0,$D=0;if(this.deformData&&0<this.deformData.length){var $E=0;for($M=0,$D=$t.length;$M<$D;){for($S=$t[$M++]+$M,$u=$d=0;$M<$S;$M++)$B=$i[$t[$M]],$Z=$O[$x]+this.deformData[$E++],$s=$O[$x+1]+this.deformData[$E++],$j=$O[$x+2],$d+=($Z*$B.a+$s*$B.c+$B.tx)*$j,$u+=($Z*$B.b+$s*$B.d+$B.ty)*$j,$x+=3;$r.push($d,$u)}}else for($M=0,$D=$t.length;$M<$D;){for($S=$t[$M++]+$M,$u=$d=0;$M<$S;$M++)$B=$i[$t[$M]],$Z=$O[$x],$s=$O[$x+1],$j=$O[$x+2],$d+=($Z*$B.a+$s*$B.c+$B.tx)*$j,$u+=($Z*$B.b+$s*$B.d+$B.ty)*$j,$x+=3;$r.push($d,$u)}this._mVerticleArr=$r,$q=$U,$p.init2($A,null,$q,this._mVerticleArr,$J)},$i.drawBonePoint=function($i){$i&&this._parentMatrix&&$i.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},$i.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},$i.getMatrix=function(){return this._resultMatrix},$i.copy=function(){var $i=new $x;return $i.type="copy",$i.name=this.name,$i.attachmentName=this.attachmentName,$i.srcDisplayIndex=this.srcDisplayIndex,$i.parent=this.parent,$i.displayIndex=this.displayIndex,$i.templet=this.templet,$i.currSlotData=this.currSlotData,$i.currTexture=this.currTexture,$i.currDisplayData=this.currDisplayData,$i},$x.createSkinMesh=function(){return $j.isWebGL||$j.isConchApp?$Z.skinAniSprite():($j.isWebGL,null)},$F($x,["_tempMatrix",function(){return this._tempMatrix=new $mi}]),$x}(),$_i=function(){function $i(){this.skinName=null,this.deformSlotDataList=[]}return $J($i,"laya.ani.bone.DeformAniData"),$i}(),$yi=function(){function $i(){this.deformSlotDisplayList=[]}return $J($i,"laya.ani.bone.DeformSlotData"),$i}(),$Ni=function(){function $i(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}$J($i,"laya.ani.bone.DeformSlotDisplayData");var $p=$i.prototype;return $p.binarySearch1=function($i,$p){var $F=0,$J=$i.length-2;if(0==$J)return 1;for(var $A=$J>>>1;;){if($i[Math.floor($A+1)]<=$p?$F=$A+1:$J=$A,$F==$J)return $F+1;$A=$F+$J>>>1}return 0},$p.apply=function($i,$p,$F){if(void 0===$F&&($F=1),$i+=.05,!(this.timeList.length<=0)){var $J=0;if(!($i<this.timeList[0])){var $A=this.vectices[0].length,$t=[],$q=this.binarySearch1(this.timeList,$i);if(this.frameIndex=$q,$i>=this.timeList[this.timeList.length-1]){var $B=this.vectices[this.vectices.length-1];if($F<1)for($J=0;$J<$A;$J++)$t[$J]+=($B[$J]-$t[$J])*$F;else for($J=0;$J<$A;$J++)$t[$J]=$B[$J];this.deformData=$t}else{this.tweenKeyList[this.frameIndex];var $O=this.vectices[this.frameIndex-1],$U=this.vectices[this.frameIndex],$d=this.timeList[this.frameIndex-1],$u=this.timeList[this.frameIndex];$F=this.tweenKeyList[$q-1]?($i-$d)/($u-$d):0;var $S=NaN;for($J=0;$J<$A;$J++)$S=$O[$J],$t[$J]=$S+($U[$J]-$S)*$F;this.deformData=$t}}}},$i}(),$fi=function(){function $i(){this.time=NaN,this.drawOrder=[]}return $J($i,"laya.ani.bone.DrawOrderData"),$i}(),$oi=function(){function $i(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return $J($i,"laya.ani.bone.EventData"),$i}(),$M=function(){function $Ji($i,$p){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=$i,this._targetBone=$p[$i.targetBoneIndex],this.isSpine=$i.isSpine,null==this._bones&&(this._bones=[]);for(var $F=this._bones.length=0,$J=$i.boneIndexs.length;$F<$J;$F++)this._bones.push($p[$i.boneIndexs[$F]]);this.name=$i.name,this.mix=$i.mix,this.bendDirection=$i.bendDirection}$J($Ji,"laya.ani.bone.IkConstraint");var $i=$Ji.prototype;return $i.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},$i._applyIk1=function($i,$p,$F,$J){var $A=$i.parentBone,$t=1/($A.resultMatrix.a*$A.resultMatrix.d-$A.resultMatrix.b*$A.resultMatrix.c),$q=$p-$A.resultMatrix.tx,$B=$F-$A.resultMatrix.ty,$O=($q*$A.resultMatrix.d-$B*$A.resultMatrix.c)*$t-$i.transform.x,$U=($B*$A.resultMatrix.a-$q*$A.resultMatrix.b)*$t-$i.transform.y,$d=Math.atan2($U,$O)*$Ji.radDeg-0-$i.transform.skX;$i.transform.scX<0&&($d+=180),180<$d?$d-=360:$d<-180&&($d+=360),$i.transform.skX=$i.transform.skY=$i.transform.skX+$d*$J,$i.update()},$i.updatePos=function($i,$p){this._sp&&this._sp.pos($i,$p)},$i._applyIk2=function($i,$p,$F,$J,$A,$t){if(0!=$t){var $q=$i.resultTransform.x,$B=$i.resultTransform.y,$O=$i.transform.scX,$U=$i.transform.scY,$d=$p.transform.scX,$u=0,$S=0,$Z=0;$Z=$O<0?($O=-$O,$u=180,-1):($u=0,1),$U<0&&($U=-$U,$Z=-$Z),$S=$d<0?($d=-$d,180):0;var $s=$p.resultTransform.x,$x=NaN,$j=NaN,$r=NaN,$M=$i.resultMatrix.a,$D=$i.resultMatrix.c,$E=$i.resultMatrix.b,$v=$i.resultMatrix.d,$g=Math.abs($O-$U)<=1e-4;$r=$g?($j=$M*$s+$D*($x=$p.resultTransform.y)+$i.resultMatrix.tx,$E*$s+$v*$x+$i.resultMatrix.ty):($x=0,$j=$M*$s+$i.resultMatrix.tx,$E*$s+$i.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new $ti,$Ai.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($F,$J,15,"#ffff00"),this._sp.graphics.drawCircle($j,$r,15,"#ff00ff")),$i.setRotation(Math.atan2($r-$i.resultMatrix.ty,$j-$i.resultMatrix.tx));var $a=$i.parentBone;$M=$a.resultMatrix.a,$D=$a.resultMatrix.c,$E=$a.resultMatrix.b;var $R=1/($M*($v=$a.resultMatrix.d)-$D*$E),$Q=$F-$a.resultMatrix.tx,$P=$J-$a.resultMatrix.ty,$Y=($Q*$v-$P*$D)*$R-$q,$c=($P*$M-$Q*$E)*$R-$B,$h=(($Q=$j-$a.resultMatrix.tx)*$v-($P=$r-$a.resultMatrix.ty)*$D)*$R-$q,$m=($P*$M-$Q*$E)*$R-$B,$n=Math.sqrt($h*$h+$m*$m),$I=$p.length*$d,$G=NaN,$_=NaN;if($g){var $y=($Y*$Y+$c*$c-$n*$n-($I*=$O)*$I)/(2*$n*$I);$y<-1?$y=-1:1<$y&&($y=1),$_=Math.acos($y)*$A,$M=$n+$I*$y,$D=$I*Math.sin($_),$G=Math.atan2($c*$M-$Y*$D,$Y*$M+$c*$D)}else{var $N=($M=$O*$I)*$M,$f=($D=$U*$I)*$D,$o=$Y*$Y+$c*$c,$W=Math.atan2($c,$Y),$L=-2*$f*$n,$C=$f-$N;if(0<($v=$L*$L-4*$C*($E=$f*$n*$n+$N*$o-$N*$f))){var $K=Math.sqrt($v);$L<0&&($K=-$K);var $V=($K=-($L+$K)/2)/$C,$T=$E/$K,$k=Math.abs($V)<Math.abs($T)?$V:$T;$k*$k<=$o&&($P=Math.sqrt($o-$k*$k)*$A,$G=$W-Math.atan2($P,$k),$_=Math.atan2($P/$U,($k-$n)/$O))}var $w=0,$$=Number.MAX_VALUE,$X=0,$e=0,$b=0,$z=0,$l=0,$H=0;$z<($v=($Q=$n+$M)*$Q)&&($b=0,$z=$v,$l=$Q),($v=($Q=$n-$M)*$Q)<$$&&($w=Math.PI,$$=$v,$X=$Q);var $ii=Math.acos(-$M*$n/($N-$f));($v=($Q=$M*Math.cos($ii)+$n)*$Q+($P=$D*Math.sin($ii))*$P)<$$&&($w=$ii,$$=$v,$X=$Q,$e=$P),$z<$v&&($b=$ii,$z=$v,$l=$Q,$H=$P),$_=$o<=($$+$z)/2?($G=$W-Math.atan2($e*$A,$X),$w*$A):($G=$W-Math.atan2($H*$A,$l),$b*$A)}var $pi=Math.atan2($x,$s)*$Z,$Fi=$i.resultTransform.skX;180<($G=($G-$pi)*$Ji.radDeg+$u-$Fi)?$G-=360:$G<-180&&($G+=360),$i.resultTransform.x=$q,$i.resultTransform.y=$B,$i.resultTransform.skX=$i.resultTransform.skY=$Fi+$G*$t,$Fi=$p.resultTransform.skX,180<($_=(($_+$pi)*$Ji.radDeg-0)*$Z+$S-($Fi%=360))?$_-=360:$_<-180&&($_+=360),$p.resultTransform.x=$s,$p.resultTransform.y=$x,$p.resultTransform.skX=$p.resultTransform.skY=$p.resultTransform.skY+$_*$t,$i.update()}},$i._applyIk3=function($i,$p,$F,$J,$A,$t){if(0!=$t){var $q,$B,$O=$p.resultMatrix.a*$p.length,$U=$p.resultMatrix.b*$p.length,$d=$O*$O+$U*$U,$u=Math.sqrt($d),$S=$i.resultMatrix.tx,$Z=$i.resultMatrix.ty,$s=$p.resultMatrix.tx,$x=$p.resultMatrix.ty,$j=$s-$S,$r=$x-$Z,$M=$j*$j+$r*$r,$D=Math.sqrt($M),$E=($j=$F-$i.resultMatrix.tx)*$j+($r=$J-$i.resultMatrix.ty)*$r,$v=Math.sqrt($E);if($u+$D<=$v||$v+$u<=$D||$v+$D<=$u){var $g=NaN;$s=$S+($g=$u+$D<=$v?1:-1)*($F-$S)*$D/$v,$x=$Z+$g*($J-$Z)*$D/$v}else{var $a=($M-$d+$E)/(2*$E),$R=Math.sqrt($M-$a*$a*$E)/$v,$Q=$S+$j*$a,$P=$Z+$r*$a,$Y=-$r*$R,$c=$j*$R;$x=0<$A?($s=$Q-$Y,$P-$c):($s=$Q+$Y,$P+$c)}$q=$s,$B=$x,this.isDebug&&(this._sp||(this._sp=new $ti,$Ai.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle($S,$Z,15,"#ff00ff"),this._sp.graphics.drawCircle($F,$J,15,"#ffff00"),this._sp.graphics.drawCircle($q,$B,15,"#ff00ff"));var $h,$m;$h=Math.atan2($B-$i.resultMatrix.ty,$q-$i.resultMatrix.tx),$i.setRotation($h),($m=$Ji._tempMatrix).identity(),$m.rotate($h),$m.scale($i.resultMatrix.getScaleX(),$i.resultMatrix.getScaleY()),$m.translate($i.resultMatrix.tx,$i.resultMatrix.ty),$m.copyTo($i.resultMatrix),$i.updateChild();var $n,$I;$n=Math.atan2($J-$B,$F-$q),$p.setRotation($n),($I=$Ji._tempMatrix).identity(),$I.rotate($n),$I.scale($p.resultMatrix.getScaleX(),$p.resultMatrix.getScaleY()),$I.translate($q,$B),$m.copyTo($p.resultMatrix),$p.updateChild()}},$F($Ji,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new $mi}]),$Ji}(),$Wi=function(){function $i(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return $J($i,"laya.ani.bone.IkConstraintData"),$i}(),$v=function(){function $I($i,$p){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=$i,this.position=$i.position,this.spacing=$i.spacing,this.rotateMix=$i.rotateMix,this.translateMix=$i.translateMix,this.bones=[];for(var $F=this.data.bones,$J=0,$A=$F.length;$J<$A;$J++)this.bones.push($p[$F[$J]])}$J($I,"laya.ani.bone.PathConstraint");var $i=$I.prototype;return $i.apply=function($i,$p){if(this.target){var $F=this.translateMix,$J=this.translateMix,$A=0<$J,$t=this.data.spacingMode,$q="length"==$t,$B=this.data.rotateMode,$O="tangent"==$B,$U="chainScale"==$B,$d=[],$u=this.bones.length,$S=$O?$u:$u+1,$Z=[];(this._spaces=$Z)[0]=this.position;var $s=this.spacing;if($U||$q)for(var $x=0,$j=$S-1;$x<$j;){var $r=this.bones[$x],$M=$r.length,$D=$M*$r.resultMatrix.a,$E=$M*$r.resultMatrix.b;$M=Math.sqrt($D*$D+$E*$E),$U&&($d[$x]=$M),$Z[++$x]=$q?Math.max(0,$M+$s):$s}else for($x=1;$x<$S;$x++)$Z[$x]=$s;var $v=this.computeWorldPositions(this.target,$i,$p,$S,$O,"percent"==this.data.positionMode,"percent"==$t);if(this._debugKey){for($x=0;$x<$v.length;$x++)$p.drawCircle($v[$x++],$v[$x++],5,"#00ff00");var $g=[];for($x=0;$x<$v.length;$x++)$g.push($v[$x++],$v[$x++]);$p.drawLines(0,0,$g,"#ff0000")}var $a=$v[0],$R=$v[1],$Q=this.data.offsetRotation,$P="chain"==$B&&0==$Q,$Y=NaN;for($x=0,$Y=3;$x<$u;$x++,$Y+=3){($r=this.bones[$x]).resultMatrix.tx+=($a-$r.resultMatrix.tx)*$F,$r.resultMatrix.ty+=($R-$r.resultMatrix.ty)*$F;var $c=($D=$v[$Y])-$a,$h=($E=$v[$Y+1])-$R;if($U&&0!=($M=$d[$x])){var $m=(Math.sqrt($c*$c+$h*$h)/$M-1)*$J+1;$r.resultMatrix.a*=$m,$r.resultMatrix.c*=$m}if($a=$D,$R=$E,$A){var $n=$r.resultMatrix.a,$I=$r.resultMatrix.c,$G=$r.resultMatrix.b,$_=$r.resultMatrix.d,$y=NaN,$N=NaN,$f=NaN;$y=$O?$v[$Y-1]:0==$Z[$x+1]?$v[$Y+2]:Math.atan2($h,$c),$y-=Math.atan2($G,$n)-$Q/180*Math.PI,$P&&($N=Math.cos($y),$f=Math.sin($y),$a+=(($M=$r.length)*($N*$n-$f*$G)-$c)*$J,$R+=($M*($f*$n+$N*$G)-$h)*$J),$y>Math.PI?$y-=2*Math.PI:$y<-Math.PI&&($y+=2*Math.PI),$y*=$J,$N=Math.cos($y),$f=Math.sin($y),$r.resultMatrix.a=$N*$n-$f*$G,$r.resultMatrix.c=$N*$I-$f*$_,$r.resultMatrix.b=$f*$n+$N*$G,$r.resultMatrix.d=$f*$I+$N*$_}}}},$i.computeWorldVertices2=function($i,$p,$F,$J,$A,$t){var $q,$B,$O=$i.currDisplayData.bones,$U=$i.currDisplayData.weights,$d=$i.currDisplayData.triangles,$u=0,$S=0,$Z=0,$s=0,$x=0,$j=0,$r=0,$M=0,$D=0,$E=0,$v=0;if(null!=$O){for($u=0;$u<$F;$u+=2)$S+=($s=$O[$S])+1,$Z+=$s;var $g=$p;for($x=$t,$j=3*$Z;$x<$J;$x+=2){for($M=$r=0,$s=$O[$S++],$s+=$S;$S<$s;$S++,$j+=3){$q=$g[$O[$S]].resultMatrix,$D=$U[$j],$E=$U[$j+1];var $a=$U[$j+2];$r+=($D*$q.a+$E*$q.c+$q.tx)*$a,$M+=($D*$q.b+$E*$q.d+$q.ty)*$a}$A[$x]=$r,$A[$x+1]=$M}}else{var $R,$Q;if($d||($d=$U),$i.deformData&&($d=$i.deformData),$R=$i.parent,$p)for($v=$p.length,$u=0;$u<$v;$u++)if($p[$u].name==$R){$B=$p[$u];break}$B&&($Q=$B.resultMatrix),$Q||($Q=$I._tempMt);var $P=$Q.tx,$Y=$Q.ty,$c=$Q.a,$h=$Q.b,$m=$Q.c,$n=$Q.d;for($B&&($n*=$B.d),$S=$F,$x=$t;$x<$J;$S+=2,$x+=2)$D=$d[$S],$E=$d[$S+1],$A[$x]=$D*$c+$E*$h+$P,$A[$x+1]=-($D*$m+$E*$n+$Y)}},$i.computeWorldPositions=function($i,$p,$F,$J,$A,$t,$q){$i.currDisplayData.bones,$i.currDisplayData.weights,$i.currDisplayData.triangles;var $B=[],$O=0,$U=$i.currDisplayData.verLen,$d=this.position,$u=this._spaces,$S=[],$Z=[],$s=$U/6,$x=-1,$j=NaN,$r=0,$M=0,$D=NaN,$E=NaN,$v=NaN,$g=NaN;if($s--,$U-=4,this.computeWorldVertices2($i,$p,2,$U,$B,0),this._debugKey)for($O=0;$O<$B.length;)$F.drawCircle($B[$O++],$B[$O++],10,"#ff0000");$S=$B,this._curves.length=$s;var $a=this._curves,$R=$S[$j=0],$Q=$S[1],$P=0,$Y=0,$c=0,$h=0,$m=0,$n=0,$I=NaN,$G=NaN,$_=NaN,$y=NaN,$N=NaN,$f=NaN,$o=NaN,$W=NaN,$L=0;for($O=0,$L=2;$O<$s;$O++,$L+=6)$P=$S[$L],$Y=$S[$L+1],$c=$S[$L+2],$h=$S[$L+3],$N=2*($I=.1875*($R-2*$P+$c))+($_=.09375*(3*($P-$c)-$R+($m=$S[$L+4]))),$f=2*($G=.1875*($Q-2*$Y+$h))+($y=.09375*(3*($Y-$h)-$Q+($n=$S[$L+5]))),$o=.75*($P-$R)+$I+.16666667*$_,$W=.75*($Y-$Q)+$G+.16666667*$y,$j+=Math.sqrt($o*$o+$W*$W),$o+=$N,$W+=$f,$N+=$_,$f+=$y,$j+=Math.sqrt($o*$o+$W*$W),$o+=$N,$W+=$f,$j+=Math.sqrt($o*$o+$W*$W),$o+=$N+$_,$W+=$f+$y,$j+=Math.sqrt($o*$o+$W*$W),$a[$O]=$j,$R=$m,$Q=$n;if($t&&($d*=$j),$q)for($O=0;$O<$J;$O++)$u[$O]*=$j;var $C=this._segments,$K=0,$V=0;for($V=$M=$r=$O=0;$O<$J;$O++,$r+=3)if(($D=$d+=$E=$u[$O])<0)this.addBeforePosition($D,$S,0,$Z,$r);else if($j<$D)this.addAfterPosition($D-$j,$S,$U-4,$Z,$r);else{for(;;$M++)if(!(($g=$a[$M])<$D)){0==$M?$D/=$g:$D=($D-($v=$a[$M-1]))/($g-$v);break}if($M!=$x){var $T=6*($x=$M);for($R=$S[$T],$Q=$S[$T+1],$P=$S[$T+2],$Y=$S[$T+3],$c=$S[$T+4],$h=$S[$T+5],$N=2*($I=.03*($R-2*$P+$c))+($_=.006*(3*($P-$c)-$R+($m=$S[$T+6]))),$f=2*($G=.03*($Q-2*$Y+$h))+($y=.006*(3*($Y-$h)-$Q+($n=$S[$T+7]))),$o=.3*($P-$R)+$I+.16666667*$_,$W=.3*($Y-$Q)+$G+.16666667*$y,$K=Math.sqrt($o*$o+$W*$W),$C[0]=$K,$T=1;$T<8;$T++)$o+=$N,$W+=$f,$N+=$_,$f+=$y,$K+=Math.sqrt($o*$o+$W*$W),$C[$T]=$K;$o+=$N,$W+=$f,$K+=Math.sqrt($o*$o+$W*$W),$C[8]=$K,$o+=$N+$_,$W+=$f+$y,$K+=Math.sqrt($o*$o+$W*$W),$C[9]=$K,$V=0}for($D*=$K;;$V++)if(!(($g=$C[$V])<$D)){0==$V?$D/=$g:$D=$V+($D-($v=$C[$V-1]))/($g-$v);break}this.addCurvePosition(.1*$D,$R,$Q,$P,$Y,$c,$h,$m,$n,$Z,$r,$A||0<$O&&0==$E)}return $Z},$i.addBeforePosition=function($i,$p,$F,$J,$A){var $t=$p[$F],$q=$p[$F+1],$B=$p[$F+2]-$t,$O=$p[$F+3]-$q,$U=Math.atan2($O,$B);$J[$A]=$t+$i*Math.cos($U),$J[$A+1]=$q+$i*Math.sin($U),$J[$A+2]=$U},$i.addAfterPosition=function($i,$p,$F,$J,$A){var $t=$p[$F+2],$q=$p[$F+3],$B=$t-$p[$F],$O=$q-$p[$F+1],$U=Math.atan2($O,$B);$J[$A]=$t+$i*Math.cos($U),$J[$A+1]=$q+$i*Math.sin($U),$J[$A+2]=$U},$i.addCurvePosition=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d,$u){0==$i&&($i=1e-4);var $S=$i*$i,$Z=$S*$i,$s=1-$i,$x=$s*$s,$j=$x*$s,$r=$s*$i,$M=3*$r,$D=$s*$M,$E=$M*$i,$v=$p*$j+$J*$D+$t*$E+$B*$Z,$g=$F*$j+$A*$D+$q*$E+$O*$Z;$U[$d]=$v,$U[$d+1]=$g,$U[$d+2]=$u?Math.atan2($g-($F*$x+$A*$r*2+$q*$S),$v-($p*$x+$J*$r*2+$t*$S)):0},$I.NONE=-1,$I.BEFORE=-2,$I.AFTER=-3,$F($I,["_tempMt",function(){return this._tempMt=new $mi}]),$I}(),$Li=function(){function $i(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return $J($i,"laya.ani.bone.PathConstraintData"),$i}(),$Ci=function(){function $i(){this.name=null,this.slotArr=[]}return $J($i,"laya.ani.bone.SkinData"),$i}(),$Ki=function(){function $i(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}$J($i,"laya.ani.bone.SkinSlotDisplayData");var $p=$i.prototype;return $p.createTexture=function($i){return this.texture||(this.texture=new $ni($i.bitmap,this.uvs),$i.bitmap.alphaTexture&&(this.texture.alphaTexture=new $ni($i.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=$i.height,this.texture.height=$i.width,this.texture.offsetX=-$i.offsetX,this.texture.offsetY=-$i.offsetY,this.texture.sourceWidth=$i.sourceHeight,this.texture.sourceHeight=$i.sourceWidth):(this.texture.width=$i.width,this.texture.height=$i.height,this.texture.offsetX=-$i.offsetX,this.texture.offsetY=-$i.offsetY,this.texture.sourceWidth=$i.sourceWidth,this.texture.sourceHeight=$i.sourceHeight),$j.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},$p.destory=function(){this.texture&&this.texture.destroy()},$i}(),$Vi=function(){function $i(){this.name=null,this.displayArr=[]}return $J($i,"laya.ani.bone.SlotData"),$i.prototype.getDisplayByName=function($i){for(var $p=0,$F=this.displayArr.length;$p<$F;$p++)if(this.displayArr[$p].attachmentName==$i)return $p;return-1},$i}(),$g=function(){function $i($i,$p){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=$x(2,0),this._data=$i,null==this._bones&&(this._bones=[]),this.target=$p[$i.targetIndex];var $F,$J=0;for($J=0,$F=$i.boneIndexs.length;$J<$F;$J++)this._bones.push($p[$i.boneIndexs[$J]]);this.rotateMix=$i.rotateMix,this.translateMix=$i.translateMix,this.scaleMix=$i.scaleMix,this.shearMix=$i.shearMix}return $J($i,"laya.ani.bone.TfConstraint"),$i.prototype.apply=function(){for(var $i,$p=this.target.resultMatrix.a,$F=this.target.resultMatrix.b,$J=this.target.resultMatrix.c,$A=this.target.resultMatrix.d,$t=0,$q=this._bones.length;$t<$q;$t++){if($i=this._bones[$t],0<this.rotateMix){var $B=$i.resultMatrix.a,$O=$i.resultMatrix.b,$U=$i.resultMatrix.c,$d=$i.resultMatrix.d,$u=Math.atan2($J,$p)-Math.atan2($U,$B)+this._data.offsetRotation*Math.PI/180;$u>Math.PI?$u-=2*Math.PI:$u<-Math.PI&&($u+=2*Math.PI),$u*=this.rotateMix;var $S=Math.cos($u),$Z=Math.sin($u);$i.resultMatrix.a=$S*$B-$Z*$U,$i.resultMatrix.b=$S*$O-$Z*$d,$i.resultMatrix.c=$Z*$B+$S*$U,$i.resultMatrix.d=$Z*$O+$S*$d}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),$i.resultMatrix.tx+=(this._temp[0]-$i.resultMatrix.tx)*this.translateMix,$i.resultMatrix.ty+=(this._temp[1]-$i.resultMatrix.ty)*this.translateMix,$i.updateChild()),0<this.scaleMix){var $s=Math.sqrt($i.resultMatrix.a*$i.resultMatrix.a+$i.resultMatrix.c*$i.resultMatrix.c),$x=Math.sqrt($p*$p+$J*$J),$j=1e-5<$s?($s+($x-$s+this._data.offsetScaleX)*this.scaleMix)/$s:0;$i.resultMatrix.a*=$j,$i.resultMatrix.c*=$j,$s=Math.sqrt($i.resultMatrix.b*$i.resultMatrix.b+$i.resultMatrix.d*$i.resultMatrix.d),$x=Math.sqrt($F*$F+$A*$A),$j=1e-5<$s?($s+($x-$s+this._data.offsetScaleY)*this.scaleMix)/$s:0,$i.resultMatrix.b*=$j,$i.resultMatrix.d*=$j}if(0<this.shearMix){$O=$i.resultMatrix.b,$d=$i.resultMatrix.d;var $r=Math.atan2($d,$O);($u=Math.atan2($A,$F)-Math.atan2($J,$p)-($r-Math.atan2($i.resultMatrix.c,$i.resultMatrix.a)))>Math.PI?$u-=2*Math.PI:$u<-Math.PI&&($u+=2*Math.PI),$u=$r+($u+this._data.offsetShearY*Math.PI/180)*this.shearMix,$j=Math.sqrt($O*$O+$d*$d),$i.resultMatrix.b=Math.cos($u)*$j,$i.resultMatrix.d=Math.sin($u)*$j}}},$i}(),$Ti=function(){function $i(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return $J($i,"laya.ani.bone.TfConstraintData"),$i}(),$ki=function(){function $i(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}$J($i,"laya.ani.bone.Transform");var $p=$i.prototype;return $p.initData=function($i){null!=$i.x&&(this.x=$i.x),null!=$i.y&&(this.y=$i.y),null!=$i.skX&&(this.skX=$i.skX),null!=$i.skY&&(this.skY=$i.skY),null!=$i.scX&&(this.scX=$i.scX),null!=$i.scY&&(this.scY=$i.scY)},$p.getMatrix=function(){var $i;return($i=this.mMatrix?this.mMatrix:this.mMatrix=new $mi).identity(),$i.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew($i,this.skewX*Math.PI/180,this.skewY*Math.PI/180),$i.rotate(this.skX*Math.PI/180),$i.translate(this.x,this.y),$i},$p.skew=function($i,$p,$F){var $J=Math.sin($F),$A=Math.cos($F),$t=Math.sin($p),$q=Math.cos($p);return $i.setTo($i.a*$q-$i.b*$J,$i.a*$t+$i.b*$A,$i.c*$q-$i.d*$J,$i.c*$t+$i.d*$A,$i.tx*$q-$i.ty*$J,$i.tx*$t+$i.ty*$A),$i},$i}(),$a=function(){function $i(){}return $J($i,"laya.ani.bone.UVTools"),$i.getRelativeUV=function($i,$p,$F){var $J=$i[0],$A=$i[2]-$i[0],$t=$i[1],$q=$i[5]-$i[1];$F||($F=[]),$F.length=$p.length;var $B,$O=0;$B=$F.length;var $U=1/$A,$d=1/$q;for($O=0;$O<$B;$O+=2)$F[$O]=($p[$O]-$J)*$U,$F[$O+1]=($p[$O+1]-$t)*$d;return $F},$i.getAbsoluteUV=function($i,$p,$F){if(0==$i[0]&&0==$i[1]&&1==$i[4]&&1==$i[5])return $F?($r.copyArray($F,$p),$F):$p;var $J=$i[0],$A=$i[2]-$i[0],$t=$i[1],$q=$i[5]-$i[1];$F||($F=[]),$F.length=$p.length;var $B,$O=0;for($B=$F.length,$O=0;$O<$B;$O+=2)$F[$O]=$p[$O]*$A+$J,$F[$O+1]=$p[$O+1]*$q+$t;return $F},$i}(),$I=function(){function $i(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return $J($i,"laya.ani.KeyFramesContent"),$i}(),$R=function(){function $d(){}return $J($d,"laya.ani.math.BezierLerp"),$d.getBezierRate=function($i,$p,$F,$J,$A){var $t=$d._getBezierParamKey($p,$F,$J,$A),$q=100*$t+$i;if($d._bezierResultCache[$q])return $d._bezierResultCache[$q];var $B,$O=$d._getBezierPoints($p,$F,$J,$A,$t),$U=0;for($B=$O.length,$U=0;$U<$B;$U+=2)if($i<=$O[$U])return $d._bezierResultCache[$q]=$O[$U+1],$O[$U+1];return $d._bezierResultCache[$q]=1},$d._getBezierParamKey=function($i,$p,$F,$J){return 100*(100*(100*(100*$i+$p)+$F)+$J)},$d._getBezierPoints=function($i,$p,$F,$J,$A){return $d._bezierPointsCache[$A]?$d._bezierPointsCache[$A]:($t=[0,0,$i,$p,$F,$J,1,1],$q=(new $B).getBezierPoints($t,100,3),$d._bezierPointsCache[$A]=$q);var $t,$q},$d._bezierResultCache={},$d._bezierPointsCache={},$d}(),$Q=function($i){function $p(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,$p.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}$J($p,"laya.ani.AnimationPlayer",$A);var $F=$p.prototype;return $Ai.imps($F,{"laya.resource.IDestroy":!0}),$F._onTempletLoadedComputeFullKeyframeIndices=function($i,$p,$F){this._templet===$F&&this._cachePlayRate===$i&&this._cacheFrameRate===$p&&this._computeFullKeyframeIndices()},$F._computeFullKeyframeIndices=function(){for(var $i=this._fullFrames=[],$p=this._templet,$F=this._cacheFrameRateInterval*this._cachePlayRate,$J=0,$A=$p.getAnimationCount();$J<$A;$J++){for(var $t=[],$q=0,$B=$p.getAnimation($J).nodes.length;$q<$B;$q++){for(var $O=$p.getAnimation($J).nodes[$q],$U=Math.floor($O.playTime/$F+.01),$d=new Uint16Array($U+1),$u=-1,$S=0,$Z=$O.keyFrame.length;$S<$Z;$S++){var $s=$O.keyFrame[$S],$x=$s.startTime,$j=$x+$s.duration+$F;do{for(var $r=Math.floor($x/$F+.5),$M=$u+1;$M<$r;$M++)$d[$M]=$S;$d[$u=$r]=$S,$x+=$F}while($x<=$j)}$t.push($d)}$i.push($t)}},$F._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},$F._calculatePlayDuration=function(){if(0!==this.state){var $i=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=$i),this._playEnd>$i&&(this._playEnd=$i),this._playDuration=this._playEnd-this._playStart}},$F._setPlayParams=function($i,$p){this._currentTime=$i,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$p+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$p},$F._setPlayParamsWhenStop=function($i,$p){this._currentTime=$i,this._currentKeyframeIndex=Math.max(Math.floor($i/$p+.01),0),this._currentFrameTime=this._currentKeyframeIndex*$p,this._currentAnimationClipIndex=-1},$F._update=function($i){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var $p=this._cacheFrameRateInterval*this._cachePlayRate,$F=0;this._startUpdateLoopCount!==$s.loopCount&&($F=$i*this.playbackRate,this._elapsedPlaybackTime+=$F);var $J=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=$J)return this._setPlayParamsWhenStop($J,$p),void this.event("stopped");if($F+=this._currentTime,0<$J)if($J<=$F)do{if($F-=$J,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($J,$p),this._stopWhenCircleFinish=!1,void this.event("stopped");$F<$J&&(this._setPlayParams($F,$p),this.event("complete"))}while($J<=$F);else this._setPlayParams($F,$p);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop($J,$p),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},$F._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},$F.play=function($i,$p,$F,$J,$A){if(void 0===$i&&($i=0),void 0===$p&&($p=1),void 0===$F&&($F=2147483647),void 0===$J&&($J=0),void 0===$A&&($A=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if($F<0||$J<0||$A<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==$A&&$A<$J)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=$p,this._overallDuration=$F,this._playStart=$J,this._playEnd=$A,this._paused=!1,this._currentAnimationClipIndex=$i,this._currentKeyframeIndex=0,this._startUpdateLoopCount=$s.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},$F.playByFrame=function($i,$p,$F,$J,$A,$t){void 0===$i&&($i=0),void 0===$p&&($p=1),void 0===$F&&($F=2147483647),void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$t&&($t=30);var $q=1e3/$t;this.play($i,$p,$F,$J*$q,$A*$q)},$F.stop=function($i){void 0===$i&&($i=!0),$i?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},$t(0,$F,"playEnd",function(){return this._playEnd}),$t(0,$F,"templet",function(){return this._templet},function($i){0===!this.state&&this.stop(!0),this._templet!==$i&&((this._templet=$i).loaded?this._computeFullKeyframeIndices():$i.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),$t(0,$F,"playStart",function(){return this._playStart}),$t(0,$F,"playDuration",function(){return this._playDuration}),$t(0,$F,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),$t(0,$F,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),$t(0,$F,"overallDuration",function(){return this._overallDuration}),$t(0,$F,"currentFrameTime",function(){return this._currentFrameTime}),$t(0,$F,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),$t(0,$F,"currentPlayTime",function(){return this._currentTime+this._playStart}),$t(0,$F,"cachePlayRate",function(){return this._cachePlayRate},function($i){this._cachePlayRate!==$i&&(this._cachePlayRate=$i,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[$i,this._cacheFrameRate])))}),$t(0,$F,"cacheFrameRate",function(){return this._cacheFrameRate},function($i){this._cacheFrameRate!==$i&&(this._cacheFrameRate=$i,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,$i])))}),$t(0,$F,"currentTime",null,function($i){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if($i<this._playStart||$i>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=$s.loopCount;var $p=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=$i,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/$p),0),this._currentFrameTime=this._currentKeyframeIndex*$p}}),$t(0,$F,"paused",function(){return this._paused},function($i){(this._paused=$i)&&this.event("paused")}),$t(0,$F,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),$t(0,$F,"destroyed",function(){return this._destroyed}),$p}(),$G=function($i){function $p(){$p.__super.call(this),$j.isConchNode&&(this.drawSkin=function($i){$i.transform||($i.transform=$mi.EMPTY),this._addCmd([$i]),this.setSkinMesh&&this.setSkinMesh($i._ps,$i.mVBData,$i.mEleNum,0,$i.mTexture,$i.transform)})}return $J($p,"laya.ani.GraphicsAni",$q),$p.prototype.drawSkin=function($i){var $p=[$i];this._saveToCmd($j._context._drawSkin,$p)},$p.create=function(){return $p._caches.pop()||new $p},$p.recycle=function($i){$i.clear(),$p._caches.push($i)},$p._caches=[],$p}(),$_=function($i){function $M(){this._aniMap={},this.unfixedLastAniIndex=-1,$M.__super.call(this),this._anis=new Array}$J($M,"laya.ani.AnimationTemplet",$d);var $p=$M.prototype;return $p.parse=function($i){var $p=new $hi($i);this._aniVersion=$p.readUTFString(),$D.parse(this,$p)},$p._calculateKeyFrame=function($i,$p,$F){var $J=$i.keyFrame;$J[$p]=$J[0];for(var $A=0;$A<$p;$A++){var $t=$J[$A];$t.nextData=0===$t.duration?$t.data:$J[$A+1].data}$J.length--},$p.onAsynLoaded=function($i,$p,$F){var $J=new $hi($p);switch(this._aniVersion=$J.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":$E.parse(this,$J);break;default:$D.parse(this,$J)}this._endLoaded()},$p.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},$p.getAnimationCount=function(){return this._anis.length},$p.getAnimation=function($i){return this._anis[$i]},$p.getAniDuration=function($i){return this._anis[$i].playTime},$p.getNodes=function($i){return this._anis[$i].nodes},$p.getNodeIndexWithName=function($i,$p){return this._anis[$i].bone3DMap[$p]},$p.getNodeCount=function($i){return this._anis[$i].nodes.length},$p.getTotalkeyframesLength=function($i){return this._anis[$i].totalKeyframeDatasLength},$p.getPublicExtData=function(){return this._publicExtData},$p.getAnimationDataWithCache=function($i,$p,$F,$J){var $A=$p[$F];if($A){var $t=$A[$i];return $t?$t[$J]:null}return null},$p.setAnimationDataWithCache=function($i,$p,$F,$J,$A){var $t=$p[$F]||($p[$F]={});($t[$i]||($t[$i]=[]))[$J]=$A},$p.getOriginalData=function($i,$p,$F,$J,$A){for(var $t=this._anis[$i].nodes,$q=0,$B=0,$O=$t.length,$U=0;$B<$O;$B++){var $d,$u=$t[$B];$d=$u.keyFrame[$F[$B][$J]],$u.dataOffset=$U;var $S=$A-$d.startTime,$Z=$u.lerpType;if($Z)switch($Z){case 0:case 1:for($q=0;$q<$u.keyframeWidth;)$q+=$u.interpolationMethod[$q]($u,$q,$p,$U+$q,$d.data,$S,null,$d.duration,$d.nextData);break;case 2:var $s=$d.interpolationData,$x=$s.length,$j=0;for($q=0;$q<$x;){var $r=$s[$q];switch($r){case 6:case 7:$q+=$M.interpolation[$r]($u,$j,$p,$U+$j,$d.data,$S,null,$d.duration,$d.nextData,$s,$q+1);break;default:$q+=$M.interpolation[$r]($u,$j,$p,$U+$j,$d.data,$S,null,$d.duration,$d.nextData)}$j++}}else for($q=0;$q<$u.keyframeWidth;)$q+=$u.interpolationMethod[$q]($u,$q,$p,$U+$q,$d.data,$S,null,$d.duration,$d.nextData);$U+=$u.keyframeWidth}},$p.getNodesCurrentFrameIndex=function($i,$p){var $F=this._anis[$i].nodes;$i!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($F.length),this.unfixedCurrentTimes=new Float32Array($F.length),this.unfixedLastAniIndex=$i);for(var $J=0,$A=$F.length;$J<$A;$J++){var $t=$F[$J];for($p<this.unfixedCurrentTimes[$J]&&(this.unfixedCurrentFrameIndexes[$J]=0),this.unfixedCurrentTimes[$J]=$p;this.unfixedCurrentFrameIndexes[$J]<$t.keyFrame.length&&!($t.keyFrame[this.unfixedCurrentFrameIndexes[$J]].startTime>this.unfixedCurrentTimes[$J]);)this.unfixedCurrentFrameIndexes[$J]++;this.unfixedCurrentFrameIndexes[$J]--}return this.unfixedCurrentFrameIndexes},$p.getOriginalDataUnfixedRate=function($i,$p,$F){var $J=this._anis[$i].nodes;$i!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array($J.length),this.unfixedCurrentTimes=new Float32Array($J.length),this.unfixedKeyframes=$x($J.length),this.unfixedLastAniIndex=$i);for(var $A=0,$t=0,$q=$J.length,$B=0;$t<$q;$t++){var $O=$J[$t];for($F<this.unfixedCurrentTimes[$t]&&(this.unfixedCurrentFrameIndexes[$t]=0),this.unfixedCurrentTimes[$t]=$F;this.unfixedCurrentFrameIndexes[$t]<$O.keyFrame.length&&!($O.keyFrame[this.unfixedCurrentFrameIndexes[$t]].startTime>this.unfixedCurrentTimes[$t]);)this.unfixedKeyframes[$t]=$O.keyFrame[this.unfixedCurrentFrameIndexes[$t]],this.unfixedCurrentFrameIndexes[$t]++;var $U=this.unfixedKeyframes[$t];$O.dataOffset=$B;var $d=$F-$U.startTime;if($O.lerpType)switch($O.lerpType){case 0:case 1:for($A=0;$A<$O.keyframeWidth;)$A+=$O.interpolationMethod[$A]($O,$A,$p,$B+$A,$U.data,$d,null,$U.duration,$U.nextData);break;case 2:var $u=$U.interpolationData,$S=$u.length,$Z=0;for($A=0;$A<$S;){var $s=$u[$A];switch($s){case 6:case 7:$A+=$M.interpolation[$s]($O,$Z,$p,$B+$Z,$U.data,$d,null,$U.duration,$U.nextData,$u,$A+1);break;default:$A+=$M.interpolation[$s]($O,$Z,$p,$B+$Z,$U.data,$d,null,$U.duration,$U.nextData)}$Z++}}else for($A=0;$A<$O.keyframeWidth;)$A+=$O.interpolationMethod[$A]($O,$A,$p,$B+$A,$U.data,$d,null,$U.duration,$U.nextData);$B+=$O.keyframeWidth}},$M._LinearInterpolation_0=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){var $d=0===$B?0:$t/$B;return $F[$J]=(1-$d)*$A[$p]+$d*$O[$p],1},$M._QuaternionInterpolation_1=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){var $d=0===$B?0:$t/$B;return $S.slerpQuaternionArray($A,$p,$O,$p,$d,$F,$J),4},$M._AngleInterpolation_2=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return 0},$M._RadiansInterpolation_3=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return 0},$M._Matrix4x4Interpolation_4=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){for(var $d=0;$d<16;$d++,$p++)$F[$J+$d]=$A[$p]+$t*$q[$p];return 16},$M._NoInterpolation_5=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U){return $F[$J]=$A[$p],1},$M._BezierInterpolation_6=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d){return void 0===$d&&($d=0),$F[$J]=$A[$p]+($O[$p]-$A[$p])*$R.getBezierRate($t/$B,$U[$d],$U[$d+1],$U[$d+2],$U[$d+3]),5},$M._BezierInterpolation_7=function($i,$p,$F,$J,$A,$t,$q,$B,$O,$U,$d){return void 0===$d&&($d=0),$F[$J]=$U[$d+4]+$U[$d+5]*$R.getBezierRate((.001*$t+$U[$d+6])/$U[$d+7],$U[$d],$U[$d+1],$U[$d+2],$U[$d+3]),9},$M.load=function($i){return $Ai.loader.create($i,null,null,$M)},$M.interpolation=[$M._LinearInterpolation_0,$M._QuaternionInterpolation_1,$M._AngleInterpolation_2,$M._RadiansInterpolation_3,$M._Matrix4x4Interpolation_4,$M._NoInterpolation_5,$M._BezierInterpolation_6,$M._BezierInterpolation_7],$M}(),$P=function($p){function $F($i,$p){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,$F.__super.call(this),void 0===$p&&($p=0),$i&&this.init($i,$p)}$J($F,"laya.ani.bone.Skeleton",$p);var $i=$F.prototype;return $i.init=function($i,$p){void 0===$p&&($p=0);var $F,$J,$A,$t=0,$q=0;if(1==$p)for(this._graphicsCache=[],$t=0,$q=$i.getAnimationCount();$t<$q;$t++)this._graphicsCache.push([]);if(this._yReverseMatrix=$i.yReverseMatrix,this._aniMode=$p,this._templet=$i,this._player=new $Q,this._player.cacheFrameRate=$i.rate,this._player.templet=$i,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=$i.mBoneArr,this._rootBone=$i.mRootBone,this._aniSectionDic=$i.aniSectionDic,0<$i.ikArr.length)for(this._ikArr=[],$t=0,$q=$i.ikArr.length;$t<$q;$t++)this._ikArr.push(new $M($i.ikArr[$t],this._boneList));if(0<$i.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),$t=0,$q=$i.pathArr.length;$t<$q;$t++)$F=$i.pathArr[$t],$J=new $v($F,this._boneList),($A=this._boneSlotDic[$F.name])&&(($J=new $v($F,this._boneList)).target=$A),this._pathDic[$F.name]=$J;if(0<$i.tfArr.length)for(this._tfArr=[],$t=0,$q=$i.tfArr.length;$t<$q;$t++)this._tfArr.push(new $g($i.tfArr[$t],this._boneList));if(0<$i.skinDataArray.length){var $B=this._templet.skinDataArray[this._skinIndex];this._skinName=$B.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},$i.load=function($i,$p,$F){},$i._onLoaded=function(){},$i._parseComplete=function(){var $i=$Y.TEMPLET_DICTIONARY[this._aniPath];$i&&(this.init($i,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},$i._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},$i._onPlay=function(){this.event("played")},$i._onStop=function(){var $i,$p=this._templet.eventAniArr[this._aniClipIndex];if($p&&this._eventIndex<$p.length)for(;this._eventIndex<$p.length;this._eventIndex++)($i=$p[this._eventIndex]).time>=this._player.playStart&&$i.time<=this._player.playEnd&&this.event("label",$i);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},$i._onPause=function(){this.event("paused")},$i._parseSrcBoneMatrix=function(){var $i=0,$p=0;for($p=this._templet.srcBoneMatrixArr.length,$i=0;$i<$p;$i++)this._boneMatrixArray.push(new $mi);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var $F,$J,$A=this._templet.boneSlotArray;for($i=0,$p=$A.length;$i<$p;$i++)$F=$A[$i],null==($J=this._bindBoneBoneSlotDic[$F.parent])&&(this._bindBoneBoneSlotDic[$F.parent]=$J=[]),this._boneSlotDic[$F.name]=$F=$F.copy(),$J.push($F),this._boneSlotArray.push($F)}},$i._emitMissedEvents=function($i,$p,$F){void 0===$F&&($F=0);var $J=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if($J){var $A,$t,$q=0;for($A=$J.length,$q=$F;$q<$A;$q++)($t=$J[$q]).time>=this._player.playStart&&$t.time<=this._player.playEnd&&this.event("label",$t)}},$i._update=function($i){if(void 0===$i&&($i=!0),!(this._pause||$i&&this._indexControl)){var $p=this.timer.currTimer,$F=this._player.currentKeyframeIndex,$J=$p-this._lastTime;if($i?this._player._update($J):$F=-1,this._lastTime=$p,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<$J&&this._clipIndex==$F&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var $A;this._lastUpdateAniClipIndex=this._aniClipIndex,$F>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var $t,$q=this._templet.eventAniArr[this._aniClipIndex];if($q&&this._eventIndex<$q.length&&(($A=$q[this._eventIndex]).time>=this._player.playStart&&$A.time<=this._player.playEnd?this._player.currentPlayTime>=$A.time&&(this.event("label",$A),this._eventIndex++):this._eventIndex++),0==this._aniMode){if($t=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$t&&(this.graphics=$t));var $B=0,$O=0;for($O=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,$O-1)&&0<$O;)$O--;if($O<this._clipIndex)for($B=$O;$B<this._clipIndex;$B++)this._createGraphics($B)}else if(1==this._aniMode){if($t=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=$t&&(this.graphics=$t));for($O=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,$O-1)&&0<$O;)$O--;if($O<this._clipIndex)for($B=$O;$B<this._clipIndex;$B++)this._createGraphics($B)}this._createGraphics()}}},$i._createGraphics=function($i){void 0===$i&&($i=-1),-1==$i&&($i=this._clipIndex);var $p,$F,$J=$i*this._player.cacheFrameRateInterval,$A=this._templet.drawOrderAniArr[this._aniClipIndex];if($A&&0<$A.length)for(this._drawOrderIndex=0,$p=$A[this._drawOrderIndex];$J>=$p.time&&(this._drawOrder=$p.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=$A.length));)$p=$A[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=$G.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=$G.create(),$F=this.graphics;var $t=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],$i,$J);var $q,$B,$O,$U,$d=this._aniSectionDic[this._aniClipIndex],$u=0,$S=0,$Z=0,$s=0,$x=0,$j=this._templet.srcBoneMatrixArr.length;for($x=$d[$S=0];$S<$j;$S++)$U=this._boneList[$S],$O=this._templet.srcBoneMatrixArr[$S],$U.resultTransform.scX=$O.scX*this._curOriginalData[$u++],$U.resultTransform.skX=$O.skX+this._curOriginalData[$u++],$U.resultTransform.skY=$O.skY+this._curOriginalData[$u++],$U.resultTransform.scY=$O.scY*this._curOriginalData[$u++],$U.resultTransform.x=$O.x+this._curOriginalData[$u++],$U.resultTransform.y=$O.y+this._curOriginalData[$u++],8===this._templet.tMatrixDataLen&&($U.resultTransform.skewX=$O.skewX+this._curOriginalData[$u++],$U.resultTransform.skewY=$O.skewY+this._curOriginalData[$u++]);var $r,$M={},$D={};for($x+=$d[1];$S<$x;$S++)$M[($r=$t[$S]).name]=this._curOriginalData[$u++],$D[$r.name]=this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++];var $E,$v,$g={},$a={};for($x+=$d[2];$S<$x;$S++)$g[($r=$t[$S]).name]=this._curOriginalData[$u++],$a[$r.name]=this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++],this._curOriginalData[$u++];if(this._pathDic)for($x+=$d[3];$S<$x;$S++){if($r=$t[$S],$E=this._pathDic[$r.name])switch(new $hi($r.extenData).getByte()){case 1:$E.position=this._curOriginalData[$u++];break;case 2:$E.spacing=this._curOriginalData[$u++];break;case 3:$E.rotateMix=this._curOriginalData[$u++],$E.translateMix=this._curOriginalData[$u++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update($mi.TEMP.identity()),this._ikArr)for($S=0,$x=this._ikArr.length;$S<$x;$S++)$v=this._ikArr[$S],$g.hasOwnProperty($v.name)&&($v.bendDirection=$g[$v.name]),$a.hasOwnProperty($v.name)&&($v.mix=$a[$v.name]),$v.apply();if(this._pathDic)for(var $R in this._pathDic)($E=this._pathDic[$R]).apply(this._boneList,$F);if(this._tfArr)for($S=0,$s=this._tfArr.length;$S<$s;$S++)this._tfArr[$S].apply();for($S=0,$s=this._boneList.length;$S<$s;$S++)if($U=this._boneList[$S],$B=this._bindBoneBoneSlotDic[$U.name],$U.resultMatrix.copyTo(this._boneMatrixArray[$S]),$B)for($Z=0,$x=$B.length;$Z<$x;$Z++)($q=$B[$Z])&&$q.setParentMatrix($U.resultMatrix);var $Q,$P,$Y,$c,$h={},$m=this._templet.deformAniArr;if($m&&0<$m.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,$S=0,$x=this._boneSlotArray.length;$S<$x;$S++)($q=this._boneSlotArray[$S]).deformData=null;var $n,$I=$m[this._aniClipIndex];for($n in $Q=$I.default,this._setDeform($Q,$h,this._boneSlotArray,$J),$I)"default"!=$n&&$n!=this._skinName&&($Q=$I[$n],this._setDeform($Q,$h,this._boneSlotArray,$J));$Q=$I[this._skinName],this._setDeform($Q,$h,this._boneSlotArray,$J)}if(this._drawOrder)for($S=0,$x=this._drawOrder.length;$S<$x;$S++)$P=$M[($q=this._boneSlotArray[this._drawOrder[$S]]).name],$Y=$D[$q.name],isNaN($Y)||($F.save(),$F.alpha($Y)),isNaN($P)||-2==$P||(this._templet.attachmentNames?$q.showDisplayByName(this._templet.attachmentNames[$P]):$q.showDisplayByIndex($P)),$h[this._drawOrder[$S]]?($c=$h[this._drawOrder[$S]],$q.currDisplayData&&$c[$q.currDisplayData.attachmentName]?$q.deformData=$c[$q.currDisplayData.attachmentName]:$q.deformData=null):$q.deformData=null,isNaN($Y)?$q.draw($F,this._boneMatrixArray,2==this._aniMode):$q.draw($F,this._boneMatrixArray,2==this._aniMode,$Y),isNaN($Y)||$F.restore();else for($S=0,$x=this._boneSlotArray.length;$S<$x;$S++)$P=$M[($q=this._boneSlotArray[$S]).name],$Y=$D[$q.name],isNaN($Y)||($F.save(),$F.alpha($Y)),isNaN($P)||-2==$P||(this._templet.attachmentNames?$q.showDisplayByName(this._templet.attachmentNames[$P]):$q.showDisplayByIndex($P)),$h[$S]?($c=$h[$S],$q.currDisplayData&&$c[$q.currDisplayData.attachmentName]?$q.deformData=$c[$q.currDisplayData.attachmentName]:$q.deformData=null):$q.deformData=null,isNaN($Y)?$q.draw($F,this._boneMatrixArray,2==this._aniMode):$q.draw($F,this._boneMatrixArray,2==this._aniMode,$Y),isNaN($Y)||$F.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,$i,$F):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,$i,$F)},$i._setDeform=function($i,$p,$F,$J){if($i){var $A,$t,$q,$B=0,$O=0,$U=0;if($i)for($B=0,$O=$i.deformSlotDataList.length;$B<$O;$B++)for($A=$i.deformSlotDataList[$B],$U=0;$U<$A.deformSlotDisplayList.length;$U++)$q=$F[($t=$A.deformSlotDisplayList[$U]).slotIndex],$t.apply($J,$q),$p[$t.slotIndex]||($p[$t.slotIndex]={}),$p[$t.slotIndex][$t.attachment]=$t.deformData}},$i.getAnimNum=function(){return this._templet.getAnimationCount()},$i.getAniNameByIndex=function($i){return this._templet.getAniNameByIndex($i)},$i.getSlotByName=function($i){return this._boneSlotDic[$i]},$i.showSkinByName=function($i,$p){void 0===$p&&($p=!0),this.showSkinByIndex(this._templet.getSkinIndexByName($i),$p)},$i.showSkinByIndex=function($i,$p){void 0===$p&&($p=!0);for(var $F=0;$F<this._boneSlotArray.length;$F++)this._boneSlotArray[$F].showSlotData(null,$p);if(this._templet.showSkinByIndex(this._boneSlotDic,$i,$p)){var $J=this._templet.skinDataArray[$i];this._skinIndex=$i,this._skinName=$J.name}this._clearCache()},$i.showSlotSkinByIndex=function($i,$p){if(0!=this._aniMode){var $F=this.getSlotByName($i);$F&&$F.showDisplayByIndex($p),this._clearCache()}},$i.showSlotSkinByName=function($i,$p){if(0!=this._aniMode){var $F=this.getSlotByName($i);$F&&$F.showDisplayByName($p),this._clearCache()}},$i.replaceSlotSkinName=function($i,$p,$F){if(0!=this._aniMode){var $J=this.getSlotByName($i);$J&&$J.replaceDisplayByName($p,$F),this._clearCache()}},$i.replaceSlotSkinByIndex=function($i,$p,$F){if(0!=this._aniMode){var $J=this.getSlotByName($i);$J&&$J.replaceDisplayByIndex($p,$F),this._clearCache()}},$i.setSlotSkin=function($i,$p){if(0!=this._aniMode){var $F=this.getSlotByName($i);$F&&$F.replaceSkin($p),this._clearCache()}},$i._clearCache=function(){if(1==this._aniMode)for(var $i=0,$p=this._graphicsCache.length;$i<$p;$i++){for(var $F=0,$J=this._graphicsCache[$i].length;$F<$J;$F++){var $A=this._graphicsCache[$i][$F];$A!=this.graphics&&$G.recycle($A)}this._graphicsCache[$i].length=0}},$i.play=function($i,$p,$F,$J,$A,$t){void 0===$F&&($F=!0),void 0===$J&&($J=0),void 0===$A&&($A=0),void 0===$t&&($t=!0),this._indexControl=!1;var $q=-1,$B=NaN;if($B=$p?2147483647:0,"string"==typeof $i)for(var $O=0,$U=this._templet.getAnimationCount();$O<$U;$O++){var $d=this._templet.getAnimation($O);if($d&&$i==$d.name){$q=$O;break}}else $q=$i;-1<$q&&$q<this.getAnimNum()&&(this._aniClipIndex=$q,($F||this._pause||this._currAniIndex!=$q)&&(this._currAniIndex=$q,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength($q)),this._drawOrder=null,this._eventIndex=0,this._player.play($q,this._player.playbackRate,$B,$J,$A),$t&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=$u.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},$i.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},$i.playbackRate=function($i){this._player&&(this._player.playbackRate=$i)},$i.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},$i.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=$u.now(),this.timer.frameLoop(1,this,this._update,null,!0))},$i._getGrahicsDataWithCache=function($i,$p){return this._graphicsCache[$i][$p]},$i._setGrahicsDataWithCache=function($i,$p,$F){this._graphicsCache[$i][$p]=$F},$i.destroy=function($i){void 0===$i&&($i=!0),$p.prototype.destroy.call(this,$i),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},$t(0,$i,"url",function(){return this._aniPath},function($i){this.load($i)}),$t(0,$i,"index",function(){return this._index},function($i){this.player&&(this._index=$i,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),$t(0,$i,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),$t(0,$i,"templet",function(){return this._templet}),$t(0,$i,"player",function(){return this._player}),$F.useSimpleMeshInCanvas=!1,$F}($ti),$Y=function($p){function $A(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,$A.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}$J($A,"laya.ani.bone.Templet",$p);var $i=$A.prototype;return $i.getLoadList=function(){return this._loadList},$i.loadAni=function($i){this._skBufferUrl=$i,$Ai.loader.load($i,$O.create(this,this.onComplete),null,"arraybuffer")},$i.onComplete=function($i){if(this._isDestroyed)this.destroy();else{var $p=$U.getRes(this._skBufferUrl);$p?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,$p)):this.event("error","load failed:"+this._skBufferUrl)}},$i.parseData=function($i,$p,$F){void 0===$F&&($F=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=$i,this._mainTexture&&$j.isWebGL&&$i.bitmap&&($i.bitmap.enableMerageInAtlas=!1),this._rate=$F,this.parse($p)},$i.buildArmature=function($i){return void 0===$i&&($i=0),new $P(this,$i)},$i.parse=function($i){$p.prototype.parse.call(this,$i),this._endLoaded(),this._aniVersion!=$A.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+$A.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},$i._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var $i=0;this._loadList=[];var $p,$F=new $hi(this.getPublicExtData()),$J=0,$A=0,$t=0,$q=$F.getInt32(),$B=$F.readUTFString(),$O=$B.split("\n");for($i=0;$i<$q;$i++)$p=this._path+$O[2*$i],$B=$O[2*$i+1],$F.getFloat32(),$F.getFloat32(),$J=$F.getFloat32(),$A=$F.getFloat32(),$t=$F.getFloat32(),isNaN($t)?0:$t,$t=$F.getFloat32(),isNaN($t)?0:$t,$t=$F.getFloat32(),isNaN($t)?$J:$t,$t=$F.getFloat32(),isNaN($t)?$A:$t,-1==this._loadList.indexOf($p)&&this._loadList.push($p);this.event("inited",this)}},$i._textureComplete=function(){for(var $i,$p,$F=0,$J=this._loadList.length;$F<$J;$F++)$p=this._loadList[$F],$i=this._textureDic[$p]=$U.getRes($p),$j.isWebGL&&$i&&$i.bitmap&&($i.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},$i._parsePublicExtData=function(){var $i=0,$p=0,$F=0,$J=0,$A=0;for($i=0,$A=this.getAnimationCount();$i<$A;$i++)this._graphicsCache.push([]);var $t;$t="Dragon"!=this._aniClassName;var $q,$B,$O=new $hi(this.getPublicExtData()),$U=0,$d=0,$u=0,$S=0,$Z=0,$s=0,$x=0,$j=0,$r=0,$M=$O.getInt32(),$D=$O.readUTFString(),$E=$D.split("\n");for($i=0;$i<$M;$i++){if($q=this._mainTexture,$B=this._path+$E[2*$i],$D=$E[2*$i+1],null==this._mainTexture&&($q=this._textureDic[$B]),!$q)return this.event("error",this),void(this.isParseFail=!0);$U=$O.getFloat32(),$d=$O.getFloat32(),$u=$O.getFloat32(),$S=$O.getFloat32(),$r=$O.getFloat32(),$Z=isNaN($r)?0:$r,$r=$O.getFloat32(),$s=isNaN($r)?0:$r,$r=$O.getFloat32(),$x=isNaN($r)?$u:$r,$r=$O.getFloat32(),$j=isNaN($r)?$S:$r,this.subTextureDic[$D]=$ni.create($q,$U,$d,$u,$S,-$Z,-$s,$x,$j),$q.alphaTexture&&(this.subTextureDic[$D].alphaTexture=$ni.create($q.alphaTexture,$U,$d,$u,$S,-$Z,-$s,$x,$j))}this._mainTexture=$q;var $v,$g,$a,$R,$Q,$P=$O.getUint16();for($i=0;$i<$P;$i++)($v=[]).push($O.getUint16()),$v.push($O.getUint16()),$v.push($O.getUint16()),$v.push($O.getUint16()),this.aniSectionDic[$i]=$v;var $Y,$c=$O.getInt16(),$h={};for($i=0;$i<$c;$i++)$g=new $Ii,0==$i?$Y=$g:$g.root=$Y,$g.d=$t?-1:1,$R=$O.readUTFString(),$Q=$O.readUTFString(),$g.length=$O.getFloat32(),1==$O.getByte()&&($g.inheritRotation=!1),1==$O.getByte()&&($g.inheritScale=!1),$g.name=$R,$Q&&(($a=$h[$Q])?$a.addChild($g):this.mRootBone=$g),$h[$R]=$g,this.mBoneArr.push($g);this.tMatrixDataLen=$O.getUint16();var $m,$n,$I=$O.getUint16(),$G=Math.floor($I/this.tMatrixDataLen),$_=this.srcBoneMatrixArr;for($i=0;$i<$G;$i++)($m=new $ki).scX=$O.getFloat32(),$m.skX=$O.getFloat32(),$m.skY=$O.getFloat32(),$m.scY=$O.getFloat32(),$m.x=$O.getFloat32(),$m.y=$O.getFloat32(),8===this.tMatrixDataLen&&($m.skewX=$O.getFloat32(),$m.skewY=$O.getFloat32()),$_.push($m),($g=this.mBoneArr[$i]).transform=$m;var $y,$N=$O.getUint16(),$f=0;for($i=0;$i<$N;$i++){for($n=new $Wi,$f=$O.getUint16(),$p=0;$p<$f;$p++)$n.boneNames.push($O.readUTFString()),$n.boneIndexs.push($O.getInt16());$n.name=$O.readUTFString(),$n.targetBoneName=$O.readUTFString(),$n.targetBoneIndex=$O.getInt16(),$n.bendDirection=$O.getFloat32(),$n.mix=$O.getFloat32(),$n.isSpine=$t,this.ikArr.push($n)}var $o,$W=$O.getUint16(),$L=0;for($i=0;$i<$W;$i++){for($y=new $Ti,$L=$O.getUint16(),$p=0;$p<$L;$p++)$y.boneIndexs.push($O.getInt16());$y.name=$O.getUTFString(),$y.targetIndex=$O.getInt16(),$y.rotateMix=$O.getFloat32(),$y.translateMix=$O.getFloat32(),$y.scaleMix=$O.getFloat32(),$y.shearMix=$O.getFloat32(),$y.offsetRotation=$O.getFloat32(),$y.offsetX=$O.getFloat32(),$y.offsetY=$O.getFloat32(),$y.offsetScaleX=$O.getFloat32(),$y.offsetScaleY=$O.getFloat32(),$y.offsetShearY=$O.getFloat32(),this.tfArr.push($y)}var $C=$O.getUint16(),$K=0;for($i=0;$i<$C;$i++){for(($o=new $Li).name=$O.readUTFString(),$K=$O.getUint16(),$p=0;$p<$K;$p++)$o.bones.push($O.getInt16());$o.target=$O.readUTFString(),$o.positionMode=$O.readUTFString(),$o.spacingMode=$O.readUTFString(),$o.rotateMode=$O.readUTFString(),$o.offsetRotation=$O.getFloat32(),$o.position=$O.getFloat32(),$o.spacing=$O.getFloat32(),$o.rotateMix=$O.getFloat32(),$o.translateMix=$O.getFloat32(),this.pathArr.push($o)}var $V,$T,$k,$w,$$,$X=0,$e=0,$b=0,$z=NaN,$l=0,$H=$O.getInt16();for($i=0;$i<$H;$i++){var $ii=$O.getUint8(),$pi={};this.deformAniArr.push($pi);for(var $Fi=0;$Fi<$ii;$Fi++)for(($V=new $_i).skinName=$O.getUTFString(),$pi[$V.skinName]=$V,$X=$O.getInt16(),$p=0;$p<$X;$p++)for($T=new $yi,$V.deformSlotDataList.push($T),$e=$O.getInt16(),$F=0;$F<$e;$F++)for($k=new $Ni,$T.deformSlotDisplayList.push($k),$k.slotIndex=$O.getInt16(),$k.attachment=$O.getUTFString(),$b=$O.getInt16(),$J=0;$J<$b;$J++)for(1==$O.getByte()?$k.tweenKeyList.push(!0):$k.tweenKeyList.push(!1),$z=$O.getFloat32(),$k.timeList.push($z),$w=[],$k.vectices.push($w),$l=$O.getInt16(),$A=0;$A<$l;$A++)$w.push($O.getFloat32())}var $Ji,$Ai,$ti=$O.getInt16(),$qi=0,$Bi=0;for($i=0;$i<$ti;$i++){for($qi=$O.getInt16(),$$=[],$p=0;$p<$qi;$p++){for(($Ji=new $fi).time=$O.getFloat32(),$Bi=$O.getInt16(),$F=0;$F<$Bi;$F++)$Ji.drawOrder.push($O.getInt16());$$.push($Ji)}this.drawOrderAniArr.push($$)}var $Oi,$Ui=$O.getInt16(),$di=0;for($i=0;$i<$Ui;$i++){for($di=$O.getInt16(),$Ai=[],$p=0;$p<$di;$p++)($Oi=new $oi).name=$O.getUTFString(),$Oi.intValue=$O.getInt32(),$Oi.floatValue=$O.getFloat32(),$Oi.stringValue=$O.getUTFString(),$Oi.time=$O.getFloat32(),$Ai.push($Oi);this.eventAniArr.push($Ai)}var $ui=$O.getInt16();if(0<$ui)for(this.attachmentNames=[],$i=0;$i<$ui;$i++)this.attachmentNames.push($O.getUTFString());var $Si,$Zi,$si=$O.getInt16();for($i=0;$i<$si;$i++)($Si=new $Gi).name=$O.readUTFString(),$Si.parent=$O.readUTFString(),$Si.attachmentName=$O.readUTFString(),$Si.srcDisplayIndex=$Si.displayIndex=$O.getInt16(),($Si.templet=this).boneSlotDic[$Si.name]=$Si,null==($Zi=this.bindBoneBoneSlotDic[$Si.parent])&&(this.bindBoneBoneSlotDic[$Si.parent]=$Zi=[]),$Zi.push($Si),this.boneSlotArray.push($Si);var $xi,$ji,$ri,$Mi=$O.readUTFString().split("\n"),$Di=0,$Ei=$O.getUint8(),$vi=0,$gi=0,$ai=0,$Ri=0,$Qi=0,$Pi=0,$Yi=0;for($i=0;$i<$Ei;$i++){for(($xi=new $Ci).name=$Mi[$Di++],$vi=$O.getUint8(),$p=0;$p<$vi;$p++){for(($ji=new $Vi).name=$Mi[$Di++],$Si=this.boneSlotDic[$ji.name],$gi=$O.getUint8(),$F=0;$F<$gi;$F++){if($ri=new $Ki,this.skinSlotDisplayDataArr.push($ri),$ri.name=$Mi[$Di++],$ri.attachmentName=$Mi[$Di++],$ri.transform=new $ki,$ri.transform.scX=$O.getFloat32(),$ri.transform.skX=$O.getFloat32(),$ri.transform.skY=$O.getFloat32(),$ri.transform.scY=$O.getFloat32(),$ri.transform.x=$O.getFloat32(),$ri.transform.y=$O.getFloat32(),$ji.displayArr.push($ri),$ri.width=$O.getFloat32(),$ri.height=$O.getFloat32(),$ri.type=$O.getUint8(),$ri.verLen=$O.getUint16(),0<($c=$O.getUint16()))for($ri.bones=[],$J=0;$J<$c;$J++){var $ci=$O.getUint16();$ri.bones.push($ci)}if(0<($ai=$O.getUint16()))for($ri.uvs=[],$J=0;$J<$ai;$J++)$ri.uvs.push($O.getFloat32());if(0<($Ri=$O.getUint16()))for($ri.weights=[],$J=0;$J<$Ri;$J++)$ri.weights.push($O.getFloat32());if(0<($Qi=$O.getUint16()))for($ri.triangles=[],$J=0;$J<$Qi;$J++)$ri.triangles.push($O.getUint16());if(0<($Pi=$O.getUint16()))for($ri.vertices=[],$J=0;$J<$Pi;$J++)$ri.vertices.push($O.getFloat32());if(0<($Yi=$O.getUint16()))for($ri.lengths=[],$J=0;$J<$Yi;$J++)$ri.lengths.push($O.getFloat32())}$xi.slotArr.push($ji)}this.skinDic[$xi.name]=$xi,this.skinDataArray.push($xi)}1==$O.getUint8()?(this.yReverseMatrix=new $mi(1,0,0,-1,0,0),$Y&&$Y.setTempMatrix(this.yReverseMatrix)):$Y&&$Y.setTempMatrix(new $mi),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},$i.getTexture=function($i){var $p=this.subTextureDic[$i];return $p||($p=this.subTextureDic[$i.substr(0,$i.length-1)]),null==$p?this._mainTexture:$p},$i.showSkinByIndex=function($i,$p,$F){if(void 0===$F&&($F=!0),$p<0&&$p>=this.skinDataArray.length)return!1;var $J,$A,$t=0,$q=0,$B=this.skinDataArray[$p];if($B){for($t=0,$q=$B.slotArr.length;$t<$q;$t++)($A=$B.slotArr[$t])&&($J=$i[$A.name])&&($J.showSlotData($A,$F),$F&&"undefined"!=$J.attachmentName&&"null"!=$J.attachmentName?$J.showDisplayByName($J.attachmentName):$J.showDisplayByIndex($J.displayIndex));return!0}return!1},$i.getSkinIndexByName=function($i){for(var $p=0,$F=this.skinDataArray.length;$p<$F;$p++)if(this.skinDataArray[$p].name==$i)return $p;return-1},$i.getGrahicsDataWithCache=function($i,$p){return this._graphicsCache[$i][$p]},$i.setGrahicsDataWithCache=function($i,$p,$F){this._graphicsCache[$i][$p]=$F},$i.destroy=function(){var $i;for(var $p in this._isDestroyed=!0,this.subTextureDic)($i=this.subTextureDic[$p])&&$i.destroy();for($p in this._textureDic)($i=this._textureDic[$p])&&$i.destroy();for(var $F=0,$J=this.skinSlotDisplayDataArr.length;$F<$J;$F++)this.skinSlotDisplayDataArr[$F].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete $A.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},$i.getAniNameByIndex=function($i){var $p=this.getAnimation($i);return $p?$p.name:null},$t(0,$i,"rate",function(){return this._rate},function($i){this._rate=$i}),$A.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",$A.TEMPLET_DICTIONARY=null,$A}($_)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function($i,$p){"use strict";for(var $F in Object.defineProperty($p,"__esModule",{value:!0}),Laya){var $J=Laya[$F];$J&&$J.__isclass&&($p[$F]=$J)}});