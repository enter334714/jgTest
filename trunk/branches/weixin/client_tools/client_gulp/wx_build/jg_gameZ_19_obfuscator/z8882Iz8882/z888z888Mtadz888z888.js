var G=wx.$G;!function(e,o){o.un,o.uns;var i=o.static,n=o.class,a=o.getset;o.__newvec;var l=laya.utils.Browser,r=(laya.events.Event,laya.events.EventDispatcher),d=laya.resource.HTMLImage,f=laya.utils.Handler,t=laya.display.Input,c=laya.net.Loader;laya.maths.Matrix;var h=laya.renders.Render,v=laya.utils.RunDriver;laya.media.Sound;var y=laya.media.SoundChannel,p=laya.media.SoundManager,x=(laya.display.Stage,laya.net.URL),m=laya.utils.Utils;n(v67al,"laya.wx.mini.MiniAdpter"),v67al.getJson=function(i){return JSON.parse(i)},v67al.init=function(i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),v67al._inited||(v67al.window=e).navigator.userAgent.indexOf("MiniGame")<0||(v67al._inited=!0,v67al.isZiYu=n,v67al.isPosMsgYu=i,v67al.EnvConfig={},v67al.isZiYu||(u.setNativeFileDir("/layaairGame"),u.existDir(u.fileNativeDir,f.create(v67al,v67al.onMkdirCallBack))),v67al.window.focus=function(){},o.getUrlPath=function(){},v67al.window.logtime=function(i){},v67al.window.alertTimeLog=function(i){},v67al.window.resetShareInfo=function(){},v67al.window.CanvasRenderingContext2D=function(){},v67al.window.CanvasRenderingContext2D.prototype=v67al.window.wx.createCanvas().getContext("2d").__proto__,v67al.window.document.body.appendChild=function(){},v67al.EnvConfig.pixelRatioInt=0,v.getPixelRatio=v67al.pixelRatio,v67al._preCreateElement=l.createElement,l.createElement=v67al.createElement,v.createShaderCondition=v67al.createShaderCondition,m.parseXMLFromString=v67al.parseXMLFromString,t._createInputElement=g._createInputElement,v67al.EnvConfig.load=c.prototype.load,c.prototype.load=_.prototype.load,v67al.isZiYu&&i&&wx.onMessage(function(i){i.isLoad&&(u.ziyuFileData[i.url]=i.data)}))},v67al.onMkdirCallBack=function(i,n){i||(u.filesListObj=JSON.parse(n.data))},v67al.pixelRatio=function(){if(!v67al.EnvConfig.pixelRatioInt)try{var i=wx.getSystemInfoSync();return v67al.EnvConfig.pixelRatioInt=i.pixelRatio,i.pixelRatio}catch(i){}return v67al.EnvConfig.pixelRatioInt},v67al.createElement=function(i){return"canvas"!=i?"textarea"==i||"input"==i?v67al.onCreateInput(i):"div"==i?((t=v67al._preCreateElement(i)).contains=function(i){return null},t.removeChild=function(i){},t):v67al._preCreateElement(i):(1==v67al.idx?v67al.isZiYu?(n=sharedCanvas).style={}:n=e.canvas:n=e.wx.createCanvas(),v67al.idx++,n);var n,t},v67al.onCreateInput=function(i){return(i=v67al._preCreateElement(i)).focus=g.wxinputFocus,i.blur=g.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(i){},i.setType=function(i){},i.setFontFace=function(i){},i.addEventListener=function(i){},i.contains=function(i){return null},i.removeChild=function(i){},i},v67al.createShaderCondition=function(i){var n=this;return function(){return n[i.replace("this.","")]}},v67al.EnvConfig=null,v67al.window=null,v67al._preCreateElement=null,v67al._inited=!1,v67al.wxRequest=null,v67al.systemInfo=null,v67al.version="0.0.1",v67al.isZiYu=!1,v67al.isPosMsgYu=!1,v67al.parseXMLFromString=function(i){var n;i=i.replace(/>\s+</g,"><");try{n=(new e.Parser.DOMParser).parseFromString(i,"text/xml")}catch(i){throw"\u9700\u8981\u5f15\u5165xml\u89e3\u6790\u5e93\u6587\u4ef6"}return n},v67al.idx=1;var s=v67al;function v67al(){}function vf7ka5(){}n(vf7ka5,"laya.wx.mini.MiniImage"),vf7ka5.prototype._loadImage=function(i){var n=!1;-1==i.indexOf("layaNativeDir/")&&(n=!0,i=x.formatURL(i)),u.getFileInfo(i)?vf7ka5.onCreateImage(i,this,!n):-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?u.downImg(i,new f(vf7ka5,vf7ka5.onDownImgCallBack,[i,this]),i):vf7ka5.onCreateImage(i,this,!0)},vf7ka5.onDownImgCallBack=function(i,n,t){t?n.onError(null):vf7ka5.onCreateImage(i,n)},vf7ka5.onCreateImage=function(n,t,i){var e;function $3e_r(){e.onload=null,e.onerror=null,delete t.imgCache[n]}function do10u(){$3e_r(),t.onLoaded(e)}function mrsbz(){$3e_r(),t.event("error","Load image failed")}i=(i=void 0!==i&&i)?n:(i=u.getFileInfo(n).md5,u.getFileNativePath(i)),null==t.imgCache&&(t.imgCache={}),"nativeimage"==t._type?((e=new l.window.Image).crossOrigin="",e.onload=do10u,e.onerror=mrsbz,e.src=i,t.imgCache[n]=e):new d.create(i,{onload:do10u,onerror:mrsbz,onCreate:function(i){e=i,t.imgCache[n]=i}})},n(va756,"laya.wx.mini.MiniInput"),va756._createInputElement=function(){t._initInput(t.area=l.createElement("textarea")),t._initInput(t.input=l.createElement("input")),t.inputContainer=l.createElement("div"),t.inputContainer.style.position="absolute",t.inputContainer.style.zIndex=1e5,l.container.appendChild(t.inputContainer),t.inputContainer.setPos=function(i,n){t.inputContainer.style.left=i+"px",t.inputContainer.style.top=n+"px"},o.stage.on("resize",null,va756._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(i){e.dispatchEvent&&e.dispatchEvent("resize")}),p._soundClass=w,p._musicClass=w},va756._onStageResize=function(){o.stage._canvasTransform.identity().scale(l.width/h.canvas.width/v.getPixelRatio(),l.height/h.canvas.height/v.getPixelRatio())},va756.wxinputFocus=function(i){var n=t.inputElement.target;n&&!n.editable||(s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:"done",success:function(i){},fail:function(i){}}),s.window.wx.onKeyboardConfirm(function(i){i=i?i.value:"",n.text=i,n.event("input"),laya.wx.mini.MiniInput.inputEnter()}),s.window.wx.onKeyboardInput(function(i){i=i?i.value:"",n.multiline||-1==i.indexOf("\n")?(n.text=i,n.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},va756.inputEnter=function(){t.inputElement.target.focus=!1},va756.wxinputblur=function(){va756.hideKeyboard()},va756.hideKeyboard=function(){s.window.wx.offKeyboardConfirm(),s.window.wx.offKeyboardInput(),s.window.wx.hideKeyboard({success:function(i){console.log("\u9690\u85cf\u952e\u76d8")},fail:function(i){console.log("\u9690\u85cf\u952e\u76d8\u51fa\u9519:"+(i?i.errMsg:""))}})};var g=va756;function va756(){}n(rzmn,"laya.wx.mini.MiniLoader"),(C=rzmn.prototype).load=function(i,n,t,e,a){void 0===t&&(t=!0),void 0===a&&(a=!1);var o=this;0===(o._url=i).indexOf("data:image")?o._type=n="image":o._type=n=n||o.getTypeFromUrl(i),o._cache=t,o._data=null;var l="ascii";-1!=i.indexOf(".fnt")?l="utf8":"arraybuffer"==n&&(l="");var r=m.getFileExtension(i);if(-1!=rzmn._fileTypeArr.indexOf(r))s.EnvConfig.load.call(this,i,n,t,e,a);else if(u.getFileInfo(i))s.EnvConfig.load.call(this,i,n,t,e,a);else{if(-1!=i.indexOf("layaNativeDir/"))return s.isZiYu?(r=u.ziyuFileData[i],void o.onLoaded(r)):(cosnole.log("read read"),void u.read(i,l,new f(rzmn,rzmn.onReadNativeCallBack,[l,i,n,t,e,a,o])));r=""==x.rootPath?i:i.split(x.rootPath)[0],-1!=i.indexOf("http://")||-1!=i.indexOf("https://")?s.EnvConfig.load.call(o,i,n,t,e,a):u.readFile(r,l,new f(rzmn,rzmn.onReadNativeCallBack,[l,i,n,t,e,a,o]),i)}},C.resMgrLoad=function(i,e,n,t,a,o,l){void 0===n&&(n=0),void 0===t&&(t=!1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===l&&(l=3),-1!=i.indexOf("mpack")&&console.log("=============resMgrLoad url:",i),s.EnvConfig.resMgrLoad(i,(i,n,t)=>{rzmn.prototype.resMgrLoadCallBack(i,n,t,e)},n,t,a,o,l)},C.resMgrLoadCallBack=function(i,n,t,e){console.log("buff:::",i,t,u.fileNativeDir+"///"+u.fileListName),e(i,n,t)},C.clearRes=function(i,n){this.clearRes(i,n=void 0!==n&&n),!(n=u.getFileInfo(i))||-1==i.indexOf("http://")&&-1==i.indexOf("https://")||(i=n.md5,n=u.getFileNativePath(i),u.remove(n))},rzmn.onReadNativeCallBack=function(i,n,t,e,a,o,l,r,u){void 0===e&&(e=!0),void 0===o&&(o=!1),(r=void 0===r?0:r)?1==r&&s.EnvConfig.load.call(l,n,t,e,a,o):(r="json"==t||"atlas"==t?s.getJson(u.data):"xml"==t?m.parseXMLFromString(u.data):u.data,l.onLoaded(r),!s.isZiYu&&s.isPosMsgYu&&"arraybuffer"!=t&&wx.postMessage({url:n,data:r,isLoad:!0}))},i(rzmn,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]);var _=rzmn;function rzmn(){}n(ithxy,"laya.wx.mini.MiniFileMgr",r),ithxy.isLoadFile=function(i){return-1!=ithxy._fileTypeArr.indexOf(i)},ithxy.getFileInfo=function(i){return i=i.split("?")[0],null==(i=ithxy.filesListObj[i])?null:i},ithxy.onFileUpdate=function(i,n){i=(i=i.split("/"))[i.length-1];var t=ithxy.getFileInfo(n);null==t?ithxy.onSaveFile(n,i):t.readyUrl!=n&&ithxy.remove(i,n)},ithxy.exits=function(i,n){i=ithxy.getFileNativePath(i),ithxy.fs.getFileInfo({filePath:i,success:function(i){null!=n&&n.runWith([0,i])},fail:function(i){null!=n&&n.runWith([1,i])}})},ithxy.read=function(i,n,t,e){void 0===n&&(n="ascill"),i=""!=(e=void 0===e?"":e)?ithxy.getFileNativePath(i):i,ithxy.fs.readFile({filePath:i,encoding:n,success:function(i){null!=t&&t.runWith([0,i])},fail:function(i){i&&""!=e?ithxy.down(e,n,t,e):null!=t&&t.runWith([1])}})},ithxy.readNativeFile=function(i,n){ithxy.fs.readFile({filePath:i,encoding:"",success:function(i){null!=n&&n.runWith([0])},fail:function(i){null!=n&&n.runWith([1])}})},ithxy.down=function(i,n,t,e){void 0===n&&(n="ascill"),void 0===e&&(e="");var a=ithxy.getFileNativePath(e);ithxy.wxdown({url:i,filePath:a,success:function(i){200===i.statusCode&&ithxy.readFile(i.filePath,n,t,e)},fail:function(i){null!=t&&t.runWith([1,i])}}).onProgressUpdate(function(i){null!=t&&t.runWith([2,i.progress])})},ithxy.readFile=function(n,i,t,e){void 0===e&&(e=""),ithxy.fs.readFile({filePath:n,encoding:i=void 0===i?"ascill":i,success:function(i){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||ithxy.onFileUpdate(n,e),null!=t&&t.runWith([0,i])},fail:function(i){i&&null!=t&&t.runWith([1,i])}})},ithxy.downImg=function(i,n,t){void 0===t&&(t=""),ithxy.wxdown({url:i,success:function(i){200===i.statusCode&&ithxy.copyFile(i.tempFilePath,t,n)},fail:function(i){null!=n&&n.runWith([1,i])}})},ithxy.copyFile=function(i,n,t){var e=i.split("/"),a=e[e.length-1];n.split("?")[0];var o=ithxy.getFileInfo(n);e=ithxy.getFileNativePath(a),ithxy.fs.copyFile({srcPath:i,destPath:e,success:function(i){o?o.readyUrl!=n&&ithxy.remove(a,n,t):(ithxy.onSaveFile(n,a),null!=t&&t.runWith([0]))},fail:function(i){null!=t&&t.runWith([1,i])}})},ithxy.getFileNativePath=function(i){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+i},ithxy.remove=function(n,t,e){void 0===t&&(t="");var i=ithxy.getFileInfo(t),a=ithxy.getFileNativePath(i.md5);o.loader.clearRes(i.readyUrl),ithxy.fs.unlink({filePath:a,success:function(i){""!=t&&ithxy.onSaveFile(t,n),null!=e&&e.runWith([0])},fail:function(i){}})},ithxy.onSaveFile=function(i,n){var t=i.split("?")[0];ithxy.filesListObj[t]={md5:n,readyUrl:i},ithxy.fs.writeFile({filePath:ithxy.fileNativeDir+"/"+ithxy.fileListName,encoding:"utf8",data:JSON.stringify(ithxy.filesListObj),success:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u6210\u529f\uff1a",i)},fail:function(i){console.log("\u5199\u5165\u6d4b\u8bd5\u6d4b\u8bd5\u5931\u8d25\uff1a",i)}})},ithxy.existDir=function(i,n){ithxy.fs.mkdir({dirPath:i,success:function(i){null!=n&&n.runWith([0,{data:JSON.stringify({})}])},fail:function(i){-1!=i.errMsg.indexOf("file already exists")?ithxy.readSync(ithxy.fileListName,"utf8",n):null!=n&&n.runWith([1,i])}})},ithxy.readSync=function(i,n,t,e){var a;void 0===n&&(n="ascill"),void 0===e&&(e=""),n=ithxy.getFileNativePath(i);try{a=ithxy.fs.readFileSync(n),null!=t&&t.runWith([0,{data:a}])}catch(i){null!=t&&t.runWith([1])}},ithxy.readCache=function(){},ithxy.writeCache=function(i){var n=readyUrl.split("?")[0];ithxy.filesListObj[n]={md5:md5Name,readyUrl:readyUrl},ithxy.fs.writeFile({filePath:ithxy.fileNativeDir+"/"+ithxy.fileListName,encoding:"utf8",data:JSON.stringify(ithxy.filesListObj),success:function(i){},fail:function(i){}})},ithxy.setNativeFileDir=function(i){ithxy.fileNativeDir=wx.env.USER_DATA_PATH+i},ithxy.filesListObj={},ithxy.fileNativeDir=null,ithxy.fileListName="layaairfiles.txt",ithxy.ziyuFileData={},i(ithxy,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]);var u=ithxy;function ithxy(){ithxy.__super.call(this)}n(k45ofd,"laya.wx.mini.MiniSound",r),(C=k45ofd.prototype).load=function(i){var n,t=this;function tnbxmz(){if(null!=k45ofd._null)t._sound.onCanplay(k45ofd._null),t._sound.onError(k45ofd._null);else try{t._sound.onCanplay(null),t._sound.onError(null),k45ofd._null=null}catch(i){console.warn("[wxmini] _clearSound:"+i),t._sound.onCanplay(nmsbzr),t._sound.onError(nmsbzr),k45ofd._null=nmsbzr}}function nmsbzr(){}i=x.formatURL(i),this.url=i,k45ofd._audioCache[i]?this.event("complete"):(this._sound.onCanplay(function(){tnbxmz(),n.loaded=!0,n.event("complete"),k45ofd._audioCache[n.url]=n}),this._sound.onError(function(i){console.error("errCode="+i.errCode+"  errMsg="+i.errMsg),tnbxmz(),n.event("error")}),this._sound.src=i,n=this)},C.play=function(i,n){void 0===i&&(i=0),void 0===n&&(n=0),(t=this.url==p._tMusic?(k45ofd._musicAudio||(k45ofd._musicAudio=k45ofd._createSound()),k45ofd._musicAudio):k45ofd._createSound()).src=this.url;var t=new F(t);return t.url=this.url,t.loops=n,t.startTime=i,t.play(),p.addChannel(t),t},C.dispose=function(){var i=k45ofd._audioCache[this.url];i&&(i.src="",delete k45ofd._audioCache[this.url])},a(0,C,"duration",function(){return this._sound.duration}),k45ofd._createSound=function(){return k45ofd._id++,s.window.wx.createInnerAudioContext()},k45ofd._musicAudio=null,k45ofd._id=0,k45ofd._audioCache={},k45ofd._null=void 0;var w=k45ofd;function k45ofd(){this._sound=null,this.url=null,this.loaded=!1,k45ofd.__super.call(this),this._sound=k45ofd._createSound()}var C;n(av765,"laya.wx.mini.MiniSoundChannel",y),(i=av765.prototype).__onEnd=function(){if(1==this.loops)return this.completeHandler&&(o.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__onNull=function(){},i.play=function(){this.isStopped=!1,p.addChannel(this),this._audio&&this._audio.play()},i.stop=function(){if(this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio){if(this._audio.stop(),null!=av765._null)this._audio.onEnded(av765._null);else try{this._audio.onEnded(null),av765._null=null}catch(i){console.warn("[wxmini] stop:"+i),this._audio.onEnded(m.bind(this.__onNull,this)),av765._null=m.bind(this.__onNull,this)}this._audio=null}},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},a(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,i,"duration",function(){return this._audio?this._audio.duration:0}),a(0,i,"volume",function(){return 1},function(i){}),av765._null=void 0;var F=av765;function av765(i){this._audio=null,this._onEnd=null,av765.__super.call(this),this._audio=i,this._onEnd=m.bind(this.__onEnd,this),i.onEnded(this._onEnd)}}(window,(document,Laya)),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,n){"use strict";for(var t in Object.defineProperty(n,"__esModule",{value:!0}),Laya){var e=Laya[t];e&&e.__isclass&&(n[t]=e)}});