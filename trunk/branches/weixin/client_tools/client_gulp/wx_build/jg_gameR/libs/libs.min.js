var Laya=window.Laya=function(rR,rS){var ro={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(rS,rQ){return 1==arguments.length?ro.__presubstr.call(this,rS):ro.__presubstr.call(this,rS,0<rQ?rQ:this.length+rQ)},__init:function(rS){rS.forEach(function(rS){rS.__init$&&rS.__init$()})},__isClass:function(rS){return rS&&(rS.__isclass||rS==Object||rS==String||rS==Array)},__newvec:function(rS,rQ){var re=[];re.length=rS;for(var rl=0;rl<rS;rl++)re[rl]=rQ;return re},__extend:function(rS,rQ){for(var re in rQ)if(rQ.hasOwnProperty(re)){var rl=Object.getOwnPropertyDescriptor(rQ,re),rM=rl.get,rd=rl.set;rM||rd?rM&&rd?Object.defineProperty(rS,re,rl):(rM&&Object.defineProperty(rS,re,rM),rd&&Object.defineProperty(rS,re,rd)):rS[re]=rQ[re]}function rT(){ro.un(this,"constructor",rS)}rT.prototype=rQ.prototype,rS.prototype=new rT,ro.un(rS.prototype,"__imps",ro.__copy({},rQ.prototype.__imps))},__copy:function(rS,rQ){if(!rQ)return null;for(var re in rS=rS||{},rQ)rS[re]=rQ[re];return rS},__package:function(rS,rQ){if(!ro.__packages[rS]){ro.__packages[rS]=!0;var re=rR,rl=rS.split(".");if(1<rl.length)for(var rM=0,rd=rl.length-1;rM<rd;rM++){var rT=re[rl[rM]];re=rT||(re[rl[rM]]={})}re[rl[rl.length-1]]||(re[rl[rl.length-1]]=rQ||{})}},__hasOwnProperty:function(rS,rQ){return rQ=rQ||this,Object.hasOwnProperty.call(rQ,rS)||function rS(rQ,re){if(Object.hasOwnProperty.call(re.prototype,rQ))return!0;var rl=re.prototype.__super;return null==rl?null:rS(rQ,rl)}(rS,rQ.__class)},__typeof:function(rS,rQ){if(!rS||!rQ)return!1;if(rQ===String)return"string"==typeof rS;if(rQ===Number)return"number"==typeof rS;if(rQ.__interface__)rQ=rQ.__interface__;else if("string"!=typeof rQ)return rS instanceof rQ;return rS.__imps&&rS.__imps[rQ]||rS.__class==rQ},__as:function(rS,rQ){return this.__typeof(rS,rQ)?rS:null},__int:function(rS){return rS?parseInt(rS):0},interface:function(rS,rQ){ro.__package(rS,{});var re=ro.__internals,rl=re[rS]=re[rS]||{self:rS};if(rQ){var rM=rQ.split(",");rl.extend=[];for(var rd=0;rd<rM.length;rd++){var rT=rM[rd];re[rT]=re[rT]||{self:rT},rl.extend.push(re[rT])}}var rU=rR,ri=rS.split(".");for(rd=0;rd<ri.length-1;rd++)rU=rU[ri[rd]];rU[ri[ri.length-1]]={__interface__:rS}},class:function(rS,rQ,re,rl){if(re&&ro.__extend(rS,re),rQ)if(ro.__package(rQ,rS),ro.__classmap[rQ]=rS,0<rQ.indexOf(".")){if(0==rQ.indexOf("laya.")){var rM=rQ.split(".");rl=rl||rM[rM.length-1],ro[rl]&&console.log("Warning!,this class["+rl+"] already exist:",ro[rl]),ro[rl]=rS}}else"Main"==rQ?rR.Main=rS:"MainWX"==rQ?rR.MainWX=rS:(ro[rQ]&&console.log("Error!,this class["+rQ+"] already exist:",ro[rQ]),ro[rQ]=rS);var rd=ro.un,rT=rS.prototype;rd(rT,"hasOwnProperty",ro.__hasOwnProperty),rd(rT,"__class",rS),rd(rT,"__super",re),rd(rT,"__className",rQ),rd(rS,"__super",re),rd(rS,"__className",rQ),rd(rS,"__isclass",!0),rd(rS,"super",function(rS){this.__super.call(rS)})},imps:function(rS,rQ){if(!rQ)return null;var rM=rS.__imps||ro.un(rS,"__imps",{});function rd(rS){var rQ,re;if((rQ=ro.__internals[rS])&&(rM[rS]=!0,re=rQ.extend))for(var rl=0;rl<re.length;rl++)rd(re[rl].self)}for(var re in rQ)rd(re)},superSet:function(rS,rQ,re,rl){var rM=rS.prototype["_$set_"+re];rM&&rM.call(rQ,rl)},superGet:function(rS,rQ,re){var rl=rS.prototype["_$get_"+re];return rl?rl.call(rQ):null},getset:function(rS,rQ,re,rl,rM){rS?(rl&&(rQ["_$GET_"+re]=rl),rM&&(rQ["_$SET_"+re]=rM)):(rl&&ro.un(rQ,"_$get_"+re,rl),rM&&ro.un(rQ,"_$set_"+re,rM)),rl&&rM?Object.defineProperty(rQ,re,{get:rl,set:rM,enumerable:!1,configurable:!0}):(rl&&Object.defineProperty(rQ,re,{get:rl,enumerable:!1,configurable:!0}),rM&&Object.defineProperty(rQ,re,{set:rM,enumerable:!1,configurable:!0}))},static:function(re,rl){for(var rM=0,rS=rl.length;rM<rS;rM+=2)if("length"==rl[rM])re.length=rl[rM+1].call(re);else{function rQ(){var rQ=rl[rM],rS=rl[rM+1];Object.defineProperty(re,rQ,{get:function(){return delete this[rQ],this[rQ]=rS.call(this)},set:function(rS){delete this[rQ],this[rQ]=rS},enumerable:!0,configurable:!0})}rQ()}},un:function(rS,rQ,re){return re||(re=rS[rQ]),ro.__propun.value=re,Object.defineProperty(rS,rQ,ro.__propun),re},uns:function(rQ,rS){rS.forEach(function(rS){ro.un(rQ,rS)})}};return rR.console=rR.console||{log:function(){}},rR.trace=rR.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),ro}(window,document);!function(rS,rQ,re){re.un,re.uns,re.static,re.class,re.getset,re.__newvec}(window,document,Laya),function(rT,rQ,rO){rO.un,rO.uns;var ri=rO.static,rj=rO.class,ro=rO.getset;rO.__newvec;rO.interface("laya.runtime.IMarket"),rO.interface("laya.filters.IFilter"),rO.interface("laya.display.ILayout"),rO.interface("laya.resource.IDispose"),rO.interface("laya.runtime.IPlatform"),rO.interface("laya.resource.IDestroy"),rO.interface("laya.runtime.IConchNode"),rO.interface("laya.filters.IFilterAction"),rO.interface("laya.runtime.ICPlatformClass"),rO.interface("laya.resource.ICreateResource"),rO.interface("laya.runtime.IConchRenderObject"),rO.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var rk=function(){function rd(){}return rj(rd,"laya.utils.RunDriver"),rd.FILTER_ACTIONS=[],rd.pixelRatio=-1,rd._charSizeTestDiv=null,rd.now=function(){return Date.now()},rd.getWindow=function(){return rT},rd.getPixelRatio=function(){if(rd.pixelRatio<0){var rS=rf.context,rQ=rS.backingStorePixelRatio||rS.webkitBackingStorePixelRatio||rS.mozBackingStorePixelRatio||rS.msBackingStorePixelRatio||rS.oBackingStorePixelRatio||rS.backingStorePixelRatio||1;(rd.pixelRatio=(rf.window.devicePixelRatio||1)/rQ)<1&&(rd.pixelRatio=1)}return rd.pixelRatio},rd.getIncludeStr=function(rS){return null},rd.createShaderCondition=function(rS){var rQ="(function() {return "+rS+";})";return rO._runScript(rQ)},rd.fontMap=[],rd.measureText=function(rS,rQ){var re=rd.hanzi.test(rS);if(re&&rd.fontMap[rQ])return rd.fontMap[rQ];var rl=rf.context;rl.font=rQ;var rM=rl.measureText(rS);return re&&(rd.fontMap[rQ]=rM),rM},rd.getWebGLContext=function(rS){},rd.beginFlush=function(){},rd.endFinish=function(){},rd.addToAtlas=null,rd.flashFlushImage=function(rS){},rd.drawToCanvas=function(rS,rQ,re,rl,rM,rd){var rT=rAS.create("2D"),rU=new r$(re,rl,rT);return rn.renders[rQ]._fun(rS,rU,rM,rd),rT},rd.createParticleTemplate2D=null,rd.createGLTextur=null,rd.createWebGLContext2D=null,rd.changeWebGLSize=function(rS,rQ){},rd.createRenderSprite=function(rS,rQ){return new rn(rS,rQ)},rd.createFilterAction=function(rS){return new rA},rd.createGraphics=function(){return new rp},rd.clear=function(rS){rm._context.ctx.clear()},rd.cancelLoadByUrl=function(rS){},rd.clearAtlas=function(rS){},rd.isAtlas=function(rS){return!1},rd.addTextureToAtlas=function(rS){},rd.getTexturePixels=function(rS,rQ,re,rl,rM){return null},rd.skinAniSprite=function(){return null},rd.update3DLoop=function(){},ri(rd,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),rd}(),rl=(ro(1,rO,"alertGlobalError",null,function(rS){var rd=0;rf.window.onerror=rS?function(rS,rQ,re,rl,rM){rd++<5&&rM&&alert(rM.stack||rM)}:null}),rO.init=function(rS,rQ,re){for(var rl=[],rM=2,rd=arguments.length;rM<rd;rM++)rl.push(arguments[rM]);if(!rO._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=rO._arrayBufferSlice),rO._isinit=!0,rf.__init__(),rP.__init__(),rp.__init__(),rO.timer=new rC,rO.scaleTimer=new rC,rO.loader=new riS,rs.__init__(),rM=0;for(var rT=rl.length;rM<rT;rM++)rl[rM].enable&&rl[rM].enable();return rJ.__init__(),rU.__init__(),ra.__init__(),ru.beginCheck(),rO._currentStage=rO.stage=new rGS,rO.stage.conchModel&&rO.stage.conchModel.setRootNode(),rO._getUrlPath(),rO.render=new rm(0,0),rO.stage.size(rS,rQ),rn.__init__(),rY.__init__(),rL.instance.__init__(rO.stage,rm.canvas),rDS.__init__(),rt.autoStopMusic=!0,rI.__init__(),rm.canvas}},rO._getUrlPath=function(){var rS=rf.window.location,rQ=rS.pathname;rQ=rQ&&":"==rQ.charAt(2)?rQ.substring(1):rQ,rb.rootPath=rb.basePath=rb.getPath("file:"==rS.protocol?rQ:rS.protocol+"//"+rS.host+rS.pathname)},rO._arrayBufferSlice=function(rS,rQ){var re=new Uint8Array(this,rS,rQ-rS),rl=new Uint8Array(re.length);return rl.set(re),rl.buffer},rO._runScript=function(rS){return rf.window[rO._evcode](rS)},rO.stage=null,rO.timer=null,rO.scaleTimer=null,rO.loader=null,rO.version="1.8.6",rO.render=null,rO._currentStage=null,rO._isinit=!1,rO.isDebug=!1,rO.MiniAdpter={init:function(){rT.navigator&&rT.navigator.userAgent&&-1<rT.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},ri(rO,["conchMarket",function(){return this.conchMarket=rT.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=rT.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function rS(){}return rj(rS,"Config"),rS.WebGLTextCacheCount=500,rS.atlasEnable=!1,rS.showCanvasMark=!1,rS.animationInterval=50,rS.isAntialias=!1,rS.isAlpha=!1,rS.premultipliedAlpha=!0,rS.isStencil=!0,rS.preserveDrawingBuffer=!1,rS}()),rR=function(){function rR(){this._events=null}rj(rR,"laya.events.EventDispatcher");var rS=rR.prototype;return rS.hasListener=function(rS){return!!(this._events&&this._events[rS])},rS.event=function(rS,rQ){if(!this._events||!this._events[rS])return!1;var re=this._events[rS];if(re.lock)re.queue||(re.queue=[]),re.queue.push(rQ);else{var rl;for(re.lock=!0,re.cursor=re.head;re.cursor;)rl=re.cursor,re.cursor=rl.next,rl.once&&rR.delNode(re,rl),null!=rQ?rl.args?rl.method.apply(rl.caller,rl.args.concat(rQ)):rQ instanceof Array?rl.method.apply(rl.caller,rQ):rl.method.call(rl.caller,rQ):rl.method.apply(rl.caller,rl.args),rl.once&&rR.recoverHandler(rl);re.lock=!1,!re.head&&this._events&&this._events[rS]==re&&delete this._events[rS],re.queue&&re.queue.length&&this.event(rS,re.queue.shift())}return!0},rS.on=function(rS,rQ,re,rl){return this._createListener(rS,rQ,re,rl,!1)},rS.once=function(rS,rQ,re,rl){return this._createListener(rS,rQ,re,rl,!0)},rS._createListener=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=!0),rd&&this.off(rS,rQ,re,rM);var rT=rR.createHandler(rQ||this,re,rl,rM);this._events||(this._events={});var rU=this._events,ri=rU[rS];return ri?ri.tail?(rT.prev=ri.tail,ri.tail.next=rT,ri.tail=rT):ri.head=ri.tail=rT:rU[rS]={head:rT,tail:rT,cursor:null,lock:!1},this},rS.off=function(rS,rQ,re,rl){if(void 0===rl&&(rl=!1),!this._events||!this._events[rS])return this;for(var rM=this._events[rS],rd=rM.head;rd;){if((!rQ||rd.caller===rQ)&&rd.method===re&&(!rl||rd.once)){rR.delNode(rM,rd),rM.cursor==rd&&(rM.cursor=rd.next),rR.recoverHandler(rd);break}rd=rd.next}return this},rS.offAll=function(rS){var rQ=this._events;if(!rQ)return this;if(rS)this._recoverHandlers(rQ[rS]),delete rQ[rS];else{for(var re in rQ)this._recoverHandlers(rQ[re]);this._events=null}return this},rS._recoverHandlers=function(rS){if(rS){for(var rQ=rS.head;rQ;){rR.delNode(rS,rQ);var re=rQ.next;rR.recoverHandler(rQ),rQ=re}rS.cursor=null}},rS.isMouseEvent=function(rS){return rR.MOUSE_EVENTS[rS]},rR.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},rR.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},rR.delNode=function(rS,rQ){rQ.prev?rQ.prev.next=rQ.next:rS.head=rQ.next,rQ.next?rQ.next.prev=rQ.prev:rS.tail=rQ.prev},rR.createHandler=function(rS,rQ,re,rl){var rM=rR._freeHandler;return rM?(rR._freeCount--,rR._freeHandler=rM.next,rM.caller=rS,rM.method=rQ,rM.args=re,rM.once=rl):rM={caller:rS,method:rQ,args:re,once:rl},rM.prev=rM.next=null,rM},rR.recoverHandler=function(rS){rS.caller=rS.method=rS.args=rS.prev=null,rS.next=rR._freeHandler,rR._freeHandler=rS,rR._freeCount++},rR._freeHandler=null,rR._freeCount=0,rR}(),rz=function(){function rM(rS,rQ,re,rl){this.once=!1,void(this._id=0)===rl&&(rl=!1),this.setTo(rS,rQ,re,rl)}rj(rM,"laya.utils.Handler");var rS=rM.prototype;return rS.setTo=function(rS,rQ,re,rl){return this._id=rM._gid++,this.caller=rS,this.method=rQ,this.args=re,this.once=rl,this},rS.run=function(){if(null==this.method)return null;var rS=this._id,rQ=this.method.apply(this.caller,this.args);return this._id===rS&&this.once&&this.recover(),rQ},rS.runWith=function(rS){if(null==this.method)return null;var rQ=this._id;if(null==rS)var re=this.method.apply(this.caller,this.args);else re=this.args||rS.unshift?this.args?this.method.apply(this.caller,this.args.concat(rS)):this.method.apply(this.caller,rS):this.method.call(this.caller,rS);return this._id===rQ&&this.once&&this.recover(),re},rS.clear=function(){return this.caller=null,this.method=null,this.args=null,this},rS.recover=function(){0<this._id&&(this._id=0,this.clear())},rM.create=function(rS,rQ,re,rl){return void 0===rl&&(rl=!0),new rM(rS,rQ,re,rl)},rM._gid=1,rM}(),rE=function(){function rS(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}rj(rS,"laya.display.BitmapFont");var rQ=rS.prototype;return rQ.loadFont=function(rS,rQ){this._path=rS,this._complete=rQ,rO.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],rz.create(this,this.onLoaded))},rQ.onLoaded=function(){this.parseFont(rUS.getRes(this._path),rUS.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},rQ.parseFont=function(rS,rQ){if(null!=rS&&null!=rQ){this._texture=rQ;var re=rS.getElementsByTagName("info");if(!re[0].getAttributeNode)return this.parseFont2(rS,rQ);this.fontSize=parseInt(re[0].getAttributeNode("size").nodeValue);var rl,rM=re[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(rM[0]),parseInt(rM[1]),parseInt(rM[2]),parseInt(rM[3])],rl=rS.getElementsByTagName("char");var rd=0;for(rd=0;rd<rl.length;rd++){var rT=rl[rd],rU=parseInt(rT.getAttributeNode("id").nodeValue),ri=parseInt(rT.getAttributeNode("xoffset").nodeValue)/1,rR=parseInt(rT.getAttributeNode("yoffset").nodeValue)/1,ro=parseInt(rT.getAttributeNode("xadvance").nodeValue)/1,rY=new rg;rY.x=parseInt(rT.getAttributeNode("x").nodeValue),rY.y=parseInt(rT.getAttributeNode("y").nodeValue),rY.width=parseInt(rT.getAttributeNode("width").nodeValue),rY.height=parseInt(rT.getAttributeNode("height").nodeValue);var rp=roS.create(rQ,rY.x,rY.y,rY.width,rY.height,ri,rR);this._maxWidth=Math.max(this._maxWidth,ro+this.letterSpacing),this._fontCharDic[rU]=rp,this._fontWidthMap[rU]=ro}}},rQ.parseFont2=function(rS,rQ){if(null!=rS&&null!=rQ){this._texture=rQ;var re=rS.getElementsByTagName("info");this.fontSize=parseInt(re[0].attributes.size.nodeValue);var rl=re[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(rl[0]),parseInt(rl[1]),parseInt(rl[2]),parseInt(rl[3])];var rM=rS.getElementsByTagName("char"),rd=0;for(rd=0;rd<rM.length;rd++){var rT=rM[rd].attributes,rU=parseInt(rT.id.nodeValue),ri=parseInt(rT.xoffset.nodeValue)/1,rR=parseInt(rT.yoffset.nodeValue)/1,ro=parseInt(rT.xadvance.nodeValue)/1,rY=new rg;rY.x=parseInt(rT.x.nodeValue),rY.y=parseInt(rT.y.nodeValue),rY.width=parseInt(rT.width.nodeValue),rY.height=parseInt(rT.height.nodeValue);var rp=roS.create(rQ,rY.x,rY.y,rY.width,rY.height,ri,rR);this._maxWidth=Math.max(this._maxWidth,ro+this.letterSpacing),this._fontCharDic[rU]=rp,this._fontWidthMap[rU]=ro}}},rQ.getCharTexture=function(rS){return this._fontCharDic[rS.charCodeAt(0)]},rQ.destroy=function(){if(this._texture){for(var rS in this._fontCharDic){var rQ=this._fontCharDic[rS];rQ&&rQ.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},rQ.setSpaceWidth=function(rS){this._spaceWidth=rS},rQ.getCharWidth=function(rS){var rQ=rS.charCodeAt(0);return this._fontWidthMap[rQ]?this._fontWidthMap[rQ]+this.letterSpacing:" "==rS?this._spaceWidth+this.letterSpacing:0},rQ.getTextWidth=function(rS){for(var rQ=0,re=0,rl=rS.length;re<rl;re++)rQ+=this.getCharWidth(rS.charAt(re));return rQ},rQ.getMaxWidth=function(){return this._maxWidth},rQ.getMaxHeight=function(){return this.fontSize},rQ.drawText=function(rS,rQ,re,rl,rM,rd){var rT,rU=this.getTextWidth(rS),ri=0;"center"===rM&&(ri=(rd-rU)/2),"right"===rM&&(ri=rd-rU);for(var rR=0,ro=0,rY=rS.length;ro<rY;ro++)(rT=this.getCharTexture(rS.charAt(ro)))&&(rQ.graphics.drawTexture(rT,re+rR+ri,rl),rR+=this.getCharWidth(rS.charAt(ro)))},rS}(),rU=function(){function re(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=re._TF_EMPTY}rj(re,"laya.display.css.Style");var rS=re.prototype;return rS.getTransform=function(){return this._tf},rS.setTransform=function(rS){this._tf="none"!==rS&&rS?rS:re._TF_EMPTY},rS.setTranslateX=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.translateX=rS},rS.setTranslateY=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.translateY=rS},rS.setScaleX=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.scaleX=rS},rS.setScale=function(rS,rQ){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.scaleX=rS,this._tf.scaleY=rQ},rS.setScaleY=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.scaleY=rS},rS.setRotate=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.rotate=rS},rS.setSkewX=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.skewX=rS},rS.setSkewY=function(rS){this._tf===re._TF_EMPTY&&(this._tf=new rM),this._tf.skewY=rS},rS.destroy=function(){this.scrollRect=null},rS.render=function(rS,rQ,re,rl){},rS.getCSSStyle=function(){return rQS.EMPTY},rS._enableLayout=function(){return!1},ro(0,rS,"scaleX",function(){return this._tf.scaleX},function(rS){this.setScaleX(rS)}),ro(0,rS,"transform",function(){return this.getTransform()},function(rS){this.setTransform(rS)}),ro(0,rS,"translateX",function(){return this._tf.translateX},function(rS){this.setTranslateX(rS)}),ro(0,rS,"translateY",function(){return this._tf.translateY},function(rS){this.setTranslateY(rS)}),ro(0,rS,"scaleY",function(){return this._tf.scaleY},function(rS){this.setScaleY(rS)}),ro(0,rS,"block",function(){return 0!=(1&this._type)}),ro(0,rS,"skewY",function(){return this._tf.skewY},function(rS){this.setSkewY(rS)}),ro(0,rS,"rotate",function(){return this._tf.rotate},function(rS){this.setRotate(rS)}),ro(0,rS,"skewX",function(){return this._tf.skewX},function(rS){this.setSkewX(rS)}),ro(0,rS,"paddingLeft",function(){return 0}),ro(0,rS,"paddingTop",function(){return 0}),ro(0,rS,"absolute",function(){return!0}),re.__init__=function(){re._TF_EMPTY=new rM,re.EMPTY=new re},re.EMPTY=null,re._TF_EMPTY=null,re}(),rJ=function(){function rQ(rS){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=rW.create(rQ.defaultColor),this.family=rQ.defaultFamily,this.stroke=rQ._STROKE,this.size=rQ.defaultSize,rS&&rS!==rQ.EMPTY&&rS.copyTo(this)}rj(rQ,"laya.display.css.Font");var rS=rQ.prototype;return rS.set=function(rS){this._text=null;for(var rQ=rS.split(" "),re=0,rl=rQ.length;re<rl;re++){var rM=rQ[re];switch(rM){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<rM.indexOf("px")&&(this.size=parseInt(rM),this.family=rQ[re+1],re++)}},rS.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},rS.copyTo=function(rS){rS._type=this._type,rS._text=this._text,rS._weight=this._weight,rS._color=this._color,rS.family=this.family,rS.stroke=this.stroke!=rQ._STROKE?this.stroke.slice():rQ._STROKE,rS.indent=this.indent,rS.size=this.size},ro(0,rS,"password",function(){return 0!=(1024&this._type)},function(rS){rS?this._type|=1024:this._type&=-1025}),ro(0,rS,"color",function(){return this._color.strColor},function(rS){this._color=rW.create(rS)}),ro(0,rS,"italic",function(){return 0!=(512&this._type)},function(rS){rS?this._type|=512:this._type&=-513}),ro(0,rS,"bold",function(){return 0!=(2048&this._type)},function(rS){rS?this._type|=2048:this._type&=-2049}),ro(0,rS,"weight",function(){return""+this._weight},function(rS){var rQ=0;switch(rS){case"normal":break;case"bold":this.bold=!0,rQ=700;break;case"bolder":rQ=800;break;case"lighter":rQ=100;break;default:rQ=parseInt(rS)}this._weight=rQ,this._text=null}),ro(0,rS,"decoration",function(){return this._decoration?this._decoration.value:null},function(rS){var rQ=rS.split(" ");switch(this._decoration||(this._decoration={}),rQ[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=rQ[0]}rQ[1]&&(this._decoration.color=rW.create(rQ)),this._decoration.value=rS}),rQ.__init__=function(){rQ.EMPTY=new rQ(null)},rQ.EMPTY=null,rQ.defaultColor="#000000",rQ.defaultSize=12,rQ.defaultFamily="Arial",rQ.defaultFont="12px Arial",rQ._STROKE=[0,"#000000"],rQ._ITALIC=512,rQ._PASSWORD=1024,rQ._BOLD=2048,rQ}(),rM=function(){function rS(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return rj(rS,"laya.display.css.TransformInfo"),rS}(),rp=function(){function rY(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,rm.isConchNode){this._nativeObj=new rT._conchGraphics,this.id=this._nativeObj.conchID}}rj(rY,"laya.display.Graphics");var rS=rY.prototype;return rS.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},rS.clear=function(rS){void 0===rS&&(rS=!1);var rQ=0,re=0;if(rS){var rl=this._one;if(this._cmds){for(re=this._cmds.length,rQ=0;rQ<re;rQ++)!(rl=this._cmds[rQ])||rl.callee!==rm._context._drawTexture&&rl.callee!==rm._context._drawTextureWithTransform||(rl[0]=null,rY._cache.push(rl));this._cmds.length=0}else rl&&(!rl||rl.callee!==rm._context._drawTexture&&rl.callee!==rm._context._drawTextureWithTransform||(rl[0]=null,rY._cache.push(rl)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(rQ=0,re=this._vectorgraphArray.length;rQ<re;rQ++)r_.getInstance().deleteShape(this._vectorgraphArray[rQ]);this._vectorgraphArray.length=0}},rS._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},rS._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new re,this._graphicBounds._graphics=this)},rS._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},rS._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},rS.getBounds=function(rS){return void 0===rS&&(rS=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(rS)},rS.getBoundPoints=function(rS){return void 0===rS&&(rS=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(rS)},rS._addCmd=function(rS){this._cmds=this._cmds||[],rS.callee=rS.shift(),this._cmds.push(rS)},rS.setFilters=function(rS){this._saveToCmd(rm._context._setFilters,rS)},rS.drawTexture=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rT&&(rT=1),!rS||rT<.01)return null;rl||(rl=rS.sourceWidth),rM||(rM=rS.sourceHeight),rT=rT<0?0:1<rT?1:rT;var rU,ri=!rm.isWebGL&&(rf.onFirefox||rf.onEdge||rf.onIE||rf.onSafari)?.5:0,rR=rl/rS.sourceWidth,ro=rM/rS.sourceHeight;return rl=rS.width*rR,rM=rS.height*ro,rS.loaded&&(rl<=0||rM<=0)?null:(rQ+=rS.offsetX*rR,re+=rS.offsetY*ro,this._sp&&(this._sp._renderType|=512),rQ-=ri,re-=ri,rl+=2*ri,rM+=2*ri,rY._cache.length?((rU=rY._cache.pop())[0]=rS,rU[1]=rQ,rU[2]=re,rU[3]=rl,rU[4]=rM,rU[5]=rd,rU[6]=rT):rU=[rS,rQ,re,rl,rM,rd,rT],rU.callee=rd||1!=rT?rm._context._drawTextureWithTransform:rm._context._drawTexture,null!=this._one||rd||1!=rT?this._saveToCmd(rU.callee,rU):(this._one=rU,this._render=this._renderOneImg),rS.loaded||rS.once("loaded",this,this._textureLoaded,[rS,rU]),this._repaint(),rU)},rS.cleanByTexture=function(rS,rQ,re,rl,rM){if(void 0===rl&&(rl=0),void 0===rM&&(rM=0),!rS)return this.clear();if(this._one&&this._render===this._renderOneImg){rl||(rl=rS.sourceWidth),rM||(rM=rS.sourceHeight);var rd=rl/rS.sourceWidth,rT=rM/rS.sourceHeight;rl=rS.width*rd,rM=rS.height*rT,rQ+=rS.offsetX*rd,re+=rS.offsetY*rT,this._one[0]=rS,this._one[1]=rQ,this._one[2]=re,this._one[3]=rl,this._one[4]=rM,this._repaint()}else this.clear(),rS&&this.drawTexture(rS,rQ,re,rl,rM)},rS.drawTextures=function(rS,rQ){rS&&this._saveToCmd(rm._context._drawTextures,[rS,rQ])},rS.fillTexture=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rd&&(rd="repeat"),rS){var rU=[rS,rQ,re,rl,rM,rd,rT||rH.EMPTY,{}];rS.loaded||rS.once("loaded",this,this._textureLoaded,[rS,rU]),this._saveToCmd(rm._context._fillTexture,rU)}},rS._textureLoaded=function(rS,rQ){rQ[3]=rQ[3]||rS.width,rQ[4]=rQ[4]||rS.height,this._repaint()},rS.fillCircle=function(rS,rQ,re,rl,rM,rd,rT){re.bitmap.enableMerageInAtlas=!1;var rU=new Float32Array(2*(rT+1)),ri=new Float32Array(2*(rT+1)),rR=new Uint16Array(3*rT),ro=2*Math.PI/rT,rY=0;rU[0]=rl,rU[1]=rM,ri[0]=rl/re.width,ri[1]=rM/re.height;for(var rp=2,rJ=0;rJ<rT;rJ++){var rL=rd*Math.cos(rY)+rl,rj=rd*Math.sin(rY)+rM;rU[rp]=rL,rU[rp+1]=rj,ri[rp]=rL/re.width,ri[rp+1]=rj/re.height,rY+=ro,rp+=2}for(rJ=rp=0;rJ<rT;rJ++)rR[rp++]=0,rR[rp++]=rJ+1,rR[rp++]=rT+1<=rJ+2?1:rJ+2;this.drawTriangles(re,rS,rQ,rU,ri,rR)},rS.drawTriangles=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){void 0===rU&&(rU=1),this._saveToCmd(rm._context.drawTriangles,[rS,rQ,re,rl,rM,rd,rT,rU,ri,rR])},rS._saveToCmd=function(rS,rQ){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=rQ,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(rQ)),rQ.callee=rS,this._repaint(),rQ},rS.clipRect=function(rS,rQ,re,rl){this._saveToCmd(rm._context._clipRect,[rS,rQ,re,rl])},rS.fillText=function(rS,rQ,re,rl,rM,rd,rT){void 0===rT&&(rT=0),this._saveToCmd(rm._context._fillText,[rS,rQ,re,rl||rJ.defaultFont,rM,rd])},rS.fillBorderText=function(rS,rQ,re,rl,rM,rd,rT,rU){this._saveToCmd(rm._context._fillBorderText,[rS,rQ,re,rl||rJ.defaultFont,rM,rd,rT,rU])},rS.strokeText=function(rS,rQ,re,rl,rM,rd,rT){this._saveToCmd(rm._context._strokeText,[rS,rQ,re,rl||rJ.defaultFont,rM,rd,rT])},rS.alpha=function(rS){rS=rS<0?0:1<rS?1:rS,this._saveToCmd(rm._context._alpha,[rS])},rS.setAlpha=function(rS){rS=rS<0?0:1<rS?1:rS,this._saveToCmd(rm._context._setAlpha,[rS])},rS.transform=function(rS,rQ,re){void 0===rQ&&(rQ=0),void 0===re&&(re=0),this._saveToCmd(rm._context._transform,[rS,rQ,re])},rS.rotate=function(rS,rQ,re){void 0===rQ&&(rQ=0),void 0===re&&(re=0),this._saveToCmd(rm._context._rotate,[rS,rQ,re])},rS.scale=function(rS,rQ,re,rl){void 0===re&&(re=0),void 0===rl&&(rl=0),this._saveToCmd(rm._context._scale,[rS,rQ,re,rl])},rS.translate=function(rS,rQ){this._saveToCmd(rm._context._translate,[rS,rQ])},rS.save=function(){this._saveToCmd(rm._context._save,[])},rS.restore=function(){this._saveToCmd(rm._context._restore,[])},rS.replaceText=function(rS){this._repaint();var rQ=this._cmds;if(rQ){for(var re=rQ.length-1;-1<re;re--)if(this._isTextCmd(rQ[re].callee))return rQ[re][0].toUpperCase?rQ[re][0]=rS:rQ[re][0].setText(rS),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=rS:this._one[0].setText(rS),!0;return!1},rS._isTextCmd=function(rS){return rS===rm._context._fillText||rS===rm._context._fillBorderText||rS===rm._context._strokeText},rS.replaceTextColor=function(rS){this._repaint();var rQ=this._cmds;if(rQ)for(var re=rQ.length-1;-1<re;re--)this._isTextCmd(rQ[re].callee)&&(rQ[re][4]=rS,rQ[re][0].toUpperCase||(rQ[re][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=rS,this._one[0].toUpperCase||(this._one[0].changed=!0))},rS.loadImage=function(rS,rQ,re,rl,rM,rd){var rT=this;void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),void 0===rM&&(rM=0);var rU=rUS.getRes(rS);function ri(rS){rS&&(rT.drawTexture(rS,rQ,re,rl,rM),null!=rd&&rd.call(rT._sp,rS))}rU?ri(rU):rO.loader.load(rS,rz.create(null,ri),null,"image")},rS._renderEmpty=function(rS,rQ,re,rl){},rS._renderAll=function(rS,rQ,re,rl){for(var rM,rd=this._cmds,rT=0,rU=rd.length;rT<rU;rT++)(rM=rd[rT]).callee.call(rQ,re,rl,rM)},rS._renderOne=function(rS,rQ,re,rl){this._one.callee.call(rQ,re,rl,this._one)},rS._renderOneImg=function(rS,rQ,re,rl){this._one.callee.call(rQ,re,rl,this._one),2305!==rS._renderType&&(rS._renderType|=1)},rS.drawLine=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=1);var rT=0;rm.isWebGL&&(rT=r_.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(rT));var rU=rd%2==0?0:.5,ri=[rS+rU,rQ+rU,re+rU,rl+rU,rM,rd,rT];this._saveToCmd(rm._context._drawLine,ri)},rS.drawLines=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=1);var rd=0;if(re&&!(re.length<4)){rm.isWebGL&&(rd=r_.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(rd));var rT=rM%2==0?0:.5,rU=[rS+rT,rQ+rT,re,rl,rM,rd];this._saveToCmd(rm._context._drawLines,rU)}},rS.drawCurves=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=1);var rd=[rS,rQ,re,rl,rM];this._saveToCmd(rm._context._drawCurves,rd)},rS.drawRect=function(rS,rQ,re,rl,rM,rd,rT){void 0===rT&&(rT=1);var rU=rd?rT/2:0,ri=rd?rT:0,rR=[rS+rU,rQ+rU,re-ri,rl-ri,rM,rd,rT];this._saveToCmd(rm._context._drawRect,rR)},rS.drawCircle=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=1);var rT=rM?rd/2:0,rU=0;rm.isWebGL&&(rU=r_.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(rU));var ri=[rS,rQ,re-rT,rl,rM,rd,rU];this._saveToCmd(rm._context._drawCircle,ri)},rS.drawPie=function(rS,rQ,re,rl,rM,rd,rT,rU){void 0===rU&&(rU=1);var ri=rT?rU/2:0,rR=rT?rU:0,ro=0;rm.isWebGL&&(ro=r_.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(ro));var rY=[rS+ri,rQ+ri,re-rR,rl,rM,rd,rT,rU,ro];rY[3]=rV.toRadian(rl),rY[4]=rV.toRadian(rM),this._saveToCmd(rm._context._drawPie,rY)},rS.drawPoly=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=1);var rT=0,rU=!1;rm.isWebGL&&(rT=r_.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(rT),rU=!(6<re.length));var ri=rM?rd%2==0?0:.5:0,rR=[rS+ri,rQ+ri,re,rl,rM,rd,rT,rU];this._saveToCmd(rm._context._drawPoly,rR)},rS.drawPath=function(rS,rQ,re,rl,rM){var rd=[rS,rQ,re,rl,rM];this._saveToCmd(rm._context._drawPath,rd)},ro(0,rS,"cmds",function(){return this._cmds},function(rS){this._sp&&(this._sp._renderType|=512),this._cmds=rS,this._render=this._renderAll,this._repaint()}),rY.__init__=function(){if(rm.isConchNode){for(var rS=laya.display.Graphics.prototype,rQ=rf.window.ConchGraphics.prototype,re=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],rl=0,rM=re.length;rl<=rM;rl++){var rd=re[rl];rS[rd]=rQ[rd]}rS._saveToCmd=null,rQ.drawImageS&&(rS.drawTextures=function(rS,rQ){if(rS&&rS.loaded&&rS.bitmap&&rS.source){var re=rS.uv,rl=rS.bitmap.width,rM=rS.bitmap.height;this.drawImageS(rS.bitmap.source,re[0]*rl,re[1]*rM,(re[2]-re[0])*rl,(re[5]-re[3])*rM,rS.offsetX,rS.offsetY,rS.width,rS.height,rQ)}}),rS.drawTexture=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rT&&(rT=1),rS)if(rS.loaded){if(rS.loaded&&rS.bitmap&&rS.source&&(rl||(rl=rS.sourceWidth),rM||(rM=rS.sourceHeight),rT=rT<0?0:1<rT?1:rT,rl=rl-rS.sourceWidth+rS.width,rM=rM-rS.sourceHeight+rS.height,!(rl<=0||rM<=0))){rQ+=rS.offsetX,re+=rS.offsetY;var rU=rS.uv,ri=rS.bitmap.width,rR=rS.bitmap.height;rU[4]<rU[0]&&rU[5]<rU[1]?this.drawImageM(rS.bitmap.source,rU[4]*ri,rU[5]*rR,(rU[0]-rU[4])*ri,(rU[1]-rU[5])*rR,rQ,re,rl,rM,rd,rT):this.drawImageM(rS.bitmap.source,rU[0]*ri,rU[1]*rR,(rU[2]-rU[0])*ri,(rU[5]-rU[3])*rR,rQ,re,rl,rM,rd,rT),this._repaint()}}else rS.once("loaded",this,function(){this.drawTexture(rS,rQ,re,rl,rM,rd)})},rS.fillTexture=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rd&&(rd="repeat"),rS&&rS.loaded){var rU,ri=rm._context.ctx,rR=rS.bitmap.width,ro=rS.bitmap.height,rY=rS.uv;rU=rS.uv!=roS.DEF_UV?ri.createPattern(rS.bitmap.source,rd,rY[0]*rR,rY[1]*ro,(rY[2]-rY[0])*rR,(rY[5]-rY[3])*ro):ri.createPattern(rS.bitmap.source,rd);var rp=0,rJ=0;rT&&(rQ+=rT.x%rS.width,re+=rT.y%rS.height,rp-=rT.x%rS.width,rJ-=rT.y%rS.height),this._fillImage(rU,rQ,re,rp,rJ,rl,rM)}}}},rY._cache=[],rY}(),re=function(){function rA(){this._cacheBoundsType=!1}rj(rA,"laya.display.GraphicsBounds");var rS=rA.prototype;return rS.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},rS.reset=function(){this._temp&&(this._temp.length=0)},rS.getBounds=function(rS){return void 0===rS&&(rS=!1),(!this._bounds||!this._temp||this._temp.length<1||rS!=this._cacheBoundsType)&&(this._bounds=rg._getWrapRec(this.getBoundPoints(rS),this._bounds)),this._cacheBoundsType=rS,this._bounds},rS.getBoundPoints=function(rS){return void 0===rS&&(rS=!1),(!this._temp||this._temp.length<1||rS!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(rS)),this._cacheBoundsType=rS,this._rstBoundPoints=rV.copyArray(this._rstBoundPoints,this._temp)},rS._getCmdPoints=function(rS){void 0===rS&&(rS=!1);var rQ,re,rl=rm._context,rM=this._graphics.cmds;if((rQ=this._temp||(this._temp=[])).length=0,rM||null==this._graphics._one||(rA._tempCmds.length=0,rA._tempCmds.push(this._graphics._one),rM=rA._tempCmds),!rM)return rQ;(re=rA._tempMatrixArrays).length=0;var rd=rA._initMatrix;rd.identity();for(var rT,rU,ri=rA._tempMatrix,rR=NaN,ro=NaN,rY=NaN,rp=NaN,rJ=NaN,rL=NaN,rj=0,rc=rM.length;rj<rc;rj++)if((rT=rM[rj]).callee)switch(rT.callee){case rl._save:case 7:re.push(rd),rd=rd.clone();break;case rl._restore:case 8:rd=re.pop();break;case rl._scale:case 5:ri.identity(),ri.translate(-rT[2],-rT[3]),ri.scale(rT[0],rT[1]),ri.translate(rT[2],rT[3]),this._switchMatrix(rd,ri);break;case rl._rotate:case 3:ri.identity(),ri.translate(-rT[1],-rT[2]),ri.rotate(rT[0]),ri.translate(rT[1],rT[2]),this._switchMatrix(rd,ri);break;case rl._translate:case 6:ri.identity(),ri.translate(rT[0],rT[1]),this._switchMatrix(rd,ri);break;case rl._transform:case 4:ri.identity(),ri.translate(-rT[1],-rT[2]),ri.concat(rT[0]),ri.translate(rT[1],rT[2]),this._switchMatrix(rd,ri);break;case 16:case 24:rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[0],rT[1],rT[2],rT[3]),rd);break;case 17:rd.copyTo(ri),ri.concat(rT[4]),rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[0],rT[1],rT[2],rT[3]),ri);break;case rl._drawTexture:rU=rT[0],rS?rT[3]&&rT[4]?rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rT[3],rT[4]),rd):(rU=rT[0],rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rU.width,rU.height),rd)):(rR=(rT[3]||rU.sourceWidth)/rU.width,ro=(rT[4]||rU.sourceHeight)/rU.height,rY=rR*rU.sourceWidth,rp=ro*rU.sourceHeight,rJ=0<rU.offsetX?rU.offsetX:0,rL=0<rU.offsetY?rU.offsetY:0,rJ*=rR,rL*=ro,rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1]-rJ,rT[2]-rL,rY,rp),rd));break;case rl._fillTexture:rT[3]&&rT[4]?rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rT[3],rT[4]),rd):(rU=rT[0],rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rU.width,rU.height),rd));break;case rl._drawTextureWithTransform:var rG;rG=rT[5]?(rd.copyTo(ri),ri.concat(rT[5]),ri):rd,rS?rT[3]&&rT[4]?rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rT[3],rT[4]),rG):(rU=rT[0],rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1],rT[2],rU.width,rU.height),rG)):(rU=rT[0],rR=(rT[3]||rU.sourceWidth)/rU.width,ro=(rT[4]||rU.sourceHeight)/rU.height,rY=rR*rU.sourceWidth,rp=ro*rU.sourceHeight,rJ=0<rU.offsetX?rU.offsetX:0,rL=0<rU.offsetY?rU.offsetY:0,rJ*=rR,rL*=ro,rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[1]-rJ,rT[2]-rL,rY,rp),rG));break;case rl._drawRect:case 13:rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[0],rT[1],rT[2],rT[3]),rd);break;case rl._drawCircle:case rl._fillCircle:case 14:rA._addPointArrToRst(rQ,rg._getBoundPointS(rT[0]-rT[2],rT[1]-rT[2],rT[2]+rT[2],rT[2]+rT[2]),rd);break;case rl._drawLine:case 20:rA._tempPoints.length=0;var rz;rz=.5*rT[5],rT[0]==rT[2]?rA._tempPoints.push(rT[0]+rz,rT[1],rT[2]+rz,rT[3],rT[0]-rz,rT[1],rT[2]-rz,rT[3]):rT[1]==rT[3]?rA._tempPoints.push(rT[0],rT[1]+rz,rT[2],rT[3]+rz,rT[0],rT[1]-rz,rT[2],rT[3]-rz):rA._tempPoints.push(rT[0],rT[1],rT[2],rT[3]),rA._addPointArrToRst(rQ,rA._tempPoints,rd);break;case rl._drawCurves:case 22:rA._addPointArrToRst(rQ,rv.I.getBezierPoints(rT[2]),rd,rT[0],rT[1]);break;case rl._drawPoly:case rl._drawLines:case 18:rA._addPointArrToRst(rQ,rT[2],rd,rT[0],rT[1]);break;case rl._drawPath:case 19:rA._addPointArrToRst(rQ,this._getPathPoints(rT[2]),rd,rT[0],rT[1]);break;case rl._drawPie:case 15:rA._addPointArrToRst(rQ,this._getPiePoints(rT[0],rT[1],rT[2],rT[3],rT[4]),rd)}return 200<rQ.length?rQ=rV.copyArray(rQ,rg._getWrapRec(rQ)._getBoundPoints()):8<rQ.length&&(rQ=rD.scanPList(rQ)),rQ},rS._switchMatrix=function(rS,rQ){rQ.concat(rS),rQ.copyTo(rS)},rS._getPiePoints=function(rS,rQ,re,rl,rM){var rd=rA._tempPoints;rA._tempPoints.length=0,rd.push(rS,rQ);var rT=(rM-rl)%(2*Math.PI)/10,rU=NaN,ri=rl;for(rU=0;rU<=10;rU++)rd.push(rS+re*Math.cos(ri),rQ+re*Math.sin(ri)),ri+=rT;return rd},rS._getPathPoints=function(rS){var rQ,re,rl=0,rM=rA._tempPoints;for(rM.length=0,rQ=rS.length,rl=0;rl<rQ;rl++)1<(re=rS[rl]).length&&(rM.push(re[1],re[2]),3<re.length&&rM.push(re[3],re[4]));return rM},rA._addPointArrToRst=function(rS,rQ,re,rl,rM){void 0===rl&&(rl=0),void 0===rM&&(rM=0);var rd,rT=0;for(rd=rQ.length,rT=0;rT<rd;rT+=2)rA._addPointToRst(rS,rQ[rT]+rl,rQ[rT+1]+rM,re)},rA._addPointToRst=function(rS,rQ,re,rl){var rM=rH.TEMP;rM.setTo(rQ||0,re||0),rl.transformPoint(rM),rS.push(rM.x,rM.y)},rA._tempPoints=[],rA._tempMatrixArrays=[],rA._tempCmds=[],ri(rA,["_tempMatrix",function(){return this._tempMatrix=new rX},"_initMatrix",function(){return this._initMatrix=new rX}]),rA}(),rd=function(){function rS(){}rj(rS,"laya.events.Event");var rQ=rS.prototype;return rQ.setTo=function(rS,rQ,re){return this.type=rS,this.currentTarget=rQ,this.target=re,this},rQ.stopPropagation=function(){this._stoped=!0},ro(0,rQ,"stageY",function(){return rO.stage.mouseY}),ro(0,rQ,"charCode",function(){return this.nativeEvent.charCode}),ro(0,rQ,"touches",function(){var rS=this.nativeEvent.touches;if(rS)for(var rQ=rO.stage,re=0,rl=rS.length;re<rl;re++){var rM=rS[re],rd=rH.TEMP;rd.setTo(rM.clientX,rM.clientY),rQ._canvasTransform.invertTransformPoint(rd),rQ.transform.invertTransformPoint(rd),rM.stageX=rd.x,rM.stageY=rd.y}return rS}),ro(0,rQ,"keyLocation",function(){return this.nativeEvent.keyLocation}),ro(0,rQ,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),ro(0,rQ,"altKey",function(){return this.nativeEvent.altKey}),ro(0,rQ,"shiftKey",function(){return this.nativeEvent.shiftKey}),ro(0,rQ,"stageX",function(){return rO.stage.mouseX}),rS.EMPTY=new rS,rS.MOUSE_DOWN="mousedown",rS.MOUSE_UP="mouseup",rS.CLICK="click",rS.RIGHT_MOUSE_DOWN="rightmousedown",rS.RIGHT_MOUSE_UP="rightmouseup",rS.RIGHT_CLICK="rightclick",rS.MOUSE_MOVE="mousemove",rS.MOUSE_OVER="mouseover",rS.MOUSE_OUT="mouseout",rS.MOUSE_WHEEL="mousewheel",rS.ROLL_OVER="mouseover",rS.ROLL_OUT="mouseout",rS.DOUBLE_CLICK="doubleclick",rS.CHANGE="change",rS.CHANGED="changed",rS.RESIZE="resize",rS.ADDED="added",rS.REMOVED="removed",rS.DISPLAY="display",rS.UNDISPLAY="undisplay",rS.ERROR="error",rS.COMPLETE="complete",rS.LOADED="loaded",rS.INITED="inited",rS.PROGRESS="progress",rS.INPUT="input",rS.RENDER="render",rS.OPEN="open",rS.MESSAGE="message",rS.CLOSE="close",rS.KEY_DOWN="keydown",rS.KEY_PRESS="keypress",rS.KEY_UP="keyup",rS.FRAME="enterframe",rS.DRAG_START="dragstart",rS.DRAG_MOVE="dragmove",rS.DRAG_END="dragend",rS.ENTER="enter",rS.SELECT="select",rS.BLUR="blur",rS.FOCUS="focus",rS.VISIBILITY_CHANGE="visibilitychange",rS.FOCUS_CHANGE="focuschange",rS.PLAYED="played",rS.PAUSED="paused",rS.STOPPED="stopped",rS.START="start",rS.END="end",rS.ENABLE_CHANGED="enablechanged",rS.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",rS.COMPONENT_ADDED="componentadded",rS.COMPONENT_REMOVED="componentremoved",rS.LAYER_CHANGED="layerchanged",rS.HIERARCHY_LOADED="hierarchyloaded",rS.RECOVERED="recovered",rS.RELEASED="released",rS.LINK="link",rS.LABEL="label",rS.FULL_SCREEN_CHANGE="fullscreenchange",rS.DEVICE_LOST="devicelost",rS.MESH_CHANGED="meshchanged",rS.MATERIAL_CHANGED="materialchanged",rS.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",rS.ANIMATION_CHANGED="animationchanged",rS.TRIGGER_ENTER="triggerenter",rS.TRIGGER_STAY="triggerstay",rS.TRIGGER_EXIT="triggerexit",rS.TRAIL_FILTER_CHANGE="trailfilterchange",rS.DOMINO_FILTER_CHANGE="dominofilterchange",rS}(),rY=(function(){function rS(){}rj(rS,"laya.events.Keyboard"),rS.NUMBER_0=48,rS.NUMBER_1=49,rS.NUMBER_2=50,rS.NUMBER_3=51,rS.NUMBER_4=52,rS.NUMBER_5=53,rS.NUMBER_6=54,rS.NUMBER_7=55,rS.NUMBER_8=56,rS.NUMBER_9=57,rS.A=65,rS.B=66,rS.C=67,rS.D=68,rS.E=69,rS.F=70,rS.G=71,rS.H=72,rS.I=73,rS.J=74,rS.K=75,rS.L=76,rS.M=77,rS.N=78,rS.O=79,rS.P=80,rS.Q=81,rS.R=82,rS.S=83,rS.T=84,rS.U=85,rS.V=86,rS.W=87,rS.X=88,rS.Y=89,rS.Z=90,rS.F1=112,rS.F2=113,rS.F3=114,rS.F4=115,rS.F5=116,rS.F6=117,rS.F7=118,rS.F8=119,rS.F9=120,rS.F10=121,rS.F11=122,rS.F12=123,rS.F13=124,rS.F14=125,rS.F15=126,rS.NUMPAD=21,rS.NUMPAD_0=96,rS.NUMPAD_1=97,rS.NUMPAD_2=98,rS.NUMPAD_3=99,rS.NUMPAD_4=100,rS.NUMPAD_5=101,rS.NUMPAD_6=102,rS.NUMPAD_7=103,rS.NUMPAD_8=104,rS.NUMPAD_9=105,rS.NUMPAD_ADD=107,rS.NUMPAD_DECIMAL=110,rS.NUMPAD_DIVIDE=111,rS.NUMPAD_ENTER=108,rS.NUMPAD_MULTIPLY=106,rS.NUMPAD_SUBTRACT=109,rS.SEMICOLON=186,rS.EQUAL=187,rS.COMMA=188,rS.MINUS=189,rS.PERIOD=190,rS.SLASH=191,rS.BACKQUOTE=192,rS.LEFTBRACKET=219,rS.BACKSLASH=220,rS.RIGHTBRACKET=221,rS.QUOTE=222,rS.ALTERNATE=18,rS.BACKSPACE=8,rS.CAPS_LOCK=20,rS.COMMAND=15,rS.CONTROL=17,rS.DELETE=46,rS.ENTER=13,rS.ESCAPE=27,rS.PAGE_UP=33,rS.PAGE_DOWN=34,rS.END=35,rS.HOME=36,rS.LEFT=37,rS.UP=38,rS.RIGHT=39,rS.DOWN=40,rS.SHIFT=16,rS.SPACE=32,rS.TAB=9,rS.INSERT=45}(),function(){function rM(){}return rj(rM,"laya.events.KeyBoardManager"),rM.__init__=function(){rM._addEvent("keydown"),rM._addEvent("keypress"),rM._addEvent("keyup")},rM._addEvent=function(rQ){rf.document.addEventListener(rQ,function(rS){laya.events.KeyBoardManager._dispatch(rS,rQ)},!0)},rM._dispatch=function(rS,rQ){if(rM.enabled){rM._event._stoped=!1,rM._event.nativeEvent=rS,rM._event.keyCode=rS.keyCode||rS.which||rS.charCode,"keydown"===rQ?rM._pressKeys[rM._event.keyCode]=!0:"keyup"===rQ&&(rM._pressKeys[rM._event.keyCode]=null);for(var re=rO.stage.focus&&null!=rO.stage.focus.event&&rO.stage.focus.displayedInStage?rO.stage.focus:rO.stage,rl=re;rl;)rl.event(rQ,rM._event.setTo(rQ,rl,re)),rl=rl.parent}},rM.hasKeyDown=function(rS){return rM._pressKeys[rS]},rM._pressKeys={},rM.enabled=!0,ri(rM,["_event",function(){return this._event=new rd}]),rM}()),rL=(function(){function rS(){}rj(rS,"laya.events.KeyLocation"),rS.STANDARD=0,rS.LEFT=1,rS.RIGHT=2,rS.NUM_PAD=3}(),function(){function ro(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=rf.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new rd,this._matrix=new rX,this._point=new rH,this._rect=new rg,this._prePoint=new rH,this._curTouchID=NaN}rj(ro,"laya.events.MouseManager");var rS=ro.prototype;return rS.__init__=function(rS,rQ){var re=this;this._stage=rS;var rl=this,rM=this._eventList;rQ.oncontextmenu=function(rS){if(ro.enabled)return!1},rQ.addEventListener("mousedown",function(rS){ro.enabled&&(rf.onIE||rS.preventDefault(),rM.push(rS),rl.mouseDownTime=rf.now())}),rQ.addEventListener("mouseup",function(rS){ro.enabled&&(rS.preventDefault(),rM.push(rS),rl.mouseDownTime=-rf.now())},!0),rQ.addEventListener("mousemove",function(rS){if(ro.enabled){rS.preventDefault();var rQ=rf.now();if(rQ-rl._lastMoveTimer<10)return;rl._lastMoveTimer=rQ,rM.push(rS)}},!0),rQ.addEventListener("mouseout",function(rS){ro.enabled&&rM.push(rS)}),rQ.addEventListener("mouseover",function(rS){ro.enabled&&rM.push(rS)}),rQ.addEventListener("touchstart",function(rS){ro.enabled&&(rM.push(rS),ro._isFirstTouch||rDS.isInputting||rS.preventDefault(),rl.mouseDownTime=rf.now())}),rQ.addEventListener("touchend",function(rS){ro.enabled?(ro._isFirstTouch||rDS.isInputting||rS.preventDefault(),ro._isFirstTouch=!1,rM.push(rS),rl.mouseDownTime=-rf.now()):re._curTouchID=NaN},!0),rQ.addEventListener("touchmove",function(rS){ro.enabled&&(rS.preventDefault(),rM.push(rS))},!0),rQ.addEventListener("touchcancel",function(rS){ro.enabled?(rS.preventDefault(),rM.push(rS)):re._curTouchID=NaN},!0),rQ.addEventListener("mousewheel",function(rS){ro.enabled&&rM.push(rS)}),rQ.addEventListener("DOMMouseScroll",function(rS){ro.enabled&&rM.push(rS)})},rS.initEvent=function(rS,rQ){var re;this._event._stoped=!1,this._event.nativeEvent=rQ||rS,this._target=null,this._point.setTo(rS.pageX||rS.clientX,rS.pageY||rS.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=rS.identifier||0,this._tTouchID=this._event.touchId,(re=rc.I._event)._stoped=!1,re.nativeEvent=this._event.nativeEvent,re.touchId=this._event.touchId},rS.checkMouseWheel=function(rS){this._event.delta=rS.wheelDelta?.025*rS.wheelDelta:-rS.detail;for(var rQ=rc.I.getLastOvers(),re=0,rl=rQ.length;re<rl;re++){var rM=rQ[re];rM.event("mousewheel",this._event.setTo("mousewheel",rM,this._target))}},rS.onMouseMove=function(rS){rc.I.onMouseMove(rS,this._tTouchID)},rS.onMouseDown=function(rS){if(rDS.isInputting&&rO.stage.focus&&rO.stage.focus.focus&&!rO.stage.focus.contains(this._target)){var rQ=rO.stage.focus._tf||rO.stage.focus,re=rS._tf||rS;re instanceof laya.display.Input&&re.multiline==rQ.multiline?rQ._focusOut():rQ.focus=!1}rc.I.onMouseDown(rS,this._tTouchID,this._isLeftMouse)},rS.onMouseUp=function(rS){rc.I.onMouseUp(rS,this._tTouchID,this._isLeftMouse)},rS.check=function(rS,rQ,re,rl){this._point.setTo(rQ,re),rS.fromParentPoint(this._point),rQ=this._point.x,re=this._point.y;var rM=rS.scrollRect;if(rM&&(this._rect.setTo(rM.x,rM.y,rM.width,rM.height),!this._rect.contains(rQ,re)))return!1;if(!this.disableMouseEvent){if(rS.hitTestPrior&&!rS.mouseThrough&&!this.hitTest(rS,rQ,re))return!1;for(var rd=rS._childs.length-1;-1<rd;rd--){var rT=rS._childs[rd];if(!rT.destroyed&&rT.mouseEnabled&&rT.visible&&this.check(rT,rQ,re,rl))return!0}}var rU=!(!rS.hitTestPrior||rS.mouseThrough||this.disableMouseEvent)||this.hitTest(rS,rQ,re);return rU?(this._target=rS,rl.call(this,rS)):rl===this.onMouseUp&&rS===this._stage&&(this._target=this._stage,rl.call(this,this._target)),rU},rS.hitTest=function(rS,rQ,re){var rl=!1;if(rS.scrollRect&&(rQ-=rS.scrollRect.x,re-=rS.scrollRect.y),rS.hitArea instanceof laya.utils.HitArea)return rS.hitArea.isHit(rQ,re);if(0<rS.width&&0<rS.height||rS.mouseThrough||rS.hitArea)if(rS.mouseThrough)rl=rS.getGraphicBounds().contains(rQ,re);else{var rM=this._rect;rS.hitArea?rM=rS.hitArea:rM.setTo(0,0,rS.width,rS.height),rl=rM.contains(rQ,re)}return rl},rS.runEvent=function(){var rS=this._eventList.length;if(rS){var rQ=this;rQ.mouseEventTime=rf.now();var re,rl=0,rM=0,rd=0;try{for(;rl<rS;){var rT=this._eventList[rl];switch("mousemove"!==rT.type&&(this._prePoint.x=this._prePoint.y=-1e6),rT.type){case"mousedown":this._touchIDs[0]=this._id++,ro._isTouchRespond?ro._isTouchRespond=!1:(rQ._isLeftMouse=0===rT.button,rQ.initEvent(rT),rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseDown));break;case"mouseup":rQ._isLeftMouse=0===rT.button,rQ.initEvent(rT),rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-rT.clientX)+Math.abs(this._prePoint.y-rT.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=rT.clientX,this._prePoint.y=rT.clientY,rQ.initEvent(rT),rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseMove));break;case"touchstart":ro._isTouchRespond=!0,rQ._isLeftMouse=!0;var rU=rT.changedTouches;for(rM=0,rd=rU.length;rM<rd;rM++)re=rU[rM],(ro.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=re.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[re.identifier]=this._id++,rQ.initEvent(re,rT),rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseDown));break;case"touchend":case"touchcancel":ro._isTouchRespond=!0,rQ._isLeftMouse=!0;var ri=rT.changedTouches;for(rM=0,rd=ri.length;rM<rd;rM++)if(re=ri[rM],ro.multiTouchEnabled||re.identifier==this._curTouchID){this._curTouchID=NaN,rQ.initEvent(re,rT);rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseUp)||rQ.onMouseUp(null)}break;case"touchmove":var rR=rT.changedTouches;for(rM=0,rd=rR.length;rM<rd;rM++)re=rR[rM],(ro.multiTouchEnabled||re.identifier==this._curTouchID)&&(rQ.initEvent(re,rT),rQ.check(rQ._stage,rQ.mouseX,rQ.mouseY,rQ.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":rQ.checkMouseWheel(rT);break;case"mouseout":rc.I.stageMouseOut();break;case"mouseover":rQ._stage.event("mouseover",rQ._event.setTo("mouseover",rQ._stage,rQ._stage))}rl++}}catch(rS){throw this._eventList.length=0,rS}this._eventList.length=0}},ro.enabled=!0,ro.multiTouchEnabled=!0,ro._isTouchRespond=!1,ro._isFirstTouch=!0,ri(ro,["instance",function(){return this.instance=new ro}]),ro}()),rc=function(){function rL(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new rd}rj(rL,"laya.events.TouchManager");var rS=rL.prototype;return rS._clearTempArrs=function(){rL._oldArr.length=0,rL._newArr.length=0,rL._tEleArr.length=0},rS.getTouchFromArr=function(rS,rQ){var re,rl,rM=0;for(re=rQ.length,rM=0;rM<re;rM++)if((rl=rQ[rM]).id==rS)return rl;return null},rS.removeTouchFromArr=function(rS,rQ){var re=0;for(re=rQ.length-1;0<=re;re--)rQ[re].id==rS&&rQ.splice(re,1)},rS.createTouchO=function(rS,rQ){var re;return(re=rZ.getItem("TouchData")||{}).id=rQ,re.tar=rS,re},rS.onMouseDown=function(rS,rQ,re){var rl,rM,rd,rT;(void 0===re&&(re=!1),this.enable)&&(rl=this.getTouchFromArr(rQ,this.preOvers),rd=this.getEles(rS,null,rL._tEleArr),rl?rl.tar=rS:(rM=this.createTouchO(rS,rQ),this.preOvers.push(rM)),rf.onMobile&&this.sendEvents(rd,"mouseover",rQ),rT=re?this.preDowns:this.preRightDowns,(rl=this.getTouchFromArr(rQ,rT))?rl.tar=rS:(rM=this.createTouchO(rS,rQ),rT.push(rM)),this.sendEvents(rd,re?"mousedown":"rightmousedown",rQ),this._clearTempArrs())},rS.sendEvents=function(rS,rQ,re){void 0===re&&(re=0);var rl,rM,rd,rT=0;for(rl=rS.length,this._event._stoped=!1,rM=rS[0],rT=0;rT<rl;rT++){if((rd=rS[rT]).destroyed)return;if(rd.event(rQ,this._event.setTo(rQ,rd,rM)),this._event._stoped)break}},rS.getEles=function(rS,rQ,re){for(re?re.length=0:re=[];rS&&rS!=rQ;)re.push(rS),rS=rS.parent;return re},rS.checkMouseOutAndOverOfMove=function(rS,rQ,re){if(void 0===re&&(re=0),rQ!=rS){var rl,rM,rd=0,rT=0;if(rQ.contains(rS))rM=this.getEles(rS,rQ,rL._tEleArr),this.sendEvents(rM,"mouseover",re);else if(rS.contains(rQ))rM=this.getEles(rQ,rS,rL._tEleArr),this.sendEvents(rM,"mouseout",re);else{var rU,ri;(rM=rL._tEleArr).length=0,rU=this.getEles(rQ,null,rL._oldArr),ri=this.getEles(rS,null,rL._newArr),rT=rU.length;var rR=0;for(rd=0;rd<rT;rd++){if(rl=rU[rd],0<=(rR=ri.indexOf(rl))){ri.splice(rR,ri.length-rR);break}rM.push(rl)}0<rM.length&&this.sendEvents(rM,"mouseout",re),0<ri.length&&this.sendEvents(ri,"mouseover",re)}}},rS.onMouseMove=function(rS,rQ){var re,rl;this.enable&&((re=this.getTouchFromArr(rQ,this.preOvers))?(this.checkMouseOutAndOverOfMove(rS,re.tar),re.tar=rS,rl=this.getEles(rS,null,rL._tEleArr)):(rl=this.getEles(rS,null,rL._tEleArr),this.sendEvents(rl,"mouseover",rQ),this.preOvers.push(this.createTouchO(rS,rQ))),this.sendEvents(rl,"mousemove",rQ),this._clearTempArrs())},rS.getLastOvers=function(){return(rL._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,rL._tEleArr):(rL._tEleArr.push(rO.stage),rL._tEleArr)},rS.stageMouseOut=function(){var rS;rS=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(rS,"mouseout",0)},rS.onMouseUp=function(rS,rQ,re){if(void 0===re&&(re=!1),this.enable){var rl,rM,rd,rT,rU,ri,rR=0,ro=0,rY=rf.onMobile;if(rM=this.getEles(rS,null,rL._tEleArr),this.sendEvents(rM,re?"mouseup":"rightmouseup",rQ),ri=re?this.preDowns:this.preRightDowns,rl=this.getTouchFromArr(rQ,ri)){var rp,rJ=rf.now();if(rp=rJ-this._lastClickTime<300,this._lastClickTime=rJ,rS==rl.tar)rU=rM;else for(rd=this.getEles(rl.tar,null,rL._oldArr),(rU=rL._newArr).length=0,ro=rd.length,rR=0;rR<ro;rR++)rT=rd[rR],0<=rM.indexOf(rT)&&rU.push(rT);0<rU.length&&this.sendEvents(rU,re?"click":"rightclick",rQ),re&&rp&&this.sendEvents(rU,"doubleclick",rQ),this.removeTouchFromArr(rQ,ri),rl.tar=null,rZ.recover("TouchData",rl)}else;(rl=this.getTouchFromArr(rQ,this.preOvers))&&rY&&((rU=this.getEles(rl.tar,null,rU))&&0<rU.length&&this.sendEvents(rU,"mouseout",rQ),this.removeTouchFromArr(rQ,this.preOvers),rl.tar=null,rZ.recover("TouchData",rl)),this._clearTempArrs()}},rL._oldArr=[],rL._newArr=[],rL._tEleArr=[],ri(rL,["I",function(){return this.I=new rL}]),rL}(),rG=function(){function rS(){this._action=null}rj(rS,"laya.filters.Filter");var rQ=rS.prototype;return rO.imps(rQ,{"laya.filters.IFilter":!0}),rQ.callNative=function(rS){},ro(0,rQ,"type",function(){return-1}),ro(0,rQ,"action",function(){return this._action}),rS.BLUR=16,rS.COLOR=32,rS.GLOW=8,rS._filterStart=null,rS._filterEnd=null,rS._EndTarget=null,rS._recycleScope=null,rS._filter=null,rS._useSrc=null,rS._endSrc=null,rS._useOut=null,rS._endOut=null,rS}(),rA=function(){function rS(){this.data=null}rj(rS,"laya.filters.ColorFilterAction");var rQ=rS.prototype;return rO.imps(rQ,{"laya.filters.IFilterAction":!0}),rQ.apply=function(rS){var rQ=rS.ctx.ctx,re=rS.ctx.ctx.canvas;if(0==re.width||0==re.height)return re;for(var rl,rM=rQ.getImageData(0,0,re.width,re.height),rd=rM.data,rT=0,rU=rd.length;rT<rU;rT+=4)rl=this.getColor(rd[rT],rd[rT+1],rd[rT+2],rd[rT+3]),0!=rd[rT+3]&&(rd[rT]=rl[0],rd[rT+1]=rl[1],rd[rT+2]=rl[2],rd[rT+3]=rl[3]);return rQ.putImageData(rM,0,0),rS},rQ.getColor=function(rS,rQ,re,rl){var rM=[];if(this.data._mat&&this.data._alpha){var rd=this.data._mat,rT=this.data._alpha;rM[0]=rd[0]*rS+rd[1]*rQ+rd[2]*re+rd[3]*rl+rT[0],rM[1]=rd[4]*rS+rd[5]*rQ+rd[6]*re+rd[7]*rl+rT[1],rM[2]=rd[8]*rS+rd[9]*rQ+rd[10]*re+rd[11]*rl+rT[2],rM[3]=rd[12]*rS+rd[13]*rQ+rd[14]*re+rd[15]*rl+rT[3]}return rM},rS}(),rv=(function(){function rS(){}rj(rS,"laya.maths.Arith"),rS.formatR=function(rS){return rS>Math.PI&&(rS-=2*Math.PI),rS<-Math.PI&&(rS+=2*Math.PI),rS},rS.isPOT=function(rS,rQ){return 0<rS&&0==(rS&rS-1)&&0<rQ&&0==(rQ&rQ-1)},rS.setMatToArray=function(rS,rQ){rS.a,rS.b,rS.c,rS.d,rS.tx,rS.ty,rQ[0]=rS.a,rQ[1]=rS.b,rQ[4]=rS.c,rQ[5]=rS.d,rQ[12]=rS.tx,rQ[13]=rS.ty}}(),function(){function rS(){this._controlPoints=[new rH,new rH,new rH],this._calFun=this.getPoint2}rj(rS,"laya.maths.Bezier");var rQ=rS.prototype;return rQ._switchPoint=function(rS,rQ){var re=this._controlPoints.shift();re.setTo(rS,rQ),this._controlPoints.push(re)},rQ.getPoint2=function(rS,rQ){var re=this._controlPoints[0],rl=this._controlPoints[1],rM=this._controlPoints[2],rd=Math.pow(1-rS,2)*re.x+2*rS*(1-rS)*rl.x+Math.pow(rS,2)*rM.x,rT=Math.pow(1-rS,2)*re.y+2*rS*(1-rS)*rl.y+Math.pow(rS,2)*rM.y;rQ.push(rd,rT)},rQ.getPoint3=function(rS,rQ){var re=this._controlPoints[0],rl=this._controlPoints[1],rM=this._controlPoints[2],rd=this._controlPoints[3],rT=Math.pow(1-rS,3)*re.x+3*rl.x*rS*(1-rS)*(1-rS)+3*rM.x*rS*rS*(1-rS)+rd.x*Math.pow(rS,3),rU=Math.pow(1-rS,3)*re.y+3*rl.y*rS*(1-rS)*(1-rS)+3*rM.y*rS*rS*(1-rS)+rd.y*Math.pow(rS,3);rQ.push(rT,rU)},rQ.insertPoints=function(rS,rQ){var re,rl=NaN;for(re=1/(rS=0<rS?rS:5),rl=0;rl<=1;rl+=re)this._calFun(rl,rQ)},rQ.getBezierPoints=function(rS,rQ,re){void 0===rQ&&(rQ=5),void 0===re&&(re=2);var rl,rM,rd=0;if((rl=rS.length)<2*(re+1))return[];switch(rM=[],re){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=re;)this._controlPoints.push(new rH);for(rd=0;rd<2*re;rd+=2)this._switchPoint(rS[rd],rS[rd+1]);for(rd=2*re;rd<rl;rd+=2)this._switchPoint(rS[rd],rS[rd+1]),rd/2%re==0&&this.insertPoints(rQ,rM);return rM},ri(rS,["I",function(){return this.I=new rS}]),rS}()),rD=function(){function rR(){}return rj(rR,"laya.maths.GrahamScan"),rR.multiply=function(rS,rQ,re){return(rS.x-re.x)*(rQ.y-re.y)-(rQ.x-re.x)*(rS.y-re.y)},rR.dis=function(rS,rQ){return(rS.x-rQ.x)*(rS.x-rQ.x)+(rS.y-rQ.y)*(rS.y-rQ.y)},rR._getPoints=function(rS,rQ,re){for(void 0===rQ&&(rQ=!1),rR._mPointList||(rR._mPointList=[]);rR._mPointList.length<rS;)rR._mPointList.push(new rH);return re||(re=[]),re.length=0,rQ?rR.getFrom(re,rR._mPointList,rS):rR.getFromR(re,rR._mPointList,rS),re},rR.getFrom=function(rS,rQ,re){var rl=0;for(rl=0;rl<re;rl++)rS.push(rQ[rl]);return rS},rR.getFromR=function(rS,rQ,re){var rl=0;for(rl=0;rl<re;rl++)rS.push(rQ.pop());return rS},rR.pListToPointList=function(rS,rQ){void 0===rQ&&(rQ=!1);var re=0,rl=rS.length/2,rM=rR._getPoints(rl,rQ,rR._tempPointList);for(re=0;re<rl;re++)rM[re].setTo(rS[re+re],rS[re+re+1]);return rM},rR.pointListToPlist=function(rS){var rQ,re=0,rl=rS.length,rM=rR._temPList;for(re=rM.length=0;re<rl;re++)rQ=rS[re],rM.push(rQ.x,rQ.y);return rM},rR.scanPList=function(rS){return rV.copyArray(rS,rR.pointListToPlist(rR.scan(rR.pListToPointList(rS,!0))))},rR.scan=function(rS){var rQ,re,rl,rM=0,rd=0,rT=0,rU=rS.length,ri={};for((re=rR._temArr).length=0,rM=(rU=rS.length)-1;0<=rM;rM--)rl=(rQ=rS[rM]).x+"_"+rQ.y,ri.hasOwnProperty(rl)||(ri[rl]=!0,re.push(rQ));for(rU=re.length,rV.copyArray(rS,re),rM=1;rM<rU;rM++)(rS[rM].y<rS[rT].y||rS[rM].y==rS[rT].y&&rS[rM].x<rS[rT].x)&&(rT=rM);for(rQ=rS[0],rS[0]=rS[rT],rS[rT]=rQ,rM=1;rM<rU-1;rM++){for(rd=(rT=rM)+1;rd<rU;rd++)(0<rR.multiply(rS[rd],rS[rT],rS[0])||0==rR.multiply(rS[rd],rS[rT],rS[0])&&rR.dis(rS[0],rS[rd])<rR.dis(rS[0],rS[rT]))&&(rT=rd);rQ=rS[rM],rS[rM]=rS[rT],rS[rT]=rQ}if((re=rR._temArr).length=0,rS.length<3)return rV.copyArray(re,rS);for(re.push(rS[0],rS[1],rS[2]),rM=3;rM<rU;rM++){for(;2<=re.length&&0<=rR.multiply(rS[rM],re[re.length-1],re[re.length-2]);)re.pop();rS[rM]&&re.push(rS[rM])}return re},rR._mPointList=null,rR._tempPointList=[],rR._temPList=[],rR._temArr=[],rR}(),rB=function(){function rM(){}return rj(rM,"laya.maths.MathUtil"),rM.subtractVector3=function(rS,rQ,re){re[0]=rS[0]-rQ[0],re[1]=rS[1]-rQ[1],re[2]=rS[2]-rQ[2]},rM.lerp=function(rS,rQ,re){return rS*(1-re)+rQ*re},rM.scaleVector3=function(rS,rQ,re){re[0]=rS[0]*rQ,re[1]=rS[1]*rQ,re[2]=rS[2]*rQ},rM.lerpVector3=function(rS,rQ,re,rl){var rM=rS[0],rd=rS[1],rT=rS[2];rl[0]=rM+re*(rQ[0]-rM),rl[1]=rd+re*(rQ[1]-rd),rl[2]=rT+re*(rQ[2]-rT)},rM.lerpVector4=function(rS,rQ,re,rl){var rM=rS[0],rd=rS[1],rT=rS[2],rU=rS[3];rl[0]=rM+re*(rQ[0]-rM),rl[1]=rd+re*(rQ[1]-rd),rl[2]=rT+re*(rQ[2]-rT),rl[3]=rU+re*(rQ[3]-rU)},rM.slerpQuaternionArray=function(rS,rQ,re,rl,rM,rd,rT){var rU,ri,rR,ro,rY,rp=rS[rQ+0],rJ=rS[rQ+1],rL=rS[rQ+2],rj=rS[rQ+3],rc=re[rl+0],rG=re[rl+1],rz=re[rl+2],rA=re[rl+3];return(ri=rp*rc+rJ*rG+rL*rz+rj*rA)<0&&(ri=-ri,rc=-rc,rG=-rG,rz=-rz,rA=-rA),rY=1e-6<1-ri?(rU=Math.acos(ri),rR=Math.sin(rU),ro=Math.sin((1-rM)*rU)/rR,Math.sin(rM*rU)/rR):(ro=1-rM,rM),rd[rT+0]=ro*rp+rY*rc,rd[rT+1]=ro*rJ+rY*rG,rd[rT+2]=ro*rL+rY*rz,rd[rT+3]=ro*rj+rY*rA,rd},rM.getRotation=function(rS,rQ,re,rl){return Math.atan2(rl-rQ,re-rS)/Math.PI*180},rM.sortBigFirst=function(rS,rQ){return rS==rQ?0:rS<rQ?1:-1},rM.sortSmallFirst=function(rS,rQ){return rS==rQ?0:rS<rQ?-1:1},rM.sortNumBigFirst=function(rS,rQ){return parseFloat(rQ)-parseFloat(rS)},rM.sortNumSmallFirst=function(rS,rQ){return parseFloat(rS)-parseFloat(rQ)},rM.sortByKey=function(re,rS,rQ){var rl;return void 0===rS&&(rS=!1),void 0===rQ&&(rQ=!0),rl=rS?rQ?rM.sortNumBigFirst:rM.sortBigFirst:rQ?rM.sortNumSmallFirst:rM.sortSmallFirst,function(rS,rQ){return rl(rS[re],rQ[re])}},rM}(),rX=function(){function re(rS,rQ,re,rl,rM,rd){this.inPool=!1,this.bTransform=!1,void 0===rS&&(rS=1),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=1),void 0===rM&&(rM=0),void 0===rd&&(rd=0),this.a=rS,this.b=rQ,this.c=re,this.d=rl,this.tx=rM,this.ty=rd,this._checkTransform()}rj(re,"laya.maths.Matrix");var rS=re.prototype;return rS.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},rS._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},rS.setTranslate=function(rS,rQ){return this.tx=rS,this.ty=rQ,this},rS.translate=function(rS,rQ){return this.tx+=rS,this.ty+=rQ,this},rS.scale=function(rS,rQ){this.a*=rS,this.d*=rQ,this.c*=rS,this.b*=rQ,this.tx*=rS,this.ty*=rQ,this.bTransform=!0},rS.rotate=function(rS){var rQ=Math.cos(rS),re=Math.sin(rS),rl=this.a,rM=this.c,rd=this.tx;this.a=rl*rQ-this.b*re,this.b=rl*re+this.b*rQ,this.c=rM*rQ-this.d*re,this.d=rM*re+this.d*rQ,this.tx=rd*rQ-this.ty*re,this.ty=rd*re+this.ty*rQ,this.bTransform=!0},rS.skew=function(rS,rQ){var re=Math.tan(rS),rl=Math.tan(rQ),rM=this.a,rd=this.b;return this.a+=rl*this.c,this.b+=rl*this.d,this.c+=re*rM,this.d+=re*rd,this},rS.invertTransformPoint=function(rS){var rQ=this.a,re=this.b,rl=this.c,rM=this.d,rd=this.tx,rT=rQ*rM-re*rl,rU=rM/rT,ri=-re/rT,rR=-rl/rT,ro=rQ/rT,rY=(rl*this.ty-rM*rd)/rT,rp=-(rQ*this.ty-re*rd)/rT;return rS.setTo(rU*rS.x+rR*rS.y+rY,ri*rS.x+ro*rS.y+rp)},rS.transformPoint=function(rS){return rS.setTo(this.a*rS.x+this.c*rS.y+this.tx,this.b*rS.x+this.d*rS.y+this.ty)},rS.transformPointN=function(rS){return rS.setTo(this.a*rS.x+this.c*rS.y,this.b*rS.x+this.d*rS.y)},rS.transformPointArray=function(rS,rQ){for(var re=rS.length,rl=0;rl<re;rl+=2){var rM=rS[rl],rd=rS[rl+1];rQ[rl]=this.a*rM+this.c*rd+this.tx,rQ[rl+1]=this.b*rM+this.d*rd+this.ty}return rQ},rS.transformPointArrayScale=function(rS,rQ){for(var re=rS.length,rl=0;rl<re;rl+=2){var rM=rS[rl],rd=rS[rl+1];rQ[rl]=this.a*rM+this.c*rd,rQ[rl+1]=this.b*rM+this.d*rd}return rQ},rS.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},rS.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},rS.invert=function(){var rS=this.a,rQ=this.b,re=this.c,rl=this.d,rM=this.tx,rd=rS*rl-rQ*re;return this.a=rl/rd,this.b=-rQ/rd,this.c=-re/rd,this.d=rS/rd,this.tx=(re*this.ty-rl*rM)/rd,this.ty=-(rS*this.ty-rQ*rM)/rd,this},rS.setTo=function(rS,rQ,re,rl,rM,rd){return this.a=rS,this.b=rQ,this.c=re,this.d=rl,this.tx=rM,this.ty=rd,this},rS.concat=function(rS){var rQ=this.a,re=this.c,rl=this.tx;return this.a=rQ*rS.a+this.b*rS.c,this.b=rQ*rS.b+this.b*rS.d,this.c=re*rS.a+this.d*rS.c,this.d=re*rS.b+this.d*rS.d,this.tx=rl*rS.a+this.ty*rS.c+rS.tx,this.ty=rl*rS.b+this.ty*rS.d+rS.ty,this},rS.scaleEx=function(rS,rQ){var re=this.a,rl=this.b,rM=this.c,rd=this.d;0!==rl||0!==rM?(this.a=rS*re,this.b=rS*rl,this.c=rQ*rM):(this.a=rS*re,this.b=0*rd,this.c=0*re),this.d=rQ*rd,this.bTransform=!0},rS.rotateEx=function(rS){var rQ=Math.cos(rS),re=Math.sin(rS),rl=this.a,rM=this.b,rd=this.c,rT=this.d;0!==rM||0!==rd?(this.a=rQ*rl+re*rd,this.b=rQ*rM+re*rT,this.c=-re*rl+rQ*rd,this.d=-re*rM+rQ*rT):(this.a=rQ*rl,this.b=re*rT,this.c=-re*rl,this.d=rQ*rT),this.bTransform=!0},rS.clone=function(){var rS=re.create();return rS.a=this.a,rS.b=this.b,rS.c=this.c,rS.d=this.d,rS.tx=this.tx,rS.ty=this.ty,rS.bTransform=this.bTransform,rS},rS.copyTo=function(rS){return rS.a=this.a,rS.b=this.b,rS.c=this.c,rS.d=this.d,rS.tx=this.tx,rS.ty=this.ty,rS.bTransform=this.bTransform,rS},rS.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},rS.destroy=function(){if(!this.inPool){var rS=re._cache;this.inPool=!0,rS._length||(rS._length=0),(rS[rS._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},re.mul=function(rS,rQ,re){var rl=rS.a,rM=rS.b,rd=rS.c,rT=rS.d,rU=rS.tx,ri=rS.ty,rR=rQ.a,ro=rQ.b,rY=rQ.c,rp=rQ.d,rJ=rQ.tx,rL=rQ.ty;return 0!==ro||0!==rY?(re.a=rl*rR+rM*rY,re.b=rl*ro+rM*rp,re.c=rd*rR+rT*rY,re.d=rd*ro+rT*rp,re.tx=rR*rU+rY*ri+rJ,re.ty=ro*rU+rp*ri+rL):(re.a=rl*rR,re.b=rM*rp,re.c=rd*rR,re.d=rT*rp,re.tx=rR*rU+rJ,re.ty=rp*ri+rL),re},re.mul16=function(rS,rQ,re){var rl=rS.a,rM=rS.b,rd=rS.c,rT=rS.d,rU=rS.tx,ri=rS.ty,rR=rQ.a,ro=rQ.b,rY=rQ.c,rp=rQ.d,rJ=rQ.tx,rL=rQ.ty;return 0!==ro||0!==rY?(re[0]=rl*rR+rM*rY,re[1]=rl*ro+rM*rp,re[4]=rd*rR+rT*rY,re[5]=rd*ro+rT*rp,re[12]=rR*rU+rY*ri+rJ,re[13]=ro*rU+rp*ri+rL):(re[0]=rl*rR,re[1]=rM*rp,re[4]=rd*rR,re[5]=rT*rp,re[12]=rR*rU+rJ,re[13]=rp*ri+rL),re},re.mulPre=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=rS.a,rR=rS.b,ro=rS.c,rY=rS.d,rp=rS.tx,rJ=rS.ty;return 0!==re||0!==rl?(rU.a=ri*rQ+rR*rl,rU.b=ri*re+rR*rM,rU.c=ro*rQ+rY*rl,rU.d=ro*re+rY*rM,rU.tx=rQ*rp+rl*rJ+rd,rU.ty=re*rp+rM*rJ+rT):(rU.a=ri*rQ,rU.b=rR*rM,rU.c=ro*rQ,rU.d=rY*rM,rU.tx=rQ*rp+rd,rU.ty=rM*rJ+rT),rU},re.mulPos=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=rS.a,rR=rS.b,ro=rS.c,rY=rS.d,rp=rS.tx,rJ=rS.ty;return 0!==rR||0!==ro?(rU.a=rQ*ri+re*ro,rU.b=rQ*rR+re*rY,rU.c=rl*ri+rM*ro,rU.d=rl*rR+rM*rY,rU.tx=ri*rd+ro*rT+rp,rU.ty=rR*rd+rY*rT+rJ):(rU.a=rQ*ri,rU.b=re*rY,rU.c=rl*ri,rU.d=rM*rY,rU.tx=ri*rd+rp,rU.ty=rY*rT+rJ),rU},re.preMul=function(rS,rQ,re){var rl=rS.a,rM=rS.b,rd=rS.c,rT=rS.d,rU=rQ.a,ri=rQ.b,rR=rQ.c,ro=rQ.d,rY=rQ.tx,rp=rQ.ty;return re.a=rU*rl,re.b=re.c=0,re.d=ro*rT,re.tx=rY*rl+rS.tx,re.ty=rp*rT+rS.ty,0===ri&&0===rR&&0===rM&&0===rd||(re.a+=ri*rd,re.d+=rR*rM,re.b+=rU*rM+ri*rT,re.c+=rR*rl+ro*rd,re.tx+=rp*rd,re.ty+=rY*rM),re},re.preMulXY=function(rS,rQ,re,rl){var rM=rS.a,rd=rS.b,rT=rS.c,rU=rS.d;return rl.a=rM,rl.b=rd,rl.c=rT,rl.d=rU,rl.tx=rQ*rM+rS.tx+re*rT,rl.ty=re*rU+rS.ty+rQ*rd,rl},re.create=function(){var rS=re._cache,rQ=rS._length?rS[--rS._length]:new re;return rQ.inPool=!1,rQ},re.EMPTY=new re,re.TEMP=new re,re._cache=[],re}(),rH=function(){function rS(rS,rQ){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),this.x=rS,this.y=rQ}rj(rS,"laya.maths.Point");var rQ=rS.prototype;return rQ.setTo=function(rS,rQ){return this.x=rS,this.y=rQ,this},rQ.distance=function(rS,rQ){return Math.sqrt((this.x-rS)*(this.x-rS)+(this.y-rQ)*(this.y-rQ))},rQ.toString=function(){return this.x+","+this.y},rQ.normalize=function(){var rS=Math.sqrt(this.x*this.x+this.y*this.y);if(0<rS){var rQ=1/rS;this.x*=rQ,this.y*=rQ}},rS.TEMP=new rS,rS.EMPTY=new rS,rS}(),rg=function(){function rR(rS,rQ,re,rl){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),this.x=rS,this.y=rQ,this.width=re,this.height=rl}rj(rR,"laya.maths.Rectangle");var rS=rR.prototype;return rS.setTo=function(rS,rQ,re,rl){return this.x=rS,this.y=rQ,this.width=re,this.height=rl,this},rS.copyFrom=function(rS){return this.x=rS.x,this.y=rS.y,this.width=rS.width,this.height=rS.height,this},rS.contains=function(rS,rQ){return!(this.width<=0||this.height<=0)&&(rS>=this.x&&rS<this.right&&rQ>=this.y&&rQ<this.bottom)},rS.intersects=function(rS){return!(rS.x>this.x+this.width||rS.x+rS.width<this.x||rS.y>this.y+this.height||rS.y+rS.height<this.y)},rS.intersection=function(rS,rQ){return this.intersects(rS)?(rQ||(rQ=new rR),rQ.x=Math.max(this.x,rS.x),rQ.y=Math.max(this.y,rS.y),rQ.width=Math.min(this.right,rS.right)-rQ.x,rQ.height=Math.min(this.bottom,rS.bottom)-rQ.y,rQ):null},rS.union=function(rS,rQ){return rQ||(rQ=new rR),this.clone(rQ),rS.width<=0||rS.height<=0?rQ:(rQ.addPoint(rS.x,rS.y),rQ.addPoint(rS.right,rS.bottom),this)},rS.clone=function(rS){return rS||(rS=new rR),rS.x=this.x,rS.y=this.y,rS.width=this.width,rS.height=this.height,rS},rS.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},rS.equals=function(rS){return!(!rS||rS.x!==this.x||rS.y!==this.y||rS.width!==this.width||rS.height!==this.height)},rS.addPoint=function(rS,rQ){return this.x>rS&&(this.width+=this.x-rS,this.x=rS),this.y>rQ&&(this.height+=this.y-rQ,this.y=rQ),this.width<rS-this.x&&(this.width=rS-this.x),this.height<rQ-this.y&&(this.height=rQ-this.y),this},rS._getBoundPoints=function(){var rS=rR._temB;return(rS.length=0)==this.width||0==this.height||rS.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),rS},rS.isEmpty=function(){return this.width<=0||this.height<=0},ro(0,rS,"right",function(){return this.x+this.width}),ro(0,rS,"bottom",function(){return this.y+this.height}),rR._getBoundPointS=function(rS,rQ,re,rl){var rM=rR._temA;return(rM.length=0)==re||0==rl||rM.push(rS,rQ,rS+re,rQ,rS,rQ+rl,rS+re,rQ+rl),rM},rR._getWrapRec=function(rS,rQ){if(!rS||rS.length<1)return rQ?rQ.setTo(0,0,0,0):rR.TEMP.setTo(0,0,0,0);rQ=rQ||new rR;var re,rl,rM,rd,rT,rU=rS.length,ri=rH.TEMP;for(rM=rT=-(rl=rd=99999),re=0;re<rU;re+=2)ri.x=rS[re],ri.y=rS[re+1],rl=rl<ri.x?rl:ri.x,rd=rd<ri.y?rd:ri.y,rM=rM>ri.x?rM:ri.x,rT=rT>ri.y?rT:ri.y;return rQ.setTo(rl,rd,rM-rl,rT-rd)},rR.EMPTY=new rR,rR.TEMP=new rR,rR._temB=[],rR._temA=[],rR}(),rt=function(){function ri(){}return rj(ri,"laya.media.SoundManager"),ro(1,ri,"useAudioMusic",function(){return ri._useAudioMusic},function(rS){ri._useAudioMusic=rS,ri._musicClass=rS?reS:null}),ro(1,ri,"autoStopMusic",function(){return ri._autoStopMusic},function(rS){rO.stage.off("blur",null,ri._stageOnBlur),rO.stage.off("focus",null,ri._stageOnFocus),rO.stage.off("visibilitychange",null,ri._visibilityChange),(ri._autoStopMusic=rS)&&(rO.stage.on("blur",null,ri._stageOnBlur),rO.stage.on("focus",null,ri._stageOnFocus),rO.stage.on("visibilitychange",null,ri._visibilityChange))}),ro(1,ri,"muted",function(){return ri._muted},function(rS){rS!=ri._muted&&(rS&&ri.stopAllSound(),ri.musicMuted=rS,ri._muted=rS)}),ro(1,ri,"musicMuted",function(){return ri._musicMuted},function(rS){rS!=ri._musicMuted&&(rS?(ri._tMusic&&ri._musicChannel&&!ri._musicChannel.isStopped?ri._musicChannel.pause():ri._musicChannel=null,ri._musicMuted=rS):(ri._musicMuted=rS,ri._tMusic&&ri._musicChannel&&ri._musicChannel.resume()))}),ro(1,ri,"soundMuted",function(){return ri._soundMuted},function(rS){ri._soundMuted=rS}),ri.addChannel=function(rS){0<=ri._channels.indexOf(rS)||(ri._channels.push(rS),ri.autoReleaseSound&&0!=ri._notUsedCount&&ri._notUsedUrls[rS.url]&&(delete ri._notUsedUrls[rS.url],0==--ri._notUsedCount&&rO.timer.clear(ri,ri.disposeSoundIfNotUsed)))},ri.removeChannel=function(rS){var rQ=ri._channels,re=rQ.indexOf(rS);if(-1!=re&&(rQ.splice(re,1),ri.autoReleaseSound)){var rl=rS.url,rM=ri.defaultIntervals[rl]||2e4;if(0<rM){var rd=!0;for(re=rQ.length-1;0<=re;re--)if(rQ[re].url==rl){rd=!1;break}rd&&(ri._notUsedUrls[rl]=Date.now()+rM,0==ri._notUsedCount++&&rO.timer.loop(1e4,ri,ri.disposeSoundIfNotUsed))}}},ri.disposeSoundIfNotUsed=function(){var rS=ri._notUsedUrls;if(0!=ri._notUsedCount){var rQ=Date.now();for(var re in rS)rQ>=rS[re]&&(delete rS[re],--ri._notUsedCount,ri.destroySound(re));if(0!=ri._notUsedCount)return}rO.timer.clear(ri,ri.disposeSoundIfNotUsed)},ri._visibilityChange=function(){rO.stage.isVisibility?ri._stageOnFocus():ri._stageOnBlur()},ri._stageOnBlur=function(){ri._isActive=!1,ri._musicChannel&&(ri._musicChannel.isStopped||(ri._blurPaused=!0,ri._musicChannel.pause())),ri.stopAllSound(),rO.stage.once("mousedown",null,ri._stageOnFocus)},ri._recoverWebAudio=function(){rdS.ctx&&"running"!=rdS.ctx.state&&rdS.ctx.resume&&rdS.ctx.resume()},ri._stageOnFocus=function(){if(ri._isActive=!0,ri._recoverWebAudio(),rO.stage.off("mousedown",null,ri._stageOnFocus),ri._blurPaused){var rS=ri._musicChannel;rS&&ri._music&&rS.isStopped&&(ri._blurPaused=!1,ri._music._disposed?ri.playMusic(rS.url,rS.loops,rS.startHandler,rS.completeHandler,rS.startTime):rS.audioBuffer?rS.resume():ri._music.play(rS.startTime,rS.loops,rS.startHandler,rS))}},ri.playSound=function(rS,rQ,re,rl,rM,rd){if(void 0===rQ&&(rQ=1),void 0===rd&&(rd=0),!rS)return null;if(ri._muted)return null;if(ri._recoverWebAudio(),rS==ri._tMusic){if(ri._musicMuted)return null}else{if(!ri._isActive)return null;if(ri._soundMuted)return null}var rT,rU=ri._pool[rS];return rM||(rM=ri._soundClass),rU||((rU=new rM).load(rS),ri._pool[rS]=rU),(rT=rU.play(rd,rQ,re))?(rS==ri._tMusic&&(ri._music=rU,ri._isActive||(ri._blurPaused=!0,rT.pause())),rT.url=rS,rT.volume=rS==ri._tMusic?ri.musicVolume:ri.soundVolume,rT.completeHandler=rl,rT):null},ri.destroySound=function(rS){var rQ=ri._pool[rS];rQ&&(delete ri._pool[rS],rQ.dispose())},ri.playMusic=function(rS,rQ,re,rl,rM){return void 0===rQ&&(rQ=0),void 0===rM&&(rM=0),ri._tMusic=rS,ri._musicChannel&&ri._musicChannel.stop(),ri._musicChannel=ri.playSound(rS,rQ,re,rl,null,rM)},ri.stopSound=function(rS){for(var rQ,re=ri._channels.length-1;0<=re;re--)(rQ=ri._channels[re]).url==rS&&rQ.stop()},ri.stopAll=function(){ri._tMusic=null;var rS=0;for(rS=ri._channels.length-1;0<=rS;rS--)ri._channels[rS].stop()},ri.stopAllSound=function(){var rS,rQ=0;for(rQ=ri._channels.length-1;0<=rQ;rQ--)(rS=ri._channels[rQ]).url!=ri._tMusic&&rS.stop()},ri.stopMusic=function(){ri._musicChannel&&ri._musicChannel.stop(),ri._tMusic=null},ri.setSoundVolume=function(rS,rQ){if(rQ)ri._setVolume(rQ,rS);else{ri.soundVolume=rS;var re,rl=0;for(rl=ri._channels.length-1;0<=rl;rl--)(re=ri._channels[rl]).url!=ri._tMusic&&(re.volume=rS)}},ri.setMusicVolume=function(rS){ri.musicVolume=rS,ri._setVolume(ri._tMusic,rS)},ri._setVolume=function(rS,rQ){for(var re,rl=ri._channels.length-1;0<=rl;rl--)(re=ri._channels[rl]).url==rS&&(re.volume=rQ)},ri.musicVolume=1,ri.soundVolume=1,ri.playbackRate=1,ri._useAudioMusic=!0,ri._muted=!1,ri._soundMuted=!1,ri._musicMuted=!1,ri._tMusic=null,ri._musicChannel=null,ri._music=null,ri._channels=[],ri._autoStopMusic=!1,ri._blurPaused=!1,ri._isActive=!0,ri._soundClass=null,ri._musicClass=null,ri.autoReleaseSound=!0,ri._pool={},ri.defaultIntervals={},ri._notUsedUrls={},ri._notUsedCount=0,ri}(),rI=function(){var rS;function re(){}return rj(re,"laya.net.LocalStorage"),re.__init__=function(){re._baseClass||(re._baseClass=rS).init(),re.items=re._baseClass.items,re.support=re._baseClass.support},re.setItem=function(rS,rQ){re._baseClass.setItem(rS,rQ)},re.getItem=function(rS){return re._baseClass.getItem(rS)},re.setJSON=function(rS,rQ){re._baseClass.setJSON(rS,rQ)},re.getJSON=function(rS){return re._baseClass.getJSON(rS)},re.removeItem=function(rS){re._baseClass.removeItem(rS)},re.clear=function(){re._baseClass.clear()},re._baseClass=null,re.items=null,re.support=!1,re.__init$=function(){rS=function(){function re(){}return rj(re,""),re.init=function(){try{re.support=!0,re.items=rT.localStorage,re.setItem("laya","1"),re.removeItem("laya")}catch(rS){re.support=!1}re.support||console.log("LocalStorage is not supprot or browser is private mode.")},re.setItem=function(rS,rQ){try{re.support&&re.items.setItem(rS,rQ)}catch(rS){console.warn("set localStorage failed",rS)}},re.getItem=function(rS){return re.support?re.items.getItem(rS):null},re.setJSON=function(rS,rQ){try{re.support&&re.items.setItem(rS,JSON.stringify(rQ))}catch(rS){console.warn("set localStorage failed",rS)}},re.getJSON=function(rS){return JSON.parse(re.support?re.items.getItem(rS):null)},re.removeItem=function(rS){re.support&&re.items.removeItem(rS)},re.clear=function(){re.support&&re.items.clear()},re.items=null,re.support=!1,re}()},re}(),rh=(function(){function rl(){}rj(rl,"laya.net.ResourceVersion"),rl.enable=function(rS,rQ,re){void 0===re&&(re=2),laya.net.ResourceVersion.type=re,rO.loader.load(rS,rz.create(null,rl.onManifestLoaded,[rQ]),null,"json"),rb.customFormat=rl.addVersionPrefix},rl.onManifestLoaded=function(rS,rQ){rl.manifest=rQ,rS.run(),rQ||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},rl.addVersionPrefix=function(rS){return rl.manifest&&rl.manifest[rS]?2==rl.type?rl.manifest[rS]:rl.manifest[rS]+"/"+rS:rS},rl.FOLDER_VERSION=1,rl.FILENAME_VERSION=2,rl.manifest=null,rl.type=1}(),function(){function rS(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}rj(rS,"laya.net.TTFLoader");var rQ=rS.prototype;return rQ.load=function(rS){var rQ=(this._url=rS).split(".ttf")[0].split("/");this.fontName=rQ[rQ.length-1],rf.window.conch?this._loadConch():rf.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},rQ._loadConch=function(){this._http=new rTS,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},rQ._onHttpLoaded=function(rS){rf.window.conch.setFontFaceFromBuffer(this.fontName,rS),this._clearHttp(),this._complete()},rQ._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},rQ._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},rQ._complete=function(){rO.timer.clear(this,this._complete),rO.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},rQ._checkComplete=function(){rk.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},rQ._loadWithFontFace=function(){var rS=new rf.window.FontFace(this.fontName,"url('"+this._url+"')");rf.window.document.fonts.add(rS);var rQ=this;rS.loaded.then(function(){rQ._complete()}),rS.load()},rQ._createDiv=function(){this._div=rf.createElement("div"),this._div.innerHTML="laya";var rS=this._div.style;rS.fontFamily=this.fontName,rS.position="absolute",rS.left="-100px",rS.top="-100px",rf.document.body.appendChild(this._div)},rQ._loadWithCSS=function(){var rS=this,rQ=rf.createElement("style");rQ.type="text/css",rf.document.body.appendChild(rQ),rQ.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=rk.measureText("LayaTTFFont",this._fontTxt).width;var re=this;rQ.onload=function(){rO.timer.once(1e4,re,rS._complete)},rO.timer.loop(20,this,this._checkComplete),this._createDiv()},rS._testString="LayaTTFFont",rS}()),rb=function(){function rl(rS){this._url=null,this._path=null,this._url=rl.formatURL(rS),this._path=rl.getPath(rS)}rj(rl,"laya.net.URL");var rS=rl.prototype;return ro(0,rS,"path",function(){return this._path}),ro(0,rS,"url",function(){return this._url}),rl.formatURL=function(rS,rQ){if(!rS)return"null path";if(0<rS.indexOf(":"))return rS;null!=rl.customFormat&&(rS=rl.customFormat(rS,rQ));var re=rS.charAt(0);if("."===re)return rl.formatRelativePath((rQ||rl.basePath)+rS);if("~"===re)return rl.rootPath+rS.substring(1);if("d"===re){if(0===rS.indexOf("data:image"))return rS}else if("/"===re)return rS;return(rQ||rl.basePath)+rS},rl.formatRelativePath=function(rS){for(var rQ=rS.split("/"),re=0,rl=rQ.length;re<rl;re++)".."==rQ[re]&&(rQ.splice(re-1,2),re-=2);return rQ.join("/")},rl.isAbsolute=function(rS){return 0<rS.indexOf(":")||"/"==rS.charAt(0)},rl.getPath=function(rS){var rQ=rS.lastIndexOf("/");return 0<rQ?rS.substr(0,rQ+1):""},rl.getFileName=function(rS){var rQ=rS.lastIndexOf("/");return 0<rQ?rS.substr(rQ+1):rS},rl.version={},rl.basePath="",rl.rootPath="",rl.customFormat=function(rS){var rQ=rl.version[rS];return!rm.isConchApp&&rQ&&(rS+="?v="+rQ),rS},rl}(),rm=function(){function rM(rS,rQ){this._timeId=0;var re=rM._mainCanvas.source.style;re.position="absolute",re.top=re.left="0px",re.background="#000000",rM._mainCanvas.source.id="layaCanvas";var rl=laya.renders.Render.isWebGL;rM._mainCanvas.source.width=rS,rM._mainCanvas.source.height=rQ,rl&&rM.WebGL.init(rM._mainCanvas,rS,rQ),rf.container.appendChild(rM._mainCanvas.source),(rM._context=new r$(rS,rQ,rl?null:rM._mainCanvas)).ctx.setIsMainContext(),rf.window.requestAnimationFrame(function rS(rQ){rf.window.requestAnimationFrame(rS);rO.stage._loop()}),rO.stage.on("visibilitychange",this,this._onVisibilitychange)}rj(rM,"laya.renders.Render");var rS=rM.prototype;return rS._onVisibilitychange=function(){rO.stage.isVisibility?0!=this._timeId&&rf.window.clearInterval(this._timeId):this._timeId=rf.window.setInterval(this._enterFrame,1e3)},rS._enterFrame=function(rS){rO.stage._loop()},ro(1,rM,"context",function(){return rM._context}),ro(1,rM,"canvas",function(){return rM._mainCanvas.source}),rM._context=null,rM._mainCanvas=null,rM.WebGL=null,rM.isConchNode=!1,rM.isConchApp=!1,rM.isConchWebGL=!1,rM.isWebGL=!1,rM.is3DMode=!1,rM.optimizeTextureMemory=function(rS,rQ){return!0},rM.__init$=function(){rT.ConchRenderType=rT.ConchRenderType||1,rT.ConchRenderType|=rT.conch?4:0,rM.isConchNode=5==(5&rT.ConchRenderType),rM.isConchApp=4==(4&rT.ConchRenderType),rM.isConchWebGL=6==rT.ConchRenderType},rM}(),r$=function(){function rT(rS,rQ,re){this.x=0,this.y=0,this._drawTexture=function(rS,rQ,re){re[0].loaded&&this.ctx.drawTexture(re[0],re[1],re[2],re[3],re[4],rS,rQ)},this._fillTexture=function(rS,rQ,re){re[0].loaded&&this.ctx.fillTexture(re[0],re[1]+rS,re[2]+rQ,re[3],re[4],re[5],re[6],re[7])},this._drawTextureWithTransform=function(rS,rQ,re){re[0].loaded&&this.ctx.drawTextureWithTransform(re[0],re[1],re[2],re[3],re[4],re[5],rS,rQ,re[6])},this._fillQuadrangle=function(rS,rQ,re){this.ctx.fillQuadrangle(re[0],re[1],re[2],re[3],re[4])},this._drawRect=function(rS,rQ,re){var rl=this.ctx;null!=re[4]&&(rl.fillStyle=re[4],rl.fillRect(rS+re[0],rQ+re[1],re[2],re[3],null)),null!=re[5]&&(rl.strokeStyle=re[5],rl.lineWidth=re[6],rl.strokeRect(rS+re[0],rQ+re[1],re[2],re[3],re[6]))},this._drawPie=function(rS,rQ,re){var rl=this.ctx;rm.isWebGL&&rl.setPathId(re[8]),rl.beginPath(),rm.isWebGL?(rl.movePath(re[0]+rS,re[1]+rQ),rl.moveTo(0,0)):rl.moveTo(rS+re[0],rQ+re[1]),rl.arc(rS+re[0],rQ+re[1],re[2],re[3],re[4]),rl.closePath(),this._fillAndStroke(re[5],re[6],re[7],!0)},this._clipRect=function(rS,rQ,re){this.ctx.clipRect(rS+re[0],rQ+re[1],re[2],re[3])},this._fillRect=function(rS,rQ,re){this.ctx.fillRect(rS+re[0],rQ+re[1],re[2],re[3],re[4])},this._drawCircle=function(rS,rQ,re){var rl=this.ctx;rm.isWebGL&&rl.setPathId(re[6]),rN.drawCall++,rl.beginPath(),rm.isWebGL&&rl.movePath(re[0]+rS,re[1]+rQ),rl.arc(re[0]+rS,re[1]+rQ,re[2],0,rT.PI2),rl.closePath(),this._fillAndStroke(re[3],re[4],re[5],!0)},this._fillCircle=function(rS,rQ,re){rN.drawCall++;var rl=this.ctx;rl.beginPath(),rl.fillStyle=re[3],rl.arc(re[0]+rS,re[1]+rQ,re[2],0,rT.PI2),rl.fill()},this._setShader=function(rS,rQ,re){this.ctx.setShader(re[0])},this._drawLine=function(rS,rQ,re){var rl=this.ctx;rm.isWebGL&&rl.setPathId(re[6]),rl.beginPath(),rl.strokeStyle=re[4],rl.lineWidth=re[5],rm.isWebGL?(rl.movePath(rS,rQ),rl.moveTo(re[0],re[1]),rl.lineTo(re[2],re[3])):(rl.moveTo(rS+re[0],rQ+re[1]),rl.lineTo(rS+re[2],rQ+re[3])),rl.stroke()},this._drawLines=function(rS,rQ,re){var rl=this.ctx;rm.isWebGL&&rl.setPathId(re[5]),rl.beginPath(),rS+=re[0],rQ+=re[1],rm.isWebGL&&rl.movePath(rS,rQ),rl.strokeStyle=re[3],rl.lineWidth=re[4];var rM=re[2],rd=2,rT=rM.length;if(rm.isWebGL)for(rl.moveTo(rM[0],rM[1]);rd<rT;)rl.lineTo(rM[rd++],rM[rd++]);else for(rl.moveTo(rS+rM[0],rQ+rM[1]);rd<rT;)rl.lineTo(rS+rM[rd++],rQ+rM[rd++]);rl.stroke()},this._drawLinesWebGL=function(rS,rQ,re){this.ctx.drawLines(rS+this.x+re[0],rQ+this.y+re[1],re[2],re[3],re[4])},this._drawCurves=function(rS,rQ,re){this.ctx.drawCurves(rS,rQ,re)},this._draw=function(rS,rQ,re){re[0].call(null,this,rS,rQ)},this._transformByMatrix=function(rS,rQ,re){this.ctx.transformByMatrix(re[0])},this._setTransform=function(rS,rQ,re){this.ctx.setTransform(re[0],re[1],re[2],re[3],re[4],re[5])},this._setTransformByMatrix=function(rS,rQ,re){this.ctx.setTransformByMatrix(re[0])},this._save=function(rS,rQ,re){this.ctx.save()},this._restore=function(rS,rQ,re){this.ctx.restore()},this._translate=function(rS,rQ,re){this.ctx.translate(re[0],re[1])},this._transform=function(rS,rQ,re){this.ctx.translate(re[1]+rS,re[2]+rQ);var rl=re[0];this.ctx.transform(rl.a,rl.b,rl.c,rl.d,rl.tx,rl.ty),this.ctx.translate(-rS-re[1],-rQ-re[2])},this._rotate=function(rS,rQ,re){this.ctx.translate(re[1]+rS,re[2]+rQ),this.ctx.rotate(re[0]),this.ctx.translate(-rS-re[1],-rQ-re[2])},this._scale=function(rS,rQ,re){this.ctx.translate(re[2]+rS,re[3]+rQ),this.ctx.scale(re[0],re[1]),this.ctx.translate(-rS-re[2],-rQ-re[3])},this._alpha=function(rS,rQ,re){this.ctx.globalAlpha*=re[0]},this._setAlpha=function(rS,rQ,re){this.ctx.globalAlpha=re[0]},this._fillText=function(rS,rQ,re){this.ctx.fillText(re[0],re[1]+rS,re[2]+rQ,re[3],re[4],re[5])},this._strokeText=function(rS,rQ,re){this.ctx.strokeText(re[0],re[1]+rS,re[2]+rQ,re[3],re[4],re[5],re[6])},this._fillBorderText=function(rS,rQ,re){this.ctx.fillBorderText(re[0],re[1]+rS,re[2]+rQ,re[3],re[4],re[5],re[6],re[7])},this._blendMode=function(rS,rQ,re){this.ctx.globalCompositeOperation=re[0]},this._beginClip=function(rS,rQ,re){this.ctx.beginClip&&this.ctx.beginClip(rS+re[0],rQ+re[1],re[2],re[3])},this._setIBVB=function(rS,rQ,re){this.ctx.setIBVB(re[0]+rS,re[1]+rQ,re[2],re[3],re[4],re[5],re[6],re[7])},this._fillTrangles=function(rS,rQ,re){this.ctx.fillTrangles(re[0],re[1]+rS,re[2]+rQ,re[3],re[4])},this._drawPath=function(rS,rQ,re){var rl=this.ctx;rm.isWebGL&&rl.setPathId(-1),rl.beginPath(),rS+=re[0],rQ+=re[1],rm.isWebGL&&rl.movePath(rS,rQ);for(var rM=re[2],rd=0,rT=rM.length;rd<rT;rd++){var rU=rM[rd];switch(rU[0]){case"moveTo":rm.isWebGL?rl.moveTo(rU[1],rU[2]):rl.moveTo(rS+rU[1],rQ+rU[2]);break;case"lineTo":rm.isWebGL?rl.lineTo(rU[1],rU[2]):rl.lineTo(rS+rU[1],rQ+rU[2]);break;case"arcTo":rm.isWebGL?rl.arcTo(rU[1],rU[2],rU[3],rU[4],rU[5]):rl.arcTo(rS+rU[1],rQ+rU[2],rS+rU[3],rQ+rU[4],rU[5]);break;case"closePath":rl.closePath()}}var ri=re[3];null!=ri&&(rl.fillStyle=ri.fillStyle,rl.fill());var rR=re[4];null!=rR&&(rl.strokeStyle=rR.strokeStyle,rl.lineWidth=rR.lineWidth||1,rl.lineJoin=rR.lineJoin,rl.lineCap=rR.lineCap,rl.miterLimit=rR.miterLimit,rl.stroke())},this.drawPoly=function(rS,rQ,re){this.ctx.drawPoly(rS+this.x+re[0],rQ+this.y+re[1],re[2],re[3],re[4],re[5],re[6])},this._drawPoly=function(rS,rQ,re){var rl=this.ctx,rM=re[2],rd=2,rT=rM.length;if(rm.isWebGL)for(rl.setPathId(re[6]),rl.beginPath(),rS+=re[0],rQ+=re[1],rl.movePath(rS,rQ),rl.moveTo(rM[0],rM[1]);rd<rT;)rl.lineTo(rM[rd++],rM[rd++]);else for(rl.beginPath(),rS+=re[0],rQ+=re[1],rl.moveTo(rS+rM[0],rQ+rM[1]);rd<rT;)rl.lineTo(rS+rM[rd++],rQ+rM[rd++]);rl.closePath(),this._fillAndStroke(re[3],re[4],re[5],re[7])},this._drawSkin=function(rS,rQ,re){var rl=re[0];if(rl){var rM=this.ctx;rl.render(rM,rS,rQ)}},this._drawParticle=function(rS,rQ,re){this.ctx.drawParticle(rS+this.x,rQ+this.y,re[0])},this._setFilters=function(rS,rQ,re){this.ctx.setFilters(re)},re?this.ctx=re.getContext("2d"):(re=rAS.create("3D"),this.ctx=rk.createWebGLContext2D(re),re._setContext(this.ctx)),re.size(rS,rQ),this.canvas=re}rj(rT,"laya.renders.RenderContext");var rS=rT.prototype;return rS.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},rS.drawTexture=function(rS,rQ,re,rl,rM){rS.loaded&&this.ctx.drawTexture(rS,rQ,re,rl,rM,this.x,this.y)},rS._drawTextures=function(rS,rQ,re){re[0].loaded&&this.ctx.drawTextures(re[0],re[1],rS+this.x,rQ+this.y)},rS.drawTextureWithTransform=function(rS,rQ,re,rl,rM,rd,rT){rS.loaded&&this.ctx.drawTextureWithTransform(rS,rQ,re,rl,rM,rd,this.x,this.y,rT)},rS.fillQuadrangle=function(rS,rQ,re,rl,rM){this.ctx.fillQuadrangle(rS,rQ,re,rl,rM)},rS.drawCanvas=function(rS,rQ,re,rl,rM){this.ctx.drawCanvas(rS,rQ+this.x,re+this.y,rl,rM)},rS.drawRect=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=1);var rT=this.ctx;rT.strokeStyle=rM,rT.lineWidth=rd,rT.strokeRect(rS+this.x,rQ+this.y,re,rl,rd)},rS._fillAndStroke=function(rS,rQ,re,rl){void 0===rl&&(rl=!1);var rM=this.ctx;null!=rS&&(rM.fillStyle=rS,rm.isWebGL?rM.fill(rl):rM.fill()),null!=rQ&&0<re&&(rM.strokeStyle=rQ,rM.lineWidth=re,rM.stroke())},rS.clipRect=function(rS,rQ,re,rl){this.ctx.clipRect(rS+this.x,rQ+this.y,re,rl)},rS.fillRect=function(rS,rQ,re,rl,rM){this.ctx.fillRect(rS+this.x,rQ+this.y,re,rl,rM)},rS.drawCircle=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=1),rN.drawCall++;var rd=this.ctx;rd.beginPath(),rd.strokeStyle=rl,rd.lineWidth=rM,rd.arc(rS+this.x,rQ+this.y,re,0,rT.PI2),rd.stroke()},rS.drawTriangles=function(rS,rQ,re){if(rm.isWebGL)this.ctx.drawTriangles(re[0],rS+re[1],rQ+re[2],re[3],re[4],re[5],re[6],re[7],re[8],re[9]);else{var rl=re[5],rM=0,rd=rl.length,rT=this.ctx;for(rM=0;rM<rd;rM+=3){var rU=2*rl[rM],ri=2*rl[rM+1],rR=2*rl[rM+2];rT.drawTriangle(re[0],re[3],re[4],rU,ri,rR,re[6],!0)}}},rS.fillCircle=function(rS,rQ,re,rl){rN.drawCall++;var rM=this.ctx;rM.beginPath(),rM.fillStyle=rl,rM.arc(rS+this.x,rQ+this.y,re,0,rT.PI2),rM.fill()},rS.setShader=function(rS){this.ctx.setShader(rS)},rS.drawLine=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=1);var rT=this.ctx;rT.beginPath(),rT.strokeStyle=rM,rT.lineWidth=rd,rT.moveTo(this.x+rS,this.y+rQ),rT.lineTo(this.x+re,this.y+rl),rT.stroke()},rS.clear=function(){this.ctx.clear()},rS.transformByMatrix=function(rS){this.ctx.transformByMatrix(rS)},rS.setTransform=function(rS,rQ,re,rl,rM,rd){this.ctx.setTransform(rS,rQ,re,rl,rM,rd)},rS.setTransformByMatrix=function(rS){this.ctx.setTransformByMatrix(rS)},rS.save=function(){this.ctx.save()},rS.restore=function(){this.ctx.restore()},rS.translate=function(rS,rQ){this.ctx.translate(rS,rQ)},rS.transform=function(rS,rQ,re,rl,rM,rd){this.ctx.transform(rS,rQ,re,rl,rM,rd)},rS.rotate=function(rS){this.ctx.rotate(rS)},rS.scale=function(rS,rQ){this.ctx.scale(rS,rQ)},rS.alpha=function(rS){this.ctx.globalAlpha*=rS},rS.setAlpha=function(rS){this.ctx.globalAlpha=rS},rS.fillWords=function(rS,rQ,re,rl,rM,rd){void 0===rd&&(rd=0),this.ctx.fillWords(rS,rQ,re,rl,rM,rd)},rS.fillBorderWords=function(rS,rQ,re,rl,rM,rd,rT){this.ctx.fillBorderWords(rS,rQ,re,rl,rM,rd,rT)},rS.fillText=function(rS,rQ,re,rl,rM,rd){this.ctx.fillText(rS,rQ+this.x,re+this.y,rl,rM,rd)},rS.strokeText=function(rS,rQ,re,rl,rM,rd,rT){this.ctx.strokeText(rS,rQ+this.x,re+this.y,rl,rM,rd,rT)},rS.blendMode=function(rS){this.ctx.globalCompositeOperation=rS},rS.flush=function(){this.ctx.flush&&this.ctx.flush()},rS.addRenderObject=function(rS){this.ctx.addRenderObject(rS)},rS.beginClip=function(rS,rQ,re,rl){this.ctx.beginClip&&this.ctx.beginClip(rS,rQ,re,rl)},rS.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},rS.fillTrangles=function(rS,rQ,re){this.ctx.fillTrangles(re[0],re[1],re[2],re[3],4<re.length?re[4]:null)},rT.PI2=2*Math.PI,rT}(),rn=function(){function rT(rS,rQ){switch(this._next=rQ||rT.NORENDER,rS){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=rG._filter);case 69905:return void(this._fun=rT._initRenderFun)}this.onCreate(rS)}rj(rT,"laya.renders.RenderSprite");var rS=rT.prototype;return rS.onCreate=function(rS){},rS._style=function(rS,rQ,re,rl){rS._style.render(rS,rQ,re,rl);var rM=this._next;rM._fun.call(rM,rS,rQ,re,rl)},rS._no=function(rS,rQ,re,rl){},rS._custom=function(rS,rQ,re,rl){rS.customRender(rQ,re,rl);var rM=rS._style._tf;this._next._fun.call(this._next,rS,rQ,re-rM.translateX,rl-rM.translateY)},rS._clip=function(rS,rQ,re,rl){var rM=this._next;if(rM!=rT.NORENDER){var rd=rS._style.scrollRect;rQ.ctx.save(),rQ.ctx.clipRect(re,rl,rd.width,rd.height),rM._fun.call(rM,rS,rQ,re-rd.x,rl-rd.y),rQ.ctx.restore()}},rS._blend=function(rS,rQ,re,rl){var rM=rS._style;rM.blendMode&&(rQ.ctx.globalCompositeOperation=rM.blendMode);var rd=this._next;rd._fun.call(rd,rS,rQ,re,rl),rQ.ctx.globalCompositeOperation="source-over"},rS._mask=function(rS,rQ,re,rl){var rM=this._next;rM._fun.call(rM,rS,rQ,re,rl);var rd=rS.mask;rd&&(rQ.ctx.globalCompositeOperation="destination-in",(0<rd.numChildren||!rd.graphics._isOnlyOne())&&(rd.cacheAsBitmap=!0),rd.render(rQ,re-rS.pivotX,rl-rS.pivotY)),rQ.ctx.globalCompositeOperation="source-over"},rS._graphics=function(rS,rQ,re,rl){var rM=rS._style._tf;rS._graphics&&rS._graphics._render(rS,rQ,re-rM.translateX,rl-rM.translateY);var rd=this._next;rd._fun.call(rd,rS,rQ,re,rl)},rS._image=function(rS,rQ,re,rl){var rM=rS._style;rQ.ctx.drawTexture2(re,rl,rM._tf.translateX,rM._tf.translateY,rS.transform,rM.alpha,rM.blendMode,rS._graphics._one)},rS._image2=function(rS,rQ,re,rl){var rM=rS._style._tf;rQ.ctx.drawTexture2(re,rl,rM.translateX,rM.translateY,rS.transform,1,null,rS._graphics._one)},rS._alpha=function(rS,rQ,re,rl){var rM;if(.01<(rM=rS._style.alpha)||rS._needRepaint()){var rd=rQ.ctx.globalAlpha;rQ.ctx.globalAlpha*=rM;var rT=this._next;rT._fun.call(rT,rS,rQ,re,rl),rQ.ctx.globalAlpha=rd}},rS._transform=function(rS,rQ,re,rl){var rM=rS.transform,rd=this._next;rM&&rd!=rT.NORENDER?(rQ.save(),rQ.transform(rM.a,rM.b,rM.c,rM.d,rM.tx+re,rM.ty+rl),rd._fun.call(rd,rS,rQ,0,0),rQ.restore()):rd._fun.call(rd,rS,rQ,re,rl)},rS._childs=function(rS,rQ,re,rl){var rM=rS._style,rd=rM._tf;if(re=re-rd.translateX+rM.paddingLeft,rl=rl-rd.translateY+rM.paddingTop,rM._calculation){var rT=rS._getWords();if(rT){var rU=rM;rU&&(rU.stroke?rQ.fillBorderWords(rT,re,rl,rU.font,rU.color,rU.strokeColor,rU.stroke):rQ.fillWords(rT,re,rl,rU.font,rU.color,"none"!=rU.textDecoration&&rU.underLine?1:0))}}var ri,rR=rS._childs,ro=rR.length;if(rS.viewport||rS.optimizeScrollRect&&rS._style.scrollRect){var rY=rS.viewport||rS._style.scrollRect,rp=rY.x,rJ=rY.y,rL=rY.right,rj=rY.bottom,rc=NaN,rG=NaN;for(rz=0;rz<ro;++rz)(ri=rR[rz]).visible&&(rc=ri._x)<rL&&rc+ri.width>rp&&(rG=ri._y)<rj&&rG+ri.height>rJ&&ri.render(rQ,re,rl)}else for(var rz=0;rz<ro;++rz)(ri=rR[rz])._style.visible&&ri.render(rQ,re,rl)},rS._canvas=function(rS,rQ,re,rl){var rM=rS._$P.cacheCanvas;if(rM){"bitmap"===rM.type?rN.canvasBitmap++:rN.canvasNormal++;var rd=rM.ctx;if(rS._needRepaint()||!rd)this._canvas_repaint(rS,rQ,re,rl);else{var rT=rM._cacheRec;rQ.drawCanvas(rd.canvas,re+rT.x,rl+rT.y,rT.width,rT.height)}}else this._next._fun.call(this._next,rS,rQ,re,rl)},rS._canvas_repaint=function(rS,rQ,re,rl){var rM=rS._$P.cacheCanvas,rd=this._next;if(rM){var rT,rU,ri,rR,ro=rM.ctx,rY=rS._needRepaint()||!ro,rp=rM.type;if("bitmap"===rp?rN.canvasBitmap++:rN.canvasNormal++,rY){var rJ,rL;rM._cacheRec||(rM._cacheRec=new rg),rm.isWebGL&&"bitmap"!==rp?rM._cacheRec.setTo(-rS.pivotX,-rS.pivotY,1,1):((rR=rS.getSelfBounds()).x=rR.x-rS.pivotX,rR.y=rR.y-rS.pivotY,rR.x=rR.x-16,rR.y=rR.y-16,rR.width=rR.width+32,rR.height=rR.height+32,rR.x=Math.floor(rR.x+re)-re,rR.y=Math.floor(rR.y+rl)-rl,rR.width=Math.floor(rR.width),rR.height=Math.floor(rR.height),rM._cacheRec.copyFrom(rR)),rR=rM._cacheRec;var rj,rc=rm.isWebGL?1:rf.pixelRatio*rO.stage.clientScaleX,rG=rm.isWebGL?1:rf.pixelRatio*rO.stage.clientScaleY;if(!rm.isWebGL){var rz,rA=1,rv=1;for(rz=rS;rz&&rz!=rO.stage;)rA*=rz.scaleX,rv*=rz.scaleY,rz=rz.parent;rm.isWebGL?(rA<1&&(rc*=rA),rv<1&&(rG*=rv)):(1<rA&&(rc*=rA),1<rv&&(rG*=rv))}if(rS.scrollRect){var rD=rS.scrollRect;rR.x-=rD.x,rR.y-=rD.y}if(rJ=rR.width*rc,rL=rR.height*rG,rU=rR.x,ri=rR.y,rm.isWebGL&&"bitmap"===rp&&(2048<rJ||2048<rL))return console.warn("cache bitmap size larger than 2048,cache ignored"),rM.ctx&&(rZ.recover("RenderContext",rM.ctx),rM.ctx.canvas.size(0,0),rM.ctx=null),void rd._fun.call(rd,rS,rQ,re,rl);if(ro||(ro=rM.ctx=rZ.getItem("RenderContext")||new r$(rJ,rL,rAS.create("AUTO"))),ro.ctx.sprite=rS,(rT=ro.canvas).clear(),(rT.width!=rJ||rT.height!=rL)&&rT.size(rJ,rL),"bitmap"===rp?rT.context.asBitmap=!0:"normal"===rp&&(rT.context.asBitmap=!1),1!=rc||1!=rG){var rB=ro.ctx;rB.save(),rB.scale(rc,rG),!rm.isConchWebGL&&rm.isConchApp&&(rj=rS._$P.cf)&&rB.setFilterMatrix&&rB.setFilterMatrix(rj._mat,rj._alpha),rd._fun.call(rd,rS,ro,-rU,-ri),rB.restore(),rm.isConchApp&&!rm.isConchWebGL||rS._applyFilters()}else rB=ro.ctx,!rm.isConchWebGL&&rm.isConchApp&&(rj=rS._$P.cf)&&rB.setFilterMatrix&&rB.setFilterMatrix(rj._mat,rj._alpha),rd._fun.call(rd,rS,ro,-rU,-ri),rm.isConchApp&&!rm.isConchWebGL||rS._applyFilters();rS._$P.staticCache&&(rM.reCache=!1),rN.canvasReCache++}else rU=(rR=rM._cacheRec).x,ri=rR.y,rT=ro.canvas;rQ.drawCanvas(rT,re+rU,rl+ri,rR.width,rR.height)}else rd._fun.call(rd,rS,ro,re,rl)},rT.__init__=function(){var rS,rQ,re=0;for(rQ=rk.createRenderSprite(69905,null),rS=rT.renders.length=4096,re=0;re<rS;re++)rT.renders[re]=rQ;rT.renders[0]=rk.createRenderSprite(0,null),function(rS,rQ){for(var re=0,rl=0;rl<rS.length;rl++)re|=rS[rl],rT.renders[re]=rQ}([1,512,4,2],new rT(1,null)),rT.renders[513]=rk.createRenderSprite(513,null),rT.renders[517]=new rT(517,null)},rT._initRenderFun=function(rS,rQ,re,rl){var rM=rS._renderType;(rT.renders[rM]=rT._getTypeRender(rM))._fun(rS,rQ,re,rl)},rT._getTypeRender=function(rS){for(var rQ=null,re=2048;1<re;)re&rS&&(rQ=rk.createRenderSprite(re,rQ)),re>>=1;return rQ},rT.IMAGE=1,rT.ALPHA=2,rT.TRANSFORM=4,rT.BLEND=8,rT.CANVAS=16,rT.FILTERS=32,rT.MASK=64,rT.CLIP=128,rT.STYLE=256,rT.GRAPHICS=512,rT.CUSTOM=1024,rT.CHILDS=2048,rT.INIT=69905,rT.renders=[],rT.NORENDER=new rT(0,null),rT}(),rP=function(){function rU(){this._repaint=!1}rj(rU,"laya.resource.Context");var rS=rU.prototype;return rS.replaceReset=function(){var rS,rQ,re=0;for(rS=rU.replaceKeys.length,re=0;re<rS;re++)rQ=rU.replaceKeys[re],this[rU.newKeys[re]]=this[rQ]},rS.replaceResotre=function(){this.__restore(),this.__reset()},rS.setIsMainContext=function(){},rS.drawTextures=function(rS,rQ,re,rl){rN.drawCall+=rQ.length/2;for(var rM=rS.width,rd=rS.height,rT=0,rU=rQ.length;rT<rU;rT+=2)this.drawTexture(rS,rQ[rT],rQ[rT+1],rM,rd,re,rl)},rS.drawCanvas=function(rS,rQ,re,rl,rM){rN.drawCall++,this.drawImage(rS.source,rQ,re,rl,rM)},rS.fillRect=function(rS,rQ,re,rl,rM){rN.drawCall++,rM&&(this.fillStyle=rM),this.__fillRect(rS,rQ,re,rl)},rS.fillText=function(rS,rQ,re,rl,rM,rd){rN.drawCall++,3<arguments.length&&null!=rl&&(this.font=rl,this.fillStyle=rM,this.textAlign=rd,this.textBaseline="top"),this.__fillText(rS,rQ,re)},rS.fillBorderText=function(rS,rQ,re,rl,rM,rd,rT,rU){rN.drawCall++,this.font=rl,this.fillStyle=rM,this.textBaseline="top",this.strokeStyle=rd,this.lineWidth=rT,this.textAlign=rU,this.__strokeText(rS,rQ,re),this.__fillText(rS,rQ,re)},rS.strokeText=function(rS,rQ,re,rl,rM,rd,rT){rN.drawCall++,3<arguments.length&&null!=rl&&(this.font=rl,this.strokeStyle=rM,this.lineWidth=rd,this.textAlign=rT,this.textBaseline="top"),this.__strokeText(rS,rQ,re)},rS.transformByMatrix=function(rS){this.transform(rS.a,rS.b,rS.c,rS.d,rS.tx,rS.ty)},rS.setTransformByMatrix=function(rS){this.setTransform(rS.a,rS.b,rS.c,rS.d,rS.tx,rS.ty)},rS.clipRect=function(rS,rQ,re,rl){rN.drawCall++,this.beginPath(),this.rect(rS,rQ,re,rl),this.clip()},rS.drawTexture=function(rS,rQ,re,rl,rM,rd,rT){rN.drawCall++;var rU=rS.uv,ri=rS.bitmap.width,rR=rS.bitmap.height;this.drawImage(rS.source,rU[0]*ri,rU[1]*rR,(rU[2]-rU[0])*ri,(rU[5]-rU[3])*rR,rQ+rd,re+rT,rl,rM)},rS.drawTextureWithTransform=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){rN.drawCall++;var rR=rS.uv,ro=rS.bitmap.width,rY=rS.bitmap.height;this.save(),1!=ri&&(this.globalAlpha*=ri),rd?(this.transform(rd.a,rd.b,rd.c,rd.d,rd.tx+rT,rd.ty+rU),this.drawImage(rS.source,rR[0]*ro,rR[1]*rY,(rR[2]-rR[0])*ro,(rR[5]-rR[3])*rY,rQ,re,rl,rM)):this.drawImage(rS.source,rR[0]*ro,rR[1]*rY,(rR[2]-rR[0])*ro,(rR[5]-rR[3])*rY,rQ+rT,re+rU,rl,rM),this.restore()},rS.drawTexture2=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=rU[0];if(ri.loaded&&ri.bitmap&&ri.source){rN.drawCall++;var rR=1!==rd;if(rR){var ro=this.globalAlpha;this.globalAlpha*=rd}var rY=ri.uv,rp=ri.bitmap.width,rJ=ri.bitmap.height;rM?(this.save(),this.transform(rM.a,rM.b,rM.c,rM.d,rM.tx+rS,rM.ty+rQ),this.drawImage(ri.source,rY[0]*rp,rY[1]*rJ,(rY[2]-rY[0])*rp,(rY[5]-rY[3])*rJ,rU[1]-re,rU[2]-rl,rU[3],rU[4]),this.restore()):this.drawImage(ri.source,rY[0]*rp,rY[1]*rJ,(rY[2]-rY[0])*rp,(rY[5]-rY[3])*rJ,rU[1]-re+rS,rU[2]-rl+rQ,rU[3],rU[4]),rR&&(this.globalAlpha=ro)}},rS.fillTexture=function(rS,rQ,re,rl,rM,rd,rT,rU){if(!rU.pat){if(rS.uv!=roS.DEF_UV){var ri=new rAS("2D");ri.getContext("2d"),ri.size(rS.width,rS.height),ri.context.drawTexture(rS,0,0,rS.width,rS.height,0,0),rS=new roS(ri)}rU.pat=this.createPattern(rS.bitmap.source,rd)}var rR=rQ,ro=re,rY=0,rp=0;rT&&(rR+=rT.x%rS.width,ro+=rT.y%rS.height,rY-=rT.x%rS.width,rp-=rT.y%rS.height),this.translate(rR,ro),this.fillRect(rY,rp,rl,rM,rU.pat),this.translate(-rR,-ro)},rS.drawTriangle=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=rS.bitmap,rR=ri.source,ro=rS.width,rY=rS.height,rp=ri.width,rJ=ri.height,rL=re[rl]*rp,rj=re[rM]*rp,rc=re[rd]*rp,rG=re[rl+1]*rJ,rz=re[rM+1]*rJ,rA=re[rd+1]*rJ,rv=rQ[rl],rD=rQ[rM],rB=rQ[rd],rO=rQ[rl+1],rH=rQ[rM+1],rg=rQ[rd+1];if(rU){var rI=(rv+rD+rB)/3,rE=(rO+rH+rg)/3,rt=rv-rI,rk=rO-rE,rX=Math.sqrt(rt*rt+rk*rk);rv=rI+rt/rX*(rX+1),rO=rE+rk/rX*(rX+1),rk=rH-rE,rD=rI+(rt=rD-rI)/(rX=Math.sqrt(rt*rt+rk*rk))*(rX+1),rH=rE+rk/rX*(rX+1),rk=rg-rE,rB=rI+(rt=rB-rI)/(rX=Math.sqrt(rt*rt+rk*rk))*(rX+1),rg=rE+rk/rX*(rX+1)}this.save(),rT&&this.transform(rT.a,rT.b,rT.c,rT.d,rT.tx,rT.ty),this.beginPath(),this.moveTo(rv,rO),this.lineTo(rD,rH),this.lineTo(rB,rg),this.closePath(),this.clip();var rh=1/(rL*rz+rG*rc+rj*rA-rz*rc-rG*rj-rL*rA),rb=rv*rz+rG*rB+rD*rA-rz*rB-rG*rD-rv*rA,rm=rL*rD+rv*rc+rj*rB-rD*rc-rv*rj-rL*rB,r$=rL*rz*rB+rG*rD*rc+rv*rj*rA-rv*rz*rc-rG*rj*rB-rL*rD*rA,rn=rO*rz+rG*rg+rH*rA-rz*rg-rG*rH-rO*rA,rP=rL*rH+rO*rc+rj*rg-rH*rc-rO*rj-rL*rg,ra=rL*rz*rg+rG*rH*rc+rO*rj*rA-rO*rz*rc-rG*rj*rg-rL*rH*rA;this.transform(rb*rh,rn*rh,rm*rh,rP*rh,r$*rh,ra*rh),this.drawImage(rR,rS.uv[0]*rp,rS.uv[1]*rJ,ro,rY,rS.uv[0]*rp,rS.uv[1]*rJ,ro,rY),this.restore()},rS.flush=function(){return 0},rS.fillWords=function(rS,rQ,re,rl,rM,rd){rl&&(this.font=rl),rM&&(this.fillStyle=rM);this.textBaseline="top",this.textAlign="left";for(var rT=0,rU=rS.length;rT<rU;rT++){var ri=rS[rT];if(this.__fillText(ri.char,ri.x+rQ,ri.y+re),1===rd){var rR=ri.height,ro=.5*ri.style.letterSpacing;ro||(ro=0),this.beginPath(),this.strokeStyle=rM,this.lineWidth=1,this.moveTo(rQ+ri.x-ro+.5,re+ri.y+rR+.5),this.lineTo(rQ+ri.x+ri.width+ro+.5,re+ri.y+rR+.5),this.stroke()}}},rS.fillBorderWords=function(rS,rQ,re,rl,rM,rd,rT){rl&&(this.font=rl),rM&&(this.fillStyle=rM),this.textBaseline="top",this.lineWidth=rT,this.textAlign="left",this.strokeStyle=rd;for(var rU=0,ri=rS.length;rU<ri;rU++){var rR=rS[rU];this.__strokeText(rR.char,rR.x+rQ,rR.y+re),this.__fillText(rR.char,rR.x+rQ,rR.y+re)}},rS.destroy=function(){this.canvas.width=this.canvas.height=0},rS.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},rS.drawCurves=function(rS,rQ,re){this.beginPath(),this.strokeStyle=re[3],this.lineWidth=re[4];var rl=re[2];rS+=re[0],rQ+=re[1],this.moveTo(rS+rl[0],rQ+rl[1]);for(var rM=2,rd=rl.length;rM<rd;)this.quadraticCurveTo(rS+rl[rM++],rQ+rl[rM++],rS+rl[rM++],rQ+rl[rM++]);this.stroke()},rU.__init__=function(rQ){var re=laya.resource.Context.prototype;if(!(rQ=rQ||CanvasRenderingContext2D.prototype).inited){rQ.inited=!0,rQ.__fillText=rQ.fillText,rQ.__fillRect=rQ.fillRect,rQ.__strokeText=rQ.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(rS){rQ[rS]=re[rS]})}},rU.replaceCanvasGetSet=function(rS,rQ){var re=Object.getOwnPropertyDescriptor(rS,rQ);if(!re||!re.configurable)return!1;var rl,rM={};for(rl in re)"set"!=rl&&(rM[rl]=re[rl]);var rd=re.set;return rM.set=function(rS){rd.call(this,rS);var rQ=this.getContext("2d");rQ&&"__reset"in rQ&&rQ.__reset()},Object.defineProperty(rS,rQ,rM),!0},rU.replaceGetSet=function(rS,rQ){var re=Object.getOwnPropertyDescriptor(rS,rQ);if(!re||!re.configurable)return!1;var rl,rM={};for(rl in re)"set"!=rl&&(rM[rl]=re[rl]);var rd=re.set,rT="___"+rQ+"__";return rU.newKeys.push(rT),rM.set=function(rS){rS!=this[rT]&&(this[rT]=rS,rd.call(this,rS))},Object.defineProperty(rS,rQ,rM),!0},rU._default=new rU,rU.newKeys=[],ri(rU,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),rU}(),ra=function(){function rd(rS){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++rd._uniqueIDCounter,this._name=rS||"Content Manager",rd._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,rd._resourceManagers.push(this),this._resources=[],this._records={}}rj(rd,"laya.resource.ResourceManager");var rS=rd.prototype;return rO.imps(rS,{"laya.resource.IDispose":!0}),rS.getResourceByIndex=function(rS){return this._resources[rS]},rS.getResourcesLength=function(){return this._resources.length},rS.addResource=function(rS){return rS.resourceManager&&rS.resourceManager.removeResource(rS),-1===this._resources.indexOf(rS)&&((rS._resourceManager=this)._resources.push(rS),this.addRecord(rS.uri,rS.__className,rS.memorySize),this.addSize(rS.memorySize),!0)},rS.removeResource=function(rS){var rQ=this._resources.indexOf(rS);return-1!==rQ&&(this._resources.splice(rQ,1),rS._resourceManager=null,this._memorySize-=rS.memorySize,this.addRecord(rS.uri,rS.__className,-rS.memorySize),!0)},rS.unload=function(){for(var rS=this._resources.slice(0,this._resources.length),rQ=0;rQ<rS.length;rQ++){rS[rQ].destroy()}rS.length=0},rS.dispose=function(){if(this===rd._systemResourceManager)throw new Error("systemResourceManager不能被释放！");rd._resourceManagers.splice(rd._resourceManagers.indexOf(this),1),rd._isResourceManagersSorted=!1;for(var rS=this._resources.slice(0,this._resources.length),rQ=0;rQ<rS.length;rQ++){var re=rS[rQ];re.resourceManager.removeResource(re),re.destroy()}rS.length=0},rS.addSize=function(rS){rS&&(this.autoRelease&&0<rS&&this._memorySize+rS>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=rS)},rS.addRecord=function(rS,rQ,re){DEBUG&&re&&!rS&&console.error(rS,rQ,re),rS&&(this._records.hasOwnProperty(rQ+"|"+rS)||(this._records[rQ+"|"+rS]=0),this._records[rQ+"|"+rS]+=re,DEBUG&&this._records[rQ+"|"+rS]<0&&console.error(rS,rQ,this._records[rQ+"|"+rS]))},rS.garbageCollection=function(rS){var rQ=this._resources;(rQ=rQ.slice()).sort(function(rS,rQ){if(!rS||!rQ)throw new Error("a或b不能为空！");return rS.released&&rQ.released?0:rS.released?1:rQ.released?-1:rS._lastUseFrameCount-rQ._lastUseFrameCount});for(var re=rN.loopCount,rl=0,rM=rQ.length;rl<rM;rl++){var rd=rQ[rl];if(!(1<re-rd._lastUseFrameCount))return void(this._memorySize>=rS&&(this._isOverflow=!0));if(rd.releaseResource(),this._memorySize<rS)return void(this._isOverflow=!1)}},ro(0,rS,"id",function(){return this._id}),ro(0,rS,"name",function(){return this._name},function(rS){!rS&&""===rS||this._name===rS||(this._name=rS,rd._isResourceManagersSorted=!1)}),ro(0,rS,"memorySize",function(){return this._memorySize}),ro(0,rS,"records",function(){return this._records}),ro(1,rd,"systemResourceManager",function(){return rd._systemResourceManager}),rd.__init__=function(){rd.currentResourceManager=rd.systemResourceManager},rd.getLoadedResourceManagerByIndex=function(rS){return rd._resourceManagers[rS]},rd.getLoadedResourceManagersCount=function(){return rd._resourceManagers.length},rd.recreateContentManagers=function(rS){void 0===rS&&(rS=!1);for(var rQ=rd.currentResourceManager,re=0;re<rd._resourceManagers.length;re++){rd.currentResourceManager=rd._resourceManagers[re];for(var rl=0;rl<rd.currentResourceManager._resources.length;rl++)rd.currentResourceManager._resources[rl].releaseResource(rS),rd.currentResourceManager._resources[rl].activeResource(rS)}rd.currentResourceManager=rQ},rd.releaseContentManagers=function(rS){void 0===rS&&(rS=!1);for(var rQ=rd.currentResourceManager,re=0;re<rd._resourceManagers.length;re++){rd.currentResourceManager=rd._resourceManagers[re];for(var rl=0;rl<rd.currentResourceManager._resources.length;rl++){var rM=rd.currentResourceManager._resources[rl];!rM.released&&rM.releaseResource(rS)}}rd.currentResourceManager=rQ},rd._uniqueIDCounter=0,rd._isResourceManagersSorted=!1,rd._resourceManagers=[],ri(rd,["_systemResourceManager",function(){return this._systemResourceManager=new rd("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=rd._systemResourceManager}]),rd}(),rf=(function(){function rS(){}rj(rS,"laya.system.System"),rS.changeDefinition=function(rS,rQ){rO[rS]=rQ;var re=rS+"=classObj";rO._runScript(re)},rS.__init__=function(){rm.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function re(){}return rj(re,"laya.utils.Browser"),ro(1,re,"pixelRatio",function(){return re.__init__(),-1<re.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:rk.getPixelRatio()}),ro(1,re,"height",function(){return re.__init__(),(rO.stage&&rO.stage.canvasRotation?re.clientWidth:re.clientHeight)*re.pixelRatio}),ro(1,re,"clientWidth",function(){return re.__init__(),re.window.innerWidth||re.document.body.clientWidth}),ro(1,re,"window",function(){return re.__init__(),re._window}),ro(1,re,"clientHeight",function(){return re.__init__(),re.window.innerHeight||re.document.body.clientHeight||re.document.documentElement.clientHeight}),ro(1,re,"width",function(){return re.__init__(),(rO.stage&&rO.stage.canvasRotation?re.clientHeight:re.clientWidth)*re.pixelRatio}),ro(1,re,"container",function(){return re.__init__(),re._container||((re._container=re.createElement("div")).id="layaContainer",re.document.body.appendChild(re._container)),re._container},function(rS){re._container=rS}),ro(1,re,"document",function(){return re.__init__(),re._document}),re.__init__=function(){if(!re._window){re._window=rk.getWindow(),re._document=re.window.document,re._window.addEventListener("message",function(rS){laya.utils.Browser._onMessage(rS)},!1),re.document.__createElement=re.document.createElement,rT.requestAnimationFrame=rT.requestAnimationFrame||rT.webkitRequestAnimationFrame||rT.mozRequestAnimationFrame||rT.oRequestAnimationFrame||rT.msRequestAnimationFrame||function(rS){return rT.setTimeout(rS,1e3/60)};var rS=rT.document.body.style;rS["-webkit-user-select"]="none",rS["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",re.userAgent=re.window.navigator.userAgent,re.onIOS=!!(re.u=re.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),re.onMobile=-1<re.u.indexOf("Mobile"),re.onIPhone=-1<re.u.indexOf("iPhone"),re.onMac=-1<re.u.indexOf("Mac OS X"),re.onIPad=-1<re.u.indexOf("iPad"),re.onAndroid=-1<re.u.indexOf("Android")||-1<re.u.indexOf("Adr"),re.onWP=-1<re.u.indexOf("Windows Phone"),re.onQQBrowser=-1<re.u.indexOf("QQBrowser"),re.onMQQBrowser=-1<re.u.indexOf("MQQBrowser")||-1<re.u.indexOf("Mobile")&&-1<re.u.indexOf("QQ"),re.onIE=!!re.window.ActiveXObject||"ActiveXObject"in re.window,re.onWeiXin=-1<re.u.indexOf("MicroMessenger"),re.onPC=!re.onMobile,re.onSafari=-1<re.u.indexOf("Safari"),re.onFirefox=-1<re.u.indexOf("Firefox"),re.onEdge=-1<re.u.indexOf("Edge"),re.onMiniGame=-1<re.u.indexOf("MiniGame"),re.onLimixiu=-1<re.u.indexOf("limixiu"),re.httpProtocol="http:"==re.window.location.protocol,re.onMiniGame&&null==re.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),re.webAudioEnabled=!!(re.window.AudioContext||re.window.webkitAudioContext||re.window.mozAudioContext),re.soundType=re.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",rMS=re.webAudioEnabled?rdS:reS,re.webAudioEnabled&&rdS.initWebAudio(),reS._initMusicAudio(),re.enableTouch="ontouchstart"in rT||rT.DocumentTouch&&rQ instanceof DocumentTouch,rT.focus(),rt._soundClass=rMS,rt._musicClass=reS,rm._mainCanvas=rm._mainCanvas||rAS.create("2D"),re.canvas||(re.canvas=rAS.create("2D"),re.context=re.canvas.getContext("2d"))}},re._onMessage=function(rS){if(rS.data&&"size"==rS.data.name){if(re.window.innerWidth=rS.data.width,re.window.innerHeight=rS.data.height,re.window.__innerHeight=rS.data.clientHeight,!re.document.createEvent)return void console.warn("no document.createEvent");var rQ=re.document.createEvent("HTMLEvents");return rQ.initEvent("resize",!1,!1),void re.window.dispatchEvent(rQ)}},re.createElement=function(rS){return re.__init__(),re.document.__createElement(rS)},re.getElementById=function(rS){return re.__init__(),re.document.getElementById(rS)},re.removeElement=function(rS){rS&&rS.parentNode&&rS.parentNode.removeChild(rS)},re.now=function(){return rk.now()},re._window=null,re._document=null,re._container=null,re.userAgent=null,re.u=null,re.onIOS=!1,re.onMac=!1,re.onMobile=!1,re.onIPhone=!1,re.onIPad=!1,re.onAndroid=!1,re.onWP=!1,re.onQQBrowser=!1,re.onMQQBrowser=!1,re.onSafari=!1,re.onFirefox=!1,re.onEdge=!1,re.onIE=!1,re.onWeiXin=!1,re.onMiniGame=!1,re.onLimixiu=!1,re.onPC=!1,re.httpProtocol=!1,re.webAudioEnabled=!1,re.soundType=null,re.enableTouch=!1,re.canvas=null,re.context=null,re.__init$=function(){},re}()),rw=function(){function rQ(rS){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,rS?(this._u8d_=new Uint8Array(rS),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}rj(rQ,"laya.utils.Byte");var rS=rQ.prototype;return rS.___resizeBuffer=function(rQ){try{var rS=new Uint8Array(rQ);null!=this._u8d_&&(this._u8d_.length<=rQ?rS.set(this._u8d_):rS.set(this._u8d_.subarray(0,rQ))),this._u8d_=rS,this._d_=new DataView(rS.buffer)}catch(rS){throw"___resizeBuffer err:"+rQ}},rS.getString=function(){return this.rUTF(this.getUint16())},rS.getFloat32Array=function(rS,rQ){var re=rS+rQ;re=re>this._length?this._length:re;var rl=new Float32Array(this._d_.buffer.slice(rS,re));return this._pos_=re,rl},rS.getUint8Array=function(rS,rQ){var re=rS+rQ;re=re>this._length?this._length:re;var rl=new Uint8Array(this._d_.buffer.slice(rS,re));return this._pos_=re,rl},rS.getInt16Array=function(rS,rQ){var re=rS+rQ;re=re>this._length?this._length:re;var rl=new Int16Array(this._d_.buffer.slice(rS,re));return this._pos_=re,rl},rS.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var rS=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,rS},rS.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var rS=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,rS},rS.writeFloat32=function(rS){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,rS,this._xd_),this._pos_+=4},rS.writeFloat64=function(rS){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,rS,this._xd_),this._pos_+=8},rS.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var rS=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,rS},rS.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var rS=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,rS},rS.writeInt32=function(rS){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,rS,this._xd_),this._pos_+=4},rS.writeUint32=function(rS){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,rS,this._xd_),this._pos_+=4},rS.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var rS=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,rS},rS.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var rS=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,rS},rS.writeUint16=function(rS){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,rS,this._xd_),this._pos_+=2},rS.writeInt16=function(rS){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,rS,this._xd_),this._pos_+=2},rS.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},rS.writeUint8=function(rS){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,rS),this._pos_++},rS._getUInt8=function(rS){return this._d_.getUint8(rS)},rS._getUint16=function(rS){return this._d_.getUint16(rS,this._xd_)},rS._getMatrix=function(){return new rX(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},rS.rUTF=function(rS){for(var rQ=[],re=this._pos_+rS,rl=0,rM=0,rd=0,rT=String.fromCharCode,rU=this._u8d_;this._pos_<re;)(rl=rU[this._pos_++])<128?0!=rl&&rQ.push(rT(rl)):rl<224?rQ.push(rT((63&rl)<<6|127&rU[this._pos_++])):rl<240?(rM=rU[this._pos_++],rQ.push(rT((31&rl)<<12|(127&rM)<<6|127&rU[this._pos_++]))):(rM=rU[this._pos_++],rd=rU[this._pos_++],rQ.push(rT((15&rl)<<18|(127&rM)<<12|rd<<6&127|127&rU[this._pos_++]))),0;return rQ.join("")},rS.getCustomString=function(rS){for(var rQ=[],re=0,rl=0,rM=0,rd=String.fromCharCode,rT=this._u8d_;0<rS;)if((rl=rT[this._pos_])<128)rQ.push(rd(rl)),this._pos_++,rS--;else for(re=rl-128,this._pos_++,rS-=re;0<re;)rl=rT[this._pos_++],rM=rT[this._pos_++],rQ.push(rd(rM<<8|rl)),re--;return rQ.join("")},rS.clear=function(){this._pos_=0,this.length=0},rS.__getBuffer=function(){return this._d_.buffer},rS.writeUTFBytes=function(rS){for(var rQ=0,re=(rS+="").length;rQ<re;rQ++){var rl=rS.charCodeAt(rQ);rl<=127?this.writeByte(rl):rl<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|rl>>6,128|63&rl],this._pos_),this._pos_+=2):rl<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|rl>>12,128|rl>>6&63,128|63&rl],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|rl>>18,128|rl>>12&63,128|rl>>6&63,128|63&rl],this._pos_),this._pos_+=4)}},rS.writeUTFString=function(rS){var rQ=this.pos;this.writeUint16(1),this.writeUTFBytes(rS);var re=this.pos-rQ-2;if(65536<=re)throw"writeUTFString byte len more than 65536";this._d_.setUint16(rQ,re,this._xd_)},rS.readUTFString=function(){return this.readUTFBytes(this.getUint16())},rS.getUTFString=function(){return this.readUTFString()},rS.readUTFBytes=function(rS){if(void 0===rS&&(rS=-1),0==rS)return"";var rQ=this.bytesAvailable;if(rQ<rS)throw"readUTFBytes error - Out of bounds";return rS=0<rS?rS:rQ,this.rUTF(rS)},rS.getUTFBytes=function(rS){return void 0===rS&&(rS=-1),this.readUTFBytes(rS)},rS.writeByte=function(rS){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,rS),this._pos_+=1},rS.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},rS.getByte=function(){return this.readByte()},rS.ensureWrite=function(rS){this._length<rS&&(this._length=rS),this._allocated_<rS&&(this.length=rS)},rS.writeArrayBuffer=function(rS,rQ,re){if(void 0===rQ&&(rQ=0),void 0===re&&(re=0),rQ<0||re<0)throw"writeArrayBuffer error - Out of bounds";0==re&&(re=rS.byteLength-rQ),this.ensureWrite(this._pos_+re);var rl=new Uint8Array(rS);this._u8d_.set(rl.subarray(rQ,rQ+re),this._pos_),this._pos_+=re},ro(0,rS,"buffer",function(){var rS=this._d_.buffer;return rS.byteLength==this.length?rS:rS.slice(0,this.length)}),ro(0,rS,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(rS){this._xd_="littleEndian"==rS}),ro(0,rS,"length",function(){return this._length},function(rS){this._allocated_<rS?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(rS,2*this._allocated_))):this._allocated_>rS&&this.___resizeBuffer(this._allocated_=rS),this._length=rS}),ro(0,rS,"pos",function(){return this._pos_},function(rS){this._pos_=rS}),ro(0,rS,"bytesAvailable",function(){return this._length-this._pos_}),rQ.getSystemEndian=function(){if(!rQ._sysEndian){var rS=new ArrayBuffer(2);new DataView(rS).setInt16(0,256,!0),rQ._sysEndian=256===new Int16Array(rS)[0]?"littleEndian":"bigEndian"}return rQ._sysEndian},rQ.BIG_ENDIAN="bigEndian",rQ.LITTLE_ENDIAN="littleEndian",rQ._sysEndian=null,rQ}(),ru=function(){function rM(){}return rj(rM,"laya.utils.CacheManager"),rM.regCacheByFunction=function(rS,rQ){var re;rM.unRegCacheByFunction(rS,rQ),re={tryDispose:rS,getCacheList:rQ},rM._cacheList.push(re)},rM.unRegCacheByFunction=function(rS,rQ){var re,rl=0;for(re=rM._cacheList.length,rl=0;rl<re;rl++)if(rM._cacheList[rl].tryDispose==rS&&rM._cacheList[rl].getCacheList==rQ)return void rM._cacheList.splice(rl,1)},rM.forceDispose=function(){var rS=0,rQ=rM._cacheList.length;for(rS=0;rS<rQ;rS++)rM._cacheList[rS].tryDispose(!0)},rM.beginCheck=function(rS){void 0===rS&&(rS=15e3),rO.timer.loop(rS,null,rM._checkLoop)},rM.stopCheck=function(){rO.timer.clear(null,rM._checkLoop)},rM._checkLoop=function(){var rS=rM._cacheList;if(!(rS.length<1)){var rQ,re=rf.now(),rl=0;for(rQ=rl=rS.length;0<rl&&(rS[rM._index=++rM._index%rQ].tryDispose(!1),!(rf.now()-re>rM.loopTimeLimit));)rl--}},rM.loopTimeLimit=2,rM._cacheList=[],rM._index=0,rM}(),rr=function(){function rJ(){}return rj(rJ,"laya.utils.ClassUtils"),rJ.regClass=function(rS,rQ){rJ._classMap[rS]=rQ},rJ.getRegClass=function(rS){return rJ._classMap[rS]},rJ.getInstance=function(rS){var rQ=rJ.getClass(rS);return rQ?new rQ:(console.warn("[error] Undefined class:",rS),null)},rJ.createByJson=function(rS,rQ,re,rl,rM){"string"==typeof rS&&(rS=JSON.parse(rS));var rd=rS.props;if(!rQ&&!(rQ=rM?rM.runWith(rS):rJ.getInstance(rd.runtime||rS.type)))return null;var rT=rS.child;if(rT)for(var rU=0,ri=rT.length;rU<ri;rU++){var rR=rT[rU];if("render"!==rR.props.name&&"render"!==rR.props.renderType||!rQ._$set_itemRender)if("Graphic"==rR.type)rJ.addGraphicsToSprite(rR,rQ);else if(rJ.isDrawType(rR.type))rJ.addGraphicToSprite(rR,rQ,!0);else{var ro=rJ.createByJson(rR,null,re,rl,rM);"Script"==rR.type?ro.hasOwnProperty("owner")?ro.owner=rQ:ro.hasOwnProperty("target")&&(ro.target=rQ):"mask"==rR.props.renderType?rQ.mask=ro:rQ.addChild(ro)}else rQ.itemRender=rR}if(rd)for(var rY in rd){var rp=rd[rY];"var"===rY&&re?re[rp]=rQ:rp instanceof Array&&"function"==typeof rQ[rY]?rQ[rY].apply(rQ,rp):rQ[rY]=rp}return rl&&rS.customProps&&rl.runWith([rQ,rS]),rQ.created&&rQ.created(),rQ},rJ.addGraphicsToSprite=function(rS,rQ){var re;if((re=rS.child)&&!(re.length<1)){var rl;rl=rJ._getGraphicsFromSprite(rS,rQ);var rM=0,rd=0;rS.props&&(rM=rJ._getObjVar(rS.props,"x",0),rd=rJ._getObjVar(rS.props,"y",0)),0!=rM&&0!=rd&&rl.translate(rM,rd);var rT,rU=0;for(rT=re.length,rU=0;rU<rT;rU++)rJ._addGraphicToGraphics(re[rU],rl);0!=rM&&0!=rd&&rl.translate(-rM,-rd)}},rJ.addGraphicToSprite=function(rS,rQ,re){var rl;void 0===re&&(re=!1),rl=re?rJ._getGraphicsFromSprite(rS,rQ):rQ.graphics,rJ._addGraphicToGraphics(rS,rl)},rJ._getGraphicsFromSprite=function(rS,rQ){var re,rl;if(!rS||!rS.props)return rQ.graphics;switch(rl=rS.props.renderType){case"hit":case"unHit":var rM;rQ.hitArea||(rQ.hitArea=new rq),(rM=rQ.hitArea)[rl]||(rM[rl]=new rp),re=rM[rl]}return re||(re=rQ.graphics),re},rJ._getTransformData=function(rS){var rQ;(rS.hasOwnProperty("pivotX")||rS.hasOwnProperty("pivotY"))&&(rQ=rQ||new rX).translate(-rJ._getObjVar(rS,"pivotX",0),-rJ._getObjVar(rS,"pivotY",0));var re=rJ._getObjVar(rS,"scaleX",1),rl=rJ._getObjVar(rS,"scaleY",1),rM=rJ._getObjVar(rS,"rotation",0);rJ._getObjVar(rS,"skewX",0),rJ._getObjVar(rS,"skewY",0);return 1==re&&1==rl&&0==rM||((rQ=rQ||new rX).scale(re,rl),rQ.rotate(.0174532922222222*rM)),rQ},rJ._addGraphicToGraphics=function(rS,rQ){var re,rl;if((re=rS.props)&&(rl=rJ.DrawTypeDic[rS.type])){var rM,rd;rM=rQ;var rT=rJ._getParams(re,rl[1],rl[2],rl[3]);((rd=rJ._tM)||1!=rJ._alpha)&&(rM.save(),rd&&rM.transform(rd),1!=rJ._alpha&&rM.alpha(rJ._alpha)),rM[rl[0]].apply(rM,rT),(rd||1!=rJ._alpha)&&rM.restore()}},rJ._adptLineData=function(rS){return rS[2]=parseFloat(rS[0])+parseFloat(rS[2]),rS[3]=parseFloat(rS[1])+parseFloat(rS[3]),rS},rJ._adptTextureData=function(rS){return rS[0]=rUS.getRes(rS[0]),rS},rJ._adptLinesData=function(rS){return rS[2]=rJ._getPointListByStr(rS[2]),rS},rJ.isDrawType=function(rS){return"Image"!=rS&&rJ.DrawTypeDic.hasOwnProperty(rS)},rJ._getParams=function(rS,rQ,re,rl){var rM;void 0===re&&(re=0),(rM=rJ._temParam).length=rQ.length;var rd,rT,rU=0;for(rd=rQ.length,rU=0;rU<rd;rU++)rM[rU]=rJ._getObjVar(rS,rQ[rU][0],rQ[rU][1]);return rJ._alpha=rJ._getObjVar(rS,"alpha",1),rT=rJ._getTransformData(rS),rJ._tM=rT?(re||(re=0),rT.translate(rM[re],rM[re+1]),rM[re]=rM[re+1]=0,rT):null,rl&&rJ[rl]&&(rM=rJ[rl](rM)),rM},rJ._getPointListByStr=function(rS){var rQ,re,rl=0;for(re=(rQ=rS.split(",")).length,rl=0;rl<re;rl++)rQ[rl]=parseFloat(rQ[rl]);return rQ},rJ._getObjVar=function(rS,rQ,re){return rS.hasOwnProperty(rQ)?rS[rQ]:re},rJ._temParam=[],rJ._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},rJ.getClass=function(rS){var rQ=rJ._classMap[rS]||rS;return"string"==typeof rQ?rO.__classmap[rQ]:rQ},rJ._tM=null,rJ._alpha=NaN,ri(rJ,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),rJ}(),rW=function(){function rd(rS){if(this._color=[],"string"==typeof rS){null===(this.strColor=rS)&&(rS="#000000"),"#"==rS.charAt(0)&&(rS=rS.substr(1));var rQ=rS.length;if(3==rQ||4==rQ){for(var re="",rl=0;rl<rQ;rl++)re+=rS[rl]+rS[rl];rS=re}var rM=this.numColor=parseInt(rS,16);if(8==rS.length)return void(this._color=[parseInt(rS.substr(0,2),16)/255,((16711680&rM)>>16)/255,((65280&rM)>>8)/255,(255&rM)/255])}else rM=this.numColor=rS,this.strColor=rV.toHexColor(rM);this._color=[((16711680&rM)>>16)/255,((65280&rM)>>8)/255,(255&rM)/255,1],this._color.__id=++rd._COLODID}return rj(rd,"laya.utils.Color"),rd._initDefault=function(){for(var rS in rd._DEFAULT={},rd._COLOR_MAP)rd._SAVE[rS]=rd._DEFAULT[rS]=new rd(rd._COLOR_MAP[rS]);return rd._DEFAULT},rd._initSaveMap=function(){for(var rS in rd._SAVE_SIZE=0,rd._SAVE={},rd._DEFAULT)rd._SAVE[rS]=rd._DEFAULT[rS]},rd.create=function(rS){var rQ=rd._SAVE[rS+""];return null!=rQ?rQ:(rd._SAVE_SIZE<1e3||rd._initSaveMap(),rd._SAVE[rS+""]=new rd(rS))},rd._SAVE={},rd._SAVE_SIZE=0,rd._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},rd._DEFAULT=rd._initDefault(),rd._COLODID=1,rd}(),rx=(function(){function rS(){this._values=[],this._keys=[]}rj(rS,"laya.utils.Dictionary");var rQ=rS.prototype;rQ.set=function(rS,rQ){var re=this.indexOf(rS);0<=re?this._values[re]=rQ:(this._keys.push(rS),this._values.push(rQ))},rQ.indexOf=function(rS){var rQ=this._keys.indexOf(rS);return 0<=rQ?rQ:(rS="string"==typeof rS?Number(rS):"number"==typeof rS?rS.toString():rS,this._keys.indexOf(rS))},rQ.get=function(rS){var rQ=this.indexOf(rS);return rQ<0?null:this._values[rQ]},rQ.remove=function(rS){var rQ=this.indexOf(rS);return 0<=rQ&&(this._keys.splice(rQ,1),this._values.splice(rQ,1),!0)},rQ.clear=function(){this._values.length=0,this._keys.length=0},ro(0,rQ,"values",function(){return this._values}),ro(0,rQ,"keys",function(){return this._keys})}(),function(){function rS(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}rj(rS,"laya.utils.Dragging");var rQ=rS.prototype;return rQ.start=function(rS,rQ,re,rl,rM,rd,rT,rU){void 0===rU&&(rU=.92),this.clearTimer(),this.target=rS,this.area=rQ,this.hasInertia=re,this.elasticDistance=rQ?rl:0,this.elasticBackTime=rM,this.data=rd,this._disableMouseEvent=rT,this.ratio=rU,1!=rS.globalScaleX||1!=rS.globalScaleY?this._parent=rS.parent:this._parent=rO.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,rO.stage.on("mouseup",this,this.onStageMouseUp),rO.stage.on("mouseout",this,this.onStageMouseUp),rO.timer.frameLoop(1,this,this.loop)},rQ.clearTimer=function(){rO.timer.clear(this,this.loop),rO.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},rQ.stop=function(){this._dragging&&(rL.instance.disableMouseEvent=!1,rO.stage.off("mouseup",this,this.onStageMouseUp),rO.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},rQ.loop=function(){var rS=this._parent.getMousePoint(),rQ=rS.x,re=rS.y,rl=rQ-this._lastX,rM=re-this._lastY;if(this._clickOnly){if(!(1<Math.abs(rl*rO.stage._canvasTransform.getScaleX())||1<Math.abs(rM*rO.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),rL.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(rl,rM);0==rl&&0==rM||(this._lastX=rQ,this._lastY=re,this.target.x+=rl*this._elasticRateX,this.target.y+=rM*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},rQ.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var rS=this.area.x-this.target.x;else rS=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-rS/this.elasticDistance),this.target.y<this.area.y)var rQ=this.area.y-this.target.y;else rQ=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-rQ/this.elasticDistance)}},rQ.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},rQ.onStageMouseUp=function(rS){if(rL.instance.disableMouseEvent=!1,rO.stage.off("mouseup",this,this.onStageMouseUp),rO.stage.off("mouseout",this,this.onStageMouseUp),rO.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var rQ=this._offsets.length,re=Math.min(rQ,6),rl=this._offsets.length-re,rM=rQ-1;rl<rM;rM--)this._offsetY+=this._offsets[rM--],this._offsetX+=this._offsets[rM];this._offsetX=this._offsetX/re*2,this._offsetY=this._offsetY/re*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),rO.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},rQ.checkElastic=function(){var rS=NaN,rQ=NaN;if(this.target.x<this.area.x?rS=this.area.x:this.target.x>this.area.x+this.area.width&&(rS=this.area.x+this.area.width),this.target.y<this.area.y?rQ=this.area.y:this.target.y>this.area.y+this.area.height&&(rQ=this.area.y+this.area.height),isNaN(rS)&&isNaN(rQ))this.clear();else{var re={};isNaN(rS)||(re.x=rS),isNaN(rQ)||(re.y=rQ),this._tween=rK.to(this.target,re,this.elasticBackTime,rF.sineOut,rz.create(this,this.clear),0,!1,!1)}},rQ.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(rO.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},rQ.clear=function(){if(this.target){this.clearTimer();var rS=this.target;this.target=null,this._parent=null,rS.event("dragend",this.data)}},rS}()),rF=function(){function rU(){}return rj(rU,"laya.utils.Ease"),rU.linearNone=function(rS,rQ,re,rl){return re*rS/rl+rQ},rU.linearIn=function(rS,rQ,re,rl){return re*rS/rl+rQ},rU.linearInOut=function(rS,rQ,re,rl){return re*rS/rl+rQ},rU.linearOut=function(rS,rQ,re,rl){return re*rS/rl+rQ},rU.bounceIn=function(rS,rQ,re,rl){return re-rU.bounceOut(rl-rS,0,re,rl)+rQ},rU.bounceInOut=function(rS,rQ,re,rl){return rS<.5*rl?.5*rU.bounceIn(2*rS,0,re,rl)+rQ:.5*rU.bounceOut(2*rS-rl,0,re,rl)+.5*re+rQ},rU.bounceOut=function(rS,rQ,re,rl){return(rS/=rl)<1/2.75?re*(7.5625*rS*rS)+rQ:rS<2/2.75?re*(7.5625*(rS-=1.5/2.75)*rS+.75)+rQ:rS<2.5/2.75?re*(7.5625*(rS-=2.25/2.75)*rS+.9375)+rQ:re*(7.5625*(rS-=2.625/2.75)*rS+.984375)+rQ},rU.backIn=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=1.70158),re*(rS/=rl)*rS*((rM+1)*rS-rM)+rQ},rU.backInOut=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=1.70158),(rS/=.5*rl)<1?.5*re*(rS*rS*((1+(rM*=1.525))*rS-rM))+rQ:re/2*((rS-=2)*rS*((1+(rM*=1.525))*rS+rM)+2)+rQ},rU.backOut=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=1.70158),re*((rS=rS/rl-1)*rS*((rM+1)*rS+rM)+1)+rQ},rU.elasticIn=function(rS,rQ,re,rl,rM,rd){var rT;return void 0===rM&&(rM=0),void 0===rd&&(rd=0),0==rS?rQ:1==(rS/=rl)?rQ+re:(rd||(rd=.3*rl),rT=!rM||0<re&&rM<re||re<0&&rM<-re?(rM=re,rd/4):rd/rU.PI2*Math.asin(re/rM),-rM*Math.pow(2,10*(rS-=1))*Math.sin((rS*rl-rT)*rU.PI2/rd)+rQ)},rU.elasticInOut=function(rS,rQ,re,rl,rM,rd){var rT;return void 0===rM&&(rM=0),void 0===rd&&(rd=0),0==rS?rQ:2==(rS/=.5*rl)?rQ+re:(rd||(rd=rl*(.3*1.5)),rT=!rM||0<re&&rM<re||re<0&&rM<-re?(rM=re,rd/4):rd/rU.PI2*Math.asin(re/rM),rS<1?rM*Math.pow(2,10*(rS-=1))*Math.sin((rS*rl-rT)*rU.PI2/rd)*-.5+rQ:rM*Math.pow(2,-10*(rS-=1))*Math.sin((rS*rl-rT)*rU.PI2/rd)*.5+re+rQ)},rU.elasticOut=function(rS,rQ,re,rl,rM,rd){var rT;return void 0===rM&&(rM=0),void 0===rd&&(rd=0),0==rS?rQ:1==(rS/=rl)?rQ+re:(rd||(rd=.3*rl),rT=!rM||0<re&&rM<re||re<0&&rM<-re?(rM=re,rd/4):rd/rU.PI2*Math.asin(re/rM),rM*Math.pow(2,-10*rS)*Math.sin((rS*rl-rT)*rU.PI2/rd)+re+rQ)},rU.strongIn=function(rS,rQ,re,rl){return re*(rS/=rl)*rS*rS*rS*rS+rQ},rU.strongInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*re*rS*rS*rS*rS*rS+rQ:.5*re*((rS-=2)*rS*rS*rS*rS+2)+rQ},rU.strongOut=function(rS,rQ,re,rl){return re*((rS=rS/rl-1)*rS*rS*rS*rS+1)+rQ},rU.sineInOut=function(rS,rQ,re,rl){return.5*-re*(Math.cos(Math.PI*rS/rl)-1)+rQ},rU.sineIn=function(rS,rQ,re,rl){return-re*Math.cos(rS/rl*rU.HALF_PI)+re+rQ},rU.sineOut=function(rS,rQ,re,rl){return re*Math.sin(rS/rl*rU.HALF_PI)+rQ},rU.quintIn=function(rS,rQ,re,rl){return re*(rS/=rl)*rS*rS*rS*rS+rQ},rU.quintInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*re*rS*rS*rS*rS*rS+rQ:.5*re*((rS-=2)*rS*rS*rS*rS+2)+rQ},rU.quintOut=function(rS,rQ,re,rl){return re*((rS=rS/rl-1)*rS*rS*rS*rS+1)+rQ},rU.quartIn=function(rS,rQ,re,rl){return re*(rS/=rl)*rS*rS*rS+rQ},rU.quartInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*re*rS*rS*rS*rS+rQ:.5*-re*((rS-=2)*rS*rS*rS-2)+rQ},rU.quartOut=function(rS,rQ,re,rl){return-re*((rS=rS/rl-1)*rS*rS*rS-1)+rQ},rU.cubicIn=function(rS,rQ,re,rl){return re*(rS/=rl)*rS*rS+rQ},rU.cubicInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*re*rS*rS*rS+rQ:.5*re*((rS-=2)*rS*rS+2)+rQ},rU.cubicOut=function(rS,rQ,re,rl){return re*((rS=rS/rl-1)*rS*rS+1)+rQ},rU.quadIn=function(rS,rQ,re,rl){return re*(rS/=rl)*rS+rQ},rU.quadInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*re*rS*rS+rQ:.5*-re*(--rS*(rS-2)-1)+rQ},rU.quadOut=function(rS,rQ,re,rl){return-re*(rS/=rl)*(rS-2)+rQ},rU.expoIn=function(rS,rQ,re,rl){return 0==rS?rQ:re*Math.pow(2,10*(rS/rl-1))+rQ-.001*re},rU.expoInOut=function(rS,rQ,re,rl){return 0==rS?rQ:rS==rl?rQ+re:(rS/=.5*rl)<1?.5*re*Math.pow(2,10*(rS-1))+rQ:.5*re*(2-Math.pow(2,-10*--rS))+rQ},rU.expoOut=function(rS,rQ,re,rl){return rS==rl?rQ+re:re*(1-Math.pow(2,-10*rS/rl))+rQ},rU.circIn=function(rS,rQ,re,rl){return-re*(Math.sqrt(1-(rS/=rl)*rS)-1)+rQ},rU.circInOut=function(rS,rQ,re,rl){return(rS/=.5*rl)<1?.5*-re*(Math.sqrt(1-rS*rS)-1)+rQ:.5*re*(Math.sqrt(1-(rS-=2)*rS)+1)+rQ},rU.circOut=function(rS,rQ,re,rl){return re*Math.sqrt(1-(rS=rS/rl-1)*rS)+rQ},rU.HALF_PI=.5*Math.PI,rU.PI2=2*Math.PI,rU}(),rq=function(){function rY(){this._hit=null,this._unHit=null}rj(rY,"laya.utils.HitArea");var rS=rY.prototype;return rS.isHit=function(rS,rQ){return!!rY.isHitGraphic(rS,rQ,this.hit)&&!rY.isHitGraphic(rS,rQ,this.unHit)},rS.contains=function(rS,rQ){return this.isHit(rS,rQ)},ro(0,rS,"hit",function(){return this._hit||(this._hit=new rp),this._hit},function(rS){this._hit=rS}),ro(0,rS,"unHit",function(){return this._unHit||(this._unHit=new rp),this._unHit},function(rS){this._unHit=rS}),rY.isHitGraphic=function(rS,rQ,re){if(!re)return!1;var rl;if(!(rl=re.cmds)&&re._one&&((rl=rY._cmds).length=1,rl[0]=re._one),!rl)return!1;var rM,rd,rT=0;for(rM=rl.length,rT=0;rT<rM;rT++)if(rd=rl[rT]){var rU=rm._context;switch(rd.callee){case rU._translate:case 6:rS-=rd[0],rQ-=rd[1]}if(rY.isHitCmd(rS,rQ,rd))return!0}return!1},rY.isHitCmd=function(rS,rQ,re){if(!re)return!1;var rl=rm._context,rM=!1;switch(re.callee){case rl._drawRect:case 13:rY._rec.setTo(re[0],re[1],re[2],re[3]),rM=rY._rec.contains(rS,rQ);break;case rl._drawCircle:case rl._fillCircle:case 14:rM=(rS-=re[0])*rS+(rQ-=re[1])*rQ<re[2]*re[2];break;case rl._drawPoly:case 18:rS-=re[0],rQ-=re[1],rM=rY.ptInPolygon(rS,rQ,re[2])}return rM},rY.ptInPolygon=function(rS,rQ,re){var rl;(rl=rY._ptPoint).setTo(rS,rQ);var rM,rd=0,rT=NaN,rU=NaN,ri=NaN,rR=NaN;rM=re.length;for(var ro=0;ro<rM;ro+=2){if(rT=re[ro],rU=re[ro+1],ri=re[(ro+2)%rM],rU!=(rR=re[(ro+3)%rM]))if(!(rl.y<Math.min(rU,rR)))if(!(rl.y>=Math.max(rU,rR)))(rl.y-rU)*(ri-rT)/(rR-rU)+rT>rl.x&&rd++}return rd%2==1},rY._cmds=[],ri(rY,["_rec",function(){return this._rec=new rg},"_ptPoint",function(){return this._ptPoint=new rH}]),rY}(),rZ=(function(){function rM(rS,rQ,re,rl){this.char=rS,this.charNum=rS.charCodeAt(0),this._x=this._y=0,this.width=rQ,this.height=re,this.style=rl,this.isWord=!rM._isWordRegExp.test(rS)}rj(rM,"laya.utils.HTMLChar");var rS=rM.prototype;rO.imps(rS,{"laya.display.ILayout":!0}),rS.setSprite=function(rS){this._sprite=rS},rS.getSprite=function(){return this._sprite},rS._isChar=function(){return!0},rS._getCSSStyle=function(){return this.style},ro(0,rS,"width",function(){return this._w},function(rS){this._w=rS}),ro(0,rS,"x",function(){return this._x},function(rS){this._sprite&&(this._sprite.x=rS),this._x=rS}),ro(0,rS,"y",function(){return this._y},function(rS){this._sprite&&(this._sprite.y=rS),this._y=rS}),ro(0,rS,"height",function(){return this._h},function(rS){this._h=rS}),rM._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function rQ(){}rj(rQ,"laya.utils.Log"),rQ.enable=function(){rQ._logdiv||(rQ._logdiv=rf.window.document.createElement("div"),rf.window.document.body.appendChild(rQ._logdiv),rQ._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},rQ.toggle=function(){var rS=rQ._logdiv.style;"1px"==rS.width?rS.width=rS.height="50%":rS.width=rS.height="1px"},rQ.print=function(rS){rQ._logdiv&&(rQ.maxCount<=rQ._count&&rQ.clear(),rQ._count++,rQ._logdiv.innerText+=rS+"\n",rQ._logdiv.scrollTop=rQ._logdiv.scrollHeight)},rQ.clear=function(){rQ._logdiv.innerText="",rQ._count=0},rQ._logdiv=null,rQ._count=0,rQ.maxCount=20}(),function(){function rQ(){}rj(rQ,"laya.utils.Mouse"),ro(1,rQ,"cursor",function(){return rQ._style.cursor},function(rS){rQ._style.cursor=rS}),rQ.hide=function(){"none"!=rQ.cursor&&(rQ._preCursor=rQ.cursor,rQ.cursor="none")},rQ.show=function(){"none"==rQ.cursor&&(rQ.cursor=rQ._preCursor?rQ._preCursor:"auto")},rQ._preCursor=null,ri(rQ,["_style",function(){return this._style=rf.document.body.style}])}(),function(){function rd(){}return rj(rd,"laya.utils.Pool"),rd.getPoolBySign=function(rS){return rd._poolDic[rS]||(rd._poolDic[rS]=[])},rd.clearBySign=function(rS){rd._poolDic[rS]&&(rd._poolDic[rS].length=0)},rd.recover=function(rS,rQ){rQ.__InPool||(rQ.__InPool=!0,rd.getPoolBySign(rS).push(rQ))},rd.getItemByClass=function(rS,rQ){var re=rd.getPoolBySign(rS),rl=re.length?re.pop():new rQ;return rl.__InPool=!1,rl},rd.getItemByCreateFun=function(rS,rQ,re){var rl=rd.getPoolBySign(rS),rM=rl.length?rl.pop():rQ.call(re);return rM.__InPool=!1,rM},rd.getItem=function(rS){var rQ=rd.getPoolBySign(rS),re=rQ.length?rQ.pop():null;return re&&(re.__InPool=!1),re},rd._poolDic={},rd.InPoolSign="__InPool",rd}()),rN=function(){function ri(){}return rj(ri,"laya.utils.Stat"),ro(1,ri,"onclick",null,function(rS){ri._sp&&ri._sp.on("click",ri._sp,rS),ri._canvas&&(ri._canvas.source.onclick=rS,ri._canvas.source.style.pointerEvents="")}),ri.show=function(rS,rQ,re){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),!rm.isConchApp||rm.isConchWebGL){if(rm.isConchWebGL||rf.onMiniGame||rf.onLimixiu||(ri._useCanvas=!0),ri._show=!0,ri._fpsData.length=60,ri._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},ri._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},ri._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},ri._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},rm.isWebGL)if(ri._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},rm.is3DMode){if(ri._view[0].title="FPS(3D)",ri._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},ri._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},ri._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==re){var rl=8;ri._view[rl++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},ri._view[rl++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},ri._view[rl++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==re){rl=8;ri._view[rl++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},ri._view[rl++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},ri._view[rl++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},ri._view[rl++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},ri._view[rl++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},ri._view[rl++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},ri._view[rl++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else ri._view[0].title="FPS(WebGL)",ri._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else ri._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};ri._useCanvas?ri.createUIPre(rS,rQ):ri.createUI(rS,rQ),ri.enable()}else rf.window.conch.showFPS&&rf.window.conch.showFPS(rS,rQ)},ri.createUIPre=function(rS,rQ){var re=rf.pixelRatio;ri._width=170*re,ri._vx=75*re,ri._height=re*(12*ri._view.length+3*re)+4,ri._fontSize=12*re;for(var rl=0;rl<ri._view.length;rl++)ri._view[rl].x=4,ri._view[rl].y=rl*ri._fontSize+2*re;ri._canvas||((ri._canvas=new rAS("2D")).size(ri._width,ri._height),(ri._ctx=ri._canvas.getContext("2d")).textBaseline="top",ri._ctx.font=ri._fontSize+"px Sans-serif",ri._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+rS+"px;top:"+rQ+"px;width:"+ri._width/re+"px;height:"+ri._height/re+"px;"),ri._first=!0,ri.loop(),ri._first=!1,rf.container.appendChild(ri._canvas.source)},ri.createUI=function(rS,rQ){var re=ri._sp,rl=rf.pixelRatio;re||(re=new rYS,(ri._leftText=new rcS).pos(5,5),ri._leftText.color="#ffffff",re.addChild(ri._leftText),(ri._txt=new rcS).pos(80*rl,5),ri._txt.color="#ffffff",re.addChild(ri._txt),ri._sp=re),re.pos(rS,rQ);for(var rM="",rd=0;rd<ri._view.length;rd++){rM+=ri._view[rd].title+"\n"}ri._leftText.text=rM;var rT=170*rl,rU=rl*(12*ri._view.length+3*rl)+4;ri._txt.fontSize=ri._fontSize*rl,ri._leftText.fontSize=ri._fontSize*rl,re.size(rT,rU),re.graphics.clear(),re.graphics.setAlpha(.5),re.graphics.drawRect(0,0,rT,rU,"#999999"),re.graphics.setAlpha(1),ri.loop()},ri.enable=function(){rO.timer.frameLoop(1,ri,ri.loop)},ri.hide=function(){ri._show=!1,rO.timer.clear(ri,ri.loop),ri._canvas&&rf.removeElement(ri._canvas.source)},ri.clear=function(){ri.trianglesFaces=ri.drawCall=ri.shaderCall=ri.spriteCount=ri.spriteRenderUseCacheCount=ri.treeNodeCollision=ri.treeSpriteCollision=ri.canvasNormal=ri.canvasBitmap=ri.canvasReCache=0},ri.loop=function(){ri._count++;var rS=rf.now();if(!(rS-ri._timer<1e3)){var rQ=ri._count;if(ri.FPS=Math.round(1e3*rQ/(rS-ri._timer)),ri._show){ri.trianglesFaces=Math.round(ri.trianglesFaces/rQ),ri.spriteCount=ri._useCanvas?(ri.drawCall=Math.round(ri.drawCall/rQ)-2,ri.shaderCall=Math.round(ri.shaderCall/rQ),Math.round(ri.spriteCount/rQ)-1):(ri.drawCall=Math.round(ri.drawCall/rQ)-2,ri.shaderCall=Math.round(ri.shaderCall/rQ)-4,Math.round(ri.spriteCount/rQ)-4),ri.spriteRenderUseCacheCount=Math.round(ri.spriteRenderUseCacheCount/rQ),ri.canvasNormal=Math.round(ri.canvasNormal/rQ),ri.canvasBitmap=Math.round(ri.canvasBitmap/rQ),ri.canvasReCache=Math.ceil(ri.canvasReCache/rQ),ri.treeNodeCollision=Math.round(ri.treeNodeCollision/rQ),ri.treeSpriteCollision=Math.round(ri.treeSpriteCollision/rQ);var re=0<ri.FPS?Math.floor(1e3/ri.FPS).toString():" ";ri._fpsStr=ri.FPS+(ri.renderSlow?" slow":"")+" "+re,ri._spriteStr=ri.spriteCount+(ri.spriteRenderUseCacheCount?"/"+ri.spriteRenderUseCacheCount:""),ri._canvasStr=ri.canvasReCache+"/"+ri.canvasNormal+"/"+ri.canvasBitmap,ri.currentMemorySize=ra.systemResourceManager.memorySize,ri._useCanvas?ri.renderInfoPre():ri.renderInfo(),ri.clear()}ri._count=0,ri._timer=rS}},ri.renderInfoPre=function(){if(ri._canvas){var rS=ri._ctx;rS.clearRect(ri._first?0:ri._vx,0,ri._width,ri._height);for(var rQ=rm.WebGL.mainContext,re=0;re<ri._view.length;re++){var rl=ri._view[re];ri._first&&(rS.fillStyle="white",rS.fillText(rl.title,rl.x,rl.y,null,null,null)),rS.fillStyle=rl.color;var rM=-1;if((rl=ri._view[re]).varying){if(rQ)switch(rl.varying){case 1:rM=rQ.getParameter(rQ[rl.value]);break;case 2:rM=rQ.getExtension(rl.value)}}else rM=ri[rl.value];"M"==rl.units&&(rM=Math.floor(rM/1048576*100)/100+" M"),"K"==rl.units&&(rM=Math.floor(rM/1024*100)/100+" K"),"string"==rl.units&&(rM=rM.match(/\d+\.?\d/i)),rS.fillText(rM+"",rl.x+ri._vx,rl.y,null,null,null)}}},ri.renderInfo=function(){for(var rS="",rQ=rm.WebGL.mainContext,re=0;re<ri._view.length;re++){var rl=ri._view[re],rM=-1;if(rl.varying){if(rQ)switch(rl.varying){case 1:rM=rQ.getParameter(rQ[rl.value]);break;case 2:rM=rQ.getExtension(rl.value)}}else rM=ri[rl.value];"M"==rl.units&&(rM=Math.floor(rM/1048576*100)/100+" M"),"K"==rl.units&&(rM=Math.floor(rM/1024*100)/100+" K"),"string"==rl.units&&(rM=rM.match(/\d+\.?\d/i)),rS+=rM+"\n"}ri._txt.text=rS},ri.FPS=0,ri.loopCount=0,ri.shaderCall=0,ri.drawCall=0,ri.trianglesFaces=0,ri.spriteCount=0,ri.spriteRenderUseCacheCount=0,ri.treeNodeCollision=0,ri.treeSpriteCollision=0,ri.canvasNormal=0,ri.canvasBitmap=0,ri.canvasReCache=0,ri.renderSlow=!1,ri.currentMemorySize=0,ri._fpsStr=null,ri._canvasStr=null,ri._spriteStr=null,ri._fpsData=[],ri._timer=0,ri._count=0,ri._view=[],ri._fontSize=12,ri._txt=null,ri._leftText=null,ri._sp=null,ri._show=!1,ri._useCanvas=!1,ri._canvas=null,ri._ctx=null,ri._first=!1,ri._vx=NaN,ri._width=0,ri._height=100,ri}(),rC=(function(){function rS(){this._strsToID={},this._idToStrs=[],this._length=0}rj(rS,"laya.utils.StringKey");var rQ=rS.prototype;rQ.add=function(rS){var rQ=this._strsToID[rS];return null!=rQ?rQ:(this._idToStrs[this._length]=rS,this._strsToID[rS]=this._length++)},rQ.getID=function(rS){var rQ=this._strsToID[rS];return null==rQ?-1:rQ},rQ.getName=function(rS){var rQ=this._idToStrs[rS];return null==rQ?void 0:rQ}}(),function(){var rR;function rS(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}rj(rS,"laya.utils.Timer");var rQ=rS.prototype;return rQ._init=function(){rO.timer&&rO.timer.frameLoop(1,this,this._update)},rQ._now=function(){return Date.now()},rQ._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var rS=this.currFrame=this.currFrame+this.scale,rQ=this._now();this._delta=(rQ-this._lastTimer)*this.scale;var re=this.currTimer=this.currTimer+this._delta;rO.isDebug&&6e4<Math.abs(rQ-this._lastTimer)&&console.error("系统时间错误！"+(rQ-this._lastTimer)),this._lastTimer=rQ;var rl=this._handlers;for(rT=this._count=0,rU=rl.length;rT<rU;rT++)if(null!==(ri=rl[rT]).method){var rM=ri.userFrame?rS:re;if(rM>=ri.exeTime)if(ri.repeat)if(ri.jumpFrame)for(;rM>=ri.exeTime;)ri.exeTime+=ri.delay,ri.run(!1);else ri.exeTime+=ri.delay,ri.run(!1),rM>ri.exeTime&&(ri.exeTime+=Math.ceil((rM-ri.exeTime)/ri.delay)*ri.delay);else ri.run(!0)}else this._count++;(30<this._count||rS%200==0)&&this._clearHandlers();for(var rd=this._laters,rT=0,rU=rd.length-1;rT<=rU;rT++){var ri=rd[rT];this._isIgnoreRecover(ri)||(null!==ri.method&&(delete this._map[ri.key],ri.run(!1)),this._recoverHandler(ri)),rT===rU&&(rU=rd.length-1)}rd.length=0}},rQ._clearHandlers=function(){for(var rS=this._handlers,rQ=0,re=rS.length;rQ<re;rQ++){var rl=rS[rQ];null!==rl.method?this._temp.push(rl):this._isIgnoreRecover(rl)?this._temp.push(rl):this._recoverHandler(rl)}this._handlers=this._temp,this._temp=rS,this._temp.length=0},rQ._recoverHandler=function(rS){this._map[rS.key]==rS&&delete this._map[rS.key],rS.recover()},rQ._create=function(rS,rQ,re,rl,rM,rd,rT,rU){if(!re)return rM.apply(rl,rd),null;if(rT){var ri=this._getHandler(rl,rM);if(ri)return ri.repeat=rQ,ri.userFrame=rS,ri.delay=re,ri.ignoreRecover=rU,ri.caller=rl,ri.method=rM,ri.args=rd,ri.exeTime=re+(rS?this.currFrame:this.currTimer+this._now()-this._lastTimer),ri}return(ri=rR.create()).repeat=rQ,ri.userFrame=rS,ri.delay=re,ri.ignoreRecover=rU,ri.caller=rl,ri.method=rM,ri.args=rd,ri.exeTime=re+(rS?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(ri),this._handlers.push(ri),ri},rQ._indexHandler=function(rS){var rQ=rS.caller,re=rS.method,rl=rQ?rQ.$_GID||(rQ.$_GID=rV.getGID()):0,rM=re.$_TID||(re.$_TID=this._mid++);rS.key=rl+"_"+rM,this._map[rS.key]=rS},rQ.once=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=!0),this._create(!1,!1,rS,rQ,re,rl,rM,!1)},rQ.loop=function(rS,rQ,re,rl,rM,rd,rT){void 0===rM&&(rM=!0),void 0===rd&&(rd=!1),void 0===rT&&(rT=!1);var rU=this._create(!1,!0,rS,rQ,re,rl,rM,rT);rU&&(rU.jumpFrame=rd)},rQ.frameOnce=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=!0),this._create(!0,!1,rS,rQ,re,rl,rM,!1)},rQ.frameLoop=function(rS,rQ,re,rl,rM,rd){void 0===rM&&(rM=!0),void 0===rd&&(rd=!1),this._create(!0,!0,rS,rQ,re,rl,rM,rd)},rQ.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+rR._freeCount},rQ.clear=function(rS,rQ){var re=this._getHandler(rS,rQ);return!(!re||this._isIgnoreRecover(re))&&(delete this._map[re.key],re.key=null,re.clear(),!0)},rQ.clearAll=function(rS){if(rS)for(var rQ=0,re=this._handlers.length;rQ<re;rQ++){var rl=this._handlers[rQ];rl.caller===rS&&(this._isIgnoreRecover(rl)||(delete this._map[rl.key],rl.key=null,rl.clear()))}},rQ._getHandler=function(rS,rQ){var re=rS?rS.$_GID||(rS.$_GID=rV.getGID()):0,rl=rQ.$_TID||(rQ.$_TID=this._mid++);return this._map[re+"_"+rl]},rQ._isIgnoreRecover=function(rS){if(rS.ignoreRecover||rS.caller&&"IgnoreRecover"==rS.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var rQ="";try{arguments.propertyIsEnumerable.caller}catch(rS){rQ=rS.stack}rO.recordError("报错：核心定时器销毁忽略  "+rQ)}return!0}return!1},rQ.hasHandler=function(rS,rQ){return this._map[rS.$_GID+"_"+rQ.$_TID]},rQ.callLater=function(rS,rQ,re){if(null==this._getHandler(rS,rQ)){var rl=rR.create();rl.caller=rS,rl.method=rQ,rl.args=re,this._indexHandler(rl),this._laters.push(rl)}},rQ.runCallLater=function(rS,rQ){var re=this._getHandler(rS,rQ);re&&null!=re.method&&(this._isIgnoreRecover(re)||(delete this._map[re.key],re.run(!0)))},rQ.runTimer=function(rS,rQ){this.runCallLater(rS,rQ)},ro(0,rQ,"delta",function(){return this._delta}),rS.__init$=function(){rR=function(){function rQ(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}rj(rQ,"");var rS=rQ.prototype;return rS.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},rS.recover=function(){this.clear(),this.args=rQ._freeHandler,rQ._freeHandler=this,rQ._freeCount++},rS.run=function(rS){var rQ=this.caller;if(rQ&&rQ.destroyed)return this.clear();var re=this.method,rl=this.args;rS&&this.clear(),null!=re&&(rl?re.apply(rQ,rl):re.call(rQ))},rQ._freeHandler=null,rQ._freeCount=0,rQ.create=function(){var rS=rQ._freeHandler;return rS?(rQ._freeHandler=rS.args,--rQ._freeCount,rS.args=null,rS):new rQ},rQ}()},rS}()),rK=function(){function rY(){this.gid=0}rj(rY,"laya.utils.Tween");var rS=rY.prototype;return rS.to=function(rS,rQ,re,rl,rM,rd,rT){return void 0===rd&&(rd=0),void 0===rT&&(rT=!1),this._create(rS,rQ,re,rl,rM,rd,rT,!0,!1,!0)},rS.from=function(rS,rQ,re,rl,rM,rd,rT){return void 0===rd&&(rd=0),void 0===rT&&(rT=!1),this._create(rS,rQ,re,rl,rM,rd,rT,!1,!1,!0)},rS._create=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){if(!rS)throw new Error("Tween:target is null");this._target=rS,this._duration=re,this._ease=rl||rQ.ease||rY.easeNone,this._complete=rM||rQ.complete,this._delay=rd,this._props=[],this._usedTimer=0,this._startTimer=rf.now(),this._usedPool=ri,this._delayParam=null,this.update=rQ.update;var ro=rS.$_GID||(rS.$_GID=rV.getGID());return rY.tweenMap[ro]?(rT&&rY.clearTween(rS),rY.tweenMap[ro].push(this)):rY.tweenMap[ro]=[this],rR?rd<=0?this.firstStart(rS,rQ,rU):(this._delayParam=[rS,rQ,rU],rO.scaleTimer.once(rd,this,this.firstStart,this._delayParam)):this._initProps(rS,rQ,rU),this},rS.firstStart=function(rS,rQ,re){this._delayParam=null,rS.destroyed?this.clear():(this._initProps(rS,rQ,re),this._beginLoop())},rS._initProps=function(rS,rQ,re){for(var rl in rQ)if("number"==typeof rS[rl]){var rM=re?rS[rl]:rQ[rl],rd=re?rQ[rl]:rS[rl];this._props.push([rl,rM,rd-rM]),re||(rS[rl]=rM)}},rS._beginLoop=function(){rO.scaleTimer.frameLoop(1,this,this._doEase)},rS._doEase=function(){this._updateEase(rf.now())},rS._updateEase=function(rS){var rQ=this._target;if(rQ){if(rQ.destroyed)return rY.clearTween(rQ);var re=this._usedTimer=rS-this._startTimer-this._delay;if(!(re<0)){if(re>=this._duration)return this.complete();for(var rl=0<re?this._ease(re,0,1,this._duration):0,rM=this._props,rd=0,rT=rM.length;rd<rT;rd++){var rU=rM[rd];rQ[rU[0]]=rU[1]+rl*rU[2]}this.update&&this.update.run()}}},rS.complete=function(){if(this._target){rO.scaleTimer.runTimer(this,this.firstStart);for(var rS=this._target,rQ=this._props,re=this._complete,rl=0,rM=rQ.length;rl<rM;rl++){var rd=rQ[rl];rS[rd[0]]=rd[1]+rd[2]}this.update&&this.update.run(),this.clear(),re&&re.run()}},rS.pause=function(){rO.scaleTimer.clear(this,this._beginLoop),rO.scaleTimer.clear(this,this._doEase),rO.scaleTimer.clear(this,this.firstStart);var rS;(rS=rf.now()-this._startTimer-this._delay)<0&&(this._usedTimer=rS)},rS.setStartTime=function(rS){this._startTimer=rS},rS.clear=function(){this._target&&(this._remove(),this._clear())},rS._clear=function(){this.pause(),rO.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,rZ.recover("tween",this))},rS.recover=function(){this._usedPool=!0,this._clear()},rS._remove=function(){var rS=rY.tweenMap[this._target.$_GID];if(rS)for(var rQ=0,re=rS.length;rQ<re;rQ++)if(rS[rQ]===this){rS.splice(rQ,1);break}},rS.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=rf.now(),this._delayParam)rO.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var rS=this._props,rQ=0,re=rS.length;rQ<re;rQ++){var rl=rS[rQ];this._target[rl[0]]=rl[1]}rO.scaleTimer.once(this._delay,this,this._beginLoop)}},rS.resume=function(){this._usedTimer>=this._duration||(this._startTimer=rf.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?rO.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},ro(0,rS,"progress",null,function(rS){var rQ=rS*this._duration;this._startTimer=rf.now()-this._delay-rQ}),rY.to=function(rS,rQ,re,rl,rM,rd,rT,rU){return void 0===rd&&(rd=0),void 0===rT&&(rT=!1),void 0===rU&&(rU=!0),rZ.getItemByClass("tween",rY)._create(rS,rQ,re,rl,rM,rd,rT,!0,rU,!0)},rY.from=function(rS,rQ,re,rl,rM,rd,rT,rU){return void 0===rd&&(rd=0),void 0===rT&&(rT=!1),void 0===rU&&(rU=!0),rZ.getItemByClass("tween",rY)._create(rS,rQ,re,rl,rM,rd,rT,!1,rU,!0)},rY.clearAll=function(rS){if(rS&&rS.$_GID){var rQ=rY.tweenMap[rS.$_GID];if(rQ){for(var re=0,rl=rQ.length;re<rl;re++)rQ[re]._clear();rQ.length=0}}},rY.clear=function(rS){rS.clear()},rY.clearTween=function(rS){rY.clearAll(rS)},rY.easeNone=function(rS,rQ,re,rl){return re*rS/rl+rQ},rY.tweenMap={},rY}(),rV=function(){function rU(){}return rj(rU,"laya.utils.Utils"),rU.toRadian=function(rS){return rS*rU._pi2},rU.toAngle=function(rS){return rS*rU._pi},rU.toHexColor=function(rS){if(rS<0||isNaN(rS))return null;for(var rQ=rS.toString(16);rQ.length<6;)rQ="0"+rQ;return"#"+rQ},rU.getGID=function(){return rU._gid++},rU.concatArray=function(rS,rQ){if(!rQ)return rS;if(!rS)return rQ;var re=0,rl=rQ.length;for(re=0;re<rl;re++)rS.push(rQ[re]);return rS},rU.clearArray=function(rS){return rS&&(rS.length=0),rS},rU.copyArray=function(rS,rQ){if(rS||(rS=[]),!rQ)return rS;rS.length=rQ.length;var re=0,rl=rQ.length;for(re=0;re<rl;re++)rS[re]=rQ[re];return rS},rU.getGlobalRecByPoints=function(rS,rQ,re,rl,rM){var rd,rT;return rd=new rH(rQ,re),rd=rS.localToGlobal(rd),rT=new rH(rl,rM),rT=rS.localToGlobal(rT),rg._getWrapRec([rd.x,rd.y,rT.x,rT.y])},rU.getGlobalPosAndScale=function(rS){return rU.getGlobalRecByPoints(rS,0,0,1,1)},rU.bind=function(rS,rQ){return rS.bind(rQ)},rU.measureText=function(rS,rQ){return rk.measureText(rS,rQ)},rU.updateOrder=function(rS){if(!rS||rS.length<2)return!1;for(var rQ,re=1,rl=0,rM=rS.length,rd=NaN;re<rM;){for(rQ=rS[rl=re],rd=rS[rl]._zOrder;-1<--rl&&rS[rl]._zOrder>rd;)rS[rl+1]=rS[rl];rS[rl+1]=rQ,re++}var rT=rQ.parent.conchModel;if(rT)if(null!=rT.updateZOrder)rT.updateZOrder();else{for(re=0;re<rM;re++)rT.removeChild(rS[re].conchModel);for(re=0;re<rM;re++)rT.addChildAt(rS[re].conchModel,re)}return!0},rU.transPointList=function(rS,rQ,re){var rl=0,rM=rS.length;for(rl=0;rl<rM;rl+=2)rS[rl]+=rQ,rS[rl+1]+=re},rU.parseInt=function(rS,rQ){void 0===rQ&&(rQ=0);var re=rf.window.parseInt(rS,rQ);return isNaN(re)?0:re},rU.getFileExtension=function(rS){rU._extReg.lastIndex=rS.lastIndexOf(".");var rQ=rU._extReg.exec(rS);return rQ&&1<rQ.length?rQ[1].toLowerCase():null},rU.getTransformRelativeToWindow=function(rS,rQ,re){var rl=rO.stage,rM=laya.utils.Utils.getGlobalPosAndScale(rS),rd=rl._canvasTransform.clone(),rT=rd.tx,rU=rd.ty;rd.rotate(-Math.PI/180*rO.stage.canvasDegree),rd.scale(rO.stage.clientScaleX,rO.stage.clientScaleY);var ri=rO.stage.canvasDegree%180!=0,rR=NaN,ro=NaN;ri?(rR=re+rM.y,ro=rQ+rM.x,rR*=rd.d,ro*=rd.a,90==rO.stage.canvasDegree?(rR=rT-rR,ro+=rU):(rR+=rT,ro=rU-ro)):(rR=rQ+rM.x,ro=re+rM.y,rR*=rd.a,ro*=rd.d,rR+=rT,ro+=rU);var rY=NaN,rp=NaN;return rp=ri?(rY=rd.d*rM.height,rd.a*rM.width):(rY=rd.a*rM.width,rd.d*rM.height),{x:rR,y:ro,scaleX:rY,scaleY:rp}},rU.fitDOMElementInArea=function(rS,rQ,re,rl,rM,rd){rS._fitLayaAirInitialized||(rS._fitLayaAirInitialized=!0,rS.style.transformOrigin=rS.style.webKittransformOrigin="left top",rS.style.position="absolute");var rT=rU.getTransformRelativeToWindow(rQ,re,rl);rS.style.transform=rS.style.webkitTransform="scale("+rT.scaleX+","+rT.scaleY+") rotate("+rO.stage.canvasDegree+"deg)",rS.style.width=rM+"px",rS.style.height=rd+"px",rS.style.left=rT.x+"px",rS.style.top=rT.y+"px"},rU.isOkTextureList=function(rS){if(!rS)return!1;var rQ,re=0,rl=rS.length;for(re=0;re<rl;re++)if(!(rQ=rS[re])||!rQ.source)return!1;return!0},rU.isOKCmdList=function(rS){if(!rS)return!1;var rQ,re,rl=0,rM=rS.length,rd=rm._context;for(rl=0;rl<rM;rl++)switch((rQ=rS[rl]).callee){case rd._drawTexture:case rd._fillTexture:case rd._drawTextureWithTransform:if(!(re=rQ[0])||!re.source)return!1}return!0},rU._gid=1,rU._pi=180/Math.PI,rU._pi2=Math.PI/180,rU._extReg=/\.(\w+)\??/g,rU.parseXMLFromString=function(rS){var rQ;if(rS=rS.replace(/>\s+</g,"><"),-1<(rQ=(new DOMParser).parseFromString(rS,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(rQ.firstChild.firstChild.textContent);return rQ},rU}(),r_=function(){function rS(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],rm.isWebGL&&ru.regCacheByFunction(rV.bind(this.startDispose,this),rV.bind(this.getCacheList,this))}rj(rS,"laya.utils.VectorGraphManager");var rQ=rS.prototype;return rQ.getId=function(){return this._id++},rQ.addShape=function(rS,rQ){this.shapeDic[rS]=rQ,this.useDic[rS]||(this.useDic[rS]=!0)},rQ.addLine=function(rS,rQ){this.shapeLineDic[rS]=rQ,this.shapeLineDic[rS]||(this.shapeLineDic[rS]=!0)},rQ.getShape=function(rS){this._checkKey&&null!=this.useDic[rS]&&(this.useDic[rS]=!0)},rQ.deleteShape=function(rS){this.shapeDic[rS]&&(this.shapeDic[rS]=null,delete this.shapeDic[rS]),this.shapeLineDic[rS]&&(this.shapeLineDic[rS]=null,delete this.shapeLineDic[rS]),null!=this.useDic[rS]&&delete this.useDic[rS]},rQ.getCacheList=function(){var rS,rQ=[];for(rS in this.shapeDic)rQ.push(this.shapeDic[rS]);for(rS in this.shapeLineDic)rQ.push(this.shapeLineDic[rS]);return rQ},rQ.startDispose=function(rS){var rQ;for(rQ in this.useDic)this.useDic[rQ]=!1;this._checkKey=!0},rQ.endDispose=function(){if(this._checkKey){var rS;for(rS in this.useDic)this.useDic[rS]||this.deleteShape(rS);this._checkKey=!1}},rS.getInstance=function(){return rS.instance=rS.instance||new rS},rS.instance=null,rS}(),rs=function(){function rl(){this._obj=null,this._obj=rl.supportWeakMap?new rf.window.WeakMap:{},rl.supportWeakMap||rl._maps.push(this)}rj(rl,"laya.utils.WeakObject");var rS=rl.prototype;return rS.set=function(rS,rQ){if(null!=rS)if(rl.supportWeakMap){var re=rS;"string"!=typeof rS&&"number"!=typeof rS||(re=rl._keys[rS])||(re=rl._keys[rS]={k:rS}),this._obj.set(re,rQ)}else"string"==typeof rS||"number"==typeof rS?this._obj[rS]=rQ:(rS.$_GID||(rS.$_GID=rV.getGID()),this._obj[rS.$_GID]=rQ)},rS.get=function(rS){if(null==rS)return null;if(rl.supportWeakMap){var rQ="string"==typeof rS||"number"==typeof rS?rl._keys[rS]:rS;return rQ?this._obj.get(rQ):null}return"string"==typeof rS||"number"==typeof rS?this._obj[rS]:this._obj[rS.$_GID]},rS.del=function(rS){if(null!=rS)if(rl.supportWeakMap){var rQ="string"==typeof rS||"number"==typeof rS?rl._keys[rS]:rS;if(!rQ)return;this._obj.delete(rQ)}else"string"==typeof rS||"number"==typeof rS?delete this._obj[rS]:delete this._obj[this._obj.$_GID]},rS.has=function(rS){if(null==rS)return!1;if(rl.supportWeakMap){var rQ="string"==typeof rS||"number"==typeof rS?rl._keys[rS]:rS;return this._obj.has(rQ)}return"string"==typeof rS||"number"==typeof rS?null!=this._obj[rS]:null!=this._obj[this._obj.$_GID]},rl.__init__=function(){(rl.supportWeakMap=null!=rf.window.WeakMap)||rO.timer.loop(rl.delInterval,null,rl.clearCache)},rl.clearCache=function(){for(var rS=0,rQ=rl._maps.length;rS<rQ;rS++){rl._maps[rS]._obj={}}},rl.supportWeakMap=!1,rl.delInterval=3e5,rl._keys={},rl._maps=[],ri(rl,["I",function(){return this.I=new rl}]),rl}(),ry=function(){function rS(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}rj(rS,"laya.utils.WordText");var rQ=rS.prototype;return rQ.setText=function(rS){this.changed=!0,this._text=rS},rQ.toString=function(){return this._text},rQ.charCodeAt=function(rS){return this._text?this._text.charCodeAt(rS):NaN},rQ.charAt=function(rS){return this._text?this._text.charAt(rS):null},ro(0,rQ,"length",function(){return this._text?this._text.length:0}),rS}(),rSS=function(rS){function rT(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,rT.__super.call(this),this._childs=rT.ARRAY_EMPTY,this._$P=rT.PROP_EMPTY,this.timer=rO.scaleTimer,this.conchModel=rm.isConchNode?this.createConchModel():null}rj(rT,"laya.display.Node",rR);var rQ=rT.prototype;return rQ._setBit=function(rS,rQ){1==rS&&(this._getBit(rS)!=rQ&&this._updateDisplayedInstage());rQ?this._bits|=rS:this._bits&=~rS},rQ._getBit=function(rS){return 0!=(this._bits&rS)},rQ._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},rQ._setUpNoticeType=function(rS){var rQ=this;for(rQ._setBit(rS,!0),rQ=rQ.parent;rQ;){if(rQ._getBit(rS))return;rQ._setBit(rS,!0),rQ=rQ.parent}},rQ.on=function(rS,rQ,re,rl){return"display"!==rS&&"undisplay"!==rS||this._getBit(1)||this._setUpNoticeType(1),this._createListener(rS,rQ,re,rl,!1)},rQ.once=function(rS,rQ,re,rl){return"display"!==rS&&"undisplay"!==rS||this._getBit(1)||this._setUpNoticeType(1),this._createListener(rS,rQ,re,rl,!0)},rQ.createConchModel=function(){return null},rQ.destroy=function(rS){void 0===rS&&(rS=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(rS?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},rQ.destroyChildren=function(){if(this._childs)for(var rS=this._childs.length-1;-1<rS;rS--)this._childs[rS].destroy(!0)},rQ.addChild=function(rS){if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),rS._parent===this){var rQ=this.getChildIndex(rS);rQ!==this._childs.length-1&&(this._childs.splice(rQ,1),this._childs.push(rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,this._childs.length-1)),this._childChanged())}else rS.parent&&rS.parent.removeChild(rS),this._childs===rT.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,this._childs.length-1),(rS.parent=this)._childChanged();return rS},rQ.addChildren=function(rS){for(var rQ=arguments,re=0,rl=rQ.length;re<rl;)this.addChild(rQ[re++])},rQ.addChildAt=function(rS,rQ){if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),0<=rQ&&rQ<=this._childs.length){if(rS._parent===this){var re=this.getChildIndex(rS);this._childs.splice(re,1),this._childs.splice(rQ,0,rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,rQ)),this._childChanged()}else rS.parent&&rS.parent.removeChild(rS),this._childs===rT.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(rQ,0,rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,rQ),rS.parent=this;return rS}throw new Error("appendChildAt:The index is out of bounds")},rQ.getChildIndex=function(rS){return this._childs.indexOf(rS)},rQ.getChildByName=function(rS){var rQ=this._childs;if(rQ)for(var re=0,rl=rQ.length;re<rl;re++){var rM=rQ[re];if(rM.name===rS)return rM}return null},rQ._get$P=function(rS){return this._$P[rS]},rQ._set$P=function(rS,rQ){return this.destroyed||(this._$P===rT.PROP_EMPTY&&(this._$P={}),this._$P[rS]=rQ),rQ},rQ.getChildAt=function(rS){return this._childs[rS]},rQ.setChildIndex=function(rS,rQ){var re=this._childs;if(rQ<0||rQ>=re.length)throw new Error("setChildIndex:The index is out of bounds.");var rl=this.getChildIndex(rS);if(rl<0)throw new Error("setChildIndex:node is must child of this object.");return re.splice(rl,1),re.splice(rQ,0,rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,rQ)),this._childChanged(),rS},rQ._childChanged=function(rS){},rQ.removeChild=function(rS){if(!this._childs)return rS;var rQ=this._childs.indexOf(rS);return this.removeChildAt(rQ)},rQ.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},rQ.removeChildByName=function(rS){var rQ=this.getChildByName(rS);return rQ&&this.removeChild(rQ),rQ},rQ.removeChildAt=function(rS){var rQ=this.getChildAt(rS);if(rQ){for(var re=this._childs.length-1,rl=rS;rl<re;++rl)this._childs[rl]=this._childs[rl+1];this._childs.length=re,this.conchModel&&this.conchModel.removeChild(rQ.conchModel),rQ.parent=null}return rQ},rQ.removeChildren=function(rS,rQ){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=2147483647),this._childs&&0<this._childs.length){var re=this._childs;if(0===rS&&rd<=rQ){var rl=re;this._childs=rT.ARRAY_EMPTY}else rl=re.splice(rS,rQ-rS);for(var rM=0,rd=rl.length;rM<rd;rM++)rl[rM].parent=null,this.conchModel&&this.conchModel.removeChild(rl[rM].conchModel)}return this},rQ.replaceChild=function(rS,rQ){var re=this._childs.indexOf(rQ);return-1<re?(this._childs.splice(re,1,rS),this.conchModel&&(this.conchModel.removeChild(rQ.conchModel),this.conchModel.addChildAt(rS.conchModel,re)),rQ.parent=null,rS.parent=this,rS):null},rQ._updateDisplayedInstage=function(){var rS;rS=this;var rQ=rO.stage;for(this._displayedInStage=!1;rS;){if(rS._getBit(1)){this._displayedInStage=rS._displayedInStage;break}if(rS==rQ||rS._displayedInStage){this._displayedInStage=!0;break}rS=rS.parent}},rQ._setDisplay=function(rS){this._displayedInStage!==rS&&((this._displayedInStage=rS)?this.event("display"):this.event("undisplay"))},rQ._displayChild=function(rS,rQ){var re=rS._childs;if(re)for(var rl=0;rl<re.length;rl++){var rM=re[rl];rM&&rM._getBit(1)&&(0<rM._childs.length?this._displayChild(rM,rQ):rM._setDisplay(rQ))}rS._setDisplay(rQ)},rQ.contains=function(rS){if(rS===this)return!0;for(;rS;){if(rS.parent===this)return!0;rS=rS.parent}return!1},rQ.timerLoop=function(rS,rQ,re,rl,rM,rd){void 0===rM&&(rM=!0),void 0===rd&&(rd=!1),this.timer.loop(rS,rQ,re,rl,rM,rd)},rQ.timerOnce=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=!0),this.timer._create(!1,!1,rS,rQ,re,rl,rM)},rQ.frameLoop=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=!0),this.timer._create(!0,!0,rS,rQ,re,rl,rM)},rQ.frameOnce=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=!0),this.timer._create(!0,!1,rS,rQ,re,rl,rM)},rQ.clearTimer=function(rS,rQ){this.timer.clear(rS,rQ)},ro(0,rQ,"numChildren",function(){return this._childs.length}),ro(0,rQ,"destroyed",function(){return this._destroyed}),ro(0,rQ,"parent",function(){return this._parent},function(rS){this._parent!==rS&&(rS?(this._parent=rS,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),rS.displayedInStage&&this._displayChild(this,!0)),rS._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=rS))}),ro(0,rQ,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),rT.ARRAY_EMPTY=[],rT.PROP_EMPTY={},rT.NOTICE_DISPLAY=1,rT.MOUSEENABLE=2,rT}(),rQS=function(rS){function rp(rS){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,rp.__super.call(this),this._padding=rp._PADDING,this._spacing=rp._SPACING,this._aligns=rp._ALIGNS,this._font=rJ.EMPTY,this._ower=rS}rj(rp,"laya.display.css.CSSStyle",rS);var rQ=rp.prototype;return rQ.destroy=function(){this._ower=null,this._font=null,this._rect=null},rQ.inherit=function(rS){this._font=rS._font,this._spacing=rS._spacing===rp._SPACING?rp._SPACING:rS._spacing.slice(),this.lineHeight=rS.lineHeight},rQ._widthAuto=function(){return 0!=(262144&this._type)},rQ.widthed=function(rS){return 0!=(8&this._type)},rQ._calculation=function(rS,rQ){if(rQ.indexOf("%")<0)return!1;var rl=this._ower,rM=rl.parent,rd=this._rect;function rT(rS,rQ,re){return rS*re[0]+rQ*re[1]+re[2]}function re(rS){var rQ=rM.width,re=rl.width;rd.width&&(rl.width=rT(rQ,re,rd.width)),rd.height&&(rl.height=rT(rQ,re,rd.height)),rd.left&&(rl.x=rT(rQ,re,rd.left)),rd.top&&(rl.y=rT(rQ,re,rd.top))}null===rd&&(rM._getCSSStyle()._type|=524288,rM.on("resize",this,re),this._rect=rd={input:{}});var rU=rQ.split(" ");return rU[0]=parseFloat(rU[0])/100,1==rU.length?rU[1]=rU[2]=0:(rU[1]=parseFloat(rU[1])/100,rU[2]=parseFloat(rU[2])),rd[rS]=rU,rd.input[rS]=rQ,re(),!0},rQ.heighted=function(rS){return 0!=(8192&this._type)},rQ.size=function(rS,rQ){var re=this._ower,rl=!1;-1!==rS&&rS!=this._ower.width&&(this._type|=8,this._ower.width=rS,rl=!0),-1!==rQ&&rQ!=this._ower.height&&(this._type|=8192,this._ower.height=rQ,rl=!0),rl&&(re._layoutLater(),524288&this._type&&re.event("resize",this))},rQ._getAlign=function(){return this._aligns[0]},rQ._getValign=function(){return this._aligns[1]},rQ._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},rQ._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new rJ(this._font))},rQ.render=function(rS,rQ,re,rl){var rM=rS.width,rd=rS.height;re-=rS.pivotX,rl-=rS.pivotY,this._bgground&&null!=this._bgground.color&&rQ.ctx.fillRect(re,rl,rM,rd,this._bgground.color),this._border&&this._border.color&&rQ.drawRect(re,rl,rM,rd,this._border.color.strColor,this._border.size)},rQ.getCSSStyle=function(){return this},rQ.cssText=function(rS){this.attrs(rp.parseOneCSS(rS,";"))},rQ.attrs=function(rS){if(rS)for(var rQ=0,re=rS.length;rQ<re;rQ++){var rl=rS[rQ];this[rl[0]]=rl[1]}},rQ.setTransform=function(rS){"none"===rS?this._tf=rU._TF_EMPTY:this.attrs(rp.parseOneCSS(rS,","))},rQ.translate=function(rS,rQ){this._tf===rU._TF_EMPTY&&(this._tf=new rM),this._tf.translateX=rS,this._tf.translateY=rQ},rQ.scale=function(rS,rQ){this._tf===rU._TF_EMPTY&&(this._tf=new rM),this._tf.scaleX=rS,this._tf.scaleY=rQ},rQ._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},ro(0,rQ,"block",rS.prototype._$get_block,function(rS){rS?this._type|=1:this._type&=-2}),ro(0,rQ,"valign",function(){return rp._valigndef[this._aligns[1]]},function(rS){this._aligns===rp._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=rp._valigndef[rS]}),ro(0,rQ,"height",null,function(rS){if(this._type|=8192,"string"==typeof rS){if(this._calculation("height",rS))return;rS=parseInt(rS)}this.size(-1,rS)}),ro(0,rQ,"width",null,function(rS){if(this._type|=8,"string"==typeof rS){var rQ=rS.indexOf("auto");if(0<=rQ&&(this._type|=262144,rS=rS.substr(0,rQ)),this._calculation("width",rS))return;rS=parseInt(rS)}this.size(rS,-1)}),ro(0,rQ,"fontWeight",function(){return this._font.weight},function(rS){this._createFont().weight=rS}),ro(0,rQ,"left",null,function(rS){var rQ=this._ower;if("string"==typeof rS){if("center"===rS?rS="50% -50% 0":"right"===rS&&(rS="100% -100% 0"),this._calculation("left",rS))return;rS=parseInt(rS)}rQ.x=rS}),ro(0,rQ,"_translate",null,function(rS){this.translate(rS[0],rS[1])}),ro(0,rQ,"absolute",function(){return 0!=(4&this._type)}),ro(0,rQ,"top",null,function(rS){var rQ=this._ower;if("string"==typeof rS){if("middle"===rS?rS="50% -50% 0":"bottom"===rS&&(rS="100% -100% 0"),this._calculation("top",rS))return;rS=parseInt(rS)}rQ.y=rS}),ro(0,rQ,"align",function(){return rp._aligndef[this._aligns[0]]},function(rS){this._aligns===rp._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=rp._aligndef[rS]}),ro(0,rQ,"bold",function(){return this._font.bold},function(rS){this._createFont().bold=rS}),ro(0,rQ,"padding",function(){return this._padding},function(rS){this._padding=rS}),ro(0,rQ,"leading",function(){return this._spacing[1]},function(rS){"string"==typeof rS&&(rS=parseInt(rS+"")),this._spacing===rp._SPACING&&(this._spacing=[0,0]),this._spacing[1]=rS}),ro(0,rQ,"lineElement",function(){return 0!=(65536&this._type)},function(rS){rS?this._type|=65536:this._type&=-65537}),ro(0,rQ,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(rS){this.lineElement=!1,"right"===rS?this._type|=32768:this._type&=-32769}),ro(0,rQ,"textDecoration",function(){return this._font.decoration},function(rS){this._createFont().decoration=rS}),ro(0,rQ,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(rS){"nowrap"===rS&&(this._type|=131072),"none"===rS&&(this._type&=-131073)}),ro(0,rQ,"background",null,function(rS){rS?(this._bgground||(this._bgground={}),this._bgground.color=rS,this._ower.conchModel&&this._ower.conchModel.bgColor(rS),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),ro(0,rQ,"wordWrap",function(){return 0==(131072&this._type)},function(rS){rS?this._type&=-131073:this._type|=131072}),ro(0,rQ,"color",function(){return this._font.color},function(rS){this._createFont().color=rS}),ro(0,rQ,"password",function(){return this._font.password},function(rS){this._createFont().password=rS}),ro(0,rQ,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(rS){"none"===rS?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=rS),this._ower.conchModel&&this._ower.conchModel.bgColor(rS),this._ower._renderType|=256}),ro(0,rQ,"font",function(){return this._font.toString()},function(rS){this._createFont().set(rS)}),ro(0,rQ,"weight",null,function(rS){this._createFont().weight=rS}),ro(0,rQ,"letterSpacing",function(){return this._spacing[0]},function(rS){"string"==typeof rS&&(rS=parseInt(rS+"")),this._spacing===rp._SPACING&&(this._spacing=[0,0]),this._spacing[0]=rS}),ro(0,rQ,"fontSize",function(){return this._font.size},function(rS){this._createFont().size=rS}),ro(0,rQ,"italic",function(){return this._font.italic},function(rS){this._createFont().italic=rS}),ro(0,rQ,"fontFamily",function(){return this._font.family},function(rS){this._createFont().family=rS}),ro(0,rQ,"stroke",function(){return this._font.stroke[0]},function(rS){this._createFont().stroke===rJ._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=rS}),ro(0,rQ,"strokeColor",function(){return this._font.stroke[1]},function(rS){this._createFont().stroke===rJ._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=rS}),ro(0,rQ,"border",function(){return this._border?this._border.value:""},function(rS){if("none"!=rS){this._border||(this._border={});var rQ=(this._border.value=rS).split(" ");if(this._border.color=rW.create(rQ[rQ.length-1]),1==rQ.length)return this._border.size=1,void(this._border.type="solid");var re=0;0<rQ[0].indexOf("px")?(this._border.size=parseInt(rQ[0]),re++):this._border.size=1,this._border.type=rQ[re],this._ower._renderType|=256}else this._border=null}),ro(0,rQ,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(rS){rS?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==rS?null:rW.create(rS),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),ro(0,rQ,"position",function(){return 4&this._type?"absolute":""},function(rS){"absolute"==rS?this._type|=4:this._type&=-5}),ro(0,rQ,"display",null,function(rS){switch(rS){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),ro(0,rQ,"paddingLeft",function(){return this.padding[3]}),ro(0,rQ,"paddingTop",function(){return this.padding[0]}),ro(0,rQ,"_scale",null,function(rS){this._ower.scale(rS[0],rS[1])}),ro(0,rQ,"_rotate",null,function(rS){this._ower.rotation=rS}),rp.parseOneCSS=function(rS,rQ){for(var re,rl=[],rM=rS.split(rQ),rd=0,rT=rM.length;rd<rT;rd++){var rU=rM[rd],ri=rU.indexOf(":"),rR=rU.substr(0,ri).replace(/^\s+|\s+$/g,"");if(0!=rR.length){var ro=rU.substr(ri+1).replace(/^\s+|\s+$/g,""),rY=[rR,ro];switch(rR){case"italic":case"bold":rY[1]="true"==ro;break;case"line-height":rY[0]="lineHeight",rY[1]=parseInt(ro);break;case"font-size":rY[0]="fontSize",rY[1]=parseInt(ro);break;case"padding":1<(re=ro.split(" ")).length||(re[1]=re[2]=re[3]=re[0]),rY[1]=[parseInt(re[0]),parseInt(re[1]),parseInt(re[2]),parseInt(re[3])];break;case"rotate":rY[0]="_rotate",rY[1]=parseFloat(ro);break;case"scale":re=ro.split(" "),rY[0]="_scale",rY[1]=[parseFloat(re[0]),parseFloat(re[1])];break;case"translate":re=ro.split(" "),rY[0]="_translate",rY[1]=[parseInt(re[0]),parseInt(re[1])];break;default:(rY[0]=rp._CSSTOVALUE[rR])||(rY[0]=rR)}rl.push(rY)}}return rl},rp.parseCSS=function(rS,rQ){for(var re;null!=(re=rp._parseCSSRegExp.exec(rS));)rp.styleSheets[re[1]]=rp.parseOneCSS(re[2],";")},rp.EMPTY=new rp(null),rp._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},rp._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),rp._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},rp._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},rp.styleSheets={},rp.ALIGN_CENTER=1,rp.ALIGN_RIGHT=2,rp.VALIGN_MIDDLE=1,rp.VALIGN_BOTTOM=2,rp._CSS_BLOCK=1,rp._DISPLAY_NONE=2,rp._ABSOLUTE=4,rp._WIDTH_SET=8,rp._PADDING=[0,0,0,0],rp._RECT=[-1,-1,-1,-1],rp._SPACING=[0,0],rp._ALIGNS=[0,0,0],rp.ADDLAYOUTED=512,rp._NEWFONT=4096,rp._HEIGHT_SET=8192,rp._BACKGROUND_SET=16384,rp._FLOAT_RIGHT=32768,rp._LINE_ELEMENT=65536,rp._NOWARP=131072,rp._WIDTHAUTO=262144,rp._LISTERRESZIE=524288,rp}(rU),reS=function(rS){function rT(){this.url=null,this.audio=null,this.loaded=!1,rT.__super.call(this)}rj(rT,"laya.media.h5audio.AudioSound",rR);var rQ=rT.prototype;return rQ.dispose=function(){var rS=rT._audioCache[this.url];rS&&(rS.src="",delete rT._audioCache[this.url])},rQ.load=function(rS){var rQ;if(rS=rb.formatURL(rS),(this.url=rS)==rt._tMusic?(rT._initMusicAudio(),(rQ=rT._musicAudio).src!=rS&&(rT._audioCache[rQ.src]=null,rQ=null)):rQ=rT._audioCache[rS],rQ&&2<=rQ.readyState)this.event("complete");else{rQ||(rQ=rS==rt._tMusic?(rT._initMusicAudio(),rT._musicAudio):rf.createElement("audio"),(rT._audioCache[rS]=rQ).src=rS),rQ.addEventListener("canplaythrough",rl),rQ.addEventListener("error",rM);var re=this;(this.audio=rQ).load?rQ.load():rM()}function rl(){rd(),re.loaded=!0,re.event("complete")}function rM(){rQ.load=null,rd(),re.event("error")}function rd(){rQ.removeEventListener("canplaythrough",rl),rQ.removeEventListener("error",rM)}},rQ.play=function(rS,rQ,re){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),!this.url)return null;var rl,rM;if(!(rl=this.url==rt._tMusic?rT._musicAudio:rT._audioCache[this.url]))return null;rM=rZ.getItem("audio:"+this.url),rm.isConchApp?rM||((rM=rf.createElement("audio")).src=this.url):this.url==rt._tMusic?(rT._initMusicAudio(),(rM=rT._musicAudio).src=this.url):rM=rM||rl.cloneNode(!0);var rd=new rpS(rM);return rd.url=this.url,rd.loops=rQ,rd.startTime=rS,rd.startHandler=re,rd.play(!1),rt.addChannel(rd),rd},ro(0,rQ,"duration",function(){var rS;return(rS=rT._audioCache[this.url])?rS.duration:0}),rT._initMusicAudio=function(){rT._musicAudio||(rT._musicAudio||(rT._musicAudio=rf.createElement("audio")),rm.isConchApp||rf.document.addEventListener("mousedown",rT._makeMusicOK))},rT._makeMusicOK=function(){rf.document.removeEventListener("mousedown",rT._makeMusicOK),rT._musicAudio.src?rT._musicAudio.play():(rT._musicAudio.src="",rT._musicAudio.load())},rT._audioCache={},rT._musicAudio=null,rT}(),rlS=function(rS){function rQ(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,rQ.__super.call(this)}rj(rQ,"laya.media.SoundChannel",rR);var re=rQ.prototype;return re.play=function(){},re.stop=function(){},re.pause=function(){},re.resume=function(){},re.__runComplete=function(rS){rS&&rS.run()},ro(0,re,"volume",function(){return 1},function(rS){}),ro(0,re,"position",function(){return 0}),ro(0,re,"duration",function(){return 0}),rQ}(),rMS=function(rS){function rQ(){rQ.__super.call(this)}rj(rQ,"laya.media.Sound",rR);var re=rQ.prototype;return re.load=function(rS){},re.play=function(rS,rQ,re){return void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),null},re.dispose=function(){},ro(0,re,"duration",function(){return 0}),rQ}(),rdS=function(rS){function rM(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,rM.__super.call(this)}rj(rM,"laya.media.webaudio.WebAudioSound",rR);var rQ=rM.prototype;return rQ.load=function(rS){this.url=rS,this.audioBuffer=rM._dataCache[rS],this.audioBuffer?this._loaded(this.audioBuffer):(rM.e.on("loaded:"+rS,this,this._loaded),rM.e.on("err:"+rS,this,this._err),rM.__loadingSound[rS]||(rM.__loadingSound[rS]=!0,rO.loader.load(rS,rz.create(this,this.onloaded),null,rUS.BUFFER,4,!1,null,!0)))},rQ.onloaded=function(rS){rS||this._err(),this._disposed?this._removeLoadEvents():(this.data=rS,rM.buffs.push({buffer:this.data,url:this.url}),rM.decode())},rQ._err=function(){if(this._removeLoadEvents(),rM.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var rS,rQ,re,rl=0;for(rS=(rQ=this.__toPlays).length,rl=0;rl<rS;rl++)(re=rQ[rl])[3]&&!re[3].isStopped&&re[3].event("error");this.__toPlays.length=0}},rQ._loaded=function(rS){this._removeLoadEvents(),this._disposed||(this.audioBuffer=rS,this.loaded=!0,this.event("complete"))},rQ._removeLoadEvents=function(){rM.e.off("loaded:"+this.url,this,this._loaded),rM.e.off("err:"+this.url,this,this._err)},rQ.__playAfterLoaded=function(){if(this.__toPlays){var rS,rQ,re,rl=0;for(rS=(rQ=this.__toPlays).length,rl=0;rl<rS;rl++)(re=rQ[rl])[3]&&!re[3].isStopped&&this.play(re[0],re[1],re[2],re[3]);this.__toPlays.length=0}},rQ.play=function(rS,rQ,re,rl){return void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),rl=rl||new rJS,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([rS,rQ,re,rl]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),rl.url=this.url,rl.loops=rQ,rl.audioBuffer=this.audioBuffer,rl.startTime=rS,rl.startHandler=re,rl.play(!1),rt.addChannel(rl),rl},rQ.dispose=function(){this._disposed=!0,delete rM._dataCache[this.url],delete rM.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},ro(0,rQ,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),rM.decode=function(){if(!(rM.buffs.length<=0||rM.isDecoding))if(rM.isDecoding=!0,(rM.tInfo=rM.buffs.shift())&&rM.tInfo.buffer&&rM.tInfo.buffer.byteLength)try{rM.ctx.decodeAudioData(rM.tInfo.buffer,rM._done,rM._fail)}catch(rS){console.error("decodeAudioData error  byteLength:"+rM.tInfo.buffer.byteLength+"  url:"+rM.tInfo.url)}else rM._fail()},rM._done=function(rS){rM.e.event("loaded:"+rM.tInfo.url,rS),rM._dataCache[rM.tInfo.url]=rS,rM.isDecoding=!1,rM.decode()},rM._fail=function(){rM.e.event("err:"+rM.tInfo.url,null),rM.isDecoding=!1,rM.decode()},rM._playEmptySound=function(){if(null!=rM.ctx){if(rM._emptySource&&(rM._emptySource.stop(),rM._emptySource.disconnect(0),!rJS._tryCleanFailed))try{rM._emptySource.buffer=null}catch(rS){rJS._tryCleanFailed=!0}var rS=rM.ctx.createBufferSource();rS.buffer=rM._miniBuffer,rS.connect(rM.ctx.destination),rS.start(0,0,0),rM._emptySource=rS}},rM._unlock=function(){rM._unlocked||(rM._playEmptySound(),"running"==rM.ctx.state?(rf.document.removeEventListener("mousedown",rM._unlock,!0),rf.document.removeEventListener("touchend",rM._unlock,!0),rf.document.removeEventListener("touchstart",rM._unlock,!0),rM._unlocked=!0):"suspended"==rM.ctx.state&&rt._recoverWebAudio())},rM.initWebAudio=function(){"running"!=rM.ctx.state&&(rM._unlock(),rf.document.addEventListener("mousedown",rM._unlock,!0),rf.document.addEventListener("touchend",rM._unlock,!0),rf.document.addEventListener("touchstart",rM._unlock,!0))},rM._emptySource=null,rM._dataCache={},rM.buffs=[],rM.isDecoding=!1,rM._unlocked=!1,rM.tInfo=null,rM.__loadingSound={},ri(rM,["window",function(){return this.window=rf.window},"webAudioEnabled",function(){return this.webAudioEnabled=rM.window.AudioContext||rM.window.webkitAudioContext||rM.window.mozAudioContext},"ctx",function(){return this.ctx=rM.webAudioEnabled?new(rM.window.AudioContext||rM.window.webkitAudioContext||rM.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=rM.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new rR}]),rM}(),rTS=function(rS){function rQ(){this._responseType=null,this._data=null,rQ.__super.call(this),this._http=new rf.window.XMLHttpRequest}rj(rQ,"laya.net.HttpRequest",rR);var re=rQ.prototype;return re.send=function(rS,rQ,re,rl,rM){void 0===re&&(re="get"),void 0===rl&&(rl="text"),this._responseType=rl,this._data=null;var rd=this,rT=this._http;if(rT.open(re,rS,!0),rM)for(var rU=0;rU<rM.length;rU++)rT.setRequestHeader(rM[rU++],rM[rU]);else rm.isConchApp||(rQ&&"string"!=typeof rQ?rT.setRequestHeader("Content-Type","application/json"):rT.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));rT.responseType="arraybuffer"!==rl?"text":"arraybuffer",rT.onerror=function(rS){rd._onError(rS)},rT.onabort=function(rS){rd._onAbort(rS)},rT.onprogress=function(rS){rd._onProgress(rS)},rT.onload=function(rS){rd._onLoad(rS)},rT.send(rQ)},re._onProgress=function(rS){rS&&rS.lengthComputable&&this.event("progress",rS.loaded/rS.total)},re._onAbort=function(rS){this.error("Request was aborted by user")},re._onError=function(rS){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},re._onLoad=function(rS){var rQ=this._http,re=void 0!==rQ.status?rQ.status:200;200===re||204===re||0===re?this.complete():this.error("["+rQ.status+"]"+rQ.statusText+":"+rQ.responseURL)},re.error=function(rS){this.clear(),this.event("error",rS)},re.complete=function(){this.clear();var rQ=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=rV.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(rS){rQ=!1,this.error(rS.message)}rQ&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},re.clear=function(){var rS=this._http;rS.onerror=rS.onabort=rS.onprogress=rS.onload=null},ro(0,re,"url",function(){return this._http.responseURL}),ro(0,re,"http",function(){return this._http}),ro(0,re,"data",function(){return this._data}),rQ}(),rUS=function(rS){function rI(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,rI.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}rj(rI,"laya.net.Loader",rR);var rQ=rI.prototype;return rQ.load=function(rS,rQ,re,rl,rM){if(rS&&""!=rS||console.error("Loader 加载的url不合法 "+rS),void 0===re&&(re=!0),void 0===rM&&(rM=!1),0===(this._url=rS).indexOf("data:image")?this._type=rQ="image":this._type=rQ||(rQ=this.getTypeFromUrl(rS)),this._cache=re,this._data=null,!rM&&rI.loadedMap[rS])return this._data=rI.loadedMap[rS],this.event("progress",1),void this.event("complete",this._data);if(rl&&rI.setGroup(rS,rl),null!=rI.parserMap[rQ])return this._customParse=!0,void(rI.parserMap[rQ]instanceof laya.utils.Handler?rI.parserMap[rQ].runWith(this):rI.parserMap[rQ].call(null,this));if("image"===rQ||"htmlimage"===rQ||"nativeimage"===rQ)return this._loadImage(rS);if("ttf"===rQ)return this._loadTTF(rS);switch(rQ){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:rQ}rI.preLoadedMap[rS]?this.onLoaded(rI.preLoadedMap[rS]):rT.resMgrLoad(rS,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},rQ.getTypeFromUrl=function(rS){var rQ=rV.getFileExtension(rS);return rQ?rI.typeMap[rQ]:(console.warn("Not recognize the resources suffix",rS),"text")},rQ._loadTTF=function(rS){rS=rb.formatURL(rS);var rQ=new rh;rQ.complete=rz.create(this,this.onLoaded),rQ.load(rS)},rQ._loadImage=function(rS){rT.imgMgrLoad(rS,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},rQ._loadImageComplete=function(rS,rQ,re){if(null!=re)if(re instanceof ArrayBuffer){var rl=new DataView(re),rM=new laya.webgl.resource.WebGLImage(new Uint8Array(re,8),rS,0,!1,rl.getUint32(0),rl.getUint32(4));this.onLoaded(rM)}else if(re instanceof roS)rI.imgMgrSet[rS]=rQ,rT.imgMgrLock(rS,rI.imgMgrSet[rS]),this._url=rS,this.complete(re);else{var rd=-1!=rS.indexOf(".png",rS.length-4)?6408:6407;rM=new laya.webgl.resource.WebGLImage(re,rS,rd,!1,re.width,re.height);this.onLoaded(rM)}else this.event("error","Load image failed")},rQ._loadSound=function(rS){var rQ=new rt._soundClass,re=this;function rl(){rQ.offAll()}rQ.on("complete",this,function(){rl(),re.onLoaded(rQ)}),rQ.on("error",this,function(){rl(),rQ.dispose(),re.event("error","Load sound failed")}),rQ.load(rS)},rQ.onProgress=function(rS){"atlas"===this._type?this.event("progress",.3*rS):this.event("progress",rS)},rQ.onError=function(rS){this.event("error",rS)},rQ._loadedComplete=function(rS,rQ,re){if(null!=re)switch(this._type){case"atlas":case"plf":case"json":var rl=new rw(re);this.onLoaded(JSON.parse(rl.readUTFBytes()));break;case"font":rl=new rw(re);this.onLoaded(rV.parseXMLFromString(rl.readUTFBytes()));break;default:this.onLoaded(re)}else this.event("error",rS)},rQ.onLoaded=function(rS){var rQ=this._type;if("plf"==rQ)this.parsePLFData(rS),this.complete(rS);else if("image"===rQ){var re=new roS(rS);re.url=this._url,this.complete(re)}else if("sound"===rQ||"htmlimage"===rQ||"nativeimage"===rQ)this.complete(rS);else if("atlas"===rQ){if(!rS.src&&!rS._setContext){if(!this._data){if((this._data=rS).meta&&rS.meta.image)for(var rl=rS.meta.image.split(","),rM=0<=this._url.indexOf("/")?"/":"\\",rd=this._url.lastIndexOf(rM),rT=0<=rd?this._url.substr(0,rd+1):"",rU=0,ri=rl.length;rU<ri;rU++)rl[rU]=rT+rl[rU];else rl=[this._url.replace(".json",".png")];rl.reverse(),rS.toLoads=rl,rS.pics=[]}return this.event("progress",.3+1/rl.length*.6),this._loadImage(rl.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(rS),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var rR=this._data.frames,ro=this._url.split("?")[0],rY=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:ro.substring(0,ro.lastIndexOf("."))+"/",rp=this._data.pics,rJ=rb.formatURL(this._url),rL=rI.atlasMap[rJ]||(rI.atlasMap[rJ]=[]);rL.dir=rY;var rj=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var rc in rj=parseFloat(this._data.meta.scale),rR){var rG,rz=rR[rc],rA=rp[rz.frame.idx?rz.frame.idx:0],rv=rb.formatURL(rY+rc);rA.scaleRate=rj,rG=roS.create(rA,rz.frame.x,rz.frame.y,rz.frame.w,rz.frame.h,rz.spriteSourceSize.x,rz.spriteSourceSize.y,rz.sourceSize.w,rz.sourceSize.h),rI.cacheRes(rv,rG),rI.keepCache(this._url,rY+rc),rG.url=rv,rL.push(rv)}else for(rc in rR)rA=rp[(rz=rR[rc]).frame.idx?rz.frame.idx:0],rv=rb.formatURL(rY+rc),rI.cacheRes(rv,roS.create(rA,rz.frame.x,rz.frame.y,rz.frame.w,rz.frame.h,rz.spriteSourceSize.x,rz.spriteSourceSize.y,rz.sourceSize.w,rz.sourceSize.h)),rI.loadedMap[rv].url=rv,rI.keepCache(this._url,rY+rc),rL.push(rv);delete this._data.pics,this.complete(this._data)}else if("font"==rQ){if(!rS.src)return this._data=rS,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var rD=new rE;rD.parseFont(this._data,rS);var rB=this._url.split(".fnt")[0].split("/"),rO=rB[rB.length-1];rcS.registerBitmapFont(rO,rD),this._data=rD,this.complete(this._data)}else if("pkm"==rQ){var rH=rBS.create(rS,this._url),rg=new roS(rH);rg.url=this._url,this.complete(rg)}else this.complete(rS)},rQ.parsePLFData=function(rS){var rQ,re,rl;for(rQ in rS)switch(rl=rS[rQ],rQ){case"json":case"text":for(re in rl)rI.preLoadedMap[rb.formatURL(re)]=rl[re];break;default:for(re in rl)rI.preLoadedMap[rb.formatURL(re)]=rl[re]}},rQ.complete=function(rS){this._data=rS,this._customParse?this.event("loaded",rS instanceof Array?[rS]:rS):(rI._loaders.push(this),rI._isWorking||rI.checkNext())},rQ.endLoad=function(rS){rS&&(this._data=rS),this._cache&&rI.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},ro(0,rQ,"url",function(){return this._url}),ro(0,rQ,"data",function(){return this._data}),ro(0,rQ,"cache",function(){return this._cache}),ro(0,rQ,"type",function(){return this._type}),rI.checkNext=function(){rI._isWorking=!0;for(var rS=rf.now();rI._startIndex<rI._loaders.length;)if(rf.now(),rI._loaders[rI._startIndex].endLoad(),rI._startIndex++,rf.now()-rS>rI.maxTimeOut)return console.warn("loader callback cost a long time:"+(rf.now()-rS)+" url="+rI._loaders[rI._startIndex-1].url),void rO.timer.frameOnce(1,null,rI.checkNext);rI._loaders.length=0,rI._startIndex=0,rI._isWorking=!1},rI.clearRes=function(rS,rQ){if(null!=rS){void 0===rQ&&(rQ=!1),rS=rb.formatURL(rS);var re=rI.getAtlas(rS);if(re){for(var rl=0,rM=re.length;rl<rM;rl++){var rd=re[rl],rT=rI.getRes(rd);delete rI.loadedMap[rd],rI.clearCache(rS.substring(rb.basePath.length),rd.substring(rb.basePath.length)),rT&&rT.destroy(rQ)}re.length=0,delete rI.atlasMap[rS],delete rI.loadedMap[rS]}else{var rU=rI.loadedMap[rS];rU&&(delete rI.loadedMap[rS],rU instanceof laya.resource.Texture&&rU.bitmap&&rU.destroy(rQ))}}},rI.clearTextureRes=function(rS){rS=rb.formatURL(rS);var rQ=laya.net.Loader.getAtlas(rS),re=rQ&&0<rQ.length?laya.net.Loader.getRes(rQ[0]):laya.net.Loader.getRes(rS);re&&re.bitmap&&(rm.isConchApp&&!rm.isConchWebGL?re.bitmap.source.releaseTexture&&re.bitmap.source.releaseTexture():null==re.bitmap._atlaser&&re.bitmap.releaseResource(!0))},rI.getRes=function(rS){return rI.loadedMap[rb.formatURL(rS)]},rI.getAtlas=function(rS){return rI.atlasMap[rb.formatURL(rS)]},rI.cacheRes=function(rS,rQ){rS=rb.formatURL(rS),null!=rI.loadedMap[rS]?console.warn("Resources already exist,is repeated loading:",rS):rI.loadedMap[rS]=rQ},rI.setGroup=function(rS,rQ){rI.groupMap[rQ]||(rI.groupMap[rQ]=[]),rI.groupMap[rQ].push(rS)},rI.clearResByGroup=function(rS){if(rI.groupMap[rS]){var rQ=rI.groupMap[rS],re=0,rl=rQ.length;for(re=0;re<rl;re++)rI.clearRes(rQ[re]);rQ.length=0}},rI.keepCache=function(rS,rQ){if(rS&&rQ){var re=rI.cacheSet[rQ];re?-1==re.indexOf(rS)&&re.push(rS):rI.cacheSet[rQ]=[rS]}},rI.clearCache=function(rS,rQ){if(rS&&rQ){var re=rI.cacheSet[rQ];if(re){var rl=re.indexOf(rS);if(-1!==rl){var rM=re.length-1;0==rM?(delete rI.cacheSet[rQ],0<rI.imgMgrSet[rQ]?rT.imgMgrFree(rQ,rI.imgMgrSet[rQ]):rI.clearRes(rQ,!0)):(re[rl]=re[rM],re.length=rM)}}}},rI.saveObject=function(rS,rQ,re){if(rQ&&rS){var rl=rI.objectSet[rS];rl?(console.warn("Loader.saveObject: "+rS),rl[0]=rQ,rl[1]=re):rI.objectSet[rS]=[rQ,re,[]]}},rI.findObject=function(rS){if(rS){var rQ=rI.objectSet[rS];if(rQ)return rQ[0]}return null},rI.keepObject=function(rS,rQ){if(rS&&rQ){var re=rI.objectSet[rQ];re&&-1===re[2].indexOf(rS)&&re[2].push(rS)}},rI.clearObject=function(rS,rQ){if(rS&&rQ){var re=rI.objectSet[rQ];if(re){var rl=re[2],rM=rl.indexOf(rS);if(-1!==rM){var rd=rl.length-1;0==rd?(delete rI.objectSet[rQ],re[1]&&re[1].call(null,re[0])):(rl[rM]=rl[rd],rl.length=rd)}}}},rI.TEXT="text",rI.JSON="json",rI.XML="xml",rI.BUFFER="arraybuffer",rI.IMAGE="image",rI.SOUND="sound",rI.ATLAS="atlas",rI.FONT="font",rI.TTF="ttf",rI.PLF="plf",rI.PKM="pkm",rI.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},rI.parserMap={},rI.groupMap={},rI.maxTimeOut=100,rI.loadedMap={},rI.preLoadedMap={},rI.atlasMap={},rI._loaders=[],rI._isWorking=!1,rI._startIndex=0,rI.imgCache={},rI.cacheSet={},rI.objectSet={},rI.imgMgrSet={},rI}(),riS=function(rS){var rp;function rJ(){this.retryNum=3,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},rJ.__super.call(this);for(var rS=0;rS<this._maxPriority;rS++)this._resInfos[rS]=[]}rj(rJ,"laya.net.LoaderManager",rR);var rQ=rJ.prototype;return rQ.create=function(rS,re,rQ,rl,rM,rd,rT,rU){if(null==rd&&(rd=2),null==rT&&(rT=!0),rS instanceof Array){var ri=rS,rR=ri.length,ro=0;if(rQ)var rY=rz.create(rQ.caller,rQ.method,rQ.args,!1);for(var rp=0;rp<rR;rp++){var rJ=ri[rp];"string"==typeof rJ&&(rJ=ri[rp]={url:rJ}),rJ.progress=0}for(rp=0;rp<rR;rp++){rJ=ri[rp];var rL=rQ?rz.create(null,rG,[rJ],!1):null,rj=rQ||re?rz.create(null,rc,[rJ]):null;this._create(rJ.url,rj,rL,rJ.clas||rl,rJ.params||rM,null!=rJ.priority&&0<=rJ.priority?rJ.priority:rd,rT,rJ.group||rU)}function rc(rS,rQ){ro++,rS.progress=1,ro===rR&&re&&re.run()}function rG(rS,rQ){rS.progress=rQ;for(var re=0,rl=0;rl<rR;rl++){re+=ri[rl].progress}var rM=re/rR;rY.runWith(rM)}return!0}return this._create(rS,re,rQ,rl,rM,rd,rT,rU)},rQ._create=function(rQ,re,rS,rl,rM,rd,rT,rU){rQ&&""!=rQ||console.error("加载的url不合法 "+rQ),null==rd&&(rd=2),null==rT&&(rT=!0);var ri=rb.formatURL(rQ),rR=this.getRes(ri);if(rR)!rR.hasOwnProperty("loaded")||rR.loaded?(rS&&rS.runWith(1),re&&re.run()):re&&rO.loader._createListener(rQ,re.caller,re.method,re.args,!0,!1);else{var ro=rV.getFileExtension(rQ),rY=rJ.createMap[ro];if(!rY)throw new Error("LoaderManager:unknown file("+rQ+") extension with: "+ro+".");rl||(rl=rY[0]);var rp=rY[1];if("atlas"==ro)this.load(rQ,re,rS,rp,rd,rT);else{rl===roS&&(rp="htmlimage"),(rR=rl?new rl:null).hasOwnProperty("_loaded")&&(rR._loaded=!1),rR._setUrl(rQ),rU&&rR._setGroup(rU),this._createLoad(rR,rQ,rz.create(null,function(rS){rR&&!rR.destroyed&&rS&&rR.onAsynLoaded.call(rR,rQ,rS,rM),re&&re.run();rO.loader.event(rQ)}),rS,rp,rd,!1,rU,!0),rT&&this.cacheRes(ri,rR)}}return rR},rQ.load=function(rS,rQ,re,rl,rM,rd,rT,rU){rS&&""!=rS||console.error("加载的url不合法 "+rS);var ri=this;if(null==rM&&(rM=2),null==rd&&(rd=!0),void 0===rU&&(rU=!1),rS instanceof Array)return this._loadAssets(rS,rQ,re,rl,rM,rd,rT);var rR=rUS.getRes(rS);if(null!=rR)rO.timer.frameOnce(1,null,function(){re&&re.runWith(1),rQ&&rQ.runWith(rR),ri._loaderCount||ri.event("complete")});else{var ro=rJ._resMap[rS];ro?(rQ&&ro._createListener("complete",rQ.caller,rQ.method,rQ.args,!1,!1),re&&ro._createListener("progress",re.caller,re.method,re.args,!1,!1)):((ro=this._infoPool.length?this._infoPool.pop():new rp).url=rS,ro.type=rl,ro.cache=rd,ro.group=rT,ro.ignoreCache=rU,ro.priority=rM,rQ&&ro.on("complete",rQ.caller,rQ.method,rQ.args),re&&ro.on("progress",re.caller,re.method,re.args),rJ._resMap[rS]=ro,rM=rM<this._maxPriority?0<=rM?rM:0:this._maxPriority-1,this._resInfos[rM].push(ro),this._next())}return this},rQ._createLoad=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){var rR=this;if(null==rd&&(rd=2),null==rT&&(rT=!0),void 0===ri&&(ri=!1),rQ instanceof Array)return this._loadAssets(rQ,re,rl,rM,rd,rT,rU);var ro=rUS.getRes(rQ);if(null!=ro)rO.timer.frameOnce(1,null,function(){rl&&rl.runWith(1),re&&re.runWith(ro),rR._loaderCount||rR.event("complete")});else{var rY=rJ._resMap[rQ];rY?(re&&rY._createListener("complete",re.caller,re.method,re.args,!1,!1),rl&&rY._createListener("progress",rl.caller,rl.method,rl.args,!1,!1)):((rY=this._infoPool.length?this._infoPool.pop():new rp).url=rQ,rY.clas=rS,rY.type=rM,rY.cache=rT,rY.group=rU,rY.ignoreCache=ri,rY.priority=rd,re&&rY.on("complete",re.caller,re.method,re.args),rl&&rY.on("progress",rl.caller,rl.method,rl.args),rJ._resMap[rQ]=rY,rd=rd<this._maxPriority?0<=rd?rd:0:this._maxPriority-1,this._resInfos[rd].push(rY),this._next())}return this},rQ._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var rS=0;rS<this._maxPriority;rS++)for(var rQ=this._resInfos[rS];0<rQ.length;){var re=rQ.shift();if(re)return this._doLoad(re)}this._loaderCount||this.event("complete")}},rQ._doLoad=function(rQ){this._loaderCount++;var re=this._loaders.length?this._loaders.pop():new rUS;re.on("complete",null,rM),re.on("progress",null,function(rS){rQ.event("progress",rS)}),re.on("error",null,function(rS){rM(null)});var rl=this;function rM(rS){re.offAll(),re._data=null,re._customParse=!1,rl._loaders.push(re),rl._endLoad(rQ,rS instanceof Array?[rS]:rS),rl._loaderCount--,rl._next()}re._class=rQ.clas,1<=rQ.priority?(re.priority=rQ.priority,re.realTime=!1):(re.priority=0,re.realTime=!0),re.load(rQ.url,rQ.type,rQ.cache,rQ.group,rQ.ignoreCache)},rQ._endLoad=function(rS,rQ){var re=rS.url;if(null==rQ){var rl=this._failRes[re]||0;if(rl<this.retryNum)return console.warn("[warn]Retry to load:",re),this._failRes[re]=rl+1,void rO.timer.once(this.retryDelay,this,this._addReTry,[rS],!1);console.warn("[error]Failed to load:",re),this.event("error",re)}this._failRes[re]&&(this._failRes[re]=0),delete rJ._resMap[re],rS.event("complete",rQ),rS.offAll(),this._infoPool.push(rS)},rQ._addReTry=function(rS){this._resInfos[this._maxPriority-1].push(rS),this._next()},rQ.clearRes=function(rS,rQ){void 0===rQ&&(rQ=!1),rUS.clearRes(rS,rQ)},rQ.getRes=function(rS){return rUS.getRes(rS)},rQ.cacheRes=function(rS,rQ){rUS.cacheRes(rS,rQ)},rQ.clearTextureRes=function(rS){rUS.clearTextureRes(rS)},rQ.setGroup=function(rS,rQ){rUS.setGroup(rS,rQ)},rQ.clearResByGroup=function(rS){rUS.clearResByGroup(rS)},rQ.clearUnLoaded=function(){for(var rS=0;rS<this._maxPriority;rS++){for(var rQ=this._resInfos[rS],re=rQ.length-1;-1<re;re--){var rl=rQ[re];rl&&(rl.offAll(),this._infoPool.push(rl))}rQ.length=0}this._loaderCount=0,rJ._resMap={}},rQ.cancelLoadByUrls=function(rS){if(rS)for(var rQ=0,re=rS.length;rQ<re;rQ++)this.cancelLoadByUrl(rS[rQ])},rQ.cancelLoadByUrl=function(rS){for(var rQ=0;rQ<this._maxPriority;rQ++)for(var re=this._resInfos[rQ],rl=re.length-1;-1<rl;rl--){var rM=re[rl];rM&&rM.url===rS&&(re[rl]=null,rM.offAll(),this._infoPool.push(rM))}rJ._resMap[rS]&&delete rJ._resMap[rS]},rQ._loadAssets=function(rS,re,rT,rQ,rl,rM,rd){null==rl&&(rl=2),null==rM&&(rM=!0);for(var rU=rS.length,ri=0,rR=0,ro=[],rY=!0,rp=0;rp<rU;rp++){var rJ=rS[rp];if(!rJ)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+rS);"string"==typeof rJ&&(rJ={url:rJ,type:rQ,size:1,priority:rl}),rJ.size||(rJ.size=1),rJ.progress=0,rR+=rJ.size,ro.push(rJ);var rL=rT?rz.create(null,rG,[rJ],!1):null,rj=re||rT?rz.create(null,rc,[rJ]):null;this.load(rJ.url,rj,rL,rJ.type,null!=rJ.priority&&0<=rJ.priority?rJ.priority:2,rM,rJ.group||rd)}function rc(rS,rQ){ri++,rS.progress=1,rQ||(rY=!1),ri===rU&&re&&re.runWith(rY)}function rG(rS,rQ){if(null!=rT){rS.progress=rQ;for(var re=0,rl=0;rl<ro.length;rl++){var rM=ro[rl];re+=rM.size*rM.progress}var rd=re/rR;rT.runWith(rd)}}return this},rJ.cacheRes=function(rS,rQ){rUS.cacheRes(rS,rQ)},rJ._resMap={},ri(rJ,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),rJ.__init$=function(){rp=function(rS){function rQ(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.priority=-1,rQ.__super.call(this)}return rj(rQ,"",rR),rQ}()},rJ}(),rRS=(function(rS){function rM(rS){rM.__super.call(this),rS||(rS=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var rQ=0,re=0,rl=0;rl<20;rl++)rl%5!=4?this._mat[rQ++]=rS[rl]:this._alpha[re++]=rS[rl];this._action=rk.createFilterAction(32),this._action.data=this}rj(rM,"laya.filters.ColorFilter",rG);var rQ=rM.prototype;rO.imps(rQ,{"laya.filters.IFilter":!0}),rQ.callNative=function(rS){rS._$P.cf=this;rS.conchModel&&rS.conchModel.setFilterMatrix&&rS.conchModel.setFilterMatrix(this._mat,this._alpha)},ro(0,rQ,"type",function(){return 32}),ro(0,rQ,"action",function(){return this._action})}(),function(rS){function rl(rS,rQ,re){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===rQ&&(rQ=0),rl.__super.call(this),this._byteClass=re||rw,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,rS&&0<rQ&&rQ<65535&&this.connect(rS,rQ)}rj(rl,"laya.net.Socket",rR);var rQ=rl.prototype;rQ.connect=function(rS,rQ){var re="ws://"+rS+":"+rQ;re="https:"==rf.window.location.protocol?"wss://"+rS+":"+rQ:"ws://"+rS+":"+rQ,this.connectByUrl(re)},rQ.connectByUrl=function(rS){var rQ=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new rf.window.WebSocket(rS,this.protocols):this._socket=new rf.window.WebSocket(rS),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(rS){rQ._onOpen(rS)},this._socket.onmessage=function(rS){rQ._onMessage(rS)},this._socket.onclose=function(rS){rQ._onClose(rS)},this._socket.onerror=function(rS){rQ._onError(rS)}},rQ.cleanSocket=function(){try{this._socket.close()}catch(rS){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},rQ.close=function(){if(null!=this._socket)try{this._socket.close()}catch(rS){}},rQ._onOpen=function(rS){this._connected=!0,this.event("open",rS)},rQ._onMessage=function(rS){if(rS&&rS.data){var rQ=rS.data;if(this.disableInput&&rQ)this.event("message",rQ);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var re=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,rQ&&("string"==typeof rQ?this._input.writeUTFBytes(rQ):this._input.writeArrayBuffer(rQ),this._addInputPosition=this._input.pos,this._input.pos=re),this.event("message",rQ)}}},rQ._onClose=function(rS){this._connected=!1,this.event("close",rS)},rQ._onError=function(rS){this.event("error",rS)},rQ.send=function(rS){this._socket.send(rS)},rQ.flush=function(){if(this._output&&0<this._output.length){var rQ;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(rS){rQ=rS}this._output.endian=this.endian,this._output.clear(),rQ&&this.event("error",rQ)}},ro(0,rQ,"input",function(){return this._input}),ro(0,rQ,"output",function(){return this._output}),ro(0,rQ,"connected",function(){return this._connected}),ro(0,rQ,"endian",function(){return this._endian},function(rS){this._endian=rS,null!=this._input&&(this._input.endian=rS),null!=this._output&&(this._output.endian=rS)}),rl.LITTLE_ENDIAN="littleEndian",rl.BIG_ENDIAN="bigEndian"}(),function(rS){function rU(){rU.__super.call(this),this._$1__id=++rU._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(rU._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,ra.currentResourceManager&&ra.currentResourceManager.addResource(this)}rj(rU,"laya.resource.Resource",rR);var rQ=rU.prototype;return rO.imps(rQ,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),rQ._setUrl=function(rS){var rQ;this._url!==rS&&(this._url&&((rQ=rU._urlResourcesMap[this._url]).splice(rQ.indexOf(this),1),0===rQ.length&&delete rU._urlResourcesMap[this._url]),rS&&((rQ=rU._urlResourcesMap[rS])||(rU._urlResourcesMap[rS]=rQ=[]),rQ.push(this)),this._url=rS)},rQ._getGroup=function(){return this._group},rQ._setGroup=function(rS){var rQ;this._group!==rS&&(this._group&&((rQ=rU._groupResourcesMap[this._group]).splice(rQ.indexOf(this),1),0===rQ.length&&delete rU._groupResourcesMap[this._group]),rS&&((rQ=rU._groupResourcesMap[rS])||(rU._groupResourcesMap[rS]=rQ=[]),rQ.push(this)),this._group=rS)},rQ._addReference=function(){this._referenceCount++},rQ._removeReference=function(){this._referenceCount--},rQ._clearReference=function(){this._referenceCount=0},rQ._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},rQ.recreateResource=function(){this.completeCreate()},rQ.disposeResource=function(){},rQ.activeResource=function(rS){void 0===rS&&(rS=!1),this._lastUseFrameCount=rN.loopCount,!this._destroyed&&this.__loaded&&(this._released||rS)&&this.recreateResource()},rQ.releaseResource=function(rS){return void 0===rS&&(rS=!0),!(!rS&&this.lock)&&(!(this._released&&!rS)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},rQ.onAsynLoaded=function(rS,rQ,re){throw new Error("Resource: must override this function!")},rQ.destroy=function(){var rS;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete rU._idResourcesMap[this.id],this._url&&((rS=rU._urlResourcesMap[this._url])&&(rS.splice(rS.indexOf(this),1),0===rS.length&&delete rU._urlResourcesMap[this.url]),rUS.clearRes(this._url),this.__loaded||rk.cancelLoadByUrl(this._url)),this._group&&((rS=rU._groupResourcesMap[this._group]).splice(rS.indexOf(this),1),0===rS.length&&delete rU._groupResourcesMap[this.url]))},rQ.completeCreate=function(){this._released=!1,this.event("recovered",this)},rQ.dispose=function(){this.destroy()},ro(0,rQ,"memorySize",function(){return this._memorySize},function(rS){var rQ=rS-this._memorySize;this._memorySize=rS,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,rQ),this.resourceManager&&this.resourceManager.addSize(rQ)}),ro(0,rQ,"_loaded",null,function(rS){this.__loaded=rS}),ro(0,rQ,"loaded",function(){return this.__loaded}),ro(0,rQ,"id",function(){return this._$1__id}),ro(0,rQ,"destroyed",function(){return this._destroyed}),ro(0,rQ,"group",function(){return this._getGroup()},function(rS){this._setGroup(rS)}),ro(0,rQ,"resourceManager",function(){return this._resourceManager}),ro(0,rQ,"url",function(){return this._url}),ro(0,rQ,"released",function(){return this._released}),ro(0,rQ,"referenceCount",function(){return this._referenceCount}),rU.getResourceByID=function(rS){return rU._idResourcesMap[rS]},rU.getResourceByURL=function(rS,rQ){return void 0===rQ&&(rQ=0),null==rU._urlResourcesMap[rS]?null:rU._urlResourcesMap[rS][rQ]},rU.getResourceCountByURL=function(rS){return rU._urlResourcesMap[rS].length},rU.destroyUnusedResources=function(rS){var rQ;if(rS){var re=rU._groupResourcesMap[rS];if(re)for(var rl=re.slice(),rM=0,rd=rl.length;rM<rd;rM++)(rQ=rl[rM]).lock||0!==rQ._referenceCount||rQ.destroy()}else for(var rT in rU._idResourcesMap)(rQ=rU._idResourcesMap[rT]).lock||0!==rQ._referenceCount||rQ.destroy()},rU._uniqueIDCounter=0,rU._idResourcesMap={},rU._urlResourcesMap={},rU._groupResourcesMap={},rU}()),roS=function(rS){function rI(rS,rQ){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,rI.__super.call(this),rS&&null!=rS._addReference&&rS._addReference(),this.setTo(rS,rQ)}rj(rI,"laya.resource.Texture",rR);var rQ=rI.prototype;return rQ._setUrl=function(rS){this.url=rS},rQ.setTo=function(rS,rQ){if(rS instanceof rT.HTMLElement){var re=rAS.create("2D",rS);this.bitmap=re}else this.bitmap=rS;if(this.uv=rQ||rI.DEF_UV,rS){this._w=rS.width,this._h=rS.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var rl=this;if(this._loaded)rk.addToAtlas&&rk.addToAtlas(rl);else{var rM=rS;rM instanceof laya.resource.HTMLImage&&rM.image&&rM.image.addEventListener("load",function(rS){rk.addToAtlas&&rk.addToAtlas(rl)},!1)}}},rQ.active=function(){this.bitmap&&this.bitmap.activeResource()},rQ.destroy=function(rS){if(void 0===rS&&(rS=!1),this.alphaTexture&&(this.alphaTexture.destroy(rS),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var rQ=this.bitmap;rS?(rm.isConchApp&&rQ.source&&rQ.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,rQ.dispose(),rQ._clearReference()):(rQ._removeReference(),0==rQ.referenceCount&&(rm.isConchApp&&rQ.source&&rQ.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,rQ.dispose())),this.url&&this===rO.loader.getRes(this.url)&&rO.loader.clearRes(this.url,rS),this._loaded=!1}},rQ.load=function(rS){var rQ=this;this._loaded=!1,rS=rb.customFormat(rS);var re=this.bitmap||(this.bitmap=rBS.create(rS));re.uri=rS,re&&re._addReference();var rl=this;re.onload=function(){re.onload=null,rl._loaded=!0,rQ.sourceWidth=rQ._w=re.width,rQ.sourceHeight=rQ._h=re.height,rl.event("loaded",this),rk.addToAtlas&&rk.addToAtlas(rl)}},rQ.addTextureToAtlas=function(rS){rk.addTextureToAtlas(this)},rQ.getPixels=function(rS,rQ,re,rl){if(rm.isConchApp){var rM=this.bitmap;if(rM.source&&rM.source.getImageData){var rd=rM.source.getImageData(rS,rQ,re,rl),rT=new Uint8Array(rd);return Array.from(rT)}return null}return rm.isWebGL?rk.getTexturePixels(this,rS,rQ,re,rl):(rf.canvas.size(re,rl),rf.canvas.clear(),rf.context.drawTexture(this,-rS,-rQ,this.width,this.height,0,0),rf.context.getImageData(0,0,re,rl).data)},rQ.onAsynLoaded=function(rS,rQ){if(rQ){if("function"!=typeof rQ._addReference)throw new Error("bitmap._addReference is not a function. "+rQ.className+" "+typeof rQ._addReference+" "+rQ.constructor);rQ._addReference()}this.setTo(rQ,this.uv),this._loaded&&this.event("loaded",this)},ro(0,rQ,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),ro(0,rQ,"loaded",function(){return this._loaded}),ro(0,rQ,"released",function(){return!this.bitmap||this.bitmap.released}),ro(0,rQ,"width",function(){return this._w?this._w:this.uv&&this.uv!==rI.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(rS){this._w=rS,this.sourceWidth||(this.sourceWidth=rS)}),ro(0,rQ,"repeat",function(){return!rm.isWebGL||!this.bitmap||this.bitmap.repeat},function(rS){rS&&rm.isWebGL&&this.bitmap&&(this.bitmap.repeat=rS)&&(this.bitmap.enableMerageInAtlas=!1)}),ro(0,rQ,"height",function(){return this._h?this._h:this.uv&&this.uv!==rI.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(rS){this._h=rS,this.sourceHeight||(this.sourceHeight=rS)}),ro(0,rQ,"isLinearSampling",function(){return!rm.isWebGL||9728!=this.bitmap.minFifter},function(rS){!rS&&rm.isWebGL&&(rS||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),rI.moveUV=function(rS,rQ,re){for(var rl=0;rl<8;rl+=2)re[rl]+=rS,re[rl+1]+=rQ;return re},rI.create=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){void 0===rd&&(rd=0),void 0===rT&&(rT=0),void 0===rU&&(rU=0),void 0===ri&&(ri=0);var rR=rS instanceof laya.resource.Texture,ro=rR?rS.uv:rI.DEF_UV,rY=rR?rS.bitmap:rS,rp=rk.isAtlas(rY);if(rp){var rJ=rY._atlaser,rL=rS._atlasID;if(-1==rL)throw new Error("create texture error");rY=rJ._inAtlasTextureBitmapValue[rL],ro=rJ._inAtlasTextureOriUVValue[rL]}var rj=new rI(rY,null);rY.width&&rQ+rl>rY.width&&(rl=rY.width-rQ),rY.height&&re+rM>rY.height&&(rM=rY.height-re),rj.width=rl,rj.height=rM,rj.offsetX=rd,rj.offsetY=rT,rj.sourceWidth=rU||rl,rj.sourceHeight=ri||rM;var rc=1/rY.width,rG=1/rY.height;rQ*=rc,re*=rG,rl*=rc,rM*=rG;var rz=rj.uv[0],rA=rj.uv[1],rv=rj.uv[4],rD=rj.uv[5],rB=rv-rz,rO=rD-rA,rH=rI.moveUV(ro[0],ro[1],[rQ,re,rQ+rl,re,rQ+rl,re+rM,rQ,re+rM]);rj.uv=[rz+rH[0]*rB,rA+rH[1]*rO,rv-(1-rH[2])*rB,rA+rH[3]*rO,rv-(1-rH[4])*rB,rD-(1-rH[5])*rO,rz+rH[6]*rB,rD-(1-rH[7])*rO],rp&&rj.addTextureToAtlas();var rg=rY.scaleRate;return rg&&1!=rg?(rj.sourceWidth/=rg,rj.sourceHeight/=rg,rj.width/=rg,rj.height/=rg,rj.scaleRate=rg,rj.offsetX/=rg,rj.offsetY/=rg):rj.scaleRate=1,rj},rI.createFromTexture=function(rS,rQ,re,rl,rM){var rd=rS.scaleRate;1!=rd&&(rQ*=rd,re*=rd,rl*=rd,rM*=rd);var rT=rg.TEMP.setTo(rQ-rS.offsetX,re-rS.offsetY,rl,rM),rU=rT.intersection(rI._rect1.setTo(0,0,rS.width,rS.height),rI._rect2);if(!rU)return null;var ri=rI.create(rS,rU.x,rU.y,rU.width,rU.height,rU.x-rT.x,rU.y-rT.y,rl,rM);if(ri.bitmap&&ri.bitmap._removeReference)return ri.bitmap._removeReference(),ri;var rR="bitmap:"+(ri.bitmap?ri.bitmap.constructor?ri.bitmap.constructor.name:ri.bitmap.__className:"")+", url:"+(rS.url+" | "+(ri.bitmap?ri.bitmap.url:rS.url))+", x="+rQ+",y="+re+",width="+rl+",height="+rM+", result="+(rU?rU.x+","+rU.y+","+rU.width+","+rU.height:"null")+", rect="+rT.x+","+rT.y+","+rT.width+","+rT.height;throw new Error("报错：bitmap._removeReference is not a function  "+rR)},rI.DEF_UV=[0,0,1,0,1,1,0,1],rI.INV_UV=[0,1,1,1,1,0,0,0],rI._rect1=new rg,rI._rect2=new rg,rI}(),rS=function(rS){var rU;function rd(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,rd.__super.call(this)}rj(rd,"laya.utils.TimeLine",rR);var rQ=rd.prototype;return rQ.to=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=0),this._create(rS,rQ,re,rl,rM,!0)},rQ.from=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=0),this._create(rS,rQ,re,rl,rM,!1)},rQ._create=function(rS,rQ,re,rl,rM,rd){var rT=rZ.getItemByClass("tweenData",rU);return rT.isTo=rd,rT.type=0,rT.target=rS,rT.duration=re,rT.data=rQ,rT.startTime=this._startTime+rM,rT.endTime=rT.startTime+rT.duration,rT.ease=rl,this._startTime=Math.max(rT.endTime,this._startTime),this._tweenDataList.push(rT),this._startTimeSort=!0,this._endTimeSort=!0,this},rQ.addLabel=function(rS,rQ){var re=rZ.getItemByClass("tweenData",rU);return re.type=1,re.data=rS,re.endTime=re.startTime=this._startTime+rQ,this._labelDic||(this._labelDic={}),this._labelDic[rS]=re,this._tweenDataList.push(re),this},rQ.removeLabel=function(rS){if(this._labelDic&&this._labelDic[rS]){var rQ=this._labelDic[rS];if(rQ){var re=this._tweenDataList.indexOf(rQ);-1<re&&this._tweenDataList.splice(re,1)}delete this._labelDic[rS]}},rQ.gotoTime=function(rS){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var rQ,re,rl,rM;for(var rd in this._firstTweenDic)if(re=this._firstTweenDic[rd])for(var rT in re)re.diyTarget.hasOwnProperty(rT)&&(re.diyTarget[rT]=re[rT]);for(rd in this._tweenDic)(rQ=this._tweenDic[rd]).clear(),delete this._tweenDic[rd];if(this._index=0,this._gidIndex=0,this._currTime=rS,this._lastTime=rf.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=rl=this._tweenDataList.concat(),rl.sort(function(rS,rQ){return rS.endTime>rQ.endTime?1:rS.endTime<rQ.endTime?-1:0})}else rl=this._endTweenDataList;for(var rU=0,ri=rl.length;rU<ri;rU++)if(0==(rM=rl[rU]).type){if(!(rS>=rM.endTime))break;this._index=Math.max(this._index,rU+1);var rR=rM.data;if(rM.isTo)for(var ro in rR)rM.target[ro]=rR[ro]}for(rU=0,ri=this._tweenDataList.length;rU<ri;rU++)0==(rM=this._tweenDataList[rU]).type&&rS>=rM.startTime&&rS<rM.endTime&&(this._index=Math.max(this._index,rU+1),this._gidIndex++,(rQ=rZ.getItemByClass("tween",rK))._create(rM.target,rM.data,rM.duration,rM.ease,rz.create(this,this._animComplete,[this._gidIndex]),0,!1,rM.isTo,!0,!1),rQ.setStartTime(this._currTime-(rS-rM.startTime)),rQ._updateEase(this._currTime),rQ.gid=this._gidIndex,this._tweenDic[this._gidIndex]=rQ)}},rQ.gotoLabel=function(rS){if(null!=this._labelDic){var rQ=this._labelDic[rS];rQ&&this.gotoTime(rQ.startTime)}},rQ.pause=function(){rO.timer.clear(this,this._update)},rQ.resume=function(){this.play(this._currTime,this._loopKey)},rQ.play=function(rS,rQ){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(rS,rQ){return rS.startTime>rQ.startTime?1:rS.startTime<rQ.startTime?-1:0});for(var re=0,rl=this._tweenDataList.length;re<rl;re++){var rM=this._tweenDataList[re];if(null!=rM&&0==rM.type){var rd=rM.target,rT=rd.$_GID||(rd.$_GID=rV.getGID()),rU=null;for(var ri in null==this._firstTweenDic[rT]?((rU={}).diyTarget=rd,this._firstTweenDic[rT]=rU):rU=this._firstTweenDic[rT],rM.data)null==rU[ri]&&(rU[ri]=rd[ri])}}}"string"==typeof rS?this.gotoLabel(rS):this.gotoTime(rS),this._loopKey=rQ,this._lastTime=rf.now(),rO.timer.frameLoop(1,this,this._update)}},rQ._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var rS in this._tweenDic)(rQ=this._tweenDic[rS]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var rQ,re=rf.now(),rl=re-this._lastTime,rM=this._currTime+=rl*this.scale;for(rS in this._lastTime=re,this._tweenDic)(rQ=this._tweenDic[rS])._updateEase(rM);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var rd=this._tweenDataList[this._index];rM>=rd.startTime&&(this._index++,0==rd.type?(this._gidIndex++,(rQ=rZ.getItemByClass("tween",rK))._create(rd.target,rd.data,rd.duration,rd.ease,rz.create(this,this._animComplete,[this._gidIndex]),0,!1,rd.isTo,!0,!1),rQ.setStartTime(rM),rQ.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=rQ)._updateEase(rM)):this.event("label",rd.data))}},rQ._animComplete=function(rS){this._tweenDic[rS]&&delete this._tweenDic[rS]},rQ._complete=function(){this.event("complete")},rQ.reset=function(){var rS;if(this._labelDic)for(rS in this._labelDic)delete this._labelDic[rS];for(rS in this._tweenDic)this._tweenDic[rS].clear(),delete this._tweenDic[rS];for(rS in this._firstTweenDic)delete this._firstTweenDic[rS];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var rQ,re=0;for(rQ=this._tweenDataList.length,re=0;re<rQ;re++)this._tweenDataList[re]&&this._tweenDataList[re].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,rO.timer.clear(this,this._update)},rQ.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},ro(0,rQ,"index",function(){return this._frameIndex},function(rS){this._frameIndex=rS,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),ro(0,rQ,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),rd.to=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=0),(new rd).to(rS,rQ,re,rl,rM)},rd.from=function(rS,rQ,re,rl,rM){return void 0===rM&&(rM=0),(new rd).from(rS,rQ,re,rl,rM)},rd.__init$=function(){rU=function(){function rS(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return rj(rS,""),rS.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,rZ.recover("tweenData",this)},rS}()},rd}(),rYS=function(rM){function re(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,re.__super.call(this),this._style=rU.EMPTY}rj(re,"laya.display.Sprite",rM);var rS=re.prototype;return rO.imps(rS,{"laya.display.ILayout":!0}),rS.createConchModel=function(){return new ConchNode},rS.destroy=function(rS){if(void 0===rS&&(rS=!0),this._releaseMem(),!this._destroyed){this.filters=null;var rQ=this.mask;rQ&&(this.mask=null,rQ.destroy(rS))}rM.prototype.destroy.call(this,rS),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},rS.updateZOrder=function(){rV.updateOrder(this._childs)&&this.repaint()},rS.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},rS.setBounds=function(rS){this._set$P("uBounds",rS)},rS.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new rg),rg._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},rS.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new rg),rg._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},rS._boundPointsToParent=function(rS){void 0===rS&&(rS=!1);var rQ=0,re=0;this._style&&(rQ=this._style._tf.translateX,re=this._style._tf.translateY,rS=rS||0!==this._style._tf.rotate,this._style.scrollRect&&(rQ+=this._style.scrollRect.x,re+=this._style.scrollRect.y));var rl=this._getBoundPointsM(rS);if(!rl||rl.length<1)return rl;if(8!=rl.length&&(rl=rS?rD.scanPList(rl):rg._getWrapRec(rl,rg.TEMP)._getBoundPoints()),!this.transform)return rV.transPointList(rl,this._x-rQ,this._y-re),rl;var rM=rH.TEMP,rd=0,rT=rl.length;for(rd=0;rd<rT;rd+=2)rM.x=rl[rd],rM.y=rl[rd+1],this.toParentPoint(rM),rl[rd]=rM.x,rl[rd+1]=rM.y;return rl},rS.getGraphicBounds=function(rS){return void 0===rS&&(rS=!1),this._graphics?this._graphics.getBounds(rS):rg.TEMP.setTo(0,0,0,0)},rS._getBoundPointsM=function(rS){if(void 0===rS&&(rS=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var rQ=rV.clearArray(this._$P.temBM),re=rg.TEMP;return re.copyFrom(this.scrollRect),rV.concatArray(rQ,re._getBoundPoints()),rQ}for(var rl,rM,rd,rT=this._graphics?this._graphics.getBoundPoints():rV.clearArray(this._$P.temBM),rU=0,ri=(rd=this._childs).length;rU<ri;rU++)(rl=rd[rU])instanceof laya.display.Sprite&&1==rl.visible&&(rM=rl._boundPointsToParent(rS))&&(rT=rT?rV.concatArray(rT,rM):rM);return rT},rS.getStyle=function(){return this._style===rU.EMPTY&&(this._style=new rU),this._style},rS.setStyle=function(rS){this._style=rS},rS._adjustTransform=function(){this._tfChanged=!1;var rS,rQ=this._style._tf,re=rQ.scaleX,rl=rQ.scaleY;if(rQ.rotate||1!==re||1!==rl||rQ.skewX||rQ.skewY){(rS=this._transform||(this._transform=rX.create())).bTransform=!0;var rM=.0174532922222222*(rQ.rotate-rQ.skewX),rd=.0174532922222222*(rQ.rotate+rQ.skewY),rT=Math.cos(rd),rU=Math.sin(rd),ri=Math.sin(rM),rR=Math.cos(rM);return rS.a=re*rT,rS.b=re*rU,rS.c=-rl*ri,rS.d=rl*rR,rS.tx=rS.ty=0,rS}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,rS},rS.pos=function(rS,rQ,re){if(void 0===re&&(re=!1),this._x!==rS||this._y!==rQ){if(this.destroyed)return this;if(re){this._x=rS,this._y=rQ,this.conchModel&&this.conchModel.pos(this._x,this._y);var rl=this._parent;rl&&0===rl._repaint&&(rl._repaint=1,rl.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=rS,this.y=rQ}return this},rS.pivot=function(rS,rQ){return this.pivotX=rS,this.pivotY=rQ,this},rS.size=function(rS,rQ){return this.width=rS,this.height=rQ,this},rS.scale=function(rS,rQ,re){void 0===re&&(re=!1);var rl=this.getStyle(),rM=rl._tf;if(rM.scaleX!=rS||rM.scaleY!=rQ){if(this.destroyed)return this;if(re){rl.setScale(rS,rQ),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(rS,rQ),this._renderType|=4;var rd=this._parent;rd&&0===rd._repaint&&(rd._repaint=1,rd.parentRepaint())}else this.scaleX=rS,this.scaleY=rQ}return this},rS.skew=function(rS,rQ){return this.skewX=rS,this.skewY=rQ,this},rS.render=function(rS,rQ,re){rN.spriteCount++,rn.renders[this._renderType]._fun(this,rS,rQ+this._x,re+this._y),this._repaint=0},rS.drawToCanvas=function(rS,rQ,re,rl){if(rm.isConchNode){var rM=rAS.create("2D");return new r$(rS,rQ,rM).ctx.setCanvasType(1),this.conchModel.drawToCanvas(rM.source,re,rl),rM}return rk.drawToCanvas(this,this._renderType,rS,rQ,re,rl)},rS.customRender=function(rS,rQ,re){this._renderType|=1024},rS._applyFilters=function(){var rS;if(!rm.isWebGL&&((rS=this._$P.filters)&&!(rS.length<1)))for(var rQ=0,re=rS.length;rQ<re;rQ++)rS[rQ].action.apply(this._$P.cacheCanvas)},rS._isHaveGlowFilter=function(){var rS,rQ=0;if(this.filters)for(rQ=0;rQ<this.filters.length;rQ++)if(8==this.filters[rQ].type)return!0;for(rQ=0,rS=this._childs.length;rQ<rS;rQ++)if(this._childs[rQ]._isHaveGlowFilter())return!0;return!1},rS.localToGlobal=function(rS,rQ){void 0===rQ&&(rQ=!1),!0===rQ&&(rS=new rH(rS.x,rS.y));for(var re=this;re&&re!=rO.stage;)rS=re.toParentPoint(rS),re=re.parent;return rS},rS.globalToLocal=function(rS,rQ){void 0===rQ&&(rQ=!1),rQ&&(rS=new rH(rS.x,rS.y));for(var re=this,rl=[];re&&re!=rO.stage;)rl.push(re),re=re.parent;for(var rM=rl.length-1;0<=rM;)rS=(re=rl[rM]).fromParentPoint(rS),rM--;return rS},rS.toParentPoint=function(rS){if(!rS)return rS;rS.x-=this.pivotX,rS.y-=this.pivotY,this.transform&&this._transform.transformPoint(rS),rS.x+=this._x,rS.y+=this._y;var rQ=this._style.scrollRect;return rQ&&(rS.x-=rQ.x,rS.y-=rQ.y),rS},rS.fromParentPoint=function(rS){if(!rS)return rS;rS.x-=this._x,rS.y-=this._y;var rQ=this._style.scrollRect;return rQ&&(rS.x+=rQ.x,rS.y+=rQ.y),this.transform&&this._transform.invertTransformPoint(rS),rS.x+=this.pivotX,rS.y+=this.pivotY,rS},rS.on=function(rS,rQ,re,rl){return 1!==this._mouseEnableState&&this.isMouseEvent(rS)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(rS,rQ,re,rl,!1)):rM.prototype.on.call(this,rS,rQ,re,rl)},rS.once=function(rS,rQ,re,rl){return 1!==this._mouseEnableState&&this.isMouseEvent(rS)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(rS,rQ,re,rl,!0)):rM.prototype.once.call(this,rS,rQ,re,rl)},rS._$2__onDisplay=function(){if(1!==this._mouseEnableState){var rS=this;for(rS=rS.parent;rS&&1!==rS._mouseEnableState&&!rS._getBit(2);)rS.mouseEnabled=!0,rS._setBit(2,!0),rS=rS.parent}},rS.loadImage=function(rS,rQ,re,rl,rM,rd){var rT=this;return void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),void 0===rM&&(rM=0),this.graphics.loadImage(rS,rQ,re,rl,rM,function(rS){rT.destroyed||(rT.size(rQ+(rl||rS.width),re+(rM||rS.height)),rT.repaint(),rd&&rd.runWith(rS))}),this},rS.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},rS._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},rS._childChanged=function(rS){this._childs.length?this._renderType|=2048:this._renderType&=-2049,rS&&this._get$P("hasZorder")&&rO.timer.callLater(this,this.updateZOrder),this.repaint()},rS.parentRepaint=function(){var rS=this._parent;rS&&0===rS._repaint&&(rS._repaint=1,rS.parentRepaint())},rS.startDrag=function(rS,rQ,re,rl,rM,rd,rT){void 0===rQ&&(rQ=!1),void 0===re&&(re=0),void 0===rl&&(rl=300),void 0===rd&&(rd=!1),void 0===rT&&(rT=.92),this._$P.dragging||this._set$P("dragging",new rx),this._$P.dragging.start(this,rS,rQ,re,rl,rM,rd,rT)},rS.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},rS._releaseMem=function(){if(this._$P){var rS=this._$P.cacheCanvas;rS&&rS.ctx&&(rZ.recover("RenderContext",rS.ctx),rS.ctx.canvas.size(0,0),rS.ctx=null);var rQ=this._$P._filterCache;rQ&&(rQ.destroy(),rQ.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},rS._setDisplay=function(rS){rS||this._releaseMem(),rM.prototype._setDisplay.call(this,rS)},rS.hitTestPoint=function(rS,rQ){var re=this.globalToLocal(rH.TEMP.setTo(rS,rQ));return rS=re.x,rQ=re.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?rg.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(rS,rQ)},rS.getMousePoint=function(){return this.globalToLocal(rH.TEMP.setTo(rO.stage.mouseX,rO.stage.mouseY))},rS._getWords=function(){return null},rS._addChildsToLayout=function(rS){var rQ=this._getWords();if(null==rQ&&0==this._childs.length)return!1;if(rQ)for(var re=0,rl=rQ.length;re<rl;re++)rS.push(rQ[re]);re=0;for(var rM=this._childs.length;re<rM;++re){var rd=this._childs[re];rd._style._enableLayout()&&rd._addToLayout(rS)}return!0},rS._addToLayout=function(rS){this._style.absolute||(this._style.block?rS.push(this):this._addChildsToLayout(rS)&&(this.x=this.y=0))},rS._isChar=function(){return!1},rS._getCSSStyle=function(){return this._style.getCSSStyle()},rS._setAttributes=function(rS,rQ){switch(rS){case"x":this.x=parseFloat(rQ);break;case"y":this.y=parseFloat(rQ);break;case"width":this.width=parseFloat(rQ);break;case"height":this.height=parseFloat(rQ);break;default:this[rS]=rQ}},rS._layoutLater=function(){this.parent&&this.parent._layoutLater()},ro(0,rS,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(rS){this._optimizeScrollRect!=rS&&(this._optimizeScrollRect=rS,this.conchModel&&this.conchModel.optimizeScrollRect(rS))}),ro(0,rS,"customRenderEnable",null,function(rS){if(rS&&(this._renderType|=1024,rm.isConchNode)){re.CustomList.push(this);var rQ=new rAS("2d");rQ._setContext(new CanvasRenderingContext2D),this.customContext=new r$(0,0,rQ),rQ.context.setCanvasType&&rQ.context.setCanvasType(2),this.conchModel.custom(rQ.context)}}),ro(0,rS,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(rS){this.cacheAs=rS?this._$P.hasFilter?"none":"normal":"none"}),ro(0,rS,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(rS){var rQ=this._$P.cacheCanvas;if(rS!==(rQ?rQ.type:"none")){if("none"!==rS)this._getBit(1)||this._setUpNoticeType(1),rQ||(rQ=this._set$P("cacheCanvas",rZ.getItemByClass("cacheCanvas",Object))),rQ.type=rS,rQ.reCache=!0,this._renderType|=16,"bitmap"==rS&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(rQ){var re=rQ;re&&re.ctx&&(rZ.recover("RenderContext",re.ctx),re.ctx.canvas.size(0,0),re.ctx=null),rZ.recover("cacheCanvas",rQ)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),ro(0,rS,"zOrder",function(){return this._zOrder},function(rS){this._zOrder!=rS&&(this._zOrder=rS,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(rS),this._parent&&(rS&&this._parent._set$P("hasZorder",!0),rO.timer.callLater(this._parent,this.updateZOrder)))}),ro(0,rS,"rotation",function(){return this._style._tf.rotate},function(rS){var rQ=this.getStyle();if(rQ._tf.rotate!==rS){rQ.setRotate(rS),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(rS),this._renderType|=4;var re=this._parent;re&&0===re._repaint&&(re._repaint=1,re.parentRepaint())}}),ro(0,rS,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(rS){this._width!==rS&&(this._width=rS,this.conchModel&&this.conchModel.size(rS,this._height),this.repaint())}),ro(0,rS,"x",function(){return this._x},function(rS){if(this._x!==rS){if(this.destroyed)return;this._x=rS,this.conchModel&&this.conchModel.pos(rS,this._y);var rQ=this._parent;rQ&&0===rQ._repaint&&(rQ._repaint=1,rQ.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),ro(0,rS,"globalScaleY",function(){for(var rS=1,rQ=this;rQ&&rQ!==rO.stage;)rS*=rQ.scaleY,rQ=rQ.parent;return rS}),ro(0,rS,"hitArea",function(){return this._$P.hitArea},function(rS){this._set$P("hitArea",rS)}),ro(0,rS,"staticCache",function(){return this._$P.staticCache},function(rS){this._set$P("staticCache",rS),rS||this.reCache()}),ro(0,rS,"texture",function(){return this._texture},function(rS){this._texture!=rS&&(this._texture=rS,this.graphics.cleanByTexture(rS,0,0))}),ro(0,rS,"y",function(){return this._y},function(rS){if(this._y!==rS){if(this.destroyed)return;this._y=rS,this.conchModel&&this.conchModel.pos(this._x,rS);var rQ=this._parent;rQ&&0===rQ._repaint&&(rQ._repaint=1,rQ.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),ro(0,rS,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(rS){this._height!==rS&&(this._height=rS,this.conchModel&&this.conchModel.size(this._width,rS),this.repaint())}),ro(0,rS,"blendMode",function(){return this._style.blendMode},function(rS){this.getStyle().blendMode=rS,this.conchModel&&this.conchModel.blendMode(rS),rS&&"source-over"!=rS?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),ro(0,rS,"scaleX",function(){return this._style._tf.scaleX},function(rS){var rQ=this.getStyle();if(rQ._tf.scaleX!==rS){rQ.setScaleX(rS),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(rS,rQ._tf.scaleY),this._renderType|=4;var re=this._parent;re&&0===re._repaint&&(re._repaint=1,re.parentRepaint())}}),ro(0,rS,"scaleY",function(){return this._style._tf.scaleY},function(rS){var rQ=this.getStyle();if(rQ._tf.scaleY!==rS){rQ.setScaleY(rS),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(rQ._tf.scaleX,rS),this._renderType|=4;var re=this._parent;re&&0===re._repaint&&(re._repaint=1,re.parentRepaint())}}),ro(0,rS,"stage",function(){return rO.stage}),ro(0,rS,"skewX",function(){return this._style._tf.skewX},function(rS){var rQ=this.getStyle();if(rQ._tf.skewX!==rS){rQ.setSkewX(rS),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(rS,rQ._tf.skewY),this._renderType|=4;var re=this._parent;re&&0===re._repaint&&(re._repaint=1,re.parentRepaint())}}),ro(0,rS,"scrollRect",function(){return this._style.scrollRect},function(rS){this.getStyle().scrollRect=rS,this.repaint(),rS?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(rS.x,rS.y,rS.width,rS.height)):(this._renderType&=-129,this.conchModel&&(re.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),ro(0,rS,"skewY",function(){return this._style._tf.skewY},function(rS){var rQ=this.getStyle();if(rQ._tf.skewY!==rS){rQ.setSkewY(rS),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(rQ._tf.skewX,rS),this._renderType|=4;var re=this._parent;re&&0===re._repaint&&(re._repaint=1,re.parentRepaint())}}),ro(0,rS,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(rS){this._tfChanged=!1,(this._transform=rS)&&(this._x=rS.tx,this._y=rS.ty,rS.tx=rS.ty=0,this.conchModel&&this.conchModel.transform(rS.a,rS.b,rS.c,rS.d,this._x,this._y)),rS?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),ro(0,rS,"pivotX",function(){return this._style._tf.translateX},function(rS){this.getStyle().setTranslateX(rS),this.conchModel&&this.conchModel.pivot(rS,this._style._tf.translateY),this.repaint()}),ro(0,rS,"pivotY",function(){return this._style._tf.translateY},function(rS){this.getStyle().setTranslateY(rS),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,rS),this.repaint()}),ro(0,rS,"alpha",function(){return this._style.alpha},function(rS){this._style&&this._style.alpha!==rS&&(rS=rS<0?0:1<rS?1:rS,this.getStyle().alpha=rS,this.conchModel&&this.conchModel.alpha(rS),1!==rS?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),ro(0,rS,"visible",function(){return this._style.visible},function(rS){this._style&&this._style.visible!==rS&&(this.getStyle().visible=rS,this.conchModel&&this.conchModel.visible(rS),this.parentRepaint())}),ro(0,rS,"graphics",function(){return this._graphics||(this.graphics=rk.createGraphics())},function(rS){this._graphics&&(this._graphics._sp=null),(this._graphics=rS)?(this._renderType&=-2,this._renderType|=512,(rS._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(re.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),ro(0,rS,"filters",function(){return this._$P.filters},function(rS){rS&&0===rS.length&&(rS=null),this._$P.filters!=rS&&(this._set$P("filters",rS?rS.slice():null),rm.isConchApp&&(this.conchModel&&(re.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),rm.isWebGL&&(rS&&rS.length?this._renderType|=32:this._renderType&=-33),rS&&0<rS.length?(this._getBit(1)||this._setUpNoticeType(1),rm.isWebGL&&1==rS.length&&rS[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(rm.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),ro(0,rS,"parent",rM.prototype._$get_parent,function(rS){rO.superSet(rSS,this,"parent",rS),rS&&this._getBit(2)&&this._$2__onDisplay()}),ro(0,rS,"mask",function(){return this._$P._mask},function(rS){rS&&this.mask&&this.mask._$P.maskParent||(rS?(this.cacheAs="bitmap",this._set$P("_mask",rS),rS._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",rS),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(rS?rS.conchModel:null),this._renderType|=64,this.parentRepaint())}),ro(0,rS,"mouseEnabled",function(){return 1<this._mouseEnableState},function(rS){this._mouseEnableState=rS?2:1}),ro(0,rS,"globalScaleX",function(){for(var rS=1,rQ=this;rQ&&rQ!==rO.stage;)rS*=rQ.scaleX,rQ=rQ.parent;return rS}),ro(0,rS,"mouseX",function(){return this.getMousePoint().x}),ro(0,rS,"mouseY",function(){return this.getMousePoint().y}),re.fromImage=function(rS){return(new re).loadImage(rS)},re._cachePool=[],re.CustomList=[],ri(re,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=rT.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),re}(rSS),rpS=function(rS){function rQ(rS){this._audio=null,this._onEnd=null,this._resumePlay=null,rQ.__super.call(this),this._onEnd=rV.bind(this.__onEnd,this),this._resumePlay=rV.bind(this.__resumePlay,this),rS.addEventListener("ended",this._onEnd),this._audio=rS}rj(rQ,"laya.media.h5audio.AudioSoundChannel",rlS);var re=rQ.prototype;return re.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(rO.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},re.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,rf.container.appendChild(this._audio),this._audio.play()}catch(rS){this.event("error")}},re.play=function(rS){this.isStopped=!1;try{this._audio.playbackRate=rt.playbackRate,this._audio.currentTime=this.startTime}catch(rS){return void this._audio.addEventListener("canplay",this._resumePlay)}rt.addChannel(this),rf.container.appendChild(this._audio),!rS&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},re.stop=function(){this.isStopped=!0,rt.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&rm.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),rf.onIE||this._audio!=reS._musicAudio&&rZ.recover("audio:"+this.url,this._audio),rf.removeElement(this._audio),this._audio=null)},re.pause=function(){this.isStopped=!0,rt.removeChannel(this),"pause"in this._audio&&this._audio.pause()},re.resume=function(){this._audio&&(this.isStopped=!1,rt.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},ro(0,re,"position",function(){return this._audio?this._audio.currentTime:0}),ro(0,re,"duration",function(){return this._audio?this._audio.duration:0}),ro(0,re,"volume",function(){return this._audio?this._audio.volume:1},function(rS){this._audio&&(this._audio.volume=rS)}),rQ}(),rJS=function(rS){function rQ(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=rdS.ctx,rQ.__super.call(this),this._onPlayEnd=rV.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}rj(rQ,"laya.media.webaudio.WebAudioSoundChannel",rlS);var re=rQ.prototype;return re.play=function(rS){if(rt.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var rQ=this.context,re=this.gain,rl=rQ.createBufferSource();(this.bufferSource=rl).buffer=this.audioBuffer,rl.connect(re),re&&re.disconnect(),re.connect(rQ.destination),rl.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=rf.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(rl.loop=!0),rl.playbackRate.setTargetAtTime?rl.playbackRate.setTargetAtTime(rt.playbackRate,this.context.currentTime,.1):rl.playbackRate.value=rt.playbackRate,rl.start(0,this.startTime),!rS&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},re.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(rO.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},re._clearBufferSource=function(){if(this.bufferSource){var rS=this.bufferSource;rS.stop?rS.stop(0):rS.noteOff(0),rS.disconnect(0),rS.onended=null,rQ._tryCleanFailed||this._tryClearBuffer(rS),this.bufferSource=null}},re._tryClearBuffer=function(rS){try{rS.buffer=null}catch(rS){rQ._tryCleanFailed=!0}},re.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,rt.removeChannel(this),this.startHandler=null,this.completeHandler=null},re.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,rt.removeChannel(this)},re.resume=function(){this.startTime=this._pauseTime,this.play(!1)},ro(0,re,"position",function(){return this.bufferSource?(rf.now()-this._startTime)/1e3+this.startTime:0}),ro(0,re,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),ro(0,re,"volume",function(){return this._volume},function(rS){this.isStopped||(this._volume=rS,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(rS,this.context.currentTime,.1):this.gain.gain.value=rS)}),rQ._tryCleanFailed=!1,rQ}(),rLS=function(rS){function rQ(){rQ.__super.call(this),this._w=0,this._h=0}rj(rQ,"laya.resource.Bitmap",rRS);var re=rQ.prototype;return ro(0,re,"width",function(){return this._w}),ro(0,re,"height",function(){return this._h}),ro(0,re,"source",function(){return this._source}),rQ}(),rjS=function(rQ){function rS(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,rS.__super.call(this),this._interval=rl.animationInterval,this._setUpNoticeType(1)}rj(rS,"laya.display.AnimationPlayerBase",rQ);var re=rS.prototype;return re.play=function(rS,rQ,re,rl){void 0===rS&&(rS=0),void 0===rQ&&(rQ=!0),void 0===re&&(re=""),void 0===rl&&(rl=!0),this._isPlaying=!0,this.index="string"==typeof rS?this._getFrameByLabel(rS):rS,this.loop=rQ,this._actionName=re,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},re._getFrameByLabel=function(rS){var rQ=0;for(rQ=0;rQ<this._count;rQ++)if(this._labels[rQ]&&0<=this._labels[rQ].indexOf(rS))return rQ;return 0},re._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},re._setControlNode=function(rS){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=rS)&&rS!=this&&(rS.on("display",this,this._checkResumePlaying),rS.on("undisplay",this,this._checkResumePlaying))},re._setDisplay=function(rS){rQ.prototype._setDisplay.call(this,rS),this._checkResumePlaying()},re._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},re.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},re.addLabel=function(rS,rQ){this._labels||(this._labels={}),this._labels[rQ]||(this._labels[rQ]=[]),this._labels[rQ].push(rS)},re.removeLabel=function(rS){if(rS){if(this._labels)for(var rQ in this._labels)this._removeLabelFromLabelList(this._labels[rQ],rS)}else this._labels=null},re._removeLabelFromLabelList=function(rS,rQ){if(rS)for(var re=rS.length-1;0<=re;re--)rS[re]==rQ&&rS.splice(re,1)},re.gotoAndStop=function(rS){this.index="string"==typeof rS?this._getFrameByLabel(rS):rS,this.stop()},re._displayToIndex=function(rS){},re.clear=function(){this.stop(),this._labels=null},ro(0,re,"interval",function(){return this._interval},function(rS){this._interval!=rS&&(this._frameRateChanged=!0,this._interval=rS,this._isPlaying&&0<rS&&this.timerLoop(rS,this,this._frameLoop,null,!0,!0))}),ro(0,re,"isPlaying",function(){return this._isPlaying}),ro(0,re,"index",function(){return this._index},function(rS){if(this._index=rS,this._displayToIndex(rS),this._labels&&this._labels[rS])for(var rQ=this._labels[rS],re=0,rl=rQ.length;re<rl;re++)this.event("label",rQ[re])}),ro(0,re,"count",function(){return this._count}),rS.WRAP_POSITIVE=0,rS.WRAP_REVERSE=1,rS.WRAP_PINGPONG=2,rS}(rYS),rcS=function(rQ){function rJ(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,rJ.__super.call(this),this.overflow=rJ.VISIBLE,this._style=new rQS(this),this._style.wordWrap=!1}rj(rJ,"laya.display.Text",rQ);var rS=rJ.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._lines=null,this._words&&(this._words.length=0,this._words=null)},rS._getBoundPointsM=function(rS){void 0===rS&&(rS=!1);var rQ=rg.TEMP;return rQ.setTo(0,0,this.width,this.height),rQ._getBoundPoints()},rS.getGraphicBounds=function(rS){void 0===rS&&(rS=!1);var rQ=rg.TEMP;return rQ.setTo(0,0,this.width,this.height),rQ},rS._getCSSStyle=function(){return this._style},rS.lang=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro){if(rS=rJ.langPacks&&rJ.langPacks[rS]?rJ.langPacks[rS]:rS,arguments.length<2)this._text=rS;else{for(var rY=0,rp=arguments.length;rY<rp;rY++)rS=rS.replace("{"+rY+"}",arguments[rY+1]);this._text=rS}},rS._isPassWordMode=function(){var rS=this._style.password;return"prompt"in this&&this.prompt==this._text&&(rS=!1),rS},rS._getPassWordTxt=function(rS){var rQ;rQ="";for(var re=rS.length;0<re;re--)rQ+="●";return rQ},rS.renderText=function(rS,rQ){var re=this.graphics;re.clear(!0);var rl=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(rf.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);rf.context.font=rl;var rM=this.padding,rd=rM[3],rT="left",rU=this._lines,ri=this.leading+this._charSize.height,rR=this._currBitmapFont;rR&&(ri=this.leading+rR.getMaxHeight());var ro=rM[0];if(!rR&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(rT="right",rd=this._width-rM[1]):"center"==this.align&&(rT="center",rd=.5*this._width+rM[3]-rM[1])),0<this._height){var rY=this._textHeight>this._height?"top":this.valign;"middle"===rY?ro=.5*(this._height-rQ*ri)+rM[0]-rM[2]:"bottom"===rY&&(ro=this._height-rQ*ri-rM[2])}var rp=this._style;if(rR&&rR.autoScaleSize)var rJ=rR.fontSize/this.fontSize;if(this._clipPoint)if(re.save(),rR&&rR.autoScaleSize){var rL=0,rj=0;rL=this._width?this._width-rM[3]-rM[1]:this._textWidth,rj=this._height?this._height-rM[0]-rM[2]:this._textHeight,rL*=rJ,rj*=rJ,re.clipRect(rM[3],rM[0],rL,rj)}else re.clipRect(rM[3],rM[0],this._width?this._width-rM[3]-rM[1]:this._textWidth,this._height?this._height-rM[0]-rM[2]:this._textHeight);var rc=rp.password;"prompt"in this&&this.prompt==this._text&&(rc=!1);for(var rG=0,rz=0,rA=Math.min(this._lines.length,rQ+rS)||1,rv=rS;rv<rA;rv++){var rD,rB=rU[rv];if(rc){var rO=rB.length;rB="";for(var rH=rO;0<rH;rH--)rB+="●"}if(rG=rd-(this._clipPoint?this._clipPoint.x:0),rz=ro+ri*rv-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(rT,rG,rz,rv),rR){var rg=this.width;rR.autoScaleSize&&(rg=this.width*rJ),rR.drawText(rB,this,rG,rz,this.align,rg)}else rm.isWebGL?(this._words||(this._words=[]),(rD=this._words.length>rv-rS?this._words[rv-rS]:new ry).setText(rB)):rD=rB,rp.stroke?re.fillBorderText(rD,rG,rz,rl,this.color,rp.strokeColor,rp.stroke,rT):re.fillText(rD,rG,rz,rl,this.color,rT)}if(rR&&rR.autoScaleSize){var rI=1/rJ;this.scale(rI,rI)}this._clipPoint&&re.restore(),this._startX=rd,this._startY=ro},rS.drawUnderline=function(rS,rQ,re,rl){var rM=this._lineWidths[rl];switch(rS){case"center":rQ-=rM/2;break;case"right":rQ-=rM}re+=this._charSize.height,this._graphics.drawLine(rQ,re,rQ+rM,re,this.underlineColor||this.color,1)},rS.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);rf.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new rH(0,0)):this._clipPoint=null;var rS=this._lines.length;if(this.overflow!=rJ.VISIBLE){var rQ=this.overflow==rJ.HIDDEN?Math.floor:Math.ceil;rS=Math.min(rS,rQ((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var re=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(re,rS),this.repaint()},rS.evalTextSize=function(){var rS,rQ=NaN;rS=Math.max.apply(this,this._lineWidths),rQ=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],rS==this._textWidth&&rQ==this._textHeight||(this._textWidth=rS,this._textHeight=rQ,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},rS.checkEnabledViewportOrNot=function(){return this.overflow==rJ.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},rS.changeText=function(rS){this._text!==rS&&(this.lang(rS+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},rS.parseLines=function(rS){var rQ=this.wordWrap||this.overflow==rJ.HIDDEN;if(rQ)var re=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var rl=rf.context.measureText(rJ._testWord);rm.isConchApp&&0===rl.width&&0===rl.height&&(rl=rf.context.measureText("W")),this._charSize.width=rl.width,this._charSize.height=rl.height||this.fontSize}for(var rM=rS.replace(/\r\n/g,"\n").split("\n"),rd=0,rT=rM.length;rd<rT;rd++){var rU=rM[rd];rQ?this.parseLine(rU,re):(this._lineWidths.push(this.getTextWidth(rU)),this._lines.push(rU))}},rS.parseLine=function(rS,rQ){rf.context;var re,rl=this._lines,rM=0,rd=NaN,rT=NaN,rU=0;if((rd=this.getTextWidth(rS))<=rQ)return rl.push(rS),void this._lineWidths.push(rd);rd=this._charSize.width,0==(rM=Math.floor(rQ/rd))&&(rM=1),rT=rd=this.getTextWidth(rS.substring(0,rM));for(var ri=rM,rR=rS.length;ri<rR;ri++)if(rQ<(rT+=rd=this.getTextWidth(rS.charAt(ri))))if(this.wordWrap){var ro=rS.substring(rU,ri);if(ro.charCodeAt(ro.length-1)<255?(re=/(?:\w|-)+$/.exec(ro))&&(ri=re.index+rU,0==re.index?ri+=ro.length:ro=rS.substring(rU,ri)):rJ.RightToLeft&&(re=/([\u0600-\u06FF])+$/.exec(ro))&&(ri=re.index+rU,0==re.index?ri+=ro.length:ro=rS.substring(rU,ri)),rl.push(ro),this._lineWidths.push(rT-rd),!((rU=ri)+rM<rR)){rl.push(rS.substring(rU,rR)),this._lineWidths.push(this.getTextWidth(rl[rl.length-1])),rU=-1;break}ri+=rM,rT=rd=this.getTextWidth(rS.substring(rU,ri)),ri--}else if(this.overflow==rJ.HIDDEN)return rl.push(rS.substring(0,ri)),void this._lineWidths.push(this.getTextWidth(rl[rl.length-1]));this.wordWrap&&-1!=rU&&(rl.push(rS.substring(rU,rR)),this._lineWidths.push(this.getTextWidth(rl[rl.length-1])))},rS.getTextWidth=function(rS){return this._currBitmapFont?this._currBitmapFont.getTextWidth(rS):rf.context.measureText(rS).width},rS.getWordWrapWidth=function(){var rS=this.padding,rQ=NaN;return(rQ=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(rQ=this.wordWrap?100:rf.width),rQ<=0&&(rQ=100),rQ-rS[3]-rS[1]},rS.getCharPoint=function(rS,rQ){this._isChanged&&rO.timer.runCallLater(this,this.typeset);for(var re=0,rl=this._lines,rM=0,rd=0,rT=rl.length;rd<rT;rd++){if(rS<(re+=rl[rd].length)){var rU=rd;break}rM=re}var ri=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;rf.context.font=ri;var rR=this.getTextWidth(this._text.substring(rM,rS));return(rQ||new rH).setTo(this._startX+rR-(this._clipPoint?this._clipPoint.x:0),this._startY+rU*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},ro(0,rS,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(rS){rS!=this._width&&(rO.superSet(rYS,this,"width",rS),this.isChanged=!0)}),ro(0,rS,"textWidth",function(){return this._isChanged&&rO.timer.runCallLater(this,this.typeset),this._textWidth}),ro(0,rS,"height",function(){return this._height?this._height:this.textHeight},function(rS){rS!=this._height&&(rO.superSet(rYS,this,"height",rS),this.isChanged=!0)}),ro(0,rS,"textHeight",function(){return this._isChanged&&rO.timer.runCallLater(this,this.typeset),this._textHeight}),ro(0,rS,"padding",function(){return this._getCSSStyle().padding},function(rS){this._getCSSStyle().padding=rS,this.isChanged=!0}),ro(0,rS,"bold",function(){return this._getCSSStyle().bold},function(rS){this._getCSSStyle().bold=rS,this.isChanged=!0}),ro(0,rS,"text",function(){return this._text||""},function(rS){this._text!==rS&&(this.lang(rS+""),this.isChanged=!0,this.event("change"))}),ro(0,rS,"color",function(){return this._getCSSStyle().color},function(rS){this._getCSSStyle().color!=rS&&(this._getCSSStyle().color=rS,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),ro(0,rS,"font",function(){return this._getCSSStyle().fontFamily},function(rS){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),rJ._bitmapFonts&&rJ._bitmapFonts[rS]&&(this._currBitmapFont=rJ._bitmapFonts[rS]),this._getCSSStyle().fontFamily=rS,this.isChanged=!0}),ro(0,rS,"fontSize",function(){return this._getCSSStyle().fontSize},function(rS){this._getCSSStyle().fontSize=rS,this.isChanged=!0}),ro(0,rS,"italic",function(){return this._getCSSStyle().italic},function(rS){this._getCSSStyle().italic=rS,this.isChanged=!0}),ro(0,rS,"align",function(){return this._getCSSStyle().align},function(rS){this._getCSSStyle().align=rS,this.isChanged=!0}),ro(0,rS,"valign",function(){return this._getCSSStyle().valign},function(rS){this._getCSSStyle().valign=rS,this.isChanged=!0}),ro(0,rS,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(rS){this._getCSSStyle().wordWrap=rS,this.isChanged=!0}),ro(0,rS,"leading",function(){return this._getCSSStyle().leading},function(rS){this._getCSSStyle().leading=rS,this.isChanged=!0}),ro(0,rS,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(rS){this._getCSSStyle().backgroundColor=rS,this.isChanged=!0}),ro(0,rS,"borderColor",function(){return this._getCSSStyle().borderColor},function(rS){this._getCSSStyle().borderColor=rS,this.isChanged=!0}),ro(0,rS,"stroke",function(){return this._getCSSStyle().stroke},function(rS){this._getCSSStyle().stroke=rS,this.isChanged=!0}),ro(0,rS,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(rS){this._getCSSStyle().strokeColor=rS,this.isChanged=!0}),ro(0,rS,"isChanged",null,function(rS){this._isChanged!==rS&&(this._isChanged=rS)&&rO.timer.callLater(this,this.typeset)}),ro(0,rS,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(rS){if(!(this.overflow!=rJ.SCROLL||this.textWidth<this._width)&&this._clipPoint){rS=rS<this.padding[3]?this.padding[3]:rS;var rQ=this._textWidth-this._width;rS=rQ<rS?rQ:rS;var re=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=rS,this.renderText(this._lastVisibleLineIndex,re)}}),ro(0,rS,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(rS){if(!(this.overflow!=rJ.SCROLL||this.textHeight<this._height)&&this._clipPoint){rS=rS<this.padding[0]?this.padding[0]:rS;var rQ=this._textHeight-this._height,re=(rS=rQ<rS?rQ:rS)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=re;var rl=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=rS,this.renderText(re,rl)}}),ro(0,rS,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),ro(0,rS,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),ro(0,rS,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),ro(0,rS,"underlineColor",function(){return this._underlineColor},function(rS){this._underlineColor=rS,this._isChanged=!0,this.typeset()}),rJ.registerBitmapFont=function(rS,rQ){rJ._bitmapFonts||(rJ._bitmapFonts={}),rJ._bitmapFonts[rS]=rQ},rJ.unregisterBitmapFont=function(rS,rQ){if(void 0===rQ&&(rQ=!0),rJ._bitmapFonts&&rJ._bitmapFonts[rS]){var re=rJ._bitmapFonts[rS];rQ&&re.destroy(),delete rJ._bitmapFonts[rS]}},rJ.setTextRightToLeft=function(){var rS;(rS=rf.canvas.source.style).display="none",rS.position="absolute",rS.direction="rtl",rm._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,rf.document.body.appendChild(rf.canvas.source)},rJ.supportFont=function(rS){rf.context.font="10px sans-serif";var rQ=rf.context.measureText("abcji").width;rf.context.font="10px "+rS;var re=rf.context.measureText("abcji").width;return console.log(rQ,re),rQ!==re},rJ._testWord="游",rJ.langPacks=null,rJ.VISIBLE="visible",rJ.SCROLL="scroll",rJ.HIDDEN="hidden",rJ.CharacterCache=!0,rJ.RightToLeft=!1,rJ._bitmapFonts=null,ri(rJ,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),rJ}(rYS),rGS=function(rY){function rT(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",rT.__super.call(this),this.offset=new rH,this._canvasTransform=new rX,this._previousOrientation=rf.window.orientation;var rQ=this;this.transform=rX.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var rS=rf.window,re=this;rS.addEventListener("focus",function(){rQ._isFocused=!0,re.event("focus"),re.event("focuschange")}),rS.addEventListener("blur",function(){rQ._isFocused=!1,re.event("blur"),re.event("focuschange"),re._isInputting()&&(rDS.inputElement.target.focus=!1)});var rl="visibilityState",rM="visibilitychange",rd=rS.document;void 0!==rd.hidden?(rM="visibilitychange",rl="visibilityState"):void 0!==rd.mozHidden?(rM="mozvisibilitychange",rl="mozVisibilityState"):void 0!==rd.msHidden?(rM="msvisibilitychange",rl="msVisibilityState"):void 0!==rd.webkitHidden&&(rM="webkitvisibilitychange",rl="webkitVisibilityState"),rS.document.addEventListener(rM,function(){"hidden"==rf.document[rl]?re._setStageVisible(!1):re._setStageVisible(!0)}),rS.document.addEventListener("qbrowserVisibilityChange",function(rS){re._setStageVisible(!rS.hidden)}),rS.addEventListener("resize",function(){var rS=rf.window.orientation;null!=rS&&rS!=rQ._previousOrientation&&re._isInputting()&&(rDS.inputElement.target.focus=!1),rQ._previousOrientation=rS,re._isInputting()||re._resetCanvas()}),rS.addEventListener("orientationchange",function(rS){re._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),rf.onMobile&&this.on("mousedown",this,this._onmouseMove)}rj(rT,"laya.display.Stage",rY);var rS=rT.prototype;return rS._setStageVisible=function(rS){this._isVisibility!=rS&&(this._isVisibility=rS,this._isVisibility||this._isInputting()&&(rDS.inputElement.target.focus=!1),this.event("visibilitychange"))},rS._isInputting=function(){return rf.onMobile&&rDS.isInputting},rS._changeCanvasSize=function(){this.setScreenSize(rf.clientWidth*rf.pixelRatio,rf.clientHeight*rf.pixelRatio)},rS._resetCanvas=function(){if(this.screenAdaptationEnabled){var rS=rm._mainCanvas;rS.source.style;rS.size(1,1),rO.timer.once(100,this,this._changeCanvasSize)}},rS.setScreenSize=function(rS,rQ){var re=!1;if("none"!==this._screenMode&&(re=(rS/rQ<1?"vertical":"horizontal")!==this._screenMode)){var rl=rQ;rQ=rS,rS=rl}this.canvasRotation=re;var rM=rm._mainCanvas,rd=rM.source.style,rT=this._canvasTransform.identity(),rU=this._scaleMode,ri=rS/this.designWidth,rR=rQ/this.designHeight,ro=this.designWidth,rY=this.designHeight,rp=rS,rJ=rQ,rL=rf.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,rU){case"noscale":ri=rR=1,rp=this.designWidth,rJ=this.designHeight;break;case"showall":ri=rR=Math.min(ri,rR),ro=rp=Math.round(this.designWidth*ri),rY=rJ=Math.round(this.designHeight*rR);break;case"noborder":ri=rR=Math.max(ri,rR),rp=Math.round(this.designWidth*ri),rJ=Math.round(this.designHeight*rR);break;case"full":ri=rR=1,this._width=ro=rS,this._height=rY=rQ;break;case"fixedwidth":rR=ri,this._height=rY=Math.round(rQ/ri);break;case"fixedheight":ri=rR,this._width=ro=Math.round(rS/rR);break;case"fixedauto":rS/rQ<this.designWidth/this.designHeight?(rR=ri,this._height=rY=Math.round(rQ/ri)):(ri=rR,this._width=ro=Math.round(rS/rR))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,ro=ro+1&2147483646,rY=rY+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),ri*=this.scaleX,rR*=this.scaleY,1===ri&&1===rR?this.transform.identity():(this.transform.a=this._formatData(ri/(rp/ro)),this.transform.d=this._formatData(rR/(rJ/rY)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),rM.size(ro,rY),rk.changeWebGLSize(ro,rY),rT.scale(rp/ro/rL,rJ/rY/rL),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(rS-rp)/rL:this.offset.x=.5*(rS-rp)/rL,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(rQ-rJ)/rL:this.offset.y=.5*(rQ-rJ)/rL,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),rT.translate(this.offset.x,this.offset.y),this.canvasDegree=0,re&&("horizontal"===this._screenMode?(rT.rotate(Math.PI/2),rT.translate(rQ/rL,0),this.canvasDegree=90):(rT.rotate(-Math.PI/2),rT.translate(0,rS/rL),this.canvasDegree=-90)),rT.a=this._formatData(rT.a),rT.d=this._formatData(rT.d),rT.tx=this._formatData(rT.tx),rT.ty=this._formatData(rT.ty),rd.transformOrigin=rd.webkitTransformOrigin=rd.msTransformOrigin=rd.mozTransformOrigin=rd.oTransformOrigin="0px 0px 0px",rd.transform=rd.webkitTransform=rd.msTransform=rd.mozTransform=rd.oTransform="matrix("+rT.toString()+")",rT.translate(parseInt(rd.left)||0,parseInt(rd.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},rS._formatData=function(rS){return Math.abs(rS)<1e-6?0:Math.abs(1-rS)<.001?0<rS?1:-1:rS},rS.getMousePoint=function(){return rH.TEMP.setTo(this.mouseX,this.mouseY)},rS.repaint=function(){this._repaint=1},rS.parentRepaint=function(){},rS._loop=function(){return this.render(rm.context,0,0),!0},rS._onmouseMove=function(rS){this._mouseMoveTime=rf.now()},rS.getTimeFromFrameStart=function(){return rf.now()-this._frameStartTime},rS.render=function(rS,rQ,re){if("sleep"===this._frameRate&&!rm.isConchApp){var rl=rf.now();if(!(1e3<=rl-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(rN.loopCount++,rL.instance.runEvent(),rO.timer._update()));this._frameStartTime=rl}if(this._renderCount++,rm.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=rf.now();var rM="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),rd=this._renderCount%2==0;if(rN.renderSlow=!rM,rM||rd||rm.isConchApp){var rT;rN.loopCount++,rL.instance.runEvent(),rO.timer._update(),rk.update3DLoop();var rU=0,ri=0;if(rm.isConchNode)for(rU=0,ri=this._scenes.length;rU<ri;rU++)(rT=this._scenes[rU])&&rT._updateSceneConch();else for(rU=0,ri=this._scenes.length;rU<ri;rU++)(rT=this._scenes[rU])&&rT._updateScene();if(rm.isConchNode){var rR=rYS.CustomList;for(rU=0,ri=rR.length;rU<ri;rU++){var ro=rR[rU];ro.customRender(ro.customContext,0,0)}return}}rm.isConchNode||this.renderingEnabled&&(rM||!rd||rm.isConchWebGL)&&(rm.isWebGL?rm.WebGL.mainContext&&!rm.WebGL.mainContext.isContextLost()&&(rS.clear(),rY.prototype.render.call(this,rS,rQ,re),rN._show&&rN._sp&&rN._sp.render(rS,rQ,re),rk.clear(this._bgColor),rk.beginFlush(),rS.flush(),rk.endFinish(),r_.instance&&r_.getInstance().endDispose()):(rk.clear(this._bgColor),rY.prototype.render.call(this,rS,rQ,re),rN._show&&rN._sp&&rN._sp.render(rS,rQ,re)))}else this._renderCount%5==0&&(rN.loopCount++,rL.instance.runEvent(),rO.timer._update())},rS._requestFullscreen=function(){var rS=rf.document.documentElement;rS.requestFullscreen?rS.requestFullscreen():rS.mozRequestFullScreen?rS.mozRequestFullScreen():rS.webkitRequestFullscreen?rS.webkitRequestFullscreen():rS.msRequestFullscreen&&rS.msRequestFullscreen()},rS._fullScreenChanged=function(){rO.stage.event("fullscreenchange")},rS.exitFullscreen=function(){var rS=rf.document;rS.exitFullscreen?rS.exitFullscreen():rS.mozCancelFullScreen?rS.mozCancelFullScreen():rS.webkitExitFullscreen&&rS.webkitExitFullscreen()},ro(0,rS,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),ro(0,rS,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),ro(0,rS,"frameRate",function(){return this._frameRate},function(rS){if(this._frameRate=rS,rm.isConchApp)switch(this._frameRate){case"slow":rf.window.conch&&rf.window.conchConfig.setSlowFrame&&rf.window.conchConfig.setSlowFrame(!0);break;case"fast":rf.window.conch&&rf.window.conchConfig.setSlowFrame&&rf.window.conchConfig.setSlowFrame(!1);break;case"mouse":rf.window.conch&&rf.window.conchConfig.setMouseFrame&&rf.window.conchConfig.setMouseFrame(2e3);break;case"sleep":rf.window.conch&&rf.window.conchConfig.setLimitFPS&&rf.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),ro(0,rS,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),ro(0,rS,"width",rY.prototype._$get_width,function(rS){this.designWidth=rS,rO.superSet(rYS,this,"width",rS),rO.timer.callLater(this,this._changeCanvasSize)}),ro(0,rS,"alignH",function(){return this._alignH},function(rS){this._alignH=rS,rO.timer.callLater(this,this._changeCanvasSize)}),ro(0,rS,"isFocused",function(){return this._isFocused}),ro(0,rS,"height",rY.prototype._$get_height,function(rS){this.designHeight=rS,rO.superSet(rYS,this,"height",rS),rO.timer.callLater(this,this._changeCanvasSize)}),ro(0,rS,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||rX.create()},rY.prototype._$set_transform),ro(0,rS,"isVisibility",function(){return this._isVisibility}),ro(0,rS,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),ro(0,rS,"scaleMode",function(){return this._scaleMode},function(rS){this._scaleMode=rS,rO.timer.callLater(this,this._changeCanvasSize)}),ro(0,rS,"alignV",function(){return this._alignV},function(rS){this._alignV=rS,rO.timer.callLater(this,this._changeCanvasSize)}),ro(0,rS,"bgColor",function(){return this._bgColor},function(rS){this._bgColor=rS,this.conchModel&&this.conchModel.bgColor(rS),rm.isWebGL&&(rS?rT._wgColor=rW.create(rS)._color:rf.onMiniGame||(rT._wgColor=null)),rf.onLimixiu?rT._wgColor=rW.create(rS)._color:rm.canvas.style.background=rS||"none"}),ro(0,rS,"mouseX",function(){return Math.round(rL.instance.mouseX/this.clientScaleX)}),ro(0,rS,"mouseY",function(){return Math.round(rL.instance.mouseY/this.clientScaleY)}),ro(0,rS,"screenMode",function(){return this._screenMode},function(rS){this._screenMode=rS}),ro(0,rS,"visible",rY.prototype._$get_visible,function(rS){this.visible!==rS&&(rO.superSet(rYS,this,"visible",rS),rm._mainCanvas.source.style.visibility=rS?"visible":"hidden")}),ro(0,rS,"fullScreenEnabled",null,function(rS){var rQ=rf.document,re=rm.canvas;rS?(re.addEventListener("mousedown",this._requestFullscreen),re.addEventListener("touchstart",this._requestFullscreen),rQ.addEventListener("fullscreenchange",this._fullScreenChanged),rQ.addEventListener("mozfullscreenchange",this._fullScreenChanged),rQ.addEventListener("webkitfullscreenchange",this._fullScreenChanged),rQ.addEventListener("msfullscreenchange",this._fullScreenChanged)):(re.removeEventListener("mousedown",this._requestFullscreen),re.removeEventListener("touchstart",this._requestFullscreen),rQ.removeEventListener("fullscreenchange",this._fullScreenChanged),rQ.removeEventListener("mozfullscreenchange",this._fullScreenChanged),rQ.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),rQ.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),rT.SCALE_NOSCALE="noscale",rT.SCALE_EXACTFIT="exactfit",rT.SCALE_SHOWALL="showall",rT.SCALE_NOBORDER="noborder",rT.SCALE_FULL="full",rT.SCALE_FIXED_WIDTH="fixedwidth",rT.SCALE_FIXED_HEIGHT="fixedheight",rT.SCALE_FIXED_AUTO="fixedauto",rT.ALIGN_LEFT="left",rT.ALIGN_RIGHT="right",rT.ALIGN_CENTER="center",rT.ALIGN_TOP="top",rT.ALIGN_MIDDLE="middle",rT.ALIGN_BOTTOM="bottom",rT.SCREEN_NONE="none",rT.SCREEN_HORIZONTAL="horizontal",rT.SCREEN_VERTICAL="vertical",rT.FRAME_FAST="fast",rT.FRAME_SLOW="slow",rT.FRAME_MOUSE="mouse",rT.FRAME_SLEEP="sleep",rT.FRAME_MOUSE_THREDHOLD=2e3,ri(rT,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),rT}(rYS),rzS=(function(rS){function rQ(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,rQ.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}rj(rQ,"laya.media.SoundNode",rYS);var re=rQ.prototype;re._onParentChange=function(){this.target=this.parent},re.play=function(rS,rQ){void 0===rS&&(rS=1),isNaN(rS)&&(rS=1),this.url&&(this.stop(),this._channel=rt.playSound(this.url,rS,null,rQ))},re.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},re._setPlayAction=function(rS,rQ,re,rl){void 0===rl&&(rl=!0),this[re]&&rS&&(rl?rS.on(rQ,this,this[re]):rS.off(rQ,this,this[re]))},re._setPlayActions=function(rS,rQ,re,rl){if(void 0===rl&&(rl=!0),rS&&rQ){var rM,rd=rQ.split(","),rT=0;for(rM=rd.length,rT=0;rT<rM;rT++)this._setPlayAction(rS,rd[rT],re,rl)}},ro(0,re,"playEvent",null,function(rS){(this._playEvents=rS)&&this._tar&&this._setPlayActions(this._tar,rS,"play")}),ro(0,re,"target",null,function(rS){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=rS,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),ro(0,re,"stopEvent",null,function(rS){(this._stopEvents=rS)&&this._tar&&this._setPlayActions(this._tar,rS,"stop")})}(),function(rS){function rQ(){this._src=null,this._onload=null,this._onerror=null,rQ.__super.call(this)}rj(rQ,"laya.resource.FileBitmap",rLS);var re=rQ.prototype;return ro(0,re,"src",function(){return this._src},function(rS){this._src=rS}),ro(0,re,"onload",null,function(rS){}),ro(0,re,"onerror",null,function(rS){}),rQ}()),rAS=function(rS){function re(rS,rQ){this._is2D=!1,re.__super.call(this);var rl=this;if(this._source=this,"2D"===rS||"AUTO"===rS&&!rm.isWebGL){this._is2D=!0,this._source=rQ||rf.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var rM=this;rM.getContext=function(rS,rQ){if(rl._ctx)return rl._ctx;var re=rl._ctx=rl._source.getContext(rS,rQ);return re&&(re._canvas=rM,rm.isFlash||rf.onLimixiu||(re.size=function(rS,rQ){})),re}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}rj(re,"laya.resource.HTMLCanvas",rLS);var rQ=re.prototype;return rQ.clear=function(){this._ctx&&this._ctx.clear()},rQ.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},rQ.release=function(){},rQ._setContext=function(rS){this._ctx=rS},rQ.getContext=function(rS,rQ){return this._ctx?this._ctx:this._ctx=re._createContext(this)},rQ.getMemSize=function(){return 0},rQ.size=function(rS,rQ){(this._w!=rS||this._h!=rQ||this._source&&(this._source.width!=rS||this._source.height!=rQ))&&(this._w=rS,this._h=rQ,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(rS,rQ),this._source&&(this._source.height=rQ,this._source.width=rS))},rQ.getCanvas=function(){return this._source},rQ.toBase64=function(rS,rQ,re){if(this._source)if(rm.isConchApp&&this._source.toBase64)this._source.toBase64(rS,rQ,re);else{var rl=this._source.toDataURL(rS,rQ);re.call(this,rl)}},ro(0,rQ,"context",function(){return this._ctx}),ro(0,rQ,"asBitmap",null,function(rS){}),re.create=function(rS,rQ){return new re(rS,rQ)},re.TYPE2D="2D",re.TYPE3D="3D",re.TYPEAUTO="AUTO",re._createContext=null,re}(),rvS=(function(rS){function ri(rS,rQ,re,rl,rM,rd,rT,rU){throw ri.__super.call(this),new Error("不允许new！")}rj(ri,"laya.resource.HTMLSubImage",rLS),ri.create=function(rS,rQ,re,rl,rM,rd,rT,rU){return void 0===rU&&(rU=!1),new ri(rS,rQ,re,rl,rM,rd,rT,rU)}}(),function(rS){function rY(){this._frames=null,this._url=null,rY.__super.call(this),this._setControlNode(this)}rj(rY,"laya.display.Animation",rS);var rQ=rY.prototype;rQ.destroy=function(rS){void 0===rS&&(rS=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,rS),this._frames=null,this._labels=null},rQ.play=function(rS,rQ,re,rl){void 0===rS&&(rS=0),void 0===rQ&&(rQ=!0),void 0===re&&(re=""),void 0===rl&&(rl=!0),re&&this._setFramesFromCache(re,rl),this._isPlaying=!0,this.index="string"==typeof rS?this._getFrameByLabel(rS):rS,this.loop=rQ,this._actionName=re,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},rQ._setFramesFromCache=function(rS,rQ){var re;return void 0===rQ&&(rQ=!1),this._url&&(rS=this._url+"#"+rS),rS&&rY.framesMap[rS]?((re=rY.framesMap[rS])instanceof Array?(this._frames=rY.framesMap[rS],this._count=this._frames.length):(re.nodeRoot&&(rY.framesMap[rS]=this._parseGraphicAnimationByData(re),re=rY.framesMap[rS]),this._frames=re.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=re.interval),this._labels=this._copyLabels(re.labels)),!0):(rQ&&console.log("ani not found:",rS),!1)},rQ._copyLabels=function(rS){if(!rS)return null;var rQ,re;for(re in rQ={},rS)rQ[re]=rV.copyArray([],rS[re]);return rQ},rQ._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&rS.prototype._frameLoop.call(this)},rQ._displayToIndex=function(rS){this._frames&&(this.graphics=this._frames[rS])},rQ.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},rQ.loadImages=function(rS,rQ){return void 0===rQ&&(rQ=""),this._url="",this._setFramesFromCache(rQ)||(this.frames=rY.framesMap[rQ]?rY.framesMap[rQ]:rY.createFrames(rS,rQ)),this},rQ.loadAtlas=function(rQ,re,rl){void 0===rl&&(rl=""),this._url="";var rM=this;function rS(rS){rQ===rS&&(rM.frames=rY.framesMap[rl]?rY.framesMap[rl]:rY.createFrames(rQ,rl),re&&re.run())}return rM._setFramesFromCache(rl)||(rUS.getAtlas(rQ)?rS(rQ):rO.loader.load(rQ,rz.create(null,rS,[rQ]),null,"atlas")),this},rQ.loadAnimation=function(rS,rQ,re){this._url=rS;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,rQ&&rQ.run()):!re||rUS.getAtlas(re)?this._loadAnimationData(rS,rQ,re):rO.loader.load(re,rz.create(this,this._loadAnimationData,[rS,rQ,re]),null,"atlas"),this},rQ._loadAnimationData=function(rU,ri,rS){var rR=this;if(!rS||rUS.getAtlas(rS)){var ro=this;rUS.getRes(rU)?rQ(rU):rO.loader.load(rU,rz.create(null,rQ,[rU]),null,"json"),rUS.clearRes(rU)}else console.warn("atlas load fail:"+rS);function rQ(rS){if(rUS.getRes(rS)&&rU===rS){var rQ;if(rY.framesMap[rU+"#"])ro._setFramesFromCache(rR._actionName,!0),rR.index=0,rR._checkResumePlaying();else{var re=ro._parseGraphicAnimation(rUS.getRes(rU));if(!re)return;var rl,rM=re.animationList,rd=0,rT=rM.length;for(rd=0;rd<rT;rd++)rQ=rM[rd],rY.framesMap[rU+"#"+rQ.name]=rQ,rl||(rl=rQ);rl&&(rY.framesMap[rU+"#"]=rl,ro._setFramesFromCache(rR._actionName,!0),rR.index=0),rR._checkResumePlaying()}ri&&ri.run()}}},rQ._parseGraphicAnimation=function(rS){return rOS.parseAnimationData(rS)},rQ._parseGraphicAnimationByData=function(rS){return rOS.parseAnimationByData(rS)},ro(0,rQ,"frames",function(){return this._frames},function(rS){(this._frames=rS)&&(this._count=rS.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),ro(0,rQ,"autoPlay",null,function(rS){rS?this.play():this.stop()}),ro(0,rQ,"source",null,function(rS){-1<rS.indexOf(".ani")?this.loadAnimation(rS):-1<rS.indexOf(".json")||-1<rS.indexOf("als")||-1<rS.indexOf("atlas")?this.loadAtlas(rS):this.loadImages(rS.split(","))}),ro(0,rQ,"autoAnimation",null,function(rS){this.play(0,!0,rS,!1)}),rY.createFrames=function(rS,rQ){var re,rl,rM=0,rd=0;if("string"==typeof rS){var rT=rUS.getAtlas(rS);if(rT&&rT.length)for(re=[],rM=0,rd=rT.length;rM<rd;rM++)(rl=new rk.createGraphics).drawTexture(rUS.getRes(rT[rM]),0,0),re.push(rl)}else if(rS instanceof Array)for(re=[],rM=0,rd=rS.length;rM<rd;rM++)(rl=new rk.createGraphics).loadImage(rS[rM],0,0),re.push(rl);return rQ&&(rY.framesMap[rQ]=re),re},rY.clearCache=function(rS){var rQ,re=rY.framesMap,rl=rS+"#";for(rQ in re)rQ!==rS&&0!=rQ.indexOf(rl)||delete rY.framesMap[rQ]},rY.framesMap={}}(rjS),function(rS){function rd(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,rd.__super.call(this),null==rd._sortIndexFun&&(rd._sortIndexFun=rB.sortByKey("index",!1,!0))}rj(rd,"laya.display.FrameAnimation",rS);var rQ=rd.prototype;return rQ._setUp=function(rS,rQ){this._labels=null,this._animationNewFrames=null,this._targetDic=rS,this._animationData=rQ,this.interval=1e3/rQ.frameRate,rQ.parsed?(this._count=rQ.count,this._labels=rQ.labels,this._animationNewFrames=rQ.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),rQ.parsed=!0,rQ.labels=this._labels,rQ.count=this._count,rQ.animationNewFrames=this._animationNewFrames},rQ.clear=function(){rS.prototype.clear.call(this),this._targetDic=null,this._animationData=null},rQ._displayToIndex=function(rS){if(this._animationData){rS<0&&(rS=0),rS>this._count&&(rS=this._count);var rQ=this._animationData.nodes,re=0,rl=rQ.length;for(re=0;re<rl;re++)this._displayNodeToFrame(rQ[re],rS)}},rQ._displayNodeToFrame=function(rS,rQ,re){re||(re=this._targetDic);var rl=re[rS.target];if(rl){var rM,rd,rT,rU=rS.frames,ri=rS.keys,rR=0,ro=ri.length;for(rR=0;rR<ro;rR++)rT=(rd=rU[rM=ri[rR]]).length>rQ?rd[rQ]:rd[rd.length-1],rl[rM]=rT}},rQ._calculateDatas=function(){if(this._animationData){var rS,rQ=this._animationData.nodes,re=0,rl=rQ.length;for(re=this._count=0;re<rl;re++)rS=rQ[re],this._calculateNodeKeyFrames(rS);this._count+=1}},rQ._calculateNodeKeyFrames=function(rS){var rQ,re,rl=rS.keyframes,rM=rS.target;for(rQ in rS.frames||(rS.frames={}),rS.keys?rS.keys.length=0:rS.keys=[],rS.initValues||(rS.initValues={}),rl)re=rl[rQ],rS.frames[rQ]||(rS.frames[rQ]=[]),this._targetDic&&this._targetDic[rM]&&(rS.initValues[rQ]=this._targetDic[rM][rQ]),re.sort(rd._sortIndexFun),rS.keys.push(rQ),this._calculateNodePropFrames(re,rS.frames[rQ],rQ,rM)},rQ.resetToInitState=function(){if(this._targetDic&&this._animationData){var rS,rQ,re=this._animationData.nodes,rl=0,rM=re.length;for(rl=0;rl<rM;rl++)if(rQ=(rS=re[rl]).initValues){var rd,rT=this._targetDic[rS.target];if(rT)for(rd in rQ)rT[rd]=rQ[rd]}}},rQ._calculateNodePropFrames=function(rS,rQ,re,rl){var rM=0,rd=rS.length-1;if(0<rd){for(rQ.length=rS[rd].index+1,rM=0;rM<rd;rM++)this._dealKeyFrame(rS[rM]),this._calculateFrameValues(rS[rM],rS[rM+1],rQ);this._dealKeyFrame(rS[rM])}0==rd&&(rQ[rS[0].index]=rS[0].value,this._animationNewFrames&&(this._animationNewFrames[rS[0].index]=!0))},rQ._dealKeyFrame=function(rS){rS.label&&""!=rS.label&&this.addLabel(rS.label,rS.index)},rQ._calculateFrameValues=function(rS,rQ,re){var rl,rM=0,rd=rS.index,rT=rQ.index,rU=rS.value,ri=rQ.value-rS.value,rR=rT-rd;if(rT>this._count&&(this._count=rT),rS.tween)for(null==(rl=rF[rS.tweenMethod])&&(rl=rF.linearNone),rM=rd;rM<rT;rM++)re[rM]=rl(rM-rd,rU,ri,rR),this._animationNewFrames&&(this._animationNewFrames[rM]=!0);else for(rM=rd;rM<rT;rM++)re[rM]=rU;this._animationNewFrames&&(this._animationNewFrames[rS.index]=!0,this._animationNewFrames[rQ.index]=!0),re[rQ.index]=rQ.value},rd._sortIndexFun=null,rd}(rjS)),rDS=function(rQ){function rM(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",rM.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=rcS.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}rj(rM,"laya.display.Input",rQ);var rS=rM.prototype;return rS.setSelection=function(rS,rQ){this.focus=!0,laya.display.Input.inputElement.selectionStart=rS,laya.display.Input.inputElement.selectionEnd=rQ},rS._onUnDisplay=function(rS){this.focus=!1},rS._onMouseDown=function(rS){this.focus=!0},rS._syncInputTransform=function(){var rS=this.nativeInput,rQ=rV.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),re=this._width-this.padding[1]-this.padding[3],rl=this._height-this.padding[0]-this.padding[2];rm.isConchApp?(rS.setScale(rQ.scaleX,rQ.scaleY),rS.setSize(re,rl),rS.setPos(rQ.x,rQ.y)):(rM.inputContainer.style.transform=rM.inputContainer.style.webkitTransform="scale("+rQ.scaleX+","+rQ.scaleY+") rotate("+rO.stage.canvasDegree+"deg)",rS.style.width=re+"px",rS.style.height=rl+"px",rM.inputContainer.style.left=rQ.x+"px",rM.inputContainer.style.top=rQ.y+"px")},rS.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},rS._setInputMethod=function(){rM.input.parentElement&&rM.inputContainer.removeChild(rM.input),rM.area.parentElement&&rM.inputContainer.removeChild(rM.area),rM.inputElement=this._multiline?rM.area:rM.input,rM.inputContainer.appendChild(rM.inputElement),rcS.RightToLeft&&(rM.inputElement.style.direction="rtl")},rS._focusIn=function(){laya.display.Input.isInputting=!0;var rS=this.nativeInput;this._focus=!0;var rQ=rS.style;rQ.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),rS.readOnly=!this._editable,rm.isConchApp&&(rS.setType(this._type),rS.setForbidEdit(!this._editable)),rS.maxLength=this._maxChars;this.padding;if(rS.type=this._type,rS.value=this._content,rS.placeholder=this._prompt,rO.stage.off("keydown",this,this._onKeyDown),rO.stage.on("keydown",this,this._onKeyDown),(rO.stage.focus=this).event("focus"),rf.onPC&&rS.focus(),!rf.onMiniGame){this._text;this._text=null}this.typeset(),rS.setColor(this._originColor),rS.setFontSize(this.fontSize),rS.setFontFace(rf.onIPhone&&rcS._fontFamilyMap[this.font]||this.font),rm.isConchApp&&rS.setMultiAble&&rS.setMultiAble(this._multiline),rQ.lineHeight=this.leading+this.fontSize+"px",rQ.fontStyle=this.italic?"italic":"normal",rQ.fontWeight=this.bold?"bold":"normal",rQ.textAlign=this.align,rQ.padding="0 0",this._syncInputTransform(),!rm.isConchApp&&rf.onPC&&rO.timer.frameLoop(1,this,this._syncInputTransform)},rS._setPromptColor=function(){(rM.promptStyleDOM=rf.getElementById("promptStyle"))||((rM.promptStyleDOM=rf.createElement("style")).setAttribute("id","promptStyle"),rf.document.head.appendChild(rM.promptStyleDOM)),rM.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},rS._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(rO.superSet(rcS,this,"text",this._content),rO.superSet(rcS,this,"color",this._originColor)):(rO.superSet(rcS,this,"text",this._prompt),rO.superSet(rcS,this,"color",this._promptColor)),rO.stage.off("keydown",this,this._onKeyDown),rO.stage.focus=null,this.event("blur"),rm.isConchApp&&this.nativeInput.blur(),rf.onPC&&rO.timer.clear(this,this._syncInputTransform)},rS._onKeyDown=function(rS){13===rS.keyCode&&(rf.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},rS.changeText=function(rS){this._content=rS,this._focus?(this.nativeInput.value=rS||"",this.event("change")):rQ.prototype.changeText.call(this,rS)},ro(0,rS,"color",rQ.prototype._$get_color,function(rS){this._focus&&this.nativeInput.setColor(rS),rO.superSet(rcS,this,"color",this._content?rS:this._promptColor),this._originColor=rS}),ro(0,rS,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(rS){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),ro(0,rS,"multiline",function(){return this._multiline},function(rS){this._multiline=rS,this.valign=rS?"top":"middle"}),ro(0,rS,"maxChars",function(){return this._maxChars},function(rS){rS<=0&&(rS=1e5),this._maxChars=rS}),ro(0,rS,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(rS){rO.superSet(rcS,this,"color",this._originColor),rS+="",this._focus?(this.nativeInput.value=rS||"",this.event("change")):(this._multiline||(rS=rS.replace(/\r?\n/g,"")),(this._content=rS)?rO.superSet(rcS,this,"text",rS):(rO.superSet(rcS,this,"text",this._prompt),rO.superSet(rcS,this,"color",this.promptColor)))}),ro(0,rS,"nativeInput",function(){return this._multiline?rM.area:rM.input}),ro(0,rS,"prompt",function(){return this._prompt},function(rS){!this._text&&rS&&rO.superSet(rcS,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?rO.superSet(rcS,this,"text",this._text==this._prompt?rS:this._text):rO.superSet(rcS,this,"text",rS),this._prompt=rcS.langPacks&&rcS.langPacks[rS]?rcS.langPacks[rS]:rS}),ro(0,rS,"focus",function(){return this._focus},function(rS){var rQ=this.nativeInput;this._focus!==rS&&(rS?(rQ.target?rQ.target._focusOut():this._setInputMethod(),(rQ.target=this)._focusIn()):(rQ.target=null,this._focusOut(),rf.document.body.scrollTop=0,rQ.blur(),rm.isConchApp?rQ.setPos(-1e4,-1e4):rM.inputContainer.contains(rQ)&&rM.inputContainer.removeChild(rQ)))}),ro(0,rS,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(rS){rS?(-1<(rS="[^"+rS+"]").indexOf("^^")&&(rS=rS.replace("^^","")),this._restrictPattern=new RegExp(rS,"g")):this._restrictPattern=null}),ro(0,rS,"editable",function(){return this._editable},function(rS){this._editable=rS,rm.isConchApp&&rM.input.setForbidEdit(!rS)}),ro(0,rS,"promptColor",function(){return this._promptColor},function(rS){this._promptColor=rS,this._content||rO.superSet(rcS,this,"color",rS)}),ro(0,rS,"type",function(){return this._type},function(rS){this._getCSSStyle().password="password"==rS,this._type=rS,rm.isConchApp&&this.nativeInput.setType(rS)}),ro(0,rS,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(rS){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),ro(0,rS,"asPassword",function(){return this._getCSSStyle().password},function(rS){this._getCSSStyle().password=rS,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),rM.__init__=function(){rM._createInputElement(),rf.onMobile&&rm.canvas.addEventListener(rM.IOS_IFRAME?rf.onMiniGame?"touchend":"click":"touchend",rM._popupInputMethod)},rM._popupInputMethod=function(rS){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},rM._createInputElement=function(){rM._initInput(rM.area=rf.createElement("textarea")),rM._initInput(rM.input=rf.createElement("input")),(rM.inputContainer=rf.createElement("div")).style.position="absolute",rM.inputContainer.style.zIndex=1e5,rf.container.appendChild(rM.inputContainer),rM.inputContainer.setPos=function(rS,rQ){rM.inputContainer.style.left=rS+"px",rM.inputContainer.style.top=rQ+"px"}},rM._initInput=function(rQ){var rS=rQ.style;rS.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",rS.resize="none",rS.backgroundColor="transparent",rS.border="none",rS.outline="none",rS.zIndex=1,rQ.addEventListener("input",rM._processInputting),rQ.addEventListener("mousemove",rM._stopEvent),rQ.addEventListener("mousedown",rM._stopEvent),rQ.addEventListener("touchmove",rM._stopEvent),rQ.setFontFace=function(rS){rQ.style.fontFamily=rS},rm.isConchApp||(rQ.setColor=function(rS){rQ.style.color=rS},rQ.setFontSize=function(rS){rQ.style.fontSize=rS+"px"})},rM._processInputting=function(rS){var rQ=laya.display.Input.inputElement.target;if(rQ){var re=laya.display.Input.inputElement.value;rQ._restrictPattern&&(re=re.replace(/\u2006|\x27/g,""),rQ._restrictPattern.test(re)&&(re=re.replace(rQ._restrictPattern,""),laya.display.Input.inputElement.value=re)),rQ._text=re,rQ.event("input")}},rM._stopEvent=function(rS){"touchmove"==rS.type&&rS.preventDefault(),rS.stopPropagation&&rS.stopPropagation()},rM.TYPE_TEXT="text",rM.TYPE_PASSWORD="password",rM.TYPE_EMAIL="email",rM.TYPE_URL="url",rM.TYPE_NUMBER="number",rM.TYPE_RANGE="range",rM.TYPE_DATE="date",rM.TYPE_MONTH="month",rM.TYPE_WEEK="week",rM.TYPE_TIME="time",rM.TYPE_DATE_TIME="datetime",rM.TYPE_DATE_TIME_LOCAL="datetime-local",rM.TYPE_SEARCH="search",rM.input=null,rM.area=null,rM.inputElement=null,rM.inputContainer=null,rM.confirmButton=null,rM.promptStyleDOM=null,rM.inputHeight=45,rM.isInputting=!1,rM.stageMatrix=null,ri(rM,["IOS_IFRAME",function(){return this.IOS_IFRAME=rf.onIOS&&rf.window.top!=rf.window.self}]),rM}(rcS),rBS=function(rS){function re(rS,rQ){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,re.__super.call(this),rS&&this._init_(rS,rQ)}rj(re,"laya.resource.HTMLImage",rzS);var rQ=re.prototype;return rQ._init_=function(rS,rQ){this._src=rS,this._source=new rf.window.Image,rQ&&(rQ.onload&&(this.onload=rQ.onload),rQ.onerror&&(this.onerror=rQ.onerror),rQ.onCreate&&rQ.onCreate(this)),0!=rS.indexOf("data:image")&&(this._source.crossOrigin=""),rS&&(this._source.src=rS)},rQ.recreateResource=function(){var rS=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var rQ=this;this._source=new rf.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(rQ._needReleaseAgain)return rQ._needReleaseAgain=!1,rQ._source.onload=null,void(rQ._source=null);rQ._source.onload=null,rQ.memorySize=rS._w*rS._h*4,rQ._recreateLock=!1,rQ.completeCreate()},this._source.src=this._src}},rQ.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},rQ.onresize=function(){this._w=this._source.width,this._h=this._source.height},ro(0,rQ,"onload",null,function(rS){var rQ=this;this._onload=rS,this._source&&(this._source.onload=null!=this._onload?function(){rQ.onresize(),rQ._onload()}:null)}),ro(0,rQ,"onerror",null,function(rS){var rQ=this;this._onerror=rS,this._source&&(this._source.onerror=null!=this._onerror?function(){rQ._onerror()}:null)}),ro(0,rQ,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(rS){this._enableMerageInAtlas=rS,rm.isConchApp&&this._source&&(this._source.enableMerageInAtlas=rS)}),re.create=function(rS,rQ){return new re(rS,rQ)},re}(),rOS=(function(rd){function rS(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,rS.__super.call(this)}rj(rS,"laya.display.EffectAnimation",rd);var rQ=rS.prototype;rQ._onOtherBegin=function(rS){rS!=this&&this.stop()},rQ.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},rQ._onPlayAction=function(){this.play(0,!1)},rQ.play=function(rS,rQ,re,rl){void 0===rS&&(rS=0),void 0===rQ&&(rQ=!0),void 0===re&&(re=""),void 0===rl&&(rl=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,rS,rQ,re,rl))},rQ._recordInitData=function(){if(this._aniKeys){var rS,rQ,re=0;for(rS=this._aniKeys.length,re=0;re<rS;re++)rQ=this._aniKeys[re],this._initData[rQ]=this._target[rQ]}},rQ._displayToIndex=function(rS){if(this._animationData){rS<0&&(rS=0),rS>this._count&&(rS=this._count);var rQ=this._animationData.nodes,re=0,rl=rQ.length;for(rl=1<rl?1:rl,re=0;re<rl;re++)this._displayNodeToFrame(rQ[re],rS)}},rQ._displayNodeToFrame=function(rS,rQ,re){if(this._target){var rl;rl=this._target;var rM,rd,rT,rU,ri=rS.frames,rR=rS.keys,ro=0,rY=rR.length;rU=rS.secondFrames;var rp,rJ,rL,rj,rc=0;for(ro=0;ro<rY;ro++)rd=ri[rM=rR[ro]],rT=-1==(rc=rU[rM])?this._initData[rM]:rQ<rc?(rL=(rJ=rS.keyframes[rM])[0]).tween?(null==(rp=rF[rL.tweenMethod])&&(rp=rF.linearNone),rj=rJ[1],rp(rQ,this._initData[rM],rj.value-this._initData[rM],rj.index)):this._initData[rM]:rd.length>rQ?rd[rQ]:rd[rd.length-1],rl[rM]=rT}},rQ._calculateNodeKeyFrames=function(rS){rd.prototype._calculateNodeKeyFrames.call(this,rS);var rQ,re,rl,rM=rS.keyframes;rS.target;for(rQ in rl={},rS.secondFrames=rl,rM)(re=rM[rQ]).length<=1?rl[rQ]=-1:rl[rQ]=re[1].index},ro(0,rQ,"target",function(){return this._target},function(rS){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=rS,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),ro(0,rQ,"playEvent",null,function(rS){(this._playEvents=rS)&&this.addEvent()}),ro(0,rQ,"effectData",null,function(rS){var rQ;rS&&((rQ=rS.animations)&&rQ[0]&&(this._setUp({},rQ[0]),rQ[0].nodes&&rQ[0].nodes[0]&&(this._aniKeys=rQ[0].nodes[0].keys)))}),ro(0,rQ,"effectClass",null,function(rS){var rQ,re;(this._effectClass=rr.getClass(rS),this._effectClass)&&((rQ=this._effectClass.uiView)&&(re=rQ.animations)&&re[0]&&(this._setUp({},re[0]),re[0].nodes&&re[0].nodes[0]&&(this._aniKeys=re[0].nodes[0].keys)))}),rS.EffectAnimationBegin="effectanimationbegin"}(rvS),function(rQ){var rE;function rt(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,rt.__super.call(this)}rj(rt,"laya.utils.GraphicAnimation",rQ);var rS=rt.prototype;return rS._parseNodeList=function(rS){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[rS.compId]=rS.props,rS.compId&&this._nodeList.push(rS.compId);var rQ=rS.child;if(rQ){var re=0,rl=rQ.length;for(re=0;re<rl;re++)this._parseNodeList(rQ[re])}},rS._calGraphicData=function(rS){var rQ;if(this._setUp(null,rS),this._createGraphicData(),this._nodeIDAniDic)for(rQ in this._nodeIDAniDic)this._nodeIDAniDic[rQ]=null},rS._createGraphicData=function(){var rS,rQ=[],re=0,rl=this.count,rM=this._animationNewFrames;for(rM||(rM=[]),re=0;re<rl;re++)!rM[re]&&rS||(rS=this._createFrameGraphic(re)),rQ.push(rS);this._gList=rQ},rS._createFrameGraphic=function(rS){var rQ=rk.createGraphics();return rt._rootMatrix||(rt._rootMatrix=new rX),this._updateNodeGraphic(this._rootNode,rS,rt._rootMatrix,rQ),rQ},rS._updateNodeGraphic=function(rS,rQ,re,rl,rM){var rd;void 0===rM&&(rM=1);var rT,rU,ri,rR=(rd=this._nodeGDic[rS.compId]=this._getNodeGraphicData(rS.compId,rQ,this._nodeGDic[rS.compId])).alpha*rM;if(!(rR<.01)&&(rd.resultTransform||(rd.resultTransform=rX.create()),rT=rd.resultTransform,rX.mul(rd.transform,re,rT),rd.skin&&(rU=this._getTextureByUrl(rd.skin))&&(rT._checkTransform()?(rl.drawTexture(rU,0,0,rd.width,rd.height,rT,rR),rd.resultTransform=null):rl.drawTexture(rU,rT.tx,rT.ty,rd.width,rd.height,null,rR)),ri=rS.child)){var ro,rY=0;for(ro=ri.length,rY=0;rY<ro;rY++)this._updateNodeGraphic(ri[rY],rQ,rT,rl,rR)}},rS._updateNoChilds=function(rS,rQ){if(rS.skin){var re=this._getTextureByUrl(rS.skin);if(re){var rl=rS.transform;rl._checkTransform();!rl.bTransform?rQ.drawTexture(re,rl.tx,rl.ty,rS.width,rS.height,null,rS.alpha):rQ.drawTexture(re,0,0,rS.width,rS.height,rl.clone(),rS.alpha)}}},rS._updateNodeGraphic2=function(rS,rQ,re){var rl;if(rl=this._nodeGDic[rS.compId]=this._getNodeGraphicData(rS.compId,rQ,this._nodeGDic[rS.compId]),rS.child){var rM=rl.transform;rM._checkTransform();var rd,rT;rT=(rd=!rM.bTransform)&&(0!=rM.tx||0!=rM.ty);var rU,ri,rR;if((rU=rM.bTransform||1!=rl.alpha)&&re.save(),1!=rl.alpha&&re.alpha(rl.alpha),rd?rT&&re.translate(rM.tx,rM.ty):re.transform(rM.clone()),ri=rS.child,rl.skin&&(rR=this._getTextureByUrl(rl.skin))&&re.drawTexture(rR,0,0,rl.width,rl.height),ri){var ro,rY=0;for(ro=ri.length,rY=0;rY<ro;rY++)this._updateNodeGraphic2(ri[rY],rQ,re)}rU?re.restore():rd?rT&&re.translate(-rM.tx,-rM.ty):re.transform(rM.clone().invert())}else this._updateNoChilds(rl,re)},rS._calculateNodeKeyFrames=function(rS){rQ.prototype._calculateNodeKeyFrames.call(this,rS),this._nodeIDAniDic[rS.target]=rS},rS.getNodeDataByID=function(rS){return this._nodeIDAniDic[rS]},rS._getParams=function(rS,rQ,re,rl){var rM=rt._temParam;rM.length=rQ.length;var rd=0,rT=rQ.length;for(rd=0;rd<rT;rd++)rM[rd]=this._getObjVar(rS,rQ[rd][0],re,rQ[rd][1],rl);return rM},rS._getObjVar=function(rS,rQ,re,rl,rM){if(rS.hasOwnProperty(rQ)){var rd=rS[rQ];if(re>=rd.length&&(re=rd.length-1),null!=rS[rQ][re])return rS[rQ][re]}return rM.hasOwnProperty(rQ)?rM[rQ]:rl},rS._getNodeGraphicData=function(rS,rQ,re){re||(re=rE.create()),re.transform?re.transform.identity():re.transform=rX.create();var rl=this.getNodeDataByID(rS);if(!rl)return re;var rM,rd,rT=rl.frames,rU=this._getParams(rT,rt._drawTextureCmd,rQ,this._nodeDefaultProps[rS]),ri=rU[0],rR=NaN,ro=NaN,rY=rU[5],rp=rU[6],rJ=rU[13],rL=rU[14],rj=rU[7],rc=rU[8],rG=rU[9],rz=rU[11],rA=rU[12];rR=rU[3],ro=rU[4],0!=rR&&0!=ro||(ri=null),-1==rR&&(rR=0),-1==ro&&(ro=0),re.skin=ri,re.width=rR,re.height=ro,ri&&((rM=this._getTextureByUrl(ri))?(rR||(rR=rM.sourceWidth),ro||(ro=rM.sourceHeight)):console.warn("lost skin:",ri,",you may load pics first")),re.alpha=rU[10],rd=re.transform,0!=rJ&&(rY=rJ*rR),0!=rL&&(rp=rL*ro),0==rY&&0==rp||rd.translate(-rY,-rp);var rv=null;if(rG||1!==rj||1!==rc||rz||rA){(rv=rt._tempMt).identity(),rv.bTransform=!0;var rD=.0174532922222222*(rG-rz),rB=.0174532922222222*(rG+rA),rO=Math.cos(rB),rH=Math.sin(rB),rg=Math.sin(rD),rI=Math.cos(rD);rv.a=rj*rO,rv.b=rj*rH,rv.c=-rc*rg,rv.d=rc*rI,rv.tx=rv.ty=0}return rv&&(rd=rX.mul(rd,rv,rd)),rd.translate(rU[1],rU[2]),re},rS._getTextureByUrl=function(rS){return rUS.getRes(rS)},rS.setAniData=function(rS,rQ){if(rS.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=rS,this._parseNodeList(rS);var re,rl={},rM=[],rd=rS.animations,rT=0,rU=rd.length;for(rT=0;rT<rU;rT++)if(re=rd[rT],this._labels=null,(!rQ||rQ==re.name)&&re){try{this._calGraphicData(re)}catch(rS){console.warn("parse animation fail:"+re.name+",empty animation created"),this._gList=[]}var ri={};ri.interval=1e3/re.frameRate,ri.frames=this._gList,ri.labels=this._labels,ri.name=re.name,rM.push(ri),rl[re.name]=ri}this.animationList=rM,this.animationDic=rl}rt._temParam.length=0},rS.parseByData=function(rS){var rQ,re;rQ=rS.nodeRoot,re=rS.aniO,delete rS.nodeRoot,delete rS.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=rQ,this._parseNodeList(rQ),this._labels=null;try{this._calGraphicData(re)}catch(rS){console.warn("parse animation fail:"+re.name+",empty animation created"),this._gList=[]}var rl=rS;return rl.interval=1e3/re.frameRate,rl.frames=this._gList,rl.labels=this._labels,rl.name=re.name,rl},rS.setUpAniData=function(rS){if(rS.animations){var rQ,re={},rl=[],rM=rS.animations,rd=0,rT=rM.length;for(rd=0;rd<rT;rd++)if(rQ=rM[rd]){var rU={};rU.name=rQ.name,rU.aniO=rQ,rU.nodeRoot=rS,rl.push(rU),re[rQ.name]=rU}this.animationList=rl,this.animationDic=re}},rS._clear=function(){var rS,rQ;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(rS in this._nodeGDic)(rQ=this._nodeGDic[rS])&&rQ.recover();this._nodeGDic=null},rt.parseAnimationByData=function(rS){var rQ;return rt._I||(rt._I=new rt),rQ=rt._I.parseByData(rS),rt._I._clear(),rQ},rt.parseAnimationData=function(rS){var rQ;return rt._I||(rt._I=new rt),rt._I.setUpAniData(rS),(rQ={}).animationList=rt._I.animationList,rQ.animationDic=rt._I.animationDic,rt._I._clear(),rQ},rt._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],rt._temParam=[],rt._I=null,rt._rootMatrix=null,ri(rt,["_tempMt",function(){return this._tempMt=new rX}]),rt.__init$=function(){rE=function(){function rS(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return rj(rS,""),rS.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),rZ.recover("GraphicNode",this)},rS.create=function(){return rZ.getItemByClass("GraphicNode",rS)},rS}()},rt}(rvS));rO.__init([rR,riS,rm,rf,rC,rI,rS,rOS])}(window,document,Laya),function(rS,rQ,re){re.un,re.uns,re.static;var rl=re.class;re.getset,re.__newvec;new(function(){function rS(){}return rl(rS,"LayaMain"),rS}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}}),function(rS,rQ,rB){rB.un,rB.uns;var rT=rB.static,rp=rB.class,rl=rB.getset,rd=rB.__newvec,ro=laya.maths.Arith,rY=laya.maths.Bezier,re=laya.resource.Bitmap,rJ=laya.utils.Browser,ri=laya.utils.Byte,rL=laya.utils.Color,rO=(laya.filters.ColorFilter,rB.Config),rM=laya.resource.Context,rH=(laya.events.Event,laya.filters.Filter),rU=laya.display.Graphics,rR=laya.resource.HTMLCanvas,rj=(laya.utils.HTMLChar,laya.resource.HTMLImage),rc=laya.resource.HTMLSubImage,rg=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),rI=laya.maths.Point,rE=laya.maths.Rectangle,rG=laya.renders.Render,rz=(laya.renders.RenderContext,laya.renders.RenderSprite),rA=laya.resource.Resource,rv=laya.resource.ResourceManager,rD=laya.utils.RunDriver,rt=laya.display.Sprite,rk=laya.display.Stage,rX=laya.utils.Stat,rh=laya.utils.StringKey,rb=(laya.display.css.Style,laya.system.System),rm=laya.display.Text,r$=laya.resource.Texture,rn=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),rP=laya.utils.VectorGraphManager;laya.utils.WordText;rB.interface("laya.webgl.shapes.IShape"),rB.interface("laya.webgl.submit.ISubmit"),rB.interface("laya.webgl.text.ICharSegment"),rB.interface("laya.webgl.canvas.save.ISaveData"),rB.interface("laya.webgl.resource.IMergeAtlasBitmap"),rB.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var ra=function(){function rS(){}rp(rS,"laya.filters.webgl.FilterActionGL");var rQ=rS.prototype;return rB.imps(rQ,{"laya.filters.IFilterActionGL":!0}),rQ.setValue=function(rS){},rQ.setValueMix=function(rS){},rQ.apply3d=function(rS,rQ,re,rl,rM){return null},rQ.apply=function(rS){return null},rl(0,rQ,"typeMix",function(){return 0}),rS}(),rf=function(){function rS(){}return rp(rS,"laya.webgl.shader.ShaderValue"),rS}(),rw=function(){var rl,rM;function rS(rS,rQ,re){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new rM,void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),this._cells=null,this._rowInfo=null,this._init(rS,rQ),this._atlasID=re}rp(rS,"laya.webgl.atlas.AtlasGrid");var rQ=rS.prototype;return rQ.getAltasID=function(){return this._atlasID},rQ.setAltasID=function(rS){0<=rS&&(this._atlasID=rS)},rQ.addTex=function(rS,rQ,re){var rl=this._get(rQ,re);return 0==rl.ret||(this._fill(rl.x,rl.y,rQ,re,rS),this._texCount++),rl},rQ._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},rQ._init=function(rS,rQ){if(this._width=rS,this._height=rQ,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=rd(this._height);for(var re=0;re<this._height;re++)this._rowInfo[re]=new rl;return this._clear(),!0},rQ._get=function(rS,rQ){var re=new rr;if(rS>=this._failSize.width&&rQ>=this._failSize.height)return re;for(var rl=-1,rM=-1,rd=this._width,rT=this._height,rU=this._cells,ri=0;ri<rT;ri++)if(!(this._rowInfo[ri].spaceCount<rS))for(var rR=0;rR<rd;){var ro=3*(ri*rd+rR);if(0!=rU[ro]||rU[1+ro]<rS||rU[2+ro]<rQ)rR+=rU[1+ro];else{rl=rR,rM=ri;for(var rY=0;rY<rS;rY++)if(rU[3*rY+ro+2]<rQ){rl=-1;break}if(!(rl<0))return re.ret=!0,re.x=rl,re.y=rM,re;rR+=rU[1+ro]}}return re},rQ._fill=function(rS,rQ,re,rl,rM){var rd=this._width,rT=this._height;this._check(rS+re<=rd&&rQ+rl<=rT);for(var rU=rQ;rU<rl+rQ;++rU){this._check(this._rowInfo[rU].spaceCount>=re),this._rowInfo[rU].spaceCount-=re;for(var ri=0;ri<re;ri++){var rR=3*(rS+rU*rd+ri);this._check(0==this._cells[rR]),this._cells[rR]=rM,this._cells[1+rR]=re,this._cells[2+rR]=rl}}if(0<rS)for(rU=0;rU<rl;++rU){var ro=0;for(ri=rS-1;0<=ri&&0==this._cells[3*((rQ+rU)*rd+ri)];--ri,++ro);for(ri=ro;0<ri;--ri)this._cells[3*((rQ+rU)*rd+rS-ri)+1]=ri,this._check(0<ri)}if(0<rQ)for(ri=rS;ri<rS+re;++ri){for(ro=0,rU=rQ-1;0<=rU&&0==this._cells[3*(ri+rU*rd)];--rU,ro++);for(rU=ro;0<rU;--rU)this._cells[3*(ri+(rQ-rU)*rd)+2]=rU,this._check(0<rU)}},rQ._check=function(rS){0==rS&&console.log("xtexMerger 错误啦")},rQ._clear=function(){for(var rS=this._texCount=0;rS<this._height;rS++)this._rowInfo[rS].spaceCount=this._width;for(var rQ=0;rQ<this._height;rQ++)for(var re=0;re<this._width;re++){var rl=3*(rQ*this._width+re);this._cells[rl]=0,this._cells[1+rl]=this._width-re,this._cells[2+rl]=this._width-rQ}this._failSize.width=this._width+1,this._failSize.height=this._height+1},rS.__init$=function(){rl=function(){function rS(){this.spaceCount=0}return rp(rS,""),rS}(),rM=function(){function rS(){this.width=0,this.height=0}return rp(rS,""),rS}()},rS}(),ru=function(){function rG(rS,rQ,re,rl){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=rS,this._height=rQ,this._gridSize=re,this._maxAtlaserCount=rl,this._gridNumX=rS/re,this._gridNumY=rQ/re,this._curAtlasIndex=0,this._atlaserArray=[]}rp(rG,"laya.webgl.atlas.AtlasResourceManager");var rS=rG.prototype;return rS.setAtlasParam=function(rS,rQ,re,rl){if(1==this._setAtlasParam)return rG._sid_=0,this._width=rS,this._height=rQ,this._gridSize=re,this._maxAtlaserCount=rl,this._gridNumX=rS/re,this._gridNumY=rQ/re,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},rS.pushData=function(rS){var rQ,re=rS.bitmap,rl=-1,rM=null,rd=0,rT=0;for(rd=0,rQ=this._atlaserArray.length;rd<rQ&&(rT=(this._curAtlasIndex+rd)%rQ,-1==(rl=(rM=this._atlaserArray[rT]).findBitmapIsExist(re)));rd++);if(-1!=rl){var rU=rM.InAtlasWebGLImagesOffsetValue[rl];return rL=rU[0],rj=rU[1],rM.addToAtlas(rS,rL,rj),!0}this._setAtlasParam=!1;for(var ri=Math.ceil((rS.bitmap.width+2)/this._gridSize),rR=Math.ceil((rS.bitmap.height+2)/this._gridSize),ro=!1,rY=0;rY<2;rY++){var rp=this._maxAtlaserCount;for(rd=0;rd<rp;rd++){rT=(this._curAtlasIndex+rd)%rp,this._atlaserArray.length-1>=rT||this._atlaserArray.push(new rES(this._gridNumX,this._gridNumY,this._width,this._height,rG._sid_++));var rJ=this._atlaserArray[rT],rL=0,rj=0,rc=rJ.addTex(1,ri,rR);if(rc.ret){rL=rc.x*this._gridSize+1,rj=rc.y*this._gridSize+1,re.lock=!0,rJ.addToAtlasTexture(re,rL,rj),rJ.addToAtlas(rS,rL,rj),ro=!0,this._curAtlasIndex=rT;break}}if(ro)break;this._atlaserArray.push(new rES(this._gridNumX,this._gridNumY,this._width,this._height,rG._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return ro||console.log(">>>AtlasManager pushData error"),ro},rS.addToAtlas=function(rS){laya.webgl.atlas.AtlasResourceManager.instance.pushData(rS)},rS.garbageCollection=function(){if(!0===this._needGC){for(var rS=this._atlaserArray.length-this._maxAtlaserCount,rQ=0;rQ<rS;rQ++)this._atlaserArray[rQ].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+rS),this._atlaserArray.splice(0,rS),this._needGC=!1}return!0},rS.freeAll=function(){for(var rS=0,rQ=this._atlaserArray.length;rS<rQ;rS++)this._atlaserArray[rS].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},rS.getAtlaserCount=function(){return this._atlaserArray.length},rS.getAtlaserByIndex=function(rS){return this._atlaserArray[rS]},rl(1,rG,"instance",function(){return rG._Instance||(rG._Instance=new rG(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),rG._Instance}),rl(1,rG,"enabled",function(){return rO.atlasEnable}),rl(1,rG,"atlasLimitWidth",function(){return rG._atlasLimitWidth},function(rS){rG._atlasLimitWidth=rS}),rl(1,rG,"atlasLimitHeight",function(){return rG._atlasLimitHeight},function(rS){rG._atlasLimitHeight=rS}),rG._enable=function(){rO.atlasEnable=!0},rG._disable=function(){rO.atlasEnable=!1},rG.__init__=function(){rG.atlasTextureWidth=2048,rG.atlasTextureHeight=2048,rG.maxTextureCount=6,rG.atlasLimitWidth=512,rG.atlasLimitHeight=512},rG._atlasLimitWidth=0,rG._atlasLimitHeight=0,rG.gridSize=16,rG.atlasTextureWidth=0,rG.atlasTextureHeight=0,rG.maxTextureCount=0,rG._atlasRestore=0,rG.BOARDER_TYPE_NO=0,rG.BOARDER_TYPE_RIGHT=1,rG.BOARDER_TYPE_LEFT=2,rG.BOARDER_TYPE_BOTTOM=4,rG.BOARDER_TYPE_TOP=8,rG.BOARDER_TYPE_ALL=15,rG._sid_=0,rG._Instance=null,rG}(),rr=function(){function rS(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return rp(rS,"laya.webgl.atlas.MergeFillInfo"),rS}(),rW=function(){function rQ(){}return rp(rQ,"laya.webgl.canvas.BlendMode"),rQ._init_=function(rS){rQ.fns=[rQ.BlendNormal,rQ.BlendAdd,rQ.BlendMultiply,rQ.BlendScreen,rQ.BlendOverlay,rQ.BlendLight,rQ.BlendMask,rQ.BlendDestinationOut],rQ.targetFns=[rQ.BlendNormalTarget,rQ.BlendAddTarget,rQ.BlendMultiplyTarget,rQ.BlendScreenTarget,rQ.BlendOverlayTarget,rQ.BlendLightTarget,rQ.BlendMask,rQ.BlendDestinationOut]},rQ.BlendNormal=function(rS){rS.blendFunc(1,771)},rQ.BlendAdd=function(rS){rS.blendFunc(1,772)},rQ.BlendMultiply=function(rS){rS.blendFunc(774,771)},rQ.BlendScreen=function(rS){rS.blendFunc(1,1)},rQ.BlendOverlay=function(rS){rS.blendFunc(1,769)},rQ.BlendLight=function(rS){rS.blendFunc(1,1)},rQ.BlendNormalTarget=function(rS){rS.blendFunc(1,771)},rQ.BlendAddTarget=function(rS){rS.blendFunc(1,772)},rQ.BlendMultiplyTarget=function(rS){rS.blendFunc(774,771)},rQ.BlendScreenTarget=function(rS){rS.blendFunc(1,1)},rQ.BlendOverlayTarget=function(rS){rS.blendFunc(1,769)},rQ.BlendLightTarget=function(rS){rS.blendFunc(1,1)},rQ.BlendMask=function(rS){rS.blendFunc(0,770)},rQ.BlendDestinationOut=function(rS){rS.blendFunc(0,0)},rQ.activeBlendFunction=null,rQ.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],rQ.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},rQ.NORMAL="normal",rQ.ADD="add",rQ.MULTIPLY="multiply",rQ.SCREEN="screen",rQ.LIGHT="light",rQ.OVERLAY="overlay",rQ.DESTINATIONOUT="destination-out",rQ.fns=[],rQ.targetFns=[],rQ}(),rx=function(){function re(rS){this._color=rL.create("black"),this.setValue(rS)}rp(re,"laya.webgl.canvas.DrawStyle");var rS=re.prototype;return rS.setValue=function(rS){if(rS){if("string"==typeof rS)return void(this._color=rL.create(rS));if(rS instanceof laya.utils.Color)return void(this._color=rS)}},rS.reset=function(){this._color=rL.create("black")},rS.equal=function(rS){return"string"==typeof rS?this._color.strColor===rS:rS instanceof laya.utils.Color&&this._color.numColor===rS.numColor},rS.toColorStr=function(){return this._color.strColor},re.create=function(rS){var rQ;if(rS&&("string"==typeof rS?rQ=rL.create(rS):rS instanceof laya.utils.Color&&(rQ=rS),rQ))return rQ._drawStyle||(rQ._drawStyle=new re(rS));return laya.webgl.canvas.DrawStyle.DEFAULT},rT(re,["DEFAULT",function(){return this.DEFAULT=new re("#000000")}]),re}(),rF=function(){function rS(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];rvS.mainContext;this.ib=rsS.create(35048),this.vb=ryS.create(5)}rp(rS,"laya.webgl.canvas.Path");var rQ=rS.prototype;return rQ.addPoint=function(rS,rQ){this.tempArray.push(rS,rQ)},rQ.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},rQ.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},rQ.polygon=function(rS,rQ,re,rl,rM,rd){var rT;return this.geomatrys.push(this._curGeomatry=rT=new rhS(rS,rQ,re,rl,rM,rd)),rl||(rT.fill=!1),null==rd&&(rT.borderWidth=0),rT},rQ.setGeomtry=function(rS){this.geomatrys.push(this._curGeomatry=rS)},rQ.drawLine=function(rS,rQ,re,rl,rM){var rd;return this.closePath?this.geomatrys.push(this._curGeomatry=rd=new rXS(rS,rQ,re,rl,rM)):this.geomatrys.push(this._curGeomatry=rd=new rkS(rS,rQ,re,rl,rM)),rd.fill=!1,rd},rQ.update=function(){var rS=this.ib._byteLength,rQ=this.geomatrys.length;this.offset=rS;for(var re=this.geoStart;re<rQ;re++)this.geomatrys[re].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=rQ,this.count=(this.ib._byteLength-rS)/rjS.BYTES_PIDX},rQ.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},rQ.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},rS}(),rq=function(){function rU(){}rp(rU,"laya.webgl.canvas.save.SaveBase");var rS=rU.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!1},rS.restore=function(rS){this._dataObj[this._valueName]=this._value,(rU._cache[rU._cache._length++]=this)._newSubmit&&(rS._curSubmit=rdS.RENDERBASE,rS._renderKey=0)},rU._createArray=function(){var rS=[];return rS._length=0,rS},rU._init=function(){var rS=rU._namemap={};return rS[1]="ALPHA",rS[2]="fillStyle",rS[8]="font",rS[256]="lineWidth",rS[512]="strokeStyle",rS[8192]="_mergeID",rS[1024]=rS[2048]=rS[4096]=[],rS[16384]="textBaseline",rS[32768]="textAlign",rS[65536]="_nBlendType",rS[1048576]="shader",rS[2097152]="filters",rS},rU.save=function(rS,rQ,re,rl){if((rS._saveMark._saveuse&rQ)!==rQ){rS._saveMark._saveuse|=rQ;var rM=rU._cache,rd=0<rM._length?rM[--rM._length]:new rU;rd._value=re[rd._valueName=rU._namemap[rQ]],rd._dataObj=re,rd._newSubmit=rl;var rT=rS._save;rT[rT._length++]=rd}},rU._cache=laya.webgl.canvas.save.SaveBase._createArray(),rU._namemap=rU._init(),rU}(),rZ=function(){function rd(){this._clipRect=new rE}rp(rd,"laya.webgl.canvas.save.SaveClipRect");var rS=rd.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!1},rS.restore=function(rS){rS._clipRect=this._clipSaveRect,(rd._cache[rd._cache._length++]=this)._submitScissor.submitLength=rS._submits._length-this._submitScissor.submitIndex,rS._curSubmit=rdS.RENDERBASE,rS._renderKey=0},rd.save=function(rS,rQ){if(131072!=(131072&rS._saveMark._saveuse)){rS._saveMark._saveuse|=131072;var re=rd._cache,rl=0<re._length?re[--re._length]:new rd;rl._clipSaveRect=rS._clipRect,rS._clipRect=rl._clipRect.copyFrom(rS._clipRect),rl._submitScissor=rQ;var rM=rS._save;rM[rM._length++]=rl}},rT(rd,["_cache",function(){return this._cache=rq._createArray()}]),rd}(),rN=function(){function rJ(){this._contextX=0,this._contextY=0,this._clipRect=new rE,this._rect=new rE,this._matrix=new rg}rp(rJ,"laya.webgl.canvas.save.SaveClipRectStencil");var rS=rJ.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!1},rS.restore=function(rS){roS.restore(rS,this._rect,this._saveMatrix,this._contextX,this._contextY),rS._clipRect=this._clipSaveRect,rS._curMat=this._saveMatrix,rS._x=this._contextX,rS._y=this._contextY,rJ._cache[rJ._cache._length++]=this,rS._curSubmit=rdS.RENDERBASE},rJ.save=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){if(262144!=(262144&rS._saveMark._saveuse)){rS._saveMark._saveuse|=262144;var ro=rJ._cache,rY=0<ro._length?ro[--ro._length]:new rJ;rY._clipSaveRect=rS._clipRect,rY._clipRect.setTo(rT,rU,ri,rR),rS._clipRect=rY._clipRect,rY._rect.x=re,rY._rect.y=rl,rY._rect.width=rM,rY._rect.height=rd,rY._contextX=rS._x,rY._contextY=rS._y,rY._saveMatrix=rS._curMat,rS._curMat.copyTo(rY._matrix),rS._curMat=rY._matrix,rY._submitStencil=rQ;var rp=rS._save;rp[rp._length++]=rY}},rT(rJ,["_cache",function(){return this._cache=rq._createArray()}]),rJ}(),rC=function(){function rl(){this._saveuse=0}rp(rl,"laya.webgl.canvas.save.SaveMark");var rS=rl.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!0},rS.restore=function(rS){rS._saveMark=this._preSaveMark,rl._no[rl._no._length++]=this},rl.Create=function(rS){var rQ=rl._no,re=0<rQ._length?rQ[--rQ._length]:new rl;return re._saveuse=0,re._preSaveMark=rS._saveMark,rS._saveMark=re},rT(rl,["_no",function(){return this._no=rq._createArray()}]),rl}(),rK=function(){function rd(){this._matrix=new rg}rp(rd,"laya.webgl.canvas.save.SaveTransform");var rS=rd.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!1},rS.restore=function(rS){rS._curMat=this._savematrix,rd._no[rd._no._length++]=this},rd.save=function(rS){var rQ=rS._saveMark;if(2048!=(2048&rQ._saveuse)){rQ._saveuse|=2048;var re=rd._no,rl=0<re._length?re[--re._length]:new rd;rl._savematrix=rS._curMat,rS._curMat=rS._curMat.copyTo(rl._matrix);var rM=rS._save;rM[rM._length++]=rl}},rT(rd,["_no",function(){return this._no=rq._createArray()}]),rd}(),rV=function(){function rM(){}rp(rM,"laya.webgl.canvas.save.SaveTranslate");var rS=rM.prototype;return rB.imps(rS,{"laya.webgl.canvas.save.ISaveData":!0}),rS.isSaveMark=function(){return!1},rS.restore=function(rS){rS._curMat;rS._x=this._x,rS._y=this._y,rM._no[rM._no._length++]=this},rM.save=function(rS){var rQ=rM._no,re=0<rQ._length?rQ[--rQ._length]:new rM;re._x=rS._x,re._y=rS._y;var rl=rS._save;rl[rl._length++]=re},rT(rM,["_no",function(){return this._no=rq._createArray()}]),rM}(),r_=function(){function rS(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new rE}rp(rS,"laya.webgl.resource.RenderTargetMAX");var rQ=rS.prototype;return rQ.setSP=function(rS){this._sp=rS},rQ.size=function(rS,rQ){var re=this;this._width!==rS||this._height!==rQ?(this.repaint=!0,this._width=rS,this._height=rQ,this.target?this.target.size(rS,rQ):this.target=rPS.create(rS,rQ),this.target.hasListener("recovered")||this.target.on("recovered",this,function(rS){rB.timer.callLater(re._sp,re._sp.repaint)})):this.target.size(rS,rQ)},rQ._flushToTarget=function(rS,rQ){if(!rQ._destroy){var re=rzS.worldScissorTest,rl=rzS.worldClipRect;rzS.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,rzS.worldScissorTest=!1,rvS.mainContext.disable(3089);var rM=rzS.worldAlpha,rd=rzS.worldMatrix4,rT=rzS.worldMatrix,rU=rzS.worldFilters,ri=rzS.worldShaderDefines;if(rzS.worldMatrix=rg.EMPTY,rzS.restoreTempArray(),rzS.worldMatrix4=rzS.TEMPMAT4_ARRAY,rzS.worldAlpha=1,rzS.worldFilters=null,rzS.worldShaderDefines=null,rnS.activeShader=null,rQ.start(),rO.showCanvasMark?rQ.clear(0,1,0,.3):rQ.clear(0,0,0,0),rS.flush(),rQ.end(),rnS.activeShader=null,rzS.worldAlpha=rM,rzS.worldMatrix4=rd,rzS.worldMatrix=rT,rzS.worldFilters=rU,rzS.worldShaderDefines=ri,rzS.worldScissorTest=re){var rR=rzS.height-rl.y-rl.height;rvS.mainContext.scissor(rl.x,rR,rl.width,rl.height),rvS.mainContext.enable(3089)}rzS.worldClipRect=rl}},rQ.flush=function(rS){this.repaint&&(this._flushToTarget(rS,this.target),this.repaint=!1)},rQ.drawTo=function(rS,rQ,re,rl,rM){rS.drawTexture(this.target.getTexture(),rQ,re,rl,rM,0,0)},rQ.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},rS}(),rs=function(){function rS(){this.ALPHA=1,this.shaderType=0,this.defines=new rtS}return rp(rS,"laya.webgl.shader.d2.Shader2D"),rS.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},rS.__init__=function(){var rS,rQ;rCS.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),rCS.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),rCS.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),rCS.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),rCS.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),rCS.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),rCS.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),rCS.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),rS="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",rQ='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',rCS.preCompile2D(0,1,rS,rQ,null),rS="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",rQ='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',rCS.preCompile2D(0,2,rS,rQ,null),rS="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",rQ="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",rCS.preCompile2D(0,4,rS,rQ,null),rS="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",rQ='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',rCS.preCompile2D(0,256,rS,rQ,null),rS="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",rQ="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",rCS.preCompile2D(0,512,rS,rQ,null)},rS}(),ry=function(){function rQ(rS,rQ,re){this._value=0,this._name2int=rS,this._int2name=rQ,this._int2nameMap=re}rp(rQ,"laya.webgl.shader.ShaderDefines");var rS=rQ.prototype;return rS.add=function(rS){return"string"==typeof rS&&(rS=this._name2int[rS]),this._value|=rS,this._value},rS.addInt=function(rS){return this._value|=rS,this._value},rS.remove=function(rS){return"string"==typeof rS&&(rS=this._name2int[rS]),this._value&=~rS,this._value},rS.isDefine=function(rS){return(this._value&rS)===rS},rS.getValue=function(){return this._value},rS.setValue=function(rS){this._value=rS},rS.toNameDic=function(){var rS=this._int2nameMap[this._value];return rS||rQ._toText(this._value,this._int2name,this._int2nameMap)},rQ._reg=function(rS,rQ,re,rl){rl[re[rS]=rQ]=rS},rQ._toText=function(rS,rQ,re){var rl=re[rS];if(rl)return rl;for(var rM={},rd=1,rT=0;rT<32&&!(rS<(rd=1<<rT));rT++)if(rS&rd){var rU=rQ[rd];rU&&(rM[rU]="")}return re[rS]=rM},rQ._toInt=function(rS,rQ){for(var re=rS.split("."),rl=0,rM=0,rd=re.length;rM<rd;rM++){var rT=rQ[re[rM]];if(!rT)throw new Error("Defines to int err:"+rS+"/"+re[rM]);rl|=rT}return rl},rQ}(),rSS=function(){function rT(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new rg}rp(rT,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var rS=rT.prototype;return rS.init=function(rS,rQ,re){if(rQ)this._vs=rQ;else{this._vs=[];var rl=rS.width,rM=rS.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(rl,0,1,0,1,1,1,1),this._vs.push(rl,rM,1,1,1,1,1,1),this._vs.push(0,rM,0,1,1,1,1,1)}re?this._ps=re:(rT._defaultPS||(rT._defaultPS=[]).push(0,1,3,3,1,2),this._ps=rT._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=rS},rS.init2=function(rS,rQ,re,rl,rM){this.transform&&(this.transform=null),re?this._ps=re:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=rl,this._uvs=rM,this.mEleNum=this._ps.length,this.mTexture=rS,(rG.isConchNode||rG.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},rS._initMyData=function(){var rS=0,rQ=0,re=4*this._verticles.length;this._vs=rT._tempVS;var rl=!1;if(rG.isConchNode||rG.isConchApp?(this._vs.length=re,rl=!0):this._vs.length<re&&(this._vs.length=re,rl=!0),rT._tVSLen=re,rl)for(;rS<re;)this._vs[rS]=this._verticles[rQ],this._vs[rS+1]=this._verticles[rQ+1],this._vs[rS+2]=this._uvs[rQ],this._vs[rS+3]=this._uvs[rQ+1],this._vs[rS+4]=1,this._vs[rS+5]=1,this._vs[rS+6]=1,this._vs[rS+7]=1,rS+=8,rQ+=2;else for(;rS<re;)this._vs[rS]=this._verticles[rQ],this._vs[rS+1]=this._verticles[rQ+1],this._vs[rS+2]=this._uvs[rQ],this._vs[rS+3]=this._uvs[rQ+1],rS+=8,rQ+=2},rS.getData2=function(rS,rQ,re){var rl;this.mVBBuffer=rS,this.mIBBuffer=rQ,this._initMyData(),rS.appendEx2(this._vs,Float32Array,rT._tVSLen,4),this._indexStart=rQ._byteLength,(rl=rT._tempIB).length<this._ps.length&&(rl.length=this._ps.length);for(var rM=0,rd=this._ps.length;rM<rd;rM++)rl[rM]=this._ps[rM]+re;rQ.appendEx2(rl,Uint16Array,this._ps.length,2)},rS.getData=function(rS,rQ,re){if(this.mVBBuffer=rS,this.mIBBuffer=rQ,rS.append(this.mVBData),this._indexStart=rQ._byteLength,this.mIBData.start!=re){for(var rl=0,rM=this._ps.length;rl<rM;rl++)this.mIBData[rl]=this._ps[rl]+re;this.mIBData.start=re}rQ.append(this.mIBData)},rS.render=function(rS,rQ,re){if(rG.isWebGL&&this.mTexture){rS._renderKey=0,rS._shader2D.glTexture=null,rQS.getInstance().addSkinMesh(this);var rl=rdS.createShape(rS,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,rHS.create(512,0));this.transform||(this.transform=rg.EMPTY),this.transform.translate(rQ,re),rg.mul(this.transform,rS._curMat,this._tempMatrix),this.transform.translate(-rQ,-re);var rM=rl.shaderValue,rd=rM.u_mmat2||rzS.getMatrArray();rzS.mat2MatArray(this._tempMatrix,rd),rM.textureHost=this.mTexture,rM.offsetX=0,rM.offsetY=0,rM.u_mmat2=rd,rM.ALPHA=rS._shader2D.ALPHA,rS._submits[rS._submits._length++]=rl}else rG.isConchApp&&this.mTexture&&(this.transform||(this.transform=rg.EMPTY),rS.setSkinMesh&&rS.setSkinMesh(rQ,re,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},rT._tempVS=[],rT._tempIB=[],rT._defaultPS=null,rT._tVSLen=0,rT}(),rQS=function(){function rS(){this.ib=null,this.vb=null;rvS.mainContext;this.ib=rsS.create(35048),this.vb=ryS.create(8)}rp(rS,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var rQ=rS.prototype;return rQ.addSkinMesh=function(rS){rS.getData2(this.vb,this.ib,this.vb._byteLength/32)},rQ.reset=function(){this.vb.clear(),this.ib.clear()},rS.getInstance=function(){return rS.instance=rS.instance||new rS},rS.instance=null,rS}(),reS=function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU,ri){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===ri&&(ri=0),this.x=rS,this.y=rQ,this.width=re,this.height=rl,this.edges=rM,this.color=rd,this.borderWidth=rT,this.borderColor=rU}rp(rS,"laya.webgl.shapes.BasePoly");var rQ=rS.prototype;return rB.imps(rQ,{"laya.webgl.shapes.IShape":!0}),rQ.getData=function(rS,rQ,re){},rQ.rebuild=function(rS){},rQ.setMatrix=function(rS){},rQ.needUpdate=function(rS){return!0},rQ.sector=function(rS,rQ,re){var rl=this.x,rM=this.y,rd=this.edges,rT=(this.r1-this.r0)/rd,rU=this.width,ri=this.height,rR=this.color,ro=(rR>>16&255)/255,rY=(rR>>8&255)/255,rp=(255&rR)/255;rS.push(rl,rM,ro,rY,rp);for(var rJ=0;rJ<rd+1;rJ++)rS.push(rl+Math.sin(rT*rJ+this.r0)*rU,rM+Math.cos(rT*rJ+this.r0)*ri),rS.push(ro,rY,rp);for(rJ=0;rJ<rd;rJ++)rQ.push(re,re+rJ+1,re+rJ+2)},rQ.createLine2=function(rS,rQ,re,rl,rM,rd){var rT,rU,ri,rR,ro,rY,rp,rJ,rL,rj,rc,rG,rz,rA,rv,rD,rB,rO,rH,rg,rI=rS.concat(),rE=rM,rt=this.borderColor,rk=(rt>>16&255)/255,rX=(rt>>8&255)/255,rh=(255&rt)/255,rb=rI.length/2,rm=rl,r$=re/2;ri=rI[0],rR=rI[1],rj=ri-(ro=rI[2]),rL=(rL=-(rR-(rY=rI[3])))/(rg=Math.sqrt(rL*rL+rj*rj))*r$,rj=rj/rg*r$,rE.push(ri-rL+this.x,rR-rj+this.y,rk,rX,rh,ri+rL+this.x,rR+rj+this.y,rk,rX,rh);for(var rn=1;rn<rb-1;rn++)ri=rI[2*(rn-1)],rR=rI[2*(rn-1)+1],ro=rI[2*rn],rY=rI[2*rn+1],rp=rI[2*(rn+1)],rJ=rI[2*(rn+1)+1],rj=ri-ro,rG=ro-rp,rv=(-(rL=(rL=-(rR-rY))/(rg=Math.sqrt(rL*rL+rj*rj))*r$)+ri)*(-(rj=rj/rg*r$)+rY)-(-rL+ro)*(-rj+rR),rO=(-(rc=(rc=-(rY-rJ))/(rg=Math.sqrt(rc*rc+rG*rG))*r$)+rp)*(-(rG=rG/rg*r$)+rY)-(-rc+ro)*(-rG+rJ),rH=(rz=-rj+rR-(-rj+rY))*(rB=-rc+ro-(-rc+rp))-(rD=-rG+rJ-(-rG+rY))*(rA=-rL+ro-(-rL+ri)),Math.abs(rH)<.1?(rH+=10.1,rE.push(ro-rL+this.x,rY-rj+this.y,rk,rX,rh,ro+rL+this.x,rY+rj+this.y,rk,rX,rh)):(((rT=(rA*rO-rB*rv)/rH)-ro)*(rT-ro)+((rU=(rD*rv-rz*rO)/rH)-rY)+(rU-rY),rE.push(rT+this.x,rU+this.y,rk,rX,rh,ro-(rT-ro)+this.x,rY-(rU-rY)+this.y,rk,rX,rh));ri=rI[rI.length-4],rR=rI[rI.length-3],rj=ri-(ro=rI[rI.length-2]),rL=(rL=-(rR-(rY=rI[rI.length-1])))/(rg=Math.sqrt(rL*rL+rj*rj))*r$,rj=rj/rg*r$,rE.push(ro-rL+this.x,rY-rj+this.y,rk,rX,rh,ro+rL+this.x,rY+rj+this.y,rk,rX,rh);var rP=rd;for(rn=1;rn<rP;rn++)rQ.push(rm+2*(rn-1),rm+2*(rn-1)+1,rm+2*rn+1,rm+2*rn+1,rm+2*rn,rm+2*(rn-1));return rE},rQ.createLine=function(rS,rQ,re,rl){var rM=rS.concat(),rd=rS,rT=this.borderColor,rU=(rT>>16&255)/255,ri=(rT>>8&255)/255,rR=(255&rT)/255;rM.splice(0,5);var ro,rY,rp,rJ,rL,rj,rc,rG,rz,rA,rv,rD,rB,rO,rH,rg,rI,rE,rt,rk,rX=rM.length/5,rh=rl,rb=re/2;rp=rM[0],rJ=rM[1],rA=rp-(rL=rM[5]),rz=(rz=-(rJ-(rj=rM[6])))/(rk=Math.sqrt(rz*rz+rA*rA))*rb,rA=rA/rk*rb,rd.push(rp-rz,rJ-rA,rU,ri,rR,rp+rz,rJ+rA,rU,ri,rR);for(var rm=1;rm<rX-1;rm++)rp=rM[5*(rm-1)],rJ=rM[5*(rm-1)+1],rL=rM[5*rm],rj=rM[5*rm+1],rc=rM[5*(rm+1)],rG=rM[5*(rm+1)+1],rA=rp-rL,rD=rL-rc,rH=(-(rz=(rz=-(rJ-rj))/(rk=Math.sqrt(rz*rz+rA*rA))*rb)+rp)*(-(rA=rA/rk*rb)+rj)-(-rz+rL)*(-rA+rJ),rE=(-(rv=(rv=-(rj-rG))/(rk=Math.sqrt(rv*rv+rD*rD))*rb)+rc)*(-(rD=rD/rk*rb)+rj)-(-rv+rL)*(-rD+rG),rt=(rB=-rA+rJ-(-rA+rj))*(rI=-rv+rL-(-rv+rc))-(rg=-rD+rG-(-rD+rj))*(rO=-rz+rL-(-rz+rp)),Math.abs(rt)<.1?(rt+=10.1,rd.push(rL-rz,rj-rA,rU,ri,rR,rL+rz,rj+rA,rU,ri,rR)):(((ro=(rO*rE-rI*rH)/rt)-rL)*(ro-rL)+((rY=(rg*rH-rB*rE)/rt)-rj)+(rY-rj),rd.push(ro,rY,rU,ri,rR,rL-(ro-rL),rj-(rY-rj),rU,ri,rR));rp=rM[rM.length-10],rJ=rM[rM.length-9],rA=rp-(rL=rM[rM.length-5]),rz=(rz=-(rJ-(rj=rM[rM.length-4])))/(rk=Math.sqrt(rz*rz+rA*rA))*rb,rA=rA/rk*rb,rd.push(rL-rz,rj-rA,rU,ri,rR,rL+rz,rj+rA,rU,ri,rR);var r$=this.edges+1;for(rm=1;rm<r$;rm++)rQ.push(rh+2*(rm-1),rh+2*(rm-1)+1,rh+2*rm+1,rh+2*rm+1,rh+2*rm,rh+2*(rm-1));return rd},rQ.createLoopLine=function(rS,rQ,re,rl,rM,rd){var rT=rS.concat(),rU=rM||rS,ri=this.borderColor,rR=(ri>>16&255)/255,ro=(ri>>8&255)/255,rY=(255&ri)/255;rT.splice(0,5);var rp=[rT[0],rT[1]],rJ=[rT[rT.length-5],rT[rT.length-4]],rL=rJ[0]+.5*(rp[0]-rJ[0]),rj=rJ[1]+.5*(rp[1]-rJ[1]);rT.unshift(rL,rj,0,0,0),rT.push(rL,rj,0,0,0);var rc,rG,rz,rA,rv,rD,rB,rO,rH,rg,rI,rE,rt,rk,rX,rh,rb,rm,r$,rn,rP=rT.length/5,ra=rl,rf=re/2;rz=rT[0],rA=rT[1],rg=rz-(rv=rT[5]),rH=(rH=-(rA-(rD=rT[6])))/(rn=Math.sqrt(rH*rH+rg*rg))*rf,rg=rg/rn*rf,rU.push(rz-rH,rA-rg,rR,ro,rY,rz+rH,rA+rg,rR,ro,rY);for(var rw=1;rw<rP-1;rw++)rz=rT[5*(rw-1)],rA=rT[5*(rw-1)+1],rv=rT[5*rw],rD=rT[5*rw+1],rB=rT[5*(rw+1)],rO=rT[5*(rw+1)+1],rg=rz-rv,rE=rv-rB,rX=(-(rH=(rH=-(rA-rD))/(rn=Math.sqrt(rH*rH+rg*rg))*rf)+rz)*(-(rg=rg/rn*rf)+rD)-(-rH+rv)*(-rg+rA),rm=(-(rI=(rI=-(rD-rO))/(rn=Math.sqrt(rI*rI+rE*rE))*rf)+rB)*(-(rE=rE/rn*rf)+rD)-(-rI+rv)*(-rE+rO),r$=(rt=-rg+rA-(-rg+rD))*(rb=-rI+rv-(-rI+rB))-(rh=-rE+rO-(-rE+rD))*(rk=-rH+rv-(-rH+rz)),Math.abs(r$)<.1?(r$+=10.1,rU.push(rv-rH,rD-rg,rR,ro,rY,rv+rH,rD+rg,rR,ro,rY)):(((rc=(rk*rm-rb*rX)/r$)-rv)*(rc-rv)+((rG=(rh*rX-rt*rm)/r$)-rD)+(rG-rD),rU.push(rc,rG,rR,ro,rY,rv-(rc-rv),rD-(rG-rD),rR,ro,rY));rd&&(rQ=rd);var ru=this.edges+1;for(rw=1;rw<ru;rw++)rQ.push(ra+2*(rw-1),ra+2*(rw-1)+1,ra+2*rw+1,ra+2*rw+1,ra+2*rw,ra+2*(rw-1));return rQ.push(ra+2*(rw-1),ra+2*(rw-1)+1,ra+1,ra+1,ra,ra+2*(rw-1)),rU},rS}(),rlS=function(){function rj(){}return rp(rj,"laya.webgl.shapes.Earcut"),rj.earcut=function(rS,rQ,re){re=re||2;var rl,rM,rd,rT,rU,ri,rR,ro=rQ&&rQ.length,rY=ro?rQ[0]*re:rS.length,rp=rj.linkedList(rS,0,rY,re,!0),rJ=[];if(!rp)return rJ;if(ro&&(rp=rj.eliminateHoles(rS,rQ,rp,re)),rS.length>80*re){rl=rd=rS[0],rM=rT=rS[1];for(var rL=re;rL<rY;rL+=re)(rU=rS[rL])<rl&&(rl=rU),(ri=rS[rL+1])<rM&&(rM=ri),rd<rU&&(rd=rU),rT<ri&&(rT=ri);rR=0!==(rR=Math.max(rd-rl,rT-rM))?1/rR:0}return rj.earcutLinked(rp,rJ,re,rl,rM,rR),rJ},rj.linkedList=function(rS,rQ,re,rl,rM){var rd,rT;if(rM===0<rj.signedArea(rS,rQ,re,rl))for(rd=rQ;rd<re;rd+=rl)rT=rj.insertNode(rd,rS[rd],rS[rd+1],rT);else for(rd=re-rl;rQ<=rd;rd-=rl)rT=rj.insertNode(rd,rS[rd],rS[rd+1],rT);return rT&&rj.equals(rT,rT.next)&&(rj.removeNode(rT),rT=rT.next),rT},rj.filterPoints=function(rS,rQ){if(!rS)return rS;rQ||(rQ=rS);var re,rl=rS;do{if(re=!1,rl.steiner||!rj.equals(rl,rl.next)&&0!==rj.area(rl.prev,rl,rl.next))rl=rl.next;else{if(rj.removeNode(rl),(rl=rQ=rl.prev)===rl.next)break;re=!0}}while(re||rl!==rQ);return rQ},rj.earcutLinked=function(rS,rQ,re,rl,rM,rd,rT){if(rS){!rT&&rd&&rj.indexCurve(rS,rl,rM,rd);for(var rU,ri,rR=rS;rS.prev!==rS.next;)if(rU=rS.prev,ri=rS.next,rd?rj.isEarHashed(rS,rl,rM,rd):rj.isEar(rS))rQ.push(rU.i/re),rQ.push(rS.i/re),rQ.push(ri.i/re),rj.removeNode(rS),rS=ri.next,rR=ri.next;else if((rS=ri)===rR){rT?1===rT?(rS=rj.cureLocalIntersections(rS,rQ,re),rj.earcutLinked(rS,rQ,re,rl,rM,rd,2)):2===rT&&rj.splitEarcut(rS,rQ,re,rl,rM,rd):rj.earcutLinked(rj.filterPoints(rS,null),rQ,re,rl,rM,rd,1);break}}},rj.isEar=function(rS){var rQ=rS.prev,re=rS,rl=rS.next;if(0<=rj.area(rQ,re,rl))return!1;for(var rM=rS.next.next;rM!==rS.prev;){if(rj.pointInTriangle(rQ.x,rQ.y,re.x,re.y,rl.x,rl.y,rM.x,rM.y)&&0<=rj.area(rM.prev,rM,rM.next))return!1;rM=rM.next}return!0},rj.isEarHashed=function(rS,rQ,re,rl){var rM=rS.prev,rd=rS,rT=rS.next;if(0<=rj.area(rM,rd,rT))return!1;for(var rU=rM.x<rd.x?rM.x<rT.x?rM.x:rT.x:rd.x<rT.x?rd.x:rT.x,ri=rM.y<rd.y?rM.y<rT.y?rM.y:rT.y:rd.y<rT.y?rd.y:rT.y,rR=rM.x>rd.x?rM.x>rT.x?rM.x:rT.x:rd.x>rT.x?rd.x:rT.x,ro=rM.y>rd.y?rM.y>rT.y?rM.y:rT.y:rd.y>rT.y?rd.y:rT.y,rY=rj.zOrder(rU,ri,rQ,re,rl),rp=rj.zOrder(rR,ro,rQ,re,rl),rJ=rS.nextZ;rJ&&rJ.z<=rp;){if(rJ!==rS.prev&&rJ!==rS.next&&rj.pointInTriangle(rM.x,rM.y,rd.x,rd.y,rT.x,rT.y,rJ.x,rJ.y)&&0<=rj.area(rJ.prev,rJ,rJ.next))return!1;rJ=rJ.nextZ}for(rJ=rS.prevZ;rJ&&rJ.z>=rY;){if(rJ!==rS.prev&&rJ!==rS.next&&rj.pointInTriangle(rM.x,rM.y,rd.x,rd.y,rT.x,rT.y,rJ.x,rJ.y)&&0<=rj.area(rJ.prev,rJ,rJ.next))return!1;rJ=rJ.prevZ}return!0},rj.cureLocalIntersections=function(rS,rQ,re){var rl=rS;do{var rM=rl.prev,rd=rl.next.next;!rj.equals(rM,rd)&&rj.intersects(rM,rl,rl.next,rd)&&rj.locallyInside(rM,rd)&&rj.locallyInside(rd,rM)&&(rQ.push(rM.i/re),rQ.push(rl.i/re),rQ.push(rd.i/re),rj.removeNode(rl),rj.removeNode(rl.next),rl=rS=rd),rl=rl.next}while(rl!==rS);return rl},rj.splitEarcut=function(rS,rQ,re,rl,rM,rd){var rT=rS;do{for(var rU=rT.next.next;rU!==rT.prev;){if(rT.i!==rU.i&&rj.isValidDiagonal(rT,rU)){var ri=rj.splitPolygon(rT,rU);return rT=rj.filterPoints(rT,rT.next),ri=rj.filterPoints(ri,ri.next),rj.earcutLinked(rT,rQ,re,rl,rM,rd),void rj.earcutLinked(ri,rQ,re,rl,rM,rd)}rU=rU.next}rT=rT.next}while(rT!==rS)},rj.eliminateHoles=function(rS,rQ,re,rl){var rM,rd,rT,rU,ri,rR=[];for(rM=0,rd=rQ.length;rM<rd;rM++)rT=rQ[rM]*rl,rU=rM<rd-1?rQ[rM+1]*rl:rS.length,(ri=rj.linkedList(rS,rT,rU,rl,!1))===ri.next&&(ri.steiner=!0),rR.push(rj.getLeftmost(ri));for(rR.sort(rj.compareX),rM=0;rM<rR.length;rM++)rj.eliminateHole(rR[rM],re),re=rj.filterPoints(re,re.next);return re},rj.compareX=function(rS,rQ){return rS.x-rQ.x},rj.eliminateHole=function(rS,rQ){if(rQ=rj.findHoleBridge(rS,rQ)){var re=rj.splitPolygon(rQ,rS);rj.filterPoints(re,re.next)}},rj.findHoleBridge=function(rS,rQ){var re,rl=rQ,rM=rS.x,rd=rS.y,rT=-1/0;do{if(rd<=rl.y&&rd>=rl.next.y&&rl.next.y!==rl.y){var rU=rl.x+(rd-rl.y)*(rl.next.x-rl.x)/(rl.next.y-rl.y);if(rU<=rM&&rT<rU){if((rT=rU)===rM){if(rd===rl.y)return rl;if(rd===rl.next.y)return rl.next}re=rl.x<rl.next.x?rl:rl.next}}rl=rl.next}while(rl!==rQ);if(!re)return null;if(rM===rT)return re.prev;var ri,rR=re,ro=re.x,rY=re.y,rp=1/0;for(rl=re.next;rl!==rR;)rM>=rl.x&&rl.x>=ro&&rM!==rl.x&&rj.pointInTriangle(rd<rY?rM:rT,rd,ro,rY,rd<rY?rT:rM,rd,rl.x,rl.y)&&((ri=Math.abs(rd-rl.y)/(rM-rl.x))<rp||ri===rp&&rl.x>re.x)&&rj.locallyInside(rl,rS)&&(re=rl,rp=ri),rl=rl.next;return re},rj.indexCurve=function(rS,rQ,re,rl){for(var rM=rS;null===rM.z&&(rM.z=rj.zOrder(rM.x,rM.y,rQ,re,rl)),rM.prevZ=rM.prev,rM.nextZ=rM.next,(rM=rM.next)!==rS;);rM.prevZ.nextZ=null,rM.prevZ=null,rj.sortLinked(rM)},rj.sortLinked=function(rS){var rQ,re,rl,rM,rd,rT,rU,ri,rR=1;do{for(re=rS,rd=rS=null,rT=0;re;){for(rT++,rl=re,rQ=rU=0;rQ<rR&&(rU++,rl=rl.nextZ);rQ++);for(ri=rR;0<rU||0<ri&&rl;)0!==rU&&(0===ri||!rl||re.z<=rl.z)?(re=(rM=re).nextZ,rU--):(rl=(rM=rl).nextZ,ri--),rd?rd.nextZ=rM:rS=rM,rM.prevZ=rd,rd=rM;re=rl}rd.nextZ=null,rR*=2}while(1<rT);return rS},rj.zOrder=function(rS,rQ,re,rl,rM){return(rS=1431655765&((rS=858993459&((rS=252645135&((rS=16711935&((rS=32767*(rS-re)*rM)|rS<<8))|rS<<4))|rS<<2))|rS<<1))|(rQ=1431655765&((rQ=858993459&((rQ=252645135&((rQ=16711935&((rQ=32767*(rQ-rl)*rM)|rQ<<8))|rQ<<4))|rQ<<2))|rQ<<1))<<1},rj.getLeftmost=function(rS){for(var rQ=rS,re=rS;rQ.x<re.x&&(re=rQ),(rQ=rQ.next)!==rS;);return re},rj.pointInTriangle=function(rS,rQ,re,rl,rM,rd,rT,rU){return 0<=(rM-rT)*(rQ-rU)-(rS-rT)*(rd-rU)&&0<=(rS-rT)*(rl-rU)-(re-rT)*(rQ-rU)&&0<=(re-rT)*(rd-rU)-(rM-rT)*(rl-rU)},rj.isValidDiagonal=function(rS,rQ){return rS.next.i!==rQ.i&&rS.prev.i!==rQ.i&&!rj.intersectsPolygon(rS,rQ)&&rj.locallyInside(rS,rQ)&&rj.locallyInside(rQ,rS)&&rj.middleInside(rS,rQ)},rj.area=function(rS,rQ,re){return(rQ.y-rS.y)*(re.x-rQ.x)-(rQ.x-rS.x)*(re.y-rQ.y)},rj.equals=function(rS,rQ){return rS.x===rQ.x&&rS.y===rQ.y},rj.intersects=function(rS,rQ,re,rl){return!!(rj.equals(rS,rQ)&&rj.equals(re,rl)||rj.equals(rS,rl)&&rj.equals(re,rQ))||0<rj.area(rS,rQ,re)!=0<rj.area(rS,rQ,rl)&&0<rj.area(re,rl,rS)!=0<rj.area(re,rl,rQ)},rj.intersectsPolygon=function(rS,rQ){var re=rS;do{if(re.i!==rS.i&&re.next.i!==rS.i&&re.i!==rQ.i&&re.next.i!==rQ.i&&rj.intersects(re,re.next,rS,rQ))return!0;re=re.next}while(re!==rS);return!1},rj.locallyInside=function(rS,rQ){return rj.area(rS.prev,rS,rS.next)<0?0<=rj.area(rS,rQ,rS.next)&&0<=rj.area(rS,rS.prev,rQ):rj.area(rS,rQ,rS.prev)<0||rj.area(rS,rS.next,rQ)<0},rj.middleInside=function(rS,rQ){for(var re=rS,rl=!1,rM=(rS.x+rQ.x)/2,rd=(rS.y+rQ.y)/2;re.y>rd!=re.next.y>rd&&re.next.y!==re.y&&rM<(re.next.x-re.x)*(rd-re.y)/(re.next.y-re.y)+re.x&&(rl=!rl),(re=re.next)!==rS;);return rl},rj.splitPolygon=function(rS,rQ){var re=new rMS(rS.i,rS.x,rS.y),rl=new rMS(rQ.i,rQ.x,rQ.y),rM=rS.next,rd=rQ.prev;return(rS.next=rQ).prev=rS,(re.next=rM).prev=re,(rl.next=re).prev=rl,(rd.next=rl).prev=rd,rl},rj.insertNode=function(rS,rQ,re,rl){var rM=new rMS(rS,rQ,re);return rl?(rM.next=rl.next,(rM.prev=rl).next.prev=rM,rl.next=rM):(rM.prev=rM).next=rM,rM},rj.removeNode=function(rS){rS.next.prev=rS.prev,rS.prev.next=rS.next,rS.prevZ&&(rS.prevZ.nextZ=rS.nextZ),rS.nextZ&&(rS.nextZ.prevZ=rS.prevZ)},rj.signedArea=function(rS,rQ,re,rl){for(var rM=0,rd=rQ,rT=re-rl;rd<re;rd+=rl)rM+=(rS[rT]-rS[rd])*(rS[rd+1]+rS[rT+1]),rT=rd;return rM},rj}(),rMS=function(){function rS(rS,rQ,re){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=rS,this.x=rQ,this.y=re,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return rp(rS,"laya.webgl.shapes.EarcutNode"),rS}(),rdS=(function(){function rS(rS,rQ,re,rl,rM,rd,rT){this.lineWidth=rS,this.lineColor=rQ,this.lineAlpha=re,this.fillColor=rl,this.fillAlpha=rM,this.shape=rT,this.fill=rd}rp(rS,"laya.webgl.shapes.GeometryData");var rQ=rS.prototype;rQ.clone=function(){return new rS(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},rQ.getIndexData=function(){return null},rQ.getVertexData=function(){return null},rQ.destroy=function(){this.shape=null}}(),function(){function rS(rS){if(rS instanceof Float32Array)this.points=rS;else if(rS instanceof Array){rS.length;this.points=new Float32Array(rS)}}rp(rS,"laya.webgl.shapes.Vertex");var rQ=rS.prototype;rB.imps(rQ,{"laya.webgl.shapes.IShape":!0}),rQ.getData=function(rS,rQ,re){},rQ.needUpdate=function(rS){return!1},rQ.rebuild=function(rS){},rQ.setMatrix=function(rS){}}(),function(){function ri(rS){void 0===rS&&(rS=1e4),this._renderType=rS}rp(ri,"laya.webgl.submit.Submit");var rS=ri.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS.releaseRender=function(){var rS=ri._cache;(rS[rS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},rS.getRenderType=function(){return this._renderType},rS.renderSubmit=function(){if(0===this._numEle)return 1;var rS=this.shaderValue.textureHost;if(rS){var rQ=rS.source;if(!rS.bitmap||!rQ)return 1;this.shaderValue.texture=rQ,rS.alphaTexture&&rS.alphaTexture.source&&(this.shaderValue.texture1=rS.alphaTexture.source)}this._vb.bind_upload(this._ib);var re=rvS.mainContext;return this.shaderValue.upload(),rW.activeBlendFunction!==this._blendFn&&(re.enable(3042),this._blendFn(re),rW.activeBlendFunction=this._blendFn),rX.drawCall++,rX.trianglesFaces+=this._numEle/3,re.drawElements(4,this._numEle,5123,this._startIdx),1},ri.__init__=function(){var rS=ri.RENDERBASE=new ri(-1);rS.shaderValue=new rHS(0,0),rS.shaderValue.ALPHA=-1234},ri.createSubmit=function(rS,rQ,re,rl,rM){var rd=ri._cache._length?ri._cache[--ri._cache._length]:new ri;null==re&&((re=rd._selfVb||(rd._selfVb=ryS.create(-1))).clear(),rl=0),rd._ib=rQ,rd._vb=re,rd._startIdx=rl*rjS.BYTES_PIDX,rd._numEle=0;var rT=rS._nBlendType;rd._blendFn=rS._targets?rW.targetFns[rT]:rW.fns[rT],rd.shaderValue=rM,rd.shaderValue.setValue(rS._shader2D);var rU=rS._shader2D.filters;return rU&&rd.shaderValue.setFilters(rU),rd},ri.createShape=function(rS,rQ,re,rl,rM,rd){var rT=ri._cache._length?ri._cache[--ri._cache._length]:new ri;rT._ib=rQ,rT._vb=re,rT._numEle=rl,rT._startIdx=rM,rT.shaderValue=rd,rT.shaderValue.setValue(rS._shader2D);var rU=rS._nBlendType;return rT._blendFn=rS._targets?rW.targetFns[rU]:rW.fns[rU],rT},ri.TYPE_2D=1e4,ri.TYPE_CANVAS=10003,ri.TYPE_CMDSETRT=10004,ri.TYPE_CUSTOM=10005,ri.TYPE_BLURRT=10006,ri.TYPE_CMDDESTORYPRERT=10007,ri.TYPE_DISABLESTENCIL=10008,ri.TYPE_OTHERIBVB=10009,ri.TYPE_PRIMITIVE=10010,ri.TYPE_RT=10011,ri.TYPE_BLUR_RT=10012,ri.TYPE_TARGET=10013,ri.TYPE_CHANGE_VALUE=10014,ri.TYPE_SHAPE=10015,ri.TYPE_TEXTURE=10016,ri.TYPE_FILLTEXTURE=10017,ri.RENDERBASE=null,ri._cache=((ri._cache=[])._length=0,ri._cache),ri}()),rTS=function(){function rl(){this.fun=null,this.args=null}rp(rl,"laya.webgl.submit.SubmitCMD");var rS=rl.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS.renderSubmit=function(){return this.fun.apply(null,this.args),1},rS.getRenderType=function(){return 0},rS.releaseRender=function(){var rS=rl._cache;rS[rS._length++]=this},rl.create=function(rS,rQ){var re=rl._cache._length?rl._cache[--rl._cache._length]:new rl;return re.fun=rQ,re.args=rS,re},rl._cache=((rl._cache=[])._length=0,rl._cache),rl}(),rUS=function(){function rQ(){this.variables={}}rp(rQ,"laya.webgl.submit.SubmitCMDScope");var rS=rQ.prototype;return rS.getValue=function(rS){return this.variables[rS]},rS.addValue=function(rS,rQ){return this.variables[rS]=rQ},rS.setValue=function(rS,rQ){return this.variables.hasOwnProperty(rS)?this.variables[rS]=rQ:null},rS.clear=function(){for(var rS in this.variables)delete this.variables[rS]},rS.recycle=function(){this.clear(),rQ.POOL.push(this)},rQ.create=function(){var rS=rQ.POOL.pop();return rS||(rS=new rQ),rS},rQ.POOL=[],rQ}(),riS=function(){function rY(){this.offset=0,this.startIndex=0,this._mat=rg.create()}rp(rY,"laya.webgl.submit.SubmitOtherIBVB");var rS=rY.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS.releaseRender=function(){var rS=rY._cache;(rS[rS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},rS.getRenderType=function(){return 10009},rS.renderSubmit=function(){var rS=this._shaderValue.textureHost;if(rS){var rQ=rS.source;if(!rS.bitmap||!rQ)return 1;this._shaderValue.texture=rQ}this._vb.bind_upload(this._ib);var re=rzS.worldMatrix4,rl=rg.TEMP;rg.mulPre(this._mat,re[0],re[1],re[4],re[5],re[12],re[13],rl);var rM=rzS.worldMatrix4=rY.tempMatrix4;rM[0]=rl.a,rM[1]=rl.b,rM[4]=rl.c,rM[5]=rl.d,rM[12]=rl.tx,rM[13]=rl.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var rd=rvS.mainContext;return rW.activeBlendFunction!==this._blendFn&&(rd.enable(3042),this._blendFn(rd),rW.activeBlendFunction=this._blendFn),rX.drawCall++,rX.trianglesFaces+=this._numEle/3,rd.drawElements(4,this._numEle,5123,this.startIndex),rzS.worldMatrix4=re,rnS.activeShader=null,1},rY.create=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){void 0===ri&&(ri=0);var rR=rY._cache._length?rY._cache[--rY._cache._length]:new rY;rR._ib=re,rR._vb=rQ,rR._numEle=rl,rR._shader=rM,rR._shaderValue=rd;var ro=rS._nBlendType;switch(rR._blendFn=rS._targets?rW.targetFns[ro]:rW.fns[ro],ri){case 0:rR.offset=0,rR.startIndex=rU/(rjS.BYTES_PE*rQ.vertexStride)*1.5,rR.startIndex*=rjS.BYTES_PIDX;break;case 1:rR.startIndex=rT,rR.offset=rU}return rR},rY._cache=((rY._cache=[])._length=0,rY._cache),rY.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rY}(),rRS=function(){function re(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new rE,this.screenRect=new rE}rp(re,"laya.webgl.submit.SubmitScissor");var rS=re.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS._scissor=function(rS,rQ,re,rl){var rM=rzS.worldMatrix4,rd=rM[0],rT=rM[5],rU=rM[12],ri=rM[13];if(rl*=rT,(re*=rd)<1||rl<1)return!1;var rR=(rS=rS*rd+rU)+re,ro=(rQ=rQ*rT+ri)+rl;rS<0&&(re=rR-(rS=0)),rQ<0&&(rl=ro-(rQ=0));var rY=rzS.worldClipRect;if(rS=Math.max(rS,rY.x),rQ=Math.max(rQ,rY.y),re=Math.min(rR,rY.right)-rS,rl=Math.min(ro,rY.bottom)-rQ,re<1||rl<1)return!1;var rp=rzS.worldScissorTest;return this.screenRect.copyFrom(rY),rY.x=rS,rY.y=rQ,rY.width=re,rY.height=rl,rzS.worldScissorTest=!0,rQ=rzS.height-rQ-rl,rvS.mainContext.scissor(rS,rQ,re,rl),rvS.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),rp?(rQ=rzS.height-this.screenRect.y-this.screenRect.height,rvS.mainContext.scissor(this.screenRect.x,rQ,this.screenRect.width,this.screenRect.height),rvS.mainContext.enable(3089)):(rvS.mainContext.disable(3089),rzS.worldScissorTest=!1),rY.copyFrom(this.screenRect),!0},rS._scissorWithTagart=function(rS,rQ,re,rl){if(re<1||rl<1)return!1;var rM=rS+re,rd=rQ+rl;rS<0&&(re=rM-(rS=0)),rQ<0&&(rl=rd-(rQ=0));var rT=rzS.worldClipRect;if(rS=Math.max(rS,rT.x),rQ=Math.max(rQ,rT.y),re=Math.min(rM,rT.right)-rS,rl=Math.min(rd,rT.bottom)-rQ,re<1||rl<1)return!1;var rU=rzS.worldScissorTest;return this.screenRect.copyFrom(rT),rzS.worldScissorTest=!0,rT.x=rS,rT.y=rQ,rT.width=re,rT.height=rl,rQ=rzS.height-rQ-rl,rvS.mainContext.scissor(rS,rQ,re,rl),rvS.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),rU?(rQ=rzS.height-this.screenRect.y-this.screenRect.height,rvS.mainContext.scissor(this.screenRect.x,rQ,this.screenRect.width,this.screenRect.height),rvS.mainContext.enable(3089)):(rvS.mainContext.disable(3089),rzS.worldScissorTest=!1),rT.copyFrom(this.screenRect),!0},rS.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},rS.getRenderType=function(){return 0},rS.releaseRender=function(){var rS=re._cache;(rS[rS._length++]=this).context=null},re.create=function(rS){var rQ=re._cache._length?re._cache[--re._cache._length]:new re;return rQ.context=rS,rQ},re._cache=((re._cache=[])._length=0,re._cache),re}(),roS=function(){function ri(){this.step=0,this.blendMode=null,this.level=0}rp(ri,"laya.webgl.submit.SubmitStencil");var rS=ri.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},rS.getRenderType=function(){return 0},rS.releaseRender=function(){var rS=ri._cache;rS[rS._length++]=this},rS.do1=function(){var rS=rvS.mainContext;rS.enable(2960),rS.clear(1024),rS.colorMask(!1,!1,!1,!1),rS.stencilFunc(514,this.level,255),rS.stencilOp(7680,7680,7682)},rS.do2=function(){var rS=rvS.mainContext;rS.stencilFunc(514,this.level+1,255),rS.colorMask(!0,!0,!0,!0),rS.stencilOp(7680,7680,7680)},rS.do3=function(){var rS=rvS.mainContext;rS.colorMask(!0,!0,!0,!0),rS.stencilOp(7680,7680,7680),rS.clear(1024),rS.disable(2960)},rS.do4=function(){var rS=rvS.mainContext;0==this.level&&(rS.enable(2960),rS.clear(1024)),rS.colorMask(!1,!1,!1,!1),rS.stencilFunc(519,0,255),rS.stencilOp(7680,7680,7682)},rS.do5=function(){var rS=rvS.mainContext;rS.stencilFunc(514,this.level,255),rS.colorMask(!0,!0,!0,!0),rS.stencilOp(7680,7680,7680)},rS.do6=function(){var rS=rvS.mainContext;rW.targetFns[rW.TOINT[this.blendMode]](rS)},rS.do7=function(){var rS=rvS.mainContext;rS.colorMask(!1,!1,!1,!1),rS.stencilOp(7680,7680,7683)},rS.do8=function(){var rS=rvS.mainContext;rS.colorMask(!0,!0,!0,!0),rS.stencilFunc(514,this.level,255),rS.stencilOp(7680,7680,7680)},ri.restore=function(rS,rQ,re,rl,rM){var rd;if((rS._renderKey=0)<ri._mask&&ri._mask--,0==ri._mask)rd=laya.webgl.submit.SubmitStencil.create(3),rS.addRenderObject(rd),rS._curSubmit=rdS.RENDERBASE;else{rd=laya.webgl.submit.SubmitStencil.create(7),rS.addRenderObject(rd);var rT=rS._vb;rT._byteLength;if(rcS.fillRectImgVb(rT,null,rQ.x,rQ.y,rQ.width,rQ.height,r$.DEF_UV,re,rl,rM,0,0)){rS._shader2D.glTexture=null;var rU=rS._curSubmit=rdS.createSubmit(rS,rS._ib,rT,(rT._byteLength-64)/32*3,rHS.create(2,0));rU.shaderValue.ALPHA=1,rS._submits[rS._submits._length++]=rU,rS._curSubmit._numEle+=6,rS._curSubmit=rdS.RENDERBASE}else alert("clipRect calc stencil rect error");rd=laya.webgl.submit.SubmitStencil.create(8),rS.addRenderObject(rd)}},ri.restore2=function(rS,rQ){var re;(rS._renderKey=0)<ri._mask&&ri._mask--,0==ri._mask?(re=laya.webgl.submit.SubmitStencil.create(3),rS.addRenderObject(re),rS._curSubmit=rdS.RENDERBASE):(re=laya.webgl.submit.SubmitStencil.create(7),rS.addRenderObject(re),rS._submits[rS._submits._length++]=rQ,re=laya.webgl.submit.SubmitStencil.create(8),rS.addRenderObject(re))},ri.create=function(rS){var rQ=ri._cache._length?ri._cache[--ri._cache._length]:new ri;return 5==(rQ.step=rS)&&++ri._mask,rQ.level=ri._mask,rQ},ri._cache=((ri._cache=[])._length=0,ri._cache),ri._mask=0,ri}(),rYS=function(){function rU(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}rp(rU,"laya.webgl.submit.SubmitTarget");var rS=rU.prototype;return rB.imps(rS,{"laya.webgl.submit.ISubmit":!0}),rS.renderSubmit=function(){this._vb.bind_upload(this._ib);var rS=this.scope.getValue(this.proName);return rS&&(this.shaderValue.texture=rS.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[rS.width,rS.height]),this.shaderValue.upload(),this.blend(),rX.drawCall++,rX.trianglesFaces+=this._numEle/3,rvS.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},rS.blend=function(){if(rW.activeBlendFunction!==rW.fns[this.blendType]){var rS=rvS.mainContext;rS.enable(3042),rW.fns[this.blendType](rS),rW.activeBlendFunction=rW.fns[this.blendType]}},rS.getRenderType=function(){return 0},rS.releaseRender=function(){var rS=rU._cache;(rS[rS._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},rU.create=function(rS,rQ,re,rl,rM,rd){var rT=rU._cache._length?rU._cache[--rU._cache._length]:new rU;return rT._ib=rQ,rT._vb=re,rT.proName=rd,rT._startIdx=rl*rjS.BYTES_PIDX,rT._numEle=0,rT.blendType=rS._nBlendType,rT.shaderValue=rM,rT.shaderValue.setValue(rS._shader2D),rT},rU._cache=((rU._cache=[])._length=0,rU._cache),rU}(),rpS=function(){function rS(){this._sourceStr=null}rp(rS,"laya.webgl.text.CharSegment");var rQ=rS.prototype;return rB.imps(rQ,{"laya.webgl.text.ICharSegment":!0}),rQ.textToSpit=function(rS){this._sourceStr=rS},rQ.getChar=function(rS){return this._sourceStr.charAt(rS)},rQ.getCharCode=function(rS){return this._sourceStr.charCodeAt(rS)},rQ.length=function(){return this._sourceStr.length},rS}(),rJS=function(){var rS;function rX(){}return rp(rX,"laya.webgl.text.DrawText"),rX.__init__=function(){rX._charsTemp=new Array,rX._drawValue=new rS,rX._charSeg=new rpS},rX.customCharSeg=function(rS){rX._charSeg=rS},rX.getChar=function(rS,rQ,re){var rl=rqS.createOneChar(rS,re);return-1!=rQ&&(rX._charsCache[rQ]=rl),rl},rX._drawSlow=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY,rp,rJ,rL){var rj,rc,rG=rX._drawValue.value(rd,rU,ri,rR,rp,rJ,rL),rz=0,rA=0,rv=rX._charsTemp,rD=0,rB=NaN;if(rl)for(rv.length=rl.length,rz=0,rA=rl.length;rz<rA;rz++)(rc=rl[rz])&&(rB=rc.charNum+rG.txtID,rv[rz]=rj=rX._charsCache[rB]||rX.getChar(rc.char,rB,rG),rj.active());else{var rO=re instanceof laya.utils.WordText?re.toString():re;if(rm.CharacterCache){rX._charSeg.textToSpit(rO);var rH=rX._charSeg.length();for(rz=0,rA=rv.length=rH;rz<rA;rz++)rB=rX._charSeg.getCharCode(rz)+rG.txtID,rv[rz]=rj=rX._charsCache[rB]||rX.getChar(rX._charSeg.getChar(rz),rB,rG),rj.active(),rD+=rj.cw}else rv.length=0,(rj=rX.getChar(rO,-1,rG)).active(),rD+=rj.cw,rv[0]=rj}var rg=0;null!==rT&&"left"!==rT&&(rg=-("center"==rT?rD/2:rD));var rI,rE,rt=NaN,rk=0;if(rl)for(rz=0,rA=rv.length;rz<rA;rz++)rj=rv[rz],rc=rl[rz],rj&&rc&&!rj.isSpace&&(rt=rj.borderSize,rI=rj.texture,rQ._drawText(rI,ro+rg+rc.x*rp-rt,rY+rc.y*rJ-rt,rI.width,rI.height,rM,0,0,0,0));else{for(rz=0,rA=rv.length;rz<rA;rz++)(rj=rv[rz])&&!rj.isSpace&&(rt=rj.borderSize,rI=rj.texture,rQ._drawText(rI,ro+rg-rt,rY-rt,rI.width,rI.height,rM,0,0,0,0),rS&&((rE=rS[rk++])||(rE=rS[rk-1]=[]),rE[0]=rI,rE[1]=rg-rt,rE[2]=-rt)),rg+=rj.cw;rS&&(rS.length=rk)}},rX._drawFast=function(rS,rQ,re,rl,rM){for(var rd,rT,rU=0,ri=rS.length;rU<ri;rU++)(rd=(rT=rS[rU])[0]).active(),rQ._drawText(rd,rl+rT[1],rM+rT[2],rd.width,rd.height,re,0,0,0,0)},rX.drawText=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY){if(void 0===rY&&(rY=0),!(rQ&&0===rQ.length||re&&0===re.length)){var rp=rl.a,rJ=rl.d;(0!==rl.b||0!==rl.c)&&(rp=rJ=1);var rL=1!==rp||1!==rJ;if(rL&&rB.stage.transform){var rj=rB.stage.transform;rL=rj.a===rp&&rj.d===rJ}else rL=!1;if(rL){var rc=(rl=rl.copyTo(rOS._tmpMatrix)).tx,rG=rl.ty;rl.scale(1/rp,1/rJ),rl._checkTransform(),rR*=rp,ro*=rJ,rR+=rc-rl.tx,ro+=rG-rl.ty}else rp=rJ=1;if(re)rX._drawSlow(null,rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rp,rJ,rY);else{if(null===rQ.toUpperCase){var rz=rp+1e5*rJ,rA=rQ;return void(rA.changed||rA.id!==rz?(rA.id=rz,rA.changed=!1,rX._drawSlow(rA.save,rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rp,rJ,rY)):rX._drawFast(rA.save,rS,rl,rR,ro))}var rv=rQ+rM.toString()+rT+rU+ri+rp+rJ+rd,rD=rX._textsCache[rv];rm.CharacterCache?rD?rX._drawFast(rD,rS,rl,rR,ro):(rX._textsCache.__length||(rX._textsCache.__length=0),rX._textsCache.__length>rO.WebGLTextCacheCount&&((rX._textsCache={}).__length=0,rX._curPoolIndex=0),rX._textCachesPool[rX._curPoolIndex]?(rD=rX._textsCache[rv]=rX._textCachesPool[rX._curPoolIndex]).length=0:rX._textCachesPool[rX._curPoolIndex]=rD=rX._textsCache[rv]=[],rX._textsCache.__length++,rX._curPoolIndex++,rX._drawSlow(rD,rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rp,rJ,rY)):rX._drawSlow(rD,rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rp,rJ,rY)}}},rX._charsTemp=null,rX._textCachesPool=[],rX._curPoolIndex=0,rX._charsCache={},rX._textsCache={},rX._drawValue=null,rX.d=[],rX._charSeg=null,rX.__init$=function(){rS=function(){function ri(){}return rp(ri,""),ri.prototype.value=function(rS,rQ,re,rl,rM,rd,rT){this.font=rS,this.fillColor=rQ,this.borderColor=re,this.lineWidth=rl,this.scaleX=rM,this.scaleY=rd,this.underLine=rT;var rU=rS.toString()+rM+rd+rl+(rQ?rQ.toLowerCase():" ")+(re?re.toLowerCase():" ")+rT;return this.txtID=ri._keymap[rU],this.txtID||(this.txtID=1e-7*++ri._keymapCount,ri._keymap[rU]=this.txtID),this},ri.clear=function(){ri._keymap={},ri._keymapCount=1},ri._keymap={},ri._keymapCount=1,ri}()},rX}(),rLS=function(){function rM(rS){this._index=0,this._size=14,this._italic=-2,rM._cache2=rM._cache2||[],this.setFont(rS||"14px Arial")}rp(rM,"laya.webgl.text.FontInContext");var rS=rM.prototype;return rS.setFont=function(rS){var rQ=rM._cache2[rS];if(rQ)this._words=rQ[0],this._size=rQ[1];else{this._words=rS.split(" ");for(var re=0,rl=this._words.length;re<rl;re++)if(0<this._words[re].indexOf("px")){this._index=re;break}this._size=parseInt(this._words[this._index]),rM._cache2[rS]=[this._words,this._size]}this._text=null,this._italic=-2},rS.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},rS.hasType=function(rS){for(var rQ=0,re=this._words.length;rQ<re;rQ++)if(this._words[rQ]===rS)return rQ;return-1},rS.removeType=function(rS){for(var rQ=0,re=this._words.length;rQ<re;rQ++)if(this._words[rQ]===rS){this._words.splice(rQ,1),this._index>rQ&&this._index--;break}this._text=null,this._italic=-2},rS.copyTo=function(rS){return rS._text=this._text,rS._size=this._size,rS._index=this._index,rS._words=this._words.slice(),rS._italic=-2,rS},rS.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},rl(0,rS,"size",function(){return this._size},function(rS){this._size=rS,this._words[this._index]=rS+"px",this._text=null}),rM.create=function(rS){var rQ=rM._cache[rS];return rQ||(rQ=rM._cache[rS]=new rM(rS))},rM.EMPTY=new rM,rM._cache={},rM._cache2=null,rM}(),rjS=function(){function rS(){}return rp(rS,"laya.webgl.utils.CONST3D2D"),rS.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rS.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],rS.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],rS._TMPARRAY=[],rS._OFFSETX=0,rS._OFFSETY=0,rT(rS,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),rS}(),rcS=function(){function rL(){}return rp(rL,"laya.webgl.utils.GlUtils"),rL.make2DProjection=function(rS,rQ,re){return[2/rS,0,0,0,0,-2/rQ,0,0,0,0,2/re,0,-1,1,0,1]},rL.fillIBQuadrangle=function(rS,rQ){if(65535/4<rQ)throw Error("IBQuadrangle count:"+rQ+" must<:"+Math.floor(65535/4));rQ=Math.floor(rQ),rS._resizeBuffer(6*(rQ+1)*2,!1),rS.byteLength=rS.bufferLength;for(var re=rS.getUint16Array(),rl=0,rM=0;rM<rQ;rM++)re[rl++]=4*rM,re[rl++]=4*rM+2,re[rl++]=4*rM+1,re[rl++]=4*rM,re[rl++]=4*rM+3,re[rl++]=4*rM+2;return rS.setNeedUpload(),!0},rL.expandIBQuadrangle=function(rS,rQ){rS.bufferLength>=6*rQ*2||rL.fillIBQuadrangle(rS,rQ)},rL.mathCeilPowerOfTwo=function(rS){return rS--,rS|=rS>>1,rS|=rS>>2,rS|=rS>>4,rS|=rS>>8,rS|=rS>>16,++rS},rL.fillQuadrangleImgVb=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=16+(rS._byteLength>>2);rS.byteLength=ri<<2;var rR=rS.getFloat32Array();rR[(ri-=16)+2]=rM[0],rR[ri+3]=rM[1],rR[ri+6]=rM[2],rR[ri+7]=rM[3],rR[ri+10]=rM[4],rR[ri+11]=rM[5],rR[ri+14]=rM[6],rR[ri+15]=rM[7];var ro=rd.a,rY=rd.b,rp=rd.c,rJ=rd.d;if(1!==ro||0!==rY||0!==rp||1!==rJ){rd.bTransform=!0;var rL=rd.tx+rT,rj=rd.ty+rU;rR[ri]=(rl[0]+rQ)*ro+(rl[1]+re)*rp+rL,rR[ri+1]=(rl[0]+rQ)*rY+(rl[1]+re)*rJ+rj,rR[ri+4]=(rl[2]+rQ)*ro+(rl[3]+re)*rp+rL,rR[ri+5]=(rl[2]+rQ)*rY+(rl[3]+re)*rJ+rj,rR[ri+8]=(rl[4]+rQ)*ro+(rl[5]+re)*rp+rL,rR[ri+9]=(rl[4]+rQ)*rY+(rl[5]+re)*rJ+rj,rR[ri+12]=(rl[6]+rQ)*ro+(rl[7]+re)*rp+rL,rR[ri+13]=(rl[6]+rQ)*rY+(rl[7]+re)*rJ+rj}else rd.bTransform=!1,rQ+=rd.tx+rT,re+=rd.ty+rU,rR[ri]=rQ+rl[0],rR[ri+1]=re+rl[1],rR[ri+4]=rQ+rl[2],rR[ri+5]=re+rl[3],rR[ri+8]=rQ+rl[4],rR[ri+9]=re+rl[5],rR[ri+12]=rQ+rl[6],rR[ri+13]=re+rl[7];return rS._upload=!0},rL.fillTranglesVB=function(rS,rQ,re,rl,rM,rd,rT){var rU=(rS._byteLength>>2)+rl.length;rS.byteLength=rU<<2;var ri=rS.getFloat32Array();rU-=rl.length;for(var rR=rl.length,ro=rM.a,rY=rM.b,rp=rM.c,rJ=rM.d,rL=0;rL<rR;rL+=4)if(ri[rU+rL+2]=rl[rL+2],ri[rU+rL+3]=rl[rL+3],1!==ro||0!==rY||0!==rp||1!==rJ){rM.bTransform=!0;var rj=rM.tx+rd,rc=rM.ty+rT;ri[rU+rL]=(rl[rL]+rQ)*ro+(rl[rL+1]+re)*rp+rj,ri[rU+rL+1]=(rl[rL]+rQ)*rY+(rl[rL+1]+re)*rJ+rc}else rM.bTransform=!1,rQ+=rM.tx+rd,re+=rM.ty+rT,ri[rU+rL]=rQ+rl[rL],ri[rU+rL+1]=re+rl[rL+1];return rS._upload=!0},rL.copyPreImgVb=function(rS,rQ,re){var rl=rS._byteLength>>2;rS.byteLength=rl+16<<2;for(var rM=rS.getFloat32Array(),rd=0,rT=rl-16;rd<4;rd++)rM[rl]=rM[rT]+rQ,++rT,rM[++rl]=rM[rT]+re,++rT,rM[++rl]=rM[rT],++rT,rM[++rl]=rM[rT],++rl,++rT;rS._upload=!0},rL.fillRectImgVb=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY,rp){void 0===rp&&(rp=!1);var rJ,rL,rj,rc,rG,rz,rA,rv,rD,rB,rO,rH,rg,rI,rE,rt,rk=1,rX=rU.a,rh=rU.b,rb=rU.c,rm=rU.d,r$=rQ&&rQ.width<99999999;if(1!==rX||0!==rh||0!==rb||1!==rm?(rU.bTransform=!0,0===rh&&0===rb&&(rk=23,rD=rM+re,rB=rd+rl,rJ=rX*re+(rO=rU.tx+ri),rj=rX*rD+rO,rL=rm*rl+(rH=rU.ty+rR),rc=rm*rB+rH)):(rk=23,rU.bTransform=!1,rj=(rJ=re+rU.tx+ri)+rM,rc=(rL=rl+rU.ty+rR)+rd),r$&&(rG=rQ.x,rz=rQ.y,rA=rQ.width+rG,rv=rQ.height+rz),1!==rk){if(Math.min(rJ,rj)>=rA)return!1;if(Math.min(rL,rc)>=rv)return!1;if(Math.max(rj,rJ)<=rG)return!1;if(Math.max(rc,rL)<=rz)return!1}var rn=rS._byteLength>>2;rS.byteLength=16+rn<<2;var rP=rS.getFloat32Array();switch(rP[2+rn]=rT[0],rP[3+rn]=rT[1],rP[6+rn]=rT[2],rP[7+rn]=rT[3],rP[10+rn]=rT[4],rP[11+rn]=rT[5],rP[14+rn]=rT[6],rP[15+rn]=rT[7],rk){case 1:rO=rU.tx+ri,rH=rU.ty+rR;var ra=rX*re,rf=rb*rl,rw=rm*rl,ru=rh*re,rr=rX*(rD=rM+re),rW=rb*(rB=rd+rl),rx=rm*rB,rF=rh*rD;rp?(rg=ra+rf+rO,rE=Math.round(rg)-rg,rI=rw+ru+rH,rt=Math.round(rI)-rI,rP[rn]=rg+rE,rP[1+rn]=rI+rt,rP[4+rn]=rr+rf+rO+rE,rP[5+rn]=rw+rF+rH+rt,rP[8+rn]=rr+rW+rO+rE,rP[9+rn]=rx+rF+rH+rt,rP[12+rn]=ra+rW+rO+rE,rP[13+rn]=rx+ru+rH+rt):(rP[rn]=ra+rf+rO,rP[1+rn]=rw+ru+rH,rP[4+rn]=rr+rf+rO,rP[5+rn]=rw+rF+rH,rP[8+rn]=rr+rW+rO,rP[9+rn]=rx+rF+rH,rP[12+rn]=ra+rW+rO,rP[13+rn]=rx+ru+rH);break;case 23:rp?(rg=rJ+ro,rE=Math.round(rg)-rg,rI=rL,rt=Math.round(rI)-rI,rP[rn]=rg+rE,rP[1+rn]=rI+rt,rP[4+rn]=rj+ro+rE,rP[5+rn]=rL+rt,rP[8+rn]=rj+rE,rP[9+rn]=rc+rt,rP[12+rn]=rJ+rE,rP[13+rn]=rc+rt):(rP[rn]=rJ+ro,rP[1+rn]=rL,rP[4+rn]=rj+ro,rP[5+rn]=rL,rP[8+rn]=rj,rP[9+rn]=rc,rP[12+rn]=rJ,rP[13+rn]=rc)}return rS._upload=!0},rL.fillLineVb=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=.5*rT,rR=rL._fillLineArray,ro=-(rl-rd),rY=re-rM,rp=Math.sqrt(ro*ro+rY*rY);ro/=rp,rY/=rp,ro*=ri,rY*=ri,rR[0]=re-ro,rR[1]=rl-rY,rR[4]=re+ro,rR[5]=rl+rY,rR[8]=rM+ro,rR[9]=rd+rY,rR[12]=rM-ro,rR[13]=rd-rY,rU&&rU.transformPointArray(rR,rR);var rJ=16+(rS._byteLength>>2);return rS.byteLength=rJ<<2,rS.insertData(rR,rJ-16),!0},rL._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],rL}(),rGS=(function(){function ri(){}rp(ri,"laya.webgl.utils.MatirxArray"),ri.ArrayMul=function(rS,rQ,re){if(rS)if(rQ)for(var rl=NaN,rM=NaN,rd=NaN,rT=NaN,rU=0;rU<4;rU++)rl=rS[rU],rM=rS[rU+4],rd=rS[rU+8],rT=rS[rU+12],re[rU]=rl*rQ[0]+rM*rQ[1]+rd*rQ[2]+rT*rQ[3],re[rU+4]=rl*rQ[4]+rM*rQ[5]+rd*rQ[6]+rT*rQ[7],re[rU+8]=rl*rQ[8]+rM*rQ[9]+rd*rQ[10]+rT*rQ[11],re[rU+12]=rl*rQ[12]+rM*rQ[13]+rd*rQ[14]+rT*rQ[15];else ri.copyArray(rS,re);else ri.copyArray(rQ,re)},ri.copyArray=function(rS,rQ){if(rS&&rQ)for(var re=0;re<rS.length;re++)rQ[re]=rS[re]}}(),function(){function rQ(rS,rQ,re){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=rS,this._vb=new ryS(rS,35048),rQ&&this._vb._resizeBuffer(rQ,!1),this._ib=new rsS,re&&this._ib._resizeBuffer(re,!1)}rp(rQ,"laya.webgl.utils.Mesh2D");var rS=rQ.prototype;return rS.cloneWithNewVB=function(){var rS=new rQ(this._stride,0,0);return rS._ib=this._ib,rS._quadNum=this._quadNum,rS._attribInfo=this._attribInfo,rS},rS.cloneWithNewVBIB=function(){var rS=new rQ(this._stride,0,0);return rS._attribInfo=this._attribInfo,rS},rS.getVBW=function(){return this._vb.setNeedUpload(),this._vb},rS.getVBR=function(){return this._vb},rS.getIBR=function(){return this._ib},rS.getIBW=function(){return this._ib.setNeedUpload(),this._ib},rS.createQuadIB=function(rS){this._quadNum=rS,this._ib._resizeBuffer(6*rS*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var rQ=this._ib.getUint16Array(),re=0,rl=0,rM=0;rM<rS;rM++)rQ[re++]=rl,rQ[re++]=rl+2,rQ[re++]=rl+1,rQ[re++]=rl,rQ[re++]=rl+3,rQ[re++]=rl+2,rl+=4;this._ib.setNeedUpload()},rS.setAttributes=function(rS){if(this._attribInfo=rS,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},rS.getEleNum=function(){return this._ib.getBuffer().byteLength/2},rS.releaseMesh=function(){},rS.destroy=function(){},rS.clearVB=function(){this._vb.clear()},rQ._gvaoid=0,rQ}()),rzS=function(){function rM(){}return rp(rM,"laya.webgl.utils.RenderState2D"),rM.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},rM.mat2MatArray=function(rS,rQ){var re=rS,rl=rQ;return rl[0]=re.a,rl[1]=re.b,rl[2]=rM.EMPTYMAT4_ARRAY[2],rl[3]=rM.EMPTYMAT4_ARRAY[3],rl[4]=re.c,rl[5]=re.d,rl[6]=rM.EMPTYMAT4_ARRAY[6],rl[7]=rM.EMPTYMAT4_ARRAY[7],rl[8]=rM.EMPTYMAT4_ARRAY[8],rl[9]=rM.EMPTYMAT4_ARRAY[9],rl[10]=rM.EMPTYMAT4_ARRAY[10],rl[11]=rM.EMPTYMAT4_ARRAY[11],rl[12]=re.tx,rl[13]=re.ty,rl[14]=rM.EMPTYMAT4_ARRAY[14],rl[15]=rM.EMPTYMAT4_ARRAY[15],rQ},rM.restoreTempArray=function(){rM.TEMPMAT4_ARRAY[0]=1,rM.TEMPMAT4_ARRAY[1]=0,rM.TEMPMAT4_ARRAY[4]=0,rM.TEMPMAT4_ARRAY[5]=1,rM.TEMPMAT4_ARRAY[12]=0,rM.TEMPMAT4_ARRAY[13]=0},rM.clear=function(){rM.worldScissorTest=!1,rM.worldShaderDefines=null,rM.worldFilters=null,rM.worldAlpha=1,rM.worldClipRect.x=rM.worldClipRect.y=0,rM.worldClipRect.width=rM.width,rM.worldClipRect.height=rM.height,rM.curRenderTarget=null},rM._MAXSIZE=99999999,rM.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rM.worldMatrix4=rM.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rM.worldAlpha=1,rM.worldScissorTest=!1,rM.worldFilters=null,rM.worldShaderDefines=null,rM.curRenderTarget=null,rM.width=0,rM.height=0,rT(rM,["worldMatrix",function(){return this.worldMatrix=new rg},"worldClipRect",function(){return this.worldClipRect=new rE(0,0,99999999,99999999)}]),rM}(),rAS=function(){var rz,re;function rA(rS,rQ,re,rl,rM){var rd=this;function rT(rS){var rQ=[],re=new rz(rQ);return rd._compileToTree(re,rS.split("\n"),0,rQ,rM),re}var rU=rJ.now();this._VS=rT(rQ),this._PS=rT(re),this._nameMap=rl,2<rJ.now()-rU&&console.log("ShaderCompile use time:"+(rJ.now()-rU)+"  size:"+rQ.length+"/"+re.length)}rp(rA,"laya.webgl.utils.ShaderCompile");var rS=rA.prototype;return rS._compileToTree=function(rS,rQ,re,rl,rM){var rd,rT,rU,ri,rR,ro,rY,rp=0,rJ=0,rL=0,rj=0;for(rJ=re;rJ<rQ.length;rJ++)if(!((rU=rQ[rJ]).length<1)&&0!==(rp=rU.indexOf("//"))){if(0<=rp&&(rU=rU.substr(0,rp)),rd=rY||new rz(rl),rY=null,rd.text=rU,rd.noCompile=!0,0<=(rp=rU.indexOf("#"))){for(ri="#",rj=rp+1,rL=rU.length;rj<rL;rj++){var rc=rU.charAt(rj);if(" "===rc||"\t"===rc||"\r"===rc||"\n"===rc||"?"===rc)break;ri+=rc}switch(rd.name=ri){case"#ifdef":case"#ifndef":if(rd.src=rU,rd.noCompile=null!=rU.match(/[!&|()=<>]/),rd.noCompile?console.log("function():Boolean{return "+rU.substr(rp+rd.name.length)+"}"):(ro=rU.replace(/^\s*/,"").split(/\s+/),rd.setCondition(ro[1],"#ifdef"===ri?1:2),rd.text="//"+rd.text),rd.setParent(rS),rS=rd,rM)for(ro=rU.substr(rj).split(rA._splitToWordExps3),rj=0;rj<ro.length;rj++)(rU=ro[rj]).length&&(rM[rU]=!0);continue;case"#if":if(rd.src=rU,rd.noCompile=!0,rd.setParent(rS),rS=rd,rM)for(ro=rU.substr(rj).split(rA._splitToWordExps3),rj=0;rj<ro.length;rj++)(rU=ro[rj]).length&&"defined"!=rU&&(rM[rU]=!0);continue;case"#else":rd.src=rU,rT=(rS=rS.parent).childs[rS.childs.length-1],rd.noCompile=rT.noCompile,rd.noCompile||(rd.condition=rT.condition,rd.conditionType=1==rT.conditionType?2:1,rd.text="//"+rd.text+" "+rT.text+" "+rd.conditionType),rd.setParent(rS),rS=rd;continue;case"#endif":rT=(rS=rS.parent).childs[rS.childs.length-1],rd.noCompile=rT.noCompile,rd.noCompile||(rd.text="//"+rd.text),rd.setParent(rS);continue;case"#include":ro=rA.splitToWords(rU,null);var rG=rA.includes[ro[1]];if(!rG)throw"ShaderCompile error no this include file:"+ro[1];if((rp=ro[0].indexOf("?"))<0){rd.setParent(rS),rU=rG.getWith("with"==ro[2]?ro[3]:null),this._compileToTree(rd,rU.split("\n"),0,rl,rM),rd.text="";continue}rd.setCondition(ro[0].substr(rp+1),1),rd.text=rG.getWith("with"==ro[2]?ro[3]:null);break;case"#import":rR=(ro=rA.splitToWords(rU,null))[1],rl.push({node:rd,file:rA.includes[rR],ofs:rd.text.length});continue}}else{if((rT=rS.childs[rS.childs.length-1])&&!rT.name){0<rl.length&&rA.splitToWords(rU,rT),rY=rd,rT.text+="\n"+rU;continue}0<rl.length&&rA.splitToWords(rU,rd)}rd.setParent(rS)}},rS.createShader=function(rS,rQ,re){var rl={},rM="";if(rS)for(var rd in rS)rM+="#define "+rd+"\n",rl[rd]=!0;var rT=this._VS.toscript(rl,[]),rU=this._PS.toscript(rl,[]);return(re||rCS.create)(rM+rT.join("\n"),rM+rU.join("\n"),rQ,this._nameMap)},rA._parseOne=function(rS,rQ,re,rl,rM,rd){var rT={type:rA.shaderParamsMap[re[rl+1]],name:re[rl+2],size:isNaN(parseInt(re[rl+3]))?1:parseInt(re[rl+3])};return rd&&("attribute"==rM?rS.push(rT):rQ.push(rT)),":"==re[rl+3]&&(rT.type=re[rl+4],rl+=2),rl+=2},rA.addInclude=function(rS,rQ){if(!rQ||0===rQ.length)throw new Error("add shader include file err:"+rS);if(rA.includes[rS])throw new Error("add shader include file err, has add:"+rS);rA.includes[rS]=new re(rQ)},rA.preGetParams=function(rS,rQ){var re=[rS,rQ],rl={},rM=[],rd=[],rT={},rU=[];rl.attributes=rM,rl.uniforms=rd,rl.defines=rT;for(var ri=0,rR=0,ro=0;ro<2;ro++){re[ro]=re[ro].replace(rA._removeAnnotation,"");var rY,rp=re[ro].match(rA._reg);for(ri=0,rR=rp.length;ri<rR;ri++){var rJ=rp[ri];if("attribute"==rJ||"uniform"==rJ)ri=rA._parseOne(rM,rd,rp,ri,rJ,!0);else{if("#define"==rJ){rU[rJ=rp[++ri]]=1;continue}if("#ifdef"==rJ){rT[rY=rp[++ri]]=rT[rY]||[];for(ri++;ri<rR;ri++)if("attribute"==(rJ=rp[ri])||"uniform"==rJ)ri=rA._parseOne(rM,rd,rp,ri,rJ,rU[rY]);else if("#else"==rJ)for(ri++;ri<rR;ri++)if("attribute"==(rJ=rp[ri])||"uniform"==rJ)ri=rA._parseOne(rM,rd,rp,ri,rJ,!rU[rY]);else if("#endif"==rJ)break}}}}return rl},rA.splitToWords=function(rS,rQ){for(var re,rl,rM=[],rd=-1,rT=0,rU=rS.length;rT<rU;rT++)if(re=rS.charAt(rT),0<=" \t=+-*/&%!<>()'\",;".indexOf(re)){if(0<=rd&&1<rT-rd&&(rl=rS.substr(rd,rT-rd),rM.push(rl)),'"'==re||"'"==re){var ri=rS.indexOf(re,rT+1);if(ri<0)throw"Sharder err:"+rS;rM.push(rS.substr(rT+1,ri-rT-1)),rT=ri,rd=-1;continue}"("==re&&rQ&&0<rM.length&&(rl=rM[rM.length-1]+";","vec4;main;".indexOf(rl)<0&&(rQ.useFuns+=rl)),rd=-1}else rd<0&&(rd=rT);return rd<rU&&1<rU-rd&&(rl=rS.substr(rd,rU-rd),rM.push(rl)),rM},rA.IFDEF_NO=0,rA.IFDEF_YES=1,rA.IFDEF_ELSE=2,rA.IFDEF_PARENT=3,rA._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),rA._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),rA._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),rA.includes={},rT(rA,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),rA.__init$=function(){rz=function(){function re(rS){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=rS}rp(re,"");var rS=re.prototype;return rS.setParent=function(rS){rS.childs.push(this),this.z=rS.z+1,this.parent=rS},rS.setCondition=function(rS,rQ){rS&&(this.conditionType=rQ,rS=rS.replace(/(\s*$)/g,""),this.condition=function(){return this[rS]},this.condition.__condition=rS)},rS.toscript=function(rS,rQ){return this._toscript(rS,rQ,++re.__id)},rS._toscript=function(rl,rM,rd){if(this.childs.length<1&&!this.text)return rM;rM.length;if(this.condition){var rS=!!this.condition.call(rl);if(2===this.conditionType&&(rS=!rS),!rS)return rM}if(this.text&&rM.push(this.text),0<this.childs.length&&this.childs.forEach(function(rS,rQ,re){rS._toscript(rl,rM,rd)}),0<this.includefiles.length&&0<this.useFuns.length)for(var rQ,re=0,rT=this.includefiles.length;re<rT;re++)this.includefiles[re].curUseID!=rd&&0<(rQ=this.includefiles[re].file.getFunsScript(this.useFuns)).length&&(this.includefiles[re].curUseID=rd,rM[0]=rQ+rM[0]);return rM},re.__id=1,re}(),re=function(){function rS(rS){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=rS;for(var rQ=0,re=0,rl=0;!((rQ=rS.indexOf("#begin",rQ))<0);){for(rl=rQ+5;!((rl=rS.indexOf("#end",rl))<0)&&"i"===rS.charAt(rl+4);)rl+=5;if(rl<0)throw"add include err,no #end:"+rS;re=rS.indexOf("\n",rQ);var rM=rA.splitToWords(rS.substr(rQ,re-rQ),null);"code"==rM[1]?this.codes[rM[2]]=rS.substr(re+1,rl-re-1):"function"==rM[1]&&(re=rS.indexOf("function",rQ),re+="function".length,this.funs[rM[3]]=rS.substr(re+1,rl-re-1),this.funnames+=rM[3]+";"),rQ=rl+1}}rp(rS,"");var rQ=rS.prototype;return rQ.getWith=function(rS){var rQ=rS?this.codes[rS]:this.script;if(!rQ)throw"get with error:"+rS;return rQ},rQ.getFunsScript=function(rS){var rQ="";for(var re in this.funs)0<=rS.indexOf(re+";")&&(rQ+=this.funs[re]);return rQ},rS}()},rA}(),rvS=function(){function rT(){}return rp(rT,"laya.webgl.WebGL"),rT._uint8ArraySlice=function(){for(var rS=this.length,rQ=new Uint8Array(this.length),re=0;re<rS;re++)rQ[re]=this[re];return rQ},rT._float32ArraySlice=function(){for(var rS=this.length,rQ=new Float32Array(this.length),re=0;re<rS;re++)rQ[re]=this[re];return rQ},rT._uint16ArraySlice=function(rS){var rQ,re=arguments,rl=0,rM=0;if(0===re.length)for(rl=this.length,rQ=new Uint16Array(rl),rM=0;rM<rl;rM++)rQ[rM]=this[rM];else if(2===re.length){var rd=re[0],rT=re[1];if(rd<rT)for(rl=rT-rd,rQ=new Uint16Array(rl),rM=rd;rM<rT;rM++)rQ[rM-rd]=this[rM];else rQ=new Uint16Array(0)}return rQ},rT.expandContext=function(){var rS=rM.prototype,rQ=CanvasRenderingContext2D.prototype;rQ.fillTrangles=rS.fillTrangles,rKS.__int__(null),rQ.setIBVB=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){void 0===ri&&(ri=0),void 0===rR&&(rR=0),null===re&&(this._ib=this._ib||rsS.QuadrangleIB,re=this._ib,rcS.expandIBQuadrangle(re,rl._byteLength/64+8)),this._setIBVB(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR)},rQ.fillTrangles=function(rS,rQ,re,rl,rM){this._curMat=this._curMat||rg.create(),this._vb=this._vb||ryS.create(),this._ib||(this._ib=rsS.create(),rcS.fillIBQuadrangle(this._ib,rT/4));var rd=this._vb,rT=rl.length>>4;rcS.fillTranglesVB(rd,rQ,re,rl,rM||this._curMat,0,0),rcS.expandIBQuadrangle(this._ib,rd._byteLength/64+8);var rU=new rHS(1,0);rU.textureHost=rS;var ri=new r_S("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");rd._vertType=3,this._setIBVB(rQ,re,this._ib,rd,6*rT,rM,ri,rU,0,0)}},rT.enable=function(){if(rJ.__init__(),rG.isConchApp&&!rG.isConchWebGL)return rD.skinAniSprite=function(){return new rSS},rT.expandContext(),!1;if(rD.getWebGLContext=function(rS){for(var rQ,re=["webgl","experimental-webgl","webkit-3d","moz-webgl"],rl=0;rl<re.length;rl++){try{rQ=rS.getContext(re[rl],{stencil:rO.isStencil,alpha:rO.isAlpha,antialias:rO.isAntialias,premultipliedAlpha:rO.premultipliedAlpha,preserveDrawingBuffer:rO.preserveDrawingBuffer})}catch(rS){}if(rQ)return rQ}return null},null==(rT.mainContext=rD.getWebGLContext(rG._mainCanvas)))return!1;if(rG.isWebGL)return!0;rj.create=function(rS,rQ){return new rSQ(rS,rQ)},rc.create=function(rS,rQ,re,rl,rM,rd,rT){return new rNS(rS,rQ,re,rl,rM,rd,rT)},rG.WebGL=rT,rG.isWebGL=!0,rJS.__init__(),rD.createRenderSprite=function(rS,rQ){return new rgS(rS,rQ)},rD.createWebGLContext2D=function(rS){return new rOS(rS)},rD.changeWebGLSize=function(rS,rQ){laya.webgl.WebGL.onStageResize(rS,rQ)},rD.createGraphics=function(){return new rBS};var rS=rD.createFilterAction;return rD.createFilterAction=rS||function(rS){return new rIS},rD.clear=function(rS){rzS.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var rQ=rG.context.ctx,re=0==rQ._submits._length||rO.preserveDrawingBuffer?rL.create(rS)._color:rk._wgColor;re&&rQ.clearBG(re[0],re[1],re[2],re[3]),rzS.clear()},rD.addToAtlas=function(rS,rQ){void 0===rQ&&(rQ=!1);var re=rS.bitmap;rG.optimizeTextureMemory(rS.url,rS)?rB.__typeof(re,"laya.webgl.resource.IMergeAtlasBitmap")&&re.allowMerageInAtlas&&re.on("recovered",rS,rS.addTextureToAtlas):re.enableMerageInAtlas=!1},rD.isAtlas=function(rS){return rS instanceof laya.webgl.atlas.AtlasWebGLCanvas},ru._enable(),rD.beginFlush=function(){for(var rS=ru.instance,rQ=rS.getAtlaserCount(),re=0;re<rQ;re++){var rl=rS.getAtlaserByIndex(re).texture;rl._flashCacheImageNeedFlush&&rD.flashFlushImage(rl)}},rD.drawToCanvas=function(rS,rQ,re,rl,rM,rd){(re<=0||rl<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),re|=0,rl|=0,rM|=0,rd|=0;var rT=rPS.create(re,rl,6408,5121,0,!1);rT.start(),rT.clear(0,0,0,0),rG.context.clear(),rz.renders[rQ]._fun(rS,rG.context,rM,rzS.height-rl+rd),rG.context.flush(),rT.end();var rU=rT.getData(0,0,re,rl);if(rT.recycle(),rU.byteLength==re*rl*4){var ri=new rFS;ri._canvas=rJ.createElement("canvas"),ri.size(re,rl);var rR=ri._canvas.getContext("2d");rJ.canvas.size(re,rl);var ro=rJ.context,rY=ro.createImageData(re,rl);return rY.data.set(new Uint8ClampedArray(rU.buffer)),ri._imgData=rY,ro.putImageData(rY,0,0),rR.save(),rR.translate(0,rl),rR.scale(1,-1),rR.drawImage(rJ.canvas.source,0,0),rR.restore(),ri}console.log("drawToCanvas error: w:"+re+",h:"+rl+",datalen:"+rU.byteLength)},rD.createFilterAction=function(rS){var rQ;switch(rS){case 32:rQ=new rIS}return rQ},rD.addTextureToAtlas=function(rS){rS._uvID++,ru._atlasRestore++,rS.bitmap.enableMerageInAtlas&&ru.instance.addToAtlas(rS)},rD.getTexturePixels=function(rS,rQ,re,rl,rM){rG.context.ctx.clear();var rd=new rt;rd.graphics.drawTexture(rS,-rQ,-re);var rT=rPS.create(rl,rM);rT.start(),rT.clear(0,0,0,0),rd.render(rG.context,0,0),rG.context.ctx.flush(),rT.end();for(var rU=rT.getData(0,0,rl,rM),ri=[],rR=0,ro=rM-1;0<=ro;ro--)for(var rY=0;rY<rl;rY++)rR=4*(ro*rl+rY),ri.push(rU[rR]),ri.push(rU[rR+1]),ri.push(rU[rR+2]),ri.push(rU[rR+3]);return ri},rD.skinAniSprite=function(){return new rSS},rR.create=function(rS,rQ){var re=new rFS;return re._imgData=rQ,re.flipY=!1,re},rH._filterStart=function(rS,rQ,re,rl,rM){var rd=rS.getValue("bounds"),rT=rPS.create(rd.width,rd.height);if(rT.start(),rT.clear(0,0,0,0),rS.addValue("src",rT),rS.addValue("ScissorTest",rzS.worldScissorTest),rzS.worldScissorTest){var rU=new rE;rU.copyFrom(re.ctx._clipRect),rS.addValue("clipRect",rU),rzS.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},rH._filterEnd=function(rS,rQ,re,rl,rM){var rd=rS.getValue("bounds");rS.getValue("src").end();var rT=rPS.create(rd.width,rd.height);rT.start(),rT.clear(0,0,0,0),rS.addValue("out",rT),rQ._set$P("_filterCache",rT),rQ._set$P("_isHaveGlowFilter",rS.getValue("_isHaveGlowFilter"))},rH._EndTarget=function(rS,rQ){if(rS.getValue("src").recycle(),rS.getValue("out").end(),rS.getValue("ScissorTest")){rzS.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),rQ.ctx.save();var re=rS.getValue("clipRect");rQ.ctx.clipRect(re.x,re.y,re.width,re.height)}},rH._useSrc=function(rS){var rQ=rS.getValue("out");rQ.end(),(rQ=rS.getValue("src")).start(),rQ.clear(0,0,0,0)},rH._endSrc=function(rS){rS.getValue("src").end()},rH._useOut=function(rS){var rQ=rS.getValue("src");rQ.end(),(rQ=rS.getValue("out")).start(),rQ.clear(0,0,0,0)},rH._endOut=function(rS){rS.getValue("out").end()},rH._recycleScope=function(rS){rS.recycle()},rH._filter=function(rS,rQ,re,rl){var rM=this._next;if(rM){var rd,rT,rU=rS.filters,ri=rU.length;if(1==ri&&32==rU[0].type)return rQ.ctx.save(),rQ.ctx.setFilters([rU[0]]),rM._fun.call(rM,rS,rQ,re,rl),void rQ.ctx.restore();var rR=rUS.create(),ro=rI.TEMP,rY=rQ.ctx._getTransformMatrix(),rp=rg.create();rY.copyTo(rp);var rJ=0,rL=0,rj=!1,rc=rS._$P._filterCache?rS._$P._filterCache:null;if(!rc||rS._repaint){rj=rS._isHaveGlowFilter(),rR.addValue("_isHaveGlowFilter",rj),rj&&(rJ=50,rL=25),(rT=new rE).copyFrom(rS.getSelfBounds()),rT.x+=rS.x,rT.y+=rS.y,rT.x-=rS.pivotX+4,rT.y-=rS.pivotY+4;var rG=rT.x,rz=rT.y;if(rT.width+=rJ+8,rT.height+=rJ+8,ro.x=rT.x*rp.a+rT.y*rp.c,ro.y=rT.y*rp.d+rT.x*rp.b,rT.x=ro.x,rT.y=ro.y,ro.x=rT.width*rp.a+rT.height*rp.c,ro.y=rT.height*rp.d+rT.width*rp.b,rT.width=ro.x,rT.height=ro.y,rT.width<=0||rT.height<=0)return;rc&&rc.recycle(),rR.addValue("bounds",rT);var rA=rTS.create([rR,rS,rQ,0,0],rH._filterStart);rQ.addRenderObject(rA),rQ.ctx._renderKey=0,rQ.ctx._shader2D.glTexture=null;var rv=rS.x-rG+rL,rD=rS.y-rz+rL;rM._fun.call(rM,rS,rQ,rv,rD),rA=rTS.create([rR,rS,rQ,0,0],rH._filterEnd),rQ.addRenderObject(rA);for(var rB=0;rB<ri;rB++){0!=rB&&(rA=rTS.create([rR],rH._useSrc),rQ.addRenderObject(rA),rd=rHS.create(1,0),rg.TEMP.identity(),rQ.ctx.drawTarget(rR,0,0,rT.width,rT.height,rg.TEMP,"out",rd,null,rW.TOINT.overlay),rA=rTS.create([rR],rH._useOut),rQ.addRenderObject(rA)),rU[rB].action.apply3d(rR,rS,rQ,0,0)}rA=rTS.create([rR,rQ],rH._EndTarget),rQ.addRenderObject(rA)}else{if((rj=!!rS._$P._isHaveGlowFilter&&rS._$P._isHaveGlowFilter)&&(rJ=50,rL=25),(rT=rS.getBounds()).width<=0||rT.height<=0)return;rT.width+=rJ,rT.height+=rJ,ro.x=rT.x*rp.a+rT.y*rp.c,ro.y=rT.y*rp.d+rT.x*rp.b,rT.x=ro.x,rT.y=ro.y,ro.x=rT.width*rp.a+rT.height*rp.c,ro.y=rT.height*rp.d+rT.width*rp.b,rT.width=ro.x,rT.height=ro.y,rR.addValue("out",rc)}re=re-rL-rS.x,rl=rl-rL-rS.y,ro.setTo(re,rl),rp.transformPoint(ro),re=ro.x+rT.x,rl=ro.y+rT.y,rd=rHS.create(1,0),rg.TEMP.identity(),rQ.ctx.drawTarget(rR,re,rl,rT.width,rT.height,rg.TEMP,"out",rd,null,rW.TOINT.overlay),rA=rTS.create([rR],rH._recycleScope),rQ.addRenderObject(rA),rp.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=rT._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=rT._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=rT._uint8ArraySlice),!0},rT.onStageResize=function(rS,rQ){null!=rT.mainContext&&(rT.mainContext.viewport(0,0,rS,rQ),rzS.width=rS,rzS.height=rQ)},rT.onInvalidGLRes=function(){ru.instance.freeAll(),rv.releaseContentManagers(!0),rT.doNodeRepaint(rB.stage),rT.mainContext.viewport(0,0,rzS.width,rzS.height),rB.stage.event("devicelost")},rT.doNodeRepaint=function(rS){0==rS.numChildren&&rS.repaint();for(var rQ=0;rQ<rS.numChildren;rQ++)rT.doNodeRepaint(rS.getChildAt(rQ))},rT.init=function(rS,rQ,re){rT.mainCanvas=rS,rR._createContext=function(rS){return new rOS(rS)},rFS._createContext=function(rS){return new rOS(rS)};var rl=laya.webgl.WebGL.mainContext;if(null!=rl.getShaderPrecisionFormat){var rM=rl.getShaderPrecisionFormat(35633,36338),rd=rl.getShaderPrecisionFormat(35632,36338);rT.shaderHighPrecision=!(!rM.precision||!rd.precision)}else rT.shaderHighPrecision=!1;if(rl.deleteTexture1=rl.deleteTexture,rl.deleteTexture=function(rS){rS==rDS.curBindTexValue&&(rDS.curBindTexValue=null),rl.deleteTexture1(rS)},rT.onStageResize(rQ,re),null==rT.mainContext)throw new Error("webGL getContext err!");rb.__init__(),ru.__init__(),rtS.__init__(),rdS.__init__(),rOS.__init__(),rHS.__init__(),rs.__init__(),rKS.__int__(rl),rW._init_(rl),rG.isConchApp&&conch.setOnInvalidGLRes(rT.onInvalidGLRes)},rT.mainCanvas=null,rT.mainContext=null,rT.antialias=!0,rT.shaderHighPrecision=!1,rT._bg_null=[0,0,0,0],rT}(),rDS=function(){function rl(){}return rp(rl,"laya.webgl.WebGLContext"),rl.UseProgram=function(rS){return rl._useProgram!==rS&&(rvS.mainContext.useProgram(rS),rl._useProgram=rS,!0)},rl.setDepthTest=function(rS,rQ){rQ!==rl._depthTest&&((rl._depthTest=rQ)?rS.enable(2929):rS.disable(2929))},rl.setDepthMask=function(rS,rQ){rQ!==rl._depthMask&&(rl._depthMask=rQ,rS.depthMask(rQ))},rl.setDepthFunc=function(rS,rQ){rQ!==rl._depthFunc&&(rl._depthFunc=rQ,rS.depthFunc(rQ))},rl.setBlend=function(rS,rQ){rQ!==rl._blend&&((rl._blend=rQ)?rS.enable(3042):rS.disable(3042))},rl.setBlendFunc=function(rS,rQ,re){(rQ!==rl._sFactor||re!==rl._dFactor)&&(rl._sFactor=rQ,rl._dFactor=re,rS.blendFunc(rQ,re))},rl.setCullFace=function(rS,rQ){rQ!==rl._cullFace&&((rl._cullFace=rQ)?rS.enable(2884):rS.disable(2884))},rl.setFrontFace=function(rS,rQ){rQ!==rl._frontFace&&(rl._frontFace=rQ,rS.frontFace(rQ))},rl.bindTexture=function(rS,rQ,re){rS.bindTexture(rQ,re),rl.curBindTexTarget=rQ,rl.curBindTexValue=re},rl.DEPTH_BUFFER_BIT=256,rl.STENCIL_BUFFER_BIT=1024,rl.COLOR_BUFFER_BIT=16384,rl.POINTS=0,rl.LINES=1,rl.LINE_LOOP=2,rl.LINE_STRIP=3,rl.TRIANGLES=4,rl.TRIANGLE_STRIP=5,rl.TRIANGLE_FAN=6,rl.ZERO=0,rl.ONE=1,rl.SRC_COLOR=768,rl.ONE_MINUS_SRC_COLOR=769,rl.SRC_ALPHA=770,rl.ONE_MINUS_SRC_ALPHA=771,rl.DST_ALPHA=772,rl.ONE_MINUS_DST_ALPHA=773,rl.DST_COLOR=774,rl.ONE_MINUS_DST_COLOR=775,rl.SRC_ALPHA_SATURATE=776,rl.FUNC_ADD=32774,rl.BLEND_EQUATION=32777,rl.BLEND_EQUATION_RGB=32777,rl.BLEND_EQUATION_ALPHA=34877,rl.FUNC_SUBTRACT=32778,rl.FUNC_REVERSE_SUBTRACT=32779,rl.BLEND_DST_RGB=32968,rl.BLEND_SRC_RGB=32969,rl.BLEND_DST_ALPHA=32970,rl.BLEND_SRC_ALPHA=32971,rl.CONSTANT_COLOR=32769,rl.ONE_MINUS_CONSTANT_COLOR=32770,rl.CONSTANT_ALPHA=32771,rl.ONE_MINUS_CONSTANT_ALPHA=32772,rl.BLEND_COLOR=32773,rl.ARRAY_BUFFER=34962,rl.ELEMENT_ARRAY_BUFFER=34963,rl.ARRAY_BUFFER_BINDING=34964,rl.ELEMENT_ARRAY_BUFFER_BINDING=34965,rl.STREAM_DRAW=35040,rl.STATIC_DRAW=35044,rl.DYNAMIC_DRAW=35048,rl.BUFFER_SIZE=34660,rl.BUFFER_USAGE=34661,rl.CURRENT_VERTEX_ATTRIB=34342,rl.FRONT=1028,rl.BACK=1029,rl.CULL_FACE=2884,rl.FRONT_AND_BACK=1032,rl.BLEND=3042,rl.DITHER=3024,rl.STENCIL_TEST=2960,rl.DEPTH_TEST=2929,rl.SCISSOR_TEST=3089,rl.POLYGON_OFFSET_FILL=32823,rl.SAMPLE_ALPHA_TO_COVERAGE=32926,rl.SAMPLE_COVERAGE=32928,rl.NO_ERROR=0,rl.INVALID_ENUM=1280,rl.INVALID_VALUE=1281,rl.INVALID_OPERATION=1282,rl.OUT_OF_MEMORY=1285,rl.CW=2304,rl.CCW=2305,rl.LINE_WIDTH=2849,rl.ALIASED_POINT_SIZE_RANGE=33901,rl.ALIASED_LINE_WIDTH_RANGE=33902,rl.CULL_FACE_MODE=2885,rl.FRONT_FACE=2886,rl.DEPTH_RANGE=2928,rl.DEPTH_WRITEMASK=2930,rl.DEPTH_CLEAR_VALUE=2931,rl.DEPTH_FUNC=2932,rl.STENCIL_CLEAR_VALUE=2961,rl.STENCIL_FUNC=2962,rl.STENCIL_FAIL=2964,rl.STENCIL_PASS_DEPTH_FAIL=2965,rl.STENCIL_PASS_DEPTH_PASS=2966,rl.STENCIL_REF=2967,rl.STENCIL_VALUE_MASK=2963,rl.STENCIL_WRITEMASK=2968,rl.STENCIL_BACK_FUNC=34816,rl.STENCIL_BACK_FAIL=34817,rl.STENCIL_BACK_PASS_DEPTH_FAIL=34818,rl.STENCIL_BACK_PASS_DEPTH_PASS=34819,rl.STENCIL_BACK_REF=36003,rl.STENCIL_BACK_VALUE_MASK=36004,rl.STENCIL_BACK_WRITEMASK=36005,rl.VIEWPORT=2978,rl.SCISSOR_BOX=3088,rl.COLOR_CLEAR_VALUE=3106,rl.COLOR_WRITEMASK=3107,rl.UNPACK_ALIGNMENT=3317,rl.PACK_ALIGNMENT=3333,rl.MAX_TEXTURE_SIZE=3379,rl.MAX_VIEWPORT_DIMS=3386,rl.SUBPIXEL_BITS=3408,rl.RED_BITS=3410,rl.GREEN_BITS=3411,rl.BLUE_BITS=3412,rl.ALPHA_BITS=3413,rl.DEPTH_BITS=3414,rl.STENCIL_BITS=3415,rl.POLYGON_OFFSET_UNITS=10752,rl.POLYGON_OFFSET_FACTOR=32824,rl.TEXTURE_BINDING_2D=32873,rl.SAMPLE_BUFFERS=32936,rl.SAMPLES=32937,rl.SAMPLE_COVERAGE_VALUE=32938,rl.SAMPLE_COVERAGE_INVERT=32939,rl.NUM_COMPRESSED_TEXTURE_FORMATS=34466,rl.COMPRESSED_TEXTURE_FORMATS=34467,rl.DONT_CARE=4352,rl.FASTEST=4353,rl.NICEST=4354,rl.GENERATE_MIPMAP_HINT=33170,rl.BYTE=5120,rl.UNSIGNED_BYTE=5121,rl.SHORT=5122,rl.UNSIGNED_SHORT=5123,rl.INT=5124,rl.UNSIGNED_INT=5125,rl.FLOAT=5126,rl.DEPTH_COMPONENT=6402,rl.ALPHA=6406,rl.RGB=6407,rl.RGBA=6408,rl.LUMINANCE=6409,rl.LUMINANCE_ALPHA=6410,rl.UNSIGNED_SHORT_4_4_4_4=32819,rl.UNSIGNED_SHORT_5_5_5_1=32820,rl.UNSIGNED_SHORT_5_6_5=33635,rl.FRAGMENT_SHADER=35632,rl.VERTEX_SHADER=35633,rl.MAX_VERTEX_ATTRIBS=34921,rl.MAX_VERTEX_UNIFORM_VECTORS=36347,rl.MAX_VARYING_VECTORS=36348,rl.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,rl.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,rl.MAX_TEXTURE_IMAGE_UNITS=34930,rl.MAX_FRAGMENT_UNIFORM_VECTORS=36349,rl.SHADER_TYPE=35663,rl.DELETE_STATUS=35712,rl.LINK_STATUS=35714,rl.VALIDATE_STATUS=35715,rl.ATTACHED_SHADERS=35717,rl.ACTIVE_UNIFORMS=35718,rl.ACTIVE_ATTRIBUTES=35721,rl.SHADING_LANGUAGE_VERSION=35724,rl.CURRENT_PROGRAM=35725,rl.NEVER=512,rl.LESS=513,rl.EQUAL=514,rl.LEQUAL=515,rl.GREATER=516,rl.NOTEQUAL=517,rl.GEQUAL=518,rl.ALWAYS=519,rl.KEEP=7680,rl.REPLACE=7681,rl.INCR=7682,rl.DECR=7683,rl.INVERT=5386,rl.INCR_WRAP=34055,rl.DECR_WRAP=34056,rl.VENDOR=7936,rl.RENDERER=7937,rl.VERSION=7938,rl.NEAREST=9728,rl.LINEAR=9729,rl.NEAREST_MIPMAP_NEAREST=9984,rl.LINEAR_MIPMAP_NEAREST=9985,rl.NEAREST_MIPMAP_LINEAR=9986,rl.LINEAR_MIPMAP_LINEAR=9987,rl.TEXTURE_MAG_FILTER=10240,rl.TEXTURE_MIN_FILTER=10241,rl.TEXTURE_WRAP_S=10242,rl.TEXTURE_WRAP_T=10243,rl.TEXTURE_2D=3553,rl.TEXTURE=5890,rl.TEXTURE_CUBE_MAP=34067,rl.TEXTURE_BINDING_CUBE_MAP=34068,rl.TEXTURE_CUBE_MAP_POSITIVE_X=34069,rl.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,rl.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,rl.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,rl.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,rl.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,rl.MAX_CUBE_MAP_TEXTURE_SIZE=34076,rl.TEXTURE0=33984,rl.TEXTURE1=33985,rl.TEXTURE2=33986,rl.TEXTURE3=33987,rl.TEXTURE4=33988,rl.TEXTURE5=33989,rl.TEXTURE6=33990,rl.TEXTURE7=33991,rl.TEXTURE8=33992,rl.TEXTURE9=33993,rl.TEXTURE10=33994,rl.TEXTURE11=33995,rl.TEXTURE12=33996,rl.TEXTURE13=33997,rl.TEXTURE14=33998,rl.TEXTURE15=33999,rl.TEXTURE16=34e3,rl.TEXTURE17=34001,rl.TEXTURE18=34002,rl.TEXTURE19=34003,rl.TEXTURE20=34004,rl.TEXTURE21=34005,rl.TEXTURE22=34006,rl.TEXTURE23=34007,rl.TEXTURE24=34008,rl.TEXTURE25=34009,rl.TEXTURE26=34010,rl.TEXTURE27=34011,rl.TEXTURE28=34012,rl.TEXTURE29=34013,rl.TEXTURE30=34014,rl.TEXTURE31=34015,rl.ACTIVE_TEXTURE=34016,rl.REPEAT=10497,rl.CLAMP_TO_EDGE=33071,rl.MIRRORED_REPEAT=33648,rl.FLOAT_VEC2=35664,rl.FLOAT_VEC3=35665,rl.FLOAT_VEC4=35666,rl.INT_VEC2=35667,rl.INT_VEC3=35668,rl.INT_VEC4=35669,rl.BOOL=35670,rl.BOOL_VEC2=35671,rl.BOOL_VEC3=35672,rl.BOOL_VEC4=35673,rl.FLOAT_MAT2=35674,rl.FLOAT_MAT3=35675,rl.FLOAT_MAT4=35676,rl.SAMPLER_2D=35678,rl.SAMPLER_CUBE=35680,rl.VERTEX_ATTRIB_ARRAY_ENABLED=34338,rl.VERTEX_ATTRIB_ARRAY_SIZE=34339,rl.VERTEX_ATTRIB_ARRAY_STRIDE=34340,rl.VERTEX_ATTRIB_ARRAY_TYPE=34341,rl.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,rl.VERTEX_ATTRIB_ARRAY_POINTER=34373,rl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,rl.COMPILE_STATUS=35713,rl.LOW_FLOAT=36336,rl.MEDIUM_FLOAT=36337,rl.HIGH_FLOAT=36338,rl.LOW_INT=36339,rl.MEDIUM_INT=36340,rl.HIGH_INT=36341,rl.FRAMEBUFFER=36160,rl.RENDERBUFFER=36161,rl.RGBA4=32854,rl.RGB5_A1=32855,rl.RGB565=36194,rl.DEPTH_COMPONENT16=33189,rl.STENCIL_INDEX=6401,rl.STENCIL_INDEX8=36168,rl.DEPTH_STENCIL=34041,rl.RENDERBUFFER_WIDTH=36162,rl.RENDERBUFFER_HEIGHT=36163,rl.RENDERBUFFER_INTERNAL_FORMAT=36164,rl.RENDERBUFFER_RED_SIZE=36176,rl.RENDERBUFFER_GREEN_SIZE=36177,rl.RENDERBUFFER_BLUE_SIZE=36178,rl.RENDERBUFFER_ALPHA_SIZE=36179,rl.RENDERBUFFER_DEPTH_SIZE=36180,rl.RENDERBUFFER_STENCIL_SIZE=36181,rl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,rl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,rl.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,rl.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,rl.COLOR_ATTACHMENT0=36064,rl.DEPTH_ATTACHMENT=36096,rl.STENCIL_ATTACHMENT=36128,rl.DEPTH_STENCIL_ATTACHMENT=33306,rl.NONE=0,rl.FRAMEBUFFER_COMPLETE=36053,rl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,rl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,rl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,rl.FRAMEBUFFER_UNSUPPORTED=36061,rl.FRAMEBUFFER_BINDING=36006,rl.RENDERBUFFER_BINDING=36007,rl.MAX_RENDERBUFFER_SIZE=34024,rl.INVALID_FRAMEBUFFER_OPERATION=1286,rl.UNPACK_FLIP_Y_WEBGL=37440,rl.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,rl.CONTEXT_LOST_WEBGL=37442,rl.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,rl.BROWSER_DEFAULT_WEBGL=37444,rl._useProgram=null,rl._depthTest=!0,rl._depthMask=!0,rl._blend=!1,rl._cullFace=!1,rl.curBindTexTarget=null,rl.curBindTexValue=null,rT(rl,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),rl}(),rBS=function(rS){function rQ(){rQ.__super.call(this)}rp(rQ,"laya.webgl.display.GraphicsGL",rU);var re=rQ.prototype;return re.setShader=function(rS){this._saveToCmd(rG.context._setShader,[rS])},re.setIBVB=function(rS,rQ,re,rl,rM,rd){this._saveToCmd(rG.context._setIBVB,[rS,rQ,re,rl,rM,rd])},re.drawParticle=function(rS,rQ,re){var rl=rD.createParticleTemplate2D(re);rl.x=rS,rl.y=rQ,this._saveToCmd(rG.context._drawParticle,[rl])},rQ}(),rOS=function(rS){var re;function rw(rS){this._x=0,this._y=0,this._id=++rw._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,rw.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=rw.MAXCLIPRECT,this.mOutPoint,this._canvas=rS,this._canvas._addReference(),rw._contextcount++,rG.isFlash?(this._ib=rsS.create(35044),rcS.fillIBQuadrangle(this._ib,16)):this._ib=rsS.QuadrangleIB,this.clear()}rp(rw,"laya.webgl.canvas.WebGLContext2D",rM);var rQ=rw.prototype;return rQ.setIsMainContext=function(){this._isMain=!0},rQ.clearBG=function(rS,rQ,re,rl){var rM=rvS.mainContext;rM.clearColor(rS,rQ,re,rl),rM.clear(16384)},rQ._getSubmits=function(){return this._submits},rQ._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var rS=0,rQ=this._submits._length;rS<rQ;rS++)this._submits[rS].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},rQ.destroy=function(){--rw._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=rsS.QuadrangleIB&&this._ib.releaseResource()},rQ.clear=function(){this._submits||(this._other=re.DEFAULT,this._curMat=rg.create(),this._vb=ryS.create(-1),this._submits=[],this._save=[rC.Create(this)],this._save.length=10,this._shader2D=new rs,this._triangleMesh=r$S.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=re.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=rw.MAXCLIPRECT,this._curSubmit=rdS.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=rx.DEFAULT;for(var rS=0,rQ=this._submits._length;rS<rQ;rS++)this._submits[rS].releaseRender(),this._submits[rS]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},rQ.size=function(rS,rQ){if(this._width!=rS||this._height!=rQ)if(0==rS||0==rQ){0!=this._vb._byteLength&&(this._width=rS,this._height=rQ,this._vb.clear(),this._vb.upload());for(var re=0,rl=this._submits._length;re<rl;re++)this._submits[re].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=rS,this._height=rQ,this._targets&&this._targets.size(rS,rQ),this._canvas.memorySize-=this._canvas.memorySize;0===rS&&0===rQ&&this._releaseMem()},rQ._getTransformMatrix=function(){return this._curMat},rQ.translate=function(rS,rQ){0===rS&&0===rQ||(rV.save(this),this._curMat.bTransform&&(rK.save(this),this._curMat.transformPointN(rI.TEMP.setTo(rS,rQ)),rS=rI.TEMP.x,rQ=rI.TEMP.y),this._x+=rS,this._y+=rQ)},rQ.save=function(){this._save[this._save._length++]=rC.Create(this)},rQ.restore=function(){var rS=this._save._length;if(!(rS<1))for(var rQ=rS-1;0<=rQ;rQ--){var re=this._save[rQ];if(re.restore(this),re.isSaveMark())return void(this._save._length=rQ)}},rQ._fillText=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){void 0===rR&&(rR=0);var ro=this._shader2D,rY=this._curSubmit.shaderValue,rp=rM?rLS.create(rM):this._other.font;if(ru.enabled)ro.ALPHA!==rY.ALPHA&&(ro.glTexture=null),rJS.drawText(this,rS,rQ,this._curMat,rp,ri||this._other.textAlign,rd,rT,rU,re,rl,rR);else{this._shader2D.defines.getValue();var rJ=rd?rL.create(rd)._color:ro.colorAdd;ro.ALPHA===rY.ALPHA&&rJ===ro.colorAdd&&rY.colorAdd===ro.colorAdd||(ro.glTexture=null,ro.colorAdd=rJ),rJS.drawText(this,rS,rQ,this._curMat,rp,ri||this._other.textAlign,rd,rT,rU,re,rl,rR)}},rQ.fillWords=function(rS,rQ,re,rl,rM,rd){this._fillText(null,rS,rQ,re,rl,rM,null,-1,null,rd)},rQ.fillBorderWords=function(rS,rQ,re,rl,rM,rd,rT){this._fillBorderText(null,rS,rQ,re,rl,rM,rd,rT,null)},rQ.fillText=function(rS,rQ,re,rl,rM,rd){this._fillText(rS,null,rQ,re,rl,rM,null,-1,rd)},rQ.strokeText=function(rS,rQ,re,rl,rM,rd,rT){this._fillText(rS,null,rQ,re,rl,null,rM,rd||1,rT)},rQ.fillBorderText=function(rS,rQ,re,rl,rM,rd,rT,rU){this._fillBorderText(rS,null,rQ,re,rl,rM,rd,rT,rU)},rQ._fillBorderText=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){if(!ru.enabled)return this._fillText(rS,rQ,re,rl,rM,null,rT,rU||1,ri),void this._fillText(rS,rQ,re,rl,rM,rd,null,-1,ri);var rR=this._shader2D,ro=this._curSubmit.shaderValue;rR.ALPHA!==ro.ALPHA&&(rR.glTexture=null);var rY=rM?(rw._fontTemp.setFont(rM),rw._fontTemp):this._other.font;rJS.drawText(this,rS,rQ,this._curMat,rY,ri||this._other.textAlign,rd,rT,rU||1,re,rl,0)},rQ.fillRect=function(rS,rQ,re,rl,rM){var rd=this._vb;if(rcS.fillRectImgVb(rd,this._clipRect,rS,rQ,re,rl,r$.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var rT=this._shader2D.fillStyle;rM&&(this._shader2D.fillStyle=rx.create(rM));var rU=this._shader2D,ri=this._curSubmit.shaderValue;if(rU.fillStyle!==ri.fillStyle||rU.ALPHA!==ri.ALPHA){rU.glTexture=null;var rR=this._curSubmit=rdS.createSubmit(this,this._ib,rd,(rd._byteLength-64)/32*3,rHS.create(2,0));rR.shaderValue.color=rU.fillStyle._color._color,rR.shaderValue.ALPHA=rU.ALPHA,this._submits[this._submits._length++]=rR}this._curSubmit._numEle+=6,this._shader2D.fillStyle=rT}},rQ.fillTexture=function(rS,rQ,re,rl,rM,rd,rT,rU){if(rS.loaded&&rS.bitmap&&rS.source){var ri=this._vb,rR=rS.bitmap.width,ro=rS.bitmap.height,rY=rS.uv,rp=rT.x%rS.width,rJ=rT.y%rS.height;if(rR!=rU.w||ro!=rU.h){if(!rU.w&&!rU.h)switch(rU.oy=rU.ox=0,rd){case"repeat":rU.width=rl,rU.height=rM;break;case"repeat-x":rU.width=rl,rJ<0?rS.height+rJ>rM?rU.height=rM:rU.height=rS.height+rJ:(rU.oy=rJ,rS.height+rJ>rM?rU.height=rM-rJ:rU.height=rS.height);break;case"repeat-y":rp<0?rS.width+rp>rl?rU.width=rl:rU.width=rS.width+rp:(rU.ox=rp,rS.width+rp>rl?rU.width=rl-rp:rU.width=rS.width),rU.height=rM;break;case"no-repeat":rp<0?rS.width+rp>rl?rU.width=rl:rU.width=rS.width+rp:(rU.ox=rp,rS.width+rp>rl?rU.width=rl-rp:rU.width=rS.width),rJ<0?rS.height+rJ>rM?rU.height=rM:rU.height=rS.height+rJ:(rU.oy=rJ,rS.height+rJ>rM?rU.height=rM-rJ:rU.height=rS.height);break;default:rU.width=rl,rU.height=rM}rU.w=rR,rU.h=ro,rU.uv=[0,0,rU.width/rR,0,rU.width/rR,rU.height/ro,0,rU.height/ro]}if(rQ+=rU.ox,re+=rU.oy,rp-=rU.ox,rJ-=rU.oy,rcS.fillRectImgVb(ri,this._clipRect,rQ,re,rU.width,rU.height,rU.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var rL=rmS.create(this,this._ib,ri,(ri._byteLength-64)/32*3,rHS.create(256,0)),rj=(this._submits[this._submits._length++]=rL).shaderValue;rj.textureHost=rS;var rc=rY[0]*rR,rG=rY[1]*ro,rz=(rY[2]-rY[0])*rR,rA=(rY[5]-rY[3])*ro,rv=-rp/rR,rD=-rJ/ro;rj.u_TexRange[0]=rc/rR,rj.u_TexRange[1]=rz/rR,rj.u_TexRange[2]=rG/ro,rj.u_TexRange[3]=rA/ro,rj.u_offset[0]=rv,rj.u_offset[1]=rD,ru.enabled&&!this._isMain&&rL.addTexture(rS,(ri._byteLength>>2)-16),(this._curSubmit=rL)._renderType=10017,rL._numEle+=6}}else this.sprite&&rB.timer.callLater(this,this._repaintSprite)},rQ.setShader=function(rS){rq.save(this,1048576,this._shader2D,!0),this._shader2D.shader=rS},rQ.setFilters=function(rS){rq.save(this,2097152,this._shader2D,!0),this._shader2D.filters=rS,this._curSubmit=rdS.RENDERBASE,this._renderKey=0,this._drawCount++},rQ.drawTexture=function(rS,rQ,re,rl,rM,rd,rT){this._drawTextureM(rS,rQ,re,rl,rM,rd,rT,null,1)},rQ.addTextureVb=function(rS,rQ,re){var rl=this._curSubmit._vb||this._vb,rM=rl._byteLength>>2;rl.byteLength=rM+16<<2;for(var rd=rl.getFloat32Array(),rT=0;rT<16;rT+=4)rd[rM++]=rS[rT]+rQ,rd[rM++]=rS[rT+1]+re,rd[rM++]=rS[rT+2],rd[rM++]=rS[rT+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),rl._upload=!0},rQ.willDrawTexture=function(rS,rQ){if(!(rS.loaded&&rS.bitmap&&rS.source))return this.sprite&&rB.timer.callLater(this,this._repaintSprite),0;var re=rS.bitmap,rl=re.id+this._shader2D.ALPHA*rQ+10016;if(rl==this._renderKey)return rl;var rM=this._shader2D,rd=rM.ALPHA,rT=this._curSubmit.shaderValue;rM.ALPHA*=rQ,this._renderKey=rl,this._drawCount++,rM.glTexture=re;var rU=this._vb,ri=null,rR=rU._byteLength/32*3,ro=rT.textureHost&&rT.textureHost==rS&&rT.textureHost.alphaTexture==rS.alphaTexture;return ri=rmS.create(this,this._ib,rU,rR,rHS.create(1,0)),(this._submits[this._submits._length++]=ri).shaderValue.textureHost=rS,ri._renderType=10016,ri._preIsSameTextureShader=10016===this._curSubmit._renderType&&rM.ALPHA===rT.ALPHA&&ro,this._curSubmit=ri,rM.ALPHA=rd,rl},rQ.drawTextures=function(rS,rQ,re,rl){if(rS.loaded&&rS.bitmap&&rS.source){var rM=this._clipRect;if(this._clipRect=rw.MAXCLIPRECT,this._drawTextureM(rS,rQ[0],rQ[1],rS.width,rS.height,re,rl,null,1)){if(this._clipRect=rM,rX.drawCall++,!(rQ.length<4)){for(var rd=this._curSubmit._vb||this._vb,rT=this._curMat.a,rU=this._curMat.d,ri=2,rR=rQ.length;ri<rR;ri+=2)rcS.copyPreImgVb(rd,(rQ[ri]-rQ[ri-2])*rT,(rQ[ri+1]-rQ[ri-1])*rU),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&rB.timer.callLater(this,this._repaintSprite)},rQ._drawTextureM=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){if(!rS.loaded||!rS.source)return this.sprite&&rB.timer.callLater(this,this._repaintSprite),!1;var rR=this._curSubmit._vb||this._vb,ro=rS.bitmap;rQ+=rd,re+=rT,this._drawCount++;var rY=ro.id+this._shader2D.ALPHA*ri+10016;if(rY!=this._renderKey){this._renderKey=rY;var rp=this._curSubmit.shaderValue,rJ=this._shader2D,rL=rJ.ALPHA;rJ.ALPHA*=ri,rJ.glTexture=ro;var rj=this._vb,rc=null,rG=rj._byteLength/32*3,rz=rp.textureHost&&rp.textureHost==rS&&rp.textureHost.alphaTexture==rS.alphaTexture;rc=rmS.create(this,this._ib,rj,rG,rHS.create(1,0)),(this._submits[this._submits._length++]=rc).shaderValue.textureHost=rS,rc._renderType=10016,rc._preIsSameTextureShader=10016===this._curSubmit._renderType&&rJ.ALPHA===rp.ALPHA&&rz,this._curSubmit=rc,rR=this._curSubmit._vb||this._vb,rJ.ALPHA=rL}return!!rcS.fillRectImgVb(rR,this._clipRect,rQ,re,rl||rS.width,rM||rS.height,rS.uv,rU||this._curMat,this._x,this._y,0,0)&&(ru.enabled&&!this._isMain&&this._curSubmit.addTexture(rS,(rR._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},rQ._repaintSprite=function(){this.sprite&&this.sprite.repaint()},rQ._drawText=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){var ro=rS.bitmap;this._drawCount++;var rY=ro.id+this._shader2D.ALPHA+10016;if(rY!=this._renderKey){this._renderKey=rY;var rp=this._curSubmit.shaderValue,rJ=this._shader2D;rJ.glTexture=ro;var rL=this._vb,rj=null,rc=rL._byteLength/32*3,rG=rp.textureHost&&rp.textureHost==rS&&rp.textureHost.alphaTexture==rS.alphaTexture;(rj=ru.enabled?rmS.create(this,this._ib,rL,rc,rHS.create(1,0)):rmS.create(this,this._ib,rL,rc,rVS.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&rJ.ALPHA===rp.ALPHA&&rG,(this._submits[this._submits._length++]=rj).shaderValue.textureHost=rS,rj._renderType=10016,this._curSubmit=rj}rS.active();var rz=this._curSubmit._vb||this._vb;rcS.fillRectImgVb(rz,this._clipRect,rQ+rT,re+rU,rl||rS.width,rM||rS.height,rS.uv,rd||this._curMat,this._x,this._y,ri,rR,!0)&&(ru.enabled&&!this._isMain&&this._curSubmit.addTexture(rS,(rz._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},rQ.drawTextureWithTransform=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){if(rd){var rR=this._curMat,ro=this._x,rY=this._y;(0!==rT||0!==rU)&&(this._x=rT*rR.a+rU*rR.c,this._y=rU*rR.d+rT*rR.b),rd&&rR.bTransform?(rg.mul(rd,rR,rw._tmpMatrix),(rd=rw._tmpMatrix)._checkTransform()):(this._x+=rR.tx,this._y+=rR.ty),this._drawTextureM(rS,rQ,re,rl,rM,0,0,rd,ri),this._x=ro,this._y=rY}else this._drawTextureM(rS,rQ,re,rl,rM,rT,rU,null,ri)},rQ.fillQuadrangle=function(rS,rQ,re,rl,rM){var rd=this._curSubmit,rT=this._vb,rU=this._shader2D,ri=rd.shaderValue;if(this._renderKey=0,rS.bitmap){var rR=rS.bitmap;rU.glTexture==rR&&rU.ALPHA===ri.ALPHA||(rU.glTexture=rR,(rd=this._curSubmit=rdS.createSubmit(this,this._ib,rT,rT._byteLength/32*3,rHS.create(1,0))).shaderValue.glTexture=rR,this._submits[this._submits._length++]=rd),rcS.fillQuadrangleImgVb(rT,rQ,re,rl,rS.uv,rM||this._curMat,this._x,this._y)}else rd.shaderValue.fillStyle&&rd.shaderValue.fillStyle.equal(rS)&&rU.ALPHA===ri.ALPHA||(rU.glTexture=null,(rd=this._curSubmit=rdS.createSubmit(this,this._ib,rT,rT._byteLength/32*3,rHS.create(2,0))).shaderValue.defines.add(2),rd.shaderValue.fillStyle=rx.create(rS),this._submits[this._submits._length++]=rd),rcS.fillQuadrangleImgVb(rT,rQ,re,rl,r$.DEF_UV,rM||this._curMat,this._x,this._y);rd._numEle+=6},rQ.drawTexture2=function(rS,rQ,re,rl,rM,rd,rT,rU){if(0!=rd){var ri=this._curMat;if(this._x=rS*ri.a+rQ*ri.c,this._y=rQ*ri.d+rS*ri.b,rM&&(rM=ri.bTransform||rM.bTransform?(rg.mul(rM,ri,rw._tmpMatrix),rw._tmpMatrix):(this._x+=rM.tx+ri.tx,this._y+=rM.ty+ri.ty,rg.EMPTY)),1!==rd||rT){var rR=this._shader2D.ALPHA,ro=this._nBlendType;this._shader2D.ALPHA=rd,rT&&(this._nBlendType=rW.TOINT(rT)),this._drawTextureM(rU[0],rU[1]-re,rU[2]-rl,rU[3],rU[4],0,0,rM,1),this._shader2D.ALPHA=rR,this._nBlendType=ro}else this._drawTextureM(rU[0],rU[1]-re,rU[2]-rl,rU[3],rU[4],0,0,rM,1);this._x=this._y=0}},rQ.drawCanvas=function(rS,rQ,re,rl,rM){var rd=rS.context;if(this._renderKey=0,rd._targets)this._submits[this._submits._length++]=rbS.create(rd,0,null),this._curSubmit=rdS.RENDERBASE,rd._targets.drawTo(this,rQ,re,rl,rM);else{var rT=this._submits[this._submits._length++]=rbS.create(rd,this._shader2D.ALPHA,this._shader2D.filters),rU=rl/rS.width,ri=rM/rS.height,rR=rT._matrix;this._curMat.copyTo(rR),1!=rU&&1!=ri&&rR.scale(rU,ri);var ro=rR.tx,rY=rR.ty;rR.tx=rR.ty=0,rR.transformPoint(rI.TEMP.setTo(rQ,re)),rR.translate(rI.TEMP.x+ro,rI.TEMP.y+rY),this._curSubmit=rdS.RENDERBASE}rO.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=rd._targets?"yellow":"green",this.strokeRect(rQ-1,re-1,rl+2,rM+2,1),this.strokeRect(rQ,re,rl,rM,1),this.restore())},rQ.drawTarget=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){void 0===rR&&(rR=-1);var ro=this._vb;if(rcS.fillRectImgVb(ro,this._clipRect,rQ,re,rl,rM,ri||r$.DEF_UV,rd||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var rY=this._curSubmit=rYS.create(this,this._ib,ro,(ro._byteLength-64)/32*3,rU,rT);rY.blendType=-1==rR?this._nBlendType:rR,rY.scope=rS,this._submits[this._submits._length++]=rY,this._curSubmit._numEle+=6}},rQ.mixRGBandAlpha=function(rS){return this._mixRGBandAlpha(rS,this._shader2D.ALPHA)},rQ._mixRGBandAlpha=function(rS,rQ){var re=(4278190080&rS)>>>24;return 0!=re?re*=rQ:re=255*rQ,16777215&rS|re<<24},rQ.drawTriangles=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){if(!rS.loaded||!rS.source)return this.sprite&&rB.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;rS.bitmap;var ro=this._mixRGBandAlpha(4294967295,rU),rY=(rl.length,rd.length);this._renderKey=-1;var rp=this._curSubmit=rmS.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,rHS.create(1,0));return rp.shaderValue.textureHost=rS,rp._renderType=10016,this._submits[this._submits._length++]=rp,rT?(rw._tmpMatrix.a=rT.a,rw._tmpMatrix.b=rT.b,rw._tmpMatrix.c=rT.c,rw._tmpMatrix.d=rT.d,rw._tmpMatrix.tx=rT.tx+rQ,rw._tmpMatrix.ty=rT.ty+re,rg.mul(rw._tmpMatrix,this._curMat,rw._tmpMatrix)):(rw._tmpMatrix.a=this._curMat.a,rw._tmpMatrix.b=this._curMat.b,rw._tmpMatrix.c=this._curMat.c,rw._tmpMatrix.d=this._curMat.d,rw._tmpMatrix.tx=this._curMat.tx+rQ,rw._tmpMatrix.ty=this._curMat.ty+re),this._triangleMesh.addData(rl,rM,rd,rw._tmpMatrix,ro,this),this._curSubmit._numEle+=rY,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},rQ.transform=function(rS,rQ,re,rl,rM,rd){rK.save(this),rg.mul(rg.TEMP.setTo(rS,rQ,re,rl,rM,rd),this._curMat,this._curMat),this._curMat._checkTransform()},rQ.setTransformByMatrix=function(rS){rS.copyTo(this._curMat)},rQ.transformByMatrix=function(rS){rK.save(this),rg.mul(rS,this._curMat,this._curMat),this._curMat._checkTransform()},rQ.rotate=function(rS){rK.save(this),this._curMat.rotateEx(rS)},rQ.scale=function(rS,rQ){rK.save(this),this._curMat.scaleEx(rS,rQ)},rQ.clipRect=function(rS,rQ,re,rl){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var rM=roS.create(4);this.addRenderObject(rM);var rd=this._vb,rT=rd._byteLength>>2;if(rcS.fillRectImgVb(rd,null,rS,rQ,re,rl,r$.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var rU=this._curSubmit=rdS.createSubmit(this,this._ib,rd,(rd._byteLength-64)/32*3,rHS.create(2,0));rU.shaderValue.ALPHA=1,this._submits[this._submits._length++]=rU,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var ri=roS.create(5);this.addRenderObject(ri);var rR=rd.getFloat32Array(),ro=Math.min(Math.min(Math.min(rR[0+rT],rR[4+rT]),rR[8+rT]),rR[12+rT]),rY=Math.max(Math.max(Math.max(rR[0+rT],rR[4+rT]),rR[8+rT]),rR[12+rT]),rp=Math.min(Math.min(Math.min(rR[1+rT],rR[5+rT]),rR[9+rT]),rR[13+rT]),rJ=Math.max(Math.max(Math.max(rR[1+rT],rR[5+rT]),rR[9+rT]),rR[13+rT]);rN.save(this,ri,rS,rQ,re,rl,ro,rp,rY-ro,rJ-rp),this._curSubmit=rdS.RENDERBASE}else{re*=this._curMat.a,rl*=this._curMat.d;var rL=rI.TEMP;this._curMat.transformPoint(rL.setTo(rS,rQ)),re<0&&(rL.x=rL.x+re,re=-re),rl<0&&(rL.y=rL.y+rl,rl=-rl),this._renderKey=0;var rj=this._curSubmit=rRS.create(this);(this._submits[this._submits._length++]=rj).submitIndex=this._submits._length,rj.submitLength=9999999,rZ.save(this,rj);var rc=this._clipRect,rG=rc.x,rz=rc.y,rA=rL.x+re,rv=rL.y+rl;rG<rL.x&&(rc.x=rL.x),rz<rL.y&&(rc.y=rL.y),rc.width=Math.min(rA,rG+rc.width)-rc.x,rc.height=Math.min(rv,rz+rc.height)-rc.y,this._shader2D.glTexture=null,rj.clipRect.copyFrom(rc),this._curSubmit=rdS.RENDERBASE}},rQ.setIBVB=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro){if(void 0===ri&&(ri=0),void 0===rR&&(rR=0),void 0===ro&&(ro=0),null===re){if(rG.isFlash){var rY=rl;rY._selfIB||(rY._selfIB=rsS.create(35044)),rY._selfIB.clear(),re=rY._selfIB}else re=this._ib;rcS.expandIBQuadrangle(re,rl._byteLength/(4*rl.vertexStride*4))}if(!rU||!rT)throw Error("setIBVB must input:shader shaderValues");var rp=riS.create(this,rl,re,rM,rT,rU,ri,rR,ro);rd||(rd=rg.EMPTY),rd.translate(rS,rQ),rg.mul(rd,this._curMat,rp._mat),rd.translate(-rS,-rQ),this._submits[this._submits._length++]=rp,this._curSubmit=rdS.RENDERBASE,this._renderKey=0},rQ.addRenderObject=function(rS){this._submits[this._submits._length++]=rS},rQ.fillTrangles=function(rS,rQ,re,rl,rM){var rd=this._curSubmit,rT=this._vb,rU=this._shader2D,ri=rd.shaderValue,rR=rl.length>>4,ro=rS.bitmap;this._renderKey=0,rU.glTexture==ro&&rU.ALPHA===ri.ALPHA||((rd=this._curSubmit=rdS.createSubmit(this,this._ib,rT,rT._byteLength/32*3,rHS.create(1,0))).shaderValue.textureHost=rS,this._submits[this._submits._length++]=rd),rcS.fillTranglesVB(rT,rQ,re,rl,rM||this._curMat,this._x,this._y),rd._numEle+=6*rR},rQ.submitElement=function(rS,rQ){var re=this._submits;for(rQ<0&&(rQ=re._length);rS<rQ;)rS+=re[rS].renderSubmit()},rQ.finish=function(){rvS.mainContext.finish()},rQ.flush=function(){var rS=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(rS>this._ib.bufferLength/12&&rcS.expandIBQuadrangle(this._ib,rS),!this._isMain&&ru.enabled&&ru._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=ru._atlasRestore;for(var rQ=this._submits,re=0,rl=rQ._length;re<rl;re++){var rM=rQ[re];10016===rM.getRenderType()&&rM.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),rQS.instance&&rQS.getInstance().reset();var rd;for(re=0,rd=this.meshlist.length;re<rd;re++){var rT=this.meshlist[re];rT.canReuse?rT.releaseMesh():rT.destroy()}return this.meshlist.length=0,this._curSubmit=rdS.RENDERBASE,this._renderKey=0,this._triangleMesh=r$S.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},rQ.setPathId=function(rS){if(this.mId=rS,-1!=this.mId){this.mHaveKey=!1;var rQ=rP.getInstance();rQ.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,rQ.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},rQ.movePath=function(rS,rQ){var re=rS,rl=rQ;rS=this._curMat.a*re+this._curMat.c*rl+this._curMat.tx,rQ=this._curMat.b*re+this._curMat.d*rl+this._curMat.ty,this.mX+=rS,this.mY+=rQ},rQ.beginPath=function(){var rS=this._getPath();rS.tempArray.length=0,rS.closePath=!1,this.mX=0,this.mY=0},rQ.closePath=function(){this._path.closePath=!0},rQ.fill=function(rS){void 0===rS&&(rS=!1);var rQ=this._getPath();this.drawPoly(0,0,rQ.tempArray,this.fillStyle._color.numColor,0,0,rS)},rQ.stroke=function(){var rS=this._getPath();if(0<this.lineWidth){if(-1==this.mId)rS.drawLine(0,0,rS.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var rQ=rP.getInstance().shapeLineDic[this.mId];rQ.rebuild(rS.tempArray),rS.setGeomtry(rQ)}else rP.getInstance().addLine(this.mId,rS.drawLine(0,0,rS.tempArray,this.lineWidth,this.strokeStyle._color.numColor));rS.update();var re=[this.mX,this.mY],rl=rdS.createShape(this,rS.ib,rS.vb,rS.count,rS.offset,rHS.create(4,0));rl.shaderValue.ALPHA=this._shader2D.ALPHA,rl.shaderValue.u_pos=re,rl.shaderValue.u_mmat2=rzS.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=rl,this._renderKey=-1}},rQ.line=function(rS,rQ,re,rl,rM,rd){var rT=this._curSubmit,rU=this._vb;if(rcS.fillLineVb(rU,this._clipRect,rS,rQ,re,rl,rM,rd)){this._renderKey=0;var ri=this._shader2D,rR=rT.shaderValue;ri.strokeStyle===rR.strokeStyle&&ri.ALPHA===rR.ALPHA||(ri.glTexture=null,(rT=this._curSubmit=rdS.createSubmit(this,this._ib,rU,(rU._byteLength-64)/32*3,rHS.create(2,0))).shaderValue.strokeStyle=ri.strokeStyle,rT.shaderValue.mainID=2,rT.shaderValue.ALPHA=ri.ALPHA,this._submits[this._submits._length++]=rT),rT._numEle+=6}},rQ.moveTo=function(rS,rQ,re){void 0===re&&(re=!0);var rl=this._getPath();if(re){var rM=rS,rd=rQ;rS=this._curMat.a*rM+this._curMat.c*rd,rQ=this._curMat.b*rM+this._curMat.d*rd}rl.addPoint(rS,rQ)},rQ.lineTo=function(rS,rQ,re){void 0===re&&(re=!0);var rl=this._getPath();if(re){var rM=rS,rd=rQ;rS=this._curMat.a*rM+this._curMat.c*rd,rQ=this._curMat.b*rM+this._curMat.d*rd}rl.addPoint(rS,rQ)},rQ.drawCurves=function(rS,rQ,re){this.setPathId(-1),this.beginPath(),this.strokeStyle=re[3],this.lineWidth=re[4];var rl=re[2];rS+=re[0],rQ+=re[1],this.movePath(rS,rQ),this.moveTo(rl[0],rl[1]);for(var rM=2,rd=rl.length;rM<rd;)this.quadraticCurveTo(rl[rM++],rl[rM++],rl[rM++],rl[rM++]);this.stroke()},rQ.arcTo=function(rS,rQ,re,rl,rM){if(-1==this.mId||!this.mHaveKey){var rd=0,rT=0,rU=0,ri=this._getPath();this._curMat.copyTo(rw._tmpMatrix),rw._tmpMatrix.tx=rw._tmpMatrix.ty=0,rw._tempPoint.setTo(ri.getEndPointX(),ri.getEndPointY()),rw._tmpMatrix.invertTransformPoint(rw._tempPoint);var rR=rw._tempPoint.x-rS,ro=rw._tempPoint.y-rQ,rY=Math.sqrt(rR*rR+ro*ro);if(!(rY<=1e-6)){var rp=rR/rY,rJ=ro/rY,rL=re-rS,rj=rl-rQ,rc=rL*rL+rj*rj,rG=Math.sqrt(rc);if(!(rG<=1e-6)){var rz=rL/rG,rA=rj/rG,rv=rp+rz,rD=rJ+rA,rB=Math.sqrt(rv*rv+rD*rD);if(!(rB<=1e-6)){var rO=rv/rB,rH=rD/rB,rg=Math.acos(rO*rp+rH*rJ),rI=Math.PI/2-rg,rE=(rY=rM/Math.tan(rI))*rp+rS,rt=rY*rJ+rQ,rk=Math.sqrt(rY*rY+rM*rM),rX=rS+rO*rk,rh=rQ+rH*rk,rb=0,rm=0;if(0<=rp*rA-rJ*rz){var r$=2*rI/rw.SEGNUM;rb=Math.sin(r$),rm=Math.cos(r$)}else r$=2*-rI/rw.SEGNUM,rb=Math.sin(r$),rm=Math.cos(r$);rT=this._curMat.a*rE+this._curMat.c*rt,rU=this._curMat.b*rE+this._curMat.d*rt,rT==this._path.getEndPointX()&&rU==this._path.getEndPointY()||ri.addPoint(rT,rU);var rn=rE-rX,rP=rt-rh;for(rd=0;rd<rw.SEGNUM;rd++){var ra=rn*rm+rP*rb,rf=-rn*rb+rP*rm;rT=ra+rX,rU=rf+rh,rS=this._curMat.a*rT+this._curMat.c*rU,rU=rQ=this._curMat.b*rT+this._curMat.d*rU,(rT=rS)==this._path.getEndPointX()&&rU==this._path.getEndPointY()||ri.addPoint(rT,rU),rn=ra,rP=rf}}}}}},rQ.arc=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rd&&(rd=!1),void 0===rT&&(rT=!0),-1!=this.mId){var rU=rP.getInstance().shapeDic[this.mId];if(rU&&this.mHaveKey&&!rU.needUpdate(this._curMat))return;rQ=rS=0}var ri,rR=0,ro=0,rY=0,rp=0,rJ=0,rL=0,rj=0;if(ro=rM-rl,rd)if(Math.abs(ro)>=2*Math.PI)ro=2*-Math.PI;else for(;0<ro;)ro-=2*Math.PI;else if(Math.abs(ro)>=2*Math.PI)ro=2*Math.PI;else for(;ro<0;)ro+=2*Math.PI;ri=ro/(rj=re<101?Math.max(10,ro*re/5):re<201?Math.max(10,ro*re/20):Math.max(10,ro*re/40))/2,rY=Math.abs(4/3*(1-Math.cos(ri))/Math.sin(ri)),rd&&(rY=-rY);var rc=this._getPath(),rG=NaN,rz=NaN;for(rL=0;rL<=rj;rL++)rR=rl+ro*(rL/rj),rp=rS+Math.cos(rR)*re,rJ=rQ+Math.sin(rR)*re,rT&&(rG=rp,rz=rJ,rp=this._curMat.a*rG+this._curMat.c*rz,rJ=this._curMat.b*rG+this._curMat.d*rz),rp==this._path.getEndPointX()&&rJ==this._path.getEndPointY()||rc.addPoint(rp,rJ);rp=rS+Math.cos(rM)*re,rJ=rQ+Math.sin(rM)*re,rT&&(rG=rp,rz=rJ,rp=this._curMat.a*rG+this._curMat.c*rz,rJ=this._curMat.b*rG+this._curMat.d*rz),rp==this._path.getEndPointX()&&rJ==this._path.getEndPointY()||rc.addPoint(rp,rJ)},rQ.quadraticCurveTo=function(rS,rQ,re,rl){var rM=rY.I,rd=re,rT=rl;re=this._curMat.a*rd+this._curMat.c*rT,rl=this._curMat.b*rd+this._curMat.d*rT,rd=rS,rT=rQ,rS=this._curMat.a*rd+this._curMat.c*rT,rQ=this._curMat.b*rd+this._curMat.d*rT;for(var rU=rM.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),rS,rQ,re,rl],30,2),ri=0,rR=rU.length/2;ri<rR;ri++)this.lineTo(rU[2*ri],rU[2*ri+1],!1);this.lineTo(re,rl,!1)},rQ.rect=function(rS,rQ,re,rl){this._other=this._other.make(),this._other.path||(this._other.path=new rF),this._other.path.rect(rS,rQ,re,rl)},rQ.strokeRect=function(rS,rQ,re,rl,rM){var rd=.5*rM;this.line(rS-rd,rQ,rS+re+rd,rQ,rM,this._curMat),this.line(rS+re,rQ,rS+re,rQ+rl,rM,this._curMat),this.line(rS,rQ,rS,rQ+rl,rM,this._curMat),this.line(rS-rd,rQ+rl,rS+re+rd,rQ+rl,rM,this._curMat)},rQ.clip=function(){},rQ.drawPoly=function(rS,rQ,re,rl,rM,rd,rT){void 0===rT&&(rT=!1),this._renderKey=0,this._shader2D.glTexture=null;var rU=this._getPath();if(-1==this.mId)rU.polygon(rS,rQ,re,rl,rM||1,rd);else if(this.mHaveKey){var ri=rP.getInstance().shapeDic[this.mId];ri.setMatrix(this._curMat),ri.rebuild(rU.tempArray),rU.setGeomtry(ri)}else{var rR=rU.polygon(rS,rQ,re,rl,rM||1,rd);rP.getInstance().addShape(this.mId,rR),rR.setMatrix(this._curMat)}rU.update();var ro,rY=[this.mX,this.mY];if((ro=rdS.createShape(this,rU.ib,rU.vb,rU.count,rU.offset,rHS.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,ro.shaderValue.u_pos=rY,ro.shaderValue.u_mmat2=rzS.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=ro,0<rM){if(this.mHaveLineKey){var rp=rP.getInstance().shapeLineDic[this.mId];rp.rebuild(rU.tempArray),rU.setGeomtry(rp)}else rP.getInstance().addShape(this.mId,rU.drawLine(rS,rQ,re,rM,rd));rU.update(),(ro=rdS.createShape(this,rU.ib,rU.vb,rU.count,rU.offset,rHS.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,ro.shaderValue.u_mmat2=rzS.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=ro}},rQ.drawParticle=function(rS,rQ,re){re.x=rS,re.y=rQ,this._submits[this._submits._length++]=re},rQ._getPath=function(){return this._path||(this._path=new rF)},rl(0,rQ,"globalCompositeOperation",function(){return rW.NAMES[this._nBlendType]},function(rS){var rQ=rW.TOINT[rS];null==rQ||this._nBlendType===rQ||(rq.save(this,65536,this,!0),this._curSubmit=rdS.RENDERBASE,this._renderKey=0,this._nBlendType=rQ)}),rl(0,rQ,"strokeStyle",function(){return this._shader2D.strokeStyle},function(rS){this._shader2D.strokeStyle.equal(rS)||(rq.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=rx.create(rS))}),rl(0,rQ,"globalAlpha",function(){return this._shader2D.ALPHA},function(rS){(rS=Math.floor(1e3*rS)/1e3)!=this._shader2D.ALPHA&&(rq.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=rS)}),rl(0,rQ,"asBitmap",null,function(rS){if(rS){if(this._targets||(this._targets=new r_),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),rl(0,rQ,"fillStyle",function(){return this._shader2D.fillStyle},function(rS){this._shader2D.fillStyle.equal(rS)||(rq.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=rx.create(rS))}),rl(0,rQ,"textAlign",function(){return this._other.textAlign},function(rS){this._other.textAlign===rS||(this._other=this._other.make(),rq.save(this,32768,this._other,!1),this._other.textAlign=rS)}),rl(0,rQ,"lineWidth",function(){return this._other.lineWidth},function(rS){this._other.lineWidth===rS||(this._other=this._other.make(),rq.save(this,256,this._other,!1),this._other.lineWidth=rS)}),rl(0,rQ,"textBaseline",function(){return this._other.textBaseline},function(rS){this._other.textBaseline===rS||(this._other=this._other.make(),rq.save(this,16384,this._other,!1),this._other.textBaseline=rS)}),rl(0,rQ,"font",null,function(rS){rS!=this._other.font.toString()&&(this._other=this._other.make(),rq.save(this,8,this._other,!1),this._other.font===rLS.EMPTY?this._other.font=new rLS(rS):this._other.font.setFont(rS))}),rw.__init__=function(){re.DEFAULT=new re},rw._tempPoint=new rI,rw._SUBMITVBSIZE=32e3,rw._MAXSIZE=99999999,rw._RECTVBSIZE=16,rw.MAXCLIPRECT=new rE(0,0,99999999,99999999),rw._COUNT=0,rw._tmpMatrix=new rg,rw.SEGNUM=32,rw._contextcount=0,rT(rw,["_fontTemp",function(){return this._fontTemp=new rLS},"_drawStyleTemp",function(){return this._drawStyleTemp=new rx(null)}]),rw.__init$=function(){re=function(){function rS(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=rLS.EMPTY}rp(rS,"");var rQ=rS.prototype;return rQ.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=rLS.EMPTY},rQ.make=function(){return this===rS.DEFAULT?new rS:this},rS.DEFAULT=null,rS}()},rw}(),rHS=function(rS){function rl(rS,rQ){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,rl.__super.call(this),this.defines=new rtS,this.position=rl._POSITION,this.mainID=rS,this.subID=rQ,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=rS|rQ,this._inClassCache=rl._cache[this._cacheID],0<rS&&!this._inClassCache&&(this._inClassCache=rl._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}rp(rl,"laya.webgl.shader.d2.value.Value2D",rf);var rQ=rl.prototype;return rQ.setValue=function(rS){},rQ.refresh=function(){var rS=this.size;return rS[0]=rzS.width,rS[1]=rzS.height,this.alpha=this.ALPHA*rzS.worldAlpha,this.mmat=rzS.worldMatrix4,this},rQ._ShaderWithCompile=function(){return rCS.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,r_S.create)},rQ._withWorldShaderDefines=function(){var rS=rzS.worldShaderDefines,rQ=rCS.sharders[this.mainID|this.defines._value|rS.getValue()];if(!rQ){var re,rl={};for(re in this.defines.toNameDic())rl[re]="";for(re in rS.toNameDic())rl[re]="";rQ=rCS.withCompile2D(0,this.mainID,rl,this.mainID|this.defines._value|rS.getValue(),r_S.create)}var rM=rzS.worldFilters;if(!rM)return rQ;for(var rd,rT=rM.length,rU=0;rU<rT;rU++)(rd=rM[rU])&&rd.action.setValue(this);return rQ},rQ.upload=function(){var rS=rzS;this.alpha=this.ALPHA*rS.worldAlpha,rzS.worldMatrix4!==rzS.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),rvS.shaderHighPrecision&&this.defines.add(1024);var rQ,re=rS.worldShaderDefines?this._withWorldShaderDefines():rCS.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=rS.width,this.size[1]=rS.height,this.mmat=rS.worldMatrix4,rnS.activeShader!==re?re._shaderValueWidth!==rS.width||re._shaderValueHeight!==rS.height?(re._shaderValueWidth=rS.width,re._shaderValueHeight=rS.height):rQ=re._params2dQuick2||re._make2dQuick2():re._shaderValueWidth!==rS.width||re._shaderValueHeight!==rS.height?(re._shaderValueWidth=rS.width,re._shaderValueHeight=rS.height):rQ=re._params2dQuick1||re._make2dQuick1(),re.upload(this,rQ)},rQ.setFilters=function(rS){if(this.filters=rS)for(var rQ,re=rS.length,rl=0;rl<re;rl++)(rQ=rS[rl])&&(this.defines.add(rQ.type),rQ.action.setValue(this))},rQ.clear=function(){this.defines.setValue(this.subID)},rQ.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},rl._initone=function(rS,rQ){rl._typeClass[rS]=rQ,rl._cache[rS]=[],rl._cache[rS]._length=0},rl.__init__=function(){rl._POSITION=[2,5126,!1,4*rjS.BYTES_PE,0],rl._TEXCOORD=[2,5126,!1,4*rjS.BYTES_PE,2*rjS.BYTES_PE],rl._initone(2,rwS),rl._initone(4,rWS),rl._initone(256,ruS),rl._initone(512,rfS),rl._initone(1,rrS),rl._initone(65,rVS),rl._initone(9,rrS)},rl.create=function(rS,rQ){var re=rl._cache[rS|rQ];return re._length?re[--re._length]:new rl._typeClass[rS|rQ](rQ)},rl._POSITION=null,rl._TEXCOORD=null,rl._cache=[],rl._typeClass=[],rl.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rl}(),rgS=function(rS){function rc(rS,rQ){rc.__super.call(this,rS,rQ)}rp(rc,"laya.webgl.utils.RenderSprite3D",rz);var rQ=rc.prototype;return rQ.onCreate=function(rS){switch(rS){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},rQ._mask=function(rS,rQ,re,rl){var rM,rd,rT=this._next,rU=rS.mask;if(rU){rQ.ctx.save();var ri=rQ.ctx.globalCompositeOperation,rR=new rE;if(rR.copyFrom(rU.getBounds()),rR.width=Math.round(rR.width),rR.height=Math.round(rR.height),rR.x=Math.round(rR.x),rR.y=Math.round(rR.y),0<rR.width&&0<rR.height){var ro=rS._style._tf,rY=rUS.create();rY.addValue("bounds",rR),rM=rTS.create([rY,rQ],laya.webgl.utils.RenderSprite3D.tmpTarget),rQ.addRenderObject(rM),rU.render(rQ,-rR.x,-rR.y),rM=rTS.create([rY],laya.webgl.utils.RenderSprite3D.endTmpTarget),rQ.addRenderObject(rM),rQ.ctx.save(),rQ.clipRect(re-ro.translateX+rR.x,rl-ro.translateY+rR.y,rR.width,rR.height),rT._fun.call(rT,rS,rQ,re,rl),rQ.ctx.restore(),rd=roS.create(6),ri=rQ.ctx.globalCompositeOperation,rd.blendMode="mask",rQ.addRenderObject(rd),rg.TEMP.identity();var rp=rHS.create(1,0),rJ=r$.INV_UV,rL=rR.width,rj=rR.height;(rR.width<32||rR.height<32)&&((rJ=rc.tempUV)[0]=0,rJ[1]=0,rJ[2]=32<=rR.width?1:rR.width/32,rJ[3]=0,rJ[4]=32<=rR.width?1:rR.width/32,rJ[5]=32<=rR.height?1:rR.height/32,rJ[6]=0,rJ[7]=32<=rR.height?1:rR.height/32,rR.width=32<=rR.width?rR.width:32,rR.height=32<=rR.height?rR.height:32,rJ[1]*=-1,rJ[3]*=-1,rJ[5]*=-1,rJ[7]*=-1,rJ[1]+=1,rJ[3]+=1,rJ[5]+=1,rJ[7]+=1),rQ.ctx.drawTarget(rY,re+rR.x-ro.translateX,rl+rR.y-ro.translateY,rL,rj,rg.TEMP,"tmpTarget",rp,rJ,6),rM=rTS.create([rY],laya.webgl.utils.RenderSprite3D.recycleTarget),rQ.addRenderObject(rM),(rd=roS.create(6)).blendMode=ri,rQ.addRenderObject(rd)}rQ.ctx.restore()}else rT._fun.call(rT,rS,rQ,re,rl)},rQ._blend=function(rS,rQ,re,rl){var rM=rS._style,rd=this._next;rM.blendMode?(rQ.ctx.save(),rQ.ctx.globalCompositeOperation=rM.blendMode,rd._fun.call(rd,rS,rQ,re,rl),rQ.ctx.restore()):rd._fun.call(rd,rS,rQ,re,rl)},rQ._transform=function(rS,rQ,re,rl){var rM=rS.transform,rd=this._next;if(rM&&rd!=rz.NORENDER){var rT=rQ.ctx;rS._style;rM.tx=re,rM.ty=rl;var rU=rT._getTransformMatrix(),ri=rU.clone();rg.mul(rM,rU,rU),rU._checkTransform(),rM.tx=rM.ty=0,rd._fun.call(rd,rS,rQ,0,0),ri.copyTo(rU),ri.destroy()}else rd._fun.call(rd,rS,rQ,re,rl)},rc.tmpTarget=function(rS,rQ){var re=rS.getValue("bounds"),rl=rPS.create(re.width,re.height);rl.start(),rl.clear(0,0,0,0),rS.addValue("tmpTarget",rl)},rc.endTmpTarget=function(rS){rS.getValue("tmpTarget").end()},rc.recycleTarget=function(rS){rS.getValue("tmpTarget").recycle(),rS.recycle()},rT(rc,["tempUV",function(){return this.tempUV=new Array(8)}]),rc}(),rIS=function(rS){function rQ(){this.data=null,rQ.__super.call(this)}rp(rQ,"laya.filters.webgl.ColorFilterActionGL",ra);var re=rQ.prototype;return rB.imps(re,{"laya.filters.IFilterActionGL":!0}),re.setValue=function(rS){rS.colorMat=this.data._mat,rS.colorAlpha=this.data._alpha},re.apply3d=function(rS,rQ,re,rl,rM){var rd=rS.getValue("bounds"),rT=rHS.create(1,0);rT.setFilters([this.data]);var rU=rg.TEMP;rU.identity(),re.ctx.drawTarget(rS,0,0,rd.width,rd.height,rU,"src",rT)},rQ}(),rES=function(rS){function rd(rS,rQ,re,rl,rM){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,rd.__super.call(this,rS,rQ,rM),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new rxS,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=re,this._atlasCanvas.height=rl,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}rp(rd,"laya.webgl.atlas.Atlaser",rw);var rQ=rd.prototype;return rQ.computeUVinAtlasTexture=function(rS,rQ,re,rl){var rM=ru.atlasTextureWidth,rd=ru.atlasTextureHeight,rT=re/rM,rU=rl/rd,ri=(re+rS.bitmap.width)/rM,rR=(rl+rS.bitmap.height)/rd,ro=rS.bitmap.width/rM,rY=rS.bitmap.height/rd;rS.uv=[rT+rQ[0]*ro,rU+rQ[1]*rY,ri-(1-rQ[2])*ro,rU+rQ[3]*rY,ri-(1-rQ[4])*ro,rR-(1-rQ[5])*rY,rT+rQ[6]*ro,rR-(1-rQ[7])*rY]},rQ.findBitmapIsExist=function(rS){if(rS instanceof laya.webgl.resource.WebGLImage){var rQ=rS,re=rQ.url,rl=this._InAtlasWebGLImagesKey[re||rQ.id];if(rl)return rl.offsetInfoID}return-1},rQ.addToAtlasTexture=function(rS,rQ,re){if(rS instanceof laya.webgl.resource.WebGLImage){var rl=rS,rM=rl.url;this._InAtlasWebGLImagesKey[rM||rl.id]={bitmap:rS,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([rQ,re])}this._atlasCanvas.texSubImage2D(rQ,re,rS.atlasSource),rS.clearAtlasSource()},rQ.addToAtlas=function(rS,rQ,re){rS._atlasID=this._inAtlasTextureKey.length;var rl=rS.uv.slice(),rM=rS.bitmap;this._inAtlasTextureKey.push(rS),this._inAtlasTextureOriUVValue.push(rl),this._inAtlasTextureBitmapValue.push(rM),this.computeUVinAtlasTexture(rS,rl,rQ,re),rS.bitmap=this._atlasCanvas},rQ.clear=function(){for(var rS=0,rQ=this._inAtlasTextureKey.length;rS<rQ;rS++)this._inAtlasTextureKey[rS].bitmap=this._inAtlasTextureBitmapValue[rS],this._inAtlasTextureKey[rS].uv=this._inAtlasTextureOriUVValue[rS],this._inAtlasTextureKey[rS]._atlasID=-1,this._inAtlasTextureKey[rS].bitmap.lock=!1,this._inAtlasTextureKey[rS].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},rQ.dispose=function(){this.clear(),this._atlasCanvas.destroy()},rl(0,rQ,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),rl(0,rQ,"texture",function(){return this._atlasCanvas}),rl(0,rQ,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),rd}(),rtS=function(rS){function re(){re.__super.call(this,re.__name2int,re.__int2name,re.__int2nameMap)}return rp(re,"laya.webgl.shader.d2.ShaderDefines2D",ry),re.__init__=function(){re.reg("TEXTURE2D",1),re.reg("COLOR2D",2),re.reg("PRIMITIVE",4),re.reg("GLOW_FILTER",8),re.reg("BLUR_FILTER",16),re.reg("COLOR_FILTER",32),re.reg("COLOR_ADD",64),re.reg("WORLDMAT",128),re.reg("FILLTEXTURE",256),re.reg("FSHIGHPRECISION",1024),re.reg("TXTALPHA",2048),re.reg("TXTCOMPRESS",4096)},re.reg=function(rS,rQ){ry._reg(rS,rQ,re.__name2int,re.__int2name)},re.toText=function(rS,rQ,re){return ry._toText(rS,rQ,re)},re.toInt=function(rS){return ry._toInt(rS,re.__name2int)},re.TEXTURE2D=1,re.COLOR2D=2,re.PRIMITIVE=4,re.FILTERGLOW=8,re.FILTERBLUR=16,re.FILTERCOLOR=32,re.COLORADD=64,re.WORLDMAT=128,re.FILLTEXTURE=256,re.SKINMESH=512,re.SHADERDEFINE_FSHIGHPRECISION=1024,re.TXTALPHA=2048,re.TXTCOMPRESS=4096,re.__name2int={},re.__int2name=[],re.__int2nameMap=[],re}(),rkS=(function(rS){function rU(rS,rQ,re,rl,rM,rd,rT){rU.__super.call(this,rS,rQ,re,rl,40,rM,rd,rT)}rp(rU,"laya.webgl.shapes.Ellipse",reS)}(),function(rS){function rd(rS,rQ,re,rl,rM){this._points=[],this.rebuild(re),rd.__super.call(this,rS,rQ,0,0,0,rM,rl,rM,0)}rp(rd,"laya.webgl.shapes.Line",reS);var rQ=rd.prototype;return rQ.rebuild=function(rS){var rQ=rS.length;rQ!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(rQ/2-1)),this.mFloat32Array=new Float32Array(5*rQ)),this._points.length=0;for(var re=NaN,rl=NaN,rM=-1,rd=-1,rT=rS.length/2,rU=0;rU<rT;rU++)re=rS[2*rU],rl=rS[2*rU+1],(.01<Math.abs(rM-re)||.01<Math.abs(rd-rl))&&this._points.push(re,rl),rM=re,rd=rl},rQ.getData=function(rS,rQ,re){var rl=[],rM=[];0<this.borderWidth&&this.createLine2(this._points,rl,this.borderWidth,re,rM,this._points.length/2),this.mUint16Array.set(rl,0),this.mFloat32Array.set(rM,0),rS.append(this.mUint16Array),rQ.append(this.mFloat32Array)},rd}()),rXS=function(rS){function rY(rS,rQ,re,rl,rM){this._points=[];for(var rd=NaN,rT=NaN,rU=-1,ri=-1,rR=re.length/2-1,ro=0;ro<rR;ro++)rd=re[2*ro],rT=re[2*ro+1],(.01<Math.abs(rU-rd)||.01<Math.abs(ri-rT))&&this._points.push(rd,rT),rU=rd,ri=rT;rd=re[2*rR],rT=re[2*rR+1],rU=this._points[0],ri=this._points[1],(.01<Math.abs(rU-rd)||.01<Math.abs(ri-rT))&&this._points.push(rd,rT),rY.__super.call(this,rS,rQ,0,0,this._points.length/2,0,rl,rM)}rp(rY,"laya.webgl.shapes.LoopLine",reS);var rQ=rY.prototype;return rQ.getData=function(rS,rQ,re){if(0<this.borderWidth){for(var rl=this.color,rM=(rl>>16&255)/255,rd=(rl>>8&255)/255,rT=(255&rl)/255,rU=[],ri=0,rR=0,ro=[],rY=Math.floor(this._points.length/2),rp=0;rp<rY;rp++)ri=this._points[2*rp],rR=this._points[2*rp+1],rU.push(this.x+ri,this.y+rR,rM,rd,rT);this.createLoopLine(rU,ro,this.borderWidth,re+rU.length/5),rS.append(new Uint16Array(ro)),rQ.append(new Float32Array(rU))}},rQ.createLoopLine=function(rS,rQ,re,rl,rM,rd){rS.length;var rT=rS.concat(),rU=rM||rS,ri=this.borderColor,rR=(ri>>16&255)/255,ro=(ri>>8&255)/255,rY=(255&ri)/255,rp=[rT[0],rT[1]],rJ=[rT[rT.length-5],rT[rT.length-4]],rL=rJ[0]+.5*(rp[0]-rJ[0]),rj=rJ[1]+.5*(rp[1]-rJ[1]);rT.unshift(rL,rj,0,0,0),rT.push(rL,rj,0,0,0);var rc,rG,rz,rA,rv,rD,rB,rO,rH,rg,rI,rE,rt,rk,rX,rh,rb,rm,r$,rn,rP=rT.length/5,ra=rl,rf=re/2;rz=rT[0],rA=rT[1],rg=rz-(rv=rT[5]),rH=(rH=-(rA-(rD=rT[6])))/(rn=Math.sqrt(rH*rH+rg*rg))*rf,rg=rg/rn*rf,rU.push(rz-rH,rA-rg,rR,ro,rY,rz+rH,rA+rg,rR,ro,rY);for(var rw=1;rw<rP-1;rw++)rz=rT[5*(rw-1)],rA=rT[5*(rw-1)+1],rv=rT[5*rw],rD=rT[5*rw+1],rB=rT[5*(rw+1)],rO=rT[5*(rw+1)+1],rg=rz-rv,rE=rv-rB,rX=(-(rH=(rH=-(rA-rD))/(rn=Math.sqrt(rH*rH+rg*rg))*rf)+rz)*(-(rg=rg/rn*rf)+rD)-(-rH+rv)*(-rg+rA),rm=(-(rI=(rI=-(rD-rO))/(rn=Math.sqrt(rI*rI+rE*rE))*rf)+rB)*(-(rE=rE/rn*rf)+rD)-(-rI+rv)*(-rE+rO),r$=(rt=-rg+rA-(-rg+rD))*(rb=-rI+rv-(-rI+rB))-(rh=-rE+rO-(-rE+rD))*(rk=-rH+rv-(-rH+rz)),Math.abs(r$)<.1?(r$+=10.1,rU.push(rv-rH,rD-rg,rR,ro,rY,rv+rH,rD+rg,rR,ro,rY)):(((rc=(rk*rm-rb*rX)/r$)-rv)*(rc-rv)+((rG=(rh*rX-rt*rm)/r$)-rD)+(rG-rD),rU.push(rc,rG,rR,ro,rY,rv-(rc-rv),rD-(rG-rD),rR,ro,rY));rd&&(rQ=rd);var ru=this.edges+1;for(rw=1;rw<ru;rw++)rQ.push(ra+2*(rw-1),ra+2*(rw-1)+1,ra+2*rw+1,ra+2*rw+1,ra+2*rw,ra+2*(rw-1));return rQ.push(ra+2*(rw-1),ra+2*(rw-1)+1,ra+1,ra+1,ra,ra+2*(rw-1)),rU},rY}(),rhS=function(rS){function rT(rS,rQ,re,rl,rM,rd){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=rg.create(),this._points=re.slice(0,re.length),rT.__super.call(this,rS,rQ,0,0,this._points.length/2,rl,rM,rd)}rp(rT,"laya.webgl.shapes.Polygon",reS);var rQ=rT.prototype;return rQ.rebuild=function(rS){this._repaint||(this._points.length=0,this._points=this._points.concat(rS))},rQ.setMatrix=function(rS){rS.copyTo(this._mat)},rQ.needUpdate=function(rS){return this._repaint=this._mat.a==rS.a&&this._mat.b==rS.b&&this._mat.c==rS.c&&this._mat.d==rS.d&&this._mat.tx==rS.tx&&this._mat.ty==rS.ty,!this._repaint},rQ.getData=function(rS,rQ,re){var rl,rM=0,rd=this._points,rT=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=re){for(this._start=re,rl=[],rT=this.earcutTriangles.length,rM=0;rM<rT;rM++)rl.push(this.earcutTriangles[rM]+re);this.mUint16Array=new Uint16Array(rl)}}else{this._start=re,rl=[];var rU=[],ri=[],rR=this.color,ro=(rR>>16&255)/255,rY=(rR>>8&255)/255,rp=(255&rR)/255;for(rT=Math.floor(rd.length/2),rM=0;rM<rT;rM++)rU.push(this.x+rd[2*rM],this.y+rd[2*rM+1],ro,rY,rp),ri.push(this.x+rd[2*rM],this.y+rd[2*rM+1]);for(this.earcutTriangles=rlS.earcut(ri,null,2),rT=this.earcutTriangles.length,rM=0;rM<rT;rM++)rl.push(this.earcutTriangles[rM]+re);this.mUint16Array=new Uint16Array(rl),this.mFloat32Array=new Float32Array(rU)}rS.append(this.mUint16Array),rQ.append(this.mFloat32Array)},rT}(),rbS=function(rS){function rd(){this._matrix=new rg,this._matrix4=rjS.defaultMatrix4.concat(),rd.__super.call(this,1e4),this.shaderValue=new rHS(0,0)}rp(rd,"laya.webgl.submit.SubmitCanvas",rdS);var rQ=rd.prototype;return rQ.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var rS=rzS.worldAlpha,rQ=rzS.worldMatrix4,re=rzS.worldMatrix,rl=rzS.worldFilters,rM=rzS.worldShaderDefines,rd=this.shaderValue,rT=this._matrix,rU=this._matrix4,ri=rg.TEMP;return rg.mul(rT,re,ri),rU[0]=ri.a,rU[1]=ri.b,rU[4]=ri.c,rU[5]=ri.d,rU[12]=ri.tx,rU[13]=ri.ty,rzS.worldMatrix=ri.clone(),rzS.worldMatrix4=rU,rzS.worldAlpha=rzS.worldAlpha*rd.alpha,rd.filters&&rd.filters.length&&(rzS.worldFilters=rd.filters,rzS.worldShaderDefines=rd.defines),this._ctx_src.flush(),rzS.worldAlpha=rS,rzS.worldMatrix4=rQ,rzS.worldMatrix.destroy(),rzS.worldMatrix=re,rzS.worldFilters=rl,rzS.worldShaderDefines=rM,1},rQ.releaseRender=function(){var rS=rd._cache;this._ctx_src=null,rS[rS._length++]=this},rQ.getRenderType=function(){return 10003},rd.create=function(rS,rQ,re){var rl=rd._cache._length?rd._cache[--rd._cache._length]:new rd;rl._ctx_src=rS;var rM=rl.shaderValue;return rM.alpha=rQ,rM.defines.setValue(0),re&&re.length&&rM.setFilters(re),rl},rd._cache=((rd._cache=[])._length=0,rd._cache),rd}(),rmS=function(rS){function rR(rS){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===rS&&(rS=1e4),rR.__super.call(this,rS)}rp(rR,"laya.webgl.submit.SubmitTexture",rdS);var rQ=rR.prototype;return rQ.releaseRender=function(){var rS=rR._cache;(rS[rS._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},rQ.addTexture=function(rS,rQ){this._texsID[this._texs.length]=rS._uvID,this._texs.push(rS),this._vbPos.push(rQ)},rQ.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var rS=this.shaderValue.textureHost.bitmap;if(null!==rS)for(var rQ=this._vb.getFloat32Array(),re=0,rl=this._texs.length;re<rl;re++){var rM=this._texs[re];rM.active();var rd=rM.uv;if(this._texsID[re]!==rM._uvID){this._texsID[re]=rM._uvID;var rT=this._vbPos[re];rQ[rT+2]=rd[0],rQ[rT+3]=rd[1],rQ[rT+6]=rd[2],rQ[rT+7]=rd[3],rQ[rT+10]=rd[4],rQ[rT+11]=rd[5],rQ[rT+14]=rd[6],rQ[rT+15]=rd[7],this._vb.setNeedUpload()}rM.bitmap!==rS&&(this._isSameTexture=!1)}}},rQ.renderSubmit=function(){if(0===this._numEle)return rR._shaderSet=!1,1;var rS=this.shaderValue.textureHost;if(rS){var rQ=rS.source;if(!rS.bitmap||!rQ)return rR._shaderSet=!1,1;this.shaderValue.texture=rQ,rS.alphaTexture&&rS.alphaTexture.source&&(this.shaderValue.texture1=rS.alphaTexture.source)}this._vb.bind_upload(this._ib);var re=rvS.mainContext;if(rW.activeBlendFunction!==this._blendFn&&(re.enable(3042),this._blendFn(re),rW.activeBlendFunction=this._blendFn),rX.drawCall++,rX.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&rnS.activeShader&&rR._shaderSet?(rnS.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&rnS.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),rR._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var rl=rS.bitmap,rM=0,rd=rnS.activeShader,rT=0,rU=this._texs.length;rT<rU;rT++){var ri=this._texs[rT];ri.bitmap===rl&&rT+1!==rU||(rd.uploadTexture2D(ri.source),re.drawElements(4,6*(rT-rM+1),5123,this._startIdx+6*rM*rjS.BYTES_PIDX),rl=ri.bitmap,rM=rT)}else re.drawElements(4,this._numEle,5123,this._startIdx);return 1},rR.create=function(rS,rQ,re,rl,rM){var rd=rR._cache._length?rR._cache[--rR._cache._length]:new rR;null==re&&((re=rd._selfVb||(rd._selfVb=ryS.create(-1))).clear(),rl=0),rd._ib=rQ,rd._vb=re,rd._startIdx=rl*rjS.BYTES_PIDX,rd._numEle=0;var rT=rS._nBlendType;rd._blendFn=rS._targets?rW.targetFns[rT]:rW.fns[rT],rd.shaderValue=rM,rd.shaderValue.setValue(rS._shader2D);var rU=rS._shader2D.filters;return rU&&rd.shaderValue.setFilters(rU),rd},rR._cache=((rR._cache=[])._length=0,rR._cache),rR._shaderSet=!0,rR}(),r$S=function(rS){function rG(){rG.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}rp(rG,"laya.webgl.utils.MeshTexture",rGS);var rQ=rG.prototype;return rQ.addData=function(rS,rQ,re,rl,rM,rd){for(var rT=rS.length/2,rU=this._vb.needSize(rT*rG.const_stride)>>2,ri=this._vb.getFloat32Array(),rR=0,ro=0;ro<rT;ro++){var rY=rS[rR],rp=rS[rR+1],rJ=rY*rl.a+rp*rl.c+rl.tx,rL=rY*rl.b+rp*rl.d+rl.ty;ri[rU++]=rJ,ri[rU++]=rL,ri[rU++]=rQ[rR],ri[rU++]=rQ[rR+1],rR+=2}this._vb.setNeedUpload();var rj=this.vertNum;if(0<rj){(rT=re.length)>rG.tmpIdx.length&&(rG.tmpIdx=new Uint16Array(rT));for(var rc=0;rc<rT;rc++)rG.tmpIdx[rc]=re[rc]+rj;this._ib.appendU16Array(rG.tmpIdx,re.length)}else this._ib.append(re);this._ib.setNeedUpload(),this.vertNum+=rT,this.indexNum+=re.length},rQ.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},rQ.destroy=function(){this._ib.destroy(),this._vb.destroy()},rG.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new rG},rG.const_stride=16,rG._POOL=[],rT(rG,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),rG}(),rnS=function(rS){function rQ(){rQ.__super.call(this),this.lock=!0}return rp(rQ,"laya.webgl.shader.BaseShader",rA),rQ.activeShader=null,rQ.bindShader=null,rQ}(),rPS=function(rQ){function ro(rS,rQ,re,rl,rM,rd,rT,rU,ri){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===re&&(re=6408),void 0===rl&&(rl=5121),void 0===rM&&(rM=34041),void 0===rd&&(rd=!1),void 0===rT&&(rT=!1),void 0===rU&&(rU=-1),void 0===ri&&(ri=-1),this._type=1,this._w=rS,this._h=rQ,this._surfaceFormat=re,this._surfaceType=rl,this._depthStencilFormat=rM,rG.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=rd,this._repeat=rT,this._minFifter=rU,this._magFifter=ri,this._createWebGLRenderTarget(),this.bitmap.lock=!0,ro.__super.call(this,this.bitmap,r$.INV_UV)}rp(ro,"laya.webgl.resource.RenderTarget2D",rQ);var rS=ro.prototype;return rB.imps(rS,{"laya.resource.IDispose":!0}),rS.getType=function(){return this._type},rS.getTexture=function(){return this},rS.size=function(rS,rQ){this._w==rS&&this._h==rQ||(this._w=rS,this._h=rQ,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},rS.release=function(){this.destroy()},rS.recycle=function(){ro.POOL.push(this)},rS.start=function(){var rS=rvS.mainContext;return this._preRenderTarget=rzS.curRenderTarget,rzS.curRenderTarget=this,rS.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(rS.viewport(0,0,this._w,this._h),this._svWidth=rzS.width,this._svHeight=rzS.height,rzS.width=this._w,rzS.height=this._h,rnS.activeShader=null),this},rS.clear=function(rS,rQ,re,rl){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=1);var rM=rvS.mainContext;rM.clearColor(rS,rQ,re,rl);var rd=16384;switch(this._depthStencilFormat){case 33189:rd|=256;break;case 36168:rd|=1024;break;case 34041:rd|=256,rd|=1024}rM.clear(rd)},rS.end=function(){var rS=rvS.mainContext;rS.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,rzS.curRenderTarget=this._preRenderTarget,1==this._type?(rS.viewport(0,0,this._svWidth,this._svHeight),rzS.width=this._svWidth,rzS.height=this._svHeight,rnS.activeShader=null):rS.viewport(0,0,rB.stage.width,rB.stage.height)},rS.getData=function(rS,rQ,re,rl){var rM=rvS.mainContext;if(rM.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===rM.checkFramebufferStatus(36160)))return rM.bindFramebuffer(36160,null),null;var rd=new Uint8Array(this._w*this._h*4);return rM.readPixels(rS,rQ,re,rl,this._surfaceFormat,this._surfaceType,rd),rM.bindFramebuffer(36160,null),rd},rS.destroy=function(rS){void 0===rS&&(rS=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,rQ.prototype.destroy.call(this))},rS.dispose=function(){},rS._createWebGLRenderTarget=function(){this.bitmap=new rZS(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(rS){this.event("recovered")})},rl(0,rS,"surfaceFormat",function(){return this._surfaceFormat}),rl(0,rS,"magFifter",function(){return this._magFifter}),rl(0,rS,"surfaceType",function(){return this._surfaceType}),rl(0,rS,"mipMap",function(){return this._mipMap}),rl(0,rS,"depthStencilFormat",function(){return this._depthStencilFormat}),rl(0,rS,"minFifter",function(){return this._minFifter}),rl(0,rS,"source",function(){return this._alreadyResolved?rB.superGet(r$,this,"source"):null}),ro.create=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){void 0===re&&(re=6408),void 0===rl&&(rl=5121),void 0===rM&&(rM=34041),void 0===rd&&(rd=!1),void 0===rT&&(rT=!1),void 0===rU&&(rU=-1),void 0===ri&&(ri=-1);var rR=ro.POOL.pop();return rR||(rR=new ro(rS,rQ)),rR.bitmap&&rR._w==rS&&rR._h==rQ&&rR._surfaceFormat==re&&rR._surfaceType==rl&&rR._depthStencilFormat==rM&&rR._mipMap==rd&&rR._repeat==rT&&rR._minFifter==rU&&rR._magFifter==ri||(rR._w=rS,rR._h=rQ,rR._surfaceFormat=re,rR._surfaceType=rl,rR._depthStencilFormat=rM,rG.isConchWebGL&&34041===rR._depthStencilFormat&&(rR._depthStencilFormat=33189),rR._mipMap=rd,rR._repeat=rT,rR._minFifter=rU,rR._magFifter=ri,rR.release(),rR._createWebGLRenderTarget()),rR},ro.TYPE2D=1,ro.TYPE3D=2,ro.POOL=[],ro}(r$),raS=function(rS){function rQ(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,rQ.__super.call(this),rQ._gl=rvS.mainContext}rp(rQ,"laya.webgl.utils.Buffer",rA);var re=rQ.prototype;return re._bind=function(){this.activeResource(),rQ._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(rQ._bindVertexBuffer=this._glBuffer),rQ._gl.bindBuffer(this._bufferType,rQ._bindActive[this._bufferType]=this._glBuffer),rnS.activeShader=null)},re.recreateResource=function(){this._glBuffer||(this._glBuffer=rQ._gl.createBuffer()),this.completeCreate()},re.disposeResource=function(){this._glBuffer&&(rvS.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},rl(0,re,"bufferUsage",function(){return this._bufferUsage}),rQ._gl=null,rQ._bindActive={},rQ._bindVertexBuffer=null,rQ._enableAtributes=[],rQ}(),rfS=function(rS){function re(rS){this.texcoord=null,this.offsetX=300,this.offsetY=0,re.__super.call(this,512,0);var rQ=8*rjS.BYTES_PE;this.position=[2,5126,!1,rQ,0],this.texcoord=[2,5126,!1,rQ,2*rjS.BYTES_PE],this.color=[4,5126,!1,rQ,4*rjS.BYTES_PE]}return rp(re,"laya.webgl.shader.d2.skinAnishader.SkinSV",rHS),re}(),rwS=function(rS){function rQ(rS){rQ.__super.call(this,2,0),this.color=[]}return rp(rQ,"laya.webgl.shader.d2.value.Color2dSV",rHS),rQ.prototype.setValue=function(rS){rS.fillStyle&&(this.color=rS.fillStyle._color._color),rS.strokeStyle&&(this.color=rS.strokeStyle._color._color)},rQ}(),ruS=function(rS){function rQ(rS){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=rHS._TEXCOORD,rQ.__super.call(this,256,0)}rp(rQ,"laya.webgl.shader.d2.value.FillTextureSV",rHS);var re=rQ.prototype;return re.setValue=function(rS){this.ALPHA=rS.ALPHA,rS.filters&&this.setFilters(rS.filters)},re.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},rQ}(),rrS=function(rS){function rQ(rS){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=rHS._TEXCOORD,void 0===rS&&(rS=0),rQ.__super.call(this,1,rS)}rp(rQ,"laya.webgl.shader.d2.value.TextureSV",rHS);var re=rQ.prototype;return re.setValue=function(rS){this.ALPHA=rS.ALPHA,rS.filters&&this.setFilters(rS.filters)},re.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},rQ}(),rWS=function(rS){function rQ(rS){this.a_color=null,this.u_pos=[0,0],rQ.__super.call(this,4,0),this.position=[2,5126,!1,5*rjS.BYTES_PE,0],this.a_color=[3,5126,!1,5*rjS.BYTES_PE,2*rjS.BYTES_PE]}return rp(rQ,"laya.webgl.shader.d2.value.PrimitiveSV",rHS),rQ}(),rxS=function(rS){function rQ(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,rQ.__super.call(this)}rp(rQ,"laya.webgl.atlas.AtlasWebGLCanvas",rS);var re=rQ.prototype;return re.recreateResource=function(){var rS=rvS.mainContext,rQ=this._source=rS.createTexture(),re=rDS.curBindTexTarget,rl=rDS.curBindTexValue;rDS.bindTexture(rS,3553,rQ),rS.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),rS.texParameteri(3553,10241,9729),rS.texParameteri(3553,10240,9729),rS.texParameteri(3553,10242,33071),rS.texParameteri(3553,10243,33071),re&&rl&&rDS.bindTexture(rS,re,rl),this.memorySize=this._w*this._h*4,this.completeCreate()},re.disposeResource=function(){this._source&&(rvS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},re.texSubImage2D=function(rS,rQ,re){if(rG.isFlash){this._flashCacheImage||(this._flashCacheImage=rj.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var rl=re.bitmapdata;this._flashCacheImage._image.copyPixels(rl,0,0,rl.width,rl.height,rS,rQ),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var rM=rvS.mainContext,rd=rDS.curBindTexTarget,rT=rDS.curBindTexValue;rDS.bindTexture(rM,3553,this._source),rM.pixelStorei(37441,!0),0<=rS-1&&rM.texSubImage2D(3553,0,rS-1,rQ,6408,5121,re),rS+1<=this._w&&rM.texSubImage2D(3553,0,rS+1,rQ,6408,5121,re),0<=rQ-1&&rM.texSubImage2D(3553,0,rS,rQ-1,6408,5121,re),rQ+1<=this._h&&rM.texSubImage2D(3553,0,rS,rQ+1,6408,5121,re),rM.texSubImage2D(3553,0,rS,rQ,6408,5121,re),rM.pixelStorei(37441,!1),rd&&rT&&rDS.bindTexture(rM,rd,rT)}},re.texSubImage2DPixel=function(rS,rQ,re,rl,rM){var rd=rvS.mainContext,rT=rDS.curBindTexTarget,rU=rDS.curBindTexValue;rDS.bindTexture(rd,3553,this._source);var ri=new Uint8Array(rM.data);rd.pixelStorei(37441,!0),rd.texSubImage2D(3553,0,rS,rQ,re,rl,6408,5121,ri),rd.pixelStorei(37441,!1),rT&&rU&&rDS.bindTexture(rd,rT,rU)},rl(0,re,"width",rS.prototype._$get_width,function(rS){this._w=rS}),rl(0,re,"height",rS.prototype._$get_height,function(rS){this._h=rS}),rQ}(re),rFS=function(rS){function rM(){this.flipY=!0,this.alwaysChange=!1,rM.__super.call(this)}rp(rM,"laya.webgl.resource.WebGLCanvas",re);var rQ=rM.prototype;return rQ.getCanvas=function(){return this._canvas},rQ.clear=function(){this._ctx&&this._ctx.clear()},rQ.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},rQ._setContext=function(rS){this._ctx=rS},rQ.getContext=function(rS,rQ){return this._ctx?this._ctx:this._ctx=rM._createContext(this)},rQ.size=function(rS,rQ){this._w==rS&&this._h==rQ||(this._w=rS,this._h=rQ,this._ctx&&this._ctx.size(rS,rQ),this._canvas&&(this._canvas.height=rQ,this._canvas.width=rS))},rQ.activeResource=function(rS){void 0===rS&&(rS=!1),this._source||this.recreateResource()},rQ.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},rQ.disposeResource=function(){this._source&&!this.iscpuSource&&(rvS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},rQ.createWebGlTexture=function(){var rS=rvS.mainContext;this._canvas;var rQ=this._source=rS.createTexture();this.iscpuSource=!1;var re=rDS.curBindTexTarget,rl=rDS.curBindTexValue;rDS.bindTexture(rS,3553,rQ),rS.pixelStorei(37440,this.flipY?1:0),rM.premulAlpha&&rS.pixelStorei(37441,!0),rS.texImage2D(3553,0,6408,6408,5121,this._imgData),rM.premulAlpha&&rS.pixelStorei(37441,!1),rS.texParameteri(3553,10240,9729),rS.texParameteri(3553,10241,9729),rS.texParameteri(3553,10242,33071),rS.texParameteri(3553,10243,33071),rS.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,re&&rl&&rDS.bindTexture(rS,re,rl)},rQ.reloadCanvasData=function(){var rS=rvS.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var rQ=rDS.curBindTexTarget,re=rDS.curBindTexValue;rDS.bindTexture(rS,3553,this._source),rM.premulAlpha&&rS.pixelStorei(37441,!0),rS.texImage2D(3553,0,6408,6408,5121,this._imgData),rM.premulAlpha&&rS.pixelStorei(37441,!1),rS.pixelStorei(37440,0),rQ&&re&&rDS.bindTexture(rS,rQ,re)},rQ.texSubImage2D=function(rS,rQ,re){var rl=rvS.mainContext,rM=rDS.curBindTexTarget,rd=rDS.curBindTexValue;rDS.bindTexture(rl,3553,this._source),rl.pixelStorei(37441,!0),rl.texSubImage2D(3553,0,rQ,re,6408,5121,rS._source),rl.pixelStorei(37441,!1),rM&&rd&&rDS.bindTexture(rl,rM,rd)},rQ.toBase64=function(rS,rQ,re){var rl=null;this._canvas&&(rl=this._canvas.toDataURL(rS,rQ)),re.call(this,rl)},rl(0,rQ,"context",function(){return this._ctx}),rl(0,rQ,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),rl(0,rQ,"asBitmap",null,function(rS){this._ctx&&(this._ctx.asBitmap=rS)}),rM._createContext=null,rM.premulAlpha=!1,rM}(),rqS=function(rS){function rd(rS,rQ){this.CborderSize=12,rd.__super.call(this),this.char=rS,this.isSpace=" "===rS,this.xs=rQ.scaleX,this.ys=rQ.scaleY,this.font=rQ.font.toString(),this.fontSize=rQ.font.size,this.fillColor=rQ.fillColor,this.borderColor=rQ.borderColor,this.lineWidth=rQ.lineWidth,this.underLine=rQ.underLine;var re,rl=rG.isConchApp;rl?((re=ConchTextCanvas)._source=ConchTextCanvas,re._source.canvas=ConchTextCanvas):re=rJ.canvas.source,this.canvas=re,this._enableMerageInAtlas=!0,this._ctx=rl?re:this.canvas.getContext("2d",void 0);var rM=rn.measureText(this.char,this.font);this.cw=rM.width*this.xs,this.ch=(rM.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new r$(this)}rp(rd,"laya.webgl.resource.WebGLCharImage",re);var rQ=rd.prototype;return rB.imps(rQ,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),rQ.active=function(){this.texture.active()},rQ.recreateResource=function(){var rS=rG.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),rS){var rQ=this.fontSize;1==this.xs&&1==this.ys||(rQ=parseInt(rQ*(this.xs>this.ys?this.xs:this.ys)+""));var re="normal 100 "+this.font;re=re.replace(rd._fontSizeReg,rQ),this.borderColor&&(re+=" 1 "+this.borderColor),this._ctx.font=re,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,rm.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var rl=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(rl,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},rQ.onresize=function(rS,rQ){this._w=rS,this._h=rQ,this._allowMerageInAtlas=!0},rQ.clearAtlasSource=function(){},rl(0,rQ,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),rl(0,rQ,"atlasSource",function(){return this.canvas}),rl(0,rQ,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(rS){this._enableMerageInAtlas=rS}),rd.createOneChar=function(rS,rQ){return new rd(rS,rQ)},rd._fontSizeReg=new RegExp("\\d+(?=px)","g"),rd}(),rZS=function(rS){function rR(rS,rQ,re,rl,rM,rd,rT,rU,ri){void 0===re&&(re=6408),void 0===rl&&(rl=5121),void 0===rM&&(rM=34041),void 0===rd&&(rd=!1),void 0===rT&&(rT=!1),void 0===rU&&(rU=-1),void 0===ri&&(ri=1),rR.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=rS,this._h=rQ,this._surfaceFormat=re,this._surfaceType=rl,this._depthStencilFormat=rM,this._mipMap=rd,this._repeat=rT,this._minFifter=rU,this._magFifter=ri}rp(rR,"laya.webgl.resource.WebGLRenderTarget",re);var rQ=rR.prototype;return rQ.recreateResource=function(){var rS=rvS.mainContext;this._frameBuffer||(this._frameBuffer=rS.createFramebuffer()),this._source||(this._source=rS.createTexture());var rQ=rDS.curBindTexTarget,re=rDS.curBindTexValue;rDS.bindTexture(rS,3553,this._source),rS.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var rl=this._minFifter,rM=this._magFifter,rd=this._repeat?10497:33071,rT=ro.isPOT(this._w,this._h);if(rT?(this._mipMap?-1!==rl||(rl=9987):-1!==rl||(rl=9729),-1!==rM||(rM=9729),rS.texParameteri(3553,10241,rl),rS.texParameteri(3553,10240,rM),rS.texParameteri(3553,10242,rd),rS.texParameteri(3553,10243,rd),this._mipMap&&rS.generateMipmap(3553)):(-1!==rl||(rl=9729),-1!==rM||(rM=9729),rS.texParameteri(3553,10241,rl),rS.texParameteri(3553,10240,rM),rS.texParameteri(3553,10242,33071),rS.texParameteri(3553,10243,33071)),rS.bindFramebuffer(36160,this._frameBuffer),rS.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=rS.createRenderbuffer()),rS.bindRenderbuffer(36161,this._depthStencilBuffer),rS.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:rS.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:rS.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:rS.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}rS.bindFramebuffer(36160,null),rQ&&re&&rDS.bindTexture(rS,rQ,re),rS.bindRenderbuffer(36161,null),rT&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},rQ.disposeResource=function(){this._frameBuffer&&(rvS.mainContext.deleteTexture(this._source),rvS.mainContext.deleteFramebuffer(this._frameBuffer),rvS.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},rl(0,rQ,"depthStencilBuffer",function(){return this._depthStencilBuffer}),rl(0,rQ,"frameBuffer",function(){return this._frameBuffer}),rR}(),rNS=function(rS){function rU(rS,rQ,re,rl,rM,rd,rT){this.offsetX=0,this.offsetY=0,rU.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=rd,this.canvas=rS,this._ctx=rS.getContext("2d",void 0),this._w=rl,this._h=rM,this.offsetX=rQ,this.offsetY=re,this.src=rT,this._enableMerageInAtlas=!0,ru.enabled&&this._w<ru.atlasLimitWidth&&this._h<ru.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}rp(rU,"laya.webgl.resource.WebGLSubImage",re);var rQ=rU.prototype;return rB.imps(rQ,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),rQ.size=function(rS,rQ){this._w=rS,this._h=rQ,this._ctx&&this._ctx.size(rS,rQ),this.canvas&&(this.canvas.height=rQ,this.canvas.width=rS)},rQ.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},rQ.createWebGlTexture=function(){var rS=rvS.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var rQ=this._source=rS.createTexture(),re=rDS.curBindTexTarget,rl=rDS.curBindTexValue;rDS.bindTexture(rS,3553,rQ),rS.pixelStorei(37441,!0),rS.texImage2D(3553,0,6408,6408,5121,this.canvas),rS.pixelStorei(37441,!1);var rM=this.minFifter,rd=this.magFifter,rT=this.repeat?10497:33071,rU=ro.isPOT(this.width,this.height);rU?(this.mipmap?-1!==rM||(rM=9987):-1!==rM||(rM=9729),-1!==rd||(rd=9729),rS.texParameteri(3553,10240,rd),rS.texParameteri(3553,10241,rM),rS.texParameteri(3553,10242,rT),rS.texParameteri(3553,10243,rT),this.mipmap&&rS.generateMipmap(3553)):(-1!==rM||(rM=9729),-1!==rd||(rd=9729),rS.texParameteri(3553,10241,rM),rS.texParameteri(3553,10240,rd),rS.texParameteri(3553,10242,33071),rS.texParameteri(3553,10243,33071)),re&&rl&&rDS.bindTexture(rS,re,rl),this.canvas=null,rU&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},rQ.disposeResource=function(){ru.enabled&&this._allowMerageInAtlas||!this._source||(rvS.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},rQ.clearAtlasSource=function(){},rl(0,rQ,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),rl(0,rQ,"atlasSource",function(){return this.canvas}),rl(0,rQ,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(rS){this._allowMerageInAtlas=rS}),rU}(),rCS=function(rS){function rR(rS,rQ,re,rl){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,rR.__super.call(this),!rS||!rQ)throw"Shader Error";this._id=++rR._count,this._vs=rS,this._ps=rQ,this._nameMap=rl||{},null!=re&&(rR.sharders[re]=this)}rp(rR,"laya.webgl.shader.Shader",rnS);var rQ=rR.prototype;return rQ.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},rQ.disposeResource=function(){rvS.mainContext.deleteShader(this._vshader),rvS.mainContext.deleteShader(this._pshader),rvS.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},rQ._compile=function(){if(!rvS.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var rS=[this._vs,this._ps],rQ=rvS.mainContext;if(this._program=rQ.createProgram(),this._vshader=rR._createShader(rQ,rS[0],35633),this._pshader=rR._createShader(rQ,rS[1],35632),rQ.attachShader(this._program,this._vshader),rQ.attachShader(this._program,this._pshader),rQ.linkProgram(this._program),!rG.isConchApp&&!rQ.getProgramParameter(this._program,35714))throw rQ.getProgramInfoLog(this._program);var re,rl,rM=0,rd=0;for(rd=rG.isConchApp?rQ.getProgramParameterEx(this._vs,this._ps,"",35721):rQ.getProgramParameter(this._program,35721),rM=0;rM<rd;rM++){var rT=null;re={vartype:"attribute",glfun:null,ivartype:0,attrib:rT=rG.isConchApp?rQ.getActiveAttribEx(this._vs,this._ps,"",rM):rQ.getActiveAttrib(this._program,rM),location:rQ.getAttribLocation(this._program,rT.name),name:rT.name,type:rT.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(re)}var rU=0;for(rU=rG.isConchApp?rQ.getProgramParameterEx(this._vs,this._ps,"",35718):rQ.getProgramParameter(this._program,35718),rM=0;rM<rU;rM++){var ri=null;ri=rG.isConchApp?rQ.getActiveUniformEx(this._vs,this._ps,"",rM):rQ.getActiveUniform(this._program,rM),0<(re={vartype:"uniform",glfun:null,ivartype:1,attrib:rT,location:rQ.getUniformLocation(this._program,ri.name),name:ri.name,type:ri.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(re.name=re.name.substr(0,re.name.length-3),re.isArray=!0,re.location=rQ.getUniformLocation(this._program,re.name)),this._params.push(re)}for(rM=0,rl=this._params.length;rM<rl;rM++)if((re=this._params[rM]).indexOfParams=rM,re.index=1,re.value=[re.location,null],re.codename=re.name,re.name=this._nameMap[re.codename]?this._nameMap[re.codename]:re.codename,(this._paramsMap[re.name]=re)._this=this,re.uploadedValue=[],"attribute"!==re.vartype)switch(re.type){case 5124:re.fun=re.isArray?this._uniform1iv:this._uniform1i;break;case 5126:re.fun=re.isArray?this._uniform1fv:this._uniform1f;break;case 35664:re.fun=re.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:re.fun=re.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:re.fun=re.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:re.fun=this._uniform_sampler2D;break;case 35680:re.fun=this._uniform_samplerCube;break;case 35676:re.glfun=rQ.uniformMatrix4fv,re.fun=this._uniformMatrix4fv;break;case 35670:re.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else re.fun=this._attribute}},rQ.getUniform=function(rS){return this._paramsMap[rS]},rQ._attribute=function(rS,rQ){var re=rvS.mainContext,rl=raS._enableAtributes,rM=rS.location;return rl[rM]||re.enableVertexAttribArray(rM),re.vertexAttribPointer(rM,rQ[0],rQ[1],rQ[2],rQ[3],rQ[4]+this._offset),rl[rM]=raS._bindVertexBuffer,1},rQ._uniform1f=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ?(rvS.mainContext.uniform1f(rS.location,re[0]=rQ),1):0},rQ._uniform1fv=function(rS,rQ){if(rQ.length<4){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rvS.mainContext.uniform1fv(rS.location,rQ),re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3],1):0}return rvS.mainContext.uniform1fv(rS.location,rQ),1},rQ._uniform_vec2=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]?(rvS.mainContext.uniform2f(rS.location,re[0]=rQ[0],re[1]=rQ[1]),1):0},rQ._uniform_vec2v=function(rS,rQ){if(rQ.length<2){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rvS.mainContext.uniform2fv(rS.location,rQ),re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3],1):0}return rvS.mainContext.uniform2fv(rS.location,rQ),1},rQ._uniform_vec3=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]?(rvS.mainContext.uniform3f(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2]),1):0},rQ._uniform_vec3v=function(rS,rQ){return rvS.mainContext.uniform3fv(rS.location,rQ),1},rQ._uniform_vec4=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rvS.mainContext.uniform4f(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3]),1):0},rQ._uniform_vec4v=function(rS,rQ){return rvS.mainContext.uniform4fv(rS.location,rQ),1},rQ._uniformMatrix2fv=function(rS,rQ){return rvS.mainContext.uniformMatrix2fv(rS.location,!1,rQ),1},rQ._uniformMatrix3fv=function(rS,rQ){return rvS.mainContext.uniformMatrix3fv(rS.location,!1,rQ),1},rQ._uniformMatrix4fv=function(rS,rQ){return rvS.mainContext.uniformMatrix4fv(rS.location,!1,rQ),1},rQ._uniform1i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ?(rvS.mainContext.uniform1i(rS.location,re[0]=rQ),1):0},rQ._uniform1iv=function(rS,rQ){return rvS.mainContext.uniform1iv(rS.location,rQ),1},rQ._uniform_ivec2=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]?(rvS.mainContext.uniform2i(rS.location,re[0]=rQ[0],re[1]=rQ[1]),1):0},rQ._uniform_ivec2v=function(rS,rQ){return rvS.mainContext.uniform2iv(rS.location,rQ),1},rQ._uniform_vec3i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]?(rvS.mainContext.uniform3i(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2]),1):0},rQ._uniform_vec3vi=function(rS,rQ){return rvS.mainContext.uniform3iv(rS.location,rQ),1},rQ._uniform_vec4i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rvS.mainContext.uniform4i(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3]),1):0},rQ._uniform_vec4vi=function(rS,rQ){return rvS.mainContext.uniform4iv(rS.location,rQ),1},rQ._uniform_sampler2D=function(rS,rQ){var re=rvS.mainContext,rl=rS.uploadedValue;return null==rl[0]?(rl[0]=this._curActTexIndex,re.uniform1i(rS.location,this._curActTexIndex),re.activeTexture(rR._TEXTURES[this._curActTexIndex]),rDS.bindTexture(re,3553,rQ),this._curActTexIndex++,1):(re.activeTexture(rR._TEXTURES[rl[0]]),rDS.bindTexture(re,3553,rQ),0)},rQ._uniform_samplerCube=function(rS,rQ){var re=rvS.mainContext,rl=rS.uploadedValue;return null==rl[0]?(rl[0]=this._curActTexIndex,re.uniform1i(rS.location,this._curActTexIndex),re.activeTexture(rR._TEXTURES[this._curActTexIndex]),rDS.bindTexture(re,34067,rQ),this._curActTexIndex++,1):(re.activeTexture(rR._TEXTURES[rl[0]]),rDS.bindTexture(re,34067,rQ),0)},rQ._noSetValue=function(rS){console.log("no....:"+rS.name)},rQ.uploadOne=function(rS,rQ){this.activeResource(),rDS.UseProgram(this._program);var re=this._paramsMap[rS];re.fun.call(this,re,rQ)},rQ.uploadTexture2D=function(rS){rX.shaderCall++;var rQ=rvS.mainContext;rQ.activeTexture(33984),rDS.bindTexture(rQ,3553,rS)},rQ.uploadTexture2D1=function(rS){rX.shaderCall++;var rQ=rvS.mainContext;rQ.activeTexture(33985),rDS.bindTexture(rQ,3553,rS)},rQ.upload=function(rS,rQ){rnS.activeShader=rnS.bindShader=this,this._lastUseFrameCount===rX.loopCount||this.activeResource(),rDS.UseProgram(this._program),this._reCompile?(rQ=this._params,this._reCompile=!1):rQ=rQ||this._params;rvS.mainContext;for(var re,rl,rM=rQ.length,rd=0,rT=0;rT<rM;rT++)null!==(rl=rS[(re=rQ[rT]).name])&&(rd+=re.fun.call(this,re,rl));rX.shaderCall+=rd},rQ.uploadArray=function(rS,rQ,re){rnS.activeShader=this,(rnS.bindShader=this).activeResource(),rDS.UseProgram(this._program);this._params;for(var rl,rM,rd=0,rT=rQ-2;0<=rT;rT-=2)(rM=this._paramsMap[rS[rT]])&&null!=(rl=rS[rT+1])&&(re&&re[rM.name]&&re[rM.name].bind(),rd+=rM.fun.call(this,rM,rl));rX.shaderCall+=rd},rQ.getParams=function(){return this._params},rR.getShader=function(rS){return rR.sharders[rS]},rR.create=function(rS,rQ,re,rl){return new rR(rS,rQ,re,rl)},rR.withCompile=function(rS,rQ,re,rl){if(re&&rR.sharders[re])return rR.sharders[re];var rM=rR._preCompileShader[2e-4*rS];if(!rM)throw new Error("withCompile shader err!"+rS);return rM.createShader(rQ,re,rl)},rR.withCompile2D=function(rS,rQ,re,rl,rM){if(rl&&rR.sharders[rl])return rR.sharders[rl];var rd=rR._preCompileShader[2e-4*rS+rQ];if(!rd)throw new Error("withCompile shader err!"+rS+" "+rQ);return rd.createShader(re,rl,rM)},rR.addInclude=function(rS,rQ){rAS.addInclude(rS,rQ)},rR.preCompile=function(rS,rQ,re,rl){var rM=2e-4*rS;rR._preCompileShader[rM]=new rAS(rM,rQ,re,rl)},rR.preCompile2D=function(rS,rQ,re,rl,rM){var rd=2e-4*rS+rQ;rR._preCompileShader[rd]=new rAS(rd,re,rl,rM)},rR._createShader=function(rS,rQ,re){var rl=rS.createShader(re);return rS.shaderSource(rl,rQ),rS.compileShader(rl),rl},rR._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],rR._count=0,rR._preCompileShader={},rR.SHADERNAME2ID=2e-4,rR.sharders=((rR.sharders=[]).length=32,rR.sharders),rT(rR,["nameKey",function(){return this.nameKey=new rh}]),rR}(),rKS=function(rS){function rQ(){this._maxsize=0,this._upload=!0,this._uploadSize=0,rQ.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}rp(rQ,"laya.webgl.utils.Buffer2D",rS);var re=rQ.prototype;return re.needSize=function(rS){var rQ=this._byteLength;if(rS){var re=this._byteLength+rS;re<=this._buffer.byteLength||this._resizeBuffer(re<<1,!0),this._byteLength=re}return rQ},re._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),rX.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,raS._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),raS._gl.bufferSubData(this._bufferType,0,this._buffer)},re._bufferSubData=function(rS,rQ,re){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),this._maxsize=Math.max(this._maxsize,this._byteLength),rX.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,raS._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),rQ||re){var rl=this._buffer.slice(rQ,re);raS._gl.bufferSubData(this._bufferType,rS,rl)}else raS._gl.bufferSubData(this._bufferType,rS,this._buffer)},re._checkArrayUse=function(){},re._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},re._bind_subUpload=function(rS,rQ,re){return void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(rS,rQ,re),!0)},re._resizeBuffer=function(rS,rQ){if(rS<this._buffer.byteLength)return this;if(this.memorySize=rS,rQ&&this._buffer&&0<this._buffer.byteLength){var re=new ArrayBuffer(rS);new Uint8Array(re).set(new Uint8Array(this._buffer),0),this._buffer=re}else this._buffer=new ArrayBuffer(rS);return this._checkArrayUse(),this._upload=!0,this},re.append=function(rS){this._upload=!0;var rQ,re;rQ=rS.byteLength,rS instanceof Uint8Array?(this._resizeBuffer(this._byteLength+rQ,!0),re=new Uint8Array(this._buffer,this._byteLength)):rS instanceof Uint16Array?(this._resizeBuffer(this._byteLength+rQ,!0),re=new Uint16Array(this._buffer,this._byteLength)):rS instanceof Float32Array&&(this._resizeBuffer(this._byteLength+rQ,!0),re=new Float32Array(this._buffer,this._byteLength)),re.set(rS,0),this._byteLength+=rQ,this._checkArrayUse()},re.appendU16Array=function(rS,rQ){this._resizeBuffer(this._byteLength+2*rQ,!0);for(var re=new Uint16Array(this._buffer,this._byteLength,rQ),rl=0;rl<rQ;rl++)re[rl]=rS[rl];this._byteLength+=2*rQ,this._checkArrayUse()},re.appendEx=function(rS,rQ){this._upload=!0;var re;re=rS.byteLength,this._resizeBuffer(this._byteLength+re,!0),new rQ(this._buffer,this._byteLength).set(rS,0),this._byteLength+=re,this._checkArrayUse()},re.appendEx2=function(rS,rQ,re,rl){void 0===rl&&(rl=1),this._upload=!0;var rM,rd;rM=re*rl,this._resizeBuffer(this._byteLength+rM,!0),rd=new rQ(this._buffer,this._byteLength);var rT=0;for(rT=0;rT<re;rT++)rd[rT]=rS[rT];this._byteLength+=rM,this._checkArrayUse()},re.getBuffer=function(){return this._buffer},re.setNeedUpload=function(){this._upload=!0},re.getNeedUpload=function(){return this._upload},re.upload=function(){var rS=this._bind_upload();return raS._gl.bindBuffer(this._bufferType,null),raS._bindActive[this._bufferType]=null,rnS.activeShader=null,rS},re.subUpload=function(rS,rQ,re){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0);var rl=this._bind_subUpload();return raS._gl.bindBuffer(this._bufferType,null),raS._bindActive[this._bufferType]=null,rnS.activeShader=null,rl},re.disposeResource=function(){rS.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},re.clear=function(){this._byteLength=0,this._upload=!0},rl(0,re,"bufferLength",function(){return this._buffer.byteLength}),rl(0,re,"byteLength",null,function(rS){this._byteLength!==rS&&(rS<=this._buffer.byteLength||this._resizeBuffer(2*rS+256,!0),this._byteLength=rS)}),rQ.__int__=function(rS){rsS.QuadrangleIB=rsS.create(35044),rcS.fillIBQuadrangle(rsS.QuadrangleIB,16)},rQ.FLOAT32=4,rQ.SHORT=2,rQ}(raS),rVS=(function(rQ){function re(rS){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,re.__super.call(this,9)}rp(re,"laya.webgl.shader.d2.value.GlowSV",rQ);var rS=re.prototype;rS.setValue=function(rS){rQ.prototype.setValue.call(this,rS)},rS.clear=function(){rQ.prototype.clear.call(this)}}(rrS),function(rS){function rQ(rS){rQ.__super.call(this,64),this.defines.add(64)}rp(rQ,"laya.webgl.shader.d2.value.TextSV",rS);var re=rQ.prototype;return re.release=function(){(rQ.pool[rQ._length++]=this).clear()},re.clear=function(){rS.prototype.clear.call(this)},rQ.create=function(){return rQ._length?rQ.pool[--rQ._length]:new rQ(null)},rQ.pool=[],rQ._length=0,rQ}(rrS)),r_S=function(rS){function rM(rS,rQ,re,rl){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,rM.__super.call(this,rS,rQ,re,rl)}rp(rM,"laya.webgl.shader.d2.Shader2X",rS);var rQ=rM.prototype;return rQ.upload2dQuick1=function(rS){this.upload(rS,this._params2dQuick1||this._make2dQuick1())},rQ._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var rS,rQ=this._params,re=0,rl=rQ.length;re<rl;re++)rS=rQ[re],(rG.isFlash||"size"!==rS.name&&"position"!==rS.name&&"texcoord"!==rS.name)&&this._params2dQuick1.push(rS)}return this._params2dQuick1},rQ.disposeResource=function(){rS.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},rQ.upload2dQuick2=function(rS){this.upload(rS,this._params2dQuick2||this._make2dQuick2())},rQ._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var rS,rQ=this._params,re=0,rl=rQ.length;re<rl;re++)rS=rQ[re],(rG.isFlash||"size"!==rS.name)&&this._params2dQuick2.push(rS)}return this._params2dQuick2},rM.create=function(rS,rQ,re,rl){return new rM(rS,rQ,re,rl)},rM}(rCS),rsS=function(rS){function rQ(rS){this._uint8Array=null,this._uint16Array=null,void 0===rS&&(rS=35044),rQ.__super.call(this),this._bufferUsage=rS,this._bufferType=34963,rG.isFlash||(this._buffer=new ArrayBuffer(8))}rp(rQ,"laya.webgl.utils.IndexBuffer2D",rKS);var re=rQ.prototype;return re._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},re.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},re.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},re.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},rQ.QuadrangleIB=null,rQ.create=function(rS){return void 0===rS&&(rS=35044),new rQ(rS)},rQ}(),ryS=function(rS){function re(rS,rQ){this._floatArray32=null,this._vertexStride=0,re.__super.call(this),this._vertexStride=rS,this._bufferUsage=rQ,this._bufferType=34962,rG.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}rp(re,"laya.webgl.utils.VertexBuffer2D",rS);var rQ=re.prototype;return rQ.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},rQ.bind=function(rS){rS&&rS._bind(),this._bind()},rQ.insertData=function(rS,rQ){this.getFloat32Array().set(rS,rQ),this._upload=!0},rQ.bind_upload=function(rS){rS._bind_upload()||rS._bind(),this._bind_upload()||this._bind()},rQ._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},rQ.disposeResource=function(){rS.prototype.disposeResource.call(this)},rQ.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},rl(0,rQ,"vertexStride",function(){return this._vertexStride}),re.create=function(rS,rQ){return void 0===rQ&&(rQ=35048),new re(rS,rQ)},re}(rKS),rSQ=function(rS){function rU(rS,rQ,re,rl,rM,rd){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===re&&(re=6408),void 0===rl&&(rl=!0),rU.__super.call(this,rS,rQ),rS){if(this._format=re,this._mipmap=rl,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof rS)this._url=rS,this._src=rS,this._image=new rJ.window.Image,rQ&&(rQ.onload&&(this.onload=rQ.onload),rQ.onerror&&(this.onerror=rQ.onerror),rQ.onCreate&&rQ.onCreate(this)),this._image.crossOrigin=rS&&0==rS.indexOf("data:")?null:"",rS&&(this._image.src=rS);else if(rS instanceof ArrayBuffer){this._src=rQ,this._url=this._src;var rT=new ri(rS);rT.readUTFBytes(4),rT.readUTFBytes(2),rT.getInt16();rT.endian="bigEndian",this._w=rT.getInt16(),this._h=rT.getInt16();rT.getInt16(),rT.getInt16();this._image=new Uint8Array(rS,rT.pos),this._format=rvS.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,ru.enabled&&this._w<ru.atlasLimitWidth&&this._h<ru.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(rS instanceof Uint8Array))return this._src=rQ,this._url=this._src,this._image=rS.source||rS,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=rQ,this._url=this._src,this._w=rM,this._h=rd,this._image=rS,this._format=0===re?rS.byteLength/(rM*rd)==4?6408:6407:re}this._$5__enableMerageInAtlas=!0}}rp(rU,"laya.webgl.resource.WebGLImage",rj);var rQ=rU.prototype;return rB.imps(rQ,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),rQ._init_=function(rS,rQ){},rQ._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var rS=rvS.mainContext,rQ=this._source=rS.createTexture(),re=rDS.curBindTexTarget,rl=rDS.curBindTexValue;rDS.bindTexture(rS,3553,rQ);var rM=this.minFifter,rd=this.magFifter,rT=this.repeat?10497:33071,rU=ro.isPOT(this._w,this._h),ri=!1;switch(rU?(this.mipmap?-1!==rM||(rM=9987):-1!==rM||(rM=9729),-1!==rd||(rd=9729),rS.texParameteri(3553,10241,rM),rS.texParameteri(3553,10240,rd),rS.texParameteri(3553,10242,rT),rS.texParameteri(3553,10243,rT),this.mipmap&&rS.generateMipmap(3553)):(-1!==rM||(rM=9729),-1!==rd||(rd=9729),rS.texParameteri(3553,10241,rM),rS.texParameteri(3553,10240,rd),rS.texParameteri(3553,10242,33071),rS.texParameteri(3553,10243,33071)),rS.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&rS.pixelStorei(rS.UNPACK_ALIGNMENT,1),rS.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&rS.pixelStorei(rS.UNPACK_ALIGNMENT,1),rS.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:ri=!0,rS.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case rvS.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:ri=!0,rS.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}rS.pixelStorei(37441,!1),re&&rl&&rDS.bindTexture(rS,re,rl),this.uri||(this.uri=this._url),ri?this.memorySize=this._image.length:rU&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},rQ.recreateResource=function(){var rS=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var rQ=this;this._image=new rJ.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(rQ._needReleaseAgain)return rQ._needReleaseAgain=!1,rQ._image.onload=null,void(rQ._image=null);rQ._allowMerageInAtlas&&rQ._enableMerageInAtlas?(rS.memorySize=0,rS._recreateLock=!1):rQ._createWebGlTexture(),rQ.completeCreate()},this._image.src=this._src}},rQ.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&rvS.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},rQ.onresize=function(){this._w=this._image.width,this._h=this._image.height,ru.enabled&&this._w<ru.atlasLimitWidth&&this._h<ru.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},rQ.clearAtlasSource=function(){this._image=null},rl(0,rQ,"format",function(){return this._format}),rl(0,rQ,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(rS){this._$5__enableMerageInAtlas=rS}),rl(0,rQ,"mipmap",function(){return this._mipmap}),rl(0,rQ,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),rl(0,rQ,"atlasSource",function(){return this._image}),rl(0,rQ,"onload",null,function(rS){var rQ=this;this._onload=rS,this._image&&(this._image.onload=null!=this._onload?function(){rQ.onresize(),rQ._onload()}:null)}),rl(0,rQ,"onerror",null,function(rS){var rQ=this;this._onerror=rS,this._image&&(this._image.onerror=null!=this._onerror?function(){rQ._onerror()}:null)}),rU}();rB.__init([rJS,rw,rOS,rAS])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}}),function(rd,rS,rl){rl.un,rl.uns;var rM=rl.static,rT=rl.class,rU=rl.getset,ri=(rl.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),rL=laya.utils.ClassUtils,rY=(laya.events.Event,laya.utils.HTMLChar),rR=laya.net.Loader,ro=(laya.display.Node,laya.maths.Rectangle),rp=laya.renders.Render,rJ=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),rj=laya.utils.Stat,rn=laya.display.Text,rc=laya.resource.Texture,rG=laya.net.URL,rz=laya.utils.Utils,rA=function(){function rJ(){}return rT(rJ,"laya.html.utils.HTMLParse"),rJ.parse=function(rS,rQ,re){rQ=(rQ="<root>"+(rQ=rQ.replace(/<br>/g,"<br/>"))+"</root>").replace(rJ.spacePattern,rJ.char255);var rl=rz.parseXMLFromString(rQ);rJ._parseXML(rS,rl.childNodes[0].childNodes,re)},rJ._parseXML=function(rS,rQ,re,rl){var rM=0,rd=0;if(rQ.join||rQ.item)for(rM=0,rd=rQ.length;rM<rd;++rM)rJ._parseXML(rS,rQ[rM],re,rl);else{var rT,rU,ri;if(3==rQ.nodeType)return void(rS instanceof laya.html.dom.HTMLDivElement?(null==rQ.nodeName&&(rQ.nodeName="#text"),rU=rQ.nodeName.toLowerCase(),0<(ri=rQ.textContent.replace(/^\s+|\s+$/g,"")).length&&(rT=rL.getInstance(rU))&&(rS.addChild(rT),rT.innerTEXT=ri.replace(rJ.char255AndOneSpacePattern," "))):0<(ri=rQ.textContent.replace(/^\s+|\s+$/g,"")).length&&(rS.innerTEXT=ri.replace(rJ.char255AndOneSpacePattern," ")));if("#comment"==(rU=rQ.nodeName.toLowerCase()))return;if(rT=rL.getInstance(rU)){(rT=rS.addChild(rT)).URI=re,rT.href=rl;var rR=rQ.attributes;if(rR&&0<rR.length)for(rM=0,rd=rR.length;rM<rd;++rM){var ro=rR[rM],rY=ro.nodeName,rp=ro.value;rT._setAttributes(rY,rp)}rJ._parseXML(rT,rQ.childNodes,re,rT.href)}else rJ._parseXML(rS,rQ.childNodes,re,rl)}},rJ.char255=String.fromCharCode(255),rJ.spacePattern=/&nbsp;|&#160;/g,rJ.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),rJ}(),rv=function(){function r$(){}return rT(r$,"laya.html.utils.Layout"),r$.later=function(rS){null==r$._will&&(r$._will=[],rl.stage.frameLoop(1,null,function(){if(!(r$._will.length<1)){for(var rS=0;rS<r$._will.length;rS++)laya.html.utils.Layout.layout(r$._will[rS]);r$._will.length=0}})),r$._will.push(rS)},r$.layout=function(rS){if(!rS||!rS._style)return null;if(0==(512&rS._style._type))return null;rS.getStyle()._type&=-513;var rQ=r$._multiLineLayout(rS);return rp.isConchApp&&rS.layaoutCallNative&&rS.layaoutCallNative(),rQ},r$._multiLineLayout=function(rS){if(rn.RightToLeft)return r$._multiLineLayout2(rS);var rQ=new Array;rS._addChildsToLayout(rQ);var re,rl,rM,rd,rT,rU=0,ri=rQ.length,rR=rS._getCSSStyle(),ro=rR.letterSpacing,rY=rR.leading,rp=rR.lineHeight,rJ=rR._widthAuto()||!rR.wordWrap,rL=rJ?999999:rS.width,rj=(rS.height,0),rc=rR.italic?rR.fontSize/3:0,rG=rR._getAlign(),rz=rR._getValign(),rA=0!==rz||0!==rG||0!=rp,rv=0,rD=0,rB=0,rO=0,rH=new Array,rg=rH[0]=new rP,rI=!1,rE=!1;rg.h=0,rR.italic&&(rL-=rR.fontSize/3);var rt=0,rk=!0;function rX(){rg.y=rD,rD+=rg.h+rY,0==rg.h&&(rD+=rp),rg.mWidth=rt,rt=0,rg=new rP,rH.push(rg),rg.h=0,rI=!(rk=!(rv=0))}for(rU=0;rU<ri;rU++)if(null!=(re=rQ[rU]))if(rk=!1,re instanceof laya.html.dom.HTMLBrElement)rX(),rg.y=rD;else{if(re._isChar()){if((rd=re).isWord)rI=rE||"\n"===rd.char,rg.wordStartIndex=rg.elements.length;else{if(rB=rd.width+rd.style.letterSpacin,0<rH.length&&rL<rv+rB&&0<rg.wordStartIndex){var rh;rh=rg.elements.length-rg.wordStartIndex+1,rg.elements.length=rg.wordStartIndex,rU-=rh,rX();continue}rI=!1,rt+=rd.width}rB=rd.width+ro,rO=rd.height,rE=!1,(rI=rI||rL<rv+rB)&&rX(),rg.minTextHeight=Math.min(rg.minTextHeight,re.height)}else rl=re._getCSSStyle(),rT=re,rM=rl.padding,0===rl._getCssFloat()||(rA=!0),rI=rE||rl.lineElement,rB=rT.width*rT._style._tf.scaleX+rM[1]+rM[3]+ro,rO=rT.height*rT._style._tf.scaleY+rM[0]+rM[2],rE=rl.lineElement,(rI=rI||rL<rv+rB&&rl.wordWrap)&&rX();rg.elements.push(re),rg.h=Math.max(rg.h,rO),re.x=rv,re.y=rD,rv+=rB,rg.w=rv-ro,rg.y=rD,rj=Math.max(rv+rc,rj)}else rk||(rv+=r$.DIV_ELEMENT_PADDING),rg.wordStartIndex=rg.elements.length;if(rD=rg.y+rg.h,rA){var rb=0,rm=rL;for(rJ&&0<rS.width&&(rm=rS.width),rU=0,ri=rH.length;rU<ri;rU++)rH[rU].updatePos(0,rm,rU,rb,rG,rz,rp),rb+=Math.max(rp,rH[rU].h+rY);rD=rb}return rJ&&(rS.width=rj),rD>rS.height&&(rS.height=rD),[rj,rD]},r$._multiLineLayout2=function(rS){var rQ=new Array;rS._addChildsToLayout(rQ);var re,rl,rM,rd,rT,rU=0,ri=rQ.length,rR=rS._getCSSStyle(),ro=rR.letterSpacing,rY=rR.leading,rp=rR.lineHeight,rJ=rR._widthAuto()||!rR.wordWrap,rL=rJ?999999:rS.width,rj=(rS.height,0),rc=rR.italic?rR.fontSize/3:0,rG=2-rR._getAlign(),rz=rR._getValign(),rA=0!==rz||0!=rG||0!=rp,rv=0,rD=0,rB=0,rO=0,rH=new Array,rg=rH[0]=new rP,rI=!1,rE=!1;rg.h=0,rR.italic&&(rL-=rR.fontSize/3);var rt=0,rk=!0;function rX(){rg.y=rD,rD+=rg.h+rY,0==rg.h&&(rD+=rp),rg.mWidth=rt,rt=0,rg=new rP,rH.push(rg),rg.h=0,rI=!(rk=!(rv=0))}for(rU=0;rU<ri;rU++)if(null!=(re=rQ[rU]))if(rk=!1,re instanceof laya.html.dom.HTMLBrElement)rX(),rg.y=rD;else{if(re._isChar()){if((rd=re).isWord)rI=rE||"\n"===rd.char,rg.wordStartIndex=rg.elements.length;else{if(0<rH.length&&rL<rv+rB&&0<rg.wordStartIndex){var rh;rh=rg.elements.length-rg.wordStartIndex+1,rg.elements.length=rg.wordStartIndex,rU-=rh,rX();continue}rI=!1,rt+=rd.width}rB=rd.width+ro,rO=rd.height,rE=!1,(rI=rI||rL<rv+rB)&&rX(),rg.minTextHeight=Math.min(rg.minTextHeight,re.height)}else rl=re._getCSSStyle(),rT=re,rM=rl.padding,0===rl._getCssFloat()||(rA=!0),rI=rE||rl.lineElement,rB=rT.width*rT._style._tf.scaleX+rM[1]+rM[3]+ro,rO=rT.height*rT._style._tf.scaleY+rM[0]+rM[2],rE=rl.lineElement,(rI=rI||rL<rv+rB&&rl.wordWrap)&&rX();rg.elements.push(re),rg.h=Math.max(rg.h,rO),re.x=rv,re.y=rD,rv+=rB,rg.w=rv-ro,rg.y=rD,rj=Math.max(rv+rc,rj)}else rk||(rv+=r$.DIV_ELEMENT_PADDING),rg.wordStartIndex=rg.elements.length;if(rD=rg.y+rg.h,rA){var rb=0,rm=rL;for(rU=0,ri=rH.length;rU<ri;rU++)rH[rU].updatePos(0,rm,rU,rb,rG,rz,rp),rb+=Math.max(rp,rH[rU].h+rY);rD=rb}for(rJ&&(rS.width=rj),rD>rS.height&&(rS.height=rD),rU=0,ri=rH.length;rU<ri;rU++)rH[rU].revertOrder(rL);return[rj,rD]},r$._will=null,r$.DIV_ELEMENT_PADDING=0,r$}(),rP=function(){function rS(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}rT(rS,"laya.html.utils.LayoutLine");var rQ=rS.prototype;return rQ.updatePos=function(rS,rQ,re,rl,rM,rd,rT){var rU,ri=0;0<this.elements.length&&(ri=(rU=this.elements[this.elements.length-1]).x+rU.width-this.elements[0].x);var rR=0,ro=NaN;1===rM&&(rR=(rQ-ri)/2),2===rM&&(rR=rQ-ri),0===rT||0!=rd||(rd=1);for(var rY=0,rp=this.elements.length;rY<rp;rY++){var rJ=(rU=this.elements[rY])._getCSSStyle();switch(0!==rR&&(rU.x+=rR),rJ._getValign()){case 0:rU.y=rl;break;case 1:var rL=0;99999!=this.minTextHeight&&(rL=this.minTextHeight);var rj=(rL+rT)/2;rj=Math.max(rj,this.h),ro=(laya.html.dom.HTMLImageElement,rl+rj-rU.height),rU.y=ro;break;case 2:rU.y=rl+(rT-rU.height)}}},rQ.revertOrder=function(rS){var rQ;if(0<this.elements.length){var re,rl=0;for(re=this.elements.length,rl=0;rl<re;rl++)(rQ=this.elements[rl]).x=rS-rQ.x-rQ.width}},rS}(),rD=function(re){function rQ(){this.URI=null,this._href=null,rQ.__super.call(this),this._text=rQ._EMPTYTEXT,this.setStyle(new ri(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}rT(rQ,"laya.html.dom.HTMLElement",re);var rS=rQ.prototype;return rS.layaoutCallNative=function(){var rS=0;if(this._childs&&0<(rS=this._childs.length))for(var rQ=0;rQ<rS;rQ++)this._childs[rQ].layaoutCallNative&&this._childs[rQ].layaoutCallNative();var re=this._getWords();re?laya.html.dom.HTMLElement.fillWords(this,re,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},rS.appendChild=function(rS){return this.addChild(rS)},rS._getWords2=function(){var rS=this._text.text;if(!rS||0===rS.length)return null;var rQ,re,rl=0,rM=0;if(this._text.drawWords)re=this._text.drawWords;else{for(rM=(rQ=rS.split(" ")).length-1,re=[],rl=0;rl<rM;rl++)re.push(rQ[rl]," ");0<=rM&&re.push(rQ[rM]),this._text.drawWords=re}var rd,rT=this._text.words;if(rT&&rT.length===re.length)return rT;null===rT&&(this._text.words=rT=[]),rT.length=re.length;var rU=this.style,ri=rU.font;for(rl=0,rM=re.length;rl<rM;rl++){rd=rz.measureText(re[rl],ri);var rR=rT[rl]=new rY(re[rl],rd.width,rd.height||rU.fontSize,rU);if(1<rR.char.length&&(rR.charNum=rR.char),this.href){var ro=new rJ;this.addChild(ro),rR.setSprite(ro)}}return rT},rS._getWords=function(){if(!rn.CharacterCache)return this._getWords2();var rS=this._text.text;if(!rS||0===rS.length)return null;var rQ,re=this._text.words;if(re&&re.length===rS.length)return re;null===re&&(this._text.words=re=[]),re.length=rS.length;for(var rl=this.style,rM=rl.font,rd=0,rT=rS.length;rd<rT;rd++)if(rQ=rz.measureText(rS.charAt(rd),rM)){var rU=re[rd]=new rY(rS.charAt(rd),rQ.width,rQ.height||rl.fontSize,rl);if(this.href){var ri=new rJ;this.addChild(ri),rU.setSprite(ri)}}else console.warn("_getWords size is null"+rS.charAt(rd),rM);return re},rS.showLinkSprite=function(){var rS=this._text.words;if(rS)for(var rQ,re,rl=[],rM=0;rM<rS.length;rM++)re=rS[rM],(rQ=new rJ).graphics.drawRect(0,0,re.width,re.height,"#ff0000"),rQ.width=re.width,rQ.height=re.height,this.addChild(rQ),rl.push(rQ)},rS._layoutLater=function(){var rS=this.style;512&rS._type||(rS.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&rS.block?(rv.later(this),rS._type|=512):this.parent&&this.parent._layoutLater())},rS._setAttributes=function(rS,rQ){switch(rS){case"style":return void this.style.cssText(rQ);case"class":return void(this.className=rQ)}re.prototype._setAttributes.call(this,rS,rQ)},rS.updateHref=function(){if(null!=this._href){var rS=this._getWords();if(rS)for(var rQ,re,rl=0;rl<rS.length;rl++)(re=(rQ=rS[rl]).getSprite())&&(re.size(rQ.width,rQ.height),re.on("click",this,this.onLinkHandler))}},rS.onLinkHandler=function(rS){switch(rS.type){case"click":for(var rQ=this;rQ;)rQ.event("link",[this.href]),rQ=rQ.parent}},rS.formatURL=function(rS){return this.URI?rG.formatURL(rS,this.URI?this.URI.path:null):rS},rU(0,rS,"href",function(){return this._href},function(rS){null!=(this._href=rS)&&(this._getCSSStyle().underLine=1,this.updateHref())}),rU(0,rS,"color",null,function(rS){this.style.color=rS}),rU(0,rS,"onClick",null,function(rS){rl._runScript("fn=function(event){"+rS+";}"),this.on("click",this,void 0)}),rU(0,rS,"id",null,function(rS){rB.document.setElementById(rS,this)}),rU(0,rS,"innerTEXT",function(){return this._text.text},function(rS){this.text=rS}),rU(0,rS,"style",function(){return this._style}),rU(0,rS,"text",function(){return this._text.text},function(rS){this._text==rQ._EMPTYTEXT?this._text={text:rS,words:null}:(this._text.text=rS,this._text.words&&(this._text.words.length=0)),rp.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),rU(0,rS,"parent",re.prototype._$get_parent,function(rS){if(rS instanceof laya.html.dom.HTMLElement){var rQ=rS;this.URI||(this.URI=rQ.URI),this.style.inherit(rQ.style)}rl.superSet(rJ,this,"parent",rS)}),rU(0,rS,"className",null,function(rS){this.style.attrs(rB.document.styleSheets["."+rS])}),rQ.fillWords=function(rS,rQ,re,rl,rM,rd,rT){rS.graphics.clear();for(var rU=0,ri=rQ.length;rU<ri;rU++){var rR=rQ[rU];rS.graphics.fillText(rR.char,rR.x+re,rR.y+rl,rM,rd,"left",rT)}},rQ._EMPTYTEXT={text:null,words:null},rQ}(rJ),rQ=(function(rS){function rQ(){rQ.__super.call(this),this.style.lineElement=!0,this.style.block=!0}rT(rQ,"laya.html.dom.HTMLBrElement",rD)}(),function(rS){function rQ(){this.contextHeight=NaN,this.contextWidth=NaN,rQ.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}rT(rQ,"laya.html.dom.HTMLDivElement",rS);var re=rQ.prototype;return re.appendHTML=function(rS){rA.parse(this,rS,this.URI),this.layout()},re._addChildsToLayout=function(rQ){var rS=this._getWords();if(null==rS&&0==this._childs.length)return!1;rS&&rS.forEach(function(rS){rQ.push(rS)});for(var re=!0,rl=0,rM=this._childs.length;rl<rM;rl++){var rd=this._childs[rl];re?re=!1:rQ.push(null),rd._addToLayout(rQ)}return!0},re._addToLayout=function(rS){this.layout()},re.layout=function(){if(this.style){this.style._type|=512;var rS=rv.layout(this);if(rS){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new ro);var rQ=this._$P.mHtmlBounds;rQ.x=rQ.y=0,rQ.width=this.contextWidth=rS[0],rQ.height=this.contextHeight=rS[1],this.setBounds(rQ)}}},rU(0,re,"height",function(){return this._height?this._height:this.contextHeight},rS.prototype._$set_height),rU(0,re,"innerHTML",null,function(rS){this.destroyChildren(),this.appendHTML(rS)}),rU(0,re,"width",function(){return this._width?this._width:this.contextWidth},function(rS){var rQ=!1;rQ=0===rS?rS!=this._width:rS!=this.width,rl.superSet(rD,this,"width",rS),rQ&&this.layout()}),rQ}(rD)),rB=function(rS){function rQ(){this.all=new Array,this.styleSheets=ri.styleSheets,rQ.__super.call(this)}rT(rQ,"laya.html.dom.HTMLDocument",rD);var re=rQ.prototype;return re.getElementById=function(rS){return this.all[rS]},re.setElementById=function(rS,rQ){this.all[rS]=rQ},rM(rQ,["document",function(){return this.document=new rQ}]),rQ}();(function(rS){function rQ(){this._tex=null,this._url=null,this._renderArgs=[],rQ.__super.call(this),this.style.block=!0}rT(rQ,"laya.html.dom.HTMLImageElement",rD);var re=rQ.prototype;re._addToLayout=function(rS){!this._style.absolute&&rS.push(this)},re.render=function(rS,rQ,re){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(rj.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,rS.ctx.drawTexture2(rQ,re,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},re.layaoutCallNative=function(){var rS=0;if(this._childs&&0<(rS=this._childs.length))for(var rQ=0;rQ<rS;rQ++)this._childs[rQ].layaoutCallNative&&this._childs[rQ].layaoutCallNative()},rU(0,re,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(rS){this._width!==rS&&(this._width=rS,this._style.width=rS,this.repaint())}),rU(0,re,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(rS){this._height!==rS&&(this._height=rS,this._style.height=rS,this.repaint())}),re.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),rR.clearCache(this,this._url),this._tex=null),rD.prototype.destroy.call(this)},re.onloaded=function(){var rS=this._style;rS&&!rS.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),rS&&!rS.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),rp.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},re._loadImageComplete=function(rS,rQ,re){if(!this._destroyed)if(null!=re)if(re instanceof ArrayBuffer){var rl=new DataView(re);new laya.webgl.resource.WebGLImage(new Uint8Array(re,8),rS,0,!1,rl.getUint32(0),rl.getUint32(4));this.onloaded()}else if(re instanceof rc)rR.imgMgrSet[rS]=rQ,rd.imgMgrLock(rS,rR.imgMgrSet[rS]),this._url=rS,this._tex=re,rR.keepCache(this,rS),rR.cacheRes(rS,this._tex),this.onloaded();else{var rM=-1!=rS.indexOf(".png",rS.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(re,rS,rM,!1,re.width,re.height);this.onloaded()}else this.event("error","Load image failed")},rU(0,re,"src",null,function(rS){(rS=this.formatURL(rS),this._url!=rS)&&(null!=this._tex&&(rR.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=rS,(this._tex=rR.getRes(rS))?(rR.keepCache(this,rS),this.onloaded()):rd.imgMgrLoad(rS,this._loadImageComplete.bind(this),2,!1))})})(),function(rS){function rQ(){this.type=null,rQ.__super.call(this),this.visible=!1}rT(rQ,"laya.html.dom.HTMLLinkElement",rS);var re=rQ.prototype;re._onload=function(rS){switch(this.type){case"text/css":ri.parseCSS(rS,this.URI)}},rU(0,re,"href",rS.prototype._$get_href,function(rS){var rQ=this;rS=this.formatURL(rS),this.URI=new rG(rS);var re=new rR;re.once("complete",null,function(rS){rQ._onload(rS)}),re.load(rS,"text")}),rQ._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(rD),function(rS){function rQ(){rQ.__super.call(this),this.visible=!1}rT(rQ,"laya.html.dom.HTMLStyleElement",rS),rU(0,rQ.prototype,"text",rS.prototype._$get_text,function(rS){ri.parseCSS(rS,null)})}(rD),function(rS){function rQ(){rQ.__super.call(this),this._getCSSStyle().valign="middle"}rT(rQ,"laya.html.dom.HTMLIframeElement",rS),rU(0,rQ.prototype,"href",rS.prototype._$get_href,function(re){var rl=this;re=this.formatURL(re);var rS=new rR;rS.once("complete",null,function(rS){var rQ=rl.URI;rl.URI=new rG(re),rl.innerHTML=rS,!rQ||(rl.URI=rQ)}),rS.load(re,"text")})}(rQ)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}}),function(rS,rQ,rj){rj.un,rj.uns;var rl=rj.static,rd=rj.class,rM=rj.getset,re=(rj.__newvec,laya.display.Animation),rc=(laya.utils.Browser,laya.utils.ClassUtils),rT=laya.filters.ColorFilter,rU=laya.utils.Ease,ri=laya.events.Event,rR=(laya.events.EventDispatcher,laya.display.css.Font),ro=laya.display.FrameAnimation,rY=laya.display.Graphics,rp=laya.utils.Handler,rJ=laya.display.Input,rz=laya.net.Loader,rL=(laya.display.Node,laya.maths.Point),rG=laya.maths.Rectangle,rA=laya.renders.Render,rv=laya.display.Sprite,rD=laya.display.Text,rB=laya.resource.Texture,rO=laya.utils.Tween,rH=laya.utils.Utils,rg=laya.utils.WeakObject;rj.interface("laya.ui.IItem"),rj.interface("laya.ui.ISelect"),rj.interface("laya.ui.IRender"),rj.interface("laya.ui.IComponent"),rj.interface("laya.ui.IBox","IComponent");var rI=function(){function rS(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return rd(rS,"laya.ui.LayoutStyle"),rl(rS,["EMPTY",function(){return this.EMPTY=new rS}]),rS}(),rE=function(){function rS(){}return rd(rS,"laya.ui.Styles"),rS.labelColor="#000000",rS.buttonStateNum=3,rS.scrollBarMinNum=15,rS.scrollBarDelayTime=500,rl(rS,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),rS}(),rt=function(){function rM(){}return rd(rM,"laya.ui.UIUtils"),rM.fillArray=function(rS,rQ,re){var rl=rS.concat();if(rQ)for(var rM=rQ.split(","),rd=0,rT=Math.min(rl.length,rM.length);rd<rT;rd++){var rU=rM[rd];rl[rd]="true"==rU||"false"!=rU&&rU,null!=re&&(rl[rd]=re(rU))}return rl},rM.toColor=function(rS){return rH.toHexColor(rS)},rM.gray=function(rS,rQ){void 0===rQ&&(rQ=!0),rQ?rM.addFilter(rS,rM.grayFilter):rM.clearFilter(rS,rT)},rM.addFilter=function(rS,rQ){var re=rS.filters||[];re.push(rQ),rS.filters=re},rM.clearFilter=function(rS,rQ){var re=rS.filters;if(null!=re&&0<re.length){for(var rl=re.length-1;-1<rl;rl--){var rM=re[rl];rj.__typeof(rM,rQ)&&re.splice(rl,1)}rS.filters=re}},rM._getReplaceStr=function(rS){return rM.escapeSequence[rS]},rM.adptString=function(rS){return rS.replace(/\\(\w)/g,rM._getReplaceStr)},rM.getBindFun=function(rS){var rQ=rM._funMap.get(rS);if(null==rQ){var re='"'+rS+'"',rl="(function(data){if(data==null)return;with(data){try{\nreturn "+(re=re.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";rQ=rj._runScript(rl),rM._funMap.set(rS,rQ)}return rQ},rl(rM,["grayFilter",function(){return this.grayFilter=new rT([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new rg}]),rM}(),rk=function(){function rS(){}return rd(rS,"UIConfig"),rS.touchScrollEnable=!0,rS.mouseWheelEnable=!0,rS.showButtons=!0,rS.popupBgColor="#000000",rS.popupBgAlpha=.5,rS.closeDialogOnSide=!0,rS}(),rX=function(re){function rG(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,rG.__super.call(this),this._weakKeys=[]}rd(rG,"laya.ui.AutoBitmap",re);var rS=rG.prototype;return rS.destroy=function(){if(rz.clearObject(this,this._weakKey),this._weakKeys){for(var rS=0,rQ=this._weakKeys.length;rS<rQ;++rS)rz.clearObject(this,this._weakKeys[rS]);this._weakKeys=null}re.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},rS._setChanged=function(){this._isChanged||(this._isChanged=!0,rj.timer.callLater(this,this.changeSource))},rS.changeSource=function(){this._isChanged=!1;var rS=this._source;if(rS&&rS.bitmap){var rQ=this.width,re=this.height,rl=this._sizeGrid,rM=rS.sourceWidth,rd=rS.sourceHeight;if(!rl||rM===rQ&&rd===re)this.cleanByTexture(rS,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,rQ,re);else{rz.clearObject(this,this._weakKey),rS.$_GID||(rS.$_GID=rH.getGID());var rT=rS.$_GID+"."+rQ+"."+re+"."+rl.join("."),rU=rz.findObject(rT);if(rH.isOKCmdList(rU))return this._weakKey=rT,rz.keepObject(this,this._weakKey),void(this.cmds=rU);this.clear();var ri,rR,ro=rl[0],rY=rl[1],rp=rl[2],rJ=rl[3],rL=rl[4],rj=!1;if(rQ==rM&&(rJ=rY=0),re==rd&&(ro=rp=0),rQ<rJ+rY){var rc=rQ;rj=!0,rQ=rJ+rY,this.save(),this.clipRect(0,0,rc,re)}rJ&&ro&&(ri=rG.getTexture(rS,0,0,rJ,ro),rR=this._weakKeys[0],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[0]=ri.weakKey),this.drawTexture(ri,0,0,rJ,ro)):(rz.clearObject(this,rR),this._weakKeys[0]="")),rY&&ro&&(ri=rG.getTexture(rS,rM-rY,0,rY,ro),rR=this._weakKeys[1],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[1]=ri.weakKey),this.drawTexture(ri,rQ-rY,0,rY,ro)):(rz.clearObject(this,rR),this._weakKeys[1]="")),rJ&&rp&&(ri=rG.getTexture(rS,0,rd-rp,rJ,rp),rR=this._weakKeys[2],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[2]=ri.weakKey),this.drawTexture(ri,0,re-rp,rJ,rp)):(rz.clearObject(this,rR),this._weakKeys[2]="")),rY&&rp&&(ri=rG.getTexture(rS,rM-rY,rd-rp,rY,rp),rR=this._weakKeys[3],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[3]=ri.weakKey),this.drawTexture(ri,rQ-rY,re-rp,rY,rp)):(rz.clearObject(this,rR),this._weakKeys[3]="")),ro&&(ri=rG.getTexture(rS,rJ,0,rM-rJ-rY,ro),rR=this._weakKeys[4],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[4]=ri.weakKey),this.drawBitmap(rL,ri,rJ,0,rQ-rJ-rY,ro)):(rz.clearObject(this,rR),this._weakKeys[4]="")),rp&&(ri=rG.getTexture(rS,rJ,rd-rp,rM-rJ-rY,rp),rR=this._weakKeys[5],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[5]=ri.weakKey),this.drawBitmap(rL,ri,rJ,re-rp,rQ-rJ-rY,rp)):(rz.clearObject(this,rR),this._weakKeys[5]="")),rJ&&(ri=rG.getTexture(rS,0,ro,rJ,rd-ro-rp),rR=this._weakKeys[6],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[6]=ri.weakKey),this.drawBitmap(rL,ri,0,ro,rJ,re-ro-rp)):(rz.clearObject(this,rR),this._weakKeys[6]="")),rY&&(ri=rG.getTexture(rS,rM-rY,ro,rY,rd-ro-rp),rR=this._weakKeys[7],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[7]=ri.weakKey),this.drawBitmap(rL,ri,rQ-rY,ro,rY,re-ro-rp)):(rz.clearObject(this,rR),this._weakKeys[7]="")),ri=rG.getTexture(rS,rJ,ro,rM-rJ-rY,rd-ro-rp),rR=this._weakKeys[8],ri?(rR!=ri.weakKey&&(rz.clearObject(this,rR),rz.keepObject(this,ri.weakKey),this._weakKeys[8]=ri.weakKey),this.drawBitmap(rL,ri,rJ,ro,rQ-rJ-rY,re-ro-rp)):(rz.clearObject(this,rR),this._weakKeys[8]=""),rj&&this.restore(),this.autoCacheCmd&&!rA.isConchApp&&(rz.saveObject(rT,this.cmds,null),this._weakKey=rT,rz.keepObject(this,this._weakKey))}this._repaint()}},rS.drawBitmap=function(rS,rQ,re,rl,rM,rd){void 0===rM&&(rM=0),void 0===rd&&(rd=0),rM<.1||rd<.1||(!rS||rQ.width==rM&&rQ.height==rd?this.drawTexture(rQ,re,rl,rM,rd):this.fillTexture(rQ,re,rl,rM,rd))},rS.clear=function(rS){void 0===rS&&(rS=!0),re.prototype.clear.call(this,!1)},rM(0,rS,"sizeGrid",function(){return this._sizeGrid},function(rS){this._sizeGrid=rS,this._setChanged()}),rM(0,rS,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(rS){this._width!=rS&&(this._width=rS,this._setChanged())}),rM(0,rS,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(rS){this._height!=rS&&(this._height=rS,this._setChanged())}),rM(0,rS,"source",function(){return this._source},function(rS){rS?(this._source=rS,this._setChanged()):(this._source=null,this.clear())}),rG.getTexture=function(rS,rQ,re,rl,rM){rl<=0&&(rl=1),rM<=0&&(rM=1),rS.$_GID||(rS.$_GID=rH.getGID());var rd=rS.$_GID+"."+rQ+"."+re+"."+rl+"."+rM,rT=rz.findObject(rd);if((!rT||!rT.source)&&(rT=rB.createFromTexture(rS,rQ,re,rl,rM))){if(rS.alphaTexture){var rU=rS.width/rS.alphaTexture.width;rT.alphaTexture=rB.createFromTexture(rS.alphaTexture,rQ/rU,re/rU,rl/rU,rM/rU)}rz.saveObject(rd,rT),rT.weakKey=rd}return rT},rG}(rY),rh=(function(rS){function rQ(){rQ.__super.call(this)}rd(rQ,"laya.ui.UIEvent",ri),rQ.SHOW_TIP="showtip",rQ.HIDE_TIP="hidetip"}(),function(rQ){function rS(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,rS.__super.call(this),this._layout=rI.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}rd(rS,"laya.ui.Component",rQ);var re=rS.prototype;return rj.imps(re,{"laya.ui.IComponent":!0}),re.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},re.preinitialize=function(){},re.createChildren=function(){},re.initialize=function(){},re.callLater=function(rS,rQ){rj.timer.callLater(this,rS,rQ)},re.runCallLater=function(rS){rj.timer.runCallLater(this,rS)},re.commitMeasure=function(){},re.changeSize=function(){this.event("resize")},re.getLayout=function(){return this._layout===rI.EMPTY&&(this._layout=new rI),this._layout},re._setLayoutEnabled=function(rS){this._layout&&this._layout.enable!=rS&&(this._layout.enable=rS,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},re.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},re.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},re.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},re.resetLayoutX=function(){var rS=this._layout;if(isNaN(rS.anchorX)||(this.pivotX=rS.anchorX*this.width),this.layoutEnabled){var rQ=this.parent;rQ&&(isNaN(rS.centerX)?isNaN(rS.left)?isNaN(rS.right)||(this.x=Math.round(rQ.width-this.displayWidth-rS.right+this.pivotX*this.scaleX)):(this.x=Math.round(rS.left+this.pivotX*this.scaleX),isNaN(rS.right)||(this.width=(rQ._width-rS.left-rS.right)/(this.scaleX||.01))):this.x=Math.round(.5*(rQ.width-this.displayWidth)+rS.centerX+this.pivotX*this.scaleX))}},re.resetLayoutY=function(){var rS=this._layout;if(isNaN(rS.anchorY)||(this.pivotY=rS.anchorY*this.height),this.layoutEnabled){var rQ=this.parent;rQ&&(isNaN(rS.centerY)?isNaN(rS.top)?isNaN(rS.bottom)||(this.y=Math.round(rQ.height-this.displayHeight-rS.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(rS.top+this.pivotY*this.scaleY),isNaN(rS.bottom)||(this.height=(rQ._height-rS.top-rS.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(rQ.height-this.displayHeight)+rS.centerY+this.pivotY*this.scaleY))}},re.onMouseOver=function(rS){rj.stage.event("showtip",this._toolTip)},re.onMouseOut=function(rS){rj.stage.event("hidetip",this._toolTip)},rM(0,re,"displayWidth",function(){return this.width*this.scaleX}),rM(0,re,"width",function(){return this._width?this._width:this.measureWidth},function(rS){this._width!=rS&&(this._width=rS,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),rM(0,re,"measureWidth",function(){var rS=0;this.commitMeasure();for(var rQ=this.numChildren-1;-1<rQ;rQ--){var re=this.getChildAt(rQ);re.visible&&(rS=Math.max(re.x+re.width*re.scaleX,rS))}return rS}),rM(0,re,"displayHeight",function(){return this.height*this.scaleY}),rM(0,re,"height",function(){return this._height?this._height:this.measureHeight},function(rS){this._height!=rS&&(this._height=rS,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),rM(0,re,"dataSource",function(){return this._dataSource},function(rS){for(var rQ in this._dataSource=rS,this._dataSource)this.hasOwnProperty(rQ)&&"function"!=typeof this[rQ]&&(this[rQ]=this._dataSource[rQ])}),rM(0,re,"scaleY",rQ.prototype._$get_scaleY,function(rS){rj.superGet(rv,this,"scaleY")!=rS&&(rj.superSet(rv,this,"scaleY",rS),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),rM(0,re,"measureHeight",function(){var rS=0;this.commitMeasure();for(var rQ=this.numChildren-1;-1<rQ;rQ--){var re=this.getChildAt(rQ);re.visible&&(rS=Math.max(re.y+re.height*re.scaleY,rS))}return rS}),rM(0,re,"scaleX",rQ.prototype._$get_scaleX,function(rS){rj.superGet(rv,this,"scaleX")!=rS&&(rj.superSet(rv,this,"scaleX",rS),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),rM(0,re,"top",function(){return this._layout.top},function(rS){rS!=this._layout.top&&(this.getLayout().top=rS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),rM(0,re,"bottom",function(){return this._layout.bottom},function(rS){rS!=this._layout.bottom&&(this.getLayout().bottom=rS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),rM(0,re,"left",function(){return this._layout.left},function(rS){rS!=this._layout.left&&(this.getLayout().left=rS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),rM(0,re,"right",function(){return this._layout.right},function(rS){rS!=this._layout.right&&(this.getLayout().right=rS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),rM(0,re,"centerX",function(){return this._layout.centerX},function(rS){rS!=this._layout.centerX&&(this.getLayout().centerX=rS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),rM(0,re,"centerY",function(){return this._layout.centerY},function(rS){rS!=this._layout.centerY&&(this.getLayout().centerY=rS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),rM(0,re,"anchorX",function(){return this._layout.anchorX},function(rS){rS!=this._layout.anchorX&&(this.getLayout().anchorX=rS,this._setLayoutEnabled(!0)),this.resetLayoutX()}),rM(0,re,"anchorY",function(){return this._layout.anchorY},function(rS){rS!=this._layout.anchorY&&(this.getLayout().anchorY=rS,this._setLayoutEnabled(!0)),this.resetLayoutY()}),rM(0,re,"tag",function(){return this._tag},function(rS){this._tag=rS}),rM(0,re,"toolTip",function(){return this._toolTip},function(rS){this._toolTip!=rS&&(null!=(this._toolTip=rS)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),rM(0,re,"comXml",function(){return this._comXml},function(rS){this._comXml=rS}),rM(0,re,"gray",function(){return this._gray},function(rS){rS!==this._gray&&(this._gray=rS,rt.gray(this,rS))}),rM(0,re,"disabled",function(){return this._disabled},function(rS){rS!==this._disabled&&(this.gray=this._disabled=rS,this.mouseEnabled=!rS)}),rS}(rv)),rb=function(rS){function rQ(){this.lockLayer=null,this.popupEffect=function(rS){rS.scale(1,1),rO.from(rS,{x:rj.stage.width/2,y:rj.stage.height/2,scaleX:0,scaleY:0},300,rU.backOut,rp.create(this,this.doOpen,[rS]))},this.closeEffect=function(rS,rQ){rO.to(rS,{x:rj.stage.width/2,y:rj.stage.height/2,scaleX:0,scaleY:0},300,rU.strongOut,rp.create(this,this.doClose,[rS,rQ]))},rQ.__super.call(this),this.maskLayer=new rv,this.popupEffectHandler=rp.create(this,this.popupEffect,null,!1),this.closeEffectHandler=rp.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,rj.stage.addChild(this),rj.stage.on("resize",this,this._onResize),rk.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}rd(rQ,"laya.ui.DialogManager",rv);var re=rQ.prototype;return re._closeOnSide=function(){var rS=this.getChildAt(this.numChildren-1);rS instanceof laya.ui.Dialog&&rS.close("side")},re.setLockView=function(rS){this.lockLayer||(this.lockLayer=new rm,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(rj.stage.width,rj.stage.height)),this.lockLayer.removeChildren(),rS&&(rS.centerX=rS.centerY=0,this.lockLayer.addChild(rS))},re._onResize=function(rS){var rQ=this.maskLayer.width=rj.stage.width,re=this.maskLayer.height=rj.stage.height;this.lockLayer&&this.lockLayer.size(rQ,re),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,rQ,re,rk.popupBgColor),this.maskLayer.alpha=rk.popupBgAlpha;for(var rl=this.numChildren-1;-1<rl;rl--){var rM=this.getChildAt(rl);rM.popupCenter&&this._centerDialog(rM)}},re._centerDialog=function(rS){rS.x=Math.round((rj.stage.width-rS.width>>1)+rS.pivotX),rS.y=Math.round((rj.stage.height-rS.height>>1)+rS.pivotY)},re.open=function(rS,rQ,re){void 0===rQ&&(rQ=!1),void 0===re&&(re=!1),rQ&&this._closeAll(),rS.popupCenter&&this._centerDialog(rS),this.addChild(rS),(rS.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),re&&null!=rS.popupEffect?rS.popupEffect.runWith(rS):this.doOpen(rS),this.event("open")},re.doOpen=function(rS){rS.onOpened()},re.lock=function(rS){this.lockLayer&&(rS?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},re.close=function(rS,rQ,re){void 0===re&&(re=!1),re&&null!=rS.closeEffect?rS.closeEffect.runWith([rS,rQ]):this.doClose(rS,rQ),this.event("close")},re.doClose=function(rS,rQ){rS.removeSelf(),rS.isModal&&this._checkMask(),rS.closeHandler&&rS.closeHandler.runWith(rQ),rS.onClosed(rQ)},re.closeAll=function(){this._closeAll(),this.event("close")},re._closeAll=function(){for(var rS=this.numChildren-1;-1<rS;rS--){var rQ=this.getChildAt(rS);rQ&&null!=rQ.close&&this.doClose(rQ)}},re.getDialogsByGroup=function(rS){for(var rQ=[],re=this.numChildren-1;-1<re;re--){var rl=this.getChildAt(re);rl&&rl.group===rS&&rQ.push(rl)}return rQ},re.closeByGroup=function(rS){for(var rQ=[],re=this.numChildren-1;-1<re;re--){var rl=this.getChildAt(re);rl&&rl.group===rS&&(rl.close(),rQ.push(rl))}return rQ},re._checkMask=function(){this.maskLayer.removeSelf();for(var rS=this.numChildren-1;-1<rS;rS--){var rQ=this.getChildAt(rS);if(rQ&&rQ.isModal)return void this.addChildAt(this.maskLayer,rS)}},rQ}(),rm=function(rS){function rQ(){rQ.__super.call(this)}rd(rQ,"laya.ui.Box",rS);var re=rQ.prototype;return rj.imps(re,{"laya.ui.IBox":!0}),rM(0,re,"dataSource",rS.prototype._$get_dataSource,function(rS){for(var rQ in this._dataSource=rS){var re=this.getChildByName(rQ);re?re.dataSource=rS[rQ]:this.hasOwnProperty(rQ)&&"function"!=typeof this[rQ]&&(this[rQ]=rS[rQ])}}),rQ}(rh),r$=function(rQ){function re(rS,rQ){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,re.__super.call(this),this._labelColors=rE.buttonLabelColors,this._stateNum=rE.buttonStateNum,void 0===rQ&&(rQ=""),this.skin=rS,this.label=rQ}rd(re,"laya.ui.Button",rQ);var rS=re.prototype;return rj.imps(rS,{"laya.ui.ISelect":!0}),rS.destroy=function(rS){rz.clearCache(this,this._skin),rz.clearObject(this,this._weakKey),void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(rS),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},rS.createChildren=function(){this.graphics=this._bitmap=new rX},rS.createText=function(){this._text||(this._text=new rD,this._text.overflow=rD.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},rS.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},rS.onMouse=function(rS){if(!1!==this.toggle||!this._selected)return"click"===rS.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=re.stateMap[rS.type]))},rS.changeClips=function(){var rS=rz.getRes(this._skin);if(rS&&this._skin&&""!=this._skin){rz.clearObject(this,this._weakKey);var rQ=rS.sourceWidth,re=rS.sourceHeight/this._stateNum;rS.$_GID||(rS.$_GID=rH.getGID());var rl=rS.$_GID+"-"+this._stateNum,rM=rz.findObject(rl);if(rH.isOkTextureList(rM)||(rM=null),rM)this._weakKey=rl,rz.keepObject(this,this._weakKey),this._sources=rM;else{if(this._sources=[],1===this._stateNum)this._sources.push(rS);else for(var rd=0;rd<this._stateNum;rd++){var rT=rB.createFromTexture(rS,0,re*rd,rQ,re);if(rS.alphaTexture){var rU=rS.width/rS.alphaTexture.width;rT.alphaTexture=rB.createFromTexture(rS.alphaTexture,0/rU,re*rd/rU,rQ/rU,re/rU)}this._sources.push(rT)}rz.saveObject(rl,this._sources),this._weakKey=rl,rz.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||rQ,this._bitmap.height=this._height||re,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=rQ)}else console.warn("lose skin ",this._skin,this.name,this.__className)},rS.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var rS=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[rS]),this.label&&(this._text.color=this._labelColors[rS],this._strokeColors&&(this._text.strokeColor=this._strokeColors[rS]))},rS._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},rM(0,rS,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(rS){this.createText(),this._text.strokeColor=rS}),rM(0,rS,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),rM(0,rS,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(rz.clearCache(this,this._skin),this._skin=rS,rz.keepCache(this,this._skin),this.callLater(this.changeClips),this._setStateChanged())}),rM(0,rS,"state",function(){return this._state},function(rS){this._state!=rS&&(this._state=rS,this._setStateChanged())}),rM(0,rS,"text",function(){return this.createText(),this._text}),rM(0,rS,"stateNum",function(){return this._stateNum},function(rS){"string"==typeof rS&&(rS=parseInt(rS)),this._stateNum!=rS&&(this._stateNum=rS<1?1:3<rS?3:rS,this.callLater(this.changeClips))}),rM(0,rS,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(rS){this._strokeColors=rt.fillArray(rE.buttonLabelColors,rS,String),this._setStateChanged()}),rM(0,rS,"labelColors",function(){return this._labelColors.join(",")},function(rS){this._labelColors=rt.fillArray(rE.buttonLabelColors,rS,String),this._setStateChanged()}),rM(0,rS,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),rM(0,rS,"label",function(){return this._text?this._text.text:null},function(rS){(this._text||rS)&&(this.createText(),this._text.text!=rS&&(rS&&!this._text.parent&&this.addChild(this._text),this._text.text=(rS+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),rM(0,rS,"selected",function(){return this._selected},function(rS){this._selected!=rS&&(this._selected=rS,this.state=this._selected?2:0,this.event("change"))}),rM(0,rS,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(rS){this.createText(),this._text.padding=rt.fillArray(rE.labelPadding,rS,Number)}),rM(0,rS,"labelSize",function(){return this.createText(),this._text.fontSize},function(rS){this.createText(),this._text.fontSize=rS}),rM(0,rS,"labelStroke",function(){return this.createText(),this._text.stroke},function(rS){this.createText(),this._text.stroke=rS}),rM(0,rS,"labelBold",function(){return this.createText(),this._text.bold},function(rS){this.createText(),this._text.bold=rS}),rM(0,rS,"labelFont",function(){return this.createText(),this._text.font},function(rS){this.createText(),this._text.font=rS}),rM(0,rS,"labelAlign",function(){return this.createText(),this._text.align},function(rS){this.createText(),this._text.align=rS}),rM(0,rS,"clickHandler",function(){return this._clickHandler},function(rS){this._clickHandler=rS}),rM(0,rS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(rS){this._bitmap.sizeGrid=rt.fillArray(rE.defaultSizeGrid,rS,Number)}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rh,this,"width",rS),this._autoSize&&(this._bitmap.width=rS,this._text&&(this._text.width=rS))}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rh,this,"height",rS),this._autoSize&&(this._bitmap.height=rS,this._text&&(this._text.height=rS))}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)||"string"==typeof rS?this.label=rS+"":rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(rS){this._bitmap._offset=rS?rt.fillArray([1,1],rS,Number):[]}),rl(re,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),re}(rh),rn=function(rQ){function rl(rS,rQ,re){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,rl.__super.call(this),void 0===rQ&&(rQ=1),void 0===re&&(re=1),this._clipX=rQ,this._clipY=re,this.skin=rS}rd(rl,"laya.ui.Clip",rQ);var rS=rl.prototype;return rS.destroy=function(rS){rz.clearCache(this,this._skin),rz.clearObject(this,this._weakKey),void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},rS.dispose=function(){this.destroy(!0),rj.loader.clearRes(this._skin)},rS.createChildren=function(){this.graphics=this._bitmap=new rX},rS._onDisplay=function(rS){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},rS.changeClip=function(){if(this._clipChanged=!1,this._skin){var rS=rz.getRes(this._skin);rS?this.loadComplete(this._skin,rS):rj.loader.load(this._skin,rp.create(this,this.loadComplete,[this._skin]))}},rS.loadComplete=function(rS,rQ){if(rS===this._skin&&rQ){rz.clearObject(this,this._weakKey);var re=this._clipWidth||Math.ceil(rQ.sourceWidth/this._clipX),rl=this._clipHeight||Math.ceil(rQ.sourceHeight/this._clipY),rM=this._skin+re+rl,rd=rz.findObject(rM);if(rH.isOkTextureList(rd)||(rd=null),rd)this._weakKey=rM,rz.keepObject(this,this._weakKey),this._sources=rd;else{this._sources=[];for(var rT=0;rT<this._clipY;rT++)for(var rU=0;rU<this._clipX;rU++){var ri=rB.createFromTexture(rQ,re*rU,rl*rT,re,rl);if(rQ.alphaTexture){var rR=rQ.width/rQ.alphaTexture.width;ri.alphaTexture=rB.createFromTexture(rQ.alphaTexture,re*rU/rR,rl*rT/rR,re/rR,rl/rR)}this._sources.push(ri)}rz.saveObject(rM,this._sources),this._weakKey=rM,rz.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},rS.play=function(rS,rQ){void 0===rS&&(rS=0),void 0===rQ&&(rQ=-1),this._isPlaying=!0,this.index=rS,this._toIndex=rQ,this._index++,rj.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},rS._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},rS.stop=function(){this._isPlaying=!1,rj.timer.clear(this,this._loop),this.event("complete")},rS._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},rM(0,rS,"interval",function(){return this._interval},function(rS){this._interval!=rS&&(this._interval=rS,this._isPlaying&&this.play())}),rM(0,rS,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(rz.clearCache(this,this._skin),(this._skin=rS)?(rz.keepCache(this,this._skin),this._setClipChanged()):this._bitmap.source=null)}),rM(0,rS,"sources",function(){return this._sources},function(rS){this._sources=rS,this.index=this._index,this.event("loaded")}),rM(0,rS,"clipX",function(){return this._clipX},function(rS){this._clipX=rS||1,this._setClipChanged()}),rM(0,rS,"clipY",function(){return this._clipY},function(rS){this._clipY=rS||1,this._setClipChanged()}),rM(0,rS,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),rM(0,rS,"clipWidth",function(){return this._clipWidth},function(rS){this._clipWidth=rS,this._setClipChanged()}),rM(0,rS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(rS){this._bitmap.sizeGrid=rt.fillArray(rE.defaultSizeGrid,rS,Number)}),rM(0,rS,"group",function(){return this._group},function(rS){rS&&this._skin&&rz.setGroup(this._skin,rS),this._group=rS}),rM(0,rS,"clipHeight",function(){return this._clipHeight},function(rS){this._clipHeight=rS,this._setClipChanged()}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rh,this,"width",rS),this._bitmap.width=rS}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rh,this,"height",rS),this._bitmap.height=rS}),rM(0,rS,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),rM(0,rS,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),rM(0,rS,"index",function(){return this._index},function(rS){this._index=rS,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[rS]),this.event("change")}),rM(0,rS,"autoPlay",function(){return this._autoPlay},function(rS){this._autoPlay!=rS&&((this._autoPlay=rS)?this.play():this.stop())}),rM(0,rS,"isPlaying",function(){return this._isPlaying},function(rS){this._isPlaying=rS}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)&&Math.floor(rS)==rS||"string"==typeof rS?this.index=parseInt(rS):rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"bitmap",function(){return this._bitmap}),rl}(rh),rP=function(rQ){function rS(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,rS.__super.call(this)}rd(rS,"laya.ui.ColorPicker",rQ);var re=rS.prototype;return re.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._colorPanel&&this._colorPanel.destroy(rS),this._colorButton&&this._colorButton.destroy(rS),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},re.createChildren=function(){this.addChild(this._colorButton=new r$),this._colorPanel=new rm,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new rv),this._colorPanel.addChild(this._colorBlock=new rv),this._colorPanel.addChild(this._colorInput=new rJ)},re.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},re.onPanelMouseDown=function(rS){rS.stopPropagation()},re.changePanel=function(){this._panelChanged=!1;var rS=this._colorPanel.graphics;rS.clear(),rS.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(rS=this._colorTiles.graphics).clear();for(var rQ=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],re=0;re<12;re++)for(var rl=0;rl<20;rl++){var rM=0;rM=0===rl?rQ[re]:1===rl?0:51*(((3*re+rl/6)%3<<0)+3*(re/6<<0))<<16|rl%6*51<<8|(re<<0)%6*51;var rd=rt.toColor(rM);this._colors.push(rd);var rT=rl*this._gridSize,rU=re*this._gridSize;rS.drawRect(rT,rU,this._gridSize,this._gridSize,rd,"#000000")}},re.onColorButtonClick=function(rS){this._colorPanel.parent?this.close():this.open()},re.open=function(){var rS=this.localToGlobal(new rL),rQ=rS.x+this._colorPanel.width<=rj.stage.width?rS.x:rj.stage.width-this._colorPanel.width,re=rS.y+this._colorButton.height;re=re+this._colorPanel.height<=rj.stage.height?re:rS.y-this._colorPanel.height,this._colorPanel.pos(rQ,re),this._colorPanel.zOrder=1001,rj._currentStage.addChild(this._colorPanel),rj.stage.on("mousedown",this,this.removeColorBox)},re.close=function(){rj.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},re.removeColorBox=function(rS){this.close()},re.onColorFieldKeyDown=function(rS){13==rS.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),rS.stopPropagation())},re.onColorInputChange=function(rS){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},re.onColorTilesClick=function(rS){this.selectedColor=this.getColorByMouse(),this.close()},re.onColorTilesMouseMove=function(rS){this._colorInput.focus=!1;var rQ=this.getColorByMouse();this._colorInput.text=rQ,this.drawBlock(rQ)},re.getColorByMouse=function(){var rS=this._colorTiles.getMousePoint(),rQ=Math.floor(rS.x/this._gridSize),re=Math.floor(rS.y/this._gridSize);return this._colors[20*re+rQ]},re.drawBlock=function(rS){var rQ=this._colorBlock.graphics;rQ.clear();var re=rS||"#ffffff";rQ.drawRect(0,0,50,20,re,this._borderColor),rS||rQ.drawLine(0,0,50,20,"#ff0000")},re.changeColor=function(){var rS=this.graphics;rS.clear();var rQ=this._selectedColor||"#000000";rS.drawRect(0,0,this._colorButton.width,this._colorButton.height,rQ)},re._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},rM(0,re,"inputBgColor",function(){return this._inputBgColor},function(rS){this._inputBgColor=rS,this._setPanelChanged()}),rM(0,re,"selectedColor",function(){return this._selectedColor},function(rS){this._selectedColor!=rS&&(this._selectedColor=this._colorInput.text=rS,this.drawBlock(rS),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",ri.EMPTY.setTo("change",this,this)))}),rM(0,re,"skin",function(){return this._colorButton.skin},function(rS){this._colorButton.skin=rS,this.changeColor()}),rM(0,re,"bgColor",function(){return this._bgColor},function(rS){this._bgColor=rS,this._setPanelChanged()}),rM(0,re,"borderColor",function(){return this._borderColor},function(rS){this._borderColor=rS,this._setPanelChanged()}),rM(0,re,"inputColor",function(){return this._inputColor},function(rS){this._inputColor=rS,this._setPanelChanged()}),rS}(rh),ra=function(rQ){function re(rS,rQ){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,re.__super.call(this),this._itemColors=rE.comboBoxItemColors,this.skin=rS,this.labels=rQ}rd(re,"laya.ui.ComboBox",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._button&&this._button.destroy(rS),this._list&&this._list.destroy(rS),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},rS.createChildren=function(){this.addChild(this._button=new r$),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},rS._createList=function(){this._list=new rN,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},rS._setListEvent=function(rS){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=rp.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},rS.onListDown=function(rS){rS.stopPropagation()},rS.onScrollBarDown=function(rS){rS.stopPropagation()},rS.onButtonMouseDown=function(rS){this.callLater(this.switchTo,[!this._isOpen])},rS.changeList=function(){this._listChanged=!1;var rS=this.width-2,rQ=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:rS,height:this._itemHeight,fontSize:this._itemSize,color:rQ}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},rS.onlistItemMouse=function(rS,rQ){var re=rS.type;if("mouseover"===re||"mouseout"===re){if(this._isCustomList)return;var rl=this._list.getCell(rQ);if(!rl)return;var rM=rl.getChildByName("label");rM&&("mouseover"===re?(rM.bgColor=this._itemColors[0],rM.color=this._itemColors[1]):(rM.bgColor=null,rM.color=this._itemColors[2]))}else"click"===re&&(this.selectedIndex=rQ,this.isOpen=!1)},rS.switchTo=function(rS){this.isOpen=rS},rS.changeOpen=function(){this.isOpen=!this._isOpen},rS.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var rS=this._list.graphics;rS.clear(),rS.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var rQ=this._list.array||[],re=rQ.length=0,rl=this._labels.length;re<rl;re++)rQ.push({label:this._labels[re]});this._list.height=this._listHeight,this._list.array=rQ},rS.changeSelected=function(){this._button.label=this.selectedLabel},rS._onStageMouseWheel=function(rS){this._list&&!this._list.contains(rS.target)&&this.removeList(null)},rS.removeList=function(rS){rj.stage.off("mousedown",this,this.removeList),rj.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},rM(0,rS,"selectedIndex",function(){return this._selectedIndex},function(rS){this._selectedIndex!=rS&&(this._selectedIndex=rS,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[ri.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),rM(0,rS,"measureHeight",function(){return this._button.height}),rM(0,rS,"skin",function(){return this._button.skin},function(rS){this._button.skin!=rS&&(this._button.skin=rS,this._listChanged=!0)}),rM(0,rS,"measureWidth",function(){return this._button.width}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rh,this,"width",rS),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),rM(0,rS,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(rS){this.selectedIndex=this._labels.indexOf(rS)}),rM(0,rS,"labels",function(){return this._labels.join(",")},function(rS){0<this._labels.length&&(this.selectedIndex=-1),rS?this._labels=rS.split(","):this._labels.length=0,this._itemChanged=!0}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rh,this,"height",rS),this._button.height=this._height}),rM(0,rS,"selectHandler",function(){return this._selectHandler},function(rS){this._selectHandler=rS}),rM(0,rS,"visibleNum",function(){return this._visibleNum},function(rS){this._visibleNum=rS,this._listChanged=!0}),rM(0,rS,"labelBold",function(){return this._button.text.bold},function(rS){this._button.text.bold=rS}),rM(0,rS,"itemColors",function(){return String(this._itemColors)},function(rS){this._itemColors=rt.fillArray(this._itemColors,rS,String),this._listChanged=!0}),rM(0,rS,"itemSize",function(){return this._itemSize},function(rS){this._itemSize=rS,this._listChanged=!0}),rM(0,rS,"scrollBar",function(){return this.list.scrollBar}),rM(0,rS,"isOpen",function(){return this._isOpen},function(rS){if(this._isOpen!=rS)if(this._isOpen=rS,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var rQ=this.localToGlobal(rL.TEMP.setTo(0,0)),re=rQ.y+this._button.height;re=re+this._listHeight<=rj.stage.height?re:rQ.y-this._listHeight,this._list.pos(rQ.x,re),this._list.zOrder=1001,rj._currentStage.addChild(this._list),rj.stage.once("mousedown",this,this.removeList),rj.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),rM(0,rS,"scrollBarSkin",function(){return this._scrollBarSkin},function(rS){this._scrollBarSkin=rS}),rM(0,rS,"sizeGrid",function(){return this._button.sizeGrid},function(rS){this._button.sizeGrid=rS}),rM(0,rS,"button",function(){return this._button}),rM(0,rS,"list",function(){return this._list||this._createList(),this._list},function(rS){rS&&(rS.removeSelf(),this._isCustomList=!0,this._list=rS,this._setListEvent(rS),this._itemHeight=rS.getCell(0).height+rS.spaceY)}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)&&Math.floor(rS)==rS||"string"==typeof rS?this.selectedIndex=parseInt(rS):rS instanceof Array?this.labels=rS.join(","):rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"labelColors",function(){return this._button.labelColors},function(rS){this._button.labelColors!=rS&&(this._button.labelColors=rS)}),rM(0,rS,"labelPadding",function(){return this._button.text.padding.join(",")},function(rS){this._button.text.padding=rt.fillArray(rE.labelPadding,rS,Number)}),rM(0,rS,"labelSize",function(){return this._button.text.fontSize},function(rS){this._button.text.fontSize=rS}),rM(0,rS,"labelFont",function(){return this._button.text.font},function(rS){this._button.text.font=rS}),rM(0,rS,"stateNum",function(){return this._button.stateNum},function(rS){this._button.stateNum=rS}),re}(rh),rf=function(rQ){function re(rS){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,re.__super.call(this),this._showButtons=rk.showButtons,this._touchScrollEnable=rk.touchScrollEnable,this._mouseWheelEnable=rk.mouseWheelEnable,this.skin=rS,this.max=1}rd(re,"laya.ui.ScrollBar",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),this.stopScroll(),this.target=null,rQ.prototype.destroy.call(this,rS),this.upButton&&this.upButton.destroy(rS),this.downButton&&this.downButton.destroy(rS),this.slider&&this.slider.destroy(rS),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},rS.createChildren=function(){this.addChild(this.slider=new rw),this.addChild(this.upButton=new r$),this.addChild(this.downButton=new r$)},rS.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},rS.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},rS.onButtonMouseDown=function(rS){var rQ=rS.currentTarget===this.upButton;this.slide(rQ),rj.timer.once(rE.scrollBarDelayTime,this,this.startLoop,[rQ]),rj.stage.once("mouseup",this,this.onStageMouseUp)},rS.startLoop=function(rS){rj.timer.frameLoop(1,this,this.slide,[rS])},rS.slide=function(rS){rS?this.value-=this._scrollSize:this.value+=this._scrollSize},rS.onStageMouseUp=function(rS){rj.timer.clear(this,this.startLoop),rj.timer.clear(this,this.slide)},rS.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},rS.changeSize=function(){rQ.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},rS.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},rS.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},rS.setScroll=function(rS,rQ,re){this.runCallLater(this.changeSize),this.slider.setSlider(rS,rQ,re),this.slider.bar.visible=0<rQ,!this._hide&&this.autoHide&&(this.visible=!1)},rS.onTargetMouseWheel=function(rS){this.value-=rS.delta*this._scrollSize,this.target=this._target},rS.onTargetMouseDown=function(rS){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new rL),this._lastPoint.setTo(rj.stage.mouseX,rj.stage.mouseY),rj.timer.clear(this,this.tweenMove),rO.clearTween(this),rj.stage.once("mouseup",this,this.onStageMouseUp2),rj.stage.once("mouseout",this,this.onStageMouseUp2),rj.timer.frameLoop(1,this,this.loop)},rS.loop=function(){var rS=rj.stage.mouseY,rQ=rj.stage.mouseX;if(this._lastOffset=this.isVertical?rS-this._lastPoint.y:rQ-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?rj.stage._canvasTransform.getScaleY():rj.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=rQ,this._lastPoint.y=rS,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},rS.onStageMouseUp2=function(rS){if(rj.stage.off("mouseup",this,this.onStageMouseUp2),rj.stage.off("mouseout",this,this.onStageMouseUp2),rj.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?rO.to(this,{value:this.min},this.elasticBackTime,rU.sineOut,rp.create(this,this.elasticOver)):this._value>this.max&&rO.to(this,{value:this.max},this.elasticBackTime,rU.sineOut,rp.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?rj.stage.mouseY-this._lastPoint.y:rj.stage.mouseX-this._lastPoint.x);for(var rQ=0,re=Math.min(this._offsets.length,3),rl=0;rl<re;rl++)rQ+=this._offsets[this._offsets.length-1-rl];if(this._lastOffset=rQ/re,(rQ=Math.abs(this._lastOffset))<2)return void this.event("end");60<rQ&&(this._lastOffset=0<this._lastOffset?60:-60);var rM=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));rj.timer.frameLoop(1,this,this.tweenMove,[rM])}},rS.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&rO.to(this,{alpha:0},500),this.event("end")},rS.tweenMove=function(rS){this._lastOffset*=this.rollRatio;var rQ=NaN;if(0<rS&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,rQ=.5*-(this.min-rS-this.value),this._lastOffset>rQ&&(this._lastOffset=rQ)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,rQ=.5*-(this.max+rS-this.value),this._lastOffset<rQ&&(this._lastOffset=rQ))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(rj.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?rO.to(this,{value:this.min},this.elasticBackTime,rU.sineOut,rp.create(this,this.elasticOver)):this._value>this.max?rO.to(this,{value:this.max},this.elasticBackTime,rU.sineOut,rp.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&rO.to(this,{alpha:0},500)}},rS.stopScroll=function(){this.onStageMouseUp2(null),rj.timer.clear(this,this.tweenMove),rO.clearTween(this)},rM(0,rS,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),rM(0,rS,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(this._skin=rS,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),rM(0,rS,"max",function(){return this.slider.max},function(rS){this.slider.max=rS}),rM(0,rS,"showButtons",function(){return this._showButtons},function(rS){this._showButtons=rS,this.callLater(this.changeScrollBar)}),rM(0,rS,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),rM(0,rS,"min",function(){return this.slider.min},function(rS){this.slider.min=rS}),rM(0,rS,"value",function(){return this._value},function(rS){rS!==this._value&&(this._value=rS,this._isElastic||(this.slider._value!=rS&&(this.slider._value=rS,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),rM(0,rS,"isVertical",function(){return this.slider.isVertical},function(rS){this.slider.isVertical=rS}),rM(0,rS,"sizeGrid",function(){return this.slider.sizeGrid},function(rS){this.slider.sizeGrid=rS}),rM(0,rS,"scrollSize",function(){return this._scrollSize},function(rS){this._scrollSize=rS}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)||"string"==typeof rS?this.value=Number(rS):rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"thumbPercent",function(){return this._thumbPercent},function(rS){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),rS=1<=rS?.99:rS,this._thumbPercent=rS,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*rS,rE.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*rS,rE.scrollBarMinNum))}),rM(0,rS,"target",function(){return this._target},function(rS){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=rS)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),rM(0,rS,"hide",function(){return this._hide},function(rS){this._hide=rS,this.visible=!rS}),rM(0,rS,"touchScrollEnable",function(){return this._touchScrollEnable},function(rS){this._touchScrollEnable=rS,this.target=this._target}),rM(0,rS,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(rS){this._mouseWheelEnable=rS,this.target=this._target}),rM(0,rS,"tick",function(){return this.slider.tick},function(rS){this.slider.tick=rS}),re}(rh),rw=function(rQ){function re(rS){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,re.__super.call(this),this.skin=rS}rd(re,"laya.ui.Slider",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._bg&&this._bg.destroy(rS),this._bar&&this._bar.destroy(rS),this._progress&&this._progress.destroy(rS),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},rS.createChildren=function(){this.addChild(this._bg=new ru),this.addChild(this._bar=new r$)},rS.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},rS.onBarMouseDown=function(rS){this._globalSacle||(this._globalSacle=new rL),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=rj.stage.mouseX,this._ty=rj.stage.mouseY,rj.stage.on("mousemove",this,this.mouseMove),rj.stage.once("mouseup",this,this.mouseUp),rj.stage.once("mouseout",this,this.mouseUp),this.showValueText()},rS.showValueText=function(){if(this.showLabel){var rS=laya.ui.Slider.label;this.addChild(rS),rS.textField.changeText(this._value+""),this.isVertical?(rS.x=this._bar.x+20,rS.y=.5*(this._bar.height-rS.height)+this._bar.y):(rS.y=this._bar.y-20,rS.x=.5*(this._bar.width-rS.width)+this._bar.x)}},rS.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},rS.mouseUp=function(rS){rj.stage.off("mousemove",this,this.mouseMove),rj.stage.off("mouseup",this,this.mouseUp),rj.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},rS.mouseMove=function(rS){var rQ=this._value;this.isVertical?(this._bar.y+=(rj.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(rj.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=rj.stage.mouseX,this._ty=rj.stage.mouseY;var re=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*re)/re,this._value!=rQ&&this.sendChangeEvent(),this.showValueText()},rS.sendChangeEvent=function(rS){void 0===rS&&(rS="change"),this.event(rS),this.changeHandler&&this.changeHandler.runWith(this._value)},rS.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},rS.changeSize=function(){rQ.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},rS.setSlider=function(rS,rQ,re){this._value=-1,this._min=rS,this._max=rS<rQ?rQ:rS,this.value=re<rS?rS:rQ<re?rQ:re},rS.changeValue=function(){var rS=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*rS)/rS,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var rQ=this._max-this._min;0===rQ&&(rQ=1),this.isVertical?(this._bar.y=(this._value-this._min)/rQ*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/rQ*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},rS.onBgMouseDown=function(rS){var rQ=this._bg.getMousePoint();this.isVertical?this.value=rQ.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=rQ.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},rM(0,rS,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),rM(0,rS,"skin",function(){return this._skin},function(rS){if(this._skin!=rS){this._skin=rS,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var rQ=this._skin.replace(".png","$progress.png");rz.getRes(rQ)&&(this._progress||(this.addChild(this._progress=new ru),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=rQ),this.setBarPoint(),this.callLater(this.changeValue)}}),rM(0,rS,"allowClickBack",function(){return this._allowClickBack},function(rS){this._allowClickBack!=rS&&((this._allowClickBack=rS)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),rM(0,rS,"max",function(){return this._max},function(rS){this._max!=rS&&(this._max=rS,this.callLater(this.changeValue))}),rM(0,rS,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),rM(0,rS,"tick",function(){return this._tick},function(rS){this._tick!=rS&&(this._tick=rS,this.callLater(this.changeValue))}),rM(0,rS,"sizeGrid",function(){return this._bg.sizeGrid},function(rS){this._bg.sizeGrid=rS,this._bar.sizeGrid=rS,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),rM(0,rS,"min",function(){return this._min},function(rS){this._min!=rS&&(this._min=rS,this.callLater(this.changeValue))}),rM(0,rS,"value",function(){return this._value},function(rS){if(this._value!=rS){var rQ=this._value;this._value=rS,this.changeValue(),this._value!=rQ&&this.sendChangeEvent()}}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)||"string"==typeof rS?this.value=Number(rS):rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"bar",function(){return this._bar}),rl(re,["label",function(){return this.label=new rr}]),re}(rh),ru=function(rQ){function re(rS){this._bitmap=null,this._skin=null,this._group=null,re.__super.call(this),this.skin=rS}rd(re,"laya.ui.Image",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,rz.clearCache(this,this._skin)},rS.dispose=function(){this.destroy(!0),rz.clearCache(this,this._skin)},rS.createChildren=function(){this.graphics=this._bitmap=new rX},rS.setSource=function(rS,rQ){rS===this._skin&&rQ&&(this.source=rQ,this.onCompResize())},rM(0,rS,"source",function(){return this._bitmap.source},function(rS){this._bitmap&&(this._bitmap.source=rS,this.event("loaded"),this.repaint())}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"string"==typeof(this._dataSource=rS)?this.skin=rS:rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"measureHeight",function(){return this._bitmap.height}),rM(0,rS,"skin",function(){return this._skin},function(rS){if(this._skin!=rS)if(rz.clearCache(this,this._skin),this._skin=rS){rz.keepCache(this,this._skin);var rQ=rz.getRes(rS);rQ?(this.source=rQ,this.onCompResize()):rj.loader.load(this._skin,rp.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),rM(0,rS,"group",function(){return this._group},function(rS){rS&&this._skin&&rz.setGroup(this._skin,rS),this._group=rS}),rM(0,rS,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(rS){this._bitmap.sizeGrid=rt.fillArray(rE.defaultSizeGrid,rS,Number)}),rM(0,rS,"measureWidth",function(){return this._bitmap.width}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rh,this,"width",rS),this._bitmap.width=0==rS?1e-7:rS}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rh,this,"height",rS),this._bitmap.height=0==rS?1e-7:rS}),re}(rh),rr=function(rQ){function re(rS){this._tf=null,re.__super.call(this),void 0===rS&&(rS=""),rR.defaultColor=rE.labelColor,this.text=rS}rd(re,"laya.ui.Label",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._tf=null},rS.createChildren=function(){this.addChild(this._tf=new rD)},rS.changeText=function(rS){this._tf.changeText(rS)},rM(0,rS,"padding",function(){return this._tf.padding.join(",")},function(rS){this._tf.padding=rt.fillArray(rE.labelPadding,rS,Number)}),rM(0,rS,"bold",function(){return this._tf.bold},function(rS){this._tf.bold=rS}),rM(0,rS,"align",function(){return this._tf.align},function(rS){this._tf.align=rS}),rM(0,rS,"text",function(){return this._tf.text},function(rS){this._tf.text!=rS&&(rS&&(rS=rt.adptString(rS+"")),this._tf.text=rS,this.event("change"),this._width&&this._height||this.onCompResize())}),rM(0,rS,"italic",function(){return this._tf.italic},function(rS){this._tf.italic=rS}),rM(0,rS,"wordWrap",function(){return this._tf.wordWrap},function(rS){this._tf.wordWrap=rS}),rM(0,rS,"font",function(){return this._tf.font},function(rS){this._tf.font=rS}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)||"string"==typeof rS?this.text=rS+"":rj.superSet(rh,this,"dataSource",rS)}),rM(0,rS,"color",function(){return this._tf.color},function(rS){this._tf.color=rS}),rM(0,rS,"valign",function(){return this._tf.valign},function(rS){this._tf.valign=rS}),rM(0,rS,"leading",function(){return this._tf.leading},function(rS){this._tf.leading=rS}),rM(0,rS,"fontSize",function(){return this._tf.fontSize},function(rS){this._tf.fontSize=rS}),rM(0,rS,"bgColor",function(){return this._tf.bgColor},function(rS){this._tf.bgColor=rS}),rM(0,rS,"borderColor",function(){return this._tf.borderColor},function(rS){this._tf.borderColor=rS}),rM(0,rS,"stroke",function(){return this._tf.stroke},function(rS){this._tf.stroke=rS}),rM(0,rS,"strokeColor",function(){return this._tf.strokeColor},function(rS){this._tf.strokeColor=rS}),rM(0,rS,"textField",function(){return this._tf}),rM(0,rS,"measureWidth",function(){return this._tf.width}),rM(0,rS,"measureHeight",function(){return this._tf.height}),rM(0,rS,"width",function(){return this._width||this._tf.text?rj.superGet(rh,this,"width"):0},function(rS){rj.superSet(rh,this,"width",rS),this._tf.width=rS}),rM(0,rS,"height",function(){return this._height||this._tf.text?rj.superGet(rh,this,"height"):0},function(rS){rj.superSet(rh,this,"height",rS),this._tf.height=rS}),rM(0,rS,"overflow",function(){return this._tf.overflow},function(rS){this._tf.overflow=rS}),rM(0,rS,"underline",function(){return this._tf.underline},function(rS){this._tf.underline=rS}),rM(0,rS,"underlineColor",function(){return this._tf.underlineColor},function(rS){this._tf.underlineColor=rS}),re}(rh),rW=function(rQ){function re(rS){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,re.__super.call(this),this.skin=rS}rd(re,"laya.ui.ProgressBar",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._bg&&this._bg.destroy(rS),this._bar&&this._bar.destroy(rS),this._bg=this._bar=null,this.changeHandler=null},rS.createChildren=function(){this.addChild(this._bg=new ru),this.addChild(this._bar=new ru)},rS.changeValue=function(){if(this.sizeGrid){var rS=this.sizeGrid.split(","),rQ=Number(rS[3]),re=Number(rS[1]),rl=(this.width-rQ-re)*this._value;this._bar.width=rQ+re+rl,this._bar.visible=this._bar.width>rQ+re}else this._bar.width=this.width*this._value},rM(0,rS,"measureHeight",function(){return this._bg.height}),rM(0,rS,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(this._skin=rS,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),rM(0,rS,"measureWidth",function(){return this._bg.width}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rh,this,"height",rS),this._bg.height=this._height,this._bar.height=this._height}),rM(0,rS,"bar",function(){return this._bar}),rM(0,rS,"value",function(){return this._value},function(rS){this._value!=rS&&(rS=1<rS?1:rS<0?0:rS,this._value=rS,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(rS))}),rM(0,rS,"bg",function(){return this._bg}),rM(0,rS,"sizeGrid",function(){return this._bg.sizeGrid},function(rS){this._bg.sizeGrid=this._bar.sizeGrid=rS}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rh,this,"width",rS),this._bg.width=this._width,this.callLater(this.changeValue)}),rM(0,rS,"dataSource",rQ.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)||"string"==typeof rS?this.value=Number(rS):rj.superSet(rh,this,"dataSource",rS)}),re}(rh),rx=(function(rS){function re(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,re.__super.call(this),this._tipBox=new rh,this._tipBox.addChild(this._tipText=new rD),this._tipText.x=this._tipText.y=5,this._tipText.color=re.tipTextColor,this._defaultTipHandler=this._showDefaultTip,rj.stage.on("showtip",this,this._onStageShowTip),rj.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}rd(re,"laya.ui.TipManager",rh);var rQ=re.prototype;rQ._onStageHideTip=function(rS){rj.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},rQ._onStageShowTip=function(rS){rj.timer.once(re.tipDelay,this,this._showTip,[rS],!0)},rQ._showTip=function(rS){if("string"==typeof rS){var rQ=String(rS);Boolean(rQ)&&this._defaultTipHandler(rQ)}else rS instanceof laya.utils.Handler?rS.run():"function"==typeof rS&&rS.apply();rj.stage.on("mousemove",this,this._onStageMouseMove),rj.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},rQ._onStageMouseDown=function(rS){this.closeAll()},rQ._onStageMouseMove=function(rS){this._showToStage(this,re.offsetX,re.offsetY)},rQ._showToStage=function(rS,rQ,re){void 0===rQ&&(rQ=0),void 0===re&&(re=0);var rl=rS.getBounds();rS.x=rj.stage.mouseX+rQ,rS.y=rj.stage.mouseY+re,rS.x+rl.width>rj.stage.width&&(rS.x-=rl.width+rQ),rS.y+rl.height>rj.stage.height&&(rS.y-=rl.height+re)},rQ.closeAll=function(){rj.timer.clear(this,this._showTip),rj.stage.off("mousemove",this,this._onStageMouseMove),rj.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},rQ.showDislayTip=function(rS){this.addChild(rS),this._showToStage(this),rj._currentStage.addChild(this)},rQ._showDefaultTip=function(rS){this._tipText.text=rS;var rQ=this._tipBox.graphics;rQ.clear(),rQ.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,re.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),rj._currentStage.addChild(this)},rM(0,rQ,"defaultTipHandler",function(){return this._defaultTipHandler},function(rS){this._defaultTipHandler=rS}),re.offsetX=10,re.offsetY=15,re.tipTextColor="#ffffff",re.tipBackColor="#111111",re.tipDelay=200}(),function(rS){var rJ;function rL(){this._idMap=null,this._aniList=null,this._watchMap={},rL.__super.call(this)}rd(rL,"laya.ui.View",rm);var rQ=rL.prototype;return rQ.createView=function(rS){if(rS.animations&&!this._idMap&&(this._idMap={}),rL.createComp(rS,this,this),rS.animations){var rQ,re,rl=[],rM=rS.animations,rd=0,rT=rM.length;for(rd=0;rd<rT;rd++){switch(rQ=new ro,re=rM[rd],rQ._setUp(this._idMap,re),(this[re.name]=rQ)._setControlNode(this),re.action){case 1:rQ.play(0,!1);break;case 2:rQ.play(0,!0)}rl.push(rQ)}this._aniList=rl}0<this._width&&null==rS.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},rQ.onEvent=function(rS,rQ){},rQ.loadUI=function(rS){var rQ=rL.uiMap[rS];rQ&&this.createView(rQ)},rQ.destroy=function(rS){void 0===rS&&(rS=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,rS)},rQ.changeData=function(rS){var rQ=this._watchMap[rS];if(rQ){console.log("change",rS);for(var re=0,rl=rQ.length;re<rl;re++){rQ[re].exe(this)}}},rL._regs=function(){for(var rS in rL.uiClassMap)rc.regClass(rS,rL.uiClassMap[rS])},rL.createComp=function(rS,rQ,re,rl){if(!(rQ=rQ||rL.getCompInstance(rS)))return console.warn("can not create:"+rS.type),null;var rM=rS.child;if(rM)for(var rd=rQ instanceof laya.ui.List,rT=0,rU=rM.length;rT<rU;rT++){var ri=rM[rT];if(!rQ.hasOwnProperty("itemRender")||"render"!=ri.props.name&&"render"!==ri.props.renderType)if("Graphic"==ri.type)rc.addGraphicsToSprite(ri,rQ);else if(rc.isDrawType(ri.type))rc.addGraphicToSprite(ri,rQ,!0);else{if(rd){var rR=[],ro=rL.createComp(ri,null,re,rR);rR.length&&(ro._$bindData=rR)}else ro=rL.createComp(ri,null,re,rl);"Script"==ri.type?"owner"in ro?ro.owner=rQ:"target"in ro&&(ro.target=rQ):"mask"==ri.props.renderType||"mask"==ri.props.name?rQ.mask=ro:ro instanceof laya.display.Sprite&&rQ.addChild(ro)}else rQ.itemRender=ri}var rY=rS.props;for(var rp in rY){var rJ=rY[rp];rL.eventDic[rp]?rJ&&re&&rQ.on(rp,re,re.onEvent,[rJ]):rL.setCompValue(rQ,rp,rJ,re,rl)}return rj.__typeof(rQ,"laya.ui.IItem")&&rQ.initItems(),rS.compId&&re&&re._idMap&&(re._idMap[rS.compId]=rQ),rQ},rL.setCompValue=function(rS,rQ,re,rl,rM){if("string"==typeof re&&-1<re.indexOf("${")){if(rL._sheet||(rL._sheet=rc.getClass("laya.data.Table")),!rL._sheet)return void console.warn("Can not find class Sheet");if(rM)rM.push(rS,rQ,re);else if(rl){-1==re.indexOf("].")&&(re=re.replace(".","[0]."));var rd,rT,rU=new rJ(rS,rQ,re);rU.exe(rl);for(var ri=re.replace(/\[.*?\]\./g,".");null!=(rd=rL._parseWatchData.exec(ri));){for(var rR=rd[1];null!=(rT=rL._parseKeyWord.exec(rR));){var ro=rT[0],rY=rl._watchMap[ro]||(rl._watchMap[ro]=[]);rY.push(rU),rL._sheet.I.notifer.on(ro,rl,rl.changeData,[ro])}(rY=rl._watchMap[rR]||(rl._watchMap[rR]=[])).push(rU),rL._sheet.I.notifer.on(rR,rl,rl.changeData,[rR])}}}else if("var"===rQ&&rl)rl[re]=rS;else if("onClick"==rQ){var rp=rj._runScript("(function(){"+re+"})");rS.on("click",rl,rp)}else rS[rQ]="true"===re||"false"!==re&&re},rL.getCompInstance=function(rS){var rQ,re=rS.props?rS.props.runtime:null;return rQ=re?rL.viewClassMap[re]||rL.uiClassMap[re]||rj.__classmap[re]:rL.uiClassMap[rS.type],rS.props&&rS.props.hasOwnProperty("renderType")&&"instance"==rS.props.renderType?rQ.instance:rQ?new rQ:null},rL.regComponent=function(rS,rQ){rL.uiClassMap[rS]=rQ,rc.regClass(rS,rQ)},rL.regViewRuntime=function(rS,rQ){rL.viewClassMap[rS]=rQ},rL.uiMap={},rL.viewClassMap={},rL._sheet=null,rl(rL,["uiClassMap",function(){return this.uiClassMap={ViewStack:rSS,LinkButton:r$,TextArea:rRS,ColorPicker:rP,Box:rm,Button:r$,CheckBox:rF,Clip:rn,ComboBox:ra,Component:rh,HScrollBar:rC,HSlider:rV,Image:ru,Label:rr,List:rN,Panel:rK,ProgressBar:rW,Radio:rs,RadioGroup:rUS,ScrollBar:rf,Slider:rw,Tab:riS,TextInput:reS,View:rL,VScrollBar:rQS,VSlider:rlS,Tree:ry,HBox:rdS,VBox:rTS,Sprite:rv,Animation:re,Text:rD,FontClip:rZ}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),rL.__init$=function(){rL._regs(),rJ=function(){function rS(rS,rQ,re){this.comp=null,this.prop=null,this.value=null,this.comp=rS,this.prop=rQ,this.value=re}return rd(rS,""),rS.prototype.exe=function(rS){var rQ=rt.getBindFun(this.value);this.comp[this.prop]=rQ.call(this,rS)},rS}()},rL}()),rF=function(rS){function re(rS,rQ){void 0===rQ&&(rQ=""),re.__super.call(this,rS,rQ)}rd(re,"laya.ui.CheckBox",rS);var rQ=re.prototype;return rQ.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},rQ.initialize=function(){rS.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},rM(0,rQ,"dataSource",rS.prototype._$get_dataSource,function(rS){"boolean"==typeof(this._dataSource=rS)?this.selected=rS:"string"==typeof rS?this.selected="true"===rS:rj.superSet(r$,this,"dataSource",rS)}),re}(r$),rq=function(rS){function rQ(){this._space=0,this._align="none",this._itemChanged=!1,rQ.__super.call(this)}rd(rQ,"laya.ui.LayoutBox",rm);var re=rQ.prototype;return re.addChild=function(rS){return rS.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,rS)},re.onResize=function(rS){this._setItemChanged()},re.addChildAt=function(rS,rQ){return rS.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,rS,rQ)},re.removeChild=function(rS){return rS.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,rS)},re.removeChildAt=function(rS){return this.getChildAt(rS).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,rS)},re.refresh=function(){this._setItemChanged()},re.changeItems=function(){this._itemChanged=!1},re.sortItem=function(rS){rS&&rS.sort(function(rS,rQ){return rS.y-rQ.y})},re._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},rM(0,re,"space",function(){return this._space},function(rS){this._space=rS,this._setItemChanged()}),rM(0,re,"align",function(){return this._align},function(rS){this._align=rS,this._setItemChanged()}),rQ}(),rZ=function(rQ){function re(rS,rQ){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,re.__super.call(this),rS&&(this.skin=rS),rQ&&(this.sheet=rQ)}rd(re,"laya.ui.FontClip",rQ);var rS=re.prototype;return rS.createChildren=function(){this._bitmap=new rX,this.on("loaded",this,this._onClipLoaded)},rS._onClipLoaded=function(){this.callLater(this.changeValue)},rS.changeValue=function(){var rS;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),rS=this._sources[0]))){var rQ="horizontal"===this._direction;rQ?(this._wordsW=this._valueArr.length*(rS.sourceWidth+this.spaceX),this._wordsH=rS.sourceHeight):(this._wordsW=rS.sourceWidth,this._wordsH=(rS.sourceHeight+this.spaceY)*this._valueArr.length);var re=0;if(this._width)switch(this._align){case"center":re=.5*(this._width-this._wordsW);break;case"right":re=this._width-this._wordsW;break;default:re=0}for(var rl=0,rM=this._valueArr.length;rl<rM;rl++){var rd=this._indexMap[this._valueArr.charAt(rl)];this.sources[rd]&&(rS=this.sources[rd],rQ?this.graphics.drawTexture(rS,re+rl*(rS.sourceWidth+this.spaceX),0,rS.sourceWidth,rS.sourceHeight):this.graphics.drawTexture(rS,0+re,rl*(rS.sourceHeight+this.spaceY),rS.sourceWidth,rS.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},rS.destroy=function(rS){void 0===rS&&(rS=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),rQ.prototype.destroy.call(this,rS)},rM(0,rS,"sheet",function(){return this._sheet},function(rS){rS+="";var rQ=(this._sheet=rS).split(" ");this._clipX=String(rQ[0]).length,this.clipY=rQ.length,this._indexMap={};for(var re=0;re<this._clipY;re++)for(var rl=rQ[re].split(""),rM=0,rd=rl.length;rM<rd;rM++)this._indexMap[rl[rM]]=re*this._clipX+rM}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rn,this,"height",rS),this.callLater(this.changeValue)}),rM(0,rS,"direction",function(){return this._direction},function(rS){this._direction=rS,this.callLater(this.changeValue)}),rM(0,rS,"value",function(){return this._valueArr?this._valueArr:""},function(rS){rS+="",this._valueArr=rS,this.callLater(this.changeValue)}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rn,this,"width",rS),this.callLater(this.changeValue)}),rM(0,rS,"spaceX",function(){return this._spaceX},function(rS){this._spaceX=rS,"horizontal"===this._direction&&this.callLater(this.changeValue)}),rM(0,rS,"spaceY",function(){return this._spaceY},function(rS){this._spaceY=rS,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),rM(0,rS,"align",function(){return this._align},function(rS){this._align=rS,this.callLater(this.changeValue)}),rM(0,rS,"measureWidth",function(){return this._wordsW}),rM(0,rS,"measureHeight",function(){return this._wordsH}),re}(rn),rN=function(rS){function rQ(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new rL,rQ.__super.call(this)}rd(rQ,"laya.ui.List",rS);var re=rQ.prototype;return rj.imps(re,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),re.destroy=function(rS){void 0===rS&&(rS=!0),this._content&&this._content.destroy(rS),this._scrollBar&&this._scrollBar.destroy(rS),laya.ui.Component.prototype.destroy.call(this,rS),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},re.createChildren=function(){this.addChild(this._content=new rm)},re.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=rj.superGet(rm,this,"cacheAs")),rj.superSet(rm,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},re.onScrollEnd=function(){rj.superSet(rm,this,"cacheAs",this._$P.cacheAs)},re._removePreScrollBar=function(){var rS=this.removeChildByName("scrollBar");rS&&rS.destroy(!0)},re.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var rS=this._getOneCell(),rQ=rS.width+this._spaceX||1,re=rS.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/rQ):Math.ceil(this._width/rQ)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/re):Math.round(this._height/re));var rl=this._width?this._width:rQ*this.repeatX-this._spaceX,rM=this._height?this._height:re*this.repeatY-this._spaceY;this._cellSize=this._isVertical?re:rQ,this._cellOffset=this._isVertical?re*Math.max(this._repeatY2,this._repeatY)-rM-this._spaceY:rQ*Math.max(this._repeatX2,this._repeatX)-rl-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=rM:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=rl),this.setContentSize(rl,rM);var rd=this._isVertical?this.repeatX:this.repeatY,rT=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,rd,rT),this._createdLine=rT,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},re._getOneCell=function(){if(0===this._cells.length){var rS=this.createItem();if(this._offset.setTo(rS.x,rS.y),this.cacheContent)return rS;this._cells.push(rS)}return this._cells[0]},re._createItems=function(rS,rQ,re){var rl=this._content,rM=this._getOneCell(),rd=rM.width+this._spaceX,rT=rM.height+this._spaceY;if(this.cacheContent){var rU=new rm;rU.cacheAsBitmap=!0,rU.pos((this._isVertical?0:rS)*rd,(this._isVertical?rS:0)*rT),this._content.addChild(rU),this._content.optimizeScrollRect=!0,rl=rU}else{for(var ri=[],rR=this._cells.length-1;-1<rR;rR--){var ro=this._cells[rR];ro.removeSelf(),ri.push(ro)}this._cells.length=0}for(var rY=rS;rY<re;rY++)for(var rp=0;rp<rQ;rp++)(rM=ri&&ri.length?ri.pop():this.createItem()).x=(this._isVertical?rp:rY)*rd-rl.x,rM.y=(this._isVertical?rY:rp)*rT-rl.y,rM.name="item"+(rY*rQ+rp),rl.addChild(rM),this.addCell(rM)},re.createItem=function(){var rS=[];if("function"==typeof this._itemRender)var rQ=new this._itemRender;else rQ=rx.createComp(this._itemRender,null,null,rS);if(0==rS.length&&rQ._watchMap){var re=rQ._watchMap;for(var rl in re)for(var rM=re[rl],rd=0;rd<rM.length;rd++){var rT=rM[rd];rS.push(rT.comp,rT.prop,rT.value)}}return rS.length&&(rQ._$bindData=rS),rQ},re.addCell=function(rS){rS.on("click",this,this.onCellMouse),rS.on("rightclick",this,this.onCellMouse),rS.on("mouseover",this,this.onCellMouse),rS.on("mouseout",this,this.onCellMouse),rS.on("mousedown",this,this.onCellMouse),rS.on("mouseup",this,this.onCellMouse),this._cells.push(rS)},re.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var rS=0,rQ=rS=0;rQ<1e4;rQ++){var re=this.getChildByName("item"+rQ);if(!re)break;this.addCell(re),rS++}this.repeatY=rS}},re.setContentSize=function(rS,rQ){this._content.width=rS,this._content.height=rQ,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new rG),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,rS,rQ),this._content.scrollRect=this._content.scrollRect),this.event("resize")},re.onCellMouse=function(rS){"mousedown"===rS.type&&(this._isMoved=!1);var rQ=rS.currentTarget,re=this._startIndex+this._cells.indexOf(rQ);re<0||("click"===rS.type||"rightclick"===rS.type?this.selectEnable&&!this._isMoved?this.selectedIndex=re:this.changeCellState(rQ,!0,0):"mouseover"!==rS.type&&"mouseout"!==rS.type||this._selectedIndex===re||this.changeCellState(rQ,"mouseover"===rS.type,0),this.mouseHandler&&this.mouseHandler.runWith([rS,re]))},re.changeCellState=function(rS,rQ,re){var rl=rS.getChildByName("selectBox");rl&&(this.selectEnable=!0,rl.visible=rQ,rl.index=re)},re.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},re.onScrollBarChange=function(rS){this.runCallLater(this.changeCells);var rQ=this._scrollBar.value,re=this._isVertical?this.repeatX:this.repeatY,rl=this._isVertical?this.repeatY:this.repeatX,rM=Math.floor(rQ/this._cellSize);if(this.cacheContent)rT=rl+1,this._createdLine-rM<rT&&(this._createItems(this._createdLine,re,this._createdLine+rT),this.renderItems(this._createdLine*re,0),this._createdLine+=rT);else{var rd=rM*re,rT=0;if(rd>this._startIndex){rT=rd-this._startIndex;var rU=!0,ri=this._startIndex+re*(rl+1);this._isMoved=!0}else rd<this._startIndex&&(rT=this._startIndex-rd,rU=!1,ri=this._startIndex-1,this._isMoved=!0);for(var rR=0;rR<rT;rR++){if(rU){var ro=this._cells.shift();this._cells[this._cells.length]=ro;var rY=ri+rR}else ro=this._cells.pop(),this._cells.unshift(ro),rY=ri-rR;var rp=Math.floor(rY/re)*this._cellSize;this._isVertical?ro.y=rp:ro.x=rp,this.renderItem(ro,rY)}this._startIndex=rd,this.changeSelectStatus()}var rJ=this._content.scrollRect;this._isVertical?(rJ.y=rQ-this._offset.y,rJ.x=-this._offset.x):(rJ.y=-this._offset.y,rJ.x=rQ-this._offset.x),this._content.scrollRect=rJ},re.posCell=function(rS,rQ){if(this._scrollBar){var re=this._isVertical?this.repeatX:this.repeatY,rl=(this._isVertical?this.repeatY:this.repeatX,Math.floor(rQ/re)*this._cellSize);this._isVertical?rS.y=rl:rS.x=rl}},re.changeSelectStatus=function(){for(var rS=0,rQ=this._cells.length;rS<rQ;rS++)this.changeCellState(this._cells[rS],this._selectedIndex===this._startIndex+rS,1)},re.renderItems=function(rS,rQ){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0);for(var re=rS,rl=rQ||this._cells.length;re<rl;re++)this.renderItem(this._cells[re],this._startIndex+re);this.changeSelectStatus()},re.renderItem=function(rS,rQ){this._array&&0<=rQ&&rQ<this._array.length?(rS.visible=!0,rS._$bindData?(rS._dataSource=this._array[rQ],this._bindData(rS,this._array[rQ])):rS.dataSource=this._array[rQ],this.cacheContent||this.posCell(rS,rQ),this.hasListener("render")&&this.event("render",[rS,rQ]),this.renderHandler&&this.renderHandler.runWith([rS,rQ])):(rS.visible=!1,rS.dataSource=null)},re._bindData=function(rS,rQ){for(var re=rS._$bindData,rl=0,rM=re.length;rl<rM;rl++){var rd=re[rl++],rT=re[rl++],rU=re[rl],ri=rt.getBindFun(rU);rd[rT]=ri.call(this,rQ)}},re.refresh=function(){this.array=this._array},re.getItem=function(rS){return-1<rS&&rS<this._array.length?this._array[rS]:null},re.changeItem=function(rS,rQ){-1<rS&&rS<this._array.length&&(this._array[rS]=rQ,rS>=this._startIndex&&rS<this._startIndex+this._cells.length&&this.renderItem(this.getCell(rS),rS))},re.setItem=function(rS,rQ){this.changeItem(rS,rQ)},re.addItem=function(rS){this._array.push(rS),this.array=this._array},re.addItemAt=function(rS,rQ){this._array.splice(rQ,0,rS),this.array=this._array},re.deleteItem=function(rS){this._array.splice(rS,1),this.array=this._array},re.getCell=function(rS){return this.runCallLater(this.changeCells),-1<rS&&this._cells?this._cells[(rS-this._startIndex)%this._cells.length]:null},re.scrollTo=function(rS){if(this._scrollBar){var rQ=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(rS/rQ)*this._cellSize}else this.startIndex=rS},re.tweenTo=function(rS,rQ,re){if(void 0===rQ&&(rQ=200),this._scrollBar){var rl=this._isVertical?this.repeatX:this.repeatY;rO.to(this._scrollBar,{value:Math.floor(rS/rl)*this._cellSize},rQ,null,re,0,!0)}else this.startIndex=rS,re&&re.run()},re._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},re.commitMeasure=function(){this.runCallLater(this.changeCells)},rM(0,re,"cacheAs",rS.prototype._$get_cacheAs,function(rS){rj.superSet(rm,this,"cacheAs",rS),this._scrollBar&&(this._$P.cacheAs=null,"none"!==rS?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),rM(0,re,"content",function(){return this._content}),rM(0,re,"height",rS.prototype._$get_height,function(rS){rS!=this._height&&(rj.superSet(rm,this,"height",rS),this._setCellChanged())}),rM(0,re,"itemRender",function(){return this._itemRender},function(rS){if(this._itemRender!=rS){this._itemRender=rS;for(var rQ=this._cells.length-1;-1<rQ;rQ--)this._cells[rQ].destroy();this._cells.length=0,this._setCellChanged()}}),rM(0,re,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(rS){this._removePreScrollBar();var rQ=new rQS;rQ.name="scrollBar",rQ.right=0,rS&&" "!=rS&&(rQ.skin=rS),this.scrollBar=rQ,this.addChild(rQ),this._setCellChanged()}),rM(0,re,"page",function(){return this._page},function(rS){this._page=rS,this._array&&(this._page=0<rS?rS:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),rM(0,re,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(rS){this._removePreScrollBar();var rQ=new rC;rQ.name="scrollBar",rQ.bottom=0,rS&&" "!=rS&&(rQ.skin=rS),this.scrollBar=rQ,this.addChild(rQ),this._setCellChanged()}),rM(0,re,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(rS){this._repeatX=rS,this._setCellChanged()}),rM(0,re,"scrollBar",function(){return this._scrollBar},function(rS){this._scrollBar!=rS&&(this._scrollBar=rS)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),rM(0,re,"width",rS.prototype._$get_width,function(rS){rS!=this._width&&(rj.superSet(rm,this,"width",rS),this._setCellChanged())}),rM(0,re,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(rS){this._repeatY=rS,this._setCellChanged()}),rM(0,re,"spaceX",function(){return this._spaceX},function(rS){this._spaceX=rS,this._setCellChanged()}),rM(0,re,"spaceY",function(){return this._spaceY},function(rS){this._spaceY=rS,this._setCellChanged()}),rM(0,re,"selectedIndex",function(){return this._selectedIndex},function(rS){this._selectedIndex!=rS&&(this._selectedIndex=rS,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(rS),this.startIndex=this._startIndex)}),rM(0,re,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(rS){this.selectedIndex=this._array.indexOf(rS)}),rM(0,re,"length",function(){return this._array?this._array.length:0}),rM(0,re,"selection",function(){return this.getCell(this._selectedIndex)},function(rS){this.selectedIndex=this._startIndex+this._cells.indexOf(rS)}),rM(0,re,"startIndex",function(){return this._startIndex},function(rS){this._startIndex=0<rS?rS:0,this.callLater(this.renderItems)}),rM(0,re,"array",function(){return this._array},function(rS){this.runCallLater(this.changeCells),this._array=rS||[];var rQ=this._array.length;if(this.totalPage=Math.ceil(rQ/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<rQ?this._selectedIndex:rQ-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var re=this._isVertical?this.repeatX:this.repeatY,rl=this._isVertical?this.repeatY:this.repeatX,rM=Math.ceil(rQ/re);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=rl/rM,this._scrollBar.setScroll(0,(rM-rl)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),rM(0,re,"dataSource",rS.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)&&Math.floor(rS)==rS||"string"==typeof rS?this.selectedIndex=parseInt(rS):rS instanceof Array?this.array=rS:rj.superSet(rm,this,"dataSource",rS)}),rM(0,re,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),rQ}(rm),rC=function(rS){function rQ(){rQ.__super.call(this)}return rd(rQ,"laya.ui.HScrollBar",rS),rQ.prototype.initialize=function(){rS.prototype.initialize.call(this),this.slider.isVertical=!1},rQ}(rf),rK=function(rS){function rQ(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,rQ.__super.call(this),this.width=this.height=100}rd(rQ,"laya.ui.Panel",rS);var re=rQ.prototype;return re.destroy=function(rS){void 0===rS&&(rS=!0),laya.ui.Component.prototype.destroy.call(this,rS),this._content&&this._content.destroy(rS),this._vScrollBar&&this._vScrollBar.destroy(rS),this._hScrollBar&&this._hScrollBar.destroy(rS),this._vScrollBar=null,this._hScrollBar=null,this._content=null},re.destroyChildren=function(){this._content.destroyChildren()},re.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new rm)},re.addChild=function(rS){return rS.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(rS)},re.onResize=function(){this._setScrollChanged()},re.addChildAt=function(rS,rQ){return rS.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(rS,rQ)},re.removeChild=function(rS){return rS.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(rS)},re.removeChildAt=function(rS){return this.getChildAt(rS).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(rS)},re.removeChildren=function(rS,rQ){return void 0===rS&&(rS=0),void 0===rQ&&(rQ=2147483647),this._content.removeChildren(rS,rQ),this._setScrollChanged(),this},re.getChildAt=function(rS){return this._content.getChildAt(rS)},re.getChildByName=function(rS){return this._content.getChildByName(rS)},re.getChildIndex=function(rS){return this._content.getChildIndex(rS)},re.changeScroll=function(){this._scrollChanged=!1;var rS=this.contentWidth||1,rQ=this.contentHeight||1,re=this._vScrollBar,rl=this._hScrollBar,rM=re&&rQ>this._height,rd=rl&&rS>this._width,rT=rM?this._width-re.width:this._width,rU=rd?this._height-rl.height:this._height;re&&(re.x=this._width-re.width,re.y=0,re.height=this._height-(rd?rl.height:0),re.scrollSize=Math.max(.033*this._height,1),re.thumbPercent=rU/rQ,re.setScroll(0,rQ-rU,re.value)),rl&&(rl.x=0,rl.y=this._height-rl.height,rl.width=this._width-(rM?re.width:0),rl.scrollSize=Math.max(.033*this._width,1),rl.thumbPercent=rT/rS,rl.setScroll(0,rS-rT,rl.value))},re.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},re.setContentSize=function(rS,rQ){var re=this._content;re.width=rS,re.height=rQ,re.scrollRect||(re.scrollRect=new rG),re.scrollRect.setTo(0,0,rS,rQ),re.scrollRect=re.scrollRect},re.onScrollBarChange=function(rS){var rQ=this._content.scrollRect;if(rQ){var re=Math.round(rS.value);rS.isVertical?rQ.y=re:rQ.x=re,this._content.scrollRect=rQ}},re.scrollTo=function(rS,rQ){void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),this.vScrollBar&&(this.vScrollBar.value=rQ),this.hScrollBar&&(this.hScrollBar.value=rS)},re.refresh=function(){this.changeScroll()},re.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=rj.superGet(rm,this,"cacheAs")),rj.superSet(rm,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},re.onScrollEnd=function(){rj.superSet(rm,this,"cacheAs",this._$P.cacheAs)},re._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},rM(0,re,"numChildren",function(){return this._content.numChildren}),rM(0,re,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(rS){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new rC),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=rS}),rM(0,re,"contentWidth",function(){for(var rS=0,rQ=this._content.numChildren-1;-1<rQ;rQ--){var re=this._content.getChildAt(rQ);rS=Math.max(re.x+re.width*re.scaleX,rS)}return rS}),rM(0,re,"contentHeight",function(){for(var rS=0,rQ=this._content.numChildren-1;-1<rQ;rQ--){var re=this._content.getChildAt(rQ);rS=Math.max(re.y+re.height*re.scaleY,rS)}return rS}),rM(0,re,"width",rS.prototype._$get_width,function(rS){rj.superSet(rm,this,"width",rS),this._setScrollChanged()}),rM(0,re,"hScrollBar",function(){return this._hScrollBar}),rM(0,re,"content",function(){return this._content}),rM(0,re,"height",rS.prototype._$get_height,function(rS){rj.superSet(rm,this,"height",rS),this._setScrollChanged()}),rM(0,re,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(rS){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new rQS),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=rS}),rM(0,re,"vScrollBar",function(){return this._vScrollBar}),rM(0,re,"cacheAs",rS.prototype._$get_cacheAs,function(rS){rj.superSet(rm,this,"cacheAs",rS),this._$P.cacheAs=null,"none"!==rS?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),rQ}(rm),rV=function(rS){function rQ(rS){rQ.__super.call(this,rS),this.isVertical=!1}return rd(rQ,"laya.ui.HSlider",rw),rQ}(),r_=function(rS){function re(rS,rQ){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,re.__super.call(this),this.skin=rQ,this.labels=rS}rd(re,"laya.ui.UIGroup",rS);var rQ=re.prototype;return rj.imps(rQ,{"laya.ui.IItem":!0}),rQ.preinitialize=function(){this.mouseEnabled=!0},rQ.destroy=function(rS){void 0===rS&&(rS=!0),laya.ui.Component.prototype.destroy.call(this,rS),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},rQ.addItem=function(rS,rQ){void 0===rQ&&(rQ=!0);var re=rS,rl=this._items.length;if(re.name="item"+rl,this.addChild(re),this.initItems(),rQ&&0<rl){var rM=this._items[rl-1];"horizontal"==this._direction?re.x=rM.x+rM.width+this._space:re.y=rM.y+rM.height+this._space}else rQ&&(re.x=0,re.y=0);return rl},rQ.delItem=function(rS,rQ){void 0===rQ&&(rQ=!0);var re=this._items.indexOf(rS);if(-1!=re){var rl=rS;this.removeChild(rl);for(var rM=re+1,rd=this._items.length;rM<rd;rM++){var rT=this._items[rM];rT.name="item"+(rM-1),rQ&&("horizontal"==this._direction?rT.x-=rl.width+this._space:rT.y-=rl.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var rU;rU=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=rU}}},rQ.initItems=function(){this._items||(this._items=[]);for(var rS=this._items.length=0;rS<1e4;rS++){var rQ=this.getChildByName("item"+rS);if(null==rQ)break;this._items.push(rQ),rQ.selected=rS===this._selectedIndex,rQ.clickHandler=rp.create(this,this.itemClick,[rS],!1)}},rQ.itemClick=function(rS){this.selectedIndex=rS},rQ.setSelect=function(rS,rQ){this._items&&-1<rS&&rS<this._items.length&&(this._items[rS].selected=rQ)},rQ.createItem=function(rS,rQ){return null},rQ.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var rS=0,rQ=0,re=this._items.length;rQ<re;rQ++){var rl=this._items[rQ];this._skin&&(rl.skin=this._skin),this._labelColors&&(rl.labelColors=this._labelColors),this._labelSize&&(rl.labelSize=this._labelSize),this._labelStroke&&(rl.labelStroke=this._labelStroke),this._labelStrokeColor&&(rl.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(rl.strokeColors=this._strokeColors),this._labelBold&&(rl.labelBold=this._labelBold),this._labelPadding&&(rl.labelPadding=this._labelPadding),this._labelAlign&&(rl.labelAlign=this._labelAlign),this._stateNum&&(rl.stateNum=this._stateNum),this._labelFont&&(rl.labelFont=this._labelFont),"horizontal"===this._direction?(rl.y=0,rl.x=rS,rS+=rl.width+this._space):(rl.x=0,rl.y=rS,rS+=rl.height+this._space)}this.changeSize()},rQ.commitMeasure=function(){this.runCallLater(this.changeLabels)},rQ._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},rM(0,rQ,"labelStrokeColor",function(){return this._labelStrokeColor},function(rS){this._labelStrokeColor!=rS&&(this._labelStrokeColor=rS,this._setLabelChanged())}),rM(0,rQ,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(this._skin=rS,this._setLabelChanged())}),rM(0,rQ,"selectedIndex",function(){return this._selectedIndex},function(rS){this._selectedIndex!=rS&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=rS,this.setSelect(rS,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),rM(0,rQ,"labels",function(){return this._labels},function(rS){if(this._labels!=rS){if(this._labels=rS,this.removeChildren(),this._setLabelChanged(),this._labels)for(var rQ=this._labels.split(","),re=0,rl=rQ.length;re<rl;re++){var rM=this.createItem(this._skin,rQ[re]);rM.name="item"+re,this.addChild(rM)}this.initItems()}}),rM(0,rQ,"strokeColors",function(){return this._strokeColors},function(rS){this._strokeColors!=rS&&(this._strokeColors=rS,this._setLabelChanged())}),rM(0,rQ,"labelColors",function(){return this._labelColors},function(rS){this._labelColors!=rS&&(this._labelColors=rS,this._setLabelChanged())}),rM(0,rQ,"labelStroke",function(){return this._labelStroke},function(rS){this._labelStroke!=rS&&(this._labelStroke=rS,this._setLabelChanged())}),rM(0,rQ,"labelSize",function(){return this._labelSize},function(rS){this._labelSize!=rS&&(this._labelSize=rS,this._setLabelChanged())}),rM(0,rQ,"stateNum",function(){return this._stateNum},function(rS){this._stateNum!=rS&&(this._stateNum=rS,this._setLabelChanged())}),rM(0,rQ,"labelBold",function(){return this._labelBold},function(rS){this._labelBold!=rS&&(this._labelBold=rS,this._setLabelChanged())}),rM(0,rQ,"labelFont",function(){return this._labelFont},function(rS){this._labelFont!=rS&&(this._labelFont=rS,this._setLabelChanged())}),rM(0,rQ,"labelPadding",function(){return this._labelPadding},function(rS){this._labelPadding!=rS&&(this._labelPadding=rS,this._setLabelChanged())}),rM(0,rQ,"direction",function(){return this._direction},function(rS){this._direction=rS,this._setLabelChanged()}),rM(0,rQ,"space",function(){return this._space},function(rS){this._space=rS,this._setLabelChanged()}),rM(0,rQ,"items",function(){return this._items}),rM(0,rQ,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(rS){this.selectedIndex=this._items.indexOf(rS)}),rM(0,rQ,"dataSource",rS.prototype._$get_dataSource,function(rS){"number"==typeof(this._dataSource=rS)&&Math.floor(rS)==rS||"string"==typeof rS?this.selectedIndex=parseInt(rS):rS instanceof Array?this.labels=rS.join(","):rj.superSet(rm,this,"dataSource",rS)}),re}(rm),rs=function(rQ){function re(rS,rQ){this._value=null,void 0===rQ&&(rQ=""),re.__super.call(this,rS,rQ)}rd(re,"laya.ui.Radio",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._value=null},rS.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},rS.initialize=function(){rQ.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},rS.onClick=function(rS){this.selected=!0},rM(0,rS,"value",function(){return null!=this._value?this._value:this.label},function(rS){this._value=rS}),re}(r$),ry=function(rS){function rQ(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,rQ.__super.call(this),this.width=this.height=200}rd(rQ,"laya.ui.Tree",rS);var re=rQ.prototype;return rj.imps(re,{"laya.ui.IRender":!0}),re.destroy=function(rS){void 0===rS&&(rS=!0),laya.ui.Component.prototype.destroy.call(this,rS),this._list&&this._list.destroy(rS),this._list=null,this._source=null,this._renderHandler=null},re.createChildren=function(){this.addChild(this._list=new rN),this._list.renderHandler=rp.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},re.onListChange=function(rS){this.event("change")},re.getArray=function(){var rS,rQ=[];for(var re in this._source)rS=this._source[re],this.getParentOpenStatus(rS)&&(rS.x=this._spaceLeft*this.getDepth(rS),rQ.push(rS));return rQ},re.getDepth=function(rS,rQ){return void 0===rQ&&(rQ=0),null==rS.nodeParent?rQ:this.getDepth(rS.nodeParent,rQ+1)},re.getParentOpenStatus=function(rS){var rQ=rS.nodeParent;return null==rQ||!!rQ.isOpen&&(null==rQ.nodeParent||this.getParentOpenStatus(rQ))},re.renderItem=function(rS,rQ){var re=rS.dataSource;if(re){rS.left=re.x;var rl=rS.getChildByName("arrow");rl&&(re.hasChild?(rl.visible=!0,rl.index=re.isOpen?1:0,rl.tag=rQ,rl.off("click",this,this.onArrowClick),rl.on("click",this,this.onArrowClick)):rl.visible=!1);var rM=rS.getChildByName("folder");rM&&(2==rM.clipY?rM.index=re.isDirectory?0:1:rM.index=re.isDirectory?re.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([rS,rQ])}},re.onArrowClick=function(rS){var rQ=rS.currentTarget.tag;this._list.array[rQ].isOpen=!this._list.array[rQ].isOpen,this.event("open"),this._list.array=this.getArray()},re.setItemState=function(rS,rQ){this._list.array[rS]&&(this._list.array[rS].isOpen=rQ,this._list.array=this.getArray())},re.fresh=function(){this._list.array=this.getArray(),this.repaint()},re.parseXml=function(rS,rQ,re,rl){var rM,rd=rS.childNodes,rT=rd.length;if(!rl){rM={};var rU,ri=rS.attributes;for(var rR in ri){var ro=(rU=ri[rR]).nodeName,rY=rU.nodeValue;rM[ro]="true"==rY||"false"!=rY&&rY}rM.nodeParent=re,0<rT&&(rM.isDirectory=!0),rM.hasChild=0<rT,rQ.push(rM)}for(var rp=0;rp<rT;rp++){var rJ=rd[rp];this.parseXml(rJ,rQ,rM,!1)}},re.parseOpenStatus=function(rS,rQ){for(var re=0,rl=rQ.length;re<rl;re++){var rM=rQ[re];if(rM.isDirectory)for(var rd=0,rT=rS.length;rd<rT;rd++){var rU=rS[rd];if(rU.isDirectory&&this.isSameParent(rU,rM)&&rM.label==rU.label){rM.isOpen=rU.isOpen;break}}}},re.isSameParent=function(rS,rQ){return null==rS.nodeParent&&null==rQ.nodeParent||null!=rS.nodeParent&&null!=rQ.nodeParent&&(rS.nodeParent.label==rQ.nodeParent.label&&this.isSameParent(rS.nodeParent,rQ.nodeParent))},re.filter=function(rS){if(Boolean(rS)){var rQ=[];this.getFilterSource(this._source,rQ,rS),this._list.array=rQ}else this._list.array=this.getArray()},re.getFilterSource=function(rS,rQ,re){var rl;for(var rM in re=re.toLocaleLowerCase(),rS)!(rl=rS[rM]).isDirectory&&-1<String(rl.label).toLowerCase().indexOf(re)&&(rl.x=0,rQ.push(rl)),rl.child&&0<rl.child.length&&this.getFilterSource(rl.child,rQ,re)},rM(0,re,"spaceBottom",function(){return this._list.spaceY},function(rS){this._list.spaceY=rS}),rM(0,re,"keepStatus",function(){return this._keepStatus},function(rS){this._keepStatus=rS}),rM(0,re,"itemRender",function(){return this._list.itemRender},function(rS){this._list.itemRender=rS}),rM(0,re,"array",function(){return this._list.array},function(rS){this._keepStatus&&this._list.array&&rS&&this.parseOpenStatus(this._list.array,rS),this._source=rS,this._list.array=this.getArray()}),rM(0,re,"mouseHandler",function(){return this._list.mouseHandler},function(rS){this._list.mouseHandler=rS}),rM(0,re,"dataSource",rS.prototype._$get_dataSource,function(rS){this._dataSource=rS,rj.superSet(rm,this,"dataSource",rS)}),rM(0,re,"source",function(){return this._source}),rM(0,re,"scrollBar",function(){return this._list.scrollBar}),rM(0,re,"list",function(){return this._list}),rM(0,re,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(rS){this._list.vScrollBarSkin=rS}),rM(0,re,"renderHandler",function(){return this._renderHandler},function(rS){this._renderHandler=rS}),rM(0,re,"selectedIndex",function(){return this._list.selectedIndex},function(rS){this._list.selectedIndex=rS}),rM(0,re,"spaceLeft",function(){return this._spaceLeft},function(rS){this._spaceLeft=rS}),rM(0,re,"selectedItem",function(){return this._list.selectedItem},function(rS){this._list.selectedItem=rS}),rM(0,re,"width",rS.prototype._$get_width,function(rS){rj.superSet(rm,this,"width",rS),this._list.width=rS}),rM(0,re,"height",rS.prototype._$get_height,function(rS){rj.superSet(rm,this,"height",rS),this._list.height=rS}),rM(0,re,"xml",null,function(rS){var rQ=[];this.parseXml(rS.childNodes[0],rQ,null,!0),this.array=rQ}),rM(0,re,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),rQ}(rm),rSS=function(rS){function rQ(){this._items=null,this._selectedIndex=0,rQ.__super.call(this),this._setIndexHandler=rp.create(this,this.setIndex,null,!1)}rd(rQ,"laya.ui.ViewStack",rS);var re=rQ.prototype;return rj.imps(re,{"laya.ui.IItem":!0}),re.setItems=function(rS){this.removeChildren();for(var rQ=0,re=0,rl=rS.length;re<rl;re++){var rM=rS[re];rM&&(rM.name="item"+rQ,this.addChild(rM),rQ++)}this.initItems()},re.addItem=function(rS){rS.name="item"+this._items.length,this.addChild(rS),this.initItems()},re.initItems=function(){this._items=[];for(var rS=0;rS<1e4;rS++){var rQ=this.getChildByName("item"+rS);if(null==rQ)break;this._items.push(rQ),rQ.visible=rS==this._selectedIndex}},re.setSelect=function(rS,rQ){this._items&&-1<rS&&rS<this._items.length&&(this._items[rS].visible=rQ)},re.setIndex=function(rS){this.selectedIndex=rS},rM(0,re,"dataSource",rS.prototype._$get_dataSource,function(rS){if("number"==typeof(this._dataSource=rS)&&Math.floor(rS)==rS||"string"==typeof rS)this.selectedIndex=parseInt(rS);else for(var rQ in this._dataSource)this.hasOwnProperty(rQ)&&(this[rQ]=this._dataSource[rQ])}),rM(0,re,"selectedIndex",function(){return this._selectedIndex},function(rS){this._selectedIndex!=rS&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=rS,this.setSelect(this._selectedIndex,!0))}),rM(0,re,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(rS){this.selectedIndex=this._items.indexOf(rS)}),rM(0,re,"items",function(){return this._items}),rM(0,re,"setIndexHandler",function(){return this._setIndexHandler},function(rS){this._setIndexHandler=rS}),rQ}(rm),rQS=function(rS){function rQ(){rQ.__super.call(this)}return rd(rQ,"laya.ui.VScrollBar",rf),rQ}(),reS=function(rQ){function re(rS){this._bg=null,this._skin=null,re.__super.call(this),void 0===rS&&(rS=""),this.text=rS,this.skin=this.skin}rd(re,"laya.ui.TextInput",rQ);var rS=re.prototype;return rS.preinitialize=function(){this.mouseEnabled=!0},rS.destroy=function(rS){rz.clearCache(this,this._skin),void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._bg&&this._bg.destroy(),this._bg=null},rS.createChildren=function(){this.addChild(this._tf=new rJ),this._tf.padding=rE.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},rS._onFocus=function(){this.event("focus",this)},rS._onBlur=function(){this.event("blur",this)},rS._onInput=function(){this.event("input",this)},rS._onEnter=function(){this.event("enter",this)},rS.initialize=function(){this.width=128,this.height=22},rS.select=function(){this._tf.select()},rS.setSelection=function(rS,rQ){this._tf.setSelection(rS,rQ)},rM(0,rS,"text",rQ.prototype._$get_text,function(rS){this._tf.text!=rS&&(rS+="",this._tf.text=rS,this.event("change"))}),rM(0,rS,"bg",function(){return this._bg},function(rS){this.graphics=this._bg=rS}),rM(0,rS,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(rS){this._tf.inputElementYAdjuster=rS}),rM(0,rS,"multiline",function(){return this._tf.multiline},function(rS){this._tf.multiline=rS}),rM(0,rS,"skin",function(){return this._skin},function(rS){this._skin!=rS&&(rz.clearCache(this,this._skin),this._skin=rS,this._bg||(this.graphics=this._bg=new rX),rz.keepCache(this,this._skin),this._bg.source=rz.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),rM(0,rS,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(rS){this._bg||(this.graphics=this._bg=new rX),this._bg.sizeGrid=rt.fillArray(rE.defaultSizeGrid,rS,Number)}),rM(0,rS,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(rS){this._tf.inputElementXAdjuster=rS}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(rr,this,"width",rS),this._bg&&(this._bg.width=rS)}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(rr,this,"height",rS),this._bg&&(this._bg.height=rS)}),rM(0,rS,"editable",function(){return this._tf.editable},function(rS){this._tf.editable=rS}),rM(0,rS,"restrict",function(){return this._tf.restrict},function(rS){this._tf.restrict=rS}),rM(0,rS,"prompt",function(){return this._tf.prompt},function(rS){this._tf.prompt=rS}),rM(0,rS,"promptColor",function(){return this._tf.promptColor},function(rS){this._tf.promptColor=rS}),rM(0,rS,"maxChars",function(){return this._tf.maxChars},function(rS){this._tf.maxChars=rS}),rM(0,rS,"focus",function(){return this._tf.focus},function(rS){this._tf.focus=rS}),rM(0,rS,"type",function(){return this._tf.type},function(rS){this._tf.type=rS}),rM(0,rS,"asPassword",function(){return this._tf.asPassword},function(rS){this._tf.asPassword=rS}),re}(rr),rlS=function(rS){function rQ(){rQ.__super.call(this)}return rd(rQ,"laya.ui.VSlider",rw),rQ}(),rMS=function(rS){function rl(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,rl.__super.call(this)}rd(rl,"laya.ui.Dialog",rS);var rQ=rl.prototype;return rQ.initialize=function(){this.popupEffect=rl.manager.popupEffectHandler,this.closeEffect=rl.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},rQ._dealDragArea=function(){var rS=this.getChildByName("drag");rS&&(this.dragArea=rS.x+","+rS.y+","+rS.width+","+rS.height,rS.removeSelf())},rQ._onClick=function(rS){var rQ=rS.target;if(rQ)switch(rQ.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(rQ.name)}},rQ.show=function(rS,rQ){void 0===rS&&(rS=!1),void 0===rQ&&(rQ=!0),this._open(!1,rS,rQ)},rQ.popup=function(rS,rQ){void 0===rS&&(rS=!1),void 0===rQ&&(rQ=!0),this._open(!0,rS,rQ)},rQ._open=function(rS,rQ,re){rl.manager.lock(!1),this.isModal=rS,rl.manager.open(this,rQ,re)},rQ.onOpened=function(){},rQ.close=function(rS,rQ){void 0===rQ&&(rQ=!0),rl.manager.close(this,rS,rQ)},rQ.onClosed=function(rS){},rQ._onMouseDown=function(rS){var rQ=this.getMousePoint();this._dragArea.contains(rQ.x,rQ.y)?this.startDrag():this.stopDrag()},rM(0,rQ,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(rS){if(rS){var rQ=rt.fillArray([0,0,0,0],rS,Number);this._dragArea=new rG(rQ[0],rQ[1],rQ[2],rQ[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),rM(0,rQ,"isPopup",function(){return null!=this.parent}),rM(0,rQ,"zOrder",rS.prototype._$get_zOrder,function(rS){rj.superSet(rx,this,"zOrder",rS),rl.manager._checkMask()}),rM(1,rl,"manager",function(){return rl._manager=rl._manager||new rb},function(rS){rl._manager=rS}),rl.setLockView=function(rS){rl.manager.setLockView(rS)},rl.lock=function(rS){rl.manager.lock(rS)},rl.closeAll=function(){rl.manager.closeAll()},rl.getDialogsByGroup=function(rS){return rl.manager.getDialogsByGroup(rS)},rl.closeByGroup=function(rS){return rl.manager.closeByGroup(rS)},rl.CLOSE="close",rl.CANCEL="cancel",rl.SURE="sure",rl.NO="no",rl.OK="ok",rl.YES="yes",rl._manager=null,rl}(rx),rdS=function(rS){function rQ(){rQ.__super.call(this)}rd(rQ,"laya.ui.HBox",rS);var re=rQ.prototype;return re.sortItem=function(rS){rS&&rS.sort(function(rS,rQ){return rS.x-rQ.x})},re.changeItems=function(){this._itemChanged=!1;for(var rS=[],rQ=0,re=0,rl=this.numChildren;re<rl;re++){var rM=this.getChildAt(re);rM&&rM.layoutEnabled&&(rS.push(rM),rQ=this._height?this._height:Math.max(rQ,rM.height*rM.scaleY))}this.sortItem(rS);var rd=0;for(re=0,rl=rS.length;re<rl;re++)(rM=rS[re]).x=rd,rd+=rM.width*rM.scaleX+this._space,"top"==this._align?rM.y=0:"middle"==this._align?rM.y=.5*(rQ-rM.height*rM.scaleY):"bottom"==this._align&&(rM.y=rQ-rM.height*rM.scaleY);this.changeSize()},rM(0,re,"height",rS.prototype._$get_height,function(rS){this._height!=rS&&(rj.superSet(rq,this,"height",rS),this.callLater(this.changeItems))}),rQ.NONE="none",rQ.TOP="top",rQ.MIDDLE="middle",rQ.BOTTOM="bottom",rQ}(rq),rTS=function(rS){function rQ(){rQ.__super.call(this)}rd(rQ,"laya.ui.VBox",rS);var re=rQ.prototype;return re.changeItems=function(){this._itemChanged=!1;for(var rS=[],rQ=0,re=0,rl=this.numChildren;re<rl;re++){var rM=this.getChildAt(re);rM&&rM.layoutEnabled&&(rS.push(rM),rQ=this._width?this._width:Math.max(rQ,rM.width*rM.scaleX))}this.sortItem(rS);var rd=0;for(re=0,rl=rS.length;re<rl;re++)(rM=rS[re]).y=rd,rd+=rM.height*rM.scaleY+this._space,"left"==this._align?rM.x=0:"center"==this._align?rM.x=.5*(rQ-rM.width*rM.scaleX):"right"==this._align&&(rM.x=rQ-rM.width*rM.scaleX);this.changeSize()},rM(0,re,"width",rS.prototype._$get_width,function(rS){this._width!=rS&&(rj.superSet(rq,this,"width",rS),this.callLater(this.changeItems))}),rQ.NONE="none",rQ.LEFT="left",rQ.CENTER="center",rQ.RIGHT="right",rQ}(rq),rUS=function(rS){function rQ(){rQ.__super.call(this)}return rd(rQ,"laya.ui.RadioGroup",r_),rQ.prototype.createItem=function(rS,rQ){return new rs(rS,rQ)},rQ}(),riS=function(rS){function rQ(){rQ.__super.call(this)}return rd(rQ,"laya.ui.Tab",r_),rQ.prototype.createItem=function(rS,rQ){return new r$(rS,rQ)},rQ}(),rRS=function(rQ){function re(rS){this._vScrollBar=null,this._hScrollBar=null,void 0===rS&&(rS=""),re.__super.call(this,rS)}rd(re,"laya.ui.TextArea",rQ);var rS=re.prototype;return rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},rS.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},rS.onVBarChanged=function(rS){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},rS.onHBarChanged=function(rS){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},rS.changeScroll=function(){var rS=this._vScrollBar&&0<this._tf.maxScrollY,rQ=this._hScrollBar&&0<this._tf.maxScrollX,re=rS?this._width-this._vScrollBar.width:this._width,rl=rQ?this._height-this._hScrollBar.height:this._height,rM=this._tf.padding||rE.labelPadding;this._tf.width=re,this._tf.height=rl,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-rM[2],this._vScrollBar.y=rM[1],this._vScrollBar.height=this._height-(rQ?this._hScrollBar.height:0)-rM[1]-rM[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=rl/Math.max(this._tf.textHeight,rl),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=rS),this._hScrollBar&&(this._hScrollBar.x=rM[0],this._hScrollBar.y=this._height-this._hScrollBar.height-rM[3],this._hScrollBar.width=this._width-(rS?this._vScrollBar.width:0)-rM[0]-rM[2],this._hScrollBar.scrollSize=Math.max(.033*re,1),this._hScrollBar.thumbPercent=re/Math.max(this._tf.textWidth,re),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=rQ)},rS.scrollTo=function(rS){this.commitMeasure(),this._tf.scrollY=rS},rM(0,rS,"scrollY",function(){return this._tf.scrollY}),rM(0,rS,"width",rQ.prototype._$get_width,function(rS){rj.superSet(reS,this,"width",rS),this.callLater(this.changeScroll)}),rM(0,rS,"hScrollBar",function(){return this._hScrollBar}),rM(0,rS,"height",rQ.prototype._$get_height,function(rS){rj.superSet(reS,this,"height",rS),this.callLater(this.changeScroll)}),rM(0,rS,"maxScrollX",function(){return this._tf.maxScrollX}),rM(0,rS,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(rS){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new rQS),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=rS}),rM(0,rS,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(rS){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new rC),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=rS}),rM(0,rS,"vScrollBar",function(){return this._vScrollBar}),rM(0,rS,"maxScrollY",function(){return this._tf.maxScrollY}),rM(0,rS,"scrollX",function(){return this._tf.scrollX}),re}(reS);!function(rS){function rQ(){this._uiView=null,this.isCloseOther=!1,rQ.__super.call(this)}rd(rQ,"laya.ui.AsynDialog",rMS);var re=rQ.prototype;re.createView=function(rS){this._uiView=rS},re._open=function(rS,rQ,re){this.isModal=rS,this.isCloseOther=rQ,rMS.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},re.onCreated=function(){this.createUI(),this.onOpen()},re.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},re.onOpen=function(){rMS.manager.open(this,this.isCloseOther),rMS.manager.lock(!1)},re.close=function(rS,rQ){void 0===rQ&&(rQ=!0),rMS.manager.close(this),this.onClose()},re.onClose=function(){},re.destroy=function(rS){void 0===rS&&(rS=!0),laya.ui.View.prototype.destroy.call(this,rS),this._uiView=null,this.onDestroy()},re.onDestroy=function(){}}();rj.__init([rx])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}}),function(rp,rS,rD){rD.un,rD.uns;var rY=rD.static,rJ=rD.class,rL=rD.getset,rl=rD.__newvec,rv=laya.maths.Arith,rT=laya.webgl.atlas.AtlasResourceManager,re=laya.webgl.shader.BaseShader,rh=laya.utils.Browser,rU=laya.webgl.utils.Buffer,rB=laya.utils.Byte,rM=laya.utils.ClassUtils,ri=rD.Config,rd=(laya.events.Event,laya.events.EventDispatcher),rE=laya.utils.Handler,rG=laya.net.Loader,rQ=laya.net.LoaderManager,rR=(laya.maths.MathUtil,laya.display.Node),rj=laya.renders.Render,ro=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),rc=laya.resource.Resource,rz=laya.utils.RunDriver,rA=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),rO=laya.display.Sprite,rH=laya.utils.Stat,rg=laya.utils.StringKey,rt=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),rI=laya.utils.Utils,rk=laya.webgl.WebGL,rX=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;rD.interface("laya.d3.core.IClone"),rD.interface("laya.d3.graphics.IVertex"),rD.interface("laya.d3.core.render.IUpdate"),rD.interface("laya.d3.core.scene.ITreeNode"),rD.interface("laya.d3.core.render.IRenderable");(function(){function r$(){}rJ(r$,"laya.d3.animation.AnimationClipParser01"),r$.READ_DATA=function(){r$._DATA.offset=r$._reader.getUint32(),r$._DATA.size=r$._reader.getUint32()},r$.READ_BLOCK=function(){for(var rS=r$._BLOCK.count=r$._reader.getUint16(),rQ=r$._BLOCK.blockStarts=[],re=r$._BLOCK.blockLengths=[],rl=0;rl<rS;rl++)rQ.push(r$._reader.getUint32()),re.push(r$._reader.getUint32())},r$.READ_STRINGS=function(){var rS=r$._reader.getUint32(),rQ=r$._reader.getUint16(),re=r$._reader.pos;r$._reader.pos=rS+r$._DATA.offset;for(var rl=0;rl<rQ;rl++)r$._strings[rl]=r$._reader.readUTFString();r$._reader.pos=re},r$.parse=function(rS,rQ){r$._animationClip=rS;(r$._reader=rQ).__getBuffer();r$.READ_DATA(),r$.READ_BLOCK(),r$.READ_STRINGS();for(var re=0,rl=r$._BLOCK.count;re<rl;re++){var rM=rQ.getUint16(),rd=r$._strings[rM],rT=r$["READ_"+rd];if(null==rT)throw new Error("model file err,no this function:"+rM+" "+rd);rT.call()}},r$.READ_ANIMATIONS=function(){var rS,rQ=0,re=0,rl=r$._reader,rM=rl.__getBuffer(),rd=[],rT=rl.getUint8();for(rd.length=rT,rQ=0;rQ<rT;rQ++)rd[rQ]=rl.getUint16();var rU=[],ri=rl.getUint16();for(rU.length=ri,rQ=0;rQ<ri;rQ++)rU[rQ]=rl.getFloat32();var rR=r$._animationClip;rR.name=r$._strings[rl.getUint16()];var ro=rR._duration=rl.getFloat32();rR.islooping=!!rl.getByte(),rR._frameRate=rl.getInt16();var rY=rl.getInt16(),rp=rR._nodes=new Array;rp.length=rY,(rR._publicClipDatas=[]).length=rY;var rJ=rR._nodesMap={},rL=0,rj=0;for(rQ=0;rQ<rY;rQ++){rS=rp[rQ]=new rW;var rc=rl.getUint16(),rG=rS.path=[];for(rG.length=rc,re=0;re<rc;re++)rG[re]=r$._strings[rl.getUint16()];var rz=rG.join("/"),rA=rJ[rz];rA||(rJ[rz]=rA=[]),rA.push(rS);var rv=rl.getInt16();-1!==rv&&(rS.componentType=r$._strings[rv]);var rD=ru._propertyIndexDic[r$._strings[rl.getUint16()]];if(null==rD)throw new Error("AnimationClipParser01:unknown property name.");var rB=rD<4,rO=!rB||rB&&""===rG[0];(rS._cacheProperty=rO)?rL++:rj++,rS.propertyNameID=rD;var rH=rd[rl.getUint8()];rS.keyFrameWidth=rH/4;var rg=rS.keyFrames=[],rI=rg.length=rl.getUint16(),rE=null,rt=NaN;for(re=0;re<rI;re++){var rk=rg[re]=new rr;rt=rk.startTime=rU[rl.getUint16()];var rX=rl.pos;rk.inTangent=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rX=rl.pos,rk.outTangent=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rX=rl.pos,rk.data=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rE&&(rE.next=rk,rE.duration=rt-rE.startTime),rE=rk}rk.next=null,rk.duration=ro-rt}var rh=rR._nodeToCachePropertyMap=new Int32Array(rY),rb=rR._cachePropertyMap=new Int32Array(rL),rm=rR._unCachePropertyMap=new Int32Array(rj);for(rL=rj=0,rQ=0;rQ<rY;rQ++)(rS=rp[rQ])._cacheProperty?(rh[rQ]=rL,rb[rL++]=rQ):rm[rj++]=rQ},r$._animationClip=null,r$._reader=null,r$._strings=[],rY(r$,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function rf(){}rJ(rf,"laya.d3.animation.AnimationClipParser02"),rf.READ_DATA=function(){rf._DATA.offset=rf._reader.getUint32(),rf._DATA.size=rf._reader.getUint32()},rf.READ_BLOCK=function(){for(var rS=rf._BLOCK.count=rf._reader.getUint16(),rQ=rf._BLOCK.blockStarts=[],re=rf._BLOCK.blockLengths=[],rl=0;rl<rS;rl++)rQ.push(rf._reader.getUint32()),re.push(rf._reader.getUint32())},rf.READ_STRINGS=function(){var rS=rf._reader.getUint32(),rQ=rf._reader.getUint16(),re=rf._reader.pos;rf._reader.pos=rS+rf._DATA.offset;for(var rl=0;rl<rQ;rl++)rf._strings[rl]=rf._reader.readUTFString();rf._reader.pos=re},rf.parse=function(rS,rQ){rf._animationClip=rS;(rf._reader=rQ).__getBuffer();rf.READ_DATA(),rf.READ_BLOCK(),rf.READ_STRINGS();for(var re=0,rl=rf._BLOCK.count;re<rl;re++){var rM=rQ.getUint16(),rd=rf._strings[rM],rT=rf["READ_"+rd];if(null==rT)throw new Error("model file err,no this function:"+rM+" "+rd);rT.call()}},rf.READ_ANIMATIONS=function(){var rS,rQ=0,re=0,rl=rf._reader,rM=rl.__getBuffer(),rd=[],rT=rl.getUint8();for(rd.length=rT,rQ=0;rQ<rT;rQ++)rd[rQ]=rl.getUint16();var rU=[],ri=rl.getUint16();for(rU.length=ri,rQ=0;rQ<ri;rQ++)rU[rQ]=rl.getFloat32();var rR=rf._animationClip;rR.name=rf._strings[rl.getUint16()];var ro=rR._duration=rl.getFloat32();rR.islooping=!!rl.getByte(),rR._frameRate=rl.getInt16();var rY=rl.getInt16(),rp=rR._nodes=new Array;rp.length=rY,(rR._publicClipDatas=[]).length=rY;var rJ=rR._nodesMap={},rL=0,rj=0;for(rQ=0;rQ<rY;rQ++){rS=rp[rQ]=new rW;var rc=rl.getUint16(),rG=rS.path=[];for(rG.length=rc,re=0;re<rc;re++)rG[re]=rf._strings[rl.getUint16()];var rz=rG.join("/"),rA=rJ[rz];rA||(rJ[rz]=rA=[]),rA.push(rS);var rv=rl.getInt16();-1!==rv&&(rS.componentType=rf._strings[rv]);var rD=ru._propertyIndexDic[rf._strings[rl.getUint16()]];if(null==rD)throw new Error("AnimationClipParser02:unknown property name.");var rB=rD<4,rO=!rB||rB&&""===rG[0];(rS._cacheProperty=rO)?rL++:rj++,rS.propertyNameID=rD;var rH=rd[rl.getUint8()];rS.keyFrameWidth=rH/4;var rg=rS.keyFrames=[],rI=rg.length=rl.getUint16(),rE=null,rt=NaN;for(re=0;re<rI;re++){var rk=rg[re]=new rr;rt=rk.startTime=rU[rl.getUint16()];var rX=rl.pos;rk.inTangent=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rX=rl.pos,rk.outTangent=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rX=rl.pos,rk.data=new Float32Array(rM.slice(rX,rX+rH)),rl.pos+=rH,rE&&(rE.next=rk,rE.duration=rt-rE.startTime),rE=rk}rk.next=null,rk.duration=ro-rt}var rh=rl.getUint16();for(rQ=0;rQ<rh;rQ++){var rb,rm=new rw;rm.time=rl.getFloat32(),rm.eventName=rf._strings[rl.getUint16()];var r$=rl.getUint16();for(0<r$&&(rm.params=rb=[]),re=0;re<r$;re++){switch(rl.getByte()){case 0:rb.push(!!rl.getByte());break;case 1:rb.push(rl.getInt32());break;case 2:rb.push(rl.getFloat32());break;case 3:rb.push(rf._strings[rl.getUint16()]);break;default:throw new Error("unknown type.")}}rR.addEvent(rm)}var rn=rR._nodeToCachePropertyMap=new Int32Array(rY),rP=rR._cachePropertyMap=new Int32Array(rL),ra=rR._unCachePropertyMap=new Int32Array(rj);for(rL=rj=0,rQ=0;rQ<rY;rQ++)(rS=rp[rQ])._cacheProperty?(rn[rQ]=rL,rP[rL++]=rQ):ra[rj++]=rQ},rf._animationClip=null,rf._reader=null,rf._strings=[],rY(rf,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var rw=function(){function rS(){this.time=NaN,this.eventName=null,this.params=null}return rJ(rS,"laya.d3.animation.AnimationEvent"),rS}(),ru=function(){function rl(){this._childs=[],this.transform=new rzQ(this)}rJ(rl,"laya.d3.animation.AnimationNode");var rS=rl.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.addChild=function(rS){rS._parent=this,rS.transform.setParent(this.transform),this._childs.push(rS)},rS.removeChild=function(rS){var rQ=this._childs.indexOf(rS);-1!==rQ&&this._childs.splice(rQ,1)},rS.getChildByName=function(rS){for(var rQ=0,re=this._childs.length;rQ<re;rQ++){var rl=this._childs[rQ];if(rl.name===rS)return rl}return null},rS.getChildByIndex=function(rS){return this._childs[rS]},rS.getChildCount=function(){return this._childs.length},rS.cloneTo=function(rS){var rQ=rS;rQ.name=this.name;for(var re=0,rl=this._childs.length;re<rl;re++){var rM=this._childs[re],rd=rM.clone();rQ.addChild(rd);var rT=rM.transform,rU=rd.transform;rU.setLocalPosition(rT.getLocalPosition()),rU.setLocalRotation(rT.getLocalRotation()),rU.setLocalScale(rT.getLocalScale()),rU._localRotationEuler=rT._localRotationEuler,rU._setWorldMatrixIgnoreUpdate(rT.getWorldMatrix())}},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rl.__init__=function(){rl.registerAnimationNodeProperty("localPosition",rl._getLocalPosition,rl._setLocalPosition),rl.registerAnimationNodeProperty("localRotation",rl._getLocalRotation,rl._setLocalRotation),rl.registerAnimationNodeProperty("localScale",rl._getLocalScale,rl._setLocalScale),rl.registerAnimationNodeProperty("localRotationEuler",rl._getLocalRotationEuler,rl._setLocalRotationEuler),rl.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",rl._getParticleRenderSharedMaterialTintColor,rl._setParticleRenderSharedMaterialTintColor),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",rl._getMeshRenderSharedMaterialTilingOffset,rl._setMeshRenderSharedMaterialTilingOffset),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",rl._getMeshRenderSharedMaterialAlbedo,rl._setMeshRenderSharedMaterialAlbedo),rl.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",rl._getSkinnedMeshRenderSharedMaterialTilingOffset,rl._setSkinnedMeshRenderSharedMaterialTilingOffset),rl.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",rl._getSkinnedMeshRenderSharedMaterialAlbedo,rl._setSkinnedMeshRenderSharedMaterialAlbedo),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",rl._getMeshRenderSharedMaterialAlbedo,rl._setMeshRenderSharedMaterialAlbedo),rl.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",rl._getSkinnedMeshRenderSharedMaterialAlbedo,rl._setSkinnedMeshRenderSharedMaterialAlbedo),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",rl._getMeshRenderSharedMaterialIntensity,rl._setMeshRenderSharedMaterialIntensity),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",rl._getMeshRenderSharedMaterialAlpha,rl._setMeshRenderSharedMaterialAlpha),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",rl._getMeshRenderSharedMaterialAlphaColor,rl._setMeshRenderSharedMaterialAlphaColor),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",rl._getMeshRenderSharedMaterialBaseColor,rl._setMeshRenderSharedMaterialBaseColor),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",rl._getMeshRenderSharedMaterialDissolve,rl._setMeshRenderSharedMaterialDissolve),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",rl._getMeshRenderSharedMaterialDissolveSpeed,rl._setMeshRenderSharedMaterialDissolveSpeed),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",rl._getMeshRenderSharedMaterialMMultiplier,rl._setMeshRenderSharedMaterialMMultiplier),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",rl._getMeshRenderSharedMaterialBaseScrollSpeedX,rl._setMeshRenderSharedMaterialBaseScrollSpeedX),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",rl._getMeshRenderSharedMaterialBaseScrollSpeedY,rl._setMeshRenderSharedMaterialBaseScrollSpeedY),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",rl._getMeshRenderSharedMaterialSecondScrollSpeedX,rl._setMeshRenderSharedMaterialSecondScrollSpeedX),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",rl._getMeshRenderSharedMaterialSecondScrollSpeedY,rl._setMeshRenderSharedMaterialSecondScrollSpeedY),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",rl._getMeshRenderSharedMaterialDetailTilingOffset,rl._setMeshRenderSharedMaterialDetailTilingOffset),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",rl._getMeshRenderSharedMaterialDissolveTilingOffset,rl._setMeshRenderSharedMaterialDissolveTilingOffset),rl.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",rl._getMeshRenderSharedMaterialMaskTilingOffset,rl._setMeshRenderSharedMaterialMaskTilingOffset)},rl.registerAnimationNodeProperty=function(rS,rQ,re){if(rl._propertyIndexDic[rS])throw new Error("AnimationNode: this propertyName has registered.");rl._propertyIndexDic[rS]=rl._propertyIDCounter,rl._propertyGetFuncs[rl._propertyIDCounter]=rQ,rl._propertySetFuncs[rl._propertyIDCounter]=re,rl._propertyIDCounter++},rl._getLocalPosition=function(rS,rQ){return rS?rS.transform.getLocalPosition():rQ._transform.localPosition.elements},rl._setLocalPosition=function(rS,rQ,re){if(rS)rS.transform.setLocalPosition(re);else{var rl=rQ._transform,rM=rl.localPosition;rM.elements=re,rl.localPosition=rM}},rl._getLocalRotation=function(rS,rQ){return rS?rS.transform.getLocalRotation():rQ._transform.localRotation.elements},rl._setLocalRotation=function(rS,rQ,re){if(rS)rS.transform.setLocalRotation(re);else{var rl=rQ._transform,rM=rl.localRotation;rM.elements=re,rl.localRotation=rM}},rl._getLocalScale=function(rS,rQ){return rS?rS.transform.getLocalScale():rQ._transform.localScale.elements},rl._setLocalScale=function(rS,rQ,re){if(rS)rS.transform.setLocalScale(re);else{var rl=rQ._transform,rM=rl.localScale;rM.elements=re,rl.localScale=rM}},rl._getLocalRotationEuler=function(rS,rQ){return rS?rS.transform.getLocalRotationEuler():rQ._transform.localRotationEuler.elements},rl._setLocalRotationEuler=function(rS,rQ,re){if(rS)rS.transform.setLocalRotationEuler(re);else{var rl=rQ._transform,rM=rl.localRotationEuler;rM.elements=re,rl.localRotationEuler=rM}},rl._getMeshRenderSharedMaterialTilingOffset=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return rQ.meshRender.sharedMaterial.tilingOffset.elements},rl._setMeshRenderSharedMaterialTilingOffset=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).tilingOffset).elements=re,rl.tilingOffset=rM)}else(rM=(rl=rQ.meshRender.material).tilingOffset).elements=re,rl.tilingOffset=rM},rl._getMeshRenderSharedMaterialAlbedo=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.albedoColor.elements:null}return rQ.meshRender.sharedMaterial.albedoColor.elements},rl._setMeshRenderSharedMaterialAlbedo=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).albedoColor).elements=re,rl.albedoColor=rM)}else(rM=(rl=rQ.meshRender.material).albedoColor).elements=re,rl.albedoColor=rM},rl._getSkinnedMeshRenderSharedMaterialTilingOffset=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return rQ.skinnedMeshRender.sharedMaterial.tilingOffset.elements},rl._setSkinnedMeshRenderSharedMaterialTilingOffset=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.skinnedMeshRender.material).tilingOffset).elements=re,rl.tilingOffset=rM)}else(rM=(rl=rQ.skinnedMeshRender.material).tilingOffset).elements=re,rl.tilingOffset=rM},rl._getSkinnedMeshRenderSharedMaterialAlbedo=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return rQ.skinnedMeshRender.sharedMaterial.albedoColor.elements},rl._setSkinnedMeshRenderSharedMaterialAlbedo=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.skinnedMeshRender.material).albedoColor).elements=re,rl.albedoColor=rM)}else(rM=(rl=rQ.skinnedMeshRender.material).albedoColor).elements=re,rl.albedoColor=rM},rl._getParticleRenderSharedMaterialTintColor=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.particleRender.sharedMaterial.tintColor.elements:null}return rQ.particleRender.sharedMaterial.tintColor.elements},rl._setParticleRenderSharedMaterialTintColor=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.particleRender.material).tintColor).elements=re,rl.tintColor=rM)}else(rM=(rl=rQ.particleRender.material).tintColor).elements=re,rl.tintColor=rM},rl._getMeshRenderSharedMaterialAlphaColor=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.alphaColor.elements:null}return rQ.meshRender.sharedMaterial.alphaColor.elements},rl._setMeshRenderSharedMaterialAlphaColor=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).alphaColor).elements=re,rl.alphaColor=rM)}else(rM=(rl=rQ.meshRender.material).alphaColor).elements=re,rl.alphaColor=rM},rl._getMeshRenderSharedMaterialBaseColor=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.baseColor.elements:null}return rQ.meshRender.sharedMaterial.baseColor.elements},rl._setMeshRenderSharedMaterialBaseColor=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).baseColor).elements=re,rl.baseColor=rM)}else(rM=(rl=rQ.meshRender.material).baseColor).elements=re,rl.baseColor=rM},rl._getMeshRenderSharedMaterialDissolve=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.dissolve:0}return rQ.meshRender.sharedMaterial.dissolve},rl._setMeshRenderSharedMaterialDissolve=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.dissolve=re[0])}else rQ.meshRender.material.dissolve=re[0]},rl._getMeshRenderSharedMaterialDissolveSpeed=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.dissolveSpeed:0}return rQ.meshRender.sharedMaterial.dissolveSpeed},rl._setMeshRenderSharedMaterialDissolveSpeed=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.dissolveSpeed=re[0])}else rQ.meshRender.material.dissolveSpeed=re[0]},rl._getMeshRenderSharedMaterialMMultiplier=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.mMultiplier:0}return rQ.meshRender.sharedMaterial.mMultiplier},rl._setMeshRenderSharedMaterialMMultiplier=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.mMultiplier=re[0])}else rQ.meshRender.material.mMultiplier=re[0]},rl._getMeshRenderSharedMaterialBaseScrollSpeedX=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return rQ.meshRender.sharedMaterial.baseScrollSpeedX},rl._setMeshRenderSharedMaterialBaseScrollSpeedX=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.baseScrollSpeedX=re[0])}else rQ.meshRender.material.baseScrollSpeedX=re[0]},rl._getMeshRenderSharedMaterialBaseScrollSpeedY=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return rQ.meshRender.sharedMaterial.baseScrollSpeedY},rl._setMeshRenderSharedMaterialBaseScrollSpeedY=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.baseScrollSpeedY=re[0])}else rQ.meshRender.material.baseScrollSpeedY=re[0]},rl._getMeshRenderSharedMaterialSecondScrollSpeedX=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return rQ.meshRender.sharedMaterial.secondScrollSpeedX},rl._setMeshRenderSharedMaterialSecondScrollSpeedX=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.secondScrollSpeedX=re[0])}else rQ.meshRender.material.secondScrollSpeedX=re[0]},rl._getMeshRenderSharedMaterialSecondScrollSpeedY=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return rQ.meshRender.sharedMaterial.secondScrollSpeedY},rl._setMeshRenderSharedMaterialSecondScrollSpeedY=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.secondScrollSpeedY=re[0])}else rQ.meshRender.material.secondScrollSpeedY=re[0]},rl._getMeshRenderSharedMaterialAlpha=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.alpha:0}return rQ.meshRender.sharedMaterial.alpha},rl._setMeshRenderSharedMaterialAlpha=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.alpha=re[0])}else rQ.meshRender.material.alpha=re[0]},rl._getMeshRenderSharedMaterialIntensity=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.intensity:0}return rQ.meshRender.sharedMaterial.intensity},rl._setMeshRenderSharedMaterialIntensity=function(rS,rQ,re){if(rS){var rl=rS.transform._entity;rl&&(rl.owner.meshRender.material.intensity=re[0])}else rQ.meshRender.material.intensity=re[0]},rl._getMeshRenderSharedMaterialDetailTilingOffset=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return rQ.meshRender.sharedMaterial.detailTilingOffset.elements},rl._setMeshRenderSharedMaterialDetailTilingOffset=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).detailTilingOffset).elements=re,rl.detailTilingOffset=rM)}else(rM=(rl=rQ.meshRender.material).detailTilingOffset).elements=re,rl.detailTilingOffset=rM},rl._getMeshRenderSharedMaterialDissolveTilingOffset=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return rQ.meshRender.sharedMaterial.dissolveTilingOffset.elements},rl._setMeshRenderSharedMaterialDissolveTilingOffset=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).dissolveTilingOffset).elements=re,rl.dissolveTilingOffset=rM)}else(rM=(rl=rQ.meshRender.material).dissolveTilingOffset).elements=re,rl.dissolveTilingOffset=rM},rl._getMeshRenderSharedMaterialMaskTilingOffset=function(rS,rQ){if(rS){var re=rS.transform._entity;return re?re.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return rQ.meshRender.sharedMaterial.maskTilingOffset.elements},rl._setMeshRenderSharedMaterialMaskTilingOffset=function(rS,rQ,re){var rl,rM;if(rS){var rd=rS.transform._entity;rd&&((rM=(rl=rd.owner.meshRender.material).maskTilingOffset).elements=re,rl.maskTilingOffset=rM)}else(rM=(rl=rQ.meshRender.material).maskTilingOffset).elements=re,rl.maskTilingOffset=rM},rl._propertyIDCounter=0,rl._propertyIndexDic={},rl._propertySetFuncs=[],rl._propertyGetFuncs=[],rl}(),rr=function(){function rS(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return rJ(rS,"laya.d3.animation.Keyframe"),rS}(),rW=function(){function rS(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return rJ(rS,"laya.d3.animation.KeyframeNode"),rS}(),rb=(function(){function rS(){this._tempVector30=new rTQ,this._tempVector31=new rTQ,this._tempVector32=new rTQ,this._a=new rTQ,this._b=new rTQ,this._c=new rTQ,this._d=new rTQ}rJ(rS,"laya.d3.core.glitter.SplineCurvePositionVelocity");var rQ=rS.prototype;rQ.Init=function(rS,rQ,re,rl){rS.cloneTo(this._d),rQ.cloneTo(this._c),rTQ.scale(rS,2,this._a),rTQ.scale(re,2,this._tempVector30),rTQ.subtract(this._a,this._tempVector30,this._a),rTQ.add(this._a,rQ,this._a),rTQ.add(this._a,rl,this._a),rTQ.scale(re,3,this._b),rTQ.scale(rS,3,this._tempVector30),rTQ.subtract(this._b,this._tempVector30,this._b),rTQ.subtract(this._b,rl,this._b),rTQ.scale(rQ,2,this._tempVector30),rTQ.subtract(this._b,this._tempVector30,this._b)},rQ.Slerp=function(rS,rQ){rTQ.scale(this._a,rS*rS*rS,this._tempVector30),rTQ.scale(this._b,rS*rS,this._tempVector31),rTQ.scale(this._c,rS,this._tempVector32),rTQ.add(this._tempVector30,this._tempVector31,rQ),rTQ.add(rQ,this._tempVector32,rQ),rTQ.add(rQ,this._d,rQ)}}(),function(){function rP(rS,rQ,re,rl){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=rS,this._h=rQ,this._minHeight=re,this._maxHeight=rl}rJ(rP,"laya.d3.core.HeightMap");var rS=rP.prototype;rS._inBounds=function(rS,rQ){return 0<=rS&&rS<this._h&&0<=rQ&&rQ<this._w},rS.getHeight=function(rS,rQ){return this._inBounds(rS,rQ)?this._datas[rS][rQ]:NaN},rL(0,rS,"width",function(){return this._w}),rL(0,rS,"height",function(){return this._h}),rL(0,rS,"maxHeight",function(){return this._maxHeight}),rL(0,rS,"minHeight",function(){return this._minHeight}),rP.creatFromMesh=function(rS,rQ,re,rl){for(var rM=[],rd=[],rT=rS.getSubMeshCount(),rU=0;rU<rT;rU++){for(var ri=rS.getSubMesh(rU),rR=ri._getVertexBuffer(),ro=rR.getData(),rY=[],rp=0;rp<ro.length;rp+=rR.vertexDeclaration.vertexStride/4){var rJ=new rTQ(ro[rp+0],ro[rp+1],ro[rp+2]);rY.push(rJ)}rM.push(rY);var rL=ri._getIndexBuffer();rd.push(rL.getData())}var rj=rS.boundingBox,rc=rj.min.x,rG=rj.min.z,rz=rj.max.x,rA=rj.max.z,rv=rj.min.y,rD=rj.max.y,rB=rz-rc,rO=rA-rG,rH=rl.elements[0]=rB/(rQ-1),rg=rl.elements[1]=rO/(re-1),rI=new rP(rQ,re,rv,rD),rE=rP._tempRay,rt=rE.direction.elements;rt[0]=0,rt[1]=-1,rt[2]=0;var rk=rD+.1;rE.origin.elements[1]=rk;for(var rX=0;rX<re;rX++){var rh=rG+rX*rg;rI._datas[rX]=[];for(var rb=0;rb<rQ;rb++){var rm=rc+rb*rH,r$=rE.origin.elements;r$[0]=rm,r$[2]=rh;var rn=rP._getPosition(rE,rM,rd);rI._datas[rX][rb]=rn===Number.MAX_VALUE?NaN:rk-rn}}return rI},rP.createFromImage=function(rS,rQ,re){for(var rl=rS.width,rM=rS.height,rd=new rP(rl,rM,rQ,re),rT=(re-rQ)/254,rU=rS.getPixels(),ri=0,rR=0;rR<rM;rR++)for(var ro=rd._datas[rR]=[],rY=0;rY<rl;rY++){var rp=rU[ri++],rJ=rU[ri++],rL=rU[ri++],rj=rU[ri++];ro[rY]=255==rp&&255==rJ&&255==rL&&255==rj?NaN:(rp+rJ+rL)/3*rT+rQ}return rd},rP._getPosition=function(rS,rQ,re){for(var rl=Number.MAX_VALUE,rM=0;rM<rQ.length;rM++)for(var rd=rQ[rM],rT=re[rM],rU=0;rU<rT.length;rU+=3){var ri=rd[rT[rU+0]],rR=rd[rT[rU+1]],ro=rd[rT[rU+2]],rY=rLQ.rayIntersectsTriangle(rS,ri,rR,ro);!isNaN(rY)&&rY<rl&&(rl=rY)}return rl},rY(rP,["_tempRay",function(){return this._tempRay=new rMQ(new rTQ,new rTQ)}])}(),function(){function rM(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}rJ(rM,"laya.d3.core.Layer");var rS=rM.prototype;return rS._binarySearchIndex=function(){for(var rS=0,rQ=rM._collsionTestList.length-1,re=0;rS<=rQ;){re=Math.floor((rS+rQ)/2);var rl=rM._collsionTestList[re];if(rl==this._number)return re;rl>this._number?rQ=re-1:rS=re+1}return rS},rS._addCollider=function(rS){0===this._colliders.length&&rM._collsionTestList.splice(this._binarySearchIndex(),0,this._number),rS._isRigidbody?(this._colliders.unshift(rS),this._nonRigidbodyOffset++):this._colliders.push(rS)},rS._removeCollider=function(rS){var rQ=this._colliders.indexOf(rS);rQ<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(rQ,1),0===this._colliders.length&&rM._collsionTestList.splice(rM._collsionTestList.indexOf(this._number),1)},rL(0,rS,"number",function(){return this._number}),rL(0,rS,"visible",function(){return this._visible},function(rS){this._visible=rS,rM._visibleLayers=rS?rM._visibleLayers|this.mask:rM._visibleLayers&~this.mask}),rL(0,rS,"mask",function(){return this._mask}),rL(1,rM,"visibleLayers",function(){return rM._visibleLayers},function(rS){rM._visibleLayers=rS;for(var rQ=0,re=rM._layerList.length;rQ<re;rQ++){var rl=rM._layerList[rQ];rl._visible=0!=(rl._mask&rM._visibleLayers)}}),rM.__init__=function(){rM._layerList.length=31;for(var rS=0;rS<31;rS++){var rQ=new rM;rM._layerList[rS]=rQ,0===rS?(rQ.name="Default Layer",rQ.visible=!0):(rQ.name="Layer-"+rS,rQ.visible=!1),rQ._number=rS,rQ._mask=Math.pow(2,rS)}rM.currentCreationLayer=rM._layerList[0]},rM.getLayerByNumber=function(rS){if(rS<0||30<rS)throw new Error("无法返回指定Layer，该number超出范围！");return rM._layerList[rS]},rM.getLayerByName=function(rS){for(var rQ=0;rQ<31;rQ++)if(rM._layerList[rQ].name===rS)return rM._layerList[rQ];throw new Error("无法返回指定Layer,该name不存在")},rM.isVisible=function(rS){return 0!=(rS&rM._currentCameraCullingMask&rM._visibleLayers)},rM._layerList=[],rM._visibleLayers=2147483647,rM._collsionTestList=[],rM._currentCameraCullingMask=2147483647,rM.maxCount=31,rM.currentCreationLayer=null,rM}()),rm=(function(){function rS(rS,rQ,re){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=rS,this._minCount=rQ,this._maxCount=re}rJ(rS,"laya.d3.core.particleShuriKen.module.Burst");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.cloneTo=function(rS){var rQ=rS;rQ._time=this._time,rQ._minCount=this._minCount,rQ._maxCount=this._maxCount},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"time",function(){return this._time}),rL(0,rQ,"minCount",function(){return this._minCount}),rL(0,rQ,"maxCount",function(){return this._maxCount})}(),function(){function rS(rS){this._color=null,this.enbale=!1,this._color=rS}rJ(rS,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var rQ=rS.prototype;rQ.cloneTo=function(rS){var rQ=rS;this._color.cloneTo(rQ._color),rQ.enbale=this.enbale},rQ.clone=function(){var rS;switch(this._color.type){case 0:rS=rn.createByConstant(this._color.constant.clone());break;case 1:rS=rn.createByGradient(this._color.gradient.clone());break;case 2:rS=rn.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:rS=rn.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var rQ=new this.constructor(rS);return rQ.enbale=this.enbale,rQ},rL(0,rQ,"color",function(){return this._color})}(),function(){function rS(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}rJ(rS,"laya.d3.core.particleShuriKen.module.Emission");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),rQ._destroy=function(){this._bursts=null,this._destroyed=!0},rQ.getBurstsCount=function(){return this._bursts.length},rQ.getBurstByIndex=function(rS){return this._bursts[rS]},rQ.addBurst=function(rS){var rQ=this._bursts.length;if(0<rQ)for(var re=0;re<rQ;re++)this._bursts[re].time>rS.time&&this._bursts.splice(re,0,rS);this._bursts.push(rS)},rQ.removeBurst=function(rS){var rQ=this._bursts.indexOf(rS);-1!==rQ&&this._bursts.splice(rQ,1)},rQ.removeBurstByIndex=function(rS){this._bursts.splice(rS,1)},rQ.clearBurst=function(){this._bursts.length=0},rQ.cloneTo=function(rS){var rQ=rS,re=rQ._bursts;re.length=this._bursts.length;for(var rl=0,rM=this._bursts.length;rl<rM;rl++){var rd=re[rl];rd?this._bursts[rl].cloneTo(rd):re[rl]=this._bursts[rl].clone()}rQ._emissionRate=this._emissionRate,rQ.enbale=this.enbale},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"destroyed",function(){return this._destroyed}),rL(0,rQ,"emissionRate",function(){return this._emissionRate},function(rS){if(rS<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=rS})}(),function(){function rl(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}rJ(rl,"laya.d3.core.particleShuriKen.module.FrameOverTime");var rS=rl.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,rQ._constant=this._constant,this._overTime.cloneTo(rQ._overTime),rQ._constantMin=this._constantMin,rQ._constantMax=this._constantMax,this._overTimeMin.cloneTo(rQ._overTimeMin),this._overTimeMax.cloneTo(rQ._overTimeMax)},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"frameOverTimeData",function(){return this._overTime}),rL(0,rS,"constant",function(){return this._constant}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"frameOverTimeDataMin",function(){return this._overTimeMin}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"frameOverTimeDataMax",function(){return this._overTimeMax}),rL(0,rS,"constantMax",function(){return this._constantMax}),rl.createByConstant=function(rS){var rQ=new rl;return rQ._type=0,rQ._constant=rS,rQ},rl.createByOverTime=function(rS){var rQ=new rl;return rQ._type=1,rQ._overTime=rS,rQ},rl.createByRandomTwoConstant=function(rS,rQ){var re=new rl;return re._type=2,re._constantMin=rS,re._constantMax=rQ,re},rl.createByRandomTwoOverTime=function(rS,rQ){var re=new rl;return re._type=3,re._overTimeMin=rS,re._overTimeMax=rQ,re},rl}()),r$=function(){function rR(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}rJ(rR,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var rS=rR.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,rQ._separateAxes=this._separateAxes,rQ._constant=this._constant,this._constantSeparate.cloneTo(rQ._constantSeparate),this._gradient.cloneTo(rQ._gradient),this._gradientX.cloneTo(rQ._gradientX),this._gradientY.cloneTo(rQ._gradientY),this._gradientZ.cloneTo(rQ._gradientZ),rQ._constantMin=this._constantMin,rQ._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(rQ._constantMinSeparate),this._constantMaxSeparate.cloneTo(rQ._constantMaxSeparate),this._gradientMin.cloneTo(rQ._gradientMin),this._gradientMax.cloneTo(rQ._gradientMax),this._gradientXMin.cloneTo(rQ._gradientXMin),this._gradientXMax.cloneTo(rQ._gradientXMax),this._gradientYMin.cloneTo(rQ._gradientYMin),this._gradientYMax.cloneTo(rQ._gradientYMax),this._gradientZMin.cloneTo(rQ._gradientZMin),this._gradientZMax.cloneTo(rQ._gradientZMax)},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"gradientZ",function(){return this._gradientZ}),rL(0,rS,"constant",function(){return this._constant}),rL(0,rS,"gradient",function(){return this._gradient}),rL(0,rS,"separateAxes",function(){return this._separateAxes}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"constantSeparate",function(){return this._constantSeparate}),rL(0,rS,"gradientX",function(){return this._gradientX}),rL(0,rS,"gradientY",function(){return this._gradientY}),rL(0,rS,"gradientW",function(){return this._gradientW}),rL(0,rS,"gradientMin",function(){return this._gradientMin}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"gradientMax",function(){return this._gradientMax}),rL(0,rS,"constantMax",function(){return this._constantMax}),rL(0,rS,"gradientWMin",function(){return this._gradientWMin}),rL(0,rS,"constantMinSeparate",function(){return this._constantMinSeparate}),rL(0,rS,"constantMaxSeparate",function(){return this._constantMaxSeparate}),rL(0,rS,"gradientXMin",function(){return this._gradientXMin}),rL(0,rS,"gradientXMax",function(){return this._gradientXMax}),rL(0,rS,"gradientWMax",function(){return this._gradientWMax}),rL(0,rS,"gradientYMin",function(){return this._gradientYMin}),rL(0,rS,"gradientYMax",function(){return this._gradientYMax}),rL(0,rS,"gradientZMin",function(){return this._gradientZMin}),rL(0,rS,"gradientZMax",function(){return this._gradientZMax}),rR.createByConstant=function(rS){var rQ=new rR;return rQ._type=0,rQ._separateAxes=!1,rQ._constant=rS,rQ},rR.createByConstantSeparate=function(rS){var rQ=new rR;return rQ._type=0,rQ._separateAxes=!0,rQ._constantSeparate=rS,rQ},rR.createByGradient=function(rS){var rQ=new rR;return rQ._type=1,rQ._separateAxes=!1,rQ._gradient=rS,rQ},rR.createByGradientSeparate=function(rS,rQ,re,rl){var rM=new rR;return rM._type=1,rM._separateAxes=!0,rM._gradientX=rS,rM._gradientY=rQ,rM._gradientZ=re,rM._gradientW=rl,rM},rR.createByRandomTwoConstant=function(rS,rQ){var re=new rR;return re._type=2,re._separateAxes=!1,re._constantMin=rS,re._constantMax=rQ,re},rR.createByRandomTwoConstantSeparate=function(rS,rQ){var re=new rR;return re._type=2,re._separateAxes=!0,re._constantMinSeparate=rS,re._constantMaxSeparate=rQ,re},rR.createByRandomTwoGradient=function(rS,rQ){var re=new rR;return re._type=3,re._separateAxes=!1,re._gradientMin=rS,re._gradientMax=rQ,re},rR.createByRandomTwoGradientSeparate=function(rS,rQ,re,rl,rM,rd,rT,rU){var ri=new rR;return ri._type=3,ri._separateAxes=!0,ri._gradientXMin=rS,ri._gradientXMax=rQ,ri._gradientYMin=re,ri._gradientYMax=rl,ri._gradientZMin=rM,ri._gradientZMax=rd,ri._gradientWMin=rT,ri._gradientWMax=rU,ri},rR}(),rn=function(){function rl(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}rJ(rl,"laya.d3.core.particleShuriKen.module.GradientColor");var rS=rl.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,this._constant.cloneTo(rQ._constant),this._constantMin.cloneTo(rQ._constantMin),this._constantMax.cloneTo(rQ._constantMax),this._gradient.cloneTo(rQ._gradient),this._gradientMin.cloneTo(rQ._gradientMin),this._gradientMax.cloneTo(rQ._gradientMax)},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"gradient",function(){return this._gradient}),rL(0,rS,"constant",function(){return this._constant}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"gradientMin",function(){return this._gradientMin}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"gradientMax",function(){return this._gradientMax}),rL(0,rS,"constantMax",function(){return this._constantMax}),rl.createByConstant=function(rS){var rQ=new rl;return rQ._type=0,rQ._constant=rS,rQ},rl.createByGradient=function(rS){var rQ=new rl;return rQ._type=1,rQ._gradient=rS,rQ},rl.createByRandomTwoConstant=function(rS,rQ){var re=new rl;return re._type=2,re._constantMin=rS,re._constantMax=rQ,re},rl.createByRandomTwoGradient=function(rS,rQ){var re=new rl;return re._type=3,re._gradientMin=rS,re._gradientMax=rQ,re},rl}(),rP=(function(){function rS(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}rJ(rS,"laya.d3.core.particleShuriKen.module.GradientDataColor");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.addAlpha=function(rS,rQ){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==rS&&(rS=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=rS,this._alphaElements[this._alphaCurrentLength++]=rQ):DEBUG},rQ.addRGB=function(rS,rQ){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==rS&&(rS=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=rS,this._rgbElements[this._rgbCurrentLength++]=rQ.x,this._rgbElements[this._rgbCurrentLength++]=rQ.y,this._rgbElements[this._rgbCurrentLength++]=rQ.z):DEBUG},rQ.cloneTo=function(rS){var rQ=rS,re=0,rl=0;rQ._alphaCurrentLength=this._alphaCurrentLength;var rM=rQ._alphaElements;for(rM.length=this._alphaElements.length,re=0,rl=this._alphaElements.length;re<rl;re++)rM[re]=this._alphaElements[re];rQ._rgbCurrentLength=this._rgbCurrentLength;var rd=rQ._rgbElements;for(rd.length=this._rgbElements.length,re=0,rl=this._rgbElements.length;re<rl;re++)rd[re]=this._rgbElements[re]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),rL(0,rQ,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function rS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}rJ(rS,"laya.d3.core.particleShuriKen.module.GradientDataInt");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.add=function(rS,rQ){this._currentLength<8?(6===this._currentLength&&1!==rS&&(rS=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=rS,this._elements[this._currentLength++]=rQ):console.log("Warning:data count must lessEqual than 4")},rQ.cloneTo=function(rS){var rQ=rS;rQ._currentLength=this._currentLength;var re=rQ._elements;re.length=this._elements.length;for(var rl=0,rM=this._elements.length;rl<rM;rl++)re[rl]=this._elements[rl]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"gradientCount",function(){return this._currentLength/2})}(),function(){function rS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}rJ(rS,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.add=function(rS,rQ){this._currentLength<8?(6===this._currentLength&&1!==rS&&(rS=1,DEBUG),this._elements[this._currentLength++]=rS,this._elements[this._currentLength++]=rQ):DEBUG},rQ.getKeyByIndex=function(rS){return this._elements[2*rS]},rQ.getValueByIndex=function(rS){return this._elements[2*rS+1]},rQ.getAverageValue=function(){for(var rS=0,rQ=this._currentLength-2;rS<rQ;rS+=2){this._elements[rS+1];this._elements[rS+3],this._elements[rS+2]-this._elements[rS]}return 0},rQ.cloneTo=function(rS){var rQ=rS;rQ._currentLength=this._currentLength;var re=rQ._elements;re.length=this._elements.length;for(var rl=0,rM=this._elements.length;rl<rM;rl++)re[rl]=this._elements[rl]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"gradientCount",function(){return this._currentLength/2})}(),function(){function rS(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}rJ(rS,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.add=function(rS,rQ){this._currentLength<8?(6===this._currentLength&&1!==rS&&(rS=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=rS,this._elements[this._currentLength++]=rQ.x,this._elements[this._currentLength++]=rQ.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},rQ.cloneTo=function(rS){var rQ=rS;rQ._currentLength=this._currentLength;var re=rQ._elements;re.length=this._elements.length;for(var rl=0,rM=this._elements.length;rl<rM;rl++)re[rl]=this._elements[rl]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"gradientCount",function(){return this._currentLength/3})}(),function(){function rU(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}rJ(rU,"laya.d3.core.particleShuriKen.module.GradientSize");var rS=rU.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.getMaxSizeInGradient=function(){var rS=0,rQ=0,re=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(rS=0,rQ=this._gradientX.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientX.getValueByIndex(rS));for(rS=0,rQ=this._gradientY.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientY.getValueByIndex(rS))}else for(rS=0,rQ=this._gradient.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradient.getValueByIndex(rS));break;case 1:re=this._separateAxes?(re=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),re=Math.max(re,this._constantMinSeparate.y),Math.max(re,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(rS=0,rQ=this._gradientXMin.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientXMin.getValueByIndex(rS));for(rS=0,rQ=this._gradientXMax.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientXMax.getValueByIndex(rS));for(rS=0,rQ=this._gradientYMin.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientYMin.getValueByIndex(rS));for(rS=0,rQ=this._gradientZMax.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientZMax.getValueByIndex(rS))}else{for(rS=0,rQ=this._gradientMin.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientMin.getValueByIndex(rS));for(rS=0,rQ=this._gradientMax.gradientCount;rS<rQ;rS++)re=Math.max(re,this._gradientMax.getValueByIndex(rS))}}return re},rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,rQ._separateAxes=this._separateAxes,this._gradient.cloneTo(rQ._gradient),this._gradientX.cloneTo(rQ._gradientX),this._gradientY.cloneTo(rQ._gradientY),this._gradientZ.cloneTo(rQ._gradientZ),rQ._constantMin=this._constantMin,rQ._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(rQ._constantMinSeparate),this._constantMaxSeparate.cloneTo(rQ._constantMaxSeparate),this._gradientMin.cloneTo(rQ._gradientMin),this._gradientMax.cloneTo(rQ._gradientMax),this._gradientXMin.cloneTo(rQ._gradientXMin),this._gradientXMax.cloneTo(rQ._gradientXMax),this._gradientYMin.cloneTo(rQ._gradientYMin),this._gradientYMax.cloneTo(rQ._gradientYMax),this._gradientZMin.cloneTo(rQ._gradientZMin),this._gradientZMax.cloneTo(rQ._gradientZMax)},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"gradientZ",function(){return this._gradientZ}),rL(0,rS,"gradient",function(){return this._gradient}),rL(0,rS,"separateAxes",function(){return this._separateAxes}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"gradientMin",function(){return this._gradientMin}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"gradientX",function(){return this._gradientX}),rL(0,rS,"gradientY",function(){return this._gradientY}),rL(0,rS,"gradientMax",function(){return this._gradientMax}),rL(0,rS,"constantMax",function(){return this._constantMax}),rL(0,rS,"constantMinSeparate",function(){return this._constantMinSeparate}),rL(0,rS,"constantMaxSeparate",function(){return this._constantMaxSeparate}),rL(0,rS,"gradientXMin",function(){return this._gradientXMin}),rL(0,rS,"gradientXMax",function(){return this._gradientXMax}),rL(0,rS,"gradientYMin",function(){return this._gradientYMin}),rL(0,rS,"gradientYMax",function(){return this._gradientYMax}),rL(0,rS,"gradientZMin",function(){return this._gradientZMin}),rL(0,rS,"gradientZMax",function(){return this._gradientZMax}),rU.createByGradient=function(rS){var rQ=new rU;return rQ._type=0,rQ._separateAxes=!1,rQ._gradient=rS,rQ},rU.createByGradientSeparate=function(rS,rQ,re){var rl=new rU;return rl._type=0,rl._separateAxes=!0,rl._gradientX=rS,rl._gradientY=rQ,rl._gradientZ=re,rl},rU.createByRandomTwoConstant=function(rS,rQ){var re=new rU;return re._type=1,re._separateAxes=!1,re._constantMin=rS,re._constantMax=rQ,re},rU.createByRandomTwoConstantSeparate=function(rS,rQ){var re=new rU;return re._type=1,re._separateAxes=!0,re._constantMinSeparate=rS,re._constantMaxSeparate=rQ,re},rU.createByRandomTwoGradient=function(rS,rQ){var re=new rU;return re._type=2,re._separateAxes=!1,re._gradientMin=rS,re._gradientMax=rQ,re},rU.createByRandomTwoGradientSeparate=function(rS,rQ,re,rl,rM,rd){var rT=new rU;return rT._type=2,rT._separateAxes=!0,rT._gradientXMin=rS,rT._gradientXMax=rQ,rT._gradientYMin=re,rT._gradientYMax=rl,rT._gradientZMin=rM,rT._gradientZMax=rd,rT},rU}()),ra=function(){function rU(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}rJ(rU,"laya.d3.core.particleShuriKen.module.GradientVelocity");var rS=rU.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,this._constant.cloneTo(rQ._constant),this._gradientX.cloneTo(rQ._gradientX),this._gradientY.cloneTo(rQ._gradientY),this._gradientZ.cloneTo(rQ._gradientZ),this._constantMin.cloneTo(rQ._constantMin),this._constantMax.cloneTo(rQ._constantMax),this._gradientXMin.cloneTo(rQ._gradientXMin),this._gradientXMax.cloneTo(rQ._gradientXMax),this._gradientYMin.cloneTo(rQ._gradientYMin),this._gradientYMax.cloneTo(rQ._gradientYMax),this._gradientZMin.cloneTo(rQ._gradientZMin),this._gradientZMax.cloneTo(rQ._gradientZMax)},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"gradientZ",function(){return this._gradientZ}),rL(0,rS,"constant",function(){return this._constant}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"gradientXMax",function(){return this._gradientXMax}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"gradientX",function(){return this._gradientX}),rL(0,rS,"gradientY",function(){return this._gradientY}),rL(0,rS,"gradientXMin",function(){return this._gradientXMin}),rL(0,rS,"constantMax",function(){return this._constantMax}),rL(0,rS,"gradientYMin",function(){return this._gradientYMin}),rL(0,rS,"gradientYMax",function(){return this._gradientYMax}),rL(0,rS,"gradientZMin",function(){return this._gradientZMin}),rL(0,rS,"gradientZMax",function(){return this._gradientZMax}),rU.createByConstant=function(rS){var rQ=new rU;return rQ._type=0,rQ._constant=rS,rQ},rU.createByGradient=function(rS,rQ,re){var rl=new rU;return rl._type=1,rl._gradientX=rS,rl._gradientY=rQ,rl._gradientZ=re,rl},rU.createByRandomTwoConstant=function(rS,rQ){var re=new rU;return re._type=2,re._constantMin=rS,re._constantMax=rQ,re},rU.createByRandomTwoGradient=function(rS,rQ,re,rl,rM,rd){var rT=new rU;return rT._type=3,rT._gradientXMin=rS,rT._gradientXMax=rQ,rT._gradientYMin=re,rT._gradientYMax=rl,rT._gradientZMin=rM,rT._gradientZMax=rd,rT},rU}(),rf=(function(){function rS(rS){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=rS}rJ(rS,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.cloneTo=function(rS){var rQ=rS;this._angularVelocity.cloneTo(rQ._angularVelocity),rQ.enbale=this.enbale},rQ.clone=function(){var rS;switch(this._angularVelocity.type){case 0:rS=this._angularVelocity.separateAxes?r$.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):r$.createByConstant(this._angularVelocity.constant);break;case 1:rS=this._angularVelocity.separateAxes?r$.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):r$.createByGradient(this._angularVelocity.gradient.clone());break;case 2:rS=this._angularVelocity.separateAxes?r$.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):r$.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:rS=this._angularVelocity.separateAxes?r$.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):r$.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var rQ=new this.constructor(rS);return rQ.enbale=this.enbale,rQ},rL(0,rQ,"angularVelocity",function(){return this._angularVelocity})}(),function(){function rS(){this.enable=!1,this.randomDirection=!1}rJ(rS,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ._getShapeBoundBox=function(rS){throw new Error("BaseShape: must override it.")},rQ._getSpeedBoundBox=function(rS){throw new Error("BaseShape: must override it.")},rQ.generatePositionAndDirection=function(rS,rQ,re,rl){throw new Error("BaseShape: must override it.")},rQ._calculateProceduralBounds=function(rS,rQ,re){this._getShapeBoundBox(rS);var rl=rS.min,rM=rS.max;rTQ.multiply(rl,rQ,rl),rTQ.multiply(rM,rQ,rM);var rd=new rKS(new rTQ,new rTQ);this.randomDirection?(rd.min=new rTQ(-1,-1,-1),rd.max=new rTQ(1,1,1)):this._getSpeedBoundBox(rd);var rT=new rKS(new rTQ,new rTQ),rU=rT.min,ri=rT.max;rTQ.scale(rd.min,re.y,rU),rTQ.scale(rd.max,re.y,ri),rTQ.add(rS.min,rU,rU),rTQ.add(rS.max,ri,ri),rTQ.min(rS.min,rU,rS.min),rTQ.max(rS.max,rU,rS.max);var rR=new rKS(new rTQ,new rTQ),ro=rR.min,rY=rR.max;rTQ.scale(rd.min,re.x,ro),rTQ.scale(rd.max,re.x,rY),rTQ.min(rR.min,rY,rU),rTQ.max(rR.min,rY,ri),rTQ.min(rS.min,rU,rS.min),rTQ.max(rS.max,rU,rS.max)},rQ.cloneTo=function(rS){rS.enable=this.enable},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rS}()),rx=function(){function rd(){}return rJ(rd,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),rd._randomPointUnitArcCircle=function(rS,rQ,re){var rl=rQ.elements,rM=NaN;rM=re?re.getFloat()*rS:Math.random()*rS,rl[0]=Math.cos(rM),rl[1]=Math.sin(rM)},rd._randomPointInsideUnitArcCircle=function(rS,rQ,re){var rl=rQ.elements;rd._randomPointUnitArcCircle(rS,rQ,re);var rM=NaN;rM=re?Math.pow(re.getFloat(),.5):Math.pow(Math.random(),.5),rl[0]=rl[0]*rM,rl[1]=rl[1]*rM},rd._randomPointUnitCircle=function(rS,rQ){var re=rS.elements,rl=NaN;rl=rQ?rQ.getFloat()*Math.PI*2:Math.random()*Math.PI*2,re[0]=Math.cos(rl),re[1]=Math.sin(rl)},rd._randomPointInsideUnitCircle=function(rS,rQ){var re=rS.elements;rd._randomPointUnitCircle(rS);var rl=NaN;rl=rQ?Math.pow(rQ.getFloat(),.5):Math.pow(Math.random(),.5),re[0]=re[0]*rl,re[1]=re[1]*rl},rd._randomPointUnitSphere=function(rS,rQ){var re=rS.elements,rl=NaN,rM=NaN;rM=rQ?(rl=re[2]=2*rQ.getFloat()-1,rQ.getFloat()*Math.PI*2):(rl=re[2]=2*Math.random()-1,Math.random()*Math.PI*2);var rd=Math.sqrt(1-rl*rl);re[0]=rd*Math.cos(rM),re[1]=rd*Math.sin(rM)},rd._randomPointInsideUnitSphere=function(rS,rQ){var re=rS.elements;rd._randomPointUnitSphere(rS);var rl=NaN;rl=rQ?Math.pow(rQ.getFloat(),1/3):Math.pow(Math.random(),1/3),re[0]=re[0]*rl,re[1]=re[1]*rl,re[2]=re[2]*rl},rd._randomPointInsideHalfUnitBox=function(rS,rQ){var re=rS.elements;rQ?(re[0]=rQ.getFloat()-.5,re[1]=rQ.getFloat()-.5,re[2]=rQ.getFloat()-.5):(re[0]=Math.random()-.5,re[1]=Math.random()-.5,re[2]=Math.random()-.5)},rd}(),rF=(function(){function rS(rS){this._size=null,this.enbale=!1,this._size=rS}rJ(rS,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.cloneTo=function(rS){var rQ=rS;this._size.cloneTo(rQ._size),rQ.enbale=this.enbale},rQ.clone=function(){var rS;switch(this._size.type){case 0:rS=this._size.separateAxes?rP.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):rP.createByGradient(this._size.gradient.clone());break;case 1:rS=this._size.separateAxes?rP.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):rP.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:rS=this._size.separateAxes?rP.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):rP.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var rQ=new this.constructor(rS);return rQ.enbale=this.enbale,rQ},rL(0,rQ,"size",function(){return this._size})}(),function(){function rl(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}rJ(rl,"laya.d3.core.particleShuriKen.module.StartFrame");var rS=rl.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.cloneTo=function(rS){var rQ=rS;rQ._type=this._type,rQ._constant=this._constant,rQ._constantMin=this._constantMin,rQ._constantMax=this._constantMax},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rS,"constant",function(){return this._constant}),rL(0,rS,"type",function(){return this._type}),rL(0,rS,"constantMin",function(){return this._constantMin}),rL(0,rS,"constantMax",function(){return this._constantMax}),rl.createByConstant=function(rS){var rQ=new rl;return rQ._type=0,rQ._constant=rS,rQ},rl.createByRandomTwoConstant=function(rS,rQ){var re=new rl;return re._type=1,re._constantMin=rS,re._constantMax=rQ,re},rl}()),rq=(function(){function rS(rS,rQ){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new rdQ(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=rS,this._startFrame=rQ}rJ(rS,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.cloneTo=function(rS){var rQ=rS;this.tiles.cloneTo(rQ.tiles),rQ.type=this.type,rQ.randomRow=this.randomRow,this._frame.cloneTo(rQ._frame),this._startFrame.cloneTo(rQ._startFrame),rQ.cycles=this.cycles,rQ.enableUVChannels=this.enableUVChannels,rQ.enable=this.enable},rQ.clone=function(){var rS,rQ;switch(this._frame.type){case 0:rS=rm.createByConstant(this._frame.constant);break;case 1:rS=rm.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:rS=rm.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:rS=rm.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:rQ=rF.createByConstant(this._startFrame.constant);break;case 1:rQ=rF.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var re=new this.constructor(rS,rQ);return this.tiles.cloneTo(re.tiles),re.type=this.type,re.randomRow=this.randomRow,re.cycles=this.cycles,re.enableUVChannels=this.enableUVChannels,re.enable=this.enable,re},rL(0,rQ,"frame",function(){return this._frame}),rL(0,rQ,"startFrame",function(){return this._startFrame})}(),function(){function rS(rS){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=rS}rJ(rS,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.cloneTo=function(rS){var rQ=rS;this._velocity.cloneTo(rQ._velocity),rQ.enbale=this.enbale,rQ.space=this.space},rQ.clone=function(){var rS;switch(this._velocity.type){case 0:rS=ra.createByConstant(this._velocity.constant.clone());break;case 1:rS=ra.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:rS=ra.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:rS=ra.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var rQ=new this.constructor(rS);return rQ.enbale=this.enbale,rQ.space=this.space,rQ},rL(0,rQ,"velocity",function(){return this._velocity})}(),function(){function rS(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new rpQ,this._vb=rfQ.create(rS._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=raQ.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=rnQ.nameKey.getID("LINE"),this._shaderCompile=rHQ._preCompileShader[this._sharderNameID]}rJ(rS,"laya.d3.core.PhasorSpriter3D");var rQ=rS.prototype;return rQ.line=function(rS,rQ,re,rl){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(rS.x,rS.y,rS.z,rQ.x,rQ.y,rQ.z,rQ.w),this.addVertex(re.x,re.y,re.z,rl.x,rl.y,rl.z,rl.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},rQ.circle=function(rS,rQ,re,rl,rM,rd){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*rQ,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/rQ,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*rS,Math.cos(this._tempNumver0)*rS,0,re,rl,rM,rd),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},rQ.plane=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=rl/2,this._tempNumver1=rM/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(rS-this._tempNumver0,rQ+this._tempNumver1,re,rd,rT,rU,ri),this.addVertex(rS+this._tempNumver0,rQ+this._tempNumver1,re,rd,rT,rU,ri),this.addVertex(rS-this._tempNumver0,rQ-this._tempNumver1,re,rd,rT,rU,ri),this.addVertex(rS+this._tempNumver0,rQ-this._tempNumver1,re,rd,rT,rU,ri),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},rQ.box=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=rl/2,this._tempNumver1=rM/2,this._tempNumver2=rd/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(rS-this._tempNumver0,rQ+this._tempNumver1,re+this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS+this._tempNumver0,rQ+this._tempNumver1,re+this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS-this._tempNumver0,rQ-this._tempNumver1,re+this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS+this._tempNumver0,rQ-this._tempNumver1,re+this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS+this._tempNumver0,rQ+this._tempNumver1,re-this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS-this._tempNumver0,rQ+this._tempNumver1,re-this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS+this._tempNumver0,rQ-this._tempNumver1,re-this._tempNumver2,rT,rU,ri,rR),this.addVertex(rS-this._tempNumver0,rQ-this._tempNumver1,re-this._tempNumver2,rT,rU,ri,rR),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},rQ.cone=function(rS,rQ,re,rl,rM,rd,rT){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*re+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*re>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/re,this.addVertexIndex(0,rQ,0,rl,rM,rd,rT,this._tempUint0),this.addVertexIndex(0,0,0,rl,rM,rd,rT,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<re;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(rS*this._tempNumver2,0,rS*this._tempNumver3,rl,rM,rd,rT,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==re-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(rS*this._tempNumver2,0,rS*this._tempNumver3,rl,rM,rd,rT,this._tempUint0+(this._tempInt0+re)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==re-1?this.addIndexes(this._tempUint1+re+2):this.addIndexes(this._tempUint1+this._tempInt0+re+1),this.addIndexes(this._tempUint1+this._tempInt0+re),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},rQ.boundingBoxLine=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(rS,rM,rd,rT,rU,ri,rR),this.addVertex(rl,rM,rd,rT,rU,ri,rR),this.addVertex(rS,rQ,rd,rT,rU,ri,rR),this.addVertex(rl,rQ,rd,rT,rU,ri,rR),this.addVertex(rl,rM,re,rT,rU,ri,rR),this.addVertex(rS,rM,re,rT,rU,ri,rR),this.addVertex(rl,rQ,re,rT,rU,ri,rR),this.addVertex(rS,rQ,re,rT,rU,ri,rR),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},rQ.addVertex=function(rS,rQ,re,rl,rM,rd,rT){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=rS,this._vbData[this._posInVBData+1]=rQ,this._vbData[this._posInVBData+2]=re,this._vbData[this._posInVBData+3]=rl,this._vbData[this._posInVBData+4]=rM,this._vbData[this._posInVBData+5]=rd,this._vbData[this._posInVBData+6]=rT,this._posInVBData+=this._floatSizePerVer,this},rQ.addVertexIndex=function(rS,rQ,re,rl,rM,rd,rT,rU){return this._hasBegun||this.addVertexIndexException(),this._vbData[rU]=rS,this._vbData[rU+1]=rQ,this._vbData[rU+2]=re,this._vbData[rU+3]=rl,this._vbData[rU+4]=rM,this._vbData[rU+5]=rd,this._vbData[rU+6]=rT,(rU+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=rU),this},rQ.addIndexes=function(rS){var rQ=arguments;this._hasBegun||this.addVertexIndexException();for(var re=0;re<rQ.length;re++)this._ibData[this._posInIBData]=rQ[re],this._posInIBData++;return this},rQ.begin=function(rS,rQ){return this._hasBegun&&this.beginException0(),1!==rS&&4!==rS&&this.beginException1(),this._primitiveType=rS,this._camera=rQ,this._hasBegun=!0,this},rQ.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},rQ.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(rS._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),rH.drawCall++,rk.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},rQ.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},rQ.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},rQ.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},rQ.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},rQ.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},rQ.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(28,[new rTS(0,"vector3",0),new rTS(12,"vector4",1)])}]),rS}()),rZ=function(){function rS(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++rS._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new rpQ}rJ(rS,"laya.d3.core.render.RenderElement");var rQ=rS.prototype;return rQ.getDynamicBatchBakedVertexs=function(rS){for(var rQ=this._renderObj._getVertexBuffer(rS),re=rQ.getData().slice(),rl=rQ.vertexDeclaration,rM=rl.getVertexElementByUsage(0).offset/4,rd=rl.getVertexElementByUsage(3).offset/4,rT=this._sprite3D.transform,rU=rT.worldMatrix,ri=rT.rotation,rR=rl.vertexStride/4,ro=0,rY=re.length;ro<rY;ro+=rR){var rp=ro+rM,rJ=ro+rd;rcQ.transformVector3ArrayToVector3ArrayCoordinate(re,rp,rU,re,rp),rcQ.transformVector3ArrayByQuat(re,rJ,ri,re,rJ)}return re},rQ.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},rQ._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},rL(0,rQ,"id",function(){return this._id}),rL(0,rQ,"renderObj",function(){return this._renderObj},function(rS){this._renderObj!==rS&&(this._renderObj=rS)}),rS._uniqueIDCounter=0,rS}(),rN=function(){function rQ(rS){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++rQ._uniqueIDCounter,this._needSort=!1,this._scene=rS,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}rJ(rQ,"laya.d3.core.render.RenderQueue");var rS=rQ.prototype;return rS._sortOpaqueFunc=function(rS,rQ){if(rS._render&&rQ._render){var re=rS._material.renderQueue-rQ._material.renderQueue;return 0==re?rS._render._distanceForSort-rQ._render._distanceForSort:re}return 0},rS._sortAlphaFunc=function(rS,rQ){if(rS._render&&rQ._render){var re=rS._material.renderQueue-rQ._material.renderQueue;return 0==re?rQ._render._distanceForSort-rS._render._distanceForSort:re}return 0},rS._begainRenderElement=function(rS,rQ,re){return!!rQ._beforeRender(rS)},rS._sortAlpha=function(rS){rQ._cameraPosition=rS,this._finalElements.sort(this._sortAlphaFunc)},rS._sortOpaque=function(rS){rQ._cameraPosition=rS,this._finalElements.sort(this._sortOpaqueFunc)},rS._preRender=function(rS){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},rS._render=function(rS,rQ){for(var re,rl,rM,rd,rT,rU,ri=rH.loopCount,rR=this._scene,ro=rS.camera,rY=(ro.id,!1),rp=0,rJ=this._finalElements.length;rp<rJ;rp++){var rL,rj,rc,rG=this._finalElements[rp];if(null!=rG._onPreRenderFunction&&rG._onPreRenderFunction.call(rG._sprite3D,rS),0===rG._type){if(rS.owner=rc=rG._sprite3D,rS.renderElement=rG,rc._preRenderUpdateComponents(rS),rL=rG.renderObj,rj=rG._material,this._begainRenderElement(rS,rL,rj)){if(re=rL._getVertexBuffers(),!(rM=(rl=rL._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[rl.id]){this._errorRecord[rl.id]=1;var rz="vertexBuffer:"+("("+rl._destroyed+","+rl._released+","+rl._referenceCount+","+rl._buffer+")")+", material:"+(rj?rj.__className+"("+rj._destroyed+","+rj._released+")":"null")+", owner:"+(rc?rc.__className+"("+rc._destroyed+","+rc._activeInHierarchy+","+rc._displayedInStage+")":"null")+", renderObj:"+(rL?rL.__className+"("+rL._destroyed+","+rL._released+","+rL._referenceCount+")":"")+", parent:, url:"+(rc?rc.url:"")+", disposeStack:"+rl.disposeStack;rD.recordError("报错：unknown vertexDeclaration  "+rz)}continue}if(rY=(rd=rS._shader=rj._getShader(rR._shaderDefineValue,rM.shaderDefineValue,rc._shaderDefineValue)).bind()||ri!==rd._uploadLoopCount,re){if(rd._uploadVertexBuffer!==re||rY){for(var rA=0;rA<re.length;rA++){var rv=re[rA];rd.uploadAttributesX(rv.vertexDeclaration.shaderValues.data,rv)}rd._uploadVertexBuffer=re}}else(rd._uploadVertexBuffer!==rl||rY)&&(rd.uploadAttributes(rM.shaderValues.data,null),rd._uploadVertexBuffer=rl);(rd._uploadScene!==rR||rY)&&(rd.uploadSceneUniforms(rR._shaderValues.data),rd._uploadScene=rR),(ro!==rd._uploadCamera||rd._uploadSprite3D!==rc||rY)&&(rd.uploadSpriteUniforms(rc._shaderValues.data),rd._uploadSprite3D=rc),(ro!==rd._uploadCamera||rY)&&(rd.uploadCameraUniforms(ro._shaderValues.data),rd._uploadCamera=ro),(rd._uploadMaterial!==rj||rY)&&(rj._upload(),rd._uploadMaterial=rj),rT!==rj?(rj._setRenderStateBlendDepth(),rj._setRenderStateFrontFace(rQ,rc.transform),rT=rj,rU=rc):rU!==rc&&(rj._setRenderStateFrontFace(rQ,rc.transform),rU=rc),rL._render(rS),rd._uploadLoopCount=ri}rc._postRenderUpdateComponents(rS)}else if(2===rG._type){rG.renderObj;rS.owner=rc=rG._sprite3D,rS.renderElement=rG,rS._batchIndexStart=rG._tempBatchIndexStart,rS._batchIndexEnd=rG._tempBatchIndexEnd,rL=rG.renderObj,rj=rG._material,this._begainRenderElement(rS,rL,rj)&&(rM=(rl=rL._getVertexBuffer(0)).vertexDeclaration,rY=(rd=rS._shader=rj._getShader(rR._shaderDefineValue,rM.shaderDefineValue,rc._shaderDefineValue)).bind()||ri!==rd._uploadLoopCount,(rd._uploadVertexBuffer!==rl||rY)&&(rd.uploadAttributes(rM.shaderValues.data,null),rd._uploadVertexBuffer=rl),(rd._uploadScene!==rR||rY)&&(rd.uploadSceneUniforms(rR._shaderValues.data),rd._uploadScene=rR),(ro!==rd._uploadCamera||rd._uploadSprite3D!==rc||rY)&&(rd.uploadSpriteUniforms(rc._shaderValues.data),rd._uploadSprite3D=rc),(ro!==rd._uploadCamera||rY)&&(rd.uploadCameraUniforms(ro._shaderValues.data),rd._uploadCamera=ro),(rd._uploadMaterial!==rj||rY)&&(rj._upload(),rd._uploadMaterial=rj),rT!==rj?(rj._setRenderStateBlendDepth(),rj._setRenderStateFrontFace(rQ,rc.transform),rT=rj,rU=rc):rU!==rc&&(rj._setRenderStateFrontFace(rQ,rc.transform),rU=rc),rL._render(rS),rd._uploadLoopCount=ri)}}},rS._renderShadow=function(rS,rQ){for(var re,rl,rM,rd,rT,rU=rH.loopCount,ri=this._scene,rR=rS.camera,ro=!1,rY=0,rp=this._finalElements.length;rY<rp;rY++){var rJ,rL,rj,rc=this._finalElements[rY];0===rc._type&&(rS.owner=rj=rc._sprite3D,rQ||rj._projectionViewWorldUpdateCamera===rR&&rj._projectionViewWorldUpdateLoopCount===rH.loopCount||(rj._render._renderUpdate(rS._projectionViewMatrix),rj._projectionViewWorldUpdateLoopCount=rH.loopCount,rj._projectionViewWorldUpdateCamera=rR),rS.renderElement=rc,rj._preRenderUpdateComponents(rS),rJ=rc.renderObj,rL=rc._material,this._begainRenderElement(rS,rJ,null)&&(rl=(re=rJ._getVertexBuffer(0)).vertexDeclaration,ro=(rM=rS._shader=rL._getShader(ri._shaderDefineValue,rl.shaderDefineValue,rj._shaderDefineValue)).bind()||rU!==rM._uploadLoopCount,(rM._uploadVertexBuffer!==re||ro)&&(rM.uploadAttributes(rl.shaderValues.data,null),rM._uploadVertexBuffer=re),(rR!==rM._uploadCamera||rM._uploadSprite3D!==rj||ro)&&(rM.uploadSpriteUniforms(rj._shaderValues.data),rM._uploadSprite3D=rj),(rR!==rM._uploadCamera||ro)&&(rM.uploadCameraUniforms(rR._shaderValues.data),rM._uploadCamera=rR),(rM._uploadMaterial!==rL||ro)&&(rL._upload(),rM._uploadMaterial=rL),rM._uploadRenderElement,rd!==rL?(rL._setRenderStateFrontFace(!1,rj.transform),rd=rL,rT=rj):rT!==rj&&(rL._setRenderStateFrontFace(!1,rj.transform),rT=rj),rJ._render(rS),rM._uploadLoopCount=rU),rj._postRenderUpdateComponents(rS))}},rS._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},rS._addRenderElement=function(rS){this._renderElements.push(rS),this._needSort=!0},rS._addDynamicBatchElement=function(rS){this._dynamicBatchCombineRenderElements.push(rS)},rL(0,rS,"id",function(){return this._id}),rQ._uniqueIDCounter=0,rQ._cameraPosition=null,rQ}(),rC=function(){function rS(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return rJ(rS,"laya.d3.core.render.RenderState"),rS.clientWidth=0,rS.clientHeight=0,rS}(),rK=function(){function rT(rS,rQ){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new r_S(new rTQ,0),this._corners=[new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ],this._boundingBoxCenter=new rTQ,this._children=rl(8),this._objects=[],this._tempBoundBoxCorners=[new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ],this._scene=rS,this._currentDepth=rQ}rJ(rT,"laya.d3.core.scene.OctreeNode");var rS=rT.prototype;return rD.imps(rS,{"laya.d3.core.scene.ITreeNode":!0}),rS.init=function(rS,rQ){var re=new rTQ,rl=new rTQ;rTQ.scale(rQ,-.5,re),rTQ.scale(rQ,.5,rl),rTQ.add(re,rS,re),rTQ.add(rl,rS,rl),this.exactBox=new rKS(re,rl),this.relaxBox=new rKS(re,rl)},rS.addTreeNode=function(rS){1===Collision.boxContainsBox(this._relaxBox,rS.boundingBox)?this.addNodeDown(rS,0):this.addObject(rS)},rS.addChild=function(rS){var rQ=this._children[rS];if(null==rQ){rQ=new rT(this._scene,this._currentDepth+1),(this._children[rS]=rQ)._parent=this,rTQ.subtract(this._exactBox.max,this._exactBox.min,rT.tempSize),rTQ.multiply(rT.tempSize,rT._octreeSplit[rS],rT.tempCenter),rTQ.add(this._exactBox.min,rT.tempCenter,rT.tempCenter),rTQ.scale(rT.tempSize,.25,rT.tempSize);var re=new rTQ,rl=new rTQ;rTQ.subtract(rT.tempCenter,rT.tempSize,re),rTQ.add(rT.tempCenter,rT.tempSize,rl),rQ.exactBox=new rKS(re,rl),rTQ.scale(rT.tempSize,rT.relax,rT.tempSize);var rM=new rTQ,rd=new rTQ;rTQ.subtract(rT.tempCenter,rT.tempSize,rM),rTQ.add(rT.tempCenter,rT.tempSize,rd),rQ.relaxBox=new rKS(rM,rd)}return rQ},rS.addObject=function(rS){(rS._treeNode=this)._objects.push(rS)},rS.removeObject=function(rS){if(rS._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var rQ=this._objects.indexOf(rS);return-1!==rQ&&(this._objects.splice(rQ,1),!0)},rS.clearObject=function(){this._objects.length=0},rS.addNodeUp=function(rS,rQ){this._parent&&1!==Collision.boxContainsBox(this._exactBox,rS.boundingBox)?this._parent.addNodeUp(rS,rQ-1):this.addNodeDown(rS,rQ)},rS.addNodeDown=function(rS,rQ){if(rQ<this._scene.treeLevel){var re=this.inChildIndex(rS.boundingBoxCenter),rl=this.addChild(re);1===Collision.boxContainsBox(rl._relaxBox,rS.boundingBox)?rl.addNodeDown(rS,++rQ):this.addObject(rS)}else this.addObject(rS)},rS.inChildIndex=function(rS){return 4*(rS.z<this._boundingBoxCenter.z?0:1)+2*(rS.y<this._boundingBoxCenter.y?0:1)+(rS.x<this._boundingBoxCenter.x?0:1)},rS.updateObject=function(rS){1===Collision.boxContainsBox(this._relaxBox,rS.boundingBox)?(this.removeObject(rS),rS._treeNode=null,this.addNodeDown(rS,this._currentDepth)):this._parent&&(this.removeObject(rS),rS._treeNode=null,this._parent.addNodeUp(rS,this._currentDepth-1))},rS.cullingObjects=function(rS,rQ,re,rl,rM){var rd,rT=0,rU=0,ri=0,rR=this._scene._dynamicBatchManager;for(rT=0,rd=this._objects.length;rT<rd;rT++){var ro=this._objects[rT];if(rb.isVisible(ro._owner.layer.mask)&&ro.enable){if(rQ&&(rH.treeSpriteCollision+=1,0===rS.containsBoundSphere(ro.boundingSphere)))continue;ro._renderUpdate(rM),ro._distanceForSort=rTQ.distance(ro.boundingSphere.center,rl)+ro.sortingFudge;var rY=ro._renderElements;for(rU=0,ri=rY.length;rU<ri;rU++){var rp=rY[rU],rJ=rp._staticBatch;if(rJ&&rJ._material===rp._material)rJ._addBatchRenderElement(rp);else{var rL=rp.renderObj;rL.triangleCount<10&&1===rL._vertexBufferCount&&rL._getIndexBuffer()&&rp._material.renderQueue<2&&rp._canDynamicBatch&&!ro._owner.isStatic?rR._addPrepareRenderElement(rp):this._scene.getRenderQueue(rp._material.renderQueue)._addRenderElement(rp)}}}}for(rT=0;rT<8;rT++){var rj=this._children[rT];if(null!=rj){var rc=rQ;if(rQ){var rG=rS.containsBoundBox(rj._relaxBox);if(rH.treeNodeCollision+=1,0===rG)continue;rc=2===rG}rj.cullingObjects(rS,rc,re,rl,rM)}}},rS.cullingShadowObjects=function(rS,rQ,re,rl,rM){var rd,rT=0,rU=0,ri=0;this._scene._dynamicBatchManager;for(rT=0,rd=this._objects.length;rT<rd;rT++){var rR=this._objects[rT];if(rR.castShadow&&rb.isVisible(rR._owner.layer.mask)&&rR.enable){if(re&&0===rS[0].containsBoundSphere(rR.boundingSphere))continue;for(var ro=1,rY=rS.length;ro<rY;ro++){var rp=rQ[ro-1];if(0!==rS[ro].containsBoundSphere(rR.boundingSphere)){var rJ=rR._renderElements;for(rU=0,ri=rJ.length;rU<ri;rU++)rp._addRenderElement(rJ[rU])}}}}for(rT=0;rT<8;rT++){var rL=this._children[rT];if(null!=rL){var rj=re;if(re){var rc=rS[0].containsBoundBox(rL._relaxBox);if(0===rc)continue;rj=2===rc}rL.cullingShadowObjects(rS,rQ,rj,rl,rM)}}},rS.cullingShadowObjectsOnePSSM=function(rS,rQ,re,rl,rM,rd){var rT,rU=rQ[0],ri=0,rR=0,ro=0;for(ri=0,rT=this._objects.length;ri<rT;ri++){var rY=this._objects[ri];if(rY.castShadow&&rb.isVisible(rY._owner.layer.mask)&&rY.enable){if(rl&&0===rS.containsBoundSphere(rY.boundingSphere))continue;rY._renderUpdate(re);var rp=rY._renderElements;for(rR=0,ro=rp.length;rR<ro;rR++)rU._addRenderElement(rp[rR])}}for(ri=0;ri<8;ri++){var rJ=this._children[ri];if(null!=rJ){var rL=rl;if(rl){var rj=rS.containsBoundBox(rJ._relaxBox);if(0===rj)continue;rL=2===rj}rJ.cullingShadowObjectsOnePSSM(rS,rQ,re,rL,rM,rd)}}},rS.renderBoudingBox=function(rS){this._renderBoudingBox(rS);for(var rQ=0;rQ<8;++rQ){var re=this._children[rQ];re&&re.renderBoudingBox(rS)}},rS.buildAllChild=function(rS){if(rS<this._scene.treeLevel)for(var rQ=0;rQ<8;rQ++){this.addChild(rQ).buildAllChild(rS+1)}},rS._renderBoudingBox=function(rS){},rL(0,rS,"exactBox",function(){return this._exactBox},function(rS){this._exactBox=rS,rTQ.add(rS.min,rS.max,this._boundingBoxCenter),rTQ.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),rL(0,rS,"relaxBox",function(){return this._relaxBox},function(rS){(this._relaxBox=rS).getCorners(this._corners),r_S.createfromPoints(this._corners,this._boundingSphere)}),rT.debugMode=!1,rT.relax=1.15,rT.CHILDNUM=8,rY(rT,["tempVector0",function(){return this.tempVector0=new rTQ},"tempSize",function(){return this.tempSize=new rTQ},"tempCenter",function(){return this.tempCenter=new rTQ},"_octreeSplit",function(){return this._octreeSplit=[new rTQ(.25,.25,.25),new rTQ(.75,.25,.25),new rTQ(.25,.75,.25),new rTQ(.75,.75,.25),new rTQ(.25,.25,.75),new rTQ(.75,.25,.75),new rTQ(.25,.75,.75),new rTQ(.75,.75,.75)]}]),rT}(),rV=(function(){function rS(){}rJ(rS,"laya.d3.core.scene.SceneManager")}(),function(){function rS(rS,rQ,re,rl){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===rS&&(rS=1),void 0===rQ&&(rQ=1),void 0===re&&(re=1),void 0===rl&&(rl=1),this._r=rS,this._g=rQ,this._b=re,this._a=rl}return rJ(rS,"laya.d3.core.trail.module.Color",null,"Color$1"),rS.prototype.cloneTo=function(rS){rS._r=this._r,rS._g=this._g,rS._b=this._b,rS._a=this._a},rY(rS,["RED",function(){return this.RED=new rS(1,0,0,1)},"GREEN",function(){return this.GREEN=new rS(0,1,0,1)},"BLUE",function(){return this.BLUE=new rS(0,0,1,1)},"CYAN",function(){return this.CYAN=new rS(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new rS(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new rS(1,0,1,1)},"GRAY",function(){return this.GRAY=new rS(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new rS(1,1,1,1)},"BLACK",function(){return this.BLACK=new rS(0,0,0,1)}]),rS}()),r_=(function(){function rS(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}rJ(rS,"laya.d3.core.trail.module.Gradient");var rQ=rS.prototype;rQ.setKeys=function(rS,rQ){var re,rl;this._colorKeys=rS;for(var rM=this.index=0;rM<rS.length;rM++){var rd=(re=rS[rM]).color;this._colorKeyData[this.index++]=rd._r,this._colorKeyData[this.index++]=rd._g,this._colorKeyData[this.index++]=rd._b,this._colorKeyData[this.index++]=re.time}this._alphaKeys=rQ;for(var rT=this.index=0;rT<rQ.length;rT++)rl=rQ[rT],this._alphaKeyData[this.index++]=rl.alpha,this._alphaKeyData[this.index++]=rl.time},rQ.cloneTo=function(rS){var rQ=0,re=0,rl=this.colorKeys,rM=[];for(rQ=0,re=rl.length;rQ<re;rQ++){var rd=new rs;rl[rQ].cloneTo(rd),rM.push(rd)}var rT=this.alphaKeys,rU=[];for(rQ=0,re=rT.length;rQ<re;rQ++){var ri=new r_;rT[rQ].cloneTo(ri),rU.push(ri)}rS.setKeys(rM,rU)},rL(0,rQ,"mode",function(){return this._mode},function(rS){this._mode=rS}),rL(0,rQ,"colorKeys",function(){return this._colorKeys},function(rS){this._colorKeys=rS;for(var rQ=this.index=0;rQ<rS.length;rQ++){var re=rS[rQ],rl=re.color;this._colorKeyData[this.index++]=rl._r,this._colorKeyData[this.index++]=rl._g,this._colorKeyData[this.index++]=rl._b,this._colorKeyData[this.index++]=re.time}}),rL(0,rQ,"alphaKeys",function(){return this._alphaKeys},function(rS){this._alphaKeys=rS;for(var rQ=this.index=0;rQ<rS.length;rQ++){var re=rS[rQ];this._alphaKeyData[this.index++]=re.alpha,this._alphaKeyData[this.index++]=re.time}})}(),function(){function rS(rS,rQ){this._alpha=NaN,this._time=NaN,void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),this._alpha=rS,this._time=rQ}rJ(rS,"laya.d3.core.trail.module.GradientAlphaKey");var rQ=rS.prototype;return rQ.cloneTo=function(rS){rS.alpha=this.alpha,rS.time=this.time},rL(0,rQ,"alpha",function(){return this._alpha},function(rS){this._alpha=rS}),rL(0,rQ,"time",function(){return this._time},function(rS){this._time=rS}),rS}()),rs=function(){function rS(rS,rQ){this._color=null,this._time=NaN,void 0===rQ&&(rQ=0),this._color=rS||new rV,this._time=rQ}rJ(rS,"laya.d3.core.trail.module.GradientColorKey");var rQ=rS.prototype;return rQ.cloneTo=function(rS){this.color.cloneTo(rS.color),rS.time=this.time},rL(0,rQ,"color",function(){return this._color},function(rS){this._color=rS}),rL(0,rQ,"time",function(){return this._time},function(rS){this._time=rS}),rS}(),ry=(function(){function rS(){}rJ(rS,"laya.d3.core.trail.module.GradientMode"),rS.Blend=0,rS.Fixed=1}(),function(){function rS(){}rJ(rS,"laya.d3.core.trail.module.TextureMode"),rS.Stretch=0,rS.Tile=1}(),function(){function rS(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}rJ(rS,"laya.d3.core.trail.module.TrailKeyFrame"),rS.prototype.cloneTo=function(rS){rS.time=this.time,rS.inTangent=this.inTangent,rS.outTangent=this.outTangent,rS.value=this.value}}(),function(){function rQ(rS){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new rTQ,this._curPosition=new rTQ,this._delVector3=new rTQ,this._lastFixedVertexPosition=new rTQ,this._pointAtoBVector3=new rTQ,this._pointA=new rTQ,this._pointB=new rTQ,this._owner=rS,this._id=rQ.renderElementCount++,0==this._id?rS._owner.transform.position.cloneTo(this._lastPosition):rS._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new rfQ(ry.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new rfQ(ry.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}rJ(rQ,"laya.d3.core.trail.TrailRenderElement");var rS=rQ.prototype;rD.imps(rS,{"laya.d3.core.render.IRenderable":!0}),rS._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},rS._addTrailByFirstPosition=function(rS,rQ){rTQ.subtract(rQ,rS,this._delVector3),rTQ.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),rTQ.normalize(this._pointAtoBVector3,this._pointAtoBVector3),rTQ.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(rS),rS.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},rS._addTrailByNextPosition=function(rS){rTQ.subtract(rS,this._lastFixedVertexPosition,this._delVector3),rTQ.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),rTQ.normalize(this._pointAtoBVector3,this._pointAtoBVector3),rTQ.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=rTQ.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=rsS.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(rS),rS.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(rS),this._virtualVerticesCount=2)},rS._updateVerticesByPosition=function(rS){this._pointe=rS.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},rS._updateVertexBuffer2=function(){var rS,rQ=0,re=0,rl=0;for(rl=0,rS=(this._verticesCount+this._virtualVerticesCount)/2;rl<rS;rl++)re=0==this._owner.textureMode?(this._VerticesToTailLength[rl]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[rl],this._vertices2[rQ++]=1-re,this._vertices2[rQ++]=1-re;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},rS._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},rS._updateDisappear=function(){var rS,rQ=0;for(rQ=this._curDisappearIndex,rS=(this._verticesCount+this._virtualVerticesCount)/2;rQ<rS;rQ++)this._owner._curtime-this._everyGroupVertexBirthTime[rQ]>=this._owner.time+rsS.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},rS._beforeRender=function(rS){return this._camera=rS.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),rTQ.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},rS._render=function(rS){this._isDead||(rk.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),rH.drawCall++,rH.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},rS._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),0===rS?this._vertexBuffer1:1===rS?this._vertexBuffer2:null},rS._getVertexBuffers=function(){return this._vertexBuffers},rS._getIndexBuffer=function(){return null},rS.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},rS._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},rL(0,rS,"_vertexBufferCount",function(){return this._vertexBuffers.length}),rL(0,rS,"triangleCount",function(){return 0}),rQ.renderElementCount=0}(),function(){function rS(){}rJ(rS,"laya.d3.core.trail.VertexTrail");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration1}),rL(1,rS,"vertexDeclaration1",function(){return rS._vertexDeclaration1}),rL(1,rS,"vertexDeclaration2",function(){return rS._vertexDeclaration2}),rY(rS,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new rdS(32,[new rTS(0,"vector3",0),new rTS(12,"vector3",41),new rTS(24,"single",33),new rTS(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new rdS(4,[new rTS(0,"single",38)])}]),rS}()),rSS=function(){function rv(rS){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=rS}rJ(rv,"laya.d3.graphics.DynamicBatch");var rS=rv.prototype;return rD.imps(rS,{"laya.d3.core.render.IRenderable":!0}),rS._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),0===rS?this._vertexBuffer:null},rS._getIndexBuffer=function(){return this._indexBuffer},rS._getCombineRenderElementFromPool=function(rS,rQ,re){var rl=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return rl||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=rl=new rZ,rl._sprite3D=new rNQ),rl._sprite3D._render._renderUpdate(re),rl},rS._getRenderElement=function(rS,rQ,re){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*rv.maxVertexCount),this._indexDatas=new Uint16Array(rv.maxIndexCount),this._vertexBuffer=rfQ.create(this._vertexDeclaration,rv.maxVertexCount,35048),this._indexBuffer=raQ.create("ushort",rv.maxIndexCount,35048));for(var rl=this._merageElements.length=0,rM=0,rd=0,rT=this._combineRenderElements.length;rd<rT;rd++){var rU=this._combineRenderElements[rd],ri=rU.getDynamicBatchBakedVertexs(0),rR=rU.getBakedIndices(),ro=rU._sprite3D.transform._isFrontFaceInvert,rY=rl/(this._vertexDeclaration.vertexStride/4),rp=rM,rJ=rp+rR.length;rU._tempBatchIndexStart=rp,rU._tempBatchIndexEnd=rJ,this._indexDatas.set(rR,rM);var rL=0;if(ro)for(rL=rp;rL<rJ;rL+=3){this._indexDatas[rL]=rY+this._indexDatas[rL];var rj=this._indexDatas[rL+1],rc=this._indexDatas[rL+2];this._indexDatas[rL+1]=rY+rc,this._indexDatas[rL+2]=rY+rj}else for(rL=rp;rL<rJ;rL+=3)this._indexDatas[rL]=rY+this._indexDatas[rL],this._indexDatas[rL+1]=rY+this._indexDatas[rL+1],this._indexDatas[rL+2]=rY+this._indexDatas[rL+2];rM+=rR.length,this._vertexDatas.set(ri,rl),rl+=ri.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),rd=this._combineRenderElementPoolIndex=0,rT=this._materials.length;rd<rT;rd++){var rG=this._getCombineRenderElementFromPool(rS,rQ,re);rG._type=2,rG._staticBatch=null;var rz=(rG.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[rd]]._tempBatchIndexStart,rA=rd+1===this._materialToRenderElementsOffsets.length?rM:this._combineRenderElements[this._materialToRenderElementsOffsets[rd+1]]._tempBatchIndexStart;rG._tempBatchIndexStart=rz,rG._tempBatchIndexEnd=rA,rG._material=this._materials[rd],this._merageElements.push(rG)}},rS._addCombineRenderObjTest=function(rS){var rQ=rS.renderObj,re=this._currentCombineIndexCount+rQ._getIndexBuffer().indexCount,rl=this._currentCombineVertexCount+rQ._getVertexBuffer().vertexCount;return!(rv.maxVertexCount<rl||rv.maxIndexCount<re)},rS._addCombineRenderObj=function(rS){var rQ=rS.renderObj;this._combineRenderElements.push(rS),this._currentCombineIndexCount=this._currentCombineIndexCount+rQ._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+rQ._getVertexBuffer().vertexCount},rS._addCombineMaterial=function(rS){this._materials.push(rS)},rS._addMaterialToRenderElementOffset=function(rS){this._materialToRenderElementsOffsets.push(rS)},rS._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},rS._addToRenderQueue=function(rS,rQ,re,rl){this._getRenderElement(rQ,re,rl);for(var rM=0,rd=this._materials.length;rM<rd;rM++)rS.getRenderQueue(this._materials[rM].renderQueue)._addDynamicBatchElement(this._merageElements[rM])},rS._beforeRender=function(rS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},rS._render=function(rS){var rQ=rS._batchIndexEnd-rS._batchIndexStart;rk.mainContext.drawElements(4,rQ,5123,2*rS._batchIndexStart),rH.drawCall++,rH.trianglesFaces+=rQ/3},rS._getVertexBuffers=function(){return null},rL(0,rS,"_vertexBufferCount",function(){return 1}),rL(0,rS,"triangleCount",function(){return this._indexBuffer.indexCount/3}),rL(0,rS,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),rv.maxVertexCount=2e4,rv.maxIndexCount=4e4,rv.maxCombineTriangleCount=10,rv}(),rQS=function(){function rv(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}rJ(rv,"laya.d3.graphics.DynamicBatchManager");var rS=rv.prototype;return rS.getDynamicBatch=function(rS,rQ){var re,rl=rS.id.toString()+rQ;return this._dynamicBatches[rl]?re=this._dynamicBatches[rl]:this._dynamicBatches[rl]=re=new rSS(rS),re},rS._garbageCollection=function(){for(var rS in this._dynamicBatches)0===this._dynamicBatches[rS].combineRenderElementsCount&&delete this._dynamicBatches[rS]},rS._addPrepareRenderElement=function(rS){this._prepareDynamicBatchCombineElements.push(rS)},rS._finishCombineDynamicBatch=function(rS){var rQ,re,rl;this._prepareDynamicBatchCombineElements.sort(rv._sortPrepareDynamicBatch);for(var rM,rd,rT,rU,ri,rR=-1,ro=!0,rY=0,rp=-1,rJ=0,rL=this._prepareDynamicBatchCombineElements.length;rJ<rL;rJ++){var rj=(rd=this._prepareDynamicBatchCombineElements[rJ]).renderObj._getVertexBuffer(0).vertexDeclaration,rc=re!==rj;rc&&(rY=0,re=rj);var rG=rY!==rR;if(rG&&(rR=rY),(rc||rG)&&(rT=this.getDynamicBatch(rj,rY),rQ=null),ro)if(rT._addCombineRenderObjTest(rd)){if(rQ!==(rM=rd._material))rU&&(rS.getRenderQueue(ri._material.renderQueue)._addRenderElement(ri),ri=rU=null,rp=-1),rU=rM,rp=rT.combineRenderElementsCount,ri=rd,rQ=rM;else if(rU){var rz=ri.renderObj,rA=rd.renderObj;rz._getVertexBuffer().vertexCount+rA._getVertexBuffer().vertexCount>rSS.maxVertexCount||rz._getIndexBuffer().indexCount+rA._getIndexBuffer().indexCount>rSS.maxIndexCount?(rS.getRenderQueue(ri._material.renderQueue)._addRenderElement(ri),rU=rM,rp=rT.combineRenderElementsCount,ri=rd):(rT._addCombineMaterial(rU),rT._addMaterialToRenderElementOffset(rp),rT._addCombineRenderObj(ri),ri=rU=null,rp=-1,rT._addCombineRenderObj(rd))}else rT._addCombineRenderObj(rd);ro=!0}else rU&&(rS.getRenderQueue(ri._material.renderQueue)._addRenderElement(ri),ri=rU=null,rp=-1),rY++,ro=!1;else rl=this._prepareDynamicBatchCombineElements[rJ-1],rT._addMaterialToRenderElementOffset(rT.combineRenderElementsCount),rQ=rl._material,rT._addCombineMaterial(rQ),rT._addCombineRenderObj(rl),ro=!0,rQ!==(rM=rd._material)?(rU=rM,rp=rT.combineRenderElementsCount,ri=rd):rT._addCombineRenderObj(rd),rQ=rM}rU&&(rS.getRenderQueue(ri._material.renderQueue)._addRenderElement(ri),ri=rU=null,rp=-1),this._prepareDynamicBatchCombineElements.length=0},rS._clearRenderElements=function(){for(var rS in this._dynamicBatches)this._dynamicBatches[rS]._clearRenderElements()},rS._addToRenderQueue=function(rS,rQ,re,rl){for(var rM in this._dynamicBatches){var rd=this._dynamicBatches[rM];0<rd.combineRenderElementsCount&&rd._addToRenderQueue(rS,rQ,re,rl)}},rS.dispose=function(){this._dynamicBatches=null},rv._sortPrepareDynamicBatch=function(rS,rQ){return rS._mainSortID-rQ._mainSortID},rv}(),reS=function(){function rS(){}return rJ(rS,"laya.d3.graphics.FrustumCulling"),rS.renderShadowObjectCulling=function(rS,rQ,re,rl,rM){var rd=0,rT=0,rU=0,ri=0;for(rd=0,rU=re.length;rd<rU;rd++){var rR=re[rd];rR&&rR._clearRenderElements()}var ro,rY,rp,rJ=rS._cullingRenders;if(1<rM){for(rd=0,rU=rS._cullingRendersLength;rd<rU;rd++)if((ro=rJ[rd]).castShadow&&rb.isVisible(ro._owner.layer.mask)&&ro.enable)for(var rL=1,rj=rQ.length;rL<rj;rL++)if(rY=re[rL-1],0!==rQ[rL].containsBoundSphere(ro.boundingSphere))for(rT=0,ri=(rp=ro._renderElements).length;rT<ri;rT++)rY._addRenderElement(rp[rT])}else for(rd=0,rU=rS._cullingRendersLength;rd<rU;rd++)if((ro=rJ[rd]).castShadow&&rb.isVisible(ro._owner.layer.mask)&&ro.enable&&0!==rQ[0].containsBoundSphere(ro.boundingSphere))for(ro._renderUpdate(rl),rY=re[0],rT=0,ri=(rp=ro._renderElements).length;rT<ri;rT++)rY._addRenderElement(rp[rT])},rS.renderShadowObjectCullingOctree=function(rS,rQ,re,rl,rM){for(var rd=0,rT=re.length;rd<rT;rd++){var rU=re[rd];rU&&rU._clearRenderElements()}1<rM?rS.treeRoot.cullingShadowObjects(rQ,re,!0,0,rS):rS.treeRoot.cullingShadowObjectsOnePSSM(rQ[0],re,rl,!0,0,rS)},rS.renderObjectCulling=function(rS,rQ,re,rl,rM,rd){var rT=0,rU=0,ri=0,rR=0,ro=rQ._quenes,rY=rQ._dynamicBatchManager,rp=rQ._cullingRenders;for(rT=0,rU=ro.length;rT<rU;rT++){var rJ=ro[rT];rJ&&rJ._clearRenderElements()}var rL=rlS._staticBatchManagers;for(rT=0,rU=rL.length;rT<rU;rT++)rL[rT]._clearRenderElements();rY._clearRenderElements();var rj=re.transform.position;for(rT=0,rU=rQ._cullingRendersLength;rT<rU;rT++){var rc=rp[rT];if(rb.isVisible(rc._owner.layer.mask)&&rc.enable&&0!==rS.containsBoundSphere(rc.boundingSphere)&&rc._renderUpdate(rd)){rc._distanceForSort=rTQ.distance(rc.boundingSphere.center,rj)+rc.sortingFudge;var rG=rc._renderElements;for(ri=0,rR=rG.length;ri<rR;ri++){var rz=rG[ri],rA=rz._staticBatch;if(rA&&rA._material===rz._material)rA._addBatchRenderElement(rz);else{var rv=rz.renderObj;rv.triangleCount<10&&1===rv._vertexBufferCount&&rv._getIndexBuffer()&&rz._material.renderQueue<2&&rz._canDynamicBatch&&!rc._owner.isStatic?rY._addPrepareRenderElement(rz):rQ.getRenderQueue(rz._material.renderQueue)._addRenderElement(rz)}}}}for(rT=0,rU=rL.length;rT<rU;rT++)rL[rT]._addToRenderQueue(rQ,rl,rM,rd);rY._finishCombineDynamicBatch(rQ),rY._addToRenderQueue(rQ,rl,rM,rd)},rS.renderObjectCullingOctree=function(rS,rQ,re,rl,rM,rd){var rT=0,rU=0,ri=rQ._quenes,rR=rQ._dynamicBatchManager;for(rT=0,rU=ri.length;rT<rU;rT++){var ro=ri[rT];ro&&ro._clearRenderElements()}var rY=rlS._staticBatchManagers;for(rT=0,rU=rY.length;rT<rU;rT++)rY[rT]._clearRenderElements();for(rR._clearRenderElements(),rQ._cullingRenders.length=0,rQ.treeRoot.cullingObjects(rS,!0,0,re.transform.position,rd),rT=0,rU=rY.length;rT<rU;rT++)rY[rT]._addToRenderQueue(rQ,rl,rM,rd);rR._finishCombineDynamicBatch(rQ),rR._addToRenderQueue(rQ,rl,rM,rd)},rS.renderObjectCullingNoBoundFrustum=function(rS,rQ,re,rl,rM){var rd=0,rT=0,rU=0,ri=0,rR=rS._quenes,ro=rS._dynamicBatchManager,rY=rS._cullingRenders;for(rd=0,rT=rR.length;rd<rT;rd++){var rp=rR[rd];rp&&rp._clearRenderElements()}var rJ=rlS._staticBatchManagers;for(rd=0,rT=rJ.length;rd<rT;rd++)rJ[rd]._clearRenderElements();ro._clearRenderElements();var rL=rQ.transform.position;for(rd=0,rT=rS._cullingRendersLength;rd<rT;rd++){var rj=rY[rd];if(rb.isVisible(rj._owner.layer.mask)&&rj.enable){rj._renderUpdate(rM),rj._distanceForSort=rTQ.distance(rj.boundingSphere.center,rL)+rj.sortingFudge;var rc=rj._renderElements;for(rU=0,ri=rc.length;rU<ri;rU++){var rG=rc[rU],rz=rG._staticBatch;if(rz&&rz._material===rG._material)rz._addBatchRenderElement(rG);else{var rA=rG.renderObj;rA.triangleCount<10&&1===rA._vertexBufferCount&&rA._getIndexBuffer()&&rG._material.renderQueue<2&&rG._canDynamicBatch&&!rj._owner.isStatic?ro._addPrepareRenderElement(rG):rS.getRenderQueue(rG._material.renderQueue)._addRenderElement(rG)}}}}for(rd=0,rT=rJ.length;rd<rT;rd++)rJ[rd]._addToRenderQueue(rS,re,rl,rM);ro._finishCombineDynamicBatch(rS),ro._addToRenderQueue(rS,re,rl,rM)},rS}(),rlS=function(){function rd(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}rJ(rd,"laya.d3.graphics.StaticBatchManager");var rS=rd.prototype;return rS._finishInit=function(){for(var rS in this._staticBatches)this._staticBatches[rS]._finishInit();this._initBatchRenderElements.length=0},rS._initStaticBatchs=function(rS){throw new Error("StaticBatchManager:must override this function.")},rS._addInitBatchSprite=function(rS){for(var rQ=rS._render._renderElements,re=0,rl=rQ.length;re<rl;re++)this._initBatchRenderElements.push(rQ[re])},rS._clearRenderElements=function(){for(var rS in this._staticBatches)this._staticBatches[rS]._clearRenderElements()},rS._garbageCollection=function(rS){var rQ=rS._staticBatch,re=rQ._initBatchRenderElements,rl=re.indexOf(rS);re.splice(rl,1),0===re.length&&(rQ.dispose(),delete this._staticBatches[rQ._key])},rS._addToRenderQueue=function(rS,rQ,re,rl){for(var rM in this._staticBatches){var rd=this._staticBatches[rM];0<rd._batchRenderElements.length&&rd._updateToRenderQueue(rS,rl)}},rS.dispose=function(){this._staticBatches=null},rd._addToStaticBatchQueue=function(rS){rS instanceof laya.d3.core.RenderableSprite3D&&rS._addToInitStaticBatchManager();for(var rQ=0,re=rS.numChildren;rQ<re;rQ++)rd._addToStaticBatchQueue(rS._childs[rQ])},rd.combine=function(rS,rQ){var re,rl=0,rM=0;if(rQ)for(rl=0,rM=rQ.length;rl<rM;rl++){rQ[rl]._addToInitStaticBatchManager()}else rS&&rd._addToStaticBatchQueue(rS);for(rl=0,rM=rd._staticBatchManagers.length;rl<rM;rl++)(re=rd._staticBatchManagers[rl])._initStaticBatchs(rS),re._finishInit()},rd._staticBatchManagers=[],rd}(),rMS=function(){function rS(rS,rQ,re){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=rS,this._manager=rQ,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=re}rJ(rS,"laya.d3.graphics.StaticBatch");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),rQ._binarySearch=function(rS){for(var rQ=0,re=this._batchRenderElements.length-1,rl=0;rQ<=re;)rl=Math.floor((rQ+re)/2),this._compareBatchRenderElement(this._batchRenderElements[rl],rS)?re=rl-1:rQ=rl+1;return rQ},rQ._compareBatchRenderElement=function(rS,rQ){throw new Error("StaticBatch:must override this function.")},rQ._getVertexDecLightMap=function(rS){return rS===raS.vertexDeclaration?rbS.vertexDeclaration:rS===rPS.vertexDeclaration?rhS.vertexDeclaration:rS===rgS.vertexDeclaration?rvS.vertexDeclaration:rS===rrS.vertexDeclaration?null:rS===rjS.vertexDeclaration?rcS.vertexDeclaration:rS===rwS.vertexDeclaration?r$S.vertexDeclaration:rS===rkS.vertexDeclaration?rXS.vertexDeclaration:rS===rfS.vertexDeclaration?rmS.vertexDeclaration:rS===rPS.vertexDeclaration?rhS.vertexDeclaration:rS===rIS.vertexDeclaration?rDS.vertexDeclaration:rS===rrS.vertexDeclaration?null:rS===rjS.vertexDeclaration?rcS.vertexDeclaration:rS===ruS.vertexDeclaration?rnS.vertexDeclaration:rS===rkS.vertexDeclaration?rXS.vertexDeclaration:rS},rQ._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},rQ._addBatchRenderElement=function(rS){this._batchRenderElements.splice(this._binarySearch(rS),0,rS)},rQ._updateToRenderQueue=function(rS,rQ){this._combineRenderElementPoolIndex=0,this._getRenderElement(rS.getRenderQueue(this._material.renderQueue)._renderElements,rS,rQ)},rQ._getRenderElement=function(rS,rQ,re){throw new Error("StaticBatch:must override this function.")},rQ._finishInit=function(){throw new Error("StaticBatch:must override this function.")},rQ._clearRenderElements=function(){this._batchRenderElements.length=0},rQ.dispose=function(){},rQ._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),null},rQ._getIndexBuffer=function(){return null},rQ._beforeRender=function(rS){return!0},rQ._render=function(rS){},rQ._getVertexBuffers=function(){return null},rL(0,rQ,"_vertexBufferCount",function(){return 1}),rL(0,rQ,"triangleCount",function(){return 0}),rS.combine=function(rS){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),rlS.combine(rS)},rS.maxBatchVertexCount=65535,rS}(),rdS=function(){function rT(rS,rQ){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++rT._uniqueIDCounter,this._id>rT.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",rT.maxVertexDeclaration);this._shaderValues=new rpQ,this._vertexElementsDic={},this._vertexStride=rS,this._vertexElements=rQ;for(var re=0;re<rQ.length;re++){var rl=rQ[re],rM=rl.elementUsage;this._vertexElementsDic[rM]=rl;var rd=[rT._getTypeSize(rl.elementFormat)/4,5126,!1,this._vertexStride,rl.offset];switch(this._shaderValues.setValue(rM,rd),rM){case 1:this._addShaderDefine(rHQ.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(rHQ.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(rHQ.SHADERDEFINE_UV1)}}}rJ(rT,"laya.d3.graphics.VertexDeclaration");var rS=rT.prototype;return rS._addShaderDefine=function(rS){this._shaderDefineValue|=rS},rS._removeShaderDefine=function(rS){this._shaderDefineValue&=~rS},rS.getVertexElements=function(){return this._vertexElements.slice()},rS.getVertexElementByUsage=function(rS){return this._vertexElementsDic[rS]},rS.unBinding=function(){},rL(0,rS,"shaderDefineValue",function(){return this._shaderDefineValue}),rL(0,rS,"id",function(){return this._id}),rL(0,rS,"vertexStride",function(){return this._vertexStride}),rL(0,rS,"shaderValues",function(){return this._shaderValues}),rT._getTypeSize=function(rS){switch(rS){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},rT.getVertexStride=function(rS){for(var rQ=0,re=0;re<rS.Length;re++){var rl=rS[re],rM=rl.offset+rT._getTypeSize(rl.elementFormat);rQ<rM&&(rQ=rM)}return rQ},rT._maxVertexDeclarationBit=1e3,rT._uniqueIDCounter=1,rY(rT,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),rT}(),rTS=function(){function rS(rS,rQ,re){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=rS,this.elementFormat=rQ,this.elementUsage=re}return rJ(rS,"laya.d3.graphics.VertexElement"),rS}(),rUS=(function(){function rS(){}rJ(rS,"laya.d3.graphics.VertexElementFormat"),rS.Single="single",rS.Vector2="vector2",rS.Vector3="vector3",rS.Vector4="vector4",rS.Color="color",rS.Byte4="byte4",rS.Short2="short2",rS.Short4="short4",rS.NormalizedShort2="normalizedshort2",rS.NormalizedShort4="normalizedshort4",rS.HalfVector2="halfvector2",rS.HalfVector4="halfvector4"}(),function(){function rS(){}rJ(rS,"laya.d3.graphics.VertexElementUsage"),rS.POSITION0=0,rS.COLOR0=1,rS.TEXTURECOORDINATE0=2,rS.NORMAL0=3,rS.BINORMAL0=4,rS.TANGENT0=5,rS.BLENDINDICES0=6,rS.BLENDWEIGHT0=7,rS.DEPTH0=8,rS.FOG0=9,rS.POINTSIZE0=10,rS.SAMPLE0=11,rS.TESSELLATEFACTOR0=12,rS.COLOR1=13,rS.NEXTTEXTURECOORDINATE0=14,rS.TEXTURECOORDINATE1=15,rS.NEXTTEXTURECOORDINATE1=16,rS.CORNERTEXTURECOORDINATE0=17,rS.VELOCITY0=18,rS.STARTCOLOR0=19,rS.STARTSIZE=20,rS.AGEADDSCALE0=21,rS.STARTROTATION=22,rS.ENDCOLOR0=23,rS.STARTLIFETIME=24,rS.TIME0=33,rS.SHAPEPOSITIONSTARTLIFETIME=30,rS.DIRECTIONTIME=32,rS.SIZEROTATION0=27,rS.RADIUS0=28,rS.RADIAN0=29,rS.STARTSPEED=31,rS.RANDOM0=34,rS.RANDOM1=35,rS.SIMULATIONWORLDPOSTION=36,rS.SIMULATIONWORLDROTATION=37,rS.TEXTURECOORDINATE0X=38,rS.TEXTURECOORDINATE0X1=39,rS.TEXTURECOORDINATE0Y=40,rS.OFFSETVECTOR=41}(),function(){function rS(rS,rQ,re){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=rS,this._textureCoordinate0=rQ,this._time=re}rJ(rS,"laya.d3.graphics.VertexGlitter");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate0}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"time",function(){return this._time}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(24,[new rTS(0,"vector3",0),new rTS(12,"vector2",2),new rTS(20,"single",33)])}])}(),function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=rS,this._position=rQ,this._velocity=re,this._startColor=rl,this._endColor=rM,this._sizeRotation=rd,this._radius=rT,this._radian=rU,this._ageAddScale=ri,this._time=rR}rJ(rS,"laya.d3.graphics.VertexParticle");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"endColor",function(){return this._endColor}),rL(0,rQ,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),rL(0,rQ,"sizeRotation",function(){return this._sizeRotation}),rL(0,rQ,"velocity",function(){return this._velocity}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"startColor",function(){return this._startColor}),rL(0,rQ,"radius",function(){return this._radius}),rL(0,rQ,"radian",function(){return this._radian}),rL(0,rQ,"ageAddScale",function(){return this._ageAddScale}),rL(0,rQ,"time",function(){return this._time}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(116,[new rTS(0,"vector4",17),new rTS(16,"vector3",0),new rTS(28,"vector3",18),new rTS(40,"vector4",19),new rTS(56,"vector4",23),new rTS(72,"vector3",27),new rTS(84,"vector2",28),new rTS(92,"vector4",29),new rTS(108,"single",24),new rTS(112,"single",33)])}])}(),function(){function rS(rS){this._position=null,this._position=rS}rJ(rS,"laya.d3.graphics.VertexPosition");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(12,[new rTS(0,"vector3",0)])}]),rS}()),riS=function(){function rS(rS,rQ){this._position=null,this._normal=null,this._position=rS,this._normal=rQ}rJ(rS,"laya.d3.graphics.VertexPositionNormal");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(24,[new rTS(0,"vector3",0),new rTS(12,"vector3",3)])}]),rS}(),rRS=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._color=null,this._position=rS,this._normal=rQ,this._color=re}rJ(rS,"laya.d3.graphics.VertexPositionNormalColor");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(40,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1)])}]),rS}(),roS=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=rS,this._normal=rQ,this._color=re,this._blendIndex=rl,this._blendWeight=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorSkin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(72,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector4",7),new rTS(56,"vector4",6)])}]),rS}(),rYS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._tangent=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(88,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector4",7),new rTS(56,"vector4",6),new rTS(72,"vector4",5)])}]),rS}(),rpS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._tangent=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(84,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector4",7),new rTS(56,"vector4",6),new rTS(72,"vector3",5)])}]),rS}(),rJS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._tangent=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(56,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector4",5)])}]),rS}(),rLS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._tangent=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(52,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector3",5)])}]),rS}(),rjS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(48,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2)])}]),rS}(),rcS=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(56,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15)])}]),rS}(),rGS=function(){function rS(rS,rQ,re,rl,rM,rd,rT){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._blendIndex=rd,this._blendWeight=rT}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(88,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15),new rTS(56,"vector4",7),new rTS(72,"vector4",6)])}]),rS}(),rzS=function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._tangent=rd,this._blendIndex=rT,this._blendWeight=rU}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(104,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15),new rTS(56,"vector4",7),new rTS(72,"vector4",6),new rTS(88,"vector4",5)])}]),rS}(),rAS=function(){function rS(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rQ.VertexPositionNormalColorTexture0SkinTangent=function(rS,rQ,re,rl,rM,rd,rT,rU){this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._tangent=rd,this._blendIndex=rT,this._blendWeight=rU},rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(100,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15),new rTS(56,"vector4",7),new rTS(72,"vector4",6),new rTS(88,"vector3",5)])}]),rS}(),rvS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._tangent=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(72,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15),new rTS(56,"vector4",5)])}]),rS}(),rDS=function(){function rS(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rQ.VertexPositionNormalColorTexture0Tangent=function(rS,rQ,re,rl,rM,rd){this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._tangent=rd},rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(68,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector2",15),new rTS(56,"vector3",5)])}]),rS}(),rBS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(80,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector4",7),new rTS(64,"vector4",6)])}]),rS}(),rOS=function(){function rS(rS,rQ,re,rl,rM,rd,rT){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl,this._tangent=rM,this._blendIndex=rd,this._blendWeight=rT}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(96,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector4",7),new rTS(64,"vector4",6),new rTS(80,"vector4",5)])}]),rS}(),rHS=function(){function rS(rS,rQ,re,rl,rM,rd,rT){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl,this._tangent=rM,this._blendIndex=rd,this._blendWeight=rT}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(92,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector4",7),new rTS(64,"vector4",6),new rTS(80,"vector3",5)])}]),rS}(),rgS=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl,this._tangent=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(64,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector4",5)])}]),rS}(),rIS=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=rS,this._normal=rQ,this._color=re,this._textureCoordinate=rl,this._tangent=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"color",function(){return this._color}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(60,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",1),new rTS(40,"vector2",2),new rTS(48,"vector3",5)])}]),rS}(),rES=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._tangent=null,this._position=rS,this._normal=rQ,this._tangent=re}rJ(rS,"laya.d3.graphics.VertexPositionNormalSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(40,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector4",5)])}]),rS}(),rtS=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._tangent=null,this._position=rS,this._normal=rQ,this._tangent=re}rJ(rS,"laya.d3.graphics.VertexPositionNormalTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(36,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector3",5)])}]),rS}(),rkS=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(32,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2)])}]),rS}(),rXS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(40,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15)])}]),rS}(),rhS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(72,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15),new rTS(40,"vector4",7),new rTS(56,"vector4",6)])}]),rS}(),rbS=function(){function rS(rS,rQ,re,rl,rM,rd,rT){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl,this._tangent=rM,this._blendIndex=rd,this._blendWeight=rT}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(88,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15),new rTS(40,"vector4",7),new rTS(56,"vector4",6),new rTS(72,"vector4",5)])}]),rS}(),rmS=function(){function rS(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rQ.VertexPositionNormalTexture0SkinTangent=function(rS,rQ,re,rl,rM,rd,rT){this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl,this._tangent=rM,this._blendIndex=rd,this._blendWeight=rT},rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(84,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15),new rTS(40,"vector4",7),new rTS(56,"vector4",6),new rTS(72,"vector3",5)])}]),rS}(),r$S=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl,this._tangent=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(56,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15),new rTS(40,"vector4",5)])}]),rS}(),rnS=function(){function rS(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}rJ(rS,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rQ.VertexPositionNormalTexture0Tangent=function(rS,rQ,re,rl,rM){this._position=rS,this._normal=rQ,this._textureCoordinate0=re,this._textureCoordinate1=rl,this._tangent=rM},rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(52,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15),new rTS(40,"vector3",5)])}]),rS}(),rPS=function(){function rS(rS,rQ,re,rl,rM){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re,this._blendIndex=rl,this._blendWeight=rM}rJ(rS,"laya.d3.graphics.VertexPositionNormalTextureSkin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(64,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector4",7),new rTS(48,"vector4",6)])}]),rS}(),raS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re,this._tangent=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(80,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector4",7),new rTS(48,"vector4",6),new rTS(64,"vector4",5)])}]),rS}(),rfS=function(){function rS(rS,rQ,re,rl,rM,rd){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re,this._tangent=rl,this._blendIndex=rM,this._blendWeight=rd}rJ(rS,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(76,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector4",7),new rTS(48,"vector4",6),new rTS(64,"vector3",5)])}]),rS}(),rwS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re,this._tangent=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(48,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector4",5)])}]),rS}(),ruS=function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re,this._tangent=rl}rJ(rS,"laya.d3.graphics.VertexPositionNormalTextureTangent");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(44,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector3",5)])}]),rS}(),rrS=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re}rJ(rS,"laya.d3.graphics.VertexPositionNTBTexture");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(56,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector3",5),new rTS(36,"vector3",4),new rTS(48,"vector2",2)])}]),rS}(),rWS=function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=rS,this._normal=rQ,this._textureCoordinate0=rl,this._textureCoordinate1=rM,this._tangent=rd,re=re,this._blendIndex=rT,this._blendWeight=rU}rJ(rS,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"tangent",function(){return this._tangent}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(0,rQ,"textureCoordinate1",function(){return this._textureCoordinate1}),rL(0,rQ,"blendIndex",function(){return this._blendIndex}),rL(0,rQ,"blendWeight",function(){return this._blendWeight}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(96,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector3",5),new rTS(36,"vector3",4),new rTS(48,"vector2",2),new rTS(56,"vector2",15),new rTS(64,"vector4",7),new rTS(80,"vector4",6)])}]),rS}(),rxS=function(){function rS(rS,rQ,re){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=rS,this._normal=rQ,this._textureCoordinate=re}rJ(rS,"laya.d3.graphics.VertexPositionNTBTextureSkin");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"textureCoordinate",function(){return this._textureCoordinate}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(88,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector3",5),new rTS(36,"vector3",4),new rTS(48,"vector2",2),new rTS(56,"vector4",7),new rTS(72,"vector4",6)])}]),rS}(),rFS=(function(){function rS(rS,rQ,re,rl){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=rS,this._normal=rQ,this._textureCoord0=re,this._textureCoord1=rl}rJ(rS,"laya.d3.graphics.VertexPositionTerrain");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"normal",function(){return this._normal}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoord0",function(){return this._textureCoord0}),rL(0,rQ,"textureCoord1",function(){return this._textureCoord1}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(40,[new rTS(0,"vector3",0),new rTS(12,"vector3",3),new rTS(24,"vector2",2),new rTS(32,"vector2",15)])}])}(),function(){function rS(rS,rQ){this._position=null,this._textureCoordinate0=null,this._position=rS,this._textureCoordinate0=rQ}rJ(rS,"laya.d3.graphics.VertexPositionTexture0");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"position",function(){return this._position}),rL(0,rQ,"textureCoordinate0",function(){return this._textureCoordinate0}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(20,[new rTS(0,"vector3",0),new rTS(12,"vector2",2)])}]),rS}()),rqS=(function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY,rp,rJ){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=rS,this._positionStartLifeTime=rQ,this._velocity=re,this._startColor=rl,this._startSize=rM,this._startRotation0=rd,this._startRotation1=rT,this._startRotation2=rU,this._startLifeTime=ri,this._time=rR,this._startSpeed=ro,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=rJ}rJ(rS,"laya.d3.graphics.VertexShurikenParticleBillboard");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),rL(0,rQ,"random1",function(){return this._randoms1}),rL(0,rQ,"startRotation2",function(){return this._startRotation2}),rL(0,rQ,"positionStartLifeTime",function(){return this._positionStartLifeTime}),rL(0,rQ,"velocity",function(){return this._velocity}),rL(0,rQ,"random0",function(){return this._randoms0}),rL(0,rQ,"startSize",function(){return this._startSize}),rL(0,rQ,"startColor",function(){return this._startColor}),rL(0,rQ,"startRotation0",function(){return this._startRotation0}),rL(0,rQ,"startRotation1",function(){return this._startRotation1}),rL(0,rQ,"startLifeTime",function(){return this._startLifeTime}),rL(0,rQ,"time",function(){return this._time}),rL(0,rQ,"startSpeed",function(){return this._startSpeed}),rL(0,rQ,"simulationWorldPostion",function(){return this._simulationWorldPostion}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(152,[new rTS(0,"vector4",17),new rTS(16,"vector4",30),new rTS(32,"vector4",32),new rTS(48,"vector4",19),new rTS(64,"vector3",20),new rTS(76,"vector3",22),new rTS(88,"single",31),new rTS(92,"vector4",34),new rTS(108,"vector4",35),new rTS(124,"vector3",36),new rTS(136,"vector4",37)])}])}(),function(){function rS(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY,rp,rJ){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=rS,this._positionStartLifeTime=rQ,this._velocity=re,this._startColor=rl,this._startSize=rM,this._startRotation0=rd,this._startRotation1=rT,this._startRotation2=rU,this._startLifeTime=ri,this._time=rR,this._startSpeed=ro,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=rJ}rJ(rS,"laya.d3.graphics.VertexShurikenParticleMesh");var rQ=rS.prototype;rD.imps(rQ,{"laya.d3.graphics.IVertex":!0}),rL(0,rQ,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),rL(0,rQ,"velocity",function(){return this._velocity}),rL(0,rQ,"position",function(){return this._positionStartLifeTime}),rL(0,rQ,"random0",function(){return this._randoms0}),rL(0,rQ,"startSize",function(){return this._startSize}),rL(0,rQ,"startColor",function(){return this._startColor}),rL(0,rQ,"startRotation0",function(){return this._startRotation0}),rL(0,rQ,"startRotation1",function(){return this._startRotation1}),rL(0,rQ,"random1",function(){return this._randoms1}),rL(0,rQ,"startRotation2",function(){return this._startRotation2}),rL(0,rQ,"startLifeTime",function(){return this._startLifeTime}),rL(0,rQ,"time",function(){return this._time}),rL(0,rQ,"startSpeed",function(){return this._startSpeed}),rL(0,rQ,"simulationWorldPostion",function(){return this._simulationWorldPostion}),rL(0,rQ,"vertexDeclaration",function(){return rS._vertexDeclaration}),rL(1,rS,"vertexDeclaration",function(){return rS._vertexDeclaration}),rY(rS,["_vertexDeclaration",function(){return this._vertexDeclaration=new rdS(172,[new rTS(0,"vector3",0),new rTS(12,"vector4",1),new rTS(28,"vector2",2),new rTS(36,"vector4",30),new rTS(52,"vector4",32),new rTS(68,"vector4",19),new rTS(84,"vector3",20),new rTS(96,"vector3",22),new rTS(108,"single",31),new rTS(112,"vector4",34),new rTS(128,"vector4",35),new rTS(144,"vector3",36),new rTS(156,"vector4",37)])}])}(),function(){function rA(rS,rQ,re,rl,rM,rd){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=re,this._materials=rl,this._subMeshes=rM,this._materialMap=rd,this._version=rQ,this._onLoaded(rS)}rJ(rA,"laya.d3.loaders.LoadModelV01");var rS=rA.prototype;return rS._onLoaded=function(rS){this._readData=rS,this.READ_BLOCK();for(var rQ=0;rQ<this._BLOCK.count;rQ++){var re=this._readData.getUint16(),rl=this._strings[re],rM=this["READ_"+rl];if(null==rM)throw new Error("model file err,no this function:"+re+" "+rl);if(!rM.call(this))break}return this._mesh},rS.onError=function(){},rS._readString=function(){return this._strings[this._readData.getUint16()]},rS.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},rS.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},rS.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var rS=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var rQ=0;rQ<this._STRINGS.size;rQ++)this._strings[rQ]=this._readData.readUTFString();return this._readData.pos=rS,!0},rS.READ_MATERIAL=function(){var rS=this._readData.getUint16(),rQ=(this._readString(),this._readString());return this._materials[rS]="null"!==rQ?rG.getRes(this._materialMap[rQ]):new rtQ,!0},rS.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var rS,rQ=this._readData.__getBuffer(),re=0,rl=this._readData.getUint32(),rM=this._readData.getUint32(),rd=(new Float32Array(rQ.slice(rl+this._DATA.offset,rl+this._DATA.offset+rM)),this._readData.getUint32()),rT=this._readData.getUint32(),rU=new Float32Array(rQ.slice(rd+this._DATA.offset,rd+this._DATA.offset+rT));for(this.mesh._inverseBindPoses=[],re=0,rS=rU.length;re<rS;re+=16){var ri=new rSQ(rU[re+0],rU[re+1],rU[re+2],rU[re+3],rU[re+4],rU[re+5],rU[re+6],rU[re+7],rU[re+8],rU[re+9],rU[re+10],rU[re+11],rU[re+12],rU[re+13],rU[re+14],rU[re+15]);this.mesh._inverseBindPoses.push(ri)}break;default:throw new Error("LoadModel:unknown version.")}return!0},rS.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var rS=this._readString();this._shaderAttributes=rS.match(rA._attrReg);var rQ=this._readData.getUint32(),re=this._readData.getUint32(),rl=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),rM=this._readData.getUint32(),rd=this._readData.getUint32(),rT=this._readData.getUint32(),rU=this._readData.__getBuffer(),ri=new rRQ(this._mesh),rR=this._getVertexDeclaration(),ro=rfQ.create(rR,rM/rR.vertexStride,35044,!0),rY=rl+this._DATA.offset,rp=rU.slice(rY,rY+rM);ro.setData(new Float32Array(rp));for(var rJ=(ri._vertexBuffer=ro).vertexDeclaration.getVertexElements(),rL=0;rL<rJ.length;rL++)ri._bufferUsage[rJ[rL].elementUsage]=ro;var rj=raQ.create("ushort",re/2,35044,!0),rc=rQ+this._DATA.offset,rG=rU.slice(rc,rc+re);rj.setData(new Uint16Array(rG)),ri._indexBuffer=rj;var rz=rU.slice(rd+this._DATA.offset,rd+this._DATA.offset+rT);return ri._boneIndicesList[0]=new Uint8Array(rz),this._subMeshes.push(ri),!0},rS.READ_DATAAREA=function(){return!1},rS._getVertexDeclaration=function(){for(var rS,rQ=!1,re=!1,rl=!1,rM=!1,rd=!1,rT=!1,rU=!1,ri=!1,rR=!1,ro=0;ro<this._shaderAttributes.length;ro+=8)switch(this._shaderAttributes[ro]){case"POSITION":rQ=!0;break;case"NORMAL":re=!0;break;case"COLOR":rl=!0;break;case"UV":rM=!0;break;case"UV1":rd=!0;break;case"BLENDWEIGHT":rU=!0;break;case"BLENDINDICES":ri=!0;break;case"TANGENT":rT=!0;break;case"BINORMAL":rR=!0}return rQ&&re&&rl&&rM&&rd&&rU&&ri&&rT?rS=rAS.vertexDeclaration:rQ&&re&&rl&&rM&&rd&&rU&&ri?rS=rGS.vertexDeclaration:rQ&&re&&rM&&rd&&rU&&ri&&rT?rS=rmS.vertexDeclaration:rQ&&re&&rM&&rd&&rU&&ri?rS=rhS.vertexDeclaration:rQ&&re&&rl&&rM&&rU&&ri&&rT?rS=rHS.vertexDeclaration:rQ&&re&&rl&&rM&&rU&&ri?rS=rBS.vertexDeclaration:rQ&&re&&rT&&rR&&rM&&rU&&ri?rS=rxS.vertexDeclaration:rQ&&re&&rM&&rU&&ri&&rT?rS=rfS.vertexDeclaration:rQ&&re&&rM&&rU&&ri?rS=rPS.vertexDeclaration:rQ&&re&&rl&&rU&&ri&&rT?rS=rpS.vertexDeclaration:rQ&&re&&rl&&rU&&ri?rS=roS.vertexDeclaration:rQ&&re&&rl&&rM&&rd&&rT?rS=rDS.vertexDeclaration:rQ&&re&&rl&&rM&&rd?rS=rcS.vertexDeclaration:rQ&&re&&rM&&rd&&rT?rS=rnS.vertexDeclaration:rQ&&re&&rM&&rd?rS=rXS.vertexDeclaration:rQ&&re&&rl&&rM&&rT?rS=rIS.vertexDeclaration:rQ&&re&&rM&&rT&&rR?rS=rrS.vertexDeclaration:rQ&&re&&rl&&rM?rS=rjS.vertexDeclaration:rQ&&re&&rM&&rT?rS=ruS.vertexDeclaration:rQ&&re&&rM?rS=rkS.vertexDeclaration:rQ&&re&&rl&&rT?rS=rLS.vertexDeclaration:rQ&&re&&rl&&(rS=rRS.vertexDeclaration),rS},rL(0,rS,"mesh",function(){return this._mesh}),rA._attrReg=new RegExp("(\\w+)|([:,;])","g"),rA}()),rZS=function(){function rO(){}return rJ(rO,"laya.d3.loaders.LoadModelV02"),rO.parse=function(rS,rQ,re,rl,rM,rd){rO._mesh=re,rO._materials=rl,rO._subMeshes=rM,rO._materialMap=rd,rO._version=rQ,rO._readData=rS,rO.READ_DATA(),rO.READ_BLOCK(),rO.READ_STRINGS();for(var rT=0,rU=rO._BLOCK.count;rT<rU;rT++){rO._readData.pos=rO._BLOCK.blockStarts[rT];var ri=rO._readData.getUint16(),rR=rO._strings[ri],ro=rO["READ_"+rR];if(null==ro)throw new Error("model file err,no this function:"+ri+" "+rR);ro.call()}rO._strings.length=0,rO._readData=null,rO._version=null,rO._mesh=null,rO._materials=null,rO._subMeshes=null,rO._materialMap=null},rO._readString=function(){return rO._strings[rO._readData.getUint16()]},rO.READ_DATA=function(){rO._DATA.offset=rO._readData.getUint32(),rO._DATA.size=rO._readData.getUint32()},rO.READ_BLOCK=function(){for(var rS=rO._BLOCK.count=rO._readData.getUint16(),rQ=rO._BLOCK.blockStarts=[],re=rO._BLOCK.blockLengths=[],rl=0;rl<rS;rl++)rQ.push(rO._readData.getUint32()),re.push(rO._readData.getUint32())},rO.READ_STRINGS=function(){var rS=rO._readData.getUint32(),rQ=rO._readData.getUint16(),re=rO._readData.pos;rO._readData.pos=rS+rO._DATA.offset;for(var rl=0;rl<rQ;rl++)rO._strings[rl]=rO._readData.readUTFString();rO._readData.pos=re},rO.READ_MATERIAL=function(){rO._readString(),rO._readString();var rS=rO._readString();return""!==rS&&rO._materials.push(rG.getRes(rO._materialMap[rS])),!0},rO.READ_MESH=function(){rO._readString();var rS,rQ=rO._readData.__getBuffer(),re=0,rl=rO._readData.getInt16(),rM=rO._DATA.offset;for(re=0;re<rl;re++){var rd=rM+rO._readData.getUint32(),rT=rO._readData.getUint32(),rU=new Float32Array(rQ.slice(rd,rd+rT)),ri=rO._readString().match(rO._attrReg),rR=rO._getVertexDeclaration(ri),ro=rfQ.create(rR,4*rU.length/rR.vertexStride,35044,!0);ro.setData(rU),rO._mesh._vertexBuffers.push(ro)}var rY=rM+rO._readData.getUint32(),rp=rO._readData.getUint32(),rJ=new Uint16Array(rQ.slice(rY,rY+rp)),rL=raQ.create("ushort",rp/2,35044,!0);rL.setData(rJ),rO._mesh._indexBuffer=rL;var rj=rO._mesh._boneNames=[],rc=rO._readData.getUint16();for(rj.length=rc,re=0;re<rc;re++)rj[re]=rO._strings[rO._readData.getUint16()];var rG=rO._readData.getUint32(),rz=rO._readData.getUint32(),rA=(new Float32Array(rQ.slice(rM+rG,rM+rG+rz)),rO._readData.getUint32()),rv=rO._readData.getUint32(),rD=new Float32Array(rQ.slice(rM+rA,rM+rA+rv));for(rO._mesh._inverseBindPoses=[],re=0,rS=rD.length;re<rS;re+=16){var rB=new rSQ(rD[re+0],rD[re+1],rD[re+2],rD[re+3],rD[re+4],rD[re+5],rD[re+6],rD[re+7],rD[re+8],rD[re+9],rD[re+10],rD[re+11],rD[re+12],rD[re+13],rD[re+14],rD[re+15]);rO._mesh._inverseBindPoses.push(rB)}return rO._mesh._skinnedDatas=new Float32Array(16*rD.length),!0},rO.READ_SUBMESH=function(){var rS=rO._readData.__getBuffer(),rQ=new rRQ(rO._mesh),re=rO._readData.getInt16(),rl=rO._readData.getUint32(),rM=rO._readData.getUint32();rQ._vertexBuffer=rO._mesh._vertexBuffers[re],rQ._vertexStart=rl,rQ._vertexCount=rM;var rd=rO._readData.getUint32(),rT=rO._readData.getUint32(),rU=rO._mesh._indexBuffer;rQ._indexBuffer=rU,rQ._indexStart=rd,rQ._indexCount=rT,rQ._indices=new Uint16Array(rU.getData().buffer,2*rd,rT);var ri=rO._DATA.offset,rR=rQ._subIndexBufferStart,ro=rQ._subIndexBufferCount,rY=rQ._boneIndicesList,rp=rO._readData.getUint16();rR.length=rp,ro.length=rp,rY.length=rp;for(var rJ=0;rJ<rp;rJ++){rR[rJ]=rO._readData.getUint32(),ro[rJ]=rO._readData.getUint32();var rL=rO._readData.getUint32(),rj=rO._readData.getUint32();rQ._boneIndicesList[rJ]=new Uint8Array(rS.slice(ri+rL,ri+rL+rj))}return rO._subMeshes.push(rQ),!0},rO._getVertexDeclaration=function(rS){for(var rQ,re=!1,rl=!1,rM=!1,rd=!1,rT=!1,rU=!1,ri=!1,rR=!1,ro=!1,rY=0;rY<rS.length;rY++)switch(rS[rY]){case"POSITION":re=!0;break;case"NORMAL":rl=!0;break;case"COLOR":rM=!0;break;case"UV":rd=!0;break;case"UV1":rT=!0;break;case"BLENDWEIGHT":ri=!0;break;case"BLENDINDICES":rR=!0;break;case"TANGENT":rU=!0;break;case"BINORMAL":ro=!0}return re&&rl&&rM&&rd&&rT&&ri&&rR&&rU?rQ=rAS.vertexDeclaration:re&&rl&&rM&&rd&&rT&&ri&&rR?rQ=rGS.vertexDeclaration:re&&rl&&rd&&rT&&ri&&rR&&rU?rQ=rmS.vertexDeclaration:re&&rl&&rd&&rT&&ri&&rR?rQ=rhS.vertexDeclaration:re&&rl&&rM&&rd&&ri&&rR&&rU?rQ=rHS.vertexDeclaration:re&&rl&&rM&&rd&&ri&&rR?rQ=rBS.vertexDeclaration:re&&rl&&rd&&ri&&rR&&rU?rQ=rfS.vertexDeclaration:re&&rl&&rd&&ri&&rR?rQ=rPS.vertexDeclaration:re&&rl&&rM&&ri&&rR&&rU?rQ=rpS.vertexDeclaration:re&&rl&&rM&&ri&&rR?rQ=roS.vertexDeclaration:re&&rl&&rM&&rd&&rT&&rU?rQ=rDS.vertexDeclaration:re&&rl&&rM&&rd&&rT?rQ=rcS.vertexDeclaration:re&&rl&&rd&&rT&&rU?rQ=rnS.vertexDeclaration:re&&rl&&rd&&rT?rQ=rXS.vertexDeclaration:re&&rl&&rM&&rd&&rU?rQ=rIS.vertexDeclaration:re&&rl&&rd&&rU&&ro?rQ=rrS.vertexDeclaration:re&&rl&&rM&&rd?rQ=rjS.vertexDeclaration:re&&rl&&rd&&rU?rQ=ruS.vertexDeclaration:re&&rl&&rd?rQ=rkS.vertexDeclaration:re&&rl&&rM&&rU?rQ=rLS.vertexDeclaration:re&&rl&&rM&&(rQ=rRS.vertexDeclaration),rQ},rO._attrReg=new RegExp("(\\w+)|([:,;])","g"),rO._strings=[],rO._readData=null,rO._version=null,rO._mesh=null,rO._materials=null,rO._subMeshes=null,rO._materialMap=null,rY(rO,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),rO}(),rNS=function(){function rB(){}return rJ(rB,"laya.d3.loaders.LoadModelV03"),rB.parse=function(rS,rQ,re,rl,rM){rB._mesh=re,rB._subMeshes=rl,rB._materialMap=rM,rB._version=rQ,rB._readData=rS,rB.READ_DATA(),rB.READ_BLOCK(),rB.READ_STRINGS();for(var rd=0,rT=rB._BLOCK.count;rd<rT;rd++){rB._readData.pos=rB._BLOCK.blockStarts[rd];var rU=rB._readData.getUint16(),ri=rB._strings[rU],rR=rB["READ_"+ri];if(null==rR)throw new Error("model file err,no this function:"+rU+" "+ri);rR.call()}rB._strings.length=0,rB._readData=null,rB._version=null,rB._mesh=null,rB._subMeshes=null,rB._materialMap=null},rB._readString=function(){return rB._strings[rB._readData.getUint16()]},rB.READ_DATA=function(){rB._DATA.offset=rB._readData.getUint32(),rB._DATA.size=rB._readData.getUint32()},rB.READ_BLOCK=function(){for(var rS=rB._BLOCK.count=rB._readData.getUint16(),rQ=rB._BLOCK.blockStarts=[],re=rB._BLOCK.blockLengths=[],rl=0;rl<rS;rl++)rQ.push(rB._readData.getUint32()),re.push(rB._readData.getUint32())},rB.READ_STRINGS=function(){var rS=rB._readData.getUint32(),rQ=rB._readData.getUint16(),re=rB._readData.pos;rB._readData.pos=rS+rB._DATA.offset;for(var rl=0;rl<rQ;rl++)rB._strings[rl]=rB._readData.readUTFString();rB._readData.pos=re},rB.READ_MESH=function(){var rS,rQ=rB._readString(),re=rB._readData.__getBuffer(),rl=0,rM=rB._readData.getInt16(),rd=rB._DATA.offset;for(rl=0;rl<rM;rl++){var rT,rU=rd+rB._readData.getUint32(),ri=rB._readData.getUint32(),rR=new Float32Array(re.slice(rU,rU+ri)),ro=rB._readString();switch(rB._version){case"LAYAMODEL:03":rT=rB._vertexDeclarationMap_Discard[ro];break;case"LAYAMODEL:0301":rT=rB._vertexDeclarationMap[ro];break;default:throw new Error("LoadModelV03: unknown version.")}if(!rT)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+rB._version+"  bufferAttribute="+ro+"  name="+rQ+"  url="+(rB._mesh?rB._mesh.url:"null"));var rY=rfQ.create(rT,4*rR.length/rT.vertexStride,35044,!0,rB._mesh._url+"_"+rl);rY.setData(rR),rB._mesh._vertexBuffers.push(rY)}var rp=rd+rB._readData.getUint32(),rJ=rB._readData.getUint32(),rL=new Uint16Array(re.slice(rp,rp+rJ)),rj=raQ.create("ushort",rJ/2,35044,!0,rB._mesh._url);rj.setData(rL),rB._mesh._indexBuffer=rj;var rc=rB._mesh._boneNames=[],rG=rB._readData.getUint16();for(rc.length=rG,rl=0;rl<rG;rl++)rc[rl]=rB._strings[rB._readData.getUint16()];rB._readData.pos+=8;var rz=rB._readData.getUint32(),rA=rB._readData.getUint32(),rv=new Float32Array(re.slice(rd+rz,rd+rz+rA));for(rB._mesh._inverseBindPoses=[],rl=0,rS=rv.length;rl<rS;rl+=16){var rD=new rSQ(rv[rl+0],rv[rl+1],rv[rl+2],rv[rl+3],rv[rl+4],rv[rl+5],rv[rl+6],rv[rl+7],rv[rl+8],rv[rl+9],rv[rl+10],rv[rl+11],rv[rl+12],rv[rl+13],rv[rl+14],rv[rl+15]);rB._mesh._inverseBindPoses.push(rD)}return rB._mesh._skinnedDatas=new Float32Array(16*rv.length),!0},rB.READ_SUBMESH=function(){var rS=rB._readData.__getBuffer(),rQ=new rRQ(rB._mesh),re=rB._readData.getInt16(),rl=rB._readData.getUint32(),rM=rB._readData.getUint32();rQ._vertexBuffer=rB._mesh._vertexBuffers[re],rQ._vertexStart=rl,rQ._vertexCount=rM;var rd=rB._readData.getUint32(),rT=rB._readData.getUint32(),rU=rB._mesh._indexBuffer;rQ._indexBuffer=rU,rQ._indexStart=rd,rQ._indexCount=rT,rQ._indices=new Uint16Array(rU.getData().buffer,2*rd,rT);var ri=rB._DATA.offset,rR=rQ._subIndexBufferStart,ro=rQ._subIndexBufferCount,rY=rQ._boneIndicesList,rp=rB._readData.getUint16();rR.length=rp,ro.length=rp,rY.length=rp;for(var rJ=0;rJ<rp;rJ++){rR[rJ]=rB._readData.getUint32(),ro[rJ]=rB._readData.getUint32();var rL=rB._readData.getUint32(),rj=rB._readData.getUint32();rY[rJ]=new Uint8Array(rS.slice(ri+rL,ri+rL+rj))}return rB._subMeshes.push(rQ),!0},rB._strings=[],rB._readData=null,rB._version=null,rB._mesh=null,rB._subMeshes=null,rB._materialMap=null,rY(rB,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":rAS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":rGS.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":rWS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":rmS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":rhS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":rHS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":rBS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":rfS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":rPS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":rpS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":roS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":rDS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":rcS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":rnS.vertexDeclaration,"POSITION,NORMAL,UV,UV1":rXS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":rIS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":rrS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":rjS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":ruS.vertexDeclaration,"POSITION,NORMAL,UV":rkS.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":rLS.vertexDeclaration,"POSITION,NORMAL,COLOR":rRS.vertexDeclaration,"POSITION,NORMAL,TANGENT":rtS.vertexDeclaration,"POSITION,NORMAL":riS.vertexDeclaration,"POSITION,UV":rFS.vertexDeclaration,POSITION:rUS.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":rzS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":rGS.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":rWS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":rbS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":rhS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":rOS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":rBS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":raS.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":rPS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":rYS.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":roS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":rvS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":rcS.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":r$S.vertexDeclaration,"POSITION,NORMAL,UV,UV1":rXS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":rgS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":rrS.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":rjS.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":rwS.vertexDeclaration,"POSITION,NORMAL,UV":rkS.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":rJS.vertexDeclaration,"POSITION,NORMAL,COLOR":rRS.vertexDeclaration,"POSITION,NORMAL,TANGENT":rES.vertexDeclaration,"POSITION,NORMAL":riS.vertexDeclaration,"POSITION,UV":rFS.vertexDeclaration,POSITION:rUS.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),rB}(),rCS=function(){function rU(){}return rJ(rU,"laya.d3.loaders.MeshReader"),rU.read=function(rS,rQ,re,rl,rM){var rd=new rB(rS);rd.pos=0;var rT=rd.readUTFString();switch(rT){case"LAYAMODEL:01":case"LAYASKINANI:01":rU._readVersion01(rd,rT,rQ,re,rl,rM);break;case"LAYAMODEL:02":rZS.parse(rd,rT,rQ,re,rl,rM);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":rNS.parse(rd,rT,rQ,rl,rM);break;default:throw new Error("MeshReader: unknown mesh version.")}rQ._setSubMeshes(rl)},rU._readVersion01=function(rS,rQ,re,rl,rM,rd){new rqS(rS,rQ,re,rl,rM,rd)},rU}(),rKS=function(){function rS(rS,rQ){this.min=null,this.max=null,this.min=rS,this.max=rQ}rJ(rS,"laya.d3.math.BoundBox");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.getCorners=function(rS){rS.length=8;var rQ=this.min.elements,re=this.max.elements,rl=rQ[0],rM=rQ[1],rd=rQ[2],rT=re[0],rU=re[1],ri=re[2];rS[0]=new rTQ(rl,rU,ri),rS[1]=new rTQ(rT,rU,ri),rS[2]=new rTQ(rT,rM,ri),rS[3]=new rTQ(rl,rM,ri),rS[4]=new rTQ(rl,rU,rd),rS[5]=new rTQ(rT,rU,rd),rS[6]=new rTQ(rT,rM,rd),rS[7]=new rTQ(rl,rM,rd)},rQ.toDefault=function(){this.min.toDefault(),this.max.toDefault()},rQ.cloneTo=function(rS){var rQ=rS;this.min.cloneTo(rQ.min),this.max.cloneTo(rQ.max)},rQ.clone=function(){var rS=new this.constructor(new rTQ,new rTQ);return this.cloneTo(rS),rS},rS.createfromPoints=function(rS,rQ){if(null==rS)throw new Error("points");var re=rQ.min,rl=rQ.max,rM=re.elements;rM[0]=Number.MAX_VALUE,rM[1]=Number.MAX_VALUE,rM[2]=Number.MAX_VALUE;var rd=rl.elements;rd[0]=-Number.MAX_VALUE,rd[1]=-Number.MAX_VALUE,rd[2]=-Number.MAX_VALUE;for(var rT=0,rU=rS.length;rT<rU;++rT)rTQ.min(re,rS[rT],re),rTQ.max(rl,rS[rT],rl)},rS.merge=function(rS,rQ,re){rTQ.min(rS.min,rQ.min,re.min),rTQ.max(rS.max,rQ.max,re.max)},rS}(),rVS=function(){function rR(rS){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=rS,this._near=new rQQ(new rTQ),this._far=new rQQ(new rTQ),this._left=new rQQ(new rTQ),this._right=new rQQ(new rTQ),this._top=new rQQ(new rTQ),this._bottom=new rQQ(new rTQ),rR._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}rJ(rR,"laya.d3.math.BoundFrustum");var rS=rR.prototype;return rS.equalsBoundFrustum=function(rS){return this._matrix.equalsOtherMatrix(rS.matrix)},rS.equalsObj=function(rS){if(rS instanceof laya.d3.math.BoundFrustum){var rQ=rS;return this.equalsBoundFrustum(rQ)}return!1},rS.getPlane=function(rS){switch(rS){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},rS.getCorners=function(rS){rR._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(rS[0]),rR._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(rS[1]),rR._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(rS[2]),rR._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(rS[3]),rR._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(rS[4]),rR._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(rS[5]),rR._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(rS[6]),rR._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(rS[7])},rS.containsPoint=function(rS){for(var rQ=rQQ.PlaneIntersectionType_Front,re=rQQ.PlaneIntersectionType_Front,rl=0;rl<6;rl++){switch(rl){case 0:re=Collision.intersectsPlaneAndPoint(this._near,rS);break;case 1:re=Collision.intersectsPlaneAndPoint(this._far,rS);break;case 2:re=Collision.intersectsPlaneAndPoint(this._left,rS);break;case 3:re=Collision.intersectsPlaneAndPoint(this._right,rS);break;case 4:re=Collision.intersectsPlaneAndPoint(this._top,rS);break;case 5:re=Collision.intersectsPlaneAndPoint(this._bottom,rS)}switch(re){case rQQ.PlaneIntersectionType_Back:return 0;case rQQ.PlaneIntersectionType_Intersecting:rQ=rQQ.PlaneIntersectionType_Intersecting}}switch(rQ){case rQQ.PlaneIntersectionType_Intersecting:return 2;default:return 1}},rS.containsBoundBox=function(rS){for(var rQ,re=rR._tempV30,rl=rR._tempV31,rM=1,rd=0;rd<6;rd++){if(rQ=this.getPlane(rd),this._getBoxToPlanePVertexNVertex(rS,rQ.normal,re,rl),Collision.intersectsPlaneAndPoint(rQ,re)===rQQ.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(rQ,rl)===rQQ.PlaneIntersectionType_Back&&(rM=2)}return rM},rS.containsBoundSphere=function(rS){for(var rQ=rQQ.PlaneIntersectionType_Front,re=rQQ.PlaneIntersectionType_Front,rl=0;rl<6;rl++){switch(rl){case 0:re=Collision.intersectsPlaneAndSphere(this._near,rS);break;case 1:re=Collision.intersectsPlaneAndSphere(this._far,rS);break;case 2:re=Collision.intersectsPlaneAndSphere(this._left,rS);break;case 3:re=Collision.intersectsPlaneAndSphere(this._right,rS);break;case 4:re=Collision.intersectsPlaneAndSphere(this._top,rS);break;case 5:re=Collision.intersectsPlaneAndSphere(this._bottom,rS)}switch(re){case rQQ.PlaneIntersectionType_Back:return 0;case rQQ.PlaneIntersectionType_Intersecting:rQ=rQQ.PlaneIntersectionType_Intersecting}}switch(rQ){case rQQ.PlaneIntersectionType_Intersecting:return 2;default:return 1}},rS._getBoxToPlanePVertexNVertex=function(rS,rQ,re,rl){var rM=rS.min,rd=rM.elements,rT=rS.max,rU=rT.elements,ri=rQ.elements,rR=ri[0],ro=ri[1],rY=ri[2];rM.cloneTo(re);var rp=re.elements;0<=rR&&(rp[0]=rU[0]),0<=ro&&(rp[1]=rU[1]),0<=rY&&(rp[2]=rU[2]),rT.cloneTo(rl);var rJ=rl.elements;0<=rR&&(rJ[0]=rd[0]),0<=ro&&(rJ[1]=rd[1]),0<=rY&&(rJ[2]=rd[2])},rL(0,rS,"top",function(){return this._top}),rL(0,rS,"matrix",function(){return this._matrix},function(rS){this._matrix=rS,rR._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),rL(0,rS,"near",function(){return this._near}),rL(0,rS,"far",function(){return this._far}),rL(0,rS,"left",function(){return this._left}),rL(0,rS,"right",function(){return this._right}),rL(0,rS,"bottom",function(){return this._bottom}),rR._getPlanesFromMatrix=function(rS,rQ,re,rl,rM,rd,rT){var rU=rS.elements,ri=rU[0],rR=rU[1],ro=rU[2],rY=rU[3],rp=rU[4],rJ=rU[5],rL=rU[6],rj=rU[7],rc=rU[8],rG=rU[9],rz=rU[10],rA=rU[11],rv=rU[12],rD=rU[13],rB=rU[14],rO=rU[15],rH=rQ.normal.elements;rH[0]=rY+ro,rH[1]=rj+rL,rH[2]=rA+rz,rQ.distance=rO+rB,rQ.normalize();var rg=re.normal.elements;rg[0]=rY-ro,rg[1]=rj-rL,rg[2]=rA-rz,re.distance=rO-rB,re.normalize();var rI=rl.normal.elements;rI[0]=rY+ri,rI[1]=rj+rp,rI[2]=rA+rc,rl.distance=rO+rv,rl.normalize();var rE=rM.normal.elements;rE[0]=rY-ri,rE[1]=rj-rp,rE[2]=rA-rc,rM.distance=rO-rv,rM.normalize();var rt=rd.normal.elements;rt[0]=rY-rR,rt[1]=rj-rJ,rt[2]=rA-rG,rd.distance=rO-rD,rd.normalize();var rk=rT.normal.elements;rk[0]=rY+rR,rk[1]=rj+rJ,rk[2]=rA+rG,rT.distance=rO+rD,rT.normalize()},rR._get3PlaneInterPoint=function(rS,rQ,re){var rl=rS.normal,rM=rQ.normal,rd=re.normal;rTQ.cross(rM,rd,rR._tempV30),rTQ.cross(rd,rl,rR._tempV31),rTQ.cross(rl,rM,rR._tempV32);var rT=rTQ.dot(rl,rR._tempV30),rU=rTQ.dot(rM,rR._tempV31),ri=rTQ.dot(rd,rR._tempV32);return rTQ.scale(rR._tempV30,-rS.distance/rT,rR._tempV33),rTQ.scale(rR._tempV31,-rQ.distance/rU,rR._tempV34),rTQ.scale(rR._tempV32,-re.distance/ri,rR._tempV35),rTQ.add(rR._tempV33,rR._tempV34,rR._tempV36),rTQ.add(rR._tempV35,rR._tempV36,rR._tempV37),rR._tempV37},rY(rR,["_tempV30",function(){return this._tempV30=new rTQ},"_tempV31",function(){return this._tempV31=new rTQ},"_tempV32",function(){return this._tempV32=new rTQ},"_tempV33",function(){return this._tempV33=new rTQ},"_tempV34",function(){return this._tempV34=new rTQ},"_tempV35",function(){return this._tempV35=new rTQ},"_tempV36",function(){return this._tempV36=new rTQ},"_tempV37",function(){return this._tempV37=new rTQ}]),rR}(),r_S=function(){function ro(rS,rQ){this.center=null,this.radius=NaN,this.center=rS,this.radius=rQ}rJ(ro,"laya.d3.math.BoundSphere");var rS=ro.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.toDefault=function(){this.center.toDefault(),this.radius=0},rS.intersectsRayDistance=function(rS){return Collision.intersectsRayAndSphereRD(rS,this)},rS.intersectsRayPoint=function(rS,rQ){return Collision.intersectsRayAndSphereRP(rS,this,rQ)},rS.cloneTo=function(rS){var rQ=rS;this.center.cloneTo(rQ.center),rQ.radius=this.radius},rS.clone=function(){var rS=new this.constructor(new rTQ,new rTQ);return this.cloneTo(rS),rS},ro.createFromSubPoints=function(rS,rQ,re,rl){if(null==rS)throw new Error("points");if(rQ<0||rQ>=rS.length)throw new Error("start"+rQ+"Must be in the range [0, "+(rS.length-1)+"]");if(re<0||rQ+re>rS.length)throw new Error("count"+re+"Must be in the range <= "+rS.length+"}");var rM=rQ+re,rd=ro._tempVector3;rd.elements[0]=0,rd.elements[1]=0,rd.elements[2]=0;for(var rT=rQ;rT<rM;++rT)rTQ.add(rS[rT],rd,rd);var rU=rl.center;rTQ.scale(rd,1/re,rU);var ri=0;for(rT=rQ;rT<rM;++rT){var rR=rTQ.distanceSquared(rU,rS[rT]);ri<rR&&(ri=rR)}rl.radius=Math.sqrt(ri)},ro.createfromPoints=function(rS,rQ){if(null==rS)throw new Error("points");ro.createFromSubPoints(rS,0,rS.length,rQ)},rY(ro,["_tempVector3",function(){return this._tempVector3=new rTQ}]),ro}(),rsS=(function(){function rS(){}rJ(rS,"laya.d3.math.ContainmentType"),rS.Disjoint=0,rS.Contains=1,rS.Intersects=2}(),function(){function re(){}return rJ(re,"laya.d3.math.MathUtils3D"),re.isZero=function(rS){return Math.abs(rS)<re.zeroTolerance},re.nearEqual=function(rS,rQ){return!!re.isZero(rS-rQ)},re.fastInvSqrt=function(rS){return re.isZero(rS)?rS:1/Math.sqrt(rS)},rY(re,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),re}()),ryS=function(){function ri(){var rS=this.elements=new Float32Array(9);rS[0]=1,rS[1]=0,rS[2]=0,rS[3]=0,rS[4]=1,rS[5]=0,rS[6]=0,rS[7]=0,rS[8]=1}rJ(ri,"laya.d3.math.Matrix3x3");var rS=ri.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.determinant=function(){var rS=this.elements,rQ=rS[0],re=rS[1],rl=rS[2],rM=rS[3],rd=rS[4],rT=rS[5],rU=rS[6],ri=rS[7],rR=rS[8];return rQ*(rR*rd-rT*ri)+re*(-rR*rM+rT*rU)+rl*(ri*rM-rd*rU)},rS.translate=function(rS,rQ){var re=rQ.elements,rl=this.elements,rM=rS.elements,rd=rl[0],rT=rl[1],rU=rl[2],ri=rl[3],rR=rl[4],ro=rl[5],rY=rl[6],rp=rl[7],rJ=rl[8],rL=rM[0],rj=rM[1];re[0]=rd,re[1]=rT,re[2]=rU,re[3]=ri,re[4]=rR,re[5]=ro,re[6]=rL*rd+rj*ri+rY,re[7]=rL*rT+rj*rR+rp,re[8]=rL*rU+rj*ro+rJ},rS.rotate=function(rS,rQ){var re=rQ.elements,rl=this.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=rl[4],rR=rl[5],ro=rl[6],rY=rl[7],rp=rl[8],rJ=Math.sin(rS),rL=Math.cos(rS);re[0]=rL*rM+rJ*rU,re[1]=rL*rd+rJ*ri,re[2]=rL*rT+rJ*rR,re[3]=rL*rU-rJ*rM,re[4]=rL*ri-rJ*rd,re[5]=rL*rR-rJ*rT,re[6]=ro,re[7]=rY,re[8]=rp},rS.scale=function(rS,rQ){var re=rQ.elements,rl=this.elements,rM=rS.elements,rd=rM[0],rT=rM[1];re[0]=rd*rl[0],re[1]=rd*rl[1],re[2]=rd*rl[2],re[3]=rT*rl[3],re[4]=rT*rl[4],re[5]=rT*rl[5],re[6]=rl[6],re[7]=rl[7],re[8]=rl[8]},rS.invert=function(rS){var rQ=rS.elements,re=this.elements,rl=re[0],rM=re[1],rd=re[2],rT=re[3],rU=re[4],ri=re[5],rR=re[6],ro=re[7],rY=re[8],rp=rY*rU-ri*ro,rJ=-rY*rT+ri*rR,rL=ro*rT-rU*rR,rj=rl*rp+rM*rJ+rd*rL;rj||(rS=null),rj=1/rj,rQ[0]=rp*rj,rQ[1]=(-rY*rM+rd*ro)*rj,rQ[2]=(ri*rM-rd*rU)*rj,rQ[3]=rJ*rj,rQ[4]=(rY*rl-rd*rR)*rj,rQ[5]=(-ri*rl+rd*rT)*rj,rQ[6]=rL*rj,rQ[7]=(-ro*rl+rM*rR)*rj,rQ[8]=(rU*rl-rM*rT)*rj},rS.transpose=function(rS){var rQ=rS.elements,re=this.elements;if(rS===this){var rl=re[1],rM=re[2],rd=re[5];rQ[1]=re[3],rQ[2]=re[6],rQ[3]=rl,rQ[5]=re[7],rQ[6]=rM,rQ[7]=rd}else rQ[0]=re[0],rQ[1]=re[3],rQ[2]=re[6],rQ[3]=re[1],rQ[4]=re[4],rQ[5]=re[7],rQ[6]=re[2],rQ[7]=re[5],rQ[8]=re[8]},rS.identity=function(){var rS=this.elements;rS[0]=1,rS[1]=0,rS[2]=0,rS[3]=0,rS[4]=1,rS[5]=0,rS[6]=0,rS[7]=0,rS[8]=1},rS.cloneTo=function(rS){var rQ,re,rl;if((re=this.elements)!==(rl=rS.elements))for(rQ=0;rQ<9;++rQ)rl[rQ]=re[rQ]},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},ri.createFromTranslation=function(rS,rQ){rQ.elements;var re=rS.elements;rQ[0]=1,rQ[1]=0,rQ[2]=0,rQ[3]=0,rQ[4]=1,rQ[5]=0,rQ[6]=re[0],rQ[7]=re[1],rQ[8]=1},ri.createFromRotation=function(rS,rQ){var re=rQ.elements,rl=Math.sin(rS),rM=Math.cos(rS);re[0]=rM,re[1]=rl,re[2]=0,re[3]=-rl,re[4]=rM,re[5]=0,re[6]=0,re[7]=0,re[8]=1},ri.createFromScaling=function(rS,rQ){var re=rQ.elements,rl=rS.elements;re[0]=rl[0],re[1]=0,re[2]=0,re[3]=0,re[4]=rl[1],re[5]=0,re[6]=0,re[7]=0,re[8]=1},ri.createFromMatrix4x4=function(rS,rQ){rQ[0]=rS[0],rQ[1]=rS[1],rQ[2]=rS[2],rQ[3]=rS[4],rQ[4]=rS[5],rQ[5]=rS[6],rQ[6]=rS[8],rQ[7]=rS[9],rQ[8]=rS[10]},ri.multiply=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements,rT=rM[0],rU=rM[1],ri=rM[2],rR=rM[3],ro=rM[4],rY=rM[5],rp=rM[6],rJ=rM[7],rL=rM[8],rj=rd[0],rc=rd[1],rG=rd[2],rz=rd[3],rA=rd[4],rv=rd[5],rD=rd[6],rB=rd[7],rO=rd[8];rl[0]=rj*rT+rc*rR+rG*rp,rl[1]=rj*rU+rc*ro+rG*rJ,rl[2]=rj*ri+rc*rY+rG*rL,rl[3]=rz*rT+rA*rR+rv*rp,rl[4]=rz*rU+rA*ro+rv*rJ,rl[5]=rz*ri+rA*rY+rv*rL,rl[6]=rD*rT+rB*rR+rO*rp,rl[7]=rD*rU+rB*ro+rO*rJ,rl[8]=rD*ri+rB*rY+rO*rL},ri.lookAt=function(rS,rQ,re,rl){rTQ.subtract(rS,rQ,ri._tempV30),rTQ.normalize(ri._tempV30,ri._tempV30),rTQ.cross(re,ri._tempV30,ri._tempV31),rTQ.normalize(ri._tempV31,ri._tempV31),rTQ.cross(ri._tempV30,ri._tempV31,ri._tempV32);var rM=ri._tempV30.elements,rd=ri._tempV31.elements,rT=ri._tempV32.elements,rU=rl.elements;rU[0]=rd[0],rU[3]=rd[1],rU[6]=rd[2],rU[1]=rT[0],rU[4]=rT[1],rU[7]=rT[2],rU[2]=rM[0],rU[5]=rM[1],rU[8]=rM[2]},ri.DEFAULT=new ri,rY(ri,["_tempV30",function(){return this._tempV30=new rTQ},"_tempV31",function(){return this._tempV31=new rTQ},"_tempV32",function(){return this._tempV32=new rTQ}]),ri}(),rSQ=function(){function rg(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY,rp,rJ,rL,rj){void 0===rS&&(rS=1),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rd&&(rd=1),void 0===rT&&(rT=0),void 0===rU&&(rU=0),void 0===ri&&(ri=0),void 0===rR&&(rR=0),void 0===ro&&(ro=1),void 0===rY&&(rY=0),void 0===rp&&(rp=0),void 0===rJ&&(rJ=0),void 0===rL&&(rL=0),void 0===rj&&(rj=1);var rc=this.elements=new Float32Array(16);rc[0]=rS,rc[1]=rQ,rc[2]=re,rc[3]=rl,rc[4]=rM,rc[5]=rd,rc[6]=rT,rc[7]=rU,rc[8]=ri,rc[9]=rR,rc[10]=ro,rc[11]=rY,rc[12]=rp,rc[13]=rJ,rc[14]=rL,rc[15]=rj}rJ(rg,"laya.d3.math.Matrix4x4");var rS=rg.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.getElementByRowColumn=function(rS,rQ){if(rS<0||3<rS)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(rQ<0||3<rQ)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*rS+rQ]},rS.setElementByRowColumn=function(rS,rQ,re){if(rS<0||3<rS)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(rQ<0||3<rQ)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*rS+rQ]=re},rS.equalsOtherMatrix=function(rS){var rQ=this.elements,re=rS.elements;return rsS.nearEqual(rQ[0],re[0])&&rsS.nearEqual(rQ[1],re[1])&&rsS.nearEqual(rQ[2],re[2])&&rsS.nearEqual(rQ[3],re[3])&&rsS.nearEqual(rQ[4],re[4])&&rsS.nearEqual(rQ[5],re[5])&&rsS.nearEqual(rQ[6],re[6])&&rsS.nearEqual(rQ[7],re[7])&&rsS.nearEqual(rQ[8],re[8])&&rsS.nearEqual(rQ[9],re[9])&&rsS.nearEqual(rQ[10],re[10])&&rsS.nearEqual(rQ[11],re[11])&&rsS.nearEqual(rQ[12],re[12])&&rsS.nearEqual(rQ[13],re[13])&&rsS.nearEqual(rQ[14],re[14])&&rsS.nearEqual(rQ[15],re[15])},rS.decomposeTransRotScale=function(rS,rQ,re){var rl=rg._tempMatrix4x4;return this.decomposeTransRotMatScale(rS,rl,re)?(reQ.createFromMatrix4x4(rl,rQ),!0):(rQ.identity(),!1)},rS.decomposeTransRotMatScale=function(rS,rQ,re){var rl=this.elements,rM=rS.elements,rd=rQ.elements,rT=re.elements;rM[0]=rl[12],rM[1]=rl[13],rM[2]=rl[14];var rU=rl[0],ri=rl[1],rR=rl[2],ro=rl[4],rY=rl[5],rp=rl[6],rJ=rl[8],rL=rl[9],rj=rl[10],rc=rT[0]=Math.sqrt(rU*rU+ri*ri+rR*rR),rG=rT[1]=Math.sqrt(ro*ro+rY*rY+rp*rp),rz=rT[2]=Math.sqrt(rJ*rJ+rL*rL+rj*rj);if(rsS.isZero(rc)||rsS.isZero(rG)||rsS.isZero(rz))return rd[1]=rd[2]=rd[3]=rd[4]=rd[6]=rd[7]=rd[8]=rd[9]=rd[11]=rd[12]=rd[13]=rd[14]=0,rd[0]=rd[5]=rd[10]=rd[15]=1,!1;var rA=rg._tempVector0,rv=rA.elements;rv[0]=rJ/rz,rv[1]=rL/rz,rv[2]=rj/rz;var rD=rg._tempVector1,rB=rD.elements;rB[0]=rU/rc,rB[1]=ri/rc,rB[2]=rR/rc;var rO=rg._tempVector2;rTQ.cross(rA,rD,rO);var rH=rg._tempVector1;return rTQ.cross(rO,rA,rH),rd[3]=rd[7]=rd[11]=rd[12]=rd[13]=rd[14]=0,rd[15]=1,rd[0]=rH.x,rd[1]=rH.y,rd[2]=rH.z,rd[4]=rO.x,rd[5]=rO.y,rd[6]=rO.z,rd[8]=rA.x,rd[9]=rA.y,rd[10]=rA.z,rd[0]*rU+rd[1]*ri+rd[2]*rR<0&&(rT[0]=-rc),rd[4]*ro+rd[5]*rY+rd[6]*rp<0&&(rT[1]=-rG),rd[8]*rJ+rd[9]*rL+rd[10]*rj<0&&(rT[2]=-rz),!0},rS.decomposeYawPitchRoll=function(rS){var rQ=rS.elements,re=Math.asin(-this.elements[9]);rQ[1]=re,Math.cos(re)>rsS.zeroTolerance?(rQ[2]=Math.atan2(this.elements[1],this.elements[5]),rQ[0]=Math.atan2(this.elements[8],this.elements[10])):(rQ[2]=Math.atan2(-this.elements[4],this.elements[0]),rQ[0]=0)},rS.normalize=function(){var rS=this.elements,rQ=rS[0],re=rS[1],rl=rS[2],rM=Math.sqrt(rQ*rQ+re*re+rl*rl);if(!rM)return rS[0]=0,rS[1]=0,void(rS[2]=0);1!=rM&&(rM=1/rM,rS[0]=rQ*rM,rS[1]=re*rM,rS[2]=rl*rM)},rS.transpose=function(){var rS,rQ;return rQ=(rS=this.elements)[1],rS[1]=rS[4],rS[4]=rQ,rQ=rS[2],rS[2]=rS[8],rS[8]=rQ,rQ=rS[3],rS[3]=rS[12],rS[12]=rQ,rQ=rS[6],rS[6]=rS[9],rS[9]=rQ,rQ=rS[7],rS[7]=rS[13],rS[13]=rQ,rQ=rS[11],rS[11]=rS[14],rS[14]=rQ,this},rS.invert=function(rS){var rQ=this.elements,re=rS.elements,rl=rQ[0],rM=rQ[1],rd=rQ[2],rT=rQ[3],rU=rQ[4],ri=rQ[5],rR=rQ[6],ro=rQ[7],rY=rQ[8],rp=rQ[9],rJ=rQ[10],rL=rQ[11],rj=rQ[12],rc=rQ[13],rG=rQ[14],rz=rQ[15],rA=rl*ri-rM*rU,rv=rl*rR-rd*rU,rD=rl*ro-rT*rU,rB=rM*rR-rd*ri,rO=rM*ro-rT*ri,rH=rd*ro-rT*rR,rg=rY*rc-rp*rj,rI=rY*rG-rJ*rj,rE=rY*rz-rL*rj,rt=rp*rG-rJ*rc,rk=rp*rz-rL*rc,rX=rJ*rz-rL*rG,rh=rA*rX-rv*rk+rD*rt+rB*rE-rO*rI+rH*rg;0!==Math.abs(rh)&&(rh=1/rh,re[0]=(ri*rX-rR*rk+ro*rt)*rh,re[1]=(rd*rk-rM*rX-rT*rt)*rh,re[2]=(rc*rH-rG*rO+rz*rB)*rh,re[3]=(rJ*rO-rp*rH-rL*rB)*rh,re[4]=(rR*rE-rU*rX-ro*rI)*rh,re[5]=(rl*rX-rd*rE+rT*rI)*rh,re[6]=(rG*rD-rj*rH-rz*rv)*rh,re[7]=(rY*rH-rJ*rD+rL*rv)*rh,re[8]=(rU*rk-ri*rE+ro*rg)*rh,re[9]=(rM*rE-rl*rk-rT*rg)*rh,re[10]=(rj*rO-rc*rD+rz*rA)*rh,re[11]=(rp*rD-rY*rO-rL*rA)*rh,re[12]=(ri*rI-rU*rt-rR*rg)*rh,re[13]=(rl*rt-rM*rI+rd*rg)*rh,re[14]=(rc*rv-rj*rB-rG*rA)*rh,re[15]=(rY*rB-rp*rv+rJ*rA)*rh)},rS.identity=function(){var rS=this.elements;rS[1]=rS[2]=rS[3]=rS[4]=rS[6]=rS[7]=rS[8]=rS[9]=rS[11]=rS[12]=rS[13]=rS[14]=0,rS[0]=rS[5]=rS[10]=rS[15]=1},rS.cloneTo=function(rS){var rQ,re,rl;if((re=this.elements)!==(rl=rS.elements))for(rQ=0;rQ<16;++rQ)rl[rQ]=re[rQ]},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rS.getTranslationVector=function(rS){var rQ=this.elements,re=rS.elements;re[0]=rQ[12],re[1]=rQ[13],re[2]=rQ[14]},rS.setTranslationVector=function(rS){var rQ=this.elements,re=rS.elements;rQ[12]=re[0],rQ[13]=re[1],rQ[14]=re[2]},rS.getForward=function(rS){var rQ=this.elements,re=rS.elements;re[0]=-rQ[8],re[1]=-rQ[9],re[2]=-rQ[10]},rS.setForward=function(rS){var rQ=this.elements,re=rS.elements;rQ[8]=-re[0],rQ[9]=-re[1],rQ[10]=-re[2]},rg.createRotationX=function(rS,rQ){var re=rQ.elements,rl=Math.sin(rS),rM=Math.cos(rS);re[1]=re[2]=re[3]=re[4]=re[7]=re[8]=re[11]=re[12]=re[13]=re[14]=0,re[0]=re[15]=1,re[5]=re[10]=rM,re[6]=rl,re[9]=-rl},rg.createRotationY=function(rS,rQ){var re=rQ.elements,rl=Math.sin(rS),rM=Math.cos(rS);re[1]=re[3]=re[4]=re[6]=re[7]=re[9]=re[11]=re[12]=re[13]=re[14]=0,re[5]=re[15]=1,re[0]=re[10]=rM,re[2]=-rl,re[8]=rl},rg.createRotationZ=function(rS,rQ){var re=rQ.elements,rl=Math.sin(rS),rM=Math.cos(rS);re[2]=re[3]=re[6]=re[7]=re[8]=re[9]=re[11]=re[12]=re[13]=re[14]=0,re[10]=re[15]=1,re[0]=re[5]=rM,re[1]=rl,re[4]=-rl},rg.createRotationYawPitchRoll=function(rS,rQ,re,rl){reQ.createFromYawPitchRoll(rS,rQ,re,rg._tempQuaternion),rg.createRotationQuaternion(rg._tempQuaternion,rl)},rg.createRotationAxis=function(rS,rQ,re){var rl=rS.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=Math.cos(rQ),ri=Math.sin(rQ),rR=rM*rM,ro=rd*rd,rY=rT*rT,rp=rM*rd,rJ=rM*rT,rL=rd*rT,rj=re.elements;rj[3]=rj[7]=rj[11]=rj[12]=rj[13]=rj[14]=0,rj[15]=1,rj[0]=rR+rU*(1-rR),rj[1]=rp-rU*rp+ri*rT,rj[2]=rJ-rU*rJ-ri*rd,rj[4]=rp-rU*rp-ri*rT,rj[5]=ro+rU*(1-ro),rj[6]=rL-rU*rL+ri*rM,rj[8]=rJ-rU*rJ+ri*rd,rj[9]=rL-rU*rL-ri*rM,rj[10]=rY+rU*(1-rY)},rg.createRotationQuaternion=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0],rd=re[1],rT=re[2],rU=re[3],ri=rM*rM,rR=rd*rd,ro=rT*rT,rY=rM*rd,rp=rT*rU,rJ=rT*rM,rL=rd*rU,rj=rd*rT,rc=rM*rU;rl[3]=rl[7]=rl[11]=rl[12]=rl[13]=rl[14]=0,rl[15]=1,rl[0]=1-2*(rR+ro),rl[1]=2*(rY+rp),rl[2]=2*(rJ-rL),rl[4]=2*(rY-rp),rl[5]=1-2*(ro+ri),rl[6]=2*(rj+rc),rl[8]=2*(rJ+rL),rl[9]=2*(rj-rc),rl[10]=1-2*(rR+ri)},rg.createTranslate=function(rS,rQ){var re=rS.elements,rl=rQ.elements;rl[4]=rl[8]=rl[1]=rl[9]=rl[2]=rl[6]=rl[3]=rl[7]=rl[11]=0,rl[0]=rl[5]=rl[10]=rl[15]=1,rl[12]=re[0],rl[13]=re[1],rl[14]=re[2]},rg.createScaling=function(rS,rQ){var re=rS.elements,rl=rQ.elements;rl[0]=re[0],rl[5]=re[1],rl[10]=re[2],rl[1]=rl[4]=rl[8]=rl[12]=rl[9]=rl[13]=rl[2]=rl[6]=rl[14]=rl[3]=rl[7]=rl[11]=0,rl[15]=1},rg.multiply=function(rS,rQ,re){var rl,rM,rd,rT,rU,ri,rR,ro;for(rM=re.elements,rd=rS.elements,rM===(rT=rQ.elements)&&(rT=rT.slice()),rl=0;rl<4;rl++)rU=rd[rl],ri=rd[rl+4],rR=rd[rl+8],ro=rd[rl+12],rM[rl]=rU*rT[0]+ri*rT[1]+rR*rT[2]+ro*rT[3],rM[rl+4]=rU*rT[4]+ri*rT[5]+rR*rT[6]+ro*rT[7],rM[rl+8]=rU*rT[8]+ri*rT[9]+rR*rT[10]+ro*rT[11],rM[rl+12]=rU*rT[12]+ri*rT[13]+rR*rT[14]+ro*rT[15]},rg.createFromQuaternion=function(rS,rQ){var re=rQ.elements,rl=rS.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=rM+rM,rR=rd+rd,ro=rT+rT,rY=rM*ri,rp=rd*ri,rJ=rd*rR,rL=rT*ri,rj=rT*rR,rc=rT*ro,rG=rU*ri,rz=rU*rR,rA=rU*ro;re[0]=1-rJ-rc,re[1]=rp+rA,re[2]=rL-rz,re[3]=0,re[4]=rp-rA,re[5]=1-rY-rc,re[6]=rj+rG,re[7]=0,re[8]=rL+rz,re[9]=rj-rG,re[10]=1-rY-rJ,re[11]=0,re[12]=0,re[13]=0,re[14]=0,re[15]=1},rg.createAffineTransformation=function(rS,rQ,re,rl){var rM=rS.elements,rd=rQ.elements,rT=re.elements,rU=rl.elements,ri=rd[0],rR=rd[1],ro=rd[2],rY=rd[3],rp=ri+ri,rJ=rR+rR,rL=ro+ro,rj=ri*rp,rc=ri*rJ,rG=ri*rL,rz=rR*rJ,rA=rR*rL,rv=ro*rL,rD=rY*rp,rB=rY*rJ,rO=rY*rL,rH=rT[0],rg=rT[1],rI=rT[2];rU[0]=(1-(rz+rv))*rH,rU[1]=(rc+rO)*rH,rU[2]=(rG-rB)*rH,rU[3]=0,rU[4]=(rc-rO)*rg,rU[5]=(1-(rj+rv))*rg,rU[6]=(rA+rD)*rg,rU[7]=0,rU[8]=(rG+rB)*rI,rU[9]=(rA-rD)*rI,rU[10]=(1-(rj+rz))*rI,rU[11]=0,rU[12]=rM[0],rU[13]=rM[1],rU[14]=rM[2],rU[15]=1},rg.createLookAt=function(rS,rQ,re,rl){var rM=rl.elements,rd=rg._tempVector0,rT=rg._tempVector1,rU=rg._tempVector2;rTQ.subtract(rS,rQ,rU),rTQ.normalize(rU,rU),rTQ.cross(re,rU,rd),rTQ.normalize(rd,rd),rTQ.cross(rU,rd,rT),rl.identity(),rM[0]=rd.x,rM[4]=rd.y,rM[8]=rd.z,rM[1]=rT.x,rM[5]=rT.y,rM[9]=rT.z,rM[2]=rU.x,rM[6]=rU.y,rM[10]=rU.z,rM[12]=-rTQ.dot(rd,rS),rM[13]=-rTQ.dot(rT,rS),rM[14]=-rTQ.dot(rU,rS)},rg.createPerspective=function(rS,rQ,re,rl,rM){var rd=rM.elements,rT=1/Math.tan(rS/2),rU=1/(re-rl);rd[0]=rT/rQ,rd[5]=rT,rd[10]=(rl+re)*rU,rd[11]=-1,rd[14]=2*rl*re*rU,rd[1]=rd[2]=rd[3]=rd[4]=rd[6]=rd[7]=rd[8]=rd[9]=rd[12]=rd[13]=rd[15]=0},rg.createOrthoOffCenterRH=function(rS,rQ,re,rl,rM,rd,rT){var rU=rT.elements,ri=1/(rS-rQ),rR=1/(re-rl),ro=1/(rM-rd);rU[1]=rU[2]=rU[3]=rU[4]=rU[6]=rU[7]=rU[8]=rU[9]=rU[11]=0,rU[15]=1,rU[0]=-2*ri,rU[5]=-2*rR,rU[10]=2*ro,rU[12]=(rS+rQ)*ri,rU[13]=(rl+re)*rR,rU[14]=(rd+rM)*ro},rg.translation=function(rS,rQ){var re=rS.elements,rl=rQ.elements;rl[0]=rl[5]=rl[10]=rl[15]=1,rl[12]=re[0],rl[13]=re[1],rl[14]=re[2]},rY(rg,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new rg},"_tempVector0",function(){return this._tempVector0=new rTQ},"_tempVector1",function(){return this._tempVector1=new rTQ},"_tempVector2",function(){return this._tempVector2=new rTQ},"_tempQuaternion",function(){return this._tempQuaternion=new reQ},"DEFAULT",function(){return this.DEFAULT=new rg},"ZERO",function(){return this.ZERO=new rg(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),rg}(),rQQ=(function(){function rA(rS,rQ){this.extents=null,this.transformation=null,this.extents=rS,this.transformation=rQ}rJ(rA,"laya.d3.math.OrientedBoundBox");var rS=rA.prototype;rS.getCorners=function(rS){var rQ=rA._tempV30.elements,re=rA._tempV31.elements,rl=rA._tempV32.elements,rM=this.extents.elements;rQ[0]=rM[0],rQ[1]=rQ[2]=0,re[1]=rM[1],re[0]=re[2]=0,rl[2]=rM[2],rl[0]=rl[1]=0,rTQ.TransformNormal(rA._tempV30,this.transformation,rA._tempV30),rTQ.TransformNormal(rA._tempV31,this.transformation,rA._tempV31),rTQ.TransformNormal(rA._tempV32,this.transformation,rA._tempV32);var rd=rA._tempV33;this.transformation.getTranslationVector(rd),rS.length=8,rTQ.add(rd,rA._tempV30,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV32,rS[0]),rTQ.add(rd,rA._tempV30,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV32,rS[1]),rTQ.subtract(rd,rA._tempV30,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV32,rS[2]),rTQ.subtract(rd,rA._tempV30,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV32,rS[3]),rTQ.add(rd,rA._tempV30,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV32,rS[4]),rTQ.add(rd,rA._tempV30,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV32,rS[5]),rTQ.subtract(rd,rA._tempV30,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV32,rS[6]),rTQ.subtract(rd,rA._tempV30,rA._tempV34),rTQ.subtract(rA._tempV34,rA._tempV31,rA._tempV34),rTQ.add(rA._tempV34,rA._tempV32,rS[7])},rS.transform=function(rS){rSQ.multiply(this.transformation,rS,this.transformation)},rS.scale=function(rS){rTQ.multiply(this.extents,rS,this.extents)},rS.translate=function(rS){this.transformation.getTranslationVector(rA._tempV30),rTQ.add(rA._tempV30,rS,rA._tempV31),this.transformation.setTranslationVector(rA._tempV31)},rS.Size=function(rS){rTQ.scale(this.extents,2,rS)},rS.getSize=function(rS){var rQ=this.extents.elements;rA._tempV30.x=rQ[0],rA._tempV31.y=rQ[1],rA._tempV32.z=rQ[2],rTQ.TransformNormal(rA._tempV30,this.transformation,rA._tempV30),rTQ.TransformNormal(rA._tempV31,this.transformation,rA._tempV31),rTQ.TransformNormal(rA._tempV31,this.transformation,rA._tempV32);var re=rS.elements;re[0]=rTQ.scalarLength(rA._tempV30),re[1]=rTQ.scalarLength(rA._tempV31),re[2]=rTQ.scalarLength(rA._tempV32)},rS.getSizeSquared=function(rS){var rQ=this.extents.elements;rA._tempV30.x=rQ[0],rA._tempV31.y=rQ[1],rA._tempV32.z=rQ[2],rTQ.TransformNormal(rA._tempV30,this.transformation,rA._tempV30),rTQ.TransformNormal(rA._tempV31,this.transformation,rA._tempV31),rTQ.TransformNormal(rA._tempV31,this.transformation,rA._tempV32);var re=rS.elements;re[0]=rTQ.scalarLengthSquared(rA._tempV30),re[1]=rTQ.scalarLengthSquared(rA._tempV31),re[2]=rTQ.scalarLengthSquared(rA._tempV32)},rS.getCenter=function(rS){this.transformation.getTranslationVector(rS)},rS.containsPoint=function(rS){var rQ=this.extents.elements,re=rQ[0],rl=rQ[1],rM=rQ[2];this.transformation.invert(rA._tempM0),rTQ.transformCoordinate(rS,rA._tempM0,rA._tempV30);var rd=rA._tempV30.elements,rT=Math.abs(rd[0]),rU=Math.abs(rd[1]),ri=Math.abs(rd[2]);return rsS.nearEqual(rT,re)&&rsS.nearEqual(rU,rl)&&rsS.nearEqual(ri,rM)?2:rT<re&&rU<rl&&ri<rM?1:0},rS.containsPoints=function(rS){var rQ=this.extents.elements,re=rQ[0],rl=rQ[1],rM=rQ[2];this.transformation.invert(rA._tempM0);for(var rd=!0,rT=!1,rU=0;rU<rS.length;rU++){rTQ.transformCoordinate(rS[rU],rA._tempM0,rA._tempV30);var ri=rA._tempV30.elements,rR=Math.abs(ri[0]),ro=Math.abs(ri[1]),rY=Math.abs(ri[2]);rsS.nearEqual(rR,re)&&rsS.nearEqual(ro,rl)&&rsS.nearEqual(rY,rM)&&(rT=!0),rR<re&&ro<rl&&rY<rM?rT=!0:rd=!1}return rd?1:rT?2:0},rS.containsSphere=function(rS,rQ){void 0===rQ&&(rQ=!1);var re=this.extents.elements,rl=re[0],rM=re[1],rd=re[2],rT=rS.radius;this.transformation.invert(rA._tempM0),rTQ.transformCoordinate(rS.center,rA._tempM0,rA._tempV30);var rU=NaN;if(rU=rQ?rT:(rTQ.scale(rTQ.UnitX,rT,rA._tempV31),rTQ.TransformNormal(rA._tempV31,rA._tempM0,rA._tempV31),rTQ.scalarLength(rA._tempV31)),rTQ.scale(this.extents,-1,rA._tempV32),rTQ.Clamp(rA._tempV30,rA._tempV32,this.extents,rA._tempV33),rU*rU<rTQ.distanceSquared(rA._tempV30,rA._tempV33))return 0;var ri=rA._tempV30.elements,rR=ri[0],ro=ri[1],rY=ri[2],rp=rA._tempV32.elements,rJ=rp[0],rL=rp[1],rj=rp[2];return rJ+rU<=rR&&rR<=rl-rU&&rU<rl-rJ&&rL+rU<=ro&&ro<=rM-rU&&rU<rM-rL&&rj+rU<=rY&&rY<=rd-rU&&rU<rd-rj?1:2},rS.containsOrientedBoundBox=function(rS){var rQ=0,re=0;rS.getCorners(rA._corners);var rl=this.containsPoints(rA._corners);if(0!=rl)return rl;var rM=this.extents.elements;rS.extents.cloneTo(rA._tempV35);var rd=rA._tempV35.elements;rA._getRows(this.transformation,rA._rows1),rA._getRows(rS.transformation,rA._rows2);var rT=NaN;for(rQ=0;rQ<4;rQ++)for(re=0;re<4;re++)3==rQ||3==re?(rA._tempM0.setElementByRowColumn(rQ,re,0),rA._tempM1.setElementByRowColumn(rQ,re,0)):(rT=rTQ.dot(rA._rows1[rQ],rA._rows2[re]),rA._tempM0.setElementByRowColumn(rQ,re,rT),rA._tempM1.setElementByRowColumn(rQ,re,Math.abs(rT)));rS.getCenter(rA._tempV34),this.getCenter(rA._tempV36),rTQ.subtract(rA._tempV34,rA._tempV36,rA._tempV30);var rU=rA._tempV31.elements;rU[0]=rTQ.dot(rA._tempV30,rA._rows1[0]),rU[1]=rTQ.dot(rA._tempV30,rA._rows1[1]),rU[2]=rTQ.dot(rA._tempV30,rA._rows1[2]);var ri=rA._tempV32.elements,rR=rA._tempV33.elements;for(rQ=0;rQ<3;rQ++)if(ri[0]=rA._tempM1.getElementByRowColumn(rQ,0),ri[1]=rA._tempM1.getElementByRowColumn(rQ,1),ri[2]=rA._tempM1.getElementByRowColumn(rQ,2),rM[rQ]+rTQ.dot(rA._tempV35,rA._tempV32)<Math.abs(rU[rQ]))return 0;for(re=0;re<3;re++)if(ri[0]=rA._tempM1.getElementByRowColumn(0,re),ri[1]=rA._tempM1.getElementByRowColumn(1,re),ri[2]=rA._tempM1.getElementByRowColumn(2,re),rR[0]=rA._tempM0.getElementByRowColumn(0,re),rR[1]=rA._tempM0.getElementByRowColumn(1,re),rR[2]=rA._tempM0.getElementByRowColumn(2,re),rTQ.dot(this.extents,rA._tempV32)+rd[re]<Math.abs(rTQ.dot(rA._tempV31,rA._tempV33)))return 0;for(rQ=0;rQ<3;rQ++)for(re=0;re<3;re++){var ro=(rQ+1)%3,rY=(rQ+2)%3,rp=(re+1)%3,rJ=(re+2)%3;if(rM[ro]*rA._tempM1.getElementByRowColumn(rY,re)+rM[rY]*rA._tempM1.getElementByRowColumn(ro,re)+(rd[rp]*rA._tempM1.getElementByRowColumn(rQ,rJ)+rd[rJ]*rA._tempM1.getElementByRowColumn(rQ,rp))<Math.abs(rU[rY]*rA._tempM0.getElementByRowColumn(ro,re)-rU[ro]*rA._tempM0.getElementByRowColumn(rY,re)))return 0}return 2},rS.containsLine=function(rS,rQ){rA._corners[0]=rS,rA._corners[1]=rQ;var re=this.containsPoints(rA._corners);if(0!=re)return re;var rl=this.extents.elements,rM=rl[0],rd=rl[1],rT=rl[2];this.transformation.invert(rA._tempM0),rTQ.transformCoordinate(rS,rA._tempM0,rA._tempV30),rTQ.transformCoordinate(rQ,rA._tempM0,rA._tempV31),rTQ.add(rA._tempV30,rA._tempV31,rA._tempV32),rTQ.scale(rA._tempV32,.5,rA._tempV32),rTQ.subtract(rA._tempV30,rA._tempV32,rA._tempV33);var rU=rA._tempV33.elements,ri=rU[0],rR=rU[1],ro=rU[2],rY=rA._tempV34.elements,rp=rY[0]=Math.abs(rU[0]),rJ=rY[1]=Math.abs(rU[1]),rL=rY[2]=Math.abs(rU[2]),rj=rA._tempV32.elements,rc=rj[0],rG=rj[1],rz=rj[2];return Math.abs(rc)>rM+rp?0:Math.abs(rG)>rd+rJ?0:Math.abs(rz)>rT+rL?0:Math.abs(rG*ro-rz*rR)>rd*rL+rT*rJ?0:Math.abs(rc*ro-rz*ri)>rM*rL+rT*rp?0:Math.abs(rc*rR-rG*ri)>rM*rJ+rd*rp?0:2},rS.containsBoundBox=function(rS){var rQ=0,re=0,rl=rS.min,rM=rS.max;rS.getCorners(rA._corners);var rd=this.containsPoints(rA._corners);if(0!=rd)return rd;rTQ.subtract(rM,rl,rA._tempV30),rTQ.scale(rA._tempV30,.5,rA._tempV30),rTQ.add(rl,rA._tempV30,rA._tempV30),rTQ.subtract(rM,rA._tempV30,rA._tempV31);var rT=this.extents.elements,rU=rA._tempV31.elements;rA._getRows(this.transformation,rA._rows1),this.transformation.invert(rA._tempM0);for(rQ=0;rQ<3;rQ++)for(re=0;re<3;re++)rA._tempM1.setElementByRowColumn(rQ,re,Math.abs(rA._tempM0.getElementByRowColumn(rQ,re)));this.getCenter(rA._tempV35),rTQ.subtract(rA._tempV30,rA._tempV35,rA._tempV32);var ri=rA._tempV31.elements;ri[0]=rTQ.dot(rA._tempV32,rA._rows1[0]),ri[1]=rTQ.dot(rA._tempV32,rA._rows1[1]),ri[2]=rTQ.dot(rA._tempV32,rA._rows1[2]);var rR=rA._tempV33.elements,ro=rA._tempV34.elements;for(rQ=0;rQ<3;rQ++)if(rR[0]=rA._tempM1.getElementByRowColumn(rQ,0),rR[1]=rA._tempM1.getElementByRowColumn(rQ,1),rR[2]=rA._tempM1.getElementByRowColumn(rQ,2),rT[rQ]+rTQ.dot(rA._tempV31,rA._tempV33)<Math.abs(ri[rQ]))return 0;for(re=0;re<3;re++)if(rR[0]=rA._tempM1.getElementByRowColumn(0,re),rR[1]=rA._tempM1.getElementByRowColumn(1,re),rR[2]=rA._tempM1.getElementByRowColumn(2,re),ro[0]=rA._tempM0.getElementByRowColumn(0,re),ro[1]=rA._tempM0.getElementByRowColumn(1,re),ro[2]=rA._tempM0.getElementByRowColumn(2,re),rTQ.dot(this.extents,rA._tempV33)+rU[re]<Math.abs(rTQ.dot(rA._tempV31,rA._tempV34)))return 0;for(rQ=0;rQ<3;rQ++)for(re=0;re<3;re++){var rY=(rQ+1)%3,rp=(rQ+2)%3,rJ=(re+1)%3,rL=(re+2)%3;if(rT[rY]*rA._tempM1.getElementByRowColumn(rp,re)+rT[rp]*rA._tempM1.getElementByRowColumn(rY,re)+(rU[rJ]*rA._tempM1.getElementByRowColumn(rQ,rL)+rU[rL]*rA._tempM1.getElementByRowColumn(rQ,rJ))<Math.abs(ri[rp]*rA._tempM0.getElementByRowColumn(rY,re)-ri[rY]*rA._tempM0.getElementByRowColumn(rp,re)))return 0}return 2},rS.intersectsRay=function(rS,rQ){rTQ.scale(this.extents,-1,rA._tempV30),this.transformation.invert(rA._tempM0),rTQ.TransformNormal(rS.direction,rA._tempM0,rA._ray.direction),rTQ.transformCoordinate(rS.origin,rA._tempM0,rA._ray.origin),rA._boxBound1.min=rA._tempV30,rA._boxBound1.max=this.extents;var re=Collision.intersectsRayAndBoxRP(rA._ray,rA._boxBound1,rQ);return-1!==re&&rTQ.transformCoordinate(rQ,this.transformation,rQ),re},rS._getLocalCorners=function(rS){rS.length=8;var rQ=this.extents.elements;rA._tempV30.x=rQ[0],rA._tempV31.y=rQ[1],rA._tempV32.z=rQ[2],rTQ.add(rA._tempV30,rA._tempV31,rA._tempV33),rTQ.add(rA._tempV33,rA._tempV32,rS[0]),rTQ.add(rA._tempV30,rA._tempV31,rA._tempV33),rTQ.subtract(rA._tempV33,rA._tempV32,rS[1]),rTQ.subtract(rA._tempV31,rA._tempV30,rA._tempV33),rTQ.subtract(rA._tempV33,rA._tempV30,rS[2]),rTQ.subtract(rA._tempV31,rA._tempV30,rA._tempV33),rTQ.add(rA._tempV33,rA._tempV32,rS[3]),rTQ.subtract(rA._tempV30,rA._tempV31,rA._tempV33),rTQ.add(rA._tempV33,rA._tempV32,rS[4]),rTQ.subtract(rA._tempV30,rA._tempV31,rA._tempV33),rTQ.subtract(rA._tempV33,rA._tempV32,rS[5]),rTQ.scale(rS[0],-1,rS[6]),rTQ.subtract(rA._tempV32,rA._tempV30,rA._tempV33),rTQ.subtract(rA._tempV33,rA._tempV31,rS[7])},rS.equals=function(rS){return this.extents==rS.extents&&this.transformation==rS.transformation},rS.cloneTo=function(rS){var rQ=rS;this.extents.cloneTo(rQ.extents),this.transformation.cloneTo(rQ.transformation)},rA.createByBoundBox=function(rS,rQ){var re=rS.min,rl=rS.max;rTQ.subtract(rl,re,rA._tempV30),rTQ.scale(rA._tempV30,.5,rA._tempV30),rTQ.add(re,rA._tempV30,rA._tempV31),rTQ.subtract(rl,rA._tempV31,rA._tempV32),rSQ.translation(rA._tempV31,rA._tempM0);var rM=rA._tempV32.clone(),rd=rA._tempM0.clone();rQ.extents=rM,rQ.transformation=rd},rA.createByMinAndMaxVertex=function(rS,rQ){return rTQ.subtract(rQ,rS,rA._tempV30),rTQ.scale(rA._tempV30,.5,rA._tempV30),rTQ.add(rS,rA._tempV30,rA._tempV31),rTQ.subtract(rQ,rA._tempV31,rA._tempV32),rSQ.translation(rA._tempV31,rA._tempM0),new rA(rA._tempV32,rA._tempM0)},rA._getRows=function(rS,rQ){rQ.length=3;var re=rS.elements,rl=rQ[0].elements;rl[0]=re[0],rl[1]=re[1],rl[2]=re[2];var rM=rQ[1].elements;rM[0]=re[4],rM[1]=re[5],rM[2]=re[6];var rd=rQ[2].elements;rd[0]=re[8],rd[1]=re[9],rd[2]=re[10]},rA.getObbtoObbMatrix4x4=function(rS,rQ,re,rl){var rM=rS.transformation,rd=rQ.transformation;if(re){rA._getRows(rM,rA._rows1),rA._getRows(rd,rA._rows2);for(var rT=0;rT<3;rT++)for(var rU=0;rU<3;rU++)rl.setElementByRowColumn(rT,rU,rTQ.dot(rA._rows2[rT],rA._rows1[rU]));rQ.getCenter(rA._tempV30),rS.getCenter(rA._tempV31),rTQ.subtract(rA._tempV30,rA._tempV31,rA._tempV32);var ri=rl.elements;ri[12]=rTQ.dot(rA._tempV32,rA._rows1[0]),ri[13]=rTQ.dot(rA._tempV32,rA._rows1[1]),ri[14]=rTQ.dot(rA._tempV32,rA._rows1[2]),ri[15]=1}else rM.invert(rA._tempM0),rSQ.multiply(rd,rA._tempM0,rl)},rA.merge=function(rS,rQ,re){var rl=rS.extents,rM=rS.transformation;rA.getObbtoObbMatrix4x4(rS,rQ,re,rA._tempM0),rQ._getLocalCorners(rA._corners),rTQ.transformCoordinate(rA._corners[0],rA._tempM0,rA._corners[0]),rTQ.transformCoordinate(rA._corners[1],rA._tempM0,rA._corners[1]),rTQ.transformCoordinate(rA._corners[2],rA._tempM0,rA._corners[2]),rTQ.transformCoordinate(rA._corners[3],rA._tempM0,rA._corners[3]),rTQ.transformCoordinate(rA._corners[4],rA._tempM0,rA._corners[4]),rTQ.transformCoordinate(rA._corners[5],rA._tempM0,rA._corners[5]),rTQ.transformCoordinate(rA._corners[6],rA._tempM0,rA._corners[6]),rTQ.transformCoordinate(rA._corners[7],rA._tempM0,rA._corners[7]),rTQ.scale(rl,-1,rA._boxBound1.min),rl.cloneTo(rA._boxBound1.max),rKS.createfromPoints(rA._corners,rA._boxBound2),rKS.merge(rA._boxBound2,rA._boxBound1,rA._boxBound3);var rd=rA._boxBound3.min,rT=rA._boxBound3.max;rTQ.subtract(rT,rd,rA._tempV30),rTQ.scale(rA._tempV30,.5,rA._tempV30),rTQ.add(rd,rA._tempV30,rA._tempV32),rTQ.subtract(rT,rA._tempV32,rl),rTQ.transformCoordinate(rA._tempV32,rM,rA._tempV33)},rY(rA,["_tempV30",function(){return this._tempV30=new rTQ},"_tempV31",function(){return this._tempV31=new rTQ},"_tempV32",function(){return this._tempV32=new rTQ},"_tempV33",function(){return this._tempV33=new rTQ},"_tempV34",function(){return this._tempV34=new rTQ},"_tempV35",function(){return this._tempV35=new rTQ},"_tempV36",function(){return this._tempV36=new rTQ},"_tempM0",function(){return this._tempM0=new rSQ},"_tempM1",function(){return this._tempM1=new rSQ},"_corners",function(){return this._corners=[new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ]},"_rows1",function(){return this._rows1=[new rTQ,new rTQ,new rTQ]},"_rows2",function(){return this._rows2=[new rTQ,new rTQ,new rTQ]},"_ray",function(){return this._ray=new rMQ(new rTQ,new rTQ)},"_boxBound1",function(){return this._boxBound1=new rKS(new rTQ,new rTQ)},"_boxBound2",function(){return this._boxBound2=new rKS(new rTQ,new rTQ)},"_boxBound3",function(){return this._boxBound3=new rKS(new rTQ,new rTQ)}])}(),function(){function rD(rS,rQ){this.normal=null,this.distance=NaN,void 0===rQ&&(rQ=0),this.normal=rS,this.distance=rQ}return rJ(rD,"laya.d3.math.Plane"),rD.prototype.normalize=function(){var rS=this.normal.elements,rQ=rS[0],re=rS[1],rl=rS[2],rM=1/Math.sqrt(rQ*rQ+re*re+rl*rl);rS[0]=rQ*rM,rS[1]=re*rM,rS[2]=rl*rM,this.distance*=rM},rD.createPlaneBy3P=function(rS,rQ,re){var rl=rS.elements,rM=rQ.elements,rd=re.elements,rT=rM[0]-rl[0],rU=rM[1]-rl[1],ri=rM[2]-rl[2],rR=rd[0]-rl[0],ro=rd[1]-rl[1],rY=rd[2]-rl[2],rp=rU*rY-ri*ro,rJ=ri*rR-rT*rY,rL=rT*ro-rU*rR,rj=1/Math.sqrt(rp*rp+rJ*rJ+rL*rL),rc=rp*rj,rG=rJ*rj,rz=rL*rj,rA=rD._TEMPVec3.elements;rA[0]=rc,rA[1]=rG,rA[2]=rz;var rv=-(rc*rl[0]+rG*rl[1]+rz*rl[2]);return new rD(rD._TEMPVec3,rv)},rD.PlaneIntersectionType_Back=0,rD.PlaneIntersectionType_Front=1,rD.PlaneIntersectionType_Intersecting=2,rY(rD,["_TEMPVec3",function(){return this._TEMPVec3=new rTQ}]),rD}()),reQ=function(){function rM(rS,rQ,re,rl){this.elements=new Float32Array(4),void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=1),this.elements[0]=rS,this.elements[1]=rQ,this.elements[2]=re,this.elements[3]=rl}rJ(rM,"laya.d3.math.Quaternion");var rS=rM.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.scaling=function(rS,rQ){var re=rQ.elements,rl=this.elements;re[0]=rl[0]*rS,re[1]=rl[1]*rS,re[2]=rl[2]*rS,re[3]=rl[3]*rS},rS.normalize=function(rS){var rQ=rS.elements,re=this.elements,rl=re[0],rM=re[1],rd=re[2],rT=re[3],rU=rl*rl+rM*rM+rd*rd+rT*rT;0<rU&&(rU=1/Math.sqrt(rU),rQ[0]=rl*rU,rQ[1]=rM*rU,rQ[2]=rd*rU,rQ[3]=rT*rU)},rS.length=function(){var rS=this.elements,rQ=rS[0],re=rS[1],rl=rS[2],rM=rS[3];return Math.sqrt(rQ*rQ+re*re+rl*rl+rM*rM)},rS.rotateX=function(rS,rQ){var re=rQ.elements,rl=this.elements;rS*=.5;var rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=Math.sin(rS),rR=Math.cos(rS);re[0]=rM*rR+rU*ri,re[1]=rd*rR+rT*ri,re[2]=rT*rR-rd*ri,re[3]=rU*rR-rM*ri},rS.rotateY=function(rS,rQ){var re=rQ.elements,rl=this.elements;rS*=.5;var rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=Math.sin(rS),rR=Math.cos(rS);re[0]=rM*rR-rT*ri,re[1]=rd*rR+rU*ri,re[2]=rT*rR+rM*ri,re[3]=rU*rR-rd*ri},rS.rotateZ=function(rS,rQ){var re=rQ.elements,rl=this.elements;rS*=.5;var rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=Math.sin(rS),rR=Math.cos(rS);re[0]=rM*rR+rd*ri,re[1]=rd*rR-rM*ri,re[2]=rT*rR+rU*ri,re[3]=rU*rR-rT*ri},rS.getYawPitchRoll=function(rS){rTQ.transformQuat(rTQ.ForwardRH,this,rM.TEMPVector31),rTQ.transformQuat(rTQ.Up,this,rM.TEMPVector32);var rQ=rM.TEMPVector32.elements;rM.angleTo(rTQ.ZERO,rM.TEMPVector31,rM.TEMPVector33);var re=rM.TEMPVector33.elements;re[0]==Math.PI/2?(re[1]=rM.arcTanAngle(rQ[2],rQ[0]),re[2]=0):re[0]==-Math.PI/2?(re[1]=rM.arcTanAngle(-rQ[2],-rQ[0]),re[2]=0):(rSQ.createRotationY(-re[1],rM.TEMPMatrix0),rSQ.createRotationX(-re[0],rM.TEMPMatrix1),rTQ.transformCoordinate(rM.TEMPVector32,rM.TEMPMatrix0,rM.TEMPVector32),rTQ.transformCoordinate(rM.TEMPVector32,rM.TEMPMatrix1,rM.TEMPVector32),re[2]=rM.arcTanAngle(rQ[1],-rQ[0])),re[1]<=-Math.PI&&(re[1]=Math.PI),re[2]<=-Math.PI&&(re[2]=Math.PI),re[1]>=Math.PI&&re[2]>=Math.PI&&(re[1]=0,re[2]=0,re[0]=Math.PI-re[0]);var rl=rS.elements;rl[0]=re[1],rl[1]=re[0],rl[2]=re[2]},rS.invert=function(rS){var rQ=rS.elements,re=this.elements,rl=re[0],rM=re[1],rd=re[2],rT=re[3],rU=rl*rl+rM*rM+rd*rd+rT*rT,ri=rU?1/rU:0;rQ[0]=-rl*ri,rQ[1]=-rM*ri,rQ[2]=-rd*ri,rQ[3]=rT*ri},rS.identity=function(){var rS=this.elements;rS[0]=0,rS[1]=0,rS[2]=0,rS[3]=1},rS.fromArray=function(rS,rQ){void 0===rQ&&(rQ=0),this.elements[0]=rS[rQ+0],this.elements[1]=rS[rQ+1],this.elements[2]=rS[rQ+2],this.elements[3]=rS[rQ+3]},rS.cloneTo=function(rS){var rQ,re,rl;if((re=this.elements)!==(rl=rS.elements))for(rQ=0;rQ<4;++rQ)rl[rQ]=re[rQ]},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rS.equals=function(rS){var rQ=this.elements,re=rS.elements;return rsS.nearEqual(rQ[0],re[0])&&rsS.nearEqual(rQ[1],re[1])&&rsS.nearEqual(rQ[2],re[2])&&rsS.nearEqual(rQ[3],re[3])},rS.lengthSquared=function(){var rS=this.elements[0],rQ=this.elements[1],re=this.elements[2],rl=this.elements[3];return rS*rS+rQ*rQ+re*re+rl*rl},rL(0,rS,"x",function(){return this.elements[0]}),rL(0,rS,"y",function(){return this.elements[1]}),rL(0,rS,"z",function(){return this.elements[2]}),rL(0,rS,"w",function(){return this.elements[3]}),rM.createFromYawPitchRoll=function(rS,rQ,re,rl){var rM=.5*re,rd=.5*rQ,rT=.5*rS,rU=Math.sin(rM),ri=Math.cos(rM),rR=Math.sin(rd),ro=Math.cos(rd),rY=Math.sin(rT),rp=Math.cos(rT),rJ=rl.elements;rJ[0]=rp*rR*ri+rY*ro*rU,rJ[1]=rY*ro*ri-rp*rR*rU,rJ[2]=rp*ro*rU-rY*rR*ri,rJ[3]=rp*ro*ri+rY*rR*rU},rM.multiply=function(rS,rQ,re){var rl=rS.elements,rM=rQ.elements,rd=re.elements,rT=rl[0],rU=rl[1],ri=rl[2],rR=rl[3],ro=rM[0],rY=rM[1],rp=rM[2],rJ=rM[3],rL=rU*rp-ri*rY,rj=ri*ro-rT*rp,rc=rT*rY-rU*ro,rG=rT*ro+rU*rY+ri*rp;rd[0]=rT*rJ+ro*rR+rL,rd[1]=rU*rJ+rY*rR+rj,rd[2]=ri*rJ+rp*rR+rc,rd[3]=rR*rJ-rG},rM.arcTanAngle=function(rS,rQ){return 0==rS?1==rQ?Math.PI/2:-Math.PI/2:0<rS?Math.atan(rQ/rS):rS<0?0<rQ?Math.atan(rQ/rS)+Math.PI:Math.atan(rQ/rS)-Math.PI:0},rM.angleTo=function(rS,rQ,re){rTQ.subtract(rQ,rS,rM.TEMPVector30),rTQ.normalize(rM.TEMPVector30,rM.TEMPVector30),re.elements[0]=Math.asin(rM.TEMPVector30.y),re.elements[1]=rM.arcTanAngle(-rM.TEMPVector30.z,-rM.TEMPVector30.x)},rM.createFromAxisAngle=function(rS,rQ,re){var rl=re.elements,rM=rS.elements;rQ*=.5;var rd=Math.sin(rQ);rl[0]=rd*rM[0],rl[1]=rd*rM[1],rl[2]=rd*rM[2],rl[3]=Math.cos(rQ)},rM.createFromMatrix3x3=function(rS,rQ){var re,rl=rQ.elements,rM=rS.elements,rd=rM[0]+rM[4]+rM[8];if(0<rd)re=Math.sqrt(rd+1),rl[3]=.5*re,re=.5/re,rl[0]=(rM[5]-rM[7])*re,rl[1]=(rM[6]-rM[2])*re,rl[2]=(rM[1]-rM[3])*re;else{var rT=0;rM[4]>rM[0]&&(rT=1),rM[8]>rM[3*rT+rT]&&(rT=2);var rU=(rT+1)%3,ri=(rT+2)%3;re=Math.sqrt(rM[3*rT+rT]-rM[3*rU+rU]-rM[3*ri+ri]+1),rl[rT]=.5*re,re=.5/re,rl[3]=(rM[3*rU+ri]-rM[3*ri+rU])*re,rl[rU]=(rM[3*rU+rT]+rM[3*rT+rU])*re,rl[ri]=(rM[3*ri+rT]+rM[3*rT+ri])*re}},rM.createFromMatrix4x4=function(rS,rQ){var re,rl,rM=rS.elements,rd=rQ.elements,rT=rM[0]+rM[5]+rM[10];0<rT?(re=Math.sqrt(rT+1),rd[3]=.5*re,re=.5/re,rd[0]=(rM[6]-rM[9])*re,rd[1]=(rM[8]-rM[2])*re,rd[2]=(rM[1]-rM[4])*re):rM[0]>=rM[5]&&rM[0]>=rM[10]?(rl=.5/(re=Math.sqrt(1+rM[0]-rM[5]-rM[10])),rd[0]=.5*re,rd[1]=(rM[1]+rM[4])*rl,rd[2]=(rM[2]+rM[8])*rl,rd[3]=(rM[6]-rM[9])*rl):rM[5]>rM[10]?(rl=.5/(re=Math.sqrt(1+rM[5]-rM[0]-rM[10])),rd[0]=(rM[4]+rM[1])*rl,rd[1]=.5*re,rd[2]=(rM[9]+rM[6])*rl,rd[3]=(rM[8]-rM[2])*rl):(rl=.5/(re=Math.sqrt(1+rM[10]-rM[0]-rM[5])),rd[0]=(rM[8]+rM[2])*rl,rd[1]=(rM[9]+rM[6])*rl,rd[2]=.5*re,rd[3]=(rM[1]-rM[4])*rl)},rM.slerp=function(rS,rQ,re,rl){var rM,rd,rT,rU,ri,rR=rS.elements,ro=rQ.elements,rY=rl.elements,rp=rR[0],rJ=rR[1],rL=rR[2],rj=rR[3],rc=ro[0],rG=ro[1],rz=ro[2],rA=ro[3];return(rd=rp*rc+rJ*rG+rL*rz+rj*rA)<0&&(rd=-rd,rc=-rc,rG=-rG,rz=-rz,rA=-rA),ri=1e-6<1-rd?(rM=Math.acos(rd),rT=Math.sin(rM),rU=Math.sin((1-re)*rM)/rT,Math.sin(re*rM)/rT):(rU=1-re,re),rY[0]=rU*rp+ri*rc,rY[1]=rU*rJ+ri*rG,rY[2]=rU*rL+ri*rz,rY[3]=rU*rj+ri*rA,rY},rM.lerp=function(rS,rQ,re,rl){var rM=rl.elements,rd=rS.elements,rT=rQ.elements,rU=rd[0],ri=rd[1],rR=rd[2],ro=rd[3];rM[0]=rU+re*(rT[0]-rU),rM[1]=ri+re*(rT[1]-ri),rM[2]=rR+re*(rT[2]-rR),rM[3]=ro+re*(rT[3]-ro)},rM.add=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]+rd[0],rl[1]=rM[1]+rd[1],rl[2]=rM[2]+rd[2],rl[3]=rM[3]+rd[3]},rM.dot=function(rS,rQ){var re=rS.elements,rl=rQ.elements;return re[0]*rl[0]+re[1]*rl[1]+re[2]*rl[2]+re[3]*rl[3]},rM.rotationLookAt=function(rS,rQ,re){rM.lookAt(rTQ.ZERO,rS,rQ,re)},rM.lookAt=function(rS,rQ,re,rl){ryS.lookAt(rS,rQ,re,rM._tempMatrix3x3),rM.rotationMatrix(rM._tempMatrix3x3,rl)},rM.invert=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=rS.lengthSquared();rsS.isZero(rM)||(rM=1/rM,rl[0]=-re[0]*rM,rl[1]=-re[1]*rM,rl[2]=-re[2]*rM,rl[3]=re[3]*rM)},rM.rotationMatrix=function(rS,rQ){var re=rS.elements,rl=re[0],rM=re[1],rd=re[2],rT=re[3],rU=re[4],ri=re[5],rR=re[6],ro=re[7],rY=re[8],rp=rQ.elements,rJ=NaN,rL=NaN,rj=rl+rU+rY;0<rj?(rJ=Math.sqrt(rj+1),rp[3]=.5*rJ,rJ=.5/rJ,rp[0]=(ri-ro)*rJ,rp[1]=(rR-rd)*rJ,rp[2]=(rM-rT)*rJ):rU<=rl&&rY<=rl?(rL=.5/(rJ=Math.sqrt(1+rl-rU-rY)),rp[0]=.5*rJ,rp[1]=(rM+rT)*rL,rp[2]=(rd+rR)*rL,rp[3]=(ri-ro)*rL):rY<rU?(rL=.5/(rJ=Math.sqrt(1+rU-rl-rY)),rp[0]=(rT+rM)*rL,rp[1]=.5*rJ,rp[2]=(ro+ri)*rL,rp[3]=(rR-rd)*rL):(rL=.5/(rJ=Math.sqrt(1+rY-rl-rU)),rp[0]=(rR+rd)*rL,rp[1]=(ro+ri)*rL,rp[2]=.5*rJ,rp[3]=(rM-rT)*rL)},rM.DEFAULT=new rM,rY(rM,["TEMPVector30",function(){return this.TEMPVector30=new rTQ},"TEMPVector31",function(){return this.TEMPVector31=new rTQ},"TEMPVector32",function(){return this.TEMPVector32=new rTQ},"TEMPVector33",function(){return this.TEMPVector33=new rTQ},"TEMPMatrix0",function(){return this.TEMPMatrix0=new rSQ},"TEMPMatrix1",function(){return this.TEMPMatrix1=new rSQ},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new ryS},"NAN",function(){return this.NAN=new rM(NaN,NaN,NaN,NaN)}]),rM}(),rlQ=function(){function rS(rS){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=rS,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}rJ(rS,"laya.d3.math.Rand");var rQ=rS.prototype;return rQ.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},rQ.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},rQ.getSignedFloat=function(){return 2*this.getFloat()-1},rL(0,rQ,"seed",function(){return this.seeds[0]},function(rS){this.seeds[0]=rS,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),rS.getFloatFromInt=function(rS){return 1/8388607*(8388607&rS)},rS.getByteFromInt=function(rS){return(8388607&rS)>>>15},rS}(),rMQ=(function(){function rM(rS){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(rS instanceof Array)||4!==rS.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|rS[0],this._state0L=0|rS[1],this._state1U=0|rS[2],this._state1L=0|rS[3]}rJ(rM,"laya.d3.math.RandX");var rS=rM.prototype;rS.randomint=function(){var rS=this._state0U,rQ=this._state0L,re=this._state1U,rl=this._state1L,rM=(rl>>>0)+(rQ>>>0),rd=re+rS+(rM/2>>>31)>>>0,rT=rM>>>0,rU=0,ri=0;rU=(rS^=rU=rS<<23|(-512&rQ)>>>9)^(this._state0U=re),ri=(rQ^=ri=rQ<<23)^(this._state0L=rl);rU^=rS>>>18,ri^=rQ>>>18|(262143&rS)<<14;return rU^=re>>>5,ri^=rl>>>5|(31&re)<<27,this._state1U=rU,this._state1L=ri,[rd,rT]},rS.random=function(){var rS=this.randomint(),rQ=rS[0],re=1023<<20|rQ>>>12,rl=0|(rS[1]>>>12|(4095&rQ)<<20);return rM._CONVERTION_BUFFER.setUint32(0,re,!1),rM._CONVERTION_BUFFER.setUint32(4,rl,!1),rlQ._CONVERTION_BUFFER.getFloat64(0,!1)-1},rY(rM,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new rlQ([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function rS(rS,rQ){this.origin=null,this.direction=null,this.origin=rS,this.direction=rQ}return rJ(rS,"laya.d3.math.Ray"),rS}()),rdQ=function(){function rS(rS,rQ){this.elements=new Float32Array(2),void 0===rS&&(rS=0),void 0===rQ&&(rQ=0);var re=this.elements;re[0]=rS,re[1]=rQ}rJ(rS,"laya.d3.math.Vector2");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.fromArray=function(rS,rQ){void 0===rQ&&(rQ=0),this.elements[0]=rS[rQ+0],this.elements[1]=rS[rQ+1]},rQ.cloneTo=function(rS){var rQ=rS.elements,re=this.elements;rQ[0]=re[0],rQ[1]=re[1]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"x",function(){return this.elements[0]},function(rS){this.elements[0]=rS}),rL(0,rQ,"y",function(){return this.elements[1]},function(rS){this.elements[1]=rS}),rS.scale=function(rS,rQ,re){var rl=re.elements,rM=rS.elements;rl[0]=rM[0]*rQ,rl[1]=rM[1]*rQ},rY(rS,["ZERO",function(){return this.ZERO=new rS(0,0)},"ONE",function(){return this.ONE=new rS(1,1)}]),rS}(),rTQ=function(){function ro(rS,rQ,re){this.elements=new Float32Array(3),void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0);var rl=this.elements;rl[0]=rS,rl[1]=rQ,rl[2]=re}rJ(ro,"laya.d3.math.Vector3");var rS=ro.prototype;return rD.imps(rS,{"laya.d3.core.IClone":!0}),rS.fromArray=function(rS,rQ){void 0===rQ&&(rQ=0),this.elements[0]=rS[rQ+0],this.elements[1]=rS[rQ+1],this.elements[2]=rS[rQ+2]},rS.cloneTo=function(rS){var rQ=rS.elements,re=this.elements;rQ[0]=re[0],rQ[1]=re[1],rQ[2]=re[2]},rS.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rS.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},rS.reset=function(rS,rQ,re){this.elements[0]=rS,this.elements[1]=rQ,this.elements[2]=re},rL(0,rS,"x",function(){return this.elements[0]},function(rS){this.elements[0]=rS}),rL(0,rS,"y",function(){return this.elements[1]},function(rS){this.elements[1]=rS}),rL(0,rS,"z",function(){return this.elements[2]},function(rS){this.elements[2]=rS}),ro.distanceSquared=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0]-rl[0],rd=re[1]-rl[1],rT=re[2]-rl[2];return rM*rM+rd*rd+rT*rT},ro.distance=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0]-rl[0],rd=re[1]-rl[1],rT=re[2]-rl[2];return Math.sqrt(rM*rM+rd*rd+rT*rT)},ro.min=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=Math.min(rM[0],rd[0]),rl[1]=Math.min(rM[1],rd[1]),rl[2]=Math.min(rM[2],rd[2])},ro.max=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=Math.max(rM[0],rd[0]),rl[1]=Math.max(rM[1],rd[1]),rl[2]=Math.max(rM[2],rd[2])},ro.transformQuat=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements,rT=rM[0],rU=rM[1],ri=rM[2],rR=rd[0],ro=rd[1],rY=rd[2],rp=rd[3],rJ=rp*rT+ro*ri-rY*rU,rL=rp*rU+rY*rT-rR*ri,rj=rp*ri+rR*rU-ro*rT,rc=-rR*rT-ro*rU-rY*ri;rl[0]=rJ*rp+rc*-rR+rL*-rY-rj*-ro,rl[1]=rL*rp+rc*-ro+rj*-rR-rJ*-rY,rl[2]=rj*rp+rc*-rY+rJ*-ro-rL*-rR},ro.scalarLength=function(rS){var rQ=rS.elements,re=rQ[0],rl=rQ[1],rM=rQ[2];return Math.sqrt(re*re+rl*rl+rM*rM)},ro.scalarLengthSquared=function(rS){var rQ=rS.elements,re=rQ[0],rl=rQ[1],rM=rQ[2];return re*re+rl*rl+rM*rM},ro.normalize=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0],rd=re[1],rT=re[2],rU=rM*rM+rd*rd+rT*rT;0<rU&&(rU=1/Math.sqrt(rU),rl[0]=re[0]*rU,rl[1]=re[1]*rU,rl[2]=re[2]*rU)},ro.multiply=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]*rd[0],rl[1]=rM[1]*rd[1],rl[2]=rM[2]*rd[2]},ro.scale=function(rS,rQ,re){var rl=re.elements,rM=rS.elements;rl[0]=rM[0]*rQ,rl[1]=rM[1]*rQ,rl[2]=rM[2]*rQ},ro.lerp=function(rS,rQ,re,rl){var rM=rl.elements,rd=rS.elements,rT=rQ.elements,rU=rd[0],ri=rd[1],rR=rd[2];rM[0]=rU+re*(rT[0]-rU),rM[1]=ri+re*(rT[1]-ri),rM[2]=rR+re*(rT[2]-rR)},ro.transformV3ToV3=function(rS,rQ,re){var rl=ro._tempVector4;ro.transformV3ToV4(rS,rQ,rl);var rM=rl.elements,rd=re.elements;rd[0]=rM[0],rd[1]=rM[1],rd[2]=rM[2]},ro.transformV3ToV4=function(rS,rQ,re){var rl=rS.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=rQ.elements,ri=re.elements;ri[0]=rM*rU[0]+rd*rU[4]+rT*rU[8]+rU[12],ri[1]=rM*rU[1]+rd*rU[5]+rT*rU[9]+rU[13],ri[2]=rM*rU[2]+rd*rU[6]+rT*rU[10]+rU[14],ri[3]=rM*rU[3]+rd*rU[7]+rT*rU[11]+rU[15]},ro.TransformNormal=function(rS,rQ,re){var rl=rS.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=rQ.elements,ri=re.elements;ri[0]=rM*rU[0]+rd*rU[4]+rT*rU[8],ri[1]=rM*rU[1]+rd*rU[5]+rT*rU[9],ri[2]=rM*rU[2]+rd*rU[6]+rT*rU[10]},ro.transformCoordinate=function(rS,rQ,re){var rl=ro._tempVector4.elements,rM=rS.elements,rd=rM[0],rT=rM[1],rU=rM[2],ri=rQ.elements;rl[0]=rd*ri[0]+rT*ri[4]+rU*ri[8]+ri[12],rl[1]=rd*ri[1]+rT*ri[5]+rU*ri[9]+ri[13],rl[2]=rd*ri[2]+rT*ri[6]+rU*ri[10]+ri[14],rl[3]=1/(rd*ri[3]+rT*ri[7]+rU*ri[11]+ri[15]);var rR=re.elements;rR[0]=rl[0]*rl[3],rR[1]=rl[1]*rl[3],rR[2]=rl[2]*rl[3]},ro.Clamp=function(rS,rQ,re,rl){var rM=rS.elements,rd=rM[0],rT=rM[1],rU=rM[2],ri=rQ.elements,rR=ri[0],ro=ri[1],rY=ri[2],rp=re.elements,rJ=rp[0],rL=rp[1],rj=rp[2],rc=rl.elements;rd=(rd=rJ<rd?rJ:rd)<rR?rR:rd,rT=(rT=rL<rT?rL:rT)<ro?ro:rT,rU=(rU=rj<rU?rj:rU)<rY?rY:rU,rc[0]=rd,rc[1]=rT,rc[2]=rU},ro.add=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]+rd[0],rl[1]=rM[1]+rd[1],rl[2]=rM[2]+rd[2]},ro.subtract=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]-rd[0],rl[1]=rM[1]-rd[1],rl[2]=rM[2]-rd[2]},ro.cross=function(rS,rQ,re){var rl=rS.elements,rM=rQ.elements,rd=re.elements,rT=rl[0],rU=rl[1],ri=rl[2],rR=rM[0],ro=rM[1],rY=rM[2];rd[0]=rU*rY-ri*ro,rd[1]=ri*rR-rT*rY,rd[2]=rT*ro-rU*rR},ro.dot=function(rS,rQ){var re=rS.elements,rl=rQ.elements;return re[0]*rl[0]+re[1]*rl[1]+re[2]*rl[2]},ro.equals=function(rS,rQ){var re=rS.elements,rl=rQ.elements;return rsS.nearEqual(Math.abs(re[0]),Math.abs(rl[0]))&&rsS.nearEqual(Math.abs(re[1]),Math.abs(rl[1]))&&rsS.nearEqual(Math.abs(re[2]),Math.abs(rl[2]))},ro.ZERO=new ro(0,0,0),ro.ONE=new ro(1,1,1),ro.NegativeUnitX=new ro(-1,0,0),ro.UnitX=new ro(1,0,0),ro.UnitY=new ro(0,1,0),ro.UnitZ=new ro(0,0,1),ro.ForwardRH=new ro(0,0,-1),ro.ForwardLH=new ro(0,0,1),ro.Up=new ro(0,1,0),ro.NAN=new ro(NaN,NaN,NaN),rY(ro,["_tempVector4",function(){return this._tempVector4=new rUQ}]),ro}(),rUQ=function(){function rS(rS,rQ,re,rl){this.elements=new Float32Array(4),void 0===rS&&(rS=0),void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=0);var rM=this.elements;rM[0]=rS,rM[1]=rQ,rM[2]=re,rM[3]=rl}rJ(rS,"laya.d3.math.Vector4");var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ.fromArray=function(rS,rQ){void 0===rQ&&(rQ=0),this.elements[0]=rS[rQ+0],this.elements[1]=rS[rQ+1],this.elements[2]=rS[rQ+2],this.elements[3]=rS[rQ+3]},rQ.cloneTo=function(rS){var rQ=rS.elements,re=this.elements;rQ[0]=re[0],rQ[1]=re[1],rQ[2]=re[2],rQ[3]=re[3]},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rQ.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},rQ.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},rL(0,rQ,"x",function(){return this.elements[0]},function(rS){this.elements[0]=rS}),rL(0,rQ,"y",function(){return this.elements[1]},function(rS){this.elements[1]=rS}),rL(0,rQ,"z",function(){return this.elements[2]},function(rS){this.elements[2]=rS}),rL(0,rQ,"w",function(){return this.elements[3]},function(rS){this.elements[3]=rS}),rS.lerp=function(rS,rQ,re,rl){var rM=rl.elements,rd=rS.elements,rT=rQ.elements,rU=rd[0],ri=rd[1],rR=rd[2],ro=rd[3];rM[0]=rU+re*(rT[0]-rU),rM[1]=ri+re*(rT[1]-ri),rM[2]=rR+re*(rT[2]-rR),rM[3]=ro+re*(rT[3]-ro)},rS.transformByM4x4=function(rS,rQ,re){var rl=rS.elements,rM=rl[0],rd=rl[1],rT=rl[2],rU=rl[3],ri=rQ.elements,rR=re.elements;rR[0]=rM*ri[0]+rd*ri[4]+rT*ri[8]+rU*ri[12],rR[1]=rM*ri[1]+rd*ri[5]+rT*ri[9]+rU*ri[13],rR[2]=rM*ri[2]+rd*ri[6]+rT*ri[10]+rU*ri[14],rR[3]=rM*ri[3]+rd*ri[7]+rT*ri[11]+rU*ri[15]},rS.equals=function(rS,rQ){var re=rS.elements,rl=rQ.elements;return rsS.nearEqual(Math.abs(re[0]),Math.abs(rl[0]))&&rsS.nearEqual(Math.abs(re[1]),Math.abs(rl[1]))&&rsS.nearEqual(Math.abs(re[2]),Math.abs(rl[2]))&&rsS.nearEqual(Math.abs(re[3]),Math.abs(rl[3]))},rS.normalize=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=rS.length();0<rM&&(rl[0]=re[0]*rM,rl[1]=re[1]*rM,rl[2]=re[2]*rM,rl[3]=re[3]*rM)},rS.add=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]+rd[0],rl[1]=rM[1]+rd[1],rl[2]=rM[2]+rd[2],rl[3]=rM[3]+rd[3]},rS.subtract=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]-rd[0],rl[1]=rM[1]-rd[1],rl[2]=rM[2]-rd[2],rl[3]=rM[3]-rd[3]},rS.multiply=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=rM[0]*rd[0],rl[1]=rM[1]*rd[1],rl[2]=rM[2]*rd[2],rl[3]=rM[3]*rd[3]},rS.scale=function(rS,rQ,re){var rl=re.elements,rM=rS.elements;rl[0]=rM[0]*rQ,rl[1]=rM[1]*rQ,rl[2]=rM[2]*rQ,rl[3]=rM[3]*rQ},rS.Clamp=function(rS,rQ,re,rl){var rM=rS.elements,rd=rM[0],rT=rM[1],rU=rM[2],ri=rM[3],rR=rQ.elements,ro=rR[0],rY=rR[1],rp=rR[2],rJ=rR[3],rL=re.elements,rj=rL[0],rc=rL[1],rG=rL[2],rz=rL[3],rA=rl.elements;rd=(rd=rj<rd?rj:rd)<ro?ro:rd,rT=(rT=rc<rT?rc:rT)<rY?rY:rT,rU=(rU=rG<rU?rG:rU)<rp?rp:rU,ri=(ri=rz<ri?rz:ri)<rJ?rJ:ri,rA[0]=rd,rA[1]=rT,rA[2]=rU,rA[3]=ri},rS.distanceSquared=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0]-rl[0],rd=re[1]-rl[1],rT=re[2]-rl[2],rU=re[3]-rl[3];return rM*rM+rd*rd+rT*rT+rU*rU},rS.distance=function(rS,rQ){var re=rS.elements,rl=rQ.elements,rM=re[0]-rl[0],rd=re[1]-rl[1],rT=re[2]-rl[2],rU=re[3]-rl[3];return Math.sqrt(rM*rM+rd*rd+rT*rT+rU*rU)},rS.dot=function(rS,rQ){var re=rS.elements,rl=rQ.elements;return re[0]*rl[0]+re[1]*rl[1]+re[2]*rl[2]+re[3]*rl[3]},rS.min=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=Math.min(rM[0],rd[0]),rl[1]=Math.min(rM[1],rd[1]),rl[2]=Math.min(rM[2],rd[2]),rl[3]=Math.min(rM[3],rd[3])},rS.max=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ.elements;rl[0]=Math.max(rM[0],rd[0]),rl[1]=Math.max(rM[1],rd[1]),rl[2]=Math.max(rM[2],rd[2]),rl[3]=Math.max(rM[3],rd[3])},rY(rS,["ZERO",function(){return this.ZERO=new rS},"ONE",function(){return this.ONE=new rS(1,1,1,1)},"UnitX",function(){return this.UnitX=new rS(1,0,0,0)},"UnitY",function(){return this.UnitY=new rS(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new rS(0,0,1,0)},"UnitW",function(){return this.UnitW=new rS(0,0,0,1)}]),rS}(),riQ=function(){function rd(rS,rQ,re,rl){this.minDepth=0,this.maxDepth=1,this.x=rS,this.y=rQ,this.width=re,this.height=rl}rJ(rd,"laya.d3.math.Viewport");var rS=rd.prototype;return rS.project=function(rS,rQ,re){rTQ.transformV3ToV3(rS,rQ,re);var rl=rS.elements,rM=rQ.elements,rd=re.elements,rT=rl[0]*rM[3]+rl[1]*rM[7]+rl[2]*rM[11]+rM[15];1!==rT&&(rd[0]=rd[0]/rT,rd[1]=rd[1]/rT,rd[2]=rd[2]/rT),rd[0]=.5*(rd[0]+1)*this.width+this.x,rd[1]=.5*(1-rd[1])*this.height+this.y,rd[2]=rd[2]*(this.maxDepth-this.minDepth)+this.minDepth},rS.unprojectFromMat=function(rS,rQ,re){var rl=rS.elements,rM=rQ.elements,rd=re.elements;rd[0]=(rl[0]-this.x)/this.width*2-1,rd[1]=-((rl[1]-this.y)/this.height*2-1);var rT=(this.maxDepth-this.minDepth)/2;rd[2]=(rl[2]-this.minDepth-rT)/rT;var rU=rd[0]*rM[3]+rd[1]*rM[7]+rd[2]*rM[11]+rM[15];rTQ.transformV3ToV3(re,rQ,re),1!==rU&&(rd[0]=rd[0]/rU,rd[1]=rd[1]/rU,rd[2]=rd[2]/rU)},rS.unprojectFromWVP=function(rS,rQ,re,rl,rM){rSQ.multiply(rQ,re,rd._tempMatrix4x4),rl&&rSQ.multiply(rd._tempMatrix4x4,rl,rd._tempMatrix4x4),rd._tempMatrix4x4.invert(rd._tempMatrix4x4),this.unprojectFromMat(rS,rd._tempMatrix4x4,rM)},rY(rd,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new rSQ}]),rd}(),rRQ=function(){function rt(rS){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=rS,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}rJ(rt,"laya.d3.resource.models.SubMesh");var rS=rt.prototype;return rD.imps(rS,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),rS._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),0===rS?this._vertexBuffer:null},rS._getIndexBuffer=function(){return this._indexBuffer},rS._getStaticBatchBakedVertexs=function(rS,rQ){var re,rl,rM=this._vertexBuffer,rd=rM.vertexDeclaration,rT=rd.getVertexElementByUsage(0).offset/4,rU=rd.getVertexElementByUsage(3).offset/4,ri=rQ.meshRender.lightmapScaleOffset,rR=0,ro=0,rY=0,rp=0,rJ=0,rL=0;if(ri)if(rl=rd.getVertexElementByUsage(15))rY=rd.vertexStride/4,re=0<this._vertexCount?rM.getData().slice(this._vertexStart*rY,(this._vertexStart+this._vertexCount)*rY):rM.getData().slice(),rp=rl.offset/4;else{rY=(rL=rd.vertexStride/4)+2,re=this._vertexCount?new Float32Array(this._vertexCount*(rM.vertexDeclaration.vertexStride/4+2)):new Float32Array(rM.vertexCount*(rM.vertexDeclaration.vertexStride/4+2)),rp=(rJ=rd.getVertexElementByUsage(2).offset/4)+2;var rj=rM.getData();for(rR=0,ro=rj.length/rL;rR<ro;rR++){var rc=0;rc=0<this._vertexCount?(this._vertexStart+rR)*rL:rR*rL;var rG=rR*rY,rz=0;for(rz=0;rz<rp;rz++)re[rG+rz]=rj[rc+rz];for(rz=rp;rz<rL;rz++)re[rG+rz+2]=rj[rc+rz]}}else rY=rd.vertexStride/4,re=this._vertexCount?rM.getData().slice(this._vertexStart*rY,(this._vertexStart+this._vertexCount)*rY):rM.getData().slice();if(rS){var rA=rS.worldMatrix,rv=rt._tempMatrix4x40;rA.invert(rv);var rD=rt._tempMatrix4x41,rB=rQ.transform.worldMatrix;rSQ.multiply(rv,rB,rD)}else rD=rQ.transform.worldMatrix;var rO=rt._tempQuaternion0;for(rD.decomposeTransRotScale(rt._tempVector30,rO,rt._tempVector31),rR=0,ro=re.length/rY;rR<ro;rR++){var rH=rR*rY+rT,rg=rR*rY+rU;if(rcQ.transformVector3ArrayToVector3ArrayCoordinate(re,rH,rD,re,rH),rcQ.transformVector3ArrayByQuat(re,rg,rO,re,rg),ri){var rI=rR*rY+rp;if(rl)rcQ.transformLightingMapTexcoordByUV1Array(re,rI,ri,re,rI);else{var rE=rR*rL+rJ;rcQ.transformLightingMapTexcoordByUV0Array(rj,rE,ri,re,rI)}}}return re},rS._getVertexBuffers=function(){return null},rS._beforeRender=function(rS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},rS._render=function(rS){var rQ,re=0,rl=rS.renderElement;if(1<this._indexCount){var rM=this._boneIndicesList.length;if(1<rM){for(var rd=0;rd<rM;rd++)(rQ=rl._skinAnimationDatas||this._skinAnimationDatas)&&(rl._shaderValue.setValue(0,rQ[rd]),rS._shader.uploadRenderElementUniforms(rl._shaderValue.data)),rk.mainContext.drawElements(4,this._subIndexBufferCount[rd],5123,2*this._subIndexBufferStart[rd]);rH.drawCall+=rM}else(rQ=rl._skinAnimationDatas||this._skinAnimationDatas)&&(rl._shaderValue.setValue(0,rQ[0]),rS._shader.uploadRenderElementUniforms(rl._shaderValue.data)),rk.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),rH.drawCall++;re=this._indexCount}else re=this._indexBuffer.indexCount,(rQ=rl._skinAnimationDatas||this._skinAnimationDatas)&&(rl._shaderValue.setValue(0,rQ[0]),rS._shader.uploadRenderElementUniforms(rl._shaderValue.data)),rk.mainContext.drawElements(4,re,5123,0),rH.drawCall++;rH.trianglesFaces+=re/3},rS.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},rS.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},rL(0,rS,"_vertexBufferCount",function(){return 1}),rL(0,rS,"triangleCount",function(){return this._indexBuffer.indexCount/3}),rY(rt,["_tempVector30",function(){return this._tempVector30=new rTQ},"_tempVector31",function(){return this._tempVector31=new rTQ},"_tempQuaternion0",function(){return this._tempQuaternion0=new reQ},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new rSQ},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new rSQ}]),rt}(),roQ=function(){function rS(rS){this.defineCounter=0,this.defines=null,rS?(this.defineCounter=rS.defineCounter,this.defines=rS.defines.slice()):(this.defineCounter=0,this.defines=[])}return rJ(rS,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),rS.prototype.registerDefine=function(rS){var rQ=Math.pow(2,this.defineCounter++);return this.defines[rQ]=rS,rQ},rS}(),rYQ=function(){function rS(){}return rJ(rS,"laya.d3.shader.ShaderInit3D"),rS.__init__=function(){var rS,rQ;rHQ._globalRegDefine("HIGHPRECISION",rHQ.SHADERDEFINE_HIGHPRECISION),rHQ._globalRegDefine("FOG",rHQ.SHADERDEFINE_FOG),rHQ._globalRegDefine("DIRECTIONLIGHT",rHQ.SHADERDEFINE_DIRECTIONLIGHT),rHQ._globalRegDefine("POINTLIGHT",rHQ.SHADERDEFINE_POINTLIGHT),rHQ._globalRegDefine("SPOTLIGHT",rHQ.SHADERDEFINE_SPOTLIGHT),rHQ._globalRegDefine("UV",rHQ.SHADERDEFINE_UV0),rHQ._globalRegDefine("COLOR",rHQ.SHADERDEFINE_COLOR),rHQ._globalRegDefine("UV1",rHQ.SHADERDEFINE_UV1),rHQ._globalRegDefine("CASTSHADOW",rJQ.SHADERDEFINE_CAST_SHADOW),rHQ._globalRegDefine("SHADOWMAP_PSSM1",rJQ.SHADERDEFINE_SHADOW_PSSM1),rHQ._globalRegDefine("SHADOWMAP_PSSM2",rJQ.SHADERDEFINE_SHADOW_PSSM2),rHQ._globalRegDefine("SHADOWMAP_PSSM3",rJQ.SHADERDEFINE_SHADOW_PSSM3),rHQ._globalRegDefine("SHADOWMAP_PCF_NO",rJQ.SHADERDEFINE_SHADOW_PCF_NO),rHQ._globalRegDefine("SHADOWMAP_PCF1",rJQ.SHADERDEFINE_SHADOW_PCF1),rHQ._globalRegDefine("SHADOWMAP_PCF2",rJQ.SHADERDEFINE_SHADOW_PCF2),rHQ._globalRegDefine("SHADOWMAP_PCF3",rJQ.SHADERDEFINE_SHADOW_PCF3),rHQ._globalRegDefine("DEPTHFOG",rHQ.SAHDERDEFINE_DEPTHFOG),rnQ.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),rnQ.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),rS={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},rQ={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var re=rnQ.nameKey.add("SIMPLE");shaderCompile=rHQ.add(re,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',rS,rQ),rPQ.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),rPQ.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),rPQ.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),rPQ.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),rPQ.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),rPQ.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),rPQ.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),rPQ.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),rPQ.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},rS}(),rpQ=function(){function rS(){this._data=null,this._data=[]}rJ(rS,"laya.d3.shader.ValusArray");var rQ=rS.prototype;return rQ.setValue=function(rS,rQ){this._data[rS]=rQ},rL(0,rQ,"data",function(){return this._data}),rS}(),rJQ=function(){function rS(){}return rS.SHADERDEFINE_RECEIVE_SHADOW=1,rS.SHADERDEFINE_CAST_SHADOW=512,rS.SHADERDEFINE_SHADOW_PSSM1=1024,rS.SHADERDEFINE_SHADOW_PSSM2=2048,rS.SHADERDEFINE_SHADOW_PSSM3=4096,rS.SHADERDEFINE_SHADOW_PCF_NO=8192,rS.SHADERDEFINE_SHADOW_PCF1=16384,rS.SHADERDEFINE_SHADOW_PCF2=32768,rS.SHADERDEFINE_SHADOW_PCF3=65536,rS.MAX_PSSM_COUNT=3,rS}(),rLQ=function(){function rN(){}return rJ(rN,"laya.d3.utils.Picker"),rN.calculateCursorRay=function(rS,rQ,re,rl,rM,rd){var rT=rS.elements[0],rU=rS.elements[1],ri=rN._tempVector30,rR=ri.elements;rR[0]=rT,rR[1]=rU,rR[2]=rQ.minDepth;var ro=rN._tempVector31,rY=ro.elements;rY[0]=rT,rY[1]=rU,rY[2]=rQ.maxDepth;var rp=rd.origin,rJ=rN._tempVector32;rQ.unprojectFromWVP(ri,re,rl,rM,rp),rQ.unprojectFromWVP(ro,re,rl,rM,rJ);var rL=rd.direction.elements;rL[0]=rJ.x-rp.x,rL[1]=rJ.y-rp.y,rL[2]=rJ.z-rp.z,rTQ.normalize(rd.direction,rd.direction)},rN.rayIntersectsPositionsAndIndices=function(rS,rQ,re,rl,rM){for(var rd=re.vertexStride/4,rT=re.getVertexElementByUsage(0).offset/4,rU=Number.MAX_VALUE,ri=-1,rR=-1,ro=-1,rY=0;rY<rl.length;rY+=3){var rp=rN._tempVector35,rJ=rp.elements,rL=rl[rY]*rd,rj=rL+rT;rJ[0]=rQ[rj],rJ[1]=rQ[1+rj],rJ[2]=rQ[2+rj];var rc=rN._tempVector36,rG=rc.elements,rz=rl[rY+1]*rd,rA=rz+rT;rG[0]=rQ[rA],rG[1]=rQ[1+rA],rG[2]=rQ[2+rA];var rv=rN._tempVector37,rD=rv.elements,rB=rl[rY+2]*rd,rO=rB+rT;rD[0]=rQ[rO],rD[1]=rQ[1+rO],rD[2]=rQ[2+rO];var rH=laya.d3.utils.Picker.rayIntersectsTriangle(rS,rp,rc,rv);!isNaN(rH)&&rH<rU&&(rU=rH,ri=rL,rR=rz,ro=rB)}if(rU===Number.MAX_VALUE)return rM.position.toDefault(),rM.distance=Number.MAX_VALUE,rM.trianglePositions[0].toDefault(),rM.trianglePositions[1].toDefault(),rM.trianglePositions[2].toDefault(),rM.triangleNormals[0].toDefault(),rM.triangleNormals[1].toDefault(),rM.triangleNormals[2].toDefault(),!1;rM.distance=rU,rTQ.scale(rS.direction,rU,rM.position),rTQ.add(rS.origin,rM.position,rM.position);var rg=rM.trianglePositions,rI=rg[0],rE=rg[1],rt=rg[2],rk=rI.elements,rX=rE.elements,rh=rt.elements,rb=ri+rT;rk[0]=rQ[rb],rk[1]=rQ[rb+1],rk[2]=rQ[rb+2];var rm=rR+rT;rX[0]=rQ[rm],rX[1]=rQ[rm+1],rX[2]=rQ[rm+2];var r$=ro+rT;rh[0]=rQ[r$],rh[1]=rQ[r$+1],rh[2]=rQ[r$+2];var rn=re.getVertexElementByUsage(3);if(rn){var rP=rn.offset/4,ra=rM.triangleNormals,rf=ra[0],rw=ra[1],ru=ra[2],rr=rf.elements,rW=rw.elements,rx=ru.elements,rF=ri+rP;rr[0]=rQ[rF],rr[1]=rQ[rF+1],rr[2]=rQ[rF+2];var rq=rR+rP;rW[0]=rQ[rq],rW[1]=rQ[rq+1],rW[2]=rQ[rq+2];var rZ=ro+rP;rx[0]=rQ[rZ],rx[1]=rQ[rZ+1],rx[2]=rQ[rZ+2]}return!0},rN.rayIntersectsTriangle=function(rS,rQ,re,rl){var rM=rN._tempVector30,rd=rN._tempVector31;rTQ.subtract(re,rQ,rM),rTQ.subtract(rl,rQ,rd);var rT,rU=rN._tempVector32;if(rTQ.cross(rS.direction,rd,rU),(rT=rTQ.dot(rM,rU))>-Number.MIN_VALUE&&rT<Number.MIN_VALUE)return Number.NaN;var ri,rR=1/rT,ro=rN._tempVector33;if(rTQ.subtract(rS.origin,rQ,ro),ri=rTQ.dot(ro,rU),(ri*=rR)<0||1<ri)return Number.NaN;var rY,rp,rJ=rN._tempVector34;return rTQ.cross(ro,rM,rJ),rY=rTQ.dot(rS.direction,rJ),(rY*=rR)<0||1<ri+rY?Number.NaN:(rp=rTQ.dot(rd,rJ),(rp*=rR)<0?Number.NaN:rp)},rY(rN,["_tempVector30",function(){return this._tempVector30=new rTQ},"_tempVector31",function(){return this._tempVector31=new rTQ},"_tempVector32",function(){return this._tempVector32=new rTQ},"_tempVector33",function(){return this._tempVector33=new rTQ},"_tempVector34",function(){return this._tempVector34=new rTQ},"_tempVector35",function(){return this._tempVector35=new rTQ},"_tempVector36",function(){return this._tempVector36=new rTQ},"_tempVector37",function(){return this._tempVector37=new rTQ}]),rN}(),rjQ=(function(){function rS(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new rTQ,new rTQ,new rTQ],this.trianglePositions.length=3,this.triangleNormals=[new rTQ,new rTQ,new rTQ],this.triangleNormals.length=3,this.position=new rTQ}rJ(rS,"laya.d3.utils.RaycastHit"),rS.prototype.cloneTo=function(rS){rS.distance=this.distance,this.trianglePositions[0].cloneTo(rS.trianglePositions[0]),this.trianglePositions[1].cloneTo(rS.trianglePositions[1]),this.trianglePositions[2].cloneTo(rS.trianglePositions[2]),this.triangleNormals[0].cloneTo(rS.triangleNormals[0]),this.triangleNormals[1].cloneTo(rS.triangleNormals[1]),this.triangleNormals[2].cloneTo(rS.triangleNormals[2]),this.position.cloneTo(rS.position),rS.sprite3D=this.sprite3D}}(),function(){function rS(rS,rQ){this._width=0,this._height=0,this._width=rS,this._height=rQ}rJ(rS,"laya.d3.utils.Size");var rQ=rS.prototype;return rL(0,rQ,"width",function(){return-1===this._width?rC.clientWidth:this._width}),rL(0,rQ,"height",function(){return-1===this._height?rC.clientHeight:this._height}),rL(1,rS,"fullScreen",function(){return new rS(-1,-1)}),rS}()),rcQ=function(){function rb(){}return rJ(rb,"laya.d3.utils.Utils3D"),rb._rotationTransformScaleSkinAnimation=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY){var rp,rJ,rL,rj,rc,rG=rb._tempArray16_0,rz=rb._tempArray16_1,rA=rb._tempArray16_2,rv=rl+rl,rD=rM+rM,rB=rd+rd,rO=rl*rv,rH=rM*rv,rg=rM*rD,rI=rd*rv,rE=rd*rD,rt=rd*rB,rk=rT*rv,rX=rT*rD,rh=rT*rB;for(rG[15]=1,rG[0]=1-rg-rt,rG[1]=rH+rh,rG[2]=rI-rX,rG[4]=rH-rh,rG[5]=1-rO-rt,rG[6]=rE+rk,rG[8]=rI+rX,rG[9]=rE-rk,rG[10]=1-rO-rg,rz[15]=1,rz[0]=rU,rz[5]=ri,rz[10]=rR,rp=0;rp<4;rp++)rJ=rG[rp],rL=rG[rp+4],rj=rG[rp+8],rc=rG[rp+12],rA[rp]=rJ,rA[rp+4]=rL,rA[rp+8]=rj,rA[rp+12]=rJ*rS+rL*rQ+rj*re+rc;for(rp=0;rp<4;rp++)rJ=rA[rp],rL=rA[rp+4],rj=rA[rp+8],rc=rA[rp+12],ro[rp+rY]=rJ*rz[0]+rL*rz[1]+rj*rz[2]+rc*rz[3],ro[rp+rY+4]=rJ*rz[4]+rL*rz[5]+rj*rz[6]+rc*rz[7],ro[rp+rY+8]=rJ*rz[8]+rL*rz[9]+rj*rz[10]+rc*rz[11],ro[rp+rY+12]=rJ*rz[12]+rL*rz[13]+rj*rz[14]+rc*rz[15]},rb._createNodeByJson=function(rS,rQ,re,rl){if(!re)switch(rQ.type){case"Sprite3D":re=new r$Q;break;case"MeshSprite3D":re=new rNQ;break;case"SkinnedMeshSprite3D":re=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":re=new ShuriKenParticle3D;break;case"TrailSprite3D":re=new TrailSprite3D;break;case"Terrain":re=new Terrain;break;case"Camera":re=new rZQ;break;case"DirectionLight":re=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var rM=rQ.props;if(rM)for(var rd in rM)re[rd]=rM[rd];var rT=rQ.customProps;rT&&(re instanceof laya.d3.core.Sprite3D?(re._parseBaseCustomProps(rT),re._parseCustomProps(rS,rl,rT,rQ),re._parseCustomComponent(rS,rl,rQ.components)):re._parseCustomProps(rS,rl,rT,rQ));var rU=rQ.child;if(rU)for(var ri=0,rR=rU.length;ri<rR;ri++){var ro=rb._createNodeByJson(rS,rU[ri],null,rl);re.addChild(ro)}return re},rb._computeBoneAndAnimationDatasByBindPoseMatrxix=function(rS,rQ,re,rl,rM,rd){var rT,rU,ri=0,rR=0,ro=rS.length;for(rT=0;rT<ro;ri+=rS[rT].keyframeWidth,rR+=16,rT++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(rQ[ri+0],rQ[ri+1],rQ[ri+2],rQ[ri+3],rQ[ri+4],rQ[ri+5],rQ[ri+6],rQ[ri+7],rQ[ri+8],rQ[ri+9],rl,rR),0!=rT&&(rU=16*rS[rT].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(rl,rU,rl,rR,rl,rR));var rY=re.length;for(rT=0;rT<rY;rT++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(rl,16*rd[rT],re[rT],rM,16*rT)},rb._computeAnimationDatasByArrayAndMatrixFast=function(rS,rQ,re,rl){for(var rM=0,rd=rS.length;rM<rd;rM++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(rQ,16*rl[rM],rS[rM],re,16*rM)},rb._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(rS,rQ,re,rl,rM){var rd,rT,rU=0,ri=0,rR=rS.length;for(rd=0;rd<rR;rU+=rS[rd].keyframeWidth,ri+=16,rd++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(rQ[rU+7],rQ[rU+8],rQ[rU+9],rQ[rU+3],rQ[rU+4],rQ[rU+5],rQ[rU+6],rQ[rU+0],rQ[rU+1],rQ[rU+2],rl,ri),0!=rd&&(rT=16*rS[rd].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(rl,rT,rl,ri,rl,ri));var ro=re.length;for(rd=0;rd<ro;rd++){var rY=16*rd;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(rl,rY,re[rd],rM,rY)}},rb._computeAnimationDatasByArrayAndMatrixFastOld=function(rS,rQ,re){for(var rl=rS.length,rM=0;rM<rl;rM++){var rd=16*rM;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(rQ,rd,rS[rM],re,rd)}},rb._computeRootAnimationData=function(rS,rQ,re){for(var rl=0,rM=0,rd=0,rT=rS.length;rl<rT;rM+=rS[rl].keyframeWidth,rd+=16,rl++)laya.d3.utils.Utils3D.createAffineTransformationArray(rQ[rM+0],rQ[rM+1],rQ[rM+2],rQ[rM+3],rQ[rM+4],rQ[rM+5],rQ[rM+6],rQ[rM+7],rQ[rM+8],rQ[rM+9],re,rd)},rb.transformVector3ArrayByQuat=function(rS,rQ,re,rl,rM){var rd=re.elements,rT=rS[rQ],rU=rS[rQ+1],ri=rS[rQ+2],rR=rd[0],ro=rd[1],rY=rd[2],rp=rd[3],rJ=rp*rT+ro*ri-rY*rU,rL=rp*rU+rY*rT-rR*ri,rj=rp*ri+rR*rU-ro*rT,rc=-rR*rT-ro*rU-rY*ri;rl[rM]=rJ*rp+rc*-rR+rL*-rY-rj*-ro,rl[rM+1]=rL*rp+rc*-ro+rj*-rR-rJ*-rY,rl[rM+2]=rj*rp+rc*-rY+rJ*-ro-rL*-rR},rb.mulMatrixByArray=function(rS,rQ,re,rl,rM,rd){var rT,rU,ri,rR,ro;if(rM===re){for(re=rb._tempArray16_3,rT=0;rT<16;++rT)re[rT]=rM[rd+rT];rl=0}for(rT=0;rT<4;rT++)rU=rS[rQ+rT],ri=rS[rQ+rT+4],rR=rS[rQ+rT+8],ro=rS[rQ+rT+12],rM[rd+rT]=rU*re[rl+0]+ri*re[rl+1]+rR*re[rl+2]+ro*re[rl+3],rM[rd+rT+4]=rU*re[rl+4]+ri*re[rl+5]+rR*re[rl+6]+ro*re[rl+7],rM[rd+rT+8]=rU*re[rl+8]+ri*re[rl+9]+rR*re[rl+10]+ro*re[rl+11],rM[rd+rT+12]=rU*re[rl+12]+ri*re[rl+13]+rR*re[rl+14]+ro*re[rl+15]},rb.mulMatrixByArrayFast=function(rS,rQ,re,rl,rM,rd){var rT,rU,ri,rR,ro;for(rT=0;rT<4;rT++)rU=rS[rQ+rT],ri=rS[rQ+rT+4],rR=rS[rQ+rT+8],ro=rS[rQ+rT+12],rM[rd+rT]=rU*re[rl+0]+ri*re[rl+1]+rR*re[rl+2]+ro*re[rl+3],rM[rd+rT+4]=rU*re[rl+4]+ri*re[rl+5]+rR*re[rl+6]+ro*re[rl+7],rM[rd+rT+8]=rU*re[rl+8]+ri*re[rl+9]+rR*re[rl+10]+ro*re[rl+11],rM[rd+rT+12]=rU*re[rl+12]+ri*re[rl+13]+rR*re[rl+14]+ro*re[rl+15]},rb.mulMatrixByArrayAndMatrixFast=function(rS,rQ,re,rl,rM){var rd,rT,rU,ri,rR,ro=re.elements,rY=ro[0],rp=ro[1],rJ=ro[2],rL=ro[3],rj=ro[4],rc=ro[5],rG=ro[6],rz=ro[7],rA=ro[8],rv=ro[9],rD=ro[10],rB=ro[11],rO=ro[12],rH=ro[13],rg=ro[14],rI=ro[15],rE=rQ,rt=rQ+4,rk=rQ+8,rX=rQ+12,rh=rM,rb=rM+4,rm=rM+8,r$=rM+12;for(rd=0;rd<4;rd++)rT=rS[rE+rd],rU=rS[rt+rd],ri=rS[rk+rd],rR=rS[rX+rd],rl[rh+rd]=rT*rY+rU*rp+ri*rJ+rR*rL,rl[rb+rd]=rT*rj+rU*rc+ri*rG+rR*rz,rl[rm+rd]=rT*rA+rU*rv+ri*rD+rR*rB,rl[r$+rd]=rT*rO+rU*rH+ri*rg+rR*rI},rb.createAffineTransformationArray=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY){var rp=rl+rl,rJ=rM+rM,rL=rd+rd,rj=rl*rp,rc=rl*rJ,rG=rl*rL,rz=rM*rJ,rA=rM*rL,rv=rd*rL,rD=rT*rp,rB=rT*rJ,rO=rT*rL;ro[rY+0]=(1-(rz+rv))*rU,ro[rY+1]=(rc+rO)*rU,ro[rY+2]=(rG-rB)*rU,ro[rY+3]=0,ro[rY+4]=(rc-rO)*ri,ro[rY+5]=(1-(rj+rv))*ri,ro[rY+6]=(rA+rD)*ri,ro[rY+7]=0,ro[rY+8]=(rG+rB)*rR,ro[rY+9]=(rA-rD)*rR,ro[rY+10]=(1-(rj+rz))*rR,ro[rY+11]=0,ro[rY+12]=rS,ro[rY+13]=rQ,ro[rY+14]=re,ro[rY+15]=1},rb.transformVector3ArrayToVector3ArrayCoordinate=function(rS,rQ,re,rl,rM){var rd=rb._tempArray4_0,rT=rS[rQ+0],rU=rS[rQ+1],ri=rS[rQ+2],rR=re.elements;rd[0]=rT*rR[0]+rU*rR[4]+ri*rR[8]+rR[12],rd[1]=rT*rR[1]+rU*rR[5]+ri*rR[9]+rR[13],rd[2]=rT*rR[2]+rU*rR[6]+ri*rR[10]+rR[14],rd[3]=1/(rT*rR[3]+rU*rR[7]+ri*rR[11]+rR[15]),rl[rM+0]=rd[0]*rd[3],rl[rM+1]=rd[1]*rd[3],rl[rM+2]=rd[2]*rd[3]},rb.transformLightingMapTexcoordByUV0Array=function(rS,rQ,re,rl,rM){var rd=re.elements;rl[rM+0]=rS[rQ+0]*rd[0]+rd[2],rl[rM+1]=(rS[rQ+1]-1)*rd[1]+rd[3]},rb.transformLightingMapTexcoordByUV1Array=function(rS,rQ,re,rl,rM){var rd=re.elements;rl[rM+0]=rS[rQ+0]*rd[0]+rd[2],rl[rM+1]=1+rS[rQ+1]*rd[1]+rd[3]},rb.getURLVerion=function(rS){var rQ=rS.indexOf("?");return 0<=rQ?rS.substr(rQ):null},rb._quaternionCreateFromYawPitchRollArray=function(rS,rQ,re,rl){var rM=.5*re,rd=.5*rQ,rT=.5*rS,rU=Math.sin(rM),ri=Math.cos(rM),rR=Math.sin(rd),ro=Math.cos(rd),rY=Math.sin(rT),rp=Math.cos(rT);rl[0]=rp*rR*ri+rY*ro*rU,rl[1]=rY*ro*ri-rp*rR*rU,rl[2]=rp*ro*rU-rY*rR*ri,rl[3]=rp*ro*ri+rY*rR*rU},rb._createAffineTransformationArray=function(rS,rQ,re,rl){var rM=rQ[0],rd=rQ[1],rT=rQ[2],rU=rQ[3],ri=rM+rM,rR=rd+rd,ro=rT+rT,rY=rM*ri,rp=rM*rR,rJ=rM*ro,rL=rd*rR,rj=rd*ro,rc=rT*ro,rG=rU*ri,rz=rU*rR,rA=rU*ro,rv=re[0],rD=re[1],rB=re[2];rl[0]=(1-(rL+rc))*rv,rl[1]=(rp+rA)*rv,rl[2]=(rJ-rz)*rv,rl[3]=0,rl[4]=(rp-rA)*rD,rl[5]=(1-(rY+rc))*rD,rl[6]=(rj+rG)*rD,rl[7]=0,rl[8]=(rJ+rz)*rB,rl[9]=(rj-rG)*rB,rl[10]=(1-(rY+rL))*rB,rl[11]=0,rl[12]=rS[0],rl[13]=rS[1],rl[14]=rS[2],rl[15]=1},rb._mulMatrixArray=function(rS,rQ,re,rl){var rM,rd,rT,rU,ri,rR=rQ.elements,ro=rR[0],rY=rR[1],rp=rR[2],rJ=rR[3],rL=rR[4],rj=rR[5],rc=rR[6],rG=rR[7],rz=rR[8],rA=rR[9],rv=rR[10],rD=rR[11],rB=rR[12],rO=rR[13],rH=rR[14],rg=rR[15],rI=rl,rE=rl+4,rt=rl+8,rk=rl+12;for(rM=0;rM<4;rM++)rd=rS[rM],rT=rS[rM+4],rU=rS[rM+8],ri=rS[rM+12],re[rI+rM]=rd*ro+rT*rY+rU*rp+ri*rJ,re[rE+rM]=rd*rL+rT*rj+rU*rc+ri*rG,re[rt+rM]=rd*rz+rT*rA+rU*rv+ri*rD,re[rk+rM]=rd*rB+rT*rO+rU*rH+ri*rg},rb.getYawPitchRoll=function(rS,rQ){rb.transformQuat(rTQ.ForwardRH,rS,reQ.TEMPVector31),rb.transformQuat(rTQ.Up,rS,reQ.TEMPVector32);var re=reQ.TEMPVector32.elements;rb.angleTo(rTQ.ZERO,reQ.TEMPVector31,reQ.TEMPVector33);var rl=reQ.TEMPVector33.elements;rl[0]==Math.PI/2?(rl[1]=rb.arcTanAngle(re[2],re[0]),rl[2]=0):rl[0]==-Math.PI/2?(rl[1]=rb.arcTanAngle(-re[2],-re[0]),rl[2]=0):(rSQ.createRotationY(-rl[1],reQ.TEMPMatrix0),rSQ.createRotationX(-rl[0],reQ.TEMPMatrix1),rTQ.transformCoordinate(reQ.TEMPVector32,reQ.TEMPMatrix0,reQ.TEMPVector32),rTQ.transformCoordinate(reQ.TEMPVector32,reQ.TEMPMatrix1,reQ.TEMPVector32),rl[2]=rb.arcTanAngle(re[1],-re[0])),rl[1]<=-Math.PI&&(rl[1]=Math.PI),rl[2]<=-Math.PI&&(rl[2]=Math.PI),rl[1]>=Math.PI&&rl[2]>=Math.PI&&(rl[1]=0,rl[2]=0,rl[0]=Math.PI-rl[0]),rQ[0]=rl[1],rQ[1]=rl[0],rQ[2]=rl[2]},rb.arcTanAngle=function(rS,rQ){return 0==rS?1==rQ?Math.PI/2:-Math.PI/2:0<rS?Math.atan(rQ/rS):rS<0?0<rQ?Math.atan(rQ/rS)+Math.PI:Math.atan(rQ/rS)-Math.PI:0},rb.angleTo=function(rS,rQ,re){rTQ.subtract(rQ,rS,reQ.TEMPVector30),rTQ.normalize(reQ.TEMPVector30,reQ.TEMPVector30),re.elements[0]=Math.asin(reQ.TEMPVector30.y),re.elements[1]=rb.arcTanAngle(-reQ.TEMPVector30.z,-reQ.TEMPVector30.x)},rb.transformQuat=function(rS,rQ,re){var rl=re.elements,rM=rS.elements,rd=rQ,rT=rM[0],rU=rM[1],ri=rM[2],rR=rd[0],ro=rd[1],rY=rd[2],rp=rd[3],rJ=rp*rT+ro*ri-rY*rU,rL=rp*rU+rY*rT-rR*ri,rj=rp*ri+rR*rU-ro*rT,rc=-rR*rT-ro*rU-rY*ri;rl[0]=rJ*rp+rc*-rR+rL*-rY-rj*-ro,rl[1]=rL*rp+rc*-ro+rj*-rR-rJ*-rY,rl[2]=rj*rp+rc*-rY+rJ*-ro-rL*-rR},rb.quaterionNormalize=function(rS,rQ){var re=rS[0],rl=rS[1],rM=rS[2],rd=rS[3],rT=re*re+rl*rl+rM*rM+rd*rd;0<rT&&(rT=1/Math.sqrt(rT),rQ[0]=re*rT,rQ[1]=rl*rT,rQ[2]=rM*rT,rQ[3]=rd*rT)},rb.matrix4x4MultiplyFFF=function(rS,rQ,re){var rl,rM,rd,rT,rU;if(re===rQ)for(rQ=new Float32Array(16),rl=0;rl<16;++rl)rQ[rl]=re[rl];for(rl=0;rl<4;rl++)rM=rS[rl],rd=rS[rl+4],rT=rS[rl+8],rU=rS[rl+12],re[rl]=rM*rQ[0]+rd*rQ[1]+rT*rQ[2]+rU*rQ[3],re[rl+4]=rM*rQ[4]+rd*rQ[5]+rT*rQ[6]+rU*rQ[7],re[rl+8]=rM*rQ[8]+rd*rQ[9]+rT*rQ[10]+rU*rQ[11],re[rl+12]=rM*rQ[12]+rd*rQ[13]+rT*rQ[14]+rU*rQ[15]},rb.matrix4x4MultiplyMFM=function(rS,rQ,re){rb.matrix4x4MultiplyFFF(rS.elements,rQ,re.elements)},rY(rb,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new rTQ},"_tempVector3_1",function(){return this._tempVector3_1=new rTQ},"_tempVector3_2",function(){return this._tempVector3_2=new rTQ},"_tempVector3_3",function(){return this._tempVector3_3=new rTQ},"_tempVector3_4",function(){return this._tempVector3_4=new rTQ},"_tempVector3_5",function(){return this._tempVector3_5=new rTQ},"_tempVector3_6",function(){return this._tempVector3_6=new rTQ},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),rb}(),rGQ=function(){function rX(){}return rJ(rX,"Laya3D"),rX._cancelLoadByUrl=function(rS){rD.loader.cancelLoadByUrl(rS),rX._innerFirstLevelLoaderManager.cancelLoadByUrl(rS),rX._innerSecondLevelLoaderManager.cancelLoadByUrl(rS),rX._innerThirdLevelLoaderManager.cancelLoadByUrl(rS),rX._innerFourthLevelLoaderManager.cancelLoadByUrl(rS)},rX._changeWebGLSize=function(rS,rQ){rk.onStageResize(rS,rQ),rC.clientWidth=rS,rC.clientHeight=rQ},rX.__init__=function(){var rS=rQ.createMap;rS.lh=[r$Q,"SPRITE3DHIERARCHY"],rS.ls=[rmQ,"SPRITE3DHIERARCHY"],rS.lm=[rrQ,"MESH"],rS.lmat=[rPQ,"MATERIAL"],rS.jpg=[rxQ,"nativeimage"],rS.jpeg=[rxQ,"nativeimage"],rS.png=[rxQ,"nativeimage"],rS.pkm=[rxQ,"arraybuffer"],rS.raw=[rwQ,"arraybuffer"],rS.mipmaps=[rwQ,"arraybuffer"],rG.parserMap.SPRITE3DHIERARCHY=rX._loadHierarchy,rG.parserMap.MESH=rX._loadMesh,rG.parserMap.MATERIAL=rX._loadMaterial,rG.parserMap.TEXTURECUBE=rX._loadTextureCube,rG.parserMap.TERRAIN=rX._loadTerrain,rX._innerFirstLevelLoaderManager.on("error",null,rX._eventLoadManagerError),rX._innerSecondLevelLoaderManager.on("error",null,rX._eventLoadManagerError),rX._innerThirdLevelLoaderManager.on("error",null,rX._eventLoadManagerError),rX._innerFourthLevelLoaderManager.on("error",null,rX._eventLoadManagerError)},rX.READ_BLOCK=function(){return rX._readData.pos+=4,!0},rX.READ_DATA=function(){return rX._DATA.offset=rX._readData.getUint32(),rX._DATA.size=rX._readData.getUint32(),!0},rX.READ_STRINGS=function(){var rS=[],rQ={offset:0,size:0};rQ.offset=rX._readData.getUint16(),rQ.size=rX._readData.getUint16();rX._readData.pos;rX._readData.pos=rQ.offset+rX._DATA.offset;for(var re=0;re<rQ.size;re++){var rl=rX._readData.readUTFString();-1===rl.lastIndexOf(".lmat")&&-1===rl.lastIndexOf(".lpbr")||rS.push(rl)}return rS},rX.formatRelativePath=function(rS,rQ){var re;if("."===rQ.charAt(0)){for(var rl=(rS+rQ).split("/"),rM=0,rd=rl.length;rM<rd;rM++)if(".."==rl[rM]){var rT=rM-1;0<rT&&".."!==rl[rT]&&(rl.splice(rT,2),rM-=2)}re=rl.join("/")}else re=rS+rQ;return null!=rt.customFormat&&(re=rt.customFormat(re,null)),re},rX._eventLoadManagerError=function(rS){rD.loader.event("error",rS)},rX._addHierarchyInnerUrls=function(rS,rQ,re,rl,rM,rd){var rT=rX.formatRelativePath(rl,rM);re&&(rT+=re),rS.push({url:rT,clas:rd}),rQ[rM]=rT},rX._getSprite3DHierarchyInnerUrls=function(rS,rQ,re,rl,rM,rd,rT){var rU,ri=0,rR=0;switch(rS.type){case"Scene":var ro=rS.customProps.lightmaps;for(ri=0,rR=ro.length;ri<rR;ri++){var rY=ro[ri].replace(".exr",".png");rX._addHierarchyInnerUrls(rl,rM,rd,rT,rY,rxQ)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var rp;if(rS.instanceParams)(rp=rS.instanceParams.loadPath)&&rX._addHierarchyInnerUrls(rQ,rM,rd,rT,rp,rrQ);else{(rp=(rU=rS.customProps).meshPath)&&rX._addHierarchyInnerUrls(rQ,rM,rd,rT,rp,rrQ);var rJ=rU.materials;if(rJ)for(ri=0,rR=rJ.length;ri<rR;ri++){for(var rL=rJ[ri],rj=rL.type.split("."),rc=rh.window,rG=0,rz=rj.length;rG<rz;++rG){rc=rc[this.clasPaths[rG]]}if("function"!=typeof rc)throw"_getSprite3DHierarchyInnerUrls 错误: "+rL.type+" 不是类";rX._addHierarchyInnerUrls(re,rM,rd,rT,rL.path,rc)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var rA=(rU=rS.customProps).meshPath;rA&&rX._addHierarchyInnerUrls(rQ,rM,rd,rT,rA,rrQ);var rv=rU.material;if(rv){rj=rv.type.split("."),rc=rh.window;for(rG=0,rz=rj.length;rG<rz;++rG){rc=rc[this.clasPaths[rG]]}rX._addHierarchyInnerUrls(re,rM,rd,rT,rv.path,rc)}else{var rD=rU.materialPath;if(rD)rX._addHierarchyInnerUrls(re,rM,rd,rT,rD,ShurikenParticleMaterial);else{var rB=rU.texturePath;rB&&rX._addHierarchyInnerUrls(rl,rM,rd,rT,rB,rxQ)}}break;case"Terrain":rX._addHierarchyInnerUrls(rl,rM,rd,rT,rS.customProps.dataPath,TerrainRes)}var rO=rS.components;for(var rH in rO){var rg=rO[rH];switch(rH){case"Animator":var rI=rg.avatarPath;if(rI)rX._addHierarchyInnerUrls(rl,rM,rd,rT,rI,Avatar);else{var rE=rg.avatar;rE&&rX._addHierarchyInnerUrls(rl,rM,rd,rT,rE.path,Avatar)}var rt=rg.clipPaths;for(ri=0,rR=rt.length;ri<rR;ri++)rX._addHierarchyInnerUrls(rl,rM,rd,rT,rt[ri],AnimationClip)}}var rk=rS.child;for(ri=0,rR=rk.length;ri<rR;ri++)rX._getSprite3DHierarchyInnerUrls(rk[ri],rQ,re,rl,rM,rd,rT)},rX._loadHierarchy=function(rS){rS.on("loaded",null,rX._onHierarchylhLoaded,[rS,rS._class._getGroup()]),rS.load(rS.url,"json",!1,null,!0)},rX._onHierarchylhLoaded=function(rS,rQ,re){if(rS._class.destroyed)rS.endLoad();else{var rl=rS.url,rM=rcQ.getURLVerion(rl),rd=rt.getPath(rl),rT=[],rU=[],ri=[],rR={};rX._getSprite3DHierarchyInnerUrls(re,rT,rU,ri,rR,rM,rd);var ro=rT.length+rU.length+ri.length,rY=ro+1,rp=1/rY;if(rX._onProcessChange(rS,0,rp,1),0<ri.length){var rJ=ro/rY,rL=rE.create(null,rX._onProcessChange,[rS,rp,rJ],!1);rX._innerFourthLevelLoaderManager.create(ri,rE.create(null,rX._onHierarchyInnerForthLevResouLoaded,[rS,rQ,rL,re,rR,rT,rU,rp+rJ*ri.length,rJ]),rL,null,null,1,!0,rQ)}else rX._onHierarchyInnerForthLevResouLoaded(rS,rQ,null,re,rR,rT,rU,rp,rJ)}},rX._onHierarchyInnerForthLevResouLoaded=function(rS,rQ,re,rl,rM,rd,rT,rU,ri){if(rS._class.destroyed)rS.endLoad();else if(re&&re.recover(),0<rT.length){var rR=rE.create(null,rX._onProcessChange,[rS,rU,ri],!1);rX._innerSecondLevelLoaderManager.create(rT,rE.create(null,rX._onHierarchyInnerSecondLevResouLoaded,[rS,rQ,rR,rl,rM,rd,rU+ri*rT.length,ri]),re,null,null,1,!0,rQ)}else rX._onHierarchyInnerSecondLevResouLoaded(rS,rQ,null,rl,rM,rd,rU,ri)},rX._onHierarchyInnerSecondLevResouLoaded=function(rS,rQ,re,rl,rM,rd,rT,rU){if(rS._class.destroyed)rS.endLoad();else if(re&&re.recover(),0<rd.length){var ri=rE.create(null,rX._onProcessChange,[rS,rT,rU],!1);rX._innerFirstLevelLoaderManager.create(rd,rE.create(null,rX._onHierarchyInnerFirstLevResouLoaded,[rS,ri,rl,rM]),re,null,null,1,!0,rQ)}else rX._onHierarchyInnerFirstLevResouLoaded(rS,null,rl,rM)},rX._onHierarchyInnerFirstLevResouLoaded=function(rS,rQ,re,rl){rQ&&rQ.recover(),rS.endLoad([re,rl])},rX._loadTerrain=function(rS){rS.on("loaded",null,rX._onTerrainLtLoaded,[rS,rS._class._getGroup()]),rS.load(rS.url,"json",!1,null,!0)},rX._onTerrainLtLoaded=function(rS,rQ,re){if(rS._class.destroyed)rS.endLoad();else{var rl,rM,rd=rS.url,rT=rcQ.getURLVerion(rd),rU=rt.getPath(rd),ri=[],rR={},ro=0,rY=0,rp=re.heightData;rl=rp.url,rM=rX.formatRelativePath(rU,rl),rT&&(rM+=rT),rl=rR[rl]=rM;var rJ=re.detailTexture;for(ro=0,rY=rJ.length;ro<rY;ro++)ri.push({url:rJ[ro].diffuse});var rL=re.normalMap;for(ro=0,rY=rL.length;ro<rY;ro++)ri.push({url:rL[ro]});var rj=re.alphaMap;for(ro=0,rY=rj.length;ro<rY;ro++)ri.push({url:rj[ro],params:[!1,!1,6408,!0]});for(ro=0,rY=ri.length;ro<rY;ro++){var rc=ri[ro].url;rM=rX.formatRelativePath(rU,rc),rT&&(rM+=rT),ri[ro].url=rM,rR[rc]=rM}var rG=ri.length,rz=rG+2,rA=1/rz;rX._onProcessChange(rS,0,rA,1);var rv={heightMapLoaded:!1,texturesLoaded:!1},rD=rE.create(null,rX._onProcessChange,[rS,rA,rA],!1);rX._innerFourthLevelLoaderManager.create(rl,rE.create(null,rX._onTerrainHeightMapLoaded,[rS,rD,re,rR,rv]),rD,null,[rp.numX,rp.numZ,rp.bitType,rp.value],1,!0,rQ);var rB=rE.create(null,rX._onProcessChange,[rS,2*rA,rG/rz],!1);rX._innerFourthLevelLoaderManager.create(ri,rE.create(null,rX._onTerrainTexturesLoaded,[rS,rB,re,rR,rv]),rB,null,null,1,!0,rQ)}},rX._onTerrainHeightMapLoaded=function(rS,rQ,re,rl,rM){rM.heightMapLoaded=!0,rM.texturesLoaded&&(rS.endLoad([re,rl]),rQ.recover())},rX._onTerrainTexturesLoaded=function(rS,rQ,re,rl,rM){rM.texturesLoaded=!0,rM.heightMapLoaded&&(rS.endLoad([re,rl]),rQ.recover())},rX._loadMesh=function(rS){rS.on("loaded",null,rX._onMeshLmLoaded,[rS,rS._class._getGroup()]),rS.load(rS.url,"arraybuffer",!1,null,!0)},rX._onMeshLmLoaded=function(rS,rQ,re){if(rS._class.destroyed)rS.endLoad();else{var rl,rM,rd,rT=rS.url,rU=rcQ.getURLVerion(rT),ri=rt.getPath(rT),rR={},ro=0,rY=0;switch((rX._readData=new rB(re)).pos=0,rX._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var rp=rX._readData.getUint32();rX._readData.pos=rX._readData.pos+4,rY=rX._readData.getUint16(),rX._readData.pos=rX._readData.pos+8*rY;var rJ=rX._readData.getUint32();for(rY=rX._readData.getUint16(),rX._readData.pos=rp+rJ,rl=[],ro=0;ro<rY;ro++){var rL=rX._readData.readUTFString();-1!==rL.lastIndexOf(".lmat")&&rl.push(rL)}break;default:for(rX.READ_BLOCK(),ro=0;ro<2;ro++){var rj=rX._readData.getUint16(),rc=rX._strings[rj],rG=rX["READ_"+rc];if(null==rG)throw new Error("model file err,no this function:"+rj+" "+rc);1===ro?rl=rG.call():rG.call()}}for(ro=0,rd=rl.length;ro<rd;ro++){var rz=rl[ro];rM=rX.formatRelativePath(ri,rz),rU&&(rM+=rU),rl[ro]=rM,rR[rz]=rM}if(0<rl.length){rX._onProcessChange(rS,0,.5,1);var rA=rE.create(null,rX._onProcessChange,[rS,.5,.5],!1);rX._innerSecondLevelLoaderManager.create(rl,rE.create(null,rX._onMeshMateialLoaded,[rS,rA,re,rR]),rA,null,null,1,!0,rQ)}else rS.endLoad([re,rR])}},rX._onMeshMateialLoaded=function(rS,rQ,re,rl){rS.endLoad([re,rl]),rQ.recover()},rX._getMaterialTexturePath=function(rS,rQ,re){var rl=rS.length-4;return rS.indexOf(".dds")!=rl&&rS.indexOf(".tga")!=rl&&rS.indexOf(".exr")!=rl&&rS.indexOf(".DDS")!=rl&&rS.indexOf(".TGA")!=rl&&rS.indexOf(".EXR")!=rl||(rS=rS.substr(0,rl)+".png"),rS=rX.formatRelativePath(re,rS),rQ&&(rS+=rQ),rS},rX._loadMaterial=function(rS){rS.on("loaded",null,rX._onMaterilLmatLoaded,[rS,rS._class._getGroup()]),rS.load(rS.url,"json",!1,null,!0)},rX._onMaterilLmatLoaded=function(rS,rQ,re){if(rS._class.destroyed)rS.endLoad();else{var rl,rM=rS.url,rd=rcQ.getURLVerion(rM),rT=rt.getPath(rM),rU=[],ri={},rR=re.customProps,ro=re.version;if(ro)switch(ro){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var rY=re.props.textures,rp=0,rJ=rY.length;rp<rJ;rp++){var rL=rY[rp],rj=rL.path;if(rj){var rc=rj.length-4;rj.indexOf(".exr")!=rc&&rj.indexOf(".EXR")!=rc||(rj=rj.substr(0,rc)+".png"),rl=rX.formatRelativePath(rT,rj),rd&&(rl+=rd),rU.push({url:rl,params:rL.params}),ri[rj]=rl}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var rG=rR.diffuseTexture.texture2D;if(rG&&(rl=rX._getMaterialTexturePath(rG,rd,rT),rU.push(rl),ri[rG]=rl),rR.normalTexture){var rz=rR.normalTexture.texture2D;rz&&(rl=rX._getMaterialTexturePath(rz,rd,rT),rU.push(rl),ri[rz]=rl)}if(rR.specularTexture){var rA=rR.specularTexture.texture2D;rA&&(rl=rX._getMaterialTexturePath(rA,rd,rT),rU.push(rl),ri[rA]=rl)}if(rR.emissiveTexture){var rv=rR.emissiveTexture.texture2D;rv&&(rl=rX._getMaterialTexturePath(rv,rd,rT),rU.push(rl),ri[rv]=rl)}if(rR.ambientTexture){var rD=rR.ambientTexture.texture2D;rD&&(rl=rX._getMaterialTexturePath(rD,rd,rT),rU.push(rl),ri[rD]=rl)}if(rR.reflectTexture){var rB=rR.reflectTexture.texture2D;rB&&(rl=rX._getMaterialTexturePath(rB,rd,rT),rU.push(rl),ri[rB]=rl)}}var rO=rU.length,rH=rO+1,rg=1/rH;if(rX._onProcessChange(rS,0,rg,1),0<rO){var rI=rE.create(null,rX._onProcessChange,[rS,rg,rO/rH],!1);rX._innerFourthLevelLoaderManager.create(rU,rE.create(null,rX._onMateialTexturesLoaded,[rS,rI,re,ri]),rI,rxQ,null,1,!0,rQ)}else rX._onMateialTexturesLoaded(rS,null,re,null)}},rX._onMateialTexturesLoaded=function(rS,rQ,re,rl){rS.endLoad([re,rl]),rQ&&rQ.recover()},rX._loadTextureCube=function(rS){rS.on("loaded",null,rX._onTextureCubeLtcLoaded,[rS]),rS.load(rS.url,"json",!1,null,!0)},rX._onTextureCubeLtcLoaded=function(rS,rQ){if(rS._class.destroyed)rS.endLoad();else{var re=rt.getPath(rS.url),rl=[rX.formatRelativePath(re,rQ.px),rX.formatRelativePath(re,rQ.nx),rX.formatRelativePath(re,rQ.py),rX.formatRelativePath(re,rQ.ny),rX.formatRelativePath(re,rQ.pz),rX.formatRelativePath(re,rQ.nz)];rX._onProcessChange(rS,0,1/7,1);var rM=rE.create(null,rX._onProcessChange,[rS,1/7,6/7],!1);rX._innerFourthLevelLoaderManager.load(rl,rE.create(null,rX._onTextureCubeImagesLoaded,[rS,rl,rM]),rM,"nativeimage")}},rX._onTextureCubeImagesLoaded=function(rS,rQ,re){var rl=[];rl.length=6;for(var rM=0;rM<6;rM++){var rd=rQ[rM];rl[rM]=rG.getRes(rd),rG.clearRes(rd)}rS.endLoad(rl),re.recover()},rX._onProcessChange=function(rS,rQ,re,rl){(rl=rQ+rl*re)<1&&rS.event("progress",rl)},rX.init=function(rS,rQ,re,rl,rM,rd){if(void 0===re&&(re=!1),void 0===rl&&(rl=!1),void 0===rM&&(rM=!0),void 0===rd&&(rd=!0),rz.update3DLoop=function(){},rz.cancelLoadByUrl=function(rS){rX._cancelLoadByUrl(rS)},ri.isAntialias=re,ri.isAlpha=rl,ri.premultipliedAlpha=rM,ri.isStencil=rd,!rk.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");rz.changeWebGLSize=rX._changeWebGLSize,rj.is3DMode=!0,rD.init(rS,rQ),rb.__init__(),rYQ.__init__(),rNQ.__init__(),ru.__init__(),rX.__init__(),rT.maxTextureCount=2,(rX.debugMode||rK.debugMode)&&(rX._debugPhasorSprite=new rq)},rX.HIERARCHY="SPRITE3DHIERARCHY",rX.MESH="MESH",rX.MATERIAL="MATERIAL",rX.PBRMATERIAL="PBRMTL",rX.TEXTURECUBE="TEXTURECUBE",rX.TERRAIN="TERRAIN",rX._readData=null,rX._debugPhasorSprite=null,rX.debugMode=!1,rY(rX,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new rQ},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new rQ},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new rQ},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new rQ}]),rX}(),rzQ=function(rS){function rM(rS){rM.__super.call(this),this._owner=rS,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}rJ(rM,"laya.d3.animation.AnimationTransform3D",rd);var rQ=rM.prototype;return rQ._getlocalMatrix=function(){return this._localUpdate&&(rcQ._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},rQ._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldTransform()}},rQ._setWorldMatrixAndUpdate=function(rS){if(this._worldMatrix=rS,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var rQ=this._getlocalMatrix(),re=0;re<16;++re)this._worldMatrix[re]=rQ[re];else rcQ.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},rQ._setWorldMatrixNoUpdate=function(rS){this._worldMatrix=rS},rQ._setWorldMatrixIgnoreUpdate=function(rS){this._worldMatrix=rS,this._worldUpdate=!1},rQ.getLocalPosition=function(){return this._localPosition},rQ.setLocalPosition=function(rS){if(this._parent)this._localPosition=rS,this._localUpdate=!0,this._onWorldTransform();else{var rQ=this._entity.owner._transform,re=this._entity.localPosition,rl=re.elements;rl[0]=rS[0],rl[1]=rS[1],rl[2]=rS[2],rQ.localPosition=re}},rQ.getLocalRotation=function(){if(this._localQuaternionUpdate){var rS=this._localRotationEuler;rcQ._quaternionCreateFromYawPitchRollArray(rS[1]/rM._angleToRandin,rS[0]/rM._angleToRandin,rS[2]/rM._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},rQ.setLocalRotation=function(rS){if(this._parent)this._localRotation=rS,rcQ.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var rQ=this._entity.owner._transform,re=this._entity.localRotation,rl=re.elements;rl[0]=rS[0],rl[1]=rS[1],rl[2]=rS[2],rl[3]=rS[3],rQ.localRotation=re}},rQ.getLocalScale=function(){return this._localScale},rQ.setLocalScale=function(rS){if(this._parent)this._localScale=rS,this._localUpdate=!0,this._onWorldTransform();else{var rQ=this._entity.owner._transform,re=this._entity.localScale,rl=re.elements;rl[0]=rS[0],rl[1]=rS[1],rl[2]=rS[2],rQ.localScale=re}},rQ.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){rcQ.getYawPitchRoll(this._localRotation,rM._tempVector3);var rS=rM._tempVector3,rQ=this._localRotationEuler;rQ[0]=rS[1]*rM._angleToRandin,rQ[1]=rS[0]*rM._angleToRandin,rQ[2]=rS[2]*rM._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},rQ.setLocalRotationEuler=function(rS){if(this._parent)rcQ._quaternionCreateFromYawPitchRollArray(rS[1]/rM._angleToRandin,rS[0]/rM._angleToRandin,rS[2]/rM._angleToRandin,this._localRotation),this._localRotationEuler=rS,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var rQ=this._entity.owner._transform,re=this._entity.localRotationEuler,rl=re.elements;rl[0]=rS[0],rl[1]=rS[1],rl[2]=rS[2],rQ.localRotationEuler=re}},rQ.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)rcQ.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var rS=this._getlocalMatrix(),rQ=0;rQ<16;++rQ)this._worldMatrix[rQ]=rS[rQ];this._worldUpdate=!1}return this._worldMatrix},rQ.setParent=function(rS){if(this._parent!==rS){if(this._parent){var rQ=this._parent._childs,re=rQ.indexOf(this);rQ.splice(re,1)}rS&&(rS._childs.push(this),rS&&this._onWorldTransform()),this._parent=rS}},rY(rM,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),rM}(),rAQ=function(rS){function rQ(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,rQ.__super.call(this),this._destroyed=!1,this._id=rQ._uniqueIDCounter,rQ._uniqueIDCounter++}rJ(rQ,"laya.d3.component.Component3D",rd);var re=rQ.prototype;return rD.imps(re,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),re._initialize=function(rS){this._owner=rS,this._enable=!0,this.started=!1,this._load(rS)},re._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},re._load=function(rS){},re._start=function(rS){},re._update=function(rS){},re._lateUpdate=function(rS){},re._preRenderUpdate=function(rS){},re._postRenderUpdate=function(rS){},re._unload=function(rS){this.offAll()},re._cloneTo=function(rS){},rL(0,re,"id",function(){return this._id}),rL(0,re,"destroyed",function(){return this._destroyed}),rL(0,re,"owner",function(){return this._owner}),rL(0,re,"enable",function(){return this._enable},function(rS){this._enable!==rS&&(this._enable=rS,this.event("enablechanged",this._enable))}),rL(0,re,"isSingleton",function(){return rQ._isSingleton}),rQ._isSingleton=!0,rQ._uniqueIDCounter=1,rQ}(),rvQ=function(rS){function rQ(){this._destroyed=!1,rQ.__super.call(this),this._destroyed=!1}rJ(rQ,"laya.d3.core.GeometryFilter",rd);var re=rQ.prototype;return rD.imps(re,{"laya.resource.IDestroy":!0}),re._destroy=function(){this.offAll(),this._destroyed=!0},rL(0,re,"_isAsyncLoaded",function(){return!0}),rL(0,re,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),rL(0,re,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),rL(0,re,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),rL(0,re,"destroyed",function(){return this._destroyed}),rQ}(),rDQ=function(rS){function rl(rS){rl.__super.call(this),this._id=++rl._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new rKS(new rTQ,new rTQ),this._boundingBoxCenter=new rTQ,this._boundingSphere=new r_S(new rTQ,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=rS,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}rJ(rl,"laya.d3.core.render.BaseRender",rd);var rQ=rl.prototype;return rD.imps(rQ,{"laya.resource.IDestroy":!0}),rQ._changeMaterialReference=function(rS,rQ){rS&&rS._removeReference(),rQ._addReference()},rQ._getInstanceMaterial=function(rS,rQ){var re=new rS.constructor;return rS.cloneTo(re),re.name=re.name+"(Instance)",this._materialsInstance[rQ]=!0,this._changeMaterialReference(this._materials[rQ],re),this._materials[rQ]=re},rQ._setShaderValuelightMap=function(rS){this._setShaderValueTexture(3,rS)},rQ._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},rQ._renderRenderableBoundBox=function(){var rS=rGQ._debugPhasorSprite,rQ=this.boundingBox,re=rl._tempBoundBoxCorners;rQ.getCorners(re),rS.line(re[0],rl._greenColor,re[1],rl._greenColor),rS.line(re[2],rl._greenColor,re[3],rl._greenColor),rS.line(re[4],rl._greenColor,re[5],rl._greenColor),rS.line(re[6],rl._greenColor,re[7],rl._greenColor),rS.line(re[0],rl._greenColor,re[3],rl._greenColor),rS.line(re[1],rl._greenColor,re[2],rl._greenColor),rS.line(re[2],rl._greenColor,re[6],rl._greenColor),rS.line(re[3],rl._greenColor,re[7],rl._greenColor),rS.line(re[0],rl._greenColor,re[4],rl._greenColor),rS.line(re[1],rl._greenColor,re[5],rl._greenColor),rS.line(re[4],rl._greenColor,re[7],rl._greenColor),rS.line(re[5],rl._greenColor,re[6],rl._greenColor)},rQ._calculateBoundingSphere=function(){throw"BaseRender: must override it."},rQ._calculateBoundingBox=function(){throw"BaseRender: must override it."},rQ._setShaderValueTexture=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ)},rQ._setShaderValueMatrix4x4=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ?rQ.elements:null)},rQ._setShaderValueColor=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ?rQ.elements:null)},rQ._setShaderValueBuffer=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ)},rQ._setShaderValueInt=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ)},rQ._setShaderValueBool=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ)},rQ._setShaderValueNumber=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ)},rQ._setShaderValueVector2=function(rS,rQ){this._owner._shaderValues.setValue(rS,rQ?rQ.elements:null)},rQ._addShaderDefine=function(rS){this._owner._shaderDefineValue|=rS},rQ._removeShaderDefine=function(rS){this._owner._shaderDefineValue&=~rS},rQ._renderUpdate=function(rS){return!0},rQ._applyLightMapParams=function(){if(0<=this._lightmapIndex){var rS=this._owner.scene;if(rS){var rQ=rS.getlightmaps()[this._lightmapIndex];rQ?(this._addShaderDefine(rqQ.SAHDERDEFINE_LIGHTMAP),rQ.loaded?this._setShaderValuelightMap(rQ):rQ.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(rqQ.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(rqQ.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(rqQ.SAHDERDEFINE_LIGHTMAP)},rQ._updateOctreeNode=function(){var rS=this._treeNode;rS&&this._octreeNodeNeedChange&&(rS.updateObject(this),this._octreeNodeNeedChange=!1)},rQ._destroy=function(){this.offAll();var rS=0,rQ=0;for(rS=0,rQ=this._renderElements.length;rS<rQ;rS++)this._renderElements[rS]._destroy();for(rS=0,rQ=this._materials.length;rS<rQ;rS++)this._materials[rS]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},rL(0,rQ,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),rL(0,rQ,"id",function(){return this._id}),rL(0,rQ,"material",function(){var rS=this._materials[0];if(rS&&!this._materialsInstance[0]){var rQ=this._getInstanceMaterial(rS,0);this.event("materialchanged",[this,0,rQ])}return this._materials[0]},function(rS){this.sharedMaterial=rS}),rL(0,rQ,"sharedMaterial",function(){return this._materials[0]},function(rS){var rQ=this._materials[0];rQ!==rS&&(this._materials[0]=rS,this._materialsInstance[0]=!1,this._changeMaterialReference(rQ,rS),this.event("materialchanged",[this,0,rS]))}),rL(0,rQ,"lightmapIndex",function(){return this._lightmapIndex},function(rS){this._lightmapIndex=rS,this._applyLightMapParams()}),rL(0,rQ,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(rS){this._lightmapScaleOffset=rS,this._setShaderValueColor(2,rS),this._addShaderDefine(rqQ.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),rL(0,rQ,"enable",function(){return this._enable},function(rS){this._enable=rS,this.event("enablechanged",[this,rS])}),rL(0,rQ,"materials",function(){for(var rS=0,rQ=this._materials.length;rS<rQ;rS++)if(!this._materialsInstance[rS]){var re=this._getInstanceMaterial(this._materials[rS],rS);this.event("materialchanged",[this,rS,re])}return this._materials.slice()},function(rS){this.sharedMaterials=rS}),rL(0,rQ,"sharedMaterials",function(){return this._materials.slice()},function(rS){if(!rS)throw new Error("MeshRender: shadredMaterials value can't be null.");var rQ=rS.length;this._materialsInstance.length=rQ;for(var re=0;re<rQ;re++){var rl=this._materials[re];rl!==rS[re]&&(this._materialsInstance[re]=!1,this._changeMaterialReference(rl,rS[re]),this.event("materialchanged",[this,re,rS[re]]))}this._materials=rS}),rL(0,rQ,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),rL(0,rQ,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var rS=this.boundingBox;rTQ.add(rS.min,rS.max,this._boundingBoxCenter),rTQ.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),rL(0,rQ,"receiveShadow",function(){return this._receiveShadow},function(rS){this._receiveShadow!==rS&&((this._receiveShadow=rS)?this._addShaderDefine(rJQ.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(rJQ.SHADERDEFINE_RECEIVE_SHADOW))}),rL(0,rQ,"destroyed",function(){return this._destroyed}),rl._uniqueIDCounter=0,rY(rl,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ,new rTQ]},"_greenColor",function(){return this._greenColor=new rUQ(0,1,0,1)}]),rl}(),rBQ=function(rS){function rU(rS){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,rU.__super.call(this),this._localPosition=new rTQ,this._localRotation=new reQ(0,0,0,1),this._localScale=new rTQ(1,1,1),this._localRotationEuler=new rTQ,this._localMatrix=new rSQ,this._position=new rTQ,this._rotation=new reQ(0,0,0,1),this._scale=new rTQ(1,1,1),this._worldMatrix=new rSQ,this._forward=new rTQ,this._up=new rTQ,this._right=new rTQ,this._owner=rS,this._childs=[]}rJ(rU,"laya.d3.core.Transform3D",rd);var rQ=rU.prototype;return rQ._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)rSQ.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var rS=rU._tempVector30;rTQ.multiply(this.pivot,this._localScale,rS);var rQ=rU._tempVector31;rTQ.subtract(rS,this.pivot,rQ);var re=rU._tempVector32,rl=this.localRotation;rTQ.transformQuat(rS,rl,re),rTQ.subtract(re,rS,re);var rM=rU._tempVector33;rTQ.subtract(this._localPosition,rQ,rM),rTQ.subtract(rM,re,rM),rSQ.createAffineTransformation(rM,rl,this._localScale,this._localMatrix)}},rQ._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldPositionRotationTransform()}},rQ._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldPositionScaleTransform()}},rQ._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldPositionTransform()}},rQ._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldPositionRotationTransform()}},rQ._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldPositionScaleTransform()}},rQ._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._onWorldTransform()}},rQ.translate=function(rS,rQ){void 0===rQ&&(rQ=!0),rQ?(rSQ.createFromQuaternion(this.localRotation,rU._tempMatrix0),rTQ.transformCoordinate(rS,rU._tempMatrix0,rU._tempVector30),rTQ.add(this.localPosition,rU._tempVector30,this._localPosition),this.localPosition=this._localPosition):(rTQ.add(this.position,rS,this._position),this.position=this._position)},rQ.rotate=function(rS,rQ,re){var rl;void 0===rQ&&(rQ=!0),void 0===re&&(re=!0),rl=re?rS:(rTQ.scale(rS,Math.PI/180,rU._tempVector30),rU._tempVector30),reQ.createFromYawPitchRoll(rl.y,rl.x,rl.z,rU._tempQuaternion0),rQ?(reQ.multiply(this._localRotation,rU._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(reQ.multiply(rU._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},rQ.lookAt=function(rS,rQ,re){void 0===re&&(re=!1);var rl,rM=rS.elements;if(re){if(rl=this._localPosition.elements,Math.abs(rl[0]-rM[0])<rsS.zeroTolerance&&Math.abs(rl[1]-rM[1])<rsS.zeroTolerance&&Math.abs(rl[2]-rM[2])<rsS.zeroTolerance)return;reQ.lookAt(this._localPosition,rS,rQ,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var rd=this.position;if(rl=rd.elements,Math.abs(rl[0]-rM[0])<rsS.zeroTolerance&&Math.abs(rl[1]-rM[1])<rsS.zeroTolerance&&Math.abs(rl[2]-rM[2])<rsS.zeroTolerance)return;reQ.lookAt(rd,rS,rQ,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},rL(0,rQ,"_isFrontFaceInvert",function(){var rS=this.scale,rQ=rS.x<0;return rS.y<0&&(rQ=!rQ),rS.z<0&&(rQ=!rQ),rQ}),rL(0,rQ,"owner",function(){return this._owner}),rL(0,rQ,"localRotation",function(){if(this._localQuaternionUpdate){var rS=this._localRotationEuler.elements;reQ.createFromYawPitchRoll(rS[1]/rU._angleToRandin,rS[0]/rU._angleToRandin,rS[2]/rU._angleToRandin,this._localRotation)}return this._localRotation},function(rS){this._localRotation=rS,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),rL(0,rQ,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?rSQ.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(rS){null===this._parent?rS.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),rSQ.multiply(this._localMatrix,rS,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=rS,this._worldUpdate=!1}),rL(0,rQ,"worldNeedUpdate",function(){return this._worldUpdate}),rL(0,rQ,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(rS){this._localMatrix=rS,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),rL(0,rQ,"dummy",function(){return this._dummy},function(rS){this._dummy!==rS&&(this._dummy&&(this._dummy._entity=null),rS&&(rS._entity=this),this._dummy=rS)}),rL(0,rQ,"localPosition",function(){return this._localPosition},function(rS){this._localPosition=rS,this._localUpdate=!0,this._onWorldPositionTransform()}),rL(0,rQ,"position",function(){if(this._positionUpdate){if(null!=this._parent){var rS=this._parent.position;rTQ.multiply(this._localPosition,this._parent.scale,rU._tempVector30),rTQ.transformQuat(rU._tempVector30,this._parent.rotation,rU._tempVector30),rTQ.add(rS,rU._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(rS){if(null!=this._parent){rTQ.subtract(rS,this._parent.position,this._localPosition);var rQ=this._parent.scale.elements,re=rQ[0],rl=rQ[1],rM=rQ[2];if(1!==re||1!==rl||1!==rM){var rd=rU._tempVector30,rT=rd.elements;rT[0]=1/re,rT[1]=1/rl,rT[2]=1/rM,rTQ.multiply(this._localPosition,rd,this._localPosition)}this._parent.rotation.invert(rU._tempQuaternion0),rTQ.transformQuat(this._localPosition,rU._tempQuaternion0,this._localPosition)}else rS.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=rS,this._positionUpdate=!1}),rL(0,rQ,"localScale",function(){return this._localScale},function(rS){this._localScale=rS,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),rL(0,rQ,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(rU._tempVector30);var rS=rU._tempVector30.elements,rQ=this._localRotationEuler.elements;rQ[0]=rS[1]*rU._angleToRandin,rQ[1]=rS[0]*rU._angleToRandin,rQ[2]=rS[2]*rU._angleToRandin}return this._localRotationEuler},function(rS){this._localRotationEuler=rS,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),rL(0,rQ,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?reQ.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(rS){null!=this._parent?(this._parent.rotation.invert(rU._tempQuaternion0),reQ.multiply(rS,rU._tempQuaternion0,this._localRotation)):rS.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=rS,this._rotationUpdate=!1}),rL(0,rQ,"scale",function(){return this._scaleUpdate&&(null!==this._parent?rTQ.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(rS){if(null!==this._parent){var rQ=this._parent.scale.elements,re=rU._tempVector30.elements;re[0]=1/rQ[0],re[1]=1/rQ[1],re[2]=1/rQ[2],rTQ.multiply(rS,rU._tempVector30,this._localScale)}else rS.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=rS,this._scaleUpdate=!1}),rL(0,rQ,"rotationEuler",null,function(rS){reQ.createFromYawPitchRoll(rS.y,rS.x,rS.z,this._rotation),this.rotation=this._rotation}),rL(0,rQ,"forward",function(){var rS=this.worldMatrix.elements;return this._forward.elements[0]=-rS[8],this._forward.elements[1]=-rS[9],this._forward.elements[2]=-rS[10],this._forward}),rL(0,rQ,"up",function(){var rS=this.worldMatrix.elements;return this._up.elements[0]=rS[4],this._up.elements[1]=rS[5],this._up.elements[2]=rS[6],this._up}),rL(0,rQ,"right",function(){var rS=this.worldMatrix.elements;return this._right.elements[0]=rS[0],this._right.elements[1]=rS[1],this._right.elements[2]=rS[2],this._right}),rL(0,rQ,"parent",function(){return this._parent},function(rS){if(this._parent!==rS){if(this._parent){var rQ=this._parent._childs,re=rQ.indexOf(this);rQ.splice(re,1)}rS&&(rS._childs.push(this),rS&&this._onWorldTransform()),this._parent=rS}}),rY(rU,["_tempVector30",function(){return this._tempVector30=new rTQ},"_tempVector31",function(){return this._tempVector31=new rTQ},"_tempVector32",function(){return this._tempVector32=new rTQ},"_tempVector33",function(){return this._tempVector33=new rTQ},"_tempQuaternion0",function(){return this._tempQuaternion0=new reQ},"_tempMatrix0",function(){return this._tempMatrix0=new rSQ},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),rU}(),rOQ=(function(rS){function rQ(){this._rotation=0,this._matNeedUpdte=!1,rQ.__super.call(this),this._matrix=new rSQ,this._offset=new rdQ,this._tiling=new rdQ(1,1)}rJ(rQ,"laya.d3.core.TransformUV",rd);var re=rQ.prototype;rD.imps(re,{"laya.d3.core.IClone":!0}),re._updateMatrix=function(){rQ._tempOffsetV3.elements[0]=this._offset.x,rQ._tempOffsetV3.elements[1]=this._offset.y,reQ.createFromYawPitchRoll(0,0,this._rotation,rQ._tempRotationQua),rQ._tempTitlingV3.elements[0]=this._tiling.x,rQ._tempTitlingV3.elements[1]=this._tiling.y,rSQ.createAffineTransformation(rQ._tempOffsetV3,rQ._tempRotationQua,rQ._tempTitlingV3,this._matrix)},re.cloneTo=function(rS){rS._matrix=this._matrix.clone(),rS._offset=this._offset.clone(),rS._rotation=this._rotation,rS._tiling=this._tiling.clone()},re.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,re,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),rL(0,re,"tiling",function(){return this._tiling},function(rS){this._tiling=rS,this._matNeedUpdte=!0}),rL(0,re,"offset",function(){return this._offset},function(rS){this._offset=rS,this._matNeedUpdte=!0}),rL(0,re,"rotation",function(){return this._rotation},function(rS){this._rotation=rS,this._matNeedUpdte=!0}),rY(rQ,["_tempOffsetV3",function(){return this._tempOffsetV3=new rTQ(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new reQ},"_tempTitlingV3",function(){return this._tempTitlingV3=new rTQ(1,1,1)}])}(),function(re){function rS(){this.x=NaN,this.y=NaN,this.z=NaN,rS.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}rJ(rS,"laya.d3.core.particleShuriKen.module.shape.BoxShape",re);var rQ=rS.prototype;rQ._getShapeBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=.5*-this.x,rQ[1]=.5*-this.y,rQ[2]=.5*-this.z;var re=rS.max.elements;re[0]=.5*this.x,re[1]=.5*this.y,re[2]=.5*this.z},rQ._getSpeedBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=0,rQ[1]=0,rQ[2]=0;var re=rS.max.elements;re[0]=0,re[1]=1,re[2]=0},rQ.generatePositionAndDirection=function(rS,rQ,re,rl){var rM=rS.elements,rd=rQ.elements;re?(re.seed=rl[16],rx._randomPointInsideHalfUnitBox(rS,re),rl[16]=re.seed):rx._randomPointInsideHalfUnitBox(rS),rM[0]=this.x*rM[0],rM[1]=this.y*rM[1],rM[2]=this.z*rM[2],this.randomDirection?re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ):(rd[0]=0,rd[1]=0,rd[2]=1)},rQ.cloneTo=function(rS){re.prototype.cloneTo.call(this,rS);var rQ=rS;rQ.x=this.x,rQ.y=this.y,rQ.z=this.z,rQ.randomDirection=this.randomDirection}}(rf),function(re){function rT(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,rT.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}rJ(rT,"laya.d3.core.particleShuriKen.module.shape.CircleShape",re);var rS=rT.prototype;rS._getShapeBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[2]=-this.radius,rQ[1]=0;var re=rS.max.elements;re[0]=re[2]=this.radius,re[1]=0},rS._getSpeedBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[1]=-1,rQ[2]=0;var re=rS.max.elements;re[0]=re[1]=1,re[2]=0},rS.generatePositionAndDirection=function(rS,rQ,re,rl){var rM=rS.elements,rd=rT._tempPositionPoint.elements;re?(re.seed=rl[16],this.emitFromEdge?rx._randomPointUnitArcCircle(this.arc,rT._tempPositionPoint,re):rx._randomPointInsideUnitArcCircle(this.arc,rT._tempPositionPoint,re),rl[16]=re.seed):this.emitFromEdge?rx._randomPointUnitArcCircle(this.arc,rT._tempPositionPoint):rx._randomPointInsideUnitArcCircle(this.arc,rT._tempPositionPoint),rM[0]=-rd[0],rM[1]=rd[1],rM[2]=0,rTQ.scale(rS,this.radius,rS),this.randomDirection?re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ):rS.cloneTo(rQ)},rS.cloneTo=function(rS){re.prototype.cloneTo.call(this,rS);var rQ=rS;rQ.radius=this.radius,rQ.arc=this.arc,rQ.emitFromEdge=this.emitFromEdge,rQ.randomDirection=this.randomDirection},rY(rT,["_tempPositionPoint",function(){return this._tempPositionPoint=new rdQ}])}(rf),function(re){function rp(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,rp.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}rJ(rp,"laya.d3.core.particleShuriKen.module.shape.ConeShape",re);var rS=rp.prototype;rS._getShapeBoundBox=function(rS){var rQ=this.radius+this.length*Math.sin(this.angle),re=this.length*Math.cos(this.angle),rl=rS.min.elements;rl[0]=rl[1]=-rQ,rl[2]=0;var rM=rS.max.elements;rM[0]=rM[1]=rQ,rM[2]=re},rS._getSpeedBoundBox=function(rS){var rQ=Math.sin(this.angle),re=rS.min.elements;re[0]=re[1]=-rQ,re[2]=0;var rl=rS.max.elements;rl[0]=re[1]=rQ,rl[2]=1},rS.generatePositionAndDirection=function(rS,rQ,re,rl){var rM,rd=rS.elements,rT=rQ.elements,rU=rp._tempPositionPoint.elements,ri=NaN,rR=NaN,ro=Math.cos(this.angle),rY=Math.sin(this.angle);switch(this.emitType){case 0:re?(re.seed=rl[16],rx._randomPointInsideUnitCircle(rp._tempPositionPoint,re),rl[16]=re.seed):rx._randomPointInsideUnitCircle(rp._tempPositionPoint),ri=rU[0],rR=rU[1],rd[0]=ri*this.radius,rd[1]=rR*this.radius,rd[2]=0,this.randomDirection?(re?(re.seed=rl[17],rx._randomPointInsideUnitCircle(rp._tempDirectionPoint,re),rl[17]=re.seed):rx._randomPointInsideUnitCircle(rp._tempDirectionPoint),rM=rp._tempDirectionPoint.elements,rT[0]=rM[0]*rY,rT[1]=rM[1]*rY):(rT[0]=ri*rY,rT[1]=rR*rY),rT[2]=ro;break;case 1:re?(re.seed=rl[16],rx._randomPointUnitCircle(rp._tempPositionPoint,re),rl[16]=re.seed):rx._randomPointUnitCircle(rp._tempPositionPoint),ri=rU[0],rR=rU[1],rd[0]=ri*this.radius,rd[1]=rR*this.radius,rd[2]=0,this.randomDirection?(re?(re.seed=rl[17],rx._randomPointInsideUnitCircle(rp._tempDirectionPoint,re),rl[17]=re.seed):rx._randomPointInsideUnitCircle(rp._tempDirectionPoint),rM=rp._tempDirectionPoint.elements,rT[0]=rM[0]*rY,rT[1]=rM[1]*rY):(rT[0]=ri*rY,rT[1]=rR*rY),rT[2]=ro;break;case 2:re?(re.seed=rl[16],rx._randomPointInsideUnitCircle(rp._tempPositionPoint,re)):rx._randomPointInsideUnitCircle(rp._tempPositionPoint),ri=rU[0],rR=rU[1],rd[0]=ri*this.radius,rd[1]=rR*this.radius,rT[rd[2]=0]=ri*rY,rT[1]=rR*rY,rT[2]=ro,rTQ.normalize(rQ,rQ),re?(rTQ.scale(rQ,this.length*re.getFloat(),rQ),rl[16]=re.seed):rTQ.scale(rQ,this.length*Math.random(),rQ),rTQ.add(rS,rQ,rS),this.randomDirection&&(re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ));break;case 3:re?(re.seed=rl[16],rx._randomPointUnitCircle(rp._tempPositionPoint,re)):rx._randomPointUnitCircle(rp._tempPositionPoint),ri=rU[0],rR=rU[1],rd[0]=ri*this.radius,rd[1]=rR*this.radius,rT[rd[2]=0]=ri*rY,rT[1]=rR*rY,rT[2]=ro,rTQ.normalize(rQ,rQ),re?(rTQ.scale(rQ,this.length*re.getFloat(),rQ),rl[16]=re.seed):rTQ.scale(rQ,this.length*Math.random(),rQ),rTQ.add(rS,rQ,rS),this.randomDirection&&(re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ));break;default:throw new Error("ConeShape:emitType is invalid.")}},rS.cloneTo=function(rS){re.prototype.cloneTo.call(this,rS);var rQ=rS;rQ.angle=this.angle,rQ.radius=this.radius,rQ.length=this.length,rQ.emitType=this.emitType,rQ.randomDirection=this.randomDirection},rY(rp,["_tempPositionPoint",function(){return this._tempPositionPoint=new rdQ},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new rdQ}])}(rf),function(re){function rS(){this.radius=NaN,this.emitFromShell=!1,rS.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}rJ(rS,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",re);var rQ=rS.prototype;rQ._getShapeBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[1]=rQ[2]=-this.radius;var re=rS.max.elements;re[0]=re[1]=this.radius,re[2]=0},rQ._getSpeedBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[1]=-1,rQ[2]=0;var re=rS.max.elements;re[0]=re[1]=re[2]=1},rQ.generatePositionAndDirection=function(rS,rQ,re,rl){var rM=rS.elements;re?(re.seed=rl[16],this.emitFromShell?rx._randomPointUnitSphere(rS,re):rx._randomPointInsideUnitSphere(rS,re),rl[16]=re.seed):this.emitFromShell?rx._randomPointUnitSphere(rS):rx._randomPointInsideUnitSphere(rS),rTQ.scale(rS,this.radius,rS);var rd=rM[2];rd<0&&(rM[2]=-1*rd),this.randomDirection?re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ):rS.cloneTo(rQ)},rQ.cloneTo=function(rS){re.prototype.cloneTo.call(this,rS);var rQ=rS;rQ.radius=this.radius,rQ.emitFromShell=this.emitFromShell,rQ.randomDirection=this.randomDirection}}(rf),function(re){function rS(){this.radius=NaN,this.emitFromShell=!1,rS.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}rJ(rS,"laya.d3.core.particleShuriKen.module.shape.SphereShape",re);var rQ=rS.prototype;rQ._getShapeBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[1]=rQ[2]=-this.radius;var re=rS.max.elements;re[0]=re[1]=re[2]=this.radius},rQ._getSpeedBoundBox=function(rS){var rQ=rS.min.elements;rQ[0]=rQ[1]=rQ[2]=-1;var re=rS.max.elements;re[0]=re[1]=re[2]=1},rQ.generatePositionAndDirection=function(rS,rQ,re,rl){re?(re.seed=rl[16],this.emitFromShell?rx._randomPointUnitSphere(rS,re):rx._randomPointInsideUnitSphere(rS,re),rl[16]=re.seed):this.emitFromShell?rx._randomPointUnitSphere(rS):rx._randomPointInsideUnitSphere(rS),rTQ.scale(rS,this.radius,rS),this.randomDirection?re?(re.seed=rl[17],rx._randomPointUnitSphere(rQ,re),rl[17]=re.seed):rx._randomPointUnitSphere(rQ):rS.cloneTo(rQ)},rQ.cloneTo=function(rS){re.prototype.cloneTo.call(this,rS);var rQ=rS;rQ.radius=this.radius,rQ.emitFromShell=this.emitFromShell,rQ.randomDirection=this.randomDirection}}(rf),function(rS){function rQ(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,rQ.__super.call(this)}return rJ(rQ,"laya.d3.core.render.SubMeshRenderElement",rZ),rQ}()),rHQ=function(rS){function rc(rS,rQ,re,rl,rM,rd){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=rS,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[rJQ.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[rqQ.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[rqQ.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[rtQ.SHADERDEFINE_ALPHATEST]="ALPHATEST";rc.__super.call(this,rS,rQ,re,null,{}),this._attributeMap=rl;var rT;for(rT in rM){var rU=rM[rT];switch(rU[1]){case 0:this._renderElementUniformMap[rT]=rU[0];break;case 1:this._materialUniformMap[rT]=rU[0];break;case 2:this._spriteUniformMap[rT]=rU[0];break;case 3:this._cameraUniformMap[rT]=rU[0];break;case 4:this._sceneUniformMap[rT]=rU[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}rJ(rc,"laya.d3.shader.ShaderCompile3D",rA);var rQ=rc.prototype;return rQ._definesToNameDic=function(rS,rQ){for(var re={},rl=1,rM=0;rM<32&&!(rS<(rl=1<<rM));rM++)if(rS&rl){var rd=rQ[rl];rd&&(re[rd]="")}return re},rQ.withCompile=function(rS,rQ,re,rl){var rM,rd,rT;if(rd=this.sharders[rS])if(rT=rd[rQ]){if(rM=rT[re])return rM}else rT=rd[rQ]=[];else rT=(rd=this.sharders[rS]=[])[rQ]=[];var rU,ri=this._definesToNameDic(rS,rc._globalInt2name),rR=this._definesToNameDic(rQ,this._spriteInt2name),ro=this._definesToNameDic(re,this._materialInt2name),rY={},rp="";if(ri)for(rU in ri)rp+="#define "+rU+"\n",rY[rU]=!0;if(rR)for(rU in rR)rp+="#define "+rU+"\n",rY[rU]=!0;if(ro)for(rU in ro)rp+="#define "+rU+"\n",rY[rU]=!0;var rJ=rnQ.nameKey.getName(this._name)+" compile ("+rS+","+rQ+","+re+")",rL=this._VS.toscript(rY,[]),rj=this._PS.toscript(rY,[]);rh.now();if(rM=rnQ.create(rp+rL.join("\n"),rp+rj.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,rl,rJ),rT[re]=rM,laya.d3.shader.ShaderCompile3D.debugMode)rh.now();return rM},rQ.precompileShaderWithShaderDefine=function(rS,rQ,re){this.withCompile(rS,rQ,re,!0)},rQ.addMaterialDefines=function(rS){var rQ=rS.defines;for(var re in rQ){var rl=rQ[re],rM=parseInt(re);this._materialInt2name[rM]=rl,this._materialName2Int[rl]=rM}},rQ.addSpriteDefines=function(rS){var rQ=rS.defines;for(var re in rQ){var rl=rQ[re],rM=parseInt(re);this._spriteInt2name[rM]=rl,this._spriteName2Int[rl]=rM}},rQ.getMaterialDefineByName=function(rS){return this._materialName2Int[rS]},rQ.registerMaterialDefine=function(rS){var rQ=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[rQ]=rS,this._materialName2Int[rS]=rQ},rQ.registerSpriteDefine=function(rS){var rQ=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[rQ]=rS,this._spriteName2Int[rS]=rQ},rc._globalRegDefine=function(rS,rQ){rc._globalInt2name[rQ]=rS},rc.add=function(rS,rQ,re,rl,rM){return laya.d3.shader.ShaderCompile3D._preCompileShader[rS]=new rc(rS,rQ,re,rl,rM,rA.includes)},rc.get=function(rS){return laya.d3.shader.ShaderCompile3D._preCompileShader[rnQ.nameKey.getID(rS)]},rc._preCompileShader={},rc._globalInt2name=[],rc.debugMode=!1,rc.SHADERDEFINE_HIGHPRECISION=1,rc.SHADERDEFINE_FOG=4,rc.SHADERDEFINE_DIRECTIONLIGHT=8,rc.SHADERDEFINE_POINTLIGHT=16,rc.SHADERDEFINE_SPOTLIGHT=32,rc.SHADERDEFINE_UV0=64,rc.SHADERDEFINE_COLOR=128,rc.SHADERDEFINE_UV1=256,rc.SAHDERDEFINE_DEPTHFOG=131072,rc}(),rgQ=function(rS){function rL(){rL.__super.call(this)}rJ(rL,"laya.d3.graphics.MeshSprite3DStaticBatchManager",rlS);var rQ=rL.prototype;return rQ._getStaticBatch=function(rS,rQ,re,rl){var rM,rd;return rd=rS?rS.id.toString()+re.id.toString()+rQ.id.toString()+rl.toString():re.id.toString()+rQ.id.toString()+rl.toString(),this._staticBatches[rd]?rM=this._staticBatches[rd]:this._staticBatches[rd]=rM=new rIQ(rd,this,rS,rQ,re),rM},rQ._initStaticBatchs=function(rS){var rQ,re;this._initBatchRenderElements.sort(rL._sortPrepareStaticBatch);for(var rl,rM=!1,rd=0,rT=0,rU=this._initBatchRenderElements.length;rT<rU;rT++){var ri,rR=this._initBatchRenderElements[rT],ro=rR.renderObj._getVertexBuffer(0);rR._sprite3D;if(re===ro.vertexDeclaration&&rQ===rR._material)if(rM)rl._addCombineBatchRenderObjTest(rR)?(ri=rR._staticBatch)!==rl&&(ri&&ri._deleteCombineBatchRenderObj(rR),rl._addCombineBatchRenderObj(rR)):(rM=!1,rd++);else{var rY=this._initBatchRenderElements[rT-1],rp=rY.renderObj,rJ=rR.renderObj;rM=!(65535<rp._getVertexBuffer().vertexCount+rJ._getVertexBuffer().vertexCount)&&(rl=this._getStaticBatch(rS,re,rQ,rd),(ri=rY._staticBatch)!==rl&&(ri&&ri._deleteCombineBatchRenderObj(rY),rl._addCombineBatchRenderObj(rY)),(ri=rR._staticBatch)!==rl&&(ri&&ri._deleteCombineBatchRenderObj(rR),rl._addCombineBatchRenderObj(rR)),!0)}else rM=!1,rd=0;rQ=rR._material,re=ro.vertexDeclaration}},rL._sortPrepareStaticBatch=function(rS,rQ){var re=rS._render,rl=rQ._render,rM=re.lightmapIndex-rl.lightmapIndex;if(0!=rM)return rM;var rd=re.receiveShadow-rl.receiveShadow;if(0!=rd)return rd;var rT=rS._mainSortID-rQ._mainSortID;return 0==rT?rS.renderObj.triangleCount-rQ.renderObj.triangleCount:rT},rL}(),rIQ=function(rS){function rd(rS,rQ,re,rl,rM){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,rd.__super.call(this,rS,rQ,re),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=rl,this._material=rM}rJ(rd,"laya.d3.graphics.SubMeshStaticBatch",rMS);var rQ=rd.prototype;return rQ._compareBatchRenderElement=function(rS,rQ){return rS._batchIndexStart>rQ._batchIndexStart},rQ._addCombineBatchRenderObjTest=function(rS){var rQ=rS.renderObj._vertexCount;return!(65535<(0<rQ?this._currentCombineVertexCount+rQ:this._currentCombineVertexCount+rS.renderObj._getVertexBuffer().vertexCount))},rQ._addCombineBatchRenderObj=function(rS){var rQ=rS.renderObj,re=rQ._vertexCount;this._initBatchRenderElements.push(rS),rS._staticBatch=this,0<re?(this._currentCombineIndexCount+=rQ._indexCount,this._currentCombineVertexCount+=re):(this._currentCombineIndexCount=this._currentCombineIndexCount+rQ._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+rQ._getVertexBuffer().vertexCount),this._needFinishCombine=!0},rQ._deleteCombineBatchRenderObj=function(rS){var rQ=rS.renderObj,re=this._initBatchRenderElements.indexOf(rS);if(-1!==re){this._initBatchRenderElements.splice(re,1),rS._staticBatch=null;var rl=rQ._vertexCount;0<rl?(this._currentCombineIndexCount=this._currentCombineIndexCount-rQ._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-rl):(this._currentCombineIndexCount=this._currentCombineIndexCount-rQ._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-rQ._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},rQ._finishInit=function(){if(this._needFinishCombine){var rS=0,rQ=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var re=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),rl=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=rfQ.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=raQ.create("ushort",this._currentCombineIndexCount,35044);for(var rM=0,rd=this._initBatchRenderElements.length;rM<rd;rM++){var rT=this._initBatchRenderElements[rM],rU=rT.renderObj,ri=rU._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,rT._sprite3D),rR=rU.getIndices(),ro=rT._sprite3D.transform._isFrontFaceInvert,rY=rS/(this._vertexDeclaration.vertexStride/4)-rU._vertexStart,rp=rQ,rJ=rp+rR.length;rT._batchIndexStart=rp,rT._batchIndexEnd=rJ,rl.set(rR,rQ);var rL=0;if(ro)for(rL=rp;rL<rJ;rL+=3){rl[rL]=rY+rl[rL];var rj=rl[rL+1],rc=rl[rL+2];rl[rL+1]=rY+rc,rl[rL+2]=rY+rj}else for(rL=rp;rL<rJ;rL+=3)rl[rL]=rY+rl[rL],rl[rL+1]=rY+rl[rL+1],rl[rL+2]=rY+rl[rL+2];rQ+=rR.length,re.set(ri,rS),rS+=ri.length}this._vertexBuffer.setData(re),this._indexBuffer.setData(rl),this._needFinishCombine=!1}},rQ._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new rOQ)},rQ._getRenderElement=function(rS,rQ,re){for(var rl,rM,rd=this._batchRenderElements.length,rT=!0,rU=0;rU<rd;rU++){var ri,rR,ro=(rM=this._batchRenderElements[rU])._sprite3D._render;if(0!==rU&&(rT=(ri=(rl=this._batchRenderElements[rU-1])._sprite3D._render).lightmapIndex!==ro.lightmapIndex||ri.receiveShadow!==ro.receiveShadow||rl._batchIndexEnd!==rM._batchIndexStart),rT){(rR=this._getCombineRenderElementFromPool()).renderObj=this,rR._material=this._material,rR._batchIndexStart=rM._batchIndexStart,rR._batchIndexEnd=rM._batchIndexEnd;var rY=ro.lightmapIndex,rp=rY+1,rJ=this._batchOwnerIndices[rp];rJ||(rJ=this._batchOwnerIndices[rp]=[]);var rL,rj=rJ[rM._render.receiveShadow?1:0];void 0===rj?(rJ[ro.receiveShadow?1:0]=this._batchOwners.length,(rL=new rNQ(null,"StaticBatchMeshSprite3D"))._scene=rQ,rL._transform=this._rootOwner?this._rootOwner._transform:null,rL._render.lightmapIndex=rY,rL._render.receiveShadow=rM._render.receiveShadow,this._batchOwners.push(rL)):rL=this._batchOwners[rj],rL._render._renderUpdate(re),rR._sprite3D=rL,rS.push(rR)}else rR._batchIndexEnd=rM._batchIndexEnd}},rQ._beforeRender=function(rS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},rQ._render=function(rS){var rQ=rS.renderElement,re=rQ._batchIndexStart,rl=rQ._batchIndexEnd-re;rk.mainContext.drawElements(4,rl,5123,2*re),rH.drawCall++,rH.trianglesFaces+=rl/3},rQ.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},rQ._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),this._vertexBuffer},rd}(),rEQ=function(rS){function rQ(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,rQ.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}rJ(rQ,"laya.d3.core.ComponentNode",rR);var re=rQ.prototype;return re.addComponent=function(rS){var rQ,re=this._componentsMap.indexOf(rS);if(-1===re)rQ=[],this._componentsMap.push(rS),this._typeComponentsIndices.push(rQ);else if(rQ=this._typeComponentsIndices[re],this._components[rQ[0]].isSingleton)throw new Error("无法单实例创建"+rS+"组件，"+rS+"组件已存在！");var rl=rM.getInstance(rS);return rQ.push(this._components.length),this._components.push(rl),rl instanceof laya.d3.component.Script&&this._scripts.push(rl),rl._initialize(this),rl},re._removeComponent=function(rS,rQ){var re=this._typeComponentsIndices[rS],rl=re[rQ],rM=this._components[rl];this._components.splice(rl,1),rM instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(rM),1),re.splice(rQ,1),0===re.length&&(this._typeComponentsIndices.splice(rS,1),this._componentsMap.splice(rS,1));for(var rd=0,rT=this._componentsMap.length;rd<rT;rd++)for(var rU=(re=this._typeComponentsIndices[rd]).length-1;0<=rU;rU--){var ri=re[rU];if(!(rl<ri))break;re[rU]=--ri}rM._destroy()},re.getComponentByType=function(rS,rQ){void 0===rQ&&(rQ=0);var re=this._componentsMap.indexOf(rS);return-1===re?null:this._components[this._typeComponentsIndices[re][rQ]]},re.getComponentsByType=function(rS,rQ){var re=this._componentsMap.indexOf(rS);if(-1!==re){var rl=this._typeComponentsIndices[re],rM=rl.length;rQ.length=rM;for(var rd=0;rd<rM;rd++)rQ[rd]=this._components[rl[rd]]}else rQ.length=0},re.getComponentByIndex=function(rS){return this._components[rS]},re.removeComponentByType=function(rS,rQ){void 0===rQ&&(rQ=0);var re=this._componentsMap.indexOf(rS);-1!==re&&this._removeComponent(re,rQ)},re.removeComponentsByType=function(rS){var rQ=this._componentsMap.indexOf(rS);if(-1!==rQ)for(var re=this._typeComponentsIndices[rQ],rl=0,rM=re.length;rl<rM;re.length<rM?rM--:rl++)this._removeComponent(rQ,rl)},re.removeAllComponent=function(){for(var rS=0,rQ=this._componentsMap.length;rS<rQ;this._componentsMap.length<rQ?rQ--:rS++)this.removeComponentsByType(this._componentsMap[rS])},re._updateComponents=function(rS){for(var rQ=0,re=this._components.length;rQ<re;rQ++){var rl=this._components[rQ];!rl.started&&(rl._start(rS),rl.started=!0),rl.enable&&rl._update(rS)}},re._lateUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._lateUpdate(rS)}},re._preRenderUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._preRenderUpdate(rS)}},re._postRenderUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._postRenderUpdate(rS)}},rQ}(),rtQ=function(rl){function rS(){rS.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new rpQ,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new rUQ(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}rJ(rS,"laya.d3.core.material.BaseMaterial",rl);var rQ=rS.prototype;return rD.imps(rQ,{"laya.d3.core.IClone":!0}),rQ._addShaderDefine=function(rS){this._shaderDefineValue|=rS},rQ._removeShaderDefine=function(rS){this._shaderDefineValue&=~rS},rQ._addDisablePublicShaderDefine=function(rS){this._disablePublicShaderDefine|=rS},rQ._removeDisablePublicShaderDefine=function(rS){this._disablePublicShaderDefine&=~rS},rQ._setBuffer=function(rS,rQ){this._shaderValues.setValue(rS,rQ),this._values[rS]=rQ},rQ._getBuffer=function(rS){return this._values[rS]},rQ._setMatrix4x4=function(rS,rQ){this._shaderValues.setValue(rS,rQ?rQ.elements:null),this._values[rS]=rQ},rQ._getMatrix4x4=function(rS){return this._values[rS]},rQ._setInt=function(rS,rQ){this._shaderValues.setValue(rS,rQ),this._values[rS]=rQ},rQ._getInt=function(rS){return this._values[rS]},rQ._setNumber=function(rS,rQ){this._shaderValues.setValue(rS,rQ),this._values[rS]=rQ},rQ._getNumber=function(rS){return this._values[rS]},rQ._setBool=function(rS,rQ){this._shaderValues.setValue(rS,rQ),this._values[rS]=rQ},rQ._getBool=function(rS){return this._values[rS]},rQ._setVector2=function(rS,rQ){this._shaderValues.setValue(rS,rQ?rQ.elements:null),this._values[rS]=rQ},rQ._getVector2=function(rS){return this._values[rS]},rQ._setColor=function(rS,rQ){this._shaderValues.setValue(rS,rQ?rQ.elements:null),this._values[rS]=rQ},rQ._getColor=function(rS){return this._values[rS]},rQ._setTexture=function(rS,rQ){var re=this._values[rS];this._values[rS]=rQ,this._shaderValues.setValue(rS,rQ),0<this.referenceCount&&(re&&re._removeReference(),rQ&&rQ._addReference())},rQ._getTexture=function(rS){return this._values[rS]},rQ._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},rQ._getShader=function(rS,rQ,re){var rl=(rS|rQ)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(rl,re,this._shaderDefineValue),this._shader},rQ._setRenderStateBlendDepth=function(){var rS=rk.mainContext;switch(rX.setDepthMask(rS,this.depthWrite),0===this.depthTest?rX.setDepthTest(rS,!1):(rX.setDepthTest(rS,!0),rX.setDepthFunc(rS,this.depthTest)),this.blend){case 0:rX.setBlend(rS,!1);break;case 1:rX.setBlend(rS,!0),rX.setBlendFunc(rS,this.srcBlend,this.dstBlend);break;case 2:rX.setBlend(rS,!0)}},rQ._setRenderStateFrontFace=function(rS,rQ){var re=rk.mainContext,rl=0;switch(this.cull){case 0:rX.setCullFace(re,!1);break;case 1:rX.setCullFace(re,!0),rl=rS?rQ&&rQ._isFrontFaceInvert?2305:2304:rQ&&rQ._isFrontFaceInvert?2304:2305,rX.setFrontFace(re,rl);break;case 2:rX.setCullFace(re,!0),rl=rS?rQ&&rQ._isFrontFaceInvert?2304:2305:rQ&&rQ._isFrontFaceInvert?2305:2304,rX.setFrontFace(re,rl)}},rQ.onAsynLoaded=function(rS,rQ,re){var rl=rQ[0],rM=rQ[1];switch(rl.version){case"LAYAMATERIAL:01":var rd=0,rT=0,rU=rl.props;for(var ri in rU)switch(ri){case"vectors":var rR=rU[ri];for(rd=0,rT=rR.length;rd<rT;rd++){var ro=rR[rd],rY=ro.value;switch(rY.length){case 2:this[ro.name]=new rdQ(rY[0],rY[1]);break;case 3:this[ro.name]=new rTQ(rY[0],rY[1],rY[2]);break;case 4:this[ro.name]=new rUQ(rY[0],rY[1],rY[2],rY[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var rp=rU[ri];for(rd=0,rT=rp.length;rd<rT;rd++){var rJ=rp[rd],rL=rJ.path;rL&&(this[rJ.name]=rG.getRes(rM[rL]))}break;case"defines":var rj=rU[ri];for(rd=0,rT=rj.length;rd<rT;rd++){var rc=this._shaderCompile.getMaterialDefineByName(rj[rd]);this._addShaderDefine(rc)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[ri]=rU[ri];break;case"renderQueue":switch(rU[ri]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[ri]=rU[ri]}break;case"LAYAMATERIAL:02":for(ri in rU=rl.props)switch(ri){case"vectors":for(rd=0,rT=(rR=rU[ri]).length;rd<rT;rd++)switch((rY=(ro=rR[rd]).value).length){case 2:this[ro.name]=new rdQ(rY[0],rY[1]);break;case 3:this[ro.name]=new rTQ(rY[0],rY[1],rY[2]);break;case 4:this[ro.name]=new rUQ(rY[0],rY[1],rY[2],rY[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(rd=0,rT=(rp=rU[ri]).length;rd<rT;rd++)(rL=(rJ=rp[rd]).path)&&(this[rJ.name]=rG.getRes(rM[rL]));break;case"defines":for(rd=0,rT=(rj=rU[ri]).length;rd<rT;rd++)rc=this._shaderCompile.getMaterialDefineByName(rj[rd]),this._addShaderDefine(rc);break;default:this[ri]=rU[ri]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},rQ._addReference=function(){rl.prototype._addReference.call(this);for(var rS=0,rQ=this._values.length;rS<rQ;rS++){var re=this._values[rS];re&&re instanceof laya.d3.resource.BaseTexture&&re._addReference()}},rQ._removeReference=function(){rl.prototype._removeReference.call(this);for(var rS=0,rQ=this._values.length;rS<rQ;rS++){var re=this._values[rS];re&&re instanceof laya.d3.resource.BaseTexture&&re._removeReference()}},rQ.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},rQ.setShaderName=function(rS){var rQ=rnQ.nameKey.getID(rS);if(-1===rQ)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=rHQ._preCompileShader[rQ]},rQ.cloneTo=function(rS){var rQ=rS;rQ.name=this.name,rQ.cull=this.cull,rQ.blend=this.blend,rQ.srcBlend=this.srcBlend,rQ.dstBlend=this.dstBlend,rQ.srcBlendRGB=this.srcBlendRGB,rQ.dstBlendRGB=this.dstBlendRGB,rQ.srcBlendAlpha=this.srcBlendAlpha,rQ.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(rQ.blendConstColor),rQ.blendEquation=this.blendEquation,rQ.blendEquationRGB=this.blendEquationRGB,rQ.blendEquationAlpha=this.blendEquationAlpha,rQ.depthTest=this.depthTest,rQ.depthWrite=this.depthWrite,rQ.renderQueue=this.renderQueue,rQ._shader=this._shader,rQ._disablePublicShaderDefine=this._disablePublicShaderDefine,rQ._shaderDefineValue=this._shaderDefineValue;var re,rl=0,rM=rQ._shaderValues;rQ._shaderValues.data.length=this._shaderValues.data.length;var rd=this._values.length,rT=rQ._values;for(rl=0,re=rT.length=rd;rl<re;rl++){var rU=this._values[rl];if(rU)if("number"==typeof rU)rT[rl]=rU,rM.data[rl]=rU;else if("number"==typeof rU&&Math.floor(rU)==rU)rT[rl]=rU,rM.data[rl]=rU;else if("boolean"==typeof rU)rT[rl]=rU,rM.data[rl]=rU;else if(rU instanceof laya.d3.math.Vector2){var ri=rT[rl]||(rT[rl]=new rdQ);rU.cloneTo(ri),rM.data[rl]=ri.elements}else if(rU instanceof laya.d3.math.Vector3){var rR=rT[rl]||(rT[rl]=new rTQ);rU.cloneTo(rR),rM.data[rl]=rR.elements}else if(rU instanceof laya.d3.math.Vector4){var ro=rT[rl]||(rT[rl]=new rUQ);rU.cloneTo(ro),rM.data[rl]=ro.elements}else if(rU instanceof laya.d3.math.Matrix4x4){var rY=rT[rl]||(rT[rl]=new rSQ);rU.cloneTo(rY),rM.data[rl]=rY.elements}else rU instanceof laya.d3.resource.BaseTexture&&(rT[rl]=rU,rM.data[rl]=rU)}},rQ.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},rL(0,rQ,"alphaTestValue",function(){return this._getNumber(0)},function(rS){this._setNumber(0,rS)}),rL(0,rQ,"alphaTest",function(){return this._alphaTest},function(rS){(this._alphaTest=rS)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),rS.__init__=function(){rS.SHADERDEFINE_ALPHATEST=rS.shaderDefines.registerDefine("ALPHATEST")},rS.RENDERQUEUE_OPAQUE=2e3,rS.RENDERQUEUE_ALPHATEST=2450,rS.RENDERQUEUE_TRANSPARENT=3e3,rS.CULL_NONE=0,rS.CULL_FRONT=1,rS.CULL_BACK=2,rS.BLEND_DISABLE=0,rS.BLEND_ENABLE_ALL=1,rS.BLEND_ENABLE_SEPERATE=2,rS.BLENDPARAM_ZERO=0,rS.BLENDPARAM_ONE=1,rS.BLENDPARAM_SRC_COLOR=768,rS.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,rS.BLENDPARAM_DST_COLOR=774,rS.BLENDPARAM_ONE_MINUS_DST_COLOR=775,rS.BLENDPARAM_SRC_ALPHA=770,rS.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,rS.BLENDPARAM_DST_ALPHA=772,rS.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,rS.BLENDPARAM_SRC_ALPHA_SATURATE=776,rS.BLENDEQUATION_ADD=0,rS.BLENDEQUATION_SUBTRACT=1,rS.BLENDEQUATION_REVERSE_SUBTRACT=2,rS.DEPTHTEST_OFF=0,rS.DEPTHTEST_NEVER=512,rS.DEPTHTEST_LESS=513,rS.DEPTHTEST_EQUAL=514,rS.DEPTHTEST_LEQUAL=515,rS.DEPTHTEST_GREATER=516,rS.DEPTHTEST_NOTEQUAL=517,rS.DEPTHTEST_GEQUAL=518,rS.DEPTHTEST_ALWAYS=519,rS.SHADERDEFINE_ALPHATEST=1,rS.ALPHATESTVALUE=0,rY(rS,["shaderDefines",function(){return this.shaderDefines=new roQ}]),rS}(rc),rkQ=function(rS){function rQ(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,rQ.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}rJ(rQ,"laya.d3.resource.BaseTexture",rc);var re=rQ.prototype;return rL(0,re,"width",function(){return this._width}),rL(0,re,"repeat",function(){return this._repeat},function(rS){if(this._repeat!==rS&&(this._repeat=rS,this._source)){var rQ=rk.mainContext;rX.bindTexture(rQ,this._type,this._source),rv.isPOT(this._width,this._height)&&this._repeat?(rQ.texParameteri(this._type,10242,10497),rQ.texParameteri(this._type,10243,10497)):(rQ.texParameteri(this._type,10242,33071),rQ.texParameteri(this._type,10243,33071))}}),rL(0,re,"height",function(){return this._height}),rL(0,re,"magFifter",function(){return this._magFifter},function(rS){(this._magFifter=rS)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(rS)}),rL(0,re,"wrapModeV",function(){return this._wrapModeV}),rL(0,re,"size",function(){return this._size}),rL(0,re,"wrapModeU",function(){return this._wrapModeU}),rL(0,re,"mipmap",function(){return this._mipmap},function(rS){this._mipmap=rS,this._mipmap!=rS&&this._conchTexture&&this._conchTexture.setMipMap(rS)}),rL(0,re,"minFifter",function(){return this._minFifter},function(rS){this._minFifter=rS,this._minFifter!=rS&&this._conchTexture&&this._conchTexture.setMinFifter(rS)}),rL(0,re,"format",function(){return this._format}),rL(0,re,"source",function(){return this.activeResource(),this._source}),rL(0,re,"defaulteTexture",function(){return rWQ.grayTexture}),rQ.WARPMODE_REPEAT=0,rQ.WARPMODE_CLAMP=1,rQ}(),rXQ=function(rS){function rQ(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,rQ.__super.call(this),this._boundingBoxCorners=rl(8,null)}rJ(rQ,"laya.d3.resource.models.BaseMesh",rc);var re=rQ.prototype;return re._getPositions=function(){throw new Error("未Override,请重载该属性！")},re._generateBoundingObject=function(){this._boundingSphere=new r_S(new rTQ,0),r_S.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new rKS(new rTQ,new rTQ),rKS.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},re.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},re.getRenderElement=function(rS){throw new Error("未Override,请重载该属性！")},rL(0,re,"subMeshCount",function(){return this._subMeshCount}),rL(0,re,"boundingBox",function(){return this._boundingBox}),rL(0,re,"boundingBoxCorners",function(){return this._boundingBoxCorners}),rL(0,re,"boundingSphere",function(){return this._boundingSphere}),rQ}(),rhQ=(function(rS){function rQ(){rQ.__super.call(this)}rJ(rQ,"laya.d3.component.Script",rAQ);var re=rQ.prototype;re.onTriggerEnter=function(rS){},re.onTriggerExit=function(rS){},re.onTriggerStay=function(rS){},rL(0,re,"isSingleton",function(){return rQ._isSingleton}),rQ._isSingleton=!1}(),function(rS){function rQ(rS){this._owner=null,this._sharedMesh=null,rQ.__super.call(this),this._owner=rS}rJ(rQ,"laya.d3.core.MeshFilter",rS);var re=rQ.prototype;return re._sharedMeshLoaded=function(){this.event("loaded")},re._destroy=function(){rS.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},rL(0,re,"sharedMesh",function(){return this._sharedMesh},function(rS){var rQ=this._sharedMesh;rQ&&rQ._removeReference(),(this._sharedMesh=rS)._addReference(),this.event("meshchanged",[this,rQ,rS]),rS.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),rL(0,re,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),rL(0,re,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),rL(0,re,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),rL(0,re,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),rQ}(rvQ)),rbQ=function(rS){function rQ(rS){rQ.__super.call(this,rS),rS.meshFilter.on("meshchanged",this,this._onMeshChanged)}rJ(rQ,"laya.d3.core.MeshRender",rDQ);var re=rQ.prototype;return re._onMeshChanged=function(rS,rQ,re){re.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:re.once("loaded",this,this._onMeshLoaed)},re._onMeshLoaed=function(rS,rQ){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},re._calculateBoundingSphereByInitSphere=function(rS){var rQ=NaN,re=this._owner.transform,rl=re.scale.elements,rM=Math.abs(rl[0]),rd=Math.abs(rl[1]),rT=Math.abs(rl[2]);rQ=rd<=rM&&rT<=rM?rM:rT<=rd?rd:rT,rTQ.transformCoordinate(rS.center,re.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=rS.radius*rQ},re._calculateBoundBoxByInitCorners=function(rS){for(var rQ=this._owner.transform.worldMatrix,re=0;re<8;re++)rTQ.transformCoordinate(rS[re],rQ,rDQ._tempBoundBoxCorners[re]);rKS.createfromPoints(rDQ._tempBoundBoxCorners,this._boundingBox)},re._calculateBoundingSphere=function(){var rS=this._owner.meshFilter.sharedMesh;null==rS||null==rS.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(rS.boundingSphere)},re._calculateBoundingBox=function(){var rS=this._owner.meshFilter.sharedMesh;null==rS||null==rS.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(rS.boundingBoxCorners)},re._renderUpdate=function(rS){var rQ=this._owner.transform;if(rQ){this._setShaderValueMatrix4x4(0,rQ.worldMatrix);var re=this._owner.getProjectionViewWorldMatrix(rS);this._setShaderValueMatrix4x4(1,re)}else this._setShaderValueMatrix4x4(0,rSQ.DEFAULT),this._setShaderValueMatrix4x4(1,rS);return rGQ.debugMode&&this._renderRenderableBoundBox(),!0},rQ}(),rmQ=function(rQ){function rl(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,rl.__super.call(this),this._renderState=new rC,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new rpQ,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new rQS,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new rTQ(.7,.7,.7),this.ambientColor=new rTQ(.212,.227,.259),rk.shaderHighPrecision&&this.addShaderDefine(rHQ.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}rJ(rl,"laya.d3.core.scene.Scene",rQ);var rS=rl.prototype;return rD.imps(rS,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),rS._setUrl=function(rS){this._url=rS},rS._getGroup=function(){return this._group},rS._setGroup=function(rS){this._group=rS},rS._display=function(){rD.stage._scenes.push(this),rD.stage._scenes.sort(rl._sortScenes);for(var rS=0,rQ=this._childs.length;rS<rQ;rS++){var re=this._childs[rS];re.active&&re._activeHierarchy()}},rS._unDisplay=function(){var rS=rD.stage._scenes;rS.splice(rS.indexOf(this),1);for(var rQ=0,re=this._childs.length;rQ<re;rQ++){var rl=this._childs[rQ];rl.active&&rl._inActiveHierarchy()}},rS._addChild3D=function(rS){rS.transform._onWorldTransform(),rS._setBelongScene(this),this.displayedInStage&&rS.active&&rS._activeHierarchy()},rS._removeChild3D=function(rS){rS.transform.parent=null,this.displayedInStage&&rS.active&&rS._inActiveHierarchy(),rS._setUnBelongScene()},rS.initOctree=function(rS,rQ,re,rl,rM){void 0===rM&&(rM=6),this.treeSize=new rTQ(rS,rQ,re),this.treeLevel=rM,this.treeRoot=new rK(this,0),this.treeRoot.init(rl,this.treeSize)},rS._prepareUpdateToRenderState=function(rS,rQ){rQ.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,rQ.scene=this},rS._prepareSceneToRender=function(rS){var rQ=this._lights.length;if(0<rQ)for(var re=0,rl=0;rl<rQ&&!(this._lights[rl]._prepareToScene(rS)&&++re>=this._enableLightCount);rl++);},rS._updateChilds=function(rS){for(var rQ=0,re=this._childs.length;rQ<re;++rQ)this._childs[rQ]._update(rS)},rS._preRenderScene=function(rS,rQ,re){var rl,rM=rQ._viewMatrix,rd=rQ._projectionMatrix,rT=rQ._projectionViewMatrix,rU=0,ri=rQ.camera;for(ri.useOcclusionCulling?this.treeRoot?reS.renderObjectCullingOctree(re,this,ri,rM,rd,rT):reS.renderObjectCulling(re,this,ri,rM,rd,rT):reS.renderObjectCullingNoBoundFrustum(this,ri,rM,rd,rT),rU=0,rl=this._quenes.length;rU<rl;rU++)this._quenes[rU]&&this._quenes[rU]._preRender(rQ)},rS._clear=function(rS,rQ){var re=rQ._viewport,rl=rQ.camera,rM=re.x,rd=rl.renderTargetSize.height-re.y-re.height,rT=re.width,rU=re.height;rS.viewport(rM,rd,rT,rU);var ri=256,rR=rl.renderTarget;switch(rl.clearFlag){case 0:var ro=rl.clearColor;if(ro){rS.enable(3089),rS.scissor(rM,rd,rT,rU);var rY=ro.elements;rS.clearColor(rY[0],rY[1],rY[2],rY[3]),ri|=16384}if(rR)switch(ro||(ri=16384),rR.depthStencilFormat){case 33189:ri|=256;break;case 36168:ri|=1024;break;case 34041:ri|=256,ri|=1024}rS.clear(ri),ro&&rS.disable(3089);break;case 1:case 2:if(rR)switch(ri=16384,rR.depthStencilFormat){case 33189:ri|=256;break;case 36168:ri|=1024;break;case 34041:ri|=256,ri|=1024}rS.clear(ri);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},rS._renderScene=function(rS,rQ){var re,rl,rM=rQ.camera,rd=0;for(rd=0;rd<2;rd++)(rl=this._quenes[rd])&&(rM.renderTarget?rl._render(rQ,!0):rl._render(rQ,!1));if(1===rM.clearFlag){var rT=rM.sky;rT&&(rX.setCullFace(rS,!1),rX.setDepthFunc(rS,515),rX.setDepthMask(rS,!1),rT._render(rQ),rX.setDepthFunc(rS,513),rX.setDepthMask(rS,!0))}for(rd=2,re=this._quenes.length;rd<re;rd++)(rl=this._quenes[rd])&&(rl._sortAlpha(rQ.camera.transform.position),rM.renderTarget?rl._render(rQ,!0):rl._render(rQ,!1))},rS._set3DRenderConfig=function(rS){rS.disable(3042),rX._blend=!1,rS.blendFunc(770,771),rX._sFactor=770,rX._dFactor=771,rS.disable(2929),rX._depthTest=!1,rS.enable(2884),rX._cullFace=!0,rS.depthMask(1),rX._depthMask=!0,rS.frontFace(2304),rX._frontFace=2304},rS._set2DRenderConfig=function(rS){rX.setBlend(rS,!0),rX.setBlendFunc(rS,1,771),rX.setDepthTest(rS,!1),rX.setCullFace(rS,!1),rX.setDepthMask(rS,!0),rX.setFrontFace(rS,2305),rS.viewport(0,0,ro.width,ro.height)},rS._parseCustomProps=function(rS,rQ,re,rl){var rM=rl.customProps.lightmaps,rd=rM.length,rT=this._lightmaps;rT.length=rd;for(var rU=0;rU<rd;rU++)rT[rU]=rG.getRes(rQ[rM[rU].replace(".exr",".png")]);this.setlightmaps(rT);var ri=rl.customProps.ambientColor;ri&&(this.ambientColor=new rTQ(ri[0],ri[1],ri[2]));var rR=rl.customProps.fogColor;rR&&(this.fogColor=new rTQ(rR[0],rR[1],rR[2]))},rS._addLight=function(rS){this._lights.indexOf(rS)<0&&this._lights.push(rS)},rS._removeLight=function(rS){var rQ=this._lights.indexOf(rS);0<=rQ&&this._lights.splice(rQ,1)},rS._updateScene=function(){var rS=this._renderState;this._prepareUpdateToRenderState(rk.mainContext,rS),this._updateComponents(rS),this._updateChilds(rS),this._lateUpdateComponents(rS),this._time+=rS.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},rS._updateSceneConch=function(){var rS=this._renderState;this._prepareUpdateToRenderState(rk.mainContext,rS),this._updateComponents(rS),this._lateUpdateComponents(rS),this._prepareSceneToRender(rS);for(var rQ=0,re=this._cameraPool.length;rQ<re;rQ++){var rl=this._cameraPool[rQ];(rS.camera=rl)._prepareCameraToRender()}},rS._preRenderShadow=function(rS,rQ,re,rl,rM){this.treeRoot?reS.renderShadowObjectCullingOctree(this,rQ,re,rl,rM):reS.renderShadowObjectCulling(this,rQ,re,rl,rM);for(var rd=0,rT=re.length;rd<rT;rd++)re[rd]&&re[rd]._preRender(rS)},rS._renderShadowMap=function(rS,rQ,re){var rl=this.parallelSplitShadowMaps[0];rl._calcAllLightCameraInfo(re);var rM,rd,rT,rU=rl.PSSMNum;if(this._preRenderShadow(rQ,rl._lightCulling,rl._shadowQuenes,rl._lightVPMatrix[0],rU),this.addShaderDefine(rJQ.SHADERDEFINE_CAST_SHADOW),1<rU)for(var ri=0;ri<rU;ri++)rM=rl.getRenderTarget(ri+1),rl.beginRenderTarget(ri+1),rS.clearColor(1,1,1,1),rS.clear(16640),rS.viewport(0,0,rM.width,rM.height),rQ.camera=rT=rl.getLightCamera(ri),rT._prepareCameraToRender(),rT._prepareCameraViewProject(rT.viewMatrix,rT.projectionMatrix),rQ._projectionViewMatrix=rl._lightVPMatrix[ri+1],(rd=rl._shadowQuenes[ri])._preRender(rQ),rd._renderShadow(rQ,!1),rl.endRenderTarget(ri+1);else rM=rl.getRenderTarget(1),rl.beginRenderTarget(1),rS.clearColor(1,1,1,1),rS.clear(16640),rS.viewport(0,0,rM.width,rM.height),rQ.camera=rT=rl.getLightCamera(0),rT._prepareCameraToRender(),rT._prepareCameraViewProject(rT.viewMatrix,rT.projectionMatrix),rQ._projectionViewMatrix=rl._lightVPMatrix[0],(rd=rl._shadowQuenes[0])._preRender(rQ),rd._renderShadow(rQ,!0),rl.endRenderTarget(1);this.removeShaderDefine(rJQ.SHADERDEFINE_CAST_SHADOW)},rS.addTreeNode=function(rS){this.treeRoot.addTreeNode(rS)},rS.removeTreeNode=function(rS){this.treeSize&&rS._treeNode&&rS._treeNode.removeObject(rS)},rS.setlightmaps=function(rS){this._lightmaps=rS;for(var rQ=0,re=this._renderableSprite3Ds.length;rQ<re;rQ++)this._renderableSprite3Ds[rQ]._render._applyLightMapParams()},rS.getlightmaps=function(){return this._lightmaps},rS.addChildAt=function(rS,rQ){if(!(rS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(rS&&rS.__className));if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),0<=rQ&&rQ<=this._childs.length){if(rS._parent===this){var re=this.getChildIndex(rS);this._childs.splice(re,1),this._childs.splice(rQ,0,rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,rQ)),this._childChanged()}else rS.parent&&rS.parent.removeChild(rS),this._childs===rR.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(rQ,0,rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,rQ),(rS.parent=this)._addChild3D(rS);return rS}throw new Error("appendChildAt:The index is out of bounds")},rS.addChild=function(rS){if(!(rS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),rS._parent===this){var rQ=this.getChildIndex(rS);rQ!==this._childs.length-1&&(this._childs.splice(rQ,1),this._childs.push(rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,this._childs.length-1)),this._childChanged())}else rS.parent&&rS.parent.removeChild(rS),this._childs===rR.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,this._childs.length-1),(rS.parent=this)._childChanged(),this._addChild3D(rS);return rS},rS.removeChildAt=function(rS){var rQ=this.getChildAt(rS);return rQ&&(this._removeChild3D(rQ),this._childs.splice(rS,1),this.conchModel&&this.conchModel.removeChild(rQ.conchModel),rQ.parent=null),rQ},rS.removeChildren=function(rS,rQ){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=2147483647),this._childs&&0<this._childs.length){var re=this._childs;if(0===rS&&rd<=rQ){var rl=re;this._childs=rR.ARRAY_EMPTY}else rl=re.splice(rS,rQ-rS);for(var rM=0,rd=rl.length;rM<rd;rM++)this._removeChild3D(rl[rM]),rl[rM].parent=null,this.conchModel&&this.conchModel.removeChild(rl[rM].conchModel)}return this},rS.addFrustumCullingObject=function(rS){this.treeRoot?this.addTreeNode(rS):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(rS):this._cullingRenders[this._cullingRendersLength]=rS,rS._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},rS.removeFrustumCullingObject=function(rS){if(this.treeRoot)this.removeTreeNode(rS);else{this._cullingRendersLength--;var rQ=rS._indexInSceneFrustumCullingObjects;if(rQ!==this._cullingRendersLength){var re=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[rQ]=re)._indexInSceneFrustumCullingObjects=rQ,rS._indexInSceneFrustumCullingObjects=-1}}},rS.getRenderQueue=function(rS){return rS<3e3?this._quenes[1]||(this._quenes[1]=new rN(this)):this._quenes[2]||(this._quenes[2]=new rN(this))},rS.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new rN(this)},rS.addShaderDefine=function(rS){this._shaderDefineValue|=rS},rS.removeShaderDefine=function(rS){this._shaderDefineValue&=~rS},rS.addScript=function(rS){return this._addComponent(rS)},rS.getScriptByType=function(rS,rQ){return void 0===rQ&&(rQ=0),this._getComponentByType(rS,rQ)},rS.getScriptsByType=function(rS,rQ){this._getComponentsByType(rS,rQ)},rS.getScriptByIndex=function(rS){return this._getComponentByIndex(rS)},rS.removeScriptByType=function(rS,rQ){void 0===rQ&&(rQ=0),this._removeComponentByType(rS,rQ)},rS.removeScriptsByType=function(rS){this._removeComponentByType(rS)},rS.removeAllScript=function(){this._removeAllComponent()},rS.render=function(rS,rQ,re){(rj._context.ctx._renderKey=0)<this._childs.length&&rS.addRenderObject(this)},rS.renderSubmit=function(){var rS=rk.mainContext,rQ=this._renderState;this._set3DRenderConfig(rS),this._prepareSceneToRender(this._renderState);var re,rl=0,rM=0;if(rGQ.debugMode||rK.debugMode)for(rl=0,rM=this._cameraPool.length;rl<rM;rl++)re=this._cameraPool[rl],rGQ._debugPhasorSprite.begin(1,re),re.activeInHierarchy&&re._renderCamera(rS,rQ,this),rGQ._debugPhasorSprite.end();else for(rl=0,rM=this._cameraPool.length;rl<rM;rl++)(re=this._cameraPool[rl]).activeInHierarchy&&re._renderCamera(rS,rQ,this);return this._set2DRenderConfig(rS),1},rS.onAsynLoaded=function(rS,rQ,re){var rl=rQ[0];if("Scene"!==rl.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var rM=rQ[1];rcQ._createNodeByJson(this,rl,this,rM),this.event("hierarchyloaded",[this]),this.__loaded=!0},rS.destroy=function(rS){void 0===rS&&(rS=!0),this.destroyed||(rQ.prototype.destroy.call(this,rS),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,rG.clearRes(this.url),this.loaded||rGQ._cancelLoadByUrl(this.url))},rS.getRenderType=function(){return 0},rS.releaseRender=function(){},rS._addComponent=function(rS){var rQ,re=this._componentsMap.indexOf(rS);if(-1===re)rQ=[],this._componentsMap.push(rS),this._typeComponentsIndices.push(rQ);else if(rQ=this._typeComponentsIndices[re],this._components[rQ[0]].isSingleton)throw new Error("无法单实例创建"+rS+"组件，"+rS+"组件已存在！");var rl=rM.getInstance(rS);rQ.push(this._components.length),this._components.push(rl);return rl._initialize(this),rl},rS._removeComponent=function(rS,rQ){var re=this._typeComponentsIndices[rS],rl=re[rQ],rM=this._components[rl];this._components.splice(rl,1),re.splice(rQ,1),0===re.length&&(this._typeComponentsIndices.splice(rS,1),this._componentsMap.splice(rS,1));for(var rd=0,rT=this._componentsMap.length;rd<rT;rd++)for(var rU=(re=this._typeComponentsIndices[rd]).length-1;0<=rU;rU--){var ri=re[rU];if(!(rl<ri))break;re[rU]=--ri}rM._destroy()},rS._getComponentByType=function(rS,rQ){void 0===rQ&&(rQ=0);var re=this._componentsMap.indexOf(rS);return-1===re?null:this._components[this._typeComponentsIndices[re][rQ]]},rS._getComponentsByType=function(rS,rQ){var re=this._componentsMap.indexOf(rS);if(-1!==re){var rl=this._typeComponentsIndices[re],rM=rl.length;rQ.length=rM;for(var rd=0;rd<rM;rd++)rQ[rd]=this._components[rl[rd]]}else rQ.length=0},rS._getComponentByIndex=function(rS){return this._components[rS]},rS._removeComponentByType=function(rS,rQ){void 0===rQ&&(rQ=0);var re=this._componentsMap.indexOf(rS);-1!==re&&this._removeComponent(re,rQ)},rS._removeComponentsByType=function(rS){var rQ=this._componentsMap.indexOf(rS);if(-1!==rQ)for(var re=this._typeComponentsIndices[rQ],rl=0,rM=re.length;rl<rM;re.length<rM?rM--:rl++)this._removeComponent(rQ,rl)},rS._removeAllComponent=function(){for(var rS=0,rQ=this._componentsMap.length;rS<rQ;this._componentsMap.length<rQ?rQ--:rS++)this._removeComponentsByType(this._componentsMap[rS])},rS._updateComponents=function(rS){for(var rQ=0,re=this._components.length;rQ<re;rQ++){var rl=this._components[rQ];!rl.started&&(rl._start(rS),rl.started=!0),rl.enable&&rl._update(rS)}},rS._lateUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._lateUpdate(rS)}},rS._preRenderUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._preRenderUpdate(rS)}},rS._postRenderUpdateComponents=function(rS){for(var rQ=0;rQ<this._components.length;rQ++){var re=this._components[rQ];!re.started&&(re._start(rS),re.started=!0),re.enable&&re._postRenderUpdate(rS)}},rL(0,rS,"_loaded",null,function(rS){this.__loaded=rS}),rL(0,rS,"fogColor",function(){return this._fogColor},function(rS){this._fogColor=rS,this._shaderValues.setValue(0,rS.elements)}),rL(0,rS,"enableFog",function(){return this._enableFog},function(rS){this._enableFog!==rS&&((this._enableFog=rS)?(this.addShaderDefine(rHQ.SHADERDEFINE_FOG),this.removeShaderDefine(rHQ.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(rHQ.SHADERDEFINE_FOG))}),rL(0,rS,"url",function(){return this._url}),rL(0,rS,"loaded",function(){return this.__loaded}),rL(0,rS,"enableDepthFog",function(){return this._enableDepthFog},function(rS){this._enableDepthFog!=rS&&((this._enableDepthFog=rS)?(this.addShaderDefine(rHQ.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(rHQ.SHADERDEFINE_FOG)):this.removeShaderDefine(rHQ.SAHDERDEFINE_DEPTHFOG))}),rL(0,rS,"fogStart",function(){return this._fogStart},function(rS){this._fogStart=rS,this._shaderValues.setValue(1,rS)}),rL(0,rS,"fogRange",function(){return this._fogRange},function(rS){this._fogRange=rS,this._shaderValues.setValue(2,rS)}),rL(0,rS,"ambientColor",function(){return this._ambientColor},function(rS){this._ambientColor=rS,this._shaderValues.setValue(21,rS.elements)}),rL(0,rS,"scene",function(){return this}),rL(0,rS,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),rl._sortScenes=function(rS,rQ){if(rS.parent!==rD.stage||rQ.parent!==rD.stage)return rS.parent!==rD.stage&&rQ.parent!==rD.stage?rl._sortScenes(rS.parent,rQ.parent):rS.parent===rD.stage?-1:1;var re=rD.stage._childs;return re.indexOf(rS)-re.indexOf(rQ)},rl.load=function(rS){return rD.loader.create(rS,null,null,rl)},rl.FOGCOLOR=0,rl.FOGSTART=1,rl.FOGRANGE=2,rl.LIGHTDIRECTION=3,rl.LIGHTDIRCOLOR=4,rl.POINTLIGHTPOS=5,rl.POINTLIGHTRANGE=6,rl.POINTLIGHTATTENUATION=7,rl.POINTLIGHTCOLOR=8,rl.SPOTLIGHTPOS=9,rl.SPOTLIGHTDIRECTION=10,rl.SPOTLIGHTSPOT=11,rl.SPOTLIGHTRANGE=12,rl.SPOTLIGHTATTENUATION=13,rl.SPOTLIGHTCOLOR=14,rl.SHADOWDISTANCE=15,rl.SHADOWLIGHTVIEWPROJECT=16,rl.SHADOWMAPPCFOFFSET=17,rl.SHADOWMAPTEXTURE1=18,rl.SHADOWMAPTEXTURE2=19,rl.SHADOWMAPTEXTURE3=20,rl.AMBIENTCOLOR=21,rl.TIME=22,rl}(rO),r$Q=function(rS){function rQ(rS){rQ.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new rSQ,this._shaderValues=new rpQ,this._colliders=[],this._id=++rQ._uniqueIDCounter,this._transform=new rBQ(this),this.name=rS||"Sprite3D-"+rQ._nameNumberCounter++,this.layer=rb.currentCreationLayer,this.active=!0}rJ(rQ,"laya.d3.core.Sprite3D",rEQ);var re=rQ.prototype;return rD.imps(re,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),re._setUrl=function(rS){this._url=rS},re._getGroup=function(){return this._group},re._setGroup=function(rS){this._group=rS},re._addChild3D=function(rS){rS.transform.parent=this.transform,this._hierarchyAnimator&&(!rS._hierarchyAnimator&&rS._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(rS,!0,[rS.name])),this._scene&&(rS._setBelongScene(this._scene),this._activeInHierarchy&&rS._active&&rS._activeHierarchy())},re._removeChild3D=function(rS){rS.transform.parent=null,this._scene&&(this._activeInHierarchy&&rS._active&&rS._inActiveHierarchy(),rS._setUnBelongScene()),this._hierarchyAnimator&&(rS._hierarchyAnimator==this._hierarchyAnimator&&rS._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(rS,!1,[rS.name]))},re._parseBaseCustomProps=function(rS){var rQ=this.transform.localPosition;rS.translate?(rQ.fromArray(rS.translate),rQ.x*=100,rQ.y*=100,rQ.z*=100):rQ.elements.fill(0),this.transform.localPosition=rQ;var re=this.transform.localRotation;rS.rotation?re.fromArray(rS.rotation):re.fromArray([0,0,0,-1]),this.transform.localRotation=re;var rl=this.transform.localScale;rS.scale?rl.fromArray(rS.scale):rl.elements.fill(1),this.transform.localScale=rl;var rM=rS.layer;null!=rM&&(this.layer=rb.getLayerByNumber(rM))},re._parseCustomComponent=function(rS,rQ,re){for(var rl in re){var rM=re[rl];switch(rl){case"Animator":var rd=this.addComponent(Animator);if(rM.avatarPath)rd.avatar=rG.getRes(rQ[rM.avatarPath]);else{var rT=rM.avatar;if(rT){rd.avatar=rG.getRes(rQ[rT.path]);var rU=rT.linkSprites;rU&&rS.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[rd,rU])}}for(var ri=rM.clipPaths,rR=ri.length,ro=0;ro<rR;ro++)rd.addClip(rG.getRes(rQ[ri[ro]]));rd.clip=rG.getRes(rQ[ri[0]]);var rY=rM.playOnWake;void 0!==rY&&(rd.playOnWake=rY);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var rp=this.addComponent(SphereCollider);rp.isTrigger=rM.isTrigger;var rJ=rp.center;rJ.fromArray(rM.center),rp.center=rJ,rp.radius=rM.radius;break;case"BoxCollider":var rL=this.addComponent(BoxCollider);rL.isTrigger=rM.isTrigger,rL.center.fromArray(rM.center);var rj=rL.size;rj.fromArray(rM.size),rL.size=rj;break;case"MeshCollider":this.addComponent(MeshCollider)}}},re._onRootNodeHierarchyLoaded=function(rS,rQ){for(var re in rQ){for(var rl=this,rM=rQ[re],rd=0,rT=rM.length;rd<rT;rd++){var rU=rM[rd];if(""===rU)break;if(!(rl=rl.getChildByName(rU)))break}rl&&rS.linkSprite3DToAvatarNode(re,rl)}},re._setHierarchyAnimator=function(rS,rQ){this._changeHierarchyAnimator(rS);for(var re=0,rl=this._childs.length;re<rl;re++){var rM=this._childs[re];rM._hierarchyAnimator==rQ&&rM._setHierarchyAnimator(rS,rQ)}},re._clearHierarchyAnimator=function(rS,rQ){this._changeHierarchyAnimator(rQ);for(var re=0,rl=this._childs.length;re<rl;re++){var rM=this._childs[re];rM._hierarchyAnimator==rS&&rM._clearHierarchyAnimator(rS,rQ)}},re._getAnimatorToLinkSprite3D=function(rS,rQ,re){var rl=this.getComponentByType(Animator);if(rl&&(rl.avatar?rl.avatar._version||rS._setAnimatorToLinkAvatar(rl,rQ):rS._setAnimatorToLinkSprite3DNoAvatar(rl,rQ,re)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){re.unshift(this._parent.name);var rM=this._parent;rM._hierarchyAnimator&&rM._getAnimatorToLinkSprite3D(rS,rQ,re)}},re._setAnimatorToLinkSprite3DNoAvatar=function(rS,rQ,re){var rl=0,rM=0;for(rl=0,rM=rS.getClipCount();rl<rM;rl++)rS._handleSpriteOwnersBySprite(rl,rQ,re,this);for(rl=0,rM=this._childs.length;rl<rM;rl++){var rd=this._childs[rl],rT=re.length;re.push(rd.name),rd._setAnimatorToLinkSprite3DNoAvatar(rS,rQ,re),re.splice(rT,1)}},re._changeHierarchyAnimator=function(rS){this._hierarchyAnimator=rS},re._isLinkSpriteToAnimationNode=function(rS,rQ,re){var rl=rS._avatarNodes.indexOf(rQ),rM=rS._cacheSpriteToNodesMap;if(re)this._transform.dummy=rQ.transform,rS._cacheNodesToSpriteMap[rl]=rM.length,rM.push(rl);else{this._transform.dummy=null;var rd=rS._cacheNodesToSpriteMap[rl];rS._cacheNodesToSpriteMap[rl]=null,rM.splice(rd,1)}},re._setBelongScene=function(rS){this._scene=rS;for(var rQ=0,re=this._childs.length;rQ<re;rQ++)this._childs[rQ]._setBelongScene(rS)},re._setUnBelongScene=function(){this._scene=null;for(var rS=0,rQ=this._childs.length;rS<rQ;rS++)this._childs[rS]._setUnBelongScene()},re._activeHierarchy=function(){var rS=0,rQ=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),rS=0,rQ=this._colliders.length;rS<rQ;rS++)this._layer._addCollider(this._colliders[rS]);for(this.event("activeinhierarchychanged",!0),rS=0,rQ=this._childs.length;rS<rQ;rS++){var re=this._childs[rS];re._active&&re._activeHierarchy()}},re._inActiveHierarchy=function(){var rS=0,rQ=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),rS=0,rQ=this._colliders.length;rS<rQ;rS++){var re=this._colliders[rS];re._clearCollsionMap(),this._layer._removeCollider(re)}for(this.event("activeinhierarchychanged",!1),rS=0,rQ=this._childs.length;rS<rQ;rS++){var rl=this._childs[rS];rl._active&&rl._inActiveHierarchy()}},re.addComponent=function(rS){var rQ,re=this._componentsMap.indexOf(rS);if(-1===re)rQ=[],this._componentsMap.push(rS),this._typeComponentsIndices.push(rQ);else if(rQ=this._typeComponentsIndices[re],this._components[rQ[0]].isSingleton)throw new Error("无法单实例创建"+rS+"组件，"+rS+"组件已存在！");var rl=rM.getInstance(rS);return rQ.push(this._components.length),this._components.push(rl),rl instanceof laya.d3.component.Script&&this._scripts.push(rl),rl._initialize(this),rl},re._removeComponent=function(rS,rQ){var re,rl=0,rM=this._typeComponentsIndices[rS],rd=rM[rQ],rT=this._components[rd];for(rT instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(rT),1),rM.splice(rQ,1),0===rM.length&&(this._typeComponentsIndices.splice(rS,1),this._componentsMap.splice(rS,1)),rl=0,re=this._componentsMap.length;rl<re;rl++)for(var rU=(rM=this._typeComponentsIndices[rl]).length-1;0<=rU;rU--){var ri=rM[rU];if(!(rd<ri))break;rM[rU]=--ri}rT._destroy()},re._clearSelfRenderObjects=function(){},re._addSelfRenderObjects=function(){},re._parseCustomProps=function(rS,rQ,re,rl){},re._updateChilds=function(rS){var rQ=this._childs.length;if(0!==rQ)for(var re=0;re<rQ;++re)this._childs[re]._update(rS)},re._getSortID=function(rS,rQ){return 1e3*rQ.id+rS._getVertexBuffer().vertexDeclaration.id},re._update=function(rS){(rS.owner=this)._activeInHierarchy&&(this._updateComponents(rS),this._lateUpdateComponents(rS),rH.spriteCount++,this._childs.length&&this._updateChilds(rS))},re.getProjectionViewWorldMatrix=function(rS){return rSQ.multiply(rS,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},re.loadHierarchy=function(rS){this.addChild(laya.d3.core.Sprite3D.load(rS))},re.addChildAt=function(rS,rQ){if(!(rS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),0<=rQ&&rQ<=this._childs.length){if(rS._parent===this){var re=this.getChildIndex(rS);this._childs.splice(re,1),this._childs.splice(rQ,0,rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,rQ)),this._childChanged()}else rS.parent&&rS.parent.removeChild(rS),this._childs===rR.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(rQ,0,rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,rQ),(rS.parent=this)._addChild3D(rS);return rS}throw new Error("appendChildAt:The index is out of bounds")},re.addChild=function(rS){if(!(rS instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!rS||this.destroyed||rS===this)return rS;if(rS.zOrder&&this._set$P("hasZorder",!0),rS._parent===this){var rQ=this.getChildIndex(rS);rQ!==this._childs.length-1&&(this._childs.splice(rQ,1),this._childs.push(rS),this.conchModel&&(this.conchModel.removeChild(rS.conchModel),this.conchModel.addChildAt(rS.conchModel,this._childs.length-1)),this._childChanged())}else rS.parent&&rS.parent.removeChild(rS),this._childs===rR.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(rS),this.conchModel&&this.conchModel.addChildAt(rS.conchModel,this._childs.length-1),(rS.parent=this)._childChanged(),this._addChild3D(rS);return rS},re.removeChildAt=function(rS){var rQ=this.getChildAt(rS);return rQ&&(this._removeChild3D(rQ),this._childs.splice(rS,1),this.conchModel&&this.conchModel.removeChild(rQ.conchModel),rQ.parent=null),rQ},re.removeChildren=function(rS,rQ){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=2147483647),this._childs&&0<this._childs.length){var re=this._childs;if(0===rS&&rd<=rQ){var rl=re;this._childs=rR.ARRAY_EMPTY}else rl=re.splice(rS,rQ-rS);for(var rM=0,rd=rl.length;rM<rd;rM++)this._removeChild3D(rl[rM]),rl[rM].parent=null,this.conchModel&&this.conchModel.removeChild(rl[rM].conchModel)}return this},re.onAsynLoaded=function(rS,rQ,re){var rl=rQ[0];if("Sprite3D"!==rl.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var rM=rQ[1];rcQ._createNodeByJson(this,rl,this,rM),this.event("hierarchyloaded",[this]),this.__loaded=!0},re.cloneTo=function(rS){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var rQ=rS;rQ.name=this.name,rQ._destroyed=this._destroyed,rQ.timer=this.timer,rQ._$P=this._$P,rQ.active=this._active;var re=rQ.transform.localPosition;this.transform.localPosition.cloneTo(re),rQ.transform.localPosition=re;var rl=rQ.transform.localRotation;this.transform.localRotation.cloneTo(rl),rQ.transform.localRotation=rl;var rM=rQ.transform.localScale;this.transform.localScale.cloneTo(rM),rQ.transform.localScale=rM,rQ.isStatic=this.isStatic;var rd=0,rT=0;for(rd=0,rT=this._componentsMap.length;rd<rT;rd++){var rU=rQ.addComponent(this._componentsMap[rd]);this._components[rd]._cloneTo(rU)}for(rd=0,rT=this._childs.length;rd<rT;rd++)rQ.addChild(this._childs[rd].clone());var ri=rQ.getComponentByType(Animator);if(ri){var rR=ri._linkSpritesData;if(rR)for(var ro in rR){for(var rY=rR[ro],rp=rQ,rJ=0,rL=rY.length;rJ<rL&&(rp=rp.getChildByName(rY[rJ]));rJ++);if(rp){var rj=ri._avatarNodeMap[ro];rp._isLinkSpriteToAnimationNode(ri,rj,!0)}}}},re.clone=function(){var rS=new this.constructor;return this.cloneTo(rS),rS},re.destroy=function(rS){if(void 0===rS&&(rS=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,rS);var rQ,re=0;for(re=0,rQ=this._components.length;re<rQ;re++)this._components[re]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,rG.clearRes(this.url),this.loaded||rGQ._cancelLoadByUrl(this.url)}},re._handleSpriteToAvatar=function(rS,rQ){rS._avatarNodes;var re=rS._avatarNodeMap[this.name];re&&re.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(rS,re,rQ)},re._setAnimatorToLinkAvatar=function(rS,rQ){this._handleSpriteToAvatar(rS,rQ);for(var re=0,rl=this._childs.length;re<rl;re++){this._childs[re]._setAnimatorToLinkAvatar(rS,rQ)}},rL(0,re,"activeInHierarchy",function(){return this._activeInHierarchy}),rL(0,re,"_loaded",null,function(rS){this.__loaded=rS}),rL(0,re,"active",function(){return this._active},function(rS){this._active!==rS&&(this._active=rS,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(rS?this._activeHierarchy():this._inActiveHierarchy()))}),rL(0,re,"componentsCount",function(){return this._components.length}),rL(0,re,"loaded",function(){return this.__loaded}),rL(0,re,"id",function(){return this._id}),rL(0,re,"url",function(){return this._url}),rL(0,re,"layer",function(){return this._layer},function(rS){if(this._layer!==rS){if(!rS)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var rQ=0,re=this._colliders.length;if(this._layer)for(rQ=0;rQ<re;rQ++)this._layer._removeCollider(this._colliders[rQ]);for(rQ=0;rQ<re;rQ++)rS._addCollider(this._colliders[rQ])}this._layer=rS,this.event("layerchanged",rS)}}),rL(0,re,"scene",function(){return this._scene}),rL(0,re,"transform",function(){return this._transform}),rQ.instantiate=function(rS,rQ,re,rl,rM){void 0===re&&(re=!0);var rd=rS.clone();rQ&&rQ.addChild(rd);var rT=rd.transform;if(re){var rU=rT.worldMatrix;rS.transform.worldMatrix.cloneTo(rU),rT.worldMatrix=rU}else rl&&(rT.position=rl),rM&&(rT.rotation=rM);return rd},rQ.load=function(rS){return rD.loader.create(rS,null,null,rQ)},rQ.WORLDMATRIX=0,rQ.MVPMATRIX=1,rQ._uniqueIDCounter=0,rQ._nameNumberCounter=0,rQ}(),rnQ=function(rS){function ro(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],ro.__super.call(this),!rS||!rQ)throw"Shader Error";this._id=++ro._count,this._vs=rS,this._ps=rQ,this._attributeMap=re,this._sceneUniformMap=rl,this._cameraUniformMap=rM,this._spriteUniformMap=rd,this._materialUniformMap=rT,this._renderElementUniformMap=rU,this._precompile=ri,this._define=rR,this._precompile&&ro.extCompileObj&&ro.extCompileFunc?ro.extCompileFunc.call(ro.extCompileObj,rS,rQ,rR):this.recreateResource()}rJ(ro,"laya.d3.shader.Shader3D",re);var rQ=ro.prototype;return rQ.recreateResource=function(){rh.now();this._compile(),this.completeCreate(),this.memorySize=0},rQ.disposeResource=function(){rk.mainContext.deleteShader(this._vshader),rk.mainContext.deleteShader(this._pshader),rk.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},rQ._compile=function(){if(!rk.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var rS=[this._vs,this._ps],rQ=rk.mainContext;if(this._program=rQ.createProgram(),this._vshader=ro._createShader(rQ,rS[0],35633),this._pshader=ro._createShader(rQ,rS[1],35632),rQ.attachShader(this._program,this._vshader),rQ.attachShader(this._program,this._pshader),rQ.linkProgram(this._program),!rj.isConchApp&&rHQ.debugMode&&!rQ.getProgramParameter(this._program,35714))throw rQ.getProgramInfoLog(this._program);var re,rl=0,rM=0,rd=0;for(rd=rj.isConchApp?rQ.getProgramParameterEx(this._vs,this._ps,"",35721):rQ.getProgramParameter(this._program,35721),rl=0;rl<rd;rl++){var rT=null;re={vartype:"attribute",ivartype:0,attrib:rT=rj.isConchApp?rQ.getActiveAttribEx(this._vs,this._ps,"",rl):rQ.getActiveAttrib(this._program,rl),location:rQ.getAttribLocation(this._program,rT.name),name:rT.name,type:rT.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(re)}var rU=0;for(rU=rj.isConchApp?rQ.getProgramParameterEx(this._vs,this._ps,"",35718):rQ.getProgramParameter(this._program,35718),rl=0;rl<rU;rl++){var ri=null;ri=rj.isConchApp?rQ.getActiveUniformEx(this._vs,this._ps,"",rl):rQ.getActiveUniform(this._program,rl),0<(re={vartype:"uniform",ivartype:1,attrib:rT,location:rQ.getUniformLocation(this._program,ri.name),name:ri.name,type:ri.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(re.name=re.name.substr(0,re.name.length-3),re.isArray=!0,re.location=rQ.getUniformLocation(this._program,re.name)),this._uniformParams.push(re)}for(rl=0,rM=this._attributeParams.length;rl<rM;rl++)(re=this._attributeParams[rl]).indexOfParams=rl,re.index=1,re.value=[re.location,null],re.codename=re.name,re.name=null!=this._attributeMap[re.codename]?this._attributeMap[re.codename]:re.codename,this._attributeParamsMap.push(re.name),this._attributeParamsMap.push(re),re._this=this,re.uploadedValue=[],re.fun=this._attribute;for(rl=0,rM=this._uniformParams.length;rl<rM;rl++)switch((re=this._uniformParams[rl]).indexOfParams=rl,re.index=1,re.value=[re.location,null],re.codename=re.name,null!=this._sceneUniformMap[re.codename]?(re.name=this._sceneUniformMap[re.codename],this._sceneUniformParamsMap.push(re.name),this._sceneUniformParamsMap.push(re)):null!=this._cameraUniformMap[re.codename]?(re.name=this._cameraUniformMap[re.codename],this._cameraUniformParamsMap.push(re.name),this._cameraUniformParamsMap.push(re)):null!=this._spriteUniformMap[re.codename]?(re.name=this._spriteUniformMap[re.codename],this._spriteUniformParamsMap.push(re.name),this._spriteUniformParamsMap.push(re)):null!=this._materialUniformMap[re.codename]?(re.name=this._materialUniformMap[re.codename],this._materialUniformParamsMap.push(re.name),this._materialUniformParamsMap.push(re)):null!=this._renderElementUniformMap[re.codename]?(re.name=this._renderElementUniformMap[re.codename],this._renderElementUniformParamsMap.push(re.name),this._renderElementUniformParamsMap.push(re)):console.log("Shader:can't find uinform name:"+re.codename+" in shader file."),re._this=this,re.uploadedValue=[],re.type){case 5124:re.fun=re.isArray?this._uniform1iv:this._uniform1i;break;case 5126:re.fun=re.isArray?this._uniform1fv:this._uniform1f;break;case 35664:re.fun=re.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:re.fun=re.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:re.fun=re.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:re.fun=this._uniform_sampler2D;break;case 35680:re.fun=this._uniform_samplerCube;break;case 35676:re.fun=this._uniformMatrix4fv;break;case 35670:re.fun=this._uniform1i;break;case 35674:re.fun=this._uinformMatrix2fv;break;case 35675:re.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},rQ._attribute=function(rS,rQ){var re=rk.mainContext,rl=rU._enableAtributes,rM=rS.location;return rl[rM]||re.enableVertexAttribArray(rM),re.vertexAttribPointer(rM,rQ[0],rQ[1],rQ[2],rQ[3],rQ[4]),rl[rM]=rU._bindVertexBuffer,1},rQ._uniform1f=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ?(rk.mainContext.uniform1f(rS.location,re[0]=rQ),1):0},rQ._uniform1fv=function(rS,rQ){if(rQ.length<4){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rk.mainContext.uniform1fv(rS.location,rQ),re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3],1):0}return rk.mainContext.uniform1fv(rS.location,rQ),1},rQ._uniform_vec2=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]?(rk.mainContext.uniform2f(rS.location,re[0]=rQ[0],re[1]=rQ[1]),1):0},rQ._uniform_vec2v=function(rS,rQ){if(rQ.length<2){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rk.mainContext.uniform2fv(rS.location,rQ),re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3],1):0}return rk.mainContext.uniform2fv(rS.location,rQ),1},rQ._uniform_vec3=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]?(rk.mainContext.uniform3f(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2]),1):0},rQ._uniform_vec3v=function(rS,rQ){return rk.mainContext.uniform3fv(rS.location,rQ),1},rQ._uniform_vec4=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rk.mainContext.uniform4f(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3]),1):0},rQ._uniform_vec4v=function(rS,rQ){return rk.mainContext.uniform4fv(rS.location,rQ),1},rQ._uniformMatrix2fv=function(rS,rQ){return rk.mainContext.uniformMatrix2fv(rS.location,!1,rQ),1},rQ._uniformMatrix3fv=function(rS,rQ){return rk.mainContext.uniformMatrix3fv(rS.location,!1,rQ),1},rQ._uniformMatrix4fv=function(rS,rQ){return rk.mainContext.uniformMatrix4fv(rS.location,!1,rQ),1},rQ._uinformMatrix2fv=function(rS,rQ){return rk.mainContext.uniformMatrix2fv(rS.location,!1,rQ),1},rQ._uinformMatrix3fv=function(rS,rQ){return rk.mainContext.uniformMatrix3fv(rS.location,!1,rQ),1},rQ._uniform1i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ?(rk.mainContext.uniform1i(rS.location,re[0]=rQ),1):0},rQ._uniform1iv=function(rS,rQ){return rk.mainContext.uniform1iv(rS.location,rQ),1},rQ._uniform_ivec2=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]?(rk.mainContext.uniform2i(rS.location,re[0]=rQ[0],re[1]=rQ[1]),1):0},rQ._uniform_ivec2v=function(rS,rQ){return rk.mainContext.uniform2iv(rS.location,rQ),1},rQ._uniform_vec3i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]?(rk.mainContext.uniform3i(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2]),1):0},rQ._uniform_vec3vi=function(rS,rQ){return rk.mainContext.uniform3iv(rS.location,rQ),1},rQ._uniform_vec4i=function(rS,rQ){var re=rS.uploadedValue;return re[0]!==rQ[0]||re[1]!==rQ[1]||re[2]!==rQ[2]||re[3]!==rQ[3]?(rk.mainContext.uniform4i(rS.location,re[0]=rQ[0],re[1]=rQ[1],re[2]=rQ[2],re[3]=rQ[3]),1):0},rQ._uniform_vec4vi=function(rS,rQ){return rk.mainContext.uniform4iv(rS.location,rQ),1},rQ._uniform_sampler2D=function(rS,rQ){var re=rQ.source||rQ.defaulteTexture.source,rl=rk.mainContext,rM=rS.uploadedValue;if(null!=rM[0])return rl.activeTexture(ro._TEXTURES[rM[0]]),re&&rX.bindTexture(rl,3553,re),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return rM[0]=this._curActTexIndex,rl.uniform1i(rS.location,this._curActTexIndex),rl.activeTexture(ro._TEXTURES[this._curActTexIndex]),re&&rX.bindTexture(rl,3553,re),this._curActTexIndex++,1},rQ._uniform_samplerCube=function(rS,rQ){var re=rQ.source||rQ.defaulteTexture.source,rl=rk.mainContext,rM=rS.uploadedValue;if(null!=rM[0])return rl.activeTexture(ro._TEXTURES[rM[0]]),re?rX.bindTexture(rl,34067,re):rX.bindTexture(rl,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return rM[0]=this._curActTexIndex,rl.uniform1i(rS.location,this._curActTexIndex),rl.activeTexture(ro._TEXTURES[this._curActTexIndex]),re?rX.bindTexture(rl,34067,re):rX.bindTexture(rl,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},rQ._noSetValue=function(rS){console.log("no....:"+rS.name)},rQ.bind=function(){return re.activeShader=this,(re.bindShader=this).activeResource(),rX.UseProgram(this._program)},rQ.uploadAttributes=function(rS,rQ){for(var re,rl,rM=0,rd=0,rT=this._attributeParamsMap.length;rd<rT;rd+=2)rl=this._attributeParamsMap[rd+1],null!=(re=rS[this._attributeParamsMap[rd]])&&(rQ&&rQ[rl.name]&&rQ[rl.name].bind(),rM+=rl.fun.call(this,rl,re));rH.shaderCall+=rM},rQ.uploadAttributesX=function(rS,rQ){for(var re,rl,rM=0,rd=0,rT=this._attributeParamsMap.length;rd<rT;rd+=2)rl=this._attributeParamsMap[rd+1],null!=(re=rS[this._attributeParamsMap[rd]])&&(rQ._bind(),rM+=rl.fun.call(this,rl,re));rH.shaderCall+=rM},rQ.uploadSceneUniforms=function(rS){for(var rQ,re,rl=0,rM=0,rd=this._sceneUniformParamsMap.length;rM<rd;rM+=2)re=this._sceneUniformParamsMap[rM+1],null!=(rQ=rS[this._sceneUniformParamsMap[rM]])&&(rl+=re.fun.call(this,re,rQ));rH.shaderCall+=rl},rQ.uploadCameraUniforms=function(rS){for(var rQ,re,rl=0,rM=0,rd=this._cameraUniformParamsMap.length;rM<rd;rM+=2)re=this._cameraUniformParamsMap[rM+1],null!=(rQ=rS[this._cameraUniformParamsMap[rM]])&&(rl+=re.fun.call(this,re,rQ));rH.shaderCall+=rl},rQ.uploadSpriteUniforms=function(rS){for(var rQ,re,rl=0,rM=0,rd=this._spriteUniformParamsMap.length;rM<rd;rM+=2)re=this._spriteUniformParamsMap[rM+1],null!=(rQ=rS[this._spriteUniformParamsMap[rM]])&&(rl+=re.fun.call(this,re,rQ));rH.shaderCall+=rl},rQ.uploadMaterialUniforms=function(rS){for(var rQ,re,rl=0,rM=0,rd=this._materialUniformParamsMap.length;rM<rd;rM+=2)re=this._materialUniformParamsMap[rM+1],null!=(rQ=rS[this._materialUniformParamsMap[rM]])&&(rl+=re.fun.call(this,re,rQ));rH.shaderCall+=rl},rQ.uploadRenderElementUniforms=function(rS){for(var rQ,re,rl=0,rM=0,rd=this._renderElementUniformParamsMap.length;rM<rd;rM+=2)re=this._renderElementUniformParamsMap[rM+1],null!=(rQ=rS[this._renderElementUniformParamsMap[rM]])&&(rl+=re.fun.call(this,re,rQ));rH.shaderCall+=rl},ro.create=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return new ro(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR)},ro.addInclude=function(rS,rQ){rA.addInclude(rS,rQ)},ro._createShader=function(rS,rQ,re){var rl=rS.createShader(re);if(rS.shaderSource(rl,rQ),rS.compileShader(rl),rHQ.debugMode&&!rS.getShaderParameter(rl,35713))throw rS.getShaderInfoLog(rl);return rl},ro.PERIOD_RENDERELEMENT=0,ro.PERIOD_MATERIAL=1,ro.PERIOD_SPRITE=2,ro.PERIOD_CAMERA=3,ro.PERIOD_SCENE=4,ro._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],ro._count=0,ro._preCompile=!1,ro.extCompileFunc=null,ro.extCompileObj=null,rY(ro,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new rg}]),ro}(),rPQ=function(rU){function ri(){this._transformUV=null,ri.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new rTQ(.6,.6,.6)),this._setColor(10,new rTQ(1,1,1)),this._setColor(11,new rUQ(1,1,1,8)),this._setColor(12,new rTQ(1,1,1)),this._setColor(7,new rUQ(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new rUQ(1,1,0,0)),this.renderMode=1}rJ(ri,"laya.d3.core.material.StandardMaterial",rU);var rS=ri.prototype;return rS.disableLight=function(){this._addDisablePublicShaderDefine(rHQ.SHADERDEFINE_POINTLIGHT|rHQ.SHADERDEFINE_SPOTLIGHT|rHQ.SHADERDEFINE_DIRECTIONLIGHT)},rS.disableFog=function(){this._addDisablePublicShaderDefine(rHQ.SHADERDEFINE_FOG)},rS.onAsynLoaded=function(rS,rQ,re){var rl=rQ[0];if(rl.version)rU.prototype.onAsynLoaded.call(this,rS,rQ,re);else{var rM=rQ[1],rd=rl.props;for(var rT in rd)this[rT]=rd[rT];ri._parseStandardMaterial(rM,this,rl),this._endLoaded()}},rS.cloneTo=function(rS){rU.prototype.cloneTo.call(this,rS);var rQ=rS;this._transformUV&&(rQ._transformUV=this._transformUV.clone())},rL(0,rS,"ambientColor",function(){return this._getColor(9)},function(rS){this._setColor(9,rS)}),rL(0,rS,"ambientTexture",function(){return this._getTexture(5)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,rS)}),rL(0,rS,"renderMode",null,function(rS){switch(rS){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(ri.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(rS)}),rL(0,rS,"reflectColor",function(){return this._getColor(12)},function(rS){this._setColor(12,rS)}),rL(0,rS,"tilingOffset",function(){return this._getColor(15)},function(rS){if(rS){var rQ=rS.elements;1!=rQ[0]||1!=rQ[1]||0!=rQ[2]||0!=rQ[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,rS)}),rL(0,rS,"albedo",function(){return this._getColor(7)},function(rS){this._setColor(7,rS)}),rL(0,rS,"diffuseColor",function(){return this._getColor(10)},function(rS){this._setColor(10,rS)}),rL(0,rS,"albedoColor",function(){return this._getColor(7)},function(rS){this._setColor(7,rS)}),rL(0,rS,"specularColor",function(){return this._getColor(11)},function(rS){this._setColor(11,rS)}),rL(0,rS,"diffuseTexture",function(){return this._getTexture(1)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,rS)}),rL(0,rS,"normalTexture",function(){return this._getTexture(2)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,rS)}),rL(0,rS,"specularTexture",function(){return this._getTexture(3)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,rS)}),rL(0,rS,"emissiveTexture",function(){return this._getTexture(4)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,rS)}),rL(0,rS,"reflectTexture",function(){return this._getTexture(6)},function(rS){rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,rS)}),rL(0,rS,"transformUV",function(){return this._transformUV},function(rS){this._transformUV=rS,this._setMatrix4x4(13,rS.matrix),rS?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,rS.matrix.elements,0)}),ri.__init__=function(){ri.SHADERDEFINE_DIFFUSEMAP=ri.shaderDefines.registerDefine("DIFFUSEMAP"),ri.SHADERDEFINE_NORMALMAP=ri.shaderDefines.registerDefine("NORMALMAP"),ri.SHADERDEFINE_SPECULARMAP=ri.shaderDefines.registerDefine("SPECULARMAP"),ri.SHADERDEFINE_EMISSIVEMAP=ri.shaderDefines.registerDefine("EMISSIVEMAP"),ri.SHADERDEFINE_AMBIENTMAP=ri.shaderDefines.registerDefine("AMBIENTMAP"),ri.SHADERDEFINE_REFLECTMAP=ri.shaderDefines.registerDefine("REFLECTMAP"),ri.SHADERDEFINE_UVTRANSFORM=ri.shaderDefines.registerDefine("UVTRANSFORM"),ri.SHADERDEFINE_TILINGOFFSET=ri.shaderDefines.registerDefine("TILINGOFFSET"),ri.SHADERDEFINE_ADDTIVEFOG=ri.shaderDefines.registerDefine("ADDTIVEFOG")},ri.load=function(rS){return rD.loader.create(rS,null,null,ri)},ri._parseStandardMaterial=function(rS,rQ,re){var rl=re.customProps,rM=rl.ambientColor;rQ.ambientColor=new rTQ(rM[0],rM[1],rM[2]);var rd=rl.diffuseColor;rQ.diffuseColor=new rTQ(rd[0],rd[1],rd[2]);var rT=rl.specularColor;rQ.specularColor=new rUQ(rT[0],rT[1],rT[2],rT[3]);var rU=rl.reflectColor;rQ.reflectColor=new rTQ(rU[0],rU[1],rU[2]);var ri=rl.albedoColor;ri&&(rQ.albedo=new rUQ(ri[0],ri[1],ri[2],ri[3]));var rR=rl.diffuseTexture.texture2D;rR&&(rQ.diffuseTexture=rG.getRes(rS[rR]));var ro=rl.normalTexture.texture2D;ro&&(rQ.normalTexture=rG.getRes(rS[ro]));var rY=rl.specularTexture.texture2D;rY&&(rQ.specularTexture=rG.getRes(rS[rY]));var rp=rl.emissiveTexture.texture2D;rp&&(rQ.emissiveTexture=rG.getRes(rS[rp]));var rJ=rl.ambientTexture.texture2D;rJ&&(rQ.ambientTexture=rG.getRes(rS[rJ]));var rL=rl.reflectTexture.texture2D;rL&&(rQ.reflectTexture=rG.getRes(rS[rL]))},ri.RENDERMODE_OPAQUE=1,ri.RENDERMODE_OPAQUEDOUBLEFACE=2,ri.RENDERMODE_CUTOUT=3,ri.RENDERMODE_CUTOUTDOUBLEFACE=4,ri.RENDERMODE_TRANSPARENT=13,ri.RENDERMODE_TRANSPARENTDOUBLEFACE=14,ri.RENDERMODE_ADDTIVE=15,ri.RENDERMODE_ADDTIVEDOUBLEFACE=16,ri.RENDERMODE_DEPTHREAD_TRANSPARENT=5,ri.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,ri.RENDERMODE_DEPTHREAD_ADDTIVE=7,ri.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,ri.RENDERMODE_NONDEPTH_TRANSPARENT=9,ri.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,ri.RENDERMODE_NONDEPTH_ADDTIVE=11,ri.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,ri.SHADERDEFINE_DIFFUSEMAP=0,ri.SHADERDEFINE_NORMALMAP=0,ri.SHADERDEFINE_SPECULARMAP=0,ri.SHADERDEFINE_EMISSIVEMAP=0,ri.SHADERDEFINE_AMBIENTMAP=0,ri.SHADERDEFINE_REFLECTMAP=0,ri.SHADERDEFINE_UVTRANSFORM=0,ri.SHADERDEFINE_TILINGOFFSET=0,ri.SHADERDEFINE_ADDTIVEFOG=0,ri.DIFFUSETEXTURE=1,ri.NORMALTEXTURE=2,ri.SPECULARTEXTURE=3,ri.EMISSIVETEXTURE=4,ri.AMBIENTTEXTURE=5,ri.REFLECTTEXTURE=6,ri.ALBEDO=7,ri.UVANIAGE=8,ri.MATERIALAMBIENT=9,ri.MATERIALDIFFUSE=10,ri.MATERIALSPECULAR=11,ri.MATERIALREFLECT=12,ri.UVMATRIX=13,ri.UVAGE=14,ri.TILINGOFFSET=15,rY(ri,["defaultMaterial",function(){var rS=new ri;return rS.lock=!0,this.defaultMaterial=rS},"shaderDefines",function(){return this.shaderDefines=new roQ(rtQ.shaderDefines)}]),ri}(rtQ),raQ=function(rS){function rT(rS,rQ,re,rl,rM){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===re&&(re=35044),void 0===rl&&(rl=!1),rT.__super.call(this),this._indexType=rS,this._indexCount=rQ,this._bufferUsage=re,this._bufferType=34963,this._canRead=rl;var rd;if("ushort"==rS)this._indexTypeByteCount=2;else{if("ubyte"!=rS)throw new Error("unidentification index type.");this._indexTypeByteCount=1}rd=this._indexTypeByteCount*rQ,this._byteLength=rd,this._bind(),rU._gl.bufferData(this._bufferType,rd,this._bufferUsage),this.uri=rM,rl?("ushort"==rS?this._buffer=new Uint16Array(rQ):"ubyte"==rS&&(this._buffer=new Uint8Array(rQ)),this.memorySize=2*rd):this.memorySize=rd}rJ(rT,"laya.d3.graphics.IndexBuffer3D",rS);var rQ=rT.prototype;return rQ.setData=function(rS,rQ,re,rl){void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=4294967295);var rM=0;if("ushort"==this._indexType?(rM=2,0===re&&4294967295===rl||(rS=new Uint16Array(rS.buffer,re*rM,rl))):"ubyte"==this._indexType&&(rM=1,0===re&&4294967295===rl||(rS=new Uint8Array(rS.buffer,re*rM,rl))),this._bind(),rU._gl.bufferSubData(this._bufferType,rQ*rM,rS),this._canRead)if(0!==rQ||0!==re||4294967295!==rl){var rd=this._buffer.length-rQ;rd<rl&&(rl=rd);for(var rT=0;rT<rl;rT++)this._buffer[rQ+rT]=rS[rT]}else this._buffer=rS},rQ.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},rQ.disposeResource=function(){rS.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},rL(0,rQ,"indexType",function(){return this._indexType}),rL(0,rQ,"indexTypeByteCount",function(){return this._indexTypeByteCount}),rL(0,rQ,"indexCount",function(){return this._indexCount}),rL(0,rQ,"canRead",function(){return this._canRead}),rT.INDEXTYPE_UBYTE="ubyte",rT.INDEXTYPE_USHORT="ushort",rT.create=function(rS,rQ,re,rl,rM){return void 0===re&&(re=35044),void 0===rl&&(rl=!1),new rT(rS,rQ,re,rl,rM)},rT}(rU),rfQ=function(rd){function rT(rS,rQ,re,rl,rM){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===rl&&(rl=!1),rT.__super.call(this),this._vertexDeclaration=rS,this._vertexCount=rQ,this._bufferUsage=re,this._bufferType=34962,this._canRead=rl,this.uri=rM,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*rQ,this._bind(),rU._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),rl&&(this._buffer=new Float32Array(this._byteLength/4))}rJ(rT,"laya.d3.graphics.VertexBuffer3D",rd);var rS=rT.prototype;return rS.bindWithIndexBuffer=function(rS){rS&&rS._bind(),this._bind()},rS.setData=function(rS,rQ,re,rl){if(void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=4294967295),0===re&&4294967295===rl||(rS=new Float32Array(rS.buffer,4*re,rl)),this._bind(),rU._gl.bufferSubData(this._bufferType,4*rQ,rS),this._canRead)if(0!==rQ||0!==re||4294967295!==rl){var rM=this._buffer.length-rQ;rM<rl&&(rl=rM);for(var rd=0;rd<rl;rd++)this._buffer[rQ+rd]=rS[rd]}else this._buffer=rS},rS.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},rS.disposeResource=function(){for(var rS=rk.mainContext,rQ=this._vertexDeclaration.getVertexElements(),re=rU._enableAtributes,rl=0,rM=rQ.length;rl<rM;rl++)re[rl]===this._glBuffer&&(rS.disableVertexAttribArray(rl),re[rl]=null);rd.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},rL(0,rS,"vertexDeclaration",function(){return this._vertexDeclaration}),rL(0,rS,"vertexCount",function(){return this._vertexCount}),rL(0,rS,"canRead",function(){return this._canRead}),rT.create=function(rS,rQ,re,rl,rM){return void 0===re&&(re=35044),void 0===rl&&(rl=!1),new rT(rS,rQ,re,rl,rM)},rT}(rU),rwQ=function(rS){function rA(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,rA.__super.call(this),this._type=3553}rJ(rA,"laya.d3.resource.DataTexture2D",rkQ);var rQ=rA.prototype;return rQ.genDebugMipmaps=function(){var rS=[];return rS.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),rS.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),rS.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),rS.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),rS.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),rS.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),rS.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),rS.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),rS.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),rS.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),rS},rQ._onTextureLoaded=function(rS){},rQ._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var rS=rk.mainContext,rQ=this._source=rS.createTexture(),re=this._width,rl=this._height,rM=rX.curBindTexTarget,rd=rX.curBindTexValue,rT=!1;if(rX.bindTexture(rS,this._type,rQ),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var rU=0;rS.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var ri=0;ri<this._mipmaps.length;ri++){if(this._mipmaps[ri].byteLength!=rR*ro*4)throw"mipmap size error  level:"+ri;rS.texSubImage2D(this._type,0,rA.simLodRect[rU++],rA.simLodRect[rU++],rA.simLodRect[rU++],rA.simLodRect[rU++],6408,5121,new Uint8Array(this._mipmaps[ri]))}this.minFifter=9729,this.magFifter=9729}else{var rR=this._width,ro=this._height;for(rU=0,rS.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),ri=0;ri<this._mipmaps.length;ri++){if(this._mipmaps[ri].byteLength!=rR*ro*4)throw"mipmap size error  level:"+ri;rS.texImage2D(this._type,ri,6408,rR,ro,0,6408,5121,new Uint8Array(this._mipmaps[ri])),(rR/=2)<1&&(rR=1),(ro/=2)<1&&(ro=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&rS.pixelStorei(rS.UNPACK_ALIGNMENT,1),rS.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var rY=0,rp=!1,rJ=!1;this._buffer.byteLength==4*re*rl?(rY=6408,rp=!0):this._buffer.byteLength==3*re*rl?(rY=6407,rJ=!0):rY=this._format,rp||rJ?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),rJ&&rS.pixelStorei(rS.UNPACK_ALIGNMENT,1),rS.texImage2D(this._type,0,rY,re,rl,0,rY,5121,this._buffer)):rS&&rY==rS.ALPHA?(rS.texImage2D(3553,0,rY,re,rl,0,rY,rS.UNSIGNED_BYTE,this._buffer),rT=!0):0!=rY&&(rS.compressedTexImage2D(3553,0,rY,re,rl,0,this._buffer),rT=!0)}var rL=this._minFifter,rj=this._magFifter,rc=0==this._wrapModeU?10497:33071,rG=0==this._wrapModeV?10497:33071,rz=rv.isPOT(re,rl);rz?(this._mipmap||this._mipmaps?-1!==rL||(rL=9987):-1!==rL||(rL=9729),-1!==rj||(rj=9729),rS.texParameteri(this._type,10241,rL),rS.texParameteri(this._type,10240,rj),rS.texParameteri(this._type,10242,rc),rS.texParameteri(this._type,10243,rG),this._mipmap&&rS.generateMipmap(this._type)):(-1!==rL||(rL=9729),-1!==rj||(rj=9729),rS.texParameteri(this._type,10241,rL),rS.texParameteri(this._type,10240,rj),rS.texParameteri(this._type,10242,33071),rS.texParameteri(this._type,10243,33071)),rM&&rd&&rX.bindTexture(rS,rM,rd),this.memorySize=rT?this._buffer.length:rz?re*rl*4*(1+1/3):re*rl*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},rQ.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},rQ.onAsynLoaded=function(rS,rQ,re){var rl;re&&(rl=re[0].call(this,rQ)),rl&&(this._width=rl.width,this._height=rl.height,this._buffer=rl.data),this._src=rS,this._size=new rjQ(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},rQ.getPixels=function(){return new Uint8Array(this._buffer)},rQ.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(rk.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},rL(0,rQ,"src",function(){return this._src}),rA.create=function(rS,rQ,re,rl,rM,rd,rT){if(void 0===rl&&(rl=9729),void 0===rM&&(rM=9729),void 0===rd&&(rd=!0),!rS||rS.byteLength<rQ*re*4)throw"DataTexture2D create error";var rU=new rA;return rU.uri=rT,rU._buffer=rS,rU._width=rQ,rU._height=re,rU._mipmap=rd,rU._magFifter=rl,rU._minFifter=rM,rU._size=new rjQ(rU._width,rU._height),rU._conchTexture?alert("怎么给runtime传递datatexture数据"):rU.activeResource(),rU},rA.load=function(rS,rQ,re,rl,rM){if(void 0===rQ&&(rQ=0),void 0===re&&(re=0),void 0===rl&&(rl=9729),void 0===rM&&(rM=9729),"mipmaps"===rI.getFileExtension(rS)){var rd=rD.loader.create(rS,null,null,rA,[function(rS){this._mipmaps=[];var rQ=new Uint32Array(rS);this._width=rQ[0];var re=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,re=1024),this._width!=re)throw"现在只支持512x256的环境贴图。当前的是"+rQ[0];this._height=rQ[1];for(var rl=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,rM=this._height,rd=8;;){var rT=rl*rM*4;if(rd+rT>rS.byteLength)throw"load mipmaps data size error ";var rU=new Uint8Array(rS,rd,rT);if(this._mipmaps.push(rU),rd+=rT,1==rl&&1==rM)break;(rl/=2)<1&&(rl=1),(rM/=2)<1&&(rM=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){rd.simLodInfo=new Float32Array(40);for(var rT=0;rT<rd.simLodInfo.length;)rd.simLodInfo[rT]=(rA.simLodRect[rT]+.5)/1024,rT++,rd.simLodInfo[rT]=(rA.simLodRect[rT]+.5)/256,rT++,rd.simLodInfo[rT]=Math.max(rA.simLodRect[rT]-1,.1)/1024,rT++,rd.simLodInfo[rT]=Math.max(rA.simLodRect[rT]-1.5,.1)/256,rT++}return rd}if("number"==typeof rQ)return rD.loader.create(rS,null,null,rA,[function(rS){return this._width=rQ,this._height=re,this._buffer=rS,null}]);if("function"==typeof rQ)return rD.loader.create(rS,null,null,rA,[rQ]);throw new Error("unknown params.")},rA.lodasatlas=!1,rY(rA,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),rA}(),ruQ=function(rS){function rQ(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,rQ.__super.call(this)}rJ(rQ,"laya.d3.resource.models.PrimitiveMesh",rXQ);var re=rQ.prototype;return rD.imps(re,{"laya.d3.core.render.IRenderable":!0}),re._getVertexBuffer=function(rS){return void 0===rS&&(rS=0),0===rS?this._vertexBuffer:null},re._getVertexBuffers=function(){return null},re._getIndexBuffer=function(){return this._indexBuffer},re._getPositions=function(){var rS,rQ=[],re=this._vertexBuffer.vertexDeclaration.getVertexElements(),rl=0;for(rl=0;rl<re.length;rl++){var rM=re[rl];if("vector3"===rM.elementFormat&&0===rM.elementUsage){rS=rM;break}}var rd=this._vertexBuffer.getData();for(rl=0;rl<rd.length;rl+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var rT=rl+rS.offset/4,rU=new rTQ(rd[rT+0],rd[rT+1],rd[rT+2]);rQ.push(rU)}return rQ},re.getRenderElement=function(rS){return this},re.getRenderElementsCount=function(){return 1},re.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},re._beforeRender=function(rS){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},re._render=function(rS){rk.mainContext.drawElements(4,this._numberIndices,5123,0),rH.drawCall++,rH.trianglesFaces+=this._numberIndices/3},rL(0,re,"_vertexBufferCount",function(){return 1}),rL(0,re,"triangleCount",function(){return this._indexBuffer.indexCount/3}),rQ}(),rrQ=function(rS){function rQ(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,rQ.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}rJ(rQ,"laya.d3.resource.models.Mesh",rXQ);var re=rQ.prototype;return re._getPositions=function(){var rS,rQ,re,rl,rM,rd=[],rT=0,rU=0,ri=0;if(0!==this._vertexBuffers.length){var rR=this._vertexBuffers.length;for(rT=0;rT<rR;rT++){for(re=(rS=this._vertexBuffers[rT]).vertexDeclaration.getVertexElements(),rU=0;rU<re.length;rU++)if("vector3"===(rl=re[rU]).elementFormat&&0===rl.elementUsage){rQ=rl;break}for(rM=rS.getData(),rU=0;rU<rM.length;rU+=rS.vertexDeclaration.vertexStride/4)ri=rU+rQ.offset/4,rd.push(new rTQ(rM[ri+0],rM[ri+1],rM[ri+2]))}}else{var ro=this._subMeshes.length;for(rT=0;rT<ro;rT++){for(re=(rS=this._subMeshes[rT]._getVertexBuffer()).vertexDeclaration.getVertexElements(),rU=0;rU<re.length;rU++)if("vector3"===(rl=re[rU]).elementFormat&&0===rl.elementUsage){rQ=rl;break}for(rM=rS.getData(),rU=0;rU<rM.length;rU+=rS.vertexDeclaration.vertexStride/4)ri=rU+rQ.offset/4,rd.push(new rTQ(rM[ri+0],rM[ri+1],rM[ri+2]))}}return rd},re._setSubMeshes=function(rS){this._subMeshes=rS,this._subMeshCount=rS.length;for(var rQ=0;rQ<this._subMeshCount;rQ++)rS[rQ]._indexInMesh=rQ;this._positions=this._getPositions(),this._generateBoundingObject()},re.onAsynLoaded=function(rS,rQ,re){var rl=rQ[0],rM=rQ[1];rCS.read(rl,this,this._materials,this._subMeshes,rM),this.completeCreate(),this._endLoaded()},re.getSubMesh=function(rS){return this._subMeshes[rS]},re.getSubMeshCount=function(){return this._subMeshes.length},re.getRenderElementsCount=function(){return this._subMeshes.length},re.getRenderElement=function(rS){return this._subMeshes[rS]},re.disposeResource=function(){for(var rS=0;rS<this._subMeshes.length;rS++)this._subMeshes[rS].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},rL(0,re,"materials",function(){return this._materials.slice()}),rL(0,re,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),rQ.load=function(rS){return rD.loader.create(rS,null,null,rQ)},rQ}(),rWQ=(function(rS){function rR(rS,rQ,re,rl,rM,rd,rT,rU,ri){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===re&&(re=6408),void 0===rl&&(rl=5121),void 0===rM&&(rM=33189),void 0===rd&&(rd=!1),void 0===rT&&(rT=!1),void 0===rU&&(rU=-1),void 0===ri&&(ri=-1),rR.__super.call(this),this._type=3553,this._width=rS,this._height=rQ,this._size=new rjQ(rS,rQ),this._surfaceFormat=re,this._surfaceType=rl,this._depthStencilFormat=rM,rj.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=rd,this._repeat=rT,this._minFifter=rU,this._magFifter=ri,this.activeResource(),this._alreadyResolved=!0}rJ(rR,"laya.d3.resource.RenderTexture",rkQ);var rQ=rR.prototype;rQ.recreateResource=function(){var rS=rk.mainContext;this._frameBuffer=rS.createFramebuffer(),this._source=rS.createTexture();var rQ=rX.curBindTexTarget,re=rX.curBindTexValue;rX.bindTexture(rS,this._type,this._source),rS.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var rl=this._minFifter,rM=this._magFifter,rd=this._repeat?10497:33071;if(rv.isPOT(this._width,this._height)?(this._mipmap?-1!==rl||(rl=9987):-1!==rl||(rl=9729),-1!==rM||(rM=9729),rS.texParameteri(this._type,10241,rl),rS.texParameteri(this._type,10240,rM),rS.texParameteri(this._type,10242,rd),rS.texParameteri(this._type,10243,rd),this._mipmap&&rS.generateMipmap(this._type)):(-1!==rl||(rl=9729),-1!==rM||(rM=9729),rS.texParameteri(this._type,10241,rl),rS.texParameteri(this._type,10240,rM),rS.texParameteri(this._type,10242,33071),rS.texParameteri(this._type,10243,33071)),rQ&&re&&rX.bindTexture(rS,rQ,re),rS.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=rS.createRenderbuffer(),rS.bindRenderbuffer(36161,this._depthStencilBuffer),rS.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),rS.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:rS.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:rS.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:rS.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}rS.framebufferTexture2D(36160,36064,3553,this._source,0),rS.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},rQ.start=function(){rk.mainContext.bindFramebuffer(36160,this.frameBuffer),(rR._currentRenderTarget=this)._alreadyResolved=!1},rQ.end=function(){rk.mainContext.bindFramebuffer(36160,null),rR._currentRenderTarget=null,this._alreadyResolved=!0},rQ.getData=function(rS,rQ,re,rl){var rM=rk.mainContext;if(rM.bindFramebuffer(36160,this._frameBuffer),!(36053===rM.checkFramebufferStatus(36160)))return rM.bindFramebuffer(36160,null),null;var rd=new Uint8Array(this._width*this._height*4);return rM.readPixels(rS,rQ,re,rl,this._surfaceFormat,this._surfaceType,rd),rM.bindFramebuffer(36160,null),rd},rQ.disposeResource=function(){if(this._frameBuffer){var rS=rk.mainContext;rS.deleteTexture(this._source),rS.deleteFramebuffer(this._frameBuffer),rS.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},rL(0,rQ,"surfaceFormat",function(){return this._surfaceFormat}),rL(0,rQ,"surfaceType",function(){return this._surfaceType}),rL(0,rQ,"depthStencilFormat",function(){return this._depthStencilFormat}),rL(0,rQ,"source",function(){return this._alreadyResolved?rD.superGet(rkQ,this,"source"):null}),rL(0,rQ,"depthStencilBuffer",function(){return this._depthStencilBuffer}),rL(0,rQ,"frameBuffer",function(){return this._frameBuffer}),rR._currentRenderTarget=null}(),function(rS){function rQ(rS){this._color=null,this._pixels=null,rQ.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new rjQ(this.width,this.height),this._color=rS,this._pixels=new Uint8Array([255*rS.x,255*rS.y,255*rS.z,255*rS.w]),this.uri="SolidColorTexture2D_"+this.id}rJ(rQ,"laya.d3.resource.SolidColorTexture2D",rkQ);var re=rQ.prototype;return re._createWebGlTexture=function(){var rS=rk.mainContext,rQ=this._source=rS.createTexture(),re=this._width,rl=this._height,rM=rX.curBindTexTarget,rd=rX.curBindTexValue;rX.bindTexture(rS,this._type,rQ),rS.texImage2D(this._type,0,6408,re,rl,0,6408,5121,this._pixels);var rT=this._minFifter,rU=this._magFifter,ri=this._repeat?10497:33071,rR=rv.isPOT(re,rl);rR?(this._mipmap?-1!==rT||(rT=9987):-1!==rT||(rT=9729),-1!==rU||(rU=9729),rS.texParameteri(this._type,10241,rT),rS.texParameteri(this._type,10240,rU),rS.texParameteri(this._type,10242,ri),rS.texParameteri(this._type,10243,ri),this._mipmap&&rS.generateMipmap(this._type)):(-1!==rT||(rT=9729),-1!==rU||(rU=9729),rS.texParameteri(this._type,10241,rT),rS.texParameteri(this._type,10240,rU),rS.texParameteri(this._type,10242,33071),rS.texParameteri(this._type,10243,33071)),rM&&rd&&rX.bindTexture(rS,rM,rd),this.memorySize=rR?re*rl*4*(1+1/3):re*rl*4},re.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},re.disposeResource=function(){this._source&&(rk.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},rY(rQ,["magentaTexture",function(){var rS=new rQ(new rUQ(1,0,1,1));return rS.lock=!0,this.magentaTexture=rS},"grayTexture",function(){var rS=new rQ(new rUQ(.5,.5,.5,1));return rS.lock=!0,this.grayTexture=rS}]),rQ}()),rxQ=function(rS){function rM(rS,rQ,re,rl){this._canRead=!1,this._image=null,this._pixels=null,void 0===rS&&(rS=!1),void 0===rQ&&(rQ=!0),void 0===re&&(re=6408),void 0===rl&&(rl=!0),rM.__super.call(this),this._type=3553,this._repeat=rQ,this._canRead=rS,this._format=re,this._mipmap=rl}rJ(rM,"laya.d3.resource.Texture2D",rkQ);var rQ=rM.prototype;return rQ._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var rS=rk.mainContext,rQ=this._source=rS.createTexture(),re=this._width,rl=this._height,rM=rX.curBindTexTarget,rd=rX.curBindTexValue;switch(rX.bindTexture(rS,this._type,rQ),this._format){case 6407:case 6408:this._canRead?rS.texImage2D(this._type,0,this._format,re,rl,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?rS.texImage2D(this._type,0,this._image._format,re,rl,0,this._image._format,5121,this._image.atlasSource):rS.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case rk.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:rS.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var rT=this._minFifter,rU=this._magFifter,ri=this._repeat?10497:33071,rR=0==this._wrapModeU?10497:33071,ro=0==this._wrapModeV?10497:33071,rY=rv.isPOT(re,rl);rY?(this._mipmap?-1!==rT||(rT=9987):-1!==rT||(rT=9729),-1!==rU||(rU=9729),rS.texParameteri(this._type,10241,rT),rS.texParameteri(this._type,10240,rU),rS.texParameteri(this._type,10242,ri),rS.texParameteri(this._type,10243,ri),rS.texParameteri(this._type,10242,rR),rS.texParameteri(this._type,10243,ro),this._mipmap&&rS.generateMipmap(this._type)):(-1!==rT||(rT=9729),-1!==rU||(rU=9729),rS.texParameteri(this._type,10241,rT),rS.texParameteri(this._type,10240,rU),rS.texParameteri(this._type,10242,33071),rS.texParameteri(this._type,10243,33071)),rM&&rd&&rX.bindTexture(rS,rM,rd),this._image.onload=null,this._image=null,this.memorySize=rY?re*rl*4*(1+1/3):re*rl*4},rQ.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},rQ.onAsynLoaded=function(rS,rQ,re){if(re){var rl=re[0];void 0!==rl&&(this._canRead=rl);var rM=re[1];void 0!==rM&&(this._repeat=rM);var rd=re[2];void 0!==rd&&(this._format=rd);var rT=re[3];void 0!==rT&&(this._mipmap=rT);var rU=re.wrapModeU;void 0!==rU&&(this._wrapModeU=rU);var ri=re.wrapModeV;void 0!==ri&&(this._wrapModeV=ri)}switch(this._format){case 6407:case 6408:var rR=(this._image=rQ).width,ro=rQ.height;this._width=rR,this._height=ro,this._size=new rjQ(rR,ro),this._canRead&&(rj.isConchApp?rQ instanceof rp.HTMLElement&&(this._pixels=new Uint8Array(rQ.getImageData(0,0,rR,ro))):(rh.canvas.size(rR,ro),rh.canvas.clear(),rh.context.drawImage(rQ,0,0,rR,ro),this._pixels=new Uint8Array(rh.context.getImageData(0,0,rR,ro).data.buffer)));break;case rk.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var rY=new rB(rQ);rY.readUTFBytes(4),rY.readUTFBytes(2),rY.getInt16();rY.endian="bigEndian",this._width=rY.getInt16(),this._height=rY.getInt16(),this._size=new rjQ(this._width,this._height);rY.getInt16(),rY.getInt16();this._image=new Uint8Array(rQ,rY.pos)}this.recreateResource(),this._endLoaded()},rQ.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},rQ.disposeResource=function(){this._source&&(rk.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},rL(0,rQ,"_src",function(){return this.url}),rL(0,rQ,"src",function(){return this.url}),rM.load=function(rS){return rD.loader.create(rS,null,null,rM)},rM}(),rFQ=function(rQ){function re(rS,rQ){re.__super.call(this),void 0===rS&&(rS=.3),void 0===rQ&&(rQ=1e3),this._tempVector3=new rTQ,this._position=new rTQ,this._up=new rTQ,this._forward=new rTQ,this._right=new rTQ,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=rjQ.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=rS,this._farPlane=rQ,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),rD.stage.on("resize",this,this._onScreenSizeChanged)}rJ(re,"laya.d3.core.BaseCamera",rQ);var rS=re.prototype;return rS._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var rS=this.scene._cameraPool,rQ=rS.length-1,re=0;re<rQ;re++)if(rS[re].renderingOrder>rS[rQ].renderingOrder){var rl=rS[re];rS[re]=rS[rQ],rS[rQ]=rl}},rS._calculateProjectionMatrix=function(){},rS._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},rS._prepareCameraToRender=function(){rb._currentCameraCullingMask=this.cullingMask;var rS=this._shaderValues;rS.setValue(0,this.transform.position.elements),rS.setValue(5,this.forward.elements),rS.setValue(6,this.up.elements)},rS._prepareCameraViewProject=function(rS,rQ){var re=this._shaderValues;re.setValue(1,rS.elements),re.setValue(2,rQ.elements)},rS._renderCamera=function(rS,rQ,re){},rS.addLayer=function(rS){29!==rS.number&&30!=rS.number&&(this.cullingMask=this.cullingMask|rS.mask)},rS.removeLayer=function(rS){29!==rS.number&&30!=rS.number&&(this.cullingMask=this.cullingMask&~rS.mask)},rS.addAllLayers=function(){this.cullingMask=2147483647},rS.removeAllLayers=function(){this.cullingMask=0|rb.getLayerByNumber(29).mask|rb.getLayerByNumber(30).mask},rS.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},rS.moveForward=function(rS){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=rS,this.transform.translate(this._tempVector3)},rS.moveRight=function(rS){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=rS,this.transform.translate(this._tempVector3)},rS.moveVertical=function(rS){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=rS,this.transform.translate(this._tempVector3,!1)},rS._addSelfRenderObjects=function(){var rS=this.scene._cameraPool,rQ=rS.length;if(0<rQ){for(var re=rQ-1;0<=re;re--)if(this.renderingOrder<=rS[re].renderingOrder){rS.splice(re+1,0,this);break}}else rS.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},rS._clearSelfRenderObjects=function(){var rS=this.scene._cameraPool;rS.splice(rS.indexOf(this),1)},rS.destroy=function(rS){void 0===rS&&(rS=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,rD.stage.off("resize",this,this._onScreenSizeChanged),rQ.prototype.destroy.call(this,rS)},rL(0,rS,"sky",function(){return this._sky},function(rS){(this._sky=rS)._ownerCamera=this}),rL(0,rS,"forward",function(){var rS=this.transform.worldMatrix.elements,rQ=this._forward.elements;return rQ[0]=-rS[8],rQ[1]=-rS[9],rQ[2]=-rS[10],this._forward}),rL(0,rS,"position",function(){var rS=this.transform.worldMatrix.elements,rQ=this._position.elements;return rQ[0]=rS[12],rQ[1]=rS[13],rQ[2]=rS[14],this._position}),rL(0,rS,"renderTarget",function(){return this._renderTarget},function(rS){null!=(this._renderTarget=rS)&&(this._renderTargetSize=rS.size)}),rL(0,rS,"up",function(){var rS=this.transform.worldMatrix.elements,rQ=this._up.elements;return rQ[0]=rS[4],rQ[1]=rS[5],rQ[2]=rS[6],this._up}),rL(0,rS,"right",function(){var rS=this.transform.worldMatrix.elements,rQ=this._right.elements;return rQ[0]=rS[0],rQ[1]=rS[1],rQ[2]=rS[2],this._right}),rL(0,rS,"renderTargetSize",function(){return this._renderTargetSize},function(rS){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=rS,this._calculateProjectionMatrix()}),rL(0,rS,"fieldOfView",function(){return this._fieldOfView},function(rS){this._fieldOfView=rS,this._calculateProjectionMatrix()}),rL(0,rS,"nearPlane",function(){return this._nearPlane},function(rS){this._nearPlane=rS,this._calculateProjectionMatrix()}),rL(0,rS,"farPlane",function(){return this._farPlane},function(rS){this._farPlane=rS,this._calculateProjectionMatrix()}),rL(0,rS,"orthographic",function(){return this._orthographic},function(rS){this._orthographic=rS,this._calculateProjectionMatrix()}),rL(0,rS,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(rS){this._orthographicVerticalSize=rS,this._calculateProjectionMatrix()}),rL(0,rS,"renderingOrder",function(){return this._renderingOrder},function(rS){this._renderingOrder=rS,this._sortCamerasByRenderingOrder()}),re.CAMERAPOS=0,re.VIEWMATRIX=1,re.PROJECTMATRIX=2,re.VPMATRIX=3,re.VPMATRIX_NO_TRANSLATE=4,re.CAMERADIRECTION=5,re.CAMERAUP=6,re.ENVIRONMENTDIFFUSE=7,re.ENVIRONMENTSPECULAR=8,re.SIMLODINFO=9,re.DIFFUSEIRRADMATR=10,re.DIFFUSEIRRADMATG=11,re.DIFFUSEIRRADMATB=12,re.HDREXPOSURE=13,re.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",re.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",re.CLEARFLAG_SOLIDCOLOR=0,re.CLEARFLAG_SKY=1,re.CLEARFLAG_DEPTHONLY=2,re.CLEARFLAG_NONE=3,rY(re,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new rSQ(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new rSQ},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new rSQ}]),re}(r$Q),rqQ=function(re){function rQ(rS){this._render=null,this._geometryFilter=null,rQ.__super.call(this,rS)}rJ(rQ,"laya.d3.core.RenderableSprite3D",re);var rS=rQ.prototype;return rS._addToInitStaticBatchManager=function(){},rS._setBelongScene=function(rS){re.prototype._setBelongScene.call(this,rS),rS._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},rS._setUnBelongScene=function(){var rS=this._scene._renderableSprite3Ds,rQ=rS.indexOf(this);rS.splice(rQ,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),re.prototype._setUnBelongScene.call(this)},rS._update=function(rS){(rS.owner=this)._activeInHierarchy&&(this._updateComponents(rS),this._render._updateOctreeNode(),this._lateUpdateComponents(rS),rH.spriteCount++,this._childs.length&&this._updateChilds(rS))},rS.destroy=function(rS){void 0===rS&&(rS=!0),re.prototype.destroy.call(this,rS),this._render._destroy(),this._render=null},rQ.__init__=function(){rQ.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=rQ.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),rQ.SAHDERDEFINE_LIGHTMAP=rQ.shaderDefines.registerDefine("LIGHTMAP")},rQ.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,rQ.SAHDERDEFINE_LIGHTMAP=4,rQ.LIGHTMAPSCALEOFFSET=2,rQ.LIGHTMAP=3,rY(rQ,["shaderDefines",function(){return this.shaderDefines=new roQ}]),rQ}(r$Q),rZQ=(function(rS){function rl(rS,rQ,re){this._long=NaN,this._width=NaN,this._height=NaN,void 0===rS&&(rS=1),void 0===rQ&&(rQ=1),void 0===re&&(re=1),rl.__super.call(this),this._long=rS,this._width=rQ,this._height=re,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}rJ(rl,"laya.d3.resource.models.BoxMesh",ruQ);var rQ=rl.prototype;rQ.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var rS=rkS.vertexDeclaration,rQ=(rS.vertexStride,this._long/2),re=this._height/2,rl=this._width/2,rM=new Float32Array([-rQ,re,-rl,0,1,0,0,0,rQ,re,-rl,0,1,0,1,0,rQ,re,rl,0,1,0,1,1,-rQ,re,rl,0,1,0,0,1,-rQ,-re,-rl,0,-1,0,0,1,rQ,-re,-rl,0,-1,0,1,1,rQ,-re,rl,0,-1,0,1,0,-rQ,-re,rl,0,-1,0,0,0,-rQ,re,-rl,-1,0,0,0,0,-rQ,re,rl,-1,0,0,1,0,-rQ,-re,rl,-1,0,0,1,1,-rQ,-re,-rl,-1,0,0,0,1,rQ,re,-rl,1,0,0,1,0,rQ,re,rl,1,0,0,0,0,rQ,-re,rl,1,0,0,0,1,rQ,-re,-rl,1,0,0,1,1,-rQ,re,rl,0,0,1,0,0,rQ,re,rl,0,0,1,1,0,rQ,-re,rl,0,0,1,1,1,-rQ,-re,rl,0,0,1,0,1,-rQ,re,-rl,0,0,-1,1,0,rQ,re,-rl,0,0,-1,0,0,rQ,-re,-rl,0,0,-1,0,1,-rQ,-re,-rl,0,0,-1,1,1]),rd=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new rfQ(rS,this._numberVertices,35044,!0),this._indexBuffer=new raQ("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(rM),this._indexBuffer.setData(rd),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},rL(0,rQ,"long",function(){return this._long},function(rS){this._long!==rS&&(this._long=rS,this.releaseResource(),this.activeResource())}),rL(0,rQ,"width",function(){return this._width},function(rS){this._width!==rS&&(this._width=rS,this.releaseResource(),this.activeResource())}),rL(0,rQ,"height",function(){return this._height},function(rS){this._height!==rS&&(this._height=rS,this.releaseResource(),this.activeResource())})}(),function(rS){function rT(rS,rQ,re){void 0===rS&&(rS=0),void 0===rQ&&(rQ=.3),void 0===re&&(re=1e3),this._viewMatrix=new rSQ,this._projectionMatrix=new rSQ,this._projectionViewMatrix=new rSQ,this._viewport=new riQ(0,0,0,0),this._normalizedViewport=new riQ(0,0,1,1),this._aspectRatio=rS,this._boundFrustumUpdate=!0,this._boundFrustum=new rVS(rSQ.DEFAULT),rT.__super.call(this,rQ,re),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}rJ(rT,"laya.d3.core.Camera",rFQ);var rQ=rT.prototype;return rQ._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},rQ._parseCustomProps=function(rS,rQ,re,rl){var rM=re.clearColor;this.clearColor=new rUQ(rM[0],rM[1],rM[2],rM[3]);var rd=re.viewport;this.normalizedViewport=new riQ(rd[0],rd[1],rd[2],rd[3])},rQ._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var rS=this.orthographicVerticalSize*this.aspectRatio*.5,rQ=.5*this.orthographicVerticalSize;rSQ.createOrthoOffCenterRH(-rS,rS,-rQ,rQ,this.nearPlane,this.farPlane,this._projectionMatrix)}else rSQ.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},rQ._update=function(rS){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,rS)},rQ._renderCamera=function(rS,rQ,re){var rl,rM;re.parallelSplitShadowMaps[0]&&re._renderShadowMap(rS,rQ,this),(rQ.camera=this)._prepareCameraToRender(),re._preRenderUpdateComponents(rQ),rl=rQ._viewMatrix=this.viewMatrix;var rd=this._renderTarget;rd?(rd.start(),rSQ.multiply(rFQ._invertYScaleMatrix,this._projectionMatrix,rFQ._invertYProjectionMatrix),rSQ.multiply(rFQ._invertYScaleMatrix,this.projectionViewMatrix,rFQ._invertYProjectionViewMatrix),rM=rQ._projectionMatrix=rFQ._invertYProjectionMatrix,rQ._projectionViewMatrix=rFQ._invertYProjectionViewMatrix):(rM=rQ._projectionMatrix=this._projectionMatrix,rQ._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(rl,rM),rQ._viewport=this.viewport,re._preRenderScene(rS,rQ,this.boundFrustum),re._clear(rS,rQ),re._renderScene(rS,rQ),re._postRenderUpdateComponents(rQ),rd&&rd.end()},rQ.viewportPointToRay=function(rS,rQ){rLQ.calculateCursorRay(rS,this.viewport,this._projectionMatrix,this.viewMatrix,null,rQ)},rQ.normalizedViewportPointToRay=function(rS,rQ){var re=rT._tempVector20,rl=this.viewport,rM=rS.elements,rd=re.elements;rd[0]=rM[0]*rl.width,rd[1]=rM[1]*rl.height,rLQ.calculateCursorRay(re,this.viewport,this._projectionMatrix,this.viewMatrix,null,rQ)},rQ.worldToViewportPoint=function(rS,rQ){rSQ.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(rS,this._projectionViewMatrix,rQ);var re=rQ.elements;re[0]=re[0]/rD.stage.clientScaleX,re[1]=re[1]/rD.stage.clientScaleY},rQ.worldToNormalizedViewportPoint=function(rS,rQ){rSQ.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(rS,this._projectionViewMatrix,rQ);var re=rQ.elements;re[0]=re[0]/rD.stage.clientScaleX,re[1]=re[1]/rD.stage.clientScaleY},rQ.convertScreenCoordToOrthographicCoord=function(rS,rQ){if(this._orthographic){var re=rC.clientWidth,rl=rC.clientHeight,rM=this.orthographicVerticalSize*this.aspectRatio/re,rd=this.orthographicVerticalSize/rl,rT=rS.elements,rU=rQ.elements;return rU[0]=(-re/2+rT[0])*rM,rU[1]=(rl/2-rT[1])*rd,rU[2]=(this.nearPlane-this.farPlane)*(rT[2]+1)/2-this.nearPlane,rTQ.transformCoordinate(rQ,this.transform.worldMatrix,rQ),!0}return!1},rL(0,rQ,"projectionViewMatrix",function(){return rSQ.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),rL(0,rQ,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var rS=this.viewport;return rS.width/rS.height},function(rS){if(rS<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=rS,this._calculateProjectionMatrix()}),rL(0,rQ,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),rL(0,rQ,"needViewport",function(){var rS=this.normalizedViewport;return 0===rS.x&&0===rS.y&&1===rS.width&&1===rS.height}),rL(0,rQ,"viewport",function(){if(this._viewportExpressedInClipSpace){var rS=this._normalizedViewport,rQ=this.renderTargetSize,re=rQ.width,rl=rQ.height;this._viewport.x=rS.x*re,this._viewport.y=rS.y*rl,this._viewport.width=rS.width*re,this._viewport.height=rS.height*rl}return this._viewport},function(rS){if(null!=this.renderTarget&&(rS.x<0||rS.y<0||0==rS.width||0==rS.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=rS,this._calculateProjectionMatrix()}),rL(0,rQ,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var rS=this._viewport,rQ=this.renderTargetSize,re=rQ.width,rl=rQ.height;this._normalizedViewport.x=rS.x/re,this._normalizedViewport.y=rS.y/rl,this._normalizedViewport.width=rS.width/re,this._normalizedViewport.height=rS.height/rl}return this._normalizedViewport},function(rS){rS.x<0&&(rS.x=0,console.warn("Camera: viewport.x must large than 0.0.")),rS.y<0&&(rS.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<rS.x+rS.width&&(rS.width=1-rS.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<rS.y+rS.height&&(rS.height=1-rS.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=rS,this._calculateProjectionMatrix()}),rL(0,rQ,"projectionMatrix",function(){return this._projectionMatrix},function(rS){this._projectionMatrix=rS,this._useUserProjectionMatrix=!0}),rL(0,rQ,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),rY(rT,["_tempVector20",function(){return this._tempVector20=new rdQ}]),rT}()),rNQ=function(re){function rl(rS,rQ){rl.__super.call(this,rQ),this._geometryFilter=new rhQ(this),this._render=new rbQ(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),rS&&(this._geometryFilter.sharedMesh=rS)instanceof laya.d3.resource.models.Mesh&&(rS.loaded?this._render.sharedMaterials=rS.materials:rS.once("loaded",this,this._applyMeshMaterials))}rJ(rl,"laya.d3.core.MeshSprite3D",re);var rS=rl.prototype;return rS._changeRenderObjectByMesh=function(rS){var rQ=this._render._renderElements,re=rQ[rS];re||(re=rQ[rS]=new rOQ),re._render=this._render;var rl=this._render.sharedMaterials[rS];rl||(rl=rPQ.defaultMaterial);var rM=this._geometryFilter.sharedMesh.getRenderElement(rS);return re._mainSortID=this._getSortID(rM,rl),re._sprite3D=this,re.renderObj=rM,re._material=rl,re},rS._changeRenderObjectByMaterial=function(rS,rQ){var re=this._render._renderElements[rS];rQ||(rQ=rPQ.defaultMaterial);var rl=this._geometryFilter.sharedMesh.getRenderElement(rS);return re._mainSortID=this._getSortID(rl,rQ),re._sprite3D=this,re.renderObj=rl,re._material=rQ,re},rS._changeRenderObjectsByMesh=function(){var rS=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=rS;for(var rQ=0;rQ<rS;rQ++)this._changeRenderObjectByMesh(rQ)},rS._onMeshChanged=function(rS){var rQ=rS.sharedMesh;rQ.loaded?this._changeRenderObjectsByMesh():rQ.once("loaded",this,this._onMeshLoaded)},rS._onMeshLoaded=function(rS){rS===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},rS._onMaterialChanged=function(rS,rQ,re){rQ<this._render._renderElements.length&&this._changeRenderObjectByMaterial(rQ,re)},rS._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},rS._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},rS._parseCustomProps=function(rS,rQ,re,rl){var rM=this.meshRender,rd=re.lightmapIndex;null!=rd&&(rM.lightmapIndex=rd);var rT,rU,ri=re.lightmapScaleOffset;if(ri&&(rM.lightmapScaleOffset=new rUQ(ri[0],ri[1],ri[2],ri[3])),rl.instanceParams)(rT=rl.instanceParams.loadPath)&&(rU=rG.getRes(rQ[rT]),(this.meshFilter.sharedMesh=rU).loaded?rM.sharedMaterials=rU.materials:rU.once("loaded",this,this._applyMeshMaterials));else{(rT=re.meshPath)&&(rU=rG.getRes(rQ[rT]),this.meshFilter.sharedMesh=rU);var rR=re.materials;if(rR){var ro=rM.sharedMaterials,rY=rR.length;ro.length=rY;for(var rp=0;rp<rY;rp++)ro[rp]=rG.getRes(rQ[rR[rp].path]);rM.sharedMaterials=ro}}},rS._applyMeshMaterials=function(rS){for(var rQ=this._render.sharedMaterials,re=rS.materials,rl=0,rM=re.length;rl<rM;rl++)rQ[rl]||(rQ[rl]=re[rl]);this._render.sharedMaterials=rQ},rS._addToInitStaticBatchManager=function(){rl._staticBatchManager._addInitBatchSprite(this)},rS.cloneTo=function(rS){var rQ=rS;rQ._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var re=this._render,rl=rQ._render;rl.enable=re.enable,rl.sharedMaterials=re.sharedMaterials,rl.castShadow=re.castShadow;var rM=re.lightmapScaleOffset;rM&&(rl.lightmapScaleOffset=rM.clone()),rl.lightmapIndex=re.lightmapIndex,rl.receiveShadow=re.receiveShadow,rl.sortingFudge=re.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,rS)},rS.destroy=function(rS){if(void 0===rS&&(rS=!0),!this.destroyed){var rQ=this.meshFilter.sharedMesh;null!=rQ&&(rQ.loaded||rQ.off("loaded",this,this._applyMeshMaterials)),re.prototype.destroy.call(this,rS),this._geometryFilter._destroy()}},rL(0,rS,"meshFilter",function(){return this._geometryFilter}),rL(0,rS,"meshRender",function(){return this._render}),rl.__init__=function(){rlS._staticBatchManagers.push(rl._staticBatchManager)},rl.load=function(rS){return rD.loader.create(rS,null,null,rl)},rY(rl,["_staticBatchManager",function(){return this._staticBatchManager=new rgQ}]),rl}(rqQ)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}}),function(rS,rQ,rMS){rMS.un,rMS.uns;var re=rMS.static,rl=rMS.class,rd=rMS.getset,rj=rMS.__newvec,rU=laya.maths.Bezier,rY=laya.utils.Browser,rkS=laya.utils.Byte,rM=(laya.events.Event,laya.events.EventDispatcher),rT=laya.display.Graphics,ri=(laya.resource.HTMLCanvas,laya.utils.Handler),rR=laya.net.Loader,rp=laya.maths.MathUtil,rXS=laya.maths.Matrix,rc=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),ro=(laya.renders.RenderContext,laya.resource.Resource),rJ=laya.utils.RunDriver,rdS=laya.display.Sprite,rL=laya.utils.Stat,rhS=laya.resource.Texture,rG=(laya.net.URL,laya.utils.Utils),rX=function(){function rS(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return rl(rS,"laya.ani.AnimationContent"),rS}(),rh=function(){function rS(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return rl(rS,"laya.ani.AnimationNodeContent"),rS}(),rA=function(){function rS(){}return rl(rS,"laya.ani.AnimationParser01"),rS.parse=function(rS,rQ){var re=rQ.__getBuffer(),rl=0,rM=0,rd=0,rT=0,rU=0,ri=0,rR=0,ro=rQ.readUTFString();rS._aniClassName=ro;var rY,rp=rQ.readUTFString().split("\n"),rJ=rQ.getUint8(),rL=rQ.getUint32(),rj=rQ.getUint32();0<rL&&(rY=re.slice(rL,rj));var rc=new rkS(rY);for(0<rj&&(rS._publicExtData=re.slice(rj,re.byteLength)),rS._useParent=!!rQ.getUint8(),rS._anis.length=rJ,rl=0;rl<rJ;rl++){var rG=rS._anis[rl]=new rX;rG.nodes=new Array;var rz=rG.name=rp[rQ.getUint16()];rS._aniMap[rz]=rl,rG.bone3DMap={},rG.playTime=rQ.getFloat32(),rG.playTime<=0&&console.error("播放时间不能为0  url="+rS.url+" name="+rG.name);var rA=rG.nodes.length=rQ.getUint8();for(rM=rG.totalKeyframeDatasLength=0;rM<rA;rM++){var rv=rG.nodes[rM]=new rh;rv.childs=[];var rD=rQ.getInt16();0<=rD&&(rv.name=rp[rD],rG.bone3DMap[rv.name]=rM),rv.keyFrame=new Array,rv.parentIndex=rQ.getInt16(),-1==rv.parentIndex?rv.parent=null:rv.parent=rG.nodes[rv.parentIndex],rv.lerpType=rQ.getUint8();var rB=rQ.getUint32();rc.pos=rB;var rO=rv.keyframeWidth=rc.getUint16();if(rG.totalKeyframeDatasLength+=rO,0===rv.lerpType||1===rv.lerpType)for(rv.interpolationMethod=[],rv.interpolationMethod.length=rO,rd=0;rd<rO;rd++)rv.interpolationMethod[rd]=r$.interpolation[rc.getUint8()];null!=rv.parent&&rv.parent.childs.push(rv);var rH=rQ.getUint16();0<rH&&(rv.extenData=re.slice(rQ.pos,rQ.pos+rH),rQ.pos+=rH);var rg,rI=rQ.getUint16(),rE=0;for(rd=0,rT=rv.keyFrame.length=rI;rd<rT;rd++){if((rg=rv.keyFrame[rd]=new rb).duration=rQ.getFloat32(),rg.startTime=rE,2===rv.lerpType){rg.interpolationData=[];var rt,rk=rQ.getUint8();switch(rt=rQ.getFloat32()){case 254:for(rg.interpolationData.length=rO,rR=0;rR<rO;rR++)rg.interpolationData[rR]=0;break;case 255:for(rg.interpolationData.length=rO,rR=0;rR<rO;rR++)rg.interpolationData[rR]=5;break;default:for(rg.interpolationData.push(rt),ri=1;ri<rk;ri++)rg.interpolationData.push(rQ.getFloat32())}}for(rg.data=new Float32Array(rO),rU=0;rU<rO;rU++)rg.data[rU]=rQ.getFloat32(),-1e-8<rg.data[rU]&&rg.data[rU]<1e-8&&(rg.data[rU]=0);rE+=rg.duration}rg.startTime=rG.playTime,rv.playTime=rG.playTime,rS._calculateKeyFrame(rv,rI,rO)}}},rS}(),rv=function(){function rD(){}return rl(rD,"laya.ani.AnimationParser02"),rD.READ_DATA=function(){rD._DATA.offset=rD._reader.getUint32(),rD._DATA.size=rD._reader.getUint32()},rD.READ_BLOCK=function(){for(var rS=rD._BLOCK.count=rD._reader.getUint16(),rQ=rD._BLOCK.blockStarts=[],re=rD._BLOCK.blockLengths=[],rl=0;rl<rS;rl++)rQ.push(rD._reader.getUint32()),re.push(rD._reader.getUint32())},rD.READ_STRINGS=function(){var rS=rD._reader.getUint32(),rQ=rD._reader.getUint16(),re=rD._reader.pos;rD._reader.pos=rS+rD._DATA.offset;for(var rl=0;rl<rQ;rl++)rD._strings[rl]=rD._reader.readUTFString();rD._reader.pos=re},rD.parse=function(rS,rQ){rD._templet=rS;(rD._reader=rQ).__getBuffer();rD.READ_DATA(),rD.READ_BLOCK(),rD.READ_STRINGS();for(var re=0,rl=rD._BLOCK.count;re<rl;re++){var rM=rQ.getUint16(),rd=rD._strings[rM],rT=rD["READ_"+rd];if(null==rT)throw new Error("model file err,no this function:"+rM+" "+rd);rT.call()}},rD.READ_ANIMATIONS=function(){var rS=rD._reader,rQ=rS.__getBuffer(),re=0,rl=0,rM=0,rd=0,rT=rS.getUint16(),rU=[];for(rU.length=rT,re=0;re<rT;re++)rU[re]=r$.interpolation[rS.getByte()];var ri=rS.getUint8();for(rD._templet._anis.length=ri,re=0;re<ri;re++){var rR=rD._templet._anis[re]={};rR.nodes=new Array;var ro=rR.name=rD._strings[rS.getUint16()];rD._templet._aniMap[ro]=re,rR.bone3DMap={},rR.playTime=rS.getFloat32();var rY=rR.nodes.length=rS.getInt16();for(rl=rR.totalKeyframeDatasLength=0;rl<rY;rl++){var rp=rR.nodes[rl]={};rp.keyframeWidth=rT,rp.childs=[];var rJ=rS.getUint16();0<=rJ&&(rp.name=rD._strings[rJ],rR.bone3DMap[rp.name]=rl),rp.keyFrame=new Array,rp.parentIndex=rS.getInt16(),-1==rp.parentIndex?rp.parent=null:rp.parent=rR.nodes[rp.parentIndex],rR.totalKeyframeDatasLength+=rT,rp.interpolationMethod=rU,null!=rp.parent&&rp.parent.childs.push(rp);var rL=rS.getUint16(),rj=null,rc=null;for(rM=0,rd=rp.keyFrame.length=rL;rM<rd;rM++){(rj=rp.keyFrame[rM]={}).startTime=rS.getFloat32(),rc&&(rc.duration=rj.startTime-rc.startTime);var rG=rD._DATA.offset,rz=rS.getUint32(),rA=4*rT,rv=rQ.slice(rG+rz,rG+rz+rA);rj.data=new Float32Array(rv),rc=rj}rj.duration=0,rp.playTime=rR.playTime,rD._templet._calculateKeyFrame(rp,rL,rT)}}},rD._templet=null,rD._reader=null,rD._strings=[],re(rD,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),rD}(),rbS=(function(){function rS(){}rl(rS,"laya.ani.AnimationState"),rS.stopped=0,rS.paused=1,rS.playing=2}(),function(){function rM(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new rqS,this.resultMatrix=new rXS,this._children=[]}rl(rM,"laya.ani.bone.Bone");var rS=rM.prototype;return rS.setTempMatrix=function(rS){this._tempMatrix=rS;var rQ,re=0;for(re=0,rQ=this._children.length;re<rQ;re++)this._children[re].setTempMatrix(this._tempMatrix)},rS.update=function(rS){var rQ;if(this.rotation=this.transform.skX,rS)rQ=this.resultTransform.getMatrix(),rXS.mul(rQ,rS,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)rQ=this.resultTransform.getMatrix(),rXS.mul(rQ,this.parentBone.resultMatrix,this.resultMatrix);else{var re=this.parentBone,rl=NaN,rM=NaN,rd=NaN,rT=this.parentBone.resultMatrix;rQ=this.resultTransform.getMatrix();var rU=rT.a*rQ.tx+rT.c*rQ.ty+rT.tx,ri=rT.b*rQ.tx+rT.d*rQ.ty+rT.ty,rR=new rXS;this.inheritRotation?(rl=Math.atan2(re.resultMatrix.b,re.resultMatrix.a),rM=Math.cos(rl),rd=Math.sin(rl),rR.setTo(rM,rd,-rd,rM,0,0),rXS.mul(this._tempMatrix,rR,rXS.TEMP),rXS.TEMP.copyTo(rR),rQ=this.resultTransform.getMatrix(),rXS.mul(rQ,rR,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,rQ=this.resultTransform.getMatrix(),rXS.TEMP.identity(),rXS.TEMP.d=this.d,rXS.mul(rQ,rXS.TEMP,this.resultMatrix)),this.resultMatrix.tx=rU,this.resultMatrix.ty=ri}else(rQ=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var ro,rY=0;for(rY=0,ro=this._children.length;rY<ro;rY++)this._children[rY].update()},rS.updateChild=function(){var rS,rQ=0;for(rQ=0,rS=this._children.length;rQ<rS;rQ++)this._children[rQ].update()},rS.setRotation=function(rS){this._sprite&&(this._sprite.rotation=180*rS/Math.PI)},rS.updateDraw=function(rS,rQ){rM.ShowBones&&!rM.ShowBones[this.name]||(this._sprite||(this._sprite=new rdS,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),rMS.stage.addChild(this._sprite)),this._sprite.x=rS+this.resultMatrix.tx,this._sprite.y=rQ+this.resultMatrix.ty);var re,rl=0;for(rl=0,re=this._children.length;rl<re;rl++)this._children[rl].updateDraw(rS,rQ)},rS.addChild=function(rS){this._children.push(rS),rS.parentBone=this},rS.findBone=function(rS){if(this.name==rS)return this;var rQ,re,rl=0;for(rl=0,rQ=this._children.length;rl<rQ;rl++)if(re=this._children[rl].findBone(rS))return re;return null},rS.localToWorld=function(rS){var rQ=rS[0],re=rS[1];rS[0]=rQ*this.resultMatrix.a+re*this.resultMatrix.c+this.resultMatrix.tx,rS[1]=rQ*this.resultMatrix.b+re*this.resultMatrix.d+this.resultMatrix.ty},rM.ShowBones={},rM}()),rmS=function(){function rj(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}rl(rj,"laya.ani.bone.BoneSlot");var rS=rj.prototype;return rS.showSlotData=function(rS,rQ){void 0===rQ&&(rQ=!0),this.currSlotData=rS,rQ&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},rS.showDisplayByName=function(rS){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(rS))},rS.replaceDisplayByName=function(rS,rQ){if(this.currSlotData){var re;re=this.currSlotData.getDisplayByName(rS);var rl;rl=this.currSlotData.getDisplayByName(rQ),this.replaceDisplayByIndex(re,rl)}},rS.replaceDisplayByIndex=function(rS,rQ){this.currSlotData&&(this._replaceDic[rS]=rQ,this.displayIndex==rS&&this.showDisplayByIndex(rS))},rS.showDisplayByIndex=function(rS){if(null!=this._replaceDic[rS]&&(rS=this._replaceDic[rS]),this.currSlotData&&-1<rS&&rS<this.currSlotData.displayArr.length){if(this.displayIndex=rS,this.currDisplayData=this.currSlotData.displayArr[rS],this.currDisplayData){var rQ=this.currDisplayData.name;this.currTexture=this.templet.getTexture(rQ),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!rc.isConchApp||rc.isConchApp&&"0.9.15"<rdS.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},rS.replaceSkin=function(rS){this._diyTexture=rS,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},rS.setParentMatrix=function(rS){this._parentMatrix=rS},rS.draw=function(rS,rQ,re,rl){if(void 0===re&&(re=!1),void 0===rl&&(rl=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var rM,rd=this.currTexture;switch(this._diyTexture&&(rd=this._diyTexture),this.currDisplayData.type){case 0:if(rS){var rT=this.getDisplayMatrix();if(this._parentMatrix){var rU=!1;if(rT){var ri;if(rXS.mul(rT,this._parentMatrix,rXS.TEMP),ri=re?(null==this._resultMatrix&&(this._resultMatrix=new rXS),this._resultMatrix):new rXS,!rc.isWebGL&&this.currDisplayData.uvs||rc.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var rR=rj._tempMatrix;rR.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(rR.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(rU=!0,rR.rotate(-Math.PI/2)),rXS.mul(rR,rXS.TEMP,ri)}else rXS.TEMP.copyTo(ri);rU?rS.drawTexture(rd,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,ri):rS.drawTexture(rd,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,ri)}}}break;case 1:if(null==(rM=re?(null==this._skinSprite&&(this._skinSprite=rj.createSkinMesh()),this._skinSprite):rj.createSkinMesh()))return;var ro;if(null==this.currDisplayData.bones){var rY,rp=this.currDisplayData.weights;this.deformData&&(rp=this.deformData),rY=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=rO.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=rO.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=rp;this.currDisplayData.triangles.length;ro=this.currDisplayData.triangles,rM.init2(rd,null,ro,this._mVerticleArr,rY);var rJ,rL=this.getDisplayMatrix();if(this._parentMatrix)if(rL)rXS.mul(rL,this._parentMatrix,rXS.TEMP),rJ=re?(null==this._resultMatrix&&(this._resultMatrix=new rXS),this._resultMatrix):new rXS,rXS.TEMP.copyTo(rJ),rM.transform=rJ}else this.skinMesh(rQ,rM,rl);rS.drawSkin(rM);break;case 2:if(null==(rM=re?(null==this._skinSprite&&(this._skinSprite=rj.createSkinMesh()),this._skinSprite):rj.createSkinMesh()))return;this.skinMesh(rQ,rM,rl),rS.drawSkin(rM)}}},rS.skinMesh=function(rS,rQ,re){var rl,rM=this.currTexture,rd=this.currDisplayData.bones;rl=this._diyTexture?(rM=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=rO.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=rO.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var rT,rU,ri=this.currDisplayData.weights,rR=this.currDisplayData.triangles,ro=0,rY=0,rp=0,rJ=NaN,rL=NaN,rj=0,rc=0,rG=[],rz=0,rA=0;if(this.deformData&&0<this.deformData.length){var rv=0;for(rz=0,rA=rd.length;rz<rA;){for(rp=rd[rz++]+rz,rY=ro=0;rz<rp;rz++)rU=rS[rd[rz]],rJ=ri[rj]+this.deformData[rv++],rL=ri[rj+1]+this.deformData[rv++],rc=ri[rj+2],ro+=(rJ*rU.a+rL*rU.c+rU.tx)*rc,rY+=(rJ*rU.b+rL*rU.d+rU.ty)*rc,rj+=3;rG.push(ro,rY)}}else for(rz=0,rA=rd.length;rz<rA;){for(rp=rd[rz++]+rz,rY=ro=0;rz<rp;rz++)rU=rS[rd[rz]],rJ=ri[rj],rL=ri[rj+1],rc=ri[rj+2],ro+=(rJ*rU.a+rL*rU.c+rU.tx)*rc,rY+=(rJ*rU.b+rL*rU.d+rU.ty)*rc,rj+=3;rG.push(ro,rY)}this._mVerticleArr=rG,rT=rR,rQ.init2(rM,null,rT,this._mVerticleArr,rl)},rS.drawBonePoint=function(rS){rS&&this._parentMatrix&&rS.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},rS.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},rS.getMatrix=function(){return this._resultMatrix},rS.copy=function(){var rS=new rj;return rS.type="copy",rS.name=this.name,rS.attachmentName=this.attachmentName,rS.srcDisplayIndex=this.srcDisplayIndex,rS.parent=this.parent,rS.displayIndex=this.displayIndex,rS.templet=this.templet,rS.currSlotData=this.currSlotData,rS.currTexture=this.currTexture,rS.currDisplayData=this.currDisplayData,rS},rj.createSkinMesh=function(){return rc.isWebGL||rc.isConchApp?rJ.skinAniSprite():(rc.isWebGL,null)},re(rj,["_tempMatrix",function(){return this._tempMatrix=new rXS}]),rj}(),r$S=function(){function rS(){this.skinName=null,this.deformSlotDataList=[]}return rl(rS,"laya.ani.bone.DeformAniData"),rS}(),rnS=function(){function rS(){this.deformSlotDisplayList=[]}return rl(rS,"laya.ani.bone.DeformSlotData"),rS}(),rPS=function(){function rS(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}rl(rS,"laya.ani.bone.DeformSlotDisplayData");var rQ=rS.prototype;return rQ.binarySearch1=function(rS,rQ){var re=0,rl=rS.length-2;if(0==rl)return 1;for(var rM=rl>>>1;;){if(rS[Math.floor(rM+1)]<=rQ?re=rM+1:rl=rM,re==rl)return re+1;rM=re+rl>>>1}return 0},rQ.apply=function(rS,rQ,re){if(void 0===re&&(re=1),rS+=.05,!(this.timeList.length<=0)){var rl=0;if(!(rS<this.timeList[0])){var rM=this.vectices[0].length,rd=[],rT=this.binarySearch1(this.timeList,rS);if(this.frameIndex=rT,rS>=this.timeList[this.timeList.length-1]){var rU=this.vectices[this.vectices.length-1];if(re<1)for(rl=0;rl<rM;rl++)rd[rl]+=(rU[rl]-rd[rl])*re;else for(rl=0;rl<rM;rl++)rd[rl]=rU[rl];this.deformData=rd}else{this.tweenKeyList[this.frameIndex];var ri=this.vectices[this.frameIndex-1],rR=this.vectices[this.frameIndex],ro=this.timeList[this.frameIndex-1],rY=this.timeList[this.frameIndex];re=this.tweenKeyList[rT-1]?(rS-ro)/(rY-ro):0;var rp=NaN;for(rl=0;rl<rM;rl++)rp=ri[rl],rd[rl]=rp+(rR[rl]-rp)*re;this.deformData=rd}}}},rS}(),raS=function(){function rS(){this.time=NaN,this.drawOrder=[]}return rl(rS,"laya.ani.bone.DrawOrderData"),rS}(),rfS=function(){function rS(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return rl(rS,"laya.ani.bone.EventData"),rS}(),rz=function(){function rlS(rS,rQ){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=rS,this._targetBone=rQ[rS.targetBoneIndex],this.isSpine=rS.isSpine,null==this._bones&&(this._bones=[]);for(var re=this._bones.length=0,rl=rS.boneIndexs.length;re<rl;re++)this._bones.push(rQ[rS.boneIndexs[re]]);this.name=rS.name,this.mix=rS.mix,this.bendDirection=rS.bendDirection}rl(rlS,"laya.ani.bone.IkConstraint");var rS=rlS.prototype;return rS.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},rS._applyIk1=function(rS,rQ,re,rl){var rM=rS.parentBone,rd=1/(rM.resultMatrix.a*rM.resultMatrix.d-rM.resultMatrix.b*rM.resultMatrix.c),rT=rQ-rM.resultMatrix.tx,rU=re-rM.resultMatrix.ty,ri=(rT*rM.resultMatrix.d-rU*rM.resultMatrix.c)*rd-rS.transform.x,rR=(rU*rM.resultMatrix.a-rT*rM.resultMatrix.b)*rd-rS.transform.y,ro=Math.atan2(rR,ri)*rlS.radDeg-0-rS.transform.skX;rS.transform.scX<0&&(ro+=180),180<ro?ro-=360:ro<-180&&(ro+=360),rS.transform.skX=rS.transform.skY=rS.transform.skX+ro*rl,rS.update()},rS.updatePos=function(rS,rQ){this._sp&&this._sp.pos(rS,rQ)},rS._applyIk2=function(rS,rQ,re,rl,rM,rd){if(0!=rd){var rT=rS.resultTransform.x,rU=rS.resultTransform.y,ri=rS.transform.scX,rR=rS.transform.scY,ro=rQ.transform.scX,rY=0,rp=0,rJ=0;rJ=ri<0?(ri=-ri,rY=180,-1):(rY=0,1),rR<0&&(rR=-rR,rJ=-rJ),rp=ro<0?(ro=-ro,180):0;var rL=rQ.resultTransform.x,rj=NaN,rc=NaN,rG=NaN,rz=rS.resultMatrix.a,rA=rS.resultMatrix.c,rv=rS.resultMatrix.b,rD=rS.resultMatrix.d,rB=Math.abs(ri-rR)<=1e-4;rG=rB?(rc=rz*rL+rA*(rj=rQ.resultTransform.y)+rS.resultMatrix.tx,rv*rL+rD*rj+rS.resultMatrix.ty):(rj=0,rc=rz*rL+rS.resultMatrix.tx,rv*rL+rS.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new rdS,rMS.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(re,rl,15,"#ffff00"),this._sp.graphics.drawCircle(rc,rG,15,"#ff00ff")),rS.setRotation(Math.atan2(rG-rS.resultMatrix.ty,rc-rS.resultMatrix.tx));var rO=rS.parentBone;rz=rO.resultMatrix.a,rA=rO.resultMatrix.c,rv=rO.resultMatrix.b;var rH=1/(rz*(rD=rO.resultMatrix.d)-rA*rv),rg=re-rO.resultMatrix.tx,rI=rl-rO.resultMatrix.ty,rE=(rg*rD-rI*rA)*rH-rT,rt=(rI*rz-rg*rv)*rH-rU,rk=((rg=rc-rO.resultMatrix.tx)*rD-(rI=rG-rO.resultMatrix.ty)*rA)*rH-rT,rX=(rI*rz-rg*rv)*rH-rU,rh=Math.sqrt(rk*rk+rX*rX),rb=rQ.length*ro,rm=NaN,r$=NaN;if(rB){var rn=(rE*rE+rt*rt-rh*rh-(rb*=ri)*rb)/(2*rh*rb);rn<-1?rn=-1:1<rn&&(rn=1),r$=Math.acos(rn)*rM,rz=rh+rb*rn,rA=rb*Math.sin(r$),rm=Math.atan2(rt*rz-rE*rA,rE*rz+rt*rA)}else{var rP=(rz=ri*rb)*rz,ra=(rA=rR*rb)*rA,rf=rE*rE+rt*rt,rw=Math.atan2(rt,rE),ru=-2*ra*rh,rr=ra-rP;if(0<(rD=ru*ru-4*rr*(rv=ra*rh*rh+rP*rf-rP*ra))){var rW=Math.sqrt(rD);ru<0&&(rW=-rW);var rx=(rW=-(ru+rW)/2)/rr,rF=rv/rW,rq=Math.abs(rx)<Math.abs(rF)?rx:rF;rq*rq<=rf&&(rI=Math.sqrt(rf-rq*rq)*rM,rm=rw-Math.atan2(rI,rq),r$=Math.atan2(rI/rR,(rq-rh)/ri))}var rZ=0,rN=Number.MAX_VALUE,rC=0,rK=0,rV=0,r_=0,rs=0,ry=0;r_<(rD=(rg=rh+rz)*rg)&&(rV=0,r_=rD,rs=rg),(rD=(rg=rh-rz)*rg)<rN&&(rZ=Math.PI,rN=rD,rC=rg);var rSS=Math.acos(-rz*rh/(rP-ra));(rD=(rg=rz*Math.cos(rSS)+rh)*rg+(rI=rA*Math.sin(rSS))*rI)<rN&&(rZ=rSS,rN=rD,rC=rg,rK=rI),r_<rD&&(rV=rSS,r_=rD,rs=rg,ry=rI),r$=rf<=(rN+r_)/2?(rm=rw-Math.atan2(rK*rM,rC),rZ*rM):(rm=rw-Math.atan2(ry*rM,rs),rV*rM)}var rQS=Math.atan2(rj,rL)*rJ,reS=rS.resultTransform.skX;180<(rm=(rm-rQS)*rlS.radDeg+rY-reS)?rm-=360:rm<-180&&(rm+=360),rS.resultTransform.x=rT,rS.resultTransform.y=rU,rS.resultTransform.skX=rS.resultTransform.skY=reS+rm*rd,reS=rQ.resultTransform.skX,180<(r$=((r$+rQS)*rlS.radDeg-0)*rJ+rp-(reS%=360))?r$-=360:r$<-180&&(r$+=360),rQ.resultTransform.x=rL,rQ.resultTransform.y=rj,rQ.resultTransform.skX=rQ.resultTransform.skY=rQ.resultTransform.skY+r$*rd,rS.update()}},rS._applyIk3=function(rS,rQ,re,rl,rM,rd){if(0!=rd){var rT,rU,ri=rQ.resultMatrix.a*rQ.length,rR=rQ.resultMatrix.b*rQ.length,ro=ri*ri+rR*rR,rY=Math.sqrt(ro),rp=rS.resultMatrix.tx,rJ=rS.resultMatrix.ty,rL=rQ.resultMatrix.tx,rj=rQ.resultMatrix.ty,rc=rL-rp,rG=rj-rJ,rz=rc*rc+rG*rG,rA=Math.sqrt(rz),rv=(rc=re-rS.resultMatrix.tx)*rc+(rG=rl-rS.resultMatrix.ty)*rG,rD=Math.sqrt(rv);if(rY+rA<=rD||rD+rY<=rA||rD+rA<=rY){var rB=NaN;rL=rp+(rB=rY+rA<=rD?1:-1)*(re-rp)*rA/rD,rj=rJ+rB*(rl-rJ)*rA/rD}else{var rO=(rz-ro+rv)/(2*rv),rH=Math.sqrt(rz-rO*rO*rv)/rD,rg=rp+rc*rO,rI=rJ+rG*rO,rE=-rG*rH,rt=rc*rH;rj=0<rM?(rL=rg-rE,rI-rt):(rL=rg+rE,rI+rt)}rT=rL,rU=rj,this.isDebug&&(this._sp||(this._sp=new rdS,rMS.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(rp,rJ,15,"#ff00ff"),this._sp.graphics.drawCircle(re,rl,15,"#ffff00"),this._sp.graphics.drawCircle(rT,rU,15,"#ff00ff"));var rk,rX;rk=Math.atan2(rU-rS.resultMatrix.ty,rT-rS.resultMatrix.tx),rS.setRotation(rk),(rX=rlS._tempMatrix).identity(),rX.rotate(rk),rX.scale(rS.resultMatrix.getScaleX(),rS.resultMatrix.getScaleY()),rX.translate(rS.resultMatrix.tx,rS.resultMatrix.ty),rX.copyTo(rS.resultMatrix),rS.updateChild();var rh,rb;rh=Math.atan2(rl-rU,re-rT),rQ.setRotation(rh),(rb=rlS._tempMatrix).identity(),rb.rotate(rh),rb.scale(rQ.resultMatrix.getScaleX(),rQ.resultMatrix.getScaleY()),rb.translate(rT,rU),rX.copyTo(rQ.resultMatrix),rQ.updateChild()}},re(rlS,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new rXS}]),rlS}(),rwS=function(){function rS(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return rl(rS,"laya.ani.bone.IkConstraintData"),rS}(),rD=function(){function rb(rS,rQ){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=rS,this.position=rS.position,this.spacing=rS.spacing,this.rotateMix=rS.rotateMix,this.translateMix=rS.translateMix,this.bones=[];for(var re=this.data.bones,rl=0,rM=re.length;rl<rM;rl++)this.bones.push(rQ[re[rl]])}rl(rb,"laya.ani.bone.PathConstraint");var rS=rb.prototype;return rS.apply=function(rS,rQ){if(this.target){var re=this.translateMix,rl=this.translateMix,rM=0<rl,rd=this.data.spacingMode,rT="length"==rd,rU=this.data.rotateMode,ri="tangent"==rU,rR="chainScale"==rU,ro=[],rY=this.bones.length,rp=ri?rY:rY+1,rJ=[];(this._spaces=rJ)[0]=this.position;var rL=this.spacing;if(rR||rT)for(var rj=0,rc=rp-1;rj<rc;){var rG=this.bones[rj],rz=rG.length,rA=rz*rG.resultMatrix.a,rv=rz*rG.resultMatrix.b;rz=Math.sqrt(rA*rA+rv*rv),rR&&(ro[rj]=rz),rJ[++rj]=rT?Math.max(0,rz+rL):rL}else for(rj=1;rj<rp;rj++)rJ[rj]=rL;var rD=this.computeWorldPositions(this.target,rS,rQ,rp,ri,"percent"==this.data.positionMode,"percent"==rd);if(this._debugKey){for(rj=0;rj<rD.length;rj++)rQ.drawCircle(rD[rj++],rD[rj++],5,"#00ff00");var rB=[];for(rj=0;rj<rD.length;rj++)rB.push(rD[rj++],rD[rj++]);rQ.drawLines(0,0,rB,"#ff0000")}var rO=rD[0],rH=rD[1],rg=this.data.offsetRotation,rI="chain"==rU&&0==rg,rE=NaN;for(rj=0,rE=3;rj<rY;rj++,rE+=3){(rG=this.bones[rj]).resultMatrix.tx+=(rO-rG.resultMatrix.tx)*re,rG.resultMatrix.ty+=(rH-rG.resultMatrix.ty)*re;var rt=(rA=rD[rE])-rO,rk=(rv=rD[rE+1])-rH;if(rR&&0!=(rz=ro[rj])){var rX=(Math.sqrt(rt*rt+rk*rk)/rz-1)*rl+1;rG.resultMatrix.a*=rX,rG.resultMatrix.c*=rX}if(rO=rA,rH=rv,rM){var rh=rG.resultMatrix.a,rb=rG.resultMatrix.c,rm=rG.resultMatrix.b,r$=rG.resultMatrix.d,rn=NaN,rP=NaN,ra=NaN;rn=ri?rD[rE-1]:0==rJ[rj+1]?rD[rE+2]:Math.atan2(rk,rt),rn-=Math.atan2(rm,rh)-rg/180*Math.PI,rI&&(rP=Math.cos(rn),ra=Math.sin(rn),rO+=((rz=rG.length)*(rP*rh-ra*rm)-rt)*rl,rH+=(rz*(ra*rh+rP*rm)-rk)*rl),rn>Math.PI?rn-=2*Math.PI:rn<-Math.PI&&(rn+=2*Math.PI),rn*=rl,rP=Math.cos(rn),ra=Math.sin(rn),rG.resultMatrix.a=rP*rh-ra*rm,rG.resultMatrix.c=rP*rb-ra*r$,rG.resultMatrix.b=ra*rh+rP*rm,rG.resultMatrix.d=ra*rb+rP*r$}}}},rS.computeWorldVertices2=function(rS,rQ,re,rl,rM,rd){var rT,rU,ri=rS.currDisplayData.bones,rR=rS.currDisplayData.weights,ro=rS.currDisplayData.triangles,rY=0,rp=0,rJ=0,rL=0,rj=0,rc=0,rG=0,rz=0,rA=0,rv=0,rD=0;if(null!=ri){for(rY=0;rY<re;rY+=2)rp+=(rL=ri[rp])+1,rJ+=rL;var rB=rQ;for(rj=rd,rc=3*rJ;rj<rl;rj+=2){for(rz=rG=0,rL=ri[rp++],rL+=rp;rp<rL;rp++,rc+=3){rT=rB[ri[rp]].resultMatrix,rA=rR[rc],rv=rR[rc+1];var rO=rR[rc+2];rG+=(rA*rT.a+rv*rT.c+rT.tx)*rO,rz+=(rA*rT.b+rv*rT.d+rT.ty)*rO}rM[rj]=rG,rM[rj+1]=rz}}else{var rH,rg;if(ro||(ro=rR),rS.deformData&&(ro=rS.deformData),rH=rS.parent,rQ)for(rD=rQ.length,rY=0;rY<rD;rY++)if(rQ[rY].name==rH){rU=rQ[rY];break}rU&&(rg=rU.resultMatrix),rg||(rg=rb._tempMt);var rI=rg.tx,rE=rg.ty,rt=rg.a,rk=rg.b,rX=rg.c,rh=rg.d;for(rU&&(rh*=rU.d),rp=re,rj=rd;rj<rl;rp+=2,rj+=2)rA=ro[rp],rv=ro[rp+1],rM[rj]=rA*rt+rv*rk+rI,rM[rj+1]=-(rA*rX+rv*rh+rE)}},rS.computeWorldPositions=function(rS,rQ,re,rl,rM,rd,rT){rS.currDisplayData.bones,rS.currDisplayData.weights,rS.currDisplayData.triangles;var rU=[],ri=0,rR=rS.currDisplayData.verLen,ro=this.position,rY=this._spaces,rp=[],rJ=[],rL=rR/6,rj=-1,rc=NaN,rG=0,rz=0,rA=NaN,rv=NaN,rD=NaN,rB=NaN;if(rL--,rR-=4,this.computeWorldVertices2(rS,rQ,2,rR,rU,0),this._debugKey)for(ri=0;ri<rU.length;)re.drawCircle(rU[ri++],rU[ri++],10,"#ff0000");rp=rU,this._curves.length=rL;var rO=this._curves,rH=rp[rc=0],rg=rp[1],rI=0,rE=0,rt=0,rk=0,rX=0,rh=0,rb=NaN,rm=NaN,r$=NaN,rn=NaN,rP=NaN,ra=NaN,rf=NaN,rw=NaN,ru=0;for(ri=0,ru=2;ri<rL;ri++,ru+=6)rI=rp[ru],rE=rp[ru+1],rt=rp[ru+2],rk=rp[ru+3],rP=2*(rb=.1875*(rH-2*rI+rt))+(r$=.09375*(3*(rI-rt)-rH+(rX=rp[ru+4]))),ra=2*(rm=.1875*(rg-2*rE+rk))+(rn=.09375*(3*(rE-rk)-rg+(rh=rp[ru+5]))),rf=.75*(rI-rH)+rb+.16666667*r$,rw=.75*(rE-rg)+rm+.16666667*rn,rc+=Math.sqrt(rf*rf+rw*rw),rf+=rP,rw+=ra,rP+=r$,ra+=rn,rc+=Math.sqrt(rf*rf+rw*rw),rf+=rP,rw+=ra,rc+=Math.sqrt(rf*rf+rw*rw),rf+=rP+r$,rw+=ra+rn,rc+=Math.sqrt(rf*rf+rw*rw),rO[ri]=rc,rH=rX,rg=rh;if(rd&&(ro*=rc),rT)for(ri=0;ri<rl;ri++)rY[ri]*=rc;var rr=this._segments,rW=0,rx=0;for(rx=rz=rG=ri=0;ri<rl;ri++,rG+=3)if((rA=ro+=rv=rY[ri])<0)this.addBeforePosition(rA,rp,0,rJ,rG);else if(rc<rA)this.addAfterPosition(rA-rc,rp,rR-4,rJ,rG);else{for(;;rz++)if(!((rB=rO[rz])<rA)){0==rz?rA/=rB:rA=(rA-(rD=rO[rz-1]))/(rB-rD);break}if(rz!=rj){var rF=6*(rj=rz);for(rH=rp[rF],rg=rp[rF+1],rI=rp[rF+2],rE=rp[rF+3],rt=rp[rF+4],rk=rp[rF+5],rP=2*(rb=.03*(rH-2*rI+rt))+(r$=.006*(3*(rI-rt)-rH+(rX=rp[rF+6]))),ra=2*(rm=.03*(rg-2*rE+rk))+(rn=.006*(3*(rE-rk)-rg+(rh=rp[rF+7]))),rf=.3*(rI-rH)+rb+.16666667*r$,rw=.3*(rE-rg)+rm+.16666667*rn,rW=Math.sqrt(rf*rf+rw*rw),rr[0]=rW,rF=1;rF<8;rF++)rf+=rP,rw+=ra,rP+=r$,ra+=rn,rW+=Math.sqrt(rf*rf+rw*rw),rr[rF]=rW;rf+=rP,rw+=ra,rW+=Math.sqrt(rf*rf+rw*rw),rr[8]=rW,rf+=rP+r$,rw+=ra+rn,rW+=Math.sqrt(rf*rf+rw*rw),rr[9]=rW,rx=0}for(rA*=rW;;rx++)if(!((rB=rr[rx])<rA)){0==rx?rA/=rB:rA=rx+(rA-(rD=rr[rx-1]))/(rB-rD);break}this.addCurvePosition(.1*rA,rH,rg,rI,rE,rt,rk,rX,rh,rJ,rG,rM||0<ri&&0==rv)}return rJ},rS.addBeforePosition=function(rS,rQ,re,rl,rM){var rd=rQ[re],rT=rQ[re+1],rU=rQ[re+2]-rd,ri=rQ[re+3]-rT,rR=Math.atan2(ri,rU);rl[rM]=rd+rS*Math.cos(rR),rl[rM+1]=rT+rS*Math.sin(rR),rl[rM+2]=rR},rS.addAfterPosition=function(rS,rQ,re,rl,rM){var rd=rQ[re+2],rT=rQ[re+3],rU=rd-rQ[re],ri=rT-rQ[re+1],rR=Math.atan2(ri,rU);rl[rM]=rd+rS*Math.cos(rR),rl[rM+1]=rT+rS*Math.sin(rR),rl[rM+2]=rR},rS.addCurvePosition=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro,rY){0==rS&&(rS=1e-4);var rp=rS*rS,rJ=rp*rS,rL=1-rS,rj=rL*rL,rc=rj*rL,rG=rL*rS,rz=3*rG,rA=rL*rz,rv=rz*rS,rD=rQ*rc+rl*rA+rd*rv+rU*rJ,rB=re*rc+rM*rA+rT*rv+ri*rJ;rR[ro]=rD,rR[ro+1]=rB,rR[ro+2]=rY?Math.atan2(rB-(re*rj+rM*rG*2+rT*rp),rD-(rQ*rj+rl*rG*2+rd*rp)):0},rb.NONE=-1,rb.BEFORE=-2,rb.AFTER=-3,re(rb,["_tempMt",function(){return this._tempMt=new rXS}]),rb}(),ruS=function(){function rS(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return rl(rS,"laya.ani.bone.PathConstraintData"),rS}(),rrS=function(){function rS(){this.name=null,this.slotArr=[]}return rl(rS,"laya.ani.bone.SkinData"),rS}(),rWS=function(){function rS(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}rl(rS,"laya.ani.bone.SkinSlotDisplayData");var rQ=rS.prototype;return rQ.createTexture=function(rS){return this.texture||(this.texture=new rhS(rS.bitmap,this.uvs),rS.bitmap.alphaTexture&&(this.texture.alphaTexture=new rhS(rS.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=rS.height,this.texture.height=rS.width,this.texture.offsetX=-rS.offsetX,this.texture.offsetY=-rS.offsetY,this.texture.sourceWidth=rS.sourceHeight,this.texture.sourceHeight=rS.sourceWidth):(this.texture.width=rS.width,this.texture.height=rS.height,this.texture.offsetX=-rS.offsetX,this.texture.offsetY=-rS.offsetY,this.texture.sourceWidth=rS.sourceWidth,this.texture.sourceHeight=rS.sourceHeight),rc.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},rQ.destory=function(){this.texture&&this.texture.destroy()},rS}(),rxS=function(){function rS(){this.name=null,this.displayArr=[]}return rl(rS,"laya.ani.bone.SlotData"),rS.prototype.getDisplayByName=function(rS){for(var rQ=0,re=this.displayArr.length;rQ<re;rQ++)if(this.displayArr[rQ].attachmentName==rS)return rQ;return-1},rS}(),rB=function(){function rS(rS,rQ){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=rj(2,0),this._data=rS,null==this._bones&&(this._bones=[]),this.target=rQ[rS.targetIndex];var re,rl=0;for(rl=0,re=rS.boneIndexs.length;rl<re;rl++)this._bones.push(rQ[rS.boneIndexs[rl]]);this.rotateMix=rS.rotateMix,this.translateMix=rS.translateMix,this.scaleMix=rS.scaleMix,this.shearMix=rS.shearMix}return rl(rS,"laya.ani.bone.TfConstraint"),rS.prototype.apply=function(){for(var rS,rQ=this.target.resultMatrix.a,re=this.target.resultMatrix.b,rl=this.target.resultMatrix.c,rM=this.target.resultMatrix.d,rd=0,rT=this._bones.length;rd<rT;rd++){if(rS=this._bones[rd],0<this.rotateMix){var rU=rS.resultMatrix.a,ri=rS.resultMatrix.b,rR=rS.resultMatrix.c,ro=rS.resultMatrix.d,rY=Math.atan2(rl,rQ)-Math.atan2(rR,rU)+this._data.offsetRotation*Math.PI/180;rY>Math.PI?rY-=2*Math.PI:rY<-Math.PI&&(rY+=2*Math.PI),rY*=this.rotateMix;var rp=Math.cos(rY),rJ=Math.sin(rY);rS.resultMatrix.a=rp*rU-rJ*rR,rS.resultMatrix.b=rp*ri-rJ*ro,rS.resultMatrix.c=rJ*rU+rp*rR,rS.resultMatrix.d=rJ*ri+rp*ro}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),rS.resultMatrix.tx+=(this._temp[0]-rS.resultMatrix.tx)*this.translateMix,rS.resultMatrix.ty+=(this._temp[1]-rS.resultMatrix.ty)*this.translateMix,rS.updateChild()),0<this.scaleMix){var rL=Math.sqrt(rS.resultMatrix.a*rS.resultMatrix.a+rS.resultMatrix.c*rS.resultMatrix.c),rj=Math.sqrt(rQ*rQ+rl*rl),rc=1e-5<rL?(rL+(rj-rL+this._data.offsetScaleX)*this.scaleMix)/rL:0;rS.resultMatrix.a*=rc,rS.resultMatrix.c*=rc,rL=Math.sqrt(rS.resultMatrix.b*rS.resultMatrix.b+rS.resultMatrix.d*rS.resultMatrix.d),rj=Math.sqrt(re*re+rM*rM),rc=1e-5<rL?(rL+(rj-rL+this._data.offsetScaleY)*this.scaleMix)/rL:0,rS.resultMatrix.b*=rc,rS.resultMatrix.d*=rc}if(0<this.shearMix){ri=rS.resultMatrix.b,ro=rS.resultMatrix.d;var rG=Math.atan2(ro,ri);(rY=Math.atan2(rM,re)-Math.atan2(rl,rQ)-(rG-Math.atan2(rS.resultMatrix.c,rS.resultMatrix.a)))>Math.PI?rY-=2*Math.PI:rY<-Math.PI&&(rY+=2*Math.PI),rY=rG+(rY+this._data.offsetShearY*Math.PI/180)*this.shearMix,rc=Math.sqrt(ri*ri+ro*ro),rS.resultMatrix.b=Math.cos(rY)*rc,rS.resultMatrix.d=Math.sin(rY)*rc}}},rS}(),rFS=function(){function rS(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return rl(rS,"laya.ani.bone.TfConstraintData"),rS}(),rqS=function(){function rS(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}rl(rS,"laya.ani.bone.Transform");var rQ=rS.prototype;return rQ.initData=function(rS){null!=rS.x&&(this.x=rS.x),null!=rS.y&&(this.y=rS.y),null!=rS.skX&&(this.skX=rS.skX),null!=rS.skY&&(this.skY=rS.skY),null!=rS.scX&&(this.scX=rS.scX),null!=rS.scY&&(this.scY=rS.scY)},rQ.getMatrix=function(){var rS;return(rS=this.mMatrix?this.mMatrix:this.mMatrix=new rXS).identity(),rS.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(rS,this.skewX*Math.PI/180,this.skewY*Math.PI/180),rS.rotate(this.skX*Math.PI/180),rS.translate(this.x,this.y),rS},rQ.skew=function(rS,rQ,re){var rl=Math.sin(re),rM=Math.cos(re),rd=Math.sin(rQ),rT=Math.cos(rQ);return rS.setTo(rS.a*rT-rS.b*rl,rS.a*rd+rS.b*rM,rS.c*rT-rS.d*rl,rS.c*rd+rS.d*rM,rS.tx*rT-rS.ty*rl,rS.tx*rd+rS.ty*rM),rS},rS}(),rO=function(){function rS(){}return rl(rS,"laya.ani.bone.UVTools"),rS.getRelativeUV=function(rS,rQ,re){var rl=rS[0],rM=rS[2]-rS[0],rd=rS[1],rT=rS[5]-rS[1];re||(re=[]),re.length=rQ.length;var rU,ri=0;rU=re.length;var rR=1/rM,ro=1/rT;for(ri=0;ri<rU;ri+=2)re[ri]=(rQ[ri]-rl)*rR,re[ri+1]=(rQ[ri+1]-rd)*ro;return re},rS.getAbsoluteUV=function(rS,rQ,re){if(0==rS[0]&&0==rS[1]&&1==rS[4]&&1==rS[5])return re?(rG.copyArray(re,rQ),re):rQ;var rl=rS[0],rM=rS[2]-rS[0],rd=rS[1],rT=rS[5]-rS[1];re||(re=[]),re.length=rQ.length;var rU,ri=0;for(rU=re.length,ri=0;ri<rU;ri+=2)re[ri]=rQ[ri]*rM+rl,re[ri+1]=rQ[ri+1]*rT+rd;return re},rS}(),rb=function(){function rS(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return rl(rS,"laya.ani.KeyFramesContent"),rS}(),rH=function(){function ro(){}return rl(ro,"laya.ani.math.BezierLerp"),ro.getBezierRate=function(rS,rQ,re,rl,rM){var rd=ro._getBezierParamKey(rQ,re,rl,rM),rT=100*rd+rS;if(ro._bezierResultCache[rT])return ro._bezierResultCache[rT];var rU,ri=ro._getBezierPoints(rQ,re,rl,rM,rd),rR=0;for(rU=ri.length,rR=0;rR<rU;rR+=2)if(rS<=ri[rR])return ro._bezierResultCache[rT]=ri[rR+1],ri[rR+1];return ro._bezierResultCache[rT]=1},ro._getBezierParamKey=function(rS,rQ,re,rl){return 100*(100*(100*(100*rS+rQ)+re)+rl)},ro._getBezierPoints=function(rS,rQ,re,rl,rM){return ro._bezierPointsCache[rM]?ro._bezierPointsCache[rM]:(rd=[0,0,rS,rQ,re,rl,1,1],rT=(new rU).getBezierPoints(rd,100,3),ro._bezierPointsCache[rM]=rT);var rd,rT},ro._bezierResultCache={},ro._bezierPointsCache={},ro}(),rg=function(rS){function rQ(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,rQ.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}rl(rQ,"laya.ani.AnimationPlayer",rM);var re=rQ.prototype;return rMS.imps(re,{"laya.resource.IDestroy":!0}),re._onTempletLoadedComputeFullKeyframeIndices=function(rS,rQ,re){this._templet===re&&this._cachePlayRate===rS&&this._cacheFrameRate===rQ&&this._computeFullKeyframeIndices()},re._computeFullKeyframeIndices=function(){for(var rS=this._fullFrames=[],rQ=this._templet,re=this._cacheFrameRateInterval*this._cachePlayRate,rl=0,rM=rQ.getAnimationCount();rl<rM;rl++){for(var rd=[],rT=0,rU=rQ.getAnimation(rl).nodes.length;rT<rU;rT++){for(var ri=rQ.getAnimation(rl).nodes[rT],rR=Math.floor(ri.playTime/re+.01),ro=new Uint16Array(rR+1),rY=-1,rp=0,rJ=ri.keyFrame.length;rp<rJ;rp++){var rL=ri.keyFrame[rp],rj=rL.startTime,rc=rj+rL.duration+re;do{for(var rG=Math.floor(rj/re+.5),rz=rY+1;rz<rG;rz++)ro[rz]=rp;ro[rY=rG]=rp,rj+=re}while(rj<=rc)}rd.push(ro)}rS.push(rd)}},re._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},re._calculatePlayDuration=function(){if(0!==this.state){var rS=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=rS),this._playEnd>rS&&(this._playEnd=rS),this._playDuration=this._playEnd-this._playStart}},re._setPlayParams=function(rS,rQ){this._currentTime=rS,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/rQ+.01),0),this._currentFrameTime=this._currentKeyframeIndex*rQ},re._setPlayParamsWhenStop=function(rS,rQ){this._currentTime=rS,this._currentKeyframeIndex=Math.max(Math.floor(rS/rQ+.01),0),this._currentFrameTime=this._currentKeyframeIndex*rQ,this._currentAnimationClipIndex=-1},re._update=function(rS){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var rQ=this._cacheFrameRateInterval*this._cachePlayRate,re=0;this._startUpdateLoopCount!==rL.loopCount&&(re=rS*this.playbackRate,this._elapsedPlaybackTime+=re);var rl=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=rl)return this._setPlayParamsWhenStop(rl,rQ),void this.event("stopped");if(re+=this._currentTime,0<rl)if(rl<=re)do{if(re-=rl,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(rl,rQ),this._stopWhenCircleFinish=!1,void this.event("stopped");re<rl&&(this._setPlayParams(re,rQ),this.event("complete"))}while(rl<=re);else this._setPlayParams(re,rQ);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(rl,rQ),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},re._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},re.play=function(rS,rQ,re,rl,rM){if(void 0===rS&&(rS=0),void 0===rQ&&(rQ=1),void 0===re&&(re=2147483647),void 0===rl&&(rl=0),void 0===rM&&(rM=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(re<0||rl<0||rM<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==rM&&rM<rl)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=rQ,this._overallDuration=re,this._playStart=rl,this._playEnd=rM,this._paused=!1,this._currentAnimationClipIndex=rS,this._currentKeyframeIndex=0,this._startUpdateLoopCount=rL.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},re.playByFrame=function(rS,rQ,re,rl,rM,rd){void 0===rS&&(rS=0),void 0===rQ&&(rQ=1),void 0===re&&(re=2147483647),void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rd&&(rd=30);var rT=1e3/rd;this.play(rS,rQ,re,rl*rT,rM*rT)},re.stop=function(rS){void 0===rS&&(rS=!0),rS?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},rd(0,re,"playEnd",function(){return this._playEnd}),rd(0,re,"templet",function(){return this._templet},function(rS){0===!this.state&&this.stop(!0),this._templet!==rS&&((this._templet=rS).loaded?this._computeFullKeyframeIndices():rS.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),rd(0,re,"playStart",function(){return this._playStart}),rd(0,re,"playDuration",function(){return this._playDuration}),rd(0,re,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),rd(0,re,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),rd(0,re,"overallDuration",function(){return this._overallDuration}),rd(0,re,"currentFrameTime",function(){return this._currentFrameTime}),rd(0,re,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),rd(0,re,"currentPlayTime",function(){return this._currentTime+this._playStart}),rd(0,re,"cachePlayRate",function(){return this._cachePlayRate},function(rS){this._cachePlayRate!==rS&&(this._cachePlayRate=rS,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[rS,this._cacheFrameRate])))}),rd(0,re,"cacheFrameRate",function(){return this._cacheFrameRate},function(rS){this._cacheFrameRate!==rS&&(this._cacheFrameRate=rS,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,rS])))}),rd(0,re,"currentTime",null,function(rS){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(rS<this._playStart||rS>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=rL.loopCount;var rQ=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=rS,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/rQ),0),this._currentFrameTime=this._currentKeyframeIndex*rQ}}),rd(0,re,"paused",function(){return this._paused},function(rS){(this._paused=rS)&&this.event("paused")}),rd(0,re,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),rd(0,re,"destroyed",function(){return this._destroyed}),rQ}(),rm=function(rS){function rQ(){rQ.__super.call(this),rc.isConchNode&&(this.drawSkin=function(rS){rS.transform||(rS.transform=rXS.EMPTY),this._addCmd([rS]),this.setSkinMesh&&this.setSkinMesh(rS._ps,rS.mVBData,rS.mEleNum,0,rS.mTexture,rS.transform)})}return rl(rQ,"laya.ani.GraphicsAni",rT),rQ.prototype.drawSkin=function(rS){var rQ=[rS];this._saveToCmd(rc._context._drawSkin,rQ)},rQ.create=function(){return rQ._caches.pop()||new rQ},rQ.recycle=function(rS){rS.clear(),rQ._caches.push(rS)},rQ._caches=[],rQ}(),r$=function(rS){function rz(){this._aniMap={},this.unfixedLastAniIndex=-1,rz.__super.call(this),this._anis=new Array}rl(rz,"laya.ani.AnimationTemplet",ro);var rQ=rz.prototype;return rQ.parse=function(rS){var rQ=new rkS(rS);this._aniVersion=rQ.readUTFString(),rA.parse(this,rQ)},rQ._calculateKeyFrame=function(rS,rQ,re){var rl=rS.keyFrame;rl[rQ]=rl[0];for(var rM=0;rM<rQ;rM++){var rd=rl[rM];rd.nextData=0===rd.duration?rd.data:rl[rM+1].data}rl.length--},rQ.onAsynLoaded=function(rS,rQ,re){var rl=new rkS(rQ);switch(this._aniVersion=rl.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":rv.parse(this,rl);break;default:rA.parse(this,rl)}this._endLoaded()},rQ.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},rQ.getAnimationCount=function(){return this._anis.length},rQ.getAnimation=function(rS){return this._anis[rS]},rQ.getAniDuration=function(rS){return this._anis[rS].playTime},rQ.getNodes=function(rS){return this._anis[rS].nodes},rQ.getNodeIndexWithName=function(rS,rQ){return this._anis[rS].bone3DMap[rQ]},rQ.getNodeCount=function(rS){return this._anis[rS].nodes.length},rQ.getTotalkeyframesLength=function(rS){return this._anis[rS].totalKeyframeDatasLength},rQ.getPublicExtData=function(){return this._publicExtData},rQ.getAnimationDataWithCache=function(rS,rQ,re,rl){var rM=rQ[re];if(rM){var rd=rM[rS];return rd?rd[rl]:null}return null},rQ.setAnimationDataWithCache=function(rS,rQ,re,rl,rM){var rd=rQ[re]||(rQ[re]={});(rd[rS]||(rd[rS]=[]))[rl]=rM},rQ.getOriginalData=function(rS,rQ,re,rl,rM){for(var rd=this._anis[rS].nodes,rT=0,rU=0,ri=rd.length,rR=0;rU<ri;rU++){var ro,rY=rd[rU];ro=rY.keyFrame[re[rU][rl]],rY.dataOffset=rR;var rp=rM-ro.startTime,rJ=rY.lerpType;if(rJ)switch(rJ){case 0:case 1:for(rT=0;rT<rY.keyframeWidth;)rT+=rY.interpolationMethod[rT](rY,rT,rQ,rR+rT,ro.data,rp,null,ro.duration,ro.nextData);break;case 2:var rL=ro.interpolationData,rj=rL.length,rc=0;for(rT=0;rT<rj;){var rG=rL[rT];switch(rG){case 6:case 7:rT+=rz.interpolation[rG](rY,rc,rQ,rR+rc,ro.data,rp,null,ro.duration,ro.nextData,rL,rT+1);break;default:rT+=rz.interpolation[rG](rY,rc,rQ,rR+rc,ro.data,rp,null,ro.duration,ro.nextData)}rc++}}else for(rT=0;rT<rY.keyframeWidth;)rT+=rY.interpolationMethod[rT](rY,rT,rQ,rR+rT,ro.data,rp,null,ro.duration,ro.nextData);rR+=rY.keyframeWidth}},rQ.getNodesCurrentFrameIndex=function(rS,rQ){var re=this._anis[rS].nodes;rS!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(re.length),this.unfixedCurrentTimes=new Float32Array(re.length),this.unfixedLastAniIndex=rS);for(var rl=0,rM=re.length;rl<rM;rl++){var rd=re[rl];for(rQ<this.unfixedCurrentTimes[rl]&&(this.unfixedCurrentFrameIndexes[rl]=0),this.unfixedCurrentTimes[rl]=rQ;this.unfixedCurrentFrameIndexes[rl]<rd.keyFrame.length&&!(rd.keyFrame[this.unfixedCurrentFrameIndexes[rl]].startTime>this.unfixedCurrentTimes[rl]);)this.unfixedCurrentFrameIndexes[rl]++;this.unfixedCurrentFrameIndexes[rl]--}return this.unfixedCurrentFrameIndexes},rQ.getOriginalDataUnfixedRate=function(rS,rQ,re){var rl=this._anis[rS].nodes;rS!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(rl.length),this.unfixedCurrentTimes=new Float32Array(rl.length),this.unfixedKeyframes=rj(rl.length),this.unfixedLastAniIndex=rS);for(var rM=0,rd=0,rT=rl.length,rU=0;rd<rT;rd++){var ri=rl[rd];for(re<this.unfixedCurrentTimes[rd]&&(this.unfixedCurrentFrameIndexes[rd]=0),this.unfixedCurrentTimes[rd]=re;this.unfixedCurrentFrameIndexes[rd]<ri.keyFrame.length&&!(ri.keyFrame[this.unfixedCurrentFrameIndexes[rd]].startTime>this.unfixedCurrentTimes[rd]);)this.unfixedKeyframes[rd]=ri.keyFrame[this.unfixedCurrentFrameIndexes[rd]],this.unfixedCurrentFrameIndexes[rd]++;var rR=this.unfixedKeyframes[rd];ri.dataOffset=rU;var ro=re-rR.startTime;if(ri.lerpType)switch(ri.lerpType){case 0:case 1:for(rM=0;rM<ri.keyframeWidth;)rM+=ri.interpolationMethod[rM](ri,rM,rQ,rU+rM,rR.data,ro,null,rR.duration,rR.nextData);break;case 2:var rY=rR.interpolationData,rp=rY.length,rJ=0;for(rM=0;rM<rp;){var rL=rY[rM];switch(rL){case 6:case 7:rM+=rz.interpolation[rL](ri,rJ,rQ,rU+rJ,rR.data,ro,null,rR.duration,rR.nextData,rY,rM+1);break;default:rM+=rz.interpolation[rL](ri,rJ,rQ,rU+rJ,rR.data,ro,null,rR.duration,rR.nextData)}rJ++}}else for(rM=0;rM<ri.keyframeWidth;)rM+=ri.interpolationMethod[rM](ri,rM,rQ,rU+rM,rR.data,ro,null,rR.duration,rR.nextData);rU+=ri.keyframeWidth}},rz._LinearInterpolation_0=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){var ro=0===rU?0:rd/rU;return re[rl]=(1-ro)*rM[rQ]+ro*ri[rQ],1},rz._QuaternionInterpolation_1=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){var ro=0===rU?0:rd/rU;return rp.slerpQuaternionArray(rM,rQ,ri,rQ,ro,re,rl),4},rz._AngleInterpolation_2=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return 0},rz._RadiansInterpolation_3=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return 0},rz._Matrix4x4Interpolation_4=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){for(var ro=0;ro<16;ro++,rQ++)re[rl+ro]=rM[rQ]+rd*rT[rQ];return 16},rz._NoInterpolation_5=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR){return re[rl]=rM[rQ],1},rz._BezierInterpolation_6=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro){return void 0===ro&&(ro=0),re[rl]=rM[rQ]+(ri[rQ]-rM[rQ])*rH.getBezierRate(rd/rU,rR[ro],rR[ro+1],rR[ro+2],rR[ro+3]),5},rz._BezierInterpolation_7=function(rS,rQ,re,rl,rM,rd,rT,rU,ri,rR,ro){return void 0===ro&&(ro=0),re[rl]=rR[ro+4]+rR[ro+5]*rH.getBezierRate((.001*rd+rR[ro+6])/rR[ro+7],rR[ro],rR[ro+1],rR[ro+2],rR[ro+3]),9},rz.load=function(rS){return rMS.loader.create(rS,null,null,rz)},rz.interpolation=[rz._LinearInterpolation_0,rz._QuaternionInterpolation_1,rz._AngleInterpolation_2,rz._RadiansInterpolation_3,rz._Matrix4x4Interpolation_4,rz._NoInterpolation_5,rz._BezierInterpolation_6,rz._BezierInterpolation_7],rz}(),rI=function(rQ){function re(rS,rQ){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,re.__super.call(this),void 0===rQ&&(rQ=0),rS&&this.init(rS,rQ)}rl(re,"laya.ani.bone.Skeleton",rQ);var rS=re.prototype;return rS.init=function(rS,rQ){void 0===rQ&&(rQ=0);var re,rl,rM,rd=0,rT=0;if(1==rQ)for(this._graphicsCache=[],rd=0,rT=rS.getAnimationCount();rd<rT;rd++)this._graphicsCache.push([]);if(this._yReverseMatrix=rS.yReverseMatrix,this._aniMode=rQ,this._templet=rS,this._player=new rg,this._player.cacheFrameRate=rS.rate,this._player.templet=rS,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=rS.mBoneArr,this._rootBone=rS.mRootBone,this._aniSectionDic=rS.aniSectionDic,0<rS.ikArr.length)for(this._ikArr=[],rd=0,rT=rS.ikArr.length;rd<rT;rd++)this._ikArr.push(new rz(rS.ikArr[rd],this._boneList));if(0<rS.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),rd=0,rT=rS.pathArr.length;rd<rT;rd++)re=rS.pathArr[rd],rl=new rD(re,this._boneList),(rM=this._boneSlotDic[re.name])&&((rl=new rD(re,this._boneList)).target=rM),this._pathDic[re.name]=rl;if(0<rS.tfArr.length)for(this._tfArr=[],rd=0,rT=rS.tfArr.length;rd<rT;rd++)this._tfArr.push(new rB(rS.tfArr[rd],this._boneList));if(0<rS.skinDataArray.length){var rU=this._templet.skinDataArray[this._skinIndex];this._skinName=rU.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},rS.load=function(rS,rQ,re){},rS._onLoaded=function(){},rS._parseComplete=function(){var rS=rE.TEMPLET_DICTIONARY[this._aniPath];rS&&(this.init(rS,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},rS._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},rS._onPlay=function(){this.event("played")},rS._onStop=function(){var rS,rQ=this._templet.eventAniArr[this._aniClipIndex];if(rQ&&this._eventIndex<rQ.length)for(;this._eventIndex<rQ.length;this._eventIndex++)(rS=rQ[this._eventIndex]).time>=this._player.playStart&&rS.time<=this._player.playEnd&&this.event("label",rS);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},rS._onPause=function(){this.event("paused")},rS._parseSrcBoneMatrix=function(){var rS=0,rQ=0;for(rQ=this._templet.srcBoneMatrixArr.length,rS=0;rS<rQ;rS++)this._boneMatrixArray.push(new rXS);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var re,rl,rM=this._templet.boneSlotArray;for(rS=0,rQ=rM.length;rS<rQ;rS++)re=rM[rS],null==(rl=this._bindBoneBoneSlotDic[re.parent])&&(this._bindBoneBoneSlotDic[re.parent]=rl=[]),this._boneSlotDic[re.name]=re=re.copy(),rl.push(re),this._boneSlotArray.push(re)}},rS._emitMissedEvents=function(rS,rQ,re){void 0===re&&(re=0);var rl=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(rl){var rM,rd,rT=0;for(rM=rl.length,rT=re;rT<rM;rT++)(rd=rl[rT]).time>=this._player.playStart&&rd.time<=this._player.playEnd&&this.event("label",rd)}},rS._update=function(rS){if(void 0===rS&&(rS=!0),!(this._pause||rS&&this._indexControl)){var rQ=this.timer.currTimer,re=this._player.currentKeyframeIndex,rl=rQ-this._lastTime;if(rS?this._player._update(rl):re=-1,this._lastTime=rQ,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<rl&&this._clipIndex==re&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var rM;this._lastUpdateAniClipIndex=this._aniClipIndex,re>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var rd,rT=this._templet.eventAniArr[this._aniClipIndex];if(rT&&this._eventIndex<rT.length&&((rM=rT[this._eventIndex]).time>=this._player.playStart&&rM.time<=this._player.playEnd?this._player.currentPlayTime>=rM.time&&(this.event("label",rM),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(rd=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=rd&&(this.graphics=rd));var rU=0,ri=0;for(ri=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,ri-1)&&0<ri;)ri--;if(ri<this._clipIndex)for(rU=ri;rU<this._clipIndex;rU++)this._createGraphics(rU)}else if(1==this._aniMode){if(rd=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=rd&&(this.graphics=rd));for(ri=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,ri-1)&&0<ri;)ri--;if(ri<this._clipIndex)for(rU=ri;rU<this._clipIndex;rU++)this._createGraphics(rU)}this._createGraphics()}}},rS._createGraphics=function(rS){void 0===rS&&(rS=-1),-1==rS&&(rS=this._clipIndex);var rQ,re,rl=rS*this._player.cacheFrameRateInterval,rM=this._templet.drawOrderAniArr[this._aniClipIndex];if(rM&&0<rM.length)for(this._drawOrderIndex=0,rQ=rM[this._drawOrderIndex];rl>=rQ.time&&(this._drawOrder=rQ.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=rM.length));)rQ=rM[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=rm.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=rm.create(),re=this.graphics;var rd=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],rS,rl);var rT,rU,ri,rR,ro=this._aniSectionDic[this._aniClipIndex],rY=0,rp=0,rJ=0,rL=0,rj=0,rc=this._templet.srcBoneMatrixArr.length;for(rj=ro[rp=0];rp<rc;rp++)rR=this._boneList[rp],ri=this._templet.srcBoneMatrixArr[rp],rR.resultTransform.scX=ri.scX*this._curOriginalData[rY++],rR.resultTransform.skX=ri.skX+this._curOriginalData[rY++],rR.resultTransform.skY=ri.skY+this._curOriginalData[rY++],rR.resultTransform.scY=ri.scY*this._curOriginalData[rY++],rR.resultTransform.x=ri.x+this._curOriginalData[rY++],rR.resultTransform.y=ri.y+this._curOriginalData[rY++],8===this._templet.tMatrixDataLen&&(rR.resultTransform.skewX=ri.skewX+this._curOriginalData[rY++],rR.resultTransform.skewY=ri.skewY+this._curOriginalData[rY++]);var rG,rz={},rA={};for(rj+=ro[1];rp<rj;rp++)rz[(rG=rd[rp]).name]=this._curOriginalData[rY++],rA[rG.name]=this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++];var rv,rD,rB={},rO={};for(rj+=ro[2];rp<rj;rp++)rB[(rG=rd[rp]).name]=this._curOriginalData[rY++],rO[rG.name]=this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++],this._curOriginalData[rY++];if(this._pathDic)for(rj+=ro[3];rp<rj;rp++){if(rG=rd[rp],rv=this._pathDic[rG.name])switch(new rkS(rG.extenData).getByte()){case 1:rv.position=this._curOriginalData[rY++];break;case 2:rv.spacing=this._curOriginalData[rY++];break;case 3:rv.rotateMix=this._curOriginalData[rY++],rv.translateMix=this._curOriginalData[rY++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(rXS.TEMP.identity()),this._ikArr)for(rp=0,rj=this._ikArr.length;rp<rj;rp++)rD=this._ikArr[rp],rB.hasOwnProperty(rD.name)&&(rD.bendDirection=rB[rD.name]),rO.hasOwnProperty(rD.name)&&(rD.mix=rO[rD.name]),rD.apply();if(this._pathDic)for(var rH in this._pathDic)(rv=this._pathDic[rH]).apply(this._boneList,re);if(this._tfArr)for(rp=0,rL=this._tfArr.length;rp<rL;rp++)this._tfArr[rp].apply();for(rp=0,rL=this._boneList.length;rp<rL;rp++)if(rR=this._boneList[rp],rU=this._bindBoneBoneSlotDic[rR.name],rR.resultMatrix.copyTo(this._boneMatrixArray[rp]),rU)for(rJ=0,rj=rU.length;rJ<rj;rJ++)(rT=rU[rJ])&&rT.setParentMatrix(rR.resultMatrix);var rg,rI,rE,rt,rk={},rX=this._templet.deformAniArr;if(rX&&0<rX.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,rp=0,rj=this._boneSlotArray.length;rp<rj;rp++)(rT=this._boneSlotArray[rp]).deformData=null;var rh,rb=rX[this._aniClipIndex];for(rh in rg=rb.default,this._setDeform(rg,rk,this._boneSlotArray,rl),rb)"default"!=rh&&rh!=this._skinName&&(rg=rb[rh],this._setDeform(rg,rk,this._boneSlotArray,rl));rg=rb[this._skinName],this._setDeform(rg,rk,this._boneSlotArray,rl)}if(this._drawOrder)for(rp=0,rj=this._drawOrder.length;rp<rj;rp++)rI=rz[(rT=this._boneSlotArray[this._drawOrder[rp]]).name],rE=rA[rT.name],isNaN(rE)||(re.save(),re.alpha(rE)),isNaN(rI)||-2==rI||(this._templet.attachmentNames?rT.showDisplayByName(this._templet.attachmentNames[rI]):rT.showDisplayByIndex(rI)),rk[this._drawOrder[rp]]?(rt=rk[this._drawOrder[rp]],rT.currDisplayData&&rt[rT.currDisplayData.attachmentName]?rT.deformData=rt[rT.currDisplayData.attachmentName]:rT.deformData=null):rT.deformData=null,isNaN(rE)?rT.draw(re,this._boneMatrixArray,2==this._aniMode):rT.draw(re,this._boneMatrixArray,2==this._aniMode,rE),isNaN(rE)||re.restore();else for(rp=0,rj=this._boneSlotArray.length;rp<rj;rp++)rI=rz[(rT=this._boneSlotArray[rp]).name],rE=rA[rT.name],isNaN(rE)||(re.save(),re.alpha(rE)),isNaN(rI)||-2==rI||(this._templet.attachmentNames?rT.showDisplayByName(this._templet.attachmentNames[rI]):rT.showDisplayByIndex(rI)),rk[rp]?(rt=rk[rp],rT.currDisplayData&&rt[rT.currDisplayData.attachmentName]?rT.deformData=rt[rT.currDisplayData.attachmentName]:rT.deformData=null):rT.deformData=null,isNaN(rE)?rT.draw(re,this._boneMatrixArray,2==this._aniMode):rT.draw(re,this._boneMatrixArray,2==this._aniMode,rE),isNaN(rE)||re.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,rS,re):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,rS,re)},rS._setDeform=function(rS,rQ,re,rl){if(rS){var rM,rd,rT,rU=0,ri=0,rR=0;if(rS)for(rU=0,ri=rS.deformSlotDataList.length;rU<ri;rU++)for(rM=rS.deformSlotDataList[rU],rR=0;rR<rM.deformSlotDisplayList.length;rR++)rT=re[(rd=rM.deformSlotDisplayList[rR]).slotIndex],rd.apply(rl,rT),rQ[rd.slotIndex]||(rQ[rd.slotIndex]={}),rQ[rd.slotIndex][rd.attachment]=rd.deformData}},rS.getAnimNum=function(){return this._templet.getAnimationCount()},rS.getAniNameByIndex=function(rS){return this._templet.getAniNameByIndex(rS)},rS.getSlotByName=function(rS){return this._boneSlotDic[rS]},rS.showSkinByName=function(rS,rQ){void 0===rQ&&(rQ=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(rS),rQ)},rS.showSkinByIndex=function(rS,rQ){void 0===rQ&&(rQ=!0);for(var re=0;re<this._boneSlotArray.length;re++)this._boneSlotArray[re].showSlotData(null,rQ);if(this._templet.showSkinByIndex(this._boneSlotDic,rS,rQ)){var rl=this._templet.skinDataArray[rS];this._skinIndex=rS,this._skinName=rl.name}this._clearCache()},rS.showSlotSkinByIndex=function(rS,rQ){if(0!=this._aniMode){var re=this.getSlotByName(rS);re&&re.showDisplayByIndex(rQ),this._clearCache()}},rS.showSlotSkinByName=function(rS,rQ){if(0!=this._aniMode){var re=this.getSlotByName(rS);re&&re.showDisplayByName(rQ),this._clearCache()}},rS.replaceSlotSkinName=function(rS,rQ,re){if(0!=this._aniMode){var rl=this.getSlotByName(rS);rl&&rl.replaceDisplayByName(rQ,re),this._clearCache()}},rS.replaceSlotSkinByIndex=function(rS,rQ,re){if(0!=this._aniMode){var rl=this.getSlotByName(rS);rl&&rl.replaceDisplayByIndex(rQ,re),this._clearCache()}},rS.setSlotSkin=function(rS,rQ){if(0!=this._aniMode){var re=this.getSlotByName(rS);re&&re.replaceSkin(rQ),this._clearCache()}},rS._clearCache=function(){if(1==this._aniMode)for(var rS=0,rQ=this._graphicsCache.length;rS<rQ;rS++){for(var re=0,rl=this._graphicsCache[rS].length;re<rl;re++){var rM=this._graphicsCache[rS][re];rM!=this.graphics&&rm.recycle(rM)}this._graphicsCache[rS].length=0}},rS.play=function(rS,rQ,re,rl,rM,rd){void 0===re&&(re=!0),void 0===rl&&(rl=0),void 0===rM&&(rM=0),void 0===rd&&(rd=!0),this._indexControl=!1;var rT=-1,rU=NaN;if(rU=rQ?2147483647:0,"string"==typeof rS)for(var ri=0,rR=this._templet.getAnimationCount();ri<rR;ri++){var ro=this._templet.getAnimation(ri);if(ro&&rS==ro.name){rT=ri;break}}else rT=rS;-1<rT&&rT<this.getAnimNum()&&(this._aniClipIndex=rT,(re||this._pause||this._currAniIndex!=rT)&&(this._currAniIndex=rT,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(rT)),this._drawOrder=null,this._eventIndex=0,this._player.play(rT,this._player.playbackRate,rU,rl,rM),rd&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=rY.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},rS.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},rS.playbackRate=function(rS){this._player&&(this._player.playbackRate=rS)},rS.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},rS.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=rY.now(),this.timer.frameLoop(1,this,this._update,null,!0))},rS._getGrahicsDataWithCache=function(rS,rQ){return this._graphicsCache[rS][rQ]},rS._setGrahicsDataWithCache=function(rS,rQ,re){this._graphicsCache[rS][rQ]=re},rS.destroy=function(rS){void 0===rS&&(rS=!0),rQ.prototype.destroy.call(this,rS),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},rd(0,rS,"url",function(){return this._aniPath},function(rS){this.load(rS)}),rd(0,rS,"index",function(){return this._index},function(rS){this.player&&(this._index=rS,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),rd(0,rS,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),rd(0,rS,"templet",function(){return this._templet}),rd(0,rS,"player",function(){return this._player}),re.useSimpleMeshInCanvas=!1,re}(rdS),rE=function(rQ){function rM(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,rM.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}rl(rM,"laya.ani.bone.Templet",rQ);var rS=rM.prototype;return rS.getLoadList=function(){return this._loadList},rS.loadAni=function(rS){this._skBufferUrl=rS,rMS.loader.load(rS,ri.create(this,this.onComplete),null,"arraybuffer")},rS.onComplete=function(rS){if(this._isDestroyed)this.destroy();else{var rQ=rR.getRes(this._skBufferUrl);rQ?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,rQ)):this.event("error","load failed:"+this._skBufferUrl)}},rS.parseData=function(rS,rQ,re){void 0===re&&(re=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=rS,this._mainTexture&&rc.isWebGL&&rS.bitmap&&(rS.bitmap.enableMerageInAtlas=!1),this._rate=re,this.parse(rQ)},rS.buildArmature=function(rS){return void 0===rS&&(rS=0),new rI(this,rS)},rS.parse=function(rS){rQ.prototype.parse.call(this,rS),this._endLoaded(),this._aniVersion!=rM.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+rM.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},rS._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var rS=0;this._loadList=[];var rQ,re=new rkS(this.getPublicExtData()),rl=0,rM=0,rd=0,rT=re.getInt32(),rU=re.readUTFString(),ri=rU.split("\n");for(rS=0;rS<rT;rS++)rQ=this._path+ri[2*rS],rU=ri[2*rS+1],re.getFloat32(),re.getFloat32(),rl=re.getFloat32(),rM=re.getFloat32(),rd=re.getFloat32(),isNaN(rd)?0:rd,rd=re.getFloat32(),isNaN(rd)?0:rd,rd=re.getFloat32(),isNaN(rd)?rl:rd,rd=re.getFloat32(),isNaN(rd)?rM:rd,-1==this._loadList.indexOf(rQ)&&this._loadList.push(rQ);this.event("inited",this)}},rS._textureComplete=function(){for(var rS,rQ,re=0,rl=this._loadList.length;re<rl;re++)rQ=this._loadList[re],rS=this._textureDic[rQ]=rR.getRes(rQ),rc.isWebGL&&rS&&rS.bitmap&&(rS.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},rS._parsePublicExtData=function(){var rS=0,rQ=0,re=0,rl=0,rM=0;for(rS=0,rM=this.getAnimationCount();rS<rM;rS++)this._graphicsCache.push([]);var rd;rd="Dragon"!=this._aniClassName;var rT,rU,ri=new rkS(this.getPublicExtData()),rR=0,ro=0,rY=0,rp=0,rJ=0,rL=0,rj=0,rc=0,rG=0,rz=ri.getInt32(),rA=ri.readUTFString(),rv=rA.split("\n");for(rS=0;rS<rz;rS++){if(rT=this._mainTexture,rU=this._path+rv[2*rS],rA=rv[2*rS+1],null==this._mainTexture&&(rT=this._textureDic[rU]),!rT)return this.event("error",this),void(this.isParseFail=!0);rR=ri.getFloat32(),ro=ri.getFloat32(),rY=ri.getFloat32(),rp=ri.getFloat32(),rG=ri.getFloat32(),rJ=isNaN(rG)?0:rG,rG=ri.getFloat32(),rL=isNaN(rG)?0:rG,rG=ri.getFloat32(),rj=isNaN(rG)?rY:rG,rG=ri.getFloat32(),rc=isNaN(rG)?rp:rG,this.subTextureDic[rA]=rhS.create(rT,rR,ro,rY,rp,-rJ,-rL,rj,rc),rT.alphaTexture&&(this.subTextureDic[rA].alphaTexture=rhS.create(rT.alphaTexture,rR,ro,rY,rp,-rJ,-rL,rj,rc))}this._mainTexture=rT;var rD,rB,rO,rH,rg,rI=ri.getUint16();for(rS=0;rS<rI;rS++)(rD=[]).push(ri.getUint16()),rD.push(ri.getUint16()),rD.push(ri.getUint16()),rD.push(ri.getUint16()),this.aniSectionDic[rS]=rD;var rE,rt=ri.getInt16(),rk={};for(rS=0;rS<rt;rS++)rB=new rbS,0==rS?rE=rB:rB.root=rE,rB.d=rd?-1:1,rH=ri.readUTFString(),rg=ri.readUTFString(),rB.length=ri.getFloat32(),1==ri.getByte()&&(rB.inheritRotation=!1),1==ri.getByte()&&(rB.inheritScale=!1),rB.name=rH,rg&&((rO=rk[rg])?rO.addChild(rB):this.mRootBone=rB),rk[rH]=rB,this.mBoneArr.push(rB);this.tMatrixDataLen=ri.getUint16();var rX,rh,rb=ri.getUint16(),rm=Math.floor(rb/this.tMatrixDataLen),r$=this.srcBoneMatrixArr;for(rS=0;rS<rm;rS++)(rX=new rqS).scX=ri.getFloat32(),rX.skX=ri.getFloat32(),rX.skY=ri.getFloat32(),rX.scY=ri.getFloat32(),rX.x=ri.getFloat32(),rX.y=ri.getFloat32(),8===this.tMatrixDataLen&&(rX.skewX=ri.getFloat32(),rX.skewY=ri.getFloat32()),r$.push(rX),(rB=this.mBoneArr[rS]).transform=rX;var rn,rP=ri.getUint16(),ra=0;for(rS=0;rS<rP;rS++){for(rh=new rwS,ra=ri.getUint16(),rQ=0;rQ<ra;rQ++)rh.boneNames.push(ri.readUTFString()),rh.boneIndexs.push(ri.getInt16());rh.name=ri.readUTFString(),rh.targetBoneName=ri.readUTFString(),rh.targetBoneIndex=ri.getInt16(),rh.bendDirection=ri.getFloat32(),rh.mix=ri.getFloat32(),rh.isSpine=rd,this.ikArr.push(rh)}var rf,rw=ri.getUint16(),ru=0;for(rS=0;rS<rw;rS++){for(rn=new rFS,ru=ri.getUint16(),rQ=0;rQ<ru;rQ++)rn.boneIndexs.push(ri.getInt16());rn.name=ri.getUTFString(),rn.targetIndex=ri.getInt16(),rn.rotateMix=ri.getFloat32(),rn.translateMix=ri.getFloat32(),rn.scaleMix=ri.getFloat32(),rn.shearMix=ri.getFloat32(),rn.offsetRotation=ri.getFloat32(),rn.offsetX=ri.getFloat32(),rn.offsetY=ri.getFloat32(),rn.offsetScaleX=ri.getFloat32(),rn.offsetScaleY=ri.getFloat32(),rn.offsetShearY=ri.getFloat32(),this.tfArr.push(rn)}var rr=ri.getUint16(),rW=0;for(rS=0;rS<rr;rS++){for((rf=new ruS).name=ri.readUTFString(),rW=ri.getUint16(),rQ=0;rQ<rW;rQ++)rf.bones.push(ri.getInt16());rf.target=ri.readUTFString(),rf.positionMode=ri.readUTFString(),rf.spacingMode=ri.readUTFString(),rf.rotateMode=ri.readUTFString(),rf.offsetRotation=ri.getFloat32(),rf.position=ri.getFloat32(),rf.spacing=ri.getFloat32(),rf.rotateMix=ri.getFloat32(),rf.translateMix=ri.getFloat32(),this.pathArr.push(rf)}var rx,rF,rq,rZ,rN,rC=0,rK=0,rV=0,r_=NaN,rs=0,ry=ri.getInt16();for(rS=0;rS<ry;rS++){var rSS=ri.getUint8(),rQS={};this.deformAniArr.push(rQS);for(var reS=0;reS<rSS;reS++)for((rx=new r$S).skinName=ri.getUTFString(),rQS[rx.skinName]=rx,rC=ri.getInt16(),rQ=0;rQ<rC;rQ++)for(rF=new rnS,rx.deformSlotDataList.push(rF),rK=ri.getInt16(),re=0;re<rK;re++)for(rq=new rPS,rF.deformSlotDisplayList.push(rq),rq.slotIndex=ri.getInt16(),rq.attachment=ri.getUTFString(),rV=ri.getInt16(),rl=0;rl<rV;rl++)for(1==ri.getByte()?rq.tweenKeyList.push(!0):rq.tweenKeyList.push(!1),r_=ri.getFloat32(),rq.timeList.push(r_),rZ=[],rq.vectices.push(rZ),rs=ri.getInt16(),rM=0;rM<rs;rM++)rZ.push(ri.getFloat32())}var rlS,rMS,rdS=ri.getInt16(),rTS=0,rUS=0;for(rS=0;rS<rdS;rS++){for(rTS=ri.getInt16(),rN=[],rQ=0;rQ<rTS;rQ++){for((rlS=new raS).time=ri.getFloat32(),rUS=ri.getInt16(),re=0;re<rUS;re++)rlS.drawOrder.push(ri.getInt16());rN.push(rlS)}this.drawOrderAniArr.push(rN)}var riS,rRS=ri.getInt16(),roS=0;for(rS=0;rS<rRS;rS++){for(roS=ri.getInt16(),rMS=[],rQ=0;rQ<roS;rQ++)(riS=new rfS).name=ri.getUTFString(),riS.intValue=ri.getInt32(),riS.floatValue=ri.getFloat32(),riS.stringValue=ri.getUTFString(),riS.time=ri.getFloat32(),rMS.push(riS);this.eventAniArr.push(rMS)}var rYS=ri.getInt16();if(0<rYS)for(this.attachmentNames=[],rS=0;rS<rYS;rS++)this.attachmentNames.push(ri.getUTFString());var rpS,rJS,rLS=ri.getInt16();for(rS=0;rS<rLS;rS++)(rpS=new rmS).name=ri.readUTFString(),rpS.parent=ri.readUTFString(),rpS.attachmentName=ri.readUTFString(),rpS.srcDisplayIndex=rpS.displayIndex=ri.getInt16(),(rpS.templet=this).boneSlotDic[rpS.name]=rpS,null==(rJS=this.bindBoneBoneSlotDic[rpS.parent])&&(this.bindBoneBoneSlotDic[rpS.parent]=rJS=[]),rJS.push(rpS),this.boneSlotArray.push(rpS);var rjS,rcS,rGS,rzS=ri.readUTFString().split("\n"),rAS=0,rvS=ri.getUint8(),rDS=0,rBS=0,rOS=0,rHS=0,rgS=0,rIS=0,rES=0;for(rS=0;rS<rvS;rS++){for((rjS=new rrS).name=rzS[rAS++],rDS=ri.getUint8(),rQ=0;rQ<rDS;rQ++){for((rcS=new rxS).name=rzS[rAS++],rpS=this.boneSlotDic[rcS.name],rBS=ri.getUint8(),re=0;re<rBS;re++){if(rGS=new rWS,this.skinSlotDisplayDataArr.push(rGS),rGS.name=rzS[rAS++],rGS.attachmentName=rzS[rAS++],rGS.transform=new rqS,rGS.transform.scX=ri.getFloat32(),rGS.transform.skX=ri.getFloat32(),rGS.transform.skY=ri.getFloat32(),rGS.transform.scY=ri.getFloat32(),rGS.transform.x=ri.getFloat32(),rGS.transform.y=ri.getFloat32(),rcS.displayArr.push(rGS),rGS.width=ri.getFloat32(),rGS.height=ri.getFloat32(),rGS.type=ri.getUint8(),rGS.verLen=ri.getUint16(),0<(rt=ri.getUint16()))for(rGS.bones=[],rl=0;rl<rt;rl++){var rtS=ri.getUint16();rGS.bones.push(rtS)}if(0<(rOS=ri.getUint16()))for(rGS.uvs=[],rl=0;rl<rOS;rl++)rGS.uvs.push(ri.getFloat32());if(0<(rHS=ri.getUint16()))for(rGS.weights=[],rl=0;rl<rHS;rl++)rGS.weights.push(ri.getFloat32());if(0<(rgS=ri.getUint16()))for(rGS.triangles=[],rl=0;rl<rgS;rl++)rGS.triangles.push(ri.getUint16());if(0<(rIS=ri.getUint16()))for(rGS.vertices=[],rl=0;rl<rIS;rl++)rGS.vertices.push(ri.getFloat32());if(0<(rES=ri.getUint16()))for(rGS.lengths=[],rl=0;rl<rES;rl++)rGS.lengths.push(ri.getFloat32())}rjS.slotArr.push(rcS)}this.skinDic[rjS.name]=rjS,this.skinDataArray.push(rjS)}1==ri.getUint8()?(this.yReverseMatrix=new rXS(1,0,0,-1,0,0),rE&&rE.setTempMatrix(this.yReverseMatrix)):rE&&rE.setTempMatrix(new rXS),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},rS.getTexture=function(rS){var rQ=this.subTextureDic[rS];return rQ||(rQ=this.subTextureDic[rS.substr(0,rS.length-1)]),null==rQ?this._mainTexture:rQ},rS.showSkinByIndex=function(rS,rQ,re){if(void 0===re&&(re=!0),rQ<0&&rQ>=this.skinDataArray.length)return!1;var rl,rM,rd=0,rT=0,rU=this.skinDataArray[rQ];if(rU){for(rd=0,rT=rU.slotArr.length;rd<rT;rd++)(rM=rU.slotArr[rd])&&(rl=rS[rM.name])&&(rl.showSlotData(rM,re),re&&"undefined"!=rl.attachmentName&&"null"!=rl.attachmentName?rl.showDisplayByName(rl.attachmentName):rl.showDisplayByIndex(rl.displayIndex));return!0}return!1},rS.getSkinIndexByName=function(rS){for(var rQ=0,re=this.skinDataArray.length;rQ<re;rQ++)if(this.skinDataArray[rQ].name==rS)return rQ;return-1},rS.getGrahicsDataWithCache=function(rS,rQ){return this._graphicsCache[rS][rQ]},rS.setGrahicsDataWithCache=function(rS,rQ,re){this._graphicsCache[rS][rQ]=re},rS.destroy=function(){var rS;for(var rQ in this._isDestroyed=!0,this.subTextureDic)(rS=this.subTextureDic[rQ])&&rS.destroy();for(rQ in this._textureDic)(rS=this._textureDic[rQ])&&rS.destroy();for(var re=0,rl=this.skinSlotDisplayDataArr.length;re<rl;re++)this.skinSlotDisplayDataArr[re].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete rM.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},rS.getAniNameByIndex=function(rS){var rQ=this.getAnimation(rS);return rQ?rQ.name:null},rd(0,rS,"rate",function(){return this._rate},function(rS){this._rate=rS}),rM.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",rM.TEMPLET_DICTIONARY=null,rM}(r$)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(rS,rQ){"use strict";for(var re in Object.defineProperty(rQ,"__esModule",{value:!0}),Laya){var rl=Laya[re];rl&&rl.__isclass&&(rQ[re]=rl)}});