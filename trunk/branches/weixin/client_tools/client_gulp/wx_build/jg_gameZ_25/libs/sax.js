function XMLReader(){}function parse(C$zur,C$zul,C$zu_,C$zua,C$zun){function c(C$zue){var C$zut=C$zue.slice(1,-1);return C$zut in C$zu_?C$zu_[C$zut]:"#"===C$zut.charAt(0)?65535<(C$zut=parseInt(C$zut.substr(1).replace("x","0x")))?(C$zut-=65536,String.fromCharCode(55296+(C$zut>>10),56320+(1023&C$zut))):String.fromCharCode(C$zut):(C$zun.error("entity not found:"+C$zue),C$zue)}function i(C$zue){var C$zut;C$zuc<C$zue&&(C$zut=C$zur.substring(C$zuc,C$zue).replace(/&#?\w+;/g,c),C$zus&&o(C$zuc),C$zua.characters(C$zut,0,C$zue-C$zuc),C$zuc=C$zue)}function o(C$zue,C$zut){for(;C$zup<=C$zue&&(C$zut=C$zud.exec(C$zur));)C$zum=C$zut.index,C$zup=C$zum+C$zut[0].length,C$zus.lineNumber++;C$zus.columnNumber=C$zue-C$zum+1}for(var C$zum=0,C$zup=0,C$zud=/.*(?:\r\n?|\n)|.*$/g,C$zus=C$zua.locator,C$zuT=[{currentNSMap:C$zul}],C$zuf={},C$zuc=0;;){try{var C$zue=C$zur.indexOf("<",C$zuc);var C$zuS,C$zuA;if(C$zue<0)return void(C$zur.substr(C$zuc).match(/^\s*$/)||(C$zuA=(C$zuS=C$zua.doc).createTextNode(C$zur.substr(C$zuc)),C$zuS.appendChild(C$zuA),C$zua.currentElement=C$zuA));switch(C$zuc<C$zue&&i(C$zue),C$zur.charAt(C$zue+1)){case"/":var C$zut=C$zur.indexOf(">",C$zue+3),C$zui=C$zur.substring(C$zue+2,C$zut),C$zuo=C$zuT.pop();C$zut<0?(C$zui=C$zur.substring(C$zue+2).replace(/[\s<].*/,""),C$zun.error("end tag name: "+C$zui+" is not complete:"+C$zuo.tagName),C$zut=C$zue+1+C$zui.length):C$zui.match(/\s</)&&(C$zui=C$zui.replace(/[\s<].*/,""),C$zun.error("end tag name: "+C$zui+" maybe not complete"),C$zut=C$zue+1+C$zui.length);var C$zuh=C$zuo.localNSMap,C$zug=C$zuo.tagName==C$zui;if(C$zug||C$zuo.tagName&&C$zuo.tagName.toLowerCase()==C$zui.toLowerCase()){if(C$zua.endElement(C$zuo.uri,C$zuo.localName,C$zui),C$zuh)for(var C$zuE in C$zuh)C$zua.endPrefixMapping(C$zuE);C$zug||C$zun.fatalError("end tag name: "+C$zui+" is not match the current start tagName:"+C$zuo.tagName)}else C$zuT.push(C$zuo);C$zut++;break;case"?":C$zus&&o(C$zue),C$zut=parseInstruction(C$zur,C$zue,C$zua);break;case"!":C$zus&&o(C$zue),C$zut=parseDCC(C$zur,C$zue,C$zua,C$zun);break;default:C$zus&&o(C$zue);var C$zuu=new ElementAttributes,C$zuw=C$zuT[C$zuT.length-1].currentNSMap,C$zut=parseElementStartPart(C$zur,C$zue,C$zuu,C$zuw,c,C$zun),C$zuN=C$zuu.length;if(!C$zuu.closed&&fixSelfClosed(C$zur,C$zut,C$zuu.tagName,C$zuf)&&(C$zuu.closed=!0,C$zu_.nbsp||C$zun.warning("unclosed xml attribute")),C$zus&&C$zuN){for(var C$zub=copyLocator(C$zus,{}),C$zux=0;C$zux<C$zuN;C$zux++){var C$zuC=C$zuu[C$zux];o(C$zuC.offset),C$zuC.locator=copyLocator(C$zus,{})}C$zua.locator=C$zub,appendElement(C$zuu,C$zua,C$zuw)&&C$zuT.push(C$zuu),C$zua.locator=C$zus}else appendElement(C$zuu,C$zua,C$zuw)&&C$zuT.push(C$zuu);"http://www.w3.org/1999/xhtml"!==C$zuu.uri||C$zuu.closed?C$zut++:C$zut=parseHtmlSpecialContent(C$zur,C$zut,C$zuu.tagName,c,C$zua)}}catch(C$zue){C$zun.error("element parse error: "+C$zue),C$zut=-1}C$zuc<C$zut?C$zuc=C$zut:i(Math.max(C$zue,C$zuc)+1)}}function copyLocator(C$zue,C$zut){return C$zut.lineNumber=C$zue.lineNumber,C$zut.columnNumber=C$zue.columnNumber,C$zut}function parseElementStartPart(C$zue,C$zut,C$zur,C$zul,C$zua,C$zun){for(var C$zus,C$zuc=++C$zut,C$zui=S_TAG;;){var C$zuo=C$zue.charAt(C$zuc);switch(C$zuo){case"=":if(C$zui===S_ATTR)C$zus=C$zue.slice(C$zut,C$zuc),C$zui=S_EQ;else{if(C$zui!==S_ATTR_SPACE)throw new Error("attribute equal must after attrName");C$zui=S_EQ}break;case"'":case'"':if(C$zui===S_EQ||C$zui===S_ATTR){if(C$zui===S_ATTR&&(C$zun.warning('attribute value must after "="'),C$zus=C$zue.slice(C$zut,C$zuc)),!(0<(C$zuc=C$zue.indexOf(C$zuo,C$zut=C$zuc+1))))throw new Error("attribute value no end '"+C$zuo+"' match");C$zuu=C$zue.slice(C$zut,C$zuc).replace(/&#?\w+;/g,C$zua),C$zur.add(C$zus,C$zuu,C$zut-1),C$zui=S_ATTR_END}else{if(C$zui!=S_ATTR_NOQUOT_VALUE)throw new Error('attribute value must after "="');C$zuu=C$zue.slice(C$zut,C$zuc).replace(/&#?\w+;/g,C$zua),C$zur.add(C$zus,C$zuu,C$zut),C$zun.warning('attribute "'+C$zus+'" missed start quot('+C$zuo+")!!"),C$zut=C$zuc+1,C$zui=S_ATTR_END}break;case"/":switch(C$zui){case S_TAG:C$zur.setTagName(C$zue.slice(C$zut,C$zuc));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:C$zui=S_TAG_CLOSE,C$zur.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return C$zun.error("unexpected end of input"),C$zui==S_TAG&&C$zur.setTagName(C$zue.slice(C$zut,C$zuc)),C$zuc;case">":switch(C$zui){case S_TAG:C$zur.setTagName(C$zue.slice(C$zut,C$zuc));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:"/"===(C$zuu=C$zue.slice(C$zut,C$zuc)).slice(-1)&&(C$zur.closed=!0,C$zuu=C$zuu.slice(0,-1));case S_ATTR_SPACE:C$zui===S_ATTR_SPACE&&(C$zuu=C$zus),C$zui==S_ATTR_NOQUOT_VALUE?(C$zun.warning('attribute "'+C$zuu+'" missed quot(")!!'),C$zur.add(C$zus,C$zuu.replace(/&#?\w+;/g,C$zua),C$zut)):("http://www.w3.org/1999/xhtml"===C$zul[""]&&C$zuu.match(/^(?:disabled|checked|selected)$/i)||C$zun.warning('attribute "'+C$zuu+'" missed value!! "'+C$zuu+'" instead!!'),C$zur.add(C$zuu,C$zuu,C$zut));break;case S_EQ:throw new Error("attribute value missed!!")}return C$zuc;case"\x80":C$zuo=" ";default:if(C$zuo<=" ")switch(C$zui){case S_TAG:C$zur.setTagName(C$zue.slice(C$zut,C$zuc)),C$zui=S_TAG_SPACE;break;case S_ATTR:C$zus=C$zue.slice(C$zut,C$zuc),C$zui=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var C$zuu=C$zue.slice(C$zut,C$zuc).replace(/&#?\w+;/g,C$zua);C$zun.warning('attribute "'+C$zuu+'" missed quot(")!!'),C$zur.add(C$zus,C$zuu,C$zut);case S_ATTR_END:C$zui=S_TAG_SPACE}else switch(C$zui){case S_ATTR_SPACE:C$zur.tagName,"http://www.w3.org/1999/xhtml"===C$zul[""]&&C$zus.match(/^(?:disabled|checked|selected)$/i)||C$zun.warning('attribute "'+C$zus+'" missed value!! "'+C$zus+'" instead2!!'),C$zur.add(C$zus,C$zus,C$zut),C$zut=C$zuc,C$zui=S_ATTR;break;case S_ATTR_END:C$zun.warning('attribute space is required"'+C$zus+'"!!');case S_TAG_SPACE:C$zui=S_ATTR,C$zut=C$zuc;break;case S_EQ:C$zui=S_ATTR_NOQUOT_VALUE,C$zut=C$zuc;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}C$zuc++}}function appendElement(C$zue,C$zul,C$zut){for(var C$zur=C$zue.tagName,C$zua=null,C$zun=C$zue.length;C$zun--;){var C$zus=C$zue[C$zun],C$zuc=C$zus.qName,C$zu_=C$zus.value;var C$zui;C$zuc=0<(C$zuo=C$zuc.indexOf(":"))?(C$zuu=C$zus.prefix=C$zuc.slice(0,C$zuo),C$zui=C$zuc.slice(C$zuo+1),"xmlns"===C$zuu&&C$zui):(C$zuu=null,"xmlns"===(C$zui=C$zuc)&&""),C$zus.localName=C$zui,!1!==C$zuc&&(null==C$zua&&(C$zua={},_copy(C$zut,C$zut={})),C$zut[C$zuc]=C$zua[C$zuc]=C$zu_,C$zus.uri="http://www.w3.org/2000/xmlns/",C$zul.startPrefixMapping(C$zuc,C$zu_))}for(C$zun=C$zue.length;C$zun--;)(C$zuu=(C$zus=C$zue[C$zun]).prefix)&&("xml"===C$zuu&&(C$zus.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==C$zuu&&(C$zus.uri=C$zut[C$zuu||""]));var C$zuo;C$zui=0<(C$zuo=C$zur.indexOf(":"))?(C$zuu=C$zue.prefix=C$zur.slice(0,C$zuo),C$zue.localName=C$zur.slice(C$zuo+1)):(C$zuu=null,C$zue.localName=C$zur);var C$zum=C$zue.uri=C$zut[C$zuu||""];if(C$zul.startElement(C$zum,C$zui,C$zur,C$zue),!C$zue.closed)return C$zue.currentNSMap=C$zut,C$zue.localNSMap=C$zua,!0;if(C$zul.endElement(C$zum,C$zui,C$zur),C$zua)for(var C$zuu in C$zua)C$zul.endPrefixMapping(C$zuu)}function parseHtmlSpecialContent(C$zue,C$zut,C$zur,C$zua,C$zun){if(/^(?:script|textarea)$/i.test(C$zur)){var C$zus=C$zue.indexOf("</"+C$zur+">",C$zut),C$zue=C$zue.substring(C$zut+1,C$zus);if(/[&<]/.test(C$zue))return/^script$/i.test(C$zur)||(C$zue=C$zue.replace(/&#?\w+;/g,C$zua)),C$zun.characters(C$zue,0,C$zue.length),C$zus}return C$zut+1}function fixSelfClosed(C$zue,C$zut,C$zur,C$zua){var C$zun=C$zua[C$zur];return null==C$zun&&((C$zun=C$zue.lastIndexOf("</"+C$zur+">"))<C$zut&&(C$zun=C$zue.lastIndexOf("</"+C$zur)),C$zua[C$zur]=C$zun),C$zun<C$zut}function _copy(C$zue,C$zut){for(var C$zur in C$zue)C$zut[C$zur]=C$zue[C$zur]}function parseDCC(C$zue,C$zut,C$zur,C$zua){var C$zun=C$zue.charAt(C$zut+2);if("-"===C$zun)return"-"!==C$zue.charAt(C$zut+3)?-1:C$zut<(C$zus=C$zue.indexOf("--\x3e",C$zut+4))?(C$zur.comment(C$zue,C$zut+4,C$zus-C$zut-4),C$zus+3):(C$zua.error("Unclosed comment"),-1);if("CDATA["==C$zue.substr(C$zut+3,6))return C$zus=C$zue.indexOf("]]>",C$zut+9),C$zur.startCDATA(),C$zur.characters(C$zue,C$zut+9,C$zus-C$zut-9),C$zur.endCDATA(),C$zus+3;C$zun=split(C$zue,C$zut),C$zua=C$zun.length;var C$zus;return 1<C$zua&&/!doctype/i.test(C$zun[0][0])?(C$zus=C$zun[1][0],C$zue=3<C$zua&&/^public$/i.test(C$zun[2][0])&&C$zun[3][0],C$zut=4<C$zua&&C$zun[4][0],C$zun=C$zun[C$zua-1],C$zur.startDTD(C$zus,C$zue&&C$zue.replace(/^(['"])(.*?)\1$/,"$2"),C$zut&&C$zut.replace(/^(['"])(.*?)\1$/,"$2")),C$zur.endDTD(),C$zun.index+C$zun[0].length):-1}function parseInstruction(C$zue,C$zut,C$zur){var C$zua=C$zue.indexOf("?>",C$zut);return C$zua&&(C$zue=C$zue.substring(C$zut,C$zua).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/))?(C$zue[0].length,C$zur.processingInstruction(C$zue[1],C$zue[2]),C$zua+2):-1}function ElementAttributes(){}function _set_proto_(C$zue,C$zut){return C$zue.__proto__=C$zut,C$zue}function split(C$zue,C$zut){var C$zur,C$zua=[],C$zun=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(C$zun.lastIndex=C$zut,C$zun.exec(C$zue);C$zur=C$zun.exec(C$zue);)if(C$zua.push(C$zur),C$zur[1])return C$zua}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;XMLReader.prototype={parse:function(C$zue,C$zut,C$zur){var C$zua=this.domBuilder;C$zua.startDocument(),_copy(C$zut,C$zut={}),parse(C$zue,C$zut,C$zur,C$zua,this.errorHandler),C$zua.endDocument()}},ElementAttributes.prototype={setTagName:function(C$zue){if(!tagNamePattern.test(C$zue))throw new Error("invalid tagName:"+C$zue);this.tagName=C$zue},add:function(C$zue,C$zut,C$zur){if(!tagNamePattern.test(C$zue))throw new Error("invalid attribute:"+C$zue);this[this.length++]={qName:C$zue,value:C$zut,offset:C$zur}},length:0,getLocalName:function(C$zue){return this[C$zue].localName},getLocator:function(C$zue){return this[C$zue].locator},getQName:function(C$zue){return this[C$zue].qName},getURI:function(C$zue){return this[C$zue].uri},getValue:function(C$zue){return this[C$zue].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(C$zue,C$zut){function r(){}for(C$zut in r.prototype=C$zut,r=new r,C$zue)r[C$zut]=C$zue[C$zut];return r}),exports.XMLReader=XMLReader;