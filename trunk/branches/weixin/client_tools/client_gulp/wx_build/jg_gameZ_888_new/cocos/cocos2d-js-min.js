!function(a,o,t){function newRequire(t,e){var i=o[t];if(!i){var r=a[t];if(!r)return;var n={};i=o[t]={exports:n},r[0](function(t){return newRequire(r[1][t]||t);},i,n);}return i.exports;}for(var e=0;e<t.length;e++)newRequire(t[e]);}({1:[function(t,e,i){e.exports={1001:"cocos2d: removeAction: Target not found",1002:"cc.ActionManager.removeActionByTag(): an invalid tag",1003:"cc.ActionManager.removeActionByTag(): target must be non-null",1004:"cc.ActionManager.getActionByTag(): an invalid tag",1005:"cocos2d : getActionByTag(tag = %s): Action not found",1006:"[Action step]. override me",1007:"[Action update]. override me",1008:"cocos2d: FiniteTimeAction#reverse: Implement me",1009:"cc.EaseElastic.reverse(): it should be overridden in subclass.",1010:"cc.IntervalAction: reverse not implemented.",1011:"cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.",1012:"cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.",1013:"The speed parameter error",1014:"The repeat parameter error",1015:"parameters should not be ending with null in Javascript",1016:"cc.RotateTo.reverse(): it should be overridden in subclass.",1019:"Failed to construct, Sequence construction needs two or more actions.",1020:"Failed to construct, Spawn construction needs two or more actions.",1021:"cc.Speed.initWithAction(): action must be non nil",1022:"cc.Follow.initWithAction(): followedNode must be non nil",1023:"cc.ActionEase.initWithAction(): action must be non nil",1024:"Invalid configuration. It must at least have one control point",1025:"cc.Sequence.initWithTwoActions(): arguments must all be non nil",1026:"cc.RepeatForever.initWithAction(): action must be non null",1027:"cc.Spawn.initWithTwoActions(): arguments must all be non null",1028:"cc.ReverseTime.initWithAction(): action must be non null",1029:"cc.ReverseTime.initWithAction(): the action was already passed in.",1030:"cc.Animate.initWithAnimation(): animation must be non-NULL",1031:"Illegal parameter get passed in cc.tween: %s.",1100:"Expected 'data' dict, but not found. Config file: %s",1101:"Please load the resource first : %s",1200:"cocos2d: Director: Error in gettimeofday",1201:"cocos2d: Director: unrecognized projection",1203:"cocos2d: Director: Error in gettimeofday",1204:"running scene should not null",1205:"the scene should not null",1206:"loadScene: The scene index to load (%s) is out of range.",1207:"loadScene: Unknown name type to load: '%s'",1208:"loadScene: Failed to load scene '%s' because '%s' is already being loaded.",1209:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1210:"Failed to preload '%s', %s",1211:"loadScene: The scene index to load (%s) is out of range.",1212:"loadScene: Unknown name type to load: '%s'",1213:"loadScene: Failed to load scene '%s' because '%s' is already loading",1214:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1215:"Failed to preload '%s', %s",1216:"Director.runSceneImmediate: scene is not valid",1300:"element type is wrong!",1400:"'%s' is deprecated, please use '%s' instead.",1404:"cc.spriteFrameCache is removed, please use cc.loader to load and cache sprite frames of atlas format.",1405:"The '%s' has been removed, please use '%s' instead.",1406:"'%s.%s' is removed",1408:"'%s' is not support in the '%s', please use '%s' instead.",1502:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",1503:"cc.Scheduler.pauseTarget():target should be non-null",1504:"cc.Scheduler.resumeTarget():target should be non-null",1505:"cc.Scheduler.isTargetPaused():target should be non-null",1506:"warning: you CANNOT change update priority in scheduled function",1507:'CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %s to %s"',1508:"Argument callback must not be empty",1509:"Argument target must be non-nullptr",1510:"cc.Scheduler: Illegal target which doesn't have uuid or instanceId.",1511:"cc.Scheduler: pause state of the scheduled task doesn't match the element pause state in Scheduler, the given paused state will be ignored.",1513:"cc.Scheduler: scheduler stopped using `__instanceId` as id since v2.0, you should do scheduler.enableForTarget(target) before all scheduler API usage on target",1605:"child already added. It can't be added again",1606:"child must be non-null",1610:"cocos2d: removeChildByTag(tag = %s): child not found!",1612:"cc.Node.stopActionBy(): argument tag an invalid tag",1613:"cc.Node.getActionByTag(): argument tag is an invalid tag",1617:"child must be non-null",1618:"cc.Node.runAction(): action must be non-null",1619:"callback function must be non-null",1620:"interval must be positive",1623:"Set '%s' to normal node (not persist root node).",1624:"Replacing with the same sgNode",1625:"The replacement sgNode should not contain any child.",1626:"Should not set alpha via 'color', set 'opacity' please.",1627:"Not support for asynchronous creating node in SG",1632:"Node name can not include '/'.",1633:"Internal error, should not remove unknown node from parent.",1634:"addChild: The child to add must be instance of cc.Node, not %s.",1635:"reorderChild: this child is not in children list.",1636:"Node's zIndex value can't be greater than cc.macro.MAX_ZINDEX, setting to the maximum value",1637:"Node's zIndex value can't be smaller than cc.macro.MIN_ZINDEX, setting to the minimum value",1638:"Private node's zIndex can't be set, it will keep cc.macro.MIN_ZINDEX as its value",1639:"cc.Action is deprecated now, please use cc.TweenAction instead",1800:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",1801:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",1802:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",1803:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",1900:"Invalid parameter.",2e3:"Don't call this method if the event is for touch.",2200:"Resolution not valid",2201:"should set resolutionPolicy",2300:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",2400:"WebGL error %s",2602:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",2603:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",2606:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",2607:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",2608:"%s is null, please check.",2609:"cc.Sprite.initWithFile(): filename should be non-null",2610:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",2614:"cc.Sprite.addChild(): child should be non-null",2616:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",2617:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",2618:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",2619:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",2623:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",2625:"too many tiles, only 16384 tiles will be show",2626:"Unrecognized fill type in bar fill",2627:"Can not generate quad",2628:"%s does not exist",2712:"Invalid spriteFrameName",3005:"cocos2d: '%s' id=%s %s x %s",3006:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",3007:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",3103:"cc.Texture.addImage(): path should be non-null",3112:"cc.Texture.addImage(): path should be non-null",3113:"NSInternalInconsistencyException",3116:"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures",3117:"Mimpap texture only works in POT textures",3119:"Lazy init texture with image element failed due to image loading failure: %s",3120:"Loading texture from '%s' with unsupported type: '%s'. Add '%s' into 'cc.macro.SUPPORT_TEXTURE_FORMATS' please.",3300:"Rect width exceeds maximum margin: %s",3400:"Rect height exceeds maximum margin: %s",3500:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",3501:"Invalid listener type!",3502:"Can't set fixed priority with scene graph based listener.",3503:"Invalid parameters.",3504:"listener must be a cc.EventListener object when adding a fixed priority listener",3505:"The listener has been registered, please don't register it again.",3506:"Unsupported listener target.",3507:"Invalid scene graph priority!",3508:"If program goes here, there should be event in dispatch.",3509:"_inDispatch should be 1 here.",3510:"%s's scene graph node not contains in the parent's children",3511:"event is undefined",3600:"cc.Class will automatically call super constructor of %s, you should not call it manually.",3601:"The editor property 'playOnFocus' should be used with 'executeInEditMode' in class '%s'",3602:"Unknown editor property '%s' in class '%s'.",3603:"Use 'cc.Float' or 'cc.Integer' instead of 'cc.Number' please.",3604:"Can only indicate one type attribute for %s.",3605:"The default value of %s is not instance of %s.",3606:"No needs to indicate the '%s' attribute for %s, which its default value is type of %s.",3607:"The default value of %s must be an empty string.",3608:"The type of %s must be cc.String, not String.",3609:"The type of %s must be cc.Boolean, not Boolean.",3610:"The type of %s must be cc.Float or cc.Integer, not Number.",3611:"Can not indicate the '%s' attribute for %s, which its default value is type of %s.",3612:"%s Just set the default value to 'new %s()' and it will be handled properly.",3613:"'No need to use 'serializable: false' or 'editorOnly: true' for the getter of '%s.%s', every getter is actually non-serialized.",3614:"Should not define constructor for cc.Component %s.",3615:"Each script can have at most one Component.",3616:"Should not specify class name %s for Component which defines in project.",3617:"Can not instantiate CCClass '%s' with arguments.",3618:"ctor of '%s' can not be another CCClass",3619:"ctor of '%s' must be function type",3620:"this._super declared in '%s.%s' but no super method defined",3621:"Unknown type of %s.%s, maybe you want is '%s'.",3622:"Unknown type of %s.%s, property should be defined in 'properties' or 'ctor'",3623:"Can not use 'editor' attribute, '%s' not inherits from Components.",3624:"'%s' overrided '%s' but '%s' is defined as 'false' so the super method will not be called. You can set '%s' to null to disable this warning.",3625:"[isChildClassOf] superclass should be function type, not",3626:"Can't remove '%s' because '%s' depends on it.",3627:"Should not add renderer component (%s) to a Canvas node.",3628:"Should not add %s to a node which size is already used by its other component.",3633:"Properties function of '%s' should return an object!",3634:"Disallow to use '.' in property name",3635:"Default array must be empty, set default value of %s.%s to [], and initialize in 'onLoad' or 'ctor' please. (just like 'this.%s = [...];')",3636:"Do not set default value to non-empty object, unless the object defines its own 'clone' function. Set default value of %s.%s to null or {}, and initialize in 'onLoad' or 'ctor' please. (just like 'this.%s = {foo: bar};')",3637:"Can not declare %s.%s, it is already defined in the prototype of %s",3638:"'%s': the getter of '%s' is already defined!",3639:"Can not apply the specified attribute to the getter of '%s.%s', attribute index: %s",3640:"'%s': the setter of '%s' is already defined!",3641:"Can not construct %s because it contains object property.",3642:"Cannot define %s.%s because static member name can not be '%s'.",3643:"Can not define a member called 'constructor' in the class '%s', please use 'ctor' instead.",3644:"Please define 'type' parameter of %s.%s as the actual constructor.",3645:"Please define 'type' parameter of %s.%s as the constructor of %s.",3646:"Unknown 'type' parameter of %s.%s\uff1a%s",3647:"The length of range array must be equal or greater than 2",3648:"Can not declare %s.%s method, it is already defined in the properties of %s.",3649:"CCClass %s have conflict between its ctor and __ctor__.",3651:'Can not call `_super` or `prototype.ctor` in ES6 Classes "%s", use `super` instead please.',3652:"Failed to `new %s()` under the hood, %s\nIt is used for getting default values declared in TypeScript in the first place.\nPlease ensure the constructor can be called during the script's initialization.",3653:'Please do not specifiy "default" attribute in decorator of "%s" property in "%s" class.  \nDefault value must be initialized at their declaration:\n \n// Before:\n@property({\n  type: cc.Integer\n  default: 0  // <--\n})\nmyProp;\n// After:\n@property({\n  type: cc.Integer\n})\nmyProp = 0;   // <--',3654:'Please specifiy a default value for "%s.%s" at its declaration:\n \n// Before:\n@property(...)\nmyProp;\n// After:\n@property(...)\nmyProp = 0;',3655:'Can not specifiy "get" or "set"  attribute in decorator for "%s" property in "%s" class.  \nPlease use:\n \n@property(...)\nget %s () {\n    ...\n}\n@property\nset %s (value) {\n    ...\n}',3656:"The default value of %s.%s must be an empty string.",3700:"internal error: _prefab is undefined",3701:"Failed to load prefab asset for node '%s'",3800:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3801:"The node can not be made persist because it's not under root node.",3802:"The node can not be made persist because it's not in current scene.",3803:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3804:"getComponent: Type must be non-nil",3805:"Can't add component '%s' because %s already contains the same component.",3806:"Can't add component '%s' to %s because it conflicts with the existing '%s' derived component.",3807:"addComponent: Failed to get class '%s'",3808:"addComponent: Should not add component ('%s') when the scripts are still loading.",3809:"addComponent: The component to add must be a constructor",3810:"addComponent: The component to add must be child class of cc.Component",3811:"_addComponentAt: The component to add must be a constructor",3812:"_addComponentAt: Index out of range",3813:"removeComponent: Component must be non-nil",3814:"Argument must be non-nil",3815:"Component not owned by this entity",3816:"Node '%s' is already activating",3817:"Sorry, the component of '%s' which with an index of %s is corrupted! It has been removed.",3818:"Failed to read or parse project.json",3819:"Warning: target element is not a DIV or CANVAS",3820:"The renderer doesn't support the renderMode %s",3821:"Cannot change hierarchy while activating or deactivating the parent.",3900:"Invalid clip to add",3901:"Invalid clip to remove",3902:"clip is defaultClip, set force to true to force remove clip and animation state",3903:"animation state is playing, set force to true to force stop and remove clip and animation state",3904:"motion path of target [%s] in prop [%s] frame [%s] is not valid",3905:"sprite frames must be an Array.",3906:"Can't find easing type [%s]",3907:"animator not added or already removed",3912:"already-playing",4e3:"Sorry, the cc.Font has been modified from Raw Asset to Asset. Please load the font asset before using.",4003:"Label font size can't be shirnked less than 0!",4004:"force notify all fonts loaded!",4011:"Property spriteFrame of Font '%s' is invalid. Using system font instead.",4012:"The texture of Font '%s' must be already loaded on JSB. Using system font instead.",4013:"Sorry, lineHeight of system font not supported on JSB.",4200:"MaskType: IMAGE_STENCIL only support WebGL mode.",4201:"The alphaThreshold invalid in Canvas Mode.",4202:"The inverted invalid in Canvas Mode.",4300:"can not found the %s page.",4400:"Invalid RichText img tag! The sprite frame name can't be found in the ImageAtlas!",4600:"Script attached to '%s' is missing or invalid.",4700:"The dom control is not created!",4800:"unknown asset type",4901:"loadRes: should not specify the extname in %s %s",4902:"No need to release non-cached asset.",4903:"Can not get class '%s'",4914:"Resources url '%s' does not exist.",4915:"Pack indices and data do not match in size",4916:"Failed to download package for %s",4920:"Sorry, you shouldn't use id as item identity any more, please use url or uuid instead, the current id is being set as url: (%s)",4921:"Invalid pipe or invalid index provided!",4922:"The pipe to be inserted is already in the pipeline!",4923:"Uuid Loader: Parse asset [ %s ] failed : %s",4924:"JSON Loader: Input item doesn't contain string content",4925:"Uuid Loader: Deserialize asset [ %s ] failed : %s",4926:"Audio Downloader: no web audio context.",4927:"Audio Downloader: audio not supported on this browser!",4928:"Load %s failed!",4929:"Load Webp ( %s ) failed",4930:"Load image ( %s ) failed",4931:"Download Uuid: can not find type of raw asset[ %s ]: %s",4932:'Since v1.10, for any atlas ("%s") in the "resources" directory, it is not possible to find the contained SpriteFrames via `loadRes`, `getRes` or `releaseRes`. Load the SpriteAtlas first and then use `spriteAtlas.getSpriteFrame(name)` instead please.',4933:"Download Font [ %s ] failed, using Arial or system default font instead",5e3:"object already destroyed",5001:"object not yet destroyed",5100:"Not a plist file!",5200:"Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option",5201:"browser don't support web audio",5202:"This feature supports WebGL render mode only.",5300:"Type of target to deserialize not matched with data: target is %s, data is %s",5301:"Can not find script '%s'",5302:"Can not find class '%s'",5402:"cc.js.addon called on non-object:",5403:"cc.js.mixin: arguments must be type object:",5404:"The base class to extend from must be non-nil",5405:"The class to extend must be non-nil",5406:"Class should be extended before assigning any prototype members.",5500:"'notify' can not be used in 'get/set' !",5501:"'notify' must be used with 'default' !",5502:"Invalid url of %s.%s",5503:"The 'url' attribute of '%s.%s' is undefined when loading script.",5504:"The 'url' type of '%s.%s' must be child class of cc.RawAsset.",5505:"The 'url' type of '%s.%s' must not be child class of cc.Asset, otherwise you should use 'type: %s' instead.",5506:"Can not specify 'type' attribute for '%s.%s', because its 'url' is already defined.",5507:"The 'default' attribute of '%s.%s' must be an array",5508:"Invalid type of %s.%s",5509:"The 'type' attribute of '%s.%s' must be child class of cc.Asset, otherwise you should use 'url: %s' instead",5510:"The 'type' attribute of '%s.%s' can not be 'Number', use cc.Float or cc.Integer instead please.",5511:"The 'type' attribute of '%s.%s' is undefined when loading script",5512:"Can not serialize '%s.%s' because the specified type is anonymous, please provide a class name or set the 'serializable' attribute of '%s.%s' to 'false'.",5513:"The 'default' value of '%s.%s' should not be used with a 'get' function.",5514:"The 'default' value of '%s.%s' should not be used with a 'set' function.",5515:"The 'default' value of '%s.%s' can not be an constructor. Set default to null please.",5516:"Property '%s.%s' must define at least one of 'default', 'get' or 'set'.",5517:"'%s.%s' hides inherited property '%s.%s'. To make the current property override that implementation, add the `override: true` attribute please.",5601:"Can not get current scene.",5602:"Scene is destroyed",5603:"reference node is destroyed",5700:"no %s or %s on %s",5800:"%s.lerp not yet implemented.",5801:"%s.clone not yet implemented.",5802:"%s.equals not yet implemented.",5900:"MotionStreak only support WebGL mode.",5901:"cc.MotionStreak.getOpacity has not been supported.",5902:"cc.MotionStreak.setOpacity has not been supported.",6e3:"Custom should not be false if file is not specified.",6001:"The new %s must not be NaN",6017:"Incomplete or corrupt PNG file",6018:"Invalid filter algorithm: %s",6019:"Invalid byte order value.",6020:"You forgot your towel!",6021:"Unknown Field Tag: %s",6022:"Too many bits requested",6023:"No bits requested",6024:"Cannot recover from missing StripByteCounts",6025:"Cannot handle sub-byte bits per sample",6026:"Cannot handle sub-byte bits per pixel",6027:"Palette image missing color map",6028:"Unknown Photometric Interpretation: %s",6029:"Unkown error",6030:"cc.ParticleSystem: error decoding or ungzipping textureImageData",6031:"cc.ParticleSystem: unknown image format with Data",6032:"cc.ParticleSystem.initWithDictionary() : error loading the texture",6400:"asset.url is not usable in core process",6402:"AssetLibrary has already been initialized!",6500:"Widget target must be one of the parent nodes of it",6600:"collider not added or already removed",6601:"Can't find testFunc for (%s, $s).",6700:"Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time.",6800:"Callback of event must be non-nil",6801:"The message must be provided",6900:"The thing you want to instantiate must be an object",6901:"The thing you want to instantiate is nil",6902:"The thing you want to instantiate is destroyed",6903:"The instantiate method for given asset do not implemented",6904:"Can not instantiate array",6905:"Can not instantiate DOM element",7e3:"Failed to init asset's raw path.",7001:"Should not load '%s' from script dynamically, unless it is placed in the 'resources' folder.",7002:"Sorry can not load '%s' because it is not placed in the 'resources' folder.",7003:"Failed to init builtin asset's raw path.",7100:"%s already defined in Enum.",7101:"Sorry, 'cc.Enum' not available on this platform, please report this error here: https://github.com/cocos-creator/engine/issues/new",7200:"Method 'initWithTMXFile' is no effect now, please set property 'tmxAsset' instead.",7201:"Method 'initWithXML' is no effect now, please set property 'tmxAsset' instead.",7202:"Add component TiledLayer into node failed.",7203:"Property 'mapLoaded' is unused now. Please write the logic to the callback 'start'.",7210:"TMX Hexa zOrder not supported",7211:"TMX invalid value",7215:"cocos2d: Warning: TMX Layer %s has no tiles",7216:"cocos2d: TMXFormat: Unsupported TMX version: %s",7217:"cocos2d: TMXFomat: Unsupported orientation: %s",7218:"cc.TMXMapInfo.parseXMLFile(): unsupported compression method",7219:"cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported",7221:"cc.TMXMapInfo.parseXMLFile(): Texture '%s' not found.",7222:"Parse %s failed.",7236:"cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released",7237:"cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released",7238:"cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released",7239:"cc.TMXLayer.setTileGID(): invalid gid: %s",7240:"cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released",7241:"cc.TiledMap.initWithXML(): Map not found. Please check the filename.",7401:"Failed to set _defaultArmatureIndex for '%s' because the index is out of range.",7402:"Failed to set _animationIndex for '%s' because the index is out of range.",7501:"Failed to set _defaultSkinIndex for '%s' because the index is out of range.",7502:"Failed to set _animationIndex for '%s' because its skeletonData is invalid.",7503:"Failed to set _animationIndex for '%s' because the index is out of range.",7504:"Can not render dynamic created SkeletonData",7505:"Invalid type of atlasFile, atlas should be registered as raw asset.",7506:"Failed to load spine atlas '$s'",7507:"Please re-import '%s' because its textures is not initialized! (This workflow will be improved in the future.)",7508:"The atlas asset of '%s' is not exists!",7509:"Spine: Animation not found: %s",7510:"Spine: Animation not found: %s",7600:"The context of RenderTexture is invalid.",7601:"cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;",7602:"Could not attach texture to the framebuffer",7603:"clearDepth isn't supported on Cocos2d-Html5",7604:"saveToFile isn't supported on Cocos2d-Html5",7605:"newCCImage isn't supported on Cocos2d-Html5",7700:"On the web is always keep the aspect ratio",7701:"Can't know status",7702:"Video player's duration is not ready to get now!",7800:"Web does not support loading",7801:"Web does not support query history",7802:"Web does not support query history",7803:"The current browser does not support the GoBack",7804:"The current browser does not support the GoForward",7805:"Web does not support zoom",7900:"cc.math.Matrix3.assign(): current matrix equals matIn",7901:"cc.math.mat4Assign(): pOut equals pIn",7902:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7903:"cc.math.Matrix4 equal: pMat1 and pMat2 are same object.",7904:"cc.math.Matrix4.extractPlane: Invalid plane index",7905:"cc.math.mat4Assign(): pOut equals pIn",7906:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7907:"cc.math.Matrix4 equals: pMat1 and pMat2 are same object.",7908:"Invalid matrix mode specified",7909:"current quaternion is an invalid value",8e3:"Can't handle this field type or size",8001:"No bytes requested",8002:"Too many bytes requested",8003:"Missing StripByteCounts!",8103:"cc.GLProgram.link(): Cannot link invalid program",8104:"cocos2d: ERROR: Failed to link program: %s",8105:"cocos2d: cc.shaderCache._loadDefaultShader, error shader type",8106:"Please load the resource firset : %s",8107:"cc.GLProgram.getUniformLocationForName(): uniform name should be non-null",8108:"cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized",8109:"modelView matrix is undefined.",8200:"Please set node's active instead of rigidbody's enabled.",8300:"Should only one camera exists, please check your project.",8301:"Camera does not support Canvas Mode.",8400:"Wrong type arguments, 'filePath' must be a String.",8401:"Since 1.10, `%s` accept %s instance directly, not a URL string. Please directly reference the %s object in your script, or load %s by loader first. Don't use %s's URL anymore.",9e3:"Stencil manager does not support level bigger than %d in this device.",9001:"Stencil manager is already empty, cannot pop any mask.",9100:"LabelAtlas '%s' cannot be loaded, raw texture does not exist.",9101:"LabelAtlas '%s' cannot be loaded, fnt data does not exist.",9102:"Program not support highp precision, will change to mediump.",9103:"%s : Failed to set property [%s], property not found.",9104:"%s : Failed to define [%s], define not found.",9105:"%s : Failed to set property [%s], property length not correct.",9106:"%s : Set property [%s] warning : should transform object to ArrayBuffer.",9107:"%s : illegal property: [%s], myabe defined an unused property;",9200:"cc.view.enableAntiAlias is deprecated now, please use cc.Texture2D.setFilters instead","0100":"%s not yet implemented."};},{}],2:[function(t,e,i){"use strict";t("../core/platform/CCClass");var r=t("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID;},clone:function(){var t=new cc.Action();return t.originalTarget=null,t.target=null,t.tag=this.tag,t;},isDone:function(){return!0;},startWithTarget:function(t){this.originalTarget=t,this.target=t;},stop:function(){this.target=null;},step:function(t){cc.logID(1006);},update:function(t){cc.logID(1007);},getTarget:function(){return this.target;},setTarget:function(t){this.target=t;},getOriginalTarget:function(){return this.originalTarget;},setOriginalTarget:function(t){this.originalTarget=t;},getTag:function(){return this.tag;},setTag:function(t){this.tag=t;},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction",extends:cc.Action,ctor:function(){this._duration=0;},getDuration:function(){return this._duration*(this._timesForRepeat||1);},setDuration:function(t){this._duration=t;},reverse:function(){return cc.logID(1008),null;},clone:function(){return new cc.FiniteTimeAction();}}),cc.Speed=cc.Class({name:"cc.Speed",extends:cc.Action,ctor:function(t,e){this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e);},getSpeed:function(){return this._speed;},setSpeed:function(t){this._speed=t;},initWithAction:function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(cc.errorID(1021),!1);},clone:function(){var t=new cc.Speed();return t.initWithAction(this._innerAction.clone(),this._speed),t;},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t);},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this);},step:function(t){this._innerAction.step(t*this._speed);},isDone:function(){return this._innerAction.isDone();},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed);},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t);},getInnerAction:function(){return this._innerAction;}}),cc.speed=function(t,e){return new cc.Speed(t,e);},cc.Follow=cc.Class({name:"cc.Follow",extends:cc.Action,ctor:function(t,e){this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t));},clone:function(){var t=new cc.Follow();var e=this._worldRect;e=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,e),t;},isBoundarySet:function(){return this._boundarySet;},setBoudarySet:function(t){this._boundarySet=t;},initWithTarget:function(t,e){if(!t)return cc.errorID(1022),!1;var i=this;e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!(0===e.width&&0===e.height),i._boundaryFullyCovered=!1;t=cc.winSize;return i._fullScreenSize=cc.v2(t.width,t.height),i._halfScreenSize=i._fullScreenSize.mul(.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0)),!0;},step:function(t){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO);var i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO);e=e.sub(i);i=this.target.parent.convertToNodeSpaceAR(e.add(this._halfScreenSize));this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(r.clampf(i.x,this.leftBoundary,this.rightBoundary),r.clampf(i.y,this.bottomBoundary,this.topBoundary)):this.target.setPosition(i.x,i.y);},isDone:function(){return!this._followedNode.activeInHierarchy;},stop:function(){this.target=null,cc.Action.prototype.stop.call(this);}}),cc.follow=function(t,e){return new cc.Follow(t,e);};},{"../core/platform/CCClass":189,"../core/utils/misc":264}],3:[function(t,e,i){"use strict";function getControlPointAt(t,e){return t[Math.min(t.length-1,Math.max(e,0))];}function reverseControlPoints(t){var e=[];for(var i=t.length-1;0<=i;i--)e.push(cc.v2(t[i].x,t[i].y));return e;}function cloneControlPoints(t){var e=[];for(var i=0;i<t.length;i++)e.push(cc.v2(t[i].x,t[i].y));return e;}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null,void 0!==i&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,i);},initWithDuration:function(t,e,i){return e&&0!==e.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0):(cc.errorID(1024),!1);},clone:function(){var t=new cc.CardinalSplineTo();return t.initWithDuration(this._duration,cloneControlPoints(this._points),this._tension),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.v2(this.target.x,this.target.y),this._accumulatedDiff=cc.v2(0,0);},update:function(t){t=this._computeEaseTime(t);var e=this._points;t=1===t?(r=e.length-1,1):(t-(i=this._deltaT)*(r=0|t/i))/i;i=getControlPointAt(e,r-1),s=getControlPointAt(e,+r),l=getControlPointAt(e,r+1),e=getControlPointAt(e,r+2),r=this._tension,o=(r=(1-r)/2)*(2*(n=(t=t)*t)-(a=n*t)-t),c=r*(n-a)+(2*a-3*n+1),t=r*(a-2*n+t)+(-2*a+3*n),r*=a-n,a=i.x*o+s.x*c+l.x*t+e.x*r,n=i.y*o+s.y*c+l.y*t+e.y*r;o=cc.v2(a,n);var i,r,n,a,o;var s,c,l;cc.macro.ENABLE_STACKABLE_ACTIONS&&(s=this.target.x-this._previousPosition.x,c=this.target.y-this._previousPosition.y,0==s&&0===c||(s=(l=this._accumulatedDiff).x+s,c=l.y+c,l.x=s,l.y=c,o.x+=s,o.y+=c)),this.updatePosition(o);},reverse:function(){var t=reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension);},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t;},getPoints:function(){return this._points;},setPoints:function(t){this._points=t;}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i);},cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy",extends:cc.CardinalSplineTo,ctor:function(t,e,i){this._startPosition=cc.v2(0,0),void 0!==i&&this.initWithDuration(t,e,i);},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.x,this._startPosition.y=t.y;},reverse:function(){var t=this._points.slice();var e;var i=t[0];for(var r=1;r<t.length;++r)e=t[r],t[r]=e.sub(i),i=e;var n=reverseControlPoints(t);i=n[n.length-1],n.pop(),i.x=-i.x,i.y=-i.y,n.unshift(i);for(r=1;r<n.length;++r)(e=n[r]).x=-e.x,e.y=-e.y,e.x+=i.x,e.y+=i.y,i=n[r]=e;return cc.cardinalSplineBy(this._duration,n,this._tension);},updatePosition:function(t){var e=this._startPosition;var i=t.x+e.x;t=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=t,this.target.setPosition(i,t);},clone:function(){var t=new cc.CardinalSplineBy();return t.initWithDuration(this._duration,cloneControlPoints(this._points),this._tension),t;}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i);},cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo",extends:cc.CardinalSplineTo,ctor:function(t,e){e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5);},clone:function(){var t=new cc.CatmullRomTo();return t.initWithDuration(this._duration,cloneControlPoints(this._points)),t;}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e);},cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy",extends:cc.CardinalSplineBy,ctor:function(t,e){e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5);},clone:function(){var t=new cc.CatmullRomBy();return t.initWithDuration(this._duration,cloneControlPoints(this._points)),t;}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e);};},{}],4:[function(l,h,u){"use strict";cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate);},reverse:function(){return cc.easeIn(1/this._rate);}};},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate);},reverse:function(){return cc.easeOut(1/this._rate);}};},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate);},reverse:function(){return cc.easeInOut(this._rate);}};};var t={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1));},reverse:function(){return e;}};cc.easeExponentialIn=function(){return t;};var e={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t);},reverse:function(){return t;}};cc.easeExponentialOut=function(){return e;};var i={easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t;},reverse:function(){return i;}};cc.easeExponentialInOut=function(){return i;};var r={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1;},reverse:function(){return n;}};cc.easeSineIn=function(){return r;};var n={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2);},reverse:function(){return r;}};cc.easeSineOut=function(){return n;};var a={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1);},reverse:function(){return a;}};cc.easeSineInOut=function(){return a;};var o={easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3));},reverse:function(){return s;}};cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(--t,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period));},reverse:function(){return cc.easeElasticOut(this._period);}}:o;};var s={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1;},reverse:function(){return o;}};function _bounceTime(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1;},reverse:function(){return cc.easeElasticIn(this._period);}}:s;},cc.easeElasticInOut=function(t){return{_period:t=t||.3,easing:function(t){var e=this._period;var i;return 0===t||1===t?t:(t*=2,i=(e=e||(this._period=.3*1.5))/4,--t<0?-.5*Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/e):Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/e)*.5+1);},reverse:function(){return cc.easeElasticInOut(this._period);}};};var c={easing:function(t){return 1-_bounceTime(1-t);},reverse:function(){return _;}};cc.easeBounceIn=function(){return c;};var _={easing:_bounceTime,reverse:function(){return c;}};cc.easeBounceOut=function(){return _;};var d={easing:function(t){return t<.5?.5*(1-_bounceTime(1-(t*=2))):.5*_bounceTime(2*t-1)+.5;},reverse:function(){return d;}};cc.easeBounceInOut=function(){return d;};var f={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158);},reverse:function(){return p;}};cc.easeBackIn=function(){return f;};var p={easing:function(t){return--t*t*(2.70158*t+1.70158)+1;},reverse:function(){return f;}};cc.easeBackOut=function(){return p;};var m={easing:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)/2:(t-=2)*t*((1+e)*t+e)/2+1;},reverse:function(){return m;}};cc.easeBackInOut=function(){return m;},cc.easeBezierAction=function(e,i,r,n){return{easing:function(t){return Math.pow(1-t,3)*e+3*t*Math.pow(1-t,2)*i+3*Math.pow(t,2)*(1-t)*r+Math.pow(t,3)*n;},reverse:function(){return cc.easeBezierAction(n,r,i,e);}};};var v={easing:function(t){return Math.pow(t,2);},reverse:function(){return v;}};cc.easeQuadraticActionIn=function(){return v;};var y={easing:function(t){return-t*(t-2);},reverse:function(){return y;}};cc.easeQuadraticActionOut=function(){return y;};var g={easing:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1);},reverse:function(){return g;}};cc.easeQuadraticActionInOut=function(){return g;};var b={easing:function(t){return t*t*t*t;},reverse:function(){return b;}};cc.easeQuarticActionIn=function(){return b;};var C={easing:function(t){return-(--t*t*t*t-1);},reverse:function(){return C;}};cc.easeQuarticActionOut=function(){return C;};var x={easing:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2);},reverse:function(){return x;}};cc.easeQuarticActionInOut=function(){return x;};var A={easing:function(t){return t*t*t*t*t;},reverse:function(){return A;}};cc.easeQuinticActionIn=function(){return A;};var S={easing:function(t){return--t*t*t*t*t+1;},reverse:function(){return S;}};cc.easeQuinticActionOut=function(){return S;};var T={easing:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2);},reverse:function(){return T;}};cc.easeQuinticActionInOut=function(){return T;};var w={easing:function(t){return-1*(Math.sqrt(1-t*t)-1);},reverse:function(){return w;}};cc.easeCircleActionIn=function(){return w;};var E={easing:function(t){return--t,Math.sqrt(1-t*t);},reverse:function(){return E;}};cc.easeCircleActionOut=function(){return E;};var P={easing:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1));},reverse:function(){return P;}};cc.easeCircleActionInOut=function(){return P;};var M={easing:function(t){return t*t*t;},reverse:function(){return M;}};cc.easeCubicActionIn=function(){return M;};var R={easing:function(t){return--t*t*t+1;},reverse:function(){return R;}};cc.easeCubicActionOut=function(){return R;};var I={easing:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2);},reverse:function(){return I;}};cc.easeCubicActionInOut=function(){return I;};},{}],5:[function(t,e,i){"use strict";cc.ActionInstant=cc.Class({name:"cc.ActionInstant",extends:cc.FiniteTimeAction,isDone:function(){return!0;},step:function(t){this.update(1);},update:function(t){},reverse:function(){return this.clone();},clone:function(){return new cc.ActionInstant();}}),cc.Show=cc.Class({name:"cc.Show",extends:cc.ActionInstant,update:function(t){var e=this.target.getComponentsInChildren(cc.RenderComponent);for(var i=0;i<e.length;++i)e[i].enabled=!0;},reverse:function(){return new cc.Hide();},clone:function(){return new cc.Show();}}),cc.show=function(){return new cc.Show();},cc.Hide=cc.Class({name:"cc.Hide",extends:cc.ActionInstant,update:function(t){var e=this.target.getComponentsInChildren(cc.RenderComponent);for(var i=0;i<e.length;++i)e[i].enabled=!1;},reverse:function(){return new cc.Show();},clone:function(){return new cc.Hide();}}),cc.hide=function(){return new cc.Hide();},cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility",extends:cc.ActionInstant,update:function(t){var e=this.target.getComponentsInChildren(cc.RenderComponent);for(var i=0;i<e.length;++i){var r=e[i];r.enabled=!r.enabled;}},reverse:function(){return new cc.ToggleVisibility();},clone:function(){return new cc.ToggleVisibility();}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility();},cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf",extends:cc.ActionInstant,ctor:function(t){this._isNeedCleanUp=!0,void 0!==t&&this.init(t);},update:function(t){this.target.removeFromParent(this._isNeedCleanUp);},init:function(t){return this._isNeedCleanUp=t,!0;},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp);},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp);}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t);},cc.DestroySelf=cc.Class({name:"cc.DestroySelf",extends:cc.ActionInstant,update:function(){this.target.destroy();},reverse:function(){return new cc.DestroySelf();},clone:function(){return new cc.DestroySelf();}}),cc.destroySelf=function(){return new cc.DestroySelf();},cc.FlipX=cc.Class({name:"cc.FlipX",extends:cc.ActionInstant,ctor:function(t){this._flippedX=!1,void 0!==t&&this.initWithFlipX(t);},initWithFlipX:function(t){return this._flippedX=t,!0;},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1);},reverse:function(){return new cc.FlipX(!this._flippedX);},clone:function(){var t=new cc.FlipX();return t.initWithFlipX(this._flippedX),t;}}),cc.flipX=function(t){return new cc.FlipX(t);},cc.FlipY=cc.Class({name:"cc.FlipY",extends:cc.ActionInstant,ctor:function(t){this._flippedY=!1,void 0!==t&&this.initWithFlipY(t);},initWithFlipY:function(t){return this._flippedY=t,!0;},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1);},reverse:function(){return new cc.FlipY(!this._flippedY);},clone:function(){var t=new cc.FlipY();return t.initWithFlipY(this._flippedY),t;}}),cc.flipY=function(t){return new cc.FlipY(t);},cc.Place=cc.Class({name:"cc.Place",extends:cc.ActionInstant,ctor:function(t,e){this._x=0,void(this._y=0)!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e));},initWithPosition:function(t,e){return this._x=t,this._y=e,!0;},update:function(t){this.target.setPosition(this._x,this._y);},clone:function(){var t=new cc.Place();return t.initWithPosition(this._x,this._y),t;}}),cc.place=function(t,e){return new cc.Place(t,e);},cc.CallFunc=cc.Class({name:"cc.CallFunc",extends:cc.ActionInstant,ctor:function(t,e,i){this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(t,e,i);},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0;},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data);},update:function(t){this.execute();},getTargetCallback:function(){return this._selectorTarget;},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t);},clone:function(){var t=new cc.CallFunc();return t.initWithFunction(this._function,this._selectorTarget,this._data),t;}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i);};},{}],6:[function(t,e,i){"use strict";function bezierAt(t,e,i,r,n){return Math.pow(1-n,3)*t+3*n*Math.pow(1-n,2)*e+3*Math.pow(n,2)*(1-n)*i+Math.pow(n,3)*r;}cc.ActionInterval=cc.Class({name:"cc.ActionInterval",extends:cc.FiniteTimeAction,ctor:function(t){this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=null,this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,void 0!==t&&cc.ActionInterval.prototype.initWithDuration.call(this,t);},getElapsed:function(){return this._elapsed;},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0;},isDone:function(){return this._elapsed>=this._duration;},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod;},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse());}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t;},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this;},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,r=e.length;i<r;i++)t=e[i].easing(t);return t;},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7);this.update(0<(t=t<1?t:1)?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration));},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0;},reverse:function(){return cc.logID(1010),null;},setAmplitudeRate:function(t){cc.logID(1011);},getAmplitudeRate:function(){return cc.logID(1012),0;},speed:function(t){return t<=0?cc.logID(1013):(this._speedMethod=!0,this._speed*=t),this;},getSpeed:function(){return this._speed;},setSpeed:function(t){return this._speed=t,this;},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?cc.logID(1014):(this._repeatMethod=!0,this._timesForRepeat*=t),this;},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this;}}),cc.actionInterval=function(t){return new cc.ActionInterval(t);},cc.Sequence=cc.Class({name:"cc.Sequence",extends:cc.ActionInterval,ctor:function(t){this._actions=[],this._split=null,this._last=0,this._reversed=!1;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){var r,n=e[0];for(var a=1;a<i;a++)e[a]&&(r=n,n=cc.Sequence._actionOneTwo(r,e[a]));this.initWithTwoActions(n,e[i]);}}else cc.errorID(1019);},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1025),!1;var i=t._duration,r=e._duration;return i*=t._repeatMethod?t._timesForRepeat:1,r*=e._repeatMethod?e._timesForRepeat:1,this.initWithDuration(i+r),this._actions[0]=t,this._actions[1]=e,!0;},clone:function(){var t=new cc.Sequence();return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1;},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this);},update:function(t){var e,i=0;var r=this._split,n=this._actions,a=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===i&&1===a&&this._reversed&&(n[1].update(0),n[1].stop())):(e=(i=1)===r?1:(t-r)/(1-r),-1===a&&(n[0].startWithTarget(this.target),n[0].update(1),n[0].stop()),0===a&&(n[0].update(1),n[0].stop())),t=n[i],a===i&&t.isDone()||(a!==i&&t.startWithTarget(this.target),e*=t._timesForRepeat,t.update(1<e?e%1:e),this._last=i);},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t;}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1019),null;var i=e.length-1;0<=i&&null==e[i]&&cc.logID(1015);var r=null;if(0<=i){r=e[0];for(var n=1;n<=i;n++)e[n]&&(r=cc.Sequence._actionOneTwo(r,e[n]));}return r;},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence();return i.initWithTwoActions(t,e),i;},cc.Repeat=cc.Class({name:"cc.Repeat",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,void 0!==e&&this.initWithAction(t,e);},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,(this._innerAction=t)instanceof cc.ActionInstant&&(this._actionInstant=!0,--this._times),!(this._total=0));},clone:function(){var t=new cc.Repeat();return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t;},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t);},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this);},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction;var i=this._duration;var r=this._times;var n=this._nextDt;if(n<=t){for(;n<t&&this._total<r;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),n+=e._duration/i,this._nextDt=1<n?1:n;1<=t&&this._total<r&&(e.update(1),this._total++),this._actionInstant||(this._total===r?e.stop():e.update(t-(n-e._duration/i)));}else e.update(t*r%1);},isDone:function(){return this._total===this._times;},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t;},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t);},getInnerAction:function(){return this._innerAction;}}),cc.repeat=function(t,e){return new cc.Repeat(t,e);},cc.RepeatForever=cc.Class({name:"cc.RepeatForever",extends:cc.ActionInterval,ctor:function(t){this._innerAction=null,t&&this.initWithAction(t);},initWithAction:function(t){return t?(this._innerAction=t,!0):(cc.errorID(1026),!1);},clone:function(){var t=new cc.RepeatForever();return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t);},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration));},isDone:function(){return!1;},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t;},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t);},getInnerAction:function(){return this._innerAction;}}),cc.repeatForever=function(t){return new cc.RepeatForever(t);},cc.Spawn=cc.Class({name:"cc.Spawn",extends:cc.ActionInterval,ctor:function(t){this._one=null,this._two=null;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(0<=i&&null==e[i]&&cc.logID(1015),0<=i){var r,n=e[0];for(var a=1;a<i;a++)e[a]&&(r=n,n=cc.Spawn._actionOneTwo(r,e[a]));this.initWithTwoActions(n,e[i]);}}else cc.errorID(1020);},initWithTwoActions:function(t,e){if(!t||!e)return cc.errorID(1027),!1;var i=!1;var r=t._duration;var n=e._duration;return this.initWithDuration(Math.max(r,n))&&(this._one=t,this._two=e,n<r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(r-n)):r<n&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(n-r))),i=!0),i;},clone:function(){var t=new cc.Spawn();return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t);},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this);},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t);},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1020),null;0<e.length&&null==e[e.length-1]&&cc.logID(1015);var i=e[0];for(var r=1;r<e.length;r++)null!=e[r]&&(i=cc.Spawn._actionOneTwo(i,e[r]));return i;},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn();return i.initWithTwoActions(t,e),i;},cc.RotateTo=cc.Class({name:"cc.RotateTo",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){this._startAngle=0,this._dstAngle=0,void(this._angle=0)!==e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngle=e,!0);},clone:function(){var t=new cc.RotateTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngle),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);t=t.angle%360;var e=cc.RotateTo._reverse?this._dstAngle-t:this._dstAngle+t;180<e&&(e-=360),e<-180&&(e+=360),this._startAngle=t,this._angle=cc.RotateTo._reverse?e:-e;},reverse:function(){cc.logID(1016);},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._angle*t);}}),cc.rotateTo=function(t,e){return new cc.RotateTo(t,e);},cc.RotateBy=cc.Class({name:"cc.RotateBy",extends:cc.ActionInterval,statics:{_reverse:!1},ctor:function(t,e){e*=cc.RotateBy._reverse?1:-1,this._deltaAngle=0,void(this._startAngle=0)!==e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaAngle=e,!0);},clone:function(){var t=new cc.RotateBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaAngle),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=t.angle;},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.angle=this._startAngle+this._deltaAngle*t);},reverse:function(){var t=new cc.RotateBy();return t.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.rotateBy=function(t,e){return new cc.RotateBy(t,e);},cc.MoveBy=cc.Class({name:"cc.MoveBy",extends:cc.ActionInterval,ctor:function(t,e,i){this._positionDelta=cc.v2(0,0),this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),void 0!==e&&cc.MoveBy.prototype.initWithDuration.call(this,t,e,i);},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0);},clone:function(){var t=new cc.MoveBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x;t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t;},update:function(t){var e,i,r,n,a;t=this._computeEaseTime(t),this.target&&(e=this._positionDelta.x*t,t=this._positionDelta.y*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(r=this.target.x,n=this.target.y,a=this._previousPosition,i.x=i.x+r-a.x,i.y=i.y+n-a.y,e+=i.x,t+=i.y,a.x=e,a.y=t,this.target.setPosition(e,t)):this.target.setPosition(i.x+e,i.y+t));},reverse:function(){var t=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i);},cc.MoveTo=cc.Class({name:"cc.MoveTo",extends:cc.MoveBy,ctor:function(t,e,i){this._endPosition=cc.v2(0,0),void 0!==e&&this.initWithDuration(t,e,i);},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0);},clone:function(){var t=new cc.MoveTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t;},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.x,this._positionDelta.y=this._endPosition.y-t.y;}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i);},cc.SkewTo=cc.Class({name:"cc.SkewTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,void(this._deltaY=0)!==i&&cc.SkewTo.prototype.initWithDuration.call(this,t,e,i);},initWithDuration:function(t,e,i){var r=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,r=!0),r;},clone:function(){var t=new cc.SkewTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360);},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t;}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i);},cc.SkewBy=cc.Class({name:"cc.SkewBy",extends:cc.SkewTo,ctor:function(t,e,i){void 0!==i&&this.initWithDuration(t,e,i);},initWithDuration:function(t,e,i){var r=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,r=!0),r;},clone:function(){var t=new cc.SkewBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t;},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY;},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i);},cc.JumpBy=cc.Class({name:"cc.JumpBy",extends:cc.ActionInterval,ctor:function(t,e,i,r,n){this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),this._delta=cc.v2(0,0),this._height=0,void(this._jumps=0)!==r&&cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,r,n);},initWithDuration:function(t,e,i,r,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===n&&(n=r,r=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=r,this._jumps=n,!0);},clone:function(){var t=new cc.JumpBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x;t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t;},update:function(t){var e,i,r,n,a;t=this._computeEaseTime(t),this.target&&(e=t*this._jumps%1,e=4*this._height*e*(1-e),e+=this._delta.y*t,t=this._delta.x*t,i=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(r=this.target.x,n=this.target.y,a=this._previousPosition,i.x=i.x+r-a.x,i.y=i.y+n-a.y,t+=i.x,e+=i.y,a.x=t,a.y=e,this.target.setPosition(t,e)):this.target.setPosition(i.x+t,i.y+e));},reverse:function(){var t=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.jumpBy=function(t,e,i,r,n){return new cc.JumpBy(t,e,i,r,n);},cc.JumpTo=cc.Class({name:"cc.JumpTo",extends:cc.JumpBy,ctor:function(t,e,i,r,n){this._endPosition=cc.v2(0,0),void 0!==r&&this.initWithDuration(t,e,i,r,n);},initWithDuration:function(t,e,i,r,n){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,r,n)&&(void 0===n&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0);},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y;},clone:function(){var t=new cc.JumpTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t;}}),cc.jumpTo=function(t,e,i,r,n){return new cc.JumpTo(t,e,i,r,n);},cc.BezierBy=cc.Class({name:"cc.BezierBy",extends:cc.ActionInterval,ctor:function(t,e){this._config=[],this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),e&&cc.BezierBy.prototype.initWithDuration.call(this,t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0);},clone:function(){var t=new cc.BezierBy();this._cloneDecoration(t);var e=[];for(var i=0;i<this._config.length;i++){var r=this._config[i];e.push(cc.v2(r.x,r.y));}return t.initWithDuration(this._duration,e),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.x;t=t.y;this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t;},update:function(t){var e,i,r,n,a,o;t=this._computeEaseTime(t),this.target&&(e=(o=this._config)[0].x,i=o[1].x,r=o[2].x,n=o[0].y,a=o[1].y,o=o[2].y,e=bezierAt(0,e,i,r,t),i=bezierAt(0,n,a,o,t),r=this._startPosition,cc.macro.ENABLE_STACKABLE_ACTIONS?(n=this.target.x,a=this.target.y,o=this._previousPosition,r.x=r.x+n-o.x,r.y=r.y+a-o.y,e+=r.x,i+=r.y,o.x=e,o.y=i,this.target.setPosition(e,i)):this.target.setPosition(r.x+e,r.y+i));},reverse:function(){var t=this._config;var e=t[0].x,i=t[0].y;var r=t[1].x,n=t[1].y;var a=t[2].x,t=t[2].y;r=[cc.v2(r-a,n-t),cc.v2(e-a,i-t),cc.v2(-a,-t)];n=new cc.BezierBy(this._duration,r);return this._cloneDecoration(n),this._reverseEaseList(n),n;}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e);},cc.BezierTo=cc.Class({name:"cc.BezierTo",extends:cc.BezierBy,ctor:function(t,e){this._toConfig=[],e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0);},clone:function(){var t=new cc.BezierTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t;},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);t=this._startPosition;var e=this._toConfig;var i=this._config;i[0]=e[0].sub(t),i[1]=e[1].sub(t),i[2]=e[2].sub(t);}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e);},cc.ScaleTo=cc.Class({name:"cc.ScaleTo",extends:cc.ActionInterval,ctor:function(t,e,i){this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,void(this._deltaY=0)!==e&&cc.ScaleTo.prototype.initWithDuration.call(this,t,e,i);},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0);},clone:function(){var t=new cc.ScaleTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY;},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t);}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i);},cc.ScaleBy=cc.Class({name:"cc.ScaleBy",extends:cc.ScaleTo,startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY;},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t;},clone:function(){var t=new cc.ScaleBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t;}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i);},cc.Blink=cc.Class({name:"cc.Blink",extends:cc.ActionInterval,ctor:function(t,e){this._times=0,this._originalState=!1,void 0!==e&&this.initWithDuration(t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0);},clone:function(){var t=new cc.Blink();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t;},update:function(t){var e;t=this._computeEaseTime(t),this.target&&!this.isDone()&&(e=1/this._times,this.target.opacity=e/2<t%e?255:0);},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity;},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this);},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.blink=function(t,e){return new cc.Blink(t,e);},cc.FadeTo=cc.Class({name:"cc.FadeTo",extends:cc.ActionInterval,ctor:function(t,e){this._toOpacity=0,void(this._fromOpacity=0)!==e&&cc.FadeTo.prototype.initWithDuration.call(this,t,e);},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0);},clone:function(){var t=new cc.FadeTo();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t;},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity;}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e);},cc.FadeIn=cc.Class({name:"cc.FadeIn",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,255);},reverse:function(){var t=new cc.FadeOut();return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t;},clone:function(){var t=new cc.FadeIn();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t;},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t);}}),cc.fadeIn=function(t){return new cc.FadeIn(t);},cc.FadeOut=cc.Class({name:"cc.FadeOut",extends:cc.FadeTo,ctor:function(t){null==t&&(t=0),this._reverseAction=null,this.initWithDuration(t,0);},reverse:function(){var t=new cc.FadeIn();return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t;},clone:function(){var t=new cc.FadeOut();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t;}}),cc.fadeOut=function(t){return new cc.FadeOut(t);},cc.TintTo=cc.Class({name:"cc.TintTo",extends:cc.ActionInterval,ctor:function(t,e,i,r){this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(r=e.b,i=e.g,e=e.r),void 0!==r&&this.initWithDuration(t,e,i,r);},initWithDuration:function(t,e,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,r),!0);},clone:function(){var t=new cc.TintTo();this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color;},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&(this.target.color=cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t));}}),cc.tintTo=function(t,e,i,r){return new cc.TintTo(t,e,i,r);},cc.TintBy=cc.Class({name:"cc.TintBy",extends:cc.ActionInterval,ctor:function(t,e,i,r){this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,void(this._fromB=0)!==r&&this.initWithDuration(t,e,i,r);},initWithDuration:function(t,e,i,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=r,!0);},clone:function(){var t=new cc.TintBy();return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);t=t.color;this._fromR=t.r,this._fromG=t.g,this._fromB=t.b;},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t);},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t;}}),cc.tintBy=function(t,e,i,r){return new cc.TintBy(t,e,i,r);},cc.DelayTime=cc.Class({name:"cc.DelayTime",extends:cc.ActionInterval,update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t;},clone:function(){var t=new cc.DelayTime();return this._cloneDecoration(t),t.initWithDuration(this._duration),t;}}),cc.delayTime=function(t){return new cc.DelayTime(t);},cc.ReverseTime=cc.Class({name:"cc.ReverseTime",extends:cc.ActionInterval,ctor:function(t){this._other=null,t&&this.initWithAction(t);},initWithAction:function(t){return t?t===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(cc.errorID(1028),!1);},clone:function(){var t=new cc.ReverseTime();return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t);},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t);},reverse:function(){return this._other.clone();},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this);}}),cc.reverseTime=function(t){return new cc.ReverseTime(t);},cc.TargetedAction=cc.Class({name:"cc.TargetedAction",extends:cc.ActionInterval,ctor:function(t,e){this._action=null,this._forcedTarget=null,e&&this.initWithTarget(t,e);},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0);},clone:function(){var t=new cc.TargetedAction();return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget);},stop:function(){this._action.stop();},update:function(t){t=this._computeEaseTime(t),this._action.update(t);},getForcedTarget:function(){return this._forcedTarget;},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t);}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e);};},{}],7:[function(t,e,i){"use strict";t("../core/platform/CCClass");var r=t("../core/platform/js");function wc(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1;}cc.ActionManager=function(){this._hashTargets=r.createMap(!0),this._arrayTargets=[],this._currentTarget=null,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this);},cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null;},_getElement:function(t,e){var i=this._elementPool.pop();return(i=i||new wc()).target=t,i.paused=!!e,i;},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t);},addAction:function(t,e,i){var r;t&&e?((r=this._hashTargets[e._id])?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets[e._id]=r,this._arrayTargets.push(r)),r.actions.push(t),t.startWithTarget(e)):cc.errorID(1e3);},removeAllActions:function(){var t=this._arrayTargets;for(var e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i);}this._arrayTargets.length=0,this._hashTargets=r.createMap(!0);},removeAllActionsFromTarget:function(t,e){null==t||(t=this._hashTargets[t._id])&&(t.actions.length=0,this._deleteHashElement(t));},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget();var i=this._hashTargets[e._id];if(i){for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1),i.actionIndex>=r&&i.actionIndex--;break;}}else cc.logID(1001);}},_removeActionByTag:function(t,e,i){for(var r=0,n=e.actions.length;r<n;++r){var a=e.actions[r];if(a&&a.getTag()===t&&(!i||a.getOriginalTarget()===i)){this._removeActionAtIndex(r,e);break;}}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002);var i=this._hashTargets;if(e){var r=i[e._id];r&&this._removeActionByTag(t,r,e);}else for(var n in i){n=i[n];this._removeActionByTag(t,n);}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1004);var i=this._hashTargets[e._id];if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n;}cc.logID(1005,t);}return null;},getNumberOfRunningActionsInTarget:function(t){t=this._hashTargets[t._id];return t&&t.actions?t.actions.length:0;},pauseTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!0);},resumeTarget:function(t){t=this._hashTargets[t._id];t&&(t.paused=!1);},pauseAllRunningActions:function(){var t=[];var e=this._arrayTargets;for(var i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target));}return t;},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e]);},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e]);},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this);},_removeActionAtIndex:function(t,e){e.actions[t];e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e);},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target._id]){delete this._hashTargets[t.target._id];var i=this._arrayTargets;for(var r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break;}this._putElement(t),e=!0;}return e;},update:function(t){var e,i=this._arrayTargets;for(var r=0;r<i.length;r++){if(this._currentTarget=i[r],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++){var n;e.currentAction=e.actions[e.actionIndex],e.currentAction&&(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()&&(e.currentAction.stop(),n=e.currentAction,e.currentAction=null,this.removeAction(n)),e.currentAction=null);}e.lock=!1;}0===e.actions.length&&this._deleteHashElement(e)&&r--;}}};},{"../core/platform/CCClass":189,"../core/platform/js":209}],8:[function(t,e,i){"use strict";t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom"),t("./tween");},{"./CCAction":2,"./CCActionCatmullRom":3,"./CCActionEase":4,"./CCActionInstant":5,"./CCActionInterval":6,"./CCActionManager":7,"./tween":9}],9:[function(s,c,h){"use strict";var l=s("../animation/bezier");var u=0;var r=cc.Class({name:"cc.TweenAction",extends:cc.ActionInterval,ctor:function(t,e,i){var r;this._opts=i=i||Object.create(null),this._props=Object.create(null),i.progress=i.progress||this.progress,i.easing&&"string"==typeof i.easing&&(r=i.easing,i.easing=cc.easing[r],i.easing||cc.warnID(1031,r));var n=this._opts.relative;for(var a in e){var o=e[a];var s=void 0,c=void 0;var l;void 0!==o.value&&(o.easing||o.progress)&&("string"==typeof o.easing?(s=cc.easing[o.easing])||cc.warnID(1031,o.easing):s=o.easing,c=o.progress,o=o.value),"number"==typeof o||o.lerp&&(!n||o.add||o.mul)&&o.clone?((l=Object.create(null)).value=o,l.easing=s,l.progress=c,this._props[a]=l):cc.warn("Can not animate "+a+" property, because it do not have [lerp, (add|mul), clone] function.");}this._originProps=e,this.initWithDuration(t);},clone:function(){var t=new r(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t;},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative;var i=this._props;for(var r in i){var n=t[r];r=i[r];"number"==typeof n?(r.start=n,r.current=n,r.end=e?n+r.value:r.value):(r.start=n.clone(),r.current=n.clone(),r.end=e?(n.add||n.mul).call(n,r.value):r.value);}},update:function(t){var e=this._opts;var i=t;e.easing&&(i=e.easing(t));var r=this.target;if(r){var n=this._props;var a=this._opts.progress;for(var o in n){var s=n[o];var c=s.easing?s.easing(t):i;s=s.current=(s.progress||a)(s.start,s.end,s.current,c);r[o]=s;}}},progress:function(t,e,i,r){return"number"==typeof t?i=t+(e-t)*r:t.lerp(e,r,i),i;}});var e=cc.Class({name:"cc.SetAction",extends:cc.ActionInstant,ctor:function(t){this._props={},void 0!==t&&this.init(t);},init:function(t){for(var e in t)this._props[e]=t[e];return!0;},update:function(){var t=this._props;var e=this.target;for(var i in t)e[i]=t[i];},clone:function(){var t=new e();return t.init(this._props),t;}});function Tween(t){this._actions=[],this._finalAction=null,this._target=t,this._tag=cc.Action.TAG_INVALID;}Tween.stopAll=function(){cc.director.getActionManager().removeAllActions();},Tween.stopAllByTag=function(t){cc.director.getActionManager().removeActionByTag(t);},Tween.stopAllByTarget=function(t){cc.director.getActionManager().removeAllActionsFromTarget(t);},Tween.prototype.then=function(t){return t instanceof cc.Action?this._actions.push(t.clone()):this._actions.push(t._union()),this;},Tween.prototype.target=function(t){return this._target=t,this;},Tween.prototype.start=function(){var t=this._target;return t?t instanceof cc.Object&&!t.isValid?void 0:(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),void 0===t._id&&(t._id=++u),this._finalAction.setTag(this._tag),cc.director.getActionManager().addAction(this._finalAction,t,!1),this):(cc.warn("Please set target to tween first"),this);},Tween.prototype.stop=function(){return this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this;},Tween.prototype.tag=function(t){return this._tag=t,this;},Tween.prototype.clone=function(t){var e=this._union();return cc.tween(t).then(e.clone());},Tween.prototype.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this;},Tween.prototype._union=function(){var t=this._actions;return t=1===t.length?t[0]:cc.sequence(t);},Object.assign(Tween.prototype,{bezierTo:function(t,e,i,r,n){var a=e.x,o=e.y,s=i.x,c=i.y;return(n=n||Object.create(null)).progress=function(t,e,i,r){return i.x=(0,l.bezier)(t.x,a,s,e.x,r),i.y=(0,l.bezier)(t.y,o,c,e.y,r),i;},this.to(t,{position:r},n);},bezierBy:function(t,e,i,r,n){var a=e.x,o=e.y,s=i.x,c=i.y;return(n=n||Object.create(null)).progress=function(t,e,i,r){var n=t.x,t=t.y;return i.x=(0,l.bezier)(n,a+n,s+n,e.x,r),i.y=(0,l.bezier)(t,o+t,c+t,e.y,r),i;},this.by(t,{position:r},n);},flipX:function(){var t=this;return this.call(function(){t._target.scaleX*=-1;},this);},flipY:function(){var t=this;return this.call(function(){t._target.scaleY*=-1;},this);},blink:function(t,e,i){var n=1/e;return(i=i||Object.create(null)).progress=function(t,e,i,r){return 1<=r?t:n/2<r%n?255:0;},this.to(t,{opacity:1},i);}});var n=[];function wrapAction(r){return function(){n.length=0;for(var t=arguments.length,e=0;e<t;e++){var i=n[e]=arguments[e];i instanceof Tween&&(n[e]=i._union());}return r.apply(this,n);};}var i={to:function(t,e,i){return(i=i||Object.create(null)).relative=!1,new r(t,e,i);},by:function(t,e,i){return(i=i||Object.create(null)).relative=!0,new r(t,e,i);},set:function(t){return new e(t);},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:wrapAction(cc.sequence),parallel:wrapAction(cc.spawn)};var _={repeat:cc.repeat,repeatForever:function(t){return cc.repeat(t,1e9);},reverseTime:cc.reverseTime};var o=Object.keys(i);for(var t=0;t<o.length;t++)!function(t){var e=o[t];Tween.prototype[e]=function(){var t=i[e].apply(this,arguments);return this._actions.push(t),this;};}(t);o=Object.keys(_);for(var a=0;a<o.length;a++)!function(t){var a=o[t];Tween.prototype[a]=function(){var t=this._actions;var e=arguments[arguments.length-1];var i=arguments.length-1;e instanceof cc.Tween?e=e._union():e instanceof cc.Action||(e=t[t.length-1],--t.length,i+=1);var r=[e];for(var n=0;n<i;n++)r.push(arguments[n]);return e=_[a].apply(this,r),t.push(e),this;};}(a);cc.tween=function(t){return new Tween(t);},cc.Tween=Tween;},{"../animation/bezier":15}],10:[function(t,e,a){"use strict";var i=cc.js;var r=t("./playable");var n=t("./animation-curves"),_=n.EventAnimCurve,d=n.EventInfo;var f=t("./types").WrapModeMask;var p=t("../core/utils/binary-search").binarySearchEpsilon;function AnimationAnimator(t,e){r.call(this),this.target=t,this.animation=e,this._anims=new i.array.MutableForwardIterator([]);}i.extend(AnimationAnimator,r);n=AnimationAnimator.prototype;function initClipData(t,e){var i=e.clip;e.duration=i.duration,e.speed=i.speed,e.wrapMode=i.wrapMode,e.frameRate=i.sample,(e.wrapMode&f.Loop)===f.Loop?e.repeatCount=1/0:e.repeatCount=1;var h=e.curves=i.createCurves(e,t);var r=i.events;var n;if(r)for(var a=0,u=r.length;a<u;a++){n||((n=new _()).target=t,h.push(n));var o=r[a];var s=o.frame/e.duration;var c=void 0;var l=p(n.ratios,s);0<=l?c=n.events[l]:(c=new d(),n.ratios.push(s),n.events.push(c)),c.add(o.func,o.params);}}n.playState=function(t,e){t.clip&&(t.curveLoaded||initClipData(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play());},n.stopStatesExcept=function(t){var e=this._anims;var i=e.array;for(e.i=0;e.i<i.length;++e.i){var r=i[e.i];r!==t&&this.stopState(r);}},n.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setEventTarget(this.animation);},n.removeAnimation=function(t){var e=this._anims.array.indexOf(t);0<=e?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3907),t.animator=null;},n.sample=function(){var t=this._anims;var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].sample();},n.stopState=function(t){t&&t.stop();},n.pauseState=function(t){t&&t.pause();},n.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume();},n.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;var i=this._anims.array;for(var r=0;r<i.length;++r){var n=i[r];n.setTime(e),n.sample();}}},n.onStop=function(){var t=this._anims;var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].stop();},n.onPause=function(){var t=this._anims.array;for(var e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null;}},n.onResume=function(){var t=this._anims.array;for(var e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume();}},n._reloadClip=function(t){initClipData(this.target,t);},e.exports=AnimationAnimator;},{"../core/utils/binary-search":256,"./animation-curves":12,"./playable":19,"./types":20}],11:[function(t,e,n){"use strict";var i=t("./types").WrapMode;var r=t("./animation-curves"),m=r.DynamicAnimCurve,v=r.quickFindIndex;var y=t("./motion-path-helper").sampleMotionPaths;var g=t("../core/utils/binary-search").binarySearchEpsilon;var s=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:cc.Float},duration:{get:function(){return this._duration;}},sample:{default:60},speed:{default:1},wrapMode:{default:i.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;var i=new s();i.sample=e||i.sample,i._duration=t.length/i.sample;var r=[];var n=1/i.sample;for(var a=0,o=t.length;a<o;a++)r[a]={frame:a*n,value:t[a]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:r}}},i;}},onLoad:function(){this._duration=Number.parseFloat(this.duration),this.speed=Number.parseFloat(this.speed),this.wrapMode=Number.parseInt(this.wrapMode),this.frameRate=Number.parseFloat(this.sample);},createPropCurve:function(t,e,i){var h=[];var u=t instanceof cc.Node&&"position"===e;var r=new m();r.target=t,r.prop=e;for(var n=0,_=i.length;n<_;n++){var a=i[n];var o=a.frame/this.duration;r.ratios.push(o),u&&h.push(a.motionPath);o=a.value;r.values.push(o);o=a.curve;if(o){if("string"==typeof o){r.types.push(o);continue;}if(Array.isArray(o)){o[0]===o[1]&&o[2]===o[3]?r.types.push(m.Linear):r.types.push(m.Bezier(o));continue;}}r.types.push(m.Linear);}u&&y(h,r,this.duration,this.sample,t);var s=r.ratios;var c,d;var f=!0;for(var l=1,p=s.length;l<p;l++)if(c=s[l]-s[l-1],1===l)d=c;else if(1e-6<Math.abs(c-d)){f=!1;break;}r._findFrameIndex=f?v:g;e=r.values[0];return null==e||r._lerp||("number"==typeof e?r._lerp=m.prototype._lerpNumber:e instanceof cc.Quat?r._lerp=m.prototype._lerpQuat:e instanceof cc.Vec2||e instanceof cc.Vec3?r._lerp=m.prototype._lerpVector:e.lerp&&(r._lerp=m.prototype._lerpObject)),r;},createTargetCurves:function(t,e,i){var r=e.props;var n=e.comps;if(r)for(var a in r){var h=r[a];a=this.createPropCurve(t,a,h);i.push(a);}if(n)for(var o in n){var s=t.getComponent(o);if(s){var c=n[o];for(var l in c){var u=c[l];l=this.createPropCurve(s,l,u);i.push(l);}}}},createCurves:function(t,e){var i=this.curveData;var r=i.paths;var n=[];for(var a in this.createTargetCurves(e,i,n),r){var o=cc.find(a,e);o&&(a=r[a],this.createTargetCurves(o,a,n));}return n;}});cc.AnimationClip=e.exports=s;},{"../core/utils/binary-search":256,"./animation-curves":12,"./motion-path-helper":18,"./types":20}],12:[function(t,e,a){"use strict";var o=t("./bezier").bezierByTime;var _=t("../core/utils/binary-search").binarySearchEpsilon;var d=t("./types").WrapModeMask;var f=t("./types").WrappedInfo;function computeRatioByType(t,e){var i;return"string"==typeof e?(i=cc.easing[e])?t=i(t):cc.errorID(3906,e):Array.isArray(e)&&(t=o(e,t)),t;}t=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:void 0});var i=cc.Class({name:"cc.DynamicAnimCurve",extends:t,ctor:function(){this._cachedIndex=0;},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:_,_lerp:void 0,_lerpNumber:function(t,e,i){return t+(e-t)*i;},_lerpObject:function(t,e,i){return t.lerp(e,i);},_lerpQuat:(n=cc.quat(),function(t,e,i){return t.lerp(e,i,n);}),_lerpVector:(r=cc.v3(),function(t,e,i){return t.lerp(e,i,r);}),sample:function(t,e,i){var r=this.values;var n=this.ratios;var a=n.length;var o,s,c;0!==a&&(c=!0,(s=this._cachedIndex)<0&&0<(s=~s)&&s<n.length&&(o=n[s-1],s=n[s],o<e&&e<s&&(c=!1)),c&&(this._cachedIndex=this._findFrameIndex(n,e)),c=(o=this._cachedIndex)<0?(o=~o)<=0?r[0]:a<=o?r[a-1]:(s=r[o-1],this._lerp?(a=(e-(c=n[o-1]))/(n[o]-c),(e=this.types[o-1])&&(a=computeRatioByType(a,e)),n=r[o],this._lerp(s,n,a)):s):r[o],this.target[this.prop]=c);}});var r;var n;i.Linear=null,i.Bezier=function(t){return t;};function vE(){this.events=[];}vE.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]});};var s=cc.Class({name:"cc.EventAnimCurve",extends:t,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new f();}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&--t,0|t;},sample:function(h,u,t){var e=this.ratios.length;var i=t.getWrappedInfo(t.time,this._wrappedInfo);var r=i.direction;var n=_(this.ratios,i.ratio);if(n<0&&(n=~n-1,r<0&&(n+=1)),this._ignoreIndex!==n&&(this._ignoreIndex=NaN),i.frameIndex=n,!this._lastWrappedInfo)return this._fireEvent(n),void(this._lastWrappedInfo=new f(i));var a=t.wrapMode;var o=this._wrapIterations(i.iterations);t=this._lastWrappedInfo;var s=this._wrapIterations(t.iterations);var c=t.frameIndex;t=t.direction;var l=-1!==s&&o!==s;if(c===n&&l&&1===e)this._fireEvent(0);else if(c!==n||l){r=t;do{if(c!==n){if(-1===r&&0===c&&0<n?((a&d.PingPong)===d.PingPong?r*=-1:c=e,s++):1===r&&c===e-1&&n<e-1&&((a&d.PingPong)===d.PingPong?r*=-1:c=-1,s++),c===n)break;if(o<s)break;}}while((c+=r,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[c]),c!==n&&-1<c&&c<e));}this._lastWrappedInfo.set(i);},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid){var i=this.target._components;for(var r=0;r<e.length;r++){var n=e[r];var a=n.func;for(var o=0;o<i.length;o++){var s=i[o];var c=s[a];c&&c.apply(s,n.params);}}}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;e=e.getWrappedInfo(t,this._wrappedInfo);t=e.direction;e=_(this.ratios,e.ratio);e<0&&(e=~e-1,t<0&&(e+=1),this._ignoreIndex=e);}});e.exports={AnimCurve:t,DynamicAnimCurve:i,EventAnimCurve:s,EventInfo:vE,computeRatioByType:computeRatioByType,quickFindIndex:function(t,e){var i=t.length-1;if(0==i)return 0;var r=t[0];if(e<r)return 0;var n=t[i];return n<e?~t.length:(t=(e=(e-r)/(n-r))/(1/i))-(n=0|t)<1e-6?n:1+n-t<1e-6?1+n:~(1+n);}};},{"../core/utils/binary-search":256,"./bezier":15,"./types":20}],13:[function(t,e,i){"use strict";var r=cc.js;var n=cc.Class({ctor:function(){this._anims=new r.array.MutableForwardIterator([]),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this);},update:function(t){var e=this._anims;var i=e.array;for(e.i=0;e.i<i.length;++e.i){var r=i[e.i];r._isPlaying&&!r._isPaused&&r.update(t);}var n=this._delayEvents;for(var a=0;a<n.length;a++){var o=n[a];o.target[o.func].apply(o.target,o.args);}n.length=0;},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t);},removeAnimation:function(t){t=this._anims.array.indexOf(t);0<=t?this._anims.fastRemoveAt(t):cc.errorID(3907);},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i});}});cc.AnimationManager=e.exports=n;},{}],14:[function(t,e,a){"use strict";var i=cc.js;var r=t("./playable");t=t("./types");var c=t.WrappedInfo;var n=t.WrapMode;var l=t.WrapModeMask;function AnimationState(t,e){r.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new c(),this._lastWrappedInfo=null,this._process=process,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=n.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,this.emit=function(){var t=new Array(arguments.length);for(var e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t);};}i.extend(AnimationState,r);t=AnimationState.prototype;function process(){var t=this.sample();var e;this._lastframeEventOn&&(e=this._lastWrappedInfo||(this._lastWrappedInfo=new c(t)),1<this.repeatCount&&(0|t.iterations)>(0|e.iterations)&&this.emit("lastframe",this),e.set(t)),t.stopped&&(this.stop(),this.emit("finished",this));}function simpleProcess(){var t=this.time;var e=this.duration;e<t?0===(t%=e)&&(t=e):t<0&&0!==(t%=e)&&(t+=e);var i=t/e;var r=this.curves;for(var n=0,a=r.length;n<a;n++)r[n].sample(t,i,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=i),(0<this.time&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i);}t._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e);},t.on=function(t,e,i){return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),this._target.on(t,e,i)):null;},t.once=function(t,e,i){var r;return this._target&&this._target.isValid?("lastframe"===t&&(this._lastframeEventOn=!0),(r=this)._target.once(t,function(t){e.call(i,t),r._lastframeEventOn=!1;})):null;},t.off=function(t,e,i){this._target&&this._target.isValid&&("lastframe"===t&&(this._target.hasEventListener(t)||(this._lastframeEventOn=!1)),this._target.off(t,e,i));},t._setEventTarget=function(t){this._target=t;},t.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this);},t.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this);},t.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this);},t.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this);},t.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;var e=this.curves;for(var i=0,r=e.length;i<r;i++){var n=e[i];n.onTimeChangedManually&&n.onTimeChangedManually(t,this);}},t.update=function(t){0<this._delayTime&&(this._delayTime-=t,0<this._delayTime)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process());},t._needRevers=function(t){var e=this.wrapMode;var i=!1;return(e&l.PingPong)===l.PingPong&&(t-(0|t)==0&&0<t&&--t,1&t&&(i=!i)),i=(e&l.Reverse)===l.Reverse?!i:i;},t.getWrappedInfo=function(t,e){e=e||new c();var i=!1;var r=this.duration;var n=this.repeatCount;var a=0<t?t/r:-t/r;n<=a&&(i=!0,t=(n=0===(n=(a=n)-(0|n))?1:n)*r*(0<t?1:-1)),r<t?t=0==(n=t%r)?r:n:t<0&&0!==(t%=r)&&(t+=r);n=!1;var o=this._wrapMode&l.ShouldWrap;var s=(n=o?this._needRevers(a):n)?-1:1;return this.speed<0&&(s*=-1),e.ratio=(t=o&&n?r-t:t)/r,e.time=t,e.direction=s,e.stopped=i,e.iterations=a,e;},t.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);var e=this.curves;for(var i=0,r=e.length;i<r;i++)e[i].sample(t.time,t.ratio,this);return t;},i.get(t,"clip",function(){return this._clip;}),i.get(t,"name",function(){return this._name;}),i.obsolete(t,"AnimationState.length","duration"),i.getset(t,"curveLoaded",function(){return 0<this.curves.length;},function(){this.curves.length=0;}),i.getset(t,"wrapMode",function(){return this._wrapMode;},function(t){this._wrapMode=t,this.time=0,t&l.Loop?this.repeatCount=1/0:this.repeatCount=1;}),i.getset(t,"repeatCount",function(){return this._repeatCount;},function(t){this._repeatCount=t;var e=this._wrapMode&l.ShouldWrap;var i=(this.wrapMode&l.Reverse)===l.Reverse;this._process=1/0!==t||e||i?process:simpleProcess;}),i.getset(t,"delay",function(){return this._delay;},function(t){this._delayTime=this._delay=t;}),cc.AnimationState=e.exports=AnimationState;},{"./playable":19,"./types":20}],15:[function(t,e,i){"use strict";var u=Math.cos,_=Math.acos,d=Math.max,f=2*Math.PI,p=Math.sqrt;function crt(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3);}e.exports={bezier:function(t,e,i,r,n){var a=1-n;return a*(a*(t+(3*e-t)*n)+3*i*n*n)+r*n*n*n;},bezierByTime:function(t,e){var i,r,n,a,o,h,s,c,l;return r=+(e=e),n=e-(i=t)[0],a=3*r,o=3*n,i=3*(e-i[2]),i=1/3*(n=(a-6*n+i)*(e=1/(o-r-i+(e-1)))),l=1/3*(a=1/3*(3*(o=(o-a)*e)-n*n)),n=(r=(o=(n=(2*n*n*n-9*n*o+27*(r*e))/27)/2)*o+l*l*l)<0?(l=p((e=1/3*-a)*e*e),e=_((a=-n/(2*l))<-1?-1:1<a?1:a),s=(n=2*crt(l))*u(e*(1/3))-i,c=n*u((e+f)*(1/3))-i,a=n*u((e+2*f)*(1/3))-i,0<=s&&s<=1?0<=c&&c<=1?0<=a&&a<=1?d(s,c,a):d(s,c):0<=a&&a<=1?d(s,a):s:0<=c&&c<=1?0<=a&&a<=1?d(c,a):c:a):0==r?(c=-(h=o<0?crt(-o):-crt(o))-i,0<=(s=2*h-i)&&s<=1?0<=c&&c<=1?d(s,c):s:c):(l=p(r),s=(h=crt(-o+l))-crt(o+l)-i),e=t[1],((1-n)*(e+(t[3]-e)*n)*3+n*n)*n;}};},{}],16:[function(t,e,i){"use strict";var r={constant:function(){return 0;},linear:function(t){return t;},quadIn:function(t){return t*t;},quadOut:function(t){return t*(2-t);},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1);},cubicIn:function(t){return t*t*t;},cubicOut:function(t){return--t*t*t+1;},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2);},quartIn:function(t){return t*t*t*t;},quartOut:function(t){return 1- --t*t*t*t;},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2);},quintIn:function(t){return t*t*t*t*t;},quintOut:function(t){return--t*t*t*t*t+1;},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2);},sineIn:function(t){return 1-Math.cos(t*Math.PI/2);},sineOut:function(t){return Math.sin(t*Math.PI/2);},sineInOut:function(t){return .5*(1-Math.cos(Math.PI*t));},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1);},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t);},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)));},circIn:function(t){return 1-Math.sqrt(1-t*t);},circOut:function(t){return Math.sqrt(1- --t*t);},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1);},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4));},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1);},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(e=!i||i<1?(i=1,.1):.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1);},backIn:function(t){return t*t*(2.70158*t-1.70158);},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1;},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2);},bounceIn:function(t){return 1-r.bounceOut(1-t);},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;},bounceInOut:function(t){return t<.5?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5;},smooth:function(t){return t<=0?0:1<=t?1:t*t*(3-2*t);},fade:function(t){return t<=0?0:1<=t?1:t*t*t*(t*(6*t-15)+10);}};function _makeOutIn(e,i){return function(t){return t<.5?i(2*t)/2:e(2*t-1)/2+.5;};}r.quadOutIn=_makeOutIn(r.quadIn,r.quadOut),r.cubicOutIn=_makeOutIn(r.cubicIn,r.cubicOut),r.quartOutIn=_makeOutIn(r.quartIn,r.quartOut),r.quintOutIn=_makeOutIn(r.quintIn,r.quintOut),r.sineOutIn=_makeOutIn(r.sineIn,r.sineOut),r.expoOutIn=_makeOutIn(r.expoIn,r.expoOut),r.circOutIn=_makeOutIn(r.circIn,r.circOut),r.backOutIn=_makeOutIn(r.backIn,r.backOut),r.bounceIn=function(t){return 1-r.bounceOut(1-t);},r.bounceInOut=function(t){return t<.5?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5;},r.bounceOutIn=_makeOutIn(r.bounceIn,r.bounceOut),cc.easing=e.exports=r;},{}],17:[function(t,e,i){"use strict";t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator");},{"./animation-animator":10,"./animation-clip":11,"./animation-curves":12,"./animation-manager":13,"./animation-state":14,"./bezier":15,"./easing":16,"./motion-path-helper":18,"./types":20}],18:[function(t,e,r){"use strict";var N=t("./animation-curves").DynamicAnimCurve;var k=t("./animation-curves").computeRatioByType;var i=t("./bezier").bezier;var G=t("../core/utils/binary-search").binarySearchEpsilon;var z=cc.v2;function Curve(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers();}function Bezier(){this.start=z(),this.end=z(),this.startCtrlPoint=z(),this.endCtrlPoint=z();}Curve.prototype.computeBeziers=function(){var t;this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var e=1;e<this.points.length;e++){var i=this.points[e-1];var r=this.points[e];(t=new Bezier()).start=i.pos,t.startCtrlPoint=i.out,t.end=r.pos,t.endCtrlPoint=r.in,this.beziers.push(t),this.length+=t.getLength();}var n=0;for(e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=n+=this.ratios[e];return this.beziers;},Bezier.prototype.getPointAt=function(t){t=this.getUtoTmapping(t);return this.getPoint(t);},Bezier.prototype.getPoint=function(t){var e=i(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t);t=i(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new z(e,t);},Bezier.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1];},Bezier.prototype.getLengths=function(t){if(t=t||this.__arcLengthDivisions||200,this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e=[];var i,r=this.getPoint(0),n=z();var a,o=0;for(e.push(0),a=1;a<=t;a++)i=this.getPoint(a/t),n.x=r.x-i.x,n.y=r.y-i.y,o+=n.mag(),e.push(o),r=i;return this.cacheArcLengths=e;},Bezier.prototype.getUtoTmapping=function(t,e){var i=this.getLengths();var r=0,n=i.length;var a;a=e||t*i[n-1];var o,s=0,c=n-1;for(;s<=c;)if((o=i[r=Math.floor(s+(c-s)/2)]-a)<0)s=r+1;else{if(!(0<o)){c=r;break;}c=r-1;}if(i[r=c]===a)return r/(n-1);e=i[r];return(r+(a-e)/(i[r+1]-e))/(n-1);},e.exports={sampleMotionPaths:function(h,t,u,_,d){function createControlPoints(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:z(t[2],t[3]),pos:z(t[0],t[1]),out:z(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO};}var e=t.values=t.values.map(function(t){return t=Array.isArray(t)?2===t.length?cc.v2(t[0],t[1]):cc.v3(t[0],t[1],t[2]):t;});if(0!==h.length&&0!==e.length){var f=!1;for(var p=0;p<h.length;p++){var m=h[p];if(m&&!function(t){if(Array.isArray(t)){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!Array.isArray(r)||6!==r.length)return;}return 1;}}(m)&&(cc.errorID(3904,d?d.name:"","position",p),m=null),m&&0<m.length){f=!0;break;}}if(f&&1!==e.length){var v=t.types;var i=t.ratios;var y=t.values=[];var g=t.types=[];var b=t.ratios=[];var C=0;var x=N.Linear;for(var r=0,A=h.length;r<A-1;r++){var S=h[r];var T=i[r];var w=i[r+1]-T;var E=e[r];var P=e[r+1];var M=v[r];var R=[];var n=C/w;var I=1/(w*u*_);var a;if(S&&0<S.length){var B=[];B.push(createControlPoints(E));for(var o=0,D=S.length;o<D;o++){var L=createControlPoints(S[o]);B.push(L);}B.push(createControlPoints(P));var s=new Curve(B);s.computeBeziers();var V=s.progresses;for(;1e-6<1-n;){var c,O,F;var l;l=(a=k(a=n,M))<0?(F=(0-a)*(c=s.beziers[0]).getLength(),O=c.start.sub(c.endCtrlPoint).normalize(),c.start.add(O.mul(F))):1<a?(F=(a-1)*(c=s.beziers[s.beziers.length-1]).getLength(),O=c.end.sub(c.startCtrlPoint).normalize(),c.end.add(O.mul(F))):(a=(a-=0<(l=(l=G(V,a))<0?~l:l)?V[l-1]:0)/s.ratios[l],s.beziers[l].getPointAt(a)),R.push(l),n+=I;}}else for(;1e-6<1-n;)a=k(a=n,M),R.push(E.lerp(P,a)),n+=I;x="constant"===M?M:N.Linear;for(o=0,D=R.length;o<D;o++)addNewDatas(R[o],x,T+C+I*o*w);C=1e-6<Math.abs(n-1)?(n-1)*w:0;}i[i.length-1]!==b[b.length-1]&&addNewDatas(e[e.length-1],x,i[i.length-1]);}}function addNewDatas(t,e,i){y.push(t),g.push(e),b.push(i);}},Curve:Curve,Bezier:Bezier};},{"../core/utils/binary-search":256,"./animation-curves":12,"./bezier":15}],19:[function(t,e,i){"use strict";var r=cc.js;var n=t("../core/CCDebug");function Playable(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1;}t=Playable.prototype;r.get(t,"isPlaying",function(){return this._isPlaying;},!0),r.get(t,"isPaused",function(){return this._isPaused;},!0);function Yq(){}t.onPlay=Yq,t.onPause=Yq,t.onResume=Yq,t.onStop=Yq,t.onError=Yq,t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(n.getError(3912)):(this._isPlaying=!0,this.onPlay());},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1);},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause());},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume());},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play();},e.exports=Playable;},{"../core/CCDebug":27}],20:[function(t,e,i){"use strict";var r={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36};var n=cc.Enum({Default:0,Normal:1,Reverse:r.Reverse,Loop:r.Loop,LoopReverse:r.Loop|r.Reverse,PingPong:r.PingPong,PingPongReverse:r.PingPong|r.Reverse});function WrappedInfo(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0);}cc.WrapMode=n,WrappedInfo.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex;},e.exports={WrapModeMask:r,WrapMode:n,WrappedInfo:WrappedInfo};},{}],21:[function(t,e,l){"use strict";var i=t("../core/event/event-target");var r=t("../core/platform/CCSys");var n=t("../core/assets/CCAudioClip").LoadMode;var a=!1;var o=[];function iq(t){i.call(this),this._shouldRecycleOnEnded=!1,this._src=t,this._element=null,this.id=0,this._volume=1,this._loop=!1,this._nextTime=0,this._state=iq.State.INITIALZING,this._onended=function(){this._state=iq.State.STOPPED,this.emit("ended");}.bind(this);}var s;cc.js.extend(iq,i),iq.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3},(t=iq.prototype)._bindEnded=function(t){t=t||this._onended;var e=this._element;this._src&&e instanceof HTMLAudioElement?e.addEventListener("ended",t):e.onended=t;},t._unbindEnded=function(){var t=this._element;t instanceof HTMLAudioElement?t.removeEventListener("ended",this._onended):t&&(t.onended=null);},t._onLoaded=function(){this._createElement(),this.setVolume(this._volume),this.setLoop(this._loop),0!==this._nextTime&&this.setCurrentTime(this._nextTime),this.getState(!1)===iq.State.PLAYING?this.play():this._state=iq.State.INITIALZING;},t._createElement=function(){var t=this._src._nativeAsset;t instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=t.src):this._element=new c(t,this);},t.play=function(){this._state=iq.State.PLAYING,this._element&&(this._bindEnded(),this._element.play(),this._touchToPlay());},t._touchToPlay=function(){var t;this._src&&this._src.loadMode===n.DOM_AUDIO&&this._element.paused&&o.push({instance:this,offset:0,audio:this._element}),a||(a=!0,t="ontouchend"in window?"touchend":"mousedown",cc.game.canvas.addEventListener(t,function(){var t;for(;t=o.pop();)t.audio.play(t.offset);}));},t.destroy=function(){this._element=null;},t.pause=function(){this._element&&this.getState()===iq.State.PLAYING&&(this._unbindEnded(),this._element.pause(),this._state=iq.State.PAUSED);},t.resume=function(){this._element&&this.getState()===iq.State.PAUSED&&(this._bindEnded(),this._element.play(),this._state=iq.State.PLAYING);},t.stop=function(){if(this._element){this._element.pause();try{this._element.currentTime=0;}catch(t){}for(var t=0;t<o.length;t++)if(o[t].instance===this){o.splice(t,1);break;}this._unbindEnded(),this.emit("stop"),this._state=iq.State.STOPPED;}},t.setLoop=function(t){this._loop=t,this._element&&(this._element.loop=t);},t.getLoop=function(){return this._loop;},t.setVolume=function(t){this._volume=t,this._element&&(this._element.volume=t);},t.getVolume=function(){return this._volume;},t.setCurrentTime=function(e){if(this._element){this._nextTime=0,this._unbindEnded(),this._bindEnded(function(){this._bindEnded();}.bind(this));try{this._element.currentTime=e;}catch(t){var i=this._element;i.addEventListener&&i.addEventListener("loadedmetadata",function func(){i.removeEventListener("loadedmetadata",func),i.currentTime=e;});}}else this._nextTime=e;},t.getCurrentTime=function(){return this._element?this._element.currentTime:0;},t.getDuration=function(){return this._element?this._element.duration:0;},t.getState=function(t){return(t=void 0===t?!0:t)&&this._forceUpdatingState(),this._state;},t._forceUpdatingState=function(){var t=this._element;t&&(iq.State.PLAYING===this._state&&t.paused?this._state=iq.State.STOPPED:iq.State.STOPPED!==this._state||t.paused||(this._state=iq.State.PLAYING));},Object.defineProperty(t,"src",{get:function(){return this._src;},set:function(i){var t;return this._unbindEnded(),i?(this._src=i).loaded?this._onLoaded():(t=this,i.once("load",function(){i===t._src&&t._onLoaded();}),cc.loader.load({url:i.nativeUrl,skips:["Loader"]},function(t,e){t?cc.error(t):i.loaded||(i._nativeAsset=e);})):(this._src=null,this._element instanceof c?this._element=null:this._element&&(this._element.src=""),this._state=iq.State.INITIALZING),i;},enumerable:!0,configurable:!0}),Object.defineProperty(t,"paused",{get:function(){return!this._element||this._element.paused;},enumerable:!0,configurable:!0}),s=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0;var c=function(t,e){this._audio=e,this._context=r.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this.volume=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currentTimer=null,this._endCallback=function(){this.onended&&this.onended(this);}.bind(this);};(t=c.prototype).play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._gainObj),e.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var i=this._buffer.duration;var r=t;var n;this._loop?e.start?e.start(0,r):e.notoGrainOn?e.noteGrainOn(0,r):e.noteOn(0,r):(i=i-t,e.start?e.start(0,r,i):e.noteGrainOn?e.noteGrainOn(0,r,i):e.noteOn(0,r,i)),(this._currentSource=e).onended=this._endCallback,e.context.state&&"suspended"!==e.context.state||0!==this._context.currentTime||(n=this,clearTimeout(this._currentTimer),this._currentTimer=setTimeout(function(){0===n._context.currentTime&&o.push({instance:n._audio,offset:t,audio:n});},10)),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&"interrupted"===e.context.state&&e.context.resume();},t.pause=function(){var t;clearTimeout(this._currentTimer),this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,t=this._currentSource,this._currentSource=null,this._startTime=-1,t&&t.stop(0));},Object.defineProperty(t,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration);},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loop",{get:function(){return this._loop;},set:function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t;},enumerable:!0,configurable:!0}),Object.defineProperty(t,"volume",{get:function(){return this._volume;},set:function(e){if(this._volume=e,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,s);}catch(t){this._gainObj.gain.setTargetAtTime(e,this._context.currentTime,.01);}else this._gainObj.gain.value=e;r.os===r.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play());},enumerable:!0,configurable:!0}),Object.defineProperty(t,"currentTime",{get:function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength;},set:function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t;},enumerable:!0,configurable:!0}),Object.defineProperty(t,"duration",{get:function(){return this._buffer.duration;},enumerable:!0,configurable:!0}),e.exports=cc.Audio=iq;},{"../core/assets/CCAudioClip":35,"../core/event/event-target":115,"../core/platform/CCSys":198}],22:[function(t,e,c){"use strict";var r=t("./CCAudio");var l=t("../core/assets/CCAudioClip");var i=cc.js;var h=0;var a=i.createMap(!0);var o={};var n=[];function FG(t){var e=h++;var i=o[t];function xg(){var t;WG(this.id)&&(delete a[this.id],t=i.indexOf(this.id),cc.js.array.fastRemoveAt(i,t)),(t=this)._shouldRecycleOnEnded&&(t._finishCallback=null,t.off("ended"),t.off("stop"),t.src=null,n.includes(t)||(n.length<32?n.push(t):t.destroy()),t._shouldRecycleOnEnded=!1);}return i=i||(o[t]=[]),s._maxAudioInstance<=i.length&&(t=i.shift(),WG(t).stop()),(t=n.pop()||new r()).on("ended",function(){this._finishCallback&&this._finishCallback(),xg.call(this);},t),t.on("stop",xg,t),t.id=e,a[e]=t,i.push(e),t;}function WG(t){return a[t];}function aG(t){return void 0===t?t=1:"string"==typeof t&&(t=Number.parseFloat(t)),t;}var s={AudioState:r.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:a,play:function(t,e,i){var r=t;var n;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),n=FG(r=t),l._loadByUrl(r,function(t,e){e&&(n.src=e);});else{if(!t)return;r=t.nativeUrl,(n=FG(r)).src=t;}return n._shouldRecycleOnEnded=!0,n.setLoop(e||!1),i=aG(i),n.setVolume(i),n.play(),n.id;},setLoop:function(t,e){t=WG(t);t&&t.setLoop&&t.setLoop(e);},isLoop:function(t){t=WG(t);return!(!t||!t.getLoop)&&t.getLoop();},setVolume:function(t,e){t=WG(t);t&&t.setVolume(e);},getVolume:function(t){t=WG(t);return t?t.getVolume():1;},setCurrentTime:function(t,e){t=WG(t);return!!t&&(t.setCurrentTime(e),!0);},getCurrentTime:function(t){t=WG(t);return t?t.getCurrentTime():0;},getDuration:function(t){t=WG(t);return t?t.getDuration():0;},getState:function(t){t=WG(t);return t?t.getState():this.AudioState.ERROR;},setFinishCallback:function(t,e){t=WG(t);t&&(t._finishCallback=e);},pause:function(t){t=WG(t);return!!t&&(t.pause(),!0);},_pauseIDCache:[],pauseAll:function(){for(var t in a){var e=a[t];e.getState()===r.State.PLAYING&&(this._pauseIDCache.push(t),e.pause());}},resume:function(t){t=WG(t);t&&t.resume();},resumeAll:function(){for(var t=0;t<this._pauseIDCache.length;++t){var e=this._pauseIDCache[t];e=WG(e);e&&e.resume();}this._pauseIDCache.length=0;},stop:function(t){t=WG(t);return!!t&&(t.stop(),!0);},stopAll:function(){for(var t in a){t=a[t];t&&t.stop();}},setMaxAudioInstance:function(t){this._maxAudioInstance=t;},getMaxAudioInstance:function(){return this._maxAudioInstance;},uncache:function(t){var e=t;if("string"==typeof t)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),e=t;else{if(!t)return;e=t.nativeUrl;}var i=o[e];if(i)for(;0<i.length;){var r=i.pop();var n=a[r];n&&(n.stop(),delete a[r]);}},uncacheAll:function(){var t;for(var e in this.stopAll(),a)(t=a[e])&&t.destroy();for(;t=n.pop();)t.destroy();a=i.createMap(!0),o={};},getProfile:function(t){},preload:function(t,e){cc.warn("`cc.audioEngine.preload` is deprecated, use `cc.loader.loadRes(url, cc.AudioClip)` instead please."),cc.loader.load(t,e&&function(t){t||e();});},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t;},_breakCache:null,_break:function(){for(var t in this._breakCache=[],a){var e=a[t];e.getState()===r.State.PLAYING&&(this._breakCache.push(t),e.pause());}},_restore:function(){if(this._breakCache){for(;0<this._breakCache.length;){var t=this._breakCache.pop();t=WG(t);t&&t.resume&&t.resume();}this._breakCache=null;}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(t,e){var i=this._music;return this.stop(i.id),i.id=this.play(t,e,i.volume),i.loop=e,i.id;},stopMusic:function(){this.stop(this._music.id);},pauseMusic:function(){return this.pause(this._music.id),this._music.id;},resumeMusic:function(){return this.resume(this._music.id),this._music.id;},getMusicVolume:function(){return this._music.volume;},setMusicVolume:function(t){t=aG(t);var e=this._music;return e.volume=t,this.setVolume(e.id,e.volume),e.volume;},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING;},playEffect:function(t,e){return this.play(t,e||!1,this._effect.volume);},setEffectsVolume:function(t){t=aG(t);var e=this._music.id;for(var i in this._effect.volume=t,a){var r=a[i];r&&r.id!==e&&s.setVolume(i,t);}},getEffectsVolume:function(){return this._effect.volume;},pauseEffect:function(t){return this.pause(t);},pauseAllEffects:function(){var t=this._music.id;var e=this._effect;for(var i in e.pauseCache.length=0,a){var r=a[i];r&&r.id!==t&&r.getState()===this.AudioState.PLAYING&&(e.pauseCache.push(i),r.pause());}},resumeEffect:function(t){this.resume(t);},resumeAllEffects:function(){var t=this._effect.pauseCache;for(var e=0;e<t.length;++e){var i=t[e];i=a[i];i&&i.resume();}},stopEffect:function(t){return this.stop(t);},stopAllEffects:function(){var t=this._music.id;for(var e in a){e=a[e];e&&e.id!==t&&e.getState()===s.AudioState.PLAYING&&e.stop();}}};e.exports=cc.audioEngine=s;},{"../core/assets/CCAudioClip":35,"./CCAudio":21}],23:[function(t,e,i){"use strict";var r={name:"Jacob__Codec"};r.Base64=t("./base64"),r.GZip=t("./gzip"),r.unzip=function(){return r.GZip.gunzip.apply(r.GZip,arguments);},r.unzipBase64=function(){var e=r.Base64.decode.apply(r.Base64,arguments);try{return r.GZip.gunzip.call(r.GZip,e);}catch(t){return e.slice(7);}},r.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,a=this.unzipBase64(t),o=[];for(i=0,n=a.length/e;i<n;i++)for(o[i]=0,r=e-1;0<=r;--r)o[i]+=a.charCodeAt(i*e+r)<<8*r;return o;},r.unzipAsArray=function(t,e){e=e||1;var i,r,n,a=this.unzip(t),o=[];for(i=0,n=a.length/e;i<n;i++)for(o[i]=0,r=e-1;0<=r;--r)o[i]+=a.charCodeAt(i*e+r)<<8*r;return o;},cc.codec=e.exports=r;},{"./base64":24,"./gzip":25}],24:[function(t,e,i){"use strict";var l=t("../core/utils/misc").BASE64_VALUES;t={name:"Jacob__Codec__Base64"};t.decode=function(t){var e,i,r,n,a,o,s=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)r=l[t.charCodeAt(c++)],e=(15&(n=l[t.charCodeAt(c++)]))<<4|(a=l[t.charCodeAt(c++)])>>2,i=(3&a)<<6|(o=l[t.charCodeAt(c++)]),s.push(String.fromCharCode(r<<2|n>>4)),64!==a&&s.push(String.fromCharCode(e)),64!==o&&s.push(String.fromCharCode(i));return s=s.join("");},t.decodeAsArray=function(t,e){var i,r,n,a=this.decode(t),o=[];for(i=0,n=a.length/e;i<n;i++)for(o[i]=0,r=e-1;0<=r;--r)o[i]+=a.charCodeAt(i*e+r)<<8*r;return o;},e.exports=t;},{"../core/utils/misc":264}],25:[function(t,e,i){"use strict";function IJ(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(IJ.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0;}IJ.gunzip=function(t){return t.constructor===Array||(t.constructor,String),new IJ(t).gunzip()[0][0];},IJ.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1;},IJ.LITERALS=288,IJ.NAMEMAX=256,IJ.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],IJ.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],IJ.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],IJ.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],IJ.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],IJ.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],IJ.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped;},IJ.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1;},IJ.prototype.byteAlign=function(){this.bb=1;},IJ.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t;},IJ.prototype.readBits=function(t){var e=0,i=t;for(;i--;)e=e<<1|this.readBit();return e=t?IJ.bitReverse[e]>>8-t:e;},IJ.prototype.flushBuffer=function(){this.bIdx=0;},IJ.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0);},IJ.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++;}},IJ.prototype.Rec=function(){var t=this.Places[this.treepos];var e;if(17===this.len)return-1;if(this.treepos++,this.len++,0<=(e=this.IsPat()))t.b0=e;else if(t.b0=32768,this.Rec())return-1;if(0<=(e=this.IsPat()))t.b1=e,t.jump=null;else if(t.b1=32768,t.jump=this.Places[this.treepos],t.jumppos=this.treepos,this.Rec())return-1;return this.len--,0;},IJ.prototype.CreateTree=function(t,e,i,r){var n;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,n=0;n<17;n++)this.fpos[n]=0;return this.len=0,this.Rec()?-1:0;},IJ.prototype.DecodeValue=function(t){var e,i,r=0,n=t[r];for(;;)if(this.readBit()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break;}}else{if(!(32768&n.b0))return n.b0;n=t[++r];}return-1;},IJ.prototype.DeflateLoop=function(){var h,u,t;do{var e;if(h=this.readBit(),0===(u=this.readBits(2)))for(this.byteAlign(),e=this.readByte(),e|=this.readByte()<<8,o=this.readByte(),65535&(e^~(o|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");e--;)i=this.readByte(),this.addBuffer(i);else if(1===u){for(;;)if(23<(r=IJ.bitReverse[this.readBits(7)]>>1)?199<(r=r<<1|this.readBit())?r=(r-=128)<<1|this.readBit():143<(r-=48)&&(r+=136):r+=256,r<256)this.addBuffer(r);else{if(256===r)break;for(r-=257,c=this.readBits(IJ.cplext[r])+IJ.cplens[r],r=IJ.bitReverse[this.readBits(5)]>>3,8<IJ.cpdext[r]?(l=this.readBits(8),l|=this.readBits(IJ.cpdext[r]-8)<<8):l=this.readBits(IJ.cpdext[r]),l+=IJ.cpdist[r],r=0;r<c;r++){var i=this.buf32k[this.bIdx-l&32767];this.addBuffer(i);}}}else if(2===u){var r,n,a,o,_;var s=new Array(320);for(a=257+this.readBits(5),o=1+this.readBits(5),_=4+this.readBits(4),r=0;r<19;r++)s[r]=0;for(r=0;r<_;r++)s[IJ.border[r]]=this.readBits(3);for(c=this.distanceTree.length,t=0;t<c;t++)this.distanceTree[t]=new IJ.HufNode();if(this.CreateTree(this.distanceTree,19,s,0))return this.flushBuffer(),1;n=a+o,t=0;for(;t<n;)if((r=this.DecodeValue(this.distanceTree))<16)s[t++]=r;else if(16===r){var d;if(n<t+(r=3+this.readBits(2)))return this.flushBuffer(),1;for(d=t?s[t-1]:0;r--;)s[t++]=d;}else{if(n<t+(r=17===r?3+this.readBits(3):11+this.readBits(7)))return this.flushBuffer(),1;for(;r--;)s[t++]=0;}for(c=this.literalTree.length,t=0;t<c;t++)this.literalTree[t]=new IJ.HufNode();if(this.CreateTree(this.literalTree,a,s,0))return this.flushBuffer(),1;for(c=this.literalTree.length,t=0;t<c;t++)this.distanceTree[t]=new IJ.HufNode();var f=new Array();for(t=a;t<s.length;t++)f[t-a]=s[t];if(this.CreateTree(this.distanceTree,o,f,0))return this.flushBuffer(),1;for(;;)if(256<=(r=this.DecodeValue(this.literalTree))){var c,l;if(0===(r-=256))break;for(r--,c=this.readBits(IJ.cplext[r])+IJ.cplens[r],r=this.DecodeValue(this.distanceTree),8<IJ.cpdext[r]?(l=this.readBits(8),l|=this.readBits(IJ.cpdext[r]-8)<<8):l=this.readBits(IJ.cpdext[r]),l+=IJ.cpdist[r];c--;){i=this.buf32k[this.bIdx-l&32767];this.addBuffer(i);}}else this.addBuffer(r);}}while(!h);return this.flushBuffer(),this.byteAlign(),0;},IJ.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0];},IJ.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;t=this.readByte();t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var e=this.readByte();(e|=this.readByte()<<8)|this.readByte()<<16|this.readByte()<<24;e=this.readByte();(e|=this.readByte()<<8)|this.readByte()<<16|this.readByte()<<24;var i=this.readByte();i|=this.readByte()<<8;var r=this.readByte();for(r|=this.readByte()<<8,a=0,this.nameBuf=[];i--;){var n=this.readByte();"/"===n|":"===n?a=0:a<IJ.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(n));}this.fileout||(this.fileout=this.nameBuf);var a=0;for(;a<r;)n=this.readByte(),a++;8==t&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir();}},IJ.prototype.skipdir=function(){var t=[];var e,i,r;if(8&this.gpflags&&(t[0]=this.readByte(),t[1]=this.readByte(),t[2]=this.readByte(),t[3]=this.readByte(),e=this.readByte(),e|=this.readByte()<<8,this.readByte(),this.readByte(),e=this.readByte(),e=(e=(e|=this.readByte()<<8)|this.readByte()<<16)|this.readByte()<<24),this.modeZIP&&this.nextFile(),t[0]=this.readByte(),8!==t[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(t[0]=this.readByte(),t[2]=this.readByte(),this.len=t[0]+256*t[1],i=0;i<this.len;i++)this.readByte();if(8&this.gpflags)for(i=0,this.nameBuf=[];r=this.readByte();)(i="7"!==r&&":"!==r?i:0)<IJ.NAMEMAX-1&&(this.nameBuf[i++]=r);if(16&this.gpflags)for(;r=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),e=this.readByte(),e=(e=(e|=this.readByte()<<8)|this.readByte()<<16)|this.readByte()<<24,this.modeZIP&&this.nextFile();},e.exports=IJ;},{}],26:[function(t,e,i){"use strict";!function(){function i(t){throw t;}var tt=void 0,et=!0,a=this;function y(t,e){var i=t.split("."),r=a;i[0]in r||!r.execScript||r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||e===tt?r=r[n]||(r[n]={}):r[n]=e;}var it="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function ba(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r;}for(var n,a=1,o=0,s=t.length,c=0;0<s;){for(s-=n=1024<s?1024:s;o+=a+=t[c++],--n;);a%=65521,o%=65521;}return(o<<16|a)>>>0;}function J(t,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=t instanceof(it?Uint8Array:Array)?t:new(it?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&i(Error("invalid index")),this.buffer.length<=this.index&&this.f();}J.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(it?Uint8Array:Array)(i<<1);if(it)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r;},J.prototype.d=function(t,e,i){var r,n=this.buffer,a=this.index,o=this.i,s=n[a];if(i&&1<e&&(t=8<e?(h[255&t]<<24|h[t>>>8&255]<<16|h[t>>>16&255]<<8|h[t>>>24&255])>>32-e:h[t]>>8-e),e+o<8)s=s<<e|t,o+=e;else for(r=0;r<e;++r)s=s<<1|t>>e-r-1&1,8==++o&&(o=0,n[a++]=h[s],s=0,a===n.length&&(n=this.f()));n[a]=s,this.buffer=n,this.i=o,this.index=a;},J.prototype.finish=function(){var t=this.buffer,e=this.index;return 0<this.i&&(t[e]<<=8-this.i,t[e]=h[t[e]],e++),it?t.subarray(0,e):(t.length=e,t);};var r,n=new(it?Uint8Array:Array)(256);for(r=0;r<256;++r){for(var s=l=r,c=7,l=l>>>1;l;l>>>=1)s=s<<1|1&l,--c;n[r]=(s<<c&255)>>>0;}var h=n;function la(t){this.buffer=new(it?Uint16Array:Array)(2*t),this.length=0;}function S(t){var e,i,r,n,a,o,h,s,c,u=t.length,l=0,_=Number.POSITIVE_INFINITY;for(s=0;s<u;++s)t[s]>l&&(l=t[s]),t[s]<_&&(_=t[s]);for(e=1<<l,i=new(it?Uint32Array:Array)(e),r=1,n=0,a=2;r<=l;){for(s=0;s<u;++s)if(t[s]===r){for(h=n,c=o=0;c<r;++c)o=o<<1|1&h,h>>=1;for(c=o;c<e;c+=a)i[c]=r<<16|s;++n;}++r,n<<=1,a<<=1;}return[i,l,_];}function ma(t,e){this.h=rt,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=it&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(it?Uint8Array:Array)(32768));}it&&new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),la.prototype.getParent=function(t){return 2*((t-2)/4|0);},la.prototype.push=function(t,e){var i,r,n,a=this.buffer;for(i=this.length,a[this.length++]=e,a[this.length++]=t;0<i&&(r=this.getParent(i),a[i]>a[r]);)n=a[i],a[i]=a[r],a[r]=n,n=a[i+1],a[i+1]=a[r+1],a[r+1]=n,i=r;return this.length;},la.prototype.pop=function(){var t,e,i,r,n,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&a[r+2]>a[r]&&(r+=2),a[r]>a[n]);)i=a[n],a[n]=a[r],a[r]=i,i=a[n+1],a[n+1]=a[r+1],a[r+1]=i,n=r;return{index:t,value:e,length:this.length};};var t,rt=2,u={NONE:0,r:1,j:rt,N:3},nt=[];for(t=0;t<288;t++)switch(et){case t<=143:nt.push([t+48,8]);break;case t<=255:nt.push([t-144+400,9]);break;case t<=279:nt.push([t-256,7]);break;case t<=287:nt.push([t-280+192,8]);break;default:i("invalid literal: "+t);}function wa(t,e){this.length=t,this.G=e;}ma.prototype.n=function(){var u,_,d,f=this.input;switch(this.h){case 0:for(_=0,d=f.length;_<d;){var p,m,v=y=it?f.subarray(_,_+65535):f.slice(_,_+65535),y=(_+=y.length)===d,g=tt,t=this.a,e=this.b;if(it){for(t=new Uint8Array(this.a.buffer);t.length<=e+v.length+5;)t=new Uint8Array(t.length<<1);t.set(this.a);}if(t[e++]=0|(y?1:0),p=65536+~(y=v.length)&65535,t[e++]=255&y,t[e++]=y>>>8&255,t[e++]=255&p,t[e++]=p>>>8&255,it)t.set(v,e),e+=v.length,t=t.subarray(0,e);else{for(g=0,m=v.length;g<m;++g)t[e++]=v[g];t.length=e;}this.b=e,this.a=t;}break;case 1:var b=new J(new Uint8Array(this.a.buffer),this.b);b.d(1,1,et),b.d(1,2,et);var C,x,A,S=sa(this,f);for(C=0,x=S.length;C<x;C++)if(A=S[C],J.prototype.d.apply(b,nt[A]),256<A)b.d(S[++C],S[++C],et),b.d(S[++C],5),b.d(S[++C],S[++C],et);else if(256===A)break;this.a=b.finish(),this.b=this.a.length;break;case rt:var T,w,E,P,M,R,I,B,D,L,r,V,n=new J(new Uint8Array(this.a),this.b),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=Array(19);for(K=rt,n.d(1,1,et),n.d(K,2,et),T=sa(this,f),K=ua(M=ta(this.L,15)),$=ua(R=ta(this.K,7)),w=286;257<w&&0===M[w-1];w--);for(E=30;1<E&&0===R[E-1];E--);var a,N,o,k,s,c,G=w,z=E,l=new(it?Uint32Array:Array)(G+z),h=new(it?Uint32Array:Array)(316),U=new(it?Uint8Array:Array)(19);for(a=N=0;a<G;a++)l[N++]=M[a];for(a=0;a<z;a++)l[N++]=R[a];if(!it)for(a=0,k=U.length;a<k;++a)U[a]=0;for(a=s=0,k=l.length;a<k;a+=N){for(N=1;a+N<k&&l[a+N]===l[a];++N);if(o=N,0===l[a]){if(o<3)for(;0<o--;)U[h[s++]=0]++;else for(;0<o;)(c=o-3<(c=o<138?o:138)&&c<o?o-3:c)<=10?(h[s++]=17,h[s++]=c-3,U[17]++):(h[s++]=18,h[s++]=c-11,U[18]++),o-=c;}else if(h[s++]=l[a],U[l[a]]++,--o<3)for(;0<o--;)h[s++]=l[a],U[l[a]]++;else for(;0<o;)o-3<(c=o<6?o:6)&&c<o&&(c=o-3),h[s++]=16,h[s++]=c-3,U[16]++,o-=c;}for(u=it?h.subarray(0,s):h.slice(0,s),I=ta(U,7),r=0;r<19;r++)F[r]=I[O[r]];for(P=19;4<P&&0===F[P-1];P--);for(B=ua(I),n.d(w-257,5,et),n.d(E-1,5,et),n.d(P-4,4,et),r=0;r<P;r++)n.d(F[r],3,et);for(r=0,V=u.length;r<V;r++)if(D=u[r],n.d(B[D],I[D],et),16<=D){switch(r++,D){case 16:L=2;break;case 17:L=3;break;case 18:L=7;break;default:i("invalid code: "+D);}n.d(u[r],L,et);}var W,H,j,X,q,Y,Z,Q,K=[K,M],$=[$,R];for(q=K[0],Y=K[1],Z=$[0],Q=$[1],W=0,H=T.length;W<H;++W)if(j=T[W],n.d(q[j],Y[j],et),256<j)n.d(T[++W],T[++W],et),X=T[++W],n.d(Z[X],Q[X],et),n.d(T[++W],T[++W],et);else if(256===j)break;this.a=n.finish(),this.b=this.a.length;break;default:i("invalid compression type");}return this.a;};var _,d,f=[];for(_=3;_<=258;_++)d=function(){var t=_;switch(et){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:i("invalid length: "+t);}}(),f[_]=d[2]<<24|d[1]<<16|d[0];var P=it?new Uint32Array(f):f;function sa(c,t){function b(t,e){var r,n=t.G,a=[],o=0;var s;switch(r=P[t.length],a[o++]=65535&r,a[o++]=r>>16&255,a[o++]=r>>24,et){case 1===n:s=[0,n-1,0];break;case 2===n:s=[1,n-2,0];break;case 3===n:s=[2,n-3,0];break;case 4===n:s=[3,n-4,0];break;case n<=6:s=[4,n-5,1];break;case n<=8:s=[5,n-7,1];break;case n<=12:s=[6,n-9,2];break;case n<=16:s=[7,n-13,2];break;case n<=24:s=[8,n-17,3];break;case n<=32:s=[9,n-25,3];break;case n<=48:s=[10,n-33,4];break;case n<=64:s=[11,n-49,4];break;case n<=96:s=[12,n-65,5];break;case n<=128:s=[13,n-97,5];break;case n<=192:s=[14,n-129,6];break;case n<=256:s=[15,n-193,6];break;case n<=384:s=[16,n-257,7];break;case n<=512:s=[17,n-385,7];break;case n<=768:s=[18,n-513,8];break;case n<=1024:s=[19,n-769,8];break;case n<=1536:s=[20,n-1025,9];break;case n<=2048:s=[21,n-1537,9];break;case n<=3072:s=[22,n-2049,10];break;case n<=4096:s=[23,n-3073,10];break;case n<=6144:s=[24,n-4097,11];break;case n<=8192:s=[25,n-6145,11];break;case n<=12288:s=[26,n-8193,12];break;case n<=16384:s=[27,n-12289,12];break;case n<=24576:s=[28,n-16385,13];break;case n<=32768:s=[29,n-24577,13];break;default:i("invalid distance");}var c,l;for(r=s,a[o++]=r[0],a[+o]=r[1],a[5]=r[2],c=0,l=a.length;c<l;++c)u[m++]=a[c];_[a[0]]++,y[a[3]]++,v=t.length+e-1,h=null;}var e,l,r,d,n,a,f,h,o,p={},u=it?new Uint16Array(2*t.length):[],m=0,v=0,_=new(it?Uint32Array:Array)(286),y=new(it?Uint32Array:Array)(30),g=c.w;if(!it){for(r=0;r<=285;)_[r++]=0;for(r=0;r<=29;)y[r++]=0;}for(_[256]=1,e=0,l=t.length;e<l;++e){for(r=n=0,d=3;r<d&&e+r!==l;++r)n=n<<8|t[e+r];if(p[n]===tt&&(p[n]=[]),a=p[n],!(0<v--)){for(;0<a.length&&32768<e-a[0];)a.shift();if(l<=e+3){for(h&&b(h,-1),r=0,d=l-e;r<d;++r)o=t[e+r],u[m++]=o,++_[o];break;}if(0<a.length){var C,x=tt,A=0,s=tt,S=tt,T=tt,w=t.length,S=0,E=a.length;t:for(;S<E;S++){if(C=a[E-S-1],(s=3)<A){for(T=A;3<T;T--)if(t[C+T-1]!==t[e+T-1])continue t;s=A;}for(;s<258&&e+s<w&&t[C+s]===t[e+s];)++s;if(A<s&&(x=C,A=s),258===s)break;}f=new wa(A,e-x),h?h.length<f.length?(o=t[e-1],u[m++]=o,++_[o],b(f,0)):b(h,-1):f.length<g?h=f:b(f,0);}else h?b(h,-1):(o=t[e],u[m++]=o,++_[o]);}a.push(e);}return u[m++]=256,_[256]++,c.L=_,c.K=y,it?u.subarray(0,m):u;}function ta(h,t){var e,u,_,i,d,f=h.length,p=new la(572),m=new(it?Uint8Array:Array)(f);if(!it)for(i=0;i<f;i++)m[i]=0;for(i=0;i<f;++i)0<h[i]&&p.push(i,h[i]);if(e=Array(p.length/2),u=new(it?Uint32Array:Array)(p.length/2),1===e.length)return m[p.pop().index]=1,m;for(i=0,d=p.length/2;i<d;++i)e[i]=p.pop(),u[i]=e[i].value;var r,n,a,v,y,o=u.length,s=new(it?Uint16Array:Array)(t),c=new(it?Uint8Array:Array)(t),g=new(it?Uint8Array:Array)(o),l=Array(t),C=Array(t),x=Array(t),A=(1<<t)-o,S=1<<t-1;for(s[t-1]=o,n=0;n<t;++n)A<S?c[n]=0:(c[n]=1,A-=S),A<<=1,s[t-2-n]=(s[t-1-n]/2|0)+o;for(s[0]=c[0],l[0]=Array(s[0]),C[0]=Array(s[0]),n=1;n<t;++n)s[n]>2*s[n-1]+c[n]&&(s[n]=2*s[n-1]+c[n]),l[n]=Array(s[n]),C[n]=Array(s[n]);for(r=0;r<o;++r)g[r]=t;for(a=0;a<s[t-1];++a)l[t-1][a]=u[a],C[t-1][a]=a;for(r=0;r<t;++r)x[r]=0;for(1===c[t-1]&&(--g[0],++x[t-1]),n=t-2;0<=n;--n){for(r=0,y=x[n+1],a=0;a<s[n];a++)(v=l[n+1][y]+l[n+1][y+1])>u[r]?(l[n][a]=v,C[n][a]=o,y+=2):(l[n][a]=u[r],C[n][a]=r,++r);x[n]=0,1===c[n]&&function b(t){var e=C[t][x[t]];e===o?(b(t+1),b(t+1)):--g[e],++x[t];}(n);}for(_=g,i=0,d=e.length;i<d;++i)m[e[i].index]=_[i];return m;}function ua(t){var e,r,n,a,o=new(it?Uint16Array:Array)(t.length),s=[],c=[],l=0;for(e=0,r=t.length;e<r;e++)s[t[e]]=1+(0|s[t[e]]);for(e=1,r=16;e<=r;e++)c[e]=l,1<<e<(l+=0|s[e])&&i("overcommitted"),l<<=1;for(l<65536&&i("undercommitted"),e=0,r=t.length;e<r;e++)for(l=c[t[e]],c[t[e]]+=1,n=o[e]=0,a=t[e];n<a;n++)o[e]=o[e]<<1|1&l,l>>>=1;return o;}function Da(t,e){this.input=t,this.a=new(it?Uint8Array:Array)(32768),this.h=o.j;var i,r={};for(i in(e?"number"!=typeof e.compressionType:e={})||(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.z=new ma(this.input,r);}var o=u;function V(t,e){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=it?new Uint8Array(t):t,this.s=!1,this.m=C,this.B=!1,e?(e.index&&(this.c=e.index),e.bufferSize&&(this.l=e.bufferSize),e.bufferType&&(this.m=e.bufferType),e.resize&&(this.B=e.resize)):e={},this.m){case g:this.b=32768,this.a=new(it?Uint8Array:Array)(32768+this.l+258);break;case C:this.b=0,this.a=new(it?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:i(Error("invalid inflate mode"));}}Da.prototype.n=function(){var t,e,r,n,a=0;if(n=this.a,(t=z)===z?r=Math.LOG2E*Math.log(32768)-8:i(Error("invalid compression method")),n[a++]=r=r<<4|t,t===z)switch(this.h){case o.NONE:e=0;break;case o.r:e=1;break;case o.j:e=2;break;default:i(Error("unsupported compression type"));}else i(Error("invalid compression method"));return n[a++]=(t=e<<6|0)|31-(256*r+t)%31,r=ba(this.input),this.z.b=a,a=(n=this.z.n()).length,it&&((n=new Uint8Array(n.buffer)).length<=a+4&&(this.a=new Uint8Array(n.length+4),this.a.set(n),n=this.a),n=n.subarray(0,a+4)),n[a++]=r>>24&255,n[a++]=r>>16&255,n[a++]=r>>8&255,n[a++]=255&r,n;},y("Zlib.Deflate",Da),y("Zlib.Deflate.compress",function(t,e){return new Da(t,e).n();}),y("Zlib.Deflate.CompressionType",o),y("Zlib.Deflate.CompressionType.NONE",o.NONE),y("Zlib.Deflate.CompressionType.FIXED",o.r),y("Zlib.Deflate.CompressionType.DYNAMIC",o.j);var g=0,C=1,u={D:g,C:C};V.prototype.p=function(){for(;!this.s;){var u=X(this,3);switch(1&u&&(this.s=et),u>>>=1){case 0:var t=this.input,e=this.c,r=this.a,n=this.b,a=tt,_=r.length,o=tt;switch(this.e=this.g=0,(l=t[e++])===tt&&i(Error("invalid uncompressed block header: LEN (first byte)")),a=l,(l=t[e++])===tt&&i(Error("invalid uncompressed block header: LEN (second byte)")),a|=l<<8,(l=t[e++])===tt&&i(Error("invalid uncompressed block header: NLEN (first byte)")),h=l,(l=t[e++])===tt&&i(Error("invalid uncompressed block header: NLEN (second byte)")),a===~(h|=l<<8)&&i(Error("invalid uncompressed block header: length verify")),e+a>t.length&&i(Error("input buffer is broken")),this.m){case g:for(;n+a>r.length;){if(a-=o=_-n,it)r.set(t.subarray(e,e+o),n),n+=o,e+=o;else for(;o--;)r[n++]=t[e++];this.b=n,r=this.f(),n=this.b;}break;case C:for(;n+a>r.length;)r=this.f({v:2});break;default:i(Error("invalid inflate mode"));}if(it)r.set(t.subarray(e,e+a),n),n+=a,e+=a;else for(;a--;)r[n++]=t[e++];this.c=e,this.b=n,this.a=r;break;case 1:this.o(I,D);break;case 2:c=m=p=f=y=v=h=l=s=void 0;var s=this;var d=function(t,e,i){var r,n,a,o;for(o=0;o<t;)switch(r=mb(this,e),r){case 16:for(a=3+X(this,2);a--;)i[o++]=n;break;case 17:for(a=3+X(this,3);a--;)i[o++]=0;n=0;break;case 18:for(a=11+X(this,7);a--;)i[o++]=0;n=0;break;default:n=i[o++]=r;}return i;};var f,p,m,c,l=X(s,5)+257,h=X(s,5)+1,v=X(s,4)+4,y=new(it?Uint8Array:Array)(x.length);for(c=0;c<v;++c)y[x[c]]=X(s,3);f=S(y),p=new(it?Uint8Array:Array)(l),m=new(it?Uint8Array:Array)(h),s.o(S(d.call(s,l,f,p)),S(d.call(s,h,f,m)));break;default:i(Error("unknown BTYPE: "+u));}}return this.t();};var p,m,e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=it?new Uint16Array(e):e,e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=it?new Uint16Array(e):e,e=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],A=it?new Uint8Array(e):e,e=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],T=it?new Uint16Array(e):e,e=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=it?new Uint8Array(e):e,E=new(it?Uint8Array:Array)(288);for(p=0,m=E.length;p<m;++p)E[p]=p<=143?8:p<=255?9:p<=279?7:8;var M,R,I=S(E),B=new(it?Uint8Array:Array)(30);for(M=0,R=B.length;M<R;++M)B[M]=5;var D=S(B);function X(t,e){for(var r,n=t.g,a=t.e,o=t.input,s=t.c;a<e;)(r=o[s++])===tt&&i(Error("input buffer is broken")),n|=r<<a,a+=8;return r=n&(1<<e)-1,t.g=n>>>e,t.e=a-e,t.c=s,r;}function mb(t,e){for(var r,n=t.g,a=t.e,o=t.input,s=t.c,c=e[0],l=e[1];a<l;)(r=o[s++])===tt&&i(Error("input buffer is broken")),n|=r<<a,a+=8;return e=c[n&(1<<l)-1],t.g=n>>(c=e>>>16),t.e=a-c,t.c=s,65535&e;}function nb(t,e){var r,n;this.input=t,this.c=0,e?(e.index&&(this.c=e.index),e.verify&&(this.M=e.verify)):e={},r=t[this.c++],n=t[this.c++],(15&r)===z?this.method=z:i(Error("unsupported compression method")),0!=((r<<8)+n)%31&&i(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&i(Error("fdict flag is not supported")),this.A=new V(t,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize});}V.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,a,o,s,c=i.length-258;256!==(n=mb(this,t));)if(n<256)c<=r&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(s=v[a=n-257],0<A[a]&&(s+=X(this,A[a])),n=mb(this,e),o=T[n],0<w[n]&&(o+=X(this,w[n])),c<=r&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r;},V.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,a,o,s,c=i.length;256!==(n=mb(this,t));)if(n<256)c<=r&&(c=(i=this.f()).length),i[r++]=n;else for(s=v[a=n-257],0<A[a]&&(s+=X(this,A[a])),n=mb(this,e),o=T[n],0<w[n]&&(o+=X(this,w[n])),c<r+s&&(c=(i=this.f()).length);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r;},V.prototype.f=function(){var t,e,i=new(it?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(it)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,it)n.set(n.subarray(r,32768+r));else for(t=0;t<32768;++t)n[t]=n[r+t];return this.b=32768,n;},V.prototype.J=function(t){var e,i=this.input.length/this.c+1|0,r=this.input,n=this.a;return t&&("number"==typeof t.v&&(i=t.v),"number"==typeof t.F&&(i+=t.F)),r=i<2?(t=(r.length-this.c)/this.u[2]/2*258|0)<n.length?n.length+t:n.length<<1:n.length*i,it?(e=new Uint8Array(r)).set(n):e=n,this.a=e;},V.prototype.t=function(){var t,e,i,r,n,a=0,o=this.a,s=this.k,c=new(it?Uint8Array:Array)(this.q+(this.b-32768));if(0===s.length)return it?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=s.length;e<i;++e)for(r=0,n=(t=s[e]).length;r<n;++r)c[a++]=t[r];for(e=32768,i=this.b;e<i;++e)c[a++]=o[e];return this.k=[],this.buffer=c;},V.prototype.H=function(){var t,e=this.b;return it?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t;},nb.prototype.p=function(){var t,e=this.input;return t=this.A.p(),this.c=this.A.c,this.M&&(e[this.c++]<<24|e[this.c++]<<16|e[this.c++]<<8|e[this.c++])>>>0!==ba(t)&&i(Error("invalid adler-32 checksum")),t;},y("Zlib.Inflate",nb),y("Zlib.Inflate.BufferType",u),u.ADAPTIVE=u.C,u.BLOCK=u.D,y("Zlib.Inflate.prototype.decompress",nb.prototype.p);it&&new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);it&&new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]);it&&new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]);it&&new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]);it&&new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]);var L,O,F=new(it?Uint8Array:Array)(288);for(L=0,O=F.length;L<O;++L)F[L]=L<=143?8:L<=255?9:L<=279?7:8;S(F);var N,k,G=new(it?Uint8Array:Array)(30);for(N=0,k=G.length;N<k;++N)G[N]=5;S(G);var z=8;}.call(window);var r=window.Zlib;r.Deflate=r.Deflate,r.Deflate.compress=r.Deflate.compress,r.Inflate=r.Inflate,r.Inflate.BufferType=r.Inflate.BufferType,r.Inflate.prototype.decompress=r.Inflate.prototype.decompress,e.exports=r;},{}],27:[function(t,e,l){"use strict";var i=t("./platform/utils");var r=t("../../DebugInfos")||{};var n;cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log;function getTypedFormatter(){return function(){var t=r[arguments[0]]||"unknown id";if(1===arguments.length)return t;if(2===arguments.length)return cc.js.formatStr(t,arguments[1]);var e=cc.js.shiftArguments.apply(null,arguments);return cc.js.formatStr.apply(null,[t].concat(e));};}cc._throw=function(t){i.callInNextTick(function(){throw t;});};var a=getTypedFormatter();cc.logID=function(){cc.log(a.apply(null,arguments));};var o=getTypedFormatter();cc.warnID=function(){cc.warn(o.apply(null,arguments));};var s=getTypedFormatter();cc.errorID=function(){cc.error(s.apply(null,arguments));};var h=getTypedFormatter();cc.assertID=function(t){t||cc.assert(!1,h.apply(null,cc.js.shiftArguments.apply(null,arguments)));};var c=cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});e.exports=cc.debug={DebugMode:c,_resetDebugSetting:function(t){var i;cc.log=cc.warn=cc.error=cc.assert=function(){},t!==c.NONE&&(t>c.ERROR?(i=function(t){var e,i;cc.game.canvas&&(n||((e=document.createElement("Div")).setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc.game.canvas.height),(i=e.style).zIndex="99999",i.position="absolute",i.top=i.left="0",(n=document.createElement("textarea")).setAttribute("rows","20"),n.setAttribute("cols","30"),n.setAttribute("disabled","true"),(i=n.style).backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin=0,e.appendChild(n),cc.game.canvas.parentNode.appendChild(e)),n.value=n.value+t+"\r\n",n.scrollTop=n.scrollHeight);},cc.error=function(){i("ERROR :  "+cc.js.formatStr.apply(null,arguments));},cc.assert=function(t,e){!t&&e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),i("ASSERT: "+e));},t!==c.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.js.formatStr.apply(null,arguments));}),t===c.INFO_FOR_WEB_PAGE&&(cc.log=function(){i(cc.js.formatStr.apply(null,arguments));})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments);},cc.assert=function(t,e){if(!t)throw e=e&&cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),new Error(e);}),t!==c.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments);}),t===c.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments);}));},getError:getTypedFormatter(),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats();},setDisplayStats:function(t){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!t);}};},{"../../DebugInfos":1,"./platform/utils":213}],28:[function(t,e,s){"use strict";var i=t("./event/event-target");var h=t("./load-pipeline/auto-release-utils");var r=t("./component-scheduler");var n=t("./node-activator");var u=t("./platform/CCObject");var _=t("./CCGame");var c=t("./renderer");var a=t("./event-manager");var o=t("./CCScheduler");cc.Director=function(){i.call(this),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._startTime=0,this._maxParticleDeltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var t=this;_.on(_.EVENT_SHOW,function(){t._lastUpdate=performance.now();}),_.once(_.EVENT_ENGINE_INITED,this.init,this);},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new o(),cc.ActionManager?(this._actionManager=new cc.ActionManager(),this._scheduler.scheduleUpdate(this._actionManager,o.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0;},sharedInit:function(){this._compScheduler=new r(),this._nodeActivator=new n(),a&&a.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager(),this._scheduler.scheduleUpdate(this._animationManager,o.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager(),this._scheduler.scheduleUpdate(this._collisionManager,o.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager(),this._scheduler.scheduleUpdate(this._physicsManager,o.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc.Physics3DManager?(this._physics3DManager=new cc.Physics3DManager(),this._scheduler.scheduleUpdate(this._physics3DManager,o.PRIORITY_SYSTEM,!1)):this._physics3DManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this);},calculateDeltaTime:function(t){t=t||performance.now(),this._deltaTime=t>this._lastUpdate?(t-this._lastUpdate)/1e3:0,1<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=t;},convertToGL:function(t){var e=_.container;var i=cc.view;var r=e.getBoundingClientRect();var n=r.left+window.pageXOffset-e.clientLeft;e=r.top+window.pageYOffset-e.clientTop;n=i._devicePixelRatio*(t.x-n);e=i._devicePixelRatio*(e+r.height-t.y);return i._isRotated?cc.v2(i._viewportRect.width-e,n):cc.v2(n,e);},convertToUI:function(t){var e=_.container;var i=cc.view;var r=e.getBoundingClientRect();var n=r.left+window.pageXOffset-e.clientLeft;e=r.top+window.pageYOffset-e.clientTop;var a=cc.v2(0,0);return i._isRotated?(a.x=n+t.y/i._devicePixelRatio,a.y=e+r.height-(i._viewportRect.width-t.x)/i._devicePixelRatio):(a.x=n+t.x*i._devicePixelRatio,a.y=e+r.height-t.y*i._devicePixelRatio),a;},end:function(){this._purgeDirectorInNextLoop=!0;},getWinSize:function(){return cc.size(cc.winSize);},getWinSizeInPixels:function(){return cc.size(cc.winSize);},pause:function(){this._paused||(this._paused=!0);},purgeCachedData:function(){cc.loader.releaseAll();},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),a&&a.setEnabled(!1),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,cc.renderer.clear(),cc.AssetLibrary.resetBuiltins(),cc.game.pause(),cc.loader.releaseAll();},reset:function(){this.purgeDirector(),a&&a.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),cc.game.resume();},runSceneImmediate:function(t,e,i){cc.assertID(t instanceof cc.Scene,1216),console.time("InitScene"),t._load(),console.timeEnd("InitScene"),console.time("AttachPersist");var r=Object.keys(_._persistRootNodes).map(function(t){return _._persistRootNodes[t];});for(var n=0;n<r.length;n++){var a=r[n];var o=t.getChildByUuid(a.uuid);var s;o?(s=o.getSiblingIndex(),o._destroyImmediate(),t.insertChild(a,s)):a.parent=t;}console.timeEnd("AttachPersist");var c=this._scene;console.time("AutoRelease");var l=c&&c.autoReleaseAssets&&c.dependAssets;h.autoRelease(l,t.dependAssets,r),console.timeEnd("AutoRelease"),console.time("Destroy"),cc.isValid(c)&&c.destroy(),this._scene=null,u._deferredDestroy(),console.timeEnd("Destroy"),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,console.time("Activate"),t._activate(),console.timeEnd("Activate"),cc.game.resume(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t);},runScene:function(t,e,i){cc.assertID(t,1205),cc.assertID(t instanceof cc.Scene,1216),t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i);},this);},_getSceneUuid:function(t){var e=_._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);for(var i=0;i<e.length;i++){var r=e[i];if(r.url.endsWith(t))return r;}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.errorID(1206,t);}else cc.errorID(1207,t);return null;},loadScene:function(t,e,i){if(this._loadingScene)return cc.warnID(1208,t,this._loadingScene),!1;var r=this._getSceneUuid(t);return r?(r=r.uuid,this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(r,e,i),!0):(cc.errorID(1209,t),!1);},preloadScene:function(i,t,r){void 0===r&&(r=t,t=null);var e=this._getSceneUuid(i);e?(this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,i),cc.loader.load({uuid:e.uuid,type:"uuid"},t,function(t,e){t&&cc.errorID(1210,i,t.message),r&&r(t,e);})):(e='Can not preload the scene "'+i+'" because it is not in the build settings.',r(new Error(e)),cc.error("preloadScene: "+e));},_loadSceneByUuid:function(n,a,o,t){console.time("LoadScene "+n),cc.AssetLibrary.loadAsset(n,function(t,e){console.timeEnd("LoadScene "+n);var i=cc.director;if(i._loadingScene="",t)t="Failed to load scene: "+t,cc.error(t);else{var r;if(e instanceof cc.SceneAsset)return(r=e.scene)._id=e._uuid,r._name=e._name,void i.runSceneImmediate(r,o,a);t="The asset "+n+" is not a scene",cc.error(t);}a&&a(t);});},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0);},setDepthTest:function(t){cc.Camera.main&&(cc.Camera.main.depth=!!t);},setClearColor:function(t){cc.Camera.main&&(cc.Camera.main.backgroundColor=t);},getRunningScene:function(){return this._scene;},getScene:function(){return this._scene;},getAnimationInterval:function(){return 1e3/_.getFrameRate();},setAnimationInterval:function(t){_.setFrameRate(Math.round(1e3/t));},getDeltaTime:function(){return this._deltaTime;},getTotalTime:function(){return performance.now()-this._startTime;},getTotalFrames:function(){return this._totalFrames;},isPaused:function(){return this._paused;},getScheduler:function(){return this._scheduler;},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t);},getActionManager:function(){return this._actionManager;},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1));},getAnimationManager:function(){return this._animationManager;},getCollisionManager:function(){return this._collisionManager;},getPhysicsManager:function(){return this._physicsManager;},getPhysics3DManager:function(){return this._physics3DManager;},startAnimation:function(){cc.game.resume();},stopAnimation:function(){cc.game.pause();},_resetDeltaTime:function(){this._lastUpdate=performance.now(),this._deltaTime=0;},mainLoop:function(t){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):(this.calculateDeltaTime(t),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this._compScheduler.clearup(),this.emit(cc.Director.EVENT_AFTER_UPDATE),u._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW),c.render(this._scene,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_DRAW),a.frameUpdateListeners(),this._totalFrames++);},__fastOn:function(t,e,i){this.on(t,e,i);},__fastOff:function(t,e,i){this.off(t,e,i);}},cc.js.addon(cc.Director.prototype,i.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics",cc.Director.EVENT_AFTER_PHYSICS="director_after_physics",cc.director=new cc.Director(),e.exports=cc.director;},{"./CCGame":29,"./CCScheduler":33,"./component-scheduler":72,"./event-manager":113,"./event/event-target":115,"./load-pipeline/auto-release-utils":140,"./node-activator":161,"./platform/CCObject":195,"./renderer":220}],29:[function(t,e,i){"use strict";var r=t("./event/event-target");t("../audio/CCAudioEngine");var o=t("./CCDebug");var a=t("./renderer/index.js");var s=t("../core/renderer/utils/dynamic-atlas/manager");var c={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(t){this.config.frameRate=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop();},getFrameRate:function(){return this.config.frameRate;},step:function(){cc.director.mainLoop();},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0);},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop());},isPaused:function(){return this._paused;},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var t in c._persistRootNodes)c.removePersistRootNode(c._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),c.pause(),cc.AssetLibrary._loadBuiltins(function(){c.onStart(),c.emit(c.EVENT_RESTART);});});},end:function(){close();},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED));},_loadPreviewScript:function(t){t();},_prepareFinished:function(t){var e=this;this._initEngine(),this._setAnimFrame(),cc.AssetLibrary._loadBuiltins(function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION),e._prepared=!0,e._runMainLoop(),e.emit(e.EVENT_GAME_INITED),t&&t();});},eventTargetOn:r.prototype.on,eventTargetOnce:r.prototype.once,on:function(t,e,i,r){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOn(t,e,i,r);},once:function(t,e,i){this._prepared&&t===this.EVENT_ENGINE_INITED||!this._paused&&t===this.EVENT_GAME_INITED?e.call(i):this.eventTargetOnce(t,e,i);},prepare:function(e){var i=this;var t;this._prepared?e&&e():(t=this.config.jsList)&&0<t.length?cc.loader.load(t,function(t){if(t)throw new Error(JSON.stringify(t));i._loadPreviewScript(function(){i._prepareFinished(e);});}):this._loadPreviewScript(function(){i._prepareFinished(e);});},run:function(t,e){this._initConfig(t),this.onStart=e,this.prepare(c.onStart&&c.onStart.bind(c));},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i))if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802);}else t.parent=i;(this._persistRootNodes[e]=t)._persistNode=!0;}}else cc.warnID(3800);},removePersistRootNode:function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1);},isPersistRootNode:function(t){return t._persistNode;},_setAnimFrame:function(){this._lastTime=performance.now();var t=c.config.frameRate;this._frameTime=1e3/t,cc.director._maxParticleDeltaTime=this._frameTime/1e3*2,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime);},_stTime:function(t){var e=performance.now();var i=Math.max(0,c._frameTime-(e-c._lastTime));var r=window.setTimeout(function(){t();},i);return c._lastTime=e+i,r;},_ctTime:function(t){window.clearTimeout(t);},_runMainLoop:function(){var e,i,t,r,n,a;this._prepared&&(t=(e=this).config,r=cc.director,n=!0,a=t.frameRate,o.setDisplayStats(t.showFPS),i=function(t){e._paused||(e._intervalId=window.requestAnimFrame(i),30===a&&(n=!n)||r.mainLoop(t));},e._intervalId=window.requestAnimFrame(i),e._paused=!1);},_initConfig:function(t){"number"!=typeof t.debugMode&&(t.debugMode=0),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||2<e||e<0)&&(t.renderMode=0),"boolean"!=typeof t.registerSystemEvent&&(t.registerSystemEvent=!0),t.showFPS=1!==e&&!!t.showFPS,this._sceneInfos=t.scenes||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],o._resetDebugSetting(t.debugMode),this.config=t,this._configLoaded=!0;},_determineRenderType:function(){var t=this.config,t=parseInt(t.renderMode)||0;this.renderType=this.RENDER_TYPE_CANVAS;var e=!1;if(0===t?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,e=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):1===t&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,e=!0):2===t&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,e=!0),!e)throw new Error(o.getError(3820,t));},_initRenderer:function(){var t,e,i,r,n;this._rendererInitialized||("CANVAS"===(n=(n=this.config.id)instanceof HTMLElement?n:document.querySelector(n)||document.querySelector("#"+n)).tagName?(t=n.width,e=n.height,this.canvas=i=n,this.container=r=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(r,i)):("DIV"!==n.tagName&&cc.warnID(3819),t=n.clientWidth,e=n.clientHeight,this.canvas=i=document.createElement("CANVAS"),this.container=r=document.createElement("DIV"),n.appendChild(r)),r.setAttribute("id","Cocos2dGameContainer"),r.appendChild(i),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,n="gameCanvas",-1<(" "+(r=i).className+" ").indexOf(" "+n+" ")||(r.className&&(r.className+=" "),r.className+=n),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL&&(n={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS},a.initWebGL(i,n),this._renderContext=a.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&s&&(s.enabled=!0)),this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,a.initCanvas(i),this._renderContext=a.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1;},this._rendererInitialized=!0);},_initEvents:function(){var e,t=window;this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden");var a=!1;function onHidden(){a||(a=!0,c.emit(c.EVENT_HIDE));}function onShown(t,e,i,r,n){a&&(a=!1,c.emit(c.EVENT_SHOW,t,e,i,r,n));}if(e){var i=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"];for(var r=0;r<i.length;r++)document.addEventListener(i[r],function(t){(document[e]||t.hidden?onHidden:onShown)();});}else t.addEventListener("blur",onHidden),t.addEventListener("focus",onShown);-1<navigator.userAgent.indexOf("MicroMessenger")&&(t.onfocus=onShown),"onpageshow"in window&&"onpagehide"in window&&(t.addEventListener("pagehide",onHidden),t.addEventListener("pageshow",onShown),document.addEventListener("pagehide",onHidden),document.addEventListener("pageshow",onShown)),this.on(c.EVENT_HIDE,function(){c.pause();}),this.on(c.EVENT_SHOW,function(){c.resume();});}};r.call(c),cc.js.addon(c,r.prototype),cc.game=e.exports=c;},{"../audio/CCAudioEngine":22,"../core/renderer/utils/dynamic-atlas/manager":223,"./CCDebug":27,"./event/event-target":115,"./renderer/index.js":220}],30:[function(t,e,r){"use strict";var p=t("./value-types");var l=t("./utils/base-node");var u=t("./utils/prefab-helper");var _=t("./utils/trans-pool").NodeMemPool;var i=t("./utils/affine-transform");var s=t("./event-manager");var d=t("./platform/CCMacro");var f=t("./platform/js");t("./event/event");var v=t("./event/event-target");var n=t("./renderer/render-flow");var y=cc.Object.Flags.Destroying;var g=Math.PI/180;var a=!!cc.ActionManager;function xz(){}var b=new p.Vec3();var C=new p.Quat();var x=new p.Vec3();var A=new p.Vec3();var S=new p.Quat();var T=new p.Quat();var w=new p.Vec3();var E=new p.Vec3();var P=new p.Vec3();var M=new p.Vec3();var R=new p.Vec3();var I=new p.Quat();var B=new p.Quat();var D=new p.Vec3();var L=new p.Quat();var V=new p.Vec3();var O=new p.Quat();var F=new p.Vec3();var N=new p.Vec3();var k=new p.Quat();var G=new p.Quat();new p.Quat();var m=cc.mat4();var z=new p.Vec3();var o=new Array(16);o.length=0;t=cc.Enum({DEBUG:31});var h=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535});var c=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"});var U=[c.TOUCH_START,c.TOUCH_MOVE,c.TOUCH_END,c.TOUCH_CANCEL];var W=[c.MOUSE_DOWN,c.MOUSE_ENTER,c.MOUSE_MOVE,c.MOUSE_LEAVE,c.MOUSE_UP,c.MOUSE_WHEEL];var H=!0;function Sz(t,e){0!==t&&(H&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),H=!1);}var j=null;function Zz(t,e){var i=t.getLocation();var r=this.owner;return!!r._hitTest(i,this)&&(e.type=c.TOUCH_START,e.touch=t,e.bubbles=!0,r.dispatchEvent(e),!0);}function nz(t,e){var i=this.owner;e.type=c.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e);}function $z(t,e){var i=t.getLocation();var r=this.owner;r._hitTest(i,this)?e.type=c.TOUCH_END:e.type=c.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,r.dispatchEvent(e);}function Fz(t,e){t.getLocation();var i=this.owner;e.type=c.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e);}function Wz(t){var e=t.getLocation();var i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t));}function az(t){var e=t.getLocation();var i=this.owner;if(i._hitTest(e,this))this._previousIn||(j&&j._mouseListener&&(t.type=c.MOUSE_LEAVE,j.dispatchEvent(t),j._mouseListener._previousIn=!1),j=this.owner,t.type=c.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=c.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=c.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,j=null;}t.stopPropagation();}function jz(t){var e=t.getLocation();var i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation());}function iz(t){var e=t.getLocation();var i=this.owner;i._hitTest(e,this)&&(t.type=c.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation());}function _searchComponentsInParent(t,e){if(e){var i=0;var r=null;for(var n=t;n&&cc.Node.isNode(n);n=n._parent,++i){var a;n.getComponent(e)&&(a={index:i,node:n},r?r.push(a):r=[a]);}return r;}return null;}function _checkListeners(t,e){if(t._objFlags&y)return 1;var i=0;if(t._bubblingListeners)for(;i<e.length;++i)if(t._bubblingListeners.hasEventListener(e[i]))return 1;if(t._capturingListeners)for(;i<e.length;++i)if(t._capturingListeners.hasEventListener(e[i]))return 1;}function _getActualGroupIndex(t){var e=t.groupIndex;return e=0===e&&t.parent?_getActualGroupIndex(t.parent):e;}function _updateCullingMask(t){var e=_getActualGroupIndex(t);t._cullingMask=1<<e;for(var i=0;i<t._children.length;i++)_updateCullingMask(t._children[i]);}function updateLocalMatrix3D(){var t,e,i,r,n,a,o;this._localMatDirty&h.TRSS&&(t=(e=this._matrix).m,p.Trs.toMat4(e,this._trs),(this._skewX||this._skewY)&&(e=t[0],i=t[1],r=t[4],n=t[5],a=Math.tan(this._skewX*g),o=Math.tan(this._skewY*g),1/0===a&&(a=99999999),t[0]=e+r*(o=1/0===o?99999999:o),t[1]=i+n*o,t[4]=r+e*a,t[5]=n+i*a),this._localMatDirty&=~h.TRSS,this._worldMatDirty=!0);}function updateLocalMatrix2D(){var t=this._localMatDirty;var e,i,r,n,a,o,s,c,l;t&h.TRSS&&(e=this._matrix.m,i=this._trs,t&(h.RS|h.SKEW)&&(t=-this._eulerAngles.z,l=this._skewX||this._skewY,r=i[7],n=i[8],t||l?(s=o=0,c=a=1,t&&(t=t*g,s=Math.sin(t),a=c=Math.cos(t),o=-s),e[0]=a*=r,e[1]=o*=r,e[4]=s*=n,e[5]=c*=n,l&&(t=e[0],a=e[1],o=e[4],s=e[5],c=Math.tan(this._skewX*g),l=Math.tan(this._skewY*g),1/0===c&&(c=99999999),e[0]=t+o*(l=1/0===l?99999999:l),e[1]=a+s*l,e[4]=o+t*c,e[5]=s+a*c)):(e[0]=r,e[1]=0,e[4]=0,e[5]=n)),e[12]=i[0],e[13]=i[1],this._localMatDirty&=~h.TRSS,this._worldMatDirty=!0);}function calculWorldMatrix3D(){var t;this._localMatDirty&h.TRSS&&this._updateLocalMatrix(),this._parent?(t=this._parent._worldMatrix,p.Mat4.mul(this._worldMatrix,t,this._matrix)):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1;}function calculWorldMatrix2D(){this._localMatDirty&h.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1;}function mulMat2D(t,e,i){e=e.m,i=i.m,t=t.m;var r=e[0],n=e[1],a=e[4],o=e[5],h=e[12],e=e[13];var s=i[0],c=i[1],l=i[4],u=i[5],_=i[12],i=i[13];0!==n||0!==a?(t[0]=s*r+c*a,t[1]=s*n+c*o,t[4]=l*r+u*a,t[5]=l*n+u*o,t[12]=r*_+a*i+h,t[13]=n*_+o*i+e):(t[0]=s*r,t[1]=c*o,t[4]=l*r,t[5]=u*o,t[12]=r*_+h,t[13]=o*i+e);}var X=p.Mat4.mul;l={name:"cc.Node",extends:l,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,_groupIndex:{default:0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex;},set:function(t){this._groupIndex=t,_updateCullingMask(this),this.emit(c.GROUP_CHANGED,this);}},group:{get:function(){return cc.game.groupList[this.groupIndex]||"";},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t);}},x:{get:function(){return this._trs[0];},set:function(t){var e=this._trs;t!==e[0]&&(e[0]=t,this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED));}},y:{get:function(){return this._trs[1];},set:function(t){var e=this._trs;t!==e[1]&&(e[1]=t,this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED));}},z:{get:function(){return this._trs[2];},set:function(t){var e=this._trs;t!==e[2]&&(e[2]=t,this.setLocalDirty(h.ALL_POSITION),this._renderFlag|=n.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(c.POSITION_CHANGED));}},rotation:{get:function(){return cc.warn("`cc.Node.rotation` is deprecated since v2.1.0, please use `-angle` instead. (`this.node.rotation` -> `-this.node.angle`)"),-this.angle;},set:function(t){cc.warn("`cc.Node.rotation` is deprecated since v2.1.0, please set `-angle` instead. (`this.node.rotation = x` -> `this.node.angle = -x`)"),this.angle=-t;}},angle:{get:function(){return this._eulerAngles.z;},set:function(t){p.Vec3.set(this._eulerAngles,0,0,t),p.Trs.fromAngleZ(this._trs,t),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED);}},rotationX:{get:function(){return cc.warn("`cc.Node.rotationX` is deprecated since v2.1.0, please use `eulerAngles.x` instead. (`this.node.rotationX` -> `this.node.eulerAngles.x`)"),this._eulerAngles.x;},set:function(t){cc.warn("`cc.Node.rotationX` is deprecated since v2.1.0, please set `eulerAngles` instead. (`this.node.rotationX = x` -> `this.node.is3DNode = true; this.node.eulerAngles = cc.v3(x, 0, 0)`"),this._eulerAngles.x!==t&&(this._eulerAngles.x=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,t,this._eulerAngles.y,0),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED));}},rotationY:{get:function(){return cc.warn("`cc.Node.rotationY` is deprecated since v2.1.0, please use `eulerAngles.y` instead. (`this.node.rotationY` -> `this.node.eulerAngles.y`)"),this._eulerAngles.y;},set:function(t){cc.warn("`cc.Node.rotationY` is deprecated since v2.1.0, please set `eulerAngles` instead. (`this.node.rotationY = y` -> `this.node.is3DNode = true; this.node.eulerAngles = cc.v3(0, y, 0)`"),this._eulerAngles.y!==t&&(this._eulerAngles.y=t,this._eulerAngles.x===this._eulerAngles.y?p.Trs.fromAngleZ(this._trs,-t):p.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,t,0),this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED));}},eulerAngles:{get:function(){return p.Trs.toEuler(this._eulerAngles,this._trs);},set:function(t){p.Trs.fromEuler(this._trs,t),this.setLocalDirty(h.ALL_ROTATION),this._renderFlag|=n.FLAG_TRANSFORM,4&this._eventMask&&this.emit(c.ROTATION_CHANGED);}},quat:{get:function(){var t=this._trs;return new p.Quat(t[3],t[4],t[5],t[6]);},set:function(t){this.setRotation(t);}},scale:{get:function(){return this._trs[7];},set:function(t){this.setScale(t);}},scaleX:{get:function(){return this._trs[7];},set:function(t){this._trs[7]!==t&&(this._trs[7]=t,this.setLocalDirty(h.ALL_SCALE),2&this._eventMask&&this.emit(c.SCALE_CHANGED));}},scaleY:{get:function(){return this._trs[8];},set:function(t){this._trs[8]!==t&&(this._trs[8]=t,this.setLocalDirty(h.ALL_SCALE),2&this._eventMask&&this.emit(c.SCALE_CHANGED));}},scaleZ:{get:function(){return this._trs[9];},set:function(t){this._trs[9]!==t&&(this._trs[9]=t,this.setLocalDirty(h.ALL_SCALE),this._renderFlag|=n.FLAG_TRANSFORM,2&this._eventMask&&this.emit(c.SCALE_CHANGED));}},skewX:{get:function(){return this._skewX;},set:function(t){Sz(t),this._skewX=t,this.setLocalDirty(h.SKEW);}},skewY:{get:function(){return this._skewY;},set:function(t){Sz(t),this._skewY=t,this.setLocalDirty(h.SKEW);}},opacity:{get:function(){return this._opacity;},set:function(t){t=cc.misc.clampf(t,0,255),this._opacity!==t&&(this._opacity=t,this._renderFlag|=n.FLAG_OPACITY_COLOR);},range:[0,255]},color:{get:function(){return this._color.clone();},set:function(t){this._color.equals(t)||(this._color.set(t),this._renderFlag|=n.FLAG_COLOR,32&this._eventMask&&this.emit(c.COLOR_CHANGED,t));}},anchorX:{get:function(){return this._anchorPoint.x;},set:function(t){var e=this._anchorPoint;e.x!==t&&(e.x=t,16&this._eventMask&&this.emit(c.ANCHOR_CHANGED));}},anchorY:{get:function(){return this._anchorPoint.y;},set:function(t){var e=this._anchorPoint;e.y!==t&&(e.y=t,16&this._eventMask&&this.emit(c.ANCHOR_CHANGED));}},width:{get:function(){return this._contentSize.width;},set:function(t){t!==this._contentSize.width&&(this._contentSize.width=t,8&this._eventMask&&this.emit(c.SIZE_CHANGED));}},height:{get:function(){return this._contentSize.height;},set:function(t){t!==this._contentSize.height&&(this._contentSize.height=t,8&this._eventMask&&this.emit(c.SIZE_CHANGED));}},zIndex:{get:function(){return this._localZOrder>>16;},set:function(t){t>d.MAX_ZINDEX?(cc.warnID(1636),t=d.MAX_ZINDEX):t<d.MIN_ZINDEX&&(cc.warnID(1637),t=d.MIN_ZINDEX),this.zIndex!==t&&(this._localZOrder=65535&this._localZOrder|t<<16,this.emit(c.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged());}},is3DNode:{get:function(){return this._is3DNode;},set:function(t){this._is3DNode=t,this._update3DFunction();}},up:{get:function(){return p.Vec3.transformQuat(V,p.Vec3.UP,this.getWorldRotation(O)).clone();}},right:{get:function(){return p.Vec3.transformQuat(V,p.Vec3.RIGHT,this.getWorldRotation(O)).clone();}},forward:{get:function(){return p.Vec3.transformQuat(V,p.Vec3.FORWARD,this.getWorldRotation(O)).clone();}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._initDataFromPool(),this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._renderFlag=n.FLAG_TRANSFORM|n.FLAG_OPACITY_COLOR;},statics:{EventType:c,_LocalDirtyFlag:h,isNode:function(t){return t instanceof q&&(t.constructor===q||!(t instanceof cc.Scene));},BuiltinGroupIndex:t},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort();},_onPreDestroy:function(){this._onPreDestroyBase();a&&cc.director.getActionManager().removeAllActionsFromTarget(this),j===this&&(j=null),(this._touchListener||this._mouseListener)&&(s.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),this._backDataIntoPool(),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this);},_onPostActivated:function(t){var e=a?cc.director.getActionManager():null;t?(this._renderFlag|=n.FLAG_WORLD_TRANSFORM,e&&e.resumeTarget(this),s.resumeTarget(this),this._checkListenerMask()):(e&&e.pauseTarget(this),s.pauseTarget(this));},_onHierarchyChanged:function(t){this._updateOrderOfArrival(),_updateCullingMask(this),this._parent&&this._parent._delaySort(),this._renderFlag|=n.FLAG_WORLD_TRANSFORM,this._onHierarchyChangedBase(t),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0),t&&this._activeInHierarchy&&this._checkListenerMask();},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=updateLocalMatrix3D,this._calculWorldMatrix=calculWorldMatrix3D,this._mulMat=X):(this._updateLocalMatrix=updateLocalMatrix2D,this._calculWorldMatrix=calculWorldMatrix2D,this._mulMat=mulMat2D),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=n.FLAG_TRANSFORM,this._localMatDirty=h.ALL;},_initDataFromPool:function(){this._spaceInfo||(this._spaceInfo=_.pop());var t=this._spaceInfo;this._matrix=cc.mat4(t.localMat),p.Mat4.identity(this._matrix),this._worldMatrix=cc.mat4(t.worldMat),p.Mat4.identity(this._worldMatrix),this._localMatDirty=h.ALL,this._worldMatDirty=!0;t=this._trs=this._spaceInfo.trs;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=1,t[7]=1,t[8]=1,t[9]=1;},_backDataIntoPool:function(){_.push(this._spaceInfo),this._matrix=null,this._worldMatrix=null,this._trs=null,this._spaceInfo=null;},_toEuler:function(){var t;this.is3DNode?p.Trs.toEuler(this._eulerAngles,this._trs):(t=Math.asin(this._trs[5])/g*2,p.Vec3.set(this._eulerAngles,0,0,t));},_fromEuler:function(){this.is3DNode?p.Trs.fromEuler(this._trs,this._eulerAngles):p.Trs.fromAngleZ(this._trs,this._eulerAngles.z);},_upgrade_1x_to_2x:function(){this._is3DNode&&this._update3DFunction();var t=this._trs;var e;t?(e=t,t=this._trs=this._spaceInfo.trs,11===e.length?t.set(e.subarray(1)):t.set(e)):t=this._trs=this._spaceInfo.trs,void 0!==this._zIndex&&(this._localZOrder=this._zIndex<<16,this._zIndex=void 0),this._fromEuler(),0!==this._localZOrder&&(this._zIndex=(4294901760&this._localZOrder)>>16),this._color.a<255&&255===this._opacity&&(this._opacity=this._color.a,this._color.a=255);},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&t.root===this&&u.syncWithPrefab(this),this._upgrade_1x_to_2x(),this._updateOrderOfArrival(),this._cullingMask=1<<_getActualGroupIndex(this),this._activeInHierarchy||(a&&cc.director.getActionManager().pauseTarget(this),s.pauseTarget(this));var e=this._children;for(var i=0,r=e.length;i<r;i++)e[i]._onBatchCreated();0<e.length&&(this._renderFlag|=n.FLAG_CHILDREN);},_onBatchRestored:function(){var t;this._upgrade_1x_to_2x(),this._cullingMask=1<<_getActualGroupIndex(this),this._activeInHierarchy||((t=cc.director.getActionManager())&&t.pauseTarget(this),s.pauseTarget(this));var e=this._children;for(var i=0,r=e.length;i<r;i++)e[i]._onBatchRestored();0<e.length&&(this._renderFlag|=n.FLAG_CHILDREN);},_checkListenerMask:function(){var t;this._touchListener?(t=this._touchListener.mask=_searchComponentsInParent(this,cc.Mask),this._mouseListener&&(this._mouseListener.mask=t)):this._mouseListener&&(this._mouseListener.mask=_searchComponentsInParent(this,cc.Mask));},_checknSetupSysEvent:function(t){var e=!1;var i=!1;return-1!==U.indexOf(t)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:_searchComponentsInParent(this,cc.Mask),onTouchBegan:Zz,onTouchMoved:nz,onTouchEnded:$z,onTouchCancelled:Fz}),s.addListener(this._touchListener,this),e=!0),i=!0):-1!==W.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:_searchComponentsInParent(this,cc.Mask),onMouseDown:Wz,onMouseMove:az,onMouseUp:jz,onMouseScroll:iz}),s.addListener(this._mouseListener,this),e=!0),i=!0),e&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||s.pauseTarget(this);},this,0,0,0,!1),i;},on:function(t,e,i,r){if(this._checknSetupSysEvent(t))return this._onDispatch(t,e,i,r);switch(t){case c.POSITION_CHANGED:this._eventMask|=1;break;case c.SCALE_CHANGED:this._eventMask|=2;break;case c.ROTATION_CHANGED:this._eventMask|=4;break;case c.SIZE_CHANGED:this._eventMask|=8;break;case c.ANCHOR_CHANGED:this._eventMask|=16;break;case c.COLOR_CHANGED:this._eventMask|=32;}return this._bubblingListeners||(this._bubblingListeners=new v()),this._bubblingListeners.on(t,e,i);},once:function(t,e,i,r){(this._checknSetupSysEvent(t)&&r?this._capturingListeners=this._capturingListeners||new v():this._bubblingListeners=this._bubblingListeners||new v()).once(t,e,i);},_onDispatch:function(t,e,i,r){var n;{if("boolean"==typeof i?(r=i,i=void 0):r=!!r,e)return n=null,(n=r?this._capturingListeners=this._capturingListeners||new v():this._bubblingListeners=this._bubblingListeners||new v()).hasEventListener(t,e,i)||(n.on(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800);}},off:function(t,e,i,r){var n=-1!==U.indexOf(t);var a=!n&&-1!==W.indexOf(t);if(n||a)this._offDispatch(t,e,i,r),n?this._touchListener&&!_checkListeners(this,U)&&(s.removeListener(this._touchListener),this._touchListener=null):a&&this._mouseListener&&!_checkListeners(this,W)&&(s.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners)if(this._bubblingListeners.off(t,e,i),!this._bubblingListeners.hasEventListener(t))switch(t){case c.POSITION_CHANGED:this._eventMask&=-2;break;case c.SCALE_CHANGED:this._eventMask&=-3;break;case c.ROTATION_CHANGED:this._eventMask&=-5;break;case c.SIZE_CHANGED:this._eventMask&=-9;break;case c.ANCHOR_CHANGED:this._eventMask&=-17;break;case c.COLOR_CHANGED:this._eventMask&=-33;}},_offDispatch:function(t,e,i,r){"boolean"==typeof i?(r=i,i=void 0):r=!!r,e?(r=r?this._capturingListeners:this._bubblingListeners)&&(r.off(t,e,i),i&&i.__eventTargets&&f.array.fastRemove(i.__eventTargets,this)):(this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t));},targetOff:function(t){var e=this._bubblingListeners;e&&(e.targetOff(t),1&this._eventMask&&!e.hasEventListener(c.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!e.hasEventListener(c.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!e.hasEventListener(c.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!e.hasEventListener(c.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!e.hasEventListener(c.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!e.hasEventListener(c.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(t),t&&t.__eventTargets&&f.array.fastRemove(t.__eventTargets,this),this._touchListener&&!_checkListeners(this,U)&&(s.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!_checkListeners(this,W)&&(s.removeListener(this._mouseListener),this._mouseListener=null);},hasEventListener:function(t){var e=!1;return e=!(e=this._bubblingListeners?this._bubblingListeners.hasEventListener(t):e)&&this._capturingListeners?this._capturingListeners.hasEventListener(t):e;},emit:function(t,e,i,r,n,a){this._bubblingListeners&&this._bubblingListeners.emit(t,e,i,r,n,a);},dispatchEvent:function(t){!function(t,e){var i,r;for(e.target=t,o.length=0,t._getCapturingTargets(e.type,o),e.eventPhase=1,r=o.length-1;0<=r;--r)if((i=o[r])._capturingListeners&&((e.currentTarget=i)._capturingListeners.emit(e.type,e,o),e._propagationStopped))return o.length=0;if(o.length=0,e.eventPhase=2,(e.currentTarget=t)._capturingListeners&&t._capturingListeners.emit(e.type,e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.emit(e.type,e),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,o),e.eventPhase=3,r=0;r<o.length;++r)if((i=o[r])._bubblingListeners&&((e.currentTarget=i)._bubblingListeners.emit(e.type,e),e._propagationStopped))return o.length=0;o.length=0;}(this,t),o.length=0;},pauseSystemEvents:function(t){s.pauseTarget(this,t);},resumeSystemEvents:function(t){s.resumeTarget(this,t);},_hitTest:function(h,t){var u=this._contentSize.width,_=this._contentSize.height,e=F,i=N;var d=cc.Camera.findCamera(this);if(d?d.getScreenToWorldPoint(h,e):e.set(h),this._updateWorldMatrix(),!p.Mat4.invert(m,this._worldMatrix))return!1;p.Vec2.transformMat4(i,e,m),i.x+=this._anchorPoint.x*u,i.y+=this._anchorPoint.y*_;var r=!1;if(0<=i.x&&0<=i.y&&i.x<=u&&i.y<=_&&(r=!0,t&&t.mask)){var n=t.mask;var a=this;var f=n?n.length:0;for(var o=0,s=0;a&&s<f;++o,a=a.parent){var c=n[s];if(o===c.index){if(a!==c.node){n.length=s;break;}var l=a.getComponent(cc.Mask);if(l&&l._enabled&&!l._hitTest(e)){r=!1;break;}s++;}else if(o>c.index){n.length=s;break;}}}return r;},_getCapturingTargets:function(t,e){var i=this.parent;for(;i;)i._capturingListeners&&i._capturingListeners.hasEventListener(t)&&e.push(i),i=i.parent;},_getBubblingTargets:function(t,e){var i=this.parent;for(;i;)i._bubblingListeners&&i._bubblingListeners.hasEventListener(t)&&e.push(i),i=i.parent;},runAction:a?function(t){var e;if(this.active)return cc.assertID(t,1618),e=cc.director.getActionManager(),e._suppressDeprecation||(e._suppressDeprecation=!0,cc.warnID(1639)),e.addAction(t,this,!1),t;}:xz,pauseAllActions:a?function(){cc.director.getActionManager().pauseTarget(this);}:xz,resumeAllActions:a?function(){cc.director.getActionManager().resumeTarget(this);}:xz,stopAllActions:a?function(){cc.director.getActionManager().removeAllActionsFromTarget(this);}:xz,stopAction:a?function(t){cc.director.getActionManager().removeAction(t);}:xz,stopActionByTag:a?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612);}:xz,getActionByTag:a?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this);}:function(){return null;},getNumberOfRunningActions:a?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this);}:function(){return 0;},getPosition:function(t){return t=t||new p.Vec3(),p.Trs.toPosition(t,this._trs);},setPosition:function(t,e,i){var r;i=void 0===e?(r=t.x,e=t.y,t.z||0):(r=t,i||0);t=this._trs;t[0]===r&&t[1]===e&&t[2]===i||(t[0]=r,t[1]=e,t[2]=i,this.setLocalDirty(h.ALL_POSITION),this._renderFlag|=n.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(c.POSITION_CHANGED));},getScale:function(t){return void 0!==t?p.Trs.toScale(t,this._trs):(cc.errorID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7]);},setScale:function(t,e,i){t&&"number"!=typeof t?(e=t.y,i=void 0===t.z?1:t.z,t=t.x):void 0!==t&&void 0===e?i=e=t:void 0===i&&(i=1);var r=this._trs;r[7]===t&&r[8]===e&&r[9]===i||(r[7]=t,r[8]=e,r[9]=i,this.setLocalDirty(h.ALL_SCALE),this._renderFlag|=n.FLAG_TRANSFORM,2&this._eventMask&&this.emit(c.SCALE_CHANGED));},getRotation:function(t){return t instanceof p.Quat?p.Trs.toRotation(t,this._trs):(cc.warn("`cc.Node.getRotation()` is deprecated since v2.1.0, please use `-cc.Node.angle` instead. (`this.node.getRotation()` -> `-this.node.angle`)"),-this.angle);},setRotation:function(t,e,i,r){var n;"number"==typeof t&&void 0===e?(cc.warn("`cc.Node.setRotation(degree)` is deprecated since v2.1.0, please set `-cc.Node.angle` instead. (`this.node.setRotation(x)` -> `this.node.angle = -x`)"),this.angle=-t):(n=t,void 0===e&&(n=t.x,e=t.y,i=t.z,r=t.w),(t=this._trs)[3]===n&&t[4]===e&&t[5]===i&&t[6]===r||(t[3]=n,t[4]=e,t[5]=i,t[6]=r,this.setLocalDirty(h.ALL_ROTATION),4&this._eventMask&&this.emit(c.ROTATION_CHANGED)));},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height);},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height;}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e;}8&this._eventMask&&this.emit(c.SIZE_CHANGED);},getAnchorPoint:function(){return cc.v2(this._anchorPoint);},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y;}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e;}this.setLocalDirty(h.ALL_POSITION),16&this._eventMask&&this.emit(c.ANCHOR_CHANGED);},_invTransformPoint:function(t,e){this._parent?this._parent._invTransformPoint(t,e):p.Vec3.copy(t,e);e=this._trs;return p.Trs.toPosition(x,e),p.Vec3.sub(t,t,x),p.Trs.toRotation(S,e),p.Quat.conjugate(T,S),p.Vec3.transformQuat(t,t,T),p.Trs.toScale(x,e),p.Vec3.inverseSafe(A,x),p.Vec3.mul(t,t,A),t;},getWorldPosition:function(t){p.Trs.toPosition(t,this._trs);var e=this._parent;var i;for(;e;)i=e._trs,p.Trs.toScale(b,i),p.Vec3.mul(t,t,b),p.Trs.toRotation(C,i),p.Vec3.transformQuat(t,t,C),p.Trs.toPosition(b,i),p.Vec3.add(t,t,b),e=e._parent;return t;},setWorldPosition:function(t){var e=this._trs;this._parent?this._parent._invTransformPoint(w,t):p.Vec3.copy(w,t),p.Trs.fromPosition(e,w),this.setLocalDirty(h.ALL_POSITION),1&this._eventMask&&this.emit(c.POSITION_CHANGED);},getWorldRotation:function(t){p.Trs.toRotation(k,this._trs),p.Quat.copy(t,k);var e=this._parent;for(;e;)p.Trs.toRotation(k,e._trs),p.Quat.mul(t,k,t),e=e._parent;return t;},setWorldRotation:function(t){this._parent?(this._parent.getWorldRotation(G),p.Quat.conjugate(G,G),p.Quat.mul(G,G,t)):p.Quat.copy(G,t),p.Trs.fromRotation(this._trs,G),this.setLocalDirty(h.ALL_ROTATION);},getWorldScale:function(t){p.Trs.toScale(E,this._trs),p.Vec3.copy(t,E);var e=this._parent;for(;e;)p.Trs.toScale(E,e._trs),p.Vec3.mul(t,t,E),e=e._parent;return t;},setWorldScale:function(t){this._parent?(this._parent.getWorldScale(P),p.Vec3.div(P,t,P)):p.Vec3.copy(P,t),p.Trs.fromScale(this._trs,P),this.setLocalDirty(h.ALL_SCALE);},getWorldRT:function(t){var e=M;var i=I;var r=this._trs;p.Trs.toPosition(e,r),p.Trs.toRotation(i,r);var n=this._parent;for(;n;)r=n._trs,p.Trs.toScale(R,r),p.Vec3.mul(e,e,R),p.Trs.toRotation(B,r),p.Vec3.transformQuat(e,e,B),p.Trs.toPosition(R,r),p.Vec3.add(e,e,R),p.Quat.mul(i,B,i),n=n._parent;return p.Mat4.fromRT(t,i,e),t;},lookAt:function(t,e){this.getWorldPosition(D),p.Vec3.sub(D,D,t),p.Vec3.normalize(D,D),p.Quat.fromViewUp(L,D,e),this.setWorldRotation(L);},_updateLocalMatrix:updateLocalMatrix2D,_calculWorldMatrix:function(){this._localMatDirty&h.TRSS&&this._updateLocalMatrix();var t=this._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):p.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1;},_mulMat:mulMat2D,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();var t=this._children;for(var e=0,i=t.length;e<i;e++)t[e]._worldMatDirty=!0;}},setLocalDirty:function(t){this._localMatDirty|=t,this._worldMatDirty=!0,t===h.ALL_POSITION||t===h.POSITION?this._renderFlag|=n.FLAG_WORLD_TRANSFORM:this._renderFlag|=n.FLAG_TRANSFORM;},setWorldDirty:function(){this._worldMatDirty=!0;},getLocalMatrix:function(t){return this._updateLocalMatrix(),p.Mat4.copy(t,this._matrix);},getWorldMatrix:function(t){return this._updateWorldMatrix(),p.Mat4.copy(t,this._worldMatrix);},convertToNodeSpaceAR:function(t,e){return this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix),t instanceof cc.Vec2?(e=e||new cc.Vec2(),p.Vec2.transformMat4(e,t,m)):(e=e||new cc.Vec3(),p.Vec3.transformMat4(e,t,m));},convertToWorldSpaceAR:function(t,e){return this._updateWorldMatrix(),t instanceof cc.Vec2?(e=e||new cc.Vec2(),p.Vec2.transformMat4(e,t,this._worldMatrix)):(e=e||new cc.Vec3(),p.Vec3.transformMat4(e,t,this._worldMatrix));},convertToNodeSpace:function(t){this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix);var e=new cc.Vec2();return p.Vec2.transformMat4(e,t,m),e.x+=this._anchorPoint.x*this._contentSize.width,e.y+=this._anchorPoint.y*this._contentSize.height,e;},convertToWorldSpace:function(t){this._updateWorldMatrix();t=new cc.Vec2(t.x-this._anchorPoint.x*this._contentSize.width,t.y-this._anchorPoint.y*this._contentSize.height);return p.Vec2.transformMat4(t,t,this._worldMatrix);},getNodeToParentTransform:function(t){t=t||i.identity(),this._updateLocalMatrix();var e=this._contentSize;return z.x=-this._anchorPoint.x*e.width,z.y=-this._anchorPoint.y*e.height,p.Mat4.copy(m,this._matrix),p.Mat4.transform(m,m,z),i.fromMat4(t,m);},getNodeToParentTransformAR:function(t){return t=t||i.identity(),this._updateLocalMatrix(),i.fromMat4(t,this._matrix);},getNodeToWorldTransform:function(t){t=t||i.identity(),this._updateWorldMatrix();var e=this._contentSize;return z.x=-this._anchorPoint.x*e.width,z.y=-this._anchorPoint.y*e.height,p.Mat4.copy(m,this._worldMatrix),p.Mat4.transform(m,m,z),i.fromMat4(t,m);},getNodeToWorldTransformAR:function(t){return t=t||i.identity(),this._updateWorldMatrix(),i.fromMat4(t,this._worldMatrix);},getParentToNodeTransform:function(t){return t=t||i.identity(),this._updateLocalMatrix(),p.Mat4.invert(m,this._matrix),i.fromMat4(t,m);},getWorldToNodeTransform:function(t){return t=t||i.identity(),this._updateWorldMatrix(),p.Mat4.invert(m,this._worldMatrix),i.fromMat4(t,m);},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation());},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation());},getBoundingBox:function(){this._updateLocalMatrix();var t=this._contentSize.width;var e=this._contentSize.height;t=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return t.transformMat4(t,this._matrix);},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox();},_getBoundingBoxTo:function(){var t=this._contentSize.width;var e=this._contentSize.height;var i=cc.rect(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);if(this._calculWorldMatrix(),i.transformMat4(i,this._worldMatrix),!this._children)return i;var r=this._children;for(var n=0;n<r.length;n++){var a=r[n];a&&a.active&&(a=a._getBoundingBoxTo())&&i.union(i,a);}return i;},_updateOrderOfArrival:function(){var t=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|t,this.emit(c.SIBLING_ORDER_CHANGED);},addChild:function(t,e,i){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,void 0!==e&&(t.zIndex=e),void 0!==i&&(t.name=i);},cleanup:function(){a&&cc.director.getActionManager().removeAllActionsFromTarget(this),s.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)(e=this._children[t])&&e.cleanup();},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;this._childArrivalOrder=1;for(var e=0,i=t.length;e<i;e++)(n=t[e])._updateOrderOfArrival();if(s._setDirtyForNode(this),1<t.length){var r,n;for(var a=1,o=t.length;a<o;a++){for(n=t[a],r=a-1;0<=r&&n._localZOrder<t[r]._localZOrder;)t[r+1]=t[r],r--;t[r+1]=n;}this.emit(c.CHILD_REORDER,this);}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this);}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this));},_restoreProperties:!1,onRestore:!1};var q=cc.Class(l);t=q.prototype;f.getset(t,"position",t.getPosition,t.setPosition,!1,!0),cc.Node=e.exports=q;},{"./event-manager":113,"./event/event":116,"./event/event-target":115,"./platform/CCMacro":194,"./platform/js":209,"./renderer/render-flow":221,"./utils/affine-transform":254,"./utils/base-node":255,"./utils/prefab-helper":267,"./utils/trans-pool":273,"./value-types":279}],31:[function(t,e,i){"use strict";var r=t("./CCNode");var n=t("./renderer/render-flow");cc.Object.Flags.HideInHierarchy;var a=r._LocalDirtyFlag;t=cc.Class({name:"cc.PrivateNode",extends:r,properties:{x:{get:function(){return this._originPos.x;},set:function(t){var e=this._originPos;t!==e.x&&(e.x=t,this._posDirty(!0));},override:!0},y:{get:function(){return this._originPos.y;},set:function(t){var e=this._originPos;t!==e.y&&(e.y=t,this._posDirty(!0));},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX;},set:function(){cc.warnID(1638);},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(t){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2();},_posDirty:function(t){this.setLocalDirty(a.POSITION),this._renderFlag|=n.FLAG_TRANSFORM,!0===t&&1&this._eventMask&&this.emit(r.EventType.POSITION_CHANGED);},_updateLocalMatrix:function(){var t;this._localMatDirty&&((t=this.parent)&&(this._trs[0]=this._originPos.x-(t._anchorPoint.x-.5)*t._contentSize.width,this._trs[1]=this._originPos.y-(t._anchorPoint.y-.5)*t._contentSize.height),this._super());},getPosition:function(){return new cc.Vec2(this._originPos);},setPosition:function(t,e){void 0===e&&(e=(t=t.x).y);var i=this._originPos;i.x===t&&i.y===e||(i.x=t,i.y=e,this._posDirty(!0));},setParent:function(t){var e=this._parent;this._super(t),e!==t&&(e&&e.off(r.EventType.ANCHOR_CHANGED,this._posDirty,this),t&&t.on(r.EventType.ANCHOR_CHANGED,this._posDirty,this));},_updateOrderOfArrival:function(){}});cc.js.getset(t.prototype,"parent",t.prototype.getParent,t.prototype.setParent),cc.js.getset(t.prototype,"position",t.prototype.getPosition,t.prototype.setPosition),cc.PrivateNode=e.exports=t;},{"./CCNode":30,"./renderer/render-flow":221}],32:[function(t,e,i){"use strict";cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null;},destroy:function(){if(cc.Object.prototype.destroy.call(this)){var t=this._children;for(var e=0;e<t.length;++e)t[e].active=!1;}this._active=!1,this._activeInHierarchy=!1;},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0);},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t);}}),e.exports=cc.Scene;},{"./CCNode":30}],33:[function(t,r,n){"use strict";var e=t("./platform/js");t=t("./platform/id-generater");var c=new t("Scheduler");function ey(t,e,i,r){this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=r;}var a=[];ey.get=function(t,e,i,r){var n=a.pop();return n?(n.target=t,n.priority=e,n.paused=i,n.markedForDeletion=r):n=new ey(t,e,i,r),n;},ey.put=function(t){a.length<20&&(t.target=null,a.push(t));};function Ly(t,e,i,r){this.list=t,this.entry=e,this.target=i,this.callback=r;}var o=[];Ly.get=function(t,e,i,r){var n=o.pop();return n?(n.list=t,n.entry=e,n.target=i,n.callback=r):n=new Ly(t,e,i,r),n;},Ly.put=function(t){o.length<20&&(t.list=t.entry=t.target=t.callback=null,o.push(t));};function Ky(t,e,i,r,n,a){var o=this;o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=a;}var s=[];function CallbackTimer(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null;}Ky.get=function(t,e,i,r,n,a){var o=s.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=r,o.currentTimerSalvaged=n,o.paused=a):o=new Ky(t,e,i,r,n,a),o;},Ky.put=function(t){s.length<20&&(t.timers=t.target=t.currentTimer=null,s.push(t));};t=CallbackTimer.prototype;t.initWithCallback=function(t,e,i,r,n,a){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=r,this._delay=a,this._useDelay=0<this._delay,this._repeat=n,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0;},t.getInterval=function(){return this._interval;},t.setInterval=function(t){this._interval=t;},t.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()));},t.getCallback=function(){return this._callback;},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1);},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target);};var i=[];CallbackTimer.get=function(){return i.pop()||new CallbackTimer();},CallbackTimer.put=function(t){i.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,i.push(t));},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=e.createMap(!0),this._hashForTimers=e.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[];},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(t){delete this._hashForTimers[t.target._id];var e=this._arrayForTimers;for(var i=0,r=e.length;i<r;i++)if(e[i]===t){e.splice(i,1);break;}Ky.put(t);},_removeUpdateFromHash:function(t){t=t.target._id;var e=this._hashForUpdates[t];if(e){var i=e.list,r=e.entry;for(var n=0,a=i.length;n<a;n++)if(i[n]===r){i.splice(n,1);break;}delete this._hashForUpdates[t],ey.put(r),Ly.put(e);}},_priorityIn:function(t,e,i){for(var r=0;r<t.length;r++)if(i<t[r].priority)return void t.splice(r,0,e);t.push(e);},_appendIn:function(t,e){t.push(e);},enableForTarget:function(t){t._id||(t.__instanceId?cc.warnID(1513):t._id=c.getNewId());},setTimeScale:function(t){this._timeScale=t;},getTimeScale:function(){return this._timeScale;},update:function(t){var e,i,r,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,r=(i=this._updatesNegList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updates0List).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);for(e=0,r=(i=this._updatesPosList).length;e<r;e++)(n=i[e]).paused||n.markedForDeletion||n.target.update(t);var a,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(a=o[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e);}for(e=0,i=this._updatesNegList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updates0List;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;for(e=0,i=this._updatesPosList;e<i.length;)(n=i[e]).markedForDeletion?this._removeUpdateFromHash(n):e++;this._updateHashLocked=!1,this._currentTarget=null;},schedule:function(t,e,i,r,l,n){"function"!=typeof t&&(a=t,t=e,e=a),4!==arguments.length&&5!==arguments.length||(n=!!r,r=cc.macro.REPEAT_FOREVER,l=0),cc.assertID(e,1502);var a=e._id;a||(e.__instanceId?(cc.warnID(1513),a=e._id=e.__instanceId):cc.errorID(1510));var o=this._hashForTimers[a];var s,c;if(o?o.paused!==n&&cc.warnID(1511):(o=Ky.get(null,e,0,null,null,n),this._arrayForTimers.push(o),this._hashForTimers[a]=o),null==o.timers)o.timers=[];else for(c=0;c<o.timers.length;++c)if((s=o.timers[c])&&t===s._callback)return cc.logID(1507,s.getInterval(),i),void(s._interval=i);(s=CallbackTimer.get()).initWithCallback(this,t,e,i,r,l),o.timers.push(s),this._currentTarget===o&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1);},scheduleUpdate:function(t,e,i){var r=t._id;r||(t.__instanceId?(cc.warnID(1513),r=t._id=t.__instanceId):cc.errorID(1510));var n=this._hashForUpdates[r];if(n&&n.entry){if(n.entry.priority===e)return n.entry.markedForDeletion=!1,void(n.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),n.entry.markedForDeletion=!1,void(n.entry.paused=i);this.unscheduleUpdate(t);}n=ey.get(t,e,i,!1);var a;0===e?(a=this._updates0List,this._appendIn(a,n)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,n,e)),this._hashForUpdates[r]=Ly.get(a,n,t,null);},unschedule:function(t,e){if(e&&t){var i=e._id;i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510));var r=this._hashForTimers[i];if(r){var n=r.timers;for(var a=0,o=n.length;a<o;a++){var s=n[a];if(t===s._callback)return s!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),n.splice(a,1),CallbackTimer.put(s),r.timerIndex>=a&&r.timerIndex--,void(0===n.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)));}}}},unscheduleUpdate:function(t){var e;t&&((e=t._id)||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510)),(t=this._hashForUpdates[e])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry)));},unscheduleAllForTarget:function(t){if(t){var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));e=this._hashForTimers[e];if(e){var i=e.timers;-1<i.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0);for(var r=0,n=i.length;r<n;r++)CallbackTimer.put(i[r]);i.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e);}this.unscheduleUpdate(t);}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM);},unscheduleAllWithMinPriority:function(t){var e,i,r=this._arrayForTimers;for(e=r.length-1;0<=e;e--)i=r[e],this.unscheduleAllForTarget(i.target);var n;var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(n=this._updatesNegList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),a==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(n=this._updates0List[e])&&this.unscheduleUpdate(n.target),a==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(n=this._updatesPosList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),a==this._updatesPosList.length&&e++;},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=e._id;i||(e.__instanceId?(cc.warnID(1513),i=e._id=e.__instanceId):cc.errorID(1510));e=this._hashForTimers[i];if(!e)return!1;if(null==e.timers)return!1;var r=e.timers;for(var n=0;n<r.length;++n)if(t===r[n]._callback)return!0;return!1;},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM);},pauseAllTargetsWithMinPriority:function(t){var e=[];var i,r=this._arrayForTimers;var n,a;for(n=0,a=r.length;n<a;n++)(i=r[n])&&(i.paused=!0,e.push(i.target));var o;if(t<0)for(n=0;n<this._updatesNegList.length;n++)(o=this._updatesNegList[n])&&o.priority>=t&&(o.paused=!0,e.push(o.target));if(t<=0)for(n=0;n<this._updates0List.length;n++)(o=this._updates0List[n])&&(o.paused=!0,e.push(o.target));for(n=0;n<this._updatesPosList.length;n++)(o=this._updatesPosList[n])&&o.priority>=t&&(o.paused=!0,e.push(o.target));return e;},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e]);},pauseTarget:function(t){cc.assertID(t,1503);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));t=this._hashForTimers[e];t&&(t.paused=!0);t=this._hashForUpdates[e];t&&(t.entry.paused=!0);},resumeTarget:function(t){cc.assertID(t,1504);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));t=this._hashForTimers[e];t&&(t.paused=!1);t=this._hashForUpdates[e];t&&(t.entry.paused=!1);},isTargetPaused:function(t){cc.assertID(t,1505);var e=t._id;e||(t.__instanceId?(cc.warnID(1513),e=t._id=t.__instanceId):cc.errorID(1510));t=this._hashForTimers[e];if(t)return t.paused;t=this._hashForUpdates[e];return!!t&&t.entry.paused;}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,r.exports=cc.Scheduler;},{"./platform/id-generater":205,"./platform/js":209}],34:[function(t,e,i){"use strict";t=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:t,ctor:function(){this.loaded=!0,this.url="";},properties:{nativeUrl:{get:function(){if(this._native){var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);var e;if(cc.AssetLibrary)return e=cc.AssetLibrary.getLibUrlNoExt(this._uuid,!0),46===t.charCodeAt(0)?e+t:e+"/"+t;cc.errorID(6400);}return"";},visible:!1},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset;},set:function(t){this._$nativeAsset=t;}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl;},serialize:!1,createNode:null,_setRawAsset:function(t,e){this._native=!1!==e?t||void 0:"/"+t;}}),e.exports=cc.Asset;},{"./CCRawAsset":42}],35:[function(t,e,i){"use strict";var r=t("./CCAsset");t=t("../event/event-target");var n=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1});var a=cc.Class({name:"cc.AudioClip",extends:r,mixins:[t],ctor:function(){this.loaded=!1,this._audio=null;},properties:{loadMode:{default:n.WEB_AUDIO,type:n},_nativeAsset:{get:function(){return this._audio;},set:function(t){t instanceof cc.AudioClip?this._audio=t._nativeAsset:this._audio=t,this._audio&&(this.loaded=!0,this.emit("load"));},override:!0}},statics:{LoadMode:n,_loadByUrl:function(i,r){var n=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1");n&&n.complete?n._owner instanceof a?r(null,n._owner):r(null,n.content):cc.loader.load(i,function(t,e){if(t)return r(t);n=cc.loader.getItem(i)||cc.loader.getItem(i+"?useDom=1"),r(null,n.content);});}},destroy:function(){cc.audioEngine.uncache(this),this._super();}});cc.AudioClip=a,e.exports=a;},{"../event/event-target":115,"./CCAsset":34}],36:[function(t,e,i){"use strict";function XL(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0;}function xL(t){this._letterDefinitions={},this._texture=t;}xL.prototype={constructor:xL,addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e;},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var i=new XL();cc.js.mixin(i,this._letterDefinitions[e]),t[e]=i;}return t;},getTexture:function(){return this._texture;},getLetter:function(t){return this._letterDefinitions[t];},getLetterDefinitionForChar:function(t){t=t.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(t)?this._letterDefinitions[t]:null;},clear:function(){this._letterDefinitions={};}};var r=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var t=this.spriteFrame;!this._fontDefDictionary&&t&&(this._fontDefDictionary=new xL(t._texture));t=this._fntConfig;if(t){var e=t.fontDefDictionary;for(var i in e){var r=new XL();var n=e[i].rect;r.offsetX=e[i].xOffset,r.offsetY=e[i].yOffset,r.w=n.width,r.h=n.height,r.u=n.x,r.v=n.y,r.textureID=0,r.valid=!0,r.xAdvance=e[i].xAdvance,this._fontDefDictionary.addLetterDefinitions(i,r);}}}});cc.BitmapFont=r,cc.BitmapFont.FontLetterDefinition=XL,cc.BitmapFont.FontAtlas=xL,e.exports=r;},{}],37:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null;},properties:{_nativeAsset:{get:function(){return this._buffer;},set:function(t){this._buffer=t.buffer||t;},override:!0},buffer:function(){return this._buffer;}}});cc.BufferAsset=e.exports=r;},{}],38:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=e.exports=r;},{}],39:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});e.exports=cc.JsonAsset=r;},{}],40:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name);}});cc.LabelAtlas=r,e.exports=r;},{}],41:[function(e,t,i){"use strict";var r=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2});r=cc.Class({name:"cc.Prefab",extends:cc.Asset,ctor:function(){this._createFunction=null,this._instantiatedTimes=0;},properties:{data:null,optimizationPolicy:r.AUTO,asyncLoadAssets:!1,readonly:{default:!1,editorOnly:!0}},statics:{OptimizationPolicy:r,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var t=e("../platform/instantiate-jit");this._createFunction=t.compile(this.data);},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t);},_instantiate:function(){var t;return this.data._prefab._synced=!0,t=this.data._instantiate(),++this._instantiatedTimes,t;},destroy:function(){this.data&&this.data.destroy(),this._super();}});cc.Prefab=t.exports=r,cc.js.obsolete(cc,"cc._Prefab","Prefab");},{"../platform/instantiate-jit":207}],42:[function(t,e,i){"use strict";var r=t("../platform/CCObject");var n=t("../platform/js");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:r,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0});}}),n.value(cc.RawAsset,"isRawAssetType",function(t){return n.isChildClassOf(t,cc.RawAsset)&&!n.isChildClassOf(t,cc.Asset);}),n.value(cc.RawAsset,"wasRawAssetType",function(t){return t===cc.Texture2D||t===cc.AudioClip||t===cc.ParticleAsset||t===cc.Asset;}),e.exports=cc.RawAsset;},{"../platform/CCObject":195,"../platform/js":209}],43:[function(t,e,i){"use strict";var a=(r=t("../../renderer/gfx"))&&r.__esModule?r:{default:r};var o=t("../renderer");var r=t("./CCTexture2D");t=cc.Enum({RB_FMT_D24S8:a.default.RB_FMT_D24S8,RB_FMT_S8:a.default.RB_FMT_S8,RB_FMT_D16:a.default.RB_FMT_D16});r=cc.Class({name:"cc.RenderTexture",extends:r,statics:{DepthStencilFormat:t},ctor:function(){this._framebuffer=null;},initWithSize:function(t,e,i){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var r={colors:[this._texture]};var n;this._depthStencilBuffer&&this._depthStencilBuffer.destroy(),i&&(n=new a.default.RenderBuffer(o.device,i,t,e),i===a.default.RB_FMT_D24S8?r.depthStencil=n:i===a.default.RB_FMT_S8?r.stencil=n:i===a.default.RB_FMT_D16&&(r.depth=n)),this._depthStencilBuffer=n,this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=new a.default.FrameBuffer(o.device,t,e,r),this._packable=!1,this.loaded=!0,this.emit("load");},updateSize:function(t,e){this.width=Math.floor(t||cc.visibleRect.width),this.height=Math.floor(e||cc.visibleRect.height),this._resetUnderlyingMipmaps();var i=this._depthStencilBuffer;i&&i.update(this.width,this.height),this._framebuffer._width=t,this._framebuffer._height=e;},drawTextureAt:function(t,e,i){t._image&&0!==t._image.width&&this._texture.updateSubImage({x:e,y:i,image:t._image,width:t.width,height:t.height,level:0,flipY:!1,premultiplyAlpha:t._premultiplyAlpha});},readPixels:function(t,e,i,r,n){if(!this._framebuffer||!this._texture)return t;e=e||0,i=i||0;r=r||this.width;n=n||this.height;t=t||new Uint8Array(r*n*4);var a=cc.game._renderContext;var o=a.getParameter(a.FRAMEBUFFER_BINDING);return a.bindFramebuffer(a.FRAMEBUFFER,this._framebuffer.getHandle()),a.readPixels(e,i,r,n,a.RGBA,a.UNSIGNED_BYTE,t),a.bindFramebuffer(a.FRAMEBUFFER,o),t;},destroy:function(){this._super(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null);}});cc.RenderTexture=e.exports=r;},{"../../renderer/gfx":312,"../renderer":220,"./CCTexture2D":50}],44:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=r,e.exports=r;},{}],45:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=r;var n=cc.Class({name:"cc.JavaScript",extends:r});cc._JavaScript=n;n=cc.Class({name:"cc.CoffeeScript",extends:r});cc._CoffeeScript=n;n=cc.Class({name:"cc.TypeScript",extends:r});cc._TypeScript=n;},{}],46:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);return 0<t.length&&(t=this._spriteFrames[t[0]])?t.getTexture():null;},getSpriteFrame:function(t){var e=this._spriteFrames[t];return e?(e.name||(e.name=t),e):null;},getSpriteFrames:function(){var t=[];for(var e in this._spriteFrames)t.push(this.getSpriteFrame(e));return t;}});cc.SpriteAtlas=r,e.exports=r;},{}],47:[function(t,e,i){"use strict";var a=t("../event/event-target");var r=t("../utils/texture-util");var v=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}];var n=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[a],properties:{_textureSetter:{set:function(t){t&&(this._texture!==t&&this._refreshTexture(t),this._textureFilename=t.url);}},insetTop:{get:function(){return this._capInsets[1];},set:function(t){this._capInsets[1]=t,this._texture&&this._calculateSlicedUV();}},insetBottom:{get:function(){return this._capInsets[3];},set:function(t){this._capInsets[3]=t,this._texture&&this._calculateSlicedUV();}},insetLeft:{get:function(){return this._capInsets[0];},set:function(t){this._capInsets[0]=t,this._texture&&this._calculateSlicedUV();}},insetRight:{get:function(){return this._capInsets[2];},set:function(t){this._capInsets[2]=t,this._texture&&this._calculateSlicedUV();}}},ctor:function(){a.call(this);var t=arguments[0];var e=arguments[1];var i=arguments[2];var r=arguments[3];var n=arguments[4];this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this._flipX=!1,this._flipY=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],this._textureFilename="",void 0!==t&&this.setTexture(t,e,i,r,n);},textureLoaded:function(){return this._texture&&this._texture.loaded;},onTextureLoaded:function(t,e){return this.textureLoaded()?(t.call(e),!0):(this.once("load",t,e),this.ensureLoadTexture(),!1);},isRotated:function(){return this._rotated;},setRotated:function(t){this._rotated=t,this._texture&&this._calculateUV();},isFlipX:function(){return this._flipX;},isFlipY:function(){return this._flipY;},setFlipX:function(t){this._flipX=t,this._texture&&this._calculateUV();},setFlipY:function(t){this._flipY=t,this._texture&&this._calculateUV();},getRect:function(){return cc.rect(this._rect);},setRect:function(t){this._rect=t,this._texture&&this._calculateUV();},getOriginalSize:function(){return cc.size(this._originalSize);},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t);},getTexture:function(){return this._texture;},_textureLoadedCallback:function(){var t=this;var e=this._texture;var i;e&&(i=e.width,e=e.height,t._rect?t._checkRect(t._texture):t._rect=cc.rect(0,0,i,e),t._originalSize||t.setOriginalSize(cc.size(i,e)),t._offset||t.setOffset(cc.v2(0,0)),t._calculateUV(),t.emit("load"));},_refreshTexture:function(t){(this._texture=t).loaded?this._textureLoadedCallback():t.once("load",this._textureLoadedCallback,this);},getOffset:function(){return cc.v2(this._offset);},setOffset:function(t){this._offset=cc.v2(t);},clone:function(){return new n(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize);},setTexture:function(t,e,i,r,n){this._rect=e||null,r?this.setOffset(r):this._offset=null,n?this.setOriginalSize(n):this._originalSize=null,this._rotated=i||!1;e=t;return"string"==typeof e&&e&&(this._textureFilename=e,this._loadTexture()),e instanceof cc.Texture2D&&this._texture!==e&&this._refreshTexture(e),!0;},_loadTexture:function(){var t;this._textureFilename&&(t=r.loadImage(this._textureFilename),this._refreshTexture(t));},ensureLoadTexture:function(){this._texture?this._texture.loaded||(this._refreshTexture(this._texture),r.postLoadTexture(this._texture)):this._textureFilename&&this._loadTexture();},_checkRect:function(t){var e=this._rect;var i=e.x,r=e.y;this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.width&&cc.errorID(3300,t.url+"/"+this.name,i,t.width),r>t.height&&cc.errorID(3400,t.url+"/"+this.name,r,t.height);},_flipXY:function(t){var e;this._flipX&&(e=t[0],t[0]=t[1],t[1]=e,e=t[2],t[2]=t[3],t[3]=e),this._flipY&&(e=t[0],t[0]=t[2],t[2]=e,e=t[1],t[1]=t[3],t[3]=e);},_calculateSlicedUV:function(){var t=this._rect;var e=this._texture.width;var i=this._texture.height;var r=this._capInsets[0];var n=this._capInsets[2];n=t.width-r-n;var a=this._capInsets[1];var o=this._capInsets[3];var h=t.height-a-o;var s=this.uvSliced;if(s.length=0,this._rotated){v[0].u=t.x/e,v[1].u=(t.x+o)/e,v[2].u=(t.x+o+h)/e,v[3].u=(t.x+t.height)/e,v[3].v=t.y/i,v[2].v=(t.y+r)/i,v[1].v=(t.y+r+n)/i,v[0].v=(t.y+t.width)/i,this._flipXY(v);for(var c=0;c<4;++c){var u=v[c];for(var l=0;l<4;++l){var _=v[3-l];s.push({u:u.u,v:_.v});}}}else{v[0].u=t.x/e,v[1].u=(t.x+r)/e,v[2].u=(t.x+r+n)/e,v[3].u=(t.x+t.width)/e,v[3].v=t.y/i,v[2].v=(t.y+a)/i,v[1].v=(t.y+a+h)/i,v[0].v=(t.y+t.height)/i,this._flipXY(v);for(var d=0;d<4;++d){var f=v[d];for(var p=0;p<4;++p){var m=v[p];s.push({u:m.u,v:f.v});}}}},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV());},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV());},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,r=e.width,n=e.height;var a,o;var s;this._rotated?(e=0===r?0:t.x/r,s=0===r?0:(t.x+t.height)/r,o=0===n?0:(t.y+t.width)/n,a=0===n?0:t.y/n,i[0]=e,i[1]=a,i[2]=e,i[3]=o,i[4]=s,i[5]=a,i[6]=s,i[7]=o):(e=0===r?0:t.x/r,a=0===r?0:(t.x+t.width)/r,s=0===n?0:(t.y+t.height)/n,o=0===n?0:t.y/n,i[0]=e,i[1]=s,i[2]=a,i[3]=s,i[4]=e,i[5]=o,i[6]=a,i[7]=o),this._flipX&&(t=i[0],i[0]=i[2],i[2]=t,t=i[1],i[1]=i[3],i[3]=t,t=i[4],i[4]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t),this._flipY&&(s=i[0],i[0]=i[4],i[4]=s,s=i[1],i[1]=i[5],i[5]=s,s=i[2],i[2]=i[6],i[6]=s,s=i[3],i[3]=i[7],i[7]=s);var c=this.vertices;if(c){c.nu.length=0;for(var l=c.nv.length=0;l<c.u.length;l++)c.nu[l]=c.u[l]/r,c.nv[l]=c.v[l]/n;}this._calculateSlicedUV();},_serialize:!1,_deserialize:function(t,e){var i=t.rect;i&&(this._rect=new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;i=t.capInsets;i&&(this._capInsets[0]=i[0],this._capInsets[1]=i[1],this._capInsets[2]=i[2],this._capInsets[3]=i[3]),this.vertices=t.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[]);i=t.texture;i&&e.result.push(this,"_textureSetter",i);}});t=n.prototype;t.copyWithZone=t.clone,t.copy=t.clone,t.initWithTexture=t.setTexture,cc.SpriteFrame=n,e.exports=n;},{"../assets/CCAsset":34,"../event/event-target":115,"../utils/texture-util":272}],48:[function(t,e,i){"use strict";t=t("./CCFont");t=cc.Class({name:"cc.TTFFont",extends:t,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily;},set:function(t){this._fontFamily=t||"Arial";},override:!0}}});cc.TTFFont=e.exports=t;},{"./CCFont":38}],49:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text;}});e.exports=cc.TextAsset=r;},{}],50:[function(t,n,s){"use strict";e=(e=t("../../renderer/gfx"))&&e.__esModule?e:{default:e};var e;var h=t("../event/event-target");var a=t("../renderer");t("../platform/CCClass");var u=new(t("../platform/id-generater"))("Tex");var _=1024;var f=cc.Enum({RGB565:e.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:e.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:e.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:e.default.TEXTURE_FMT_RGB8,RGBA8888:e.default.TEXTURE_FMT_RGBA8,RGBA32F:e.default.TEXTURE_FMT_RGBA32F,A8:e.default.TEXTURE_FMT_A8,I8:e.default.TEXTURE_FMT_L8,AI8:e.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:e.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:e.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:_++,RGB_PVRTC_4BPPV1:e.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:e.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:+_,RGB_ETC1:e.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:1026,RGB_ETC2:e.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:e.default.TEXTURE_FMT_RGBA_ETC2});var c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648});var l=cc.Enum({LINEAR:9729,NEAREST:9728});var o={9728:0,9729:1};var i=[];var r={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};function _getSharedOptions(){for(var t in r)r[t]=void 0;return i.length=0,r.images=i,r;}var p=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCAsset"),mixins:[h],properties:{_nativeAsset:{get:function(){return this._image;},set:function(t){t._compressed&&t._data?this.initWithData(t._data,this._format,t.width,t.height):this.initWithElement(t);},override:!0},_format:f.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:l.LINEAR,_magFilter:l.LINEAR,_mipFilter:l.LINEAR,_wrapS:c.CLAMP_TO_EDGE,_wrapT:c.CLAMP_TO_EDGE,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps;},set:function(t){var e;this._genMipmaps!==t&&((e=_getSharedOptions()).genMipmaps=t,this.update(e));}},_packable:!0,packable:{get:function(){return this._packable;},set:function(t){this._packable=t;}}},statics:{PixelFormat:f,WrapMode:c,Filter:l,_FilterIndex:o,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm"]},ctor:function(){this._id=u.getNewId(),this.loaded=!1,this.width=0,this.height=0,this._hashDirty=!0,this._hash=0,this._texture=null;},getImpl:function(){return this._texture;},getId:function(){return this._id;},toString:function(){return this.url||"";},update:function(t){var e;t&&(e=!1,void 0!==t.width&&(this.width=t.width),void 0!==t.height&&(this.height=t.height),void 0!==t.minFilter&&(this._minFilter=t.minFilter,t.minFilter=o[t.minFilter]),void 0!==t.magFilter&&(this._magFilter=t.magFilter,t.magFilter=o[t.magFilter]),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter,t.mipFilter=o[t.mipFilter]),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format),void 0!==t.flipY&&(this._flipY=t.flipY,e=!0),void 0!==t.premultiplyAlpha&&(this._premultiplyAlpha=t.premultiplyAlpha,e=!0),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps),e&&this._image&&(t.image=this._image),t.images&&0<t.images.length?this._image=t.images[0]:void 0!==t.image&&(this._image=t.image,t.images||(i.length=0,t.images=i),t.images.push(t.image)),this._texture&&this._texture.update(t),this._hashDirty=!0);},initWithElement:function(t){var e;t&&((this._image=t).complete||t instanceof HTMLCanvasElement?this.handleLoadedTexture():(e=this,t.addEventListener("load",function(){e.handleLoadedTexture();}),t.addEventListener("error",function(t){cc.warnID(3119,t.message);})));},initWithData:function(t,e,i,r){var n=_getSharedOptions();return n.image=t,n.images=[n.image],n.genMipmaps=this._genMipmaps,n.premultiplyAlpha=this._premultiplyAlpha,n.flipY=this._flipY,n.minFilter=o[this._minFilter],n.magFilter=o[this._magFilter],n.wrapS=this._wrapS,n.wrapT=this._wrapT,n.format=this._getGFXPixelFormat(e),n.width=i,n.height=r,this._texture?this._texture.update(n):this._texture=new a.Texture2D(a.device,n),this.width=i,this.height=r,this._checkPackable(),this.loaded=!0,this.emit("load"),!0;},getHtmlElementObj:function(){return this._image;},destroy:function(){this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this),this._image=null,this._texture&&this._texture.destroy(),this._super();},getPixelFormat:function(){return this._format;},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1;},handleLoadedTexture:function(){var t;this._image&&this._image.width&&this._image.height&&(this.width=this._image.width,this.height=this._image.height,(t=_getSharedOptions()).image=this._image,t.images=[t.image],t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._getGFXPixelFormat(this._format),t.premultiplyAlpha=this._premultiplyAlpha,t.flipY=this._flipY,t.minFilter=o[this._minFilter],t.magFilter=o[this._magFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,this._texture?this._texture.update(t):this._texture=new a.Texture2D(a.device,t),this._checkPackable(),this.loaded=!0,this.emit("load"),cc.macro.CLEANUP_IMAGE_CACHE&&this._image instanceof HTMLImageElement&&this._clearImage());},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">";},releaseTexture:function(){this._image=null,this._texture&&this._texture.destroy();},setWrapMode:function(t,e){var i;this._wrapS===t&&this._wrapT===e||((i=_getSharedOptions()).wrapS=t,i.wrapT=e,this.update(i));},setFilters:function(t,e){var i;this._minFilter===t&&this._magFilter===e||((i=_getSharedOptions()).minFilter=t,i.magFilter=e,this.update(i));},setFlipY:function(t){var e;this._flipY!==t&&((e=_getSharedOptions()).flipY=t,this.update(e));},setPremultiplyAlpha:function(t){var e;this._premultiplyAlpha!==t&&((e=_getSharedOptions()).premultiplyAlpha=t,this.update(e));},_checkPackable:function(){var t=cc.dynamicAtlasManager;var e,i;t&&(this._isCompressed()?this._packable=!1:(e=this.width,i=this.height,!this._image||e>t.maxFrameSize||i>t.maxFrameSize||this._getHash()!==t.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)));},_getOpts:function(){var t=_getSharedOptions();return t.width=this.width,t.height=this.height,t.genMipmaps=this._genMipmaps,t.format=this._format,t.premultiplyAlpha=this._premultiplyAlpha,t.anisotropy=this._anisotropy,t.flipY=this._flipY,t.minFilter=o[this._minFilter],t.magFilter=o[this._magFilter],t.mipFilter=o[this._mipFilter],t.wrapS=this._wrapS,t.wrapT=this._wrapT,t;},_getGFXPixelFormat:function(t){return t===f.RGBA_ETC1?t=f.RGB_ETC1:t===f.RGB_A_PVRTC_4BPPV1?t=f.RGB_PVRTC_4BPPV1:t===f.RGB_A_PVRTC_2BPPV1&&(t=f.RGB_PVRTC_2BPPV1),t;},_resetUnderlyingMipmaps:function(t){var e=this._getOpts();e.images=t||[null],this._texture?this._texture.update(e):this._texture=new a.Texture2D(a.device,e);},_serialize:!1,_deserialize:function(t,h){var e=cc.renderer.device;t=t.split(",");var i=t[0];if(i){var r=i.split("_");var n="";var a="";var u=999;var _=this._format;var d=cc.macro.SUPPORT_TEXTURE_FORMATS;for(var o=0;o<r.length;o++){var s=r[o].split("@");var c=s[0];c=p.extnames[c.charCodeAt(0)-48]||c;var l=d.indexOf(c);-1!==l&&l<u?(s=s[1]?parseInt(s[1]):this._format,(".pvr"!==c||e.ext("WEBGL_compressed_texture_pvrtc"))&&(s!==f.RGB_ETC1&&s!==f.RGBA_ETC1||e.ext("WEBGL_compressed_texture_etc1"))&&(s!==f.RGB_ETC2&&s!==f.RGBA_ETC2||e.ext("WEBGL_compressed_texture_etc"))&&(".webp"===c&&!cc.sys.capabilities.webp||(u=l,a=c,_=s))):n=n||c;}a?(this._setRawAsset(a),this._format=_):(this._setRawAsset(n),cc.warnID(3120,h.customEnv.url,n,n));}8===t.length&&(this._minFilter=parseInt(t[1]),this._magFilter=parseInt(t[2]),this._wrapS=parseInt(t[3]),this._wrapT=parseInt(t[4]),this._premultiplyAlpha=49===t[5].charCodeAt(0),this._genMipmaps=49===t[6].charCodeAt(0),this._packable=49===t[7].charCodeAt(0));},_getHash:function(){if(!this._hashDirty)return this._hash;var t=this._genMipmaps?1:0;var e=this._premultiplyAlpha?1:0;var i=this._flipY?1:0;var r=this._minFilter===l.LINEAR?1:2;var n=this._magFilter===l.LINEAR?1:2;var a=this._wrapS===c.REPEAT?1:this._wrapS===c.CLAMP_TO_EDGE?2:3;var o=this._wrapT===c.REPEAT?1:this._wrapT===c.CLAMP_TO_EDGE?2:3;var s=this._format;this._image;return this._hash=Number(""+r+n+s+a+o+t+e+i),this._hashDirty=!1,this._hash;},_isCompressed:function(){return this._format<f.A8||this._format>f.RGBA32F;},_clearImage:function(){cc.loader.removeItem(this._image.id||this._image.src),this._image.src="";}});cc.Texture2D=n.exports=p;},{"../../renderer/gfx":312,"../assets/CCAsset":34,"../event/event-target":115,"../platform/CCClass":189,"../platform/id-generater":205,"../renderer":220}],51:[function(t,e,i){"use strict";t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("./CCSpriteFrame"),t("./CCTexture2D"),t("./CCRenderTexture"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas"),t("./CCTextAsset"),t("./CCJsonAsset"),t("./CCBufferAsset"),t("./material");},{"./CCAsset":34,"./CCAudioClip":35,"./CCBitmapFont":36,"./CCBufferAsset":37,"./CCFont":38,"./CCJsonAsset":39,"./CCLabelAtlas":40,"./CCPrefab":41,"./CCRawAsset":42,"./CCRenderTexture":43,"./CCSceneAsset":44,"./CCScripts":45,"./CCSpriteAtlas":46,"./CCSpriteFrame":47,"./CCTTFFont":48,"./CCTextAsset":49,"./CCTexture2D":50,"./material":58}],52:[function(t,e,i){"use strict";r=(r=t("../CCAsset"))&&r.__esModule?r:{default:r};var r;var n=t("./effect-parser");t=cc.Class({name:"cc.EffectAsset",extends:r.default,ctor:function(){this._effect=null;},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){var t=cc.renderer._forward._programLib;for(var e=0;e<this.shaders.length;e++)t.define(this.shaders[e]);this._initEffect();}},_initEffect:function(){this._effect||(this._effect=(0,n.parseEffect)(this),Object.freeze(this._effect));},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone();},getEffect:function(){return this._initEffect(),this._effect;}});e.exports=cc.EffectAsset=t;},{"../CCAsset":34,"./effect-parser":55}],53:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../CCAsset");var s=t("../CCTexture2D");var c=s.PixelFormat;var n=t("./CCEffectAsset");var l=t("../../utils/texture-util");var h=cc.gfx;t=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"});var a=cc.Class({name:"cc.Material",extends:r,ctor:function(){this._manualHash=!1,this._dirty=!0,this._effect=null;},properties:{_defines:{default:void 0,type:Object},_props:{default:void 0,type:Object},_effectAsset:{type:n,default:null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset;},set:function(t){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&((this._effectAsset=t)?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."));}},effect:{get:function(){return this._effect;}},techniqueIndex:{get:function(){return this._techniqueIndex;},set:function(t){this._techniqueIndex=t,this._effect.switchTechnique(t);}}},statics:{getBuiltinMaterial:function(t){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material():cc.AssetLibrary.getBuiltin("material","builtin-"+t);},BUILTIN_NAME:t,createWithBuiltin:function(t,e){void 0===e&&(e=0);t=cc.AssetLibrary.getBuiltin("effect","builtin-"+t);return a.create(t,e);},create:function(t,e){if(void 0===e&&(e=0),!t)return null;var i=new a();return i.effectAsset=t,i.techniqueIndex=e,i;}},setProperty:function(t,e,i,r){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof i&&(i=parseInt(i)),e instanceof s){var n=e.getPixelFormat();n=n===c.RGBA_ETC1||n===c.RGB_A_PVRTC_4BPPV1||n===c.RGB_A_PVRTC_2BPPV1;var a="CC_USE_ALPHA_ATLAS_"+t;var o=this.getDefine(a,i);if((n||o)&&this.define(a,n),!e.loaded)return e.once("load",function(){this._effect.setProperty(t,e,i);},this),void l.postLoadTexture(e);}this._effect.setProperty(t,e,i,r);}},getProperty:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getProperty(t,e);},define:function(t,e,i,r){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof i&&(i=parseInt(i)),this._effect.define(t,e,i,r));},getDefine:function(t,e){return"string"==typeof e&&(e=parseInt(e)),this._effect.getDefine(t,e);},setCullMode:function(t,e){void 0===t&&(t=h.CULL_BACK),this._effect.setCullMode(t,e);},setDepth:function(t,e,i,r){void 0===i&&(i=h.DS_FUNC_LESS),this._effect.setDepth(t=void 0===t?!1:t,e=void 0===e?!1:e,i,r);},setBlend:function(t,e,i,r,n,a,o,s,c){void 0===e&&(e=h.BLEND_FUNC_ADD),void 0===i&&(i=h.BLEND_SRC_ALPHA),void 0===r&&(r=h.BLEND_ONE_MINUS_SRC_ALPHA),void 0===n&&(n=h.BLEND_FUNC_ADD),void 0===a&&(a=h.BLEND_SRC_ALPHA),void 0===o&&(o=h.BLEND_ONE_MINUS_SRC_ALPHA),this._effect.setBlend(t=void 0===t?!1:t,e,i,r,n,a,o,s=void 0===s?4294967295:s,c);},setStencilEnabled:function(t,e){void 0===t&&(t=h.STENCIL_INHERIT),this._effect.setStencilEnabled(t,e);},setStencil:function(t,e,i,r,n,a,o,s,c){void 0===t&&(t=h.STENCIL_INHERIT),void 0===e&&(e=h.DS_FUNC_ALWAYS),void 0===n&&(n=h.STENCIL_OP_KEEP),void 0===a&&(a=h.STENCIL_OP_KEEP),void 0===o&&(o=h.STENCIL_OP_KEEP),this._effect.setStencil(t,e,i=void 0===i?0:i,r=void 0===r?255:r,n,a,o,s=void 0===s?255:s,c);},updateHash:function(t){this._manualHash=t,this._effect&&this._effect.updateHash(t);},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash();},onLoad:function(){if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex),this._techniqueData=this._techniqueData||{};var t=this._techniqueData;for(var e in t){var i=t[e=parseInt(e)];if(i){for(var r in i.defines)this.define(r,i.defines[r],e);for(var n in i.props)this.setProperty(n,i.props[n],e);}}}}});i.default=a,cc.Material=a,e.exports=i.default;},{"../../utils/texture-util":272,"../CCAsset":34,"../CCTexture2D":50,"./CCEffectAsset":52}],54:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=(t=t("../../../renderer/core/pass"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}var o=cc.gfx;(t=EffectBase.prototype)._createPassProp=function(t,e){var i=e._properties[t];var r;if(i)return r=Object.create(null),r.name=t,r.type=i.type,i.value instanceof Float32Array?r.value=new Float32Array(i.value):r.value=i.value,e._properties[t]=r;},t._setPassProperty=function(t,e,i,r){var n=i._properties.hasOwnProperty(t);if(n){if(n.value===e)return;}else n=this._createPassProp(t,i);return this._dirty=!0,a.default.prototype.setProperty.call(i,t,e,r);},t.setProperty=function(t,e,i,r){var n=!1;var a=this.passes;var o=0,s=a.length;void 0!==i&&(s=(o=i)+1);for(var c=o;c<s;c++)this._setPassProperty(t,e,a[c],r)&&(n=!0);n||cc.warnID(9103,this.name,t);},t.getProperty=function(t,e){var i=this.passes;if(!(e>=i.length)){var r=0,n=i.length;void 0!==e&&(n=(r=e)+1);for(var a=r;a<n;a++){var o=i[a].getProperty(t);if(void 0!==o)return o;}}},t.define=function(t,e,i,r){var n=!1;var a=this.passes;var o=0,s=a.length;void 0!==i&&(s=(o=i)+1);for(var c=o;c<s;c++)a[c].define(t,e,r)&&(n=!0);n||cc.warnID(9104,this.name,t);},t.getDefine=function(t,e){var i=this.passes;if(!(e>=i.length)){var r=0,n=i.length;void 0!==e&&(n=(r=e)+1);for(var a=r;a<n;a++){var o=i[a].getDefine(t);if(void 0!==o)return o;}}},t.setCullMode=function(t,e){void 0===t&&(t=o.CULL_BACK);var i=this.passes;var r=0,n=i.length;void 0!==e&&(n=(r=e)+1);for(var a=r;a<n;a++)i[a].setCullMode(t);this._dirty=!0;},t.setDepth=function(t,e,i,r){var n=this.passes;var a=0,o=n.length;void 0!==r&&(o=(a=r)+1);for(var s=a;s<o;s++)n[s].setDepth(t,e,i);this._dirty=!0;},t.setBlend=function(t,e,i,r,n,h,u,_,a){var o=this.passes;var s=0,c=o.length;void 0!==a&&(c=(s=a)+1);for(var l=s;l<c;l++)o[l].setBlend(t,e,i,r,n,h,u,_);this._dirty=!0;},t.setStencilEnabled=function(t,e){void 0===t&&(t=o.STENCIL_INHERIT);var i=this.passes;var r=0,n=i.length;void 0!==e&&(n=(r=e)+1);for(var a=r;a<n;a++)i[a].setStencilEnabled(t);this._dirty=!0;},t.setStencil=function(t,e,i,r,n,a,o,s,c){var h=this.passes;var u=0,_=h.length;void 0!==c&&(_=(u=c)+1);for(var l=u;l<_;l++){var d=h[l];d.setStencilFront(t,e,i,r,n,a,o,s),d.setStencilBack(t,e,i,r,n,a,o,s);}this._dirty=!0;},t=EffectBase,(r=[{key:"name",get:function(){return this._name;}},{key:"technique",get:function(){return this._technique;}},{key:"passes",get:function(){return[];}}])&&_defineProperties(t.prototype,r),n&&_defineProperties(t,n);r=EffectBase;function EffectBase(){this._dirty=!0,this._name="",this._technique=null;}var r,n;i.default=r,cc.EffectBase=r,e.exports=i.default;},{"../../../renderer/core/pass":303}],55:[function(t,r,e){"use strict";e.__esModule=!0,e.parseEffect=function(t){var e=function(t){var e=t.techniques.length;var i=new Array(e);for(var r=0;r<e;++r){var n=t.techniques[r];var h=n.name||r;var u=n.passes.length;var _=new Array(u);for(var a=0;a<u;++a){var o=n.passes[a];var s=o.name||a;var c=t.name+"-"+h+"-"+s;var l=o.stage||"opaque";var d=function(t,e){var r=e.properties||{};var i=getInvolvedProgram(e.program);for(var n in r)(function(e){if(!i.uniforms.find(function(t){return t.name===e;}))cc.warnID(9107,t.name,e);})(n);var a={};return i.uniforms.forEach(function(t){var e=t.name,i=a[e]=Object.assign({},t),e=r[e];m.enums2default[t.type];e=e?e.type===v.default.PARAM_TEXTURE_2D?null:e.type===v.default.PARAM_INT||e.type===v.default.PARAM_FLOAT?Array.isArray(e.value)?e.value[0]:e.value:new Float32Array(e.value):m.enums2default[t.type],i.value=e;}),a;}(t,o);var f=function(t){var e={};return getInvolvedProgram(t.program).defines.forEach(function(t){e[t.name]=m.enums2default[t.type];}),e;}(o);s=_[a]=new p.default(s,c,o.program,l,d,f);o.rasterizerState&&s.setCullMode(o.rasterizerState.cullMode);c=o.blendState&&o.blendState.targets[0];c&&s.setBlend(c.blend,c.blendEq,c.blendSrc,c.blendDst,c.blendAlphaEq,c.blendSrcAlpha,c.blendDstAlpha,c.blendColor);l=o.depthStencilState;l&&(s.setDepth(l.depthTest,l.depthWrite,l.depthFunc),s.setStencilFront(l.stencilTest,l.stencilFuncFront,l.stencilRefFront,l.stencilMaskFront,l.stencilFailOpFront,l.stencilZFailOpFront,l.stencilZPassOpFront,l.stencilWriteMaskFront),s.setStencilBack(l.stencilTest,l.stencilFuncBack,l.stencilRefBack,l.stencilMaskBack,l.stencilFailOpBack,l.stencilZFailOpBack,l.stencilZPassOpBack,l.stencilWriteMaskBack));}i[r]=new y.default(h,_);}return i;}(t);return new i.default(t.name,e,0,t);};var p=_interopRequireDefault(t("../../../renderer/core/pass"));var m=t("../../../renderer/types");var v=_interopRequireDefault(t("../../../renderer/enums"));var i=_interopRequireDefault(t("./effect"));var y=_interopRequireDefault(t("../../../renderer/core/technique"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function getInvolvedProgram(t){return cc.renderer._forward._programLib.getTemplate(t);}},{"../../../renderer/core/pass":303,"../../../renderer/core/technique":305,"../../../renderer/enums":307,"../../../renderer/types":335,"./effect":57}],56:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=_interopRequireDefault(t("../../../renderer/murmurhash2_gc"));var a=_interopRequireDefault(t("./utils"));t=_interopRequireDefault(t("./effect-base"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}cc.gfx;t=function(i){r=i,(t=EffectVariant).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;_createSuper(EffectVariant);var t,e;function EffectVariant(t){var e;return(e=i.call(this)||this)._effect=void 0,e._passes=[],e._stagePasses={},e._hash=0,e.init(t),e;}t=EffectVariant,(r=[{key:"effect",get:function(){return this._effect;}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)";}},{key:"passes",get:function(){return this._passes;}},{key:"stagePasses",get:function(){return this._stagePasses;}}])&&_defineProperties(t.prototype,r),e&&_defineProperties(t,e);var r=EffectVariant.prototype;return r._onEffectChanged=function(){},r.init=function(t){if(t instanceof EffectVariant&&(t=t.effect),this._effect=t,this._dirty=!0,t){var e=t.passes;var i=this._passes;i.length=0;var r=this._stagePasses={};for(var n=0;n<e.length;n++){var a=i[n]=Object.setPrototypeOf({},e[n]);a._properties=Object.setPrototypeOf({},e[n]._properties),a._defines=Object.setPrototypeOf({},e[n]._defines),r[a._stage]||(r[a._stage]=[]),r[a._stage].push(a);}}},r.updateHash=function(t){},r.getHash=function(){if(!this._dirty)return this._hash;this._dirty=!1;var t="";t+=a.default.serializePasses(this._passes);var e=this._effect;return e&&(t+=a.default.serializePasses(e.passes)),this._hash=(0,n.default)(t,666),this.updateHash(this._hash),this._hash;},EffectVariant;}(t.default);i.default=t,cc.EffectVariant=t,e.exports=i.default;},{"../../../renderer/murmurhash2_gc":330,"./effect-base":54,"./utils":61}],57:[function(t,e,i){"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t=function(a){i=a,(t=Effect).prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i;_createSuper(Effect);var t,e;function Effect(t,e,i,r){var n;return(n=a.call(this)||this)._techniques=[],n._asset=null,n.init(t,e,i,r,!0),n;}t=Effect,(i=[{key:"technique",get:function(){return this._technique;}},{key:"passes",get:function(){return this._technique.passes;}}])&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e);var i=Effect.prototype;return i.init=function(t,e,i,r,n){this._name=t,this._techniques=e,this._technique=e[i],this._asset=r;},i.switchTechnique=function(t){t>=this._techniques.length?cc.warn("Can not switch to technique with index ["+t+"]"):this._technique=this._techniques[t];},i.clear=function(){this._techniques=[];},i.clone=function(){var t=[];for(var e=0;e<this._techniques.length;e++)t.push(this._techniques[e].clone());var i=this._techniques.indexOf(this._technique);return new Effect(this._name,t,i,this._asset);},Effect;}(((t=t("./effect-base"))&&t.__esModule?t:{default:t}).default);i.default=t,cc.Effect=t,e.exports=i.default;},{"./effect-base":54}],58:[function(t,e,i){"use strict";t("./CCEffectAsset"),t("./CCMaterial"),t("./material-variant");},{"./CCEffectAsset":52,"./CCMaterial":53,"./material-variant":60}],59:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=_interopRequireDefault(t("./utils"));t=_interopRequireDefault(t("../../utils/pool"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var r=new(function(n){var t;t=n,(e=MaterialPool).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(MaterialPool);function MaterialPool(){var t;for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return(t=n.call.apply(n,[this].concat(i))||this).enabled=!1,t._pool={},t;}var e=MaterialPool.prototype;return e.get=function(t,e){var i=this._pool;if(t instanceof cc.MaterialVariant){if(!t._owner)return t._owner=e,t;if(t._owner===e)return t;t=t.material;}var r,n;return!this.enabled||i[r=t.effectAsset._uuid]&&(n=a.default.serializeDefines(t._effect._defines)+a.default.serializeTechniques(t._effect._techniques),n=i[r][n]&&i[r][n].pop()),n?this.count--:((n=new cc.MaterialVariant(t))._name=t._name+" (Instance)",n._uuid=t._uuid),n._owner=e,n;},e.put=function(t){var e,i,r;this.enabled&&t._owner&&((e=this._pool)[i=t.effectAsset._uuid]||(e[i]={}),r=a.default.serializeDefines(t._effect._defines)+a.default.serializeTechniques(t._effect._techniques),e[i][r]||(e[i][r]=[]),this.count>this.maxSize||(this._clean(t),e[i][r].push(t),this.count++));},e.clear=function(){this._pool={},this.count=0;},e._clean=function(t){t._owner=null;},MaterialPool;}(t.default))();t.default.register("material",r),i.default=r,e.exports=i.default;},{"../../utils/pool":266,"./utils":61}],60:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=_interopRequireDefault(t("./CCMaterial"));var a=_interopRequireDefault(t("./effect-variant"));var o=_interopRequireDefault(t("./material-pool"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}t=(0,cc._decorator.ccclass)("cc.MaterialVariant")(t=function(i){e=i,(t=MaterialVariant).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(MaterialVariant);var t,e,r;function MaterialVariant(t){var e;return(e=i.call(this)||this)._owner=null,e._material=null,e.init(t),e;}return MaterialVariant.createWithBuiltin=function(t,e){return MaterialVariant.create(n.default.getBuiltinMaterial(t),e);},MaterialVariant.create=function(t,e){return t?o.default.get(t,e):null;},t=MaterialVariant,(e=[{key:"uuid",get:function(){return this._material.uuid;}},{key:"owner",get:function(){return this._owner;}},{key:"material",get:function(){return this._material;}}])&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),MaterialVariant.prototype.init=function(t){this._effect=new a.default(t.effect),this._effectAsset=t._effectAsset,this._material=t;},MaterialVariant;}(n.default))||t;i.default=t,cc.MaterialVariant=t,e.exports=i.default;},{"./CCMaterial":53,"./effect-variant":56,"./material-pool":59}],61:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("../../../renderer/enums"))&&t.__esModule?t:{default:t};function serializeDefines(t){var e="";for(var i in t)e+=i+t[i];return e;}function serializeUniforms(t){var e="";for(var i in t){i=t[i];var r=i.value;r&&(i.type===n.default.PARAM_TEXTURE_2D||i.type===n.default.PARAM_TEXTURE_CUBE?e+=r._id+";":e+=r.toString()+";");}return e;}i.default={serializeDefines:serializeDefines,serializePasses:function(t){var e="";for(var i=0;i<t.length;i++)e+=(r=t[i],a=n=void 0,a=r._programName+r._cullMode,r._blend&&(a+=r._blendEq+r._blendAlphaEq+r._blendSrc+r._blendDst+r._blendSrcAlpha+r._blendDstAlpha+r._blendColor),r._depthTest&&(a+=r._depthWrite+r._depthFunc),r._stencilTest&&(a+=r._stencilFuncFront+r._stencilRefFront+r._stencilMaskFront+r._stencilFailOpFront+r._stencilZFailOpFront+r._stencilZPassOpFront+r._stencilWriteMaskFront+r._stencilFuncBack+r._stencilRefBack+r._stencilMaskBack+r._stencilFailOpBack+r._stencilZFailOpBack+r._stencilZPassOpBack+r._stencilWriteMaskBack),n||(a+=serializeUniforms(r._properties)),a+=serializeDefines(r._defines));var r,n,a;return e;},serializeUniforms:serializeUniforms},e.exports=i.default;},{"../../../renderer/enums":307}],62:[function(t,e,i){"use strict";t("../CCNode").EventType;var b=56;var C=7;var a=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});var x=cc.Vec2.ZERO;var A=cc.Vec2.ONE;function align(t,e){var h=e._target;var u;var _,i;h?function(t,h,e,i){var r=t._parent.scaleX;var n=t._parent.scaleY;var a=0;var o=0;for(var s=t._parent;;){if(a+=s.x,o+=s.y,!(s=s._parent))return e.x=e.y=0,i.x=i.y=1;if(s===h)break;var c=s.scaleX;var l=s.scaleY;a*=c,o*=l,r*=c,n*=l;}i.x=0!==r?1/r:1,i.y=0!==n?1/n:1,e.x=-a,e.y=-o;}(t,u=h,_=x,i=A):u=t._parent;d=(d=u)instanceof cc.Scene?cc.visibleRect:d._contentSize;var d;var f=u._anchorPoint;var p=u instanceof cc.Scene;var m=t.x,v=t.y;var y=t._anchorPoint;var r,n,a,g,o,s,c,l;e._alignFlags&b&&(a=d.width,s=p?(o=cc.visibleRect.left.x,cc.visibleRect.right.x):(o=-f.x*a)+a,o+=e._isAbsLeft?e._left:e._left*a,s-=e._isAbsRight?e._right:e._right*a,h&&(o=(o+=_.x)*i.x,s=(s+=_.x)*i.x),c=y.x,(r=t.scaleX)<0&&(c=1-c,r=-r),m=e.isStretchWidth?(l=s-o,0!==r&&(t.width=l/r),o+c*l):(l=t.width*r,e.isAlignHorizontalCenter?(r=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*a,a=(.5-f.x)*d.width,h&&(r*=i.x,a=(a+=_.x)*i.x),a+(c-.5)*l+r):e.isAlignLeft?o+c*l:s+(c-1)*l)),e._alignFlags&C&&(a=d.height,r=p?(n=cc.visibleRect.bottom.y,cc.visibleRect.top.y):(n=-f.y*a)+a,n+=e._isAbsBottom?e._bottom:e._bottom*a,r-=e._isAbsTop?e._top:e._top*a,h&&(n=(n+=_.y)*i.y,r=(r+=_.y)*i.y),o=y.y,(s=t.scaleY)<0&&(o=1-o,s=-s),v=e.isStretchHeight?(g=r-n,0!==s&&(t.height=g/s),n+o*g):(g=t.height*s,e.isAlignVerticalCenter?(c=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*a,l=(.5-f.y)*d.height,h&&(c*=i.y,l=(l+=_.y)*i.y),l+(o-.5)*g+c):e.isAlignBottom?n+o*g:r+(o-1)*g)),t.setPosition(m,v);}function refreshScene(){var t=cc.director.getScene();if(t){if(r.isAligning=!0,r._nodesOrderDirty)o.length=0,function visitNode(t){var e=t._widget;e&&(align(t,e),e.alignMode!==a.ALWAYS?e.enabled=!1:o.push(e));var i=t._children;for(var r=0;r<i.length;r++){var n=i[r];n._active&&visitNode(n);}}(t),r._nodesOrderDirty=!1;else{var e,i=r._activeWidgetsIterator;for(i.i=0;i.i<o.length;++i.i)align((e=o[i.i]).node,e);}r.isAligning=!1;}}var o=[];var r=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(o),init:function(t){t.on(cc.Director.EVENT_AFTER_UPDATE,refreshScene);t=this.onResized.bind(this);window.addEventListener("resize",t),window.addEventListener("orientationchange",t);},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0;},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t);},onResized:function(){var t=cc.director.getScene();t&&this.refreshWidgetOnResized(t);},refreshWidgetOnResized:function(t){var e=cc.Node.isNode(t)&&t.getComponent(cc.Widget);e&&e.alignMode===a.ON_WINDOW_RESIZE&&(e.enabled=!0);var i=t._children;for(var r=0;r<i.length;r++){var n=i[r];this.refreshWidgetOnResized(n);}},updateAlignment:function updateAlignment(t){var e=t._parent;cc.Node.isNode(e)&&updateAlignment(e);var i=t._widget||t.getComponent(cc.Widget);i&&e&&align(t,i);},AlignMode:a};},{"../CCNode":30}],63:[function(t,h,u){"use strict";var a=t("../value-types");var _=t("../geom-utils");var d=t("../utils/affine-transform");var r=t("../renderer/index");var f=t("../renderer/render-flow");var i=t("../CCGame");var n=null;n=t("../../renderer/scene/camera");var o=cc.mat4();var s=cc.mat4();var p=cc.v3();var m=cc.v3();var e=cc.v3();var c=[];var l=null;function repositionDebugCamera(){var t,e;l&&(t=l.getNode(),e=cc.game.canvas,t.z=e.height/1.1566,t.x=e.width/2,t.y=e.height/2);}t=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4});var v=cc.Enum({OPAQUE:1,TRANSPARENT:2});t=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){var t;i.renderType!==i.RENDER_TYPE_CANVAS?((t=new n()).setStages(["opaque"]),t.dirty=!0,this._inited=!1,this._camera=t):this._inited=!0;},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:t.DEPTH|t.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio;},set:function(t){this._zoomRatio=t;},tooltip:!1},fov:{get:function(){return this._fov;},set:function(t){this._fov=t;},tooltip:!1},orthoSize:{get:function(){return this._orthoSize;},set:function(t){this._orthoSize=t;},tooltip:!1},nearClip:{get:function(){return this._nearClip;},set:function(t){this._nearClip=t,this._updateClippingpPlanes();},tooltip:!1},farClip:{get:function(){return this._farClip;},set:function(t){this._farClip=t,this._updateClippingpPlanes();},tooltip:!1},ortho:{get:function(){return this._ortho;},set:function(t){this._ortho=t,this._updateProjection();},tooltip:!1},rect:{get:function(){return this._rect;},set:function(t){this._rect=t,this._updateRect();},tooltip:!1},cullingMask:{get:function(){return this._cullingMask;},set:function(t){this._cullingMask=t,this._updateCameraMask();},tooltip:!1},clearFlags:{get:function(){return this._clearFlags;},set:function(t){this._clearFlags=t,this._camera&&this._camera.setClearFlags(t);},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor;},set:function(t){this._backgroundColor.equals(t)||(this._backgroundColor.set(t),this._updateBackgroundColor());},tooltip:!1},depth:{get:function(){return this._depth;},set:function(t){this._depth=t,this._camera&&this._camera.setPriority(t);},tooltip:!1},targetTexture:{get:function(){return this._targetTexture;},set:function(t){this._targetTexture=t,this._updateTargetTexture();},tooltip:!1},renderStages:{get:function(){return this._renderStages;},set:function(t){this._renderStages=t,this._updateStages();},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen;},set:function(t){this._alignWithScreen=t;}},_is3D:{get:function(){return this.node&&this.node._is3DNode;}}},statics:{main:null,cameras:c,ClearFlags:t,findCamera:function(t){for(var e=0,i=c.length;e<i;e++){var r=c[e];if(r.containsNode(t))return r;}return null;},_findRendererCamera:function(t){var e=r.scene._cameras;for(var i=0;i<e._count;i++)if(e._data[i]._cullingMask&t._cullingMask)return e._data[i];return null;},_setupDebugCamera:function(){var t,e;l||i.renderType!==i.RENDER_TYPE_CANVAS&&(t=new n(),(l=t).setStages(["opaque"]),t.setFov(60*Math.PI/180),t.setNear(.1),t.setFar(4096),t.dirty=!0,t.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,t.setPriority(cc.macro.MAX_ZINDEX),t.setClearFlags(0),t.setColor(0,0,0,0),e=new cc.Node(),t.setNode(e),repositionDebugCamera(),cc.view.on("design-resolution-changed",repositionDebugCamera),r.scene.addCamera(t));}},_updateCameraMask:function(){var t;this._camera&&(t=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG),this._camera.cullingMask=t);},_updateBackgroundColor:function(){var t;this._camera&&(t=this._backgroundColor,this._camera.setColor(t.r/255,t.g/255,t.b/255,t.a/255));},_updateTargetTexture:function(){var t;this._camera&&(t=this._targetTexture,this._camera.setFrameBuffer(t?t._framebuffer:null));},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip));},_updateProjection:function(){var t;this._camera&&(t=this._ortho?1:0,this._camera.setType(t));},_updateRect:function(){var t;this._camera&&(t=this._rect,this._camera.setRect(t.x,t.y,t.width,t.height));},_updateStages:function(){var t=this._renderStages;var e=[];t&v.OPAQUE&&e.push("opaque"),t&v.TRANSPARENT&&e.push("transparent"),this._camera.setStages(e);},_init:function(){var t;this._inited||(this._inited=!0,(t=this._camera)&&(t.setNode(this.node),t.setClearFlags(this._clearFlags),t.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw()));},onLoad:function(){this._init();},onEnable:function(){i.renderType!==i.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),r.scene.addCamera(this._camera)),c.push(this);},onDisable:function(){i.renderType!==i.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),r.scene.removeCamera(this._camera)),cc.js.array.remove(c,this);},getScreenToWorldMatrix2D:function(t){return this.getWorldToScreenMatrix2D(t),a.Mat4.invert(t,t),t;},getWorldToScreenMatrix2D:function(t){this.node.getWorldRT(o);var e=this.zoomRatio;var i=o.m;i[0]*=e,i[1]*=e,i[4]*=e,i[5]*=e;e=i[12];var r=i[13];var n=cc.visibleRect.center;return i[12]=n.x-(i[0]*e+i[4]*r),i[13]=n.y-(i[1]*e+i[5]*r),t!==o&&a.Mat4.copy(t,o),t;},getScreenToWorldPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3(),this._camera.screenToWorld(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2(),this.getScreenToWorldMatrix2D(o),a.Vec2.transformMat4(e,t,o)),e;},getWorldToScreenPoint:function(t,e){return this.node.is3DNode?(e=e||new cc.Vec3(),this._camera.worldToScreen(e,t,cc.visibleRect.width,cc.visibleRect.height)):(e=e||new cc.Vec2(),this.getWorldToScreenMatrix2D(o),a.Vec2.transformMat4(e,t,o)),e;},getRay:function(t){return cc.geomUtils?(a.Vec3.set(e,t.x,t.y,1),this._camera.screenToWorld(m,e,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(a.Vec3.set(e,t.x,t.y,-1),this._camera.screenToWorld(p,e,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(p),_.Ray.fromPoints(new _.Ray(),p,m)):t;},containsNode:function(t){return t._cullingMask&this.cullingMask;},render:function(t){if(!(t=t||cc.director.getScene()))return null;this.node.getWorldMatrix(o),this.beforeDraw(),f.render(t),r._forward.renderCamera(this._camera,r.scene);},_onAlignWithScreen:function(){var t=cc.game.canvas.height/cc.view._scaleY;this._targetTexture&&(t=cc.visibleRect.height);var e=this._fov*cc.macro.RAD;this.node.z=t/(2*Math.tan(e/2)),e=2*Math.atan(Math.tan(e/2)/this.zoomRatio),this._camera.setFov(e),this._camera.setOrthoHeight(t/2/this.zoomRatio),this.node.setRotation(0,0,0,1);},beforeDraw:function(){var t;this._camera&&(this._alignWithScreen?this._onAlignWithScreen():(t=this._fov*cc.macro.RAD,t=2*Math.atan(Math.tan(t/2)/this.zoomRatio),this._camera.setFov(t),this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)),this._camera.dirty=!0);}});cc.js.mixin(t.prototype,{getNodeToCameraTransform:function(t){var e=d.identity();return t.getWorldMatrix(s),this.containsNode(t)&&(this.getWorldToCameraMatrix(o),a.Mat4.mul(s,s,o)),d.fromMat4(e,s),e;},getCameraToWorldPoint:function(t,e){return this.getScreenToWorldPoint(t,e);},getWorldToCameraPoint:function(t,e){return this.getWorldToScreenPoint(t,e);},getCameraToWorldMatrix:function(t){return this.getScreenToWorldMatrix2D(t);},getWorldToCameraMatrix:function(t){return this.getWorldToScreenMatrix2D(t);}}),h.exports=cc.Camera=t;},{"../../renderer/scene/camera":332,"../CCGame":29,"../geom-utils":123,"../renderer/index":220,"../renderer/render-flow":221,"../utils/affine-transform":254,"../value-types":279}],64:[function(t,e,i){"use strict";cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset;},set:function(t){this._offset=t;},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size;},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height;},type:cc.Size}},resetInEditor:!1});var r=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=e.exports=r;},{}],65:[function(t,e,i){"use strict";cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset;},set:function(t){this._offset=t;},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius;},set:function(t){this._radius=t<0?0:t;}}},resetInEditor:!1});var r=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=e.exports=r;},{}],66:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this);},onEnable:function(){cc.director.getCollisionManager().addCollider(this);}});cc.Collider=e.exports=r;},{}],67:[function(t,e,i){"use strict";var D=(r=t("../value-types/vec2"))&&r.__esModule?r:{default:r};var a=t("./CCContact");var h=a.CollisionType;var o=t("../CCNode").EventType;var L=new D.default();var r=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this);},update:function(t){if(this.enabled){var e,i;var r=this._colliders;for(e=0,i=r.length;e<i;e++)this.updateCollider(r[e]);var n=this._contacts;var a=[];for(e=0,i=n.length;e<i;e++){var o=n[e].updateState();o!==h.None&&a.push([o,n[e]]);}for(e=0,i=a.length;e<i;e++){var s=a[e];this._doCollide(s[0],s[1]);}this.drawColliders();}},_doCollide:function(t,e){var i;switch(t){case h.CollisionEnter:i="onCollisionEnter";break;case h.CollisionStay:i="onCollisionStay";break;case h.CollisionExit:i="onCollisionExit";}var r=e.collider1;var n=e.collider2;var a=r.node._components;var o=n.node._components;var s,c,l;for(s=0,c=a.length;s<c;s++)(l=a[s])[i]&&l[i](n,r);for(s=0,c=o.length;s<c;s++)(l=o[s])[i]&&l[i](r,n);},shouldCollide:function(t,e){t=t.node,e=e.node;var i=cc.game.collisionMatrix;return t!==e&&i[t.groupIndex][e.groupIndex];},initCollider:function(t){var e;t.world||((e=t.world={}).aabb=cc.rect(),e.preAabb=cc.rect(),e.matrix=cc.mat4(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.map(function(t){return cc.v2(t.x,t.y);})):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null));},updateCollider:function(t){var h=t.offset;var e=t.world;var i=e.aabb;var u=e.matrix;t.node.getWorldMatrix(u);var r=e.preAabb;if(r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height,t instanceof cc.BoxCollider){r=t.size;i.x=h.x-r.width/2,i.y=h.y-r.height/2,i.width=r.width,i.height=r.height;r=e.points;var _=r[0],d=r[1],f=r[2],r=r[3];o=u,S=_,s=d,T=f,w=r,c=(a=i).x,l=a.y,E=a.width,a=a.height,P=(o=o.m)[0],M=o[1],R=o[4],I=o[5],B=P*c+R*l+o[12],c=M*c+I*l+o[13],l=P*E,o=M*E,P=R*a,M=I*a,s.x=B,s.y=c,T.x=l+B,T.y=o+c,S.x=P+B,S.y=M+c,w.x=l+P+B,w.y=o+M+c;E=Math.min(_.x,d.x,f.x,r.x);R=Math.min(_.y,d.y,f.y,r.y);I=Math.max(_.x,d.x,f.x,r.x);a=Math.max(_.y,d.y,f.y,r.y);i.x=E,i.y=R,i.width=I-E,i.height=a-R;}else if(t instanceof cc.CircleCollider){D.default.transformMat4(L,t.offset,u),e.position.x=L.x,e.position.y=L.y;s=u.m;T=s[12],S=s[13];s[12]=s[13]=0,L.x=t.radius,L.y=0,D.default.transformMat4(L,L,u);l=Math.sqrt(L.x*L.x+L.y*L.y);e.radius=l,i.x=e.position.x-l,i.y=e.position.y-l,i.width=2*l,i.height=2*l,s[12]=T,s[13]=S;}else if(t instanceof cc.PolygonCollider){var p=t.points;var m=e.points;m.length=p.length;var v=1e6,y=1e6,g=-1e6,b=-1e6;for(var n=0,C=p.length;n<C;n++){m[n]||(m[n]=cc.v2()),L.x=p[n].x+h.x,L.y=p[n].y+h.y,D.default.transformMat4(L,L,u);var x=L.x;var A=L.y;g<(m[n].x=x)&&(g=x),x<v&&(v=x),b<(m[n].y=A)&&(b=A),A<y&&(y=A);}i.x=v,i.y=y,i.width=g-v,i.height=b-y;}var a,o,S,s,T,w,c,l,E,P,M,R,I,B;},addCollider:function(t){var e=this._colliders;if(-1===e.indexOf(t)){for(var i=0,r=e.length;i<r;i++){var n=e[i];this.shouldCollide(t,n)&&(n=new a(t,n),this._contacts.push(n));}e.push(t),this.initCollider(t);}t.node.on(o.GROUP_CHANGED,this.onNodeGroupChanged,this);},removeCollider:function(t){var e=this._colliders;var i=e.indexOf(t);if(0<=i){e.splice(i,1);var r=this._contacts;for(var n=r.length-1;0<=n;n--){var a=r[n];a.collider1!==t&&a.collider2!==t||(a.touching&&this._doCollide(h.CollisionExit,a),r.splice(n,1));}t.node.off(o.GROUP_CHANGED,this.onNodeGroupChanged,this);}else cc.errorID(6600);},onNodeGroupChanged:function(t){var e=t.getComponents(cc.Collider);for(var i=0,r=e.length;i<r;i++){var n=e[i];cc.PhysicsCollider&&n instanceof cc.PhysicsCollider||(this.removeCollider(n),this.addCollider(n));}},drawColliders:function(){if(this._enabledDebugDraw){this._checkDebugDrawValid();var t=this._debugDrawer;t.clear();var e=this._colliders;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(t.strokeColor=cc.Color.WHITE,n instanceof cc.BoxCollider||n instanceof cc.PolygonCollider){var a=n.world.points;if(0<a.length){t.moveTo(a[0].x,a[0].y);for(var o=1;o<a.length;o++)t.lineTo(a[o].x,a[o].y);t.close(),t.stroke();}}else n instanceof cc.CircleCollider&&(t.circle(n.world.position.x,n.world.position.y,n.world.radius),t.stroke());this.enabledDrawBoundingBox&&(n=n.world.aabb,t.strokeColor=cc.Color.BLUE,t.moveTo(n.xMin,n.yMin),t.lineTo(n.xMin,n.yMax),t.lineTo(n.xMax,n.yMax),t.lineTo(n.xMax,n.yMin),t.close(),t.stroke());}}},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics));}});cc.js.getset(r.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw;},function(t){t&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1),this._enabledDebugDraw=t;}),cc.CollisionManager=e.exports=r;},{"../CCNode":30,"../value-types/vec2":288,"./CCContact":68}],68:[function(t,e,i){"use strict";var o=t("./CCIntersection");var r=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});function Contact(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var i=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider;var r=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider;var n=t instanceof cc.CircleCollider;var a=e instanceof cc.CircleCollider;i&&r?this.testFunc=o.polygonPolygon:n&&a?this.testFunc=o.circleCircle:i&&a?this.testFunc=o.polygonCircle:n&&r?(this.testFunc=o.polygonCircle,this.collider1=e,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(e));}Contact.prototype.test=function(){var t=this.collider1.world;var e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===o.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===o.circleCircle?this.testFunc(t,e):this.testFunc===o.polygonCircle&&this.testFunc(t.points,e));},Contact.prototype.updateState=function(){var t=this.test();var e=r.None;return t&&!this.touching?(this.touching=!0,e=r.CollisionEnter):t&&this.touching?e=r.CollisionStay:!t&&this.touching&&(this.touching=!1,e=r.CollisionExit),e;},Contact.CollisionType=r,e.exports=Contact;},{"./CCIntersection":69}],69:[function(t,e,i){"use strict";var r={};function lineLine(t,e,i,r){var n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x);var a=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x);r=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!=r){i=n/r;e=a/r;if(0<=i&&i<=1&&0<=e&&e<=1)return!0;}return!1;}function linePolygon(t,e,i){var r=i.length;for(var n=0;n<r;++n)if(lineLine(t,e,i[n],i[(n+1)%r]))return!0;return!1;}function pointInPolygon(t,e){var i=!1;var h=t.x;var r=t.y;var n=e.length;for(var a=0,o=n-1;a<n;o=a++){var s=e[a].x,c=e[a].y,u=e[o].x,l=e[o].y;r<c!=r<l&&h<(u-s)*(r-c)/(l-c)+s&&(i=!i);}return i;}function pointLineDistance(t,e,i,r){var n=i.x-e.x;var a=i.y-e.y;var o=n*n+a*a;var s=((t.x-e.x)*n+(t.y-e.y)*a)/o;return r=r?!o||s<0?e:1<s?i:cc.v2(e.x+s*n,e.y+s*a):cc.v2(e.x+s*n,e.y+s*a),n=t.x-r.x,a=t.y-r.y,Math.sqrt(n*n+a*a);}r.lineLine=lineLine,r.lineRect=function(t,e,i){var r=new cc.Vec2(i.x,i.y);var n=new cc.Vec2(i.x,i.yMax);var a=new cc.Vec2(i.xMax,i.yMax);return i=new cc.Vec2(i.xMax,i.y),!!lineLine(t,e,r,n)||!!lineLine(t,e,n,a)||!!lineLine(t,e,a,i)||!!lineLine(t,e,i,r);},r.linePolygon=linePolygon,r.rectRect=function(t,e){var i=t.x;var r=t.y;var n=t.x+t.width;t=t.y+t.height;var a=e.x;var o=e.y;var s=e.x+e.width;return e=e.y+e.height,i<=s&&a<=n&&r<=e&&o<=t;},r.rectPolygon=function(t,e){var i,r;var n=new cc.Vec2(t.x,t.y);var a=new cc.Vec2(t.x,t.yMax);var o=new cc.Vec2(t.xMax,t.yMax);var s=new cc.Vec2(t.xMax,t.y);if(linePolygon(n,a,e))return!0;if(linePolygon(a,o,e))return!0;if(linePolygon(o,s,e))return!0;if(linePolygon(s,n,e))return!0;for(i=0,r=e.length;i<r;++i)if(pointInPolygon(e[i],t))return!0;return!!pointInPolygon(n,e)||!!pointInPolygon(a,e)||!!pointInPolygon(o,e)||!!pointInPolygon(s,e);},r.polygonPolygon=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(linePolygon(t[i],t[(i+1)%r],e))return!0;for(i=0,r=e.length;i<r;++i)if(pointInPolygon(e[i],t))return!0;for(i=0,r=t.length;i<r;++i)if(pointInPolygon(t[i],e))return!0;return!1;},r.circleCircle=function(t,e){return t.position.sub(e.position).mag()<t.radius+e.radius;},r.polygonCircle=function(t,e){var i=e.position;if(pointInPolygon(i,t))return!0;for(var r=0,n=t.length;r<n;r++)if(pointLineDistance(i,0===r?t[t.length-1]:t[r-1],t[r],!0)<e.radius)return!0;return!1;},r.pointInPolygon=pointInPolygon,r.pointLineDistance=pointLineDistance,cc.Intersection=e.exports=r;},{}],70:[function(t,e,i){"use strict";cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset;},set:function(t){this._offset=t;},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)];},type:[cc.Vec2]}},resetPointsByContour:!1});var r=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=e.exports=r;},{}],71:[function(t,e,i){"use strict";t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider");},{"./CCBoxCollider":64,"./CCCircleCollider":65,"./CCCollider":66,"./CCCollisionManager":67,"./CCPolygonCollider":70}],72:[function(t,o,s){"use strict";t("./platform/CCClass");var e=t("./platform/CCObject").Flags;var i=t("./platform/js").array;var r=e.IsStartCalled;var n=e.IsOnEnableCalled;e.IsEditorOnEnableCalled;function sortedIndex(t,e){var i=e.constructor._executionOrder;var r=e._id;for(var n=0,a=t.length-1,o=a>>>1;n<=a;o=n+a>>>1){var s=t[o];var c=s.constructor._executionOrder;if(i<c)a=o-1;else if(c<i)n=o+1;else{c=s._id;if(r<c)a=o-1;else{if(!(c<r))return o;n=o+1;}}}return~n;}function stableRemoveInactive(t,e){var i=t.array;var r=t.i+1;for(;r<i.length;){var n=i[r];n._enabled&&n.node._activeInHierarchy?++r:(t.removeAt(r),e&&(n._objFlags&=~e));}}t=cc.Class({__ctor__:function(t){var e=i.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t;},statics:{stableRemoveInactive:stableRemoveInactive},add:null,remove:null,invoke:null});function compareOrder(t,e){return t.constructor._executionOrder-e.constructor._executionOrder;}var a=cc.Class({extends:t,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t);},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t);},cancelInactive:function(t){stableRemoveInactive(this._zero,t),stableRemoveInactive(this._neg,t),stableRemoveInactive(this._pos,t);},invoke:function(){var t=this._neg;0<t.array.length&&(t.array.sort(compareOrder),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;t=this._pos;0<t.array.length&&(t.array.sort(compareOrder),this._invoke(t),t.array.length=0);}});var c=cc.Class({extends:t,add:function(t){var e=t.constructor._executionOrder;var i;0===e?this._zero.array.push(t):(i=sortedIndex(e=(e<0?this._neg:this._pos).array,t))<0&&e.splice(~i,0,t);},remove:function(t){var e=t.constructor._executionOrder;0===e?this._zero.fastRemove(t):0<=(t=sortedIndex((e=e<0?this._neg:this._pos).array,t))&&e.removeAt(t);},invoke:function(t){0<this._neg.array.length&&this._invoke(this._neg,t),this._invoke(this._zero,t),0<this._pos.array.length&&this._invoke(this._pos,t);}});function createInvokeImpl(n,t,a,o){return function(e,i){try{o(e,i);}catch(t){cc._throw(t);var r=e.array;for(a&&(r[e.i]._objFlags|=a),++e.i;e.i<r.length;++e.i)try{n(r[e.i],i);}catch(t){cc._throw(t),a&&(r[e.i]._objFlags|=a);}}};}var l=createInvokeImpl(function(t){t.start(),t._objFlags|=r;},0,r,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.start(),i._objFlags|=r;}});var h=createInvokeImpl(function(t,e){t.update(e);},0,void 0,function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].update(e);});var u=createInvokeImpl(function(t,e){t.lateUpdate(e);},0,void 0,function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i)i[t.i].lateUpdate(e);});function ctor(){this.startInvoker=new a(l),this.updateInvoker=new c(h),this.lateUpdateInvoker=new c(u),this.scheduleInNextFrame=[],this._updating=!1;}e=cc.Class({ctor:ctor,unscheduleAll:ctor,statics:{LifeCycleInvoker:t,OneOffInvoker:a,createInvokeImpl:createInvokeImpl,invokeOnEnable:function(t){var e=cc.director._compScheduler;var i=t.array;for(t.i=0;t.i<i.length;++t.i){var r=i[t.i];r._enabled&&(r.onEnable(),r.node._activeInHierarchy&&e._onEnabled(r));}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=n,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t);},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~n;var e=this.scheduleInNextFrame.indexOf(t);0<=e?i.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&r||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t));},enableComp:function(t,e){if(!(t._objFlags&n)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return;}this._onEnabled(t);}},disableComp:function(t){t._objFlags&n&&(t.onDisable&&t.onDisable(),this._onDisabled(t));},_scheduleImmediate:function(t){!t.start||t._objFlags&r||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t);},_deferredSchedule:function(){var t=this.scheduleInNextFrame;for(var e=0,i=t.length;e<i;e++){var r=t[e];this._scheduleImmediate(r);}t.length=0;},_earlyStartForNewComps:function(){0<this.scheduleInNextFrame.length&&(this._deferredSchedule(),this.startInvoker.invoke());},startPhase:function(){this._updating=!0,0<this.scheduleInNextFrame.length&&this._deferredSchedule(),this.startInvoker.invoke(),this._earlyStartForNewComps();},updatePhase:function(t){this.updateInvoker.invoke(t);},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1;},clearup:function(){this._earlyStartForNewComps();}});o.exports=e;},{"./platform/CCClass":189,"./platform/CCObject":195,"./platform/js":209,"./utils/misc":264}],73:[function(t,e,i){"use strict";var r=t("../../animation/animation-animator");var n=t("../../animation/animation-clip");var a=t("../event/event-target");var o=t("../platform/js");var s=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"});t=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[a],editor:!1,statics:{EventType:s},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=o.createMap(!0),this._didInit=!1,this._currentClip=null;},properties:{_defaultClip:{default:null,type:n},defaultClip:{type:n,get:function(){return this._defaultClip;},set:function(t){},tooltip:!1},currentClip:{get:function(){return this._currentClip;},set:function(t){this._currentClip=t;},type:n,visible:!1},_writableClips:{get:function(){return this._clips;},set:function(t){this._didInit=!1,this._clips=t,this._init();},type:[n]},_clips:{default:[],type:[n],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){var t;this.playOnLoad&&this._defaultClip&&(this._animator&&this._animator.isPlaying||(t=this.getAnimationState(this._defaultClip.name),this._animator.playState(t)));},onEnable:function(){this._animator&&this._animator.resume();},onDisable:function(){this._animator&&this._animator.pause();},onDestroy:function(){this.stop();},getClips:function(){return this._clips;},play:function(t,e){t=this.playAdditive(t,e);return this._animator.stopStatesExcept(t),t;},playAdditive:function(t,e){this._init();t=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);var i;return t&&(this.enabled=!0,(i=this._animator).isPlaying&&t.isPlaying?t.isPaused?i.resumeState(t):(i.stopState(t),i.playState(t,e)):i.playState(t,e),this.enabledInHierarchy||i.pause(),this.currentClip=t.clip),t;},stop:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.stopState(t):this._animator.stop());},pause:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.pauseState(t):this.enabled=!1);},resume:function(t){this._didInit&&(t?(t=this._nameToState[t])&&this._animator.resumeState(t):this.enabled=!0);},setCurrentTime:function(t,e){this._init(),e?(e=this._nameToState[e])&&this._animator.setStateTime(e,t):this._animator.setStateTime(t);},getAnimationState:function(t){this._init();t=this._nameToState[t];return t&&!t.curveLoaded&&this._animator._reloadClip(t),t||null;},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;i=this._clips.indexOf(i.clip);-1!==i&&this._clips.splice(i,1);}i=new cc.AnimationState(t,e);return this._nameToState[e]=i;}cc.warnID(3900);},removeClip:function(e,t){if(e){var i;for(var r in this._init(),this._nameToState)if((i=this._nameToState[r]).clip===e)break;if(e===this._defaultClip){if(!t)return void cc.warnID(3902);this._defaultClip=null;}if(i&&i.isPlaying){if(!t)return void cc.warnID(3903);this.stop(i.name);}this._clips=this._clips.filter(function(t){return!(t===e);}),i&&delete this._nameToState[i.name];}else cc.warnID(3901);},sample:function(t){this._init(),t?(t=this._nameToState[t])&&t.sample():this._animator.sample();},on:function(t,e,i,r){this._init();e=this._EventTargetOn(t,e,i,r);if("lastframe"===t){var n=this._nameToState;for(var a in n)n[a]._lastframeEventOn=!0;}return e;},off:function(t,e,i,r){if(this._init(),"lastframe"===t){var n=this._nameToState;for(var a in n)n[a]._lastframeEventOn=!1;}this._EventTargetOff(t,e,i,r);},_init:function(){this._didInit||(this._didInit=!0,this._animator=new r(this.node,this),this._createStates());},_createStates:function(){this._nameToState=o.createMap(!0);var t=null;var e=!1;for(var i=0;i<this._clips.length;++i){var r=this._clips[i];r&&(t=new cc.AnimationState(r),this._nameToState[t.name]=t,this._defaultClip===r&&(e=t));}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t);}});t.prototype._EventTargetOn=a.prototype.on,t.prototype._EventTargetOff=a.prototype.off,cc.Animation=e.exports=t;},{"../../animation/animation-animator":10,"../../animation/animation-clip":11,"../event/event-target":115,"../platform/js":209,"./CCComponent":78}],74:[function(t,e,i){"use strict";var r=t("../utils/misc");var n=t("./CCComponent");var a=t("../assets/CCAudioClip");t=cc.Class({name:"cc.AudioSource",extends:n,editor:!1,ctor:function(){this.audio=new cc.Audio();},properties:{_clip:{default:null,type:a},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return this.audio.getState()===cc.Audio.State.PLAYING;},visible:!1},clip:{get:function(){return this._clip;},set:function(t){var i;if("string"==typeof t)return cc.warnID(8401,"cc.AudioSource","cc.AudioClip","AudioClip","cc.AudioClip","audio"),i=this,void a._loadByUrl(t,function(t,e){e&&(i.clip=e);});t!==this._clip&&(this._clip=t,this.audio.stop(),this.preload&&(this.audio.src=this._clip));},type:a,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume;},set:function(t){return t=r.clamp01(t),this._volume=t,this._mute||this.audio.setVolume(t),t;},tooltip:!1},mute:{get:function(){return this._mute;},set:function(t){return this._mute=t,this.audio.setVolume(t?0:this._volume),t;},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop;},set:function(t){return this._loop=t,this.audio.setLoop(t),t;},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_ensureDataLoaded:function(){this.audio.src!==this._clip&&(this.audio.src=this._clip);},_pausedCallback:function(){this.audio.getState()===cc.Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0);},_restoreCallback:function(){this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1;},onLoad:function(){this.audio.setVolume(this._mute?0:this._volume),this.audio.setLoop(this._loop);},onEnable:function(){this.preload&&(this.audio.src=this._clip),this.playOnLoad&&this.play(),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this);},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this);},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip);},play:function(){var t;this._clip&&(t=this.audio,this._clip.loaded&&t.stop(),this._ensureDataLoaded(),t.setCurrentTime(0),t.play());},stop:function(){this.audio.stop();},pause:function(){this.audio.pause();},resume:function(){this._ensureDataLoaded(),this.audio.resume();},rewind:function(){this.audio.setCurrentTime(0);},getCurrentTime:function(){return this.audio.getCurrentTime();},setCurrentTime:function(t){return this.audio.setCurrentTime(t),t;},getDuration:function(){return this.audio.getDuration();}});cc.AudioSource=e.exports=t;},{"../assets/CCAudioClip":35,"../utils/misc":264,"./CCComponent":78}],75:[function(t,e,i){"use strict";var r=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function stopPropagation(t){t.stopPropagation();}t=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var t=0;t<r.length;t++)this.node.on(r[t],stopPropagation,this);},onDisable:function(){for(var t=0;t<r.length;t++)this.node.off(r[t],stopPropagation,this);}});cc.BlockInputEvents=e.exports=t;},{"./CCComponent":78}],76:[function(t,e,i){"use strict";var r=t("./CCComponent");t=t("../utils/gray-sprite-state");var n=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3});var a=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3});r=cc.Class({name:"cc.Button",extends:r,mixins:[t],ctor:function(){this._pressed=!1,this._hovered=!1,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=cc.Vec2.ZERO,this._toScale=cc.Vec2.ZERO,this._originalScale=null,this._graySpriteMaterial=null,this._spriteMaterial=null,this._sprite=null;},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(){this._updateState(),this.interactable||this._resetState();},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode();}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState();}},transition:{default:n.NONE,tooltip:!1,type:n,animatable:!1,notify:function(t){this._updateTransition(t);},formerlySerializedAs:"transition"},normalColor:{default:cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===a.NORMAL&&(this._getTarget().opacity=this.normalColor.a),this._updateState();}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===a.PRESSED&&(this._getTarget().opacity=this.pressedColor.a),this._updateState();},formerlySerializedAs:"pressedColor"},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===a.HOVER&&(this._getTarget().opacity=this.hoverColor.a),this._updateState();},formerlySerializedAs:"hoverColor"},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===n.Color&&this._getButtonState()===a.DISABLED&&(this._getTarget().opacity=this.disabledColor.a),this._updateState();}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState();}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState();}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState();}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState();}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(t){this._applyTarget(),t&&this.target!==t&&this._unregisterTargetEvent(t);}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:n},__preload:function(){this._applyTarget(),this._resetState();},_resetState:function(){this._pressed=!1,this._hovered=!1;var t=this._getTarget();var e=this.transition;var i=this._originalScale;e===n.COLOR&&this.interactable?this._setTargetColor(this.normalColor):e===n.SCALE&&i&&t.setScale(i.x,i.y),this._transitionFinished=!0;},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerNodeEvent();},onDisable:function(){this._resetState(),this._unregisterNodeEvent();},_getTarget:function(){return this.target||this.node;},_onTargetSpriteFrameChanged:function(t){this.transition===n.SPRITE&&this._setCurrentStateSprite(t.spriteFrame);},_onTargetColorChanged:function(t){this.transition===n.COLOR&&this._setCurrentStateColor(t);},_onTargetScaleChanged:function(){var t=this._getTarget();this._originalScale&&(this.transition!==n.SCALE||this._transitionFinished)&&(this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY);},_setTargetColor:function(t){var e=this._getTarget();e.color=t,e.opacity=t.a;},_getStateColor:function(t){switch(t){case a.NORMAL:return this.normalColor;case a.HOVER:return this.hoverColor;case a.PRESSED:return this.pressedColor;case a.DISABLED:return this.disabledColor;}},_getStateSprite:function(t){switch(t){case a.NORMAL:return this.normalSprite;case a.HOVER:return this.hoverSprite;case a.PRESSED:return this.pressedSprite;case a.DISABLED:return this.disabledSprite;}},_setCurrentStateColor:function(t){switch(this._getButtonState()){case a.NORMAL:this.normalColor=t;break;case a.HOVER:this.hoverColor=t;break;case a.PRESSED:this.pressedColor=t;break;case a.DISABLED:this.disabledColor=t;}},_setCurrentStateSprite:function(t){switch(this._getButtonState()){case a.NORMAL:this.normalSprite=t;break;case a.HOVER:this.hoverSprite=t;break;case a.PRESSED:this.pressedSprite=t;break;case a.DISABLED:this.disabledSprite=t;}},update:function(t){var e=this._getTarget();var i;this._transitionFinished||this.transition!==n.COLOR&&this.transition!==n.SCALE||(this.time+=t,(t=1)<=(t=0<this.duration?this.time/this.duration:t)&&(t=1),this.transition===n.COLOR?(i=this._fromColor.lerp(this._toColor,t),this._setTargetColor(i)):this.transition===n.SCALE&&this._originalScale&&(e.scale=this._fromScale.lerp(this._toScale,t)),1===t&&(this._transitionFinished=!0));},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this);},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this);},_registerTargetEvent:function(t){t.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this);},_unregisterTargetEvent:function(t){t.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this);},_getTargetSprite:function(t){var e=null;return e=t?t.getComponent(cc.Sprite):e;},_applyTarget:function(){var t=this._getTarget();this._sprite=this._getTargetSprite(t),this._originalScale||(this._originalScale=cc.Vec2.ZERO),this._originalScale.x=t.scaleX,this._originalScale.y=t.scaleY,this._registerTargetEvent(t);},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation());},_onTouchMove:function(t){var e,i,r;this.interactable&&this.enabledInHierarchy&&this._pressed&&(e=t.touch,e=this.node._hitTest(e.getLocation()),r=this._getTarget(),i=this._originalScale,this.transition===n.SCALE&&i?e?(this._fromScale.x=i.x,this._fromScale.y=i.y,this._toScale.x=i.x*this.zoomScale,this._toScale.y=i.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,r.setScale(i.x,i.y)):(r=e?a.PRESSED:a.NORMAL,this._applyTransition(r)),t.stopPropagation());},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation());},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState());},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition===n.SPRITE&&!this.hoverSprite||this._hovered||(this._hovered=!0,this._updateState()));},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState());},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState();},_getButtonState:function(){return this.interactable?this._pressed?a.PRESSED:this._hovered?a.HOVER:a.NORMAL:a.DISABLED;},_updateColorTransitionImmediately:function(t){t=this._getStateColor(t);this._setTargetColor(t),this._fromColor=t.clone(),this._toColor=t;},_updateColorTransition:function(t){var e;t===a.DISABLED?this._updateColorTransitionImmediately(t):(e=this._getTarget(),t=this._getStateColor(t),this._fromColor=e.color.clone(),this._toColor=t,this.time=0,this._transitionFinished=!1);},_updateSpriteTransition:function(t){t=this._getStateSprite(t);this._sprite&&t&&(this._sprite.spriteFrame=t);},_updateScaleTransition:function(t){t===a.PRESSED?this._zoomUp():this._zoomBack();},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1);},_zoomBack:function(){var t;this._originalScale&&(t=this._getTarget(),this._fromScale.x=t.scaleX,this._fromScale.y=t.scaleY,this._toScale.x=this._originalScale.x,this._toScale.y=this._originalScale.y,this.time=0,this._transitionFinished=!1);},_updateTransition:function(t){t===n.COLOR?this._updateColorTransitionImmediately(a.NORMAL):t===n.SPRITE&&this._updateSpriteTransition(a.NORMAL),this._updateState();},_applyTransition:function(t){var e=this.transition;e===n.COLOR?this._updateColorTransition(t):e===n.SPRITE?this._updateSpriteTransition(t):e===n.SCALE&&this._updateScaleTransition(t);},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){var t;this._sprite&&(t=!1,this.enableAutoGrayEffect&&(this.transition===n.SPRITE&&this.disabledSprite||this.interactable||(t=!0)),this._switchGrayMaterial(t,this._sprite));}});cc.Button=e.exports=r;},{"../utils/gray-sprite-state":260,"./CCComponent":78}],77:[function(t,e,i){"use strict";var r=t("../camera/CCCamera");t=t("./CCComponent");var n=cc.Class({name:"cc.Canvas",extends:t,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution);},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings();},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight;},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings());},tooltip:!1},fitWidth:{get:function(){return this._fitWidth;},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings());},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(n.instance)return cc.warnID(6700,this.node.name,n.instance.node.name);(n.instance=this).applySettings();var t=this.getComponent(cc.Widget);t&&t.updateAlignment();t=cc.find("Main Camera",this.node);t||((t=new cc.Node("Main Camera")).parent=this.node,t.setSiblingIndex(0));var e=t.getComponent(r);e||(e=t.addComponent(r),t=r.ClearFlags,e.clearFlags=t.COLOR|t.DEPTH|t.STENCIL,e.depth=-1),r.main=e;},onDestroy:function(){n.instance===this&&(n.instance=null);},applySettings:function(){var t=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?t.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?t.FIXED_WIDTH:t.FIXED_HEIGHT:t.NO_BORDER;var e=this._designResolution;cc.view.setDesignResolutionSize(e.width,e.height,t);}});cc.Canvas=e.exports=n;},{"../camera/CCCamera":63,"./CCComponent":78}],78:[function(t,e,i){"use strict";var r=t("../platform/CCObject");var n=t("../platform/js");var a=new(t("../platform/id-generater"))("Comp");r.Flags.IsOnEnableCalled;var o=r.Flags.IsOnLoadCalled;var s=!!cc.ActionManager;t=cc.Class({name:"cc.Component",extends:r,ctor:function(){this._id=a.getNewId(),this.__eventTargets=[];},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this);var e=t.lastIndexOf(".");return 0<=e&&(t=t.slice(e+1)),this.node.name+"<"+t+">";},set:function(t){this._name=t;},visible:!1},uuid:{get:function(){return this._id;},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled;},set:function(t){var e;this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy&&(e=cc.director._compScheduler,t?e.enableComp(this):e.disableComp(this)));},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy;},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&o;}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t);},getComponent:function(t){return this.node.getComponent(t);},getComponents:function(t){return this.node.getComponents(t);},getComponentInChildren:function(t){return this.node.getComponentInChildren(t);},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t);},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this);},_onPreDestroy:function(){s&&cc.director.getActionManager().removeAllActionsFromTarget(this),this.unscheduleAllCallbacks();var t=this.__eventTargets;for(var e=t.length-1;0<=e;--e){var i=t[e];i&&i.targetOff(this);}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this);},_instantiate:function(t){return(t=t||cc.instantiate._clone(this,this)).node=null,t;},schedule:function(t,e,i,r){cc.assertID(t,1619),e=e||0,cc.assertID(0<=e,1620),i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,r=r||0;var n=cc.director.getScheduler();var a=n.isTargetPaused(this);n.schedule(t,this,e,i,r,a);},scheduleOnce:function(t,e){this.schedule(t,0,0,e);},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this);},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this);}});t._requireComponent=null,t._executionOrder=0,n.value(t,"_registerEditorProps",function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i);}),t.prototype.__scriptUuid="",cc.Component=e.exports=t;},{"../platform/CCObject":195,"../platform/id-generater":205,"../platform/js":209}],79:[function(t,e,i){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId);},set:function(t){this._componentId=this._compName2Id(t);}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){var e;if(0<arguments.length)for(var i=0,r=(e=new Array(arguments.length-1)).length;i<r;i++)e[i]=arguments[i+1];for(var n=0,a=t.length;n<a;n++){var o=t[n];o instanceof cc.Component.EventHandler&&o.emit(e);}}},emit:function(t){var e=this.target;var i;cc.isValid(e)&&(this._genCompIdIfNeeded(),i=cc.js._getClassById(this._componentId),e=e.getComponent(i),!cc.isValid(e)||"function"==typeof(i=e[this.handler])&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),i.apply(e,t)));},_compName2Id:function(t){t=cc.js.getClassByName(t);return cc.js._getClassId(t);},_compId2Name:function(t){t=cc.js._getClassById(t);return cc.js.getClassName(t);},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="");}});},{}],80:[function(t,e,i){"use strict";var r=t("../platform/CCMacro");var n=t("./CCRenderComponent");t("../assets/material/CCMaterial");var a=t("../renderer/utils/label/label-frame");t=r.TextAlignment;r=r.VerticalTextAlignment;var o=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var s=cc.Enum({NONE:0,BITMAP:1,CHAR:2});var c=cc.Class({name:"cc.Label",extends:n,ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._ttfTexture=null,this._letterTexture=null,cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterial=this._updateMaterialCanvas:this._updateMaterial=this._updateMaterialWebgl;},editor:!1,properties:{_useOriginalSize:!0,_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string;},set:function(t){var e=this._string;this._string=""+t,this.string!==e&&this.setVertsDirty(),this._checkStringEmpty();},multiline:!0,tooltip:!1},horizontalAlign:{default:t.LEFT,type:t,tooltip:!1,notify:function(t){this.horizontalAlign!==t&&this.setVertsDirty();},animatable:!1},verticalAlign:{default:r.TOP,type:r,tooltip:!1,notify:function(t){this.verticalAlign!==t&&this.setVertsDirty();},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize;},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize;},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.setVertsDirty());},range:[0,512],tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(t){this.fontFamily!==t&&this.setVertsDirty();},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight;},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.setVertsDirty());},tooltip:!1},overflow:{default:o.NONE,type:o,tooltip:!1,notify:function(t){this.overflow!==t&&this.setVertsDirty();},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText;},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.setVertsDirty());},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file;},set:function(t){this.font!==t&&(t||(this._isSystemFontUsed=!0),(this._N$file=t)&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),"string"==typeof t&&cc.warnID(4e3),this.enabledInHierarchy&&this._forceUpdateRenderData());},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed;},set:function(t){if(this._isSystemFontUsed!==t){if(this._isSystemFontUsed=!!t,t){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData();}this.markForValidate();}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1;},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX;},set:function(t){this._spacingX=t,this.setVertsDirty();},tooltip:!1},_batchAsBitmap:!1,cacheMode:{default:s.NONE,type:s,tooltip:!1,notify:function(t){this.cacheMode!==t&&(t!==s.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),t===s.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData());},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags);},set:function(t){t?this._styleFlags|=1:this._styleFlags&=-2,this.setVertsDirty();},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags);},set:function(t){t?this._styleFlags|=2:this._styleFlags&=-3,this.setVertsDirty();},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags);},set:function(t){t?this._styleFlags|=4:this._styleFlags&=-5,this.setVertsDirty();},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight;},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.setVertsDirty());},tooltip:!1}},statics:{HorizontalAlign:t,VerticalAlign:r,Overflow:o,CacheMode:s,_shareAtlas:null,clearCharCache:function(){c._shareAtlas&&c._shareAtlas.clearAllCache();}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===s.NONE&&(this.cacheMode=s.BITMAP,this._batchAsBitmap=!1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=s.NONE);},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this._forceUpdateRenderData();},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this);},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null),this._super();},_nodeSizeChanged:function(){this.overflow!==o.NONE&&this.setVertsDirty();},_updateColor:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty(),n.prototype._updateColor.call(this);},_validateRender:function(){if(this.string){if(this._materials[0]){var t=this.font;if(!(t instanceof cc.BitmapFont))return;var e=t.spriteFrame;if(e&&e.textureLoaded()&&t._fntConfig)return;}this.disableRender();}else this.disableRender();},_resetAssembler:function(){this._frame=null,n.prototype._resetAssembler.call(this);},_checkStringEmpty:function(){this.markForRender(!!this.string);},_on3DNodeChanged:function(){this._resetAssembler(),this._applyFontTexture();},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture,this.markForRender(!0),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this);},_applyFontTexture:function(){var t=this.font;t instanceof cc.BitmapFont?(t=t.spriteFrame,(this._frame=t)&&t.onTextureLoaded(this._onBMFontTextureLoaded,this)):(this._frame||(this._frame=new a()),this.cacheMode===s.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D(),this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==s.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture)),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)),this.markForValidate();},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture.url=this.uuid+"_texture");},_updateMaterialWebgl:function(){var t;!this._frame||(t=this.getMaterial(0))&&t.setProperty("texture",this._frame._texture);},_forceUpdateRenderData:function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture();},_enableBold:function(t){cc.warn("`label._enableBold` is deprecated, use `label.enableBold = true` instead please"),this.enableBold=!!t;},_enableItalics:function(t){cc.warn("`label._enableItalics` is deprecated, use `label.enableItalics = true` instead please"),this.enableItalic=!!t;},_enableUnderline:function(t){cc.warn("`label._enableUnderline` is deprecated, use `label.enableUnderline = true` instead please"),this.enableUnderline=!!t;}});cc.Label=e.exports=c;},{"../assets/material/CCMaterial":53,"../platform/CCMacro":194,"../renderer/utils/label/label-frame":225,"./CCRenderComponent":89}],81:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color;},set:function(t){this._color=t,this._updateRenderData();}},width:{tooltip:!1,get:function(){return this._width;},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData());},range:[0,512]}},onEnable:function(){this._updateRenderData();},onDisable:function(){this._updateRenderData();},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.setVertsDirty();}});cc.LabelOutline=e.exports=t;},{"./CCComponent":78}],82:[function(t,e,i){"use strict";t=cc.Class({name:"cc.LabelShadow",extends:t("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color;},set:function(t){this._color=t,this._updateRenderData();}},offset:{tooltip:!1,get:function(){return this._offset;},set:function(t){this._offset=t,this._updateRenderData();}},blur:{tooltip:!1,get:function(){return this._blur;},set:function(t){this._blur=t,this._updateRenderData();},range:[0,1024]}},onEnable:function(){this._updateRenderData();},onDisable:function(){this._updateRenderData();},_updateRenderData:function(){var t=this.node.getComponent(cc.Label);t&&t.markForRender(!0);}});cc.LabelShadow=e.exports=t;},{"./CCComponent":78}],83:[function(t,e,i){"use strict";var r=t("../CCNode").EventType;var E=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3});var P=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2});var n=cc.Enum({HORIZONTAL:0,VERTICAL:1});var M=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1});var R=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1});t=cc.Class({name:"cc.Layout",extends:t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:P.NONE,_N$layoutType:E.NONE,type:{type:E,get:function(){return this._N$layoutType;},set:function(t){this._N$layoutType=t,this._doLayoutDirty();},tooltip:!1,animatable:!1},resizeMode:{type:P,tooltip:!1,animatable:!1,get:function(){return this._resize;},set:function(t){this.type===E.NONE&&t===P.CHILDREN||(this._resize=t,this._doLayoutDirty());}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty();}},startAxis:{default:n.HORIZONTAL,tooltip:!1,type:n,notify:function(){this._doLayoutDirty();},animatable:!1},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty();}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty();}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty();}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty();}},spacingX:{default:0,notify:function(){this._doLayoutDirty();},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty();},tooltip:!1},verticalDirection:{default:M.TOP_TO_BOTTOM,type:M,notify:function(){this._doLayoutDirty();},tooltip:!1,animatable:!1},horizontalDirection:{default:R.LEFT_TO_RIGHT,type:R,notify:function(){this._doLayoutDirty();},tooltip:!1,animatable:!1},affectedByScale:{default:!1,notify:function(){this._doLayoutDirty();},animatable:!1,tooltip:!1}},statics:{Type:E,VerticalDirection:M,HorizontalDirection:R,ResizeMode:P,AxisDirection:n},onEnable:function(){this._addEventListeners(),this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize),this._doLayoutDirty();},onDisable:function(){this._removeEventListeners();},_doLayoutDirty:function(){this._layoutDirty=!0;},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale;},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(r.SIZE_CHANGED,this._resized,this),this.node.on(r.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(r.CHILD_ADDED,this._childAdded,this),this.node.on(r.CHILD_REMOVED,this._childRemoved,this),this.node.on(r.CHILD_REORDER,this._doLayoutDirty,this),this._addChildrenEventListeners();},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(r.SIZE_CHANGED,this._resized,this),this.node.off(r.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(r.CHILD_ADDED,this._childAdded,this),this.node.off(r.CHILD_REMOVED,this._childRemoved,this),this.node.off(r.CHILD_REORDER,this._doLayoutDirty,this),this._removeChildrenEventListeners();},_addChildrenEventListeners:function(){var t=this.node.children;for(var e=0;e<t.length;++e){var i=t[e];i.on(r.SCALE_CHANGED,this._doScaleDirty,this),i.on(r.SIZE_CHANGED,this._doLayoutDirty,this),i.on(r.POSITION_CHANGED,this._doLayoutDirty,this),i.on(r.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._doLayoutDirty,this);}},_removeChildrenEventListeners:function(){var t=this.node.children;for(var e=0;e<t.length;++e){var i=t[e];i.off(r.SCALE_CHANGED,this._doScaleDirty,this),i.off(r.SIZE_CHANGED,this._doLayoutDirty,this),i.off(r.POSITION_CHANGED,this._doLayoutDirty,this),i.off(r.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._doLayoutDirty,this);}},_childAdded:function(t){t.on(r.SCALE_CHANGED,this._doScaleDirty,this),t.on(r.SIZE_CHANGED,this._doLayoutDirty,this),t.on(r.POSITION_CHANGED,this._doLayoutDirty,this),t.on(r.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty();},_childRemoved:function(t){t.off(r.SCALE_CHANGED,this._doScaleDirty,this),t.off(r.SIZE_CHANGED,this._doLayoutDirty,this),t.off(r.POSITION_CHANGED,this._doLayoutDirty,this),t.off(r.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty();},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty();},_doLayoutHorizontally:function(h,u,_,d){var f=this.node.getAnchorPoint();var p=this.node.children;var t=1;var m=this.paddingLeft;var v=-f.x*h;this.horizontalDirection===R.RIGHT_TO_LEFT&&(t=-1,v=(1-f.x)*h,m=this.paddingRight);var y=v+t*m-t*this.spacingX;var g=0;var e=0;var i=0;var b=0;var r=0;var C=0;var x=0;for(var n=0;n<p.length;++n)(a=p[n]).activeInHierarchy&&x++;var A=this.cellSize.width;this.type!==E.GRID&&this.resizeMode===P.CHILDREN&&(A=(h-(this.paddingLeft+this.paddingRight)-(x-1)*this.spacingX)/x);for(n=0;n<p.length;++n){var a=p[n];var o=this._getUsedScaleValue(a.scaleX);var s=this._getUsedScaleValue(a.scaleY);var S,T,c,w,l;a.activeInHierarchy&&(this._resize===P.CHILDREN&&(a.width=A/o,this.type===E.GRID&&(a.height=this.cellSize.height/s)),l=a.anchorX,o=a.width*o,(e=e<i?i:e)<=(s=a.height*s)&&(i=e,e=s,C=a.getAnchorPoint().y),y=y+t*(l=this.horizontalDirection===R.RIGHT_TO_LEFT?1-a.anchorX:l)*o+t*this.spacingX,S=t*(1-l)*o,u&&(c=y+S+t*(0<t?this.paddingRight:this.paddingLeft),T=this.horizontalDirection===R.LEFT_TO_RIGHT&&c>(1-f.x)*h,c=this.horizontalDirection===R.RIGHT_TO_LEFT&&c<-f.x*h,(T||c)&&(e<=s?(g+=i=0===i?e:i,i=e):(g+=e,i=s,e=0),y=v+t*(m+l*o),b++)),T=_(a,g,b),h>=o+this.paddingLeft+this.paddingRight&&d&&a.setPosition(cc.v2(y,T)),c=1,l=0===e?s:e,this.verticalDirection===M.TOP_TO_BOTTOM?(r=r||this.node._contentSize.height,(w=T+(c=-1)*(l*C+this.paddingBottom))<r&&(r=w)):(r=r||-this.node._contentSize.height)<(w=T+c*(l*C+this.paddingTop))&&(r=w),y+=S);}return r;},_getVerticalBaseHeight:function(t){var e=0;var i=0;if(this.resizeMode===P.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r];n.activeInHierarchy&&(i++,e+=n.height*this._getUsedScaleValue(n.scaleY));}e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop;}else e=this.node.getContentSize().height;return e;},_doLayoutVertically:function(h,u,_,d){var f=this.node.getAnchorPoint();var p=this.node.children;var t=1;var m=this.paddingBottom;var v=-f.y*h;this.verticalDirection===M.TOP_TO_BOTTOM&&(t=-1,v=(1-f.y)*h,m=this.paddingTop);var y=v+t*m-t*this.spacingY;var g=0;var e=0;var i=0;var b=0;var r=0;var C=0;var x=0;for(var n=0;n<p.length;++n)(a=p[n]).activeInHierarchy&&x++;var A=this.cellSize.height;this.type!==E.GRID&&this.resizeMode===P.CHILDREN&&(A=(h-(this.paddingTop+this.paddingBottom)-(x-1)*this.spacingY)/x);for(n=0;n<p.length;++n){var a=p[n];var o=this._getUsedScaleValue(a.scaleX);var s=this._getUsedScaleValue(a.scaleY);var S,T,c,w,l;a.activeInHierarchy&&(this.resizeMode===P.CHILDREN&&(a.height=A/s,this.type===E.GRID&&(a.width=this.cellSize.width/o)),l=a.anchorY,o=a.width*o,s=a.height*s,(e=e<i?i:e)<=o&&(i=e,e=o,C=a.getAnchorPoint().x),y=y+t*(l=this.verticalDirection===M.TOP_TO_BOTTOM?1-a.anchorY:l)*s+t*this.spacingY,S=t*(1-l)*s,u&&(c=y+S+t*(0<t?this.paddingTop:this.paddingBottom),T=this.verticalDirection===M.BOTTOM_TO_TOP&&c>(1-f.y)*h,c=this.verticalDirection===M.TOP_TO_BOTTOM&&c<-f.y*h,(T||c)&&(e<=o?(g+=i=0===i?e:i,i=e):(g+=e,i=o,e=0),y=v+t*(m+l*s),b++)),T=_(a,g,b),h>=s+(this.paddingTop+this.paddingBottom)&&d&&a.setPosition(cc.v2(T,y)),c=1,l=0===e?o:e,this.horizontalDirection===R.RIGHT_TO_LEFT?(r=r||this.node._contentSize.width,(w=T+(c=-1)*(l*C+this.paddingLeft))<r&&(r=w)):(r=r||-this.node._contentSize.width)<(w=T+c*(l*C+this.paddingRight))&&(r=w),y+=S);}return r;},_doLayoutBasic:function(){var t=this.node.children;var e=null;for(var i=0;i<t.length;++i){var r=t[i];r.activeInHierarchy&&(e?e.union(e,r.getBoundingBoxToWorld()):e=r.getBoundingBoxToWorld());}var n,a,o;e&&(n=this.node.convertToNodeSpaceAR(cc.v2(e.x,e.y)),n=cc.v2(n.x-this.paddingLeft,n.y-this.paddingBottom),a=this.node.convertToNodeSpaceAR(cc.v2(e.xMax,e.yMax)),a=(a=cc.v2(a.x+this.paddingRight,a.y+this.paddingTop)).sub(n),0!==(a=cc.size(parseFloat(a.x.toFixed(2)),parseFloat(a.y.toFixed(2)))).width&&(o=-n.x/a.width,this.node.anchorX=parseFloat(o.toFixed(2))),0!==a.height&&(o=-n.y/a.height,this.node.anchorY=parseFloat(o.toFixed(2))),this.node.setContentSize(a));},_doLayoutGridAxisHorizontal:function(t,e){var i=e.width;var r=1;var n=-t.y*e.height;var a=this.paddingBottom;this.verticalDirection===M.TOP_TO_BOTTOM&&(r=-1,n=(1-t.y)*e.height,a=this.paddingTop);e=function(t,e,i){return n+r*(e+t.anchorY*t.height*this._getUsedScaleValue(t.scaleY)+a+i*this.spacingY);}.bind(this);var o=0;var s;this.resizeMode===P.CONTAINER&&(s=this._doLayoutHorizontally(i,!0,e,!1),(o=n-s)<0&&(o*=-1),n=-t.y*o,this.verticalDirection===M.TOP_TO_BOTTOM&&(r=-1,n=(1-t.y)*o)),this._doLayoutHorizontally(i,!0,e,!0),this.resizeMode===P.CONTAINER&&this.node.setContentSize(i,o);},_doLayoutGridAxisVertical:function(t,e){var i=e.height;var r=1;var n=-t.x*e.width;var a=this.paddingLeft;this.horizontalDirection===R.RIGHT_TO_LEFT&&(r=-1,n=(1-t.x)*e.width,a=this.paddingRight);e=function(t,e,i){return n+r*(e+t.anchorX*t.width*this._getUsedScaleValue(t.scaleX)+a+i*this.spacingX);}.bind(this);var o=0;var s;this.resizeMode===P.CONTAINER&&(s=this._doLayoutVertically(i,!0,e,!1),(o=n-s)<0&&(o*=-1),n=-t.x*o,this.horizontalDirection===R.RIGHT_TO_LEFT&&(r=-1,n=(1-t.x)*o)),this._doLayoutVertically(i,!0,e,!0),this.resizeMode===P.CONTAINER&&this.node.setContentSize(o,i);},_doLayoutGrid:function(){var t=this.node.getAnchorPoint();var e=this.node.getContentSize();this.startAxis===n.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===n.VERTICAL&&this._doLayoutGridAxisVertical(t,e);},_getHorizontalBaseWidth:function(t){var e=0;var i=0;if(this.resizeMode===P.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r];n.activeInHierarchy&&(i++,e+=n.width*this._getUsedScaleValue(n.scaleX));}e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight;}else e=this.node.getContentSize().width;return e;},_doLayout:function(){var t;this.type===E.HORIZONTAL?(t=this._getHorizontalBaseWidth(this.node.children),this._doLayoutHorizontally(t,!1,function(t){return t.y;},!0),this.node.width=t):this.type===E.VERTICAL?(t=this._getVerticalBaseHeight(this.node.children),this._doLayoutVertically(t,!1,function(t){return t.x;},!0),this.node.height=t):this.type===E.NONE?this.resizeMode===P.CONTAINER&&this._doLayoutBasic():this.type===E.GRID&&this._doLayoutGrid();},_getUsedScaleValue:function(t){return this.affectedByScale?Math.abs(t):1;},updateLayout:function(){this._layoutDirty&&0<this.node.children.length&&(this._doLayout(),this._layoutDirty=!1);}});cc.Layout=e.exports=t;},{"../CCNode":30,"./CCComponent":78}],84:[function(t,e,n){"use strict";var h=_interopRequireDefault(t("../../renderer/gfx"));var a=_interopRequireDefault(t("../value-types/mat4"));var o=_interopRequireDefault(t("../value-types/vec2"));var i=_interopRequireDefault(t("../assets/material/material-variant"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var u=t("../utils/misc");var _=t("./CCRenderComponent");var r=t("../renderer/render-flow");var d=t("../graphics/graphics");var f=new o.default();var s=new a.default();var c=[];var l=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2});t=cc.Class({name:"cc.Mask",extends:_,editor:!1,ctor:function(){this._graphics=null,this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null;},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:l.RECT,type:{get:function(){return this._type;},set:function(t){this._type!==t&&this._resetAssembler(),this._type=t,this._type!==l.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._activateMaterial();},type:l,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame;},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t,this.setVertsDirty(),this._updateMaterial());}},alphaThreshold:{default:.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201);}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202);}},_segments:64,segements:{get:function(){return this._segments;},set:function(t){this._segments=u.clampf(t,3,1e4),this._updateGraphics();},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode();}}},statics:{Type:l},onRestore:function(){this._activateMaterial();},onEnable:function(){this._super(),this._type!==l.IMAGE_STENCIL&&this._updateGraphics(),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this);},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~r.FLAG_POST_RENDER;},onDestroy:function(){this._super(),this._removeGraphics();},_resizeNodeToTargetNode:!1,_validateRender:function(){var t;this._type===l.IMAGE_STENCIL&&((t=this._spriteFrame)&&t.textureLoaded()||this.disableRender());},_activateMaterial:function(){this._createGraphics();var t=this._materials[0];(t=t?i.default.create(t,this):i.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0),this._type===l.IMAGE_STENCIL?(t.define("CC_USE_MODEL",!1),t.define("USE_TEXTURE",!0)):(t.define("CC_USE_MODEL",!0),t.define("USE_TEXTURE",!1)),this._enableMaterial||(this._enableMaterial=i.default.createWithBuiltin("2d-sprite",this)),this._exitMaterial||(this._exitMaterial=i.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(h.default.STENCIL_DISABLE)),this._clearMaterial||(this._clearMaterial=i.default.createWithBuiltin("clear-stencil",this)),this.setMaterial(0,t),this._graphics._materials[0]=t,this._updateMaterial();},_updateMaterial:function(){var t=this._materials[0];var e;t&&(this._type===l.IMAGE_STENCIL&&this.spriteFrame&&(e=this.spriteFrame.getTexture(),t.setProperty("texture",e)),t.setProperty("alphaThreshold",this.alphaThreshold));},_createGraphics:function(){this._graphics||(this._graphics=new d(),cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0));},_updateGraphics:function(){var t=this.node;var e=this._graphics;e.clear(!1);var i=t._contentSize.width;var r=t._contentSize.height;var n=-i*t._anchorPoint.x;t=-r*t._anchorPoint.y;if(this._type===l.RECT)e.rect(n,t,i,r);else if(this._type===l.ELLIPSE){var a=function(t,e,i){c.length=0;var r=2*Math.PI/i;for(var n=0;n<i;++n)c.push(cc.v2(e.x*Math.cos(r*n)+t.x,e.y*Math.sin(r*n)+t.y));return c;}(cc.v2(n+i/2,t+r/2),{x:i/2,y:r/2},this._segments);for(var o=0;o<a.length;++o){var s=a[o];0===o?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y);}e.close();}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?e.stroke():e.fill();},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null);},_hitTest:function(t){var e=this.node;var i=e.getContentSize(),r=i.width,i=i.height,n=f;if(e._updateWorldMatrix(),!a.default.invert(s,e._worldMatrix))return!1;o.default.transformMat4(n,t,s),n.x+=e._anchorPoint.x*r,n.y+=e._anchorPoint.y*i;t=!1;return this.type===l.RECT||this.type===l.IMAGE_STENCIL?t=0<=n.x&&0<=n.y&&n.x<=r&&n.y<=i:this.type===l.ELLIPSE&&(t=(e=n.x-.5*r)*e/((e=r/2)*e)+(r=n.y-.5*i)*r/((e=i/2)*e)<1),t=this.inverted?!t:t;},markForRender:function(t){var e=r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e;},disableRender:function(){this.node._renderFlag&=~(r.FLAG_RENDER|r.FLAG_UPDATE_RENDER_DATA|r.FLAG_POST_RENDER);}});cc.Mask=e.exports=t;},{"../../renderer/gfx":312,"../assets/material/material-variant":60,"../graphics/graphics":131,"../renderer/render-flow":221,"../utils/misc":264,"../value-types/mat4":281,"../value-types/vec2":288,"./CCRenderComponent":89}],85:[function(t,e,i){"use strict";var r=t("../components/CCRenderComponent");var n=t("../../core/utils/blend-func");t=cc.Class({name:"cc.MotionStreak",extends:r,mixins:[n],editor:!1,ctor:function(){this._points=[];},properties:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime;},set:function(t){this._fadeTime=t,this.reset();},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg;},set:function(t){this._minSeg=t;},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke;},set:function(t){this._stroke=t;},animatable:!1,tooltip:!1},_texture:{default:null,type:cc.Texture2D},texture:{get:function(){return this._texture;},set:function(t){this._texture!==t&&(this._texture=t,this._updateMaterial());},type:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color;},set:function(t){this._color=t;},type:cc.Color,tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode;},set:function(t){this._fastMode=t;},animatable:!1,tooltip:!1}},onEnable:function(){this._super(),this.reset();},_updateMaterial:function(){var t=this.getMaterial(0);t&&t.setProperty("texture",this._texture),n.prototype._updateMaterial.call(this);},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear();},lateUpdate:function(t){this._assembler&&this._assembler.update(this,t);}});cc.MotionStreak=e.exports=t;},{"../../core/utils/blend-func":257,"../components/CCRenderComponent":89}],86:[function(t,e,i){"use strict";var a=cc.Enum({Unified:0,Free:1});var o=cc.Enum({Horizontal:0,Vertical:1});var r=cc.Enum({PAGE_TURNING:0});var n=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=cc.v2(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[];},properties:{sizeMode:{default:a.Unified,type:a,tooltip:!1,notify:function(){this._syncSizeMode();}},direction:{default:o.Horizontal,type:o,tooltip:!1,notify:function(){this._syncScrollDirection();}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this);}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:a,Direction:o,EventType:r},__preload:function(){this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this);},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this);},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this);},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this);},onDestroy:function(){this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this);},getCurrentPageIndex:function(){return this._curPageIdx;},setCurrentPageIndex:function(t){this.scrollToPage(t,!0);},getPages:function(){return this._pages;},addPage:function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView());},insertPage:function(t,e){e<0||!t||-1!==this._pages.indexOf(t)||!this.content||(this._pages.length<=e?this.addPage(t):(this._pages.splice(e,0,t),this.content.addChild(t),this._updatePageView()));},removePage:function(t){var e;t&&this.content&&(-1!==(e=this._pages.indexOf(t))?this.removePageAtIndex(e):cc.warnID(4300,t.name));},removePageAtIndex:function(t){var e=this._pages;var i;t<0||t>=e.length||(i=e[t])&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView());},removeAllPages:function(){if(this.content){var t=this._pages;for(var e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView();}},scrollToPage:function(t,e){t<0||t>=this._pages.length||(e=void 0!==e?e:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState());},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming;},_syncScrollDirection:function(){this.horizontal=this.direction===o.Horizontal,this.vertical=this.direction===o.Vertical;},_syncSizeMode:function(){var t,e;!this.content||(t=this.content.getComponent(cc.Layout))&&(this.sizeMode===a.Free&&0<this._pages.length&&(e=this._pages[this._pages.length-1],this.direction===o.Horizontal?(t.paddingLeft=(this._view.width-this._pages[0].width)/2,t.paddingRight=(this._view.width-e.width)/2):this.direction===o.Vertical&&(t.paddingTop=(this._view.height-this._pages[0].height)/2,t.paddingBottom=(this._view.height-e.height)/2)),t.updateLayout());},_updatePageView:function(){var t=this.content.getComponent(cc.Layout);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);var i=this._initContentPos;for(var r=0;r<e;++r){var n=this._pages[r];n.setSiblingIndex(r),this.direction===o.Horizontal?this._scrollCenterOffsetX[r]=Math.abs(i.x+n.x):this._scrollCenterOffsetY[r]=Math.abs(i.y+n.y);}this.indicator&&this.indicator._refresh();},_updateAllPagesSize:function(){if(this.sizeMode===a.Unified){var t=this._pages;var e=this._view.getContentSize();for(var i=0,r=t.length;i<r;i++)t[i].setContentSize(e);}},_initPages:function(){if(this.content){this._initContentPos=this.content.position;var t=this.content.children;for(var e=0;e<t.length;++e){var i=t[e];0<=this._pages.indexOf(i)||this._pages.push(i);}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView();}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,r.PAGE_TURNING),this.node.emit("page-turning",this));},_isScrollable:function(t,e,i){return this.sizeMode!==a.Free?this.direction===o.Horizontal?Math.abs(t.x)>=this._view.width*this.scrollThreshold:this.direction===o.Vertical?Math.abs(t.y)>=this._view.height*this.scrollThreshold:void 0:this.direction===o.Horizontal?(r=this._scrollCenterOffsetX[e],n=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(r-n)*this.scrollThreshold):this.direction===o.Vertical?(r=this._scrollCenterOffsetY[e],n=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(r-n)*this.scrollThreshold):void 0;var r,n;},_isQuicklyScrollable:function(t){if(this.direction===o.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0;}else if(this.direction===o.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1;},_moveOffsetValue:function(t){var e=cc.v2(0,0);return this.sizeMode===a.Free?this.direction===o.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===o.Vertical&&(e.y=this._scrollCenterOffsetY[t]):this.direction===o.Horizontal?e.x=t*this._view.width:this.direction===o.Vertical&&(e.y=t*this._view.height),e;},_getDragDirection:function(t){return this.direction===o.Horizontal?0===t.x?0:0<t.x?1:-1:this.direction===o.Vertical?0===t.y?0:t.y<0?1:-1:void 0;},_handleReleaseLogic:function(t){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"));},_autoScrollToPage:function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();(0<(t=this._clampDelta(t)).x||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||0<t.y)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState();}else{t=this._touchBeganPosition.sub(this._touchEndPosition);var e=this._curPageIdx,i=e+this._getDragDirection(t);var r=this.pageTurningSpeed*Math.abs(e-i);if(i<this._pages.length){if(this._isScrollable(t,e,i))return void this.scrollToPage(i,r);t=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(t))return void this.scrollToPage(i,r);}this.scrollToPage(e,r);}},_onTouchBegan:function(t,e){this._touchBeganPosition=t.touch.getLocation(),this._super(t,e);},_onTouchMoved:function(t,e){this._super(t,e);},_onTouchEnded:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e);},_onTouchCancelled:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e);},_onMouseWheel:function(){}});cc.PageView=e.exports=n;},{}],87:[function(t,e,i){"use strict";var r=cc.Enum({HORIZONTAL:0,VERTICAL:1});t=cc.Class({name:"cc.PageViewIndicator",extends:t("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1},direction:{default:r.HORIZONTAL,type:r,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:r},onLoad:function(){this._updateLayout();},setPageView:function(t){this._pageView=t,this._refresh();},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===r.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===r.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER;},_createIndicator:function(){var t=new cc.Node();var e=t.addComponent(cc.Sprite);return e.spriteFrame=this.spriteFrame,e.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t;},_changedState:function(){var t=this._indicators;if(0!==t.length){var e=this._pageView._curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i)t[i].opacity=127.5;t[e].opacity=255;}}},_refresh:function(){if(this._pageView){var t=this._indicators;var e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;0<i;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1);}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState();}}}});cc.PageViewIndicator=e.exports=t;},{"./CCComponent":78}],88:[function(t,e,i){"use strict";var h=t("../utils/misc");t=t("./CCComponent");var u=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2});t=cc.Class({name:"cc.ProgressBar",extends:t,editor:!1,_initBarSprite:function(){var t,e,i,r;!this.barSprite||(t=this.barSprite.node)&&(e=this.node.getContentSize(),i=this.node.getAnchorPoint(),r=t.getContentSize(),t.parent===this.node&&this.node.setContentSize(r),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=u.FILLED),r=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=r.width:this.mode===u.VERTICAL?this.totalLength=r.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node&&(r=-e.width*i.x,t.setPosition(cc.v2(r,0))));},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(t){var e=t.getAnchorPoint();var i=t.getContentSize();var r=t.getPosition();var n=cc.v2(0,.5);var a=h.clamp01(this.progress);var o=this.totalLength*a;var s;var c;var l;switch(this.mode){case u.HORIZONTAL:this.reverse&&(n=cc.v2(1,.5)),s=cc.size(o,i.height),c=this.totalLength,l=i.height;break;case u.VERTICAL:n=this.reverse?cc.v2(.5,1):cc.v2(.5,0),s=cc.size(i.width,o),c=i.width,l=this.totalLength;}this.mode===u.FILLED?this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(o*=-1),this.barSprite.fillRange=o):this.barSprite.type!==cc.Sprite.Type.FILLED?(a=n.x-e.x,e=n.y-e.y,a=cc.v2(c*a,l*e),t.setPosition(r.x+a.x,r.y+a.y),t.setAnchorPoint(n),t.setContentSize(s)):cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!");}}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite();},animatable:!1},mode:{default:u.HORIZONTAL,type:u,tooltip:!1,notify:function(){var t;!this.barSprite||(t=this.barSprite.node)&&(t=t.getContentSize(),this.mode===u.HORIZONTAL?this.totalLength=t.width:this.mode===u.VERTICAL?this.totalLength=t.height:this.mode===u.FILLED&&(this.totalLength=this.barSprite.fillRange));},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength;},set:function(t){this.mode===u.FILLED&&(t=h.clamp01(t)),this._N$totalLength=t,this._updateBarStatus();}},progress:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus();}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus();},animatable:!1}},statics:{Mode:u}});cc.ProgressBar=e.exports=t;},{"../utils/misc":264,"./CCComponent":78}],89:[function(t,e,i){"use strict";var r=_interopRequireDefault(t("../renderer/assembler"));var n=_interopRequireDefault(t("../assets/material/material-variant"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var a=t("./CCComponent");var o=t("../renderer/render-flow");var s=t("../assets/material/CCMaterial");t=cc.Class({name:"RenderComponent",extends:a,editor:!1,properties:{_materials:{default:[],type:s},materials:{get:function(){return this._materials;},set:function(t){this._materials=t,this._activateMaterial();},type:[s],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0,this._assembler=null;},_resetAssembler:function(){r.default.init(this),this._updateColor(),this.setVertsDirty();},__preload:function(){this._resetAssembler(),this._activateMaterial();},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),(this.node._renderComponent=this).node._renderFlag|=o.FLAG_OPACITY_COLOR,this.setVertsDirty();},onDisable:function(){this.node._renderComponent=null,this.disableRender();},onDestroy:function(){var t=this._materials;for(var e=0;e<t.length;e++)cc.pool.material.put(t[e]);t.length=0,cc.pool.assembler.put(this._assembler);},setVertsDirty:function(){this._vertsDirty=!0,this.markForRender(!0);},_on3DNodeChanged:function(){this._resetAssembler();},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this);},markForRender:function(t){var e=o.FLAG_RENDER|o.FLAG_UPDATE_RENDER_DATA;t?(this.node._renderFlag|=e,this.markForValidate()):this.node._renderFlag&=~e;},disableRender:function(){this.node._renderFlag&=~(o.FLAG_RENDER|o.FLAG_UPDATE_RENDER_DATA);},getMaterial:function(t){if(t<0||t>=this._materials.length)return null;var e=this._materials[t];if(!e)return null;var i=n.default.create(e,this);return i!==e&&this.setMaterial(t,i),i;},getMaterials:function(){var t=this._materials;for(var e=0;e<t.length;e++)t[e]=n.default.create(t[e],this);return t;},setMaterial:function(t,e){return e!==this._materials[t]&&(e=n.default.create(e,this),this._materials[t]=e),this._updateMaterial(),this.markForRender(!0),e;},_getDefaultMaterial:function(){return s.getBuiltinMaterial("2d-sprite");},_activateMaterial:function(){var t=this._materials;var e;t[0]||(e=this._getDefaultMaterial(),t[0]=e);for(var i=0;i<t.length;i++)t[i]=n.default.create(t[i],this);this._updateMaterial();},_updateMaterial:function(){},_updateColor:function(){this._assembler.updateColor&&this._assembler.updateColor(this);},_checkBacth:function(t,e){var i=this._materials[0];(i&&i.getHash()!==t.material.getHash()||t.cullingMask!==e)&&(t._flush(),t.node=i.getDefine("CC_USE_MODEL")?this.node:t._dummyNode,t.material=i,t.cullingMask=e);}});cc.RenderComponent=e.exports=t;},{"../assets/material/CCMaterial":53,"../assets/material/material-variant":60,"../renderer/assembler":217,"../renderer/render-flow":221,"./CCComponent":78}],90:[function(t,e,s){"use strict";var i=t("../platform/js");var r=t("../platform/CCMacro");var u=t("../utils/text-utils");var h=new(t("../utils/html-text-parser"))();var _=r.TextAlignment;var n=r.VerticalTextAlignment;var a="RICHTEXT_CHILD";var l="RICHTEXT_Image_CHILD";t=cc.Label.CacheMode;var o=new i.Pool(function(t){if(!cc.isValid(t))return!1;t=t.getComponent(cc.LabelOutline);return t&&(t.width=0),!0;},20);o.get=function(t,e){var i=this._get();(i=i||new cc.PrivateNode(a)).setPosition(0,0),i.setAnchorPoint(.5,.5),i.skewX=0;var r=i.getComponent(cc.Label);return(r=r||i.addComponent(cc.Label)).string="",r.horizontalAlign=_.LEFT,r.verticalAlign=n.CENTER,i;};r=cc.Class({name:"cc.RichText",extends:cc.Component,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._updateRichTextStatus=this._updateRichText;},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus();}},horizontalAlign:{default:_.LEFT,type:_,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus());}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus());}},_fontFamily:"Arial",fontFamily:{tooltip:!1,get:function(){return this._fontFamily;},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus());},animatable:!1},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus());}},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed;},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus());},animatable:!1,tooltip:!1},cacheMode:{default:t.NONE,type:t,tooltip:!1,notify:function(t){this.cacheMode!==t&&this._updateRichTextStatus();},animatable:!1},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus());}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus());}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus());}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners());}}},statics:{HorizontalAlign:_,VerticalAlign:n},onEnable:function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0);},onDisable:function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1);},start:function(){this._onTTFLoaded();},_onColorChanged:function(e){this.node.children.forEach(function(t){t.color=e;});},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this);},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this);},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t,null,!0);}.bind(this));},_createFontLabel:function(t){return o.get(t,this);},_onTTFLoaded:function(){var i;!(this.font instanceof cc.TTFFont)||this.font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):(i=this,cc.loader.load(this.font.nativeUrl,function(t,e){i._layoutDirty=!0,i._updateRichText();}));},_measureText:function(i,t){var r=this;function v_s(t){var e;return 0===r._labelSegmentsCache.length?(e=r._createFontLabel(t),r._labelSegmentsCache.push(e)):e=r._labelSegmentsCache[0],e._styleIndex=i,r._applyTextAttribute(e,t,!0),e.getContentSize().width;}return t?v_s(t):v_s;},_onTouchEnded:function(r){var n=this;var a=this.node.getComponents(cc.Component);for(var t=0;t<this._labelSegments.length;++t)!function(t){t=n._labelSegments[t];var e=t._clickHandler;var i=t._clickParam;e&&n._containsTouchLocation(t,r.touch.getLocation())&&(a.forEach(function(t){t.enabledInHierarchy&&t[e]&&t[e](r,i);}),r.stopPropagation());}(t);},_containsTouchLocation:function(t,e){return t.getBoundingBoxToWorld().contains(e);},_resetState:function(){var t=this.node.children;for(var e=t.length-1;0<=e;e--){var i=t[e];i.name!==a&&i.name!==l||(i.parent===this.node?i.parent=null:t.splice(e,1),i.name===a&&o.put(i));}this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0;},onRestore:!1,_activateChildren:function(t){for(var e=this.node.children.length-1;0<=e;e--){var i=this.node.children[e];i.name!==a&&i.name!==l||(i.active=t);}},_addLabelSegment:function(t,e){var i;return(i=0===this._labelSegmentsCache.length?this._createFontLabel(t):this._labelSegmentsCache.pop())._styleIndex=e,i._lineCount=this._lineCount,i.active=this.node.active,i.setAnchorPoint(0,0),this._applyTextAttribute(i,t),this.node.addChild(i),this._labelSegments.push(i),i;},_updateRichTextWithMaxWidth:function(t,h,e){var i=h;if(0<this._lineOffsetX&&i+this._lineOffsetX>this.maxWidth){var r=0;for(;this._lineOffsetX<=this.maxWidth;){var n=this._getFirstWordLen(t,r,t.length);var a=t.substr(r,n);a=this._measureText(e,a);if(!(this._lineOffsetX+a<=this.maxWidth)){var o;0<r&&(o=t.substr(0,r),this._addLabelSegment(o,e),t=t.substr(r,t.length),i=this._measureText(e,t)),this._updateLineInfo();break;}this._lineOffsetX+=a,r+=n;}}if(i>this.maxWidth){var s=u.fragmentText(t,i,this.maxWidth,this._measureText(e));for(var c=0;c<s.length;++c){var l=s[c];l=this._addLabelSegment(l,e).getContentSize();this._lineOffsetX+=l.width,1<s.length&&c<s.length-1&&this._updateLineInfo();}}else this._lineOffsetX+=i,this._addLabelSegment(t,e);},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n");},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++;},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e];var r=t[e];if(i.text!==r.text)return!0;i=i.style,r=r.style;if(i){if(r){if(!i.outline!=!r.outline)return!0;if(i.size!==r.size||!i.italic!=!r.italic||i.isImage!==r.isImage)return!0;if(i.src!==r.src||i.imageAlign!==r.imageAlign||i.imageHeight!==r.imageHeight||i.imageWidth!==r.imageWidth||i.imageOffset!==r.imageOffset)return!0;}else if(i.size||i.italic||i.isImage||i.outline)return!0;}else if(r&&(r.size||r.italic||r.isImage||r.outline))return!0;}return!1;},_addRichTextImageElement:function(t){var e=t.style.src;e=this.imageAtlas.getSpriteFrame(e);if(e){var i=new cc.PrivateNode(l);var r=i.addComponent(cc.Sprite);switch(t.style.imageAlign){case"top":i.setAnchorPoint(0,1);break;case"center":i.setAnchorPoint(0,.5);break;default:i.setAnchorPoint(0,0);}t.style.imageOffset&&(i._imageOffset=t.style.imageOffset),r.type=cc.Sprite.Type.SLICED,r.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.node.addChild(i),this._labelSegments.push(i);var n=e.getRect();var a=1;var o=n.width;n=n.height;var s=t.style.imageWidth;var c=t.style.imageHeight;o*=a=0<c?c/n:this.lineHeight/n,n*=a,0<s&&(o=s),0<this.maxWidth?(this._lineOffsetX+o>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.spriteFrame=e,i.setContentSize(o,n),i._lineCount=this._lineCount,t.style.event?(t.style.event.click&&(i._clickHandler=t.style.event.click),t.style.event.param?i._clickParam=t.style.event.param:i._clickParam=""):i._clickHandler=null;}else cc.warnID(4400);},_updateRichText:function(){if(this.enabledInHierarchy){var t=h.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();var e=!1;for(var i=0;i<this._textArray.length;++i){var r=this._textArray[i];var n=r.text;if(""===n){if(r.style&&r.style.newline){this._updateLineInfo();continue;}if(r.style&&r.style.isImage&&this.imageAtlas){this._addRichTextImageElement(r);continue;}}var a=n.split("\n");for(var o=0;o<a.length;++o){var s=a[o];var c;""!==s?(e=!1,0<this.maxWidth?(c=this._measureText(i,s),this._updateRichTextWithMaxWidth(s,c,i)):(c=this._addLabelSegment(s,i).getContentSize(),this._lineOffsetX+=c.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),1<a.length&&o<a.length-1&&this._updateLineInfo()):this._isLastComponentCR(n)&&o===a.length-1||(this._updateLineInfo(),e=!0);}}e||this._linesWidth.push(this._lineOffsetX),0<this.maxWidth&&(this._labelWidth=this.maxWidth),this._labelHeight=(this._lineCount+u.BASELINE_RATIO)*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1;}},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(u.isUnicodeCJK(r)||u.isUnicodeSpace(r))return 1;var n=1;for(var a=e+1;a<i&&(r=t.charAt(a),!u.isUnicodeSpace(r)&&!u.isUnicodeCJK(r));++a)n++;return n;},_updateRichTextPosition:function(){var t=0;var e=1;var h=this._lineCount;for(var i=0;i<this._labelSegments.length;++i){var r=this._labelSegments[i];var n=r._lineCount;e<n&&(t=0,e=n);var a=0;switch(this.horizontalAlign){case _.LEFT:a=-this._labelWidth/2;break;case _.CENTER:a=-this._linesWidth[n-1]/2;break;case _.RIGHT:a=this._labelWidth/2-this._linesWidth[n-1];}r.x=t+a;var o=r.getContentSize();if(r.y=this.lineHeight*(h-n)-this._labelHeight/2,n===e&&(t+=o.width),r.getComponent(cc.Sprite)){var s=this.lineHeight;var c=this.lineHeight*(1+u.BASELINE_RATIO);switch(r.anchorY){case 1:r.y+=s+(c-s)/2;break;case .5:r.y+=c/2;break;default:r.y+=(c-s)/2;}var l;r._imageOffset&&(1===(o=r._imageOffset.split(",")).length&&o[0]?(l=parseFloat(o[0]),Number.isInteger(l)&&(r.y+=l)):2===o.length&&(l=parseFloat(o[0]),o=parseFloat(o[1]),Number.isInteger(l)&&(r.x+=l),Number.isInteger(o)&&(r.y+=o)));}o=r.getComponent(cc.LabelOutline);o&&o.width&&(r.y=r.y-o.width);}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]||cc.color().fromHEX(t);},_applyTextAttribute:function(t,e,i){var r=t.getComponent(cc.Label);var n,a;r&&(a=t._styleIndex,n=null,(n=this._textArray[a]?this._textArray[a].style:n)&&n.color?t.color=this._convertLiteralColorValue(n.color):t.color=this.node.color,r.cacheMode=this.cacheMode,this.font instanceof cc.Font&&!this._isSystemFontUsed?r.font=this.font:r.fontFamily=this.fontFamily,r.useSystemFont=this._isSystemFontUsed,r.lineHeight=this.lineHeight,r.enableBold=n&&n.bold,r.enableItalics=n&&n.italic,n&&n.italic&&(t.skewX=12),r.enableUnderline=n&&n.underline,n&&n.outline&&((a=(a=t.getComponent(cc.LabelOutline))||t.addComponent(cc.LabelOutline)).color=this._convertLiteralColorValue(n.outline.color),a.width=n.outline.width),n&&n.size?r.fontSize=n.size:r.fontSize=this.fontSize,null!==e&&(r.string=e="string"!=typeof e?""+e:e),i&&r._forceUpdateRenderData(),n&&n.event?(n.event.click&&(t._clickHandler=n.event.click),n.event.param?t._clickParam=n.event.param:t._clickParam=""):t._clickHandler=null);},onDestroy:function(){for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(),o.put(this._labelSegments[t]);}});cc.RichText=e.exports=r;},{"../platform/CCMacro":194,"../platform/js":209,"../utils/html-text-parser":261,"../utils/text-utils":271}],91:[function(t,e,i){"use strict";var o=t("../utils/misc");t("./CCComponent");var h=cc.Enum({HORIZONTAL:0,VERTICAL:1});t=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0));},animatable:!1},direction:{default:h.HORIZONTAL,type:h,tooltip:!1,notify:function(){this._onScroll(cc.v2(0,0));},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:h},setTargetScrollView:function(t){this._scrollView=t;},_convertToScrollViewSpace:function(t){var e=this._scrollView.node;t=t.convertToWorldSpaceAR(cc.v2(-t.anchorX*t.width,-t.anchorY*t.height));t=e.convertToNodeSpaceAR(t);return t.x+=e.anchorX*e.width,t.y+=e.anchorY*e.height,t;},_setOpacity:function(t){this.handle&&(this.node.opacity=t,this.handle.node.opacity=t);},_onScroll:function(t){var e,i,r,n,a,o,s,c,l;!this._scrollView||(e=this._scrollView.content)&&(c=e.getContentSize(),l=this._scrollView.node.getContentSize(),i=this.node.getContentSize(),this._conditionalDisableScrollBar(c,l)||(this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)),s=o=a=n=r=0,this.direction===h.HORIZONTAL?(r=c.width,n=l.width,s=i.width,a=t.x,o=-this._convertToScrollViewSpace(e).x):this.direction===h.VERTICAL&&(r=c.height,n=l.height,s=i.height,a=t.y,o=-this._convertToScrollViewSpace(e).y),c=this._calculateLength(r,n,s,a),l=this._calculatePosition(r,n,s,o,a,c),this._updateLength(c),this._updateHanlderPosition(l)));},_updateHanlderPosition:function(t){var e;this.handle&&(e=this._fixupHandlerPosition(),this.handle.node.setPosition(t.x+e.x,t.y+e.y));},_fixupHandlerPosition:function(){var t=this.node.getContentSize();var e=this.node.getAnchorPoint();var i=this.handle.node.getContentSize();var r=this.handle.node.parent;e=this.node.convertToWorldSpaceAR(cc.v2(-t.width*e.x,-t.height*e.y));r=r.convertToNodeSpaceAR(e);return this.direction===h.HORIZONTAL?r=cc.v2(r.x,r.y+(t.height-i.height)/2):this.direction===h.VERTICAL&&(r=cc.v2(r.x+(t.width-i.width)/2,r.y)),this.handle.node.setPosition(r),r;},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0);},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===h.HORIZONTAL||t.height<=e.height&&this.direction===h.VERTICAL;},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){t=t.getContentSize();var e=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(t,e))return;}}this._autoHideRemainingTime=this.autoHideTime;}},_calculateLength:function(t,e,i,r){return r&&(t+=20*(0<r?r:-r)),i*(e/t);},_calculatePosition:function(t,e,i,r,n,a){t-=e;n&&(t+=Math.abs(n));e=0;n=(i-a)*(e=t?o.clamp01(e=r/t):e);return this.direction===h.VERTICAL?cc.v2(0,n):cc.v2(n,0);},_updateLength:function(t){var e,i;this.handle&&(i=(e=this.handle.node).getContentSize(),e.setAnchorPoint(cc.v2(0,0)),this.direction===h.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t));},_processAutoHide:function(t){!this.enableAutoHide||this._autoHideRemainingTime<=0||this._touching||(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),t=this._opacity*(this._autoHideRemainingTime/this.autoHideTime),this._setOpacity(t)));},start:function(){this.enableAutoHide&&this._setOpacity(0);},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0);},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity);},update:function(t){this._processAutoHide(t);}});cc.Scrollbar=e.exports=t;},{"../utils/misc":264,"./CCComponent":78}],92:[function(t,e,c){"use strict";var i=t("../CCNode").EventType;var a=1e-4;var r=cc.v2();var n=cc.v2();function LGs(){return new Date().getMilliseconds();}var o=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12});var s={"scroll-to-top":o.SCROLL_TO_TOP,"scroll-to-bottom":o.SCROLL_TO_BOTTOM,"scroll-to-left":o.SCROLL_TO_LEFT,"scroll-to-right":o.SCROLL_TO_RIGHT,scrolling:o.SCROLLING,"bounce-bottom":o.BOUNCE_BOTTOM,"bounce-left":o.BOUNCE_LEFT,"bounce-right":o.BOUNCE_RIGHT,"bounce-top":o.BOUNCE_TOP,"scroll-ended":o.SCROLL_ENDED,"touch-up":o.TOUCH_UP,"scroll-ended-with-threshold":o.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":o.SCROLL_BEGAN};t=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1;},properties:{content:{default:void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(t){this._calculateBoundary();}},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0));},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0));},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent;}}},statics:{EventType:o},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0);},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i);},scrollToOffset:function(t,e,i){var r=this.getMaxScrollOffset();var n=cc.v2(0,0);0===r.x?n.x=0:n.x=t.x/r.x,0===r.y?n.y=1:n.y=(r.y-t.y)/r.y,this.scrollTo(n,e,i);},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary;var e=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(e,t);},getMaxScrollOffset:function(){var t=this._view.getContentSize();var e=this.content.getContentSize();var i=e.width-t.width;e=e.height-t.height;return i=0<=i?i:0,e=0<=e?e:0,cc.v2(i,e);},scrollToPercentHorizontal:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t);},scrollTo:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t);},scrollToPercentVertical:function(t,e,i){t=this._calculateMovePercentDelta({anchor:cc.v2(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(t,e,!1!==i):this._moveContent(t);},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime;},setContentPosition:function(t){t.fuzzyEquals(this.getContentPosition(),a)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0);},getContentPosition:function(){return this.content.getPosition();},isScrolling:function(){return this._scrolling;},isAutoScrolling:function(){return this._autoScrolling;},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0);},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0);},_onMouseWheel:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=cc.v2(0,0),this.vertical?e=cc.v2(0,-.1*t.getScrollY()):this.horizontal&&(e=cc.v2(-.1*t.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(e),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)));},_checkMouseWheel:function(t){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),a))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,.1<this._mouseWheelEventElapsedTime&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1);},_calculateMovePercentDelta:function(t){var e=t.anchor;var i=t.applyToHorizontal;t=t.applyToVertical;this._calculateBoundary(),e=e.clampf(cc.v2(0,0),cc.v2(1,1));var r=this._view.getContentSize();var n=this.content.getContentSize();var a;var o;a=-(this._getContentBottomBoundary()-this._bottomBoundary),o=-(this._getContentLeftBoundary()-this._leftBoundary);var s=cc.v2(0,0);var c=0;return i&&(c=n.width-r.width,s.x=o-c*e.x),t&&(c=n.height-r.height,s.y=a-c*e.y),s;},_moveContentToTopLeft:function(t){var e=this.content.getContentSize();var i;i=-(this._getContentBottomBoundary()-this._bottomBoundary);var r=cc.v2(0,0);var n=0;var a;a=-(this._getContentLeftBoundary()-this._leftBoundary),e.height<t.height&&(n=e.height-t.height,r.y=i-n),e.width<t.width&&(n=e.width-t.width,r.x=a),this._updateScrollBarState(),this._moveContent(r),this._adjustContentOutOfBoundary();},_calculateBoundary:function(){var t,e,i;this.content&&((t=this.content.getComponent(cc.Layout))&&t.enabledInHierarchy&&t.updateLayout(),e=(t=this._view.getContentSize()).width*this._view.anchorX,i=t.height*this._view.anchorY,this._leftBoundary=-e,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+t.width,this._topBoundary=this._bottomBoundary+t.height,this._moveContentToTopLeft(t));},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var r=e[i];if(this.node===r)return!!t.target.getComponent(cc.ViewGroup);if(r.getComponent(cc.ViewGroup))return!0;}return!1;}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation();},_onTouchBegan:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=t.touch,this.content&&this._handlePressLogic(e),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)));},_onTouchMoved:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(e=t.touch,this.content&&this._handleMoveLogic(e),this.cancelInnerEvents&&(7<e.getLocation().sub(e.getStartLocation()).mag()&&!this._touchMoved&&t.target!==this.node&&((e=new cc.Event.EventTouch(t.getTouches(),t.bubbles)).type=cc.Node.EventType.TOUCH_CANCEL,e.touch=t.touch,e.simulate=!0,t.target.dispatchEvent(e),this._touchMoved=!0),this._stopPropagationIfTargetIsMe(t))));},_onTouchEnded:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(this._dispatchEvent("touch-up"),e=t.touch,this.content&&this._handleReleaseLogic(e),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)));},_onTouchCancelled:function(t,e){this.enabledInHierarchy&&(this._hasNestedViewGroup(t,e)||(t.simulate||(e=t.touch,this.content&&this._handleReleaseLogic(e)),this._stopPropagationIfTargetIsMe(t)));},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t);},_getLocalAxisAlignDelta:function(t){return this.node.convertToNodeSpaceAR(t.getLocation(),r),this.node.convertToNodeSpaceAR(t.getPreviousLocation(),n),r.sub(n);},_handleMoveLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._processDeltaMove(t);},_scrollChildren:function(t){t=this._clampDelta(t);this.elastic&&(e=this._getHowMuchOutOfBoundary(),t.x*=0===e.x?1:.5,t.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(t),t=t.add(e));var e=-1;0<t.y?this.content.y-this.content.anchorY*this.content.height+t.y>=this._bottomBoundary&&(e="scroll-to-bottom"):t.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+t.y<=this._topBoundary&&(e="scroll-to-top"),t.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+t.x<=this._rightBoundary&&(e="scroll-to-right"):0<t.x&&this.content.x-this.content.anchorX*this.content.width+t.x>=this._leftBoundary&&(e="scroll-to-left"),this._moveContent(t,!1),0===t.x&&0===t.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==e&&this._dispatchEvent(e);},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=LGs(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan();},_clampDelta:function(t){var e=this.content.getContentSize();var i=this._view.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t;},_gatherTouchMove:function(t){for(t=this._clampDelta(t);5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);t=LGs();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t;},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if((t=this._clampDelta(t)).fuzzyEquals(cc.v2(0,0),a))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(0<t.y&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),0<t.x&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0;},_processInertiaScroll:function(){var t;this._startBounceBackIfNeeded()||!this.inertia||!(t=this._calculateTouchMoveVelocity()).fuzzyEquals(cc.v2(0,0),a)&&this.brake<1&&this._startInertiaScroll(t),this._onScrollBarTouchEnded();},_handleReleaseLogic:function(t){t=this._getLocalAxisAlignDelta(t);this._gatherTouchMove(t),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"));},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),a);},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0;}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1;},getScrollEndedEventTiming:function(){return a;},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake();var i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);t=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(r=t,t=--r*r*r*r*r+1);var r=this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(t));var n=Math.abs(t-1)<=a;Math.abs(t-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic?(t=r.sub(this._autoScrollBrakingStartPosition),e&&(t=t.mul(i)),r=this._autoScrollBrakingStartPosition.add(t)):(e=r.sub(this.getContentPosition()),(i=this._getHowMuchOutOfBoundary(e)).fuzzyEquals(cc.v2(0,0),a)||(r=r.add(i),n=!0)),n&&(this._autoScrolling=!1);t=r.sub(this.getContentPosition());this._moveContent(this._clampDelta(t),n),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"));},_startInertiaScroll:function(t){var e=t.mul(.7);this._startAttenuatingAutoScroll(e,t);},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9));},_startAttenuatingAutoScroll:function(t,e){e=this._calculateAutoScrollTimeByInitalSpeed(e.mag());var i=t.normalize();var r=this.content.getContentSize();var n=this._view.getContentSize();var a=r.width-n.width;r=r.height-n.height;n=this._calculateAttenuatedFactor(a);var o=this._calculateAttenuatedFactor(r);i=cc.v2(i.x*a*(1-this.brake)*n,i.y*r*o*(1-this.brake));a=t.mag();n=i.mag()/a;i=i.add(t),0<this.brake&&7<n&&(n=Math.sqrt(n),i=t.mul(n).add(t)),0<this.brake&&3<n&&(e*=n=3),0===this.brake&&1<n&&(e*=n),this._startAutoScroll(i,e,!0);},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5));},_startAutoScroll:function(t,e,i){t=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=t,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),a)||(this._autoScrollCurrentlyOutOfBoundary=!0);},_calculateTouchMoveVelocity:function(){var t;if((t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e;},0))<=0||.5<=t)return cc.v2(0,0);var e=cc.v2(0,0);return e=this._touchMoveDisplacements.reduce(function(t,e){return t.add(e);},e),cc.v2(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t);},_flattenVectorByDirection:function(t){return t.x=this.horizontal?t.x:0,t.y=this.vertical?t.y:0,t;},_moveContent:function(t,e){t=this._flattenVectorByDirection(t);t=this.getContentPosition().add(t);this.setContentPosition(t);t=this._getHowMuchOutOfBoundary();this._updateScrollBar(t),this.elastic&&e&&this._startBounceBackIfNeeded();},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width;},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width;},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height;},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height;},_getHowMuchOutOfBoundary:function(t){if((t=t||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),a)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.v2(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.fuzzyEquals(cc.v2(0,0),a)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e=this._clampDelta(e);},_updateScrollBarState:function(){var t,e;this.content&&(t=this.content.getContentSize(),e=this._view.getContentSize(),this.verticalScrollBar&&(t.height<e.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(t.width<e.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show()));},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t);},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan();},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded();},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<s[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e;}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,s[t]),this.node.emit(t,this);},_adjustContentOutOfBoundary:function(){var t;this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()&&(t=this._getHowMuchOutOfBoundary(cc.v2(0,0)),t=this.getContentPosition().add(t),this.content&&(this.content.setPosition(t),this._updateScrollBar(0)));},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this);},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide();},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(i.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(i.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(i.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(i.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(i.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll();},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(i.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(i.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(i.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(i.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(i.SIZE_CHANGED,this._calculateBoundary,this))),this._updateScrollBarState();},update:function(t){this._autoScrolling&&this._processAutoScrolling(t);}});cc.ScrollView=e.exports=t;},{"../CCNode":30,"./CCViewGroup":99}],93:[function(t,e,i){"use strict";var r=t("../utils/misc");t=t("./CCComponent");var n=cc.Enum({Horizontal:0,Vertical:1});t=cc.Class({name:"cc.Slider",extends:t,editor:!1,ctor:function(){this._offset=cc.v2(),this._touchHandle=!1,this._dragging=!1;},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:n.Horizontal,type:n,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition();}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:n},__preload:function(){this._updateHandlePosition();},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this));},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this));},_onHandleDragStart:function(t){this._dragging=!0,this._touchHandle=!0,this._offset=this.handle.node.convertToNodeSpaceAR(t.touch.getLocation()),t.stopPropagation();},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.stopPropagation());},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation());},_onTouchEnded:function(t){this._dragging=!1,this._touchHandle=!1,this._offset=cc.v2(),t.stopPropagation();},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation();},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent();},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this);},_updateProgress:function(t){var e;this.handle&&(t=(e=this.node).convertToNodeSpaceAR(t.getLocation()),this.direction===n.Horizontal?this.progress=r.clamp01((t.x-this._offset.x+e.anchorX*e.width)/e.width):this.progress=r.clamp01((t.y-this._offset.y+e.anchorY*e.height)/e.height));},_updateHandlePosition:function(){var t;this.handle&&(t=this.direction===n.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height),t=this.node.convertToWorldSpaceAR(t),this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(t));}});cc.Slider=e.exports=t;},{"../utils/misc":264,"./CCComponent":78}],94:[function(t,e,i){"use strict";var r=t("../utils/misc");t("../CCNode").EventType;var n=t("./CCRenderComponent");var a=t("../utils/blend-func");var o=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4});t=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2});var s=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2});var c=cc.Enum({NORMAL:0,GRAY:1});n=cc.Class({name:"cc.Sprite",extends:n,mixins:[a],editor:!1,properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:o.SIMPLE,_sizeMode:s.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame;},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i));},type:cc.SpriteFrame},type:{get:function(){return this._type;},set:function(t){this._type!==t&&(this._type=t,this.setVertsDirty(),this._resetAssembler());},type:o,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType;},set:function(t){t!==this._fillType&&(this._fillType=t,this.setVertsDirty(),this._resetAssembler());},type:t,tooltip:!1},fillCenter:{get:function(){return this._fillCenter;},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===o.FILLED&&this.setVertsDirty();},tooltip:!1},fillStart:{get:function(){return this._fillStart;},set:function(t){this._fillStart=r.clampf(t,-1,1),this._type===o.FILLED&&this.setVertsDirty();},tooltip:!1},fillRange:{get:function(){return this._fillRange;},set:function(t){this._fillRange=r.clampf(t,-1,1),this._type===o.FILLED&&this.setVertsDirty();},tooltip:!1},trim:{get:function(){return this._isTrimmedMode;},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type!==o.SIMPLE&&this._type!==o.MESH||this.setVertsDirty());},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode;},set:function(t){(this._sizeMode=t)!==s.CUSTOM&&this._applySpriteSize();},animatable:!1,type:s,tooltip:!1}},statics:{FillType:t,Type:o,SizeMode:s,State:c},setVisible:function(t){this.enabled=t;},setState:function(){},getState:function(){},onEnable:function(){this._super(),this._applySpriteFrame(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this);},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this);},_updateMaterial:function(){var t=this._spriteFrame&&this._spriteFrame.getTexture();var e=this.getMaterial(0);e&&e.setProperty("texture",t),a.prototype._updateMaterial.call(this);},_applyAtlas:!1,_validateRender:function(){var t=this._spriteFrame;this._materials[0]&&t&&t.textureLoaded()||this.disableRender();},_applySpriteSize:function(){var t;this._spriteFrame&&this.isValid&&(s.RAW===this._sizeMode?(t=this._spriteFrame._originalSize,this.node.setContentSize(t)):s.TRIMMED===this._sizeMode&&(t=this._spriteFrame._rect,this.node.setContentSize(t.width,t.height)),this.setVertsDirty());},_applySpriteFrame:function(t){var e=t&&t.getTexture();e&&!e.loaded&&t.off("load",this._applySpriteSize,this);t=this._spriteFrame;t?(this._updateMaterial(),e===(e=t.getTexture())&&e&&e.loaded?this._applySpriteSize():(this.disableRender(),t.onTextureLoaded(this._applySpriteSize,this))):this.disableRender();}});cc.Sprite=e.exports=n;},{"../CCNode":30,"../utils/blend-func":257,"../utils/misc":264,"./CCRenderComponent":89}],95:[function(t,e,i){"use strict";var r=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5});var n=cc.Enum({VERTICAL:0,HORIZONTAL:1});var a=cc.Enum({TOP:0,CENTER:1,BOTTOM:2});var o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2});r=cc.Class({name:"cc.StudioComponent",extends:cc.Component,editor:!1,properties:!1,statics:{ComponentType:r,ListDirection:n,VerticalAlign:a,HorizontalAlign:o}});var s=t("../utils/prefab-helper");r.PlaceHolder=cc.Class({name:"cc.StudioComponent.PlaceHolder",extends:cc.Component,properties:{_baseUrl:"",nestedPrefab:cc.Prefab},onLoad:function(){this.nestedPrefab&&this._replaceWithNestedPrefab();},_replaceWithNestedPrefab:function(){var t=this.node;var e=t._prefab;e.root=t,e.asset=this.nestedPrefab,s.syncWithPrefab(t);}}),cc.StudioComponent=e.exports=r;n=cc.Class({name:"cc.StudioWidget",extends:cc.Widget,editor:!1,_validateTargetInDEV:function(){}});cc.StudioWidget=e.exports=n;},{"../utils/prefab-helper":267}],96:[function(t,e,i){"use strict";var r=t("../utils/gray-sprite-state");r=cc.Class({name:"cc.Toggle",extends:t("./CCButton"),mixins:[r],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked;},set:function(t){var e;t!==this._N$isChecked&&((e=this.toggleGroup||this._toggleContainer)&&e.enabled&&this._N$isChecked&&!e.allowSwitchOff||(this._N$isChecked=t,this._updateCheckMark(),e&&e.enabled&&e.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents()));},tooltip:!1},toggleGroup:{default:null,tooltip:!1,type:t("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode();}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this);},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this);},_hideCheckMark:function(){this._N$isChecked=!1,this._updateCheckMark();},toggle:function(t){this.isChecked=!this.isChecked,cc.Toggle._triggerEventInScript_isChecked||!cc.Toggle._triggerEventInScript_check&&!t||this._emitToggleEvents();},check:function(){this.isChecked=!0,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents();},uncheck:function(){this.isChecked=!1,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents();},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked);},_updateDisabledState:function(){var t;this._super(),this.enableAutoGrayEffect&&this.checkMark&&(t=!this.interactable,this._switchGrayMaterial(t,this.checkMark));},_registerToggleEvent:function(){this.node.on("click",this.toggle,this);},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this);},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this);}});cc.Toggle=e.exports=r,t("../platform/js").get(r.prototype,"_toggleContainer",function(){var t=this.node.parent;return cc.Node.isNode(t)?t.getComponent(cc.ToggleContainer):null;});},{"../platform/js":209,"../utils/gray-sprite-state":260,"./CCButton":76,"./CCToggleGroup":98}],97:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},checkEvents:{default:[],type:cc.Component.EventHandler}},updateToggles:function(e){this.enabledInHierarchy&&e.isChecked&&(this.toggleItems.forEach(function(t){t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark();}),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,e));},_allowOnlyOneToggleChecked:function(){var e=!1;return this.toggleItems.forEach(function(t){e?t._hideCheckMark():t.isChecked&&(e=!0);}),e;},_makeAtLeastOneToggleChecked:function(){var t;this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<(t=this.toggleItems).length&&t[0].check();},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this);},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this);},start:function(){this._makeAtLeastOneToggleChecked();}});t("../platform/js").get(r.prototype,"toggleItems",function(){return this.node.getComponentsInChildren(cc.Toggle);}),cc.ToggleContainer=e.exports=r;},{"../platform/js":209}],98:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[];},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems;}}},updateToggles:function(e){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){e.isChecked&&t!==e&&t.isChecked&&t.enabled&&t._hideCheckMark();});},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked();},removeToggle:function(t){t=this._toggleItems.indexOf(t);-1<t&&this._toggleItems.splice(t,1),this._makeAtLeastOneToggleChecked();},_allowOnlyOneToggleChecked:function(){var e=!1;return this._toggleItems.forEach(function(t){e&&t.enabled&&t._hideCheckMark(),t.isChecked&&t.enabled&&(e=!0);}),e;},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||0<this._toggleItems.length&&(this._toggleItems[0].isChecked=!0);},start:function(){this._makeAtLeastOneToggleChecked();}});t=t("../platform/js");var n=!1;t.get(cc,"ToggleGroup",function(){return n||(cc.errorID(1405,"cc.ToggleGroup","cc.ToggleContainer"),n=!0),r;}),e.exports=r;},{"../platform/js":209}],99:[function(t,e,i){"use strict";t=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=t;},{"./CCComponent":78}],100:[function(h,u,_){"use strict";var t=h("../base-ui/CCWidgetManager");var e=t.AlignMode;var i=t._AlignFlags;var r=i.TOP;var n=i.MID;var a=i.BOT;var o=i.LEFT;var s=i.CENTER;var c=i.RIGHT;var d=r|a;var l=o|c;i=cc.Class({name:"cc.Widget",extends:h("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target;},set:function(t){this._target=t;},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return 0<(this._alignFlags&r);},set:function(t){this._setAlign(r,t);},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return 0<(this._alignFlags&n);},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=n):this._alignFlags&=~n;},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return 0<(this._alignFlags&a);},set:function(t){this._setAlign(a,t);},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return 0<(this._alignFlags&o);},set:function(t){this._setAlign(o,t);},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return 0<(this._alignFlags&s);},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=s):this._alignFlags&=~s;},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return 0<(this._alignFlags&c);},set:function(t){this._setAlign(c,t);},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&l)==l;},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&d)==d;},visible:!1},top:{get:function(){return this._top;},set:function(t){this._top=t;},tooltip:!1},bottom:{get:function(){return this._bottom;},set:function(t){this._bottom=t;},tooltip:!1},left:{get:function(){return this._left;},set:function(t){this._left=t;},tooltip:!1},right:{get:function(){return this._right;},set:function(t){this._right=t;},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter;},set:function(t){this._horizontalCenter=t;},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter;},set:function(t){this._verticalCenter=t;},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter;},set:function(t){this._isAbsHorizontalCenter=t;},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter;},set:function(t){this._isAbsVerticalCenter=t;},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop;},set:function(t){this._isAbsTop=t;},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom;},set:function(t){this._isAbsBottom=t;},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft;},set:function(t){this._isAbsLeft=t;},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight;},set:function(t){this._isAbsRight=t;},animatable:!1},alignMode:{default:e.ON_WINDOW_RESIZE,type:e,tooltip:!1},_wasAlignOnce:{default:void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:e},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?e.ONCE:e.ALWAYS,this._wasAlignOnce=void 0);},onEnable:function(){t.add(this);},onDisable:function(){t.remove(this);},_validateTargetInDEV:!1,_setAlign:function(t,e){var i;e!==0<(this._alignFlags&t)&&(i=0<(t&l),e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t));},updateAlignment:function(){t.updateAlignment(this.node);}});Object.defineProperty(i.prototype,"isAlignOnce",{get:function(){return cc.warn("`widget.isAlignOnce` is deprecated, use `widget.alignMode === cc.Widget.AlignMode.ONCE` instead please."),this.alignMode===e.ONCE;},set:function(t){cc.warn("`widget.isAlignOnce` is deprecated, use `widget.alignMode = cc.Widget.AlignMode.*` instead please."),this.alignMode=t?e.ONCE:e.ALWAYS;}}),cc.Widget=u.exports=i;},{"../base-ui/CCWidgetManager":62,"./CCComponent":78}],101:[function(t,e,i){"use strict";t=t("./CCComponent");t=cc.Class({name:"cc.WXSubContextView",extends:t,editor:!1,properties:{_fps:60,fps:{get:function(){return this._fps;},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1/t,this._updateSubContextFrameRate());},tooltip:!1}},ctor:function(){this._sprite=null,this._tex=new cc.Texture2D(),this._context=null,this._updatedTime=performance.now(),this._updateInterval=0;},onLoad:function(){wx.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._context=wx.getOpenDataContext(),this.reset(),this._tex.setPremultiplyAlpha(!0),this._tex.initWithElement(sharedCanvas),this._sprite=this.node.getComponent(cc.Sprite),this._sprite||(this._sprite=this.node.addComponent(cc.Sprite),this._sprite.srcBlendFactor=cc.macro.BlendFactor.ONE),this._sprite.spriteFrame=new cc.SpriteFrame(this._tex)):this.enabled=!1;},reset:function(){var t;this._context&&(this.updateSubContextViewport(),(t=this._context.canvas)&&(t.width=this.node.width,t.height=this.node.height));},onEnable:function(){this._runSubContextMainLoop(),this._registerNodeEvent(),this._updateSubContextFrameRate(),this.updateSubContextViewport();},onDisable:function(){this._unregisterNodeEvent(),this._stopSubContextMainLoop();},update:function(t){if(void 0===t)return this._context&&this._context.postMessage({fromEngine:!0,event:"step"}),void this._updateSubContextTexture();performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture());},_updateSubContextTexture:function(){this._tex&&this._context&&(this._tex.initWithElement(this._context.canvas),this._sprite._activateMaterial());},updateSubContextViewport:function(){var t,e,i;this._context&&(t=this.node.getBoundingBoxToWorld(),e=cc.view._scaleX,i=cc.view._scaleY,this._context.postMessage({fromEngine:!0,event:"viewport",x:t.x*e+cc.view._viewportRect.x,y:t.y*i+cc.view._viewportRect.y,width:t.width*e,height:t.height*i}));},_registerNodeEvent:function(){this.node.on("position-changed",this.updateSubContextViewport,this),this.node.on("scale-changed",this.updateSubContextViewport,this),this.node.on("size-changed",this.updateSubContextViewport,this);},_unregisterNodeEvent:function(){this.node.off("position-changed",this.updateSubContextViewport,this),this.node.off("scale-changed",this.updateSubContextViewport,this),this.node.off("size-changed",this.updateSubContextViewport,this);},_runSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!0});},_stopSubContextMainLoop:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"mainLoop",value:!1});},_updateSubContextFrameRate:function(){this._context&&this._context.postMessage({fromEngine:!0,event:"frameRate",value:this._fps});}});cc.WXSubContextView=e.exports=t;},{"./CCComponent":78}],102:[function(t,e,l){"use strict";var i=t("../../platform/CCMacro");var r=t("../editbox/EditBoxImplBase");var n=t("../CCLabel");var a=t("./types");var o=a.InputMode;var s=a.InputFlag;a=a.KeyboardReturnType;var c=cc.Class({name:"cc.EditBox",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._string;},set:function(t){t=""+t,0<=this.maxLength&&t.length>=this.maxLength&&(t=t.slice(0,this.maxLength)),this._string=t,this._updateString(t);}},textLabel:{tooltip:!1,default:null,type:n,notify:function(t){this.textLabel&&this.textLabel!==t&&(this._updateTextLabel(),this._updateLabels());}},placeholderLabel:{tooltip:!1,default:null,type:n,notify:function(t){this.placeholderLabel&&this.placeholderLabel!==t&&(this._updatePlaceholderLabel(),this._updateLabels());}},background:{tooltip:!1,default:null,type:cc.Sprite,notify:function(t){this.background&&this.background!==t&&this._updateBackgroundSprite();}},_N$backgroundImage:{default:void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null;},set:function(t){this.background&&(this.background.spriteFrame=t);}},returnType:{default:a.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:a},_N$returnType:{default:void 0,type:cc.Float},inputFlag:{tooltip:!1,default:s.DEFAULT,type:s,notify:function(){this._updateString(this._string);}},inputMode:{tooltip:!1,default:o.ANY,type:o,notify:function(t){this.inputMode!==t&&(this._updateTextLabel(),this._updatePlaceholderLabel());}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:0;},set:function(t){this.textLabel&&(this.textLabel.fontSize=t);}},_N$fontSize:{default:void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:0;},set:function(t){this.textLabel&&(this.textLabel.lineHeight=t);}},_N$lineHeight:{default:void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:cc.Color.BLACK;},set:function(t){this.textLabel&&(this.textLabel.node.color=t,this.textLabel.node.opacity=t.a);}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:"";},set:function(t){this.placeholderLabel&&(this.placeholderLabel.string=t);}},_N$placeholder:{default:void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:0;},set:function(t){this.placeholderLabel&&(this.placeholderLabel.fontSize=t);}},_N$placeholderFontSize:{default:void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:cc.Color.BLACK;},set:function(t){this.placeholderLabel&&(this.placeholderLabel.node.color=t,this.placeholderLabel.node.opacity=t.a);}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,default:20},_N$maxLength:{default:void 0,type:cc.Float},stayOnTop:{default:!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.");}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex;},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t));}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{_ImplClass:r,KeyboardReturnType:a,InputFlag:s,InputMode:o},_init:function(){this._upgradeComp(),this._isLabelVisible=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this),(this._impl=new c._ImplClass()).init(this),this._updateString(this._string),this._syncSize();},_updateBackgroundSprite:function(){var t=this.background;var e;t||(t=(t=(e=(e=this.node.getChildByName("BACKGROUND_SPRITE"))||new cc.Node("BACKGROUND_SPRITE")).getComponent(cc.Sprite))||e.addComponent(cc.Sprite),e.parent=this.node,this.background=t),t.type=cc.Sprite.Type.SLICED,void 0!==this._N$backgroundImage&&(t.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0);},_updateTextLabel:function(){var t=this.textLabel;var e;t||(t=(t=(e=(e=this.node.getChildByName("TEXT_LABEL"))||new cc.Node("TEXT_LABEL")).getComponent(n))||e.addComponent(n),e.parent=this.node,this.textLabel=t),t.node.setAnchorPoint(0,1),t.overflow=n.Overflow.CLAMP,this.inputMode===o.ANY?(t.verticalAlign=i.VerticalTextAlignment.TOP,t.enableWrapText=!0):(t.verticalAlign=i.VerticalTextAlignment.CENTER,t.enableWrapText=!1),t.string=this._updateLabelStringStyle(this._string),void 0!==this._N$fontColor&&(t.node.color=this._N$fontColor,t.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0),void 0!==this._N$fontSize&&(t.fontSize=this._N$fontSize,this._N$fontSize=void 0),void 0!==this._N$lineHeight&&(t.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0);},_updatePlaceholderLabel:function(){var t=this.placeholderLabel;var e;t||(t=(t=(e=(e=this.node.getChildByName("PLACEHOLDER_LABEL"))||new cc.Node("PLACEHOLDER_LABEL")).getComponent(n))||e.addComponent(n),e.parent=this.node,this.placeholderLabel=t),t.node.setAnchorPoint(0,1),t.overflow=n.Overflow.CLAMP,this.inputMode===o.ANY?(t.verticalAlign=i.VerticalTextAlignment.TOP,t.enableWrapText=!0):(t.verticalAlign=i.VerticalTextAlignment.CENTER,t.enableWrapText=!1),t.string=this.placeholder,void 0!==this._N$placeholderFontColor&&(t.node.color=this._N$placeholderFontColor,t.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0),void 0!==this._N$placeholderFontSize&&(t.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0);},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0),void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0),void 0!==this._N$backgroundImage&&this._updateBackgroundSprite(),void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel(),void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel(),void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0);},_syncSize:function(){var t;this._impl&&(t=this.node.getContentSize(),this._impl.setSize(t.width,t.height));},_showLabels:function(){this._isLabelVisible=!0,this._updateLabels();},_hideLabels:function(){this._isLabelVisible=!1,this.textLabel&&(this.textLabel.node.active=!1),this.placeholderLabel&&(this.placeholderLabel.node.active=!1);},_updateLabels:function(){var t;this._isLabelVisible&&(t=this._string,this.textLabel&&(this.textLabel.node.active=""!==t),this.placeholderLabel&&(this.placeholderLabel.node.active=""===t));},_updateString:function(t){var e=this.textLabel;var i;e&&(i=(i=t)&&this._updateLabelStringStyle(t),e.string=i,this._updateLabels());},_updateLabelStringStyle:function(t,e){var i=this.inputFlag;if(e||i!==s.PASSWORD)i===s.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===s.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase();}):i===s.INITIAL_CAPS_SENTENCE&&(t=(e=t).charAt(0).toUpperCase()+e.slice(1));else{var r="";var n=t.length;for(var a=0;a<n;++a)r+="\u25cf";t=r;}return t;},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this);},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this);},editBoxTextChanged:function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,cc.Component.EventHandler.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this);},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this);},onEnable:function(){this._registerEvent(),this._impl&&this._impl.enable();},onDisable:function(){this._unregisterEvent(),this._impl&&this._impl.disable();},onDestroy:function(){this._impl&&this._impl.clear();},__preload:function(){this._init();},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this);},_onTouchBegan:function(t){t.stopPropagation();},_onTouchCancel:function(t){t.stopPropagation();},_onTouchEnded:function(t){this._impl&&this._impl.beginEditing(),t.stopPropagation();},setFocus:function(){cc.errorID(1400,"setFocus()","focus()"),this._impl&&this._impl.setFocus(!0);},focus:function(){this._impl&&this._impl.setFocus(!0);},blur:function(){this._impl&&this._impl.setFocus(!1);},isFocused:function(){return!!this._impl&&this._impl.isFocused();},update:function(){this._impl&&this._impl.update();}});cc.EditBox=e.exports=c,cc.sys.isBrowser&&t("./WebEditBoxImpl");},{"../../platform/CCMacro":194,"../CCLabel":80,"../editbox/EditBoxImplBase":103,"./WebEditBoxImpl":104,"./types":106}],103:[function(t,e,i){"use strict";var r=cc.Class({ctor:function(){this._delegate=null,this._editing=!1;},init:function(t){},enable:function(){},disable:function(){this._editing&&this.endEditing();},clear:function(){},update:function(){},setTabIndex:function(t){},setSize:function(t,e){},setFocus:function(t){t?this.beginEditing():this.endEditing();},isFocused:function(){return this._editing;},beginEditing:function(){},endEditing:function(){}});e.exports=r;},{}],104:[function(t,r,l){"use strict";var _=(e=t("../../value-types/mat4"))&&e.__esModule?e:{default:e};var h=t("../../platform/utils");var u=t("../../platform/CCMacro");var e=t("./types");var s=t("../CCLabel");var n=t("./tabIndexUtil");t=cc.EditBox;var f=cc.js;var a=e.InputMode;var o=e.InputFlag;var p=e.KeyboardReturnType;var m={zoomInvalid:!1};cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(m.zoomInvalid=!0);var v=0;var d=cc.v3();var c=null;var i=!1;var y=!1;var g=t._ImplClass;function WebEditBoxImpl(){g.call(this),this._domId="EditBoxId_"+ ++v,this._placeholderStyleSheet=null,this._elem=null,this._isTextArea=!1,this._worldMat=new _.default(),this._cameraMat=new _.default(),this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this._cacheViewportRect=cc.rect(0,0,0,0),this._inputMode=null,this._inputFlag=null,this._returnType=null,this._eventListeners={},this._textLabelFont=null,this._textLabelFontSize=null,this._textLabelFontColor=null,this._textLabelAlign=null,this._placeholderLabelFont=null,this._placeholderLabelFontSize=null,this._placeholderLabelFontColor=null,this._placeholderLabelAlign=null,this._placeholderLineHeight=null;}f.extend(WebEditBoxImpl,g),t._ImplClass=WebEditBoxImpl,Object.assign(WebEditBoxImpl.prototype,{init:function(t){t&&((this._delegate=t).inputMode===a.ANY?this._createTextArea():this._createInput(),n.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),i=cc.view.isAutoFullScreenEnabled(),y=cc.view._resizeWithBrowserSize);},clear:function(){this._removeEventListeners(),this._removeDomFromGameContainer(),n.remove(this),c===this&&(c=null);},update:function(){},setTabIndex:function(t){this._elem.tabIndex=t,n.resort();},setSize:function(t,e){var i=this._elem;i.style.width=t+"px",i.style.height=e+"px";},beginEditing:function(){c&&c!==this&&c.setFocus(!1),this._editing=!0,(c=this)._delegate.editBoxEditingDidBegan(),this._showDom(),this._elem.focus();},endEditing:function(){this._elem&&this._elem.blur();},_createInput:function(){this._isTextArea=!1,this._elem=document.createElement("input");},_createTextArea:function(){this._isTextArea=!0,this._elem=document.createElement("textarea");},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem),document.head.appendChild(this._placeholderStyleSheet);},_removeDomFromGameContainer:function(){h.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem),h.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet),delete this._elem,delete this._placeholderStyleSheet;},_showDom:function(){this._updateMatrix(),this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._elem.style.display="",this._delegate._hideLabels(),cc.sys.isMobile&&this._showDomOnMobile();},_hideDom:function(){this._elem.style.display="none",this._delegate._showLabels(),cc.sys.isMobile&&this._hideDomOnMobile();},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(i&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),y&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll());},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(y&&cc.view.resizeWithBrowserSize(!0),setTimeout(function(){c||i&&cc.view.enableAutoFullScreen(!0);},800)),this._scrollBackWindow();},_adjustWindowScroll:function(){var t=this;setTimeout(function(){window.scrollY<100&&t._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"});},800);},_scrollBackWindow:function(){setTimeout(function(){var t=cc.sys;t.browserType!==t.BROWSER_TYPE_WECHAT||t.os!==t.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0);},800);},_updateMatrix:function(){var t=this._delegate.node;t.getWorldMatrix(this._worldMat);var e=this._worldMat;var i=e.m;var r=cc.view;var n,a,o,h,u,s,c,l;this._m00===i[0]&&this._m01===i[1]&&this._m04===i[4]&&this._m05===i[5]&&this._m12===i[12]&&this._m13===i[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height&&this._cacheViewportRect.equals(r._viewportRect)||(this._m00=i[0],this._m01=i[1],this._m04=i[4],this._m05=i[5],this._m12=i[12],this._m13=i[13],this._w=t._contentSize.width,this._h=t._contentSize.height,this._cacheViewportRect.set(r._viewportRect),i=r._scaleX,n=r._scaleY,c=r._viewportRect,r=r._devicePixelRatio,d.x=-t._anchorPoint.x*this._w,d.y=-t._anchorPoint.y*this._h,_.default.transform(e,e,d),cc.Camera.findCamera(t).getWorldToScreenMatrix2D(this._cameraMat),a=this._cameraMat,_.default.mul(a,a,e),i/=r,n/=r,e=cc.game.container,o=(a=a.m)[0]*i,h=a[1],u=a[4],s=a[5]*n,l=e&&e.style.paddingLeft&&parseInt(e.style.paddingLeft),l+=c.x/r,e=e&&e.style.paddingBottom&&parseInt(e.style.paddingBottom),e+=c.y/r,c=a[12]*i+l,r=a[13]*n+e,m.zoomInvalid&&(this.setSize(t.width*o,t.height*s),s=o=1),(i=this._elem).style.transform=l="matrix("+o+","+-h+","+-u+","+s+","+c+","+-r+")",i.style["-webkit-transform"]=l,i.style["transform-origin"]="0px 100% 0px",i.style["-webkit-transform-origin"]="0px 100% 0px");},_updateInputType:function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,t=t.returnType,r=this._elem;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==t){if(this._inputMode=e,this._inputFlag=i,this._returnType=t,this._isTextArea)return n="none",i===o.INITIAL_CAPS_ALL_CHARACTERS?n="uppercase":i===o.INITIAL_CAPS_WORD&&(n="capitalize"),void(r.style.textTransform=n);var n;i!==o.PASSWORD?(n=r.type,e===a.EMAIL_ADDR?n="email":e===a.NUMERIC||e===a.DECIMAL?n="number":e===a.PHONE_NUMBER?(n="number",r.pattern="[0-9]*"):e===a.URL?n="url":(n="text",t===p.SEARCH&&(n="search")),r.type=n,e="none",i===o.INITIAL_CAPS_ALL_CHARACTERS?e="uppercase":i===o.INITIAL_CAPS_WORD&&(e="capitalize"),r.style.textTransform=e):r.type="password";}},_updateMaxLength:function(){var t=this._delegate.maxLength;this._elem.maxLength=t=t<0?65535:t;},_initStyleSheet:function(){var t=this._elem;t.style.display="none",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.textTransform="uppercase",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflow_y="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style");},_updateStyleSheet:function(){var t=this._delegate,e=this._elem;e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel);},_updateTextLabel:function(t){if(t){var e=t.font;e=!e||e instanceof cc.BitmapFont?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scaleY;if(this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign){this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign;var r=this._elem;switch(r.style.fontSize=i+"px",r.style.color=t.node.color.toCSS(),r.style.fontFamily=e,t.horizontalAlign){case s.HorizontalAlign.LEFT:r.style.textAlign="left";break;case s.HorizontalAlign.CENTER:r.style.textAlign="center";break;case s.HorizontalAlign.RIGHT:r.style.textAlign="right";}}}},_updatePlaceholderLabel:function(t){if(t){var e=t.font;e=!e||e instanceof cc.BitmapFont?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scaleY;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r=this._placeholderStyleSheet;var n=t.node.color.toCSS();var a=t.fontSize;var o;switch(t.horizontalAlign){case s.HorizontalAlign.LEFT:o="left";break;case s.HorizontalAlign.CENTER:o="center";break;case s.HorizontalAlign.RIGHT:o="right";}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+e+"; font-size: "+i+"px; color: "+n+"; line-height: "+a+"px; text-align: "+o+";}",cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}");}}},_registerEventListeners:function(){var e=this,i=this._elem,t=!1,r=this._eventListeners;r.compositionStart=function(){t=!0;},r.compositionEnd=function(){t=!1,e._delegate.editBoxTextChanged(i.value);},r.onInput=function(){t||e._delegate.editBoxTextChanged(i.value);},r.onClick=function(t){e._editing&&cc.sys.isMobile&&e._adjustWindowScroll();},r.onKeydown=function(t){t.keyCode===u.KEY.enter?(t.stopPropagation(),e._delegate.editBoxEditingReturn(),e._isTextArea||i.blur()):t.keyCode===u.KEY.tab&&(t.stopPropagation(),t.preventDefault(),n.next(e));},r.onBlur=function(){e._editing=!1,c=null,e._hideDom(),e._delegate.editBoxEditingDidEnded();},r.onResize=function(){e._updateMatrix();},i.addEventListener("compositionstart",r.compositionStart),i.addEventListener("compositionend",r.compositionEnd),i.addEventListener("input",r.onInput),i.addEventListener("keydown",r.onKeydown),i.addEventListener("blur",r.onBlur),i.addEventListener("touchstart",r.onClick),window.addEventListener("resize",r.onResize),window.addEventListener("orientationchange",r.onResize);},_removeEventListeners:function(){var t=this._elem,e=this._eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),window.removeEventListener("resize",e.onResize),window.removeEventListener("orientationchange",e.onResize),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null,e.onResize=null;}});},{"../../platform/CCMacro":194,"../../platform/utils":213,"../../value-types/mat4":281,"../CCLabel":80,"./tabIndexUtil":105,"./types":106}],105:[function(t,e,i){"use strict";e.exports={_tabIndexList:[],add:function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t);},remove:function(t){var e=this._tabIndexList;t=e.indexOf(t);-1!==t&&e.splice(t,1);},resort:function(){this._tabIndexList.sort(function(t,e){return t._delegate._tabIndex-e._delegate._tabIndex;});},next:function(t){var e=this._tabIndexList;var i=e.indexOf(t);t.setFocus(!1),-1===i||(t=e[i+1])&&0<=t._delegate._tabIndex&&t.setFocus(!0);}};},{}],106:[function(t,e,i){"use strict";var r=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5});var n=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6});var a=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});e.exports={KeyboardReturnType:r,InputMode:n,InputFlag:a};},{}],107:[function(t,e,i){"use strict";t("./CCComponent"),t("./CCComponentEventHandler"),t("./missing-script");var r=t("./WXSubContextView");var n=t("./SwanSubContextView");r=r||cc.Class({name:"cc.WXSubContextView",extends:cc.Component}),n=n||cc.Class({name:"cc.SwanSubContextView",extends:cc.Component});t=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./editbox/CCEditBox"),t("./CCLabelOutline"),t("./CCLabelShadow"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents"),t("./CCMotionStreak"),r,n];e.exports=t;},{"./CCAnimation":73,"./CCAudioSource":74,"./CCBlockInputEvents":75,"./CCButton":76,"./CCCanvas":77,"./CCComponent":78,"./CCComponentEventHandler":79,"./CCLabel":80,"./CCLabelOutline":81,"./CCLabelShadow":82,"./CCLayout":83,"./CCMask":84,"./CCMotionStreak":85,"./CCPageView":86,"./CCPageViewIndicator":87,"./CCProgressBar":88,"./CCRichText":90,"./CCScrollBar":91,"./CCScrollView":92,"./CCSlider":93,"./CCSprite":94,"./CCToggle":96,"./CCToggleContainer":97,"./CCToggleGroup":98,"./CCWidget":100,"./SwanSubContextView":void 0,"./WXSubContextView":101,"./editbox/CCEditBox":102,"./missing-script":108}],108:[function(t,e,i){"use strict";var r=cc.js;var n=t("../utils/misc").BUILTIN_CLASSID_RE;var a=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}});var o=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){var i=r._getClassById(t);return i||(t?(cc.deserialize.reportMissingClass(t),o.getMissingWrapper(t,e)):null);},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||n.test(t))?o:a;}},onLoad:function(){cc.warnID(4600,this.node.name);}});cc._MissingScript=e.exports=o;},{"../utils/misc":264}],109:[function(t,e,i){"use strict";var r=cc.js;t("../event/event");function CAs(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0;}r.extend(CAs,cc.Event);t=CAs.prototype;t.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e;},t.getScrollX=function(){return this._scrollX;},t.getScrollY=function(){return this._scrollY;},t.setLocation=function(t,e){this._x=t,this._y=e;},t.getLocation=function(){return cc.v2(this._x,this._y);},t.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y);},t._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e;},t.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY);},t.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY);},t.getDeltaX=function(){return this._x-this._prevX;},t.getDeltaY=function(){return this._y-this._prevY;},t.setButton=function(t){this._button=t;},t.getButton=function(){return this._button;},t.getLocationX=function(){return this._x;},t.getLocationY=function(){return this._y;},CAs.NONE=0,CAs.DOWN=1,CAs.UP=2,CAs.MOVE=3,CAs.SCROLL=4,CAs.BUTTON_LEFT=0,CAs.BUTTON_RIGHT=2,CAs.BUTTON_MIDDLE=1,CAs.BUTTON_4=3,CAs.BUTTON_5=4,CAs.BUTTON_6=5,CAs.BUTTON_7=6,CAs.BUTTON_8=7;function YAs(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null;}r.extend(YAs,cc.Event),(t=YAs.prototype).getEventCode=function(){return this._eventCode;},t.getTouches=function(){return this._touches;},t._setEventCode=function(t){this._eventCode=t;},t._setTouches=function(t){this._touches=t;},t.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e);},t.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2();},t.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2();},t.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2();},t.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2();},t.getID=function(){return this.touch?this.touch.getID():null;},t.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2();},t.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0;},t.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0;},t.getLocationX=function(){return this.touch?this.touch.getLocationX():0;},t.getLocationY=function(){return this.touch?this.touch.getLocationY():0;},YAs.MAX_TOUCHES=5,YAs.BEGAN=0,YAs.MOVED=1,YAs.ENDED=2,YAs.CANCELED=3;function IAs(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t;}r.extend(IAs,cc.Event);function yAs(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e;}r.extend(yAs,cc.Event),cc.Event.EventMouse=CAs,cc.Event.EventTouch=YAs,cc.Event.EventAcceleration=IAs,cc.Event.EventKeyboard=yAs,e.exports=cc.Event;},{"../event/event":116}],110:[function(t,e,r){"use strict";t=t("../platform/js");cc.EventListener=function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0;},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(t){this._paused=t;},_isPaused:function(){return this._paused;},_setRegistered:function(t){this._registered=t;},_isRegistered:function(){return this._registered;},_getType:function(){return this._type;},_getListenerID:function(){return this._listenerID;},_setFixedPriority:function(t){this._fixedPriority=t;},_getFixedPriority:function(){return this._fixedPriority;},_setSceneGraphPriority:function(t){this._target=t,this._node=t;},_getSceneGraphPriority:function(){return this._node;},checkAvailable:function(){return null!==this._onEvent;},clone:function(){return null;},setEnabled:function(t){this._isEnabled=t;},isEnabled:function(){return this._isEnabled;},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8;var i=cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};function ODs(t,e){this._onCustomEvent=e,cc.EventListener.call(this,cc.EventListener.CUSTOM,t,this._callback);}t.extend(ODs,cc.EventListener),t.mixin(ODs.prototype,{_onCustomEvent:null,_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t);},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent;},clone:function(){return new ODs(this._listenerID,this._onCustomEvent);}});function UDs(){cc.EventListener.call(this,cc.EventListener.MOUSE,i.MOUSE,this._callback);}t.extend(UDs,cc.EventListener),t.mixin(UDs.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t);}},clone:function(){var t=new UDs();return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t;},checkAvailable:function(){return!0;}});function pDs(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,i.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[];}t.extend(pDs,cc.EventListener),t.mixin(pDs.prototype,{constructor:pDs,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(t){this.swallowTouches=t;},isSwallowTouches:function(){return this.swallowTouches;},clone:function(){var t=new pDs();return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t;},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1);}});function _Ds(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,i.TOUCH_ALL_AT_ONCE,null);}t.extend(_Ds,cc.EventListener),t.mixin(_Ds.prototype,{constructor:_Ds,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var t=new _Ds();return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t;},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1);}});function RDs(t){this._onAccelerationEvent=t,cc.EventListener.call(this,cc.EventListener.ACCELERATION,i.ACCELERATION,this._callback);}t.extend(RDs,cc.EventListener),t.mixin(RDs.prototype,{constructor:RDs,_onAccelerationEvent:null,_callback:function(t){this._onAccelerationEvent(t.acc,t);},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0;},clone:function(){return new RDs(this._onAccelerationEvent);}});function qDs(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,i.KEYBOARD,this._callback);}t.extend(qDs,cc.EventListener),t.mixin(qDs.prototype,{constructor:qDs,onKeyPressed:null,onKeyReleased:null,_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t);},clone:function(){var t=new qDs();return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t;},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1);}}),cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e=t.event;delete t.event;var i=null;for(var r in e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new pDs():e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new _Ds():e===cc.EventListener.MOUSE?i=new UDs():e===cc.EventListener.CUSTOM?(i=new ODs(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new qDs():e===cc.EventListener.ACCELERATION&&(i=new RDs(t.callback),delete t.callback),t)i[r]=t[r];return i;},e.exports=cc.EventListener;},{"../platform/js":209}],111:[function(t,e,i){"use strict";var r=t("../platform/js");t("./CCEventListener");var h=cc.EventListener.ListenerID;function nDs(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0;}var l={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!(nDs.prototype={constructor:nDs,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length;},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length;},push:function(t){(0===t._getFixedPriority()?this._sceneGraphListeners:this._fixedListeners).push(t);},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0;},clearFixedListeners:function(){this._fixedListeners.length=0;},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0;},getFixedPriorityListeners:function(){return this._fixedListeners;},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners;}}),_currentTouch:null,_currentTouchListener:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){var e=this._nodeListenersMap[t._id];if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=e[i]._getListenerID();null==this._dirtyListeners[n]&&(this._dirtyListeners[n]=!0);}if(0<t.childrenCount){var a=t._children;for(var o=0,s=a.length;o<s;o++)this._setDirtyForNode(a[o]);}},pauseTarget:function(t,e){if(t instanceof cc._BaseNode){var i,r,n=this._nodeListenersMap[t._id];if(n)for(i=0,r=n.length;i<r;i++)n[i]._setPaused(!0);if(!0===e){var a=t._children;for(i=0,r=a?a.length:0;i<r;i++)this.pauseTarget(a[i],!0);}}else cc.warnID(3506);},resumeTarget:function(t,e){if(t instanceof cc._BaseNode){var i,r,n=this._nodeListenersMap[t._id];if(n)for(i=0,r=n.length;i<r;i++)n[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e){var a=t._children;for(i=0,r=a?a.length:0;i<r;i++)this.resumeTarget(a[i],!0);}}else cc.warnID(3506);},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t);},_forceAddEventListener:function(t){var e=t._getListenerID();var i=this._listenersMap[e];i||(i=new nDs(),this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),null===(i=t._getSceneGraphPriority())&&cc.logID(3507),this._associateNodeAndEventListener(i,t),i.activeInHierarchy&&this.resumeTarget(i)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY);},_getListeners:function(t){return this._listenersMap[t];},_updateDirtyFlagForSceneGraph:function(){for(var t in this._dirtyListeners)this._setDirty(t,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={};},_removeAllListenersInVector:function(t){var e;if(t)for(var i=t.length-1;0<=i;i--)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(t,i);},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];var r,n;i&&(r=i.getFixedPriorityListeners(),n=i.getSceneGraphPriorityListeners(),this._removeAllListenersInVector(n),this._removeAllListenersInVector(r),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t]));var a,o=this._toAddedListeners;for(e=o.length-1;0<=e;e--)(a=o[e])&&a._getListenerID()===t&&cc.js.array.removeAt(o,e);},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;(e=i[t]?i[t]:e)!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(t));},_sortListenersOfSceneGraphPriority:function(t){t=this._getListeners(t);var e;!t||(e=t.getSceneGraphPriorityListeners())&&0!==e.length&&t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes);},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();if(!(e&&r&&r._activeInHierarchy&&null!==r._parent))return-1;if(!t||!i||!i._activeInHierarchy||null===i._parent)return 1;var n=i,a=r,o=!1;for(;n._parent._id!==a._parent._id;)n=null===n._parent._parent?(o=!0,r):n._parent,a=null===a._parent._parent?(o=!0,i):a._parent;if(n._id===a._id){if(n._id===r._id)return-1;if(n._id===i._id)return 1;}return o?n._localZOrder-a._localZOrder:a._localZOrder-n._localZOrder;},_sortListenersOfFixedPriority:function(t){t=this._listenersMap[t];if(t){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);var i=0;for(var r=e.length;i<r&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i;}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority();},_onUpdateListeners:function(t){var e=t.getFixedPriorityListeners();var i=t.getSceneGraphPriorityListeners();var r,n,a,o=this._toRemovedListeners;if(i)for(r=i.length-1;0<=r;r--)(n=i[r])._isRegistered()||(cc.js.array.removeAt(i,r),-1!==(a=o.indexOf(n))&&o.splice(a,1));if(e)for(r=e.length-1;0<=r;r--)(n=e[r])._isRegistered()||(cc.js.array.removeAt(e,r),-1!==(a=o.indexOf(n))&&o.splice(a,1));i&&0===i.length&&t.clearSceneGraphListeners(),e&&0===e.length&&t.clearFixedListeners();},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var r=this._toAddedListeners;if(0!==r.length){for(var n=0,a=r.length;n<a;n++)this._forceAddEventListener(r[n]);r.length=0;}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners();},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(0<e,3508),!(1<e)){var i;(i=this._listenersMap[h.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(i),(i=this._listenersMap[h.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(i),cc.assertID(1===e,3509);var r=this._toAddedListeners;if(0!==r.length){for(var n=0,a=r.length;n<a;n++)this._forceAddEventListener(r[n]);this._toAddedListeners.length=0;}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners();}},_cleanToRemovedListeners:function(){var t=this._toRemovedListeners;for(var e=0;e<t.length;e++){var i=t[e];var r=this._listenersMap[i._getListenerID()];var n,a;r&&(a=r.getFixedPriorityListeners(),(r=r.getSceneGraphPriorityListeners())&&-1!==(n=r.indexOf(i))&&r.splice(n,1),a&&-1!==(n=a.indexOf(i))&&a.splice(n,1));}t.length=0;},_onTouchEventCallback:function(t,e){if(!t._isRegistered())return!1;var i=e.event,r=i.currentTouch;i.currentTarget=t._node;var n,a=!1;var o=i.getEventCode(),s=cc.Event.EventTouch;if(o===s.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch){var c=l._currentTouchListener._node;if(c&&c.activeInHierarchy)return!1;}t.onTouchBegan&&(a=t.onTouchBegan(r,i))&&t._registered&&(t._claimedTouches.push(r),l._currentTouchListener=t,l._currentTouch=r);}else if(0<t._claimedTouches.length&&-1!==(n=t._claimedTouches.indexOf(r))){if(a=!0,!cc.macro.ENABLE_MULTI_TOUCH&&l._currentTouch&&l._currentTouch!==r)return!1;o===s.MOVED&&t.onTouchMoved?t.onTouchMoved(r,i):o===s.ENDED?(t.onTouchEnded&&t.onTouchEnded(r,i),t._registered&&t._claimedTouches.splice(n,1),l._clearCurTouch()):o===s.CANCELED&&(t.onTouchCancelled&&t.onTouchCancelled(r,i),t._registered&&t._claimedTouches.splice(n,1),l._clearCurTouch());}return i.isStopped()?(l._updateTouchListeners(i),!0):!(!a||!t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(r,1),!0);},_dispatchTouchEvent:function(t){this._sortEventListeners(h.TOUCH_ONE_BY_ONE),this._sortEventListeners(h.TOUCH_ALL_AT_ONCE);var e=this._getListeners(h.TOUCH_ONE_BY_ONE);var i=this._getListeners(h.TOUCH_ALL_AT_ONCE);if(null!==e||null!==i){var r=t.getTouches(),n=cc.js.array.copy(r);var a={event:t,needsMutableSet:e&&i,touches:n,selTouch:null};if(e)for(var o=0;o<r.length;o++)t.currentTouch=r[o],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,a);i&&0<n.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:n}),t.isStopped())||this._updateTouchListeners(t);}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,r=e.event,e=e.touches,n=r.getEventCode();return r.currentTarget=t._node,n===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(e,r):n===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(e,r):n===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(e,r):n===i.CANCELED&&t.onTouchesCancelled&&t.onTouchesCancelled(e,r),!!r.isStopped()&&(l._updateTouchListeners(r),!0);},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i||(this._nodeListenersMap[t._id]=i=[]),i.push(e);},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t._id];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t._id]);},_dispatchEventToListeners:function(t,e,i){var r=!1;var n=t.getFixedPriorityListeners();var a=t.getSceneGraphPriorityListeners();var o,s,c=0;if(n&&0!==n.length)for(;c<t.gt0Index;++c)if((s=n[c]).isEnabled()&&!s._isPaused()&&s._isRegistered()&&e(s,i)){r=!0;break;}if(a&&!r)for(o=0;o<a.length;o++)if((s=a[o]).isEnabled()&&!s._isPaused()&&s._isRegistered()&&e(s,i)){r=!0;break;}if(n&&!r)for(;c<n.length;++c)if((s=n[c]).isEnabled()&&!s._isPaused()&&s._isRegistered()&&e(s,i)){r=!0;break;}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t];},_sortNumberAsc:function(t,e){return t-e;},hasEventListener:function(t){return!!this._getListeners(t);},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505);}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t);}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t;}}else cc.warnID(3506);},addCustomListener:function(t,e){t=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:t,callback:e});return this.addListener(t,1),t;},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var r in i){var n=i[r];var a=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(o,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(a,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),n.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[r]),e)break;}if(!e){var s=this._toAddedListeners;for(var c=s.length-1;0<=c;c--){var l=s[c];if(l===t){cc.js.array.removeAt(s,c),l._setRegistered(!1);break;}}}this._currentTouchListener===t&&this._clearCurTouch();}},_clearCurTouch:function(){this._currentTouchListener=null,this._currentTouch=null;},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=t.length-1;0<=i;i--){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0;}return!1;},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=t.length-1;0<=i;i--){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(t,i):this._toRemovedListeners.push(r),!0;}return!1;},removeListeners:function(t,e){var i=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode){if(void 0!==t._id){var r,n=i._nodeListenersMap[t._id];if(n){var a=cc.js.array.copy(n);for(r=0;r<a.length;r++)i.removeListener(a[r]);delete i._nodeListenersMap[t._id];}var o=i._toAddedListeners;for(r=0;r<o.length;){var s=o[r];s._getSceneGraphPriority()===t?(s._setSceneGraphPriority(null),s._setRegistered(!1),o.splice(r,1)):++r;}if(!0===e){var c,l=t.children;for(r=0,c=l.length;r<c;r++)i.removeListeners(l[r],!0);}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(h.TOUCH_ONE_BY_ONE):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(h.TOUCH_ALL_AT_ONCE):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(h.MOUSE):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(h.ACCELERATION):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(h.KEYBOARD):cc.logID(3501);}else cc.warnID(3506);},removeCustomListeners:function(t){this._removeListenersForListenerID(t);},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i);},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var r in i){r=i[r].getFixedPriorityListeners();if(r)if(-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)));}}},setEnabled:function(t){this._isEnabled=t;},isEnabled:function(){return this._isEnabled;},dispatchEvent:function(t){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,t&&t.getType){if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;e=t,i=cc.Event;e=(e=e.type)===i.ACCELERATION?h.ACCELERATION:e===i.KEYBOARD?h.KEYBOARD:e.startsWith(i.MOUSE)?h.MOUSE:(e.startsWith(i.TOUCH)&&cc.logID(2e3),"");var e;this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--;}else cc.errorID(3511);},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped();},dispatchCustomEvent:function(t,e){t=new cc.Event.EventCustom(t);t.setUserData(e),this.dispatchEvent(t);}};r.get(cc,"eventManager",function(){return cc.errorID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),l;}),e.exports=cc.internal.eventManager=l;},{"../platform/js":209,"./CCEventListener":110}],112:[function(t,e,i){"use strict";cc.Touch=function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e);},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y);},getLocationX:function(){return this._point.x;},getLocationY:function(){return this._point.y;},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y);},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y);},getDelta:function(){return this._point.sub(this._prevPoint);},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y);},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y);},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y);},getID:function(){return this._id;},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.v2(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0);},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e);},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.v2(t.x,t.y):cc.v2(t||0,e||0);}};},{}],113:[function(t,e,i){"use strict";t("./CCEvent"),t("./CCTouch"),t("./CCEventListener");t=t("./CCEventManager");e.exports=t;},{"./CCEvent":109,"./CCEventListener":110,"./CCEventManager":111,"./CCTouch":112}],114:[function(t,e,i){"use strict";var r=cc.js;var n=t("../platform/callbacks-invoker");function EventListeners(){n.call(this);}r.extend(EventListeners,n),EventListeners.prototype.emit=function(t,e){var i=t.type;i=this._callbackTable[i];if(i){var r=!i.isInvoking;i.isInvoking=!0;var n=i.callbackInfos;for(var a=0,o=n.length;a<o;++a){var s=n[a];if(s&&s.callback&&(s.callback.call(s.target,t,e),t._propagationImmediateStopped))break;}r&&(i.isInvoking=!1,i.containCanceled&&i.purgeCanceled());}},e.exports=EventListeners;},{"../platform/callbacks-invoker":202}],115:[function(t,e,i){"use strict";var r=t("../platform/js");var n=t("../platform/callbacks-invoker");var o=r.array.fastRemove;function EventTarget(){n.call(this);}r.extend(EventTarget,n);t=EventTarget.prototype;t.__on=t.on,t.on=function(t,e,i,r){if(e)return this.hasEventListener(t,e,i)||(this.__on(t,e,i,r),i&&i.__eventTargets&&i.__eventTargets.push(this)),e;cc.errorID(6800);},t.__off=t.off,t.off=function(t,e,i){if(e)this.__off(t,e,i),i&&i.__eventTargets&&o(i.__eventTargets,this);else{e=this._callbackTable[t];if(e){var r=e.callbackInfos;for(var n=0;n<r.length;++n){var a=r[n]&&r[n].target;a&&a.__eventTargets&&o(a.__eventTargets,this);}this.removeAll(t);}}},t.targetOff=function(t){this.removeAll(t),t&&t.__eventTargets&&o(t.__eventTargets,this);},t.once=function(t,e,i){this.on(t,e,i,!0);},t.dispatchEvent=function(t){this.emit(t.type,t);},cc.EventTarget=e.exports=EventTarget;},{"../platform/callbacks-invoker":202,"../platform/js":209}],116:[function(t,e,i){"use strict";t=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1;},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1;},reuse:function(t,e){this.type=t,this.bubbles=e||!1;},stopPropagation:function(){this._propagationStopped=!0;},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0;},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped;},getCurrentTarget:function(){return this.currentTarget;},getType:function(){return this.type;}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;function NBs(t,e){cc.Event.call(this,t,e),this.detail=null;}t.extend(NBs,cc.Event),(NBs.prototype.reset=NBs).prototype.setUserData=function(t){this.detail=t;},NBs.prototype.getUserData=function(){return this.detail;},NBs.prototype.getEventName=cc.Event.prototype.getType;var r=new t.Pool(10);NBs.put=function(t){r.put(t);},NBs.get=function(t,e){var i=r._get();return i?i.reset(t,e):i=new NBs(t,e),i;},cc.Event.EventCustom=NBs,e.exports=cc.Event;},{"../platform/js":209}],117:[function(t,e,i){"use strict";t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event");},{"./event":116,"./event-listeners":114,"./event-target":115,"./system-event":118}],118:[function(t,e,i){"use strict";var r=t("../event/event-target");var n=t("../event-manager");var a=t("../platform/CCInputManager");var o=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"});var s=null;var c=null;t=cc.Class({name:"SystemEvent",extends:r,statics:{EventType:o},setAccelerometerEnabled:function(t){t&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(t){console.log("Device Motion Event request permission: "+t),a.setAccelerometerEnabled("granted"===t);}):a.setAccelerometerEnabled(t);},setAccelerometerInterval:function(t){a.setAccelerometerInterval(t);},on:function(t,e,i,r){this._super(t,e,i,r),t!==o.KEY_DOWN&&t!==o.KEY_UP||(s=s||cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=o.KEY_DOWN,cc.systemEvent.dispatchEvent(e);},onKeyReleased:function(t,e){e.type=o.KEY_UP,cc.systemEvent.dispatchEvent(e);}}),n.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||n.addListener(s,1)),t===o.DEVICEMOTION&&(c=c||cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=o.DEVICEMOTION,cc.systemEvent.dispatchEvent(e);}}),n.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||n.addListener(c,1));},off:function(t,e,i){this._super(t,e,i),!s||t!==o.KEY_DOWN&&t!==o.KEY_UP||(e=this.hasEventListener(o.KEY_DOWN),i=this.hasEventListener(o.KEY_UP),e||i||n.removeListener(s)),c&&t===o.DEVICEMOTION&&n.removeListener(c);}});cc.SystemEvent=e.exports=t,cc.systemEvent=new cc.SystemEvent();},{"../event-manager":113,"../event/event-target":115,"../platform/CCInputManager":193}],119:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=_interopRequireDefault(t("../value-types/vec3"));var r=_interopRequireDefault(t("../value-types/mat3"));var o=_interopRequireDefault(t("./enums"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var n=new s.default();var a=new s.default();var c=new r.default();function aabb(t,e,i,r,n,a){this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=o.default.SHAPE_AABB,this.center=new s.default(t,e,i),this.halfExtents=new s.default(r,n,a);}aabb.create=function(t,e,i,r,n,a){return new aabb(t,e,i,r,n,a);},aabb.clone=function(t){return new aabb(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z);},aabb.copy=function(t,e){return s.default.copy(t.center,e.center),s.default.copy(t.halfExtents,e.halfExtents),t;},aabb.fromPoints=function(t,e,i){return s.default.scale(t.center,s.default.add(n,e,i),.5),s.default.scale(t.halfExtents,s.default.sub(a,i,e),.5),t;},aabb.set=function(t,e,i,r,n,a,o){return s.default.set(t.center,e,i,r),s.default.set(t.halfExtents,n,a,o),t;},(t=aabb.prototype).getBoundary=function(t,e){s.default.sub(t,this.center,this.halfExtents),s.default.add(e,this.center,this.halfExtents);},t.transform=function(t,e,i,r,n){var a,o;s.default.transformMat4((n=n||this).center,this.center,t),n=n.halfExtents,a=this.halfExtents,t=t,o=c.m,t=t.m,o[0]=Math.abs(t[0]),o[1]=Math.abs(t[1]),o[2]=Math.abs(t[2]),o[3]=Math.abs(t[4]),o[4]=Math.abs(t[5]),o[5]=Math.abs(t[6]),o[6]=Math.abs(t[8]),o[7]=Math.abs(t[9]),o[8]=Math.abs(t[10]),s.default.transformMat3(n,a,c);},i.default=aabb,e.exports=i.default;},{"../value-types/mat3":280,"../value-types/vec3":289,"./enums":121}],120:[function(e,i,t){"use strict";t.__esModule=!0,t.point_plane=point_plane,t.pt_point_plane=function(t,e,i){var r=point_plane(e,i);return o.Vec3.subtract(t,e,o.Vec3.multiplyScalar(t,i.n,r));},t.pt_point_aabb=function(t,e,i){return o.Vec3.copy(t,e),o.Vec3.subtract(r,i.center,i.halfExtents),o.Vec3.add(n,i.center,i.halfExtents),t.x=(t.x<r.x?r:t).x,t.y=(t.y<r.x?r:t).y,t.z=(t.z<r.x?r:t).z,t.x=(t.x>n.x?n:t).x,t.y=(t.y>n.x?n:t).y,t.z=(t.z>n.x?n:t).z,t;},t.pt_point_obb=function(t,e,i){var r=i.orientation.m;o.Vec3.set(s,r[0],r[1],r[2]),o.Vec3.set(c,r[3],r[4],r[5]),o.Vec3.set(l,r[6],r[7],r[8]),u[0]=s,u[1]=c,u[2]=l,_[0]=i.halfExtents.x,_[1]=i.halfExtents.y,_[2]=i.halfExtents.z,o.Vec3.subtract(h,e,i.center),o.Vec3.set(t,i.center.x,i.center.y,i.center.z);for(var n=0;n<3;n++){var a=o.Vec3.dot(h,u[n]);(a=a>_[n]?_[n]:a)<-_[n]&&(a=-_[n]),t.x+=a*u[n].x,t.y+=a*u[n].y,t.z+=a*u[n].z;}return t;};var o=e("../value-types");var s=new o.Vec3();var c=new o.Vec3();var l=new o.Vec3();var h=new o.Vec3();var r=new o.Vec3();var n=new o.Vec3();var u=new Array(3);var _=new Array(3);function point_plane(t,e){return o.Vec3.dot(e.n,t)-e.d;}},{"../value-types":279}],121:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;i.default={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256},e.exports=i.default;},{}],122:[function(t,r,e){"use strict";e.__esModule=!0,e.frustum=void 0;var o=t("../value-types");var s=_interopRequireDefault(t("./enums"));var c=_interopRequireDefault(t("./plane"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}var l=new Array(8);l[0]=new o.Vec3(1,1,1),l[1]=new o.Vec3(-1,1,1),l[2]=new o.Vec3(-1,-1,1),l[3]=new o.Vec3(1,-1,1),l[4]=new o.Vec3(1,1,-1),l[5]=new o.Vec3(-1,1,-1),l[6]=new o.Vec3(-1,-1,-1),l[7]=new o.Vec3(1,-1,-1);frustum.create=function(){return new frustum();},frustum.clone=function(t){return frustum.copy(new frustum(),t);},frustum.copy=function(t,e){t._type=e._type;for(var i=0;i<6;++i)c.default.copy(t.planes[i],e.planes[i]);for(var r=0;r<8;++r)o.Vec3.copy(t.vertices[r],e.vertices[r]);return t;},t=frustum,(i=[{key:"accurate",set:function(t){this._type=t?s.default.SHAPE_FRUSTUM_ACCURATE:s.default.SHAPE_FRUSTUM;}}])&&_defineProperties(t.prototype,i),n&&_defineProperties(t,n),(i=frustum.prototype).update=function(t,e){t=t.m;if(o.Vec3.set(this.planes[0].n,t[3]+t[0],t[7]+t[4],t[11]+t[8]),this.planes[0].d=-(t[15]+t[12]),o.Vec3.set(this.planes[1].n,t[3]-t[0],t[7]-t[4],t[11]-t[8]),this.planes[1].d=-(t[15]-t[12]),o.Vec3.set(this.planes[2].n,t[3]+t[1],t[7]+t[5],t[11]+t[9]),this.planes[2].d=-(t[15]+t[13]),o.Vec3.set(this.planes[3].n,t[3]-t[1],t[7]-t[5],t[11]-t[9]),this.planes[3].d=-(t[15]-t[13]),o.Vec3.set(this.planes[4].n,t[3]+t[2],t[7]+t[6],t[11]+t[10]),this.planes[4].d=-(t[15]+t[14]),o.Vec3.set(this.planes[5].n,t[3]-t[2],t[7]-t[6],t[11]-t[10]),this.planes[5].d=-(t[15]-t[14]),this._type===s.default.SHAPE_FRUSTUM_ACCURATE){for(var i=0;i<6;i++){var r=this.planes[i];var n=1/r.n.length();o.Vec3.multiplyScalar(r.n,r.n,n),r.d*=n;}for(var a=0;a<8;a++)o.Vec3.transformMat4(this.vertices[a],l[a],e);}},i.transform=function(t){if(this._type===s.default.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)o.Vec3.transformMat4(this.vertices[e],this.vertices[e],t);c.default.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),c.default.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),c.default.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),c.default.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),c.default.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),c.default.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5]);}};t=frustum;function frustum(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=s.default.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=c.default.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new o.Vec3();}var n,i;var h;(e.frustum=t).createOrtho=(h=new o.Vec3(),function(t,e,i,r,n,a){e/=2;i/=2;o.Vec3.set(h,e,i,r),o.Vec3.transformMat4(t.vertices[0],h,a),o.Vec3.set(h,-e,i,r),o.Vec3.transformMat4(t.vertices[1],h,a),o.Vec3.set(h,-e,-i,r),o.Vec3.transformMat4(t.vertices[2],h,a),o.Vec3.set(h,e,-i,r),o.Vec3.transformMat4(t.vertices[3],h,a),o.Vec3.set(h,e,i,n),o.Vec3.transformMat4(t.vertices[4],h,a),o.Vec3.set(h,-e,i,n),o.Vec3.transformMat4(t.vertices[5],h,a),o.Vec3.set(h,-e,-i,n),o.Vec3.transformMat4(t.vertices[6],h,a),o.Vec3.set(h,e,-i,n),o.Vec3.transformMat4(t.vertices[7],h,a),c.default.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),c.default.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),c.default.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),c.default.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),c.default.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),c.default.fromPoints(t.planes[0],t.vertices[7],t.vertices[5],t.vertices[6]);});},{"../value-types":279,"./enums":121,"./plane":127}],123:[function(t,e,i){"use strict";var r={enums:i.__esModule=!0,Triangle:!0,Aabb:!0,Ray:!0,intersect:!0,Sphere:!0,Obb:!0,Frustum:!0,Line:!0,Plane:!0};i.Plane=i.Line=i.Frustum=i.Obb=i.Sphere=i.intersect=i.Ray=i.Aabb=i.Triangle=i.enums=void 0;var n=_interopRequireDefault(t("./enums"));i.enums=n.default;n=_interopRequireDefault(t("./triangle"));i.Triangle=n.default;n=_interopRequireDefault(t("./aabb"));i.Aabb=n.default;n=_interopRequireDefault(t("./ray"));i.Ray=n.default;n=_interopRequireDefault(t("./intersect"));i.intersect=n.default;n=_interopRequireDefault(t("./sphere"));i.Sphere=n.default;n=_interopRequireDefault(t("./obb"));i.Obb=n.default;n=_interopRequireDefault(t("./frustum"));i.Frustum=n.default;n=_interopRequireDefault(t("./line"));i.Line=n.default;n=_interopRequireDefault(t("./plane"));i.Plane=n.default;var a=t("./distance");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(r,t)||(i[t]=a[t]));}),cc.geomUtils=e.exports;},{"./aabb":119,"./distance":120,"./enums":121,"./frustum":122,"./intersect":124,"./line":125,"./obb":126,"./plane":127,"./ray":128,"./sphere":129,"./triangle":130}],124:[function(t,r,n){"use strict";n.__esModule=!0,n.default=void 0;var _=_interopRequireDefault(t("../../renderer/gfx"));var e=_interopRequireDefault(t("../../renderer/memop/recycle-pool"));var f=t("../value-types");var l=_interopRequireDefault(t("./aabb"));var a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var i={};var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t){var a;Object.prototype.hasOwnProperty.call(t,n)&&((a=r?Object.getOwnPropertyDescriptor(t,n):null)&&(a.get||a.set)?Object.defineProperty(i,n,a):i[n]=t[n]);}return i.default=t,e&&e.set(t,i),i;}(t("./distance"));var i=_interopRequireDefault(t("./enums"));var d=_interopRequireDefault(t("./ray"));t=_interopRequireDefault(t("./triangle"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap();return _getRequireWildcardCache=function(){return t;},t;}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function getVec3(t,e,i,r){f.Vec3.set(t,e[i*r],e[i*r+1],e[i*r+2]);}var h,u;h=t.default.create(),u=1/0;function xYs(t,e){u=1/0;var i=e._subMeshes;for(var r=0;r<i.length;r++)if(i[r]._primitiveType===_.default.PT_TRIANGLES){var n=e._subDatas[r]||e._subDatas[0];var a=e._getAttrMeshData(r,_.default.ATTR_POSITION);var o=n.getIData(Uint16Array);var s=n.vfm.element(_.default.ATTR_POSITION).num;for(var c=0;c<o.length;c+=3){getVec3(h.a,a,o[c],s),getVec3(h.b,a,o[c+1],s),getVec3(h.c,a,o[c+2],s);var l=A(t,h);0<l&&l<u&&(u=l);}}return u;}function cmp(t,e){return t.distance-e.distance;}function transformMat4Normal(t,e,i){i=i.m;var r=e.x,n=e.y,e=e.z,a=i[3]*r+i[7]*n+i[11]*e;return t.x=(i[0]*r+i[4]*n+i[8]*e)*(a=a?1/a:1),t.y=(i[1]*r+i[5]*n+i[9]*e)*a,t.z=(i[2]*r+i[6]*n+i[10]*e)*a,t;}function distanceValid(t){return 0<t&&t<1/0;}var p,o,m,v,y,s,g,b,c;p=new e.default(function(){return{distance:0,node:null};},1),o=[],m=l.default.create(),v=new f.Vec3(),y=new f.Vec3(),s=new d.default(),g=cc.mat4(),b=cc.mat4(),c=new f.Vec3();function lYs(t,r,n,a){return p.reset(),o.length=0,function traversal(t,e){var i=t.children;for(var r=i.length-1;0<=r;r--)traversal(i[r],e);e(t);}(t=t||cc.director.getScene(),function(t){var e,i;a&&!a(t)||(f.Mat4.invert(b,t.getWorldMatrix(g)),f.Vec3.transformMat4(s.o,r.o,b),f.Vec3.normalize(s.d,transformMat4Normal(s.d,r.d,b)),e=1/0,(i=t._renderComponent)instanceof cc.MeshRenderer?e=W(s,i._boundingBox):t.width&&t.height&&(f.Vec3.set(v,-t.width*t.anchorX,-t.height*t.anchorY,t.z),f.Vec3.set(y,t.width*(1-t.anchorX),t.height*(1-t.anchorY),t.z),l.default.fromPoints(m,v,y),e=W(s,m)),distanceValid(e)&&distanceValid(e=n?n(s,t,e):e)&&(f.Vec3.scale(c,s.d,e),transformMat4Normal(c,c,g),(i=p.add()).node=t,i.distance=f.Vec3.mag(c),o.push(i)));}),o.sort(cmp),o;}function uYs(t,e){var i=f.Vec3.dot(t.d,e.n);return Math.abs(i)<Number.EPSILON?0:(f.Vec3.multiplyScalar(C,e.n,e.d),(t=f.Vec3.dot(f.Vec3.subtract(C,C,t.o),e.n)/i)<0?0:t);}C=new f.Vec3(0,0,0);var C;function EYs(t,e){return f.Vec3.subtract(x,t.e,t.s),(t=(e.d-f.Vec3.dot(t.s,e.n))/f.Vec3.dot(x,e.n))<0||1<t?0:t;}x=new f.Vec3(0,0,0);var x;S=new f.Vec3(0,0,0),T=new f.Vec3(0,0,0),w=new f.Vec3(0,0,0),E=new f.Vec3(0,0,0),P=new f.Vec3(0,0,0);var A=function(t,e,i){f.Vec3.subtract(S,e.b,e.a),f.Vec3.subtract(T,e.c,e.a),f.Vec3.cross(w,t.d,T);var r=f.Vec3.dot(S,w);if(r<Number.EPSILON&&(!i||r>-Number.EPSILON))return 0;i=1/r;f.Vec3.subtract(E,t.o,e.a);r=f.Vec3.dot(E,w)*i;if(r<0||1<r)return 0;f.Vec3.cross(P,E,S);e=f.Vec3.dot(t.d,P)*i;if(e<0||1<r+e)return 0;t=f.Vec3.dot(T,P)*i;return t<0?0:t;};var S,T,w,E,P;t=A;function pYs(t,e,i){f.Vec3.subtract(M,e.b,e.a),f.Vec3.subtract(R,e.c,e.a),f.Vec3.subtract(I,t.s,t.e),f.Vec3.cross(D,M,R);var r=f.Vec3.dot(I,D);if(r<=0)return 0;if(f.Vec3.subtract(B,t.s,e.a),(t=f.Vec3.dot(B,D))<0||r<t)return 0;if(f.Vec3.cross(L,I,B),(t=f.Vec3.dot(R,L))<0||r<t)return 0;var n=-f.Vec3.dot(M,L);return n<0||r<t+n?0:(i&&(r=1-(t*=r=1/r)-(n*=r),f.Vec3.set(i,e.a.x*r+e.b.x*t+e.c.x*n,e.a.y*r+e.b.y*t+e.c.y*n,e.a.z*r+e.b.z*t+e.c.z*n)),1);}M=new f.Vec3(0,0,0),R=new f.Vec3(0,0,0),I=new f.Vec3(0,0,0),B=new f.Vec3(0,0,0),D=new f.Vec3(0,0,0),L=new f.Vec3(0,0,0);var M,R,I,B,D,L;function _Ys(t,e,i,r,n,a,o){if(f.Vec3.subtract(V,e,t),f.Vec3.subtract(O,i,t),f.Vec3.subtract(F,r,t),f.Vec3.subtract(N,n,t),f.Vec3.cross(G,N,V),0<=(e=f.Vec3.dot(O,G))){var s=-f.Vec3.dot(F,G);if(s<0)return 0;var c=f.Vec3.dot(f.Vec3.cross(z,V,F),O);if(c<0)return 0;o&&f.Vec3.set(o,i.x*(s*=l=1/(s+e+c))+r.x*(e*=l)+n.x*(c*=l),i.y*s+r.y*e+n.y*c,i.z*s+r.z*e+n.z*c);}else{f.Vec3.subtract(k,a,t);var l=f.Vec3.dot(k,G);if(l<0)return 0;s=f.Vec3.dot(f.Vec3.cross(z,V,O),k);if(s<0)return 0;o&&(r=1/(l+(e=-e)+s),f.Vec3.set(o,i.x*(l*=r)+a.x*(e*=r)+n.x*(s*=r),i.y*l+a.y*e+n.y*s,i.z*l+a.z*e+n.z*s));}return 1;}V=new f.Vec3(0,0,0),O=new f.Vec3(0,0,0),F=new f.Vec3(0,0,0),N=new f.Vec3(0,0,0),k=new f.Vec3(0,0,0),G=new f.Vec3(0,0,0),z=new f.Vec3(0,0,0);var V,O,F,N,k,G,z;function RYs(t,e){var i=e.radius;e=e.center;var r=t.o;return t=t.d,i*=i,f.Vec3.subtract(U,e,r),e=U.lengthSqr(),r=f.Vec3.dot(U,t),(t=i-(e-r*r))<0?0:(t=Math.sqrt(t),(e=e<i?r+t:r-t)<0?0:e);}U=new f.Vec3(0,0,0);var U;H=new f.Vec3(),j=new f.Vec3();var W=function(t,e){var i=t.o,t=t.d;var r=1/t.x,n=1/t.y,t=1/t.z;f.Vec3.subtract(H,e.center,e.halfExtents),f.Vec3.add(j,e.center,e.halfExtents);e=(H.x-i.x)*r;r=(j.x-i.x)*r;var a=(H.y-i.y)*n;n=(j.y-i.y)*n;var o=(H.z-i.z)*t;i=(j.z-i.z)*t;t=Math.max(Math.max(Math.min(e,r),Math.min(a,n)),Math.min(o,i));e=Math.min(Math.min(Math.max(e,r),Math.max(a,n)),Math.max(o,i));return e<0||e<t?0:t;};var H,j;e=W;d=function(){var r;new f.Vec3();var d;new f.Vec3();var n;new f.Vec3();var a=new f.Vec3();var o=new f.Vec3();var s=new f.Vec3();var c=new f.Vec3();var l=new Array(3);var h=new Array(3);var u=new Array(3);var _=new Array(6);return function(t,e){l[0]=e.halfExtents.x,l[1]=e.halfExtents.y,l[2]=e.halfExtents.z,r=e.center,d=t.o,n=t.d;t=e.orientation.m;f.Vec3.set(a,t[0],t[1],t[2]),f.Vec3.set(o,t[3],t[4],t[5]),f.Vec3.set(s,t[6],t[7],t[8]),f.Vec3.subtract(c,r,d),h[0]=f.Vec3.dot(a,n),h[1]=f.Vec3.dot(o,n),h[2]=f.Vec3.dot(s,n),u[0]=f.Vec3.dot(a,c),u[1]=f.Vec3.dot(o,c),u[2]=f.Vec3.dot(s,c);for(var i=0;i<3;++i){if(0===h[i]){if(0<-u[i]-l[i]||-u[i]+l[i]<0)return 0;h[i]=1e-7;}_[2*i+0]=(u[i]+l[i])/h[i],_[2*i+1]=(u[i]-l[i])/h[i];}e=Math.max(Math.max(Math.min(_[0],_[1]),Math.min(_[2],_[3])),Math.min(_[4],_[5]));t=Math.min(Math.min(Math.max(_[0],_[1]),Math.max(_[2],_[3])),Math.max(_[4],_[5]));return t<0||t<e||e<0?0:e;};}();function fYs(t,e){return f.Vec3.subtract(X,t.center,t.halfExtents),f.Vec3.add(q,t.center,t.halfExtents),f.Vec3.subtract(Y,e.center,e.halfExtents),f.Vec3.add(J,e.center,e.halfExtents),X.x<=J.x&&q.x>=Y.x&&X.y<=J.y&&q.y>=Y.y&&X.z<=J.z&&q.z>=Y.z;}X=new f.Vec3(),q=new f.Vec3(),Y=new f.Vec3(),J=new f.Vec3();var X,q,Y,J;function getOBBVertices(t,e,i,r,n,a){f.Vec3.set(a[0],t.x+i.x*e.x+r.x*e.y+n.x*e.z,t.y+i.y*e.x+r.y*e.y+n.y*e.z,t.z+i.z*e.x+r.z*e.y+n.z*e.z),f.Vec3.set(a[1],t.x-i.x*e.x+r.x*e.y+n.x*e.z,t.y-i.y*e.x+r.y*e.y+n.y*e.z,t.z-i.z*e.x+r.z*e.y+n.z*e.z),f.Vec3.set(a[2],t.x+i.x*e.x-r.x*e.y+n.x*e.z,t.y+i.y*e.x-r.y*e.y+n.y*e.z,t.z+i.z*e.x-r.z*e.y+n.z*e.z),f.Vec3.set(a[3],t.x+i.x*e.x+r.x*e.y-n.x*e.z,t.y+i.y*e.x+r.y*e.y-n.y*e.z,t.z+i.z*e.x+r.z*e.y-n.z*e.z),f.Vec3.set(a[4],t.x-i.x*e.x-r.x*e.y-n.x*e.z,t.y-i.y*e.x-r.y*e.y-n.y*e.z,t.z-i.z*e.x-r.z*e.y-n.z*e.z),f.Vec3.set(a[5],t.x+i.x*e.x-r.x*e.y-n.x*e.z,t.y+i.y*e.x-r.y*e.y-n.y*e.z,t.z+i.z*e.x-r.z*e.y-n.z*e.z),f.Vec3.set(a[6],t.x-i.x*e.x+r.x*e.y-n.x*e.z,t.y-i.y*e.x+r.y*e.y-n.y*e.z,t.z-i.z*e.x+r.z*e.y-n.z*e.z),f.Vec3.set(a[7],t.x-i.x*e.x-r.x*e.y+n.x*e.z,t.y-i.y*e.x-r.y*e.y+n.y*e.z,t.z-i.z*e.x-r.z*e.y+n.z*e.z);}function getInterval(t,e){var i=f.Vec3.dot(e,t[0]),r=i;for(var n=1;n<8;++n){var a=f.Vec3.dot(e,t[n]);i=a<i?a:i,r=r<a?a:r;}return[i,r];}var Z=function(){var c=new Array(15);for(var t=0;t<15;t++)c[t]=new f.Vec3(0,0,0);var l=new Array(8);var h=new Array(8);for(var e=0;e<8;e++)l[e]=new f.Vec3(0,0,0),h[e]=new f.Vec3(0,0,0);var u=new f.Vec3();var _=new f.Vec3();return function(t,e){var i=e.orientation.m;f.Vec3.set(c[0],1,0,0),f.Vec3.set(c[1],0,1,0),f.Vec3.set(c[2],0,0,1),f.Vec3.set(c[3],i[0],i[1],i[2]),f.Vec3.set(c[4],i[3],i[4],i[5]),f.Vec3.set(c[5],i[6],i[7],i[8]);for(var r=0;r<3;++r)f.Vec3.cross(c[6+3*r],c[r],c[0]),f.Vec3.cross(c[6+3*r+1],c[r],c[1]),f.Vec3.cross(c[6+3*r+1],c[r],c[2]);var n;f.Vec3.subtract(u,t.center,t.halfExtents),f.Vec3.add(_,t.center,t.halfExtents),i=u,t=_,n=l,f.Vec3.set(n[0],i.x,t.y,t.z),f.Vec3.set(n[1],i.x,t.y,i.z),f.Vec3.set(n[2],i.x,i.y,t.z),f.Vec3.set(n[3],i.x,i.y,i.z),f.Vec3.set(n[4],t.x,t.y,t.z),f.Vec3.set(n[5],t.x,t.y,i.z),f.Vec3.set(n[6],t.x,i.y,t.z),f.Vec3.set(n[7],t.x,i.y,i.z),getOBBVertices(e.center,e.halfExtents,c[3],c[4],c[5],h);for(var a=0;a<15;++a){var o=getInterval(l,c[a]);var s=getInterval(h,c[a]);if(s[0]>o[1]||o[0]>s[1])return 0;}return 1;};}();function PYs(t,e){var i=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z);return(t=f.Vec3.dot(e.n,t.center))+i<e.d?-1:t-i>e.d?0:1;}function tYs(t,e){for(var i=0;i<e.planes.length;i++)if(-1===PYs(t,e.planes[i]))return 0;return 1;}var Q=function(){var l=new Array(8);var h=0,u=0;for(var t=0;t<l.length;t++)l[t]=new f.Vec3(0,0,0);return function(t,e){var i,r=!1;for(var n=0;n<e.planes.length;n++){if(-1===(i=PYs(t,e.planes[n])))return 0;1===i&&(r=!0);}if(!r)return 1;for(var a=0;a<e.vertices.length;a++)f.Vec3.subtract(l[a],e.vertices[a],t.center);for(var o=u=h=0;o<e.vertices.length;o++)l[o].x>t.halfExtents.x?h++:l[o].x<-t.halfExtents.x&&u++;if(h===e.vertices.length||u===e.vertices.length)return 0;for(var s=u=h=0;s<e.vertices.length;s++)l[s].y>t.halfExtents.y?h++:l[s].y<-t.halfExtents.y&&u++;if(h===e.vertices.length||u===e.vertices.length)return 0;for(var c=u=h=0;c<e.vertices.length;c++)l[c].z>t.halfExtents.z?h++:l[c].z<-t.halfExtents.z&&u++;return h===e.vertices.length||u===e.vertices.length?0:1;};}();function NYs(t,e){return f.Vec3.subtract(K,e,t.center),f.Vec3.transformMat3(K,K,f.Mat3.transpose($,t.orientation)),e=K,t=t.halfExtents,Math.abs(e.x)<t.x&&Math.abs(e.y)<t.y&&Math.abs(e.z)<t.z;}K=new f.Vec3(0,0,0),$=new f.Mat3();var K,$;var tt=function(t,e){var i=t.orientation.m;i=t.halfExtents.x*nVs(e.n,i[0],i[1],i[2])+t.halfExtents.y*nVs(e.n,i[3],i[4],i[5])+t.halfExtents.z*nVs(e.n,i[6],i[7],i[8]);t=f.Vec3.dot(e.n,t.center);return t+i<e.d?-1:t-i>e.d?0:1;};function nVs(t,e,i,r){return Math.abs(t.x*e+t.y*i+t.z*r);}function kYs(t,e){for(var i=0;i<e.planes.length;i++)if(-1===tt(t,e.planes[i]))return 0;return 1;}var et=function(){var h=new Array(8);var u=0,_=0,d=0;for(var t=0;t<h.length;t++)h[t]=new f.Vec3(0,0,0);function Obs(t,e,i,r){return t.x*e+t.y*i+t.z*r;}return function(t,e){var i,r=!1;for(var n=0;n<e.planes.length;n++){if(-1===(i=tt(t,e.planes[n])))return 0;1===i&&(r=!0);}if(!r)return 1;for(var a=0;a<e.vertices.length;a++)f.Vec3.subtract(h[a],e.vertices[a],t.center);d=_=0;var o=t.orientation.m;for(var s=0;s<e.vertices.length;s++)(u=Obs(h[s],o[0],o[1],o[2]))>t.halfExtents.x?_++:u<-t.halfExtents.x&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var c=d=_=0;c<e.vertices.length;c++)(u=Obs(h[c],o[3],o[4],o[5]))>t.halfExtents.y?_++:u<-t.halfExtents.y&&d++;if(_===e.vertices.length||d===e.vertices.length)return 0;for(var l=d=_=0;l<e.vertices.length;l++)(u=Obs(h[l],o[6],o[7],o[8]))>t.halfExtents.z?_++:u<-t.halfExtents.z&&d++;return _===e.vertices.length||d===e.vertices.length?0:1;};}();var it=function(){var c=new Array(15);for(var t=0;t<15;t++)c[t]=new f.Vec3(0,0,0);var l=new Array(8);var h=new Array(8);for(var e=0;e<8;e++)l[e]=new f.Vec3(0,0,0),h[e]=new f.Vec3(0,0,0);return function(t,e){var i=t.orientation.m;var r=e.orientation.m;f.Vec3.set(c[0],i[0],i[1],i[2]),f.Vec3.set(c[1],i[3],i[4],i[5]),f.Vec3.set(c[2],i[6],i[7],i[8]),f.Vec3.set(c[3],r[0],r[1],r[2]),f.Vec3.set(c[4],r[3],r[4],r[5]),f.Vec3.set(c[5],r[6],r[7],r[8]);for(var n=0;n<3;++n)f.Vec3.cross(c[6+3*n],c[n],c[0]),f.Vec3.cross(c[6+3*n+1],c[n],c[1]),f.Vec3.cross(c[6+3*n+1],c[n],c[2]);getOBBVertices(t.center,t.halfExtents,c[0],c[1],c[2],l),getOBBVertices(e.center,e.halfExtents,c[3],c[4],c[5],h);for(var a=0;a<15;++a){var o=getInterval(l,c[a]);var s=getInterval(h,c[a]);if(s[0]>o[1]||o[0]>s[1])return 0;}return 1;};}();function hYs(t,e){var i=f.Vec3.dot(e.n,t.center);return t=t.radius*e.n.length(),i+t<e.d?-1:i-t>e.d?0:1;}function QYs(t,e){for(var i=0;i<e.planes.length;i++)if(-1===hYs(t,e.planes[i]))return 0;return 1;}function vYs(t,e){for(var i=0;i<6;i++){var r=e.planes[i];var n=t.radius,a=t.center;var o=r.n,r=r.d;var s=f.Vec3.dot(o,a);if(s+n<r)return 0;if(!(r<s-n)){f.Vec3.add(rt,a,f.Vec3.multiplyScalar(rt,o,n));for(var c=0;c<6;c++)if(c!==i&&c!==i+nt[i]){var l=e.planes[c];if(f.Vec3.dot(l.n,rt)<l.d)return 0;}}}return 1;}rt=new f.Vec3(0,0,0),nt=[1,-1,1,-1,1,-1];var rt,nt;function zYs(t,e){var i=t.radius+e.radius;return f.Vec3.squaredDistance(t.center,e.center)<i*i;}function BYs(t,e){return a.pt_point_aabb(at,t.center,e),f.Vec3.squaredDistance(t.center,at)<t.radius*t.radius;}at=new f.Vec3();var at;function oYs(t,e){return a.pt_point_obb(ot,t.center,e),f.Vec3.squaredDistance(t.center,ot)<t.radius*t.radius;}ot=new f.Vec3();var ot;e={rayAabb:e,rayMesh:xYs,raycast:lYs,rayTriangle:t,ray_sphere:RYs,ray_aabb:W,ray_obb:d,ray_plane:uYs,ray_triangle:A,line_plane:EYs,line_triangle:pYs,line_quad:_Ys,sphere_sphere:zYs,sphere_aabb:BYs,sphere_obb:oYs,sphere_plane:hYs,sphere_frustum:QYs,sphere_frustum_accurate:vYs,aabb_aabb:fYs,aabb_obb:Z,aabb_plane:PYs,aabb_frustum:tYs,aabb_frustum_accurate:Q,obb_obb:it,obb_plane:tt,obb_frustum:kYs,obb_frustum_accurate:et,obb_point:NYs,resolve:function(t,e,i){void 0===i&&(i=null);var r=t._type,n=e._type;var a=this[r|n];return r<n?a(t,e,i):a(e,t,i);}};e[i.default.SHAPE_RAY|i.default.SHAPE_SPHERE]=RYs,e[i.default.SHAPE_RAY|i.default.SHAPE_AABB]=W,e[i.default.SHAPE_RAY|i.default.SHAPE_OBB]=d,e[i.default.SHAPE_RAY|i.default.SHAPE_PLANE]=uYs,e[i.default.SHAPE_RAY|i.default.SHAPE_TRIANGLE]=A,e[i.default.SHAPE_LINE|i.default.SHAPE_PLANE]=EYs,e[i.default.SHAPE_LINE|i.default.SHAPE_TRIANGLE]=pYs,e[i.default.SHAPE_SPHERE]=zYs,e[i.default.SHAPE_SPHERE|i.default.SHAPE_AABB]=BYs,e[i.default.SHAPE_SPHERE|i.default.SHAPE_OBB]=oYs,e[i.default.SHAPE_SPHERE|i.default.SHAPE_PLANE]=hYs,e[i.default.SHAPE_SPHERE|i.default.SHAPE_FRUSTUM]=QYs,e[i.default.SHAPE_SPHERE|i.default.SHAPE_FRUSTUM_ACCURATE]=vYs,e[i.default.SHAPE_AABB]=fYs,e[i.default.SHAPE_AABB|i.default.SHAPE_OBB]=Z,e[i.default.SHAPE_AABB|i.default.SHAPE_PLANE]=PYs,e[i.default.SHAPE_AABB|i.default.SHAPE_FRUSTUM]=tYs,e[i.default.SHAPE_AABB|i.default.SHAPE_FRUSTUM_ACCURATE]=Q,e[i.default.SHAPE_OBB]=it,e[i.default.SHAPE_OBB|i.default.SHAPE_PLANE]=tt,e[i.default.SHAPE_OBB|i.default.SHAPE_FRUSTUM]=kYs,e[i.default.SHAPE_OBB|i.default.SHAPE_FRUSTUM_ACCURATE]=et,n.default=e,r.exports=n.default;},{"../../renderer/gfx":312,"../../renderer/memop/recycle-pool":327,"../value-types":279,"./aabb":119,"./distance":120,"./enums":121,"./ray":128,"./triangle":130}],125:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("../value-types");var s=(t=t("./enums"))&&t.__esModule?t:{default:t};function line(t,e,i,r,n,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=s.default.SHAPE_LINE,this.s=new o.Vec3(t,e,i),this.e=new o.Vec3(r,n,a);}line.create=function(t,e,i,r,n,a){return new line(t,e,i,r,n,a);},line.clone=function(t){return new line(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z);},line.copy=function(t,e){return o.Vec3.copy(t.s,e.s),o.Vec3.copy(t.e,e.e),t;},line.fromPoints=function(t,e,i){return o.Vec3.copy(t.s,e),o.Vec3.copy(t.e,i),t;},line.set=function(t,e,i,r,n,a,o){return t.s.x=e,t.s.y=i,t.s.z=r,t.e.x=n,t.e.y=a,t.e.z=o,t;},line.len=function(t){return o.Vec3.distance(t.s,t.e);},line.prototype.length=function(){return o.Vec3.distance(this.s,this.e);},i.default=line,e.exports=i.default;},{"../value-types":279,"./enums":121}],126:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var m=t("../value-types");var p=(t=t("./enums"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}var o=new m.Vec3();var a=new m.Vec3();var s=new m.Mat3();obb.create=function(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f){return new obb(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f);},obb.clone=function(t){var e=t.orientation.m;return new obb(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);},obb.copy=function(t,e){return m.Vec3.copy(t.center,e.center),m.Vec3.copy(t.halfExtents,e.halfExtents),m.Mat3.copy(t.orientation,e.orientation),t;},obb.fromPoints=function(t,e,i){return m.Vec3.multiplyScalar(t.center,m.Vec3.add(o,e,i),.5),m.Vec3.multiplyScalar(t.halfExtents,m.Vec3.subtract(a,i,e),.5),m.Mat3.identity(t.orientation),t;},obb.set=function(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f,p){return m.Vec3.set(t.center,e,i,r),m.Vec3.set(t.halfExtents,n,a,o),m.Mat3.set(t.orientation,s,c,l,h,u,_,d,f,p),t;},t=obb,(n=[{key:"type",get:function(){return this._type;}}])&&_defineProperties(t.prototype,n),r&&_defineProperties(t,r),(n=obb.prototype).getBoundary=function(t,e){var i,r,n,a;i=o,r=this.halfExtents,n=this.orientation,a=s.m,n=n.m,a[0]=Math.abs(n[0]),a[1]=Math.abs(n[1]),a[2]=Math.abs(n[2]),a[3]=Math.abs(n[3]),a[4]=Math.abs(n[4]),a[5]=Math.abs(n[5]),a[6]=Math.abs(n[6]),a[7]=Math.abs(n[7]),a[8]=Math.abs(n[8]),m.Vec3.transformMat3(i,r,s),m.Vec3.subtract(t,this.center,o),m.Vec3.add(e,this.center,o);},n.transform=function(t,e,i,r,n){m.Vec3.transformMat4(n.center,this.center,t),m.Mat3.fromQuat(n.orientation,i),m.Vec3.multiply(n.halfExtents,this.halfExtents,r);},n.translateAndRotate=function(t,e,i){m.Vec3.transformMat4(i.center,this.center,t),m.Mat3.fromQuat(i.orientation,e);},n.setScale=function(t,e){m.Vec3.multiply(e.halfExtents,this.halfExtents,t);};t=obb;function obb(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=p.default.SHAPE_OBB,this.center=new m.Vec3(t,e,i),this.halfExtents=new m.Vec3(r,n,a),this.orientation=new m.Mat3(o,s,c,l,h,u,_,d,f);}var r,n;i.default=t,e.exports=i.default;},{"../value-types":279,"./enums":121}],127:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=t("../value-types");var a=(t=t("./enums"))&&t.__esModule?t:{default:t};var o=new n.Vec3(0,0,0);var s=new n.Vec3(0,0,0);var r=cc.mat4();var c=cc.v4();function plane(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=a.default.SHAPE_PLANE,this.n=new n.Vec3(t,e,i),this.d=r;}plane.create=function(t,e,i,r){return new plane(t,e,i,r);},plane.clone=function(t){return new plane(t.n.x,t.n.y,t.n.z,t.d);},plane.copy=function(t,e){return n.Vec3.copy(t.n,e.n),t.d=e.d,t;},plane.fromPoints=function(t,e,i,r){return n.Vec3.subtract(o,i,e),n.Vec3.subtract(s,r,e),n.Vec3.normalize(t.n,n.Vec3.cross(t.n,o,s)),t.d=n.Vec3.dot(t.n,e),t;},plane.set=function(t,e,i,r,n){return t.n.x=e,t.n.y=i,t.n.z=r,t.d=n,t;},plane.fromNormalAndPoint=function(t,e,i){return n.Vec3.copy(t.n,e),t.d=n.Vec3.dot(e,i),t;},plane.normalize=function(t,e){var i=e.n.len();return n.Vec3.normalize(t.n,e.n),0<i&&(t.d=e.d/i),t;},plane.prototype.transform=function(t){n.Mat4.invert(r,t),n.Mat4.transpose(r,r),n.Vec4.set(c,this.n.x,this.n.y,this.n.z,this.d),n.Vec4.transformMat4(c,c,r),n.Vec3.set(this.n,c.x,c.y,c.z),this.d=c.w;},i.default=plane,e.exports=i.default;},{"../value-types":279,"./enums":121}],128:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var o=t("../value-types");var s=(t=t("./enums"))&&t.__esModule?t:{default:t};function ray(t,e,i,r,n,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=s.default.SHAPE_RAY,this.o=new o.Vec3(t,e,i),this.d=new o.Vec3(r,n,a);}ray.create=function(t,e,i,r,n,a){return new ray(t=void 0===t?0:t,e=void 0===e?0:e,i=void 0===i?0:i,r=void 0===r?0:r,n=void 0===n?0:n,a=void 0===a?1:a);},ray.clone=function(t){return new ray(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z);},ray.copy=function(t,e){return o.Vec3.copy(t.o,e.o),o.Vec3.copy(t.d,e.d),t;},ray.fromPoints=function(t,e,i){return o.Vec3.copy(t.o,e),o.Vec3.normalize(t.d,o.Vec3.subtract(t.d,i,e)),t;},ray.set=function(t,e,i,r,n,a,o){return t.o.x=e,t.o.y=i,t.o.z=r,t.d.x=n,t.d.y=a,t.d.z=o,t;},ray.prototype.computeHit=function(t,e){o.Vec3.normalize(t,this.d),o.Vec3.scaleAndAdd(t,this.o,t,e);},i.default=ray,e.exports=i.default;},{"../value-types":279,"./enums":121}],129:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var a=t("../value-types");var n=(t=t("./enums"))&&t.__esModule?t:{default:t};var r=new a.Vec3();function sphere(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.center=void 0,this.radius=void 0,this._type=void 0,this._type=n.default.SHAPE_SPHERE,this.center=new a.Vec3(t,e,i),this.radius=r;}sphere.create=function(t,e,i,r){return new sphere(t,e,i,r);},sphere.clone=function(t){return new sphere(t.center.x,t.center.y,t.center.z,t.radius);},sphere.copy=function(t,e){return a.Vec3.copy(t.center,e.center),t.radius=e.radius,t;},sphere.fromPoints=function(t,e,i){return a.Vec3.multiplyScalar(t.center,a.Vec3.add(r,e,i),.5),t.radius=.5*a.Vec3.subtract(r,i,e).len(),t;},sphere.set=function(t,e,i,r,n){return t.center.x=e,t.center.y=i,t.center.z=r,t.radius=n,t;},(t=sphere.prototype).clone=function(){return sphere.clone(this);},t.copy=function(t){return sphere.copy(this,t);},t.getBoundary=function(t,e){a.Vec3.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),a.Vec3.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius);},t.transform=function(t,e,i,r,n){a.Vec3.transformMat4(n.center,this.center,t),n.radius=this.radius*r.maxAxis();},t.translateAndRotate=function(t,e,i){a.Vec3.transformMat4(i.center,this.center,t);},t.setScale=function(t,e){e.radius=this.radius*t.maxAxis();},i.default=sphere,e.exports=i.default;},{"../value-types":279,"./enums":121}],130:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var l=_interopRequireDefault(t("../value-types/vec3"));var h=_interopRequireDefault(t("./enums"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function triangle(t,e,i,r,n,a,o,s,c){this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this.a=new l.default(t,e,i),this.b=new l.default(r,n,a),this.c=new l.default(o,s,c),this._type=h.default.SHAPE_TRIANGLE;}triangle.create=function(t,e,i,r,n,a,o,s,c){return new triangle(t,e,i,r,n,a,o,s,c);},triangle.clone=function(t){return new triangle(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z);},triangle.copy=function(t,e){return l.default.copy(t.a,e.a),l.default.copy(t.b,e.b),l.default.copy(t.c,e.c),t;},triangle.fromPoints=function(t,e,i,r){return l.default.copy(t.a,e),l.default.copy(t.b,i),l.default.copy(t.c,r),t;},triangle.set=function(t,e,i,r,n,a,o,s,c,l){return t.a.x=e,t.a.y=i,t.a.z=r,t.b.x=n,t.b.y=a,t.b.z=o,t.c.x=s,t.c.y=c,t.c.z=l,t;},i.default=triangle,e.exports=i.default;},{"../value-types/vec3":289,"./enums":121}],131:[function(t,e,i){"use strict";var r=t("../components/CCRenderComponent");var n=t("../assets/material/CCMaterial");var a=t("./types");var o=a.LineCap;var s=a.LineJoin;var c=cc.Class({name:"cc.Graphics",extends:r,editor:!1,ctor:function(){this._impl=new c._Impl(this);},properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:s.MITER,_lineCap:o.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth;},set:function(t){this._lineWidth=t,this._impl.lineWidth=t;}},lineJoin:{get:function(){return this._lineJoin;},set:function(t){this._lineJoin=t,this._impl.lineJoin=t;},type:s},lineCap:{get:function(){return this._lineCap;},set:function(t){this._lineCap=t,this._impl.lineCap=t;},type:o},strokeColor:{get:function(){return this._strokeColor;},set:function(t){this._impl.strokeColor=this._strokeColor=cc.color(t);}},fillColor:{get:function(){return this._fillColor;},set:function(t){this._impl.fillColor=this._fillColor=cc.color(t);}},miterLimit:{get:function(){return this._miterLimit;},set:function(t){this._miterLimit=t,this._impl.miterLimit=t;}}},statics:{LineJoin:s,LineCap:o},onRestore:function(){this._impl||(this._impl=new c._Impl(this));},onDestroy:function(){this.clear(!0),this._super(),this._impl=null;},_getDefaultMaterial:function(){return n.getBuiltinMaterial("2d-base");},_updateMaterial:function(){var t=this._materials[0];t&&t.define("CC_USE_MODEL",!0);},moveTo:function(t,e){t instanceof cc.Vec2?cc.warn("[moveTo] : Can not pass Vec2 as [x, y] value, please check it."):this._impl.moveTo(t,e);},lineTo:function(t,e){t instanceof cc.Vec2?cc.warn("[moveTo] : Can not pass Vec2 as [x, y] value, please check it."):this._impl.lineTo(t,e);},bezierCurveTo:function(t,e,i,r,n,a){this._impl.bezierCurveTo(t,e,i,r,n,a);},quadraticCurveTo:function(t,e,i,r){this._impl.quadraticCurveTo(t,e,i,r);},arc:function(t,e,i,r,n,a){this._impl.arc(t,e,i,r,n,a);},ellipse:function(t,e,i,r){this._impl.ellipse(t,e,i,r);},circle:function(t,e,i){this._impl.circle(t,e,i);},rect:function(t,e,i,r){this._impl.rect(t,e,i,r);},roundRect:function(t,e,i,r,n){this._impl.roundRect(t,e,i,r,n);},fillRect:function(t,e,i,r){this.rect(t,e,i,r),this.fill();},clear:function(t){this._impl.clear(t),this._assembler&&this._assembler.clear(t);},close:function(){this._impl.close();},stroke:function(){this._assembler||this._resetAssembler(),this._assembler.stroke(this);},fill:function(){this._assembler||this._resetAssembler(),this._assembler.fill(this);}});cc.Graphics=e.exports=c,cc.Graphics.Types=a,cc.Graphics.Helper=t("undefined");},{"../assets/material/CCMaterial":53,"../components/CCRenderComponent":89,"undefined":132,"./types":134}],132:[function(t,e,i){"use strict";var b=t("./types").PointFlags;var g=Math.PI;var C=Math.min;var T=Math.max;var x=Math.cos;var A=Math.sin;var S=Math.abs;var s=Math.sign;var c=.5522847493;e.exports={arc:function(h,u,_,t,d,e,f){var i=0,r=0;var n,a,o,s;var p=0,m=0,v=0,y=0;var c,l;if(i=e-d,f=f||!1){if(S(i)>=2*g)i=2*g;else for(;i<0;)i+=2*g;}else if(S(i)>=2*g)i=2*-g;else for(;0<i;)i-=2*g;for(l=0|T(1,C(S(i)/(.5*g)+.5,5)),r=S(4/3*(1-x(e=i/l/2))/A(e)),f||(r=-r),c=0;c<=l;c++)n=u+(s=x(o=d+i*(c/l)))*t,a=_+(o=A(o))*t,o=-o*t*r,s=s*t*r,0===c?h.moveTo(n,a):h.bezierCurveTo(p+v,m+y,n-o,a-s,n,a),p=n,m=a,v=o,y=s;},ellipse:function(t,e,i,r,n){t.moveTo(e-r,i),t.bezierCurveTo(e-r,i+n*c,e-r*c,i+n,e,i+n),t.bezierCurveTo(e+r*c,i+n,e+r,i+n*c,e+r,i),t.bezierCurveTo(e+r,i-n*c,e+r*c,i-n,e,i-n),t.bezierCurveTo(e-r*c,i-n,e-r,i-n*c,e-r,i),t.close();},roundRect:function(t,e,i,r,n,a){var o;a<.1?t.rect(e,i,r,n):(o=C(a,.5*S(r))*s(r),a=C(a,.5*S(n))*s(n),t.moveTo(e,i+a),t.lineTo(e,i+n-a),t.bezierCurveTo(e,i+n-a*(1-c),e+o*(1-c),i+n,e+o,i+n),t.lineTo(e+r-o,i+n),t.bezierCurveTo(e+r-o*(1-c),i+n,e+r,i+n-a*(1-c),e+r,i+n-a),t.lineTo(e+r,i+a),t.bezierCurveTo(e+r,i+a*(1-c),e+r-o*(1-c),i,e+r-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-c),i,e,i+a*(1-c),e,i+a),t.close());},tesselateBezier:function tesselateBezier(t,e,h,i,r,n,a,o,s,u,c){var _,d,f,p,m,v,y,g;var l;10<u||(m=.5*(n+o),v=.5*(a+s),y=.5*((_=.5*(e+i))+(f=.5*(i+n))),g=.5*((d=.5*(h+r))+(p=.5*(r+a))),((l=S((i-o)*(i=s-h)-(r-s)*(r=o-e)))+(n=S((n-o)*i-(a-s)*r)))*(l+n)<t._tessTol*(r*r+i*i)?t._addPoint(o,s,0===c?c|b.PT_BEVEL:c):(tesselateBezier(t,e,h,_,d,y,g,l=.5*(y+(a=.5*(f+m))),r=.5*(g+(n=.5*(p+v))),u+1,0),tesselateBezier(t,l,r,a,n,m,v,o,s,u+1,c)));}};},{"./types":134}],133:[function(t,e,i){"use strict";t("./graphics");},{"./graphics":131}],134:[function(t,e,i){"use strict";var r=cc.Enum({BUTT:0,ROUND:1,SQUARE:2});var n=cc.Enum({BEVEL:0,ROUND:1,MITER:2});var a=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});e.exports={LineCap:r,LineJoin:n,PointFlags:a};},{}],135:[function(t,e,i){"use strict";t("./platform"),t("./assets"),t("./CCNode"),t("./CCPrivateNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./geom-utils"),t("./mesh"),t("./3d"),t("./base-ui/CCWidgetManager");},{"./3d":void 0,"./CCNode":30,"./CCPrivateNode":31,"./CCScene":32,"./assets":51,"./base-ui/CCWidgetManager":62,"./camera/CCCamera":63,"./collider":71,"./collider/CCIntersection":69,"./components":107,"./geom-utils":123,"./graphics":133,"./mesh":158,"./physics":173,"./platform":206}],136:[function(t,e,i){"use strict";var n=t("../platform/js");var r=t("./pipeline");var c=t("./loading-items");var s=t("./asset-loader");var _=t("./downloader");var d=t("./loader");var f=t("./asset-table");var u=t("../platform/utils").callInNextTick;var p=t("./auto-release-utils");var m=t("./released-asset-checker");var o=Object.create(null);o.assets=new f(),o.internal=new f();var a={url:null,raw:!1};function getResWithUrl(t){var e,i;if("object"==typeof t){if((i=t).url)return i;e=t.uuid;}else i={},e=t;return t=i.type?"uuid"===i.type:cc.AssetLibrary._uuidInSettings(e),cc.AssetLibrary._getAssetInfoInRuntime(e,a),i.url=t?a.url:e,a.url&&"uuid"===i.type&&a.raw?(i.type=null,i.isRawAsset=!0):t||(i.isRawAsset=!0),i;}var l=[];var h=[];function CCLoader(){var t=new s();var e=new _();var i=new d();r.call(this,[t,e,i]),this.assetLoader=t,this.md5Pipe=null,this.downloader=e,this.loader=i,this.onProgress=null,this._autoReleaseSetting=n.createMap(!0),this._releasedAssetChecker_DEBUG=new m();}n.extend(CCLoader,r);t=CCLoader.prototype;t.init=function(t){var e=this;t.on(cc.Director.EVENT_AFTER_UPDATE,function(){e._releasedAssetChecker_DEBUG.checkCouldRelease(e._cache);});},t.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest():new ActiveXObject("MSXML2.XMLHTTP");},t.addDownloadHandlers=function(t){this.downloader.addHandlers(t);},t.addLoadHandlers=function(t){this.loader.addHandlers(t);},t.load=function(t,e,r){void 0===r&&(r=e,e=this.onProgress||null);var n=this;var a=!1;var o;t instanceof Array||(t=t?(a=!0,[t]):[]);for(var i=l.length=0;i<t.length;++i){var s=t[i];s&&s.id&&(cc.warnID(4920,s.id),s.uuid||s.url||(s.url=s.id)),((o=getResWithUrl(s)).url||o.uuid)&&(s=this._cache[o.url],l.push(s||o));}e=c.create(this,e,function(e,i){u(function(){var t;r&&(a?(t=o.url,r.call(n,e,i.getContent(t))):r.call(n,e,i),r=null),i.destroy();});});c.initQueueDeps(e),e.append(l),l.length=0;},t.flowInDeps=function(i,t,r){for(var e=h.length=0;e<t.length;++e){var n=getResWithUrl(t[e]);var a;(n.url||n.uuid)&&((a=this._cache[n.url])?h.push(a):h.push(n));}var o=c.create(this,i?function(t,e,i){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(i);}:null,function(t,e){r(t,e),i&&i.deps&&(i.deps.length=0),e.destroy();});i&&(s=c.getQueue(i),o._ownerQueue=s._ownerQueue||s);var s=o.append(h,i);return h.length=0,s;},t._assetTables=o,t._getResUuid=function(t,e,i,r){i=o[i=i||"assets"];if(!t||!i)return null;var n=t.indexOf("?");-1!==n&&(t=t.substr(0,n));n=i.getUuid(t,e);var a;return n||(a=cc.path.extname(t))&&(t=t.slice(0,-a.length),(n=i.getUuid(t,e))&&!r&&cc.warnID(4901,t,a)),n;},t._getReferenceKey=function(t){var e;return"object"==typeof t?e=t._uuid||null:"string"==typeof t&&(e=this._getResUuid(t,null,null,!0)||t),e?(cc.AssetLibrary._getAssetInfoInRuntime(e,a),this._cache[a.url]?a.url:e):(cc.warnID(4800,t),e);},t._urlNotFound=function(e,i,r){u(function(){e=cc.url.normalize(e);var t=(i?n.getClassName(i):"Asset")+' in "resources/'+e+'" does not exist.';r&&r(new Error(t),[]);});},t._parseLoadResArgs=function(t,e,i){var r;return void 0===i&&(r=t instanceof Array||n.isChildClassOf(t,cc.RawAsset),e?(i=e,r&&(e=this.onProgress||null)):void 0!==e||r||(i=t,e=this.onProgress||null,t=null),void 0===e||r||(e=t,t=null)),{type:t,onProgress:e,onComplete:i};},t.loadRes=function(t,e,i,r,n){5!==arguments.length&&(n=r,r=i,i="assets");var a=this._parseLoadResArgs(e,r,n);e=a.type,r=a.onProgress,n=a.onComplete;var o=this;var s=o._getResUuid(t,e,i);s?this.load({type:"uuid",uuid:s},r,function(t,e){e&&o.setAutoReleaseRecursively(s,!1),n&&n(t,e);}):o._urlNotFound(t,e,n);},t._loadResUuids=function(t,e,s,c){var l,h;0<t.length?(l=this,h=t.map(function(t){return{type:"uuid",uuid:t};}),this.load(h,e,function(t,e){if(s){var i=[];var r=c&&[];for(var n=0;n<h.length;++n){var a=h[n].uuid;var o=this._getReferenceKey(a);o=e.getContent(o);o&&(l.setAutoReleaseRecursively(a,!1),i.push(o),r&&r.push(c[n]));}c?s(t,i,r):s(t,i);}})):s&&u(function(){c?s(null,[],[]):s(null,[]);});},t.loadResArray=function(t,e,i,r,n){5!==arguments.length&&(n=r,r=i,i="assets");var a=this._parseLoadResArgs(e,r,n);e=a.type,r=a.onProgress,n=a.onComplete;var o=[];var h=e instanceof Array;for(var s=0;s<t.length;s++){var c=t[s];var l=h?e[s]:e;var u=this._getResUuid(c,l,i);if(!u)return void this._urlNotFound(c,l,n);o.push(u);}this._loadResUuids(o,r,n);},t.loadResDir=function(t,e,i,r,n){var a;5!==arguments.length&&(n=r,r=i,i="assets"),o[i]&&(e=(a=this._parseLoadResArgs(e,r,n)).type,r=a.onProgress,n=a.onComplete,i=o[i].getUuidArray(t,e,a=[]),this._loadResUuids(i,r,n,a));},t.getRes=function(t,e){var i=this._cache[t];if(!i){t=this._getResUuid(t,e,null,!0);if(!t)return null;e=this._getReferenceKey(t);i=this._cache[e];}return(i=i&&i.alias?i.alias:i)&&i.complete?i.content:null;},t.getResCount=function(){return Object.keys(this._cache).length;},t.getDependsRecursively=function(t){var e;return t?(t=this._getReferenceKey(t),(e=p.getDependsRecursively(t)).push(t),e):[];},t.release=function(t){var e,i,r;if(Array.isArray(t))for(var n=0;n<t.length;n++){var a=t[n];this.release(a);}else t&&((e=this._getReferenceKey(t))&&e in cc.AssetLibrary.getBuiltinDeps()||((i=this.getItem(e))&&(r=this.removeItem(e),t=i.content,r&&this._releasedAssetChecker_DEBUG.setReleased(i,e)),t instanceof cc.Asset&&((r=t.nativeUrl)&&this.release(r),t.destroy())));},t.releaseAsset=function(t){t=t._uuid;t&&this.release(t);},t.releaseRes=function(t,e,i){e=this._getResUuid(t,e,i);e?this.release(e):cc.errorID(4914,t);},t.releaseResDir=function(t,e,i){if(o[i=i||"assets"]){var r=o[i].getUuidArray(t,e);for(var n=0;n<r.length;n++){var a=r[n];this.release(a);}}},t.releaseAll=function(){for(var t in this._cache)this.release(t);},t.removeItem=function(t){var e=r.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e;},t.setAutoRelease=function(t,e){t=this._getReferenceKey(t);t&&(this._autoReleaseSetting[t]=!!e);},t.setAutoReleaseRecursively=function(t,e){e=!!e;t=this._getReferenceKey(t);if(t){this._autoReleaseSetting[t]=e;var i=p.getDependsRecursively(t);for(var r=0;r<i.length;r++){var n=i[r];this._autoReleaseSetting[n]=e;}}},t.isAutoRelease=function(t){t=this._getReferenceKey(t);return!!t&&!!this._autoReleaseSetting[t];},cc.loader=new CCLoader(),e.exports=cc.loader;},{"../platform/js":209,"../platform/utils":213,"./asset-loader":137,"./asset-table":138,"./auto-release-utils":140,"./downloader":142,"./loader":145,"./loading-items":146,"./pipeline":149,"./released-asset-checker":150}],137:[function(t,e,i){"use strict";t("../utils/CCPath");var o=t("../CCDebug");var r=t("./pipeline");var s=t("./loading-items");var n="AssetLoader";function gHs(t){this.id=n,this.async=!0,this.pipeline=null;}gHs.ID=n;var c=[];gHs.prototype.handle=function(r,n){var a=r.uuid;if(!a)return r.content||null;cc.AssetLibrary.queryAssetInfo(a,function(t,e,i){t?n(t):(r.url=r.rawUrl=e,(r.isRawAsset=i)?(t=cc.path.extname(e).toLowerCase())?(t=t.substr(1),i=s.getQueue(r),c[0]={queueId:r.queueId,id:e,url:e,type:t,error:null,alias:r,complete:!0},i.append(c),r.type=t,n(null,r.content)):n(new Error(o.getError(4931,a,e))):(r.type="uuid",n(null,r.content)));});},r.AssetLoader=e.exports=gHs;},{"../CCDebug":27,"../utils/CCPath":253,"./loading-items":146,"./pipeline":149}],138:[function(t,e,i){"use strict";var n=t("../utils/misc").pushToMap;var d=t("../platform/js");function Entry(t,e){this.uuid=t,this.type=e;}function AssetTable(){this._pathToUuid=d.createMap(!0);}t=AssetTable.prototype;t.getUuid=function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var r=0;r<i.length;r++){var n=i[r];if(d.isChildClassOf(n.type,e))return n.uuid;}if(d.isChildClassOf(e,cc.SpriteFrame))for(var a=0;a<i.length;a++){var o=i[a];if(d.isChildClassOf(o.type,cc.SpriteAtlas)){cc.errorID(4932,t);break;}}}else{if(!e||d.isChildClassOf(i.type,e))return i.uuid;d.isChildClassOf(e,cc.SpriteFrame)&&d.isChildClassOf(i.type,cc.SpriteAtlas)&&cc.errorID(4932,t);}return"";},t.getUuidArray=function(t,e,i){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var h=this._pathToUuid;var r=[];var u=d.isChildClassOf;var n;for(var a in h)if(a.startsWith(t)&&(l=a,_=t,!(l.length>_.length)||46===(l=l.charCodeAt(_.length))||47===l)||!t){var o=h[a];if(Array.isArray(o))for(var s=0;s<o.length;s++){var c=o[s];!e||u(c.type,e)?(r.push(c.uuid),i&&i.push(a)):c.type===cc.SpriteAtlas&&(n=a);}else!e||u(o.type,e)?(r.push(o.uuid),i&&i.push(a)):o.type===cc.SpriteAtlas&&(n=a);}var l,_;return 0===r.length&&n&&d.isChildClassOf(e,cc.SpriteFrame)&&cc.errorID(4932,n),r;},t.add=function(t,e,i,r){t=t.substring(0,t.length-cc.path.extname(t).length);e=new Entry(e,i);n(this._pathToUuid,t,e,r);},t._getInfo_DEBUG=function(t,e){var i=this._pathToUuid;var r=Object.keys(i);for(var n=0;n<r.length;++n){var a=r[n];var o=i[a];if(Array.isArray(o))for(var s=0;s<o.length;s++){var c=o[s];if(c.uuid===t)return e.path=a,e.type=c.type,!0;}else if(o.uuid===t)return e.path=a,e.type=o.type,!0;}return!1;},t.reset=function(){this._pathToUuid=d.createMap(!0);},e.exports=AssetTable;},{"../platform/js":209,"../utils/misc":264}],139:[function(t,e,s){"use strict";var i=t("../platform/CCSys");var r=t("../CCDebug");var o=i.__audioSupport;var n=o.format;var a=o.context;function loadDomAudio(e,i){var t=document.createElement("audio");t.src=e.url;function Qds(){clearTimeout(r),t.removeEventListener("canplaythrough",n,!1),t.removeEventListener("error",a,!1),o.USE_LOADER_EVENT&&t.removeEventListener(o.USE_LOADER_EVENT,n,!1);}var r=setTimeout(function(){(0===t.readyState?a:n)();},8e3);var n=function(){Qds(),i(null,t);};var a=function(){Qds();var t="load audio failure - "+e.url;cc.log(t),i(t);};t.addEventListener("canplaythrough",n,!1),t.addEventListener("error",a,!1),o.USE_LOADER_EVENT&&t.addEventListener(o.USE_LOADER_EVENT,n,!1);}function loadWebAudio(t,e){a||e(new Error(r.getError(4926)));var i=cc.loader.getXMLHttpRequest();i.open("GET",t.url,!0),i.responseType="arraybuffer",i.onload=function(){a.decodeAudioData(i.response,function(t){e(null,t);},function(){e("decode error - "+t.id,null);});},i.onerror=function(){e("request error - "+t.id,null);},i.send();}e.exports=function(t,e){if(0===n.length)return new Error(r.getError(4927));(o.WEB_AUDIO?t._owner instanceof cc.AudioClip?t._owner.loadMode===cc.AudioClip.LoadMode.WEB_AUDIO?loadWebAudio:loadDomAudio:t.urlParam&&t.urlParam.useDom?loadDomAudio:loadWebAudio:loadDomAudio)(t,e);};},{"../CCDebug":27,"../platform/CCSys":198}],140:[function(t,e,i){"use strict";var _=t("../platform/js");function parseDepends(t,e){t=cc.loader.getItem(t);if(t){var i=t.dependKeys;if(i)for(var r=0;r<i.length;r++){var n=i[r];e[n]||(e[n]=!0,parseDepends(n,e));}}}function visitAsset(t,e){t._uuid&&(e[t=cc.loader._getReferenceKey(t)]||(e[t]=!0,parseDepends(t,e)));}function visitNode(t,h){for(var e=0;e<t._components.length;e++){i=void 0;r=void 0;n=void 0;a=void 0;o=void 0;s=void 0;c=void 0;u=void 0;l=void 0;_=void 0;var i=t._components[e];var r=h;var n=Object.getOwnPropertyNames(i);for(var a=0;a<n.length;a++){var o=i[n[a]];if("object"==typeof o&&o)if(Array.isArray(o))for(var s=0;s<o.length;s++){var c=o[s];c instanceof cc.RawAsset&&visitAsset(c,r);}else if(o.constructor&&o.constructor!==Object)o instanceof cc.RawAsset&&visitAsset(o,r);else{var u=Object.getOwnPropertyNames(o);for(var l=0;l<u.length;l++){var _=o[u[l]];_ instanceof cc.RawAsset&&visitAsset(_,r);}}}}for(var d=0;d<t._children.length;d++)visitNode(t._children[d],h);}e.exports={autoRelease:function(t,e,h){var i=cc.loader._autoReleaseSetting;var r=_.createMap();if(e)for(var n=0;n<e.length;n++)r[e[n]]=!0;for(var a=0;a<h.length;a++)visitNode(h[a],r);if(t)for(var o=0;o<t.length;o++){var s=t[o];!1===i[s]||r[s]||cc.loader.release(s);}var u=Object.keys(i);for(var c=0;c<u.length;c++){var l=u[c];!0!==i[l]||r[l]||cc.loader.release(l);}},getDependsRecursively:function(t){var e={};return parseDepends(t,e),Object.keys(e);}};},{"../platform/js":209}],141:[function(t,e,i){"use strict";e.exports=function(t,e){t=t.url;var i=cc.loader.getXMLHttpRequest(),r="Load binary data failed: "+t;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){var t=i.response;t?(t=new Uint8Array(t),e(null,t)):e({status:i.status,errorMessage:r+"(no response)"});},i.onerror=function(){e({status:i.status,errorMessage:r+"(error)"});},i.ontimeout=function(){e({status:i.status,errorMessage:r+"(time out)"});},i.send(null);};},{}],142:[function(t,a,s){"use strict";var e=t("../platform/js");var o=t("../CCDebug");t("../utils/CCPath");var c=t("./pipeline");var r=t("./pack-downloader");var i=t("./binary-downloader");var n=t("./text-downloader");var l=t("./utils").urlAppendTimestamp;function skip(){return null;}function downloadScript(t,e,i){var r=t.url,t=document,n=document.createElement("script");function loadHandler(){n.parentNode.removeChild(n),n.removeEventListener("load",loadHandler,!1),n.removeEventListener("error",errorHandler,!1),e(null,r);}function errorHandler(){n.parentNode.removeChild(n),n.removeEventListener("load",loadHandler,!1),n.removeEventListener("error",errorHandler,!1),e(new Error(o.getError(4928,r)));}"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=i,n.src=l(r),n.addEventListener("load",loadHandler,!1),n.addEventListener("error",errorHandler,!1),t.body.appendChild(n);}function downloadImage(t,e,i,r){void 0===i&&(i=!0);var n=l(t.url);if(r=r||new Image(),i&&"file:"!==window.location.protocol?r.crossOrigin="anonymous":r.crossOrigin=null,r.complete&&0<r.naturalWidth&&r.src===n)return r;var a=function loadCallback(){r.removeEventListener("load",loadCallback),r.removeEventListener("error",U00),r.id=t.id,e(null,r);};function U00(){r.removeEventListener("load",a),r.removeEventListener("error",U00),"https:"!==window.location.protocol&&r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()?downloadImage(t,e,!1,r):e(new Error(o.getError(4930,n)));}r.addEventListener("load",a),r.addEventListener("error",U00),r.src=n;}function downloadVideo(t,e){e(null,t.url);}var h={js:downloadScript,png:downloadImage,jpg:downloadImage,bmp:downloadImage,jpeg:downloadImage,gif:downloadImage,ico:downloadImage,tiff:downloadImage,webp:downloadImage,image:downloadImage,pvr:i,pkm:i,mp3:t=t("./audio-downloader"),ogg:t,wav:t,m4a:t,txt:n,xml:n,vsh:n,fsh:n,atlas:n,tmx:n,tsx:n,json:n,ExportJson:n,plist:n,fnt:n,font:skip,eot:skip,ttf:skip,woff:skip,svg:skip,ttc:skip,uuid:function(t,e){var i=r.load(t,e);return void 0===i?this.extMap.json(t,e):i||void 0;},binary:i,bin:i,dbbin:i,skel:i,mp4:downloadVideo,avi:downloadVideo,mov:downloadVideo,mpg:downloadVideo,mpeg:downloadVideo,rm:downloadVideo,rmvb:downloadVideo,default:n};var u="Downloader";function is0(t){this.id=u,this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this._subpackages={},this.extMap=e.mixin(t,h);}is0.ID=u,is0.PackDownloader=r,is0.prototype.addHandlers=function(t){e.mixin(this.extMap,t);},is0.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var e=this.handle(t.item,t.callback);void 0!==e&&(e instanceof Error?t.callback(e):t.callback(null,e));}},is0.prototype.handle=function(t,i){var r=this;var e=this.extMap[t.type]||this.extMap.default;var n=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(n=e.call(this,t,function(t,e){r._curConcurrent=Math.max(0,r._curConcurrent-1),r._handleLoadQueue(),i&&i(t,e);})))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),n;}else if(t.ignoreMaxConcurrency){if(void 0!==(n=e.call(this,t,i)))return n;}else this._loadQueue.push({item:t,callback:i});},is0.prototype.loadSubpackage=function(t,e,i){!i&&e&&(i=e,e=null);var r=this._subpackages[t];r?r.loaded?i&&i():downloadScript({url:r.path+"index.js"},function(t){t||(r.loaded=!0),i&&i(t);}):i&&i(new Error("Can't find subpackage "+t));},c.Downloader=a.exports=is0;},{"../CCDebug":27,"../platform/js":209,"../utils/CCPath":253,"./audio-downloader":139,"./binary-downloader":141,"./pack-downloader":148,"./pipeline":149,"./text-downloader":152,"./utils":154}],143:[function(t,e,r){"use strict";var h=t("../utils/text-utils");var u=null;var _="BES bswy:->@123\u4e01\u3041\u1101";var d={};var f=-1;var p=[];i=void 0;var v=function(){var t,e;return i=void 0===i?!!window.FontFace&&(t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor),t?42<parseInt(t[1],10):!e):i;};var i;function _checkFontLoaded(){var t=!0;var e=Date.now();for(var i=p.length-1;0<=i;i--){var r=p[i];var n=r.fontFamilyName;var a,o;3e3<e-r.startTime?(cc.warnID(4933,n),r.callback(null,n),p.splice(i,1)):(a=r.refWidth,u.font=o="40px "+n,a!==h.safeMeasureText(u,_,o)?(p.splice(i,1),r.callback(null,n)):t=!1);}t&&(clearInterval(f),f=-1);}var m={loadFont:function(t,e){t=t.url;var i=m._getFontFamily(t);if(d[i])return i;u||((r=document.createElement("canvas")).width=100,r.height=100,u=r.getContext("2d"));var r="40px "+i;u.font=r;r=h.safeMeasureText(u,_,r);var n=document.createElement("style");n.type="text/css";var a="";isNaN(+i)?a+="@font-face { font-family:"+i+"; src:":a+="@font-face { font-family:'"+i+"'; src:",n.textContent=(a+="url('"+t+"');")+"}",document.body.appendChild(n);t=document.createElement("div");a=t.style;var o,s,c,l;a.fontFamily=i,t.innerHTML=".",a.position="absolute",a.left="-100px",a.top="-100px",document.body.appendChild(t),v()?(o=Date.now(),s=i,c=e,a=new Promise(function(e,t){(function check(){3e3<=Date.now()-o?t():document.fonts.load("40px "+s).then(function(t){1<=t.length?e():setTimeout(check,100);},function(){t();});})();}),l=null,t=new Promise(function(t,e){l=setTimeout(e,3e3);}),Promise.race([t,a]).then(function(){l&&(clearTimeout(l),l=null),c(null,s);},function(){cc.warnID(4933,s),c(null,s);})):(t={fontFamilyName:i,refWidth:r,callback:e,startTime:Date.now()},p.push(t),-1===f&&(f=setInterval(_checkFontLoaded,100))),d[i]=n;},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i=t.lastIndexOf("/");return t=-1!==(t=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL").indexOf(" ")?'"'+t+'"':t;}};e.exports=m;},{"../utils/text-utils":271}],144:[function(t,e,i){"use strict";t("./downloader"),t("./loader"),t("./loading-items"),t("./pipeline"),t("./CCLoader");},{"./CCLoader":136,"./downloader":142,"./loader":145,"./loading-items":146,"./pipeline":149}],145:[function(t,e,n){"use strict";var i=t("../platform/js");var a=t("../platform/CCSAXParser").plistParser;var o=t("./pipeline");var s=t("../assets/CCTexture2D");var r=t("./uuid-loader");t=t("./font-loader");function loadJSON(e){if("string"!=typeof e.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(e.content);}catch(t){return new Error("JSON Loader: Parse json ["+e.id+"] failed : "+t);}}function loadImage(t){if(t._owner instanceof cc.Asset)return null;var e=t.content;if(cc.sys.platform!==cc.sys.FB_PLAYABLE_ADS&&!(e instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var i=t.texture||new s();return i._uuid=t.uuid,i.url=t.url,i._setRawAsset(t.rawUrl,!1),i._nativeAsset=e,i;}function loadAudioAsAsset(t,e){if(t._owner instanceof cc.Asset)return null;var i=new cc.AudioClip();return i._setRawAsset(t.rawUrl,!1),i._nativeAsset=t.content,i.url=t.url,i;}function loadBinary(t){return t.load?t.load(t.content):null;}function readBEUint16(t,e){return t[e]<<8|t[e+1];}var c={png:loadImage,jpg:loadImage,bmp:loadImage,jpeg:loadImage,gif:loadImage,ico:loadImage,tiff:loadImage,webp:loadImage,image:loadImage,pvr:function(t){t=t.content instanceof ArrayBuffer?t.content:t.content.buffer;var e=new Int32Array(t,0,13);if(55727696!=e[0])return new Error("Invalid magic number in PVR header");var i=e[7];var r=e[6];return e=e[12]+52,{_data:new Uint8Array(t,e),_compressed:!0,width:i,height:r};},pkm:function(t){t=t.content instanceof ArrayBuffer?t.content:t.content.buffer;var e=new Uint8Array(t);var i=readBEUint16(e,6);if(0!==i&&1!==i&&3!==i)return new Error("Invalid magic number in ETC header");i=readBEUint16(e,12);var r=readBEUint16(e,14);return readBEUint16(e,8),readBEUint16(e,10),{_data:new Uint8Array(t,16),_compressed:!0,width:i,height:r};},mp3:loadAudioAsAsset,ogg:loadAudioAsAsset,wav:loadAudioAsAsset,m4a:loadAudioAsAsset,json:loadJSON,ExportJson:loadJSON,plist:function(t){return"string"!=typeof t.content?new Error("Plist Loader: Input item doesn't contain string content"):a.parse(t.content)||new Error("Plist Loader: Parse ["+t.id+"] failed");},uuid:r,prefab:r,fire:r,scene:r,binary:loadBinary,dbbin:loadBinary,bin:loadBinary,skel:loadBinary,font:t.loadFont,eot:t.loadFont,ttf:t.loadFont,woff:t.loadFont,svg:t.loadFont,ttc:t.loadFont,default:function(){return null;}};function u10(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=i.mixin(t,c);}u10.ID="Loader",u10.prototype.addHandlers=function(t){this.extMap=i.mixin(this.extMap,t);},u10.prototype.handle=function(t,e){return(this.extMap[t.type]||this.extMap.default).call(this,t,e);},o.Loader=e.exports=u10;},{"../assets/CCTexture2D":50,"../platform/CCSAXParser":196,"../platform/js":209,"./font-loader":143,"./pipeline":149,"./uuid-loader":155}],146:[function(t,e,i){"use strict";var n=t("../platform/callbacks-invoker");t("../utils/CCPath");var o=t("../platform/js");var u=0|998*Math.random();var c=o.createMap(!0);var a=[];var s={WORKING:1,COMPLETE:2,ERROR:3};var l=o.createMap(!0);function createItem(t,e){var i="object"==typeof t?t.url:t;var r={queueId:e,id:i,url:i,rawUrl:void 0,urlParam:function(t){if(t){t=t.split("?");var e;if(t&&t[0]&&t[1])return e={},t[1].split("&").forEach(function(t){t=t.split("=");e[t[0]]=t[1];}),e;}}(i),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(o.mixin(r,t),t.skips))for(var n=0;n<t.skips.length;n++){var a=t.skips[n];r.states[a]=s.COMPLETE;}return r.rawUrl=r.url,i&&!r.type&&(r.type=cc.path.extname(i).toLowerCase().substr(1)),r;}var h=[];function c20(t,e,i,r){n.call(this),this._id=++u,(c[this._id]=this)._pipeline=t,this._errorUrls=o.createMap(!0),this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=r,this.map=o.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&(0<e.length?this.append(e):this.allComplete());}c20.ItemState=new cc.Enum(s),c20.create=function(t,e,i,r){void 0===i?"function"==typeof e&&(r=e,e=i=null):void 0===r&&("function"==typeof e?(r=i,i=e,e=null):(r=i,i=null));var n=a.pop();return n?(n._pipeline=t,n.onProgress=i,n.onComplete=r,(c[n._id]=n)._pipeline&&(n.active=!0),e&&n.append(e)):n=new c20(t,e,i,r),n;},c20.getQueue=function(t){return t.queueId?c[t.queueId]:null;},c20.itemComplete=function(t){var e=c[t.queueId];e&&e.itemComplete(t.id);},c20.initQueueDeps=function(t){var e=l[t._id];e?(e.completed.length=0,e.deps.length=0):l[t._id]={completed:[],deps:[]};},c20.registerQueueDep=function(t,e){var i=t.queueId||t;if(!i)return!1;i=l[i];if(i)-1===i.deps.indexOf(e)&&i.deps.push(e);else if(t.id)for(var r in l){r=l[r];-1!==r.deps.indexOf(t.id)&&-1===r.deps.indexOf(e)&&r.deps.push(e);}},c20.finishDep=function(t){for(var e in l){e=l[e];-1!==e.deps.indexOf(t)&&-1===e.completed.indexOf(t)&&e.completed.push(t);}};t=c20.prototype;o.mixin(t,n.prototype),t.append=function(t,e){if(!this.active)return[];e&&!e.deps&&(e.deps=[]),this._appending=!0;var i,r,n=[];for(i=0;i<t.length;++i){var a,o;!(r=t[i]).queueId||this.map[r.id]?"string"==typeof((s=r).url||s)&&(o=(s=createItem(r,this._id)).id,this.map[o]||(this.map[o]=s,this.totalCount++,e&&e.deps.push(s),c20.registerQueueDep(e||this._id,o),n.push(s))):(this.map[r.id]=r,e&&e.deps.push(r),r.complete||function checkCircleReference(t,e,i){if(t&&e){var r=!1;if(h.push(e.id),e.deps){var n,a,o=e.deps;for(n=0;n<o.length;n++){if((a=o[n]).id===t.id){r=!0;break;}if(!(0<=h.indexOf(a.id))&&a.deps&&checkCircleReference(t,a,!0)){r=!0;break;}}}return i||(h.length=0),r;}}(e,r))?(this.totalCount++,this.itemComplete(r.id)):(a=this,(o=c[r.queueId])&&(this.totalCount++,c20.registerQueueDep(e||this._id,r.id),o.addListener(r.id,function(t){a.itemComplete(t.id);})));}var s;return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(n),n;},t._childOnProgress=function(t){var e;this.onProgress&&(e=l[this._id],this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t));},t.allComplete=function(){var t=o.isEmptyObject(this._errorUrls)?null:this._errorUrls;this.onComplete&&this.onComplete(t,this);},t.isCompleted=function(){return this.completedCount>=this.totalCount;},t.isItemCompleted=function(t){return!!this.completed[t];},t.exists=function(t){return!!this.map[t];},t.getContent=function(t){t=this.map[t];var e=null;return t&&(t.content?e=t.content:t.alias&&(e=t.alias.content)),e;},t.getError=function(t){t=this.map[t];var e=null;return t&&(t.error?e=t.error:t.alias&&(e=t.alias.error)),e;},t.addListener=n.prototype.on,t.hasListener=n.prototype.hasEventListener,t.removeListener=n.prototype.off,t.removeAllListeners=n.prototype.removeAll,t.removeItem=function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias.id],delete this.map[e.alias.id]),this.completedCount--,this.totalCount--);},t.itemComplete=function(t){var e=this.map[t];var i;e&&(i=t in this._errorUrls,e.error instanceof Error||o.isString(e.error)?this._errorUrls[t]=e.error:e.error?o.mixin(this._errorUrls,e.error):!e.error&&i&&delete this._errorUrls[t],this.completed[t]=e,this.completedCount++,c20.finishDep(e.id),this.onProgress&&(i=l[this._id],this.onProgress(i?i.completed.length:this.completedCount,i?i.deps.length:this.totalCount,e)),this.emit(t,e),this.removeAll(t),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete());},t.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,o.clear(this._errorUrls),this.onProgress=null,this.onComplete=null,this.map=o.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,n.call(this),l[this._id]&&(l[this._id].completed.length=0,l[this._id].deps.length=0),delete c[this._id],delete l[this._id],-1===a.indexOf(this)&&a.length<10&&a.push(this);},cc.LoadingItems=e.exports=c20;},{"../platform/callbacks-invoker":202,"../platform/js":209,"../utils/CCPath":253}],147:[function(t,e,i){"use strict";t=t("./pipeline");var r=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;function zT0(t,e,i){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.md5NativeAssetsMap=e,this.libraryBase=i;}zT0.ID="MD5Pipe",zT0.prototype.handle=function(t){return t.url=this.transformURL(t.url),null;},zT0.prototype.transformURL=function(t){var i=!t.startsWith(this.libraryBase)?this.md5NativeAssetsMap:this.md5AssetsMap;return t=t.replace(r,function(t,e){e=i[e];return e?t+"."+e:t;});},t.MD5Pipe=e.exports=zT0;},{"./pipeline":149}],148:[function(t,e,i){"use strict";var a=t("./unpackers");var d=t("../utils/misc").pushToMap;var o=0,n=2,s=3;function UnpackerData(){this.unpacker=null,this.state=o,this.duration=0;}var c={};var l={};var h={};var u=[];var _=null;function error(t,e){return new Error("Can not retrieve "+t+" from packer "+e);}e.exports={msToRelease:12e4,initPacks:function(t){for(var e in c={},l=t){var i=t[e];for(var r=0;r<i.length;r++){var n=i[r];var a=1===i.length;d(c,n,e,a);}}},_loadNewPack:function(i,r,n){var a=this;var o=cc.AssetLibrary.getLibUrlNoExt(r)+".json";cc.loader.load({url:o,ignoreMaxConcurrency:!0},function(t,e){if(t)return cc.errorID(4916,i),n(t);h[r].url=o;t=a._doLoadNewPack(i,r,e);t?n(null,t):n(error(i,r));});},_doPreload:function(t,e){var i=h[t];i||((i=h[t]=new UnpackerData()).state=n),i.state!==s&&(i.unpacker=new a.JsonUnpacker(),i.unpacker.load(l[t],e),i.state=s);},_doLoadNewPack:function(t,e,i){var r=h[e];var n;return r.state!==s&&("string"==typeof i&&(i=JSON.parse(i)),Array.isArray(i)?r.unpacker=new a.JsonUnpacker():i.type===a.TextureUnpacker.ID&&(r.unpacker=new a.TextureUnpacker()),r.unpacker.load(l[e],i),r.state=s,r.duration=0,u.push(e),n=this,_=_||setInterval(function(){var t=n.msToRelease/5e3;for(var e=u.length-1;0<=e;e--){var i=u[e];++h[i].duration>t&&n.release(i);}0===u.length&&(clearInterval(_),_=null);},5e3)),r.unpacker.retrieve(t);},_selectLoadedPack:function(t){var e=o;var i="";for(var r=0;r<t.length;r++){var n=t[r];var a=h[n];if(a){a=a.state;if(a===s)return n;e<a&&(e=a,i=n);}}return e!==o?i:t[0];},load:function(t,e){t=t.uuid;var i=c[t];var r;if(i)return Array.isArray(i)&&(i=this._selectLoadedPack(i)),r=h[i],r&&r.state===s?(r.duration=0,r.unpacker.retrieve(t)||error(t,i)):(r||(console.log("Create unpacker %s for %s",i,t),(r=h[i]=new UnpackerData()).state=n),this._loadNewPack(t,i,e),null);},release:function(t){var e=h[t];e&&(cc.loader.release(e.url),delete h[t],cc.js.array.fastRemove(u,t));}};},{"../utils/misc":264,"./unpackers":153}],149:[function(t,e,i){"use strict";var r=t("../platform/js");var n=t("./loading-items");var o=n.ItemState;function WX0(t){this._pipes=t,this._cache=r.createMap(!0);for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null);}}WX0.ItemState=o;t=WX0.prototype;t.insertPipe=function(t,e){var i,r;!t.handle||!t.id||e>this._pipes.length?cc.warnID(4921):0<this._pipes.indexOf(t)?cc.warnID(4922):(i=null,e<(t.pipeline=this)._pipes.length&&(i=this._pipes[e]),r=null,(r=0<e?this._pipes[e-1]:r)&&(r.next=t),t.next=i,this._pipes.splice(e,0,t));},t.insertPipeAfter=function(t,e){t=this._pipes.indexOf(t);t<0||this.insertPipe(e,t+1);},t.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,0<this._pipes.length&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t));},t.flowIn=function(t){var e,i,r=this._pipes[0];if(r){for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i;for(e=0;e<t.length;e++)(function flow(t,i){var r=t.id;var e=i.states[r];var n=t.next;var a=t.pipeline;i.error||e===o.WORKING||e===o.ERROR||(e===o.COMPLETE?n?flow(n,i):a.flowOut(i):(i.states[r]=o.WORKING,(e=t.handle(i,function(t,e){t?(i.error=t,i.states[r]=o.ERROR,a.flowOut(i)):(e&&(i.content=e),i.states[r]=o.COMPLETE,n?flow(n,i):a.flowOut(i));}))instanceof Error?(i.error=e,i.states[r]=o.ERROR,a.flowOut(i)):void 0!==e&&(null!==e&&(i.content=e),i.states[r]=o.COMPLETE,n?flow(n,i):a.flowOut(i))));})(r,i=t[e]);}else for(e=0;e<t.length;e++)this.flowOut(t[e]);},t.flowInDeps=function(t,e,i){return n.create(this,function(t,e){i(t,e),e.destroy();}).append(e,t);},t.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,n.itemComplete(t);},t.copyItemStates=function(t,e){if(e instanceof Array)for(var i=0;i<e.length;++i)e[i].states=t.states;else e.states=t.states;},t.getItem=function(t){t=this._cache[t];return t&&(t.alias||t);},t.removeItem=function(t){var e=this._cache[t];return e&&e.complete&&delete this._cache[t],e;},t.clear=function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e));}},cc.Pipeline=e.exports=WX0;},{"../platform/js":209,"./loading-items":146}],150:[function(t,e,i){"use strict";function V30(){this._releasedKeys=s.createMap(!0),this._dirty=!1;}function L30(t,e,i){i[t]||cc.log('"'+t+'" was released but maybe still referenced by '+((i=e).uuid?(r=r||{path:"",type:null},cc.loader._assetTables.assets._getInfo_DEBUG(i.uuid,r)?(r.path="resources/"+r.path,'"'+r.path+'" (type: '+s.getClassName(r.type)+", uuid: "+i.uuid+")"):'"'+i.rawUrl+'" ('+i.uuid+")"):'"'+i.rawUrl+'"'));}var s=t("../platform/js");V30.prototype.setReleased=function(t,e){this._releasedKeys[e]=!0,this._dirty=!0;};var r=null;V30.prototype.checkCouldRelease=function(t){if(this._dirty){this._dirty=!1;var e=this._releasedKeys;for(var i in t){var r=t[i];var n=(r=r.alias?r.alias:r).dependKeys;if(n)for(var a=0;a<n.length;++a){var o=n[a];e[o]&&(L30(o,r,t),delete e[o]);}}s.clear(e);}},e.exports=V30;},{"../platform/js":209}],151:[function(t,e,i){"use strict";t=t("./pipeline");var r="SubPackPipe";var n=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;var a=Object.create(null);function px0(t){for(var e in this.id=r,this.async=!1,this.pipeline=null,t){var i=t[e];i.uuids&&i.uuids.forEach(function(t){a[t]=i.path;});}}px0.ID=r,px0.prototype.handle=function(t){return t.url=this.transformURL(t.url),null;},px0.prototype.transformURL=function(t){e=(e=(e=t).match(n))?e[1]:"";if(e){var e=a[e];if(e)return t.replace("res/raw-assets/",e+"raw-assets/");}return t;},t.SubPackPipe=e.exports=px0;},{"./pipeline":149}],152:[function(t,e,i){"use strict";var n=t("./utils").urlAppendTimestamp;e.exports=function(t,e){t=t.url;t=n(t);var i=cc.loader.getXMLHttpRequest(),r="Load text file failed: "+t;i.open("GET",t,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(){4===i.readyState?200===i.status||0===i.status?e(null,i.responseText):e({status:i.status,errorMessage:r+"(wrong status)"}):e({status:i.status,errorMessage:r+"(wrong readyState)"});},i.onerror=function(){e({status:i.status,errorMessage:r+"(error)"});},i.ontimeout=function(){e({status:i.status,errorMessage:r+"(time out)"});},i.send(null);};},{"./utils":154}],153:[function(t,e,i){"use strict";var r=t("../assets/CCTexture2D");t=t("../platform/js");function JsonUnpacker(){this.jsons={};}function TextureUnpacker(){this.contents={};}JsonUnpacker.prototype.load=function(t,e){e.length!==t.length&&cc.errorID(4915);for(var i=0;i<t.length;i++){var r=t[i];var n=e[i];this.jsons[r]=n;}},JsonUnpacker.prototype.retrieve=function(t){return this.jsons[t]||null;},TextureUnpacker.ID=t._getClassId(r),TextureUnpacker.prototype.load=function(t,e){var i=e.data.split("|");i.length!==t.length&&cc.errorID(4915);for(var r=0;r<t.length;r++)this.contents[t[r]]=i[r];},TextureUnpacker.prototype.retrieve=function(t){t=this.contents[t];return t?{__type__:TextureUnpacker.ID,content:t}:null;},e.exports={JsonUnpacker:JsonUnpacker,TextureUnpacker:TextureUnpacker};},{"../assets/CCTexture2D":50,"../platform/js":209}],154:[function(t,e,i){"use strict";var r=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(r.test(t)?t+="&_t="+ +new Date():t+="?_t="+ +new Date()),t;}};},{}],155:[function(t,e,i){"use strict";var s=t("../platform/js");var c=t("../CCDebug");t("../platform/deserialize");var f=t("./loading-items");function isSceneObj(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__);}function loadUuid(e,t){if("string"==typeof e.content)try{a=JSON.parse(e.content);}catch(t){return new Error(c.getError(4923,e.id,t.stack));}else{if("object"!=typeof e.content)return new Error(c.getError(4924));a=e.content;}var i=isSceneObj(a);o=i?cc._MissingScript.safeFindClass:function(t){var e=s._getClassById(t);return e||(cc.warnID(4903,t),Object);};var r=cc.deserialize.Details.pool.get();var n;try{n=cc.deserialize(a,r,{classFinder:o,target:e.existingAsset,customEnv:e});}catch(t){cc.deserialize.Details.pool.put(r);var a=t.stack;return new Error(c.getError(4925,e.id,a));}n._uuid=e.uuid,n.url=n.nativeUrl,o=n,a=i,(i=(i=e).deferredLoadRaw)?o instanceof cc.Asset&&o.constructor.preventDeferredLoadDependents&&(i=!1):a&&(o instanceof cc.SceneAsset||o instanceof cc.Prefab)&&(i=o.asyncLoadAssets);var o=function(h,t,e,u){var i=e.uuidList;var r=e.uuidObjList;var n=e.uuidPropList;var a=e._stillUseUrl;var o;var s,c;var _=h.dependKeys=[];if(u)for(o=[],s=0;s<i.length;s++){c=i[s];var d=r[s];var f=n[s];var l=cc.AssetLibrary._getAssetInfoInRuntime(c);l.raw?(l=l.url,d[f]=l,_.push(l)):o.push({type:"uuid",uuid:c,deferredLoadRaw:!0,_owner:d,_ownerProp:f,_stillUseUrl:a[s]});}else{for(o=new Array(i.length),s=0;s<i.length;s++)c=i[s],o[s]={type:"uuid",uuid:c,_owner:r[s],_ownerProp:n[s],_stillUseUrl:a[s]};t._native&&!t.constructor.preventPreloadNativeObject&&o.push({url:t.nativeUrl,_owner:t,_ownerProp:"_nativeAsset"});}return o;}(e,n,r,i);if(cc.deserialize.Details.pool.put(r),0===o.length)return n.onLoad&&n.onLoad(),t(null,n);var h,u,d,_;i=this.pipeline,h=n,u=o,d=t,(r=e).content=h,_=r.dependKeys,i.flowInDeps(r,u,function(t,e){var i;var r=e.map;for(var l in r)(i=r[l]).uuid&&i.content&&(i.content._uuid=i.uuid);function loadCallback(t){var e=t.content;this._stillUseUrl&&(e=e&&cc.RawAsset.wasRawAssetType(e.constructor)?e.nativeUrl:t.rawUrl),"_nativeAsset"===this._ownerProp&&(this._owner.url=t.url),this._owner[this._ownerProp]=e,t.uuid!==h._uuid&&_.indexOf(t.id)<0&&_.push(t.id);}for(var n=0;n<u.length;n++){var a=u[n];var o=a.uuid;var s=a.url;a._owner;a._ownerProp;var c;(i=r[s])&&(s=a,i.complete||i.content?i.error?cc._throw(i.error.message||i.error.errorMessage||i.error):loadCallback.call(s,i):(c=(a=f.getQueue(i))._callbackTable[o])?c.unshift(loadCallback,s):a.addListener(o,loadCallback,s));}if(!t&&h.onLoad)try{h.onLoad();}catch(t){cc._throw(t);}d(t,h);});}(e.exports=loadUuid).isSceneObj=isSceneObj;},{"../CCDebug":27,"../platform/deserialize":204,"../platform/js":209,"./loading-items":146}],156:[function(t,e,r){"use strict";var l=_interopRequireDefault(t("../../renderer/core/input-assembler"));var y=_interopRequireDefault(t("../../renderer/gfx"));var h=t("./mesh-data");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var u=t("../renderer");t=t("../event/event-target");function applyColor(t,e,i){t[e]=i._val;}function applyVec2(t,e,i){t[e]=i.x,t[e+1]=i.y;}function applyVec3(t,e,i){t[e]=i.x,t[e+1]=i.y,t[e+2]=i.z;}var v={5120:"getInt8",5121:"getUint8",5122:"getInt16",5123:"getUint16",5124:"getInt32",5125:"getUint32",5126:"getFloat32"};var b={5120:"setInt8",5121:"setUint8",5122:"setInt16",5123:"setUint16",5124:"setInt32",5125:"setUint32",5126:"setFloat32"};i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0);var g=256===new Int16Array(i)[0];var i=cc.Class({name:"cc.Mesh",extends:cc.Asset,mixins:[t],properties:{_nativeAsset:{override:!0,get:function(){return this._buffer;},set:function(t){this._buffer=ArrayBuffer.isView(t)?t.buffer:t,this.initWithBuffer();}},_vertexBundles:{default:null,type:h.VertexBundle},_primitives:{default:null,Primitive:h.Primitive},_minPos:cc.v3(),_maxPos:cc.v3(),subMeshes:{get:function(){return this._subMeshes;},set:function(t){this._subMeshes=t;}},subDatas:{get:function(){return this._subDatas;}}},ctor:function(){this._subMeshes=[],this.loaded=!1,this._subDatas=[];},initWithBuffer:function(){this._subMeshes.length=0;var t=this._primitives;for(var e=0;e<t.length;e++){var i=t[e];var r=i.data;r=new Uint8Array(this._buffer,r.offset,r.length);var n=this._vertexBundles[i.vertexBundleIndices[0]];var a=n.data;n=new y.default.VertexFormat(n.formats);var o=new Uint8Array(this._buffer,a.offset,a.length);var s=this._canVertexFormatBatch(n);var c=new h.MeshData();c.vData=o,c.iData=r,c.vfm=n,c.offset=a.offset,c.canBatch=s,this._subDatas.push(c);a=new y.default.VertexBuffer(u.device,n,y.default.USAGE_STATIC,o);s=new y.default.IndexBuffer(u.device,i.indexUnit,y.default.USAGE_STATIC,r);this._subMeshes.push(new l.default(a,s));}this.loaded=!0,this.emit("load");},_canVertexFormatBatch:function(t){var e=t._attr2el[y.default.ATTR_POSITION];return!e||e.type===y.default.ATTR_TYPE_FLOAT32&&t._bytes%4==0;},init:function(t,e,i,r){void 0===i&&(i=!1),void 0===r&&(r=0);e=new Uint8Array(t._bytes*e);var n=new h.MeshData();n.vData=e,n.vfm=t,n.vDirty=!0,n.canBatch=this._canVertexFormatBatch(t);t=new y.default.VertexBuffer(u.device,t,i?y.default.USAGE_DYNAMIC:y.default.USAGE_STATIC,e);n.vb=t,this._subMeshes[r]=new l.default(n.vb);i=this._subDatas[r];i&&(i.vb&&i.vb.destroy(),i.ib&&i.ib.destroy()),this._subDatas[r]=n,this.loaded=!0,this.emit("load"),this.emit("init-format");},setVertices:function(t,e,i){i=this._subDatas[i=i||0];var r=i.vfm.element(t);if(!r)return cc.warn("Cannot find "+t+" attribute in vertex defines.");var h="number"==typeof e[0];var n=r.num;var a=h?e.length/n|0:e.length;var o;i.vData.byteLength<a*r.stride&&i.setVData(new Uint8Array(a*i.vfm._bytes));a=4;t===y.default.ATTR_COLOR?h?(o=i.getVData(),a=1):o=i.getVData(Uint32Array):o=i.getVData(Float32Array);var u=r.stride/a;var _=r.offset/a;if(h)for(var s=0,d=e.length/n;s<d;s++){var f=s*n;var p=s*u+_;for(var c=0;c<n;c++)o[p+c]=e[f+c];}else{var m;m=t===y.default.ATTR_COLOR?applyColor:2===n?applyVec2:applyVec3;for(var l=0,v=e.length;l<v;l++)m(o,l*u+_,e[l]);}i.vDirty=!0;},setIndices:function(t,e,i){e=e||0;var r=t;t instanceof Uint16Array?r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(r=new Uint16Array(t),r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength));t=i?y.default.USAGE_DYNAMIC:y.default.USAGE_STATIC;i=this._subDatas[e];i.ib?(i.iData=r,i.iDirty=!0):(i.iData=r,t=new y.default.IndexBuffer(u.device,y.default.INDEX_FMT_UINT16,t,r,r.byteLength/y.default.IndexBuffer.BYTES_PER_INDEX[y.default.INDEX_FMT_UINT16]),i.ib=t,this._subMeshes[e]._indexBuffer=i.ib);},setPrimitiveType:function(t,e){this._subMeshes[e=e||0]?this._subMeshes[e]._primitiveType=t:cc.warn("Do not have sub mesh at index "+e);},clear:function(){this._subMeshes.length=0;var t=this._subDatas;for(var e=0,i=t.length;e<i;e++){var r=t[e].vb;r&&r.destroy();r=t[e].ib;r&&r.destroy();}t.length=0;},setBoundingBox:function(t,e){this._minPos=t,this._maxPos=e;},destroy:function(){this.clear();},_uploadData:function(){var t=this._subDatas;for(var e=0,i=t.length;e<i;e++){var r=t[e];var n,a;r.vDirty&&(n=r.vb,a=r.vData,n.update(0,a),r.vDirty=!1),r.iDirty&&(n=r.ib,a=r.iData,n.update(0,a),r.iDirty=!1);}},_getAttrMeshData:function(t,e){t=this._subDatas[t];if(!t)return[];var i=t.vfm;var r=i.element(e);if(!r)return[];t.attrDatas||(t.attrDatas={});var n=t.attrDatas;var a=n[e];if(a)return a;a=n[e]=[];n=t.vData;var o=new DataView(n.buffer,n.byteOffset,n.byteLength);var h=r.stride;var u=r.offset;var s=r.num;var _=r.bytes/s;var d=v[r.type];var f=n.byteLength/i._bytes;for(var c=0;c<f;c++){var p=c*h+u;for(var l=0;l<s;l++){var m=o[d](p+l*_,g);a.push(m);}}return a;},copyAttribute:function(t,e,h,u,_){var i=!1;var r=this._subDatas[t];if(!r)return i;var n=r.vfm;var a=n.element(e);if(!a)return i;var o=b[a.type];if(!o)return i;var s=this._getAttrMeshData(t,e);var d=r.vData.byteLength/n._bytes;var f=a.bytes/a.num;if(0<s.length){var p=new DataView(h,_);var m=u;var v=a.num;for(var c=0;c<d;++c){var y=c*v;for(var l=0;l<v;++l)p[o](m*c+f*l,s[y+l],g);}i=!0;}return i;},copyIndices:function(t,e){t=this._subDatas[t];if(!t)return!1;t=t.iData;var i=t.length/2;var r=new DataView(t.buffer,t.byteOffset,t.byteLength);var n=v[y.default.INDEX_FMT_UINT8];for(var a=0;a<i;++a)e[a]=r[n](2*a);return!0;}});cc.Mesh=e.exports=i;},{"../../renderer/core/input-assembler":302,"../../renderer/gfx":312,"../event/event-target":115,"../renderer":220,"./mesh-data":159}],157:[function(t,r,n){"use strict";var S=_interopRequireDefault(t("../../renderer/gfx"));var T=_interopRequireDefault(t("../../renderer/core/input-assembler"));var e=_interopRequireDefault(t("../geom-utils/aabb"));var a=t("../utils/mesh-util");var w=_interopRequireDefault(t("../value-types/vec3"));var R=_interopRequireDefault(t("../value-types/mat4"));var E=_interopRequireDefault(t("../assets/material/material-variant"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var o=t("../components/CCRenderComponent");var s=t("./CCMesh");var c=t("../renderer/render-flow");var P=t("../renderer");var l=t("../assets/material/CCMaterial");var i=cc.Enum({OFF:0,ON:1});t=cc.Class({name:"cc.MeshRenderer",extends:o,editor:!1,properties:{_mesh:{default:null,type:s},_receiveShadows:!1,_shadowCastingMode:i.OFF,_enableAutoBatch:!1,mesh:{get:function(){return this._mesh;},set:function(t){this._mesh!==t&&(this._setMesh(t),t?(this.markForRender(!0),this.node._renderFlag|=c.FLAG_TRANSFORM):this.disableRender());},type:s,animatable:!1},textures:{default:[],type:cc.Texture2D,visible:!1},receiveShadows:{get:function(){return this._receiveShadows;},set:function(t){this._receiveShadows=t,this._updateReceiveShadow();},animatable:!1},shadowCastingMode:{get:function(){return this._shadowCastingMode;},set:function(t){this._shadowCastingMode=t,this._updateCastShadow();},type:i,animatable:!1},enableAutoBatch:{get:function(){return this._enableAutoBatch;},set:function(t){this._enableAutoBatch=t;}}},statics:{ShadowCastingMode:i},ctor:function(){this._boundingBox=cc.geomUtils&&new e.default(),this._debugDatas={wireFrame:[],normal:[]};},onEnable:function(){var t=this;this._super(),this._mesh&&!this._mesh.loaded?(this.disableRender(),this._mesh.once("load",function(){t.isValid&&(t._setMesh(t._mesh),t.markForRender(!0));}),(0,a.postLoadMesh)(this._mesh)):this._setMesh(this._mesh),this._updateRenderNode(),this._updateMaterial();},onDestroy:function(){this._setMesh(null),cc.pool.assembler.put(this._assembler);},_updateRenderNode:function(){this._assembler.setRenderNode(this.node);},_setMesh:function(t){cc.geomUtils&&t&&e.default.fromPoints(this._boundingBox,t._minPos,t._maxPos),this._mesh&&this._mesh.off("init-format",this._updateMeshAttribute,this),t&&t.on("init-format",this._updateMeshAttribute,this),this._mesh=t,this._updateMeshAttribute();},_getDefaultMaterial:function(){return l.getBuiltinMaterial("unlit");},_validateRender:function(){var t=this._mesh;t&&0<t._subDatas.length||this.disableRender();},_updateMaterial:function(){var t=this.textures;if(t&&0<t.length){var e=this._getDefaultMaterial();for(var i=0;i<t.length;i++){var r=this._materials[i];r&&r._uuid!==e._uuid||(r||(r=E.default.create(e,this),this.setMaterial(i,r)),r.setProperty("diffuseTexture",t[i]));}}this._updateReceiveShadow(),this._updateCastShadow(),this._updateMeshAttribute();},_updateReceiveShadow:function(){var t=this.getMaterials();for(var e=0;e<t.length;e++)t[e].define("CC_USE_SHADOW_MAP",this._receiveShadows,void 0,!0);},_updateCastShadow:function(){var t=this.getMaterials();for(var e=0;e<t.length;e++)t[e].define("CC_CASTING_SHADOW",this._shadowCastingMode===i.ON,void 0,!0);},_updateMeshAttribute:function(){var t=this._mesh&&this._mesh.subDatas;if(t){var e=this.getMaterials();for(var i=0;i<e.length&&t[i];i++){var r=t[i].vfm;var n=e[i];n.define("CC_USE_ATTRIBUTE_COLOR",!!r.element(S.default.ATTR_COLOR),void 0,!0),n.define("CC_USE_ATTRIBUTE_UV0",!!r.element(S.default.ATTR_UV0),void 0,!0),n.define("CC_USE_ATTRIBUTE_NORMAL",!!r.element(S.default.ATTR_NORMAL),void 0,!0),n.define("CC_USE_ATTRIBUTE_TANGENT",!!r.element(S.default.ATTR_TANGENT),void 0,!0);}for(var a in this._debugDatas)this._debugDatas[a].length=0;}},_checkBacth:function(){}});var h=cc.Color.BLACK;var I=cc.Color.RED;var M=[cc.v3(),cc.v3()];var B=cc.mat4();var u={normal:function(t,h,e,i){e=e.vfm;var u=e.element(S.default.ATTR_NORMAL);var r=e.element(S.default.ATTR_POSITION);var n=e.element(S.default.ATTR_JOINTS);var a=e.element(S.default.ATTR_WEIGHTS);if(u&&r){var _=[];var o=[];var d;w.default.set(M[0],5,0,0),R.default.invert(B,t.node._worldMatrix),w.default.transformMat4Normal(M[0],M[0],B),d=M[0].mag();e=t.mesh;var s=e._getAttrMeshData(i,S.default.ATTR_POSITION);var f=e._getAttrMeshData(i,S.default.ATTR_NORMAL);var p=e._getAttrMeshData(i,S.default.ATTR_JOINTS);var m=e._getAttrMeshData(i,S.default.ATTR_WEIGHTS);var v=s.length/r.num;for(var c=0;c<v;c++){var y=c*u.num;var g=c*r.num;w.default.set(M[0],f[y],f[1+y],f[2+y]),w.default.set(M[1],s[g],s[1+g],s[2+g]),w.default.scaleAndAdd(M[0],M[1],M[0],d);for(var l=0;l<2;l++){if(o.push(M[l].x,M[l].y,M[l].z),n){var b=c*n.num;for(var C=0;C<n.num;C++)o.push(p[b+C]);}if(a){var x=c*a.num;for(var A=0;A<a.num;A++)o.push(m[x+A]);}}_.push(2*c,2*c+1);}t=[{name:S.default.ATTR_POSITION,type:S.default.ATTR_TYPE_FLOAT32,num:3}];n&&t.push({name:S.default.ATTR_JOINTS,type:S.default.ATTR_TYPE_FLOAT32,num:n.num}),a&&t.push({name:S.default.ATTR_WEIGHTS,type:S.default.ATTR_TYPE_FLOAT32,num:a.num});e=new S.default.VertexFormat(t);i=new S.default.VertexBuffer(P.device,e,S.default.USAGE_STATIC,new Float32Array(o));t=new Uint16Array(_);e=new S.default.IndexBuffer(P.device,S.default.INDEX_FMT_UINT16,S.default.USAGE_STATIC,t,t.length);t=E.default.createWithBuiltin("unlit");return t.setProperty("diffuseColor",I),{material:t,ia:new T.default(i,e,S.default.PT_LINES)};}},wireFrame:function(l,t,e){var i=e.getIData(Uint16Array);e=E.default.createWithBuiltin("unlit");e.setProperty("diffuseColor",h);var r=[];for(var n=0;n<i.length;n+=3){var a=i[n+0];var o=i[n+1];var s=i[n+2];r.push(a,o,o,s,s,a);}var c=new Uint16Array(r);c=new S.default.IndexBuffer(P.device,S.default.INDEX_FMT_UINT16,S.default.USAGE_STATIC,c,c.length);return{material:e,ia:new T.default(t._vertexBuffer,c,S.default.PT_LINES)};}};t.prototype._updateDebugDatas=function(){var t=this._debugDatas;var e=this._mesh.subMeshes;var i=this._mesh._subDatas;for(var r in t){var n=t[r];if(n.length!==e.length&&cc.macro["SHOW_MESH_"+r.toUpperCase()]){n.length=e.length;for(var a=0;a<e.length;a++)n[a]=u[r](this,e[a],i[a],a);}}},cc.MeshRenderer=r.exports=t;},{"../../renderer/core/input-assembler":302,"../../renderer/gfx":312,"../assets/material/CCMaterial":53,"../assets/material/material-variant":60,"../components/CCRenderComponent":89,"../geom-utils/aabb":119,"../renderer":220,"../renderer/render-flow":221,"../utils/mesh-util":263,"../value-types/mat4":281,"../value-types/vec3":289,"./CCMesh":156}],158:[function(t,e,i){"use strict";t("./CCMesh"),t("./CCMeshRenderer"),t("./mesh-renderer");},{"./CCMesh":156,"./CCMeshRenderer":157,"./mesh-renderer":160}],159:[function(t,e,i){"use strict";i.__esModule=!0,i.MeshData=MeshData,i.Primitive=i.VertexBundle=i.VertexFormat=i.BufferRange=void 0;t=(t=t("../../renderer/gfx"))&&t.__esModule?t:{default:t};var r=cc.Class({name:"cc.BufferRange",properties:{offset:0,length:0}});i.BufferRange=r;var n=cc.Class({name:"cc.mesh.VertexFormat",properties:{name:"",type:-1,num:-1,normalize:!1}});i.VertexFormat=n;n=cc.Class({name:"cc.mesh.VertexBundle",properties:{data:{default:null,type:r},formats:{default:[],type:n},verticesCount:0}});i.VertexBundle=n;n=cc.Class({name:"cc.mesh.Primitive",properties:{vertexBundleIndices:{default:[],type:cc.Float},data:{default:null,type:r},indexUnit:t.default.INDEX_FMT_UINT16,topology:t.default.PT_TRIANGLES}});function MeshData(){this.vData=null,this.float32VData=null,this.uint32VData=null,this.iData=null,this.uint16IData=null,this.vfm=null,this.offset=0,this.vb=null,this.ib=null,this.vDirty=!1,this.iDirty=!1,this.enable=!0;}i.Primitive=n,MeshData.prototype.setVData=function(t){this.vData=t,this.float32VData=null,this.uint32VData=null;},MeshData.prototype.getVData=function(t){return t===Float32Array?(this.float32VData||(this.float32VData=new Float32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.float32VData):t===Uint32Array?(this.uint32VData||(this.uint32VData=new Uint32Array(this.vData.buffer,this.vData.byteOffset,this.vData.byteLength/4)),this.uint32VData):this.vData;},MeshData.prototype.getIData=function(t){return t===Uint16Array?(this.uint16IData||(this.uint16IData=new Uint16Array(this.iData.buffer,this.iData.byteOffset,this.iData.byteLength/2)),this.uint16IData):this.iData;};},{"../../renderer/gfx":312}],160:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("../renderer/assembler"));var p=_interopRequireDefault(t("../../renderer/gfx"));var m=_interopRequireDefault(t("../value-types/vec3"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}t=t("./CCMeshRenderer");var v=new m.default();var n=function(e){var t;t=e,(i=MeshRendererAssembler).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;_createSuper(MeshRendererAssembler);function MeshRendererAssembler(){return e.apply(this,arguments)||this;}var i=MeshRendererAssembler.prototype;return i.init=function(t){e.prototype.init.call(this,t),this._worldDatas={},this._renderNode=null;},i.setRenderNode=function(t){this._renderNode=t;},i.fillBuffers=function(t,e){if(t.mesh){t.mesh._uploadData();var i=e.cullingMask===t.node._cullingMask;var r=t.enableAutoBatch;var n=t._materials;var a=t.mesh._subMeshes;var h=t.mesh.subDatas;for(var o=0;o<a.length;o++){var s=a[o];var c=h[o];var l=n[o]||n[0];r&&c.canBatch&&s._primitiveType===p.default.PT_TRIANGLES?(i&&l.getHash()===e.material.getHash()||e._flush(),e.material=l,e.cullingMask=t.node._cullingMask,e.node=e._dummyNode,this._fillBuffer(t,c,e,o)):(e._flush(),e.material=l,e.cullingMask=t.node._cullingMask,e.node=this._renderNode,e._flushIA(s));}!cc.macro.SHOW_MESH_WIREFRAME&&!cc.macro.SHOW_MESH_NORMAL||t.node._cullingMask&1<<cc.Node.BuiltinGroupIndex.DEBUG||(e._flush(),e.node=this._renderNode,t._updateDebugDatas(),cc.macro.SHOW_MESH_WIREFRAME&&this._drawDebugDatas(t,e,"wireFrame"),cc.macro.SHOW_MESH_NORMAL&&this._drawDebugDatas(t,e,"normal"));}},i._fillBuffer=function(h,t,e,i){var r=t.getVData(Float32Array);var n=t.vfm;var a=r.byteLength/n._bytes|0;var o=t.getIData(Uint16Array);var s=o.length;t=e.getBuffer("mesh",n);var c=t.request(a,s);var u=c.indiceOffset,_=c.byteOffset>>2,d=c.vertexOffset,c=t._vData,f=t._iData;!e.worldMatDirty&&this._worldDatas[i]||this._updateWorldVertices(i,a,r,n,h.node._worldMatrix),c.set(this._worldDatas[i],_);for(var l=0;l<s;l++)f[u+l]=d+o[l];},i._updateWorldVertices=function(t,e,i,r,h){var n=this._worldDatas[t];n||(n=this._worldDatas[t]=new Float32Array(i.length)).set(i);var u=r._bytes/4;var a=r._elements;for(var o=0,_=a.length;o<_;o++){var s=a[o];var d=s.offset/4;if(s.name===p.default.ATTR_POSITION||s.name===p.default.ATTR_NORMAL){var f=s.name===p.default.ATTR_NORMAL?m.default.transformMat4Normal:m.default.transformMat4;for(var c=0;c<e;c++){var l=c*u+d;v.x=i[l],v.y=i[1+l],v.z=i[2+l],f(v,v,h),n[l]=v.x,n[1+l]=v.y,n[2+l]=v.z;}}}},i._drawDebugDatas=function(t,e,i){var r=t._debugDatas[i];if(r)for(var n=0;n<r.length;n++){var a=r[n];var o;a&&(o=a.material,e.material=o,e._flushIA(a.ia));}},MeshRendererAssembler;}(r.default);i.default=n,r.default.register(t,n),e.exports=i.default;},{"../../renderer/gfx":312,"../renderer/assembler":217,"../value-types/vec3":289,"./CCMeshRenderer":157}],161:[function(t,r,c){"use strict";var i=t("./component-scheduler");var e=t("./platform/CCObject").Flags;var _=t("./platform/js");var a=e.IsPreloadStarted;var o=e.IsOnLoadStarted;var n=e.IsOnLoadCalled;var d=e.Deactivating;var l=cc.Class({extends:i.LifeCycleInvoker,add:function(t){this._zero.array.push(t);},remove:function(t){this._zero.fastRemove(t);},cancelInactive:function(t){i.LifeCycleInvoker.stableRemoveInactive(this._zero,t);},invoke:function(){this._invoke(this._zero),this._zero.array.length=0;}});var h=i.createInvokeImpl(function(t){t.__preload();},!1,void 0,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].__preload();});var u=i.createInvokeImpl(function(t){t.onLoad(),t._objFlags|=n;},!1,n,function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];i.onLoad(),i._objFlags|=n;}});var s=new _.Pool(4);function ctor(){this._activatingStack=[];}s.get=function(){var t=this._get()||{preload:new l(h),onLoad:new i.OneOffInvoker(u),onEnable:new i.OneOffInvoker(i.invokeOnEnable)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t;};t=cc.Class({ctor:ctor,reset:ctor,_activateNodeRecursively:function(t,e,i,r){if(t._objFlags&d)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;var n=t._components.length;for(var a=0;a<n;++a){var o=t._components[a];o instanceof cc.Component?this.activateComp(o,e,i,r):(s=t,h=a,(o=o)?s._removeComponent(o):_.array.removeAt(s._components,h),--a,--n);}var s,h;t._childArrivalOrder=t._children.length;for(var c=0,u=t._children.length;c<u;++c){var l=t._children[c];l._localZOrder=4294901760&l._localZOrder|c+1,l._active&&this._activateNodeRecursively(l,e,i,r);}t._onPostActivated(!0);}},_deactivateNodeRecursively:function(t){t._objFlags|=d,t._activeInHierarchy=!1;var e=t._components.length;for(var i=0;i<e;++i){var r=t._components[i];if(r._enabled&&(cc.director._compScheduler.disableComp(r),t._activeInHierarchy))return void(t._objFlags&=~d);}for(var n=0,a=t._children.length;n<a;++n){var o=t._children[n];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~d);}t._onPostActivated(!1),t._objFlags&=~d;},activateNode:function(t,e){if(e){e=s.get();this._activatingStack.push(e),this._activateNodeRecursively(t,e.preload,e.onLoad,e.onEnable),e.preload.invoke(),e.onLoad.invoke(),e.onEnable.invoke(),this._activatingStack.pop(),s.put(e);}else{this._deactivateNodeRecursively(t);var i=this._activatingStack;for(var r=0;r<i.length;r++){var n=i[r];n.preload.cancelInactive(a),n.onLoad.cancelInactive(o),n.onEnable.cancelInactive();}}t.emit("active-in-hierarchy-changed",t);},activateComp:function(t,e,i,r){cc.isValid(t,!0)&&(t._objFlags&a||(t._objFlags|=a,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&o||(t._objFlags|=o,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=n):t._objFlags|=n),!t._enabled||t.node._activeInHierarchy&&cc.director._compScheduler.enableComp(t,r));},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&n&&t.onDestroy();},resetComp:!1});r.exports=t;},{"./component-scheduler":72,"./platform/CCObject":195,"./platform/js":209,"./utils/misc":264}],162:[function(t,e,r){"use strict";var l=t("./CCPhysicsTypes").PTM_RATIO;var h=t("./CCPhysicsTypes").ContactType;var i=[];var d=[cc.v2(),cc.v2()];var c=new b2.WorldManifold();var u={points:[],separations:[],normal:cc.v2()};function ManifoldPoint(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0;}var f=[new ManifoldPoint(),new ManifoldPoint()];new b2.Manifold();var _={type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]};var a={normalImpulses:[],tangentImpulses:[]};function PhysicsContact(){}PhysicsContact.prototype.init=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,(this._b2contact=t)._contact=this;},PhysicsContact.prototype.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null;},PhysicsContact.prototype.getWorldManifold=function(){var t=u.points;var e=u.separations;var i=u.normal;this._b2contact.GetWorldManifold(c);var r=c.points;var n=c.separations;var a=this._b2contact.GetManifold().pointCount;t.length=e.length=a;for(var o=0;o<a;o++){var s=d[o];s.x=r[o].x*l,s.y=r[o].y*l,t[o]=s,e[o]=n[o]*l;}return i.x=c.normal.x,i.y=c.normal.y,this._inverted&&(i.x*=-1,i.y*=-1),u;},PhysicsContact.prototype.getManifold=function(){var t=_.points;var e=_.localNormal;var i=_.localPoint;var r=this._b2contact.GetManifold();var n=r.points;var a=t.length=r.pointCount;for(var o=0;o<a;o++){var s=f[o];var c=n[o];s.localPoint.x=c.localPoint.x*l,s.localPoint.Y=c.localPoint.Y*l,s.normalImpulse=c.normalImpulse*l,s.tangentImpulse=c.tangentImpulse,t[o]=s;}return i.x=r.localPoint.x*l,i.y=r.localPoint.y*l,e.x=r.localNormal.x,e.y=r.localNormal.y,_.type=r.type,this._inverted&&(e.x*=-1,e.y*=-1),_;},PhysicsContact.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;var e=a.normalImpulses;var i=a.tangentImpulses;var r=t.count;for(var n=0;n<r;n++)e[n]=t.normalImpulses[n]*l,i[n]=t.tangentImpulses[n];return i.length=e.length=r,a;},PhysicsContact.prototype.emit=function(t){var e;switch(t){case h.BEGIN_CONTACT:e="onBeginContact";break;case h.END_CONTACT:e="onEndContact";break;case h.PRE_SOLVE:e="onPreSolve";break;case h.POST_SOLVE:e="onPostSolve";}var i=this.colliderA;var r=this.colliderB;t=i.body;var n=r.body;var a;var o,s,c;if(t.enabledContactListener)for(a=t.node._components,this._inverted=!1,o=0,s=a.length;o<s;o++)(c=a[o])[e]&&c[e](this,i,r);if(n.enabledContactListener)for(a=n.node._components,this._inverted=!0,o=0,s=a.length;o<s;o++)(c=a[o])[e]&&c[e](this,r,i);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1);},PhysicsContact.get=function(t){var e;return(e=0===i.length?new cc.PhysicsContact():i.pop()).init(t),e;},PhysicsContact.put=function(t){t=t._contact;t&&(i.push(t),t.reset());};t=PhysicsContact.prototype;t.setEnabled=function(t){this._b2contact.SetEnabled(t);},t.isTouching=function(){return this._b2contact.IsTouching();},t.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/l);},t.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*l;},t.setFriction=function(t){this._b2contact.SetFriction(t);},t.getFriction=function(){return this._b2contact.GetFriction();},t.resetFriction=function(){return this._b2contact.ResetFriction();},t.setRestitution=function(t){this._b2contact.SetRestitution(t);},t.getRestitution=function(){return this._b2contact.GetRestitution();},t.resetRestitution=function(){return this._b2contact.ResetRestitution();},PhysicsContact.ContactType=h,cc.PhysicsContact=e.exports=PhysicsContact;},{"./CCPhysicsTypes":164}],163:[function(t,n,a){"use strict";var e=t("./CCPhysicsTypes");var i=e.ContactType;var c=e.BodyType;var d=e.RayCastType;var o=e.DrawBits;var f=e.PTM_RATIO;e.ANGLE_TO_PHYSICS_ANGLE;var h=e.PHYSICS_ANGLE_TO_ANGLE;var u=t("./utils").convertToNodeRotation;var _=t("./platform/CCPhysicsDebugDraw");var r=new b2.AABB();var p=new b2.Vec2();var m=new b2.Vec2();var s=cc.v2();var l=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:o,PTM_RATIO:f,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._joints=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.enabledAccumulator=!1;},pushDelayEvent:function(t,e,i){this._steping?this._delayEvents.push({target:t,func:e,args:i}):t[e].apply(t,i);},update:function(t){var e=this._world;if(e&&this.enabled){this.emit("before-step"),this._steping=!0;var i=l.VELOCITY_ITERATIONS;var r=l.POSITION_ITERATIONS;if(this.enabledAccumulator){this._accumulator+=t;var n=l.FIXED_TIME_STEP;t=l.MAX_ACCUMULATOR;for(this._accumulator>t&&(this._accumulator=t);this._accumulator>n;)e.Step(n,i,r),this._accumulator-=n;}else{t=1/cc.game.config.frameRate;e.Step(t,i,r);}this.debugDrawFlags&&(this._checkDebugDrawValid(),this._debugDrawer.clear(),e.DrawDebugData()),this._steping=!1;var a=this._delayEvents;for(var o=0,s=a.length;o<s;o++){var c=a[o];c.target[c.func].apply(c.target,c.args);}a.length=0,this._syncNode();}},testPoint:function(t){var e=p.x=t.x/f;t=p.y=t.y/f;var i=.2/f;r.lowerBound.x=e-i,r.lowerBound.y=t-i,r.upperBound.x=e+i,r.upperBound.y=t+i;e=this._aabbQueryCallback;e.init(p),this._world.QueryAABB(e,r);t=e.getFixture();return t?t.collider:null;},testAABB:function(t){r.lowerBound.x=t.xMin/f,r.lowerBound.y=t.yMin/f,r.upperBound.x=t.xMax/f,r.upperBound.y=t.yMax/f;t=this._aabbQueryCallback;return t.init(),this._world.QueryAABB(t,r),t.getFixtures().map(function(t){return t.collider;});},rayCast:function(t,e,i){if(t.equals(e))return[];i=i||d.Closest,p.x=t.x/f,p.y=t.y/f,m.x=e.x/f,m.y=e.y/f;t=this._raycastQueryCallback;t.init(i),this._world.RayCast(t,p,m);var r=t.getFixtures();if(0<r.length){var n=t.getPoints();var a=t.getNormals();var o=t.getFractions();var h=[];for(var s=0,u=r.length;s<u;s++){var _=r[s];var c=_.collider;if(i===d.AllClosest){var l=h.find(function(t){return t.collider===c;});if(l){o[s]<l.fraction&&(l.fixtureIndex=c._getFixtureIndex(_),l.point.x=n[s].x*f,l.point.y=n[s].y*f,l.normal.x=a[s].x,l.normal.y=a[s].y,l.fraction=o[s]);continue;}}h.push({collider:c,fixtureIndex:c._getFixtureIndex(_),point:cc.v2(n[s].x*f,n[s].y*f),normal:cc.v2(a[s]),fraction:o[s]});}return h;}return[];},syncPosition:function(){var t=this._bodies;for(var e=0;e<t.length;e++)t[e].syncPosition();},syncRotation:function(){var t=this._bodies;for(var e=0;e<t.length;e++)t[e].syncRotation();},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t);},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t);},_addBody:function(t,e){var i=this._world;var r=t.node;i&&r&&(t._b2Body=i.CreateBody(e),t._b2Body.body=t,this._bodies.push(t));},_removeBody:function(t){var e=this._world;e&&(t._b2Body.body=null,e.DestroyBody(t._b2Body),t._b2Body=null,cc.js.array.remove(this._bodies,t));},_addJoint:function(t,e){e=this._world.CreateJoint(e);e&&((e._joint=t)._joint=e,this._joints.push(t));},_removeJoint:function(t){t._isValid()&&this._world.DestroyJoint(t._joint),t._joint&&(t._joint._joint=null),cc.js.array.remove(this._joints,t);},_initCallback:function(){var t;this._world?this._contactListener||((t=new cc.PhysicsContactListener()).setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback(),this._raycastQueryCallback=new cc.PhysicsRayCastCallback()):cc.warn("Please init PhysicsManager first");},_init:function(){this.enabled=!0,this.debugDrawFlags=o.e_shapeBit;},_getWorld:function(){return this._world;},_syncNode:function(){var t=this._bodies;for(var e=0,i=t.length;e<i;e++){var r=t[e];var n=r.node;var a=r._b2Body;var o=a.GetPosition();s.x=o.x*f,s.y=o.y*f;o=a.GetAngle()*h;null!==n.parent.parent&&(s=n.parent.convertToNodeSpaceAR(s),o=u(n.parent,o));a=n._eventMask;n._eventMask=0,n.position=s,n.angle=-o,n._eventMask=a,r.type===c.Animated&&r.resetVelocity();}},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(i.BEGIN_CONTACT);},_onEndContact:function(t){var e=t._contact;e&&(e.emit(i.END_CONTACT),cc.PhysicsContact.put(t));},_onPreSolve:function(t){t=t._contact;t&&t.emit(i.PRE_SOLVE);},_onPostSolve:function(t,e){t=t._contact;t&&(t._impulse=e,t.emit(i.POST_SOLVE),t._impulse=null);},_checkDebugDrawValid:function(){var t;this._debugDrawer&&this._debugDrawer.isValid||((t=new cc.Node("PHYSICS_MANAGER_DEBUG_DRAW")).zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(t),this._debugDrawer=t.addComponent(cc.Graphics),(t=new _(this._debugDrawer)).SetFlags(this.debugDrawFlags),this._world.SetDebugDraw(t));}});cc.js.getset(l.prototype,"enabled",function(){return this._enabled;},function(t){var e;t&&!this._world&&((e=new b2.World(new b2.Vec2(0,-10))).SetAllowSleeping(!0),this._world=e,this._initCallback()),this._enabled=t;}),cc.js.getset(l.prototype,"debugDrawFlags",function(){return this._debugDrawFlags;},function(t){t&&!this._debugDrawFlags?this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!0):!t&&this._debugDrawFlags&&this._debugDrawer&&this._debugDrawer.node&&(this._debugDrawer.node.active=!1),t&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t)),(this._debugDrawFlags=t)&&(this._checkDebugDrawValid(),this._world.m_debugDraw.SetFlags(t));}),cc.js.getset(l.prototype,"gravity",function(){var t;return this._world?(t=this._world.GetGravity(),cc.v2(t.x*f,t.y*f)):cc.v2();},function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/f,t.y/f));}),cc.PhysicsManager=n.exports=l;},{"./CCPhysicsTypes":164,"./platform/CCPhysicsDebugDraw":185,"./utils":187}],164:[function(t,e,i){"use strict";var r=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3});cc.RigidBodyType=r;var n=cc.Enum({Closest:0,Any:1,AllClosest:2,All:3});cc.RayCastType=n,e.exports={BodyType:r,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:n,DrawBits:b2.DrawFlags,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI};},{}],165:[function(t,e,i){"use strict";function At(t,e){var i=e.length;return e[t<0?i- -t%i:t%i];}function Copy(t,e,i){var r=[];for(;e<t;)e+=i.length;for(;t<=e;++t)r.push(At(t,i));return r;}function Reflex(t,e){return Right(t,e);}function Right(t,e,i){var r,n;return void 0===i&&(t=At((r=t)-1,n=e),e=At(r,n),i=At(r+1,n)),Area(t,e,i)<0;}function Left(t,e,i){return 0<Area(t,e,i);}function LeftOn(t,e,i){return 0<=Area(t,e,i);}function RightOn(t,e,i){return Area(t,e,i)<=0;}function SquareDist(t,e){var i=e.x-t.x;e=e.y-t.y;return i*i+e*e;}function ForceCounterClockWise(t){IsCounterClockWise(t)||t.reverse();}function IsCounterClockWise(t){return t.length<3||0<function(t){var e;var i=0;for(e=0;e<t.length;e++){var r=(e+1)%t.length;i=(i+=t[e].x*t[r].y)-t[e].y*t[r].x;}return i/=2;}(t);}function LineIntersect(t,e,i,r){var n=cc.v2();var a=e.y-t.y;e=t.x-e.x;t=a*t.x+e*t.y;var o=r.y-i.y;r=i.x-r.x;i=o*i.x+r*i.y;var s=a*r-o*e;var c;return c=0,Math.abs(s-c)<=1e-6||(n.x=(r*t-e*i)/s,n.y=(a*i-o*t)/s),n;}function Area(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y);}e.exports={ConvexPartition:function ConvexPartition(t){ForceCounterClockWise(t);var e=[];var i,r,h;var n;var u=cc.v2();var _=cc.v2();var a=0,o=0;var d,f;for(var s=0;s<t.length;++s)if(Reflex(s,t)){r=h=1e8;for(var c=0;c<t.length;++c)Left(At(s-1,t),At(s,t),At(c,t))&&RightOn(At(s-1,t),At(s,t),At(c-1,t))&&(n=LineIntersect(At(s-1,t),At(s,t),At(c,t),At(c-1,t)),Right(At(s+1,t),At(s,t),n)&&(i=SquareDist(At(s,t),n))<r&&(r=i,u=n,a=c)),Left(At(s+1,t),At(s,t),At(c+1,t))&&RightOn(At(s+1,t),At(s,t),At(c,t))&&(n=LineIntersect(At(s+1,t),At(s,t),At(c,t),At(c+1,t)),Left(At(s-1,t),At(s,t),n)&&(i=SquareDist(At(s,t),n))<h&&(h=i,o=c,_=n));if(a==(o+1)%t.length){var p=u.add(_).div(2);(d=Copy(s,o,t)).push(p),(f=Copy(a,s,t)).push(p);}else{var m=0,v=a;for(;o<a;)o+=t.length;for(c=a;c<=o;++c){var l;!function(t,e,i){if(Reflex(t,i)){if(LeftOn(At(t,i),At(t-1,i),At(e,i))&&RightOn(At(t,i),At(t+1,i),At(e,i)))return;}else if(RightOn(At(t,i),At(t+1,i),At(e,i))||LeftOn(At(t,i),At(t-1,i),At(e,i)))return;if(Reflex(e,i)){if(LeftOn(At(e,i),At(e-1,i),At(t,i))&&RightOn(At(e,i),At(e+1,i),At(t,i)))return;}else if(RightOn(At(e,i),At(e+1,i),At(t,i))||LeftOn(At(e,i),At(e-1,i),At(t,i)))return;for(var r=0;r<i.length;++r)if((r+1)%i.length!=t&&r!=t&&(r+1)%i.length!=e&&r!=e){var n=cc.v2();if(function(t,e,i,r,h){if(t!=i&&t!=r&&e!=i&&e!=r){var n=t.x;t=t.y;var a=e.x;e=e.y;var o=i.x;i=i.y;var s=r.x;var c,l;if(r=r.y,!(Math.max(n,a)<Math.min(o,s)||Math.max(o,s)<Math.min(n,a)))if(!(Math.max(t,e)<Math.min(i,r)||Math.max(i,r)<Math.min(t,e)))return c=(s-o)*(t-i)-(r-i)*(n-o),l=(a-n)*(t-i)-(e-t)*(n-o),r=(r-i)*(a-n)-(s-o)*(e-t),Math.abs(r)<1e-6?void 0:(l/=r,0<(c/=r)&&c<1&&0<l&&l<1&&(h.x=n+c*(a-n),h.y=t+c*(e-t),1));}}(At(t,i),At(e,i),At(r,i),At(r+1,i),n))return;}return 1;}(s,c,t)||(l=1/(SquareDist(At(s,t),At(c,t))+1),Reflex(c,t)?RightOn(At(c-1,t),At(c,t),At(s,t))&&LeftOn(At(c+1,t),At(c,t),At(s,t))?l+=3:l+=2:l+=1,m<l&&(v=c,m=l));}d=Copy(s,v,t),f=Copy(v,s,t);}return e=(e=e.concat(ConvexPartition(d))).concat(ConvexPartition(f));}e.push(t);for(s=e.length-1;0<=s;s--)0==e[s].length&&e.splice(s,0);return e;},ForceCounterClockWise:ForceCounterClockWise,IsCounterClockWise:IsCounterClockWise};},{}],166:[function(t,h,u){"use strict";var e=t("../CCNode").EventType;var n=t("./CCPhysicsTypes").PTM_RATIO;var a=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;var i=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE;var o=t("./utils").getWorldRotation;var s=t("./CCPhysicsTypes").BodyType;var r=new b2.Vec2();var c=new b2.Vec2();var l=cc.Vec2.ZERO;t=cc.Class({name:"cc.RigidBody",extends:cc.Component,editor:!1,properties:{_type:s.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled;},set:function(){cc.warnID(8200);},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:s,tooltip:!1,get:function(){return this._type;},set:function(t){this._type=t,this._b2Body&&(t===s.Animated?this._b2Body.SetType(s.Kinematic):this._b2Body.SetType(t));}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep;},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetSleepingAllowed(t);}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale;},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t);}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping;},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping);}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping;},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t);}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t=this._linearVelocity;var e;return this._b2Body&&(e=this._b2Body.GetLinearVelocity(),t.x=e.x*n,t.y=e.y*n),t;},set:function(t){this._linearVelocity=t;var e=this._b2Body;var i;e&&((i=e.m_linearVelocity).Set(t.x/n,t.y/n),e.SetLinearVelocity(i));}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*i:this._angularVelocity;},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*a);}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation;},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t);}},awake:{visible:!1,tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake();},set:function(t){this._b2Body&&this._b2Body.SetAwake(t);}},awakeOnLoad:{default:!0,tooltip:!1,animatable:!1},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive();},set:function(t){this._b2Body&&this._b2Body.SetActive(t);}}},getLocalPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(r.Set(t.x/n,t.y/n),t=this._b2Body.GetLocalPoint(r,e),e.x=t.x*n,e.y=t.y*n),e;},getWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(r.Set(t.x/n,t.y/n),t=this._b2Body.GetWorldPoint(r,e),e.x=t.x*n,e.y=t.y*n),e;},getWorldVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(r.Set(t.x/n,t.y/n),t=this._b2Body.GetWorldVector(r,e),e.x=t.x*n,e.y=t.y*n),e;},getLocalVector:function(t,e){return e=e||cc.v2(),this._b2Body&&(r.Set(t.x/n,t.y/n),t=this._b2Body.GetLocalVector(r,e),e.x=t.x*n,e.y=t.y*n),e;},getWorldPosition:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetPosition(),t.x=e.x*n,t.y=e.y*n),t;},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*i:0;},getLocalCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetLocalCenter(),t.x=e.x*n,t.y=e.y*n),t;},getWorldCenter:function(t){var e;return t=t||cc.v2(),this._b2Body&&(e=this._b2Body.GetWorldCenter(),t.x=e.x*n,t.y=e.y*n),t;},getLinearVelocityFromWorldPoint:function(t,e){return e=e||cc.v2(),this._b2Body&&(r.Set(t.x/n,t.y/n),t=this._b2Body.GetLinearVelocityFromWorldPoint(r,e),e.x=t.x*n,e.y=t.y*n),e;},getMass:function(){return this._b2Body?this._b2Body.GetMass():0;},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*n*n:0;},getJointList:function(){if(!this._b2Body)return[];var t=[];var e=this._b2Body.GetJointList();if(!e)return[];t.push(e.joint._joint);var i=e.prev;for(;i;)t.push(i.joint._joint),i=i.prev;var r=e.next;for(;r;)t.push(r.joint._joint),r=r.next;return t;},applyForce:function(t,e,i){this._b2Body&&(r.Set(t.x/n,t.y/n),c.Set(e.x/n,e.y/n),this._b2Body.ApplyForce(r,c,i));},applyForceToCenter:function(t,e){this._b2Body&&(r.Set(t.x/n,t.y/n),this._b2Body.ApplyForceToCenter(r,e));},applyTorque:function(t,e){this._b2Body&&this._b2Body.ApplyTorque(t/n,e);},applyLinearImpulse:function(t,e,i){this._b2Body&&(r.Set(t.x/n,t.y/n),c.Set(e.x/n,e.y/n),this._b2Body.ApplyLinearImpulse(r,c,i));},applyAngularImpulse:function(t,e){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/n/n,e);},syncPosition:function(t){var e=this._b2Body;var i,r;e&&(r=this.node.convertToWorldSpaceAR(l),(i=this.type===s.Animated?e.GetLinearVelocity():e.GetPosition()).x=r.x/n,i.y=r.y/n,this.type===s.Animated&&t?(r=e.GetPosition(),t=cc.game.config.frameRate,i.x=(i.x-r.x)*t,i.y=(i.y-r.y)*t,e.SetAwake(!0),e.SetLinearVelocity(i)):e.SetTransformVec(i,e.GetAngle()));},syncRotation:function(t){var e=this._b2Body;var i,r;e&&(i=a*o(this.node),this.type===s.Animated&&t?(t=e.GetAngle(),r=cc.game.config.frameRate,e.SetAwake(!0),e.SetAngularVelocity((i-t)*r)):e.SetTransformVec(e.GetPosition(),i));},resetVelocity:function(){var t=this._b2Body;var e;t&&((e=t.m_linearVelocity).Set(0,0),t.SetLinearVelocity(e),t.SetAngularVelocity(0));},onEnable:function(){this._init();},onDisable:function(){this._destroy();},_registerNodeEvents:function(){var t=this.node;t.on(e.POSITION_CHANGED,this._onNodePositionChanged,this),t.on(e.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.on(e.SCALE_CHANGED,this._onNodeScaleChanged,this);},_unregisterNodeEvents:function(){var t=this.node;t.off(e.POSITION_CHANGED,this._onNodePositionChanged,this),t.off(e.ROTATION_CHANGED,this._onNodeRotationChanged,this),t.off(e.SCALE_CHANGED,this._onNodeScaleChanged,this);},_onNodePositionChanged:function(){this.syncPosition(!0);},_onNodeRotationChanged:function(t){this.syncRotation(!0);},_onNodeScaleChanged:function(t){if(this._b2Body){var e=this.getComponents(cc.PhysicsCollider);for(var i=0;i<e.length;i++)e[i].apply();}},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[]);},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[]);},__init:function(){var t,e,i;this._inited||(this._registerNodeEvents(),t=new b2.BodyDef(),this.type===s.Animated?t.type=s.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping,e=this.linearVelocity,t.linearVelocity=new b2.Vec2(e.x/n,e.y/n),t.angularVelocity=this.angularVelocity*a,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet,i=(e=this.node).convertToWorldSpaceAR(l),t.position=new b2.Vec2(i.x/n,i.y/n),t.angle=-Math.PI/180*o(e),t.awake=this.awakeOnLoad,cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0);},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1);},_getBody:function(){return this._b2Body;}});cc.RigidBody=h.exports=t;},{"../CCNode":30,"./CCPhysicsTypes":164,"./utils":187}],167:[function(t,e,i){"use strict";var r=t("../../../external/box2d/box2d");for(var n in window.b2={},r){var a;-1===n.indexOf("b2_")&&(a=n.replace("b2",""),b2[a]=r[n]);}b2.maxPolygonVertices=8;},{"../../../external/box2d/box2d":362}],168:[function(t,e,i){"use strict";var a=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.PhysicsBoxCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x);t=Math.abs(t.y);var i=this.size.width/2/a*e;var r=this.size.height/2/a*t;e=this.offset.x/a*e;t=this.offset.y/a*t;var n=new b2.PolygonShape();return n.SetAsBox(i,r,new b2.Vec2(e,t),0),n;}});cc.PhysicsBoxCollider=e.exports=t;},{"../CCPhysicsTypes":164}],169:[function(t,e,i){"use strict";var o=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.PhysicsChainCollider",extends:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},properties:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)];},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){var e=new b2.ChainShape();var i=this.points;var r=[];for(var n=0;n<i.length;n++){var a=i[n];r.push(new b2.Vec2(a.x/o*t.x,a.y/o*t.y));}return this.loop?e.CreateLoop(r,r.length):e.CreateChain(r,r.length),e;},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=e.exports=t;},{"../CCPhysicsTypes":164}],170:[function(t,e,i){"use strict";var n=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.PhysicsCircleCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x);t=Math.abs(t.y);var i=this.offset.x/n*e;t=this.offset.y/n*t;var r=new b2.CircleShape();return r.m_radius=this.radius/n*e,r.m_p=new b2.Vec2(i,t),r;}});cc.PhysicsCircleCollider=e.exports=t;},{"../CCPhysicsTypes":164}],171:[function(t,e,i){"use strict";var u=t("../CCPhysicsTypes").PTM_RATIO;var d=t("../utils").getWorldScale;t=cc.Class({name:"cc.PhysicsCollider",extends:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect();},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density;},set:function(t){this._density=t;}},sensor:{tooltip:!1,get:function(){return this._sensor;},set:function(t){this._sensor=t;}},friction:{tooltip:!1,get:function(){return this._friction;},set:function(t){this._friction=t;}},restitution:{tooltip:!1,get:function(){return this._restitution;},set:function(t){this._restitution=t;}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy();},onEnable:function(){this._init();},start:function(){this._init();},_getFixtureIndex:function(t){return this._fixtures.indexOf(t);},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[]);},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[]);},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var e=t._getBody();if(e){var i=t.node;var r=d(i);var n=0===(this._scale=r).x&&0===r.y?[]:this._createShape(r);n instanceof Array||(n=[n]);r=1<<i.groupIndex;var a=0;var o=cc.game.collisionMatrix[i.groupIndex];for(var s=0;s<o.length;s++)o[s]&&(a|=1<<s);var h={categoryBits:r,maskBits:a,groupIndex:0};var u=cc.director.getPhysicsManager();for(var c=0;c<n.length;c++){var _=n[c];var l=new b2.FixtureDef();l.density=this.density,l.isSensor=this.sensor,l.friction=this.friction,l.restitution=this.restitution,l.shape=_,l.filter=h;l=e.CreateFixture(l);l.collider=this,t.enabledContactListener&&u._registerContactFixture(l),this._shapes.push(_),this._fixtures.push(l);}this.body=t,this._inited=!0;}}}},__destroy:function(){if(this._inited){var t=this._fixtures;var e=this.body._getBody();var i=cc.director.getPhysicsManager();for(var r=t.length-1;0<=r;r--){var n=t[r];n.collider=null,i._unregisterContactFixture(n),e&&e.DestroyFixture(n);}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1;}},_createShape:function(){},apply:function(){this._destroy(),this._init();},getAABB:function(){var t=1e7,e=1e7;var i=-1e7,r=-1e7;var n=this._fixtures;for(var a=0;a<n.length;a++){var o=n[a];var h=o.GetShape().GetChildCount();for(var s=0;s<h;s++){var c=o.GetAABB(s);c.lowerBound.x<t&&(t=c.lowerBound.x),c.lowerBound.y<e&&(e=c.lowerBound.y),c.upperBound.x>i&&(i=c.upperBound.x),c.upperBound.y>r&&(r=c.upperBound.y);}}e*=u,i*=u,r*=u;var l=this._rect;return l.x=t*=u,l.y=e,l.width=i-t,l.height=r-e,l;}});cc.PhysicsCollider=e.exports=t;},{"../CCPhysicsTypes":164,"../utils":187}],172:[function(t,e,i){"use strict";var f=t("../CCPhysicsTypes").PTM_RATIO;var p=t("../CCPolygonSeparator");t=cc.Class({name:"cc.PhysicsPolygonCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=[];var i=this.points;0<i.length&&i[0].equals(i[i.length-1])&&--i.length;var h=p.ConvexPartition(i);var u=this.offset;for(var r=0;r<h.length;r++){var _=h[r];var n=null,a=[];var o=null;for(var s=0,d=_.length;s<d;s++){n=n||new b2.PolygonShape();var c=_[s];var l=(c.x+u.x)/f*t.x;c=(c.y+u.y)/f*t.y;l=new b2.Vec2(l,c);a.push(l),o=o||l,a.length===b2.maxPolygonVertices&&(n.Set(a,a.length),e.push(n),n=null,s<d-1&&(a=[o,a[a.length-1]]));}n&&(n.Set(a,a.length),e.push(n));}return e;}});cc.PhysicsPolygonCollider=e.exports=t;},{"../CCPhysicsTypes":164,"../CCPolygonSeparator":165}],173:[function(t,e,i){"use strict";t("./box2d-adapter"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback");},{"./CCPhysicsContact":162,"./CCPhysicsManager":163,"./CCRigidBody":166,"./box2d-adapter":167,"./collider/CCPhysicsBoxCollider":168,"./collider/CCPhysicsChainCollider":169,"./collider/CCPhysicsCircleCollider":170,"./collider/CCPhysicsCollider":171,"./collider/CCPhysicsPolygonCollider":172,"./joint/CCDistanceJoint":174,"./joint/CCJoint":175,"./joint/CCMotorJoint":176,"./joint/CCMouseJoint":177,"./joint/CCPrismaticJoint":178,"./joint/CCRevoluteJoint":179,"./joint/CCRopeJoint":180,"./joint/CCWeldJoint":181,"./joint/CCWheelJoint":182,"./platform/CCPhysicsAABBQueryCallback":183,"./platform/CCPhysicsContactListner":184,"./platform/CCPhysicsRayCastCallback":186}],174:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.DistanceJoint",extends:cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance;},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t);}},frequency:{tooltip:!1,get:function(){return this._frequency;},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t);}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio;},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t);}}},_createJointDef:function(){var t=new b2.DistanceJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.length=this.distance/r,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t;}});cc.DistanceJoint=e.exports=t;},{"../CCPhysicsTypes":164}],175:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.Joint",extends:cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy();},onEnable:function(){this._init();},start:function(){this._init();},apply:function(){this._destroy(),this._init();},getWorldAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorA(),cc.v2(t.x*r,t.y*r)):cc.Vec2.ZERO;},getWorldConnectedAnchor:function(){var t;return this._joint?(t=this._joint.GetAnchorB(),cc.v2(t.x*r,t.y*r)):cc.Vec2.ZERO;},getReactionForce:function(t){var e=cc.v2();return this._joint?this._joint.GetReactionForce(t,e):e;},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0;},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[]);},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[]);},__init:function(){var t;this._inited||(this.body=this.getComponent(cc.RigidBody),!this._isValid()||(t=this._createJointDef())&&(t.bodyA=this.body._getBody(),t.bodyB=this.connectedBody._getBody(),t.collideConnected=this.collideConnected,cc.director.getPhysicsManager()._addJoint(this,t),this._inited=!0));},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeJoint(this),this._joint=null,this._inited=!1);},_createJointDef:function(){return null;},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody();}});cc.Joint=e.exports=t;},{"../CCPhysicsTypes":164}],176:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;t=cc.Class({name:"cc.MotorJoint",extends:cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset;},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/r,t.y/r));}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset;},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t);}},maxForce:{tooltip:!1,get:function(){return this._maxForce;},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t);}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque;},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t);}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor;},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t);}}},_createJointDef:function(){var t=new b2.MotorJointDef();return t.linearOffset=new b2.Vec2(this.linearOffset.x/r,this.linearOffset.y/r),t.angularOffset=this.angularOffset*n,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t;}});cc.MotorJoint=e.exports=t;},{"../CCPhysicsTypes":164}],177:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=new b2.Vec2();t=cc.Class({name:"cc.MouseJoint",extends:cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target;},set:function(t){this._target=t,this._joint&&(n.x=t.x/r,n.y=t.y/r,this._joint.SetTarget(n));}},frequency:{tooltip:!1,get:function(){return this._frequency;},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t);}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio;},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t);}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce;},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t);}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this);},onEnable:function(){},start:function(){},onTouchBegan:function(t){var e=cc.director.getPhysicsManager();t=this._pressPoint=t.touch.getLocation();cc.Camera&&cc.Camera.main&&(t=cc.Camera.main.getScreenToWorldPoint(t));e=e.testPoint(t);e&&((this.connectedBody=e.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=t,this._init());},onTouchMove:function(t){this._pressPoint=t.touch.getLocation();},onTouchEnd:function(t){this._destroy(),this._pressPoint=null;},_createJointDef:function(){var t=new b2.MouseJointDef();return n.x=this.target.x/r,n.y=this.target.y/r,t.target=n,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t;},update:function(){var t;this._pressPoint&&this._isValid()&&(t=cc.Camera.findCamera(this.node),this.target=t?t.getScreenToWorldPoint(this._pressPoint):this._pressPoint);}});cc.MouseJoint=e.exports=t;},{"../CCPhysicsTypes":164}],178:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;t=cc.Class({name:"cc.PrismaticJoint",extends:cc.Joint,editor:!1,properties:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce;},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t);}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed;},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t);}}},_createJointDef:function(){var t=new b2.PrismaticJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*n,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/r,t.upperTranslation=this.upperLimit/r,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t;}});cc.PrismaticJoint=e.exports=t;},{"../CCPhysicsTypes":164}],179:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;var a=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE;t=cc.Class({name:"cc.RevoluteJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque;},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t);}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed;},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*n);}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit;},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t);}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor;},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t);}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*a:0;},setLimits:function(t,e){if(this._joint)return this._joint.SetLimits(t*n,e*n);},_createJointDef:function(){var t=new b2.RevoluteJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.lowerAngle=this.upperAngle*n,t.upperAngle=this.lowerAngle*n,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*n,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*n,t;}});cc.RevoluteJoint=e.exports=t;},{"../CCPhysicsTypes":164}],180:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;t=cc.Class({name:"cc.RopeJoint",extends:cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength;},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t);}}},_createJointDef:function(){var t=new b2.RopeJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.maxLength=this.maxLength/r,t;}});cc.RopeJoint=e.exports=t;},{"../CCPhysicsTypes":164}],181:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;t=cc.Class({name:"cc.WeldJoint",extends:cc.Joint,editor:!1,properties:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency;},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t);}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio;},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t);}}},_createJointDef:function(){var t=new b2.WeldJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.referenceAngle=this.referenceAngle*n,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t;}});cc.WeldJoint=e.exports=t;},{"../CCPhysicsTypes":164}],182:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").PTM_RATIO;var n=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE;t=cc.Class({name:"cc.WheelJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque;},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t);}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed;},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*n);}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor;},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t);}},frequency:{tooltip:!1,get:function(){return this._frequency;},set:function(t){this._frequency=t,this._joint&&this._joint.SetSpringFrequencyHz(t);}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio;},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t);}}},_createJointDef:function(){var t=new b2.WheelJointDef();return t.localAnchorA=new b2.Vec2(this.anchor.x/r,this.anchor.y/r),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/r,this.connectedAnchor.y/r),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*n,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t;}});cc.WheelJoint=e.exports=t;},{"../CCPhysicsTypes":164}],183:[function(t,e,i){"use strict";var r=t("../CCPhysicsTypes").BodyType;function PhysicsAABBQueryCallback(){this._point=new b2.Vec2(),this._isPoint=!1,this._fixtures=[];}PhysicsAABBQueryCallback.prototype.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0;},PhysicsAABBQueryCallback.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===r.Dynamic)if(this._isPoint){if(t.TestPoint(this._point))return this._fixtures.push(t),!1;}else this._fixtures.push(t);return!0;},PhysicsAABBQueryCallback.prototype.getFixture=function(){return this._fixtures[0];},PhysicsAABBQueryCallback.prototype.getFixtures=function(){return this._fixtures;},cc.PhysicsAABBQueryCallback=e.exports=PhysicsAABBQueryCallback;},{"../CCPhysicsTypes":164}],184:[function(t,e,i){"use strict";function PhysicsContactListener(){this._contactFixtures=[];}PhysicsContactListener.prototype.setBeginContact=function(t){this._BeginContact=t;},PhysicsContactListener.prototype.setEndContact=function(t){this._EndContact=t;},PhysicsContactListener.prototype.setPreSolve=function(t){this._PreSolve=t;},PhysicsContactListener.prototype.setPostSolve=function(t){this._PostSolve=t;},PhysicsContactListener.prototype.BeginContact=function(t){var e,i,r;this._BeginContact&&(e=t.GetFixtureA(),i=t.GetFixtureB(),r=this._contactFixtures,t._shouldReport=!1,-1===r.indexOf(e)&&-1===r.indexOf(i)||(t._shouldReport=!0,this._BeginContact(t)));},PhysicsContactListener.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t));},PhysicsContactListener.prototype.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e);},PhysicsContactListener.prototype.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e);},PhysicsContactListener.prototype.registerContactFixture=function(t){this._contactFixtures.push(t);},PhysicsContactListener.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t);},cc.PhysicsContactListener=e.exports=PhysicsContactListener;},{}],185:[function(t,e,i){"use strict";var o=t("../CCPhysicsTypes").PTM_RATIO;var s=cc.v2();var r=cc.Color.GREEN;var n=cc.Color.RED;function PhysicsDebugDraw(t){b2.Draw.call(this),this._drawer=t,this._xf=this._dxf=new b2.Transform();}cc.js.extend(PhysicsDebugDraw,b2.Draw),cc.js.mixin(PhysicsDebugDraw.prototype,{_DrawPolygon:function(t,e){var i=this._drawer;for(var r=0;r<e;r++){b2.Transform.MulXV(this._xf,t[r],s);var n=s.x*o,a=s.y*o;0===r?i.moveTo(n,a):i.lineTo(n,a);}i.close();},DrawPolygon:function(t,e,i){this._applyStrokeColor(i),this._DrawPolygon(t,e),this._drawer.stroke();},DrawSolidPolygon:function(t,e,i){this._applyFillColor(i),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke();},_DrawCircle:function(t,e){var i=this._xf.p;this._drawer.circle((t.x+i.x)*o,(t.y+i.y)*o,e*o);},DrawCircle:function(t,e,i){this._applyStrokeColor(i),this._DrawCircle(t,e),this._drawer.stroke();},DrawSolidCircle:function(t,e,i,r){this._applyFillColor(r),this._DrawCircle(t,e),this._drawer.fill();},DrawSegment:function(t,e,i){var r=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(i),this._DrawCircle(t,2/o),void r.fill();this._applyStrokeColor(i),b2.Transform.MulXV(this._xf,t,s),r.moveTo(s.x*o,s.y*o),b2.Transform.MulXV(this._xf,e,s),r.lineTo(s.x*o,s.y*o),r.stroke();},DrawTransform:function(t){var e=this._drawer;e.strokeColor=n,s.x=s.y=0,b2.Transform.MulXV(t,s,s),e.moveTo(s.x*o,s.y*o),s.x=1,s.y=0,b2.Transform.MulXV(t,s,s),e.lineTo(s.x*o,s.y*o),e.stroke(),e.strokeColor=r,s.x=s.y=0,b2.Transform.MulXV(t,s,s),e.moveTo(s.x*o,s.y*o),s.x=0,s.y=1,b2.Transform.MulXV(t,s,s),e.lineTo(s.x*o,s.y*o),e.stroke();},DrawPoint:function(t,e,i){},_applyStrokeColor:function(t){var e=this._drawer.strokeColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.strokeColor=e;},_applyFillColor:function(t){var e=this._drawer.fillColor;e.r=255*t.r,e.g=255*t.g,e.b=255*t.b,e.a=150,this._drawer.fillColor=e;},PushTransform:function(t){this._xf=t;},PopTransform:function(){this._xf=this._dxf;}}),e.exports=PhysicsDebugDraw;},{"../CCPhysicsTypes":164}],186:[function(t,e,i){"use strict";function PhysicsRayCastCallback(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[];}PhysicsRayCastCallback.prototype.init=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0;},PhysicsRayCastCallback.prototype.ReportFixture=function(t,e,i,r){return 0===this._type?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=i,this._fractions[0]=r):(this._fixtures.push(t),this._points.push(cc.v2(e)),this._normals.push(cc.v2(i)),this._fractions.push(r),1===this._type?0:2<=this._type?1:r);},PhysicsRayCastCallback.prototype.getFixtures=function(){return this._fixtures;},PhysicsRayCastCallback.prototype.getPoints=function(){return this._points;},PhysicsRayCastCallback.prototype.getNormals=function(){return this._normals;},PhysicsRayCastCallback.prototype.getFractions=function(){return this._fractions;},cc.PhysicsRayCastCallback=e.exports=PhysicsRayCastCallback;},{}],187:[function(t,e,i){"use strict";e.exports={getWorldRotation:function(t){var e=t.angle;var i=t.parent;for(;i.parent;)e+=i.angle,i=i.parent;return-e;},getWorldScale:function(t){var e=t.scaleX;var i=t.scaleY;var r=t.parent;for(;r.parent;)e*=r.scaleX,i*=r.scaleY,r=r.parent;return cc.v2(e,i);},convertToNodeRotation:function(t,e){e-=-t.angle;var i=t.parent;for(;i.parent;)e-=-i.angle,i=i.parent;return e;}};},{}],188:[function(t,i,n){"use strict";t("../assets/CCAsset");var a=t("./utils").callInNextTick;var v=t("../load-pipeline/CCLoader");var A=t("../load-pipeline/asset-table");var S=t("../load-pipeline/pack-downloader");var s=t("../load-pipeline/auto-release-utils");var y=t("../utils/decode-uuid");var T=t("../load-pipeline/md5-pipe");var w=t("../load-pipeline/subpackage-pipe");var g=t("./js");var b="";var C="";var x=g.createMap(!0);function isScene(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene);}function RawAssetEntry(t,e){this.url=t,this.type=e;}var e={loadAsset:function(r,n,t){if("string"!=typeof r)return a(n,new Error("[AssetLibrary] uuid must be string"),null);var e={uuid:r,type:"uuid"};t&&t.existingAsset&&(e.existingAsset=t.existingAsset),v.load(e,function(t,e){var i;t||!e?(i="string"==typeof t?t:t?t.message||t.errorMessage||JSON.stringify(t):"Unknown error",t=new Error("[AssetLibrary] loading JSON or dependencies failed:"+i)):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(r),e.scene.dependAssets=s.getDependsRecursively(i)),isScene(e)&&(i=cc.loader._getReferenceKey(r),v.removeItem(i))),n&&n(t,e);});},getLibUrlNoExt:function(t,e){return t=y(t),(e?C+"assets/":b)+t.slice(0,2)+"/"+t;},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t,e){e=e||{url:null,raw:!1};var i=x[t];return i&&!g.isChildClassOf(i.type,cc.Asset)?(e.url=C+i.url,e.raw=!0):(e.url=this.getLibUrlNoExt(t)+".json",e.raw=!1),e;},_uuidInSettings:function(t){return t in x;},queryAssetInfo:function(t,e){t=this._getAssetInfoInRuntime(t);e(null,t.url,t.raw);},parseUuidInEditor:function(t){},loadJson:function(t,r){var n=""+(new Date().getTime()+Math.random());t={uuid:n,type:"uuid",content:t,skips:[v.assetLoader.id,v.downloader.id]};v.load(t,function(t,e){var i;t?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):(e.constructor===cc.SceneAsset&&(i=cc.loader._getReferenceKey(n),e.scene.dependAssets=s.getDependsRecursively(i)),isScene(e)&&(i=cc.loader._getReferenceKey(n),v.removeItem(i))),e._uuid="",r&&r(t,e);});},getAssetByUuid:function(t){return e._uuidToAsset[t]||null;},init:function(t){var e=t.libraryPath;e=e.replace(/\\/g,"/"),b=cc.path.stripSep(e)+"/",C=t.rawAssetsBase,t.subpackages&&(e=new w(t.subpackages),cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.subPackPipe=e);e=t.md5AssetsMap;if(e&&e.import){var i=0,r=0;var h=g.createMap(!0);var n=e.import;for(i=0;i<n.length;i+=2)h[r=y(n[i])]=n[i+1];var u=g.createMap(!0);for(n=e["raw-assets"],i=0;i<n.length;i+=2)u[r=y(n[i])]=n[i+1];e=new T(h,u,b);cc.loader.insertPipeAfter(cc.loader.assetLoader,e),cc.loader.md5Pipe=e;}var a=v._assetTables;for(var _ in a)a[_].reset();var o=t.rawAssets;if(o)for(var s in o){var d=o[s];for(var r in d){var f=d[r];var c=f[0];var p=f[1];var m=cc.js._getClassById(p);var l;m?(x[r]=new RawAssetEntry(s+"/"+c,m),(l=cc.path.extname(c))&&(c=c.slice(0,-l.length)),l=1===f[2],a[s]||(a[s]=new A()),a[s].add(c,r,m,!l)):cc.error("Cannot get",p);}}t.packedAssets&&S.initPacks(t.packedAssets),cc.url._init(t.mountPaths&&t.mountPaths.assets||C+"assets");}};e._uuidToAsset={};var r={effect:{},material:{}};var o={};function loadBuiltins(t,e,n){var i=t+"s";var a=r[t]={};cc.loader.loadResDir(i,e,"internal",function(){},function(t,e){if(t)cc.error(t);else for(var i=0;i<e.length;i++){var r=e[i];cc.loader.getDependsRecursively(r).forEach(function(t){return o[t]=!0;}),a[""+r.name]=r;}n();});}e._loadBuiltins=function(t){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return t&&t();loadBuiltins("effect",cc.EffectAsset,function(){loadBuiltins("material",cc.Material,t);});},e.getBuiltin=function(t,e){return r[t][e];},e.getBuiltins=function(t){return t?r[t]:r;},e.resetBuiltins=function(){r={effect:{},material:{}},o={};},e.getBuiltinDeps=function(){return o;},i.exports=cc.AssetLibrary=e;},{"../assets/CCAsset":34,"../load-pipeline/CCLoader":136,"../load-pipeline/asset-table":138,"../load-pipeline/auto-release-utils":140,"../load-pipeline/md5-pipe":147,"../load-pipeline/pack-downloader":148,"../load-pipeline/subpackage-pipe":151,"../utils/decode-uuid":258,"./js":209,"./utils":213}],189:[function(t,i,r){"use strict";var y=t("./js");var s=t("./CCEnum");var e=t("./utils");e.isPlainEmptyObj_DEV;e.cloneable_DEV;var g=t("./attribute");var b=g.DELIMETER;var C=t("./preprocess-class");t("./requiring-frame");var h=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"];function pushUnique(t,e){t.indexOf(e)<0&&t.push(e);}var u={datas:null,push:function(t){var e;this.datas?this.datas.push(t):(this.datas=[t],e=this,setTimeout(function(){e.init();},0));},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e];var r=i.cls;var n=i.props;"function"==typeof n&&(n=n());var a=y.getClassName(r);n?declareProperties(r,a,n,r.$super,i.mixins):cc.errorID(3633,a);}this.datas=null;}}};function defineProp(t,e,i,r){var n=r.default;g.setClassAttr(t,i,"default",n),pushUnique(t.__props__,i),parseAttributes(t,r,0,i);}function getDefault(t){return"function"==typeof t?t():t;}function mixinWithInherited(t,e,i){for(var r in e)t.hasOwnProperty(r)||i&&!i(r)||Object.defineProperty(t,r,y.getPropertyDescriptor(e,r));}function doDefine(h,t,e,i){var r=i.__ctor__;var u=i.ctor;var n=i.__ES6__;var a;var o;n?(a=[u],o=u):(a=r?[r]:function(t,e,i){var r=[];var n=[t].concat(e);for(var a=0;a<n.length;a++){var o=n[a];if(o){var s=function(t){return CCClass._isCCClass(t)?t.__ctors__||[]:[t];}(o);for(var c=0;c<s.length;c++)pushUnique(r,s[c]);}}t=i.ctor;return t&&r.push(t),r;}(t,e,i),o=mr0(a,t,0,i),y.value(o,"extend",function(t){return t.extends=this,CCClass(t);},!0)),y.value(o,"__ctors__",0<a.length?a:null,!0);var s=o.prototype;if(t&&(n||(y.extend(o,t),s=o.prototype),o.$super=t),e){for(var c=e.length-1;0<=c;c--){var l=e[c];mixinWithInherited(s,l.prototype),mixinWithInherited(o,l,function(t){return l.hasOwnProperty(t)&&!0;}),CCClass._isCCClass(l)&&mixinWithInherited(g.getClassAttrs(o),g.getClassAttrs(l));}s.constructor=o;}return n||(s.__initProps__=compileProps),y.setClassName(h,o),o;}function escapeForJS(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");}e=/^[A-Za-z_$][0-9A-Za-z_$]*$/;function compileProps(t){var e=g.getClassAttrs(t);var i=t.__props__;null===i&&(u.init(),i=t.__props__);e=function(t,e){var n=[];var a=[];var o=[];var s=[];for(var i=0;i<e.length;++i){var r=e[i];var c=r+b+"default";c in t&&("object"==typeof(c=t[c])&&c||"function"==typeof c?(n.push(r),a.push(c)):(o.push(r),s.push(c)));}return function(){for(var t=0;t<o.length;++t)this[o[t]]=s[t];for(var e=0;e<n.length;e++){var i=n[e];var r=a[e];r="object"==typeof r?r instanceof cc.ValueType?r.clone():Array.isArray(r)?[]:{}:r(),this[i]=r;}};}(e,i);(t.prototype.__initProps__=e).call(this);}function mr0(e,t,i,r){var n=t&&function(t,e){var i=!1;for(var r in e)if(!(0<=h.indexOf(r))){var n=e[r];if("function"==typeof n){var a=y.getPropertyDescriptor(t.prototype,r);if(a){a=a.value;if("function"==typeof a){o.test(n)&&(i=!0,e[r]=function(i,r){return function(){var t=this._super;this._super=i;var e=r.apply(this,arguments);return this._super=t,e;};}(a,n));continue;}}}}return i;}(t,r);var a;return t=e.length,a=0<t?n?2===t?function(){this._super=null,this.__initProps__(a),e[0].apply(this,arguments),e[1].apply(this,arguments);}:function(){this._super=null,this.__initProps__(a);for(var t=0;t<e.length;++t)e[t].apply(this,arguments);}:3===t?function(){this.__initProps__(a),e[0].apply(this,arguments),e[1].apply(this,arguments),e[2].apply(this,arguments);}:function(){this.__initProps__(a);var t=a.__ctors__;for(var e=0;e<t.length;++e)t[e].apply(this,arguments);}:function(){n&&(this._super=null),this.__initProps__(a);};}var o=/xyz/.test(function(){xyz;})?/\b\._super\b/:/.*/;/xyz/.test(function(){xyz;});function declareProperties(e,h,t,i,u,_){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),u)for(var d=0;d<u.length;++d){var f=u[d];f.__props__&&(e.__props__=e.__props__.concat(f.__props__.filter(function(t){return e.__props__.indexOf(t)<0;})));}if(t)for(var r in C.preprocessAttrs(t,h,e,_),t){var n=t[r];"default"in n?defineProp(e,0,r,n):(a=e,p=h,r=r,m=_,l=c=s=o=void 0,o=(n=n).get,s=n.set,c=a.prototype,l=!Object.getOwnPropertyDescriptor(c,r),o&&(parseAttributes(a,n,0,r),g.setClassAttr(a,r,"serializable",!1),m||y.get(c,r,o,l,l)),s&&(m||y.set(c,r,s,l,l)));}var a,p,m,o,s,c,l;var v=g.getClassAttrs(e);e.__values__=e.__props__.filter(function(t){return!1!==v[t+b+"serializable"];});}function CCClass(t){var e=(t=t||{}).name;var i=t.extends;var r=t.mixins;var n=function(t,e,i,r){var n=cc.Component;var a=cc._RF.peek();if(a&&y.isChildClassOf(e,n)){if(y.isChildClassOf(a.cls,n))return cc.errorID(3615),null;t=t||a.script;}return t=doDefine(t,e,i,r),a&&(y.isChildClassOf(e,n)?((i=a.uuid)&&y._setClassId(i,t),a.cls=t):y.isChildClassOf(a.cls,n)||(a.cls=t)),t;}(e,i,r,t);e=e||cc.js.getClassName(n),n._sealed=!0,i&&(i._sealed=!1);var a=t.properties;"function"==typeof a||i&&null===i.__props__||r&&r.some(function(t){return null===t.__props__;})?(u.push({cls:n,props:a,mixins:r}),n.__props__=n.__values__=null):declareProperties(n,e,a,i,t.mixins,t.__ES6__);var o=t.statics;if(o)for(var s in o)n[s]=o[s];for(var c in t){var l;0<=h.indexOf(c)||(l=t[c],C.validateMethodWithProps(l,c,e,n,i)&&y.value(n.prototype,c,l,!0,!0));}r=t.editor;return r&&y.isChildClassOf(i,cc.Component)&&cc.Component._registerEditorProps(n,r),n;}CCClass._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__");},CCClass._fastDefine=function(t,e,i){y.setClassName(t,e);var r=e.__props__=e.__values__=Object.keys(i);var n=g.getClassAttrs(e);for(var a=0;a<r.length;a++){var o=r[a];n[o+b+"visible"]=!1,n[o+b+"default"]=i[o];}},CCClass.Attr=g,CCClass.attr=g.attr,CCClass.getInheritanceChain=function(t){var e=[];for(;t=y.getSuper(t);)t!==Object&&e.push(t);return e;};var c={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function parseAttributes(t,r,e,i){var n=null;var a="";function initAttrs(){return a=i+b,n=g.getClassAttrs(t);}var o=r.type;function parseSimpleAttr(t,e){var i;t in r&&typeof(i=r[t])===e&&((n||initAttrs())[a+t]=i);}o&&(c[o]?(n||initAttrs())[a+"type"]=o:"Object"===o||(o===g.ScriptUuid?((n||initAttrs())[a+"type"]="Script",n[a+"ctor"]=cc.ScriptAsset):"object"==typeof o?s.isEnum(o)&&((n||initAttrs())[a+"type"]="Enum",n[a+"enumList"]=s.getList(o)):"function"==typeof o&&((n||initAttrs())[a+"type"]="Object",n[a+"ctor"]=o))),r.editorOnly&&((n||initAttrs())[a+"editorOnly"]=!0),r.url&&((n||initAttrs())[a+"saveUrlAsAsset"]=!0),!1===r.serializable&&((n||initAttrs())[a+"serializable"]=!1),parseSimpleAttr("formerlySerializedAs","string");o=r.range;o&&Array.isArray(o)&&2<=o.length&&((n||initAttrs())[a+"min"]=o[0],n[a+"max"]=o[1],2<o.length&&(n[a+"step"]=o[2])),parseSimpleAttr("min","number"),parseSimpleAttr("max","number"),parseSimpleAttr("step","number");}cc.Class=CCClass,i.exports={isArray:function(t){return t=getDefault(t),Array.isArray(t);},fastDefine:CCClass._fastDefine,getNewValueTypeCode:!1,IDENTIFIER_RE:e,escapeForJS:escapeForJS,getDefault:getDefault};},{"./CCEnum":191,"./attribute":201,"./js":209,"./preprocess-class":210,"./requiring-frame":211,"./utils":213}],190:[function(t,n,a){"use strict";t("./CCClass");var h=t("./preprocess-class");var l=t("./js");var r="__ccclassCache__";function fNOP(t){return t;}function getSubDict(t,e){return t[e]||(t[e]={});}function checkCtorArgument(i){return function(e){return"function"==typeof e?i(e):function(t){return i(t,e);};};}function _checkNormalArgument(t,i,e){return function(e){return function(t){return i(t,e);};};}t=_checkNormalArgument.bind(null,!1);function _argumentChecker(){return _checkNormalArgument.bind(null,!1);}var e=_argumentChecker();var i=_argumentChecker();function getClassCache(t){return getSubDict(t,r);}function genProperty(t,e,i,r,n,a){var o=n&&(n.get||n.set);r&&(c=h.getFullFormOfProperty(r,o));var s=e[i];s=l.mixin(s||{},c||r||{});var c;o?(n.get&&(s.get=n.get),n.set&&(s.set=n.set)):(c=void 0,n?n.initializer&&(c=function(e){var t;try{t=e();}catch(t){return e;}return"object"!=typeof t||null===t?t:e;}(n.initializer)):(r=a.default||(a.default=function(t){var e;try{e=new t();}catch(t){return{};}return e;}(t))).hasOwnProperty(i)&&(c=r[i]),s.default=c),e[i]=s;}var o=checkCtorArgument(function(t,e){var i=l.getSuper(t);e={name:e,extends:i=i===Object?null:i,ctor:t,__ES6__:!0};i=t[r];return i&&((i=i.proto)&&l.mixin(e,i),t[r]=void 0),cc.Class(e);});function createEditorDecorator(t,i,r){return t(function(t,e){t=getClassCache(t);t&&(e=void 0!==r?r:e,t=getSubDict(t,"proto"),getSubDict(t,"editor")[i]=e);},i);}function createDummyDecorator(t){return t(fNOP);}var s=createDummyDecorator(checkCtorArgument);t=createEditorDecorator(t,"requireComponent");var c=createDummyDecorator(e);i=createEditorDecorator(i,"executionOrder");var u=createDummyDecorator(checkCtorArgument);var _=createDummyDecorator(checkCtorArgument);var d=createDummyDecorator(e);var f=createDummyDecorator(e);e=createDummyDecorator(e);cc._decorator=n.exports={ccclass:o,property:function(t,e,i){var a=null;function normalized(t,e,i){var r=getClassCache(t.constructor);var n;r&&(n=getSubDict(r,"proto"),n=getSubDict(n,"properties"),genProperty(t.constructor,n,e,a,i,r));}if(void 0===e)return a=t,normalized;normalized(t,e,i);},executeInEditMode:s,requireComponent:t,menu:c,executionOrder:i,disallowMultiple:u,playOnFocus:_,inspector:d,icon:f,help:e,mixins:function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){t=getClassCache(t);t&&(getSubDict(t,"proto").mixins=e);};}};},{"./CCClass":189,"./js":209,"./preprocess-class":210,"./utils":213}],191:[function(t,e,i){"use strict";var o=t("./js");function Enum(t){if("__enums__"in t)return t;o.value(t,"__enums__",null,!0);var e=-1;var i=Object.keys(t);for(var r=0;r<i.length;r++){var n=i[r];var a=t[n];if(-1===a)a=++e,t[n]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(n)))continue;a=""+a;n!==a&&o.value(t,a,n);}return t;}Enum.isEnum=function(t){return t&&t.hasOwnProperty("__enums__");},Enum.getList=function(t){if(t.__enums__)return t.__enums__;var e=t.__enums__=[];for(var i in t){var r=t[i];Number.isInteger(r)&&e.push({name:i,value:r});}return e.sort(function(t,e){return t.value-e.value;}),e;},e.exports=cc.Enum=Enum;},{"./js":209}],192:[function(t,e,i){"use strict";var r=t("../event-manager");t=t("./CCInputManager");var n;cc.Acceleration=function(t,e,i,r){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=r||0;},t.setAccelerometerEnabled=function(t){var e=this;e._accelEnabled!==t&&(e._accelEnabled=t,(t=cc.director.getScheduler()).enableForTarget(e),e._accelEnabled?(e._registerAccelerometerEvent(),e._accelCurTime=0,t.scheduleUpdate(e)):(e._unregisterAccelerometerEvent(),e._accelCurTime=0,t.unscheduleUpdate(e)));},t.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t);},t._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault();},!1),cc.game.canvas.addEventListener("keyup",function(t){r.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault();},!1);},t._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration(),this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";var i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),n=this.didAccelerate.bind(this),t.addEventListener(e,n,!1);},t._unregisterAccelerometerEvent=function(){var t=window;var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";n&&t.removeEventListener(e,n,!1);},t.didAccelerate=function(t){var e=window;var i,r,n,a,o;this._accelEnabled&&(i=this._acceleration,a=this._accelDeviceEvent===window.DeviceMotionEvent?(a=t.accelerationIncludingGravity,r=this._accelMinus*a.x*.1,n=this._accelMinus*a.y*.1,.1*a.z):(r=t.gamma/90*.981,n=-t.beta/90*.981,t.alpha/90*.981),cc.view._isRotated&&(o=r,r=-n,n=o),i.x=r,i.y=n,i.z=a,i.timestamp=t.timeStamp||Date.now(),o=i.x,90===e.orientation?(i.x=-i.y,i.y=o):-90===e.orientation?(i.x=i.y,i.y=-o):180===e.orientation&&(i.x=-i.x,i.y=-i.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(i.x=-i.x,i.y=-i.y));};},{"../event-manager":113,"./CCInputManager":193}],193:[function(t,e,i){"use strict";var r=t("./CCMacro");var d=t("./CCSys");var f=t("../event-manager");var n=r.TOUCH_TIMEOUT;var h=cc.v2();t={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){var t=this._indexBitsUsed;var e=cc.sys.now();for(var i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var r=this._touches[i];if(e-r._lastModified>n)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[r.getID()],i;t>>=1;}return-1;},_removeUsedIndexBit:function(t){t<0||t>=this._maxTouches||(this._indexBitsUsed&=~(1<<t));},_glView:null,_updateCanvasBoundingRect:function(){var t=cc.game.canvas;var e=this._canvasBoundingRect;var i=document.documentElement;var r=window.pageXOffset-i.clientLeft;i=window.pageYOffset-i.clientTop;var n;t.getBoundingClientRect?(n=t.getBoundingClientRect(),e.left=n.left+r,e.top=n.top+i,e.width=n.width,e.height=n.height):t instanceof HTMLCanvasElement?(e.left=r,e.top=i,e.width=t.width,e.height=t.height):(e.left=r,e.top=i,e.width=parseInt(t.style.width),e.height=parseInt(t.style.height));},handleTouchesBegin:function(t){var e,i,r,n=[],a=this._touchesIntegerDict,o=d.now();for(var s=0,h=t.length;s<h;s++){var c;null==a[r=(e=t[s]).getID()]&&(-1!==(c=this._getUnUsedIndex())?((i=this._touches[c]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=o,i._setPrevPoint(e._prevPoint),a[r]=c,n.push(i)):cc.logID(2300,c));}var l;0<n.length&&(this._glView._convertTouchesWithScale(n),(l=new cc.Event.EventTouch(n))._eventCode=cc.Event.EventTouch.BEGAN,f.dispatchEvent(l));},handleTouchesMove:function(t){var e,i,r=[],n=this._touches,a=d.now();for(var o=0,s=t.length;o<s;o++)i=(e=t[o]).getID(),null!=(i=this._touchesIntegerDict[i])&&n[i]&&(n[i]._setPoint(e._point),n[i]._setPrevPoint(e._prevPoint),n[i]._lastModified=a,r.push(n[i]));var c;0<r.length&&(this._glView._convertTouchesWithScale(r),(c=new cc.Event.EventTouch(r))._eventCode=cc.Event.EventTouch.MOVED,f.dispatchEvent(c));},handleTouchesEnd:function(t){t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.ENDED,f.dispatchEvent(t)),this._preTouchPool.length=0;},handleTouchesCancel:function(t){t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.Event.EventTouch(t))._eventCode=cc.Event.EventTouch.CANCELED,f.dispatchEvent(t)),this._preTouchPool.length=0;},getSetOfTouchesEndOrCancel:function(t){var e,i,r,n=[],a=this._touches,o=this._touchesIntegerDict;for(var s=0,c=t.length;s<c;s++)null!=(i=o[r=(e=t[s]).getID()])&&a[i]&&(a[i]._setPoint(e._point),a[i]._setPrevPoint(e._prevPoint),n.push(a[i]),this._removeUsedIndexBit(i),delete o[r]);return n;},getPreTouch:function(t){var e=null;var i=this._preTouchPool;var r=t.getID();for(var n=i.length-1;0<=n;n--)if(i[n].getID()===r){e=i[n];break;}return e=e||t;},setPreTouch:function(t){var e=!1;var i=this._preTouchPool;var r=t.getID();for(var n=i.length-1;0<=n;n--)if(i[n].getID()===r){i[n]=t,e=!0;break;}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50));},getTouchByXY:function(t,e,i){var r=this._preTouchPoint;t=this._glView.convertToLocationInView(t,e,i);e=new cc.Touch(t.x,t.y,0);return e._setPrevPoint(r.x,r.y),r.x=t.x,r.y=t.y,e;},getMouseEvent:function(t,e,i){var r=this._prevMousePoint;i=new cc.Event.EventMouse(i);return i._setPrevCursor(r.x,r.y),r.x=t.x,r.y=t.y,this._glView._convertMouseToLocationInView(r,e),i.setLocation(r.x,r.y),i;},getPointByEvent:function(t,e){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY});},getTouchesByEvent:function(t,e){var i=[],r=this._glView;var n,a;var o=this._preTouchPoint;var s=t.changedTouches.length;for(var c=0;c<s;c++){var l;(a=t.changedTouches[c])&&(l=void 0,l=d.BROWSER_TYPE_FIREFOX===d.browserType?r.convertToLocationInView(a.pageX,a.pageY,e,h):r.convertToLocationInView(a.clientX,a.clientY,e,h),null!=a.identifier?(n=new cc.Touch(l.x,l.y,a.identifier),a=this.getPreTouch(n).getLocation(),n._setPrevPoint(a.x,a.y),this.setPreTouch(n)):(n=new cc.Touch(l.x,l.y))._setPrevPoint(o.x,o.y),o.x=l.x,o.y=l.y,i.push(n));}return i;},registerSystemEvent:function(a){if(!this._isRegisterEvent){this._glView=cc.view;var o=this;var s=this._canvasBoundingRect;window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this));var t=d.isMobile;var e="mouse"in d.capabilities;var h="touches"in d.capabilities;if(e){t||(window.addEventListener("mousedown",function(){o._mousePressed=!0;},!1),window.addEventListener("mouseup",function(t){var e;o._mousePressed&&(o._mousePressed=!1,e=o.getPointByEvent(t,s),cc.rect(s.left,s.top,s.width,s.height).contains(e)||(o.handleTouchesEnd([o.getTouchByXY(e.x,e.y,s)]),(e=o.getMouseEvent(e,s,cc.Event.EventMouse.UP)).setButton(t.button),f.dispatchEvent(e)));},!1));e=cc.Event.EventMouse;var i=[!t&&["mousedown",e.DOWN,function(t,e,i,r){o._mousePressed=!0,o.handleTouchesBegin([o.getTouchByXY(i.x,i.y,r)]),a.focus();}],!t&&["mouseup",e.UP,function(t,e,i,r){o._mousePressed=!1,o.handleTouchesEnd([o.getTouchByXY(i.x,i.y,r)]);}],!t&&["mousemove",e.MOVE,function(t,e,i,r){o.handleTouchesMove([o.getTouchByXY(i.x,i.y,r)]),o._mousePressed||e.setButton(null);}],["mousewheel",e.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta);}],["DOMMouseScroll",e.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail);}]];for(var r=0;r<i.length;++r){var c=i[r];c&&function(){var t=c[0];var r=c[1];var n=c[2];a.addEventListener(t,function(t){var e=o.getPointByEvent(t,s);var i=o.getMouseEvent(e,s,r);i.setButton(t.button),n(t,i,e,s),f.dispatchEvent(i),t.stopPropagation(),t.preventDefault();},!1);}();}}if(window.navigator.msPointerEnabled){var n={MSPointerDown:o.handleTouchesBegin,MSPointerMove:o.handleTouchesMove,MSPointerUp:o.handleTouchesEnd,MSPointerCancel:o.handleTouchesCancel};for(var u in n)!function(t){var i=n[t];a.addEventListener(t,function(t){var e=document.documentElement;s.adjustedLeft=s.left-e.scrollLeft,s.adjustedTop=s.top-e.scrollTop,i.call(o,[o.getTouchByXY(t.clientX,t.clientY,s)]),t.stopPropagation();},!1);}(u);}if(h){var l={touchstart:function(t){o.handleTouchesBegin(t),a.focus();},touchmove:function(t){o.handleTouchesMove(t);},touchend:function(t){o.handleTouchesEnd(t);},touchcancel:function(t){o.handleTouchesCancel(t);}};for(var _ in l)!function(t){var i=l[t];a.addEventListener(t,function(t){var e;t.changedTouches&&(e=document.body,s.adjustedLeft=s.left-(e.scrollLeft||window.scrollX||0),s.adjustedTop=s.top-(e.scrollTop||window.scrollY||0),i(o.getTouchesByEvent(t,s)),t.stopPropagation(),t.preventDefault());},!1);}(_);}this._registerKeyboardEvent(),this._isRegisterEvent=!0;}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,f.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t;}};e.exports=cc.internal.inputManager=t;},{"../event-manager":113,"./CCMacro":194,"./CCSys":198}],194:[function(t,e,i){"use strict";cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ENABLE_MULTI_TOUCH:!0},Object.defineProperty(cc.macro,"ROTATE_ACTION_CCW",{set:function(t){cc.RotateTo&&cc.RotateBy&&(cc.RotateTo._reverse=cc.RotateBy._reverse=t);}});cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),e.exports=cc.macro;},{}],195:[function(t,e,i){"use strict";var r=t("./js");t=t("./CCClass");function CCObject(){this._name="",this._objFlags=0;}t.fastDefine("cc.Object",CCObject,{_name:"",_objFlags:0}),r.value(CCObject,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var n=[];r.value(CCObject,"_deferredDestroy",function(){var t=n.length;for(var e=0;e<t;++e){var i=n[e];1&i._objFlags||i._destroyImmediate();}t===n.length?n.length=0:n.splice(0,t);});t=CCObject.prototype;r.getset(t,"name",function(){return this._name;},function(t){this._name=t;},!0),r.get(t,"isValid",function(){return!(1&this._objFlags);},!0);t.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags)&&(this._objFlags|=4,n.push(this),!0);},t._destruct=function(){var t=this.constructor;var e=t.__destruct__;e||(e=function(t,e){var i=t instanceof cc._BaseNode||t instanceof cc.Component;var r=i?"_id":null;var n,a={};for(n in t)if(t.hasOwnProperty(n)){if(n===r)continue;switch(typeof t[n]){case"string":a[n]="";break;case"object":case"function":a[n]=null;}}if(cc.Class._isCCClass(e)){var o=cc.Class.Attr.getClassAttrs(e);var s=e.__props__;for(var c=0;c<s.length;c++){var l=(n=s[c])+cc.Class.Attr.DELIMETER+"default";if(l in o&&(!i||"_id"!==n))switch(typeof o[l]){case"string":a[n]="";break;case"object":case"function":a[n]=null;break;case"undefined":a[n]=void 0;}}}return function(t){for(var e in a)t[e]=a[e];};}(this,t),r.value(t,"__destruct__",e,!0)),e(this);},t._onPreDestroy=null,t._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1);},t._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t;},cc.Object=e.exports=CCObject;},{"./CCClass":189,"./js":209}],196:[function(t,e,i){"use strict";t=t("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser()):(this._isSupportDOMParser=!1,this._parser=null);},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(t){return this._parseXML(t);},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e;}},cc.PlistParser=function(){cc.SAXParser.call(this);},t.extend(cc.PlistParser,cc.SAXParser),t.mixin(cc.PlistParser.prototype,{parse:function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return cc.warnID(5100),{};var i=null;for(var r=0,n=e.childNodes.length;r<n&&1!==(i=e.childNodes[r]).nodeType;r++);return this._parseNode(i);},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i){if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var r=0;r<t.childNodes.length;r++)e+=t.childNodes[r].nodeValue;}}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e;},_parseArray:function(t){var e=[];for(var i=0,r=t.childNodes.length;i<r;i++){var n=t.childNodes[i];1===n.nodeType&&e.push(this._parseNode(n));}return e;},_parseDict:function(t){var e={};var i=null;for(var r=0,n=t.childNodes.length;r<n;r++){var a=t.childNodes[r];1===a.nodeType&&("key"===a.tagName?i=a.firstChild.nodeValue:e[i]=this._parseNode(a));}return e;}}),cc.saxParser=new cc.SAXParser(),cc.plistParser=new cc.PlistParser(),e.exports={saxParser:cc.saxParser,plistParser:cc.plistParser};},{"../platform/js":209}],197:[function(t,e,i){"use strict";cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};var t,e,i,r,n=this._fnMap;for(t=0,e=n.length;t<e;t++)if((i=n[t])&&void 0!==document[i[1]]){for(t=0,r=i.length;t<r;t++)this._fn[n[0][t]]=i[t];break;}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchend"in window?"touchend":"mousedown";},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement]);},requestFullScreen:function(t,e,i){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&0<t.readyState)return void(t.webkitEnterFullscreen&&t.webkitEnterFullscreen());t.setAttribute("x5-video-player-fullscreen","true");}var r;this._supportsFullScreen&&(t=t||document.documentElement,e&&(r=this._fn.fullscreenchange,this._onfullscreenchange&&document.removeEventListener(r,this._onfullscreenchange),this._onfullscreenchange=e,document.addEventListener(r,e,!1)),i&&(r=this._fn.fullscreenerror,this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=i,document.addEventListener(r,i,{once:!0})),t[this._fn.requestFullscreen]());},exitFullScreen:function(t){if(t&&"video"===t.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(t.webkitExitFullscreen&&t.webkitExitFullscreen());t.setAttribute("x5-video-player-fullscreen","false");}return!this._supportsFullScreen||document[this._fn.exitFullscreen]();},autoFullScreen:function(t,e){t=t||document.body,this._ensureFullScreen(t,e),this.requestFullScreen(t,e);},disableAutoFullScreen:function(t){t=cc.game.canvas||t;var e=this._touchEvent;this._preOnTouch&&(t.removeEventListener(e,this._preOnTouch),this._preOnTouch=null);},_ensureFullScreen:function(t,e){var i=this;var r=cc.game.canvas||t;var n=this._fn.fullscreenerror;var a;function onFullScreenError(){i._preOnFullScreenError=null,i._preOnTouch&&r.removeEventListener(a,i._preOnTouch),i._preOnTouch=function(){i._preOnTouch=null,i.requestFullScreen(t,e);},r.addEventListener(a,i._preOnTouch,{once:!0});}void 0!==document[n]&&(a=this._touchEvent,this._preOnFullScreenError&&t.removeEventListener(n,this._preOnFullScreenError),this._preOnFullScreenError=onFullScreenError,t.addEventListener(n,onFullScreenError,{once:!0}));}},cc.screen.init();},{}],198:[function(t,e,i){"use strict";window._CCSettings&&_CCSettings.platform;var d="undefined"==typeof window?global:window;var r=cc&&cc.sys?cc.sys:function(){cc.sys={};var e=cc.sys;if(e.LANGUAGE_ENGLISH="en",e.LANGUAGE_CHINESE="zh",e.LANGUAGE_FRENCH="fr",e.LANGUAGE_ITALIAN="it",e.LANGUAGE_GERMAN="de",e.LANGUAGE_SPANISH="es",e.LANGUAGE_DUTCH="du",e.LANGUAGE_RUSSIAN="ru",e.LANGUAGE_KOREAN="ko",e.LANGUAGE_JAPANESE="ja",e.LANGUAGE_HUNGARIAN="hu",e.LANGUAGE_PORTUGUESE="pt",e.LANGUAGE_ARABIC="ar",e.LANGUAGE_NORWEGIAN="no",e.LANGUAGE_POLISH="pl",e.LANGUAGE_TURKISH="tr",e.LANGUAGE_UKRAINIAN="uk",e.LANGUAGE_ROMANIAN="ro",e.LANGUAGE_BULGARIAN="bg",e.LANGUAGE_UNKNOWN="unknown",e.OS_IOS="iOS",e.OS_ANDROID="Android",e.OS_WINDOWS="Windows",e.OS_MARMALADE="Marmalade",e.OS_LINUX="Linux",e.OS_BADA="Bada",e.OS_BLACKBERRY="Blackberry",e.OS_OSX="OS X",e.OS_WP8="WP8",e.OS_WINRT="WINRT",e.OS_UNKNOWN="Unknown",e.UNKNOWN=-1,e.WIN32=0,e.LINUX=1,e.MACOS=2,e.ANDROID=3,e.IPHONE=4,e.IPAD=5,e.BLACKBERRY=6,e.NACL=7,e.EMSCRIPTEN=8,e.TIZEN=9,e.WINRT=10,e.WP8=11,e.MOBILE_BROWSER=100,e.DESKTOP_BROWSER=101,e.EDITOR_PAGE=102,e.EDITOR_CORE=103,e.WECHAT_GAME=104,e.QQ_PLAY=105,e.FB_PLAYABLE_ADS=106,e.BAIDU_GAME=107,e.VIVO_GAME=108,e.OPPO_GAME=109,e.HUAWEI_GAME=110,e.XIAOMI_GAME=111,e.JKW_GAME=112,e.ALIPAY_GAME=113,e.WECHAT_GAME_SUB=114,e.BAIDU_GAME_SUB=115,e.QTT_GAME=116,e.BROWSER_TYPE_WECHAT="wechat",e.BROWSER_TYPE_WECHAT_GAME="wechatgame",e.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",e.BROWSER_TYPE_BAIDU_GAME="baidugame",e.BROWSER_TYPE_BAIDU_GAME_SUB="baidugamesub",e.BROWSER_TYPE_XIAOMI_GAME="xiaomigame",e.BROWSER_TYPE_ALIPAY_GAME="alipaygame",e.BROWSER_TYPE_QQ_PLAY="qqplay",e.BROWSER_TYPE_ANDROID="androidbrowser",e.BROWSER_TYPE_IE="ie",e.BROWSER_TYPE_EDGE="edge",e.BROWSER_TYPE_QQ="qqbrowser",e.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",e.BROWSER_TYPE_UC="ucbrowser",e.BROWSER_TYPE_UCBS="ucbs",e.BROWSER_TYPE_360="360browser",e.BROWSER_TYPE_BAIDU_APP="baiduboxapp",e.BROWSER_TYPE_BAIDU="baidubrowser",e.BROWSER_TYPE_MAXTHON="maxthon",e.BROWSER_TYPE_OPERA="opera",e.BROWSER_TYPE_OUPENG="oupeng",e.BROWSER_TYPE_MIUI="miuibrowser",e.BROWSER_TYPE_FIREFOX="firefox",e.BROWSER_TYPE_SAFARI="safari",e.BROWSER_TYPE_CHROME="chrome",e.BROWSER_TYPE_LIEBAO="liebao",e.BROWSER_TYPE_QZONE="qzone",e.BROWSER_TYPE_SOUGOU="sogou",e.BROWSER_TYPE_UNKNOWN="unknown",e.isNative=!1,e.isBrowser="object"==typeof window&&"object"==typeof document&&!0,e.glExtension=function(t){return!!cc.renderer.device.ext(t);},e.getMaxJointMatrixSize=function(){var t;return e._maxJointMatrixSize||(t=cc.game._renderContext,t=Math.floor(t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)/4)-10,e._maxJointMatrixSize=t<50?0:50),e._maxJointMatrixSize;},d.__globalAdapter&&d.__globalAdapter.adaptSys)d.__globalAdapter.adaptSys(e);else{var t=window,i=t.navigator,h=document,u=h.documentElement;var r=i.userAgent.toLowerCase();e.isMobile=/mobile|android|iphone|ipad/.test(r),"undefined"!=typeof FbPlayableAd?e.platform=e.FB_PLAYABLE_ADS:e.platform=e.isMobile?e.MOBILE_BROWSER:e.DESKTOP_BROWSER;var n=i.language;n=n||i.browserLanguage,e.languageCode=n.toLowerCase(),n=n?n.split("-")[0]:e.LANGUAGE_ENGLISH,e.language=n;var n=!1,a=!1,o="",s=0;var c=/android (\d+(?:\.\d+)*)/i.exec(r)||/android (\d+(?:\.\d+)*)/i.exec(i.platform);c&&(n=!0,o=c[1]||"",s=parseInt(o)||0),(c=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(a=!0,o=c[2]||"",s=parseInt(o)||0):(/(iPhone|iPad|iPod)/.exec(i.platform)||"MacIntel"===i.platform&&i.maxTouchPoints&&1<i.maxTouchPoints)&&(a=!0,o="",s=0);c=e.OS_UNKNOWN;-1!==i.appVersion.indexOf("Win")?c=e.OS_WINDOWS:a?c=e.OS_IOS:-1!==i.appVersion.indexOf("Mac")?c=e.OS_OSX:-1!==i.appVersion.indexOf("X11")&&-1===i.appVersion.indexOf("Linux")?c=e.OS_UNIX:n?c=e.OS_ANDROID:-1===i.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(c=e.OS_LINUX),e.os=c,e.osVersion=o,e.osMainVersion=s,e.browserType=e.BROWSER_TYPE_UNKNOWN;a=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|ucbrowser|ubrowser|edge/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r);("safari"===(a=a?a[0].toLowerCase():e.BROWSER_TYPE_UNKNOWN)&&n||"qq"===a&&r.match(/android.*applewebkit/i))&&(a=e.BROWSER_TYPE_ANDROID);c={micromessenger:e.BROWSER_TYPE_WECHAT,trident:e.BROWSER_TYPE_IE,edge:e.BROWSER_TYPE_EDGE,"360 aphone":e.BROWSER_TYPE_360,mxbrowser:e.BROWSER_TYPE_MAXTHON,"opr/":e.BROWSER_TYPE_OPERA,ubrowser:e.BROWSER_TYPE_UC};e.browserType=c[a]||a,e.browserVersion="",o=(o=r.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i))||r.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i),e.browserVersion=o?o[4]:"";s=window.innerWidth||document.documentElement.clientWidth;n=window.innerHeight||document.documentElement.clientHeight;c=window.devicePixelRatio||1;e.windowPixelResolution={width:c*s,height:c*n},e._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.");};a=document.createElement("canvas");try{var _=e.localStorage=t.localStorage;_.setItem("storage",""),_.removeItem("storage"),_=null;}catch(t){r=function(){cc.warnID(5200);};e.localStorage={getItem:r,setItem:r,removeItem:r,clear:r};}o=a.toDataURL("image/webp").startsWith("data:image/webp");s=!!a.getContext("2d");c=!1;t.WebGLRenderingContext&&(c=!0);n=e.capabilities={canvas:s,opengl:c,webp:o};var l;void 0===u.ontouchstart&&void 0===h.ontouchstart&&!i.msPointerEnabled||(n.touches=!0),void 0!==u.onmouseup&&(n.mouse=!0),void 0!==u.onkeyup&&(n.keyboard=!0),(t.DeviceMotionEvent||t.DeviceOrientationEvent)&&(n.accelerometer=!0),e.browserVersion,_=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),l={ONLY_ONE:!1,WEB_AUDIO:_,DELAY_CREATE_CTX:!1},e.os===e.OS_IOS&&(l.USE_LOADER_EVENT="loadedmetadata"),e.browserType===e.BROWSER_TYPE_FIREFOX&&(l.DELAY_CREATE_CTX=!0,l.USE_LOADER_EVENT="canplay"),e.os===e.OS_ANDROID&&e.browserType===e.BROWSER_TYPE_UC&&(l.ONE_SOURCE=!0);try{l.WEB_AUDIO&&(l.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)(),l.DELAY_CREATE_CTX&&setTimeout(function(){l.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)();},0));}catch(t){l.WEB_AUDIO=!1,cc.logID(5201);}r=[];(a=document.createElement("audio")).canPlayType&&(a.canPlayType('audio/ogg; codecs="vorbis"')&&r.push(".ogg"),a.canPlayType("audio/mpeg")&&r.push(".mp3"),a.canPlayType('audio/wav; codecs="1"')&&r.push(".wav"),a.canPlayType("audio/mp4")&&r.push(".mp4"),a.canPlayType("audio/x-m4a")&&r.push(".m4a")),l.format=r,e.__audioSupport=l;}return e.NetworkType={NONE:0,LAN:1,WWAN:2},e.getNetworkType=function(){return e.NetworkType.LAN;},e.getBatteryLevel=function(){return 1;},e.garbageCollect=function(){},e.restartVM=function(){},e.getSafeAreaRect=function(){var t=cc.view.getVisibleSize();return cc.rect(0,0,t.width,t.height);},e.isObjectValid=function(t){return!!t;},e.dump=function(){var t="";t=(t=(t=(t=(t=(t=(t=(t=(t+="isMobile : "+this.isMobile+"\r\n")+"language : "+this.language+"\r\n")+"browserType : "+this.browserType+"\r\n")+"browserVersion : "+this.browserVersion+"\r\n")+"capabilities : "+JSON.stringify(this.capabilities)+"\r\n")+"os : "+this.os+"\r\n")+"osVersion : "+this.osVersion+"\r\n")+"platform : "+this.platform+"\r\n")+"Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t);},e.openURL=function(t){window.open(t);},e.now=function(){return Date.now?Date.now():+new Date();},e;}();e.exports=r;},{}],199:[function(t,e,l){"use strict";var r=t("../event/event-target");var i=t("../platform/js");var h=t("../renderer");t("../platform/CCClass");var n={init:function(){this.html=document.getElementsByTagName("html")[0];},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth;},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight;},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(n.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),n.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:n.meta["minimal-ui"]="true",n.availWidth=cc.sys.isMobile?function(t){return window.innerWidth;}:function(t){return t.clientWidth;},n.availHeight=cc.sys.isMobile?function(t){return window.innerHeight;}:function(t){return t.clientHeight;};break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:n.meta["minimal-ui"]="true",n.availWidth=function(t){return t.clientWidth;},n.availHeight=function(t){return t.clientHeight;};}var o=null;function pm0(){r.call(this);var t=this,e=cc.ContainerStrategy,i=cc.ContentStrategy;n.init(this),t._frameSize=cc.size(0,0),t._designResolutionSize=cc.size(0,0),t._originalDesignResolutionSize=cc.size(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=cc.rect(0,0,0,0),t._visibleRect=cc.rect(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=cc.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._antiAliasEnabled=!1,t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this);}cc.js.extend(pm0,r),cc.js.mixin(pm0.prototype,{init:function(){this._initFrameSize();var t=cc.game.canvas.width,e=cc.game.canvas.height;this._designResolutionSize.width=t,this._designResolutionSize.height=e,this._originalDesignResolutionSize.width=t,this._originalDesignResolutionSize.height=e,this._viewportRect.width=t,this._viewportRect.height=e,this._visibleRect.width=t,this._visibleRect.height=e,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect);},_resizeEvent:function(t){var e;e=this.setDesignResolutionSize?this:cc.view;var i=cc.sys;var r,n,a,o;i.browserType!==i.BROWSER_TYPE_UC||i.os!==i.OS_IOS?(i=e._frameSize.width,r=e._frameSize.height,n=e._isRotated,cc.sys.isMobile?(a=(o=cc.game.container.style).margin,o.margin="0",o.display="none",e._initFrameSize(),o.margin=a,o.display="block"):e._initFrameSize(),!0!==t&&e._isRotated===n&&e._frameSize.width===i&&e._frameSize.height===r||(a=e._originalDesignResolutionSize.width,o=e._originalDesignResolutionSize.height,e._resizing=!0,0<a&&e.setDesignResolutionSize(a,o,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call())):setTimeout(function(){e._resizeEvent(t);},0);},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent(),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout(function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1);},500);},resizeWithBrowserSize:function(t){t?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange));},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t);},setOrientation:function(t){var e;(t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t&&(this._orientation=t,t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height,this.setDesignResolutionSize(t,e,this._resolutionPolicy));},_initFrameSize:function(){var t=this._frameSize;var e=n.availWidth(cc.game.frame);var i=n.availHeight(cc.game.frame);var r=i<=e;!cc.sys.isMobile||r&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1;},1e3);},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var r,n,a,o=document.getElementsByName("viewport"),o=o?o[0]:null;for(n in r=o?o.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1==r.indexOf(n)?r+=","+n+"="+t[n]:e&&(a=new RegExp(n+"s*=s*[^,]+"),r.replace(a,n+"="+t[n]));/^,/.test(r)&&(r=r.substr(1)),i.content=r,o&&(o.content=r),document.head.appendChild(i);},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(n.meta,!1),this._isAdjustViewport=!1);},adjustViewportMeta:function(t){this._isAdjustViewport=t;},enableRetina:function(t){this._retinaEnabled=!!t;},isRetinaEnabled:function(){return this._retinaEnabled;},enableAntiAlias:function(t){if(cc.warnID(9200),this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL){var e=cc.loader._cache;for(var i in e){i=e[i];i=i&&i.content instanceof cc.Texture2D?i.content:null;var r;i&&(r=cc.Texture2D.Filter,t?i.setFilters(r.LINEAR,r.LINEAR):i.setFilters(r.NEAREST,r.NEAREST));}}else{var n;cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&((n=cc.game.canvas.getContext("2d")).imageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t);}},isAntiAliasEnabled:function(){return this._antiAliasEnabled;},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame));},isAutoFullScreenEnabled:function(){return this._autoFullScreen;},setCanvasSize:function(t,e){var i=cc.game.canvas;var r=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",this._resizeEvent();},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height);},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height);},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(!0);},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height);},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY);},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y);},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY);},getResolutionPolicy:function(){return this._resolutionPolicy;},setResolutionPolicy:function(t){var e=this;var i;t instanceof cc.ResolutionPolicy?e._resolutionPolicy=t:(t===(i=cc.ResolutionPolicy).EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth));},setDesignResolutionSize:function(t,e,i){var r;0<t||0<e?(this.setResolutionPolicy(i),(i=this._resolutionPolicy)&&i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i?(this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e,(t=i.apply(this,this._designResolutionSize)).scale&&2===t.scale.length&&(this._scaleX=t.scale[0],this._scaleY=t.scale[1]),t.viewport&&(e=this._viewportRect,r=this._visibleRect,t=t.viewport,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,r.x=0,r.y=0,r.width=t.width/this._scaleX,r.height=t.height/this._scaleY),i.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),h.updateCameraViewport(),cc.internal.inputManager._updateCanvasBoundingRect(),this.emit("design-resolution-changed")):cc.logID(2201)):cc.logID(2200);},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height);},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i);},setViewportInPoints:function(t,e,i,r){var n=this._scaleX,a=this._scaleY;cc.game._renderContext.viewport(t*n+this._viewportRect.x,e*a+this._viewportRect.y,i*n,r*a);},setScissorInPoints:function(t,e,i,r){var n=this._scaleX,a=this._scaleY;t=Math.ceil(t*n+this._viewportRect.x);e=Math.ceil(e*a+this._viewportRect.y);i=Math.ceil(i*n);n=Math.ceil(r*a);r=cc.game._renderContext;o||(a=r.getParameter(r.SCISSOR_BOX),o=cc.rect(a[0],a[1],a[2],a[3])),o.x===t&&o.y===e&&o.width===i&&o.height===n||(o.x=t,o.y=e,o.width=i,o.height=n,r.scissor(t,e,i,n));},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST);},getScissorRect:function(){o||(t=gl.getParameter(gl.SCISSOR_BOX),o=cc.rect(t[0],t[1],t[2],t[3]));var t=1/this._scaleX;var e=1/this._scaleY;return cc.rect((o.x-this._viewportRect.x)*t,(o.y-this._viewportRect.y)*e,o.width*t,o.height*e);},getViewportRect:function(){return this._viewportRect;},getScaleX:function(){return this._scaleX;},getScaleY:function(){return this._scaleY;},getDevicePixelRatio:function(){return this._devicePixelRatio;},convertToLocationInView:function(t,e,i,r){r=r||cc.v2();var n=i.adjustedLeft||i.left;var a=i.adjustedTop||i.top;t=this._devicePixelRatio*(t-n);n=this._devicePixelRatio*(a+i.height-e);return this._isRotated?(r.x=cc.game.canvas.width-n,r.y=t):(r.x=t,r.y=n),r;},_convertMouseToLocationInView:function(t,e){var i=this._viewportRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY;},_convertPointWithScale:function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY;},_convertTouchesWithScale:function(t){var e,i,r=this._viewportRect,n=this._scaleX,a=this._scaleY;for(var o=0;o<t.length;o++)e=(i=t[o])._point,i=i._prevPoint,e.x=(e.x-r.x)/n,e.y=(e.y-r.y)/a,i.x=(i.x-r.x)/n,i.y=(i.y-r.y)/a;}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var r=cc.game.canvas;this._setupStyle(t,e,i);var n=t._devicePixelRatio=1;t.isRetinaEnabled()&&(n=t._devicePixelRatio=Math.min(t._maxPixelRatio,window.devicePixelRatio||1)),r.width=e*n,r.height=i*n;},_setupStyle:function(t,e,i){var r=cc.game.canvas;var n=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),n.style.width=r.style.width=e+"px",n.style.height=r.style.height=i+"px";},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";t=cc.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0;}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null};},_buildResult:function(t,e,i,r,n,a){Math.abs(t-i)<2&&(i=t),Math.abs(e-r)<2&&(r=e);t=cc.rect((t-i)/2,(e-r)/2,i,r);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[n,a],this._result.viewport=t,this._result;},preApply:function(t){},apply:function(t,e){return{scale:[1,1]};},postApply:function(t){}});t=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(t){var e=t._frameSize.height,i=cc.game.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px";}});var a=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(t,e){var i,r=t._frameSize.width,n=t._frameSize.height,a=cc.game.container.style,o=e.width,e=e.height,s=r/o,c=n/e;e=s<c?(i=r,e*s):(i=o*c,n);s=Math.round((r-i)/2);o=Math.round((n-e)/2);this._setupContainer(t,i=r-2*s,e=n-2*o),t._isRotated?a.margin="0 0 0 "+n+"px":a.margin="0px",a.paddingLeft=s+"px",a.paddingRight=s+"px",a.paddingTop=o+"px",a.paddingBottom=o+"px";}});cc.Class({name:"EqualToWindow",extends:t,preApply:function(t){this._super(t),cc.game.frame=document.documentElement;},apply:function(t){this._super(t),this._fixContainer();}}),cc.Class({name:"ProportionalToWindow",extends:a,preApply:function(t){this._super(t),cc.game.frame=document.documentElement;},apply:function(t,e){this._super(t,e),this._fixContainer();}});var s=cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height);}});var c=("undefined"==typeof window?global:window).__globalAdapter;c&&(c.adaptContainerStrategy&&c.adaptContainerStrategy(cc.ContainerStrategy.prototype),c.adaptView&&c.adaptView(pm0.prototype)),cc.ContainerStrategy.EQUAL_TO_FRAME=new t(),cc.ContainerStrategy.PROPORTION_TO_FRAME=new a(),cc.ContainerStrategy.ORIGINAL_CONTAINER=new s(),c=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,n=i/e.width,e=r/e.height;return this._buildResult(i,r,i,r,n,e);}}),t=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(t,e){var i,r=cc.game.canvas.width,n=cc.game.canvas.height,a=e.width,e=e.height,o=r/a,s=n/e,c=0;return e=o<s?(i=r,e*(c=o)):(i=a*(c=s),n),this._buildResult(r,n,i,e,c,c);}}),a=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(t,e){var i,r,n=cc.game.canvas.width,a=cc.game.canvas.height,o=e.width,e=e.height,s=n/o,c=a/e;return o=s<c?(r=o*(i=c),a):(r=n,e*(i=s)),this._buildResult(n,a,r,o,i,i);}}),s=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,e=r/e.height;return this._buildResult(i,r,i,r,e,e);}});var u=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(t,e){var i=cc.game.canvas.width,r=cc.game.canvas.height,e=i/e.width;return this._buildResult(i,r,i,r,e,e);}});cc.ContentStrategy.EXACT_FIT=new c(),cc.ContentStrategy.SHOW_ALL=new t(),cc.ContentStrategy.NO_BORDER=new a(),cc.ContentStrategy.FIXED_HEIGHT=new s(),cc.ContentStrategy.FIXED_WIDTH=new u(),cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(t,e){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e);},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t);},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e);},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t);},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t);},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t);}}),i.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height);}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new pm0(),cc.winSize=cc.size(),e.exports=cc.view;},{"../event/event-target":115,"../platform/CCClass":189,"../platform/js":209,"../renderer":220}],200:[function(t,e,i){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width;var i=this.height=t.height;var r=t.x,t=t.y,n=t+i,a=r+e;this.topLeft.x=r,this.topLeft.y=n,this.topRight.x=a,this.topRight.y=n,this.top.x=r+e/2,this.top.y=n,this.bottomLeft.x=r,this.bottomLeft.y=t,this.bottomRight.x=a,this.bottomRight.y=t,this.bottom.x=r+e/2,this.bottom.y=t,this.center.x=r+e/2,this.center.y=t+i/2,this.left.x=r,this.left.y=t+i/2,this.right.x=a,this.right.y=t+i/2;}};},{}],201:[function(t,e,i){"use strict";var r=t("./js");t("./utils").isPlainEmptyObj_DEV;function createAttrsSingle(t,e){e=e?Object.create(e):{};return r.value(t,"__attrs__",e),e;}function attr(t,e,i){var r=getClassAttrs(t);var n=e+"$_$";var a={};for(var o in r)o.startsWith(n)&&(a[o.slice(n.length)]=r[o]);return a;}function getClassAttrs(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){if("function"!=typeof t)return createAttrsSingle(t,getClassAttrs(t.constructor));var e;var i=cc.Class.getInheritanceChain(t);for(var r=i.length-1;0<=r;r--){var n=i[r];n.hasOwnProperty("__attrs__")&&n.__attrs__||createAttrsSingle(n,(e=i[r+1])&&e.__attrs__);}return createAttrsSingle(t,(e=i[0])&&e.__attrs__),t.__attrs__;}(t);}function PrimitiveType(t,e){this.name=t,this.default=e;}PrimitiveType.prototype.toString=function(){return this.name;},cc.Integer=new PrimitiveType("Integer",0),cc.Float=new PrimitiveType("Float",0),cc.Boolean=new PrimitiveType("Boolean",!1),cc.String=new PrimitiveType("String",""),e.exports={PrimitiveType:PrimitiveType,attr:attr,getClassAttrs:getClassAttrs,setClassAttr:function(t,e,i,r){getClassAttrs(t)[e+"$_$"+i]=r;},DELIMETER:"$_$",getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}};},{"./CCClass":189,"./js":209,"./utils":213}],202:[function(t,e,r){"use strict";var i=t("./js");var s=i.array.fastRemoveAt;function empty(){}function CallbackInfo(){this.callback=empty,this.target=void 0,this.once=!1;}CallbackInfo.prototype.set=function(t,e,i){this.callback=t,this.target=e,this.once=!!i;};var c=new i.Pool(function(t){return t.callback=empty,t.target=void 0,!(t.once=!1);},32);function CallbackList(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1;}c.get=function(){return this._get()||new CallbackInfo();};t=CallbackList.prototype;t.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.callback===t&&(c.put(i),s(this.callbackInfos,e),--e);}},t.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var i=this.callbackInfos[e];i&&i.target===t&&(c.put(i),s(this.callbackInfos,e),--e);}},t.cancel=function(t){var e=this.callbackInfos[t];e&&(c.put(e),this.callbackInfos[t]=null),this.containCanceled=!0;},t.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(c.put(e),this.callbackInfos[t]=null);}this.containCanceled=!0;},t.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;0<=t;--t)this.callbackInfos[t]||s(this.callbackInfos,t);this.containCanceled=!1;},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1;};var l=new i.Pool(function(t){return t.callbackInfos=[],t.isInvoking=!1,!(t.containCanceled=!1);},16);function CallbacksInvoker(){this._callbackTable=i.createMap(!0);}l.get=function(){return this._get()||new CallbackList();},(t=CallbacksInvoker.prototype).on=function(t,e,i,r){var n=this._callbackTable[t];n=n||(this._callbackTable[t]=l.get());t=c.get();t.set(e,i,r),n.callbackInfos.push(t);},t.hasEventListener=function(t,e,i){t=this._callbackTable[t];if(!t)return!1;var r=t.callbackInfos;if(!e){if(t.isInvoking){for(var n=0;n<r.length;++n)if(r[n])return!0;return!1;}return 0<r.length;}for(var a=0;a<r.length;++a){var o=r[a];if(o&&o.callback===e&&o.target===i)return!0;}return!1;},t.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),l.put(e),delete this._callbackTable[t]));}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking){var n=r.callbackInfos;for(var a=0;a<n.length;++a){var o=n[a];o&&o.target===t&&r.cancel(a);}}else r.removeByTarget(t);}},t.off=function(t,e,i){var r=this._callbackTable[t];if(r){var n=r.callbackInfos;for(var a=0;a<n.length;++a){var o=n[a];if(o&&o.callback===e&&o.target===i){r.isInvoking?r.cancel(a):(s(n,a),c.put(o));break;}}}},t.emit=function(t,e,i,r,n,h){var a=this._callbackTable[t];if(a){var u=!a.isInvoking;a.isInvoking=!0;var _=a.callbackInfos;for(var o=0,d=_.length;o<d;++o){var s=_[o];var c,l;s&&(c=s.target,l=s.callback,s.once&&this.off(t,l,c),c?l.call(c,e,i,r,n,h):l(e,i,r,n,h));}u&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled());}},e.exports=CallbacksInvoker;},{"./js":209}],203:[function(t,e,i){"use strict";e.exports={flattenCodeArray:function(t){var e=[];return function deepFlatten(t,e){for(var i=0;i<e.length;i++){var r=e[i];Array.isArray(r)?deepFlatten(t,r):t.push(r);}}(e,t),e.join("");}};},{}],204:[function(t,e,i){"use strict";var S=t("./js");var T=t("./attribute");var w=t("./CCClass");var E=t("../utils/misc");function cL0(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this._stillUseUrl=S.createMap(!0);}cL0.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,S.clear(this._stillUseUrl);},cL0.prototype.push=function(t,e,i,r){r&&(this._stillUseUrl[this.uuidList.length]=!0),this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e);},(cL0.pool=new S.Pool(function(t){t.reset();},10)).get=function(){return this._get()||new cL0();};(t=_Deserializer.prototype).deserialize=function(t){if(Array.isArray(t)){var e=t;var i=e.length;this.deserializedList.length=i;for(var r=0;r<i;r++)e[r]&&(this.deserializedList[r]=this._deserializeObject(e[r],!1));this.deserializedData=0<i?this.deserializedList[0]:[];}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t,!1):null,this.deserializedList[0]=this.deserializedData;t=this;var n=t.deserializedList;var a=t._idPropList;var o=t._idList;var h=t._idObjList;var s,c,l;for(t._classFinder&&t._classFinder.onDereferenced,s=0;s<o.length;s++)c=a[s],l=o[s],h[s][c]=n[l];return this.deserializedData;},t._deserializeObject=function(t,h,u,e,_){var i;var r=null;var n=null;var a=t.__type__;if("TypedArray"===a){var d=t.array;r=new window[t.ctor](d.length);for(var o=0;o<d.length;++o)r[o]=d[o];return r;}if(a){if(!(n=this._classFinder(a,t,e,_)))return this._classFinder===S._getClassById&&cc.deserialize.reportMissingClass(a),null;if((r=new n())._deserialize)return r._deserialize(t.content,this),r;if(cc.Class._isCCClass(n)){e=this;_=r;a=t;var s=n;var c;s.hasOwnProperty("__deserialize__")?c=s.__deserialize__:(c=f(e,s),S.value(s,"__deserialize__",c,!0));c(e,_,a,s,u);}else this._deserializeTypedObject(r,t,n);}else if(Array.isArray(t)){r=new Array(t.length);for(var l=0;l<t.length;l++)"object"==typeof(i=t[l])&&i?this._deserializeObjField(r,i,""+l,null,h):r[l]=i;}else this._deserializePrimitiveObject(r={},t);return r;},t._deserializeObjField=function(t,e,i,r,n){var a=e.__id__;var o;void 0===a?(o=e.__uuid__)?this.result.push(t,i,o,n):t[i]=this._deserializeObject(e,n):(o=this.deserializedList[a])?t[i]=o:(this._idList.push(a),this._idObjList.push(t),this._idPropList.push(i));},t._deserializePrimitiveObject=function(t,e){for(var i in e){var r;e.hasOwnProperty(i)&&("object"!=typeof(r=e[i])?"__type__"!==i&&(t[i]=r):r?this._deserializeObjField(t,r,i):t[i]=null);}},t._deserializeTypedObject=function(t,e,i){if(i===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===cc.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);var r;if(i===cc.Color)return t.r=e.r||0,t.g=e.g||0,t.b=e.b||0,r=e.a,void(t.a=void 0===r?255:r);if(i===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);var n=T.DELIMETER+"default";var a=T.getClassAttrs(i);var o=i.__props__||Object.keys(t);for(var s=0;s<o.length;s++){var c=o[s];var l=e[c];"object"!=typeof(l=void 0!==l&&e.hasOwnProperty(c)?l:w.getDefault(a[c+n]))?t[c]=l:l?this._deserializeObjField(t,l,c):t[c]=null;}},f=function(a,t){var u=E.BUILTIN_CLASSID_RE.test(S._getClassId(t));var m=cc.js.isChildClassOf(t,cc._BaseNode)||cc.js.isChildClassOf(t,cc.Component);var v;var _=[];var d=_;var f=[];var p=f;var y=[];var g=[];var o=t.__values__;v="_$erialized"===o[o.length-1];var e=T.getClassAttrs(t);var s=T.DELIMETER+"type";var c=T.DELIMETER+"default";var l=T.DELIMETER+"saveUrlAsAsset";var h=T.DELIMETER+"formerlySerializedAs";for(var b=0;b<o.length;b++){var i=o[b];var r=i;e[i+h]&&(r=e[i+h]);var C=e[i+l];var x=w.getDefault(e[i+c]);var A=!1;var n;u&&(n=e[i+s],A=void 0===x&&n?n instanceof T.PrimitiveType:"string"==(n=typeof x)&&!C||"number"==n||"boolean"==n),u&&A?(r!==i&&d===_&&(d=_.slice()),_.push(i),d!==_&&d.push(r)):(r!==i&&p===f&&(p=f.slice()),f.push(i),p!==f&&p.push(r),y.push(C),g.push(x instanceof cc.ValueType&&x.constructor));}return function(t,e,i,l,h){for(var r=0;r<_.length;++r){var n=i[d[r]];void 0!==n&&(e[_[r]]=n);}for(var a=0;a<f.length;++a){var o=f[a];var s=i[p[a]];var c;void 0!==s&&(u||"object"==typeof s?(c=g[a])?u||s?t._deserializeTypedObject(e[o],s,c):e[o]=null:s?t._deserializeObjField(e,s,o,null,y[a]):e[o]=null:e[o]=s);}m&&i._id&&(e._id=i._id),v&&(e._$erialized=JSON.parse(JSON.stringify(i)),t._deserializePrimitiveObject(e._$erialized,i));};},(_Deserializer.pool=new S.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0;},1)).get=function(t,e,i,r,n){var a=this._get();return a?(a.result=t,a.customEnv=r,a._classFinder=i,a):new _Deserializer(t,0,i,r);};var s=_Deserializer;function _Deserializer(t,e,i,r,n){this.result=t,this.customEnv=r,this.deserializedList=[],this.deserializedData=null,this._classFinder=i,this._idList=[],this._idObjList=[],this._idPropList=[];}var f;cc.deserialize=function(t,e,i){var r=(i=i||{}).classFinder||S._getClassById;var n=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE;var a=i.customEnv;i=i.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t));var o=!e;e=e||cL0.pool.get();r=s.pool.get(e,!1,r,a,i);cc.game._isCloning=!0;a=r.deserialize(t);return cc.game._isCloning=!1,s.pool.put(r),n&&e.assignAssetsBy(Editor.serialize.asAsset),o&&cL0.pool.put(e),a;},cc.deserialize.Details=cL0,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t);};},{"../utils/misc":264,"./CCClass":189,"./attribute":201,"./js":209}],205:[function(t,e,i){"use strict";function IdGenerater(t){this.id=0|998*Math.random(),this.prefix=t?t+".":"";}IdGenerater.prototype.getNewId=function(){return this.prefix+ ++this.id;},IdGenerater.global=new IdGenerater("global"),e.exports=IdGenerater;},{}],206:[function(t,e,i){"use strict";t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect");},{"./CCAssetLibrary":188,"./CCClass":189,"./CCClassDecorator":190,"./CCEnum":191,"./CCMacro":194,"./CCObject":195,"./CCSys":198,"./CCVisibleRect":200,"./callbacks-invoker":202,"./deserialize":204,"./instantiate":208,"./instantiate-jit":207,"./js":209,"./requiring-frame":211,"./url":212}],207:[function(t,e,i){"use strict";var o=t("./CCObject");var r=o.Flags.Destroyed;var s=o.Flags.PersistentMask;var h=t("./attribute");var a=t("./js");var u=t("./CCClass");var c=t("./compiler");var _=h.DELIMETER+"default";var n=u.IDENTIFIER_RE;var l=u.escapeForJS;var d={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};try{Float32Array.name||(Float32Array.name="Float32Array"),Float64Array.name||(Float64Array.name="Float64Array"),Int8Array.name||(Int8Array.name="Int8Array"),Int16Array.name||(Int16Array.name="Int16Array"),Int32Array.name||(Int32Array.name="Int32Array"),Uint8Array.name||(Uint8Array.name="Uint8Array"),Uint16Array.name||(Uint16Array.name="Uint16Array"),Uint32Array.name||(Uint32Array.name="Uint32Array");}catch(t){}function Declaration(t,e){this.varName=t,this.expression=e;}function mergeDeclaration(t,e){return e instanceof Declaration?new Declaration(e.varName,t+e.expression):t+e;}function writeAssignment(t,e,i){Array.isArray(i)?(i[0]=mergeDeclaration(e,i[0]),t.push(i)):t.push(mergeDeclaration(e,i)+";");}function Assignments(t){this._exps=[],this._targetExp=t;}function equalsToDefault(t,e){if("function"==typeof t)try{t=t();}catch(t){return!1;}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return Array.isArray(t)&&Array.isArray(e)&&0===t.length&&0===e.length;}catch(t){}}return!1;}function getPropAccessor(t){return n.test(t)?"."+t:"["+l(t)+"]";}function Parser(t,e){var i;this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=a.createMap(),a.mixin(this.funcModuleCache,d),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),a.value(t,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),0<this.globalVariables.length&&(i="var "+this.globalVariables.join(",")+";");e=c.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",e)(this.objs,this.funcs);for(var r=0,n=this.objsToClear_iN$t.length;r<n;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0;}Declaration.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";";},Assignments.prototype.append=function(t,e){this._exps.push([t,e]);},Assignments.prototype.writeCode=function(t){var e;if(1<this._exps.length)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp;}for(var i=0;i<this._exps.length;i++){var r=this._exps[i];writeAssignment(t,e+getPropAccessor(r[0])+"=",r[1]);}},(Assignments.pool=new a.Pool(function(t){t._exps.length=0,t._targetExp=null;},1)).get=function(t){var e=this._get()||new Assignments();return e._targetExp=t,e;};t=Parser.prototype;t.getFuncModule=function(t,e){var i=a.getClassName(t);if(i){var r=this.funcModuleCache[i];if(r)return r;if(void 0===r)if(-1!==i.indexOf("."))try{if(t===Function("return "+i)())return this.funcModuleCache[i]=i;}catch(t){}}r=this.funcs.indexOf(t);r<0&&(r=this.funcs.length,this.funcs.push(t));t="F["+r+"]";return this.funcModuleCache[i]=t=e?"("+t+")":t;},t.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]";},t.setValueType=function(t,e,i,r){var n=Assignments.pool.get(r);var a=e.constructor.__props__;a=a||Object.keys(e);for(var o=0;o<a.length;o++){var s=a[o];var c=i[s];e[s]!==c&&(c=this.enumerateField(i,s,c),n.append(s,c));}n.writeCode(t),Assignments.pool.put(n);},t.enumerateCCClass=function(t,e,i){var r=i.__values__;var n=h.getClassAttrs(i);for(var a=0;a<r.length;a++){var o=r[a];var s=e[o];var c=n[o+_];var l;equalsToDefault(c,s)||("object"==typeof s&&s instanceof cc.ValueType&&(c=u.getDefault(c))&&c.constructor===s.constructor?(l="o"+getPropAccessor(o),this.setValueType(t,c,s,l)):this.setObjProp(t,e,o,s));}},t.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId;var i=[new Declaration(e,"new Array("+t.length+")")];a.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)writeAssignment(i,e+"["+r+"]=",this.enumerateField(t,r,t[r]));return i;},t.instantiateTypedArray=function(t){var e=t.constructor.name||function(t){if(t===Float32Array)return"Float32Array";if(t===Float64Array)return"Float64Array";if(t===Int8Array)return"Int8Array";if(t===Int16Array)return"Int16Array";if(t===Int32Array)return"Int32Array";if(t===Uint8Array)return"Uint8Array";if(t===Uint16Array)return"Uint16Array";if(t===Uint32Array)return"Uint32Array";throw new Error("Unknown TypedArray could not be instantiated: "+t);}(t.constructor);if(0===t.length)return"new "+e;var i="a"+ ++this.localVariableId;var r=[new Declaration(i,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)0!==t[n]&&writeAssignment(r,i+"["+n+"]=",t[n]);return r;},t.enumerateField=function(t,e,i){var r,n,a;return"object"==typeof i&&i?(r=i._iN$t)?((n=r.globalVar)||(n=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(n),a=r.source[0],r.source[0]=mergeDeclaration(n+"=",a)),n):ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i):"function"==typeof i?this.getFuncModule(i):"string"==typeof i?l(i):("_objFlags"===e&&t instanceof o&&(i&=s),i);},t.setObjProp=function(t,e,i,r){writeAssignment(t,"o"+getPropAccessor(i)+"=",this.enumerateField(e,i,r));},t.enumerateObject=function(t,e){var i=e.constructor;if(cc.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var r in e){var n;!e.hasOwnProperty(r)||95===r.charCodeAt(0)&&95===r.charCodeAt(1)&&"__type__"!==r||"object"==typeof(n=e[r])&&n&&n===e._iN$t||this.setObjProp(t,e,r,n);}},t.instantiateObj=function(t){if(t instanceof cc.ValueType)return u.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&r)return null;var e;var i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t);}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t);}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new Declaration("o","new "+this.getFuncModule(i,!0)+"()");}else if(i===Object)e=new Declaration("o","{}");else{if(i)return this.getObjRef(t);e=new Declaration("o","Object.create(null)");}i=[e];return a.value(t,"_iN$t",{globalVar:"",source:i},!0),this.objsToClear_iN$t.push(t),this.enumerateObject(i,t),["(function(){",i,"return o;})();"];},e.exports={compile:function(t){return new Parser(t,t instanceof cc._BaseNode&&t).result;},equalsToDefault:equalsToDefault};},{"./CCClass":189,"./CCObject":195,"./attribute":201,"./compiler":203,"./js":209}],208:[function(t,e,i){"use strict";var f=t("./CCObject");var p=t("../value-types/value-type");var l=f.Flags.Destroyed;var y=f.Flags.PersistentMask;var a=t("./utils").isDomNode;var m=t("./js");function instantiate(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null;}var i;if(t instanceof f){if(t._instantiate)return cc.game._isCloning=!0,i=t._instantiate(),cc.game._isCloning=!1,i;if(t instanceof cc.Asset)return null;}return cc.game._isCloning=!0,i=doInstantiate(t),cc.game._isCloning=!1,i;}var v=[];function doInstantiate(t,e){if(Array.isArray(t))return null;if(a&&a(t))return null;var i;i=t._iN$t||(t.constructor?new t.constructor():Object.create(null)),enumerateObject(t,i,e);for(var r=0,n=v.length;r<n;++r)v[r]._iN$t=null;return v.length=0,i;}function enumerateObject(t,e,i){m.value(t,"_iN$t",e,!0),v.push(t);var h=t.constructor;if(cc.Class._isCCClass(h)){var u=t;var r=e;var _=i;var d=h.__values__;for(var n=0;n<d.length;n++){var a=d[n];var o=u[a];var s;"object"==typeof o&&o?(s=r[a])instanceof p&&s.constructor===o.constructor?s.set(o):r[a]=o._iN$t||instantiateObj(o,_):r[a]=o;}}else for(var c in t){var l;!t.hasOwnProperty(c)||95===c.charCodeAt(0)&&95===c.charCodeAt(1)&&"__type__"!==c||("object"==typeof(l=t[c])&&l?l!==e&&(e[c]=l._iN$t||instantiateObj(l,i)):e[c]=l);}t instanceof f&&(e._objFlags&=y);}function instantiateObj(t,e){if(t instanceof p)return t.clone();if(t instanceof cc.Asset)return t;var i;if(ArrayBuffer.isView(t)){var r=t.length;i=new t.constructor(r),t._iN$t=i,v.push(t);for(var n=0;n<r;++n)i[n]=t[n];return i;}if(Array.isArray(t)){var a=t.length;i=new Array(a),m.value(t,"_iN$t",i,!0),v.push(t);for(var o=0;o<a;++o){var s=t[o];i[o]="object"==typeof s&&s?s._iN$t||instantiateObj(s,e):s;}return i;}if(t._objFlags&l)return null;var c=t.constructor;if(cc.Class._isCCClass(c)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t;}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t;}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;i=new c();}else if(c===Object)i={};else{if(c)return t;i=Object.create(null);}return enumerateObject(t,i,e),i;}instantiate._clone=doInstantiate,cc.instantiate=instantiate,e.exports=instantiate;},{"../value-types/value-type":287,"./CCObject":195,"./js":209,"./utils":213}],209:[function(t,e,i){"use strict";var h=new(t("./id-generater"))("TmpCId.");function _getPropertyDescriptor(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t);}return null;}function _copyprop(t,e,i){e=_getPropertyDescriptor(e,t);Object.defineProperty(i,t,e);}var o={isNumber:function(t){return"number"==typeof t||t instanceof Number;},isString:function(t){return"string"==typeof t||t instanceof String;},addon:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r)if("object"==typeof r)for(var n in r)n in t||_copyprop(n,r,t);else cc.errorID(5402,r);}return t;},mixin:function(t){t=t||{};for(var e=1,i=arguments.length;e<i;e++){var r=arguments[e];if(r)if("object"==typeof r)for(var n in r)_copyprop(n,r,t);else cc.errorID(5403,r);}return t;},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t;},getSuper:function(t){t=t.prototype;t=t&&Object.getPrototypeOf(t);return t&&t.constructor;},isChildClassOf:function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=o.getSuper(t)))return!1;if(t===e)return!0;}}return!1;},clear:function(t){var e=Object.keys(t);for(var i=0;i<e.length;i++)delete t[e[i]];},isEmptyObject:function(t){for(var e in t)return!1;return!0;},getPropertyDescriptor:_getPropertyDescriptor};var a={value:void 0,enumerable:!1,writable:!1,configurable:!0};var s={get:null,set:null,enumerable:!(o.value=function(t,e,i,r,n){a.value=i,a.writable=r,a.enumerable=n,Object.defineProperty(t,e,a),a.value=void 0;})};var c={get:null,enumerable:!(o.getset=function(t,e,i,r,n,a){"function"!=typeof r&&(n=r,r=void 0),s.get=i,s.set=r,s.enumerable=n,s.configurable=a,Object.defineProperty(t,e,s),s.get=null,s.set=null;}),configurable:!1};var l={set:null,enumerable:!(o.get=function(t,e,i,r,n){c.get=i,c.enumerable=r,c.configurable=n,Object.defineProperty(t,e,c),c.get=null;}),configurable:!1};function setup(r,t,n){return o.getset(o,t,function(){return Object.assign({},n);},function(t){o.clear(n),Object.assign(n,t);}),function(t,e){var i;e.prototype.hasOwnProperty(r)&&delete n[e.prototype[r]],o.value(e.prototype,r,t),t&&((i=n[t])&&i!==e?cc.error("A Class already exists with the same "+r+' : "'+t+'".'):n[t]=e);};}var r,n,u;o.set=function(t,e,i,r,n){l.set=i,l.enumerable=r,l.configurable=n,Object.defineProperty(t,e,l),l.set=null;},o.getClassName=function(t){if("function"!=typeof t)return t&&t.constructor?o.getClassName(t.constructor):"";var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;e="";return t.name&&(e=t.name),!t.toString||(t="["===(t=t.toString()).charAt(0)?t.match(/\[\w+\s*(\w+)\]/):t.match(/function\s*(\w+)/))&&2===t.length&&(e=t[1]),"Object"!==e?e:"";},r={},n={},o._setClassId=setup("__cid__","_registeredClassIds",r),u=setup("__classname__","_registeredClassNames",n),o.setClassName=function(t,e){u(t,e),e.prototype.hasOwnProperty("__cid__")||(t=t||h.getNewId())&&o._setClassId(t,e);},o.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t].prototype;var i=e.__cid__;i&&delete r[i];i=e.__classname__;i&&delete n[i];}},o._getClassById=function(t){return r[t];},o.getClassByName=function(t){return n[t];},o._getClassId=function(t,e){if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__;}return"";},o.obsolete=function(t,e,i,r){var n=/([^.]+)$/;e=n.exec(e)[0];var a=n.exec(i)[0];function get(){return this[a];}r?o.getset(t,e,get,function(t){this[a]=t;}):o.get(t,e,get);},o.obsoletes=function(t,e,i,r){for(var n in i){var a=i[n];o.obsolete(t,e+"."+n,a,r);}};var _=/(%d)|(%s)/;var d=/%s/;function removeAt(t,e){t.splice(e,1);}function remove(t,e){e=t.indexOf(e);return 0<=e&&(removeAt(t,e),!0);}o.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&_.test(e))for(var i=1;i<t;++i){var r=arguments[i];var n="number"==typeof r?_:d;n.test(e)?e=e.replace(n,r):e+=" "+r;}else for(var a=1;a<t;++a)e+=" "+arguments[a];return e;},o.shiftArguments=function(){var t=arguments.length-1;var e=new Array(t);for(var i=0;i<t;++i)e[i]=arguments[i+1];return e;},o.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e;};var f=Array.prototype.indexOf;function Pool(t,e){void 0===e&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t;}o.array={remove:remove,fastRemove:function(t,e){0<=(e=t.indexOf(e))&&(t[e]=t[t.length-1],--t.length);},removeAt:removeAt,fastRemoveAt:function(t,e){var i=t.length;e<0||i<=e||(t[e]=t[i-1],t.length=i-1);},contains:function(t,e){return 0<=t.indexOf(e);},verifyType:function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0;},removeArray:function(t,e){for(var i=0,r=e.length;i<r;i++)remove(t,e[i]);},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t;},copy:function(t){var e,i=t.length,r=new Array(i);for(e=0;e<i;e+=1)r[e]=t[e];return r;},indexOf:f,MutableForwardIterator:t("../utils/mutable-forward-iterator")},Pool.prototype._get=function(){var t;return 0<this.count?(--this.count,t=this._pool[this.count],this._pool[this.count]=null,t):null;},Pool.prototype.put=function(t){var e=this._pool;this.count<e.length&&(this._cleanup&&!1===this._cleanup(t)||(e[this.count]=t,++this.count));},Pool.prototype.resize=function(t){0<=t&&(this._pool.length=t,this.count>t&&(this.count=t));},o.Pool=Pool,cc.js=o,e.exports=o;},{"../utils/mutable-forward-iterator":265,"./id-generater":205}],210:[function(t,e,s){"use strict";var a=t("./js");var o=t("./attribute");var c={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function _wrapOptions(t,e,i,r){t=t?{_short:!0}:{_short:!0,default:e};return i&&(r?t.url=i:t.type=i),t;}s.getFullFormOfProperty=function(t,e,i,r){return t&&t.constructor===Object?null:Array.isArray(t)&&0<t.length?(t[0],_wrapOptions(e,[],t)):"function"==typeof t?(n=t,cc.RawAsset.isRawAssetType(n)||cc.RawAsset.wasRawAssetType(n)?_wrapOptions(e,"",n,!0):_wrapOptions(e,a.isChildClassOf(n,cc.ValueType)?new n():null,n)):t instanceof o.PrimitiveType?_wrapOptions(e,t.default):_wrapOptions(e,t);var n;},s.preprocessAttrs=function(t,e,i,r){for(var n in t){var a=t[n];var o=s.getFullFormOfProperty(a,!1,n,e);(a=o?t[n]=o:a)&&((o=a.notify)&&function(t,e,i,r){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var n="_N$"+e;t.get=function(){return this[n];},t.set=function(t){var e=this[n];this[n]=t,i.call(this,e);};var a={};for(var o in r[n]=a,c){var s=c[o];t.hasOwnProperty(o)&&(a[o]=t[o],s.canUsedInGet||delete t[o]);}}}(a,n,o,t),"type"in a&&function(t,e,i,r){if(Array.isArray(e)){if(!(0<e.length))return cc.errorID(5508,i,r);if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],delete t.type;t.type=e=e[0];}"function"==typeof e&&(e===String?t.type=cc.String:e===Boolean?t.type=cc.Boolean:e===Number&&(t.type=cc.Float));}(a,a.type,e,n),"url"in a&&(n=(o=a).url,Array.isArray(n)&&0<n.length&&(n=n[0]),o.type=n),"type"in a&&a.type);}},s.validateMethodWithProps=function(t,e,i,r,n){return"function"==typeof t||null===t;};},{"./CCClass":189,"./attribute":201,"./js":209}],211:[function(t,e,i){"use strict";var n=[];cc._RF={push:function(t,e,i){void 0===i&&(i=e,e=""),n.push({uuid:e,script:i,module:t,exports:t.exports,beh:null});},pop:function(){var t=n.pop();var e=t.module;var i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=t.cls;}},peek:function(){return n[n.length-1];}};},{}],212:[function(t,e,i){"use strict";cc.url={_rawAssets:"",normalize:function(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t;},raw:function(t){if((t=this.normalize(t)).startsWith("resources/")){var e=cc.loader._getResUuid(t.slice(10),cc.Asset,null,!0);if(e)return cc.AssetLibrary.getLibUrlNoExt(e,!0)+cc.path.extname(t);}else cc.errorID(7002,t);return this._rawAssets+t;},_init:function(t){this._rawAssets=cc.path.stripSep(t)+"/";}},e.exports=cc.url;},{}],213:[function(t,e,i){"use strict";t("./js");e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;}while(null!==(i=i.parentNode));return!1;},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node;}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName;}),callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i);},0);}};},{"./js":209}],214:[function(t,e,i){"use strict";t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./CCDirector"),t("./renderer"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager");},{"./CCDirector":28,"./CCScheduler":33,"./event":117,"./event-manager":113,"./load-pipeline":144,"./platform/CCInputExtension":192,"./platform/CCInputManager":193,"./platform/CCMacro":194,"./platform/CCScreen":197,"./platform/CCSys":198,"./platform/CCView":199,"./platform/js":209,"./renderer":220,"./utils":262,"./value-types":279}],215:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("./assembler"));var n=_interopRequireDefault(t("./utils/dynamic-atlas/manager"));var a=_interopRequireDefault(t("./webgl/render-data"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(r){return function(){var t=_getPrototypeOf(r);var e;return e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(i=e)||"object"!=typeof i&&"function"!=typeof i?_assertThisInitialized(t):i;var i;};}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}t=function(e){i=e,(t=Assembler2D).prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i;_createSuper(Assembler2D);function Assembler2D(){var t;return(t=e.call(this)||this)._renderData=new a.default(),t._renderData.init(_assertThisInitialized(t)),t.initData(),t.initLocal(),t;}var t=Assembler2D.prototype;var i,r;return t.initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount);},t.initLocal=function(){this._local=[],this._local.length=4;},t.updateColor=function(t,e){var i=this._renderData.uintVDatas[0];if(i){e=e||t.node.color._val;var r=this.floatsPerVert;for(var n=this.colorOffset,a=i.length;n<a;n+=r)i[n]=e;}},t.getBuffer=function(){return cc.renderer._handle._meshBuffer;},t.updateWorldVerts=function(t){var e=this._local;var i=this._renderData.vDatas[0];var t=t.node._worldMatrix.m,r=t[0],n=t[1],h=t[4],a=t[5],o=t[12],t=t[13];var s=e[0],c=e[2],l=e[1],e=e[3];var u,_,d;1===r&&0===n&&0===h&&1===a?(i[0]=s+o,i[1]=l+t,i[5]=c+o,i[6]=l+t,i[10]=s+o,i[11]=e+t,i[15]=c+o,i[16]=e+t):(u=r*c,_=n*s,n=n*c,c=h*e,d=a*l,a=a*e,i[0]=(e=r*s)+(r=h*l)+o,i[1]=_+d+t,i[5]=u+r+o,i[6]=n+d+t,i[10]=e+c+o,i[11]=_+a+t,i[15]=u+c+o,i[16]=n+a+t);},t.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);t=this._renderData;var i=t.vDatas[0];var r=t.iDatas[0];t=this.getBuffer(e);e=t.request(this.verticesCount,this.indicesCount);var n=e.byteOffset>>2,a=t._vData;i.length+n>a.length?a.set(i.subarray(0,a.length-n),n):a.set(i,n);var o=t._iData,s=e.indiceOffset,c=e.vertexOffset;for(var l=0,h=r.length;l<h;l++)o[s++]=c+r[l];},t.packToDynamicAtlas=function(t,e){e._original||!n.default||!e._texture.packable||(i=n.default.insertSpriteFrame(e))&&e._setDynamicAtlasFrame(i);var i=t._materials[0];i&&i.getProperty("texture")!==e._texture&&(t._vertsDirty=!0,t._updateMaterial());},i=Assembler2D,(t=[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert;}}])&&_defineProperties(i.prototype,t),r&&_defineProperties(i,r),Assembler2D;}(r.default);i.default=t,cc.js.addon(t.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4}),cc.Assembler2D=t,e.exports=i.default;},{"./assembler":217,"./utils/dynamic-atlas/manager":223,"./webgl/render-data":250}],216:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../utils/pool"))&&t.__esModule?t:{default:t};function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var r=0;function getAssemblerId(t){return Object.getOwnPropertyDescriptor(t,"__assemblerId__")||(t.__assemblerId__=++r),t.__assemblerId__;}var n=new(function(n){var t;t=n,(e=AssemblerPool).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(AssemblerPool);function AssemblerPool(){var t;for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return(t=n.call.apply(n,[this].concat(i))||this)._pool={},t;}var e=AssemblerPool.prototype;return e.put=function(t){var e,i;t&&this.enabled&&(e=getAssemblerId(t.constructor),(i=this._pool)[e]||(i[e]=[]),this.count>this.maxSize||(this._clean(t),i[e].push(t),this.count++));},e.get=function(t){var e;var i,r;return(e=this.enabled?(i=this._pool)[r=getAssemblerId(t)]&&i[r].pop():e)?this.count--:e=new t(),e;},e.clear=function(){this._pool={},this.count=0;},e._clean=function(t){t._renderComp=null;},AssemblerPool;}(t.default))();t.default.register("assembler",n),i.default=n,e.exports=i.default;},{"../utils/pool":266}],217:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("./webgl/vertex-format");var n=(t=t("./assembler-pool"))&&t.__esModule?t:{default:t};(t=Assembler.prototype).init=function(t){this._renderComp=t;},t.updateRenderData=function(t){},t.fillBuffers=function(t,e){},t.getVfmt=function(){return r.vfmtPosUvColor;};t=Assembler;function Assembler(){this._extendNative&&this._extendNative();}(i.default=t).register=function(t,e){t.__assembler__=e;},t.init=function(t){var e=t.constructor;var i=e.__assembler__;for(;!i;){if(!(e=e.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(t)+"]");i=e.__assembler__;}var r;i.getConstructor&&(i=i.getConstructor(t)),t._assembler&&t._assembler.constructor===i||((r=n.default.get(i)).init(t),t._assembler=r);},cc.Assembler=t,e.exports=i.default;},{"./assembler-pool":216,"./webgl/vertex-format":252}],218:[function(t,e,i){"use strict";function EsM(t){var e;try{e=t.getContext("2d");}catch(t){return void console.error(t);}this._canvas=t,this._ctx=e,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0;}EsM.prototype._restoreTexture=function(t){},EsM.prototype.setViewport=function(t,e,i,r){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===r||(this._vx=t,this._vy=e,this._vw=i,this._vh=r);},EsM.prototype.setScissor=function(t,e,i,r){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===r||(this._sx=t,this._sy=e,this._sw=i,this._sh=r);},EsM.prototype.clear=function(t){var e=this._ctx;e.clearRect(this._vx,this._vy,this._vw,this._vh),!t||0===t[0]&&0===t[1]&&0===t[2]||(e.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",e.globalAlpha=t[3],e.fillRect(this._vx,this._vy,this._vw,this._vh));},EsM.prototype.resetDrawCalls=function(){this._stats.drawcalls=0;},EsM.prototype.getDrawCalls=function(){return this._stats.drawcalls;},e.exports=EsM;},{}],219:[function(t,e,i){"use strict";function DsM(t,e){this._device=t,this._width=4,this._height=4,this._image=null,e&&(void 0!==e.width&&(this._width=e.width),void 0!==e.height&&(this._height=e.height),this.updateImage(e));}DsM.prototype.update=function(t){this.updateImage(t);},DsM.prototype.updateImage=function(t){t.images&&t.images[0]&&(t=t.images[0])&&t!==this._image&&(this._image=t);},DsM.prototype.destroy=function(){this._image=null;},e.exports=DsM;},{}],220:[function(a,t,e){"use strict";e.__esModule=!0,e.default=void 0;var o=_interopRequireDefault(a("../../renderer/gfx"));var i=_interopRequireDefault(a("../../renderer/core/input-assembler"));var r=_interopRequireDefault(a("../../renderer/core/pass"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}i=cc.renderer={Texture2D:null,InputAssembler:i.default,Pass:r.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(t,e){a("./webgl/assemblers");var i=a("./webgl/model-batcher");this.Texture2D=o.default.Texture2D,this.canvas=t,this._flow=cc.RenderFlow;var r=a("../../renderer/scene/scene");var n=a("../../renderer/renderers/forward-renderer");this.device=new o.default.Device(t,e),this.scene=new r();t=this.device;e={defaultTexture:new o.default.Texture2D(t,{images:[],width:128,height:128,wrapS:o.default.WRAP_REPEAT,wrapT:o.default.WRAP_REPEAT,format:o.default.TEXTURE_FMT_RGB8,mipmap:!1}),programTemplates:[],programChunks:{}};this._forward=new n(this.device,e),this._handle=new i(this.device,this.scene),this._flow.init(this._handle,this._forward);},initCanvas:function(t){var e=a("./canvas");var i=a("./canvas/Texture2D");var r=a("./canvas/Device");this.Device=r,this.Texture2D=i,this.canvas=t,this.device=new r(t),this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0},this._handle=new e.RenderComponentHandle(this.device,this._camera),this._forward=new e.ForwardRenderer(),this._flow=cc.RenderFlow,this._flow.init(this._handle,this._forward);},updateCameraViewport:function(){var t;!cc.director||(t=cc.director.getScene())&&t.setScale(1,1,1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(t=cc.view.getViewportRect(),this.device.setViewport(t.x,t.y,t.width,t.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=t.x,this._camera.ty=t.y+t.height);},render:function(t,e){this.device.resetDrawCalls(),t&&(this._flow.render(t,e),this.drawCalls=this.device.getDrawCalls());},clear:function(){this._handle.reset(),this._forward.clear();}};e.default=i,t.exports=e.default;},{"../../renderer/core/input-assembler":302,"../../renderer/core/pass":303,"../../renderer/gfx":312,"../../renderer/renderers/forward-renderer":331,"../../renderer/scene/scene":334,"./canvas":void 0,"./canvas/Device":218,"./canvas/Texture2D":219,"./webgl/assemblers":232,"./webgl/model-batcher":248}],221:[function(e,i,s){"use strict";var t=0;t++;t++;t++;t++;t++;t++;t++;t++;t++;var r=1024;var u,n;var _=0;function RenderFlow(){this._func=init,this._next=null;}t=RenderFlow.prototype;t._doNothing=function(){},t._localTransform=function(t){t._updateLocalMatrix(),t._renderFlag&=-5,this._next._func(t);},t._worldTransform=function(t){u.worldMatDirty++;var e=t._matrix;var i=t._trs;var r=e.m;r[12]=i[0],r[13]=i[1],r[14]=i[2],t._mulMat(t._worldMatrix,t._parent._worldMatrix,e),t._renderFlag&=-9,this._next._func(t),u.worldMatDirty--;},t._opacity=function(t){u.parentOpacityDirty++,t._renderFlag&=-33,this._next._func(t),u.parentOpacityDirty--;},t._color=function(t){var e=t._renderComponent;e&&e._updateColor(),t._renderFlag&=-65,this._next._func(t);},t._updateRenderData=function(t){var e=t._renderComponent;e._assembler.updateRenderData(e),t._renderFlag&=-17,this._next._func(t);},t._render=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.fillBuffers(e,u),this._next._func(t);},t._children=function(t){var e=_;var i=u;var r=i.parentOpacity;var n=i.parentOpacity*=t._opacity/255;var a=(i.worldMatDirty?8:0)|(i.parentOpacityDirty?96:0);var o=t._children;for(var s=0,h=o.length;s<h;s++){var c=o[s];var l;c._renderFlag|=a,c._activeInHierarchy&&0!==c._opacity&&(_=c._cullingMask=0===c.groupIndex?e:1<<c.groupIndex,l=c._color._val,c._color._fastSetA(c._opacity*n),d[c._renderFlag]._func(c),c._color._val=l);}i.parentOpacity=r,this._next._func(t);},t._postRender=function(t){var e=t._renderComponent;e._checkBacth(u,t._cullingMask),e._assembler.postFillBuffers(e,u),this._next._func(t);};var a=new RenderFlow();a._func=a._doNothing,a._next=a;var d={};function createFlow(t,e){var i=new RenderFlow();switch(i._next=e||a,t){case 1:case 2:i._func=i._doNothing;break;case 4:i._func=i._localTransform;break;case 8:i._func=i._worldTransform;break;case 32:i._func=i._opacity;break;case 64:i._func=i._color;break;case 16:i._func=i._updateRenderData;break;case 128:i._func=i._render;break;case 256:i._func=i._children;break;case 512:i._func=i._postRender;}return i;}function init(t){var e=t._renderFlag;(d[e]=function(t){var e=null;var i=r;for(;0<i;)i&t&&(e=createFlow(i,e)),i>>=1;return e;}(e))._func(t);}RenderFlow.flows=d,RenderFlow.createFlow=createFlow;var o=[];RenderFlow.registerValidate=function(t){t._inValidateList||(o.push(t),t._inValidateList=!0);},RenderFlow.validateRenderers=function(){for(var t=0,e=o.length;t<e;t++){var i=o[t];i.isValid&&(i.enabledInHierarchy?i._validateRender():i.disableRender(),i._inValidateList=!1);}o.length=0;},RenderFlow.visitRootNode=function(t){RenderFlow.validateRenderers(),_=1<<t.groupIndex,8&t._renderFlag?(u.worldMatDirty++,t._calculWorldMatrix(),t._renderFlag&=-9,d[t._renderFlag]._func(t),u.worldMatDirty--):d[t._renderFlag]._func(t);},RenderFlow.render=function(t,e){u.reset(),u.walking=!0,RenderFlow.visitRootNode(t),u.terminate(),u.walking=!1,n.render(u._renderScene,e);},RenderFlow.init=function(t,e){u=t,n=e,d[0]=a;for(var i=1;i<r;i++)d[i]=new RenderFlow();},RenderFlow.getBachther=function(){return u;},RenderFlow.FLAG_DONOTHING=1,RenderFlow.FLAG_BREAK_FLOW=2,RenderFlow.FLAG_LOCAL_TRANSFORM=4,RenderFlow.FLAG_WORLD_TRANSFORM=8,RenderFlow.FLAG_TRANSFORM=12,RenderFlow.FLAG_OPACITY=32,RenderFlow.FLAG_COLOR=64,RenderFlow.FLAG_OPACITY_COLOR=96,RenderFlow.FLAG_UPDATE_RENDER_DATA=16,RenderFlow.FLAG_RENDER=128,RenderFlow.FLAG_CHILDREN=256,RenderFlow.FLAG_POST_RENDER=512,RenderFlow.FLAG_FINAL=r,i.exports=cc.RenderFlow=RenderFlow;},{}],222:[function(t,e,i){"use strict";var r=t("../../../assets/CCRenderTexture");function Atlas(t,e){var i=new r();i.initWithSize(t,e),i.update(),this._texture=i,this._x=2,this._y=2,this._nexty=2,this._width=t,this._height=e,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0;}Atlas.DEFAULT_HASH=new r()._getHash(),cc.js.mixin(Atlas.prototype,{insertSpriteFrame:function(t){var e=t._rect,i=t._texture,r=this._innerTextureInfos[i._id];var n=e.x,e=e.y;if(r)n+=r.x,e+=r.y;else{var r=i.width,a=i.height;if(this._x+r+2>this._width&&(this._x=2,this._y=this._nexty),this._y+a+2>this._nexty&&(this._nexty=this._y+a+2),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((r<=8||a<=8)&&(this._texture.drawTextureAt(i,this._x-1,this._y-1),this._texture.drawTextureAt(i,this._x-1,this._y+1),this._texture.drawTextureAt(i,this._x+1,this._y-1),this._texture.drawTextureAt(i,this._x+1,this._y+1)),this._texture.drawTextureAt(i,this._x-1,this._y),this._texture.drawTextureAt(i,this._x+1,this._y),this._texture.drawTextureAt(i,this._x,this._y-1),this._texture.drawTextureAt(i,this._x,this._y+1)),this._texture.drawTextureAt(i,this._x,this._y),this._innerTextureInfos[i._id]={x:this._x,y:this._y,texture:i},this._count++,n+=this._x,e+=this._y,this._x+=r+2,this._dirty=!0;}a={x:n,y:e,texture:this._texture};return this._innerSpriteFrames.push(t),a;},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1);},deleteInnerTexture:function(t){t&&this._innerTextureInfos[t._id]&&(delete this._innerTextureInfos[t._id],this._count--);},isEmpty:function(){return this._count<=0;},reset:function(){this._x=2,this._y=2,this._nexty=2;var t=this._innerSpriteFrames;for(var e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r._resetDynamicAtlasFrame();}this._innerSpriteFrames.length=0,this._innerTextureInfos={};},destroy:function(){this.reset(),this._texture.destroy();}}),e.exports=Atlas;},{"../../../assets/CCRenderTexture":43}],223:[function(t,l,h){"use strict";var e=t("./atlas");var r=[];var n=-1;var a=5;var i=2048;var o=512;var s=!0;function newAtlas(){var t=r[++n];return t||(t=new e(i,i),r.push(t)),t;}function beforeSceneLoad(){u.reset();}var c=!1;var u={Atlas:e,get enabled(){return c;},set enabled(t){c!==t&&(t?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,beforeSceneLoad)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,beforeSceneLoad),c=t);},get maxAtlasCount(){return a;},set maxAtlasCount(t){a=t;},get textureBleeding(){return s;},set textureBleeding(t){s=t;},get textureSize(){return i;},set textureSize(t){i=t;},get maxFrameSize(){return o;},set maxFrameSize(t){o=t;},insertSpriteFrame:function(t){if(!c||n===a||!t||t._original)return null;if(!t._texture.packable)return null;var e=r[n];var i=(e=e||newAtlas()).insertSpriteFrame(t);return i||n===a?i:(e=newAtlas()).insertSpriteFrame(t);},reset:function(){for(var t=0,e=r.length;t<e;t++)r[t].destroy();r.length=0,n=-1;},deleteAtlasSpriteFrame:function(t){t._original&&(t=t._original._texture,this.deleteAtlasTexture(t));},deleteAtlasTexture:function(t){if(t)for(var e=r.length-1;0<=e;e--)r[e].deleteInnerTexture(t),r[e].isEmpty()&&(r[e].destroy(),r.splice(e,1),n--);},showDebug:!1,update:function(){if(this.enabled)for(var t=0;t<=n;t++)r[t].update();}};l.exports=cc.dynamicAtlasManager=u;},{"./atlas":222}],224:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../assembler-2d"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var P=t("../../../utils/text-utils");var o=t("../../../platform/CCMacro");var x=t("../../../components/CCLabel").Overflow;var A=t("../utils").shareLabelInfo;function D1M(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash="";}var d=cc.rect();var f=null;var M=[];var p=[];var S=[];var v=[];var R=null;var I=0;var B=0;var y=0;var D=0;var L=0;var T=1;var m=null;var w=cc.size();var V="";var s=0;var c=0;var l=0;var h=0;var O=0;var F=0;var E=0;var N=!1;var k=0;var G=0;var z=0;t=function(t){var e;e=t,(i=BmfontAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(BmfontAssembler);function BmfontAssembler(){return t.apply(this,arguments)||this;}var i=BmfontAssembler.prototype;return i.updateRenderData=function(t){t._vertsDirty&&f!==t&&(f=t,this._reserveQuads(t,t.string.toString().length),this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),this.updateWorldVerts(t),f._actualFontSize=s,f.node.setContentSize(w),f._vertsDirty=!1,f=null,this._resetProperties());},i._updateFontScale=function(){T=s/c;},i._updateFontFamily=function(t){var e=t.font;m=e.spriteFrame,R=e._fntConfig,A.fontAtlas=e._fontDefDictionary,this.packToDynamicAtlas(t,m);},i._updateLabelInfo=function(){A.hash="",A.margin=0;},i._updateProperties=function(t){V=t.string.toString(),s=t.fontSize,c=(R||t).fontSize,l=t.horizontalAlign,h=t.verticalAlign,O=t.spacingX,E=t.overflow,F=t._lineHeight,w.width=t.node.width,w.height=t.node.height,E===x.NONE?(N=!1,w.width+=2*A.margin,w.height+=2*A.margin):E===x.RESIZE_HEIGHT?(N=!0,w.height+=2*A.margin):N=t.enableWrapText,A.lineHeight=F,A.fontSize=s,this._setupBMFontOverflowMetrics();},i._resetProperties=function(){m=R=null,A.hash="",A.margin=0;},i._updateContent=function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText();},i._computeHorizontalKerningForText=function(){var t=V;var e=t.length;var i=R.kerningDict;var r=M;var n=-1;for(var a=0;a<e;++a){var o=t.charCodeAt(a);var s=i[n<<16|65535&o]||0;r[a]=a<e-1?s:0,n=o;}},i._multilineTextWrap=function(h){var u=V.length;var t=0;var e=0;var _=0;var d=0;var i=0;var r=0;var n=0;var a;var o=cc.v2(0,0);for(var s=0;s<u;){var c=V.charAt(s);if("\n"!==c){var f=h(V,s,u);var p=r;var m=n;var v=i;var y=e;var g=!1;for(var b=0;b<f;++b){var l=s+b;if("\r"!==(c=V.charAt(l))){if(a=A.fontAtlas.getLetterDefinitionForChar(c,A)){var C=y+a.offsetX*T-A.margin;if(N&&0<z&&0<e&&C+a.w*T>z&&!P.isUnicodeSpace(c)){S.push(i),t++,e=i=0,_-=F*this._getFontScale()+0,g=!0;break;}o.x=C,o.y=_-a.offsetY*T+A.margin,this._recordLetterInfo(o,c,l,t),l+1<M.length&&l<u-1&&(y+=M[l+1]),y+=a.xAdvance*T+O-2*A.margin,v=o.x+a.w*T-A.margin,p<o.y&&(p=o.y),m>o.y-a.h*T&&(m=o.y-a.h*T);}else this._recordPlaceholderInfo(l,c),console.log("Can't find letter definition in texture atlas "+R.atlasName+" for letter:"+c);}else this._recordPlaceholderInfo(l,c);}g||(e=y,r<p&&(r=p),m<n&&(n=m),d<(i=v)&&(d=i),s+=f);}else S.push(i),t++,e=i=0,_-=F*this._getFontScale()+0,this._recordPlaceholderInfo(s,c),s++;}return S.push(i),B=(I=t+1)*F*this._getFontScale(),1<I&&(B+=0*(I-1)),w.width=k,w.height=G,k<=0&&(w.width=parseFloat(d.toFixed(2))+2*A.margin),G<=0&&(w.height=parseFloat(B.toFixed(2))+2*A.margin),D=w.height,L=0,E!==x.CLAMP&&(0<r&&(D=w.height+r),n<-B&&(L=B+n)),!0;},i._getFirstCharLen=function(){return 1;},i._getFontScale=function(){return E===x.SHRINK?T:1;},i._getFirstWordLen=function(t,e,i){var r=t.charAt(e);if(P.isUnicodeCJK(r)||"\n"===r||P.isUnicodeSpace(r))return 1;var n=1;var a=A.fontAtlas.getLetterDefinitionForChar(r,A);if(!a)return n;var o=a.xAdvance*T+O;for(var s=e+1;s<i&&(r=t.charAt(s),a=A.fontAtlas.getLetterDefinitionForChar(r,A));++s){if(o+a.offsetX*T+a.w*T>z&&!P.isUnicodeSpace(r)&&0<z)return n;if(o+=a.xAdvance*T+O,"\n"===r||P.isUnicodeSpace(r)||P.isUnicodeCJK(r))break;n++;}return n;},i._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen);},i._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen);},i._recordPlaceholderInfo=function(t,e){var i;t>=p.length&&(i=new D1M(),p.push(i)),p[t].char=e,p[t].hash=e.charCodeAt(0)+A.hash,p[t].valid=!1;},i._recordLetterInfo=function(t,e,i,r){i>=p.length&&(n=new D1M(),p.push(n));var n=e.charCodeAt(0)+A.hash;p[i].line=r,p[i].char=e,p[i].hash=n,p[i].valid=A.fontAtlas.getLetter(n).valid,p[i].x=t.x,p[i].y=t.y;},i._alignText=function(){B=0,S.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),E===x.SHRINK&&0<s&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||E===x.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp);},i._scaleFontSizeDown=function(t){var e=!0;t||(e=!(t=.1)),s=t,e&&this._updateContent();},i._shrinkLabelToContentSize=function(t){var e,i=0,r=0|s;for(;i<r;){var n=e=i+r+1>>1;if(n<=0)break;T=n/c,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?r=e-1:i=e;}var a=i;0<=a&&this._scaleFontSizeDown(a);},i._isVerticalClamp=function(){return B>w.height;},i._isHorizontalClamp=function(){var t=!1;for(var e=0,i=V.length;e<i;++e){var r=p[e];if(r.valid){var n=A.fontAtlas.getLetter(r.hash);n=r.x+n.w*T;r=r.line;if(0<k)if(N){if(S[r]>w.width&&(n>w.width||n<0)){t=!0;break;}}else if(n>w.width){t=!0;break;}}}return t;},i._isHorizontalClamped=function(t,e){e=S[e];t=t>w.width||t<0;return(!N||e>w.width)&&t;},i._updateQuads=function(){var t=m?m._texture:A.fontAtlas.getTexture();var e=f.node;this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0);var i=w,h=e._anchorPoint.x*i.width,u=e._anchorPoint.y*i.height;var r=!0;for(var n=0,_=V.length;n<_;++n){var a=p[n];if(a.valid){var o=A.fontAtlas.getLetter(a.hash);d.height=o.h,d.width=o.w,d.x=o.u,d.y=o.v;var s=a.y+y;0<G&&(D<s&&(c=s-D,d.y+=c,d.height-=c,s-=c),s-o.h*T<L&&E===x.CLAMP&&(d.height=s<L?0:(s-L)/T));var c=a.line;var l=a.x+o.w/2*T+v[c];if(0<k&&this._isHorizontalClamped(l,c))if(E===x.CLAMP)d.width=0;else if(E===x.SHRINK){if(w.width>o.w){r=!1;break;}d.width=0;}0<d.height&&0<d.width&&(l=this._determineRect(d),o=a.x+v[a.line],this.appendQuad(f,t,d,l,o-h,s-u,T));}}return this._quadsUpdated(f),r;},i._determineRect=function(t){var e=m.isRotated();var i=m._originalSize;var r=m._rect;var n=m._offset;var a=n.x+(i.width-r.width)/2;n=n.y-(i.height-r.height)/2;return e?(i=t.x,t.x=r.x+r.height-t.y-t.height-n,t.y=i+r.y-a,t.y<0&&(t.height=t.height+n)):(t.x+=r.x-a,t.y+=r.y+n),e;},i._computeAlignmentOffset=function(){switch(v.length=0,l){case o.TextAlignment.LEFT:for(var t=0;t<I;++t)v.push(0);break;case o.TextAlignment.CENTER:for(var e=0,i=S.length;e<i;e++)v.push((w.width-S[e])/2);break;case o.TextAlignment.RIGHT:for(var r=0,n=S.length;r<n;r++)v.push(w.width-S[r]);}var a;y=w.height,h!==o.VerticalTextAlignment.TOP&&(a=w.height-B+F*this._getFontScale()-c*T,h===o.VerticalTextAlignment.BOTTOM?y-=a:y-=a/2);},i._setupBMFontOverflowMetrics=function(){var t=w.width,e=w.height;E===x.RESIZE_HEIGHT&&(e=0),E===x.NONE&&(e=t=0),G=e,z=k=t;},i.updateWorldVerts=function(){},i.appendQuad=function(t,e,i,r,n,a,o){},i._quadsUpdated=function(t){},i._reserveQuads=function(){},BmfontAssembler;}(r.default);i.default=t,e.exports=i.default;},{"../../../components/CCLabel":80,"../../../platform/CCMacro":194,"../../../utils/text-utils":271,"../../assembler-2d":215,"../utils":228}],225:[function(t,e,i){"use strict";function LabelFrame(){this._rect=null,this.uv=[],this._texture=null,this._original=null;}LabelFrame.prototype={constructor:LabelFrame,getRect:function(){return cc.rect(this._rect);},setRect:function(t){this._rect=t,this._texture&&this._calculateUV();},_setDynamicAtlasFrame:function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV());},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV());},_refreshTexture:function(t){this._texture=t,this._rect=cc.rect(0,0,t.width,t.height),this._calculateUV();},_calculateUV:function(){var t=this._rect,e=this._texture,i=this.uv,r=e.width,e=e.height;var n=0===r?0:t.x/r;r=0===r?0:(t.x+t.width)/r;var a=0===e?0:(t.y+t.height)/e;t=0===e?0:t.y/e;i[0]=n,i[1]=a,i[2]=r,i[3]=a,i[4]=n,i[5]=t,i[6]=r,i[7]=t;}},e.exports=LabelFrame;},{}],226:[function(t,c,e){"use strict";e.__esModule=!0,e.default=void 0;i=(i=t("../../webgl/assemblers/label/2d/bmfont"))&&i.__esModule?i:{default:i};var i;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var r=t("../../../components/CCLabel");var l=t("../../../components/CCLabelOutline");var s=t("../../../utils/text-utils");var n=t("../../../components/CCComponent");var h=t("../../../assets/CCRenderTexture");var u=cc.js.isChildClassOf(l,n);var _=t("../utils").getFontFamily;var a=t("../utils").shareLabelInfo;var d=cc.BitmapFont.FontLetterDefinition;var f=cc.BitmapFont.FontAtlas;var p=cc.Color.WHITE;var m=(1/255).toFixed(3);function LetterTexture(t,e){this._texture=null,this._labelInfo=e,this._char=t,this._hash=null,this._data=null,this._canvas=null,this._context=null,this._width=0,this._height=0,this._offsetY=0,this._hash=t.charCodeAt(0)+e.hash;}function LetterAtlas(t,e){var i=new h();i.initWithSize(t,e),i.update(),this._fontDefDictionary=new f(i),this._x=0,this._y=0,this._nexty=0,this._width=t,this._height=e,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this);}LetterTexture.prototype={constructor:LetterTexture,updateRenderData:function(){this._updateProperties(),this._updateTexture();},_updateProperties:function(){this._texture=new cc.Texture2D(),this._data=r._canvasPool.get(),this._canvas=this._data.canvas,this._context=this._data.context,this._context.font=this._labelInfo.fontDesc;var t=s.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc);var e=2*this._labelInfo.margin+2;this._width=parseFloat(t.toFixed(2))+e,this._height=(1+s.BASELINE_RATIO)*this._labelInfo.fontSize+e,this._offsetY=-this._labelInfo.fontSize*s.BASELINE_RATIO/2,this._canvas.width!==this._width&&(this._canvas.width=this._width),this._canvas.height!==this._height&&(this._canvas.height=this._height),this._texture.initWithElement(this._canvas);},_updateTexture:function(){var t=this._context;var e=this._labelInfo,i=this._canvas.width,r=this._canvas.height;var n=i/2;var a=r/2+this._labelInfo.fontSize*s.MIDDLE_RATIO;var o=e.color;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,r),t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", "+m+")",t.fillRect(0,0,i,r),t.font=e.fontDesc,t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",e.isOutlined&&0<e.margin&&(i=e.out||p,t.strokeStyle="rgba("+i.r+", "+i.g+", "+i.b+", "+i.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this._char,n,a)),t.fillText(this._char,n,a),this._texture.handleLoadedTexture();},destroy:function(){this._texture.destroy(),this._texture=null,r._canvasPool.put(this._data);}},cc.js.mixin(LetterAtlas.prototype,{insertLetterTexture:function(t){var e=t._texture;var i=e.width,r=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nexty),this._y+r>this._nexty&&(this._nexty=this._y+r+0),this._nexty>this._height)return null;this._fontDefDictionary._texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;r=new d();return r.u=this._x+1,r.v=this._y+1,r.texture=this._fontDefDictionary._texture,r.valid=!0,r.w=t._width-2,r.h=t._height-2,r.xAdvance=r.w,r.offsetY=t._offsetY,this._x+=i+0,this._fontDefDictionary.addLetterDefinitions(t._hash,r),r;},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1);},reset:function(){this._x=0,this._y=0,this._nexty=0;var t=this._fontDefDictionary._letterDefinitions;for(var e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r.destroy();}this._fontDefDictionary.clear();},destroy:function(){this.reset(),this._fontDefDictionary._texture.destroy(),this._fontDefDictionary._texture=null;},beforeSceneLoad:function(){this.clearAllCache();},clearAllCache:function(){this.destroy();var t=new h();t.initWithSize(this._width,this._height),t.update(),this._fontDefDictionary._texture=t;},getLetter:function(t){return this._fontDefDictionary._letterDefinitions[t];},getTexture:function(){return this._fontDefDictionary.getTexture();},getLetterDefinitionForChar:function(t,e){var i=t.charCodeAt(0)+e.hash;i=this._fontDefDictionary._letterDefinitions[i];return i||((t=new LetterTexture(t,e)).updateRenderData(),i=this.insertLetterTexture(t),t.destroy()),i;}});var o=null;n=function(t){var e;e=t,(i=LetterFontAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(LetterFontAssembler);function LetterFontAssembler(){return t.apply(this,arguments)||this;}var i=LetterFontAssembler.prototype;return i._getAssemblerData=function(){return o||(o=new LetterAtlas(2048,2048),cc.Label._shareAtlas=o),o.getTexture();},i._updateFontFamily=function(t){a.fontAtlas=o,a.fontFamily=_(t);var e=u&&t.getComponent(l);e&&e.enabled?(a.isOutlined=!0,a.margin=e.width,a.out=e.color.clone(),a.out.a=e.color.a*t.node.color.a/255):(a.isOutlined=!1,a.margin=0);},i._updateLabelInfo=function(t){var e,i;a.fontDesc=this._getFontDesc(),a.color=t.node.color,a.hash=(e=(t=a).color.toHEX("#rrggbb"),i="",t.isOutlined&&0<t.margin&&(i=i+t.margin+t.out.toHEX("#rrggbb")),""+t.fontSize+t.fontFamily+e+i);},i._getFontDesc=function(){var t=a.fontSize.toString()+"px ";return t+=a.fontFamily;},i._computeHorizontalKerningForText=function(){},i._determineRect=function(t){return!1;},LetterFontAssembler;}(i.default);e.default=n,c.exports=e.default;},{"../../../assets/CCRenderTexture":43,"../../../components/CCComponent":78,"../../../components/CCLabel":80,"../../../components/CCLabelOutline":81,"../../../utils/text-utils":271,"../../webgl/assemblers/label/2d/bmfont":233,"../utils":228}],227:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../assembler-2d"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var p=t("../../../utils/text-utils");var d=t("../../../platform/CCMacro");var n=t("../../../components/CCLabel");var a=t("../../../components/CCLabelOutline");var o=t("../../../components/CCLabelShadow");var C=n.Overflow;var s=t("../utils").deleteFromDynamicAtlas;var c=t("../utils").getFontFamily;var f=(1/255).toFixed(3);var m=null;var l=null;var x=null;var v="";var A="";var y=0;var S=0;var h=[];var g=cc.Size.ZERO;var T=0;var w=0;var E=0;var P=null;var M="";var R=C.NONE;var I=!1;var u=null;var B=cc.Color.WHITE;var _=null;var D=cc.Color.BLACK;var b=cc.rect();var L=cc.Size.ZERO;var V=cc.Size.ZERO;var O=!1;var F=!1;var N=!1;var k=0;var G=cc.Vec2.ZERO;var z;var U;t=function(e){var t;t=e,(i=TTFAssembler).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;_createSuper(TTFAssembler);function TTFAssembler(){return e.apply(this,arguments)||this;}var i=TTFAssembler.prototype;return i._getAssemblerData=function(){return(U=n._canvasPool.get()).canvas.width=U.canvas.height=1,U;},i._resetAssemblerData=function(t){t&&n._canvasPool.put(t);},i.updateRenderData=function(t){e.prototype.updateRenderData.call(this,t),t._vertsDirty&&(this._updateFontFamily(t),this._updateProperties(t),this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture(t),this._calDynamicAtlas(t),t._actualFontSize=y,t.node.setContentSize(V),this.updateVerts(t),t._vertsDirty=!1,x=l=m=null);},i.updateVerts=function(){},i._updatePaddingRect=function(){var t=0,e=0,i=0,r=0;var n=0;L.width=L.height=0,u&&(t=e=i=r=n=u.width,L.width=L.height=2*n),_&&(n=_.blur+n,i=Math.max(i,-_._offset.x+n),r=Math.max(r,_._offset.x+n),t=Math.max(t,_._offset.y+n),e=Math.max(e,-_._offset.y+n)),F&&(r+=n=S*Math.tan(.20943951),L.width+=n),b.x=i,b.y=t,b.width=i+r,b.height=t+e;},i._updateFontFamily=function(t){M=c(t);},i._updateProperties=function(t){var e=t._assemblerData;m=e.context,l=e.canvas,x=(t._frame._original||t._frame)._texture,A=t.string.toString(),y=t._fontSize,S=y,k=t.underlineHeight||S/8,R=t.overflow,g.width=t.node.width,g.height=t.node.height,V=t.node.getContentSize(),T=t._lineHeight,w=t.horizontalAlign,E=t.verticalAlign,P=t.node.color,O=t.enableBold,F=t.enableItalic,N=t.enableUnderline,I=R!==C.NONE&&(R===C.RESIZE_HEIGHT||t.enableWrapText),(u=(u=a&&t.getComponent(a))&&u.enabled&&0<u.width?u:null)&&B.set(u.color),(_=(_=o&&t.getComponent(o))&&_.enabled?_:null)&&(D.set(_.color),D.a=D.a*t.node.color.a/255),this._updatePaddingRect();},i._calculateFillTextStartPosition=function(){var t=0;w===d.TextAlignment.RIGHT?t=g.width-b.width:w===d.TextAlignment.CENTER&&(t=(g.width-b.width)/2);var e=this._getLineHeight()*(h.length-1);var i=y*(1-p.BASELINE_RATIO/2);return E!==d.VerticalTextAlignment.TOP&&(e=e+b.height+y-g.height,E===d.VerticalTextAlignment.BOTTOM?i-=e+=p.BASELINE_RATIO/2*y:i-=e/2),i+=p.BASELINE_OFFSET*y,cc.v2(t+b.x,i+b.y);},i._setupOutline=function(){m.strokeStyle="rgba("+B.r+", "+B.g+", "+B.b+", "+B.a/255+")",m.lineWidth=2*u.width;},i._setupShadow=function(){m.shadowColor="rgba("+D.r+", "+D.g+", "+D.b+", "+D.a/255+")",m.shadowBlur=_.blur,m.shadowOffsetX=_.offset.x,m.shadowOffsetY=-_.offset.y;},i._drawUnderline=function(t){u&&(this._setupOutline(),m.strokeRect(G.x,G.y,t,k)),m.lineWidth=k,m.fillStyle="rgba("+P.r+", "+P.g+", "+P.b+", "+P.a/255+")",m.fillRect(G.x,G.y,t,k);},i._updateTexture=function(){m.clearRect(0,0,l.width,l.height);var t=u?B:P;m.fillStyle="rgba("+t.r+", "+t.g+", "+t.b+", "+f+")",m.fillRect(0,0,l.width,l.height),m.font=v;var e=this._calculateFillTextStartPosition();var i=this._getLineHeight();m.lineJoin="round",m.fillStyle="rgba("+P.r+", "+P.g+", "+P.b+", 1)";var r=1<h.length;var n=this._measureText(m,v);var a=0,o=0;_&&this._setupShadow(),u&&0<u.width&&this._setupOutline();for(var s=0;s<h.length;++s)a=e.x,o=e.y+s*i,_&&r&&(u&&0<u.width&&m.strokeText(h[s],a,o),m.fillText(h[s],a,o)),N&&(z=n(h[s]),w===d.TextAlignment.RIGHT?G.x=e.x-z:w===d.TextAlignment.CENTER?G.x=e.x-z/2:G.x=e.x,G.y=o+S/8,this._drawUnderline(z));_&&r&&(m.shadowColor="transparent");for(var c=0;c<h.length;++c)a=e.x,o=e.y+c*i,u&&0<u.width&&m.strokeText(h[c],a,o),m.fillText(h[c],a,o);_&&(m.shadowColor="transparent"),x.handleLoadedTexture();},i._calDynamicAtlas=function(t){var e;t.cacheMode===n.CacheMode.BITMAP&&(e=t._frame,s(t,e),e._original||e.setRect(cc.rect(0,0,l.width,l.height)),this.packToDynamicAtlas(t,e));},i._updateLabelDimensions=function(){var t=A.split("\n");if(R===C.RESIZE_HEIGHT){var e=(h.length+p.BASELINE_RATIO)*this._getLineHeight();g.height=e+b.height,V.height=e+L.height;}else if(R===C.NONE){h=t;var i=0;e=0;for(var r=0;r<t.length;++r){var n=p.safeMeasureText(m,t[r],v);i=n<i?i:n;}e=(h.length+p.BASELINE_RATIO)*this._getLineHeight();var a=parseFloat(i.toFixed(2));e=parseFloat(e.toFixed(2));g.width=a+b.width,g.height=e+b.height,V.width=a+L.width,V.height=e+L.height;}g.width=Math.min(g.width,2048),g.height=Math.min(g.height,2048),l.width!==g.width&&(l.width=g.width),l.height!==g.height&&(l.height=g.height);},i._calculateTextBaseline=function(){var t;t=w===d.TextAlignment.RIGHT?"right":w===d.TextAlignment.CENTER?"center":"left",m.textAlign=t,m.textBaseline="alphabetic";},i._calculateSplitedStrings=function(){var t=A.split("\n");if(I){h=[];var e=V.width;for(var i=0;i<t.length;++i){var r=p.safeMeasureText(m,t[i],v);r=p.fragmentText(t[i],r,e,this._measureText(m,v));h=h.concat(r);}}else h=t;},i._getFontDesc=function(){var t=y.toString()+"px ";return t+=M,O&&(t="bold "+t),t=F?"italic "+t:t;},i._getLineHeight=function(){return 0|(0===T?y:T*y/S);},i._calculateParagraphLength=function(t,e){var i=[];for(var r=0;r<t.length;++r){var n=p.safeMeasureText(e,t[r],v);i.push(n);}return i;},i._measureText=function(e,i){return function(t){return p.safeMeasureText(e,t,i);};},i._calculateLabelFont=function(){if(v=this._getFontDesc(),m.font=v,R===C.SHRINK){var t=A.split("\n");var h=this._calculateParagraphLength(t,m);var e=0;var i=0;var r=0;if(I){var n=V.width;var a=V.height;if(n<0||a<0)return v=this._getFontDesc(),void(m.font=v);i=a+1,r=n+1;var o;var s,c=0,l=0|y+1;for(;c<l;){if((s=c+l+1>>1)<=0){cc.logID(4003);break;}for(y=s,v=this._getFontDesc(),m.font=v,e=i=0;e<t.length;++e){var u=0;var _=p.safeMeasureText(m,t[e],v);for(o=p.fragmentText(t[e],_,n,this._measureText(m,v));u<o.length;)r=p.safeMeasureText(m,o[u],v),i+=this._getLineHeight(),++u;}a<i?l=s-1:c=s;}0===c?cc.logID(4003):(y=c,v=this._getFontDesc(),m.font=v);}else{for(i=t.length*this._getLineHeight(),e=0;e<t.length;++e)r<h[e]&&(r=h[e]);var d=(g.width-b.width)/r;var f=g.height/i;y=S*Math.min(1,d,f)|0,v=this._getFontDesc(),m.font=v;}}},TTFAssembler;}(r.default);i.default=t,e.exports=i.default;},{"../../../components/CCLabel":80,"../../../components/CCLabelOutline":81,"../../../components/CCLabelShadow":82,"../../../platform/CCMacro":194,"../../../utils/text-utils":271,"../../assembler-2d":215,"../utils":228}],228:[function(t,e,i){"use strict";var r=t("./dynamic-atlas/manager");t=cc.Color.WHITE;e.exports={deleteFromDynamicAtlas:function(t,e){e&&e._original&&r&&(r.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame());},getFontFamily:function(i){return i.useSystemFont?i.fontFamily||"Arial":i.font?i.font._nativeAsset||(cc.loader.load(i.font.nativeUrl,function(t,e){i.font._nativeAsset=e,i.setVertsDirty();}),"Arial"):"Arial";},shareLabelInfo:{fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:t,isOutlined:!1,out:t,margin:0}};},{"./dynamic-atlas/manager":223}],229:[function(t,e,i){"use strict";function earcut(t,e,i){i=i||2;var h=e&&e.length,u=h?e[0]*i:t.length,r=linkedList(t,0,u,i,!0),_=[];if(!r)return _;var n,a,o,s,c,l,d;if(h&&(r=function(t,e,i,r){var n,a,o,s,c=[];for(n=0,a=e.length;n<a;n++)s=e[n]*r,o=n<a-1?e[n+1]*r:t.length,(s=linkedList(t,s,o,r,!1))===s.next&&(s.steiner=!0),c.push(function(t){var e=t,i=t;for(;e.x<i.x&&(i=e),e=e.next,e!==t;);return i;}(s));for(c.sort(compareX),n=0;n<c.length;n++)!function(t,e){(e=function(t,h){var e,i=h,r=t.x,n=t.y,a=-1/0;do{if(n<=i.y&&n>=i.next.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&a<o){if((a=o)===r){if(n===i.y)return i;if(n===i.next.y)return i.next;}e=i.x<i.next.x?i:i.next;}}}while((i=i.next,i!==h));if(!e)return null;if(r===a)return e.prev;var s,u=e,_=e.x,c=e.y,l=1/0;i=e.next;for(;i!==u;)r>=i.x&&i.x>=_&&pointInTriangle(n<c?r:a,n,_,c,n<c?a:r,n,i.x,i.y)&&((s=Math.abs(n-i.y)/(r-i.x))<l||s===l&&i.x>e.x)&&locallyInside(i,t)&&(e=i,l=s),i=i.next;return e;}(t,e))&&filterPoints(e=splitPolygon(e,t),e.next);}(c[n],i),i=filterPoints(i,i.next);return i;}(t,e,r,i)),t.length>80*i){n=o=t[0],a=s=t[1];for(var f=i;f<u;f+=i)(c=t[f])<n&&(n=c),(l=t[f+1])<a&&(a=l),o<c&&(o=c),s<l&&(s=l);d=Math.max(o-n,s-a);}return earcutLinked(r,_,i,n,a,d),_;}function linkedList(t,e,i,r,n){var a,o;if(n===0<signedArea(t,e,i,r))for(a=e;a<i;a+=r)o=insertNode(a,t[a],t[a+1],o);else for(a=i-r;e<=a;a-=r)o=insertNode(a,t[a],t[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o;}function filterPoints(t,e){if(!t)return t;e=e||t;var i,r=t;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=e=r.prev)===r.next)return null;i=!0;}}while(i||r!==e);return e;}function earcutLinked(t,e,i,r,n,a,o){if(t){if(!o&&a){var s=t;var h=r;var u=n;var _=a;var c=s;for(;null===c.z&&(c.z=zOrder(c.x,c.y,h,u,_)),c.prevZ=c.prev,c.nextZ=c.next,c=c.next,c!==s;);c.prevZ.nextZ=null,c.prevZ=null,function(t){var e,i,r,n,a,o,s,c,l=1;do{for(i=t,a=t=null,o=0;i;){for(o++,r=i,e=s=0;e<l&&(s++,r=r.nextZ);e++);for(c=l;0<s||0<c&&r;)0!==s&&(0===c||!r||i.z<=r.z)?(i=(n=i).nextZ,s--):(r=(n=r).nextZ,c--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;i=r;}}while((a.nextZ=null,l*=2,1<o));}(c);}var d,l,f=t;for(;t.prev!==t.next;)if(d=t.prev,l=t.next,a?function(t,e,i,r){var n=t.prev,a=t,o=t.next;if(0<=area(n,a,o))return!1;var s=(n.x<a.x?n.x<o.x?n:o:a.x<o.x?a:o).x,c=(n.y<a.y?n.y<o.y?n:o:a.y<o.y?a:o).y,h=(n.x>a.x?n.x>o.x?n:o:a.x>o.x?a:o).x,u=(n.y>a.y?n.y>o.y?n:o:a.y>o.y?a:o).y;var _=zOrder(s,c,e,i,r),d=zOrder(h,u,e,i,r);var l=t.nextZ;for(;l&&l.z<=d;){if(l!==t.prev&&l!==t.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,l.x,l.y)&&0<=area(l.prev,l,l.next))return!1;l=l.nextZ;}l=t.prevZ;for(;l&&l.z>=_;){if(l!==t.prev&&l!==t.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,l.x,l.y)&&0<=area(l.prev,l,l.next))return!1;l=l.prevZ;}return!0;}(t,r,n,a):function(t){var e=t.prev,i=t,r=t.next;if(0<=area(e,i,r))return!1;var n=t.next.next;for(;n!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=area(n.prev,n,n.next))return!1;n=n.next;}return!0;}(t))e.push(d.i/i),e.push(t.i/i),e.push(l.i/i),removeNode(t),t=l.next,f=l.next;else if((t=l)===f){o?1===o?earcutLinked(t=function(t,e,i){var r=t;do{var n=r.prev,a=r.next.next;}while((!equals(n,a)&&intersects(n,r,r.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(a.i/i),removeNode(r),removeNode(r.next),r=t=a),r=r.next,r!==t));return r;}(t,e,i),e,i,r,n,a,2):2===o&&function(t,e,i,r,n,a){var o=t;do{var s=o.next.next;for(;s!==o.prev;){var c;if(o.i!==s.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;}while((i=i.next,i!==t));return!1;}(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;for(;i.y>a!=i.next.y>a&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next,i!==t;);return r;}(t,e);}(o,s))return c=splitPolygon(o,s),o=filterPoints(o,o.next),c=filterPoints(c,c.next),earcutLinked(o,e,i,r,n,a),earcutLinked(c,e,i,r,n,a);s=s.next;}}while((o=o.next,o!==t));}(t,e,i,r,n,a):earcutLinked(filterPoints(t),e,i,r,n,a,1);break;}}}function compareX(t,e){return t.x-e.x;}function zOrder(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1;}function pointInTriangle(t,e,i,r,n,a,o,s){return 0<=(n-o)*(e-s)-(t-o)*(a-s)&&0<=(t-o)*(r-s)-(i-o)*(e-s)&&0<=(i-o)*(a-s)-(n-o)*(r-s);}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y);}function equals(t,e){return t.x===e.x&&t.y===e.y;}function intersects(t,e,i,r){return equals(t,e)&&equals(i,r)||equals(t,r)&&equals(i,e)||0<area(t,e,i)!=0<area(t,e,r)&&0<area(i,r,t)!=0<area(i,r,e);}function locallyInside(t,e){return area(t.prev,t,t.next)<0?0<=area(t,e,t.next)&&0<=area(t,t.prev,e):area(t,e,t.prev)<0||area(t,t.next,e)<0;}function splitPolygon(t,e){var i=new Node(t.i,t.x,t.y),r=new Node(e.i,e.x,e.y),n=t.next,a=e.prev;return(t.next=e).prev=t,(i.next=n).prev=i,(r.next=i).prev=r,(a.next=r).prev=a,r;}function insertNode(t,e,i,r){t=new Node(t,e,i);return r?(t.next=r.next,(t.prev=r).next.prev=t,r.next=t):(t.prev=t).next=t,t;}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function signedArea(t,e,i,r){var n=0;for(var a=e,o=i-r;a<i;a+=r)n+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return n;}(cc.Graphics.earcut=e.exports=earcut).deviation=function(t,e,i,r){var n=e&&e.length;var h=n?e[0]*i:t.length;var a=Math.abs(signedArea(t,0,h,i));if(n)for(var o=0,s=e.length;o<s;o++){var u=e[o]*i;var _=o<s-1?e[o+1]*i:t.length;a-=Math.abs(signedArea(t,u,_,i));}var c=0;for(o=0;o<r.length;o+=3){var l=r[o]*i;var d=r[o+1]*i;var f=r[o+2]*i;c+=Math.abs((t[l]-t[f])*(t[1+d]-t[1+l])-(t[l]-t[d])*(t[1+f]-t[1+l]));}return 0===a&&0===c?0:Math.abs((c-a)/a);},earcut.flatten=function(t){var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0;for(var n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++)for(var o=0;o<e;o++)i.vertices.push(t[n][a][o]);0<n&&(r+=t[n-1].length,i.holes.push(r));}return i;};},{}],230:[function(t,e,i){"use strict";var s=t("../../../../graphicundefined");var c=t("../../../../graphics/types").PointFlags;var o=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(t,e){this.reset();},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0;}});function Path(){this.reset();}function Impl(t){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[];}cc.js.mixin(Path.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[];}}),cc.js.mixin(Impl.prototype,{moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,c.PT_CORNER),this._commandx=t,this._commandy=e;},lineTo:function(t,e){this._addPoint(t,e,c.PT_CORNER),this._commandx=t,this._commandy=e;},bezierCurveTo:function(t,e,i,r,n,a){var o=this._curPath;o=o.points[o.points.length-1];o.x!==t||o.y!==e||i!==n||r!==a?(s.tesselateBezier(this,o.x,o.y,t,e,i,r,n,a,0,c.PT_CORNER),this._commandx=n,this._commandy=a):this.lineTo(n,a);},quadraticCurveTo:function(t,e,i,r){var n=this._commandx;var a=this._commandy;this.bezierCurveTo(n+2/3*(t-n),a+2/3*(e-a),i+2/3*(t-i),r+2/3*(e-r),i,r);},arc:function(t,e,i,r,n,a){s.arc(this,t,e,i,r,n,a);},ellipse:function(t,e,i,r){s.ellipse(this,t,e,i,r),this._curPath.complex=!1;},circle:function(t,e,i){s.ellipse(this,t,e,i,i),this._curPath.complex=!1;},rect:function(t,e,i,r){this.moveTo(t,e),this.lineTo(t,e+r),this.lineTo(t+i,e+r),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1;},roundRect:function(t,e,i,r,n){s.roundRect(this,t,e,i,r,n),this._curPath.complex=!1;},clear:function(t){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t&&(this._paths.length=0,this._points.length=0);},close:function(){this._curPath.closed=!0;},_addPath:function(){var t=this._pathLength;t=this._paths[t];return t?t.reset():(t=new Path(),this._paths.push(t)),this._pathLength++,this._curPath=t;},_addPoint:function(t,e,i){var r=this._curPath;var n,a;r&&(a=this._points,r=r.points,(n=a[this._pointsOffset++])?(n.x=t,n.y=e):(n=new o(t,e),a.push(n)),n.flags=i,r.push(n));}}),cc.Graphics._Impl=Impl,e.exports=Impl;},{"../../../../graphicundefined":132,"../../../../graphics/types":134}],231:[function(t,r,e){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(t("../../../assembler"));var a=_interopRequireDefault(t("../../../../../renderer/core/input-assembler"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var o=t("../../mesh-buffer");var s=t("../../vertex-format").vfmtPosColor;var c=t("../../../index");var i=t("../../../../graphics/graphics");var L=t("../../../../graphics/types").PointFlags;var V=i.LineJoin;var O=i.LineCap;var R=t("./earcut");t("./impl");var F=Math.PI;var y=Math.min;var N=Math.max;var k=Math.ceil;var G=Math.acos;var E=Math.cos;var P=Math.sin;var M=Math.atan2;function clamp(t,e,i){return t<e?e:i<t?i:t;}i=function(e){var t;t=e,(i=GraphicsAssembler).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;_createSuper(GraphicsAssembler);function GraphicsAssembler(t){return(t=e.call(this,t)||this)._buffer=null,t._buffers=[],t._bufferOffset=0,t;}var i=GraphicsAssembler.prototype;return i.getVfmt=function(){return s;},i.requestBuffer=function(){var t={indiceStart:0,vertexStart:0};var e=new o(c._handle,s);t.meshbuffer=e;e=new a.default(e._vb,e._ib);return t.ia=e,this._buffers.push(t),t;},i.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers;},i.clear=function(t){this._bufferOffset=0;var e=this._buffers;if(t){for(var i=0,r=e.length;i<r;i++){var n=e[i];n.meshbuffer.destroy(),n.meshbuffer=null;}e.length=0;}else for(var a=0,o=e.length;a<o;a++){var s=e[a];s.indiceStart=0,s.vertexStart=0,s.meshbuffer.reset();}},i.fillBuffers=function(t,e){e._flush(),e.node=t.node,e.material=t._materials[0];var i=this.getBuffers();for(var r=0,n=i.length;r<n;r++){var a=i[r];var o=a.meshbuffer;a.ia._count=a.indiceStart,e._flushIA(a.ia),o.uploadData();}},i.genBuffer=function(t,e){var i=this.getBuffers();var r=i[this._bufferOffset];var n=r.meshbuffer;var a=r.vertexStart+e;return(65535<a||131070<3*a)&&(++this._bufferOffset,a=e,this._bufferOffset<i.length?r=i[this._bufferOffset]:(r=this.requestBuffer(t),i[this._bufferOffset]=r),n=r.meshbuffer),a>n.vertexOffset&&n.requestStatic(e,3*e),this._buffer=r;},i.stroke=function(t){this._curColor=t._strokeColor._val,this._flattenPaths(t._impl),this._expandStroke(t),t._impl._updatePathOffset=!0;},i.fill=function(t){this._curColor=t._fillColor._val,this._expandFill(t),t._impl._updatePathOffset=!0;},i._expandStroke=function(t){var e=.5*t.lineWidth,i=t.lineCap,h=t.lineJoin,u=t.miterLimit;var r=t._impl;d=e,f=F,x=r._tessTol,d=2*G(e/(e+x));var _=N(2,k(f/d));var d,f;this._calculateJoins(r,e,h,u);var p=r._paths;var m=0;for(var v=r._pathOffset,y=r._pathLength;v<y;v++){var g=p[v];var b=g.points.length;h===V.ROUND?m+=2*(b+g.nbevel*(_+2)+1):m+=2*(b+5*g.nbevel+1),g.closed||(i===O.ROUND?m+=2*(2*_+2):m+=12);}var C=this.genBuffer(t,m),x=C.meshbuffer,A=x._vData,S=x._iData;for(var T=r._pathOffset,w=r._pathLength;T<w;T++){var n=p[T];var E=n.points;var a=E.length;var P=C.vertexStart;var o=void 0,s=void 0;var c=void 0,M=void 0;M=(n=n.closed)?(o=E[a-1],s=E[0],c=0,a):(o=E[0],s=E[1],a-(c=1)),s=s||o,n||((a=s.sub(o)).normalizeSelf(),l=a.x,a=a.y,i===O.BUTT?this._buttCapStart(o,l,a,e,0):i===O.SQUARE?this._buttCapStart(o,l,a,e,e):i===O.ROUND&&this._roundCapStart(o,l,a,e,_));for(var R=c;R<M;++R)h===V.ROUND?this._roundJoin(o,s,e,e,_):0!=(s.flags&(L.PT_BEVEL|L.PT_INNERBEVEL))?this._bevelJoin(o,s,e,e):(this._vset(s.x+s.dmx*e,s.y+s.dmy*e),this._vset(s.x-s.dmx*e,s.y-s.dmy*e)),o=s,s=E[R+1];var l;n?(this._vset(A[l=3*P],A[1+l]),this._vset(A[3+l],A[4+l])):((a=s.sub(o)).normalizeSelf(),c=a.x,n=a.y,i===O.BUTT?this._buttCapEnd(s,c,n,e,0):i===O.SQUARE?this._buttCapEnd(s,c,n,e,e):i===O.ROUND&&this._roundCapEnd(s,c,n,e,_));var I=C.indiceStart;for(var B=P+2,D=C.vertexStart;B<D;B++)S[I++]=B-2,S[I++]=B-1,S[I++]=B;C.indiceStart=I;}},i._expandFill=function(t){var e=t._impl;var h=e._paths;var u=0;for(var i=e._pathOffset,_=e._pathLength;i<_;i++)u+=h[i].points.length;var r=this.genBuffer(t,u),t=r.meshbuffer,d=t._vData,n=t._iData;for(var f=e._pathOffset,p=e._pathLength;f<p;f++){var m=h[f];var v=m.points;var y=v.length;if(0!==y){var a=r.vertexStart;for(var o=0;o<y;++o)this._vset(v[o].x,v[o].y);var s=r.indiceStart;if(m.complex){var g=[];for(var b=a,C=r.vertexStart;b<C;b++){var x=3*b;g.push(d[x]),g.push(d[1+x]);}var c=R(g,null,2);if(!c||0===c.length)continue;for(var A=0,S=c.length;A<S;A++)n[s++]=c[A]+a;}else{var T=a;for(var l=a+2,w=r.vertexStart;l<w;l++)n[s++]=T,n[s++]=l-1,n[s++]=l;}r.indiceStart=s;}}},i._calculateJoins=function(t,h,u,_){var d=0;0<h&&(d=1/h);var f=t._paths;for(var e=t._pathOffset,p=t._pathLength;e<p;e++){var i=f[e];var r=i.points;var m=r.length;var n=r[m-1];var a=r[0];for(var o=i.nbevel=0;o<m;o++){var s=n.dy;var c=-n.dx;var l=a.dy;var v=-a.dx;a.dmx=.5*(s+l),a.dmy=.5*(c+v),1e-6<(s=a.dmx*a.dmx+a.dmy*a.dmy)&&(600<(l=1/s)&&(l=600),a.dmx*=l,a.dmy*=l),0<a.dx*n.dy-n.dx*a.dy&&(a.flags|=L.PT_LEFT),s*(c=N(11,y(n.len,a.len)*d))*c<1&&(a.flags|=L.PT_INNERBEVEL),a.flags&L.PT_CORNER&&(s*_*_<1||u===V.BEVEL||u===V.ROUND)&&(a.flags|=L.PT_BEVEL),0!=(a.flags&(L.PT_BEVEL|L.PT_INNERBEVEL))&&i.nbevel++,n=a,a=r[o+1];}}},i._flattenPaths=function(t){var e=t._paths;for(var i=t._pathOffset,r=t._pathLength;i<r;i++){var n=e[i];var a=n.points;var o=a[a.length-1];var s=a[0];2<a.length&&o.equals(s)&&(n.closed=!0,a.pop(),o=a[a.length-1]);for(var c=0,h=a.length;c<h;c++){var l=s.sub(o);o.len=l.mag(),(l.x||l.y)&&l.normalizeSelf(),o.dx=l.x,o.dy=l.y,o=s,s=a[c+1];}}},i._chooseBevel=function(t,e,i,r){var n=i.x;var a=i.y;var o,s,c,l;return 0!==t?(o=n+e.dy*r,s=a-e.dx*r,c=n+i.dy*r,l=a-i.dx*r):(o=c=n+i.dmx*r,s=l=a+i.dmy*r),[o,s,c,l];},i._buttCapStart=function(t,e,i,r,n){var a=t.x-e*n;t=t.y-i*n;n=i;i=-e;this._vset(a+n*r,t+i*r),this._vset(a-n*r,t-i*r);},i._buttCapEnd=function(t,e,i,r,n){var a=t.x+e*n;t=t.y+i*n;n=i;i=-e;this._vset(a+n*r,t+i*r),this._vset(a-n*r,t-i*r);},i._roundCapStart=function(t,e,i,r,h){var n=t.x;var a=t.y;var o=i;var s=-e;for(var c=0;c<h;c++){var l=c/(h-1)*F;var u=E(l)*r,l=P(l)*r;this._vset(n-o*u-e*l,a-s*u-i*l),this._vset(n,a);}this._vset(n+o*r,a+s*r),this._vset(n-o*r,a-s*r);},i._roundCapEnd=function(t,e,i,r,h){var n=t.x;var a=t.y;var o=i;var s=-e;this._vset(n+o*r,a+s*r),this._vset(n-o*r,a-s*r);for(var c=0;c<h;c++){var l=c/(h-1)*F;var u=E(l)*r,l=P(l)*r;this._vset(n,a),this._vset(n-o*u+e*l,a-s*u+i*l);}},i._roundJoin=function(t,e,h,i,r){var n=t.dy;var a=-t.dx;var u=e.dy;var _=-e.dx;var o=e.x;var s=e.y;if(0!=(e.flags&L.PT_LEFT)){var c=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,h);var l=c[0];var d=c[1];var f=c[2];c=c[3];var p=M(-a,-n);var m=M(-_,-u);p<m&&(m-=2*F),this._vset(l,d),this._vset(o-n*i,e.y-a*i);var v=clamp(k((p-m)/F)*r,2,r);for(var y=0;y<v;y++){var g=p+y/(v-1)*(m-p);var b=o+E(g)*i;g=s+P(g)*i;this._vset(o,s),this._vset(b,g);}this._vset(f,c),this._vset(o-u*i,s-_*i);}else{l=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,-i);d=l[0];f=l[1];c=l[2];t=l[3];var C=M(a,n);var x=M(_,u);x<C&&(x+=2*F),this._vset(o+n*i,s+a*i),this._vset(d,f);var A=clamp(k((x-C)/F)*r,2,r);for(var S=0;S<A;S++){var T=C+S/(A-1)*(x-C);var w=o+E(T)*h;T=s+P(T)*h;this._vset(w,T),this._vset(o,s);}this._vset(o+u*i,s+_*i),this._vset(c,t);}},i._bevelJoin=function(t,e,i,r){var n,a;var o=t.dy;var s=-t.dx;var h=e.dy;var u=-e.dx;var c,l;e.flags&L.PT_LEFT?(l=(c=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,i))[0],n=c[1],a=c[2],c=c[3],this._vset(l,n),this._vset(e.x-o*r,e.y-s*r),this._vset(a,c),this._vset(e.x-h*r,e.y-u*r)):(n=(l=this._chooseBevel(e.flags&L.PT_INNERBEVEL,t,e,-r))[0],a=l[1],c=l[2],t=l[3],this._vset(e.x+o*i,e.y+s*i),this._vset(n,a),this._vset(e.x+h*i,e.y+u*i),this._vset(c,t));},i._vset=function(t,e){var i=this._buffer;var r=i.meshbuffer;var n=3*i.vertexStart;var a=r._vData;var o=r._uintVData;a[n]=t,a[1+n]=e,o[2+n]=this._curColor,i.vertexStart++,r._dirty=!0;},GraphicsAssembler;}(n.default);e.default=i,n.default.register(cc.Graphics,i),r.exports=e.default;},{"../../../../../renderer/core/input-assembler":302,"../../../../graphics/graphics":131,"../../../../graphics/types":134,"../../../assembler":217,"../../../index":220,"../../mesh-buffer":247,"../../vertex-format":252,"./earcut":229,"./impl":230}],232:[function(t,e,i){"use strict";cc.assemblers={},t("./sprite"),t("./mask-assembler"),t("./graphics"),t("./label"),t("./motion-streak");},{"./graphics":231,"./label":236,"./mask-assembler":237,"./motion-streak":238,"./sprite":245}],233:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=(t=t("../../../../utils/label/bmfont"))&&t.__esModule?t:{default:t};function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var C=0;t=function(t){var e;e=t,(i=WebglBmfontAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(WebglBmfontAssembler);function WebglBmfontAssembler(){return t.apply(this,arguments)||this;}var i=WebglBmfontAssembler.prototype;return i.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt());},i._reserveQuads=function(t,e){var i=4*e;e*=6;var r=this._renderData._flexBuffer;r.reserve(i,e),r.used(i,e);var n=this._renderData.iDatas[0];for(var a=0,o=0,s=e;a<s;a+=6,o+=4)n[a]=o,n[a+1]=o+1,n[a+2]=o+2,n[a+3]=o+1,n[a+4]=o+3,n[a+5]=o+2;C=0;},i._quadsUpdated=function(t){C=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount);},i._getColor=function(t){return t.node._color._val;},i.appendQuad=function(h,t,e,u,_,d,f){var i=this._renderData;var r=i.vDatas[0],p=i.uintVDatas[0];this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3;var i=t.width,t=t.height,m=e.width,v=e.height,y=this._getColor(h);var n,a,o,s;var c=this.floatsPerVert;var l=C+this.uvOffset;u?(n=e.x/i,o=(e.x+v)/i,a=(e.y+m)/t,s=e.y/t,r[l]=n,r[l+1]=s,r[l+=c]=n,r[l+1]=a,r[l+=c]=o,r[l+1]=s,r[l+=c]=o,r[l+1]=a):(n=e.x/i,o=(e.x+m)/i,a=(e.y+v)/t,s=e.y/t,r[l]=n,r[l+1]=a,r[l+=c]=o,r[l+1]=a,r[l+=c]=n,r[l+1]=s,r[l+=c]=o,r[l+1]=s),this.appendVerts(h,C,n=_,o=_+m*f,a=d-v*f,s=d);var g=C+this.colorOffset;for(var b=0;b<4;b++)p[g]=y,g+=c;C+=4*this.floatsPerVert;},i.appendVerts=function(t,e,i,r,n,a){var o=this._local;var s=this.floatsPerVert;o[e]=i,o[e+1]=n,o[e+=s]=r,o[e+1]=n,o[e+=s]=i,o[e+1]=a,o[e+=s]=r,o[e+1]=a;},i.updateWorldVerts=function(t){var t=t.node._worldMatrix.m,e=t[0],i=t[1],r=t[4],n=t[5],h=t[12],u=t[13];var a=this._local;var o=this._renderData.vDatas[0];var _=this.floatsPerVert;for(var s=0;s<a.length;s+=_){var c=a[s];var l=a[s+1];o[s]=c*e+l*r+h,o[s+1]=c*i+l*n+u;}},WebglBmfontAssembler;}(t.default);i.default=t,e.exports=i.default;},{"../../../../utils/label/bmfont":224}],234:[function(t,e,i){"use strict";function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t("../../../../../platform/js");t("./bmfont");t=t("../../../../utils/label/letter-font");var r=cc.color(255,255,255,255);t=function(i){var t;t=i,(e=WebglLetterFontAssembler).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(WebglLetterFontAssembler);function WebglLetterFontAssembler(){return i.apply(this,arguments)||this;}var e=WebglLetterFontAssembler.prototype;return e.createData=function(t){return t.requestRenderData();},e._getColor=function(t){return r._fastSetA(t.node._color.a),r._val;},e.updateColor=function(t){var e=this._getColor(t);i.prototype.updateColor.call(this,t,e);},WebglLetterFontAssembler;}(t);i.default=t,e.exports=i.default;},{"../../../../../platform/js":209,"../../../../utils/label/letter-font":226,"./bmfont":233}],235:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../../../utils/label/ttf"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var l=t("../../../../../components/CCLabelShadow");var n=cc.color(255,255,255,255);t=function(i){var t;t=i,(e=WebglTTFAssembler).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(WebglTTFAssembler);function WebglTTFAssembler(){return i.apply(this,arguments)||this;}var e=WebglTTFAssembler.prototype;return e.updateUVs=function(t){var e=this._renderData.vDatas[0];var i=t._frame.uv;var r=this.uvOffset;var n=this.floatsPerVert;for(var a=0;a<4;a++){var o=2*a;var s=n*a+r;e[s]=i[o],e[s+1]=i[1+o];}},e.updateColor=function(t){n._fastSetA(t.node._color.a);var e=n._val;i.prototype.updateColor.call(this,t,e);},e.updateVerts=function(t){var e=t.node,i=t._ttfTexture.width,r=t._ttfTexture.height,n=e.anchorX*e.width,a=e.anchorY*e.height;var o=l&&t.getComponent(l);var s;o&&o._enabled&&(c=(i-e.width)/2,s=(r-e.height)/2,-(o=o.offset).x>c?n+=i-e.width:c>o.x&&(n+=c-o.x),-o.y>s?a+=r-e.height:s>o.y&&(a+=s-o.y));var c=this._local;c[0]=-n,c[1]=-a,c[2]=i-n,c[3]=r-a,this.updateUVs(t),this.updateWorldVerts(t);},WebglTTFAssembler;}(r.default);i.default=t,e.exports=i.default;},{"../../../../../components/CCLabelShadow":82,"../../../../utils/label/ttf":227}],236:[function(t,i,h){"use strict";var e=_interopRequireDefault(t("../../../assembler"));var r=_interopRequireDefault(t("../../../../components/CCLabel"));var n=_interopRequireDefault(t("./2d/ttf"));var a=_interopRequireDefault(t("./2d/bmfont"));var o=_interopRequireDefault(t("./2d/letter"));var s=_interopRequireDefault(t("./3d/ttf"));var c=_interopRequireDefault(t("./3d/bmfont"));var l=_interopRequireDefault(t("./3d/letter"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}r.default._canvasPool={pool:[],get:function(){var t=this.pool.pop();var e,i;return t||(i=(e=document.createElement("canvas")).getContext("2d"),t={canvas:e,context:i}),t;},put:function(t){32<=this.pool.length||this.pool.push(t);}},e.default.register(cc.Label,{getConstructor:function(t){var e=t.node.is3DNode;var i=(e?s:n).default;return t.font instanceof cc.BitmapFont?i=(e?c:a).default:t.cacheMode===r.default.CacheMode.CHAR&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):i=(e?l:o).default),i;},TTF:n.default,Bmfont:a.default,Letter:o.default,TTF3D:s.default,Bmfont3D:c.default,Letter3D:l.default});},{"../../../../components/CCLabel":80,"../../../assembler":217,"./2d/bmfont":233,"./2d/letter":234,"./2d/ttf":235,"./3d/bmfont":void 0,"./3d/letter":void 0,"./3d/ttf":void 0}],237:[function(t,r,e){"use strict";e.__esModule=!0,e.MaskAssembler=void 0;i=(i=t("../../assembler"))&&i.__esModule?i:{default:i};var i;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var l=t("../../../components/CCMask");var d=t("../../render-flow");var h=t("./sprite/2d/simple");var f=t("./graphics");var u=t("../../../../renderer/gfx");var p=t("../vertex-format").vfmtPos;var _=[];function getWriteMask(){return 1<<_.length-1;}function applyStencil(t,e,i,r,n,a){t=t.effect;var o=u.STENCIL_OP_KEEP,s=u.STENCIL_OP_KEEP;t.setStencil(u.STENCIL_ENABLE,e,r,n,i,o,s,a);}function enableMask(t){var e=u.DS_FUNC_EQUAL;var i=u.STENCIL_OP_KEEP;var r=function(){var t=0;for(var e=0;e<_.length;++e)t+=1<<e;return t;}();var n=getWriteMask();var a=_[_.length-1];applyStencil(a._enableMaterial,e,i,r,r,n),t._flushMaterial(a._enableMaterial);}t=function(t){var e;e=t,(i=MaskAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(MaskAssembler);function MaskAssembler(){return t.apply(this,arguments)||this;}var i=MaskAssembler.prototype;return i.updateRenderData=function(t){t._type===l.Type.IMAGE_STENCIL?t.spriteFrame?h.prototype.updateRenderData.call(this,t):t.setMaterial(0,null):(t._graphics.setMaterial(0,t._materials[0]),f.prototype.updateRenderData.call(t._graphics._assembler,t._graphics,t._graphics));},i.fillBuffers=function(t,e){var i,r,n,a,o,s;var c;t._type===l.Type.IMAGE_STENCIL&&!t.spriteFrame||(c=t,8<_.length+1&&cc.errorID(9e3,8),_.push(c),c=t,i=e,r=u.DS_FUNC_NEVER,n=getWriteMask(),a=c.inverted?u.STENCIL_OP_REPLACE:u.STENCIL_OP_ZERO,applyStencil(c._clearMaterial,r,a,n,n,n),r=i.getBuffer("mesh",p),n=(a=r.request(4,6)).indiceOffset,o=a.byteOffset>>2,a=a.vertexOffset,s=r._vData,r=r._iData,s[o++]=-1,s[o++]=-1,s[o++]=-1,s[o++]=1,s[o++]=1,s[o++]=1,s[o++]=1,s[+o]=-1,r[n++]=a,r[n++]=a+3,r[n++]=a+1,r[n++]=a+1,r[n++]=a+3,r[+n]=a+2,i.node=i._dummyNode,i.material=c._clearMaterial,i._flush(),s=t,o=e,r=u.DS_FUNC_NEVER,n=getWriteMask(),a=s.inverted?u.STENCIL_OP_ZERO:u.STENCIL_OP_REPLACE,applyStencil(s._materials[0],r,a,n,n,n),o.material=s._materials[0],s._type===l.Type.IMAGE_STENCIL?(o.node=o._dummyNode,h.prototype.fillBuffers.call(s._assembler,s,o),o._flush()):(o.node=s.node,f.prototype.fillBuffers.call(s._graphics._assembler,s._graphics,o)),enableMask(e)),t.node._renderFlag|=d.FLAG_UPDATE_RENDER_DATA;},i.postFillBuffers=function(t,e){var i;t._type===l.Type.IMAGE_STENCIL&&!t.spriteFrame||(i=t,e=e,0===_.length&&cc.errorID(9001),_.pop(),0===_.length?e._flushMaterial(i._exitMaterial):enableMask(e)),t.node._renderFlag|=d.FLAG_UPDATE_RENDER_DATA;},MaskAssembler;}(h);e.MaskAssembler=t,i.default.register(l,t);},{"../../../../renderer/gfx":312,"../../../components/CCMask":84,"../../assembler":217,"../../render-flow":221,"../vertex-format":252,"./graphics":231,"./sprite/2d/simple":242}],238:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../assembler-2d"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var n=t("../../../components/CCMotionStreak");var f=t("../../render-flow");function Point(t,e){this.point=t||cc.v2(),this.dir=e||cc.v2(),this.distance=0,this.time=0;}Point.prototype.setPoint=function(t,e){this.point.x=t,this.point.y=e;},Point.prototype.setDir=function(t,e){this.dir.x=t,this.dir.y=e;};cc.v2();cc.v2();var x=cc.v2();var A=cc.v2();t=function(t){var e;e=t,(i=MotionStreakAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(MotionStreakAssembler);function MotionStreakAssembler(){return t.apply(this,arguments)||this;}var i=MotionStreakAssembler.prototype;return i.initData=function(){this._renderData.createFlexData(0,16,42);},i.update=function(t,h){var u=t._stroke/2;var e=t.node._worldMatrix.m;var i=e[12],e=e[13];var r=t._points;var n;1<r.length&&(a=r[0].point.x-i)*a+(a=r[0].point.y-e)*a<t.minSeg&&(n=r[0]),n||(n=new Point(),r.splice(0,0,n)),n.setPoint(i,e),n.time=t._fadeTime+h;var _=0;if(!(r.length<2)){var a=t._color,d=a.r,f=a.g,p=a.b,m=a.a;i=r[1];i.distance=n.point.sub(i.point,A).mag(),A.normalizeSelf(),i.setDir(A.x,A.y),n.setDir(A.x,A.y);e=this._renderData._flexBuffer;e.reserve(2*r.length,6*(r.length-1));var o=e.vData;var v=e.uintVData;var y=t._fadeTime;var g=!1;for(var b=r.length-1;0<=b;b--){var s=r[b];var C=s.point;var c=s.dir;if(s.time-=h,s.time<0)r.splice(b,1);else{s=s.time/y;var l=r[b-1];if(!g){if(!l){r.splice(b,1);continue;}C.x=l.point.x-c.x*s,C.y=l.point.y-c.y*s;}g=!0,l=c,(c=x).x=-l.y,c.y=l.x;c=(s*m<<24>>>0)+(p<<16)+(f<<8)+d;l=5*_;o[l]=C.x+x.x*u,o[1+l]=C.y+x.y*u,o[2+l]=1,o[3+l]=s,v[4+l]=c,o[l+=5]=C.x-x.x*u,o[1+l]=C.y-x.y*u,o[2+l]=0,o[3+l]=s,v[4+l]=c,_+=2;}}e.used(_,_<=2?0:3*(_-2));}},i.fillBuffers=function(h,t){var e=this._renderData._flexBuffer,i=e.vData,u=e.usedVertices,r=e.usedIndices,e=e.usedVerticesFloats;t=t._meshBuffer;r=t.request(u,r);var n=r.byteOffset>>2,a=t._vData;i.length+n>a.length?a.set(i.subarray(0,e),n):a.set(i,n);var o=t._iData,s=r.indiceOffset,_=r.vertexOffset;for(var c=0,d=u;c<d;c+=2){var l=_+c;o[s++]=l,o[s++]=l+2,o[s++]=l+1,o[s++]=l+1,o[s++]=l+2,o[s++]=l+3;}h.node._renderFlag|=f.FLAG_UPDATE_RENDER_DATA;},MotionStreakAssembler;}(r.default);(i.default=t).register(n,t),e.exports=i.default;},{"../../../components/CCMotionStreak":85,"../../assembler-2d":215,"../../render-flow":221}],239:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../../../assembler-2d"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var b=t("../../../../../components/CCSprite").FillType;t=function(t){var e;e=t,(i=BarFilledAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(BarFilledAssembler);function BarFilledAssembler(){return t.apply(this,arguments)||this;}var i=BarFilledAssembler.prototype;return i.updateRenderData=function(t){var e=t._spriteFrame;var i;this.packToDynamicAtlas(t,e),t._vertsDirty&&(e=t._fillStart,(i=t._fillRange)<0&&(e+=i,i=-i),i=(i=1<(i=e+i)?1:i)<0?0:i,i=(e=(e=1<e?1:e)<0?0:e)+(i=(i-=e)<0?0:i),this.updateUVs(t,e,i=1<i?1:i),this.updateVerts(t,e,i),t._vertsDirty=!1);},i.updateUVs=function(h,t,e){var u=h._spriteFrame;var _=u._texture.width;var d=u._texture.height;var i=u._rect;var f,p;var r,n,a,o,m,v,y,g;u._rotated?(f=i.x/_,p=(i.y+i.width)/d,r=a=f,m=y=(i.x+i.height)/_,o=g=p,n=v=i.y/d):(f=i.x/_,p=(i.y+i.height)/d,r=m=f,a=y=(i.x+i.width)/_,n=o=p,v=g=i.y/d);var s=this._renderData.vDatas[0];var c=this.uvOffset;var l=this.floatsPerVert;switch(h._fillType){case b.HORIZONTAL:s[c]=r+(a-r)*t,s[c+1]=n+(o-n)*t,s[c+l]=r+(a-r)*e,s[c+l+1]=n+(o-n)*e,s[c+2*l]=m+(y-m)*t,s[c+2*l+1]=v+(g-v)*t,s[c+3*l]=m+(y-m)*e,s[c+3*l+1]=v+(g-v)*e;break;case b.VERTICAL:s[c]=r+(m-r)*t,s[c+1]=n+(v-n)*t,s[c+l]=a+(y-a)*t,s[c+l+1]=o+(g-o)*t,s[c+2*l]=r+(m-r)*e,s[c+2*l+1]=n+(v-n)*e,s[c+3*l]=a+(y-a)*e,s[c+3*l+1]=o+(g-o)*e;break;default:cc.errorID(2626);}},i.updateVerts=function(t,e,i){var r=t.node,n=r.width,h=r.height,u=r.anchorX*n,r=r.anchorY*h;var a=-u,o=-r,s=n-u,c=h-r;var l;switch(t._fillType){case b.HORIZONTAL:l=a+(s-a)*i,a=a+(s-a)*e,s=l;break;case b.VERTICAL:l=o+(c-o)*i,o=o+(c-o)*e,c=l;break;default:cc.errorID(2626);}n=this._local;n[0]=a,n[1]=o,n[2]=s,n[3]=c,this.updateWorldVerts(t);},BarFilledAssembler;}(r.default);i.default=t,e.exports=i.default;},{"../../../../../components/CCSprite":94,"../../../../assembler-2d":215}],240:[function(t,e,i){"use strict";function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t=function(t){var e;e=t,(i=MeshSpriteAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(MeshSpriteAssembler);function MeshSpriteAssembler(){return t.apply(this,arguments)||this;}var i=MeshSpriteAssembler.prototype;return i.initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt());},i.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame);var e=t.spriteFrame;var i;!e||(e=e.vertices)&&(this.verticesCount=e.x.length,this.indicesCount=e.triangles.length,(i=this._renderData._flexBuffer).reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(t),t._vertsDirty=!0),i.used(this.verticesCount,this.indicesCount),this.updateIndices(e.triangles),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),this.updateWorldVerts(t),t._vertsDirty=!1));},i.updateIndices=function(t){this._renderData.iDatas[0].set(t);},i.updateUVs=function(t){var t=t.spriteFrame.vertices,e=t.nu,i=t.nv;var r=this.uvOffset;var n=this.floatsPerVert;var a=this._renderData.vDatas[0];for(var o=0;o<e.length;o++){var s=n*o+r;a[s]=e[o],a[s+1]=i[o];}},i.updateVerts=function(t){var e=t.node,i=Math.abs(e.width),r=Math.abs(e.height),h=e.anchorX*i,u=e.anchorY*r;var e=t.spriteFrame,n=e.vertices,a=n.x,_=n.y,n=e._originalSize.width,o=e._originalSize.height,d=e._rect.width,f=e._rect.height,p=e._offset.x+(n-d)/2,m=e._offset.y+(o-f)/2;var v=i/(t.trim?d:n),y=r/(t.trim?f:o);var s=this._local;if(t.trim)for(var c=0,g=a.length;c<g;c++){var b=2*c;s[b]=(a[c]-p)*v-h,s[1+b]=(o-_[c]-m)*y-u;}else for(var l=0,C=a.length;l<C;l++){var x=2*l;s[x]=a[l]*v-h,s[1+x]=(o-_[l])*y-u;}},i.updateWorldVerts=function(t){t=t.node._worldMatrix.m;var e=t[0],i=t[1],r=t[4],h=t[5],u=t[12],_=t[13];var n=this._local;var a=this._renderData.vDatas[0];var o=this.floatsPerVert;for(var s=0,d=this.verticesCount;s<d;s++){var c=n[2*s];var l=n[2*s+1];a[o*s]=c*e+l*r+u,a[o*s+1]=c*i+l*h+_;}},MeshSpriteAssembler;}(((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default);i.default=t,e.exports=i.default;},{"../../../../assembler-2d":215}],241:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;t=(t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t};function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var m=2*Math.PI;var v=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)];var y=[0,0,0,0];var g=[0,0,0,0,0,0,0,0];var b=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)];var A=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)];var C=cc.v2(0,0);var x=[];function _calcInsectedPoints(t,e,i,h,r,n,a){var o=Math.sin(n);var s=Math.cos(n);var c;var l;0!==Math.cos(n)&&(l=o/s,0<(t-r.x)*s&&(c=r.y+l*(t-r.x),a[0].x=t,a[0].y=c),0<(e-r.x)*s&&(t=r.y+l*(e-r.x),a[2].x=e,a[2].y=t)),0!==Math.sin(n)&&(c=s/o,0<(h-r.y)*o&&(l=r.x+c*(h-r.y),a[3].x=l,a[3].y=h),0<(i-r.y)*o&&(e=r.x+c*(i-r.y),a[1].x=e,a[1].y=i));}function _getVertAngle(t,e){var i;if(i=e.x-t.x,e=e.y-t.y,0!=i||0!=e){if(0==i)return 0<e?.5*Math.PI:1.5*Math.PI;t=Math.atan(e/i);return i<0&&(t+=Math.PI),t;}}t=function(p){var t;t=p,(e=RadialFilledAssembler).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(RadialFilledAssembler);function RadialFilledAssembler(){return p.apply(this,arguments)||this;}var e=RadialFilledAssembler.prototype;return e.initData=function(t){this._renderData.createFlexData(0,4,6,this.getVfmt()),this.updateIndices();},e.updateRenderData=function(t){p.prototype.updateRenderData.call(this,t);var e=t.spriteFrame;if(this.packToDynamicAtlas(t,e),t._vertsDirty){var i=t._fillStart;var r=t._fillRange;for(r<0&&(i+=r,r=-r);1<=i;)--i;for(;i<0;)i+=1;i*=m,r*=m,n=(s=(f=t).node).width,a=s.height,o=s.anchorX*n,s=s.anchorY*a,c=-o,l=-s,n-=o,o=a-s,(a=y)[0]=c,a[1]=l,a[2]=n,a[3]=o,s=f._fillCenter,f=C.x=Math.min(Math.max(0,s.x),1)*(n-c)+c,s=C.y=Math.min(Math.max(0,s.y),1)*(o-l)+l,v[0].x=v[3].x=c,v[1].x=v[2].x=n,v[0].y=v[1].y=l,v[2].y=v[3].y=o,f!==a[x.length=0]&&(x[0]=[3,0]),f!==a[2]&&(x[2]=[1,2]),s!==a[1]&&(x[1]=[0,1]),s!==a[3]&&(x[3]=[2,3]),c=e._texture.width,n=e._texture.height,l=e._rect,o=g,e._rotated?(h=l.x/c,u=(l.x+l.height)/c,_=l.y/n,d=(l.y+l.width)/n,o[0]=o[2]=h,o[4]=o[6]=u,o[3]=o[7]=d,o[1]=o[5]=_):(h=l.x/c,u=(l.x+l.width)/c,_=l.y/n,d=(l.y+l.height)/n,o[0]=o[4]=h,o[2]=o[6]=u,o[1]=o[3]=d,o[5]=o[7]=_),_calcInsectedPoints(y[0],y[2],y[1],y[3],C,i,b),_calcInsectedPoints(y[0],y[2],y[1],y[3],C,i+r,A),this.updateVerts(t,i,r),t._vertsDirty=!1;}var h,u,_,d;var f,n,a,o,s,c,l;},e.updateVerts=function(t,e,h){var i=e+h;var r=this._local;var n=r.length=0;var a=3*this.floatsPerVert;for(var o=0;o<4;++o){var s=x[o];if(s)if(m<=h)r.length=n+a,this._generateTriangle(r,n,C,v[s[0]],v[s[1]]),n+=a;else{var c=_getVertAngle(C,v[s[0]]);var l=_getVertAngle(C,v[s[1]]);l<c&&(l+=m),c-=m,l-=m;for(var u=0;u<3;++u)i<=c||(e<=c?(r.length=n+a,i<=l?this._generateTriangle(r,n,C,v[s[0]],A[o]):this._generateTriangle(r,n,C,v[s[0]],v[s[1]]),n+=a):l<=e||(l<=i?(r.length=n+a,this._generateTriangle(r,n,C,b[o],v[s[1]])):(r.length=n+a,this._generateTriangle(r,n,C,b[o],A[o])),n+=a)),c+=m,l+=m;}}this.allocWorldVerts(t),this.updateWorldVerts(t);},e.allocWorldVerts=function(t){var e=t.node._color._val;t=this._renderData;var i=this.floatsPerVert;var r=this._local;var n=r.length/i;this.verticesCount=this.indicesCount=n;var a=t._flexBuffer;a.reserve(n,n)&&this.updateIndices(),a.used(this.verticesCount,this.indicesCount);var o=t.vDatas[0],s=t.uintVDatas[0];var h=this.uvOffset;for(var c=0;c<r.length;c+=i){var l=c+h;o[l]=r[l],o[l+1]=r[l+1],s[l+2]=e;}},e.updateIndices=function(){var t=this._renderData.iDatas[0];for(var e=0;e<t.length;e++)t[e]=e;},e.updateWorldVerts=function(t){var t=t.node._worldMatrix.m,e=t[0],i=t[1],r=t[4],n=t[5],h=t[12],u=t[13];var a=this._local;var o=this._renderData.vDatas[0];var _=this.floatsPerVert;for(var s=0;s<a.length;s+=_){var c=a[s];var l=a[s+1];o[s]=c*e+l*r+h,o[s+1]=c*i+l*n+u;}},e._generateTriangle=function(t,e,i,r,n){var a=y[0];var o=y[1];var s=y[2];var h=y[3];var c=this.floatsPerVert;t[e]=i.x,t[e+1]=i.y,t[e+c]=r.x,t[e+c+1]=r.y,t[e+2*c]=n.x,t[e+2*c+1]=n.y;var u=this.uvOffset;var l;l=(i.x-a)/(s-a),i=(i.y-o)/(h-o),this._generateUV(l,i,t,e+u),l=(r.x-a)/(s-a),i=(r.y-o)/(h-o),this._generateUV(l,i,t,e+c+u),l=(n.x-a)/(s-a),i=(n.y-o)/(h-o),this._generateUV(l,i,t,e+2*c+u);},e._generateUV=function(t,e,i,r){var n=g[0]+(g[2]-g[0])*t;var a=g[1]+(g[3]-g[1])*t;var o=g[5]+(g[7]-g[5])*t;i[r]=n+(g[4]+(g[6]-g[4])*t-n)*e,i[r+1]=a+(o-a)*e;},RadialFilledAssembler;}(t.default);e.default=t,i.exports=e.default;},{"../../../../assembler-2d":215}],242:[function(t,e,i){"use strict";function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t=function(t){var e;e=t,(i=SimpleSpriteAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(SimpleSpriteAssembler);function SimpleSpriteAssembler(){return t.apply(this,arguments)||this;}var i=SimpleSpriteAssembler.prototype;return i.updateRenderData=function(t){this.packToDynamicAtlas(t,t._spriteFrame),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1);},i.updateUVs=function(t){var e=t._spriteFrame.uv;var i=this.uvOffset;var r=this.floatsPerVert;var n=this._renderData.vDatas[0];for(var a=0;a<4;a++){var o=2*a;var s=r*a+i;n[s]=e[o],n[s+1]=e[1+o];}},i.updateVerts=function(t){var h,u,_,e=t.node,i=e.width,r=e.height,n=e.anchorX*i,e=e.anchorY*r;var a,d,o,s,c;i=t.trim?(h=-n,u=-e,_=i-n,r-e):(s=(o=t.spriteFrame)._originalSize.width,a=o._originalSize.height,l=o._rect.width,d=o._rect.height,c=(o=o._offset).x+(s-l)/2,l=o.x-(s-l)/2,h=c*(c=i/s)-n,u=(o.y+(a-d)/2)*(s=r/a)-e,_=i+l*c-n,r+(o.y-(a-d)/2)*s-e);var l=this._local;l[0]=h,l[1]=u,l[2]=_,l[3]=i,this.updateWorldVerts(t);},SimpleSpriteAssembler;}(((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default);i.default=t,e.exports=i.default;},{"../../../../assembler-2d":215}],243:[function(t,e,i){"use strict";function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t=function(t){var e;e=t,(i=SlicedAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(SlicedAssembler);function SlicedAssembler(){return t.apply(this,arguments)||this;}var i=SlicedAssembler.prototype;return i.initData=function(t){if(!(0<this._renderData.meshCount)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);var e=this._renderData.iDatas[0];var i=0;for(var r=0;r<3;++r)for(var n=0;n<3;++n){var a=4*r+n;e[i++]=a,e[i++]=a+1,e[i++]=a+4,e[i++]=a+1,e[i++]=a+5,e[i++]=a+4;}}},i.initLocal=function(){this._local=[],this._local.length=8;},i.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1);},i.updateVerts=function(t){var e=t.node,i=e.width,r=e.height,h=e.anchorX*i,e=e.anchorY*r;var n=t.spriteFrame;var u=n.insetLeft;var a=n.insetRight;var o=n.insetTop;n=n.insetBottom;var s=i-u-a;var c=r-o-n;a=i/(u+a);o=r/(o+n);a=isNaN(a)||1<a?1:a,o=isNaN(o)||1<o?1:o,s=s<0?0:s,c=c<0?0:c;var l=this._local;l[0]=-h,l[1]=-e,l[2]=u*a-h,l[3]=n*o-e,l[4]=l[2]+s,l[5]=l[3]+c,l[6]=i-h,l[7]=r-e,this.updateWorldVerts(t);},i.updateUVs=function(t){var e=this._renderData.vDatas[0];var i=t.spriteFrame.uvSliced;var r=this.uvOffset;var n=this.floatsPerVert;for(var a=0;a<4;++a)for(var o=0;o<4;++o){var s=4*a+o;var c=i[s];s=s*n;e[s+r]=c.u,e[s+r+1]=c.v;}},i.updateWorldVerts=function(t){var t=t.node._worldMatrix.m,e=t[0],i=t[1],h=t[4],u=t[5],_=t[12],d=t[13];var r=this._local;var n=this._renderData.vDatas[0];var f=this.floatsPerVert;for(var a=0;a<4;++a){var o=r[2*a+1];for(var s=0;s<4;++s){var c=r[2*s];var l=(4*a+s)*f;n[l]=c*e+o*h+_,n[1+l]=c*i+o*u+d;}}},SlicedAssembler;}(((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default);i.default=t,Object.assign(t.prototype,{verticesCount:16,indicesCount:54}),e.exports=i.default;},{"../../../../assembler-2d":215}],244:[function(t,e,i){"use strict";function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}i.__esModule=!0,i.default=void 0;t=function(t){var e;e=t,(i=TiledAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(TiledAssembler);function TiledAssembler(){return t.apply(this,arguments)||this;}var i=TiledAssembler.prototype;return i.initData=function(t){this.verticesCount=0,this.contentWidth=0,this.contentHeight=0,this.rectWidth=0,this.rectHeight=0,this.hRepeat=0,this.vRepeat=0,this.row=0,this.col=0,this._renderData.createFlexData(0,4,6,this.getVfmt()),this._updateIndices();},i.initLocal=function(){this._local={x:[],y:[]};},i._updateIndices=function(){var t=this._renderData.iDatas[0];for(var e=0,i=0,r=t.length;e<r;e+=6,i+=4)t[e]=i,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+1,t[e+4]=i+3,t[e+5]=i+2;},i.updateRenderData=function(t){var e=t._spriteFrame;this.packToDynamicAtlas(t,e);var i=t.node;var r=this.contentWidth=Math.abs(i.width);i=this.contentHeight=Math.abs(i.height);var n=e._rect;var a=e.insetLeft,o=e.insetRight,s=n.width-a-o,c=e.insetTop,e=e.insetBottom,n=n.height-c-e;this.sizableWidth=r-a-o,this.sizableHeight=i-c-e,this.sizableWidth=0<this.sizableWidth?this.sizableWidth:0,this.sizableHeight=0<this.sizableHeight?this.sizableHeight:0;r=this.hRepeat=0==s?this.sizableWidth:this.sizableWidth/s;a=this.vRepeat=0==n?this.sizableHeight:this.sizableHeight/n;o=(this.row=Math.ceil(a+2))*(this.col=Math.ceil(r+2));this.verticesCount=4*o,this.indicesCount=6*o;i=this._renderData._flexBuffer;i.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(t)),i.used(this.verticesCount,this.indicesCount),t._vertsDirty&&(this.updateUVs(t),this.updateVerts(t),t._vertsDirty=!1);},i.updateVerts=function(h){var t=h._spriteFrame;var u=t._rect;var e=h.node,i=e.anchorX*e.width,r=e.anchorY*e.height;var _=this.row,d=this.col,f=this.contentWidth,p=this.contentHeight;var m=this._local,v=m.x,y=m.y;v.length=y.length=0;var n=t.insetLeft,g=t.insetRight,a=u.width-n-g,b=t.insetTop,o=t.insetBottom,s=u.height-b-o;var C=1<e.width/(n+g)?1:e.width/(n+g);var x=1<e.height/(b+o)?1:e.height/(b+o);var A,S;A=0<a?Math.floor(1e3*this.sizableWidth)/1e3%a==0?a:this.sizableWidth%a:this.sizableWidth,S=0<s?Math.floor(1e3*this.sizableHeight)/1e3%s==0?s:this.sizableHeight%s:this.sizableHeight;for(var c=0;c<=d;c++)0===c?v[c]=-i:0<c&&c<d?v[c]=1===c?n*C+Math.min(a,this.sizableWidth)-i:0<a?c===d-1?n+A+a*(c-2)-i:n+Math.min(a,this.sizableWidth)+a*(c-2)-i:n+this.sizableWidth-i:c===d&&(v[c]=Math.min(n+this.sizableWidth+g,f)-i);for(var l=0;l<=_;l++)0===l?y[l]=-r:0<l&&l<_?y[l]=1===l?o*x+Math.min(s,this.sizableHeight)-r:0<s?l===_-1?o+S+(l-2)*s-r:o+Math.min(s,this.sizableHeight)+(l-2)*s-r:o+this.sizableHeight-r:l===_&&(y[l]=Math.min(o+this.sizableHeight+b,p)-r);this.updateWorldVerts(h);},i.updateWorldVerts=function(h){var t=this._renderData;var u=this._local;var _=u.x,d=u.y;var e=t.vDatas[0];var u=this.row,f=this.col;t=h.node._worldMatrix.m;var i=t[0],r=t[1],n=t[4],p=t[5],m=t[12],v=t[13];var a,o,s,c;var y=this.floatsPerVert;var l=0;for(var g=0,b=u;g<b;++g){s=d[g],c=d[g+1];for(var C=0,x=f;C<x;++C)a=_[C],o=_[C+1],e[l]=a*i+s*n+m,e[l+1]=a*r+s*p+v,e[l+=y]=o*i+s*n+m,e[l+1]=o*r+s*p+v,e[l+=y]=a*i+c*n+m,e[l+1]=a*r+c*p+v,e[l+=y]=o*i+c*n+m,e[l+1]=o*r+c*p+v,l+=y;}},i.updateUVs=function(h){var t=this._renderData.vDatas[0];if(t){var e=h._spriteFrame;var u=e._rect;var _=e.insetLeft,d=e.insetRight,f=u.width-_-d,_=e.insetTop,d=e.insetBottom,p=u.height-_-d;var i=this.row,r=this.col,m=this.hRepeat,v=this.vRepeat;var y,g;var n=h.spriteFrame.uv;var a=h.spriteFrame.uvSliced;var b=h.spriteFrame._rotated;var o=this.floatsPerVert,s=this.uvOffset;for(var c=0,C=i;c<C;++c){g=this.sizableHeight>p?this.sizableHeight>=c*p?1:v%1:v;for(var l=0,x=r;l<x;++l)y=this.sizableWidth>f?this.sizableWidth>=l*f?1:m%1:m,b?(t[s]=n[0],t[s+1]=n[1],t[s+=o]=n[0],t[s+1]=n[1]+(n[7]-n[1])*y,t[s+=o]=n[0]+(n[6]-n[0])*g,t[s+1]=n[1],t[s+=o]=t[s-o],t[s+1]=t[s+1-2*o]):(0===l?t[s]=n[0]:0<l&&l<r-1?t[s]=a[1].u:l===r-1&&(t[s]=a[2].u),0===c?t[s+1]=a[0].v:0<c&&c<i-1?t[s+1]=a[4].v:c===i-1&&(t[s+1]=a[8].v),s+=o,0===l||0<l&&l<r-1?t[s]=a[1].u+(a[2].u-a[1].u)*y:l===r-1&&(t[s]=a[3].u),0===c?t[s+1]=a[0].v:0<c&&c<i-1?t[s+1]=a[4].v:c===i-1&&(t[s+1]=a[8].v),s+=o,0===l?t[s]=n[0]:0<l&&l<r-1?t[s]=a[1].u:l===r-1&&(t[s]=a[2].u),0===c||0<c&&c<i-1?t[s+1]=a[4].v+(a[8].v-a[4].v)*g:c===i-1&&(t[s+1]=a[12].v),t[s+=o]=t[s-2*o],t[s+1]=t[s+1-o]),s+=o;}}},TiledAssembler;}(((t=t("../../../../assembler-2d"))&&t.__esModule?t:{default:t}).default);i.default=t,e.exports=i.default;},{"../../../../assembler-2d":215}],245:[function(t,e,i){"use strict";var u=_interopRequireDefault(t("../../../assembler"));var r=t("../../../../components/CCSprite");var n=_interopRequireDefault(t("./2d/simple"));var a=_interopRequireDefault(t("./2d/sliced"));var o=_interopRequireDefault(t("./2d/tiled"));var s=_interopRequireDefault(t("./2d/radial-filled"));var c=_interopRequireDefault(t("./2d/bar-filled"));var l=_interopRequireDefault(t("./2d/mesh"));var h=_interopRequireDefault(t("./3d/simple"));var _=_interopRequireDefault(t("./3d/sliced"));var d=_interopRequireDefault(t("./3d/tiled"));var f=_interopRequireDefault(t("./3d/radial-filled"));var p=_interopRequireDefault(t("./3d/bar-filled"));var m=_interopRequireDefault(t("./3d/mesh"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}t={getConstructor:function(t){var e=t.node.is3DNode;var i=(e?h:n).default;switch(t.type){case r.Type.SLICED:i=(e?_:a).default;break;case r.Type.TILED:i=(e?d:o).default;break;case r.Type.FILLED:i=(t._fillType===r.FillType.RADIAL?e?f:s:e?p:c).default;break;case r.Type.MESH:i=(e?m:l).default;}return i;},Simple:n.default,Sliced:a.default,Tiled:o.default,RadialFilled:s.default,BarFilled:c.default,Mesh:l.default,Simple3D:h.default,Sliced3D:_.default,Tiled3D:d.default,RadialFilled3D:f.default,BarFilled3D:p.default,Mesh3D:m.default};u.default.register(cc.Sprite,t);},{"../../../../components/CCSprite":94,"../../../assembler":217,"./2d/bar-filled":239,"./2d/mesh":240,"./2d/radial-filled":241,"./2d/simple":242,"./2d/sliced":243,"./2d/tiled":244,"./3d/bar-filled":void 0,"./3d/mesh":void 0,"./3d/radial-filled":void 0,"./3d/simple":void 0,"./3d/sliced":void 0,"./3d/tiled":void 0}],246:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(r=FlexBuffer.prototype)._reallocVData=function(t,e){this.vData=new Float32Array(t),this.uintVData=new Uint32Array(this.vData.buffer),e&&this.vData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData);},r._reallocIData=function(t,e){this.iData=new Uint16Array(t),e&&this.iData.set(e),this._handler.updateMesh(this._index,this.vData,this.iData);},r.reserve=function(t,e){var i=t*this._verticesBytes>>2;var r=this.vData.length;t=!1;if(r<i){for(;r<i;)r*=2;this._reallocVData(r,this.vData),t=!0;}var n=this.iData.length;if(n<e){for(;n<e;)n*=2;this._reallocIData(e,this.iData),t=!0;}return t;},r.used=function(t,e){this.usedVertices=t,this.usedIndices=e,this.usedVerticesFloats=t*this._verticesBytes>>2,this._handler.updateMeshRange(t,e);},r.reset=function(){var t=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(t),this._reallocIData(this._initIndicesCount),this.usedVertices=0,this.usedVerticesFloats=0,this.usedIndices=0;};r=FlexBuffer;function FlexBuffer(t,e,i,r,n){this._handler=t,this._index=e,this._vfmt=n,this._verticesBytes=n._bytes,this._initVerticesCount=i,this._initIndicesCount=r,this.reset();}var r;i.default=r,cc.FlexBuffer=r,e.exports=i.default;},{}],247:[function(t,e,i){"use strict";var r=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t};t=cc.Class({name:"cc.MeshBuffer",ctor:function(t,e){this.init(t,e);},init:function(t,e){this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1,this._vertexFormat=e,this._vertexBytes=this._vertexFormat._bytes,this._arrOffset=0,this._vbArr=[],this._vb=new r.default.VertexBuffer(t._device,e,r.default.USAGE_DYNAMIC,new ArrayBuffer(),0),this._vbArr[0]=this._vb,this._ibArr=[],this._ib=new r.default.IndexBuffer(t._device,r.default.INDEX_FMT_UINT16,r.default.USAGE_STATIC,new ArrayBuffer(),0),this._ibArr[0]=this._ib,this._vData=null,this._uintVData=null,this._iData=null,this._batcher=t,this._initVDataCount=256*e._bytes,this._initIDataCount=1536,this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0},this._reallocBuffer();},uploadData:function(){var t,e;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this._iData.buffer,0,this.indiceOffset),this._vb.update(0,t),this._ib.update(0,e),this._dirty=!1);},switchBuffer:function(){var t=++this._arrOffset;this.byteOffset=0,this.vertexOffset=0,this.indiceOffset=0,this.indiceStart=0,t<this._vbArr.length?(this._vb=this._vbArr[t],this._ib=this._ibArr[t]):(this._vb=new r.default.VertexBuffer(this._batcher._device,this._vertexFormat,r.default.USAGE_DYNAMIC,new ArrayBuffer(),0),this._vbArr[t]=this._vb,this._ib=new r.default.IndexBuffer(this._batcher._device,r.default.INDEX_FMT_UINT16,r.default.USAGE_STATIC,new ArrayBuffer(),0),this._ibArr[t]=this._ib);},checkAndSwitchBuffer:function(t){65535<this.vertexOffset+t&&(this.uploadData(),this._batcher._flush(),this.switchBuffer());},requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes;var r=this.indiceOffset+e;var n=this._vData.byteLength;var a=this._iData.length;if(n<i||a<r){for(;n<i||a<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,a=this._initIDataCount;this._reallocBuffer();}this._updateOffset(t,e,i);},_updateOffset:function(t,e,i){var r=this._offsetInfo;r.vertexOffset=this.vertexOffset,this.vertexOffset+=t,r.indiceOffset=this.indiceOffset,this.indiceOffset+=e,r.byteOffset=this.byteOffset,this.byteOffset=i,this._dirty=!0;},request:function(t,e){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(t,e),this._offsetInfo;},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(!0);},_reallocVData:function(t){var e;this._vData&&(e=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer);var i=new Uint8Array(this._uintVData.buffer);if(e&&t)for(var r=0,n=e.length;r<n;r++)i[r]=e[r];},_reallocIData:function(t){var e=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),e&&t){var i=this._iData;for(var r=0,n=e.length;r<n;r++)i[r]=e[r];}},reset:function(){this._arrOffset=0,this._vb=this._vbArr[0],this._ib=this._ibArr[0],this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1;},destroy:function(){this.reset();for(var t=0;t<this._vbArr.length;t++)this._vbArr[t].destroy();this._vbArr=null;for(var e=0;e<this._ibArr.length;e++)this._ibArr[e].destroy();this._ibArr=null,this._ib=null,this._vb=null;},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset;}});cc.MeshBuffer=e.exports=t;},{"../../../renderer/gfx":312}],248:[function(t,c,l){"use strict";var i=_interopRequireDefault(t("../../../renderer/core/input-assembler"));var r=_interopRequireDefault(t("../../../renderer/memop/recycle-pool"));var h=_interopRequireDefault(t("../../../renderer/scene/model"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var e=t("./vertex-format"),n=e.vfmtPosUvColor,a=e.vfmt3D;var u=t("./quad-buffer");var _=t("./mesh-buffer");var d=t("./spine-buffer");e=t("../../assets/material/CCMaterial");new(t("../../platform/id-generater"))("VertextFormat");var o={};var s=new e();var f=new i.default();f._count=0;function _vM(t,e){this._renderScene=e,this._device=t,this.walking=!1,this.material=s,this.cullingMask=1,this._iaPool=new r.default(function(){return new i.default();},16),this._modelPool=new r.default(function(){return new h.default();},16),this._quadBuffer=this.getBuffer("quad",n),this._meshBuffer=this.getBuffer("mesh",n),this._quadBuffer3D=this.getBuffer("quad",a),this._meshBuffer3D=this.getBuffer("mesh",a),this._buffer=this._meshBuffer,this._batchedModels=[],this._dummyNode=new cc.Node(),this._sortKey=0,this.node=this._dummyNode,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0;}_vM.prototype={constructor:_vM,reset:function(){this._iaPool.reset();var t=this._renderScene;var e=this._batchedModels;for(var i=0;i<e.length;++i)e[i].setInputAssembler(null),e[i].setEffect(null),t.removeModel(e[i]);for(var r in this._modelPool.reset(),e.length=0,this._sortKey=0,o)o[r].reset();this._buffer=this._meshBuffer,this.node=this._dummyNode,this.material=s,this.cullingMask=1,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0;},_flushMaterial:function(t){var e;!t||(t=(this.material=t).effect)&&(e=this._modelPool.add(),this._batchedModels.push(e),e.sortKey=this._sortKey++,e._cullingMask=this.cullingMask,e.setNode(this.node),e.setEffect(t,null),e.setInputAssembler(f),this._renderScene.addModel(e));},_flush:function(){var t=this.material,e=this._buffer,i=e.indiceOffset-e.indiceStart;var r;!this.walking||!t||i<=0||(t=t.effect)&&((r=this._iaPool.add())._vertexBuffer=e._vb,r._indexBuffer=e._ib,r._start=e.indiceStart,r._count=i,i=this._modelPool.add(),this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(t),i.setInputAssembler(r),this._renderScene.addModel(i),e.forwardIndiceStartToOffset());},_flushIA:function(t){var e,i;!t||(e=this.material.effect)&&(i=this._modelPool.add(),this._batchedModels.push(i),i.sortKey=this._sortKey++,i._cullingMask=this.cullingMask,i.setNode(this.node),i.setEffect(e),i.setInputAssembler(t),this._renderScene.addModel(i));},terminate:function(){for(var t in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),o)o[t].uploadData();this.walking=!1;},getBuffer:function(t,e){var i=t+e.getHash();var r=o[i];if(!r){if("mesh"===t)r=new _(this,e);else if("quad"===t)r=new u(this,e);else{if("spine"!==t)return cc.error("Not support buffer type ["+t+"]"),null;r=new d(this,e);}o[i]=r;}return r;}},c.exports=_vM;},{"../../../renderer/core/input-assembler":302,"../../../renderer/memop/recycle-pool":327,"../../../renderer/scene/model":333,"../../assets/material/CCMaterial":53,"../../platform/id-generater":205,"./mesh-buffer":247,"./quad-buffer":249,"./spine-buffer":251,"./vertex-format":252}],249:[function(t,e,i){"use strict";t=t("./mesh-buffer");t=cc.Class({name:"cc.QuadBuffer",extends:t,_fillQuadBuffer:function(){var t=this._initIDataCount/6;var e=this._iData;for(var i=0,r=0;i<t;i++){var n=4*i;e[r++]=n,e[r++]=1+n,e[r++]=2+n,e[r++]=1+n,e[r++]=3+n,e[r++]=2+n;}var a=new Uint16Array(this._iData.buffer,0,6*t);this._ib.update(0,a);},uploadData:function(){var t;0!==this.byteOffset&&this._dirty&&(t=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),this._vb.update(0,t),this._dirty=!1);},switchBuffer:function(){this._super();var t=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,t);},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(),this._fillQuadBuffer();}});cc.QuadBuffer=e.exports=t;},{"./mesh-buffer":247}],250:[function(t,e,i){"use strict";i.__esModule=!0,i.default=RenderData;var n=(r=t("./flex-buffer"))&&r.__esModule?r:{default:r};var r;var a=t("./vertex-format");function RenderData(){this.vDatas=[],this.uintVDatas=[],this.iDatas=[],this.meshCount=0,this._infos=null,this._flexBuffer=null;}cc.js.mixin(RenderData.prototype,{init:function(t){},clear:function(){this.vDatas.length=0,this.iDatas.length=0,this.uintVDatas.length=0,this.meshCount=0,this._infos=null,this._flexBuffer&&this._flexBuffer.reset();},updateMesh:function(t,e,i){this.vDatas[t]=e,this.uintVDatas[t]=new Uint32Array(e.buffer,0,e.length),this.iDatas[t]=i,this.meshCount=this.vDatas.length;},updateMeshRange:function(t,e){},createData:function(t,e,i){e=new Float32Array(e);i=new Uint16Array(i);this.updateMesh(t,e,i);},createQuadData:function(t,e,i){this.createData(t,e,i),this.initQuadIndices(this.iDatas[t]);},createFlexData:function(t,e,i,r){r=r||a.vfmtPosUvColor,this._flexBuffer=new n.default(this,t,e,i,r);},initQuadIndices:function(t){var e=t.length/6;for(var i=0,r=0;i<e;i++){var n=4*i;t[r++]=n,t[r++]=1+n,t[r++]=2+n,t[r++]=1+n,t[r++]=3+n,t[r++]=2+n;}}}),cc.RenderData=RenderData,e.exports=i.default;},{"./flex-buffer":246,"./vertex-format":252}],251:[function(t,e,i){"use strict";t=cc.Class({name:"cc.SpineBuffer",extends:t("./mesh-buffer"),requestStatic:function(t,e){this.checkAndSwitchBuffer(t);var i=this.byteOffset+t*this._vertexBytes;var r=this.indiceOffset+e;var n=this._vData.byteLength;var a=this._iData.length;if(n<i||a<r){for(;n<i||a<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,a=this._initIDataCount;this._reallocBuffer();}t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset;},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0;}});cc.SpineBuffer=e.exports=t;},{"./mesh-buffer":247}],252:[function(t,e,i){"use strict";t=(t=t("../../../renderer/gfx"))&&t.__esModule?t:{default:t};var r=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:3},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);r.name="vfmt3D",t.default.VertexFormat.XYZ_UV_Color=r;var n=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);n.name="vfmtPosUvColor",t.default.VertexFormat.XY_UV_Color=n;var a=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:t.default.ATTR_COLOR0,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);a.name="vfmtPosUvTwoColor",t.default.VertexFormat.XY_UV_Two_Color=a;var o=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_UV0,type:t.default.ATTR_TYPE_FLOAT32,num:2}]);o.name="vfmtPosUv",t.default.VertexFormat.XY_UV=o;var s=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2},{name:t.default.ATTR_COLOR,type:t.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);s.name="vfmtPosColor",t.default.VertexFormat.XY_Color=s;var c=new t.default.VertexFormat([{name:t.default.ATTR_POSITION,type:t.default.ATTR_TYPE_FLOAT32,num:2}]);c.name="vfmtPos",t.default.VertexFormat.XY=c,e.exports={vfmt3D:r,vfmtPosUvColor:n,vfmtPosUvTwoColor:a,vfmtPosUv:o,vfmtPosColor:s,vfmtPos:c};},{"../../../renderer/gfx":312}],253:[function(t,e,i){"use strict";t("../platform/CCSys");var r=/(\.[^\.\/\?\\]*)(\?.*)?$/;var n=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/;var a=/[^\.\/]+\/\.\.\//;cc.path={join:function(){var t=arguments.length;var e="";for(var i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e;},extname:function(t){t=r.exec(t);return t?t[1]:"";},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e);}return t;},basename:function(t,e){var i=t.indexOf("?");0<i&&(t=t.substring(0,i));i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return null;i=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i;},dirname:function(t){t=n.exec(t);return t?t[2]:"";},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?");var r="";return 0<i&&(r=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+r:t.substring(0,i)+e+r;},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var r=t.indexOf("?");var n="";i=i?this.extname(t):"";return 0<r&&(n=t.substring(r),t=t.substring(0,r)),r=t.lastIndexOf("/"),t.substring(0,r=r<=0?0:r+1)+e+i+n;},_normalize:function(t){var e;t=String(t);for(;t=(e=t).replace(a,""),e.length!==t.length;);return t;},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"");}},e.exports=cc.path;},{"../platform/CCSys":198}],254:[function(t,e,i){"use strict";function CBM(t,e,i,r,n,a){this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=a;}CBM.create=function(t,e,i,r,n,a){return{a:t,b:e,c:i,d:r,tx:n,ty:a};},CBM.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0};},CBM.clone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty};},CBM.concat=function(t,e,i){var r=e.a,n=e.b,a=e.c,o=e.d,s=e.tx,e=e.ty;return t.a=r*i.a+n*i.c,t.b=r*i.b+n*i.d,t.c=a*i.a+o*i.c,t.d=a*i.b+o*i.d,t.tx=s*i.a+e*i.c+i.tx,t.ty=s*i.b+e*i.d+i.ty,t;},CBM.invert=function(t,e){var i=e.a,r=e.b,n=e.c,a=e.d;var o=1/(i*a-r*n);var s=e.tx,e=e.ty;return t.a=o*a,t.b=-o*r,t.c=-o*n,t.d=o*i,t.tx=o*(n*e-a*s),t.ty=o*(r*s-i*e),t;},CBM.fromMat4=function(t,e){e=e.m;return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.tx=e[12],t.ty=e[13],t;},CBM.transformVec2=function(t,e,i,r){var n;return e=void 0===r?(r=i,n=e.x,e.y):(n=e,i),t.x=r.a*n+r.c*e+r.tx,t.y=r.b*n+r.d*e+r.ty,t;},CBM.transformSize=function(t,e,i){return t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height,t;},CBM.transformRect=function(t,e,i){var r=e.x;var n=e.y;var a=r+e.width;e=n+e.height;var o=i.a*r+i.c*n+i.tx;var s=i.b*r+i.d*n+i.ty;var c=i.a*a+i.c*n+i.tx;n=i.b*a+i.d*n+i.ty;var l=i.a*r+i.c*e+i.tx;r=i.b*r+i.d*e+i.ty;var h=i.a*a+i.c*e+i.tx;a=i.b*a+i.d*e+i.ty;e=Math.min(o,c,l,h);i=Math.max(o,c,l,h);o=Math.min(s,n,r,a);c=Math.max(s,n,r,a);return t.x=e,t.y=o,t.width=i-e,t.height=c-o,t;},CBM.transformObb=function(t,e,i,r,n,a){var o=n.x;var s=n.y;var c=n.width;n=n.height;var l=a.a*o+a.c*s+a.tx;o=a.b*o+a.d*s+a.ty;s=a.a*c;c=a.b*c;var h=a.c*n;a=a.d*n;e.x=l,e.y=o,i.x=s+l,i.y=c+o,t.x=h+l,t.y=a+o,r.x=s+h+l,r.y=c+a+o;},cc.AffineTransform=e.exports=CBM;},{}],255:[function(t,s,l){"use strict";var e=t("../platform/CCObject").Flags;var h=t("./misc");var i=t("../platform/js");var u=t("../platform/id-generater");var _=t("../event-manager");var r=t("../renderer/render-flow");var c=e.Destroying;var n=e.DontDestroy;var a=e.Deactivating;var o=new u("Node");function getConstructor(t){return t?"string"==typeof t?i.getClassByName(t):t:(cc.errorID(3804),null);}function findComponent(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var r=t._components[i];if(r.constructor===e)return r;}else for(var n=0;n<t._components.length;++n){var a=t._components[n];if(a instanceof e)return a;}return null;}function findComponents(t,e,i){if(e._sealed)for(var r=0;r<t._components.length;++r){var n=t._components[r];n.constructor===e&&i.push(n);}else for(var a=0;a<t._components.length;++a){var o=t._components[a];o instanceof e&&i.push(o);}}t=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return 0<(this._objFlags&n);},set:function(t){t?this._objFlags|=n:this._objFlags&=~n;}},name:{get:function(){return this._name;},set:function(t){this._name=t;}},uuid:{get:function(){return this._id;}},children:{get:function(){return this._children;}},childrenCount:{get:function(){return this._children.length;}},active:{get:function(){return this._active;},set:function(t){var e;this._active!==(t=!!t)&&(this._active=t,(e=this._parent)&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t));}},activeInHierarchy:{get:function(){return this._activeInHierarchy;}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this._id=o.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[];},getParent:function(){return this._parent;},setParent:function(t){var e,i;this._parent!==t&&((e=this._parent)&&e._objFlags&a&&cc.errorID(3821),this._parent=t||null,this._onSetParent(t),t&&(t._objFlags&a&&cc.errorID(3821),_._setDirtyForNode(this),t._children.push(this),t.emit&&t.emit("child-added",this),t._renderFlag|=r.FLAG_CHILDREN),e?e._objFlags&c||(i=e._children.indexOf(this),e._children.splice(i,1),e.emit&&e.emit("child-removed",this),this._onHierarchyChanged(e),0===e._children.length&&(e._renderFlag&=~r.FLAG_CHILDREN)):t&&this._onHierarchyChanged(null));},attr:function(t){i.mixin(this,t);},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;var e=this._children;for(var i=0,r=e.length;i<r;i++)if(e[i]._id===t)return e[i];return null;},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;var e=this._children;for(var i=0,r=e.length;i<r;i++)if(e[i]._name===t)return e[i];return null;},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this);},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e);},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0;},setSiblingIndex:function(t){var e,i;this._parent&&(this._parent._objFlags&a?cc.errorID(3821):(e=this._parent._children,(t=-1!==t?t:e.length-1)!==(i=e.indexOf(this))&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))));},walk:function(t,e){var i=cc._BaseNode;var r=1;var n,a,o,s;var c=i._stacks[i._stackId];c||i._stacks.push(c=[]),i._stackId++,c.length=0,c[0]=this;var l=null;for(s=!1;r;)if(a=c[--r])if(!s&&t?t(a):s&&e&&e(a),c[r]=null,s){if(s=!1,n)if(n[++o])c[r]=n[o],r++;else if(l&&(c[r]=l,r++,s=!0,l._parent?(o=(n=l._parent._children).indexOf(l),l=l._parent):n=l=null,o<0))break;}else 0<a._children.length?(n=(l=a)._children,c[r]=n[o=0],r++):(c[r]=a,r++,s=!0);c.length=0,i._stackId--;},cleanup:function(){},removeFromParent:function(t){this._parent&&this._parent.removeChild(this,t=void 0===t?!0:t);},removeChild:function(t,e){-1<this._children.indexOf(t)&&(!e&&void 0!==e||t.cleanup(),t.parent=null);},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;0<=i;i--){var r=e[i];r&&(t&&r.cleanup(),r.parent=null);}this._children.length=0;},isChildOf:function(t){var e=this;do{if(e===t)return!0;}while(e=e._parent);return!1;},getComponent:function(t){t=getConstructor(t);return t?findComponent(this,t):null;},getComponents:function(t){var t=getConstructor(t),e=[];return t&&findComponents(this,t,e),e;},getComponentInChildren:function(t){t=getConstructor(t);return t?function findChildComponent(t,e){for(var i=0;i<t.length;++i){var r=t[i];var n=findComponent(r,e);if(n)return n;if(0<r._children.length&&(n=findChildComponent(r._children,e)))return n;}return null;}(this._children,t):null;},getComponentsInChildren:function(t){var t=getConstructor(t),e=[];return t&&(findComponents(this,t,e),function findChildComponents(t,e,i){for(var r=0;r<t.length;++r){var n=t[r];findComponents(n,e,i),0<n._children.length&&findChildComponents(n._children,e,i);}}(this._children,t,e)),e;},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=i.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null;}else{if(!t)return cc.errorID(3804),null;e=t;}if("function"!=typeof e)return cc.errorID(3809),null;if(!i.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;t=e._requireComponent;if(t&&!this.getComponent(t)&&!this.addComponent(t))return null;t=new e();return(t.node=this)._components.push(t),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(t),t;},_addComponentAt:!1,removeComponent:function(t){t?(t=t instanceof cc.Component?t:this.getComponent(t))&&t.destroy():cc.errorID(3813);},_getDependComponent:!1,_removeComponent:function(t){var e;t?this._objFlags&c||(-1!==(e=this._components.indexOf(t))?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)):cc.errorID(3814);},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1);},destroyAllChildren:function(){var t=this._children;for(var e=0;e<t.length;++e)t[e].destroy();},_onSetParent:function(t){},_onPostActivated:function(){},_onBatchRestored:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(t){var e=this._parent;!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this);e=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==e&&cc.director._nodeActivator.activateNode(this,e);},_instantiate:function(t){t=t||cc.instantiate._clone(this,this);var e=this._prefab;e&&this===e.root&&e.sync;return t._parent=null,t._onBatchRestored(),t;},_registerIfAttached:!1,_onPreDestroy:function(){var t,e;this._objFlags|=c;var i=this._parent;var r=i&&i._objFlags&c;var n=this._children;for(t=0,e=n.length;t<e;++t)n[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t)this._components[t]._destroyImmediate();var a=this.__eventTargets;for(t=0,e=a.length;t<e;++t){var o=a[t];o&&o.targetOff(this);}var s;return a.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!r&&i&&(s=i._children.indexOf(this),i._children.splice(s,1),i.emit&&i.emit("child-removed",this)),r;},onRestore:!1});t.idGenerater=o,t._stacks=[[]],t._stackId=0,t.prototype._onPreDestroyBase=t.prototype._onPreDestroy,t.prototype._onHierarchyChangedBase=t.prototype._onHierarchyChanged;h.propertyDefine(t,["parent","name","children","childrenCount"],{}),cc._BaseNode=s.exports=t;},{"../event-manager":113,"../platform/CCObject":195,"../platform/id-generater":205,"../platform/js":209,"../renderer/render-flow":221,"./misc":264}],256:[function(t,e,i){"use strict";e.exports={binarySearchEpsilon:function(t,e){for(var i=0,r=t.length-1,n=r>>>1;i<=r;n=i+r>>>1){var a=t[n];if(e+1e-6<a)r=n-1;else{if(!(a<e-1e-6))return n;i=n+1;}}return~i;}};},{}],257:[function(t,e,i){"use strict";var r=t("../components/CCRenderComponent");var n=t("../platform/CCMacro").BlendFactor;var a=t("../../renderer/gfx");t=cc.Class({properties:{_srcBlendFactor:n.SRC_ALPHA,_dstBlendFactor:n.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor;},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc());},animatable:!1,type:n,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor;},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc());},animatable:!1,type:n,tooltip:!1,visible:!0}},setMaterial:function(t,e){t=r.prototype.setMaterial.call(this,t,e);return this._srcBlendFactor===n.SRC_ALPHA&&this._dstBlendFactor===n.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(t),t;},_updateMaterial:function(){this._updateBlendFunc();},_updateBlendFunc:function(){if(this._srcBlendFactor!==n.SRC_ALPHA||this._dstBlendFactor!==n.ONE_MINUS_SRC_ALPHA){var t=this.getMaterials();for(var e=0;e<t.length;e++){var i=t[e];this._updateMaterialBlendFunc(i);}}},_updateMaterialBlendFunc:function(t){t.setBlend(!0,a.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,a.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor);}});e.exports=cc.BlendFunc=t;},{"../../renderer/gfx":312,"../components/CCRenderComponent":89,"../platform/CCMacro":194}],258:[function(t,e,i){"use strict";var a=t("./misc").BASE64_VALUES;var o="0123456789abcdef".split("");t=["","","",""];var s=t.concat(t,"-",t,"-",t,"-",t,"-",t,t,t);var c=s.map(function(t,e){return"-"===t?NaN:e;}).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;s[0]=t[0],s[1]=t[1];for(var e=2,i=2;e<22;e+=2){var r=a[t.charCodeAt(e)];var n=a[t.charCodeAt(e+1)];s[c[i++]]=o[r>>2],s[c[i++]]=o[(3&r)<<2|n>>4],s[c[i++]]=o[15&n];}return s.join("");};},{"./misc":264}],259:[function(t,e,i){"use strict";cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(3814),null;if(!e){var i=cc.director.getScene();if(!i)return null;e=i;}var r=e;i="/"!==t[0]?0:1;var n=t.split("/");for(var a=i;a<n.length;a++){var o=n[a];var s=r._children;r=null;for(var c=0,h=s.length;c<h;++c){var l=s[c];if(l.name===o){r=l;break;}}if(!r)return null;}return r;};},{}],260:[function(t,e,i){"use strict";var r=(a=t("../assets/material/material-variant"))&&a.__esModule?a:{default:a};var n=t("../assets/material/CCMaterial");var a=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial;},set:function(t){this._normalMaterial=t,this._updateDisabledState&&this._updateDisabledState();},type:n,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial;},set:function(t){this._grayMaterial=t,this._updateDisabledState&&this._updateDisabledState();},type:n,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(t,e){var i;i=t?(i=(i=this._grayMaterial)||n.getBuiltinMaterial("2d-gray-sprite"),this._grayMaterial=r.default.create(i,e)):(i=(i=this._normalMaterial)||n.getBuiltinMaterial("2d-sprite",e),this._normalMaterial=r.default.create(i,e)),e.setMaterial(0,i);}});e.exports=a;},{"../assets/material/CCMaterial":53,"../assets/material/material-variant":60}],261:[function(t,e,i){"use strict";var c=/^(click)(\s)*=|(param)(\s)*=/;var u=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;function dIM(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "]);}dIM.prototype={constructor:dIM,parse:function(t){this._resultObjectArray=[],this._stack=[];var e=0;var i=t.length;for(;e<i;){var r=t.indexOf(">",e);var n=-1;var a,o;0<=r&&(n=t.lastIndexOf("<",r))<e-1&&(n=t.indexOf("<",r+1),r=t.indexOf(">",n+1)),e=n<0?(this._stack.pop(),this._processResult(t.substring(e)),i):(a=t.substring(e,n),""===(o=t.substring(n+1,r))&&(a=t.substring(e,r+1)),this._processResult(a),-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(o),r+1);}return this._resultObjectArray;},_attributeToObject:function(t){var e={};var i=(t=t.trim()).match(/^(color|size)(\s)*=/);var r;var n;var a;if(i){if(r=i[0],""===(t=t.substring(r.length).trim()))return e;switch(n=t.indexOf(" "),r[0]){case"c":e.color=-1<n?t.substring(0,n).trim():t;break;case"s":e.size=parseInt(t);}return-1<n&&(a=t.substring(n+1).trim(),a=this._processEventHandler(a),e.event=a),e;}if((i=t.match(/^(br(\s)*\/)/))&&0<i[0].length&&(r=i[0].trim()).startsWith("br")&&"/"===r[r.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),e;if((i=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&0<i[0].length&&(r=i[0].trim()).startsWith("img")&&"/"===r[r.length-1]){var o;i=t.match(u);var s=!1;for(;i;){if(r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),l=-1<(n=(o=t.substring(r.length).trim()).indexOf(" "))?o.substr(0,n):o,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(n).trim(),l.endsWith("/")&&(l=l.slice(0,-1)),"src"===r){switch(l.charCodeAt(0)){case 34:case 39:s=!0,l=l.slice(1,-1);}e.isImage=!0,e.src=l;}else if("height"===r)e.imageHeight=parseInt(l);else if("width"===r)e.imageWidth=parseInt(l);else if("align"===r){switch(l.charCodeAt(0)){case 34:case 39:l=l.slice(1,-1);}e.imageAlign=l.toLocaleLowerCase();}else"offset"===r?e.imageOffset=l:"click"===r&&(e.event=this._processEventHandler(r+"="+l));e.event&&"param"===r&&(e.event.param=l.replace(/^\"|\"$/g,"")),i=t.match(u);}return s&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{};}if(i=t.match(/^(outline(\s)*[^>]*)/)){var c={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var h=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;var l;for(i=t.match(h);i;)r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),l=-1<(n=(o=t.substring(r.length).trim()).indexOf(" "))?o.substr(0,n):o,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=o.substring(n).trim(),"click"===r?e.event=this._processEventHandler(r+"="+l):"color"===r?c.color=l:"width"===r&&(c.width=parseInt(l)),e.event&&"param"===r&&(e.event.param=l.replace(/^\"|\"$/g,"")),i=t.match(h);}e.outline=c;}if((i=t.match(/^(on|u|b|i)(\s)*/))&&0<i[0].length){switch(r=i[0],t=t.substring(r.length).trim(),r[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0;}if(""===t)return e;a=this._processEventHandler(t),e.event=a;}return e;},_processEventHandler:function(t){var e=0;var i={};var r=t.match(c);var n=!1;for(;r;){var a=r[0];var o="";var s;n=!1,'"'===(t=t.substring(a.length).trim()).charAt(0)?(-1<(e=t.indexOf('"',1))&&(o=t.substring(1,e).trim(),n=!0),e++):"'"===t.charAt(0)?(-1<(e=t.indexOf("'",1))&&(o=t.substring(1,e).trim(),n=!0),e++):e=(o=(s=t.match(/(\S)+/))?s[0]:"").length,n&&(i[a=a.substring(0,a.length-1).trim()]=o),r=(t=t.substring(e).trim()).match(c);}return i;},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else if(!e.isNewLine&&!e.isImage){var i=this._stack[this._stack.length-1];for(var r in i)e[r]||(e[r]=i[r]);this._stack.push(e);}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),0<this._stack.length?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}));},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0];var r=this._specialSymbolArray[e][1];t=t.replace(i,r);}return t;}},e.exports=dIM;},{}],262:[function(t,e,i){"use strict";t("./CCPath"),t("./profiler/CCProfiler"),t("./find"),t("./mutable-forward-iterator");},{"./CCPath":253,"./find":259,"./mutable-forward-iterator":265,"./profiler/CCProfiler":268}],263:[function(t,e,i){"use strict";i.__esModule=!0,i.postLoadMesh=function(i,r){!i.loaded&&i.nativeUrl?cc.loader.load(i.nativeUrl,function(t,e){e&&(i._nativeAsset=e),r&&r(t);}):r&&r();};},{}],264:[function(t,e,i){"use strict";var c=t("../platform/js");t={};t.propertyDefine=function(t,e,i){function define(t,e,i,r){var n=Object.getOwnPropertyDescriptor(t,e);n?(n.get&&(t[i]=n.get),n.set&&r&&(t[r]=n.set)):(n=t[i],c.getset(t,e,n,t[r]));}var r,n=t.prototype;for(var a=0;a<e.length;a++){var o=(r=e[a])[0].toUpperCase()+r.slice(1);define(n,r,"get"+o,"set"+o);}for(r in i){var s=i[r];define(n,r,s[0],s[1]);}},t.NextPOT=function(t){return--t,(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)+1;},t.BUILTIN_CLASSID_RE=/^(?:cc|dragonBones|sp|ccsg)\..+/;var r=new Array(123);for(var n=0;n<123;++n)r[n]=64;for(var a=0;a<64;++a)r["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(a)]=a;t.BASE64_VALUES=r,t.pushToMap=function(t,e,i,r){var n=t[e];n?Array.isArray(n)?r?(n.push(n[0]),n[0]=i):n.push(i):t[e]=r?[i,n]:[n,i]:t[e]=i;},t.clampf=function(t,e,i){var r;return i<e&&(r=e,e=i,i=r),t<e?e:t<i?t:i;},t.clamp01=function(t){return t<0?0:t<1?t:1;},t.lerp=function(t,e,i){return t+(e-t)*i;},t.degreesToRadians=function(t){return t*cc.macro.RAD;},t.radiansToDegrees=function(t){return t*cc.macro.DEG;},cc.misc=e.exports=t;},{"../platform/js":209}],265:[function(t,e,i){"use strict";function MutableForwardIterator(t){this.i=0,this.array=t;}var r=MutableForwardIterator.prototype;r.remove=function(t){t=this.array.indexOf(t);0<=t&&this.removeAt(t);},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i;},r.fastRemove=function(t){t=this.array.indexOf(t);0<=t&&this.fastRemoveAt(t);},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i;},r.push=function(t){this.array.push(t);},e.exports=MutableForwardIterator;},{}],266:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;(r=Pool.prototype).get=function(){},r.put=function(){},r.clear=function(){};r=Pool;function Pool(){this.enabled=!1,this.count=0,this.maxSize=1024;}var r;i.default=r,cc.pool={},r.register=function(t,e){cc.pool[t]=e;},e.exports=i.default;},{}],267:[function(t,e,i){"use strict";cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags;var r=t._parent;var n=t._id;var a=t._name;var o=t._active;var s=t._eulerAngles.x;var h=t._eulerAngles.y;var u=t._eulerAngles.z;var _=t._localZOrder;var d=t._globalZOrder;var c=t._trs;var f=c[0];var p=c[1];var m=c[2];cc.game._isCloning=!0;var l=e.asset.data;l._prefab._synced=!0,l._iN$t=t,cc.instantiate._clone(l,l),cc.game._isCloning=!1,t._objFlags=i,t._parent=r,t._id=n,t._prefab=e,t._name=a,t._active=o,t._localZOrder=_,t._globalZOrder=d,(c=t._trs)[0]=f,c[1]=p,c[2]=m,t._eulerAngles.x=s,t._eulerAngles.y=h,t._eulerAngles.z=u;}};},{}],268:[function(t,e,s){"use strict";var c=t("../../platform/CCMacro");var l=t("./perf-counter");var i=!1;var r=15;var n=null;var a=null;var o=null;function beforeUpdate(){var t,e;a&&a.isValid||((a=new cc.Node("PROFILER-NODE")).x=a.y=10,a.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),a.zIndex=c.MAX_ZINDEX,cc.game.addPersistRootNode(a),(i=new cc.Node("LEFT-PANEL")).anchorX=i.anchorY=0,(t=i.addComponent(cc.Label)).fontSize=r,t.lineHeight=r,i.parent=a,(i=new cc.Node("RIGHT-PANEL")).anchorX=1,i.anchorY=0,i.x=200,(e=i.addComponent(cc.Label)).horizontalAlign=cc.Label.HorizontalAlign.RIGHT,e.fontSize=r,e.lineHeight=r,i.parent=a,cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(t.cacheMode=cc.Label.CacheMode.CHAR,e.cacheMode=cc.Label.CacheMode.CHAR),o={left:t,right:e});var i=cc.director._lastUpdate;n.frame._counter.start(i),n.logic._counter.start(i);}function afterUpdate(){var t=performance.now();cc.director.isPaused()?n.frame._counter.start(t):n.logic._counter.end(t),n.render._counter.start(t);}function afterDraw(){var t=performance.now();n.render._counter.end(t),n.draws._counter.value=cc.renderer.drawCalls,n.frame._counter.end(t),n.fps._counter.frame(t);var e="";var i="";for(var r in n){r=n[r];r._counter.sample(t),e+=r.desc+"\n",i+=r._counter.human()+"\n";}o&&(o.left.string=e,o.right.string=i);}cc.profiler=e.exports={isShowingStats:function(){return i;},hideStats:function(){i&&(a&&(a.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,beforeUpdate),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,afterUpdate),cc.director.off(cc.Director.EVENT_AFTER_DRAW,afterDraw),i=!1);},showStats:function(){if(!i){if(!n){n={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var t=performance.now();for(var e in n)n[e]._counter=new l(e,n[e],t);}a&&(a.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,beforeUpdate),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,afterUpdate),cc.director.on(cc.Director.EVENT_AFTER_DRAW,afterDraw),i=!0;}}};},{"../../platform/CCMacro":194,"./perf-counter":270}],269:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.Counter",ctor:function(t,e,i){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=i;},properties:{value:{get:function(){return this._value;},set:function(t){this._value=t;}}},_average:function(t,e){this._opts.average&&(this._accumValue+=t,++this._accumSamples,(t=e)-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=t,this._accumSamples=0));},sample:function(t){this._average(this._value,t);},human:function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100;},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over;}});e.exports=r;},{}],270:[function(t,e,i){"use strict";t=t("./counter");t=cc.Class({name:"cc.PerfCounter",extends:t,ctor:function(t,e,i){this._time=i;},start:function(t){this._time=t;},end:function(t){this._value=t-this._time,this._average(this._value);},tick:function(){this.end(),this.start();},frame:function(t){var e=t-this._time;this._total++,(this._opts.average||1e3)<e&&(this._value=1e3*this._total/e,this._total=0,this._time=t,this._average(this._value));}});e.exports=t;},{"./counter":269}],271:[function(t,e,i){"use strict";var r=new((t=t("../platform/js"))&&t.__esModule?t:{default:t}).default.Pool(2);function LRUCache(t){this.count=0,this.limit=t,this.datas={},this.head=null,this.tail=null;}r.get=function(){return this._get()||{key:null,value:null,prev:null,next:null};},LRUCache.prototype.moveToHead=function(t){t.next=this.head,(t.prev=null)!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.count++,this.datas[t.key]=t;},LRUCache.prototype.put=function(t,e){var i=r.get();i.key=t,i.value=e,this.count>=this.limit&&(t=this.tail,delete this.datas[t.key],this.count--,this.tail=t.prev,this.tail.next=null,t.prev=null,t.next=null,r.put(t)),this.moveToHead(i);},LRUCache.prototype.remove=function(t){null!==t.prev?t.prev.next=t.next:this.head=t.next,null!==t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--;},LRUCache.prototype.get=function(t){t=this.datas[t];return t?(this.remove(t),this.moveToHead(t),t.value):null;},LRUCache.prototype.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null;},LRUCache.prototype.has=function(t){return!!this.datas[t];},LRUCache.prototype.delete=function(t){t=this.datas[t];this.remove(t);};var n=new LRUCache(100);cc.textUtils=e.exports={BASELINE_RATIO:.26,MIDDLE_RATIO:.37,BASELINE_OFFSET:0,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,highSurrogateRex:/[\uD800-\uDBFF]/,lowSurrogateRex:/[\uDC00-\uDFFF]/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(t){return this.__CHINESE_REG.test(t)||this.__JAPANESE_REG.test(t)||this.__KOREAN_REG.test(t);},isUnicodeSpace:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t;},safeMeasureText:function(t,e,i){i=(i||t.font)+"\ud83c\udfae"+e;var r=n.get(i);if(null!==r)return r;r=t.measureText(e);t=r&&r.width||0;return n.put(i,t),t;},_safeSubstring:function(t,e,i){var r=e,n=i;var a=t[e];return this.lowSurrogateRex.test(a)&&r--,void 0!==i&&(i-1!==e?(e=t[i-1],this.highSurrogateRex.test(e)&&n--):this.highSurrogateRex.test(a)&&n++),t.substring(r,n);},fragmentText:function(h,t,e,u){var i=[];if(0===h.length||e<0)return i.push(""),i;var r=h;for(;e<t&&1<r.length;){var n=r.length*(e/t)|0;var a=this._safeSubstring(r,n);var o=t-u(a);var s=a;var _=0;var d=0;for(;e<o&&d++<10;)o=t-u(a=this._safeSubstring(r,n=n*(e/o)|0));for(d=0;o<=e&&d++<10;){var f;a&&(_=(f=this.label_wordRex.exec(a))?f[0].length:1,s=a),n+=_,o=t-u(a=this._safeSubstring(r,n));}0===(n-=_)?s=this._safeSubstring(r,n=1):1===n&&this.highSurrogateRex.test(r[0])&&(s=this._safeSubstring(r,n=2));var c,l=this._safeSubstring(r,0,n);this.label_wrapinspection&&this.label_symbolRex.test(s||a)&&(0===(n-=(c=this.label_lastWordRex.exec(l))?c[0].length:0)&&(n=1),s=this._safeSubstring(r,n),l=this._safeSubstring(r,0,n)),this.label_firstEnglish.test(s)&&(c=this.label_lastEnglish.exec(l))&&l!==c[0]&&(n-=c[0].length,s=this._safeSubstring(r,n),l=this._safeSubstring(r,0,n)),(0===i.length||0<(l=l.trimLeft()).length)&&i.push(l),t=u(r=s||a);}return(0===i.length||0<(r=r.trimLeft()).length)&&i.push(r),i;}};},{"../platform/js":209}],272:[function(t,e,i){"use strict";var n=t("../assets/CCTexture2D");cc.textureUtil=e.exports={loadImage:function(t,i,r){cc.assertID(t,3103);var e=cc.loader.getRes(t);return e?e.loaded?i&&i.call(r,null,e):e.once("load",function(){i&&i.call(r,null,e);},r):((e=new n()).url=t,cc.loader.load({url:t,texture:e},function(t,e){if(t)return i&&i.call(r,t||new Error("Unknown error"));e.handleLoadedTexture(),i&&i.call(r,null,e);})),e;},cacheImage:function(t,e){var i;if(t&&e)return(i=new n()).initWithElement(e),cc.loader.flowOut({id:t,url:t,error:null,content:i,complete:!1}),i;},postLoadTexture:function(i,r){!i.loaded&&i.url?cc.loader.load({url:i.url,skips:i._isCompressed()?void 0:["Loader"]},function(t,e){if(e){if(e instanceof cc.Texture2D)return cc.error("internal error: loader handle pipe must be skipped");i.loaded||(i._nativeAsset=e);}r&&r(t);}):r&&r();}};},{"../assets/CCTexture2D":50}],273:[function(t,e,i){"use strict";var r=t("./node-unit");t=t("./node-mem-pool");e.exports={NodeMemPool:new t(r)};},{"./node-mem-pool":275,"./node-unit":276}],274:[function(t,e,i){"use strict";function iLM(t){this._unitClass=t,this._pool=[],this._findOrder=[];}var r=iLM.prototype;r._initNative=function(){this._nativeMemPool=new renderer.MemPool();},r._buildUnit=function(t){return new this._unitClass(t,this);},r._destroyUnit=function(t){this._pool[t]=null;for(var e=0,i=this._findOrder.length;e<i;e++){var r=this._findOrder[e];if(r&&r.unitID==t){this._findOrder.splice(e,1);break;}}},r._findUnitID=function(){var t=0;var e=this._pool;for(;e[t];)t++;return t;},r.pop=function(){var t=null;var e=0;var i=this._findOrder;var r=this._pool;for(var n=i.length;e<n;e++){var a=i[e];if(a&&a.hasSpace()){t=a;break;}}var o;t||(o=this._findUnitID(),t=this._buildUnit(o),r[o]=t,i.push(t),e=i.length-1);r=i[0];return r!==t&&(i[0]=t,i[e]=r),t.pop();},r.push=function(t){var e=this._pool[t.unitID];return e.push(t.index),1<this._findOrder.length&&e.isAllFree()&&this._destroyUnit(t.unitID),e;},e.exports=iLM;},{}],275:[function(t,e,i){"use strict";var r=t("./mem-pool");function NSM(t){r.call(this,t);}function ASM(){}ASM.prototype=r.prototype;t=NSM.prototype=new ASM();t._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool();},t._destroyUnit=function(t){r.prototype._destroyUnit.call(this,t);},e.exports=NSM;},{"./mem-pool":274}],276:[function(t,e,i){"use strict";var a=t("../../value-types/utils");Uint32Array;var o=10*a.FLOAT_BYTES;var s=16*a.FLOAT_BYTES;var c=16*a.FLOAT_BYTES;Uint32Array;Uint32Array;Int32Array;Uint8Array;Uint8Array;Uint32Array;a.FLOAT_BYTES;var l=t("./unit-base");function EKM(t,e){l.call(this,t,e);var i=this._contentNum;this.trsList=new a.FLOAT_ARRAY_TYPE(10*i),this.localMatList=new a.FLOAT_ARRAY_TYPE(16*i),this.worldMatList=new a.FLOAT_ARRAY_TYPE(16*i);for(var r=0;r<i;r++){var n=this._spacesData[r];n.trs=new a.FLOAT_ARRAY_TYPE(this.trsList.buffer,r*o,10),n.localMat=new a.FLOAT_ARRAY_TYPE(this.localMatList.buffer,r*s,16),n.worldMat=new a.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,r*c,16);}}function qKM(){}qKM.prototype=l.prototype,EKM.prototype=new qKM(),e.exports=EKM;},{"../../value-types/utils":286,"./unit-base":277}],277:[function(t,e,i){"use strict";function wKM(t,e,i){i=i||128,this.unitID=t,this._memPool=e,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=i,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[];for(var r=0;r<i;r++){var n=2*r;this._signData[0+n]=r+1,this._signData[1+n]=0,this._spacesData[r]={index:r,unitID:t};}this._signData[2*(i-1)]=65535;}var r=wKM.prototype;r.hasSpace=function(){return 65535!==this._data[0];},r.isAllFree=function(){return 0==this._data[1];},r.pop=function(){var t=this._data[0];if(65535===t)return null;var e=2*t;t=this._spacesData[t];return this._signData[1+e]=1,this._data[0]=this._signData[0+e],this._data[1]++,t;},r.push=function(t){var e=2*t;this._signData[1+e]=0,this._signData[0+e]=this._data[0],this._data[0]=t,this._data[1]--;},r.dump=function(){var t=0;var e=this._data[0];var i="";for(;65535!=e;)t++,i+=e+"->",e=this._signData[2*e+0];var r=0;var n="";var a=this._contentNum;for(var o=0;o<a;o++)1==this._signData[2*o+1]&&(r++,n+=o+"->");var s=t+r;console.log("unitID:",this.unitID,"spaceNum:",t,"calc using num:",r,"store using num:",this._data[1],"calc total num:",s,"actually total num:",this._contentNum),console.log("free info:",i),console.log("using info:",n),r!=this._data[1]&&cc.error("using num error","calc using num:",r,"store using num:",this._data[1]),t+r!=this._contentNum&&cc.error("total num error","calc total num:",s,"actually total num:",this._contentNum);},e.exports=wKM;},{}],278:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("./value-type"));var o=_interopRequireDefault(t("../platform/CCClass"));var n=_interopRequireDefault(t("../utils/misc"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t;}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var a=function(a){var t;t=a,(e=Color).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(Color);function Color(t,e,i,r){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=255),(n=a.call(this)||this)._val=0,"object"==typeof t&&(e=t.g,i=t.b,r=t.a,t=t.r),n._val=(r<<24>>>0)+(i<<16)+(e<<8)+t,n;}Color.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t;},Color.clone=function(t){return new Color(t.r,t.g,t.b,t.a);},Color.set=function(t,e,i,r,n){return void 0===i&&(i=255),void 0===r&&(r=255),void 0===n&&(n=255),t.r=e=void 0===e?255:e,t.g=i,t.b=r,t.a=n,t;},Color.fromHex=function(t,e){var i=(e>>16&255)/255;var r=(e>>8&255)/255;var n=(255&e)/255;return t.r=(e>>24)/255,t.g=i,t.b=r,t.a=n,t;},Color.add=function(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t;},Color.subtract=function(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t;},Color.multiply=function(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t;},Color.divide=function(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t;},Color.scale=function(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t;},Color.lerp=function(t,e,i,r){var n=e.r,a=e.g,o=e.b,e=e.a;return t.r=n+r*(i.r-n),t.g=a+r*(i.g-a),t.b=o+r*(i.b-o),t.a=e+r*(i.a-e),t;},Color.toArray=function(t,e,i){var r=e instanceof Color||1<e.a?1/255:1;return t[(i=void 0===i?0:i)+0]=e.r*r,t[i+1]=e.g*r,t[i+2]=e.b*r,t[i+3]=e.a*r,t;},Color.fromArray=function(t,e,i){return e.r=255*t[(i=void 0===i?0:i)+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e;},_createClass(Color,null,[{key:"WHITE",get:function(){return new Color(255,255,255,255);}},{key:"BLACK",get:function(){return new Color(0,0,0,255);}},{key:"TRANSPARENT",get:function(){return new Color(0,0,0,0);}},{key:"GRAY",get:function(){return new Color(127.5,127.5,127.5);}},{key:"RED",get:function(){return new Color(255,0,0);}},{key:"GREEN",get:function(){return new Color(0,255,0);}},{key:"BLUE",get:function(){return new Color(0,0,255);}},{key:"YELLOW",get:function(){return new Color(255,235,4);}},{key:"ORANGE",get:function(){return new Color(255,127,0);}},{key:"CYAN",get:function(){return new Color(0,255,255);}},{key:"MAGENTA",get:function(){return new Color(255,0,255);}}]);var e=Color.prototype;return e.clone=function(){var t=new Color();return t._val=this._val,t;},e.equals=function(t){return t&&this._val===t._val;},e.lerp=function(t,e,i){i=i||new Color();var r=this.r;var n=this.g;var a=this.b;var o=this.a;return i.r=r+(t.r-r)*e,i.g=n+(t.g-n)*e,i.b=a+(t.b-a)*e,i.a=o+(t.a-o)*e,i;},e.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")";},e.getR=function(){return 255&this._val;},e.setR=function(t){return t=~~n.default.clampf(t,0,255),this._val=(4294967040&this._val|t)>>>0,this;},e.getG=function(){return(65280&this._val)>>8;},e.setG=function(t){return t=~~n.default.clampf(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0,this;},e.getB=function(){return(16711680&this._val)>>16;},e.setB=function(t){return t=~~n.default.clampf(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0,this;},e.getA=function(){return(4278190080&this._val)>>>24;},e.setA=function(t){return t=~~n.default.clampf(t,0,255),this._val=(16777215&this._val|t<<24)>>>0,this;},e.toCSS=function(t){return t&&"rgba"!==t?"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t):"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")";},e.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0;var i=parseInt(t.substr(2,2),16)||0;var r=parseInt(t.substr(4,2),16)||0;t=parseInt(t.substr(6,2),16)||255;return this._val=(t<<24>>>0)+(r<<16)+(i<<8)+e,this;},e.toHEX=function(t){var e=[(this.r<16?"0":"")+(0|this.r).toString(16),(this.g<16?"0":"")+(0|this.g).toString(16),(this.b<16?"0":"")+(0|this.b).toString(16)];var i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)1<e[i].length&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);else"#rrggbbaa"===t&&e.push((this.a<16?"0":"")+(0|this.a).toString(16));return e.join("");},e.toRGBValue=function(){return 16777215&this._val;},e.fromHSV=function(t,e,i){var r,n,a;if(0===e)r=n=a=i;else if(0===i)r=n=a=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t);t=t-o;var s=i*(1-e);var c=i*(1-e*t);var l=i*(1-e*(1-t));switch(o){case 0:r=i,n=l,a=s;break;case 1:r=c,n=i,a=s;break;case 2:r=s,n=i,a=l;break;case 3:r=s,n=c,a=i;break;case 4:r=l,n=s,a=i;break;case 5:r=i,n=s,a=c;}}return this._val=(this.a<<24>>>0)+((a*=255)<<16)+((n*=255)<<8)+(r*=255),this;},e.toHSV=function(){var t=this.r/255;var e=this.g/255;var i=this.b/255;var r={h:0,s:0,v:0};var n=Math.max(t,e,i);var a=Math.min(t,e,i);return r.v=n,r.s=n?(n-a)/n:0,r.s?(a=n-a,r.h=t===n?(e-i)/a:e===n?2+(i-t)/a:4+(t-e)/a,r.h/=6,r.h<0&&(r.h+=1)):r.h=0,r;},e.set=function(t){return t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a),this;},e._fastSetA=function(t){this._val=(16777215&this._val|t<<24)>>>0;},e.multiply=function(t){var e=(255&this._val)*t.r>>8;var i=(65280&this._val)*t.g>>8;var r=(16711680&this._val)*t.b>>8;t=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&t|16711680&r|65280&i|255&e,this;},_createClass(Color,[{key:"r",get:function(){return this.getR();},set:function(t){this.setR(t);}},{key:"g",get:function(){return this.getG();},set:function(t){this.setG(t);}},{key:"b",get:function(){return this.getB();},set:function(t){this.setB(t);}},{key:"a",get:function(){return this.getA();},set:function(t){this.setA(t);}}]),Color;}(r.default);(i.default=a).div=a.divide,a.sub=a.subtract,a.mul=a.multiply,a.WHITE_R=a.WHITE,a.BLACK_R=a.BLACK,a.TRANSPARENT_R=a.TRANSPARENT,a.GRAY_R=a.GRAY,a.RED_R=a.RED,a.GREEN_R=a.GREEN,a.BLUE_R=a.BLUE,a.YELLOW_R=a.YELLOW,a.ORANGE_R=a.ORANGE,a.CYAN_R=a.CYAN,a.MAGENTA_R=a.MAGENTA,o.default.fastDefine("cc.Color",a,{r:0,g:0,b:0,a:255}),cc.Color=a,cc.color=function(t,e,i,r){return"string"!=typeof t?"object"==typeof t?new a(t.r,t.g,t.b,t.a):new a(t,e,i,r):new a().fromHEX(t);},e.exports=i.default;},{"../platform/CCClass":189,"../utils/misc":264,"./value-type":287}],279:[function(t,e,i){"use strict";var r={Vec2:i.__esModule=!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0};i.Trs=i.Quat=i.Color=i.Size=i.Rect=i.Mat3=i.Mat4=i.Vec4=i.Vec3=i.Vec2=void 0;var n=_interopRequireDefault(t("./vec2"));i.Vec2=n.default;n=_interopRequireDefault(t("./vec3"));i.Vec3=n.default;n=_interopRequireDefault(t("./vec4"));i.Vec4=n.default;n=_interopRequireDefault(t("./mat4"));i.Mat4=n.default;n=_interopRequireDefault(t("./mat3"));i.Mat3=n.default;n=_interopRequireDefault(t("./rect"));i.Rect=n.default;n=_interopRequireDefault(t("./size"));i.Size=n.default;n=_interopRequireDefault(t("./color"));i.Color=n.default;n=_interopRequireDefault(t("./quat"));i.Quat=n.default;n=_interopRequireDefault(t("./trs"));i.Trs=n.default;var a=t("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(r,t)||(i[t]=a[t]));}),cc.math=e.exports;},{"./color":278,"./mat3":280,"./mat4":281,"./quat":282,"./rect":283,"./size":284,"./trs":285,"./utils":286,"./vec2":288,"./vec3":289,"./vec4":290}],280:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var y=t("../value-types/utils");var o=(t=t("./vec3"))&&t.__esModule?t:{default:t};Mat3.create=function(t,e,i,r,n,a,o,s,c){return new Mat3(t=void 0===t?1:t,e=void 0===e?0:e,i=void 0===i?0:i,r=void 0===r?0:r,n=void 0===n?1:n,a=void 0===a?0:a,o=void 0===o?0:o,s=void 0===s?0:s,c=void 0===c?1:c);},Mat3.clone=function(t){t=t.m;return new Mat3(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]);},Mat3.copy=function(t,e){return t.m.set(e.m),t;},Mat3.set=function(t,e,i,r,n,a,o,s,c,h){var l=t.m;return l[0]=e,l[1]=i,l[2]=r,l[3]=n,l[4]=a,l[5]=o,l[6]=s,l[7]=c,l[8]=h,t;},Mat3.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,t;},Mat3.transpose=function(t,e){var i=e.m,r=t.m;var n,a;return t===e?(e=i[1],n=i[2],a=i[5],r[1]=i[3],r[2]=i[6],r[3]=e,r[5]=i[7],r[6]=n,r[7]=a):(r[0]=i[0],r[1]=i[3],r[2]=i[6],r[3]=i[1],r[4]=i[4],r[5]=i[7],r[6]=i[2],r[7]=i[5],r[8]=i[8]),t;},Mat3.invert=function(h,t){var t=t.m,e=h.m;var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],c=t[6],u=t[7],t=t[8];var _=t*o-s*u;var d=-t*a+s*c;var f=u*a-o*c;var l=i*_+r*d+n*f;return l&&(e[0]=_*(l=1/l),e[1]=(-t*r+n*u)*l,e[2]=(s*r-n*o)*l,e[3]=d*l,e[4]=(t*i-n*c)*l,e[5]=(-s*i+n*a)*l,e[6]=f*l,e[7]=(-u*i+r*c)*l,e[8]=(o*i-r*a)*l),h;},Mat3.adjoint=function(h,t){var t=t.m,e=h.m;var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],t=t[8];return e[0]=o*t-s*l,e[1]=n*l-r*t,e[2]=r*s-n*o,e[3]=s*c-a*t,e[4]=i*t-n*c,e[5]=n*a-i*s,e[6]=a*l-o*c,e[7]=r*c-i*l,e[8]=i*o-r*a,h;},Mat3.determinant=function(t){t=t.m;var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],s=t[6],c=t[7],t=t[8];return e*(t*a-o*c)+i*(-t*n+o*s)+r*(c*n-a*s);},Mat3.multiply=function(h,t,e){var t=t.m,e=e.m,i=h.m;var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],t=t[8];var _=e[0],d=e[1],f=e[2];var p=e[3],m=e[4],v=e[5];var y=e[6],g=e[7],e=e[8];return i[0]=_*r+d*o+f*l,i[1]=_*n+d*s+f*u,i[2]=_*a+d*c+f*t,i[3]=p*r+m*o+v*l,i[4]=p*n+m*s+v*u,i[5]=p*a+m*c+v*t,i[6]=y*r+g*o+e*l,i[7]=y*n+g*s+e*u,i[8]=y*a+g*c+e*t,h;},Mat3.multiplyMat4=function(h,t,e){var t=t.m,e=e.m,i=h.m;var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],t=t[8];var _=e[0],d=e[1],f=e[2];var p=e[4],m=e[5],v=e[6];var y=e[8],g=e[9],e=e[10];return i[0]=_*r+d*o+f*l,i[1]=_*n+d*s+f*u,i[2]=_*a+d*c+f*t,i[3]=p*r+m*o+v*l,i[4]=p*n+m*s+v*u,i[5]=p*a+m*c+v*t,i[6]=y*r+g*o+e*l,i[7]=y*n+g*s+e*u,i[8]=y*a+g*c+e*t,h;},Mat3.translate=function(t,e,i){var e=e.m,r=t.m;var n=e[0],a=e[1],o=e[2],s=e[3],c=e[4],h=e[5],u=e[6],_=e[7],e=e[8];var l=i.x,i=i.y;return r[0]=n,r[1]=a,r[2]=o,r[3]=s,r[4]=c,r[5]=h,r[6]=l*n+i*s+u,r[7]=l*a+i*c+_,r[8]=l*o+i*h+e,t;},Mat3.rotate=function(t,e,i){var e=e.m,r=t.m;var n=e[0],a=e[1],o=e[2],s=e[3],c=e[4],h=e[5],u=e[6],_=e[7],e=e[8];var l=Math.sin(i);i=Math.cos(i);return r[0]=i*n+l*s,r[1]=i*a+l*c,r[2]=i*o+l*h,r[3]=i*s-l*n,r[4]=i*c-l*a,r[5]=i*h-l*o,r[6]=u,r[7]=_,r[8]=e,t;},Mat3.scale=function(t,e,i){var r=i.x,i=i.y;var e=e.m,n=t.m;return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],t;},Mat3.fromMat4=function(t,e){var e=e.m,i=t.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t;},Mat3.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=e.x,i[7]=e.y,i[8]=1,t;},Mat3.fromRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e);var r=t.m;return r[0]=e,r[1]=i,r[2]=0,r[3]=-i,r[4]=e,r[5]=0,r[6]=0,r[7]=0,r[8]=1,t;},Mat3.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=e.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1,t;},Mat3.fromQuat=function(t,e){var i=t.m;var r=e.x,n=e.y,a=e.z,e=e.w;var o=r+r;var s=n+n;var c=a+a;r*=o;var l=n*o;n*=s;var h=a*o;var u=a*s;a*=c;o*=e;s*=e;e*=c;return i[0]=1-n-a,i[3]=l-e,i[6]=h+s,i[1]=l+e,i[4]=1-r-a,i[7]=u-o,i[2]=h-s,i[5]=u+o,i[8]=1-r-n,t;},Mat3.fromViewUp=function(t,e,i){var r,n,a;r=new o.default(0,1,0),n=new o.default(),a=new o.default();return o.default.lengthSqr(e)<y.EPSILON*y.EPSILON?(Mat3.identity(t),t):(o.default.normalize(n,o.default.cross(n,i=i||r,e)),o.default.lengthSqr(n)<y.EPSILON*y.EPSILON?Mat3.identity(t):(o.default.cross(a,e,n),Mat3.set(t,n.x,n.y,n.z,a.x,a.y,a.z,e.x,e.y,e.z)),t);},Mat3.normalFromMat4=function(h,t){var t=t.m,e=h.m;var i=t[0],r=t[1],u=t[2],n=t[3],_=t[4],d=t[5],f=t[6],a=t[7],o=t[8],s=t[9],c=t[10],l=t[11],p=t[12],m=t[13],v=t[14],t=t[15];var y=i*d-r*_;var g=i*f-u*_;var b=i*a-n*_;var C=r*f-u*d;var x=r*a-n*d;var A=u*a-n*f;var S=o*m-s*p;var T=o*v-c*p;o=o*t-l*p;var w=s*v-c*m;s=s*t-l*m;c=c*t-l*v;l=y*c-g*s+b*w+C*o-x*T+A*S;return l&&(e[0]=(d*c-f*s+a*w)*(l=1/l),e[1]=(f*o-_*c-a*T)*l,e[2]=(_*s-d*o+a*S)*l,e[3]=(u*s-r*c-n*w)*l,e[4]=(i*c-u*o+n*T)*l,e[5]=(r*o-i*s-n*S)*l,e[6]=(m*A-v*x+t*C)*l,e[7]=(v*b-p*A-t*g)*l,e[8]=(p*x-m*b+t*y)*l),h;},Mat3.frob=function(t){t=t.m;return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2));},Mat3.add=function(t,e,i){var e=e.m,i=i.m,r=t.m;return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r[6]=e[6]+i[6],r[7]=e[7]+i[7],r[8]=e[8]+i[8],t;},Mat3.subtract=function(t,e,i){var e=e.m,i=i.m,r=t.m;return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r[4]=e[4]-i[4],r[5]=e[5]-i[5],r[6]=e[6]-i[6],r[7]=e[7]-i[7],r[8]=e[8]-i[8],t;},Mat3.multiplyScalar=function(t,e,i){var e=e.m,r=t.m;return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*i,t;},Mat3.multiplyScalarAndAdd=function(t,e,i,r){var e=e.m,i=i.m,n=t.m;return n[0]=e[0]+i[0]*r,n[1]=e[1]+i[1]*r,n[2]=e[2]+i[2]*r,n[3]=e[3]+i[3]*r,n[4]=e[4]+i[4]*r,n[5]=e[5]+i[5]*r,n[6]=e[6]+i[6]*r,n[7]=e[7]+i[7]*r,n[8]=e[8]+i[8]*r,t;},Mat3.exactEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8];},Mat3.equals=function(t,e){t=t.m,e=e.m;var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],t=t[8];var h=e[0],u=e[1],_=e[2],d=e[3],f=e[4],p=e[5],m=e[6],v=e[7],e=e[8];return Math.abs(i-h)<=y.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-u)<=y.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-_)<=y.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-d)<=y.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-f)<=y.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-p)<=y.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-m)<=y.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(l-v)<=y.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(t-e)<=y.EPSILON*Math.max(1,Math.abs(t),Math.abs(e));},Mat3.toArray=function(t,e,i){void 0===i&&(i=0);var r=e.m;for(var n=0;n<9;n++)t[i+n]=r[n];return t;},Mat3.fromArray=function(t,e,i){void 0===i&&(i=0);var r=t.m;for(var n=0;n<9;n++)r[n]=e[i+n];return t;},Mat3.prototype.toString=function(){var t=this.m;return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")";};t=Mat3;function Mat3(t,e,i,r,n,a,o,s,c){var l;void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=1),this.m=void 0,t instanceof y.FLOAT_ARRAY_TYPE?this.m=t:(this.m=new y.FLOAT_ARRAY_TYPE(9),(l=this.m)[0]=t,l[1]=e,l[2]=i,l[3]=r,l[4]=n,l[5]=a,l[6]=o,l[7]=s,l[8]=c);}(i.default=t).sub=t.subtract,t.mul=t.multiply,t.IDENTITY=Object.freeze(new t()),cc.Mat3=t,e.exports=i.default;},{"../value-types/utils":286,"./vec3":289}],281:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("./value-type"));var n=_interopRequireDefault(t("../platform/CCClass"));var a=_interopRequireDefault(t("./vec3"));var o=_interopRequireDefault(t("./quat"));var E=t("./utils");var u=_interopRequireDefault(t("./mat3"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var m=0;var v=0;var g=0;var b=0;var C=0;var x=0;var A=0;var S=0;var T=0;var w=0;var P=0;var M=0;var p=0;var R=0;var I=0;var B=0;var y=function(y){var t;t=y,(e=Mat4).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(Mat4);var e=Mat4.prototype;function Mat4(t,e,i,r,n,a,o,s,h,u,_,d,f,p,m,v){var c;var l;return void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===_&&(_=1),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===m&&(m=0),void 0===v&&(v=1),(c=y.call(this)||this).m=void 0,t instanceof E.FLOAT_ARRAY_TYPE?c.m=t:(c.m=new E.FLOAT_ARRAY_TYPE(16),(l=c.m)[0]=t,l[1]=e,l[2]=i,l[3]=r,l[4]=n,l[5]=a,l[6]=o,l[7]=s,l[8]=h,l[9]=u,l[10]=_,l[11]=d,l[12]=f,l[13]=p,l[14]=m,l[15]=v),c;}return e.mul=function(t,e){return Mat4.multiply(e||new Mat4(),this,t);},e.mulScalar=function(t,e){Mat4.multiplyScalar(e||new Mat4(),this,t);},e.sub=function(t,e){Mat4.subtract(e||new Mat4(),this,t);},Mat4.clone=function(t){t=t.m;return new Mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);},Mat4.copy=function(t,e){var i=t.m,e=e.m;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],t;},Mat4.set=function(t,e,i,r,n,a,o,s,c,h,u,_,d,f,p,m,v){var l=t.m;return l[0]=e,l[1]=i,l[2]=r,l[3]=n,l[4]=a,l[5]=o,l[6]=s,l[7]=c,l[8]=h,l[9]=u,l[10]=_,l[11]=d,l[12]=f,l[13]=p,l[14]=m,l[15]=v,t;},Mat4.identity=function(t){var e=t.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t;},Mat4.transpose=function(t,e){var i=t.m,r=e.m;var n,a,o,s,c;return t===e?(e=r[1],n=r[2],a=r[3],o=r[6],s=r[7],c=r[11],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=e,i[6]=r[9],i[7]=r[13],i[8]=n,i[9]=o,i[11]=r[14],i[12]=a,i[13]=s,i[14]=c):(i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15]),t;},Mat4.invert=function(h,t){t=t.m;m=t[0],v=t[1],g=t[2],b=t[3],C=t[4],x=t[5],A=t[6],S=t[7],T=t[8],w=t[9],P=t[10],M=t[11],p=t[12],R=t[13],I=t[14],B=t[15];t=m*x-v*C;var e=m*A-g*C;var i=m*S-b*C;var r=v*A-g*x;var n=v*S-b*x;var a=g*S-b*A;var o=T*R-w*p;var s=T*I-P*p;var u=T*B-M*p;var _=w*I-P*R;var d=w*B-M*R;var f=P*B-M*I;var c=t*f-e*d+i*_+r*u-n*s+a*o;if(0==c)return null;var l=h.m;return l[0]=(x*f-A*d+S*_)*(c=1/c),l[1]=(g*d-v*f-b*_)*c,l[2]=(R*a-I*n+B*r)*c,l[3]=(P*n-w*a-M*r)*c,l[4]=(A*u-C*f-S*s)*c,l[5]=(m*f-g*u+b*s)*c,l[6]=(I*i-p*a-B*e)*c,l[7]=(T*a-P*i+M*e)*c,l[8]=(C*d-x*u+S*o)*c,l[9]=(v*u-m*d-b*o)*c,l[10]=(p*n-R*i+B*t)*c,l[11]=(w*i-T*n-M*t)*c,l[12]=(x*s-C*_-A*o)*c,l[13]=(m*_-v*s+g*o)*c,l[14]=(R*e-p*r-I*t)*c,l[15]=(T*r-w*e+P*t)*c,h;},Mat4.determinant=function(t){t=t.m;return m=t[0],v=t[1],g=t[2],b=t[3],C=t[4],x=t[5],A=t[6],S=t[7],T=t[8],w=t[9],P=t[10],M=t[11],p=t[12],R=t[13],I=t[14],B=t[15],(m*x-v*C)*(P*B-M*I)-(m*A-g*C)*(w*B-M*R)+(m*S-b*C)*(w*I-P*R)+(v*A-g*x)*(T*B-M*p)-(v*S-b*x)*(T*I-P*p)+(g*S-b*A)*(T*R-w*p);},Mat4.multiply=function(t,e,i){var r=t.m,e=e.m,i=i.m;m=e[0],v=e[1],g=e[2],b=e[3],C=e[4],x=e[5],A=e[6],S=e[7],T=e[8],w=e[9],P=e[10],M=e[11],p=e[12],R=e[13],I=e[14],B=e[15];var e=i[0],n=i[1],a=i[2],o=i[3];return r[0]=e*m+n*C+a*T+o*p,r[1]=e*v+n*x+a*w+o*R,r[2]=e*g+n*A+a*P+o*I,r[3]=e*b+n*S+a*M+o*B,e=i[4],n=i[5],a=i[6],o=i[7],r[4]=e*m+n*C+a*T+o*p,r[5]=e*v+n*x+a*w+o*R,r[6]=e*g+n*A+a*P+o*I,r[7]=e*b+n*S+a*M+o*B,e=i[8],n=i[9],a=i[10],o=i[11],r[8]=e*m+n*C+a*T+o*p,r[9]=e*v+n*x+a*w+o*R,r[10]=e*g+n*A+a*P+o*I,r[11]=e*b+n*S+a*M+o*B,e=i[12],n=i[13],a=i[14],o=i[15],r[12]=e*m+n*C+a*T+o*p,r[13]=e*v+n*x+a*w+o*R,r[14]=e*g+n*A+a*P+o*I,r[15]=e*b+n*S+a*M+o*B,t;},Mat4.transform=function(t,e,i){var r=i.x,n=i.y,i=i.z;var a=t.m,o=e.m;return e===t?(a[12]=o[0]*r+o[4]*n+o[8]*i+o[12],a[13]=o[1]*r+o[5]*n+o[9]*i+o[13],a[14]=o[2]*r+o[6]*n+o[10]*i+o[14],a[15]=o[3]*r+o[7]*n+o[11]*i+o[15]):(m=o[0],v=o[1],g=o[2],b=o[3],C=o[4],x=o[5],A=o[6],S=o[7],T=o[8],w=o[9],P=o[10],M=o[11],p=o[12],R=o[13],I=o[14],B=o[15],a[0]=m,a[1]=v,a[2]=g,a[3]=b,a[4]=C,a[5]=x,a[6]=A,a[7]=S,a[8]=T,a[9]=w,a[10]=P,a[11]=M,a[12]=m*r+C*n+T*i+o[12],a[13]=v*r+x*n+w*i+o[13],a[14]=g*r+A*n+P*i+o[14],a[15]=b*r+S*n+M*i+o[15]),t;},Mat4.translate=function(t,e,i){var r=t.m,n=e.m;return e===t?(r[12]+=i.x,r[13]+=i.y,r[14]+=i.z):(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]+=i.x,r[13]+=i.y,r[14]+=i.z,r[15]=n[15]),t;},Mat4.scale=function(t,e,i){var r=i.x,n=i.y,i=i.z;var a=t.m,e=e.m;return a[0]=e[0]*r,a[1]=e[1]*r,a[2]=e[2]*r,a[3]=e[3]*r,a[4]=e[4]*n,a[5]=e[5]*n,a[6]=e[6]*n,a[7]=e[7]*n,a[8]=e[8]*i,a[9]=e[9]*i,a[10]=e[10]*i,a[11]=e[11]*i,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],t;},Mat4.rotate=function(h,u,t,e){var i=e.x,r=e.y,e=e.z;var n=Math.sqrt(i*i+r*r+e*e);if(Math.abs(n)<E.EPSILON)return null;i*=n=1/n,r*=n,e*=n;n=Math.sin(t);t=Math.cos(t);var a=1-t;var o=u.m;m=o[0],v=o[1],g=o[2],b=o[3],C=o[4],x=o[5],A=o[6],S=o[7],T=o[8],w=o[9],P=o[10],M=o[11];var s=i*i*a+t,c=r*i*a+e*n,l=e*i*a-r*n;var _=i*r*a-e*n,d=r*r*a+t,f=e*r*a+i*n;var p=i*e*a+r*n,r=r*e*a-i*n,i=e*e*a+t;n=h.m;return n[0]=m*s+C*c+T*l,n[1]=v*s+x*c+w*l,n[2]=g*s+A*c+P*l,n[3]=b*s+S*c+M*l,n[4]=m*_+C*d+T*f,n[5]=v*_+x*d+w*f,n[6]=g*_+A*d+P*f,n[7]=b*_+S*d+M*f,n[8]=m*p+C*r+T*i,n[9]=v*p+x*r+w*i,n[10]=g*p+A*r+P*i,n[11]=b*p+S*r+M*i,u!==h&&(n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),h;},Mat4.rotateX=function(t,e,i){var r=t.m,n=e.m;var a=Math.sin(i),i=Math.cos(i),o=n[4],s=n[5],c=n[6],l=n[7],h=n[8],u=n[9],_=n[10],d=n[11];return e!==t&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[4]=o*i+h*a,r[5]=s*i+u*a,r[6]=c*i+_*a,r[7]=l*i+d*a,r[8]=h*i-o*a,r[9]=u*i-s*a,r[10]=_*i-c*a,r[11]=d*i-l*a,t;},Mat4.rotateY=function(t,e,i){var r=t.m,n=e.m;var a=Math.sin(i),i=Math.cos(i),o=n[0],s=n[1],c=n[2],l=n[3],h=n[8],u=n[9],_=n[10],d=n[11];return e!==t&&(r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=o*i-h*a,r[1]=s*i-u*a,r[2]=c*i-_*a,r[3]=l*i-d*a,r[8]=o*a+h*i,r[9]=s*a+u*i,r[10]=c*a+_*i,r[11]=l*a+d*i,t;},Mat4.rotateZ=function(t,e,i){var r=e.m;var n=t.m;var a=Math.sin(i),i=Math.cos(i),o=e.m[0],s=e.m[1],c=e.m[2],l=e.m[3],h=e.m[4],u=e.m[5],_=e.m[6],d=e.m[7];return e!==t&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=o*i+h*a,n[1]=s*i+u*a,n[2]=c*i+_*a,n[3]=l*i+d*a,n[4]=h*i-o*a,n[5]=u*i-s*a,n[6]=_*i-c*a,n[7]=d*i-l*a,t;},Mat4.fromTranslation=function(t,e){var i=t.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,t;},Mat4.fromScaling=function(t,e){var i=t.m;return i[0]=e.x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e.y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e.z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,t;},Mat4.fromRotation=function(t,e,i){var r=i.x,n=i.y,i=i.z;var a=Math.sqrt(r*r+n*n+i*i);if(Math.abs(a)<E.EPSILON)return null;r*=a=1/a,n*=a,i*=a;a=Math.sin(e);e=Math.cos(e);var o=1-e;var s=t.m;return s[0]=r*r*o+e,s[1]=n*r*o+i*a,s[2]=i*r*o-n*a,s[3]=0,s[4]=r*n*o-i*a,s[5]=n*n*o+e,s[6]=i*n*o+r*a,s[7]=0,s[8]=r*i*o+n*a,s[9]=n*i*o-r*a,s[10]=i*i*o+e,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,t;},Mat4.fromXRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e);var r=t.m;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=i,r[7]=0,r[8]=0,r[9]=-i,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,t;},Mat4.fromYRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e);var r=t.m;return r[0]=e,r[1]=0,r[2]=-i,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=i,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,t;},Mat4.fromZRotation=function(t,e){var i=Math.sin(e),e=Math.cos(e);var r=t.m;return r[0]=e,r[1]=i,r[2]=0,r[3]=0,r[4]=-i,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,t;},Mat4.fromRT=function(t,e,i){var r=e.x,n=e.y,a=e.z,e=e.w;var o=r+r;var s=n+n;var c=a+a;var l=r*o;var h=r*s;r*=c;var u=n*s;n*=c;a*=c;o*=e;s*=e;e*=c;c=t.m;return c[0]=1-(u+a),c[1]=h+e,c[2]=r-s,c[3]=0,c[4]=h-e,c[5]=1-(l+a),c[6]=n+o,c[7]=0,c[8]=r+s,c[9]=n-o,c[10]=1-(l+u),c[11]=0,c[12]=i.x,c[13]=i.y,c[14]=i.z,c[15]=1,t;},Mat4.getTranslation=function(t,e){e=e.m;return t.x=e[12],t.y=e[13],t.z=e[14],t;},Mat4.getScaling=function(t,e){e=e.m;var i=_.m;var r=i[0]=e[0];var n=i[1]=e[1];var a=i[2]=e[2];var o=i[3]=e[4];var s=i[4]=e[5];var c=i[5]=e[6];var l=i[6]=e[8];var h=i[7]=e[9];i=i[8]=e[10];return t.x=Math.sqrt(r*r+n*n+a*a),t.y=Math.sqrt(o*o+s*s+c*c),t.z=Math.sqrt(l*l+h*h+i*i),u.default.determinant(_)<0&&(t.x*=-1),t;},Mat4.getRotation=function(t,e){e=e.m;var i=e[0]+e[5]+e[10];var r=0;return 0<i?(r=2*Math.sqrt(i+1),t.w=.25*r,t.x=(e[6]-e[9])/r,t.y=(e[8]-e[2])/r,t.z=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t.w=(e[6]-e[9])/r,t.x=.25*r,t.y=(e[1]+e[4])/r,t.z=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t.w=(e[8]-e[2])/r,t.x=(e[1]+e[4])/r,t.y=.25*r,t.z=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t.w=(e[1]-e[4])/r,t.x=(e[8]+e[2])/r,t.y=(e[6]+e[9])/r,t.z=.25*r),t;},Mat4.toRTS=function(t,e,i,r){t=t.m;var n=_.m;r.x=a.default.set(s,t[0],t[1],t[2]).mag(),n[0]=t[0]/r.x,n[1]=t[1]/r.x,n[2]=t[2]/r.x,r.y=a.default.set(s,t[4],t[5],t[6]).mag(),n[3]=t[4]/r.y,n[4]=t[5]/r.y,n[5]=t[6]/r.y,r.z=a.default.set(s,t[8],t[9],t[10]).mag(),n[6]=t[8]/r.z,n[7]=t[9]/r.z,n[8]=t[10]/r.z,u.default.determinant(_)<0&&(r.x*=-1,n[0]*=-1,n[1]*=-1,n[2]*=-1),o.default.fromMat3(e,_),a.default.set(i,t[12],t[13],t[14]);},Mat4.fromRTS=function(h,t,e,i){var r=t.x,n=t.y,a=t.z,t=t.w;var o=r+r;var s=n+n;var c=a+a;var u=r*o;var _=r*s;r*=c;var d=n*s;n*=c;a*=c;o*=t;s*=t;t*=c;c=i.x;var f=i.y;i=i.z;var l=h.m;return l[0]=(1-(d+a))*c,l[1]=(_+t)*c,l[2]=(r-s)*c,l[3]=0,l[4]=(_-t)*f,l[5]=(1-(u+a))*f,l[6]=(n+o)*f,l[7]=0,l[8]=(r+s)*i,l[9]=(n-o)*i,l[10]=(1-(u+d))*i,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,h;},Mat4.fromRTSOrigin=function(h,t,u,e,i){var r=t.x,n=t.y,a=t.z,t=t.w;var o=r+r;var s=n+n;var c=a+a;var _=r*o;var d=r*s;r*=c;var f=n*s;n*=c;a*=c;o*=t;s*=t;t*=c;c=e.x;var p=e.y;e=e.z;var m=i.x;var v=i.y;i=i.z;var l=h.m;return l[0]=(1-(f+a))*c,l[1]=(d+t)*c,l[2]=(r-s)*c,l[3]=0,l[4]=(d-t)*p,l[5]=(1-(_+a))*p,l[6]=(n+o)*p,l[7]=0,l[8]=(r+s)*e,l[9]=(n-o)*e,l[10]=(1-(_+f))*e,l[11]=0,l[12]=u.x+m-(l[0]*m+l[4]*v+l[8]*i),l[13]=u.y+v-(l[1]*m+l[5]*v+l[9]*i),l[14]=u.z+i-(l[2]*m+l[6]*v+l[10]*i),l[15]=1,h;},Mat4.fromQuat=function(t,e){var i=e.x,r=e.y,n=e.z,e=e.w;var a=i+i;var o=r+r;var s=n+n;i*=a;var c=r*a;r*=o;var l=n*a;var h=n*o;n*=s;a*=e;o*=e;e*=s;s=t.m;return s[0]=1-r-n,s[1]=c+e,s[2]=l-o,s[3]=0,s[4]=c-e,s[5]=1-i-n,s[6]=h+a,s[7]=0,s[8]=l+o,s[9]=h-a,s[10]=1-i-r,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,t;},Mat4.frustum=function(t,e,i,r,n,a,o){var s=1/(i-e);var c=1/(n-r);var h=1/(a-o);var l=t.m;return l[0]=2*a*s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=2*a*c,l[6]=0,l[7]=0,l[8]=(i+e)*s,l[9]=(n+r)*c,l[10]=(o+a)*h,l[11]=-1,l[12]=0,l[13]=0,l[14]=o*a*2*h,l[15]=0,t;},Mat4.perspective=function(t,e,i,r,n){e=1/Math.tan(e/2);var a=1/(r-n);var o=t.m;return o[0]=e/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(n+r)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=2*n*r*a,o[15]=0,t;},Mat4.ortho=function(t,e,i,r,n,a,o){var s=1/(e-i);var c=1/(r-n);var h=1/(a-o);var l=t.m;return l[0]=-2*s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*c,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*h,l[11]=0,l[12]=(e+i)*s,l[13]=(n+r)*c,l[14]=(o+a)*h,l[15]=1,t;},Mat4.lookAt=function(h,t,e,i){var u=t.x;var _=t.y;t=t.z;var r=i.x;var n=i.y;i=i.z;var a=u-e.x;var o=_-e.y;e=t-e.z;var s=1/Math.sqrt(a*a+o*o+e*e);var c=n*(e*=s)-i*(o*=s);i=i*(a*=s)-r*e;r=r*o-n*a;n=o*(r*=s=1/Math.sqrt(c*c+i*i+r*r))-e*(i*=s);s=e*(c*=s)-a*r;var d=a*i-o*c;var l=h.m;return l[0]=c,l[1]=n,l[2]=a,l[3]=0,l[4]=i,l[5]=s,l[6]=o,l[7]=0,l[8]=r,l[9]=d,l[10]=e,l[11]=0,l[12]=-(c*u+i*_+r*t),l[13]=-(n*u+s*_+d*t),l[14]=-(a*u+o*_+e*t),l[15]=1,h;},Mat4.inverseTranspose=function(h,t){t=t.m;m=t[0],v=t[1],g=t[2],b=t[3],C=t[4],x=t[5],A=t[6],S=t[7],T=t[8],w=t[9],P=t[10],M=t[11],p=t[12],R=t[13],I=t[14],B=t[15];var u=m*x-v*C;var _=m*A-g*C;var e=m*S-b*C;var d=v*A-g*x;var i=v*S-b*x;var r=g*S-b*A;var n=T*R-w*p;var a=T*I-P*p;var o=T*B-M*p;var f=w*I-P*R;var s=w*B-M*R;var c=P*B-M*I;var l=u*c-_*s+e*f+d*o-i*a+r*n;return l?((t=h.m)[0]=(x*c-A*s+S*f)*(l=1/l),t[1]=(A*o-C*c-S*a)*l,t[2]=(C*s-x*o+S*n)*l,t[3]=0,t[4]=(g*s-v*c-b*f)*l,t[5]=(m*c-g*o+b*a)*l,t[6]=(v*o-m*s-b*n)*l,t[7]=0,t[8]=(R*r-I*i+B*d)*l,t[9]=(I*e-p*r-B*_)*l,t[10]=(p*i-R*e+B*u)*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,h):null;},Mat4.add=function(t,e,i){var r=t.m,e=e.m,i=i.m;return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r[6]=e[6]+i[6],r[7]=e[7]+i[7],r[8]=e[8]+i[8],r[9]=e[9]+i[9],r[10]=e[10]+i[10],r[11]=e[11]+i[11],r[12]=e[12]+i[12],r[13]=e[13]+i[13],r[14]=e[14]+i[14],r[15]=e[15]+i[15],t;},Mat4.subtract=function(t,e,i){var r=t.m,e=e.m,i=i.m;return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r[4]=e[4]-i[4],r[5]=e[5]-i[5],r[6]=e[6]-i[6],r[7]=e[7]-i[7],r[8]=e[8]-i[8],r[9]=e[9]-i[9],r[10]=e[10]-i[10],r[11]=e[11]-i[11],r[12]=e[12]-i[12],r[13]=e[13]-i[13],r[14]=e[14]-i[14],r[15]=e[15]-i[15],t;},Mat4.multiplyScalar=function(t,e,i){var r=t.m,e=e.m;return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12]*i,r[13]=e[13]*i,r[14]=e[14]*i,r[15]=e[15]*i,t;},Mat4.multiplyScalarAndAdd=function(t,e,i,r){var n=t.m,e=e.m,i=i.m;return n[0]=e[0]+i[0]*r,n[1]=e[1]+i[1]*r,n[2]=e[2]+i[2]*r,n[3]=e[3]+i[3]*r,n[4]=e[4]+i[4]*r,n[5]=e[5]+i[5]*r,n[6]=e[6]+i[6]*r,n[7]=e[7]+i[7]*r,n[8]=e[8]+i[8]*r,n[9]=e[9]+i[9]*r,n[10]=e[10]+i[10]*r,n[11]=e[11]+i[11]*r,n[12]=e[12]+i[12]*r,n[13]=e[13]+i[13]*r,n[14]=e[14]+i[14]*r,n[15]=e[15]+i[15]*r,t;},Mat4.strictEquals=function(t,e){t=t.m,e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15];},Mat4.equals=function(t,e,i){void 0===i&&(i=E.EPSILON);t=t.m,e=e.m;return Math.abs(t[0]-e[0])<=i*Math.max(1,Math.abs(t[0]),Math.abs(e[0]))&&Math.abs(t[1]-e[1])<=i*Math.max(1,Math.abs(t[1]),Math.abs(e[1]))&&Math.abs(t[2]-e[2])<=i*Math.max(1,Math.abs(t[2]),Math.abs(e[2]))&&Math.abs(t[3]-e[3])<=i*Math.max(1,Math.abs(t[3]),Math.abs(e[3]))&&Math.abs(t[4]-e[4])<=i*Math.max(1,Math.abs(t[4]),Math.abs(e[4]))&&Math.abs(t[5]-e[5])<=i*Math.max(1,Math.abs(t[5]),Math.abs(e[5]))&&Math.abs(t[6]-e[6])<=i*Math.max(1,Math.abs(t[6]),Math.abs(e[6]))&&Math.abs(t[7]-e[7])<=i*Math.max(1,Math.abs(t[7]),Math.abs(e[7]))&&Math.abs(t[8]-e[8])<=i*Math.max(1,Math.abs(t[8]),Math.abs(e[8]))&&Math.abs(t[9]-e[9])<=i*Math.max(1,Math.abs(t[9]),Math.abs(e[9]))&&Math.abs(t[10]-e[10])<=i*Math.max(1,Math.abs(t[10]),Math.abs(e[10]))&&Math.abs(t[11]-e[11])<=i*Math.max(1,Math.abs(t[11]),Math.abs(e[11]))&&Math.abs(t[12]-e[12])<=i*Math.max(1,Math.abs(t[12]),Math.abs(e[12]))&&Math.abs(t[13]-e[13])<=i*Math.max(1,Math.abs(t[13]),Math.abs(e[13]))&&Math.abs(t[14]-e[14])<=i*Math.max(1,Math.abs(t[14]),Math.abs(e[14]))&&Math.abs(t[15]-e[15])<=i*Math.max(1,Math.abs(t[15]),Math.abs(e[15]));},Mat4.adjoint=function(h,t){var t=t.m,e=h.m;var u=t[0],i=t[1],r=t[2],n=t[3],_=t[4],d=t[5],a=t[6],o=t[7],f=t[8],p=t[9],s=t[10],c=t[11],m=t[12],v=t[13],l=t[14],t=t[15];return e[0]=d*(s*t-c*l)-p*(a*t-o*l)+v*(a*c-o*s),e[1]=-(i*(s*t-c*l)-p*(r*t-n*l)+v*(r*c-n*s)),e[2]=i*(a*t-o*l)-d*(r*t-n*l)+v*(r*o-n*a),e[3]=-(i*(a*c-o*s)-d*(r*c-n*s)+p*(r*o-n*a)),e[4]=-(_*(s*t-c*l)-f*(a*t-o*l)+m*(a*c-o*s)),e[5]=u*(s*t-c*l)-f*(r*t-n*l)+m*(r*c-n*s),e[6]=-(u*(a*t-o*l)-_*(r*t-n*l)+m*(r*o-n*a)),e[7]=u*(a*c-o*s)-_*(r*c-n*s)+f*(r*o-n*a),e[8]=_*(p*t-c*v)-f*(d*t-o*v)+m*(d*c-o*p),e[9]=-(u*(p*t-c*v)-f*(i*t-n*v)+m*(i*c-n*p)),e[10]=u*(d*t-o*v)-_*(i*t-n*v)+m*(i*o-n*d),e[11]=-(u*(d*c-o*p)-_*(i*c-n*p)+f*(i*o-n*d)),e[12]=-(_*(p*l-s*v)-f*(d*l-a*v)+m*(d*s-a*p)),e[13]=u*(p*l-s*v)-f*(i*l-r*v)+m*(i*s-r*p),e[14]=-(u*(d*l-a*v)-_*(i*l-r*v)+m*(i*a-r*d)),e[15]=u*(d*s-a*p)-_*(i*s-r*p)+f*(i*a-r*d),h;},Mat4.toArray=function(t,e,i){void 0===i&&(i=0);var r=e.m;for(var n=0;n<16;n++)t[i+n]=r[n];return t;},Mat4.fromArray=function(t,e,i){void 0===i&&(i=0);var r=t.m;for(var n=0;n<16;n++)r[n]=e[i+n];return t;},e.clone=function(){var t=this.m;return new Mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);},e.set=function(t){var e=this.m,t=t.m;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this;},e.equals=function(t){return Mat4.strictEquals(this,t);},e.fuzzyEquals=function(t){return Mat4.equals(this,t);},e.toString=function(){var t=this.m;return t?"[\n"+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+",\n"+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+",\n"+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+",\n"+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]";},e.identity=function(){return Mat4.identity(this);},e.transpose=function(t){return t=t||new Mat4(),Mat4.transpose(t,this);},e.invert=function(t){return t=t||new Mat4(),Mat4.invert(t,this);},e.adjoint=function(t){return t=t||new Mat4(),Mat4.adjoint(t,this);},e.determinant=function(){return Mat4.determinant(this);},e.add=function(t,e){return e=e||new Mat4(),Mat4.add(e,this,t);},e.subtract=function(t){return Mat4.subtract(this,this,t);},e.multiply=function(t){return Mat4.multiply(this,this,t);},e.multiplyScalar=function(t){return Mat4.multiplyScalar(this,this,t);},e.translate=function(t,e){return e=e||new Mat4(),Mat4.translate(e,this,t);},e.scale=function(t,e){return e=e||new Mat4(),Mat4.scale(e,this,t);},e.rotate=function(t,e,i){return i=i||new Mat4(),Mat4.rotate(i,this,t,e);},e.getTranslation=function(t){return t=t||new a.default(),Mat4.getTranslation(t,this);},e.getScale=function(t){return t=t||new a.default(),Mat4.getScaling(t,this);},e.getRotation=function(t){return t=t||new o.default(),Mat4.getRotation(t,this);},e.fromRTS=function(t,e,i){return Mat4.fromRTS(this,t,e,i);},e.fromQuat=function(t){return Mat4.fromQuat(this,t);},Mat4;}(r.default);(i.default=y).mul=y.multiply,y.sub=y.subtract,y.IDENTITY=Object.freeze(new y());var s=new a.default();var _=new u.default();n.default.fastDefine("cc.Mat4",y,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1});for(var c=0;c<16;c++)!function(e){Object.defineProperty(y.prototype,"m"+e,{get:function(){return this.m[e];},set:function(t){this.m[e]=t;}});}(c);cc.mat4=function(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f,p){e=new y(t,e,i,r,n,a,o,s,c,l,h,u,_,d,f,p);return void 0===t&&y.identity(e),e;},cc.Mat4=y,e.exports=i.default;},{"../platform/CCClass":189,"./mat3":280,"./quat":282,"./utils":286,"./value-type":287,"./vec3":289}],282:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;var r=_interopRequireDefault(t("./value-type"));var h=_interopRequireDefault(t("../platform/CCClass"));var n=_interopRequireDefault(t("./vec3"));var u=_interopRequireDefault(t("./mat3"));var _=t("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var d;var f;var p;var m;var a=function(a){var t;t=a,(e=Quat).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(Quat);var e=Quat.prototype;function Quat(t,e,i,r){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),(n=a.call(this)||this).x=void 0,n.y=void 0,n.z=void 0,n.w=void 0,t&&"object"==typeof t?(n.z=t.z,n.y=t.y,n.w=t.w,n.x=t.x):(n.x=t,n.y=e,n.z=i,n.w=r),n;}return e.mul=function(t,e){return Quat.multiply(e||new Quat(),this,t);},Quat.clone=function(t){return new Quat(t.x,t.y,t.z,t.w);},Quat.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t;},Quat.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t;},Quat.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t;},Quat.rotationTo=function(t,e,i){var r=n.default.dot(e,i);return r<-.999999?(n.default.cross(s,n.default.RIGHT,e),s.mag()<1e-6&&n.default.cross(s,n.default.UP,e),n.default.normalize(s,s),Quat.fromAxisAngle(t,s,Math.PI),t):.999999<r?(t.x=0,t.y=0,t.z=0,t.w=1,t):(n.default.cross(s,e,i),t.x=s.x,t.y=s.y,t.z=s.z,t.w=1+r,Quat.normalize(t,t));},Quat.getAxisAngle=function(t,e){var i=2*Math.acos(e.w);var r=Math.sin(i/2);return 0!==r?(t.x=e.x/r,t.y=e.y/r,t.z=e.z/r):(t.x=1,t.y=0,t.z=0),i;},Quat.multiply=function(t,e,i){return d=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,f=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,p=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,m=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z,t.x=d,t.y=f,t.z=p,t.w=m,t;},Quat.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t;},Quat.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t;},Quat.rotateX=function(t,e,i){i*=.5;var r=Math.sin(i);i=Math.cos(i);return t.x=e.x*i+e.w*r,t.y=e.y*i+e.z*r,t.z=e.z*i-e.y*r,t.w=e.w*i-e.x*r,t;},Quat.rotateY=function(t,e,i){i*=.5;var r=Math.sin(i);i=Math.cos(i);return t.x=e.x*i-e.z*r,t.y=e.y*i+e.w*r,t.z=e.z*i+e.x*r,t.w=e.w*i-e.y*r,t;},Quat.rotateZ=function(t,e,i){i*=.5;var r=Math.sin(i);i=Math.cos(i);return t.x=e.x*i+e.y*r,t.y=e.y*i-e.x*r,t.z=e.z*i+e.w*r,t.w=e.w*i-e.z*r,t;},Quat.rotateAround=function(t,e,i,r){return Quat.invert(o,e),n.default.transformQuat(s,i,o),Quat.fromAxisAngle(o,s,r),Quat.multiply(t,e,o),t;},Quat.rotateAroundLocal=function(t,e,i,r){return Quat.fromAxisAngle(o,i,r),Quat.multiply(t,e,o),t;},Quat.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t;},Quat.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w;},Quat.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t;},Quat.slerp=function(t,e,i,r){var n=0;var a=0;var o=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;var s;return o<0&&(o=-o,i.x=-i.x,i.y=-i.y,i.z=-i.z,i.w=-i.w),a=1e-6<1-o?(o=Math.acos(o),s=Math.sin(o),n=Math.sin((1-r)*o)/s,Math.sin(r*o)/s):(n=1-r,r),t.x=n*e.x+a*i.x,t.y=n*e.y+a*i.y,t.z=n*e.z+a*i.z,t.w=n*e.w+a*i.w,t;},Quat.sqlerp=function(t,e,i,r,n,a){return Quat.slerp(o,e,n,a),Quat.slerp(v,i,r,a),Quat.slerp(t,o,v,2*a*(1-a)),t;},Quat.invert=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;i=i?1/i:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t;},Quat.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t;},Quat.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);},Quat.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;},Quat.normalize=function(t,e){var i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return 0<i&&(i=1/Math.sqrt(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i),t;},Quat.fromAxes=function(t,e,i,r){return u.default.set(c,e.x,e.y,e.z,i.x,i.y,i.z,r.x,r.y,r.z),Quat.normalize(t,Quat.fromMat3(t,c));},Quat.fromViewUp=function(t,e,i){return u.default.fromViewUp(c,e,i),Quat.normalize(t,Quat.fromMat3(t,c));},Quat.fromAxisAngle=function(t,e,i){i*=.5;var r=Math.sin(i);return t.x=r*e.x,t.y=r*e.y,t.z=r*e.z,t.w=Math.cos(i),t;},Quat.fromAngleZ=function(t,e){return e*=l,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t;},Quat.fromMat3=function(t,e){e=e.m;var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],c=e[6],h=e[7],e=e[8];var l=i+o+e;return 0<l?(l=.5/Math.sqrt(l+1),t.w=.25/l,t.x=(s-h)*l,t.y=(c-n)*l,t.z=(r-a)*l):o<i&&e<i?(l=2*Math.sqrt(1+i-o-e),t.w=(s-h)/l,t.x=.25*l,t.y=(a+r)/l,t.z=(c+n)/l):e<o?(l=2*Math.sqrt(1+o-i-e),t.w=(c-n)/l,t.x=(a+r)/l,t.y=.25*l,t.z=(h+s)/l):(l=2*Math.sqrt(1+e-i-o),t.w=(r-a)/l,t.x=(c+n)/l,t.y=(h+s)/l,t.z=.25*l),t;},Quat.fromEuler=function(t,e,i,r){e*=l,i*=l,r*=l;var n=Math.sin(e);e=Math.cos(e);var a=Math.sin(i);i=Math.cos(i);var o=Math.sin(r);r=Math.cos(r);return t.x=n*i*r+e*a*o,t.y=e*a*r+n*i*o,t.z=e*i*o-n*a*r,t.w=e*i*r-n*a*o,t;},Quat.toAxisX=function(t,e){var i=2*e.y;var r=2*e.z;return t.x=1-i*e.y-r*e.z,t.y=i*e.x+r*e.w,t.z=r*e.x+i*e.w,t;},Quat.toAxisY=function(t,e){var i=2*e.x;var r=2*e.y;var n=2*e.z;return t.x=r*e.x-n*e.w,t.y=1-i*e.x-n*e.z,t.z=n*e.y+i*e.w,t;},Quat.toAxisZ=function(t,e){var i=2*e.x;var r=2*e.y;var n=2*e.z;return t.x=n*e.x-r*e.w,t.y=n*e.y-i*e.w,t.z=1-i*e.x-r*e.y,t;},Quat.toEuler=function(t,e,h){var i=e.x,r=e.y,n=e.z,e=e.w;var a=0;var o=0;var s=0;var c=i*r+n*e;var u,l;return .499999<c?(o=(a=0,_.toDegree)(2*Math.atan2(i,e)),s=90):c<-.499999?(o=-(a=0,_.toDegree)(2*Math.atan2(i,e)),s=-90):(u=r*r,l=n*n,a=(0,_.toDegree)(Math.atan2(2*i*e-2*r*n,1-2*(i*i)-2*l)),o=(0,_.toDegree)(Math.atan2(2*r*e-2*i*n,1-2*u-2*l)),s=(0,_.toDegree)(Math.asin(2*c)),h&&(a=-180*Math.sign(a+1e-6)+a,o=-180*Math.sign(o+1e-6)+o,s=180*Math.sign(s+1e-6)-s)),t.x=a,t.y=o,t.z=s,t;},Quat.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w;},Quat.equals=function(t,e,i){return void 0===i&&(i=_.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w));},Quat.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t;},Quat.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t;},e.clone=function(){return new Quat(this.x,this.y,this.z,this.w);},e.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this;},e.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w;},e.toEuler=function(t){return Quat.toEuler(t,this);},e.fromEuler=function(t){return Quat.fromEuler(this,t.x,t.y,t.z);},e.lerp=function(t,e,i){return i=i||new Quat(),Quat.slerp(i,this,t,e),i;},e.multiply=function(t){return Quat.multiply(this,this,t);},e.rotateAround=function(t,e,i,r){return r=r||new Quat(),Quat.rotateAround(r,t,e,i);},Quat;}(r.default);(e.default=a).mul=a.multiply,a.scale=a.multiplyScalar,a.mag=a.len,a.IDENTITY=Object.freeze(new a());var o=new a();var v=new a();var s=new n.default();var c=new u.default();var l=.5*Math.PI/180;h.default.fastDefine("cc.Quat",a,{x:0,y:0,z:0,w:1}),cc.quat=function(t,e,i,r){return new a(t,e,i,r);},cc.Quat=a,i.exports=e.default;},{"../platform/CCClass":189,"./mat3":280,"./utils":286,"./value-type":287,"./vec3":289}],283:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("./value-type"));var n=_interopRequireDefault(t("../platform/CCClass"));var o=_interopRequireDefault(t("./vec2"));var s=_interopRequireDefault(t("./size"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var a=function(a){e=a,(t=Rect).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(Rect);function Rect(t,e,i,r){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),(n=a.call(this)||this).x=void 0,n.y=void 0,n.width=void 0,n.height=void 0,t&&"object"==typeof t&&(e=t.y,i=t.width,r=t.height,t=t.x),n.x=t||0,n.y=e||0,n.width=i||0,n.height=r||0,n;}Rect.fromMinMax=function(t,e){var i=Math.min(t.x,e.x);var r=Math.min(t.y,e.y);return new Rect(i,r,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-r);};var t=Rect.prototype;var e,i;return t.clone=function(){return new Rect(this.x,this.y,this.width,this.height);},t.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height;},t.lerp=function(t,e,i){i=i||new Rect();var r=this.x;var n=this.y;var a=this.width;var o=this.height;return i.x=r+(t.x-r)*e,i.y=n+(t.y-n)*e,i.width=a+(t.width-a)*e,i.height=o+(t.height-o)*e,i;},t.set=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this;},t.intersects=function(t){var e=this.x+this.width,i=this.y+this.height,r=t.x+t.width,n=t.y+t.height;return!(e<t.x||r<this.x||i<t.y||n<this.y);},t.intersection=function(t,e){var i=this.x,r=this.y,n=this.x+this.width,a=this.y+this.height;var o=e.x,s=e.y,c=e.x+e.width,e=e.y+e.height;return t.x=Math.max(i,o),t.y=Math.max(r,s),t.width=Math.min(n,c)-t.x,t.height=Math.min(a,e)-t.y,t;},t.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y;},t.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height;},t.union=function(t,e){var i=this.x,r=this.y,n=this.width,a=this.height;var o=e.x,s=e.y,c=e.width,e=e.height;return t.x=Math.min(i,o),t.y=Math.min(r,s),t.width=Math.max(i+n,o+c)-t.x,t.height=Math.max(r+a,s+e)-t.y,t;},t.transformMat4=function(t,e){var i=this.x;var r=this.y;var n=i+this.width;var a=r+this.height;e=e.m;var o=e[0]*i+e[4]*r+e[12];var s=e[1]*i+e[5]*r+e[13];var c=e[0]*n+e[4]*r+e[12];r=e[1]*n+e[5]*r+e[13];var l=e[0]*i+e[4]*a+e[12];i=e[1]*i+e[5]*a+e[13];var h=e[0]*n+e[4]*a+e[12];n=e[1]*n+e[5]*a+e[13];a=Math.min(o,c,l,h);e=Math.max(o,c,l,h);o=Math.min(s,r,i,n);c=Math.max(s,r,i,n);return t.x=a,t.y=o,t.width=e-a,t.height=c-o,t;},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")";},e=Rect,(t=[{key:"xMin",get:function(){return this.x;},set:function(t){this.width+=this.x-t,this.x=t;}},{key:"yMin",get:function(){return this.y;},set:function(t){this.height+=this.y-t,this.y=t;}},{key:"xMax",get:function(){return this.x+this.width;},set:function(t){this.width=t-this.x;}},{key:"yMax",get:function(){return this.y+this.height;},set:function(t){this.height=t-this.y;}},{key:"center",get:function(){return new o.default(this.x+.5*this.width,this.y+.5*this.height);},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height;}},{key:"origin",get:function(){return new o.default(this.x,this.y);},set:function(t){this.x=t.x,this.y=t.y;}},{key:"size",get:function(){return new s.default(this.width,this.height);},set:function(t){this.width=t.width,this.height=t.height;}}])&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Rect;}(r.default);i.default=a,n.default.fastDefine("cc.Rect",a,{x:0,y:0,width:0,height:0}),cc.Rect=a,cc.rect=function(t,e,i,r){return new a(t,e,i,r);},e.exports=i.default;},{"../platform/CCClass":189,"./size":284,"./value-type":287,"./vec2":288}],284:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=_interopRequireDefault(t("./value-type"));t=_interopRequireDefault(t("../platform/CCClass"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var n=function(r){e=r,(t=Size).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(Size);var t,e;function Size(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=r.call(this)||this).width=void 0,i.height=void 0,t&&"object"==typeof t?(i.height=t.height,i.width=t.width):(i.width=t||0,i.height=e||0),i;}t=Size,e=[{key:"ZERO",get:function(){return new Size();}}],(i=null)&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e);var i=Size.prototype;return i.clone=function(){return new Size(this.width,this.height);},i.equals=function(t){return t&&this.width===t.width&&this.height===t.height;},i.lerp=function(t,e,i){i=i||new Size();var r=this.width;var n=this.height;return i.width=r+(t.width-r)*e,i.height=n+(t.height-n)*e,i;},i.set=function(t){return this.width=t.width,this.height=t.height,this;},i.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")";},Size;}(r.default);(i.default=n).ZERO_R=n.ZERO,t.default.fastDefine("cc.Size",n,{width:0,height:0}),cc.size=function(t,e){return new n(t,e);},cc.Size=n,e.exports=i.default;},{"../platform/CCClass":189,"./value-type":287}],285:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var n=(t=t("./quat"))&&t.__esModule?t:{default:t};var a=new n.default();Trs.toRotation=function(t,e){return t.x=e[3],t.y=e[4],t.z=e[5],t.w=e[6],t;},Trs.fromRotation=function(t,e){return t[3]=e.x,t[4]=e.y,t[5]=e.z,t[6]=e.w,t;},Trs.toEuler=function(t,e){return Trs.toRotation(a,e),n.default.toEuler(t,a),t;},Trs.fromEuler=function(t,e){return n.default.fromEuler(a,e.x,e.y,e.z),Trs.fromRotation(t,a),t;},Trs.fromEulerNumber=function(t,e,i,r){return n.default.fromEuler(a,e,i,r),Trs.fromRotation(t,a),t;},Trs.toScale=function(t,e){return t.x=e[7],t.y=e[8],t.z=e[9],t;},Trs.fromScale=function(t,e){return t[7]=e.x,t[8]=e.y,t[9]=e.z,t;},Trs.toPosition=function(t,e){return t.x=e[0],t.y=e[1],t.z=e[2],t;},Trs.fromPosition=function(t,e){return t[0]=e.x,t[1]=e.y,t[2]=e.z,t;},Trs.fromAngleZ=function(t,e){return n.default.fromAngleZ(a,e),Trs.fromRotation(t,a),t;},Trs.toMat4=function(h,t){var e=t[3],i=t[4],r=t[5],n=t[6];var a=e+e;var o=i+i;var s=r+r;var u=e*a;var _=e*o;e*=s;var d=i*o;i*=s;r*=s;a*=n;o*=n;n*=s;s=t[7];var c=t[8];var f=t[9];var l=h.m;return l[0]=(1-(d+r))*s,l[1]=(_+n)*s,l[2]=(e-o)*s,l[3]=0,l[4]=(_-n)*c,l[5]=(1-(u+r))*c,l[6]=(i+a)*c,l[7]=0,l[8]=(e+o)*f,l[9]=(i-a)*f,l[10]=(1-(u+d))*f,l[11]=0,l[12]=t[0],l[13]=t[1],l[14]=t[2],l[15]=1,h;};t=Trs;function Trs(){}i.default=t,cc.Trs=t,e.exports=i.default;},{"./quat":282}],286:[function(a,o,t){"use strict";t.__esModule=!0,t.equals=function(t,e){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e));},t.approx=function(t,e,i){return i=i||r,Math.abs(t-e)<=i;},t.clamp=function(t,e,i){return t<e?e:i<t?i:t;},t.clamp01=function(t){return t<0?0:1<t?1:t;},t.lerp=function(t,e,i){return t+(e-t)*i;},t.toRadian=function(t){return t*e;},t.toDegree=function(t){return t*i;},t.randomRange=randomRange,t.randomRangeInt=function(t,e){return Math.floor(randomRange(t,e));},t.pseudoRandom=pseudoRandom,t.pseudoRandomRange=pseudoRandomRange,t.pseudoRandomRangeInt=function(t,e,i){return Math.floor(pseudoRandomRange(t,e,i));},t.nextPow2=function(t){return--t,t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16,++t;},t.repeat=repeat,t.pingPong=function(t,e){return t=repeat(t,2*e),t=e-Math.abs(t-e);},t.inverseLerp=function(t,e,i){return(i-t)/(e-t);},t.sign=function(t){return(0<t)-(t<0);},t.random=t.FLOAT_BYTES=t.FLOAT_ARRAY_TYPE=t.INT_MIN=t.INT_MAX=t.INT_BITS=t.EPSILON=void 0;var e=Math.PI/180;var i=180/Math.PI;var r=1e-6;t.EPSILON=r;t.INT_BITS=32;t.INT_MAX=2147483647;t.INT_MIN=-1<<31;var n=Float64Array;t.FLOAT_ARRAY_TYPE=n;t.FLOAT_BYTES=8;n=Math.random;function randomRange(t,e){return Math.random()*(e-t)+t;}function pseudoRandom(t){return(t=(9301*t+49297)%233280)/233280;}function pseudoRandomRange(t,e,i){return pseudoRandom(t)*(i-e)+e;}function repeat(t,e){return t-Math.floor(t/e)*e;}t.random=n;},{}],287:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("../platform/js"))&&t.__esModule?t:{default:t};(t=ValueType.prototype).clone=function(){return cc.errorID("0100",r.default.getClassName(this)+".clone"),null;},t.equals=function(t){return cc.errorID("0100",r.default.getClassName(this)+".equals"),!1;},t.lerp=function(t,e){return cc.errorID("0100",r.default.getClassName(this)+".lerp"),this.clone();},t.set=function(t){cc.errorID("0100",r.default.getClassName(this)+".set");},t.toString=function(){return""+{};};t=ValueType;function ValueType(){}i.default=t,r.default.setClassName("cc.ValueType",t),cc.ValueType=t,e.exports=i.default;},{"../platform/js":209}],288:[function(t,r,e){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(t("./value-type"));var l=_interopRequireDefault(t("../platform/CCClass"));var a=_interopRequireDefault(t("../utils/misc"));var o=t("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var s=0;var c=0;var i=function(r){e=r,(t=Vec2).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(Vec2);var t=Vec2.prototype;var e,i,n;function Vec2(t,e){var i;return void 0===t&&(t=0),void 0===e&&(e=0),(i=r.call(this)||this).mag=Vec2.prototype.len,i.magSqr=Vec2.prototype.lengthSqr,i.subSelf=Vec2.prototype.subtract,i.mulSelf=Vec2.prototype.multiplyScalar,i.divSelf=Vec2.prototype.divide,i.scaleSelf=Vec2.prototype.multiply,i.negSelf=Vec2.prototype.negate,i.x=void 0,i.y=void 0,i.z=0,t&&"object"==typeof t?(i.y=t.y||0,i.x=t.x||0):(i.x=t||0,i.y=e||0),i;}return t.sub=function(t,e){return Vec2.subtract(e||new Vec2(),this,t);},t.mul=function(t,e){return Vec2.multiplyScalar(e||new Vec2(),this,t);},t.div=function(t,e){return Vec2.multiplyScalar(e||new Vec2(),this,1/t);},t.scale=function(t,e){return Vec2.multiply(e||new Vec2(),this,t);},t.neg=function(t){return Vec2.negate(t||new Vec2(),this);},Vec2.clone=function(t){return new Vec2(t.x,t.y);},Vec2.copy=function(t,e){return t.x=e.x,t.y=e.y,t;},Vec2.set=function(t,e,i){return t.x=e,t.y=i,t;},Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t;},Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t;},Vec2.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t;},Vec2.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t;},Vec2.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t;},Vec2.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t;},Vec2.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t;},Vec2.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t;},Vec2.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t;},Vec2.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t;},Vec2.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t;},Vec2.distance=function(t,e){return s=e.x-t.x,c=e.y-t.y,Math.sqrt(s*s+c*c);},Vec2.squaredDistance=function(t,e){return s=e.x-t.x,c=e.y-t.y,s*s+c*c;},Vec2.len=function(t){return s=t.x,c=t.y,Math.sqrt(s*s+c*c);},Vec2.lengthSqr=function(t){return s=t.x,c=t.y,s*s+c*c;},Vec2.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t;},Vec2.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t;},Vec2.inverseSafe=function(t,e){return s=e.x,c=e.y,Math.abs(s)<o.EPSILON?t.x=0:t.x=1/s,Math.abs(c)<o.EPSILON?t.y=0:t.y=1/c,t;},Vec2.normalize=function(t,e){s=e.x,c=e.y;e=s*s+c*c;return 0<e&&(e=1/Math.sqrt(e),t.x=s*e,t.y=c*e),t;},Vec2.dot=function(t,e){return t.x*e.x+t.y*e.y;},Vec2.cross=function(t,e,i){return t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t;},Vec2.lerp=function(t,e,i,r){return s=e.x,c=e.y,t.x=s+r*(i.x-s),t.y=c+r*(i.y-c),t;},Vec2.random=function(t,e){e=e||1;var i=2*(0,o.random)()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t;},Vec2.transformMat3=function(t,e,i){s=e.x,c=e.y;e=i.m;return t.x=e[0]*s+e[3]*c+e[6],t.y=e[1]*s+e[4]*c+e[7],t;},Vec2.transformMat4=function(t,e,i){s=e.x,c=e.y;e=i.m;return t.x=e[0]*s+e[4]*c+e[12],t.y=e[1]*s+e[5]*c+e[13],t;},Vec2.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y;},Vec2.equals=function(t,e,i){return void 0===i&&(i=o.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y));},Vec2.angle=function(t,e){Vec2.normalize(h,t),Vec2.normalize(u,e);t=Vec2.dot(h,u);return 1<t?0:t<-1?Math.PI:Math.acos(t);},Vec2.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t;},Vec2.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t;},e=Vec2,n=[{key:"ONE",get:function(){return new Vec2(1,1);}},{key:"ZERO",get:function(){return new Vec2(0,0);}},{key:"UP",get:function(){return new Vec2(0,1);}},{key:"RIGHT",get:function(){return new Vec2(1,0);}}],(i=null)&&_defineProperties(e.prototype,i),n&&_defineProperties(e,n),t.clone=function(){return new Vec2(this.x,this.y);},t.set=function(t){return this.x=t.x,this.y=t.y,this;},t.equals=function(t){return t&&this.x===t.x&&this.y===t.y;},t.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e;},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")";},t.lerp=function(t,e,i){i=i||new Vec2();var r=this.x;var n=this.y;return i.x=r+(t.x-r)*e,i.y=n+(t.y-n)*e,i;},t.clampf=function(t,e){return this.x=a.default.clampf(this.x,t.x,e.x),this.y=a.default.clampf(this.y,t.y,e.y),this;},t.add=function(t,e){return(e=e||new Vec2()).x=this.x+t.x,e.y=this.y+t.y,e;},t.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this;},t.subtract=function(t){return this.x-=t.x,this.y-=t.y,this;},t.multiplyScalar=function(t){return this.x*=t,this.y*=t,this;},t.multiply=function(t){return this.x*=t.x,this.y*=t.y,this;},t.divide=function(t){return this.x/=t,this.y/=t,this;},t.negate=function(){return this.x=-this.x,this.y=-this.y,this;},t.dot=function(t){return this.x*t.x+this.y*t.y;},t.cross=function(t){return this.x*t.y-this.y*t.x;},t.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);},t.lengthSqr=function(){return this.x*this.x+this.y*this.y;},t.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1==t)return this;if(0==t)return this;t=1/Math.sqrt(t);return this.x*=t,this.y*=t,this;},t.normalize=function(t){return(t=t||new Vec2()).x=this.x,t.y=this.y,t.normalizeSelf(),t;},t.angle=function(t){var e=this.magSqr();var i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;t=this.dot(t)/Math.sqrt(e*i);return t=a.default.clampf(t,-1,1),Math.acos(t);},t.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e;},t.rotate=function(t,e){return(e=e||new Vec2()).x=this.x,e.y=this.y,e.rotateSelf(t);},t.rotateSelf=function(t){var e=Math.sin(t);t=Math.cos(t);var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this;},t.project=function(t){return t.multiplyScalar(this.dot(t)/t.dot(t));},t.transformMat4=function(t,e){return e=e||new Vec2(),Vec2.transformMat4(e,this,t),e;},t.maxAxis=function(){return Math.max(this.x,this.y);},Vec2;}(n.default);(e.default=i).sub=i.subtract,i.mul=i.multiply,i.scale=i.multiplyScalar,i.mag=i.len,i.squaredMagnitude=i.lengthSqr,i.div=i.divide,i.ONE_R=i.ONE,i.ZERO_R=i.ZERO,i.UP_R=i.UP,i.RIGHT_R=i.RIGHT;var h=new i();var u=new i();l.default.fastDefine("cc.Vec2",i,{x:0,y:0}),cc.v2=function(t,e){return new i(t,e);},cc.Vec2=i,r.exports=e.default;},{"../platform/CCClass":189,"../utils/misc":264,"./utils":286,"./value-type":287}],289:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(t("./value-type"));var u=_interopRequireDefault(t("../platform/CCClass"));var a=_interopRequireDefault(t("../utils/misc"));var o=_interopRequireDefault(t("./vec2"));var s=t("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var c=0;var l=0;var h=0;var r=function(n){e=n,(t=Vec3).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(Vec3);var t=Vec3.prototype;var e,i,r;function Vec3(t,e,i){var r;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),(r=n.call(this)||this).mag=Vec3.prototype.len,r.magSqr=Vec3.prototype.lengthSqr,r.subSelf=Vec3.prototype.subtract,r.mulSelf=Vec3.prototype.multiplyScalar,r.divSelf=Vec3.prototype.divide,r.scaleSelf=Vec3.prototype.multiply,r.negSelf=Vec3.prototype.negate,r.x=void 0,r.y=void 0,r.z=void 0,r.angle=o.default.prototype.angle,r.project=o.default.prototype.project,t&&"object"==typeof t?(r.z=t.z,r.y=t.y,r.x=t.x):(r.x=t,r.y=e,r.z=i),r;}return t.sub=function(t,e){return Vec3.subtract(e||new Vec3(),this,t);},t.mul=function(t,e){return Vec3.multiplyScalar(e||new Vec3(),this,t);},t.div=function(t,e){return Vec3.multiplyScalar(e||new Vec3(),this,1/t);},t.scale=function(t,e){return Vec3.multiply(e||new Vec3(),this,t);},t.neg=function(t){return Vec3.negate(t||new Vec3(),this);},Vec3.zero=function(t){return t.x=0,t.y=0,t.z=0,t;},Vec3.clone=function(t){return new Vec3(t.x,t.y,t.z);},Vec3.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t;},Vec3.set=function(t,e,i,r){return t.x=e,t.y=i,t.z=r,t;},Vec3.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t;},Vec3.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t;},Vec3.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t;},Vec3.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t;},Vec3.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t;},Vec3.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t;},Vec3.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t;},Vec3.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t;},Vec3.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t;},Vec3.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t;},Vec3.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t;},Vec3.distance=function(t,e){return c=e.x-t.x,l=e.y-t.y,h=e.z-t.z,Math.sqrt(c*c+l*l+h*h);},Vec3.squaredDistance=function(t,e){return c=e.x-t.x,l=e.y-t.y,h=e.z-t.z,c*c+l*l+h*h;},Vec3.len=function(t){return c=t.x,l=t.y,h=t.z,Math.sqrt(c*c+l*l+h*h);},Vec3.lengthSqr=function(t){return c=t.x,l=t.y,h=t.z,c*c+l*l+h*h;},Vec3.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t;},Vec3.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t;},Vec3.inverseSafe=function(t,e){return c=e.x,l=e.y,h=e.z,Math.abs(c)<s.EPSILON?t.x=0:t.x=1/c,Math.abs(l)<s.EPSILON?t.y=0:t.y=1/l,Math.abs(h)<s.EPSILON?t.z=0:t.z=1/h,t;},Vec3.normalize=function(t,e){c=e.x,l=e.y,h=e.z;e=c*c+l*l+h*h;return 0<e&&(e=1/Math.sqrt(e),t.x=c*e,t.y=l*e,t.z=h*e),t;},Vec3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z;},Vec3.cross=function(t,e,i){var r=e.x,n=e.y,e=e.z;var a=i.x,o=i.y,i=i.z;return t.x=n*i-e*o,t.y=e*a-r*i,t.z=r*o-n*a,t;},Vec3.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t;},Vec3.random=function(t,e){e=e||1;var i=2*(0,s.random)()*Math.PI;var r=2*(0,s.random)()-1;var n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t;},Vec3.transformMat4=function(t,e,i){c=e.x,l=e.y,h=e.z;e=i.m;i=e[3]*c+e[7]*l+e[11]*h+e[15];return t.x=(e[0]*c+e[4]*l+e[8]*h+e[12])*(i=i?1/i:1),t.y=(e[1]*c+e[5]*l+e[9]*h+e[13])*i,t.z=(e[2]*c+e[6]*l+e[10]*h+e[14])*i,t;},Vec3.transformMat4Normal=function(t,e,i){c=e.x,l=e.y,h=e.z;e=i.m;i=e[3]*c+e[7]*l+e[11]*h;return t.x=(e[0]*c+e[4]*l+e[8]*h)*(i=i?1/i:1),t.y=(e[1]*c+e[5]*l+e[9]*h)*i,t.z=(e[2]*c+e[6]*l+e[10]*h)*i,t;},Vec3.transformMat3=function(t,e,i){c=e.x,l=e.y,h=e.z;e=i.m;return t.x=c*e[0]+l*e[3]+h*e[6],t.y=c*e[1]+l*e[4]+h*e[7],t.z=c*e[2]+l*e[5]+h*e[8],t;},Vec3.transformAffine=function(t,e,i){c=e.x,l=e.y,h=e.z;e=i.m;return t.x=e[0]*c+e[1]*l+e[2]*h+e[3],t.y=e[4]*c+e[5]*l+e[6]*h+e[7],t.x=e[8]*c+e[9]*l+e[10]*h+e[11],t;},Vec3.transformQuat=function(t,e,i){var r=i.w*e.x+i.y*e.z-i.z*e.y;var n=i.w*e.y+i.z*e.x-i.x*e.z;var a=i.w*e.z+i.x*e.y-i.y*e.x;e=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=r*i.w+e*-i.x+n*-i.z-a*-i.y,t.y=n*i.w+e*-i.y+a*-i.x-r*-i.z,t.z=a*i.w+e*-i.z+r*-i.y-n*-i.x,t;},Vec3.transformRTS=function(t,e,i,r,n){var a=e.x*n.x;var o=e.y*n.y;e=e.z*n.z;n=i.w*a+i.y*e-i.z*o;var s=i.w*o+i.z*a-i.x*e;var c=i.w*e+i.x*o-i.y*a;a=-i.x*a-i.y*o-i.z*e;return t.x=n*i.w+a*-i.x+s*-i.z-c*-i.y+r.x,t.y=s*i.w+a*-i.y+c*-i.x-n*-i.z+r.y,t.z=c*i.w+a*-i.z+n*-i.y-s*-i.x+r.z,t;},Vec3.transformInverseRTS=function(t,e,i,r,n){var a=e.x-r.x;var o=e.y-r.y;e=e.z-r.z;r=i.w*a-i.y*e+i.z*o;var s=i.w*o-i.z*a+i.x*e;var c=i.w*e-i.x*o+i.y*a;a=i.x*a+i.y*o+i.z*e;return t.x=(r*i.w+a*i.x+s*i.z-c*i.y)/n.x,t.y=(s*i.w+a*i.y+c*i.x-r*i.z)/n.y,t.z=(c*i.w+a*i.z+r*i.y-s*i.x)/n.z,t;},Vec3.rotateX=function(t,e,i,r){c=e.x-i.x,l=e.y-i.y,h=e.z-i.z;e=Math.cos(r);r=Math.sin(r);var n=c;var a=l*e-h*r;r=l*r+h*e;return t.x=n+i.x,t.y=a+i.y,t.z=r+i.z,t;},Vec3.rotateY=function(t,e,i,r){c=e.x-i.x,l=e.y-i.y,h=e.z-i.z;e=Math.cos(r);r=Math.sin(r);var n=h*r+c*e;var a=l;e=h*e-c*r;return t.x=n+i.x,t.y=a+i.y,t.z=e+i.z,t;},Vec3.rotateZ=function(t,e,i,r){c=e.x-i.x,l=e.y-i.y,h=e.z-i.z;e=Math.cos(r);r=Math.sin(r);var n=c*e-l*r;r=c*r+l*e;e=h;return t.x=n+i.x,t.y=r+i.y,t.z=e+i.z,t;},Vec3.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z;},Vec3.equals=function(t,e,i){void 0===i&&(i=s.EPSILON);var r=t.x,n=t.y,t=t.z;var a=e.x,o=e.y,e=e.z;return Math.abs(r-a)<=i*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(t-e)<=i*Math.max(1,Math.abs(t),Math.abs(e));},Vec3.angle=function(t,e){Vec3.normalize(_,t),Vec3.normalize(d,e);t=Vec3.dot(_,d);return 1<t?0:t<-1?Math.PI:Math.acos(t);},Vec3.projectOnPlane=function(t,e,i){return Vec3.subtract(t,e,Vec3.project(t,e,i));},Vec3.project=function(t,e,i){var r=Vec3.lengthSqr(i);return r<1e-6?Vec3.set(t,0,0,0):Vec3.multiplyScalar(t,i,Vec3.dot(e,i)/r);},Vec3.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t;},Vec3.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t;},e=Vec3,r=[{key:"ONE",get:function(){return new Vec3(1,1,1);}},{key:"ZERO",get:function(){return new Vec3();}},{key:"UP",get:function(){return new Vec3(0,1,0);}},{key:"RIGHT",get:function(){return new Vec3(1,0,0);}},{key:"FORWARD",get:function(){return new Vec3(0,0,1);}}],(i=null)&&_defineProperties(e.prototype,i),r&&_defineProperties(e,r),t.clone=function(){return new Vec3(this.x,this.y,this.z);},t.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this;},t.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z;},t.fuzzyEquals=function(t,e){return this.x-e<=t.x&&t.x<=this.x+e&&this.y-e<=t.y&&t.y<=this.y+e&&this.z-e<=t.z&&t.z<=this.z+e;},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")";},t.lerp=function(t,e,i){return i=i||new Vec3(),Vec3.lerp(i,this,t,e),i;},t.clampf=function(t,e){return this.x=a.default.clampf(this.x,t.x,e.x),this.y=a.default.clampf(this.y,t.y,e.y),this.z=a.default.clampf(this.z,t.z,e.z),this;},t.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this;},t.add=function(t,e){return(e=e||new Vec3()).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e;},t.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this;},t.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this;},t.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this;},t.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this;},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this;},t.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z;},t.cross=function(t,e){return e=e||new Vec3(),Vec3.cross(e,this,t),e;},t.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);},t.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z;},t.normalizeSelf=function(){return Vec3.normalize(this,this),this;},t.normalize=function(t){return t=t||new Vec3(),Vec3.normalize(t,this),t;},t.transformMat4=function(t,e){return e=e||new Vec3(),Vec3.transformMat4(e,this,t),e;},t.maxAxis=function(){return Math.max(this.x,this.y,this.z);},t.signAngle=function(t){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var e=new o.default(this.x,this.y);t=new o.default(t.x,t.y);return e.signAngle(t);},t.rotate=function(t,e){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),o.default.prototype.rotate.call(this,t,e);},t.rotateSelf=function(t){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),o.default.prototype.rotateSelf.call(this,t);},Vec3;}(n.default);(e.default=r).sub=r.subtract,r.mul=r.multiply,r.scale=r.multiplyScalar,r.mag=r.len,r.squaredMagnitude=r.lengthSqr,r.div=r.divide,r.ONE_R=r.ONE,r.ZERO_R=r.ZERO,r.UP_R=r.UP,r.RIGHT_R=r.RIGHT,r.FRONT_R=r.FORWARD;var _=new r();var d=new r();u.default.fastDefine("cc.Vec3",r,{x:0,y:0,z:0}),cc.v3=function(t,e,i){return new r(t,e,i);},cc.Vec3=r,i.exports=e.default;},{"../platform/CCClass":189,"../utils/misc":264,"./utils":286,"./value-type":287,"./vec2":288}],290:[function(t,i,e){"use strict";e.__esModule=!0,e.v4=v4,e.default=void 0;var r=_interopRequireDefault(t("../platform/CCClass"));var a=_interopRequireDefault(t("./value-type"));var o=t("./utils");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var c=0;var l=0;var h=0;var u=0;var n=function(a){e=a,(t=Vec4).prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e;_createSuper(Vec4);var t=Vec4.prototype;var e,i,r;function Vec4(t,e,i,r){var n;return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),(n=a.call(this)||this).mag=Vec4.prototype.len,n.magSqr=Vec4.prototype.lengthSqr,n.subSelf=Vec4.prototype.subtract,n.mulSelf=Vec4.prototype.multiplyScalar,n.divSelf=Vec4.prototype.divide,n.scaleSelf=Vec4.prototype.multiply,n.negSelf=Vec4.prototype.negate,n.x=void 0,n.y=void 0,n.z=void 0,n.w=void 0,t&&"object"==typeof t?(n.w=t.w,n.z=t.z,n.y=t.y,n.x=t.x):(n.x=t,n.y=e,n.z=i,n.w=r),n;}return t.sub=function(t,e){return Vec4.subtract(e||new Vec4(),this,t);},t.mul=function(t,e){return Vec4.multiplyScalar(e||new Vec4(),this,t);},t.div=function(t,e){return Vec4.multiplyScalar(e||new Vec4(),this,1/t);},t.scale=function(t,e){return Vec4.multiply(e||new Vec4(),this,t);},t.neg=function(t){return Vec4.negate(t||new Vec4(),this);},Vec4.clone=function(t){return new Vec4(t.x,t.y,t.z,t.w);},Vec4.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t;},Vec4.set=function(t,e,i,r,n){return t.x=e,t.y=i,t.z=r,t.w=n,t;},Vec4.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t;},Vec4.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t;},Vec4.multiply=function(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t;},Vec4.divide=function(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t;},Vec4.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t;},Vec4.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t;},Vec4.min=function(t,e,i){return t.x=Math.min(e.x,i.x),t.y=Math.min(e.y,i.y),t.z=Math.min(e.z,i.z),t.w=Math.min(e.w,i.w),t;},Vec4.max=function(t,e,i){return t.x=Math.max(e.x,i.x),t.y=Math.max(e.y,i.y),t.z=Math.max(e.z,i.z),t.w=Math.max(e.w,i.w),t;},Vec4.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t;},Vec4.multiplyScalar=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t;},Vec4.scaleAndAdd=function(t,e,i,r){return t.x=e.x+i.x*r,t.y=e.y+i.y*r,t.z=e.z+i.z*r,t.w=e.w+i.w*r,t;},Vec4.distance=function(t,e){var i=e.x-t.x;var r=e.y-t.y;var n=e.z-t.z;e=e.w-t.w;return Math.sqrt(i*i+r*r+n*n+e*e);},Vec4.squaredDistance=function(t,e){var i=e.x-t.x;var r=e.y-t.y;var n=e.z-t.z;e=e.w-t.w;return i*i+r*r+n*n+e*e;},Vec4.len=function(t){return c=t.x,l=t.y,h=t.z,u=t.w,Math.sqrt(c*c+l*l+h*h+u*u);},Vec4.lengthSqr=function(t){return c=t.x,l=t.y,h=t.z,u=t.w,c*c+l*l+h*h+u*u;},Vec4.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t;},Vec4.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t;},Vec4.inverseSafe=function(t,e){return c=e.x,l=e.y,h=e.z,u=e.w,Math.abs(c)<o.EPSILON?t.x=0:t.x=1/c,Math.abs(l)<o.EPSILON?t.y=0:t.y=1/l,Math.abs(h)<o.EPSILON?t.z=0:t.z=1/h,Math.abs(u)<o.EPSILON?t.w=0:t.w=1/u,t;},Vec4.normalize=function(t,e){c=e.x,l=e.y,h=e.z,u=e.w;e=c*c+l*l+h*h+u*u;return 0<e&&(e=1/Math.sqrt(e),t.x=c*e,t.y=l*e,t.z=h*e,t.w=u*e),t;},Vec4.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w;},Vec4.lerp=function(t,e,i,r){return t.x=e.x+r*(i.x-e.x),t.y=e.y+r*(i.y-e.y),t.z=e.z+r*(i.z-e.z),t.w=e.w+r*(i.w-e.w),t;},Vec4.random=function(t,e){e=e||1;var i=2*(0,o.random)()*Math.PI;var r=2*(0,o.random)()-1;var n=Math.sqrt(1-r*r);return t.x=n*Math.cos(i)*e,t.y=n*Math.sin(i)*e,t.z=r*e,t.w=0,t;},Vec4.transformMat4=function(t,e,i){c=e.x,l=e.y,h=e.z,u=e.w;e=i.m;return t.x=e[0]*c+e[4]*l+e[8]*h+e[12]*u,t.y=e[1]*c+e[5]*l+e[9]*h+e[13]*u,t.z=e[2]*c+e[6]*l+e[10]*h+e[14]*u,t.w=e[3]*c+e[7]*l+e[11]*h+e[15]*u,t;},Vec4.transformAffine=function(t,e,i){c=e.x,l=e.y,h=e.z,u=e.w;i=i.m;return t.x=i[0]*c+i[1]*l+i[2]*h+i[3]*u,t.y=i[4]*c+i[5]*l+i[6]*h+i[7]*u,t.x=i[8]*c+i[9]*l+i[10]*h+i[11]*u,t.w=e.w,t;},Vec4.transformQuat=function(t,e,i){var r=e.x,n=e.y,a=e.z;c=i.x,l=i.y,h=i.z;i=(u=i.w)*r+l*a-h*n;var o=u*n+h*r-c*a;var s=u*a+c*n-l*r;r=-c*r-l*n-h*a;return t.x=i*u+r*-c+o*-h-s*-l,t.y=o*u+r*-l+s*-c-i*-h,t.z=s*u+r*-h+i*-l-o*-c,t.w=e.w,t;},Vec4.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w;},Vec4.equals=function(t,e,i){return void 0===i&&(i=o.EPSILON),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=i*Math.max(1,Math.abs(t.w),Math.abs(e.w));},Vec4.toArray=function(t,e,i){return t[(i=void 0===i?0:i)+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t;},Vec4.fromArray=function(t,e,i){return t.x=e[(i=void 0===i?0:i)+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t;},e=Vec4,r=[{key:"ZERO",get:function(){return new Vec4(0,0,0,0);}},{key:"ONE",get:function(){return new Vec4(1,1,1,1);}},{key:"NEG_ONE",get:function(){return new Vec4(-1,-1,-1,-1);}}],(i=null)&&_defineProperties(e.prototype,i),r&&_defineProperties(e,r),t.clone=function(){return new Vec4(this.x,this.y,this.z,this.w);},t.set=function(t,e,i,r){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=r||0),this;},t.equals=function(t,e){return void 0===e&&(e=o.EPSILON),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w));},t.equals4f=function(t,e,i,r,n){return void 0===n&&(n=o.EPSILON),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-i)<=n*Math.max(1,Math.abs(this.z),Math.abs(i))&&Math.abs(this.w-r)<=n*Math.max(1,Math.abs(this.w),Math.abs(r));},t.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w;},t.strictEquals4f=function(t,e,i,r){return this.x===t&&this.y===e&&this.z===i&&this.w===r;},t.lerp=function(t,e){return c=this.x,l=this.y,h=this.z,u=this.w,this.x=c+e*(t.x-c),this.y=l+e*(t.y-l),this.z=h+e*(t.z-h),this.w=u+e*(t.w-u),this;},t.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")";},t.clampf=function(t,e){return this.x=(0,o.clamp)(this.x,t.x,e.x),this.y=(0,o.clamp)(this.y,t.y,e.y),this.z=(0,o.clamp)(this.z,t.z,e.z),this.w=(0,o.clamp)(this.w,t.w,e.w),this;},t.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this;},t.add=function(t,e){return(e=e||new Vec4()).x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,e;},t.subtract=function(t,e){return(e=e||new Vec4()).x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,e;},t.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this;},t.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this;},t.divide=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this;},t.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this;},t.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;},t.cross=function(t,e){e=e||new Vec4();var i=this.x,r=this.y,n=this.z;var a=t.x,o=t.y,t=t.z;return e.x=r*t-n*o,e.y=n*a-i*t,e.z=i*o-r*a,e;},t.len=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return Math.sqrt(t*t+e*e+i*i+r*r);},t.lengthSqr=function(){var t=this.x,e=this.y,i=this.z,r=this.w;return t*t+e*e+i*i+r*r;},t.normalizeSelf=function(){return this.normalize(this),this;},t.normalize=function(t){t=t||new Vec4(),c=this.x,l=this.y,h=this.z,u=this.w;var e=c*c+l*l+h*h+u*u;return 0<e&&(e=1/Math.sqrt(e),t.x=c*e,t.y=l*e,t.z=h*e,t.w=u*e),t;},t.transformMat4=function(t,e){e=e||new Vec4(),c=this.x,l=this.y,h=this.z,u=this.w;t=t.m;return e.x=t[0]*c+t[4]*l+t[8]*h+t[12]*u,e.y=t[1]*c+t[5]*l+t[9]*h+t[13]*u,e.z=t[2]*c+t[6]*l+t[10]*h+t[14]*u,e.w=t[3]*c+t[7]*l+t[11]*h+t[15]*u,e;},t.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w);},Vec4;}(a.default);function v4(t,e,i,r){return new n(t,e,i,r);}(e.default=n).sub=n.subtract,n.mul=n.multiply,n.div=n.divide,n.scale=n.multiplyScalar,n.mag=n.len,n.squaredMagnitude=n.lengthSqr,n.ZERO_R=n.ZERO,n.ONE_R=n.ONE,n.NEG_ONE_R=n.NEG_ONE,r.default.fastDefine("cc.Vec4",n,{x:0,y:0,z:0,w:0}),cc.v4=v4,cc.Vec4=n;},{"../platform/CCClass":189,"./utils":286,"./value-type":287}],291:[function(t,e,n){"use strict";var s=cc.js;function ZP1(e,t,i){e&&(i=i||s.getClassName(e),t.forEach(function(t){function error(){cc.errorID(1406,i,t);}s.getset(e.prototype,t,error,error);}));}function $P1(e,t,i){e&&t.forEach(function(t){s.getset(e,t,function(){cc.errorID(1406,i,t);});});}function FP1(i,t,e){if(i){var r="Sorry, "+(e||cc.js.getClassName(i))+".%s is removed, please use %s instead.";for(var n in t){var a;var o;!function(){function define(e,t){function accessor(t){cc.error(r,e,t);}Array.isArray(t)||(t=t.split(",").map(function(t){return t.trim();}));try{s.getset(i,e,accessor.bind(null,t[0]),t[1]&&accessor.bind(null,t[1]));}catch(t){}}a=t[n],"*"===n[0]?(define("g"+(o=n.slice(1)),a),define("s"+o,a)):n.split(",").map(function(t){return t.trim();}).forEach(function(t){define(t,a);});}();}}}function WP1(i,r,n){if(i)for(var a in n=n||s.getClassName(i),r)!function(){var t=a;var e=i[t];e&&(i[t]=function(){return cc.warn("Sorry, %s.%s is deprecated. Please use %s instead",n,t,r[t]),e.apply(this,arguments);});}();}s.get(cc,"info",function(){return cc.errorID(1400,"cc.info","cc.log"),cc.log;}),s.get(cc,"spriteFrameCache",function(){cc.errorID(1404);}),s.get(cc,"vmath",function(){return cc.warnID(1400,"cc.vmath","cc.math"),cc.math;}),s.get(cc.math,"vec2",function(){return cc.warnID(1400,"cc.vmath.vec2","cc.Vec2"),cc.Vec2;}),s.get(cc.math,"vec3",function(){return cc.warnID(1400,"cc.vmath.vec3","cc.Vec3"),cc.Vec3;}),s.get(cc.math,"vec4",function(){return cc.warnID(1400,"cc.vmath.vec4","cc.Vec4"),cc.Vec4;}),s.get(cc.math,"mat4",function(){return cc.warnID(1400,"cc.vmath.mat4","cc.Mat4"),cc.Mat4;}),s.get(cc.math,"mat3",function(){return cc.warnID(1400,"cc.vmath.mat3","cc.Mat3"),cc.Mat3;}),s.get(cc.math,"quat",function(){return cc.warnID(1400,"cc.vmath.quat","cc.Quat"),cc.Quat;}),s.get(cc.SpriteFrame.prototype,"_textureLoaded",function(){return cc.errorID(1400,"spriteFrame._textureLoaded","spriteFrame.textureLoaded()"),this.textureLoaded();}),ZP1(cc.SpriteFrame,["addLoadedEventListener"]),WP1(cc.Sprite.prototype,{setState:"cc.Sprite.setMaterial",getState:"cc.Sprite.getMaterial"},"cc.Sprite"),s.get(cc.SpriteFrame.prototype,"clearTexture",function(){return cc.errorID(1406,"cc.SpriteFrame","clearTexture"),function(){};}),s.get(cc,"textureCache",function(){cc.errorID(1406,"cc","textureCache");});var i=cc.Texture2D;s.get(i.prototype,"releaseTexture",function(){return cc.errorID(1400,"texture.releaseTexture()","texture.destroy()"),this.destroy;}),s.get(i.prototype,"getName",function(){return cc.errorID(1400,"texture.getName()","texture._glID"),function(){return this._glID||null;};}),s.get(i.prototype,"isLoaded",function(){return cc.errorID(1400,"texture.isLoaded function","texture.loaded property"),function(){return this.loaded;};}),s.get(i.prototype,"setAntiAliasTexParameters",function(){return cc.errorID(1400,"texture.setAntiAliasTexParameters()","texture.setFilters(cc.Texture2D.Filter.LINEAR, cc.Texture2D.Filter.LINEAR)"),function(){this.setFilters(i.Filter.LINEAR,i.Filter.LINEAR);};}),s.get(i.prototype,"setAliasTexParameters",function(){return cc.errorID(1400,"texture.setAntiAliasTexParameters()","texture.setFilters(cc.Texture2D.Filter.NEAREST, cc.Texture2D.Filter.NEAREST)"),function(){this.setFilters(i.Filter.NEAREST,i.Filter.NEAREST);};}),$P1(cc.macro,["ENABLE_GL_STATE_CACHE","FIX_ARTIFACTS_BY_STRECHING_TEXEL"],"cc.macro"),FP1(cc.macro,{PI:"Math.PI",PI2:"Math.PI * 2",FLT_MAX:"Number.MAX_VALUE",FLT_MIN:"Number.MIN_VALUE",UINT_MAX:"Number.MAX_SAFE_INTEGER"},"cc.macro"),$P1(cc.game,["CONFIG_KEY"],"cc.game"),$P1(cc.sys,["dumpRoot","cleanScript"],"cc.sys"),FP1(cc.Director,{EVENT_PROJECTION_CHANGED:"",EVENT_BEFORE_VISIT:"EVENT_AFTER_UPDATE",EVENT_AFTER_VISIT:"EVENT_BEFORE_DRAW"},"cc.Director"),WP1(cc.Director.prototype,{convertToGL:"cc.view.convertToLocationInView",convertToUI:"",getWinSize:"cc.winSize",getWinSizeInPixels:"cc.winSize",getVisibleSize:"cc.view.getVisibleSize",getVisibleOrigin:"cc.view.getVisibleOrigin",purgeCachedData:"cc.loader.releaseAll",setDepthTest:"cc.Camera.main.depth",setClearColor:"cc.Camera.main.backgroundColor",getRunningScene:"cc.director.getScene",getAnimationInterval:"cc.game.getFrameRate",setAnimationInterval:"cc.game.setFrameRate",isDisplayStats:"cc.debug.isDisplayStats",setDisplayStats:"cc.debug.setDisplayStats",stopAnimation:"cc.game.pause",startAnimation:"cc.game.resume"},"cc.Director"),ZP1(cc.Director,["pushScene","popScene","popToRootScene","popToSceneStackLevel","setProjection","getProjection"],"cc.Director"),FP1(cc.Scheduler,{scheduleCallbackForTarget:"schedule",scheduleUpdateForTarget:"scheduleUpdate",unscheduleCallbackForTarget:"unschedule",unscheduleUpdateForTarget:"unscheduleUpdate",unscheduleAllCallbacksForTarget:"unscheduleAllForTarget",unscheduleAllCallbacks:"unscheduleAll",unscheduleAllCallbacksWithMinPriority:"unscheduleAllWithMinPriority"},"cc.Scheduler"),FP1(cc.view,{adjustViewPort:"adjustViewportMeta",setViewPortInPoints:"setViewportInPoints",getViewPortRect:"getViewportRect"},"cc.view"),$P1(cc.view,["isViewReady","setTargetDensityDPI","getTargetDensityDPI","setFrameZoomFactor","canSetContentScaleFactor","setContentTranslateLeftTop","getContentTranslateLeftTop","setViewName","getViewName"],"cc.view"),ZP1(cc.Pipeline,["flowInDeps","getItems"],"cc.loader"),ZP1(cc.PhysicsManager,["attachDebugDrawToCamera","detachDebugDrawFromCamera"]),ZP1(cc.CollisionManager,["attachDebugDrawToCamera","detachDebugDrawFromCamera"]),FP1(cc._BaseNode.prototype,{tag:"name",getTag:"name",setTag:"name",getChildByTag:"getChildByName",removeChildByTag:"getChildByName(name).destroy()"}),ZP1(cc.Node,["_cascadeColorEnabled","cascadeColor","isCascadeColorEnabled","setCascadeColorEnabled","_cascadeOpacityEnabled","cascadeOpacity","isCascadeOpacityEnabled","setCascadeOpacityEnabled","opacityModifyRGB","isOpacityModifyRGB","setOpacityModifyRGB","ignoreAnchor","isIgnoreAnchorPointForPosition","ignoreAnchorPointForPosition","isRunning","_sgNode"]),WP1(cc.Node.prototype,{getNodeToParentTransform:"getLocalMatrix",getNodeToParentTransformAR:"getLocalMatrix",getNodeToWorldTransform:"getWorldMatrix",getNodeToWorldTransformAR:"getWorldMatrix",getParentToNodeTransform:"getLocalMatrix",getWorldToNodeTransform:"getWorldMatrix",convertTouchToNodeSpace:"convertToNodeSpaceAR",convertTouchToNodeSpaceAR:"convertToNodeSpaceAR",convertToWorldSpace:"convertToWorldSpaceAR",convertToNodeSpace:"convertToNodeSpaceAR"}),FP1(cc.Node.prototype,{getRotationX:"rotationX",setRotationX:"rotationX",getRotationY:"rotationY",setRotationY:"rotationY",getPositionX:"x",setPositionX:"x",getPositionY:"y",setPositionY:"y",getSkewX:"skewX",setSkewX:"skewX",getSkewY:"skewY",setSkewY:"skewY",getScaleX:"scaleX",setScaleX:"scaleX",getScaleY:"scaleY",setScaleY:"scaleY",getOpacity:"opacity",setOpacity:"opacity",getColor:"color",setColor:"color",getLocalZOrder:"zIndex",setLocalZOrder:"zIndex"}),FP1(cc.Sprite.prototype,{setInsetLeft:"cc.SpriteFrame insetLeft",setInsetRight:"cc.SpriteFrame insetRight",setInsetTop:"cc.SpriteFrame insetTop",setInsetBottom:"cc.SpriteFrame insetBottom"}),cc.Material.getInstantiatedBuiltinMaterial=cc.MaterialVariant.createWithBuiltin,cc.Material.getInstantiatedMaterial=cc.MaterialVariant.create,WP1(cc.Material,{getInstantiatedBuiltinMaterial:"cc.MaterialVariant.createWithBuiltin",getInstantiatedMaterial:"cc.MaterialVariant.create"}),cc.js.getset(cc.RenderComponent.prototype,"sharedMaterials",function(){return cc.warnID(1400,"sharedMaterials","getMaterials"),this.materials;},function(t){cc.warnID(1400,"sharedMaterials","setMaterial"),this.materials=t;}),WP1(cc.Camera.prototype,{getNodeToCameraTransform:"getWorldToScreenMatrix2D",getCameraToWorldPoint:"getScreenToWorldPoint",getWorldToCameraPoint:"getWorldToScreenPoint",getCameraToWorldMatrix:"getScreenToWorldMatrix2D",getWorldToCameraMatrix:"getWorldToScreenMatrix2D"}),ZP1(cc.Camera,["addTarget","removeTarget","getTargets"]);var r='"%s" is not defined in the Scene, it is only defined in normal nodes.';Object.defineProperties(cc.Scene.prototype,{active:{get:function(){return cc.error(r,"active"),!0;},set:function(){cc.error(r,"active");}},activeInHierarchy:{get:function(){return cc.error(r,"activeInHierarchy"),!0;}},getComponent:{get:function(){return cc.error(r,"getComponent"),function(){return null;};}},addComponent:{get:function(){return cc.error(r,"addComponent"),function(){return null;};}}}),$P1(cc.dynamicAtlasManager,["minFrameSize"],"cc.dynamicAtlasManager"),cc.Light&&$P1(cc.Light.prototype,["shadowDepthScale"],"cc.Light.prototype"),FP1(cc,{affineTransformMake:"cc.AffineTransform.create",affineTransformMakeIdentity:"cc.AffineTransform.identity",affineTransformClone:"cc.AffineTransform.clone",affineTransformConcat:"cc.AffineTransform.concat",affineTransformConcatIn:"cc.AffineTransform.concat",affineTransformInvert:"cc.AffineTransform.invert",affineTransformInvertIn:"cc.AffineTransform.invert",affineTransformInvertOut:"cc.AffineTransform.invert",affineTransformEqualToTransform:"cc.AffineTransform.equal",pointApplyAffineTransform:"cc.AffineTransform.transformVec2",sizeApplyAffineTransform:"cc.AffineTransform.transformSize",rectApplyAffineTransform:"cc.AffineTransform.transformRect",obbApplyAffineTransform:"cc.AffineTransform.transformObb",pointEqualToPoint:"cc.Vec2 equals",sizeEqualToSize:"cc.Size equals",rectEqualToRect:"rectA.equals(rectB)",rectContainsRect:"rectA.containsRect(rectB)",rectContainsPoint:"rect.contains(vec2)",rectOverlapsRect:"rectA.intersects(rectB)",rectIntersectsRect:"rectA.intersects(rectB)",rectIntersection:"rectA.intersection(intersection, rectB)",rectUnion:"rectA.union(union, rectB)",rectGetMaxX:"rect.xMax",rectGetMidX:"rect.center.x",rectGetMinX:"rect.xMin",rectGetMaxY:"rect.yMax",rectGetMidY:"rect.center.y",rectGetMinY:"rect.yMin",colorEqual:"colorA.equals(colorB)",hexToColor:"color.fromHEX(hexColor)",colorToHex:"color.toHEX()",TextAlignment:"cc.macro.TextAlignment",VerticalTextAlignment:"cc.macro.VerticalTextAlignment",pNeg:"p.neg()",pAdd:"p1.add(p2)",pSub:"p1.sub(p2)",pMult:"p.mul(factor)",pMidpoint:"p1.add(p2).mul(0.5)",pDot:"p1.dot(p2)",pCross:"p1.cross(p2)",pPerp:"p.rotate(-90 * Math.PI / 180)",pRPerp:"p.rotate(90 * Math.PI / 180)",pProject:"p1.project(p2)",pLengthSQ:"p.magSqr()",pDistanceSQ:"p1.sub(p2).magSqr()",pLength:"p.mag()",pDistance:"p1.sub(p2).mag()",pNormalize:"p.normalize()",pForAngle:"cc.v2(Math.cos(a), Math.sin(a))",pToAngle:"Math.atan2(v.y, v.x)",pZeroIn:"p.x = p.y = 0",pIn:"p1.set(p2)",pMultIn:"p.mulSelf(factor)",pSubIn:"p1.subSelf(p2)",pAddIn:"p1.addSelf(p2)",pNormalizeIn:"p.normalizeSelf()",pSameAs:"p1.equals(p2)",pAngle:"v1.angle(v2)",pAngleSigned:"v1.signAngle(v2)",pRotateByAngle:"p.rotate(radians)",pCompMult:"v1.dot(v2)",pFuzzyEqual:"v1.fuzzyEquals(v2, tolerance)",pLerp:"p.lerp(endPoint, ratio)",pClamp:"p.clampf(min_inclusive, max_inclusive)",rand:"Math.random() * 0xffffff",randomMinus1To1:"(Math.random() - 0.5) * 2",container:"cc.game.container",_canvas:"cc.game.canvas",_renderType:"cc.game.renderType",_getError:"cc.debug.getError",_initDebugSetting:"cc.debug._resetDebugSetting",DebugMode:"cc.debug.DebugMode"},"cc"),$P1(cc,["blendFuncDisable","pFromSize","pCompOp","pIntersectPoint","pSegmentIntersect","pLineIntersect","obbApplyMatrix","getImageFormatByData","initEngine"],"cc"),WP1(cc,{p:"cc.v2"},"cc"),FP1(cc.Rect,{contain:"rectA.contains(rectB)",transformMat4:"rect.transformMat4(out, mat4)"}),FP1(cc.Color,{rgb2hsv:"color.toHSV()",hsv2rgb:"color.fromHSV(h, s, v)"}),s.get(cc,"lerp",function(){return cc.errorID(1400,"cc.lerp","cc.misc.lerp"),cc.misc.lerp;}),s.get(cc,"random0To1",function(){return cc.errorID(1400,"cc.random0To1","Math.random"),Math.random;}),s.get(cc,"degreesToRadians",function(){return cc.errorID(1400,"cc.degreesToRadians","cc.misc.degreesToRadians"),cc.misc.degreesToRadians;}),s.get(cc,"radiansToDegrees",function(){return cc.errorID(1400,"cc.radiansToDegrees","cc.misc.radiansToDegrees"),cc.misc.radiansToDegrees;}),s.get(cc,"clampf",function(){return cc.errorID(1400,"cc.clampf","cc.misc.clampf"),cc.misc.clampf;}),s.get(cc,"clamp01",function(){return cc.errorID(1400,"cc.clamp01","cc.misc.clamp01"),cc.misc.clamp01;}),s.get(cc,"ImageFormat",function(){return cc.errorID(1400,"cc.ImageFormat","cc.macro.ImageFormat"),cc.macro.ImageFormat;}),s.get(cc,"KEY",function(){return cc.errorID(1400,"cc.KEY","cc.macro.KEY"),cc.macro.KEY;}),s.get(cc,"Easing",function(){return cc.errorID(1400,"cc.Easing","cc.easing"),cc.easing;}),s.get(cc,"isChildClassOf",function(){return cc.errorID(1400,"cc.isChildClassOf","cc.js.isChildClassOf"),cc.js.isChildClassOf;}),"undefined"!=typeof dragonBones&&s.get(dragonBones.CCFactory,"getFactory",function(){return cc.errorID(1400,"dragonBones.CCFactory.getFactory","dragonBones.CCFactory.getInstance"),dragonBones.CCFactory.getInstance;}),cc.renderer.renderEngine={get gfx(){return cc.warnID(1400,"cc.renderer.renderEngine.gfx","cc.gfx"),cc.gfx;},get math(){return cc.warnID(1400,"cc.renderer.renderEngine.math","cc.math"),cc.vmath;},get InputAssembler(){return cc.warnID(1400,"cc.renderer.renderEngine.InputAssembler","cc.renderer.InputAssembler"),cc.renderer.InputAssembler;}};},{}],292:[function(t,e,i){"use strict";t("./core/CCGame"),t("./actions");},{"./actions":8,"./core/CCGame":29}],293:[function(t,e,i){"use strict";var x=t("../compression/zlib.min");var A=t("../core/CCDebug");function Tr1(t){var e,i,r,n,h,a,o,s,c,l;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},r=null;;){switch(e=this.readUInt32(),h=function(){var t,e;for(e=[],t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e;}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":r&&this.animation.frames.push(r),this.pos+=4,r={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},o=this.readUInt16(),n=this.readUInt16()||100,r.delay=1e3*o/n,r.disposeOp=this.data[this.pos++],r.blendOp=this.data[this.pos++],r.data=[];break;case"IDAT":case"fdAT":for("fdAT"===h&&(this.pos+=4,e-=4),t=(null!=r?r.data:void 0)||this.imgData,s=0;0<=e?s<e:e<s;0<=e?++s:--s)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),0<(a=255-this.transparency.indexed.length))for(c=0;0<=a?c<a:a<c;0<=a?++c:--c)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e);}break;case"tEXt":n=(o=this.read(e)).indexOf(0),l=String.fromCharCode.apply(String,o.slice(0,n)),this.text[l]=String.fromCharCode.apply(String,o.slice(n+1));break;case"IEND":return r&&this.animation.frames.push(r),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3;}}.call(this),this.hasAlphaChannel=4===(l=this.colorType)||6===l,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB";}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e;}if(this.pos+=4,this.pos>this.data.length)throw new Error(A.getError(6017));}}Tr1.prototype={constructor:Tr1,read:function(t){var e,i;for(i=[],e=0;0<=t?e<t:t<e;0<=t?++e:--e)i.push(this.data[this.pos++]);return i;},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++];},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++];},decodePixels:function(t){var e,i,h,r,u,_,d,f,p,n,a,o,s,c,l,m,v,y,g,b,C;if(0===(t=null==t?this.imgData:t).length)return new Uint8Array(0);for(t=new x.Inflate(t,{index:0,verify:!1}).decompress(),c=(n=this.pixelBitlength/8)*this.width,a=new Uint8Array(c*this.height),_=t.length,i=o=s=0;o<_;){switch(t[o++]){case 0:for(r=v=0;v<c;r=v+=1)a[i++]=t[o++];break;case 1:for(r=y=0;y<c;r=y+=1)e=t[o++],u=r<n?0:a[i-n],a[i++]=(e+u)%256;break;case 2:for(r=g=0;g<c;r=g+=1)e=t[o++],h=(r-r%n)/n,l=s&&a[(s-1)*c+h*n+r%n],a[i++]=(l+e)%256;break;case 3:for(r=b=0;b<c;r=b+=1)e=t[o++],h=(r-r%n)/n,u=r<n?0:a[i-n],l=s&&a[(s-1)*c+h*n+r%n],a[i++]=(e+Math.floor((u+l)/2))%256;break;case 4:for(r=C=0;C<c;r=C+=1)e=t[o++],h=(r-r%n)/n,u=r<n?0:a[i-n],0===s?l=m=0:(l=a[(s-1)*c+h*n+r%n],m=h&&a[(s-1)*c+(h-1)*n+r%n]),p=u+l-m,d=Math.abs(p-u),f=Math.abs(p-l),p=Math.abs(p-m),a[i++]=(e+(d<=f&&d<=p?u:f<=p?l:m))%256;break;default:throw new Error(A.getError(6018,t[o-1]));}s++;}return a;},copyToImageData:function(h,t){var e,i,r,n,a,o,s,u,c,l,_;if(i=this.colors,c=null,e=this.hasAlphaChannel,this.palette.length&&(c=null!=(_=this._decodedPalette)?_:this._decodedPalette=this.decodePalette(),i=4,e=!0),u=(r=h.data||h).length,a=c||t,n=o=0,1===i)for(;n<u;)s=c?4*t[n/4]:o,l=a[s++],r[n++]=l,r[n++]=l,r[n++]=l,r[n++]=e?a[s++]:255,o=s;else for(;n<u;)s=c?4*t[n/4]:o,r[n++]=a[s++],r[n++]=a[s++],r[n++]=a[s++],r[n++]=e?a[s++]:255,o=s;},decodePalette:function(){var t,e,i,r,n,a,o,s,c;for(i=this.palette,a=this.transparency.indexed||[],n=new Uint8Array((a.length||0)+i.length),e=o=t=r=0,s=i.length;o<s;e=o+=3)n[r++]=i[e],n[r++]=i[e+1],n[r++]=i[e+2],n[r++]=null!=(c=a[t++])?c:255;return n;},render:function(t){var e;return t.width=this.width,t.height=this.height,e=(t=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0);}},e.exports=Tr1;},{"../compression/zlib.min":26,"../core/CCDebug":27}],294:[function(t,e,i){"use strict";var r=t("../core/assets/CCAsset");t=t("../core/assets/CCSpriteFrame");r=cc.Class({name:"cc.ParticleAsset",extends:r,properties:{spriteFrame:{default:null,type:t}}});cc.ParticleAsset=e.exports=r;},{"../core/assets/CCAsset":34,"../core/assets/CCSpriteFrame":47}],295:[function(t,e,h){"use strict";var o=t("../core/platform/CCMacro");var i=t("./CCParticleAsset");var u=t("../core/components/CCRenderComponent");var _=t("../compression/ZipUtils");var s=t("./CCPNGReader");var c=t("./CCTIFFReader");var l=t("../core/utils/texture-util");t("../core/renderer/render-flow");var d=t("./particle-simulator");t("../core/assets/material/CCMaterial");var r=t("../core/utils/blend-func");var n=cc.Enum({GRAVITY:0,RADIUS:1});var a=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2});t={preview:{default:!0,editorOnly:!0,notify:!1,animatable:!1,tooltip:!1},_custom:!1,custom:{get:function(){return this._custom;},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile());},animatable:!1,tooltip:!1},_file:{default:null,type:i},file:{get:function(){return this._file;},set:function(t,e){this._file!==t&&((this._file=t)?this._applyFile():this.custom=!0);},animatable:!1,type:i,tooltip:!1},_spriteFrame:{default:null,type:cc.SpriteFrame},spriteFrame:{get:function(){return this._spriteFrame;},set:function(t,e){var i=this._renderSpriteFrame;i!==t&&((this._renderSpriteFrame=t)&&!t._uuid||(this._spriteFrame=t),(i&&i.getTexture())!==(t&&t.getTexture())&&this._applySpriteFrame(i));},type:cc.SpriteFrame,tooltip:!1},_texture:{default:null,type:cc.Texture2D,editorOnly:!0},texture:{get:function(){return this._getTexture();},set:function(t){t&&cc.warnID(6017);},type:cc.Texture2D,tooltip:!1,readonly:!0,visible:!1,animatable:!1},particleCount:{visible:!1,get:function(){return this._simulator.particles.length;},readonly:!0},_stopped:!0,stopped:{get:function(){return this._stopped;},animatable:!1,visible:!1},playOnLoad:!0,autoRemoveOnFinish:{default:!1,animatable:!1,tooltip:!1},active:{get:function(){return this._simulator.active;},visible:!1},totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,_startColor:null,startColor:{type:cc.Color,get:function(){return this._startColor;},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a;}},_startColorVar:null,startColorVar:{type:cc.Color,get:function(){return this._startColorVar;},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a;}},_endColor:null,endColor:{type:cc.Color,get:function(){return this._endColor;},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a;}},_endColorVar:null,endColorVar:{type:cc.Color,get:function(){return this._endColorVar;},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a;}},angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.Vec2.ZERO,posVar:cc.Vec2.ZERO,_positionType:{default:a.FREE,formerlySerializedAs:"positionType"},positionType:{type:a,get:function(){return this._positionType;},set:function(t){this._positionType=t,this._updateMaterial();}},emitterMode:{default:n.GRAVITY,type:n},gravity:cc.Vec2.ZERO,speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0};i=cc.Class({name:"cc.ParticleSystem",extends:u,mixins:[r],editor:!1,ctor:function(){this.initProperties();},initProperties:function(){this._previewTimer=null,this._focused=!1,this._aspectRatio=1,this._simulator=new d(this),this._startColor=cc.color(255,255,255,255),this._startColorVar=cc.color(0,0,0,0),this._endColor=cc.color(255,255,255,0),this._endColorVar=cc.color(0,0,0,0),this._renderSpriteFrame=null;},properties:t,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:n,PositionType:a,_PNGReader:s,_TIFFReader:c},onFocusInEditor:!1,onLostFocusInEditor:!1,_startPreview:!1,_stopPreview:!1,_convertTextureToSpriteFrame:!1,__preload:function(){this._super(),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame(this.spriteFrame):this._file&&(this._custom&&this._getTexture()||this._applyFile()),this.playOnLoad&&this.resetSystem();},onDestroy:function(){this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._simulator._uvFilled=0,this._super();},lateUpdate:function(t){this._simulator.finished||this._simulator.step(t);},addParticle:function(){},stopSystem:function(){this._stopped=!0,this._simulator.stop();},resetSystem:function(){this._stopped=!1,this._simulator.reset(),this.markForRender(!0);},isFull:function(){return this.particleCount>=this.totalParticles;},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this.spriteFrame=new cc.SpriteFrame(t,e));},_applyFile:function(){var i=this._file;var r;i&&(r=this,cc.loader.load(i.nativeUrl,function(t,e){!t&&e?r.isValid&&(r._plistFile=i.nativeUrl,r._custom||r._initWithDictionary(e),r._spriteFrame?!r._renderSpriteFrame&&r._spriteFrame&&r._applySpriteFrame(r.spriteFrame):i.spriteFrame?r.spriteFrame=i.spriteFrame:r._custom&&r._initTextureWithDictionary(e)):cc.errorID(6029);}));},_initTextureWithDictionary:function(i){var t=cc.path.changeBasename(this._plistFile,i.textureFileName||"");if(i.textureFileName)l.loadImage(t,function(t,e){t?(i.textureFileName=void 0,this._initTextureWithDictionary(i)):this.spriteFrame=new cc.SpriteFrame(e);},this);else if(i.textureImageData){var e=i.textureImageData;if(!(e&&0<e.length))return!1;var r=cc.loader.getRes(t);if(!r){e=_.unzipBase64AsArray(e,1);if(!e)return cc.logID(6030),!1;a=8<(a=e).length&&137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&13===a[4]&&10===a[5]&&26===a[6]&&10===a[7]?o.ImageFormat.PNG:2<a.length&&(73===a[0]&&73===a[1]||77===a[0]&&77===a[1]||255===a[0]&&216===a[1])?o.ImageFormat.TIFF:o.ImageFormat.UNKNOWN;if(a!==o.ImageFormat.TIFF&&a!==o.ImageFormat.PNG)return cc.logID(6031),!1;var n=document.createElement("canvas");a===o.ImageFormat.PNG?new s(e).render(n):c.parseTIFF(e,n),r=l.cacheImage(t,n);}r||cc.logID(6032),this.spriteFrame=new cc.SpriteFrame(r);}var a;return!0;},_initWithDictionary:function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this.srcBlendFactor=parseInt(t.blendFuncSource||o.SRC_ALPHA),this.dstBlendFactor=parseInt(t.blendFuncDestination||o.ONE_MINUS_SRC_ALPHA);e=this._startColor;e.r=255*parseFloat(t.startColorRed||0),e.g=255*parseFloat(t.startColorGreen||0),e.b=255*parseFloat(t.startColorBlue||0),e.a=255*parseFloat(t.startColorAlpha||0);e=this._startColorVar;e.r=255*parseFloat(t.startColorVarianceRed||0),e.g=255*parseFloat(t.startColorVarianceGreen||0),e.b=255*parseFloat(t.startColorVarianceBlue||0),e.a=255*parseFloat(t.startColorVarianceAlpha||0);e=this._endColor;e.r=255*parseFloat(t.finishColorRed||0),e.g=255*parseFloat(t.finishColorGreen||0),e.b=255*parseFloat(t.finishColorBlue||0),e.a=255*parseFloat(t.finishColorAlpha||0);e=this._endColorVar;if(e.r=255*parseFloat(t.finishColorVarianceRed||0),e.g=255*parseFloat(t.finishColorVarianceGreen||0),e.b=255*parseFloat(t.finishColorVarianceBlue||0),e.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:a.RELATIVE),this.sourcePos.x=0,this.sourcePos.y=0,this.posVar.x=parseFloat(t.sourcePositionVariancex||0),this.posVar.y=parseFloat(t.sourcePositionVariancey||0),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||n.GRAVITY),this.emitterMode===n.GRAVITY){this.gravity.x=parseFloat(t.gravityx||0),this.gravity.y=parseFloat(t.gravityy||0),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);e=t.rotationIsDir||"";null!==e?(e=e.toString().toLowerCase(),this.rotationIsDir="true"===e||"1"===e):this.rotationIsDir=!1;}else{if(this.emitterMode!==n.RADIUS)return cc.warnID(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0);}return this._initTextureWithDictionary(t),!0;},_validateRender:function(){var t=this._getTexture();t&&t.loaded?this._super():this.disableRender();},_onTextureLoaded:function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this.markForRender(!0);},_syncAspect:function(){var t=this._renderSpriteFrame._rect;this._aspectRatio=t.width/t.height;},_applySpriteFrame:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame&&(this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.onTextureLoaded(this._onTextureLoaded,this));},_getTexture:function(){return this._renderSpriteFrame&&this._renderSpriteFrame.getTexture()||this._texture;},_updateMaterial:function(){var t=this.getMaterial(0);t&&(t.define("CC_USE_MODEL",this._positionType!==a.FREE),t.setProperty("texture",this._getTexture()),r.prototype._updateMaterial.call(this));},_finishedSimulation:function(){this.resetSystem(),this.stopSystem(),this.disableRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy();}});cc.ParticleSystem=e.exports=i;},{"../compression/ZipUtils":23,"../core/assets/material/CCMaterial":53,"../core/components/CCRenderComponent":89,"../core/platform/CCMacro":194,"../core/renderer/render-flow":221,"../core/utils/blend-func":257,"../core/utils/texture-util":272,"./CCPNGReader":293,"./CCParticleAsset":294,"./CCTIFFReader":296,"./particle-simulator":298,"fire-url":void 0}],296:[function(t,e,i){"use strict";var tt=t("../core/CCDebug");e.exports={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t];},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1];},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(tt.getError(6019));this.littleEndian=!1;}return this.littleEndian;},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError(tt.getError(6020));return!0;},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null;},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(cc.logID(6021,t),"Tag"+t);},getFieldTypeLength:function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:null;},getFieldValues:function(t,e,i,r){var n=[];var a=this.getFieldTypeLength(e);if(a*i<=4)!1===this.littleEndian?n.push(r>>>8*(4-a)):n.push(r);else for(var o=0;o<i;o++){var s=a*o;8<=a?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(n.push(this.getUint32(r+s)),n.push(this.getUint32(r+s+4))):cc.logID(8e3):n.push(this.getBytes(a,r+s));}return"ASCII"===e&&n.forEach(function(t,e,i){i[e]=String.fromCharCode(t);}),n;},getBytes:function(t,e){if(!(t<=0))return t<=1?this.getUint8(e):t<=2?this.getUint16(e):t<=3?this.getUint32(e)>>>8:t<=4?this.getUint32(e):void cc.logID(8002);cc.logID(8001);},getBits:function(t,e,i){i=i||0;e+=Math.floor(i/8);var r=i+t;t=32-t;var n,a;return r<=0?cc.logID(6023):r<=8?(n=24+i,a=this.getUint8(e)):r<=16?(n=16+i,a=this.getUint16(e)):r<=32?(n=i,a=this.getUint32(e)):cc.logID(6022),{bits:a<<n>>>t,byteOffset:e+Math.floor(r/8),bitOffset:r%8};},parseFileDirectory:function(t){var e=this.getUint16(t);var i=[];for(var r=t+2,n=0;n<e;r+=12,n++){var a=this.getUint16(r);var o=this.getUint16(r+2);var s=this.getUint32(r+4);var c=this.getUint32(r+8);a=this.getFieldTagName(a);o=this.getFieldTypeName(o);s=this.getFieldValues(a,o,s,c);i[a]={type:o,values:s};}this._fileDirectories.push(i);t=this.getUint32(r);0!==t&&this.parseFileDirectory(t);},clampColorSample:function(t,e){e=Math.pow(2,8-e);return Math.floor(t*e+(e-1));},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){t=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(t);t=this._fileDirectories[0];var h=t.ImageWidth.values[0];var i=t.ImageLength.values[0];this.canvas.width=h,this.canvas.height=i;var r=[];var u=t.Compression?t.Compression.values[0]:1;var _=t.SamplesPerPixel.values[0];var n=[];var d=0;var f=!1;var p;t.BitsPerSample.values.forEach(function(t,e,i){n[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(n[e].hasBytesPerSample=!0,n[e].bytesPerSample=t/8),d+=t;},this),d%8==0&&(f=!0,p=d/8);var m=t.StripOffsets.values;var v=m.length;if(t.StripByteCounts)var y=t.StripByteCounts.values;else{if(cc.logID(8003),1!==v)throw Error(tt.getError(6024));y=[Math.ceil(h*i*d/8)];}for(var a=0;a<v;a++){var g=m[a];r[a]=[];var b=y[a];for(var o=0,C=0,x=1,A=!0,s=[],S=0,T=0,w=0;o<b;o+=x)switch(u){case 1:for(var c=0,s=[];c<_;c++){if(!n[c].hasBytesPerSample)throw E=this.getBits(n[c].bitsPerSample,g+o,C),s.push(E.bits),o=E.byteOffset-g,C=E.bitOffset,RangeError(tt.getError(6025));var E=n[c].bytesPerSample*c;s.push(this.getBytes(n[c].bytesPerSample,g+o+E));}if(r[a].push(s),!f)throw x=0,RangeError(tt.getError(6026));x=p;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(A){A=!1;var P=1;var M=1;var R=this.getInt8(g+o);0<=R&&R<=127?P=R+1:-127<=R&&R<=-1?M=1-R:A=!0;}else{var I=this.getUint8(g+o);for(c=0;c<M;c++){if(!n[T].hasBytesPerSample)throw RangeError(tt.getError(6025));w=w<<8*S|I,++S===n[T].bytesPerSample&&(s.push(w),w=S=0,T++),T===_&&(r[a].push(s),s=[],T=0);}0===--P&&(A=!0);}x=1;}}if(e.getContext){var B=this.canvas.getContext("2d");B.fillStyle="rgba(255, 255, 255, 0)";e=t.RowsPerStrip?t.RowsPerStrip.values[0]:i;var D=r.length;i=i%e;var L=0==i?e:i;var V=e;var O=0;var F=t.PhotometricInterpretation.values[0];var N=[];var k=0;var G,z;t.ExtraSamples&&(k=(N=t.ExtraSamples.values).length),t.ColorMap&&(G=t.ColorMap.values,z=Math.pow(2,n[0].bitsPerSample));for(a=0;a<D;a++){a+1===D&&(V=L);var U=r[a].length;var W=O*a;for(var H=0,j=0;j<U;H++)for(var X=0;X<h;X++,j++){var l=r[a][j];var q=0;var Y=0;var J=0;var Z=1;if(0<k)for(var Q=0;Q<k;Q++)if(1===N[Q]||2===N[Q]){Z=l[3+Q]/256;break;}switch(F){case 0:var K;n[0].hasBytesPerSample&&(K=Math.pow(16,2*n[0].bytesPerSample)),l.forEach(function(t,e,i){i[e]=K-t;});case 1:q=Y=J=this.clampColorSample(l[0],n[0].bitsPerSample);break;case 2:q=this.clampColorSample(l[0],n[0].bitsPerSample),Y=this.clampColorSample(l[1],n[1].bitsPerSample),J=this.clampColorSample(l[2],n[2].bitsPerSample);break;case 3:if(void 0===G)throw Error(tt.getError(6027));var $=l[0];q=this.clampColorSample(G[$],16),Y=this.clampColorSample(G[z+$],16),J=this.clampColorSample(G[2*z+$],16);break;default:throw RangeError(tt.getError(6028,F));}B.fillStyle="rgba("+q+", "+Y+", "+J+", "+Z+")",B.fillRect(X,W+H,1,1);}O=V;}}return this.canvas;}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};},{"../core/CCDebug":27}],297:[function(t,e,i){"use strict";t("./CCParticleAsset"),t("./CCParticleSystem"),t("./particle-simulator"),t("./particle-system-assembler");},{"./CCParticleAsset":294,"./CCParticleSystem":295,"./particle-simulator":298,"./particle-system-assembler":299}],298:[function(t,e,i){"use strict";var m=t("../core/utils/affine-transform");var r=t("../core/platform/js");var v=t("../core/utils/misc");var y=cc.v2(0,0);var g=m.create();var b=cc.v2();var C=cc.v2();var x=cc.v2();var A=cc.v2();function _D1(){this.pos=cc.v2(0,0),this.startPos=cc.v2(0,0),this.color=cc.color(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=cc.v2(0,0),this.aspectRatio=1,this.dir=cc.v2(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0;}var S=new r.Pool(function(t){t.pos.set(y),t.startPos.set(y),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(y),t.aspectRatio=1,t.dir.set(y),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0;},1024);S.get=function(){return this._get()||new _D1();};function qD1(t){this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this._uvFilled=0;}qD1.prototype.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0;},qD1.prototype.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;var t=this.particles;for(var e=0;e<t.length;++e)S.put(t[e]);t.length=0;},qD1.prototype.emitParticle=function(h){var t=this.sys;var e=v.clampf;var i=S.get();this.particles.push(i),i.timeToLive=t.life+t.lifeVar*(Math.random()-.5)*2;var r=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=t.sourcePos.x+t.posVar.x*(Math.random()-.5)*2,i.pos.y=t.sourcePos.y+t.posVar.y*(Math.random()-.5)*2;var n=t._startColor,a=t._startColorVar;var o=t._endColor,s=t._endColorVar;i.color.r=l=e(n.r+a.r*(Math.random()-.5)*2,0,255),i.color.g=c=e(n.g+a.g*(Math.random()-.5)*2,0,255),i.color.b=u=e(n.b+a.b*(Math.random()-.5)*2,0,255),i.color.a=n=e(n.a+a.a*(Math.random()-.5)*2,0,255),i.deltaColor.r=(e(o.r+s.r*(Math.random()-.5)*2,0,255)-l)/r,i.deltaColor.g=(e(o.g+s.g*(Math.random()-.5)*2,0,255)-c)/r,i.deltaColor.b=(e(o.b+s.b*(Math.random()-.5)*2,0,255)-u)/r,i.deltaColor.a=(e(o.a+s.a*(Math.random()-.5)*2,0,255)-n)/r;a=t.startSize+t.startSizeVar*(Math.random()-.5)*2;a=Math.max(0,a),i.size=a,t.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?i.deltaSize=0:(l=t.endSize+t.endSizeVar*(Math.random()-.5)*2,l=Math.max(0,l),i.deltaSize=(l-a)/r);var c=t.startSpin+t.startSpinVar*(Math.random()-.5)*2;var u=t.endSpin+t.endSpinVar*(Math.random()-.5)*2;i.rotation=c,i.deltaRotation=(u-c)/r,i.startPos.x=h.x,i.startPos.y=h.y,i.aspectRatio=t._aspectRatio||1;e=function(t){var e=0;var i=t;for(;i;)e+=i.angle,i=i.parent;return e;}(t.node);o=t.positionType===cc.ParticleSystem.PositionType.FREE?t.angle+e:t.angle;s=v.degreesToRadians(o+t.angleVar*(Math.random()-.5)*2);var l;t.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(n=t.speed+t.speedVar*(Math.random()-.5)*2,i.dir.x=Math.cos(s),i.dir.y=Math.sin(s),i.dir.mulSelf(n),i.radialAccel=t.radialAccel+t.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=t.tangentialAccel+t.tangentialAccelVar*(Math.random()-.5)*2,t.rotationIsDir&&(i.rotation=-v.radiansToDegrees(Math.atan2(i.dir.y,i.dir.x)))):(l=t.startRadius+t.startRadiusVar*(Math.random()-.5)*2,a=t.endRadius+t.endRadiusVar*(Math.random()-.5)*2,i.radius=l,i.deltaRadius=t.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(a-l)/r,i.angle=s,i.degreesPerSecond=v.degreesToRadians(t.rotatePerS+t.rotatePerSVar*(Math.random()-.5)*2));},qD1.prototype.updateUVs=function(t){var e=this.sys._assembler;if(e){var i=e.getBuffer();if(i&&this.sys._renderSpriteFrame){var r=4*e._vfmt._bytes/4;var n=i._vData;var a=this.sys._renderSpriteFrame.uv;e=t?0:this._uvFilled;var o=this.particles.length;for(var s=e;s<o;s++){var c=s*r;n[2+c]=a[0],n[3+c]=a[1],n[7+c]=a[2],n[8+c]=a[3],n[12+c]=a[4],n[13+c]=a[5],n[17+c]=a[6],n[18+c]=a[7];}this._uvFilled=o;}}},qD1.prototype.updateParticleBuffer=function(t,e,h,i){var r=h._vData;h=h._uintVData;var n=e.x,e=e.y;var a=t.size;var o=a;var s=t.aspectRatio;1<s?o=a/s:a=o*s;s=a/2;a=o/2;var u,_,d,c,l;t.rotation?(o=-s,u=-a,_=s,d=a,l=-v.degreesToRadians(t.rotation),c=Math.cos(l),l=Math.sin(l),r[i]=o*c-u*l+n,r[i+1]=o*l+u*c+e,r[i+5]=_*c-u*l+n,r[i+6]=_*l+u*c+e,r[i+10]=o*c-d*l+n,r[i+11]=o*l+d*c+e,r[i+15]=_*c-d*l+n,r[i+16]=_*l+d*c+e):(r[i]=n-s,r[i+1]=e-a,r[i+5]=n+s,r[i+6]=e-a,r[i+10]=n-s,r[i+11]=e+a,r[i+15]=n+s,r[i+16]=e+a),h[i+4]=t.color._val,h[i+9]=t.color._val,h[i+14]=t.color._val,h[i+19]=t.color._val;},qD1.prototype.step=function(t){t=t>cc.director._maxParticleDeltaTime?cc.director._maxParticleDeltaTime:t;var e=this.sys;var h=e.node;var i=this.particles;var u=4*this.sys._assembler._vfmt._bytes/4;var _;h._updateWorldMatrix(),g=m.identity(),e.positionType===cc.ParticleSystem.PositionType.FREE?(r=h._worldMatrix.m,g.tx=r[12],g.ty=r[13],m.transformVec2(b,y,g)):e.positionType===cc.ParticleSystem.PositionType.RELATIVE&&(r=v.degreesToRadians(-h.angle),_=Math.cos(r),r=Math.sin(r),g=m.create(_,-r,r,_,0,0),b.x=h.x,b.y=h.y),m.invert(g,g);var d=g;if(this.active&&e.emissionRate){var f=1/e.emissionRate;for(i.length<e.totalParticles&&(this.emitCounter+=t);i.length<e.totalParticles&&this.emitCounter>f;)this.emitParticle(b),this.emitCounter-=f;this.elapsed+=t,-1!==e.duration&&e.duration<this.elapsed&&e.stopSystem();}var p=e._assembler.getBuffer();var r=i.length;p.reset(),p.request(4*r,6*r),r>this._uvFilled&&this.updateUVs();var n=0;for(;n<i.length;){C.x=C.y=x.x=x.y=A.x=A.y=0;var a=i[n];var o,s,c,l;a.timeToLive-=t,0<a.timeToLive?(e.emitterMode===cc.ParticleSystem.EmitterMode.GRAVITY?(l=A,s=C,c=x,(a.pos.x||a.pos.y)&&(s.set(a.pos),s.normalizeSelf()),c.set(s),s.mulSelf(a.radialAccel),o=c.x,c.x=-c.y,c.y=o,c.mulSelf(a.tangentialAccel),l.set(s),l.addSelf(c),l.addSelf(e.gravity),l.mulSelf(t),a.dir.addSelf(l),l.set(a.dir),l.mulSelf(t),a.pos.addSelf(l)):(a.angle+=a.degreesPerSecond*t,a.radius+=a.deltaRadius*t,a.pos.x=-Math.cos(a.angle)*a.radius,a.pos.y=-Math.sin(a.angle)*a.radius),a.color.r+=a.deltaColor.r*t,a.color.g+=a.deltaColor.g*t,a.color.b+=a.deltaColor.b*t,a.color.a+=a.deltaColor.a*t,a.size+=a.deltaSize*t,a.size<0&&(a.size=0),a.rotation+=a.deltaRotation*t,o=C,s=x,e.positionType===cc.ParticleSystem.PositionType.FREE?(s.set(a.startPos),s.negSelf(),o.set(a.pos),o.subSelf(s)):e.positionType===cc.ParticleSystem.PositionType.RELATIVE?(c=A,m.transformVec2(s,b,d),m.transformVec2(c,a.startPos,d),s.subSelf(c),o.set(a.pos),o.subSelf(s)):o.set(a.pos),this.updateParticleBuffer(a,o,p,u*n),++n):(l=i[n],n!==i.length-1&&(i[n]=i[i.length-1]),S.put(l),i.length--);}0<i.length?(p.uploadData(),e._assembler._ia._count=6*i.length):this.active||this.readyToPlay||(this.finished=!0,e._finishedSimulation());},e.exports=qD1;},{"../core/platform/js":209,"../core/utils/affine-transform":254,"../core/utils/misc":264}],299:[function(t,e,s){"use strict";var i=_interopRequireDefault(t("../core/renderer/assembler"));var r=_interopRequireDefault(t("../renderer/core/input-assembler"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var n=t("./CCParticleSystem");var a=t("../core/renderer/");var c=t("../core/renderer/webgl/quad-buffer");var o=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor;t=function(e){var t;t=e,(i=ParticleAssembler).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;_createSuper(ParticleAssembler);function ParticleAssembler(t){return(t=e.call(this,t)||this)._buffer=null,t._ia=null,t._vfmt=o,t;}var i=ParticleAssembler.prototype;return i.getBuffer=function(){return this._buffer||(this._buffer=new c(a._handle,o),this._ia=new r.default(),this._ia._vertexBuffer=this._buffer._vb,this._ia._indexBuffer=this._buffer._ib,this._ia._start=0,this._ia._count=0),this._buffer;},i.fillBuffers=function(t,e){this._ia&&(e.node=t.node,e.material=t._materials[0],e._flushIA(this._ia));},ParticleAssembler;}(i.default);i.default.register(n,t),e.exports=t;},{"../core/renderer/":220,"../core/renderer/assembler":217,"../core/renderer/webgl/quad-buffer":249,"../core/renderer/webgl/vertex-format":252,"../renderer/core/input-assembler":302,"./CCParticleSystem":295}],300:[function(h,u,_){"use strict";var d=512,f=513,p=514,m=515,v=516,y=517,g=518,b=519,C=32774,x=32778,A=32779,S=0,T=1,w=768,E=769,P=774,M=775,R=770,I=771,B=772,D=773,L=32769,V=32770,O=32771,F=32772,N=776,k=7680,G=7681,z=7682,U=34055,W=7683,H=34056,j=5386,X=0,q=1028,Y=1029;var e;var i;(o={})[o.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",o[o.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",o[o.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",o[o.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",o[o.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",o[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",o[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",o[o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",o[o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",o[o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",o[o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",o[o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",o[o.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",(o=e=e||{})[o.UNKNOWN=0]="UNKNOWN",o[o.BUFFER=1]="BUFFER",o[o.TEXTURE=2]="TEXTURE",o[o.TEXTURE_VIEW=3]="TEXTURE_VIEW",o[o.RENDER_PASS=4]="RENDER_PASS",o[o.FRAMEBUFFER=5]="FRAMEBUFFER",o[o.SAMPLER=6]="SAMPLER",o[o.SHADER=7]="SHADER",o[o.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",o[o.PIPELINE_STATE=9]="PIPELINE_STATE",o[o.BINDING_LAYOUT=10]="BINDING_LAYOUT",o[o.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",o[o.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR",o[o.COMMAND_BUFFER=13]="COMMAND_BUFFER",o[o.QUEUE=14]="QUEUE",o[o.WINDOW=15]="WINDOW",(o=i=i||{})[o.UNREADY=0]="UNREADY",o[o.FAILED=1]="FAILED",o[o.SUCCESS=2]="SUCCESS";Object.defineProperty(GFXObject.prototype,"gfxType",{get:function(){return this._gfxType;},enumerable:!0,configurable:!0}),Object.defineProperty(GFXObject.prototype,"status",{get:function(){return this._status;},enumerable:!0,configurable:!0});function GFXObject(t){this._gfxType=e.UNKNOWN,this._status=i.UNREADY,this._gfxType=t;}var r;var t;var n;(o={}).ATTR_POSITION="a_position",o.ATTR_NORMAL="a_normal",o.ATTR_TANGENT="a_tangent",o.ATTR_BITANGENT="a_bitangent",o.ATTR_WEIGHTS="a_weights",o.ATTR_JOINTS="a_joints",o.ATTR_COLOR="a_color",o.ATTR_COLOR1="a_color1",o.ATTR_COLOR2="a_color2",o.ATTR_TEX_COORD="a_texCoord",o.ATTR_TEX_COORD1="a_texCoord1",o.ATTR_TEX_COORD2="a_texCoord2",o.ATTR_TEX_COORD3="a_texCoord3",o.ATTR_TEX_COORD4="a_texCoord4",o.ATTR_TEX_COORD5="a_texCoord5",o.ATTR_TEX_COORD6="a_texCoord6",o.ATTR_TEX_COORD7="a_texCoord7",o.ATTR_TEX_COORD8="a_texCoord8",(o=r=r||{})[o.UNKNOWN=0]="UNKNOWN",o[o.BOOL=1]="BOOL",o[o.BOOL2=2]="BOOL2",o[o.BOOL3=3]="BOOL3",o[o.BOOL4=4]="BOOL4",o[o.INT=5]="INT",o[o.INT2=6]="INT2",o[o.INT3=7]="INT3",o[o.INT4=8]="INT4",o[o.UINT=9]="UINT",o[o.UINT2=10]="UINT2",o[o.UINT3=11]="UINT3",o[o.UINT4=12]="UINT4",o[o.FLOAT=13]="FLOAT",o[o.FLOAT2=14]="FLOAT2",o[o.FLOAT3=15]="FLOAT3",o[o.FLOAT4=16]="FLOAT4",o[o.COLOR4=17]="COLOR4",o[o.MAT2=18]="MAT2",o[o.MAT2X3=19]="MAT2X3",o[o.MAT2X4=20]="MAT2X4",o[o.MAT3X2=21]="MAT3X2",o[o.MAT3=22]="MAT3",o[o.MAT3X4=23]="MAT3X4",o[o.MAT4X2=24]="MAT4X2",o[o.MAT4X3=25]="MAT4X3",o[o.MAT4=26]="MAT4",o[o.SAMPLER1D=27]="SAMPLER1D",o[o.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY",o[o.SAMPLER2D=29]="SAMPLER2D",o[o.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY",o[o.SAMPLER3D=31]="SAMPLER3D",o[o.SAMPLER_CUBE=32]="SAMPLER_CUBE",o[o.COUNT=33]="COUNT",(o=c=c||{})[o.UNKNOWN=0]="UNKNOWN",o[o.A8=1]="A8",o[o.L8=2]="L8",o[o.LA8=3]="LA8",o[o.R8=4]="R8",o[o.R8SN=5]="R8SN",o[o.R8UI=6]="R8UI",o[o.R8I=7]="R8I",o[o.R16F=8]="R16F",o[o.R16UI=9]="R16UI",o[o.R16I=10]="R16I",o[o.R32F=11]="R32F",o[o.R32UI=12]="R32UI",o[o.R32I=13]="R32I",o[o.RG8=14]="RG8",o[o.RG8SN=15]="RG8SN",o[o.RG8UI=16]="RG8UI",o[o.RG8I=17]="RG8I",o[o.RG16F=18]="RG16F",o[o.RG16UI=19]="RG16UI",o[o.RG16I=20]="RG16I",o[o.RG32F=21]="RG32F",o[o.RG32UI=22]="RG32UI",o[o.RG32I=23]="RG32I",o[o.RGB8=24]="RGB8",o[o.SRGB8=25]="SRGB8",o[o.RGB8SN=26]="RGB8SN",o[o.RGB8UI=27]="RGB8UI",o[o.RGB8I=28]="RGB8I",o[o.RGB16F=29]="RGB16F",o[o.RGB16UI=30]="RGB16UI",o[o.RGB16I=31]="RGB16I",o[o.RGB32F=32]="RGB32F",o[o.RGB32UI=33]="RGB32UI",o[o.RGB32I=34]="RGB32I",o[o.RGBA8=35]="RGBA8",o[o.SRGB8_A8=36]="SRGB8_A8",o[o.RGBA8SN=37]="RGBA8SN",o[o.RGBA8UI=38]="RGBA8UI",o[o.RGBA8I=39]="RGBA8I",o[o.RGBA16F=40]="RGBA16F",o[o.RGBA16UI=41]="RGBA16UI",o[o.RGBA16I=42]="RGBA16I",o[o.RGBA32F=43]="RGBA32F",o[o.RGBA32UI=44]="RGBA32UI",o[o.RGBA32I=45]="RGBA32I",o[o.R5G6B5=46]="R5G6B5",o[o.R11G11B10F=47]="R11G11B10F",o[o.RGB5A1=48]="RGB5A1",o[o.RGBA4=49]="RGBA4",o[o.RGB10A2=50]="RGB10A2",o[o.RGB10A2UI=51]="RGB10A2UI",o[o.RGB9E5=52]="RGB9E5",o[o.D16=53]="D16",o[o.D16S8=54]="D16S8",o[o.D24=55]="D24",o[o.D24S8=56]="D24S8",o[o.D32F=57]="D32F",o[o.D32F_S8=58]="D32F_S8",o[o.BC1=59]="BC1",o[o.BC1_ALPHA=60]="BC1_ALPHA",o[o.BC1_SRGB=61]="BC1_SRGB",o[o.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA",o[o.BC2=63]="BC2",o[o.BC2_SRGB=64]="BC2_SRGB",o[o.BC3=65]="BC3",o[o.BC3_SRGB=66]="BC3_SRGB",o[o.BC4=67]="BC4",o[o.BC4_SNORM=68]="BC4_SNORM",o[o.BC5=69]="BC5",o[o.BC5_SNORM=70]="BC5_SNORM",o[o.BC6H_UF16=71]="BC6H_UF16",o[o.BC6H_SF16=72]="BC6H_SF16",o[o.BC7=73]="BC7",o[o.BC7_SRGB=74]="BC7_SRGB",o[o.ETC_RGB8=75]="ETC_RGB8",o[o.ETC2_RGB8=76]="ETC2_RGB8",o[o.ETC2_SRGB8=77]="ETC2_SRGB8",o[o.ETC2_RGB8_A1=78]="ETC2_RGB8_A1",o[o.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1",o[o.ETC2_RGBA8=80]="ETC2_RGBA8",o[o.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8",o[o.EAC_R11=82]="EAC_R11",o[o.EAC_R11SN=83]="EAC_R11SN",o[o.EAC_RG11=84]="EAC_RG11",o[o.EAC_RG11SN=85]="EAC_RG11SN",o[o.PVRTC_RGB2=86]="PVRTC_RGB2",o[o.PVRTC_RGBA2=87]="PVRTC_RGBA2",o[o.PVRTC_RGB4=88]="PVRTC_RGB4",o[o.PVRTC_RGBA4=89]="PVRTC_RGBA4",o[o.PVRTC2_2BPP=90]="PVRTC2_2BPP",o[o.PVRTC2_4BPP=91]="PVRTC2_4BPP",(o={})[o.NONE=0]="NONE",o[o.TRANSFER_SRC=1]="TRANSFER_SRC",o[o.TRANSFER_DST=2]="TRANSFER_DST",o[o.INDEX=4]="INDEX",o[o.VERTEX=8]="VERTEX",o[o.UNIFORM=16]="UNIFORM",o[o.STORAGE=32]="STORAGE",o[o.INDIRECT=64]="INDIRECT",(o={})[o.NONE=0]="NONE",o[o.DEVICE=1]="DEVICE",o[o.HOST=2]="HOST",(o={})[o.NONE=0]="NONE",o[o.READ=1]="READ",o[o.WRITE=2]="WRITE",(o={})[o.POINT_LIST=0]="POINT_LIST",o[o.LINE_LIST=1]="LINE_LIST",o[o.LINE_STRIP=2]="LINE_STRIP",o[o.LINE_LOOP=3]="LINE_LOOP",o[o.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",o[o.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",o[o.ISO_LINE_LIST=6]="ISO_LINE_LIST",o[o.TRIANGLE_LIST=7]="TRIANGLE_LIST",o[o.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",o[o.TRIANGLE_FAN=9]="TRIANGLE_FAN",o[o.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",o[o.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",o[o.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",o[o.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST",(o={})[o.FILL=0]="FILL",o[o.POINT=1]="POINT",o[o.LINE=2]="LINE",(o={})[o.GOURAND=0]="GOURAND",o[o.FLAT=1]="FLAT",(o={})[o.NONE=0]="NONE",o[o.FRONT=1]="FRONT",o[o.BACK=2]="BACK",(o={})[o.NEVER=0]="NEVER",o[o.LESS=1]="LESS",o[o.EQUAL=2]="EQUAL",o[o.LESS_EQUAL=3]="LESS_EQUAL",o[o.GREATER=4]="GREATER",o[o.NOT_EQUAL=5]="NOT_EQUAL",o[o.GREATER_EQUAL=6]="GREATER_EQUAL",o[o.ALWAYS=7]="ALWAYS",(o={})[o.ZERO=0]="ZERO",o[o.KEEP=1]="KEEP",o[o.REPLACE=2]="REPLACE",o[o.INCR=3]="INCR",o[o.DECR=4]="DECR",o[o.INVERT=5]="INVERT",o[o.INCR_WRAP=6]="INCR_WRAP",o[o.DECR_WRAP=7]="DECR_WRAP",(o={})[o.ADD=0]="ADD",o[o.SUB=1]="SUB",o[o.REV_SUB=2]="REV_SUB",o[o.MIN=3]="MIN",o[o.MAX=4]="MAX",(o={})[o.ZERO=0]="ZERO",o[o.ONE=1]="ONE",o[o.SRC_ALPHA=2]="SRC_ALPHA",o[o.DST_ALPHA=3]="DST_ALPHA",o[o.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",o[o.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",o[o.SRC_COLOR=6]="SRC_COLOR",o[o.DST_COLOR=7]="DST_COLOR",o[o.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",o[o.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",o[o.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",o[o.CONSTANT_COLOR=11]="CONSTANT_COLOR",o[o.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",o[o.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",o[o.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA",(o={})[o.NONE=0]="NONE",o[o.R=1]="R",o[o.G=2]="G",o[o.B=4]="B",o[o.A=8]="A",o[o.ALL=15]="ALL",(o={})[o.NONE=0]="NONE",o[o.POINT=1]="POINT",o[o.LINEAR=2]="LINEAR",o[o.ANISOTROPIC=3]="ANISOTROPIC",(o={})[o.WRAP=0]="WRAP",o[o.MIRROR=1]="MIRROR",o[o.CLAMP=2]="CLAMP",o[o.BORDER=3]="BORDER",(o={})[o.TEX1D=0]="TEX1D",o[o.TEX2D=1]="TEX2D",o[o.TEX3D=2]="TEX3D",(o={})[o.NONE=0]="NONE",o[o.TRANSFER_SRC=1]="TRANSFER_SRC",o[o.TRANSFER_DST=2]="TRANSFER_DST",o[o.SAMPLED=4]="SAMPLED",o[o.STORAGE=8]="STORAGE",o[o.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",o[o.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",o[o.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",o[o.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT",(o={})[o.X1=0]="X1",o[o.X2=1]="X2",o[o.X4=2]="X4",o[o.X8=3]="X8",o[o.X16=4]="X16",o[o.X32=5]="X32",o[o.X64=6]="X64",(o={})[o.NONE=0]="NONE",o[o.GEN_MIPMAP=1]="GEN_MIPMAP",o[o.CUBEMAP=2]="CUBEMAP",o[o.BAKUP_BUFFER=4]="BAKUP_BUFFER",(o={})[o.TV1D=0]="TV1D",o[o.TV2D=1]="TV2D",o[o.TV3D=2]="TV3D",o[o.CUBE=3]="CUBE",o[o.TV1D_ARRAY=4]="TV1D_ARRAY",o[o.TV2D_ARRAY=5]="TV2D_ARRAY",(o={})[o.VERTEX=0]="VERTEX",o[o.HULL=1]="HULL",o[o.DOMAIN=2]="DOMAIN",o[o.GEOMETRY=3]="GEOMETRY",o[o.FRAGMENT=4]="FRAGMENT",o[o.COMPUTE=5]="COMPUTE",o[o.COUNT=6]="COUNT",(o={})[o.UNKNOWN=0]="UNKNOWN",o[o.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",o[o.SAMPLER=2]="SAMPLER",o[o.STORAGE_BUFFER=3]="STORAGE_BUFFER",(o={})[o.PRIMARY=0]="PRIMARY",o[o.SECONDARY=1]="SECONDARY",(o={})[o.LOAD=0]="LOAD",o[o.CLEAR=1]="CLEAR",o[o.DISCARD=2]="DISCARD",(o={})[o.STORE=0]="STORE",o[o.DISCARD=1]="DISCARD",(o={})[o.UNDEFINED=0]="UNDEFINED",o[o.GENERAL=1]="GENERAL",o[o.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",o[o.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",o[o.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",o[o.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",o[o.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",o[o.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",o[o.PREINITIALIZED=8]="PREINITIALIZED",o[o.PRESENT_SRC=9]="PRESENT_SRC",(o={})[o.GRAPHICS=0]="GRAPHICS",o[o.COMPUTE=1]="COMPUTE",o[o.RAY_TRACING=2]="RAY_TRACING",(o={})[o.VIEWPORT=0]="VIEWPORT",o[o.SCISSOR=1]="SCISSOR",o[o.LINE_WIDTH=2]="LINE_WIDTH",o[o.DEPTH_BIAS=3]="DEPTH_BIAS",o[o.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",o[o.DEPTH_BOUNDS=5]="DEPTH_BOUNDS",o[o.STENCIL_WRITE_MASK=6]="STENCIL_WRITE_MASK",o[o.STENCIL_COMPARE_MASK=7]="STENCIL_COMPARE_MASK",(o={})[o.FRONT=0]="FRONT",o[o.BACK=1]="BACK",o[o.ALL=2]="ALL",(o={})[o.GRAPHICS=0]="GRAPHICS",o[o.COMPUTE=1]="COMPUTE",o[o.TRANSFER=2]="TRANSFER",(o={})[o.NONE=0]="NONE",o[o.COLOR=1]="COLOR",o[o.DEPTH=2]="DEPTH",o[o.STENCIL=4]="STENCIL",o[o.DEPTH_STENCIL=6]="DEPTH_STENCIL",o[o.ALL=7]="ALL",t=t||{},t[t.DEFAULT=100]="DEFAULT",(o=n=n||{})[o.MIN=0]="MIN",o[o.MAX=255]="MAX",o[o.DEFAULT=128]="DEFAULT";var a;var J;(o=a=a||{})[o.UBO_GLOBAL=23]="UBO_GLOBAL",o[o.UBO_SHADOW=22]="UBO_SHADOW",o[o.UBO_LOCAL=21]="UBO_LOCAL",o[o.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS",o[o.UBO_SKINNING=19]="UBO_SKINNING",o[o.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE",o[o.UBO_UI=17]="UBO_UI",o[o.SAMPLER_JOINTS=25]="SAMPLER_JOINTS",o[o.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT",o[o.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT",o[o.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT",(o=J=J||{})[o.minFilter=0]="minFilter",o[o.magFilter=1]="magFilter",o[o.mipFilter=2]="mipFilter",o[o.addressU=3]="addressU",o[o.addressV=4]="addressV",o[o.addressW=5]="addressW",o[o.maxAnisotropy=6]="maxAnisotropy",o[o.cmpFunc=7]="cmpFunc",o[o.minLOD=8]="minLOD",o[o.maxLOD=9]="maxLOD",o[o.mipLODBias=10]="mipLODBias",o[o.borderColor=11]="borderColor",o[o.total=15]="total";var o={};o[o.bool=r.BOOL]="bool",o[o.int=r.INT]="int",o[o.ivec2=r.INT2]="ivec2invTypeParams",o[o.ivec3=r.INT3]="ivec3",o[o.ivec4=r.INT4]="ivec4",o[o.float=r.FLOAT]="float",o[o.vec2=r.FLOAT2]="vec2",o[o.vec3=r.FLOAT3]="vec3",o[o.vec4=r.FLOAT4]="vec4",o[o.mat2=r.MAT2]="mat2",o[o.mat3=r.MAT3]="mat3",o[o.mat4=r.MAT4]="mat4",o[o.sampler2D=r.SAMPLER2D]="sampler2D",o[o.samplerCube=r.SAMPLER_CUBE]="samplerCube";(s={})[r.BOOL]=4,s[r.INT]=4,s[r.INT2]=8,s[r.INT3]=12,s[r.INT4]=16,s[r.FLOAT]=4,s[r.FLOAT2]=8,s[r.FLOAT3]=12,s[r.FLOAT4]=16,s[r.MAT2]=16,s[r.MAT3]=36,s[r.MAT4]=64,s[r.SAMPLER2D]=4,s[r.SAMPLER_CUBE]=4;var s;(l={})[r.BOOL]=c.R32I,l[r.INT]=c.R32I,l[r.INT2]=c.RG32I,l[r.INT3]=c.RGB32I,l[r.INT4]=c.RGBA32I,l[r.FLOAT]=c.R32F,l[r.FLOAT2]=c.RG32F,l[r.FLOAT3]=c.RGB32F,l[r.FLOAT4]=c.RGBA32F;var c=l;var l={BACK:Y,FRONT:q,NONE:X,ADD:C,SUB:x,REV_SUB:A,ZERO:S,ONE:T,SRC_COLOR:w,ONE_MINUS_SRC_COLOR:E,DST_COLOR:P,ONE_MINUS_DST_COLOR:M,SRC_ALPHA:R,ONE_MINUS_SRC_ALPHA:I,DST_ALPHA:B,ONE_MINUS_DST_ALPHA:D,CONSTANT_COLOR:L,ONE_MINUS_CONSTANT_COLOR:V,CONSTANT_ALPHA:O,ONE_MINUS_CONSTANT_ALPHA:F,SRC_ALPHA_SATURATE:N,NEVER:d,LESS:f,EQUAL:p,LEQUAL:m,GREATER:v,NOTEQUAL:y,GEQUAL:g,ALWAYS:b,KEEP:k,REPLACE:G,INCR:z,INCR_WRAP:U,DECR:W,DECR_WRAP:H,INVERT:j};Object.assign(l,t);u.exports={murmurhash2_32_gc:function(t,e){var i,r=t.length,n=e^r,a=0;for(;4<=r;)i=1540483477*(65535&(i=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),r-=4,++a;switch(r){case 3:n^=(255&t.charCodeAt(a+2))<<16;case 2:n^=(255&t.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16);}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0;},SamplerInfoIndex:J,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:o,sizeMap:s,formatMap:c,passParams:l,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:n,GFXGetTypeSize:function(t){switch(t){case r.BOOL:case r.INT:case r.UINT:case r.FLOAT:return 4;case r.BOOL2:case r.INT2:case r.UINT2:case r.FLOAT2:return 8;case r.BOOL3:case r.INT3:case r.UINT3:case r.FLOAT3:return 12;case r.BOOL4:case r.INT4:case r.UINT4:case r.FLOAT4:case r.MAT2:return 16;case r.MAT2X3:return 24;case r.MAT2X4:return 32;case r.MAT3X2:return 24;case r.MAT3:return 36;case r.MAT3X4:return 48;case r.MAT4X2:case r.MAT4X2:return 32;case r.MAT4:return 64;case r.SAMPLER1D:case r.SAMPLER1D_ARRAY:case r.SAMPLER2D:case r.SAMPLER2D_ARRAY:case r.SAMPLER3D:case r.SAMPLER_CUBE:return 4;default:return 0;}},UniformBinding:a};},{}],301:[function(t,r,e){"use strict";e.__esModule=!0,e.default=void 0;var i=t("../memop");var v=_interopRequireDefault(t("../enums"));var y=t("../../core/value-types");var n=_interopRequireDefault(t("./program-lib"));var a=_interopRequireDefault(t("./view"));var x=_interopRequireDefault(t("../gfx"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}var m=new y.Mat4();var g=new i.RecyclePool(function(){return{stage:null,items:null};},8);var A=new i.RecyclePool(function(){return new Float32Array(2);},8);var S=new i.RecyclePool(function(){return new Float32Array(3);},8);var T=new i.RecyclePool(function(){return new Float32Array(4);},8);var w=new i.RecyclePool(function(){return new Float32Array(9);},8);var b=new i.RecyclePool(function(){return new Float32Array(16);},8);var E=new i.RecyclePool(function(){return new Float32Array(64);},8);var P=new i.RecyclePool(function(){return new Int32Array(2);},8);var M=new i.RecyclePool(function(){return new Int32Array(3);},8);var R=new i.RecyclePool(function(){return new Int32Array(4);},8);var C=new i.RecyclePool(function(){return new Int32Array(64);},8);function Base(t,e){this._device=t,this._programLib=new n.default(t),this._opts=e,this._type2defaultValue=((t={})[v.default.PARAM_INT]=0,t[v.default.PARAM_INT2]=new y.Vec2(0,0),t[v.default.PARAM_INT3]=new y.Vec3(0,0,0),t[v.default.PARAM_INT4]=new y.Vec4(0,0,0,0),t[v.default.PARAM_FLOAT]=0,t[v.default.PARAM_FLOAT2]=new y.Vec2(0,0),t[v.default.PARAM_FLOAT3]=new y.Vec3(0,0,0),t[v.default.PARAM_FLOAT4]=new y.Vec4(0,0,0,0),t[v.default.PARAM_COLOR4]=new y.Color(0,0,0,1),t[v.default.PARAM_MAT3]=new y.Mat3(),t[v.default.PARAM_MAT4]=new y.Mat4(),t[v.default.PARAM_TEXTURE_2D]=e.defaultTexture,t[v.default.PARAM_TEXTURE_CUBE]=e.defaultTextureCube,t),this._stage2fn={},this._usedTextureUnits=0,this._viewPools=new i.RecyclePool(function(){return new a.default();},8),this._drawItemsPools=new i.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null};},100),this._stageItemsPools=new i.RecyclePool(function(){return new i.RecyclePool(function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null};},100);},16);}(t=Base.prototype)._resetTextuerUnit=function(){this._usedTextureUnits=0;},t._allocTextureUnit=function(){var t=this._device;var e=this._usedTextureUnits;return e>=t._caps.maxTextureUnits&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+t._caps.maxTextureUnits),this._usedTextureUnits+=1,e;},t._registerStage=function(t,e){this._stage2fn[t]=e;},t.clear=function(){this._programLib.clear(),this.reset();},t.reset=function(){this._viewPools.reset(),this._stageItemsPools.reset();},t._requestView=function(){return this._viewPools.add();},t._render=function(t,h){var e=this._device;e.setFrameBuffer(t._framebuffer),e.setViewport(t._rect.x,t._rect.y,t._rect.w,t._rect.h);var i={};t._clearFlags&v.default.CLEAR_COLOR&&(i.color=y.Vec4.toArray([],t._color)),t._clearFlags&v.default.CLEAR_DEPTH&&(i.depth=t._depth),t._clearFlags&v.default.CLEAR_STENCIL&&(i.stencil=t._stencil),e.clear(i),this._drawItemsPools.reset();for(var r=0;r<h._models.length;++r){var u=h._models.data[r];var _;0!=(u._cullingMask&t._cullingMask)&&(_=this._drawItemsPools.add(),u.extractDrawItem(_));}g.reset();for(var n=0;n<t._stages.length;++n){var d=t._stages[n];var a=this._stageItemsPools.add();a.reset();for(var o=0;o<this._drawItemsPools.length;++o){var s=this._drawItemsPools.data[o];var c=s.effect.stagePasses[d];var l;c&&0!==c.length&&((l=a.add()).passes=c,l.model=s.model,l.node=s.node,l.ia=s.ia,l.effect=s.effect,l.defines=s.defines,l.sortKey=-1,l.uniforms=s.uniforms);}var f=g.add();f.stage=d,f.items=a;}for(var p=0;p<g.length;++p){var m=g.data[p];(0,this._stage2fn[m.stage])(t,m.items);}},t._setProperty=function(t){var e=this._device;var i=t.value;if(void 0!==(i=void 0===(i=void 0===i?t.val:i)?this._type2defaultValue[t.type]:i)){if(t.type===v.default.PARAM_TEXTURE_2D||t.type===v.default.PARAM_TEXTURE_CUBE){if(Array.isArray(i)){if(i.length>t.count)console.error("Failed to set property ["+t.name+"] : The length of texture array ["+i.length+"] is bigger than ["+t.count+"].");else{var r=C.add();for(var n=0;n<i.length;++n)r[n]=this._allocTextureUnit();e.setTextureArray(t.name,i,r);}}else e.setTexture(t.name,i,this._allocTextureUnit());}else t.directly?e.setUniformDirectly(t.name,i):e.setUniform(t.name,i);}else console.warn("Failed to set technique property "+t.name+", value not found.");},t._draw=function(t){var e=this._device;var h=this._programLib;var u=t.node,i=t.ia,r=t.passes,_=t.effect;A.reset(),S.reset(),T.reset(),w.reset(),b.reset(),E.reset(),P.reset(),M.reset(),R.reset(),C.reset(),u.getWorldMatrix(m),e.setUniform("cc_matWorld",y.Mat4.toArray(b.add(),m)),y.Mat4.invert(m,m),y.Mat4.transpose(m,m),e.setUniform("cc_matWorldIT",y.Mat4.toArray(b.add(),m));var n=this._defines;for(var a=0;a<r.length;++a){var o=r[a];var d=i.count;i._vertexBuffer&&e.setVertexBuffer(0,i._vertexBuffer),i._indexBuffer&&e.setIndexBuffer(i._indexBuffer),e.setPrimitiveType(i._primitiveType),Object.setPrototypeOf(n,o._defines);var s=h.getProgram(o._programName,n,_.name);e.setProgram(s);var c=s._uniforms;var f=o._properties;for(var l=0;l<c.length;l++){var p=f[c[l].name];void 0!==p&&this._setProperty(p);}e.setCullMode(o._cullMode),o._blend&&(e.enableBlend(),e.setBlendFuncSep(o._blendSrc,o._blendDst,o._blendSrcAlpha,o._blendDstAlpha),e.setBlendEqSep(o._blendEq,o._blendAlphaEq),e.setBlendColor32(o._blendColor)),o._depthTest&&(e.enableDepthTest(),e.setDepthFunc(o._depthFunc)),o._depthWrite&&e.enableDepthWrite(),e.setStencilTest(o._stencilTest),o._stencilTest===x.default.STENCIL_ENABLE&&(e.setStencilFuncFront(o._stencilFuncFront,o._stencilRefFront,o._stencilMaskFront),e.setStencilOpFront(o._stencilFailOpFront,o._stencilZFailOpFront,o._stencilZPassOpFront,o._stencilWriteMaskFront),e.setStencilFuncBack(o._stencilFuncBack,o._stencilRefBack,o._stencilMaskBack),e.setStencilOpBack(o._stencilFailOpBack,o._stencilZFailOpBack,o._stencilZPassOpBack,o._stencilWriteMaskBack)),e.draw(i._start,d),this._resetTextuerUnit();}},e.default=Base,r.exports=e.default;},{"../../core/value-types":279,"../enums":307,"../gfx":312,"../memop":324,"./program-lib":304,"./view":306}],302:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("../gfx"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}t=InputAssembler,(n=[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0;}}])&&_defineProperties(t.prototype,n),a&&_defineProperties(t,a);n=InputAssembler;function InputAssembler(t,e,i){void 0===i&&(i=r.default.PT_TRIANGLES),this._vertexBuffer=t,this._indexBuffer=e,this._primitiveType=i,this._start=0,this._count=-1;}var n,a;i.default=n,e.exports=i.default;},{"../gfx":312}],303:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var c=_interopRequireDefault(t("../gfx"));var o=_interopRequireDefault(t("../enums"));var s=_interopRequireDefault(t("../../core/value-types/value-type"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function Pass(t,e,i,r,n,a){void 0===n&&(n={}),void 0===a&&(a={}),this._name=t,this._detailName=e,this._programName=i,this._stage=r,this._properties=n,this._defines=a,this._cullMode=c.default.CULL_BACK,this._blend=!1,this._blendEq=c.default.BLEND_FUNC_ADD,this._blendAlphaEq=c.default.BLEND_FUNC_ADD,this._blendSrc=c.default.BLEND_SRC_ALPHA,this._blendDst=c.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendSrcAlpha=c.default.BLEND_SRC_ALPHA,this._blendDstAlpha=c.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendColor=4294967295,this._depthTest=!1,this._depthWrite=!1,this._depthFunc=c.default.DS_FUNC_LESS,this._stencilTest=c.default.STENCIL_INHERIT,this._stencilFuncFront=c.default.DS_FUNC_ALWAYS,this._stencilRefFront=0,this._stencilMaskFront=255,this._stencilFailOpFront=c.default.STENCIL_OP_KEEP,this._stencilZFailOpFront=c.default.STENCIL_OP_KEEP,this._stencilZPassOpFront=c.default.STENCIL_OP_KEEP,this._stencilWriteMaskFront=255,this._stencilFuncBack=c.default.DS_FUNC_ALWAYS,this._stencilRefBack=0,this._stencilMaskBack=255,this._stencilFailOpBack=c.default.STENCIL_OP_KEEP,this._stencilZFailOpBack=c.default.STENCIL_OP_KEEP,this._stencilZPassOpBack=c.default.STENCIL_OP_KEEP,this._stencilWriteMaskBack=255;}(t=Pass.prototype).setCullMode=function(t){void 0===t&&(t=c.default.CULL_BACK),this._cullMode=t;},t.setBlend=function(t,e,i,r,n,a,o,s){void 0===e&&(e=c.default.BLEND_FUNC_ADD),void 0===i&&(i=c.default.BLEND_SRC_ALPHA),void 0===r&&(r=c.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===n&&(n=c.default.BLEND_FUNC_ADD),void 0===a&&(a=c.default.BLEND_SRC_ALPHA),void 0===o&&(o=c.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===s&&(s=4294967295),this._blend=t=void 0===t?!1:t,this._blendEq=e,this._blendSrc=i,this._blendDst=r,this._blendAlphaEq=n,this._blendSrcAlpha=a,this._blendDstAlpha=o,this._blendColor=s;},t.setDepth=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=c.default.DS_FUNC_LESS),this._depthTest=t=void 0===t?!1:t,this._depthWrite=e,this._depthFunc=i;},t.setStencilFront=function(t,e,i,r,n,a,o,s){void 0===t&&(t=c.default.STENCIL_INHERIT),void 0===e&&(e=c.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===r&&(r=255),void 0===n&&(n=c.default.STENCIL_OP_KEEP),void 0===a&&(a=c.default.STENCIL_OP_KEEP),void 0===o&&(o=c.default.STENCIL_OP_KEEP),void 0===s&&(s=255),this._stencilTest=t,this._stencilFuncFront=e,this._stencilRefFront=i,this._stencilMaskFront=r,this._stencilFailOpFront=n,this._stencilZFailOpFront=a,this._stencilZPassOpFront=o,this._stencilWriteMaskFront=s;},t.setStencilEnabled=function(t){void 0===t&&(t=c.default.STENCIL_INHERIT),this._stencilTest=t;},t.setStencilBack=function(t,e,i,r,n,a,o,s){void 0===t&&(t=c.default.STENCIL_INHERIT),void 0===e&&(e=c.default.DS_FUNC_ALWAYS),void 0===i&&(i=0),void 0===r&&(r=255),void 0===n&&(n=c.default.STENCIL_OP_KEEP),void 0===a&&(a=c.default.STENCIL_OP_KEEP),void 0===o&&(o=c.default.STENCIL_OP_KEEP),void 0===s&&(s=255),this._stencilTest=t,this._stencilFuncBack=e,this._stencilRefBack=i,this._stencilMaskBack=r,this._stencilFailOpBack=n,this._stencilZFailOpBack=a,this._stencilZPassOpBack=o,this._stencilWriteMaskBack=s;},t.setStage=function(t){this._stage=t;},t.setProperties=function(t){this._properties=t;},t.getProperty=function(t){if(this._properties[t])return this._properties[t].value;},t.setProperty=function(t,e,i){var r=this._properties[t];if(!r)return!1;if(r.directly=i,Array.isArray(e)){var n=r.value;if(n.length!==e.length)return void cc.warnID(9105,this._name,t);for(var a=0;a<e.length;a++)n[a]=e[a];}else e&&!ArrayBuffer.isView(e)?r.type===o.default.PARAM_TEXTURE_2D?r.value=e.getImpl():e instanceof s.default?e.constructor.toArray(r.value,e):("object"==typeof e&&cc.warnID(9106,this._name,t),r.value=e):r.value=e;return!0;},t.getDefine=function(t){return this._defines[t];},t.define=function(t,e,i){if(!i&&void 0===this._defines[t])return!1;return this._defines[t]=e,!0;},t.clone=function(){var t=new Pass(this._programName);Object.assign(t,this);var e={};var i=this._properties;for(var r in i){var n=i[r];var a=e[r]={};r=n.value;for(var o in Array.isArray(r)?a.value=r.concat():ArrayBuffer.isView(r)?a.value=new r.__proto__.constructor(r):a.value=r,n)"value"!==o&&(a[o]=n[o]);}return t._properties=e,t._defines=Object.assign({},this._defines),t;},i.default=Pass,e.exports=i.default;},{"../../core/value-types/value-type":287,"../enums":307,"../gfx":312}],304:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var h=(t=t("../gfx"))&&t.__esModule?t:{default:t};var v=0;function _replaceMacroNums(t,e,i){var r=t;for(var n=0;n<e.length;n++){var a=e[n].name;var o=i[a];Number.isInteger(o)&&(a=new RegExp(a,"g"),r=r.replace(a,o));}return r;}function _unrollLoops(t){return t.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,function(t,e,i,r,n){var a="";i=parseInt(i);var o=parseInt(r);(i.isNaN||o.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num.");for(var s=i;s<o;++s)a+=n.replace(new RegExp("{"+e+"}","g"),s);return a;});}function _replaceHighp(t){return t.replace(/\bhighp\b/g,"mediump");}function ProgramLib(t){this._device=t,this._templates={},this._cache={},this._checkPrecision();}(t=ProgramLib.prototype).clear=function(){this._templates={},this._cache={};},t.define=function(t){var e=t.name,i=t.defines;var r=t.glsl1||t,h=r.vert,r=r.frag;if(!this._templates[e]){var u=++v;var _=0;for(var n=0;n<i.length;++n){var a=i[n];var d=1;var o;"number"===a.type?(o=a.range||[],a.min=o[0]||0,a.max=o[1]||4,d=Math.ceil(Math.log2(a.max-a.min)),a._map=function(t){return t-this.min<<this._offset;}.bind(a)):a._map=function(t){return t?1<<this._offset:0;}.bind(a),a._offset=_,_+=d;}var s=t.uniforms||[];if(t.samplers)for(var f=0;f<t.samplers.length;f++)s.push(t.samplers[f]);if(t.blocks)for(var c=0;c<t.blocks.length;c++){var p=t.blocks[c].defines;var m=t.blocks[c].members;for(var l=0;l<m.length;l++)s.push({defines:p,name:m[l].name,type:m[l].type});}this._templates[e]={id:u,name:e,vert:h,frag:r,defines:i,attributes:t.attributes,uniforms:s,extensions:t.extensions};}},t.getTemplate=function(t){return this._templates[t];},t.hasProgram=function(t){return void 0!==this._templates[t];},t.getKey=function(t,e){var i=this._templates[t];var r=0;for(var n=0;n<i.defines.length;++n){var a=i.defines[n];var o=e[a.name];void 0!==o&&(r|=a._map(o));}return i.id+":"+r;},t.getProgram=function(t,e,r){var i=this.getKey(t,e);var n=this._cache[i];if(n)return n;t=this._templates[t];var a=function(t,e){var i=[];for(var r=0;r<t.length;r++){var n=t[r].name;var a=e[n];"number"!=typeof a&&(a=a?1:0),i.push("#define "+n+" "+a);}return i.join("\n")+"\n";}(t.defines,e);var o=_replaceMacroNums(t.vert,t.defines,e);o=a+_unrollLoops(o),this._highpSupported||(o=_replaceHighp(o));e=_replaceMacroNums(t.frag,t.defines,e);e=a+_unrollLoops(e),this._highpSupported||(e=_replaceHighp(e));a=(n=new h.default.Program(this._device,{vert:o,frag:e})).link();var s,c,l;return a&&(s=o.split("\n"),c=e.split("\n"),l=t.defines.length,a.forEach(function(t){var e=t.line-1;var i=t.line-l;e=("vs"===t.type?s:c)[e];i=t.info||"Failed to compile "+t.type+" "+t.fileID+" (ln "+i+"): \n "+t.message+": \n  "+e;cc.error(r+" : "+i);})),this._cache[i]=n;},t._checkPrecision=function(){var t=this._device._gl;var e=!1;var i;t.getShaderPrecisionFormat&&(i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),t=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),e=i&&0<i.precision&&t&&0<t.precision),e||cc.warnID(9102),this._highpSupported=e;},i.default=ProgramLib,e.exports=i.default;},{"../gfx":312}],305:[function(t,e,i){"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}i.__esModule=!0,i.default=void 0;Technique.prototype.clone=function(){var t=[];for(var e=0;e<this._passes.length;e++)t.push(this._passes[e].clone());return new Technique(this._name,t);},r=Technique,(n=[{key:"name",get:function(){return this._name;}},{key:"passes",get:function(){return this._passes;}}])&&_defineProperties(r.prototype,n),a&&_defineProperties(r,a);n=Technique;function Technique(t,e){this._name=t,this._passes=e;}var r,n,a;i.default=n,e.exports=i.default;},{}],306:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../../core/value-types");var n=(t=t("../enums"))&&t.__esModule?t:{default:t};var a=new r.Mat4();var o=0;function View(){this._id=o++,this._priority=0,this._rect={x:0,y:0,w:1,h:1},this._color=new r.Vec4(.3,.3,.3,1),this._depth=1,this._stencil=0,this._clearFlags=n.default.CLEAR_COLOR|n.default.CLEAR_DEPTH,this._clearModel=null,this._matView=cc.mat4(),this._matViewInv=cc.mat4(),this._matProj=cc.mat4(),this._matViewProj=cc.mat4(),this._matInvViewProj=cc.mat4(),this._stages=[],this._cullingByID=!1,this._framebuffer=null,this._shadowLight=null,this._cullingMask=4294967295;}(t=View.prototype).getForward=function(t){var e=this._matView.m;return r.Vec3.set(t,-e[2],-e[6],-e[10]);},t.getPosition=function(t){return r.Mat4.invert(a,this._matView),r.Mat4.getTranslation(t,a);},i.default=View,e.exports=i.default;},{"../../core/value-types":279,"../enums":307}],307:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./build/mappings");t={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:t.typeMap.int,PARAM_INT2:t.typeMap.ivec2,PARAM_INT3:t.typeMap.ivec3,PARAM_INT4:t.typeMap.ivec4,PARAM_FLOAT:t.typeMap.float,PARAM_FLOAT2:t.typeMap.vec2,PARAM_FLOAT3:t.typeMap.vec3,PARAM_FLOAT4:t.typeMap.vec4,PARAM_MAT2:t.typeMap.mat2,PARAM_MAT3:t.typeMap.mat3,PARAM_MAT4:t.typeMap.mat4,PARAM_TEXTURE_2D:t.typeMap.sampler2D,PARAM_TEXTURE_CUBE:t.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};i.default=t,e.exports=i.default;},{"./build/mappings":300}],308:[function(t,a,e){"use strict";e.__esModule=!0,e.default=void 0;var n=_interopRequireDefault(t("./state"));var B=t("./enums");var o=_interopRequireDefault(t("./texture-2d"));var s=_interopRequireDefault(t("./texture-cube"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(t={})[5124]=function(t,e,i){t.uniform1i(e,i);},t[5126]=function(t,e,i){t.uniform1f(e,i);},t[35664]=function(t,e,i){t.uniform2fv(e,i);},t[35665]=function(t,e,i){t.uniform3fv(e,i);},t[35666]=function(t,e,i){t.uniform4fv(e,i);},t[35667]=function(t,e,i){t.uniform2iv(e,i);},t[35668]=function(t,e,i){t.uniform3iv(e,i);},t[35669]=function(t,e,i){t.uniform4iv(e,i);},t[35670]=function(t,e,i){t.uniform1i(e,i);},t[35671]=function(t,e,i){t.uniform2iv(e,i);},t[35672]=function(t,e,i){t.uniform3iv(e,i);},t[35673]=function(t,e,i){t.uniform4iv(e,i);},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i);},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i);},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i);},t[35678]=function(t,e,i){t.uniform1i(e,i);},t[35680]=function(t,e,i){t.uniform1i(e,i);};var D=t;(t={})[5124]=function(t,e,i){t.uniform1iv(e,i);},t[5126]=function(t,e,i){t.uniform1fv(e,i);},t[35664]=function(t,e,i){t.uniform2fv(e,i);},t[35665]=function(t,e,i){t.uniform3fv(e,i);},t[35666]=function(t,e,i){t.uniform4fv(e,i);},t[35667]=function(t,e,i){t.uniform2iv(e,i);},t[35668]=function(t,e,i){t.uniform3iv(e,i);},t[35669]=function(t,e,i){t.uniform4iv(e,i);},t[35670]=function(t,e,i){t.uniform1iv(e,i);},t[35671]=function(t,e,i){t.uniform2iv(e,i);},t[35672]=function(t,e,i){t.uniform3iv(e,i);},t[35673]=function(t,e,i){t.uniform4iv(e,i);},t[35674]=function(t,e,i){t.uniformMatrix2fv(e,!1,i);},t[35675]=function(t,e,i){t.uniformMatrix3fv(e,!1,i);},t[35676]=function(t,e,i){t.uniformMatrix4fv(e,!1,i);},t[35678]=function(t,e,i){t.uniform1iv(e,i);},t[35680]=function(t,e,i){t.uniform1iv(e,i);};var L=t;function _attach(t,e,i,r){void 0===r&&(r=0),i instanceof o.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,i._glID,0):i instanceof s.default?t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,i._glID,0):t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,i._glID);}t=Device,(r=[{key:"caps",get:function(){return this._caps;}}])&&_defineProperties(t.prototype,r),i&&_defineProperties(t,i),(r=Device.prototype)._initExtensions=function(t){var e=this._gl;for(var i=0;i<t.length;++i){var r=t[i];var n=["","WEBKIT_","MOZ_"];for(var a=0;a<n.length;a++)try{var o=e.getExtension(n[a]+r);if(o){this._extensions[r]=o;break;}}catch(t){console.error(t);}}},r._initCaps=function(){var t=this._gl;var e=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4,this._caps.maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxFragUniforms=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexAttribs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this._caps.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._caps.maxDrawBuffers=e?t.getParameter(e.MAX_DRAW_BUFFERS_WEBGL):1,this._caps.maxColorAttachments=e?t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL):1;},r._initStates=function(){var t=this._gl;t.disable(t.BLEND),t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),t.blendColor(1,1,1,1),t.colorMask(!0,!0,!0,!0),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.depthMask(!1),t.disable(t.POLYGON_OFFSET_FILL),t.depthRange(0,1),t.disable(t.STENCIL_TEST),t.stencilFunc(t.ALWAYS,0,255),t.stencilMask(255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearDepth(1),t.clearColor(0,0,0,0),t.clearStencil(0),t.disable(t.SCISSOR_TEST);},r._restoreTexture=function(t){var e=this._gl;t=this._current.textureUnits[t];t&&-1!==t._glID?e.bindTexture(t._target,t._glID):e.bindTexture(e.TEXTURE_2D,null);},r._restoreIndexBuffer=function(){var t=this._gl;var e=this._current.indexBuffer;e&&-1!==e._glID?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._glID):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null);},r.ext=function(t){return this._extensions[t];},r.allowFloatTexture=function(){return null!=this.ext("OES_texture_float");},r.setFrameBuffer=function(t){if(this._framebuffer!==t){this._framebuffer=t;var e=this._gl;if(t){e.bindFramebuffer(e.FRAMEBUFFER,t._glID);var i=t._colors.length;for(var r=0;r<i;++r){var n=t._colors[r];_attach(e,e.COLOR_ATTACHMENT0+r,n);}for(var a=i;a<this._caps.maxColorAttachments;++a)e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,null,0);t._depth&&_attach(e,e.DEPTH_ATTACHMENT,t._depth),t._stencil&&_attach(e,e.STENCIL_ATTACHMENT,t._stencil),t._depthStencil&&_attach(e,e.DEPTH_STENCIL_ATTACHMENT,t._depthStencil);}else e.bindFramebuffer(e.FRAMEBUFFER,null);}},r.setViewport=function(t,e,i,r){this._vx===t&&this._vy===e&&this._vw===i&&this._vh===r||(this._gl.viewport(t,e,i,r),this._vx=t,this._vy=e,this._vw=i,this._vh=r);},r.setScissor=function(t,e,i,r){this._sx===t&&this._sy===e&&this._sw===i&&this._sh===r||(this._gl.scissor(t,e,i,r),this._sx=t,this._sy=e,this._sw=i,this._sh=r);},r.clear=function(t){var e,i;void 0===t.color&&void 0===t.depth&&void 0===t.stencil||(e=this._gl,void(i=0)!==t.color&&(i|=e.COLOR_BUFFER_BIT,e.clearColor(t.color[0],t.color[1],t.color[2],t.color[3])),void 0!==t.depth&&(i|=e.DEPTH_BUFFER_BIT,e.clearDepth(t.depth),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.ALWAYS)),void 0!==t.stencil&&(i|=e.STENCIL_BUFFER_BIT,e.clearStencil(t.stencil)),e.clear(i),void 0!==t.depth&&(!1===this._current.depthTest?e.disable(e.DEPTH_TEST):(!1===this._current.depthWrite&&e.depthMask(!1),this._current.depthFunc!==B.enums.DS_FUNC_ALWAYS&&e.depthFunc(this._current.depthFunc))));},r.enableBlend=function(){this._next.blend=!0;},r.enableDepthTest=function(){this._next.depthTest=!0;},r.enableDepthWrite=function(){this._next.depthWrite=!0;},r.setStencilTest=function(t){this._next.stencilTest=t;},r.setStencilFunc=function(t,e,i){this._next.stencilSep=!1,this._next.stencilFuncFront=this._next.stencilFuncBack=t,this._next.stencilRefFront=this._next.stencilRefBack=e,this._next.stencilMaskFront=this._next.stencilMaskBack=i;},r.setStencilFuncFront=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncFront=t,this._next.stencilRefFront=e,this._next.stencilMaskFront=i;},r.setStencilFuncBack=function(t,e,i){this._next.stencilSep=!0,this._next.stencilFuncBack=t,this._next.stencilRefBack=e,this._next.stencilMaskBack=i;},r.setStencilOp=function(t,e,i,r){this._next.stencilFailOpFront=this._next.stencilFailOpBack=t,this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=e,this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=r;},r.setStencilOpFront=function(t,e,i,r){this._next.stencilSep=!0,this._next.stencilFailOpFront=t,this._next.stencilZFailOpFront=e,this._next.stencilZPassOpFront=i,this._next.stencilWriteMaskFront=r;},r.setStencilOpBack=function(t,e,i,r){this._next.stencilSep=!0,this._next.stencilFailOpBack=t,this._next.stencilZFailOpBack=e,this._next.stencilZPassOpBack=i,this._next.stencilWriteMaskBack=r;},r.setDepthFunc=function(t){this._next.depthFunc=t;},r.setBlendColor32=function(t){this._next.blendColor=t;},r.setBlendColor=function(t,e,i,r){this._next.blendColor=(255*t<<24|255*e<<16|255*i<<8|255*r)>>>0;},r.setBlendFunc=function(t,e){this._next.blendSep=!1,this._next.blendSrc=t,this._next.blendDst=e;},r.setBlendFuncSep=function(t,e,i,r){this._next.blendSep=!0,this._next.blendSrc=t,this._next.blendDst=e,this._next.blendSrcAlpha=i,this._next.blendDstAlpha=r;},r.setBlendEq=function(t){this._next.blendSep=!1,this._next.blendEq=t;},r.setBlendEqSep=function(t,e){this._next.blendSep=!0,this._next.blendEq=t,this._next.blendAlphaEq=e;},r.setCullMode=function(t){this._next.cullMode=t;},r.setVertexBuffer=function(t,e,i){void 0===i&&(i=0),this._next.vertexBuffers[t]=e,this._next.vertexBufferOffsets[t]=i,this._next.maxStream<t&&(this._next.maxStream=t);},r.setIndexBuffer=function(t){this._next.indexBuffer=t;},r.setProgram=function(t){this._next.program=t;},r.setTexture=function(t,e,i){i>=this._caps.maxTextureUnits?console.warn("Can not set texture "+t+" at stage "+i+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[i]=e,this.setUniform(t,i),this._next.maxTextureSlot<i&&(this._next.maxTextureSlot=i));},r.setTextureArray=function(t,e,i){var r=e.length;if(r>=this._caps.maxTextureUnits)console.warn("Can not set "+r+" textures for "+t+", max texture exceed: "+this._caps.maxTextureUnits);else{for(var n=0;n<r;++n){var a=i[n];this._next.textureUnits[a]=e[n],this._next.maxTextureSlot<a&&(this._next.maxTextureSlot=a);}this.setUniform(t,i);}},r.setUniform=function(t,e){var i=this._uniforms[t];var r=!1;var h=!1,n=!1,a=!1;for(;i&&(n=Array.isArray(e)||e instanceof Float32Array,a=e instanceof Int32Array,i.isArray===(h=n||a)&&(!i.isArray||i.value.length===e.length)&&(r=!0,0)););if(r){var o=i.value;var s=!1;if(i.isArray)for(var c=0,u=o.length;c<u;c++)o[c]!==e[c]&&(s=!0,o[c]=e[c]);else o!==e&&(s=!0,i.value=e);s&&(i.dirty=!0);}else{var l=e;n?l=new Float32Array(e):a&&(l=new Int32Array(e)),i={dirty:!0,value:l,isArray:h};}this._uniforms[t]=i;},r.setUniformDirectly=function(t,e){var i=this._uniforms[t];i||(this._uniforms[t]=i={}),i.dirty=!0,i.value=e;},r.setPrimitiveType=function(t){this._next.primitiveType=t;},r.resetDrawCalls=function(){this._stats.drawcalls=0;},r.getDrawCalls=function(){return this._stats.drawcalls;},r.draw=function(h,u){var t=this._gl;var e=this._current;var i=this._next;var r;var n,a;!function(t,e,i){if(e.blend!==i.blend)return i.blend?(t.enable(t.BLEND),i.blendSrc!==B.enums.BLEND_CONSTANT_COLOR&&i.blendSrc!==B.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&i.blendDst!==B.enums.BLEND_CONSTANT_COLOR&&i.blendDst!==B.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq))):t.disable(t.BLEND);!1!==i.blend&&(e.blendColor!==i.blendColor&&t.blendColor((i.blendColor>>24)/255,(i.blendColor>>16&255)/255,(i.blendColor>>8&255)/255,(255&i.blendColor)/255),e.blendSep===i.blendSep?i.blendSep?(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst&&e.blendSrcAlpha===i.blendSrcAlpha&&e.blendDstAlpha===i.blendDstAlpha||t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),e.blendEq===i.blendEq&&e.blendAlphaEq===i.blendAlphaEq||t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(e.blendSrc===i.blendSrc&&e.blendDst===i.blendDst||t.blendFunc(i.blendSrc,i.blendDst),e.blendEq!==i.blendEq&&t.blendEquation(i.blendEq)):i.blendSep?(t.blendFuncSeparate(i.blendSrc,i.blendDst,i.blendSrcAlpha,i.blendDstAlpha),t.blendEquationSeparate(i.blendEq,i.blendAlphaEq)):(t.blendFunc(i.blendSrc,i.blendDst),t.blendEquation(i.blendEq)));}(t,e,i),function(t,e,i){if(e.depthTest!==i.depthTest)return i.depthTest?(t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc),t.depthMask(i.depthWrite)):t.disable(t.DEPTH_TEST);e.depthWrite!==i.depthWrite&&t.depthMask(i.depthWrite),!1!==i.depthTest?e.depthFunc!==i.depthFunc&&t.depthFunc(i.depthFunc):i.depthWrite&&(i.depthTest=!0,i.depthFunc=B.enums.DS_FUNC_ALWAYS,t.enable(t.DEPTH_TEST),t.depthFunc(i.depthFunc));}(t,e,i),a=t,n=e,(r=i).stencilTest!==B.enums.STENCIL_INHERIT&&(r.stencilTest!==n.stencilTest?r.stencilTest===B.enums.STENCIL_DISABLE?a.disable(a.STENCIL_TEST):(a.enable(a.STENCIL_TEST),r.stencilSep?(a.stencilFuncSeparate(a.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),a.stencilMaskSeparate(a.FRONT,r.stencilWriteMaskFront),a.stencilOpSeparate(a.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),a.stencilFuncSeparate(a.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),a.stencilMaskSeparate(a.BACK,r.stencilWriteMaskBack),a.stencilOpSeparate(a.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(a.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),a.stencilMask(r.stencilWriteMaskFront),a.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront))):r.stencilTest!==B.enums.STENCIL_DISABLE&&(n.stencilSep===r.stencilSep?r.stencilSep?(n.stencilFuncFront===r.stencilFuncFront&&n.stencilRefFront===r.stencilRefFront&&n.stencilMaskFront===r.stencilMaskFront||a.stencilFuncSeparate(a.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),n.stencilWriteMaskFront!==r.stencilWriteMaskFront&&a.stencilMaskSeparate(a.FRONT,r.stencilWriteMaskFront),n.stencilFailOpFront===r.stencilFailOpFront&&n.stencilZFailOpFront===r.stencilZFailOpFront&&n.stencilZPassOpFront===r.stencilZPassOpFront||a.stencilOpSeparate(a.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),n.stencilFuncBack===r.stencilFuncBack&&n.stencilRefBack===r.stencilRefBack&&n.stencilMaskBack===r.stencilMaskBack||a.stencilFuncSeparate(a.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),n.stencilWriteMaskBack!==r.stencilWriteMaskBack&&a.stencilMaskSeparate(a.BACK,r.stencilWriteMaskBack),n.stencilFailOpBack===r.stencilFailOpBack&&n.stencilZFailOpBack===r.stencilZFailOpBack&&n.stencilZPassOpBack===r.stencilZPassOpBack||a.stencilOpSeparate(a.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(n.stencilFuncFront===r.stencilFuncFront&&n.stencilRefFront===r.stencilRefFront&&n.stencilMaskFront===r.stencilMaskFront||a.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),n.stencilWriteMaskFront!==r.stencilWriteMaskFront&&a.stencilMask(r.stencilWriteMaskFront),n.stencilFailOpFront===r.stencilFailOpFront&&n.stencilZFailOpFront===r.stencilZFailOpFront&&n.stencilZPassOpFront===r.stencilZPassOpFront||a.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront)):r.stencilSep?(a.stencilFuncSeparate(a.FRONT,r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),a.stencilMaskSeparate(a.FRONT,r.stencilWriteMaskFront),a.stencilOpSeparate(a.FRONT,r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront),a.stencilFuncSeparate(a.BACK,r.stencilFuncBack,r.stencilRefBack,r.stencilMaskBack),a.stencilMaskSeparate(a.BACK,r.stencilWriteMaskBack),a.stencilOpSeparate(a.BACK,r.stencilFailOpBack,r.stencilZFailOpBack,r.stencilZPassOpBack)):(a.stencilFunc(r.stencilFuncFront,r.stencilRefFront,r.stencilMaskFront),a.stencilMask(r.stencilWriteMaskFront),a.stencilOp(r.stencilFailOpFront,r.stencilZFailOpFront,r.stencilZPassOpFront)))),n=t,a=i,e.cullMode!==a.cullMode&&(a.cullMode!==B.enums.CULL_NONE?(n.enable(n.CULL_FACE),n.cullFace(a.cullMode)):n.disable(n.CULL_FACE));var o=this;var _=t;var d=e;var s=i;var f=!1;if(-1!==s.maxStream){if(d.maxStream!==s.maxStream)f=!0;else if(d.program!==s.program)f=!0;else for(var p=0;p<s.maxStream+1;++p)if(d.vertexBuffers[p]!==s.vertexBuffers[p]||d.vertexBufferOffsets[p]!==s.vertexBufferOffsets[p]){f=!0;break;}if(f){for(var m=0;m<o._caps.maxVertexAttribs;++m)o._newAttributes[m]=0;for(var v=0;v<s.maxStream+1;++v){var y=s.vertexBuffers[v];var g=s.vertexBufferOffsets[v];if(y&&-1!==y._glID){_.bindBuffer(_.ARRAY_BUFFER,y._glID);for(var b=0;b<s.program._attributes.length;++b){var c=s.program._attributes[b];var l=y._format.element(c.name);l?(0===o._enabledAttributes[c.location]&&(_.enableVertexAttribArray(c.location),o._enabledAttributes[c.location]=1),o._newAttributes[c.location]=1,_.vertexAttribPointer(c.location,l.num,l.type,l.normalize,l.stride,l.offset+g*l.stride)):console.warn("Can not find vertex attribute: "+c.name);}}}for(var C=0;C<o._caps.maxVertexAttribs;++C)o._enabledAttributes[C]!==o._newAttributes[C]&&(_.disableVertexAttribArray(C),o._enabledAttributes[C]=0);}}e.indexBuffer!==i.indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer&&-1!==i.indexBuffer._glID?i.indexBuffer._glID:null);var x=!1;e.program!==i.program&&(i.program._linked?t.useProgram(i.program._glID):console.warn("Failed to use program: has not linked yet."),x=!0);var A=t;var S=e;var T=i;for(var w=0;w<T.maxTextureSlot+1;++w){var E;S.textureUnits[w]===T.textureUnits[w]||(E=T.textureUnits[w])&&-1!==E._glID&&(A.activeTexture(A.TEXTURE0+w),A.bindTexture(E._target,E._glID));}for(var P=0;P<i.program._uniforms.length;++P){var M=i.program._uniforms[P];var R=this._uniforms[M.name];var I;R&&(x||R.dirty)&&(R.dirty=!1,(I=(void 0===M.size?D:L)[M.type])?I(t,M.location,R.value):console.warn("Can not find commit function for uniform "+M.name));}u&&(i.indexBuffer?t.drawElements(this._next.primitiveType,u,i.indexBuffer._format,h*i.indexBuffer._bytesPerIndex):t.drawArrays(this._next.primitiveType,h,u),this._stats.drawcalls++),e.set(i),i.reset();};t=Device;function Device(t,e){var i;void 0===(e=e||{}).alpha&&(e.alpha=!1),void 0===e.stencil&&(e.stencil=!0),void 0===e.depth&&(e.depth=!0),void 0===e.antialias&&(e.antialias=!1),void 0===e.preserveDrawingBuffer&&(e.preserveDrawingBuffer=!1);try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)||t.getContext("webkit-3d",e)||t.getContext("moz-webgl",e);}catch(t){return void console.error(t);}i||console.error("This device does not support webgl"),this._gl=i,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),n.default.initDefault(this),this._current=new n.default(this),this._next=new n.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs);for(var r=0;r<this._caps.maxVertexAttribs;++r)this._enabledAttributes[r]=0,this._newAttributes[r]=0;}var i,r;e.default=t,a.exports=e.default;},{"./enums":309,"./state":316,"./texture-2d":317,"./texture-cube":318}],309:[function(t,e,i){"use strict";i.__esModule=!0,i.attrTypeBytes=function(t){return t===s.ATTR_TYPE_INT8||t===s.ATTR_TYPE_UINT8?1:t===s.ATTR_TYPE_INT16||t===s.ATTR_TYPE_UINT16?2:t===s.ATTR_TYPE_INT32||t===s.ATTR_TYPE_UINT32||t===s.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+t),0);},i.glFilter=function(t,e,i){void 0===i&&(i=-1);var r=a[e][i+1];return void 0!==r?r:(console.warn("Unknown FILTER: "+e),-1===i?t.LINEAR:t.LINEAR_MIPMAP_LINEAR);},i.glTextureFmt=function(t){var e=o[t];return void 0!==e?e:(console.warn("Unknown TEXTURE_FMT: "+t),o[s.TEXTURE_FMT_RGBA8]);},i.enums=void 0;var r=6407;var n=6408;var a=[[9728,9984,9986],[9729,9985,9987]];var o=[{format:r,internalFormat:33776,pixelType:null},{format:n,internalFormat:33777,pixelType:null},{format:n,internalFormat:33778,pixelType:null},{format:n,internalFormat:33779,pixelType:null},{format:r,internalFormat:36196,pixelType:null},{format:r,internalFormat:35841,pixelType:null},{format:n,internalFormat:35843,pixelType:null},{format:r,internalFormat:35840,pixelType:null},{format:n,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:r,internalFormat:r,pixelType:33635},{format:n,internalFormat:n,pixelType:32820},{format:n,internalFormat:n,pixelType:32819},{format:r,internalFormat:r,pixelType:5121},{format:n,internalFormat:n,pixelType:5121},{format:r,internalFormat:r,pixelType:36193},{format:n,internalFormat:n,pixelType:36193},{format:r,internalFormat:r,pixelType:5126},{format:n,internalFormat:n,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:r,internalFormat:37492,pixelType:null},{format:n,internalFormat:37496,pixelType:null}];var s={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};i.enums=s;},{}],310:[function(t,e,i){"use strict";function FrameBuffer(t,e,i,r){this._device=t,this._width=e,this._height=i,this._colors=r.colors||[],this._depth=r.depth||null,this._stencil=r.stencil||null,this._depthStencil=r.depthStencil||null,this._glID=t._gl.createFramebuffer();}var r;i.__esModule=!0,i.default=void 0,(r=FrameBuffer.prototype).destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed");},r.getHandle=function(){return this._glID;},i.default=FrameBuffer,e.exports=i.default;},{}],311:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./enums");function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(r={})[t.enums.INDEX_FMT_UINT8]=1,r[t.enums.INDEX_FMT_UINT16]=2,r[t.enums.INDEX_FMT_UINT32]=4;var n=r;(t=IndexBuffer.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed");},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numIndices=this._bytes/this._bytesPerIndex;}var i=this._device._gl;var r=this._usage;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r),this._needExpandDataStore=!1):i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,t,e),this._device._restoreIndexBuffer();}}else console.error("The buffer is destroyed");},t.setUsage=function(t){this._usage=t;},t=IndexBuffer,(r=[{key:"count",get:function(){return this._numIndices;}}])&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a);r=IndexBuffer;function IndexBuffer(t,e,i,r){this._device=t,this._format=e,this._usage=i,this._bytesPerIndex=n[e],this._bytes=r.byteLength,this._numIndices=this._bytes/this._bytesPerIndex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,r),t._stats.ib+=this._bytes;}var r,a;r.BYTES_PER_INDEX=n,i.default=r,e.exports=i.default;},{"./enums":309}],312:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("./enums");t={VertexFormat:t("./vertex-format"),IndexBuffer:t("./index-buffer"),VertexBuffer:t("./vertex-buffer"),Program:t("./program"),Texture:t("./texture"),Texture2D:t("./texture-2d"),TextureCube:t("./texture-cube"),RenderBuffer:t("./render-buffer"),FrameBuffer:t("./frame-buffer"),Device:t("./device"),attrTypeBytes:r.attrTypeBytes,glFilter:r.glFilter,glTextureFmt:r.glTextureFmt},Object.assign(t,r.enums),i.default=t,cc.gfx=t,e.exports=i.default;},{"./device":308,"./enums":309,"./frame-buffer":310,"./index-buffer":311,"./program":314,"./render-buffer":315,"./texture":319,"./texture-2d":317,"./texture-cube":318,"./vertex-buffer":320,"./vertex-format":321}],313:[function(t,e,i){"use strict";i.__esModule=!0,i.isPow2=function(t){return!(t&t-1||!t);};},{}],314:[function(o,t,e){"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}e.__esModule=!0,e.default=void 0;var i=0;function _parseError(i,r,t){t.split("\n").forEach(function(t){var e;t.length<5||((e=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t))?i.push({type:r,fileID:0|e[1],line:0|e[2],message:e[3].trim()}):0<t.length&&i.push({type:r,fileID:-1,line:0,message:t}));});}(r=Program.prototype).link=function(){if(!this._linked){var t=this._device._gl;var e=_createShader(t,t.VERTEX_SHADER,this._vertSource);var i=_createShader(t,t.FRAGMENT_SHADER,this._fragSource);var r=t.createProgram();t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r);var n=!1;var a=this._errors;if(t.getShaderParameter(e,t.COMPILE_STATUS)||(_parseError(a,"vs",t.getShaderInfoLog(e)),n=!0),t.getShaderParameter(i,t.COMPILE_STATUS)||(_parseError(a,"fs",t.getShaderInfoLog(i)),n=!0),t.deleteShader(e),t.deleteShader(i),n)return a;if(!t.getProgramParameter(r,t.LINK_STATUS))return a.push({info:"Failed to link shader program: "+t.getProgramInfoLog(r)}),a;this._glID=r;var h=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(var o=0;o<h;++o){var s=t.getActiveAttrib(r,o);var u=t.getAttribLocation(r,s.name);this._attributes.push({name:s.name,location:u,type:s.type});}var _=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(var c=0;c<_;++c){var d=t.getActiveUniform(r,c);var l=d.name;var f=t.getUniformLocation(r,l);var p="[0]"===l.substr(l.length-3);l={name:l=p?l.substr(0,l.length-3):l,location:f,type:d.type,size:p?d.size:void 0};this._uniforms.push(l);}this._linked=!0;}},r.destroy=function(){this._device._gl.deleteProgram(this._glID),this._linked=!1,this._glID=null,this._attributes=[],this._uniforms=[],this._samplers=[];},r=Program,(n=[{key:"id",get:function(){return this._id;}}])&&_defineProperties(r.prototype,n),a&&_defineProperties(r,a);n=Program;function Program(t,e){this._device=t,this._attributes=[],this._uniforms=[],this._samplers=[],this._errors=[],this._linked=!1,this._vertSource=e.vert,this._fragSource=e.frag,this._glID=null,this._id=i++;}var r,n,a;function _createShader(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),e;}e.default=n,t.exports=e.default;},{}],315:[function(t,e,i){"use strict";function RenderBuffer(t,e,i,r){this._device=t,this._format=e,this._glID=t._gl.createRenderbuffer(),this.update(i,r);}var r;i.__esModule=!0,i.default=void 0,(r=RenderBuffer.prototype).update=function(t,e){this._width=t,this._height=e;var i=this._device._gl;i.bindRenderbuffer(i.RENDERBUFFER,this._glID),i.renderbufferStorage(i.RENDERBUFFER,this._format,t,e),i.bindRenderbuffer(i.RENDERBUFFER,null);},r.destroy=function(){var t;null!==this._glID?((t=this._device._gl).bindRenderbuffer(t.RENDERBUFFER,null),t.deleteRenderbuffer(this._glID),this._glID=null):console.error("The render-buffer already destroyed");},i.default=RenderBuffer,e.exports=i.default;},{}],316:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t=t("./enums");var r={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:t.enums.BLEND_FUNC_ADD,blendAlphaEq:t.enums.BLEND_FUNC_ADD,blendSrc:t.enums.BLEND_ONE,blendDst:t.enums.BLEND_ZERO,blendSrcAlpha:t.enums.BLEND_ONE,blendDstAlpha:t.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:t.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:t.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZFailOpFront:t.enums.STENCIL_OP_KEEP,stencilZPassOpFront:t.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:t.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZFailOpBack:t.enums.STENCIL_OP_KEEP,stencilZPassOpBack:t.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:t.enums.CULL_BACK,primitiveType:t.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null};function State(t){this.vertexBuffers=new Array(t._caps.maxVertexStreams),this.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),this.textureUnits=new Array(t._caps.maxTextureUnits),this.set(r);}State.initDefault=function(t){r.vertexBuffers=new Array(t._caps.maxVertexStreams),r.vertexBufferOffsets=new Array(t._caps.maxVertexStreams),r.textureUnits=new Array(t._caps.maxTextureUnits);},(t=State.prototype).reset=function(){this.set(r);},t.set=function(t){this.blend=t.blend,this.blendSep=t.blendSep,this.blendColor=t.blendColor,this.blendEq=t.blendEq,this.blendAlphaEq=t.blendAlphaEq,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.depthFunc=t.depthFunc,this.stencilTest=t.stencilTest,this.stencilSep=t.stencilSep,this.stencilFuncFront=t.stencilFuncFront,this.stencilRefFront=t.stencilRefFront,this.stencilMaskFront=t.stencilMaskFront,this.stencilFailOpFront=t.stencilFailOpFront,this.stencilZFailOpFront=t.stencilZFailOpFront,this.stencilZPassOpFront=t.stencilZPassOpFront,this.stencilWriteMaskFront=t.stencilWriteMaskFront,this.stencilFuncBack=t.stencilFuncBack,this.stencilRefBack=t.stencilRefBack,this.stencilMaskBack=t.stencilMaskBack,this.stencilFailOpBack=t.stencilFailOpBack,this.stencilZFailOpBack=t.stencilZFailOpBack,this.stencilZPassOpBack=t.stencilZPassOpBack,this.stencilWriteMaskBack=t.stencilWriteMaskBack,this.cullMode=t.cullMode,this.primitiveType=t.primitiveType,this.maxStream=t.maxStream;for(var e=0;e<t.vertexBuffers.length;++e)this.vertexBuffers[e]=t.vertexBuffers[e];for(var i=0;i<t.vertexBufferOffsets.length;++i)this.vertexBufferOffsets[i]=t.vertexBufferOffsets[i];this.indexBuffer=t.indexBuffer,this.maxTextureSlot=t.maxTextureSlot;for(var r=0;r<t.textureUnits.length;++r)this.textureUnits[r]=t.textureUnits[r];this.program=t.program;},i.default=State,e.exports=i.default;},{"./enums":309}],317:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("./texture"))&&r.__esModule?r:{default:r};var r;var o=t("./enums");var a=t("./misc");function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}t=function(r){var t;t=r,(e=Texture2D).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(Texture2D);function Texture2D(t,e){var i=(t=r.call(this,t)||this)._device._gl;return t._target=i.TEXTURE_2D,t._glID=i.createTexture(),e.images=e.images||[null],t.update(e),t;}var e=Texture2D.prototype;return e.update=function(t){var e=this._device._gl;var i=this._genMipmap;var r,n;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=o.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=o.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=o.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=o.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmap=t.genMipmaps,i=t.genMipmaps),(r=this._device.caps.maxTextureSize||Number.MAX_VALUE)<(n=Math.max(t.width||0,t.height||0))&&console.warn("The current texture size "+n+" exceeds the maximum size ["+r+"] supported on the device."),void 0!==t.images&&1<t.images.length&&(i=!1,(t.width>t.height?t.width:t.height)>>t.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap."))),(0,a.isPow2)(this._width)&&(0,a.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmap=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D),this._genMipmap=!0),this._setTexInfo(),this._device._restoreTexture(0);},e.updateSubImage=function(t){var e=this._device._gl;var i=(0,o.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0);},e.updateImage=function(t){var e=this._device._gl;var i=(0,o.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._glID),this._setImage(i,t),this._device._restoreTexture(0);},e._setSubImage=function(t,e){var i=this._device._gl;var r=e.flipY;var n=e.premultiplyAlpha;var a=e.image;!a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer?(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this._compressed?i.compressedTexSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,a):i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,a)):(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),i.texSubImage2D(i.TEXTURE_2D,e.level,e.x,e.y,t.format,t.pixelType,a));},e._setImage=function(t,e){var i=this._device._gl;var r=e.flipY;var n=e.premultiplyAlpha;var a=e.image;!a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer?(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this._compressed?i.compressedTexImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,a):i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,a)):(void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),i.texImage2D(i.TEXTURE_2D,e.level,t.internalFormat,t.format,t.pixelType,a));},e._setMipmap=function(t,e,i){var r=(0,o.glTextureFmt)(this._format);var n={width:this._width,height:this._height,flipY:e,premultiplyAlpha:i,level:0,image:null};for(var a=0;a<t.length;++a)n.level=a,n.width=this._width>>a,n.height=this._height>>a,n.image=t[a],this._setImage(r,n);},e._setTexInfo=function(){var t=this._device._gl;var e=(0,a.isPow2)(this._width)&&(0,a.isPow2)(this._height);e||this._wrapS===o.enums.WRAP_CLAMP&&this._wrapT===o.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=o.enums.WRAP_CLAMP,this._wrapT=o.enums.WRAP_CLAMP);var i=this._genMipmap?this._mipFilter:-1;e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,(0,o.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,(0,o.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT);e=this._device.ext("EXT_texture_filter_anisotropic");e&&t.texParameteri(t.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy);},Texture2D;}(r.default);i.default=t,e.exports=i.default;},{"./enums":309,"./misc":313,"./texture":319}],318:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("./texture"))&&r.__esModule?r:{default:r};var r;var c=t("./enums");var n=t("./misc");function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}t=function(r){var t;t=r,(e=TextureCube).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(TextureCube);function TextureCube(t,e){var i=(t=r.call(this,t)||this)._device._gl;return t._target=i.TEXTURE_CUBE_MAP,t._glID=i.createTexture(),t.update(e),t;}var e=TextureCube.prototype;return e.update=function(t){var e=this._device._gl;var i=this._genMipmaps;t&&(void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),void 0!==t.anisotropy&&(this._anisotropy=t.anisotropy),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.mipFilter&&(this._mipFilter=t.mipFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,this._compressed=this._format>=c.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=c.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=c.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=c.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==t.genMipmaps&&(this._genMipmaps=t.genMipmaps,i=t.genMipmaps),void 0!==t.images&&1<t.images.length&&(i=!1,t.width!==t.height&&console.warn("texture-cube width and height should be identical."),t.width>>t.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn"))),(0,n.isPow2)(this._width)&&(0,n.isPow2)(this._height)||(i=!1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),void 0!==t.images&&0<t.images.length&&(this._setMipmap(t.images,t.flipY,t.premultiplyAlpha),1<t.images.length&&(this._genMipmaps=!0)),i&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_CUBE_MAP),this._genMipmaps=!0),this._setTexInfo(),this._device._restoreTexture(0);},e.updateSubImage=function(t){var e=this._device._gl;var i=(0,c.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setSubImage(i,t),this._device._restoreTexture(0);},e.updateImage=function(t){var e=this._device._gl;var i=(0,c.glTextureFmt)(this._format);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glID),this._setImage(i,t),this._device._restoreTexture(0);},e._setSubImage=function(t,e){var i=this._device._gl;var r=e.flipY;var n=e.premultiplyAlpha;var a=e.faceIndex;var o=e.image;void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,e.x,e.y,e.width,e.height,t.format,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,e.x,e.y,e.width,e.height,t.format,t.pixelType,o):i.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,e.x,e.y,t.format,t.pixelType,o);},e._setImage=function(t,e){var i=this._device._gl;var r=e.flipY;var n=e.premultiplyAlpha;var a=e.faceIndex;var o=e.image;void 0===r?i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1):i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),void 0===n?i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),!o||ArrayBuffer.isView(o)||o instanceof ArrayBuffer?this._compressed?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,t.internalFormat,e.width,e.height,0,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,t.internalFormat,e.width,e.height,0,t.format,t.pixelType,o):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,e.level,t.internalFormat,t.format,t.pixelType,o);},e._setMipmap=function(t,e,i){var r=(0,c.glTextureFmt)(this._format);var n={width:this._width,height:this._height,faceIndex:0,flipY:e,premultiplyAlpha:i,level:0,image:null};for(var a=0;a<t.length;++a){var o=t[a];n.level=a,n.width=this._width>>a,n.height=this._height>>a;for(var s=0;s<6;++s)n.faceIndex=s,n.image=o[s],this._setImage(r,n);}},e._setTexInfo=function(){var t=this._device._gl;var e=(0,n.isPow2)(this._width)&&(0,n.isPow2)(this._height);e||this._wrapS===c.enums.WRAP_CLAMP&&this._wrapT===c.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=c.enums.WRAP_CLAMP,this._wrapT=c.enums.WRAP_CLAMP);var i=this._genMipmaps?this._mipFilter:-1;e||-1===i||(console.warn("NPOT textures do not support mipmap filter"),i=-1),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,(0,c.glFilter)(t,this._minFilter,i)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,(0,c.glFilter)(t,this._magFilter,-1)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._wrapT);e=this._device.ext("EXT_texture_filter_anisotropic");e&&t.texParameteri(t.TEXTURE_CUBE_MAP,e.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy);},TextureCube;}(r.default);i.default=t,e.exports=i.default;},{"./enums":309,"./misc":313,"./texture":319}],319:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("./enums");var n=0;function Texture(t){this._device=t,this._width=4,this._height=4,this._genMipmaps=!1,this._compressed=!1,this._anisotropy=1,this._minFilter=r.enums.FILTER_LINEAR,this._magFilter=r.enums.FILTER_LINEAR,this._mipFilter=r.enums.FILTER_LINEAR,this._wrapS=r.enums.WRAP_REPEAT,this._wrapT=r.enums.WRAP_REPEAT,this._format=r.enums.TEXTURE_FMT_RGBA8,this._target=-1,this._id=n++;}Texture.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed");},i.default=Texture,e.exports=i.default;},{"./enums":309}],320:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;t("./enums");function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(t=VertexBuffer.prototype).destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed");},t.update=function(t,e){if(-1!==this._glID){if(0!==e.byteLength){if(t+e.byteLength>this._bytes){if(t)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=t+e.byteLength,this._numVertices=this._bytes/this._bytesPerVertex;}var i=this._device._gl;var r=this._usage;i.bindBuffer(i.ARRAY_BUFFER,this._glID),this._needExpandDataStore?(i.bufferData(i.ARRAY_BUFFER,e,r),this._needExpandDataStore=!1):i.bufferSubData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null);}}else console.error("The buffer is destroyed");},t.getFormat=function(t){return this._format.element(t);},t.setUsage=function(t){this._usage=t;},t=VertexBuffer,(r=[{key:"count",get:function(){return this._numVertices;}}])&&_defineProperties(t.prototype,r),n&&_defineProperties(t,n);r=VertexBuffer;function VertexBuffer(t,e,i,r){this._device=t,this._format=e,this._usage=i,this._bytesPerVertex=this._format._bytes,this._bytes=r.byteLength,this._numVertices=this._bytes/this._bytesPerVertex,this._needExpandDataStore=!0,this._glID=t._gl.createBuffer(),this.update(0,r),t._stats.vb+=this._bytes;}var r,n;i.default=r,e.exports=i.default;},{"./enums":309}],321:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var s=t("./enums");var c=(t=t("../murmurhash2_gc"))&&t.__esModule?t:{default:t};function VertexFormat(t){this._attr2el={},this._elements=[];var e="";for(var i=this._bytes=0,r=t.length;i<r;++i){var n=t[i];n={name:n.name,offset:this._bytes,stride:0,stream:-1,type:n.type,num:n.num,normalize:void 0!==n.normalize&&n.normalize,bytes:n.num*(0,s.attrTypeBytes)(n.type)};this._attr2el[n.name]=n,this._elements.push(n),this._bytes+=n.bytes,e+=n.name+":"+n.num+":"+n.type+":"+n.normalize;}for(var a=0,o=this._elements.length;a<o;++a)this._elements[a].stride=this._bytes;this._hash=(0,c.default)(e,666);}(t=VertexFormat.prototype).element=function(t){return this._attr2el[t];},t.getHash=function(){return this._hash;},i.default=VertexFormat,e.exports=i.default;},{"../murmurhash2_gc":330,"./enums":309}],322:[function(t,e,i){"use strict";function CircularPool(t,e){this._cursor=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t();}i.__esModule=!0,i.default=void 0,CircularPool.prototype.request=function(){var t=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,t;},i.default=CircularPool,e.exports=i.default;},{}],323:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("./timsort"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(t=FixedArray.prototype)._resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=void 0;},t.reset=function(){for(var t=0;t<this._count;++t)this._data[t]=void 0;this._count=0;},t.push=function(t){this._count>=this._data.length&&this._resize(2*this._data.length),this._data[this._count]=t,++this._count;},t.pop=function(){--this._count,this._count<0&&(this._count=0);var t=this._data[this._count];return this._data[this._count]=void 0,t;},t.fastRemove=function(t){var e;t>=this._count||t<0||(e=this._count-1,this._data[t]=this._data[e],this._data[e]=void 0,--this._count);},t.indexOf=function(t){return this._data.indexOf(t);},t.sort=function(t){return(0,r.default)(this._data,0,this._count,t);},t=FixedArray,(n=[{key:"length",get:function(){return this._count;}},{key:"data",get:function(){return this._data;}}])&&_defineProperties(t.prototype,n),a&&_defineProperties(t,a);n=FixedArray;function FixedArray(t){this._count=0,this._data=new Array(t);}var n,a;i.default=n,e.exports=i.default;},{"./timsort":328}],324:[function(t,e,i){"use strict";i.__esModule=!0,i.TypedArrayPool=i.RecyclePool=i.Pool=i.LinkedArray=i.FixedArray=i.CircularPool=void 0;var r=_interopRequireDefault(t("./circular-pool"));i.CircularPool=r.default;r=_interopRequireDefault(t("./fixed-array"));i.FixedArray=r.default;r=_interopRequireDefault(t("./linked-array"));i.LinkedArray=r.default;r=_interopRequireDefault(t("./pool"));i.Pool=r.default;r=_interopRequireDefault(t("./recycle-pool"));i.RecyclePool=r.default;r=_interopRequireDefault(t("./typed-array-pool"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}i.TypedArrayPool=r.default;},{"./circular-pool":322,"./fixed-array":323,"./linked-array":325,"./pool":326,"./recycle-pool":327,"./typed-array-pool":329}],325:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("./pool"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(t=LinkedArray.prototype).add=function(){var t=this._pool.alloc();return this._tail?(this._tail._next=t)._prev=this._tail:this._head=t,this._tail=t,this._count+=1,t;},t.remove=function(t){t._prev?t._prev._next=t._next:this._head=t._next,t._next?t._next._prev=t._prev:this._tail=t._prev,t._next=null,t._prev=null,this._pool.free(t),--this._count;},t.forEach=function(t,e){var i=this._head;if(i){e&&(t=t.bind(e));var r=0;var n;for(;i;)n=i._next,t(i,r,this),i=n,++r;}},t=LinkedArray,(n=[{key:"head",get:function(){return this._head;}},{key:"tail",get:function(){return this._tail;}},{key:"length",get:function(){return this._count;}}])&&_defineProperties(t.prototype,n),a&&_defineProperties(t,a);n=LinkedArray;function LinkedArray(t,e){this._fn=t,this._count=0,this._head=null,this._tail=null,this._pool=new r.default(t,e);}var n,a;i.default=n,e.exports=i.default;},{"./pool":326}],326:[function(t,e,i){"use strict";function Pool(t,e){this._fn=t,this._idx=e-1,this._frees=new Array(e);for(var i=0;i<e;++i)this._frees[i]=t();}var r;i.__esModule=!0,i.default=void 0,(r=Pool.prototype)._expand=function(t){var e=this._frees;this._frees=new Array(t);var i=t-e.length;for(var r=0;r<i;++r)this._frees[r]=this._fn();for(var n=i,a=0;n<t;++n,++a)this._frees[n]=e[a];this._idx+=i;},r.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var t=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,t;},r.free=function(t){++this._idx,this._frees[this._idx]=t;},r.clear=function(t){for(var e=0;e<=this._idx;e++)t&&t(this._frees[e]);this._frees.length=0,this._idx=-1;},i.default=Pool,e.exports=i.default;},{}],327:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=(t=t("./timsort"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}(t=RecyclePool.prototype).reset=function(){this._count=0;},t.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn();},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++];},t.remove=function(t){var e,i;t>=this._count||(e=this._count-1,i=this._data[t],this._data[t]=this._data[e],this._data[e]=i,--this._count);},t.sort=function(t){return(0,r.default)(this._data,0,this._count,t);},t=RecyclePool,(n=[{key:"length",get:function(){return this._count;}},{key:"data",get:function(){return this._data;}}])&&_defineProperties(t.prototype,n),a&&_defineProperties(t,a);n=RecyclePool;function RecyclePool(t,e){this._fn=t,this._count=0,this._data=new Array(e);for(var i=0;i<e;++i)this._data[i]=t();}var n,a;i.default=n,cc.RecyclePool=n,e.exports=i.default;},{"./timsort":328}],328:[function(i,r,t){"use strict";t.__esModule=!0,t.default=function(t,e,i,r){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");void 0===e&&(e=0),void 0===i&&(i=t.length),void 0===r&&(r=alphabeticalCompare);var n=i-e;if(!(n<2)){var a=0;if(n<l)a=makeAscendingRun(t,e,i,r),binaryInsertionSort(t,e,i,e+a,r);else{var o=new h(t,r);var s=function(t){var e=0;for(;l<=t;)e|=1&t,t>>=1;return t+e;}(n);do{var c;}while(((a=makeAscendingRun(t,e,i,r))<s&&(binaryInsertionSort(t,e,e+(c=s<(c=n)?s:c),e+a,r),a=c),o.pushRun(e,a),o.mergeRuns(),e+=a,0!==(n-=a)));o.forceMergeRuns();}}};var l=32;var a=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function log10(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9;}function alphabeticalCompare(t,e){if(t===e)return 0;if(~~t===t&&~~e===e){if(0===t||0===e)return t<e?-1:1;if(t<0||e<0){if(0<=e)return-1;if(0<=t)return 1;t=-t,e=-e;}var i=log10(t);var r=log10(e);var n=0;return i<r?(t*=a[r-i-1],e/=10,n=-1):r<i&&(e*=a[i-r-1],t/=10,n=1),t===e?n:t<e?-1:1;}i=String(t);r=String(e);return i===r?0:i<r?-1:1;}function makeAscendingRun(t,e,i,r){var n=e+1;if(n===i)return 1;if(r(t[n++],t[e])<0){for(;n<i&&r(t[n],t[n-1])<0;)n++;var a=t;var o=e;var s=n;for(s--;o<s;){var c=a[o];a[o++]=a[s],a[s--]=c;}}else for(;n<i&&0<=r(t[n],t[n-1]);)n++;return n-e;}function binaryInsertionSort(t,e,i,r,n){for(r===e&&r++;r<i;r++){var a=t[r];var o=e;var s=r;for(;o<s;){var c=o+s>>>1;n(a,t[c])<0?s=c:o=1+c;}var l=r-o;switch(l){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;0<l;)t[o+l]=t[o+l-1],l--;}t[o]=a;}}function gallopLeft(t,e,i,r,n,a){var o=0;var s=0;var c=1;if(0<a(t,e[i+n])){for(s=r-n;c<s&&0<a(t,e[i+n+c]);)(c=1+((o=c)<<1))<=0&&(c=s);s<c&&(c=s),o+=n,c+=n;}else{for(s=n+1;c<s&&a(t,e[i+n-c])<=0;)(c=1+((o=c)<<1))<=0&&(c=s);r=o;o=n-(c=s<c?s:c),c=n-r;}for(o++;o<c;){var l=o+(c-o>>>1);0<a(t,e[i+l])?o=l+1:c=l;}return c;}function gallopRight(t,e,i,r,n,a){var o=0;var s=0;var c=1;if(a(t,e[i+n])<0){for(s=n+1;c<s&&a(t,e[i+n-c])<0;)(c=1+((o=c)<<1))<=0&&(c=s);var h=o;o=n-(c=s<c?s:c),c=n-h;}else{for(s=r-n;c<s&&0<=a(t,e[i+n+c]);)(c=1+((o=c)<<1))<=0&&(c=s);s<c&&(c=s),o+=n,c+=n;}for(o++;o<c;){var l=o+(c-o>>>1);a(t,e[i+l])<0?c=l:o=l+1;}return c;}(e=TimSort.prototype).pushRun=function(t,e){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=e,this.stackSize+=1;},e.mergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;if(1<=t&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||2<=t&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t);}},e.forceMergeRuns=function(){for(;1<this.stackSize;){var t=this.stackSize-2;0<t&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t);}},e.mergeAt=function(t){var e=this.compare;var i=this.array;var r=this.runStart[t];var n=this.runLength[t];var a=this.runStart[t+1];var o=this.runLength[t+1];this.runLength[t]=n+o,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;t=gallopRight(i[a],i,r,n,0,e);r+=t,0!=(n-=t)&&0!==(o=gallopLeft(i[r+n-1],i,a,o,o-1,e))&&(n<=o?this.mergeLow(r,n,a,o):this.mergeHigh(r,n,a,o));},e.mergeLow=function(h,t,u,e){var _=this.compare;var i=this.array;var r=this.tmp;var n=0;for(n=0;n<t;n++)r[n]=i[h+n];var a=0;var o=u;var s=h;if(i[s++]=i[o++],0!=--e){if(1!==t){var d=this.minGallop;for(;;){var c=0;var l=0;var f=!1;do{if(_(i[o],r[a])<0){if(i[s++]=i[o++],l++,(c=0)==--e){f=!0;break;}}else if(i[s++]=r[a++],c++,l=0,1==--t){f=!0;break;}}while((c|l)<d);if(f)break;do{if(0!==(c=gallopRight(i[o],r,a,t,0,_))){for(n=0;n<c;n++)i[s+n]=r[a+n];if(s+=c,a+=c,(t-=c)<=1){f=!0;break;}}if(i[s++]=i[o++],0==--e){f=!0;break;}if(0!==(l=gallopLeft(r[a],i,o,e,0,_))){for(n=0;n<l;n++)i[s+n]=i[o+n];if(s+=l,o+=l,0===(e-=l)){f=!0;break;}}if(i[s++]=r[a++],1==--t){f=!0;break;}}while((d--,7<=c||7<=l));if(f)break;d<0&&(d=0),d+=2;}if((this.minGallop=d)<1&&(this.minGallop=1),1===t){for(n=0;n<e;n++)i[s+n]=i[o+n];i[s+e]=r[a];}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(n=0;n<t;n++)i[s+n]=r[a+n];}}else{for(n=0;n<e;n++)i[s+n]=i[o+n];i[s+e]=r[a];}}else for(n=0;n<t;n++)i[s+n]=r[a+n];},e.mergeHigh=function(h,t,u,e){var _=this.compare;var i=this.array;var r=this.tmp;var n=0;for(n=0;n<e;n++)r[n]=i[u+n];var a=h+t-1;var d=e-1;var o=u+e-1;var s=0;var f=0;if(i[o--]=i[a--],0!=--t){if(1!==e){var p=this.minGallop;for(;;){var c=0;var l=0;var m=!1;do{if(_(r[d],i[a])<0){if(i[o--]=i[a--],c++,(l=0)==--t){m=!0;break;}}else if(i[o--]=r[d--],l++,c=0,1==--e){m=!0;break;}}while((c|l)<p);if(m)break;do{if(0!==(c=t-gallopRight(r[d],i,h,t,t-1,_))){for(t-=c,f=(o-=c)+1,s=(a-=c)+1,n=c-1;0<=n;n--)i[f+n]=i[s+n];if(0===t){m=!0;break;}}if(i[o--]=r[d--],1==--e){m=!0;break;}if(0!==(l=e-gallopLeft(i[a],r,0,e,e-1,_))){for(e-=l,f=(o-=l)+1,s=(d-=l)+1,n=0;n<l;n++)i[f+n]=r[s+n];if(e<=1){m=!0;break;}}if(i[o--]=i[a--],0==--t){m=!0;break;}}while((p--,7<=c||7<=l));if(m)break;p<0&&(p=0),p+=2;}if((this.minGallop=p)<1&&(this.minGallop=1),1===e){for(f=(o-=t)+1,s=(a-=t)+1,n=t-1;0<=n;n--)i[f+n]=i[s+n];i[o]=r[d];}else{if(0===e)throw new Error("mergeHigh preconditions were not respected");for(s=o-(e-1),n=0;n<e;n++)i[s+n]=r[n];}}else{for(f=(o-=t)+1,s=(a-=t)+1,n=t-1;0<=n;n--)i[f+n]=i[s+n];i[o]=r[d];}}else for(s=o-(e-1),n=0;n<e;n++)i[s+n]=r[n];};var h=TimSort;function TimSort(t,e){this.array=t,this.compare=e,this.minGallop=7,this.length=t.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0;}var e;r.exports=t.default;},{}],329:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=Array(8);for(var n=0;n<8;++n)r[n]=[];function _log2(t){var e,i;return e=(65535<t)<<4,(e=(e|=i=(255<(t>>>=e))<<3)|(i=(15<(t>>>=i))<<2)|(i=(3<(t>>>=i))<<1))|(t>>>=i)>>1;}function _alloc(t){t=function(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0;}(t);var e=r[_log2(t)>>2];return 0<e.length?e.pop():new ArrayBuffer(t);}i.default={alloc_int8:function(t){var e=new Int8Array(_alloc(t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_uint8:function(t){var e=new Uint8Array(_alloc(t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_int16:function(t){var e=new Int16Array(_alloc(2*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_uint16:function(t){var e=new Uint16Array(_alloc(2*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_int32:function(t){var e=new Int32Array(_alloc(4*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_uint32:function(t){var e=new Uint32Array(_alloc(4*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_float32:function(t){var e=new Float32Array(_alloc(4*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_float64:function(t){var e=new Float64Array(_alloc(8*t),0,t);return e.length!==t?e.subarray(0,t):e;},alloc_dataview:function(t){var e=new DataView(_alloc(t),0,t);return e.length!==t?e.subarray(0,t):e;},free:function(t){t=t.buffer,r[_log2(t.byteLength)>>2].push(t);},reset:function(){var t=Array(8);for(var e=0;e<8;++e)t[e]=[];}},e.exports=i.default;},{}],330:[function(t,e,i){"use strict";i.__esModule=!0,i.default=function(t,e){var i,r=t.length,n=e^r,a=0;for(;4<=r;)i=1540483477*(65535&(i=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:n^=(255&t.charCodeAt(a+2))<<16;case 2:n^=(255&t.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16);}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0;},e.exports=i.default;},{}],331:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;var n=t("../../core/value-types");var r=_interopRequireDefault(t("../core/base-renderer"));var c=_interopRequireDefault(t("../enums"));t=t("../memop");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}function _createSuper(r){return function(){var t=_getPrototypeOf(r);var e;return e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(i=e)||"object"!=typeof i&&"function"!=typeof i?_assertThisInitialized(t):i;var i;};}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var h=new Float32Array(16);var u=new Float32Array(16);var _=new Float32Array(16);var a=new Float32Array(16);var d=new Float32Array(4);var f=new Float32Array(64);var p=[];var m=new Float32Array(4);var o=new n.Vec4(0,0,0,0);var v=new n.Vec3(0,0,0);var s=new n.Vec3(0,0,0);var l=new t.RecyclePool(function(){return new Float32Array(16);},8);t=function(i){var t;t=i,(e=ForwardRenderer).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t;_createSuper(ForwardRenderer);function ForwardRenderer(t,e){return(t=i.call(this,t,e)||this)._time=new Float32Array(4),t._lights=[],t._shadowLights=[],t._numLights=0,t._defines={},t._registerStage("shadowcast",t._shadowStage.bind(_assertThisInitialized(t))),t._registerStage("opaque",t._opaqueStage.bind(_assertThisInitialized(t))),t._registerStage("transparent",t._transparentStage.bind(_assertThisInitialized(t))),t;}var e=ForwardRenderer.prototype;return e.reset=function(){l.reset(),i.prototype.reset.call(this);},e.render=function(t,e){this.reset(),this._time[0]+=e,this._device.setUniform("cc_time",this._time),this._updateLights(t);var i=this._device._gl.canvas;for(var r=0;r<t._cameras.length;++r){var n=this._requestView();var a=i.width;var o=i.height;t._cameras.data[r].extractView(n,a,o);}this._viewPools.sort(function(t,e){return t._priority-e._priority;});for(var s=0;s<this._viewPools.length;++s){var c=this._viewPools.data[s];this._render(c,t);}},e.renderCamera=function(t,e){this.reset();var i=this._device._gl.canvas;var r=i.width;i=i.height;var n=this._requestView();t.extractView(n,r,i),this._render(n,e);},e._updateLights=function(t){this._lights.length=0,this._shadowLights.length=0;var e=t._lights;for(var i=0;i<e.length;++i){var r=e.data[i];var n;r.update(this._device),r.shadowType!==c.default.SHADOW_NONE?(this._shadowLights.length<2&&this._shadowLights.splice(0,0,r),n=this._requestView(),r.extractView(n,["shadowcast"]),this._lights.splice(0,0,r)):this._lights.push(r);}this._updateLightDefines(),this._numLights=e._count;},e._updateLightDefines=function(){var t=this._defines;for(var e=0;e<this._lights.length;++e){var i=this._lights[e];t["CC_LIGHT_"+e+"_TYPE"]=i._type,t["CC_SHADOW_"+e+"_TYPE"]=i._shadowType;}t.CC_NUM_LIGHTS=Math.min(4,this._lights.length),t.CC_NUM_SHADOW_LIGHTS=Math.min(4,this._shadowLights.length);},e._submitLightsUniforms=function(){var t=this._device;if(0<this._lights.length){var e=l.add();var i=l.add();var r=l.add();var n=Math.min(4,this._lights.length);for(var a=0;a<n;++a){var o=this._lights[a];var s=4*a;r.set(o._colorUniform,s),i.set(o._directionUniform,s),e.set(o._positionUniform,s),e[3+s]=o._range,o._type===c.default.LIGHT_SPOT?(i[3+s]=o._spotUniform[0],r[3+s]=o._spotUniform[1]):(i[3+s]=0,r[3+s]=0);}t.setUniform("cc_lightDirection",i),t.setUniform("cc_lightColor",r),t.setUniform("cc_lightPositionAndRange",e);}},e._submitShadowStageUniforms=function(t){var e=t._shadowLight;var i=m;i[0]=e.shadowMinDepth,i[1]=e.shadowMaxDepth,i[2]=e.shadowDepthScale,i[3]=e.shadowDarkness,this._device.setUniform("cc_shadow_map_lightViewProjMatrix",n.Mat4.toArray(a,t._matViewProj)),this._device.setUniform("cc_shadow_map_info",i),this._device.setUniform("cc_shadow_map_bias",e.shadowBias),this._defines.CC_SHADOW_TYPE=e._shadowType;},e._submitOtherStagesUniforms=function(){var t=l.add();for(var e=0;e<this._shadowLights.length;++e){var i=this._shadowLights[e];var r=p[e];r=r||(p[e]=new Float32Array(f.buffer,64*e,16)),n.Mat4.toArray(r,i.viewProjMatrix);r=4*e;t[r]=i.shadowMinDepth,t[1+r]=i.shadowMaxDepth,t[2+r]=i._shadowResolution,t[3+r]=i.shadowDarkness;}this._device.setUniform("cc_shadow_lightViewProjMatrix",f),this._device.setUniform("cc_shadow_info",t);},e._sortItems=function(t){t.sort(function(t,e){return t.passes.length!==e.passes.length?t.passes.length-e.passes.length:t.sortKey-e.sortKey;});},e._shadowStage=function(t,e){this._submitShadowStageUniforms(t);for(var i=0;i<e.length;++i){var r=e.data[i];r.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(r);}},e._drawItems=function(t,e){var i=this._shadowLights;if(0===i.length&&0===this._numLights)for(var r=0;r<e.length;++r){var n=e.data[r];this._draw(n);}else for(var a=0;a<e.length;++a){var o=e.data[a];for(var s=0;s<i.length;++s)this._device.setTexture("cc_shadow_map_"+s,i[s].shadowMap,this._allocTextureUnit());this._draw(o);}},e._opaqueStage=function(t,e){t.getPosition(o),this._device.setUniform("cc_matView",n.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",n.Mat4.toArray(u,t._matViewInv)),this._device.setUniform("cc_matpProj",n.Mat4.toArray(_,t._matProj)),this._device.setUniform("cc_matViewProj",n.Mat4.toArray(a,t._matViewProj)),this._device.setUniform("cc_cameraPos",n.Vec4.toArray(d,o)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),this._drawItems(t,e);},e._transparentStage=function(t,e){t.getPosition(o),t.getForward(v),this._device.setUniform("cc_matView",n.Mat4.toArray(h,t._matView)),this._device.setUniform("cc_matViewInv",n.Mat4.toArray(u,t._matViewInv)),this._device.setUniform("cc_matpProj",n.Mat4.toArray(_,t._matProj)),this._device.setUniform("cc_matViewProj",n.Mat4.toArray(a,t._matViewProj)),this._device.setUniform("cc_cameraPos",n.Vec4.toArray(d,o)),this._submitLightsUniforms(),this._submitOtherStagesUniforms();for(var i=0;i<e.length;++i){var r=e.data[i];r.node.getWorldPosition(s),n.Vec3.sub(s,s,o),r.sortKey=-n.Vec3.dot(s,v);}this._sortItems(e),this._drawItems(t,e);},ForwardRenderer;}(r.default);e.default=t,i.exports=e.default;},{"../../core/value-types":279,"../core/base-renderer":301,"../enums":307,"../memop":324}],332:[function(t,i,e){"use strict";e.__esModule=!0,e.default=void 0;var s=t("../../core/value-types");var _=t("../../core/geom-utils");var c=(t=t("../enums"))&&t.__esModule?t:{default:t};function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);}}var n=new s.Mat4();var a=new s.Mat4();var d=new s.Mat4();var r=new s.Mat4();var o=new s.Mat4();var l=new s.Mat4();var h=new s.Vec3();var u=new s.Vec3();(t=Camera.prototype).setCullingMask=function(t){this._cullingMask=t;},t.getNode=function(){return this._node;},t.setNode=function(t){this._node=t;},t.getType=function(){return this._projection;},t.setType=function(t){this._projection=t;},t.getPriority=function(){return this._priority;},t.setPriority=function(t){this._priority=t;},t.getOrthoHeight=function(){return this._orthoHeight;},t.setOrthoHeight=function(t){this._orthoHeight=t;},t.getFov=function(){return this._fov;},t.setFov=function(t){this._fov=t;},t.getNear=function(){return this._near;},t.setNear=function(t){this._near=t;},t.getFar=function(){return this._far;},t.setFar=function(t){this._far=t;},t.getColor=function(t){return s.Vec4.copy(t,this._color);},t.setColor=function(t,e,i,r){s.Vec4.set(this._color,t,e,i,r);},t.getDepth=function(){return this._depth;},t.setDepth=function(t){this._depth=t;},t.getStencil=function(){return this._stencil;},t.setStencil=function(t){this._stencil=t;},t.getClearFlags=function(){return this._clearFlags;},t.setClearFlags=function(t){this._clearFlags=t;},t.getRect=function(t){return t.x=this._rect.x,t.y=this._rect.y,t.w=this._rect.w,t.h=this._rect.h,t;},t.setRect=function(t,e,i,r){this._rect.x=t,this._rect.y=e,this._rect.w=i,this._rect.h=r;},t.getStages=function(){return this._stages;},t.setStages=function(t){this._stages=t;},t.getFramebuffer=function(){return this._framebuffer;},t.setFrameBuffer=function(t){this._framebuffer=t;},t._calcMatrices=function(t,e){this._node.getWorldRT(d),s.Mat4.invert(a,d);t/=e;this._projection===c.default.PROJ_PERSPECTIVE?s.Mat4.perspective(r,this._fov,t,this._near,this._far):(e=this._orthoHeight*t,t=this._orthoHeight,s.Mat4.ortho(r,-e,e,-t,t,this._near,this._far)),s.Mat4.mul(o,r,a),s.Mat4.invert(l,o);},t.extractView=function(t,e,i){this._framebuffer&&(e=this._framebuffer._width,i=this._framebuffer._height),t._priority=this._priority,t._rect.x=this._rect.x*e,t._rect.y=this._rect.y*i,t._rect.w=this._rect.w*e,t._rect.h=this._rect.h*i,this.getColor(t._color),t._depth=this._depth,t._stencil=this._stencil,t._clearFlags=this._clearFlags,t._clearModel=this._clearModel,t._stages=this._stages,t._framebuffer=this._framebuffer,this._calcMatrices(e,i),s.Mat4.copy(t._matView,a),s.Mat4.copy(t._matViewInv,d),s.Mat4.copy(t._matProj,r),s.Mat4.copy(t._matViewProj,o),s.Mat4.copy(t._matInvViewProj,l),t._cullingMask=this._cullingMask;},t.screenPointToRay=function(t,e,i,r,n){if(!cc.geomUtils)return n;n=n||new _.Ray(),this._calcMatrices(i,r);var a=this._rect.x*i;var o=this._rect.y*r;i=this._rect.w*i;r=this._rect.h*r;return s.Vec3.set(u,(t-a)/i*2-1,(e-o)/r*2-1,1),s.Vec3.transformMat4(u,u,l),this._projection===c.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(h):(s.Vec3.set(h,(t-a)/i*2-1,(e-o)/r*2-1,-1),s.Vec3.transformMat4(h,h,l)),_.Ray.fromPoints(n,h,u);},t.screenToWorld=function(t,e,i,r){this._calcMatrices(i,r);var n=this._rect.x*i;var a=this._rect.y*r;i=this._rect.w*i;r=this._rect.h*r;return this._projection===c.default.PROJ_PERSPECTIVE?(s.Vec3.set(t,(e.x-n)/i*2-1,(e.y-a)/r*2-1,.9999),s.Vec3.transformMat4(t,t,l),this._node.getWorldPosition(h),s.Vec3.lerp(t,h,t,(0,s.lerp)(this._near/this._far,1,e.z))):(s.Vec3.set(t,(e.x-n)/i*2-1,(e.y-a)/r*2-1,2*e.z-1),s.Vec3.transformMat4(t,t,l)),t;},t.worldToScreen=function(t,e,i,r){this._calcMatrices(i,r);var n=this._rect.x*i;var a=this._rect.y*r;i=this._rect.w*i;r=this._rect.h*r;return s.Vec3.transformMat4(t,e,o),t.x=n+.5*(t.x+1)*i,t.y=a+.5*(t.y+1)*r,t.z=.5*t.z+.5,t;},t.worldMatrixToScreen=function(t,e,i,r){this._calcMatrices(i,r),s.Mat4.mul(t,o,e);e=i/2;i=r/2;return s.Mat4.identity(n),s.Mat4.transform(n,n,s.Vec3.set(h,e,i,0)),s.Mat4.scale(n,n,s.Vec3.set(h,e,i,1)),s.Mat4.mul(t,n,t),t;},t=Camera,(f=[{key:"cullingMask",get:function(){return this._cullingMask;},set:function(t){this._cullingMask=t;}}])&&_defineProperties(t.prototype,f),p&&_defineProperties(t,p);f=Camera;function Camera(){this._poolID=-1,this._node=null,this._projection=c.default.PROJ_PERSPECTIVE,this._priority=0,this._color=new s.Vec4(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=c.default.CLEAR_COLOR|c.default.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295;}var f,p;e.default=f,i.exports=e.default;},{"../../core/geom-utils":123,"../../core/value-types":279,"../enums":307}],333:[function(t,e,i){"use strict";function Model(){this._type="default",this._poolID=-1,this._node=null,this._inputAssembler=null,this._effect=null,this._viewID=-1,this._cameraID=-1,this._userKey=-1,this._castShadow=!1,this._boundingShape=null;}var r;i.__esModule=!0,i.default=void 0,(r=Model.prototype).setNode=function(t){this._node=t;},r.setInputAssembler=function(t){this._inputAssembler=t;},r.setEffect=function(t){this._effect=t;},r.setUserKey=function(t){this._userKey=t;},r.extractDrawItem=function(t){t.model=this,t.node=this._node,t.ia=this._inputAssembler,t.effect=this._effect;},i.default=Model,e.exports=i.default;},{}],334:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;var r=t("../memop");function Scene(t){this._lights=new r.FixedArray(16),this._models=new r.FixedArray(16),this._cameras=new r.FixedArray(16),this._debugCamera=null,this._app=t,this._views=[];}(t=Scene.prototype)._add=function(t,e){-1===e._poolID&&(t.push(e),e._poolID=t.length-1);},t._remove=function(t,e){-1!==e._poolID&&(t.data[t.length-1]._poolID=e._poolID,t.fastRemove(e._poolID),e._poolID=-1);},t.reset=function(){for(var t=0;t<this._models.length;++t)this._models.data[t]._viewID=-1;},t.setDebugCamera=function(t){this._debugCamera=t;},t.getCameraCount=function(){return this._cameras.length;},t.getCamera=function(t){return this._cameras.data[t];},t.addCamera=function(t){this._add(this._cameras,t);},t.removeCamera=function(t){this._remove(this._cameras,t);},t.getModelCount=function(){return this._models.length;},t.getModel=function(t){return this._models.data[t];},t.addModel=function(t){this._add(this._models,t);},t.removeModel=function(t){this._remove(this._models,t);},t.getLightCount=function(){return this._lights.length;},t.getLight=function(t){return this._lights.data[t];},t.addLight=function(t){this._add(this._lights,t);},t.removeLight=function(t){this._remove(this._lights,t);},t.addView=function(t){-1===this._views.indexOf(t)&&this._views.push(t);},t.removeView=function(t){t=this._views.indexOf(t);-1!==t&&this._views.splice(t,1);},i.default=Scene,e.exports=i.default;},{"../memop":324}],335:[function(t,c,e){"use strict";e.__esModule=!0,e.getInspectorProps=function(t){var e={type:t.type};Object.assign(e,t.editor||t.inspector),e.defines=t.defines,e.value=h(e.type)(t.value);t=u(e.type);e.typeName=_[t]||t,e.valueCtor=s[e.type],"cc.Texture2D"==e.typeName&&(e.typeName="cc.Asset",e.assetType="cc.Texture2D");return e;},e.getClassName=e.getInstanceCtor=e.getInstanceType=e.enums2default=e.ctor2enums=void 0;var i=_interopRequireDefault(t("./enums"));var r=t("../core/value-types");var n=_interopRequireDefault(t("../core/assets/CCTexture2D"));var a;function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t};}t=t("./gfx/texture-2d");var o=cc.Object;(a={})[Boolean]=function(t){return t||!1;},a[Number]=function(t){return t?ArrayBuffer.isView(t)?t[0]:t:0;},a[r.Vec2]=function(t){return t?cc.v2(t[0],t[1]):cc.v2();},a[r.Vec3]=function(t){return t?cc.v3(t[0],t[1],t[2]):cc.v3();},a[r.Vec4]=function(t){return t?cc.v4(t[0],t[1],t[2],t[3]):cc.v4();},a[r.Color]=function(t){return t?cc.color(255*t[0],255*t[1],255*t[2],255*(t[3]||1)):cc.color();},a[r.Mat4]=function(t){return t?cc.mat4(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]):cc.mat4();},a[n.default]=function(){return null;},a[o]=function(){return null;};var l=a;(a={})[i.default.PARAM_INT]=Number,a[i.default.PARAM_INT2]=r.Vec2,a[i.default.PARAM_INT3]=r.Vec3,a[i.default.PARAM_INT4]=r.Vec4,a[i.default.PARAM_FLOAT]=Number,a[i.default.PARAM_FLOAT2]=r.Vec2,a[i.default.PARAM_FLOAT3]=r.Vec3,a[i.default.PARAM_FLOAT4]=r.Vec4,a[i.default.PARAM_MAT4]=r.Mat4,a[i.default.PARAM_TEXTURE_2D]=n.default,a.color=r.Color,a.number=Number,a.boolean=Boolean,a.default=o;var s=a;(o={})[Number]=i.default.PARAM_FLOAT,o[r.Vec2]=i.default.PARAM_FLOAT2,o[r.Vec3]=i.default.PARAM_FLOAT3,o[r.Vec4]=i.default.PARAM_FLOAT4,o[r.Color]=i.default.PARAM_COLOR3,o[r.Color]=i.default.PARAM_COLOR4,o[r.Mat4]=i.default.PARAM_MAT4,o[n.default]=i.default.PARAM_TEXTURE_2D,o[t]=i.default.PARAM_TEXTURE_2D,e.ctor2enums=o,(a={})[i.default.PARAM_INT]=new Uint32Array([0]),a[i.default.PARAM_INT2]=new Uint32Array([0,0]),a[i.default.PARAM_INT3]=new Uint32Array([0,0,0]),a[i.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),a[i.default.PARAM_FLOAT]=new Float32Array([0]),a[i.default.PARAM_FLOAT2]=new Float32Array([0,0]),a[i.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),a[i.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),a[i.default.PARAM_MAT4]=cc.mat4().m,a[i.default.PARAM_TEXTURE_2D]=null,a.number=0,a.boolean=!1,e.enums2default=a;function IM2(t){return s[t]||s.default;}e.getInstanceType=IM2;var h=function(t){return l[IM2(t)];};e.getInstanceCtor=h;var u=function(t){return cc.js.getClassName(IM2(t));};e.getClassName=u;var _={Number:"number",Boolean:"boolean"};},{"../core/assets/CCTexture2D":50,"../core/value-types":279,"./enums":307,"./gfx/texture-2d":317}],336:[function(t,e,i){"use strict";var _=t("../compression/ZipUtils");var d=t("../compression/zlib.min");var r=t("../core/platform/js");function strToColor(t){if(!t)return cc.color(0,0,0,255);var e;if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length)return e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0,cc.color(i,r,n,e);var i=parseInt(t.substr(0,2),16)||0;var r=parseInt(t.substr(2,2),16)||0;var n=parseInt(t.substr(4,2),16)||0;return cc.color(i,r,n,255);}function getPropertyList(t,e){var i=[];var r=t.getElementsByTagName("properties");for(var n=0;n<r.length;++n){var a=r[n].getElementsByTagName("property");for(var o=0;o<a.length;++o)i.push(a[o]);}e=e||{};for(var s=0;s<i.length;s++){var c=i[s];var h=c.getAttribute("name");var l=c.getAttribute("type")||"string";c=c.getAttribute("value");"int"===l?c=parseInt(c):"float"===l?c=parseFloat(c):"bool"===l?c="true"===c:"color"===l&&(c=strToColor(c)),e[h]=c;}return e;}t("../core/platform/CCSAXParser"),cc.TMXLayerInfo=function(){this.properties={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.v2(0,0);},cc.TMXLayerInfo.prototype={constructor:cc.TMXLayerInfo,getProperties:function(){return this.properties;},setProperties:function(t){this.properties=t;}},cc.TMXImageLayerInfo=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=cc.v2(0,0),this._opacity=0,this._trans=new cc.Color(255,255,255,255),this.sourceImage=null;},cc.TMXObjectGroupInfo=function(){this.properties={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new cc.Color(255,255,255,255),this.offset=cc.v2(0,0),this._draworder="topdown";},cc.TMXObjectGroupInfo.prototype={constructor:cc.TMXObjectGroupInfo,getProperties:function(){return this.properties;},setProperties:function(t){this.properties=t;}},cc.TMXTilesetInfo=function(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=null,this.imageSize=cc.size(0,0),this.tileOffset=cc.v2(0,0),this._tileSize=cc.size(0,0);},cc.TMXTilesetInfo.prototype={constructor:cc.TMXTilesetInfo,rectForGID:function(t,e){e=e||cc.rect(0,0,0,0);e.width=this._tileSize.width,e.height=this._tileSize.height,t=(t&=cc.TiledMap.TileFlag.FLIPPED_MASK)-parseInt(this.firstGid,10);var i=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return e.x=parseInt(t%i*(this._tileSize.width+this.spacing)+this.margin,10),e.y=parseInt(parseInt(t/i,10)*(this._tileSize.height+this.spacing)+this.margin,10),e;}},cc.TMXMapInfo=function(t,e,i,r,n){this.properties=[],this.orientation=null,this.parentElement=null,this.parentGID=null,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=cc.TiledMap.RenderOrder.RightDown,this._supportVersion=[1,2,0],this._parser=new cc.SAXParser(),this._objectGroups=[],this._allChildren=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties={},this._tileAnimations={},this._tsxMap=null,this._textures=null,this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerTextures=null,this.initWithXML(t,e,i,r,n);},cc.TMXMapInfo.prototype={constructor:cc.TMXMapInfo,getOrientation:function(){return this.orientation;},setOrientation:function(t){this.orientation=t;},getStaggerAxis:function(){return this._staggerAxis;},setStaggerAxis:function(t){this._staggerAxis=t;},getStaggerIndex:function(){return this._staggerIndex;},setStaggerIndex:function(t){this._staggerIndex=t;},getHexSideLength:function(){return this._hexSideLength;},setHexSideLength:function(t){this._hexSideLength=t;},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height);},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height;},_getMapWidth:function(){return this._mapSize.width;},_setMapWidth:function(t){this._mapSize.width=t;},_getMapHeight:function(){return this._mapSize.height;},_setMapHeight:function(t){this._mapSize.height=t;},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height);},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height;},_getTileWidth:function(){return this._tileSize.width;},_setTileWidth:function(t){this._tileSize.width=t;},_getTileHeight:function(){return this._tileSize.height;},_setTileHeight:function(t){this._tileSize.height=t;},getLayers:function(){return this._layers;},setLayers:function(t){this._allChildren.push(t),this._layers.push(t);},getImageLayers:function(){return this._imageLayers;},setImageLayers:function(t){this._allChildren.push(t),this._imageLayers.push(t);},getTilesets:function(){return this._tilesets;},setTilesets:function(t){this._tilesets.push(t);},getObjectGroups:function(){return this._objectGroups;},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t);},getAllChildren:function(){return this._allChildren;},getParentElement:function(){return this.parentElement;},setParentElement:function(t){this.parentElement=t;},getParentGID:function(){return this.parentGID;},setParentGID:function(t){this.parentGID=t;},getLayerAttribs:function(){return this.layerAttrs;},setLayerAttribs:function(t){this.layerAttrs=t;},getStoringCharacters:function(){return this.storingCharacters;},setStoringCharacters:function(t){this.storingCharacters=t;},getProperties:function(){return this.properties;},setProperties:function(t){this.properties=t;},initWithXML:function(t,e,i,r,n){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxMap=e,this._textures=i,this._imageLayerTextures=n,this._textureSizes=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties.length=0,this._tileProperties={},this._tileAnimations={},this.currentString="",this.storingCharacters=!1,this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=cc.TiledMap.NONE,this.parseXMLString(t);},parseXMLString:function(t,h){var e;t=this._parser._parseXML(t).documentElement;var i=t.getAttribute("orientation");var u=t.getAttribute("staggeraxis");var _=t.getAttribute("staggerindex");var d=t.getAttribute("hexsidelength");var f=t.getAttribute("renderorder");var p=t.getAttribute("version")||"1.0.0";if("map"===t.nodeName){var m=p.split(".");var v=this._supportVersion;for(var y=0;y<v.length;y++){var g=parseInt(m[y])||0;if(v[y]<g){cc.logID(7216,p);break;}}"orthogonal"===i?this.orientation=cc.TiledMap.Orientation.ORTHO:"isometric"===i?this.orientation=cc.TiledMap.Orientation.ISO:"hexagonal"===i?this.orientation=cc.TiledMap.Orientation.HEX:null!==i&&cc.logID(7217,i),this.renderOrder="right-up"===f?cc.TiledMap.RenderOrder.RightUp:"left-up"===f?cc.TiledMap.RenderOrder.LeftUp:"left-down"===f?cc.TiledMap.RenderOrder.LeftDown:cc.TiledMap.RenderOrder.RightDown,"x"===u?this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===u&&this.setStaggerAxis(cc.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===_?this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===_&&this.setStaggerIndex(cc.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),d&&this.setHexSideLength(parseFloat(d));i=cc.size(0,0);i.width=parseFloat(t.getAttribute("width")),i.height=parseFloat(t.getAttribute("height")),this.setMapSize(i),(i=cc.size(0,0)).width=parseFloat(t.getAttribute("tilewidth")),i.height=parseFloat(t.getAttribute("tileheight")),this.setTileSize(i),this.properties=getPropertyList(t);}var b=t.getElementsByTagName("tileset");for("map"!==t.nodeName&&(b=[]).push(t),e=0;e<b.length;e++){var r=b[e];var n=r.getAttribute("source");if(n){var a=parseInt(r.getAttribute("firstgid"));n=this._tsxMap[n];n&&this.parseXMLString(n,a);}else{n=r.getElementsByTagName("image");var C=1<n.length;var x=n[0];var A=x.getAttribute("source");A.replace(/\\/g,"/");var S=r.getElementsByTagName("tile");var T=S&&S.length||1;var o=null;var w=r.getAttribute("name")||"";var E=parseInt(r.getAttribute("spacing"))||0;var P=parseInt(r.getAttribute("margin"))||0;var M=parseInt(h);M=M||parseInt(r.getAttribute("firstgid"))||0;var R=cc.size(0,0);R.width=parseFloat(r.getAttribute("tilewidth")),R.height=parseFloat(r.getAttribute("tileheight"));a=r.getElementsByTagName("tileoffset")[0];var I=cc.v2(0,0);a&&(I.x=parseFloat(a.getAttribute("x")),I.y=parseFloat(a.getAttribute("y")));var s=null;for(var B=0;B<T;B++)if(s&&!C||((s=new cc.TMXTilesetInfo()).name=w,s.firstGid=M,s.spacing=E,s.margin=P,s._tileSize=R,s.tileOffset=I,s.sourceImage=this._textures[A],s.imageSize=this._textureSizes[A]||s.imageSize,s.sourceImage||cc.errorID(7221,A),this.setTilesets(s)),o=S&&S[B]){this.parentGID=parseInt(M)+parseInt(o.getAttribute("id")||0);var c=o.getElementsByTagName("image");c&&0<c.length&&((c=(x=c[0]).getAttribute("source")).replace(/\\/g,"/"),s.sourceImage=this._textures[c],s.sourceImage||cc.errorID(7221,c),(c=cc.size(0,0)).width=parseFloat(x.getAttribute("width")),c.height=parseFloat(x.getAttribute("height")),s._tileSize=c,s.firstGid=this.parentGID),this._tileProperties[this.parentGID]=getPropertyList(o);c=o.getElementsByTagName("animation");if(c&&0<c.length){var D=c[0].getElementsByTagName("frame");c={frames:[],dt:0,frameIdx:0};var L=(this._tileAnimations[this.parentGID]=c).frames;for(var V=0;V<D.length;V++){var O=D[V];var F=parseInt(M)+parseInt(O.getAttribute("tileid"));O=parseFloat(O.getAttribute("duration"));L.push({tileid:F,duration:O/1e3,grid:null});}}}}}var N=t.childNodes;for(e=0;e<N.length;e++){var l=N[e];var k;this._shouldIgnoreNode(l)||("imagelayer"!==l.nodeName||(k=this._parseImageLayer(l))&&this.setImageLayers(k),"layer"===l.nodeName&&(k=this._parseLayer(l),this.setLayers(k)),"objectgroup"===l.nodeName&&(l=this._parseObjectGroup(l),this.setObjectGroups(l)));}return t;},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType;},_parseImageLayer:function(t){var e=t.getElementsByTagName("image");if(!e||0==e.length)return null;var i=new cc.TMXImageLayerInfo();i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);r=t.getAttribute("opacity")||1;i.opacity=parseInt(255*parseFloat(r))||255;t=e[0];r=t.getAttribute("source");return i.sourceImage=this._imageLayerTextures[r],i.width=parseInt(t.getAttribute("width"))||0,i.height=parseInt(t.getAttribute("height"))||0,i.trans=strToColor(t.getAttribute("trans")),i.sourceImage?i:(cc.errorID(7221,r),null);},_parseLayer:function(t){var e=t.getElementsByTagName("data")[0];var i=new cc.TMXLayerInfo();i.name=t.getAttribute("name");var r=cc.size(0,0);r.width=parseFloat(t.getAttribute("width")),r.height=parseFloat(t.getAttribute("height")),i._layerSize=r;r=t.getAttribute("visible");i.visible=!("0"===r);r=t.getAttribute("opacity")||1;i._opacity=r?parseInt(255*parseFloat(r)):255,i.offset=cc.v2(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var n="";for(var a=0;a<e.childNodes.length;a++)n+=e.childNodes[a].nodeValue;n=n.trim();r=e.getAttribute("compression");var o=e.getAttribute("encoding");if(r&&"gzip"!==r&&"zlib"!==r)return cc.logID(7218),null;var s;switch(r){case"gzip":s=_.unzipBase64AsArray(n,4);break;case"zlib":s=function(t){if(t.length%4!=0)return null;var e=t.length/4;var i=window.Uint32Array?new Uint32Array(e):[];for(var r=0;r<e;r++){var n=4*r;i[r]=t[n]+256*t[1+n]+65536*t[2+n]+t[3+n]*(1<<24);}return i;}(new d.Inflate(_.Base64.decodeAsArray(n,1)).decompress());break;case null:case"":if("base64"===o)s=_.Base64.decodeAsArray(n,4);else if("csv"===o){s=[];var h=n.split(",");for(var c=0;c<h.length;c++)s.push(parseInt(h[c]));}else{var u=e.getElementsByTagName("tile");s=[];for(var l=0;l<u.length;l++)s.push(parseInt(u[l].getAttribute("gid")));}break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.logID(7219);}return s&&(i._tiles=new Uint32Array(s)),i.properties=getPropertyList(t),i;},_parseObjectGroup:function(t){var e=new cc.TMXObjectGroupInfo();e.name=t.getAttribute("name")||"",e.offset=cc.v2(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var i=t.getAttribute("opacity")||1;e._opacity=i?parseInt(255*parseFloat(i)):255;i=t.getAttribute("visible");i&&0===parseInt(i)&&(e.visible=!1);i=t.getAttribute("color");i&&e._color.fromHEX(i);i=t.getAttribute("draworder");i&&(e._draworder=i),e.setProperties(getPropertyList(t));var r=t.getElementsByTagName("object");if(r){for(var n=0;n<r.length;n++){var a=r[n];var o={};o.id=a.getAttribute("id")||n,o.name=a.getAttribute("name")||"",o.width=parseFloat(a.getAttribute("width"))||0,o.height=parseFloat(a.getAttribute("height"))||0,o.x=parseFloat(a.getAttribute("x"))||0,o.y=parseFloat(a.getAttribute("y"))||0,o.rotation=parseFloat(a.getAttribute("rotation"))||0,getPropertyList(a,o);var s=a.getAttribute("visible");o.visible=!(s&&0===parseInt(s));s=a.getElementsByTagName("text");s&&0<s.length&&(s=s[0],o.type=cc.TiledMap.TMXObjectType.TEXT,o.wrap="1"==s.getAttribute("wrap"),o.color=strToColor(s.getAttribute("color")),o.halign=function(t){var e=cc.Label.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT;}}(s.getAttribute("halign")),o.valign=function(t){var e=cc.Label.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP;}}(s.getAttribute("valign")),o.pixelsize=parseInt(s.getAttribute("pixelsize"))||16,o.text=s.childNodes[0].nodeValue);s=a.getAttribute("gid");s&&(o.gid=parseInt(s),o.type=cc.TiledMap.TMXObjectType.IMAGE);s=a.getElementsByTagName("ellipse");s&&0<s.length&&(o.type=cc.TiledMap.TMXObjectType.ELLIPSE);s=a.getElementsByTagName("polygon");s&&0<s.length&&(o.type=cc.TiledMap.TMXObjectType.POLYGON,(s=s[0].getAttribute("points"))&&(o.points=this._parsePointsString(s)));s=a.getElementsByTagName("polyline");s&&0<s.length&&(o.type=cc.TiledMap.TMXObjectType.POLYLINE,(a=s[0].getAttribute("points"))&&(o.polylinePoints=this._parsePointsString(a))),o.type||(o.type=cc.TiledMap.TMXObjectType.RECT),e._objects.push(o);}"index"!==i&&e._objects.sort(function(t,e){return t.y-e.y;});}return e;},_parsePointsString:function(t){if(!t)return null;var e=[];var i=t.split(" ");for(var r=0;r<i.length;r++){var n=i[r].split(",");e.push({x:parseFloat(n[0]),y:parseFloat(n[1])});}return e;},setTileAnimations:function(t){this._tileAnimations=t;},getTileAnimations:function(){return this._tileAnimations;},getTileProperties:function(){return this._tileProperties;},setTileProperties:function(t){this._tileProperties=t;},getCurrentString:function(){return this.currentString;},setCurrentString:function(t){this.currentString=t;}};t=cc.TMXMapInfo.prototype;r.getset(t,"mapWidth",t._getMapWidth,t._setMapWidth),r.getset(t,"mapHeight",t._getMapHeight,t._setMapHeight),r.getset(t,"tileWidth",t._getTileWidth,t._setTileWidth),r.getset(t,"tileHeight",t._getTileHeight,t._setTileHeight),cc.TMXLayerInfo.ATTRIB_NONE=1,cc.TMXLayerInfo.ATTRIB_BASE64=2,cc.TMXLayerInfo.ATTRIB_GZIP=4,cc.TMXLayerInfo.ATTRIB_ZLIB=8;},{"../compression/ZipUtils":23,"../compression/zlib.min":26,"../core/platform/CCSAXParser":196,"../core/platform/js":209}],337:[function(t,e,h){"use strict";var i=t("../core/value-types");var u=(r=t("../core/assets/material/material-variant"))&&r.__esModule?r:{default:r};var r=t("../core/components/CCRenderComponent");var _=t("../core/assets/material/CCMaterial");var n=t("../core/renderer/render-flow");var a=cc.mat4();var o=cc.v2();var s=cc.v2();var c={row:0,col:0};var l=cc.Class({name:"cc.TiledUserNodeData",extends:cc.Component,ctor:function(){this._index=-1,this._row=-1,this._col=-1,this._tiledLayer=null;}});t=cc.Class({name:"cc.TiledLayer",extends:r,editor:{inspector:"packages://inspector/inspectors/comps/tiled-layer.js"},ctor:function(){this._userNodeGrid={},this._userNodeMap={},this._userNodeDirty=!1,this._tiledTiles=[],this._tilesetIndexArr=[],this._texIdToMatIndex={},this._viewPort={x:-1,y:-1,width:-1,height:-1},this._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},this._cullingDirty=!0,this._rightTop={row:-1,col:-1},this._layerInfo=null,this._mapInfo=null,this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._tiles=[],this._vertices=[],this._verticesDirty=!0,this._layerName="",this._layerOrientation=null,this._texGrids=null,this._textures=null,this._tilesets=null,this._leftDownToCenterX=0,this._leftDownToCenterY=0,this._hasTiledNodeGrid=!1,this._hasAniGrid=!1,this._animations=null,this._enableCulling=cc.macro.ENABLE_TILEDMAP_CULLING;},_hasTiledNode:function(){return this._hasTiledNodeGrid;},_hasAnimation:function(){return this._hasAniGrid;},enableCulling:function(t){this._enableCulling!=t&&(this._enableCulling=t,this._cullingDirty=!0);},addUserNode:function(t){var e=t.getComponent(l);return e?(cc.warn("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(l),t.parent=this.node,t._renderFlag|=n.FLAG_BREAK_FLOW,(this._userNodeMap[t._id]=e)._row=-1,e._col=-1,(e._tiledLayer=this)._nodeLocalPosToLayerPos(t,o),this._positionToRowCol(o.x,o.y,c),this._addUserNodeToGrid(e,c),this._updateCullingOffsetByUserNode(t),t.on(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.on(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),!0);},removeUserNode:function(t){var e=t.getComponent(l);return e?(t.off(cc.Node.EventType.POSITION_CHANGED,this._userNodePosChange,e),t.off(cc.Node.EventType.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t._id],t._removeComponent(e),e.destroy(),t.removeFromParent(!0),t._renderFlag&=~n.FLAG_BREAK_FLOW,!0):(cc.warn("CCTiledLayer:removeUserNode node is not exist"),!1);},destroyUserNode:function(t){this.removeUserNode(t),t.destroy();},_nodeLocalPosToLayerPos:function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY;},_getNodesByRowCol:function(t,e){t=this._userNodeGrid[t];return t?t[e]:null;},_getNodesCountByRow:function(t){t=this._userNodeGrid[t];return t?t.count:0;},_updateAllUserNode:function(){for(var t in this._userNodeGrid={},this._userNodeMap){t=this._userNodeMap[t];this._nodeLocalPosToLayerPos(t.node,o),this._positionToRowCol(o.x,o.y,c),this._addUserNodeToGrid(t,c),this._updateCullingOffsetByUserNode(t.node);}},_updateCullingOffsetByUserNode:function(t){this._topOffset<t.height&&(this._topOffset=t.height),this._downOffset<t.height&&(this._downOffset=t.height),this._leftOffset<t.width&&(this._leftOffset=t.width),this._rightOffset<t.width&&(this._rightOffset=t.width);},_userNodeSizeChange:function(){var t=this.node;this._tiledLayer._updateCullingOffsetByUserNode(t);},_userNodePosChange:function(){var t=this.node;var e=this._tiledLayer;e._nodeLocalPosToLayerPos(t,o),e._positionToRowCol(o.x,o.y,c),e._limitInLayer(c),c.row===this._row&&c.col===this._col||(e._removeUserNodeFromGrid(this),e._addUserNodeToGrid(this,c));},_removeUserNodeFromGrid:function(t){var e=t._row;var i=t._col;var r=t._index;e=this._userNodeGrid[e];i=e&&e[i];i&&(e.count--,i.count--,i.list[r]=null,i.count<=0&&(i.list.length=0,i.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0;},_limitInLayer:function(t){var e=t.row;var i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col);},_addUserNodeToGrid:function(t,e){var i=e.row;e=e.col;var r=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0};var n=r[e]=r[e]||{count:0,list:[]};t._row=i,t._col=e,t._index=n.list.length,r.count++,n.count++,n.list.push(t),this._userNodeDirty=!0;},_isUserNodeDirty:function(){return this._userNodeDirty;},_setUserNodeDirty:function(t){this._userNodeDirty=t;},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this),this._activateMaterial();},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this);},_syncAnchorPoint:function(){var t=this.node;this._leftDownToCenterX=t.width*t.anchorX*t.scaleX,this._leftDownToCenterY=t.height*t.anchorY*t.scaleY,this._cullingDirty=!0;},onDestroy:function(){this._super(),this._buffer&&(this._buffer.destroy(),this._buffer=null),this._renderDataList=null;},getLayerName:function(){return this._layerName;},setLayerName:function(t){this._layerName=t;},getProperty:function(t){return this._properties[t];},getPositionAt:function(t,e){var i;var r;switch(e=void 0!==e?(i=Math.floor(t),Math.floor(e)):(i=Math.floor(t.x),Math.floor(t.y)),this._layerOrientation){case cc.TiledMap.Orientation.ORTHO:r=this._positionForOrthoAt(i,e);break;case cc.TiledMap.Orientation.ISO:r=this._positionForIsoAt(i,e);break;case cc.TiledMap.Orientation.HEX:r=this._positionForHexAt(i,e);}return r;},_isInvalidPosition:function(t,e){var i;return t&&"object"==typeof t&&(e=(i=t).y,t=i.x),t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0;},_positionForIsoAt:function(t,e){var i=0,r=0;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;n=this._tiles[n];return n&&(i=(n=this._texGrids[n].tileset.tileOffset).x,r=n.y),cc.v2(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-r);},_positionForOrthoAt:function(t,e){var i=0,r=0;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;n=this._tiles[n];return n&&(i=(n=this._texGrids[n].tileset.tileOffset).x,r=n.y),cc.v2(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-r);},_positionForHexAt:function(t,e){var i=this._mapTileSize.width;var r=this._mapTileSize.height;var h=this._layerSize.height;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;n=this._tiles[n];var a=this._texGrids[n].tileset.tileOffset;var u=this._staggerIndex===cc.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1;var o=0,s=0;var c=0;var l=0;switch(this._staggerAxis){case cc.TiledMap.StaggerAxis.STAGGERAXIS_Y:c=0,o=t*i+(c=e%2==1?i/2*u:c)+a.x,s=(h-e-1)*(r-(r-this._hexSideLength)/2)-a.y;break;case cc.TiledMap.StaggerAxis.STAGGERAXIS_X:l=0,o=t*(i-(i-this._hexSideLength)/2)+a.x,s=(h-e-1)*r+(l=t%2==1?r/2*-u:l)-a.y;}return cc.v2(o,s);},setTileGIDAt:function(t,e,i,r){if(void 0===e)throw new Error("cc.TiledLayer.setTileGIDAt(): pos should be non-null");var n;if(void 0===r&&e instanceof cc.Vec2?(n=e,r=i):n=cc.v2(e,i),n.x=Math.floor(n.x),n.y=Math.floor(n.y),this._isInvalidPosition(n))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this._tiles&&this._tilesets&&0!=this._tilesets.length?0!==t&&t<this._tilesets[0].firstGid?cc.logID(7239,t):(r=r||0,e=this.getTileFlagsAt(n),this.getTileGIDAt(n)===t&&e===r||this._updateTileForGID((t|r)>>>0,n)):cc.logID(7238);},_updateTileForGID:function(t,e){0!==t&&!this._texGrids[t]||(e=0|e.x+e.y*this._layerSize.width)<this._tiles.length&&(this._tiles[e]=t,this._cullingDirty=!0);},getTileGIDAt:function(t,e){if(void 0===t)throw new Error("cc.TiledLayer.getTileGIDAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),this._isInvalidPosition(i,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this._tiles)return cc.logID(7237),null;t=Math.floor(i)+Math.floor(e)*this._layerSize.width;return(this._tiles[t]&cc.TiledMap.TileFlag.FLIPPED_MASK)>>>0;},getTileFlagsAt:function(t,e){if(!t)throw new Error("TiledLayer.getTileFlagsAt: pos should be non-null");if(void 0!==e&&(t=cc.v2(t,e)),this._isInvalidPosition(t))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this._tiles)return cc.logID(7240),null;e=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;return(this._tiles[e]&cc.TiledMap.TileFlag.FLIPPED_ALL)>>>0;},_setCullingDirty:function(t){this._cullingDirty=t;},_isCullingDirty:function(){return this._cullingDirty;},_updateViewPort:function(t,e,i,r){var n,a,o;this._viewPort.width===i&&this._viewPort.height===r&&this._viewPort.x===t&&this._viewPort.y===e||(this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r,t=1,this._layerOrientation===cc.TiledMap.Orientation.ISO&&(t=2),e=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,n=e-this._leftOffset,a=o-this._downOffset,e=e+i+this._rightOffset,i=o+r+this._topOffset,o=this._cullingRect.leftDown,r=this._cullingRect.rightTop,this._positionToRowCol(n=n<0?0:n,a=a<0?0:a,c),c.row-=t,c.col-=t,c.row=0<c.row?c.row:0,c.col=0<c.col?c.col:0,c.row===o.row&&c.col===o.col||(o.row=c.row,o.col=c.col,this._cullingDirty=!0),e<0||i<0?(c.row=-1,c.col=-1):(this._positionToRowCol(e,i,c),c.row++,c.col++),c.row>this._rightTop.row&&(c.row=this._rightTop.row),c.col>this._rightTop.col&&(c.col=this._rightTop.col),c.row===r.row&&c.col===r.col||(r.row=c.row,r.col=c.col,this._cullingDirty=!0));},_positionToRowCol:function(t,e,i){var r=cc.TiledMap;var n=r.Orientation;var h=r.StaggerAxis;var a=this._mapTileSize.width,o=this._mapTileSize.height,u=.5*a,_=.5*o;var s,c=0,l=0,d=this._staggerAxis;this._layerSize.width;switch(this._layerOrientation){case n.ORTHO:l=Math.floor(t/a),c=Math.floor(e/o);break;case n.ISO:l=Math.floor(t/u),c=Math.floor(e/_);break;case n.HEX:d===h.STAGGERAXIS_Y?(s=(c=Math.floor(e/(o-this._diffY1)))%2==1?u*this._odd_even:0,l=Math.floor((t-s)/a)):(s=(l=Math.floor(t/(a-this._diffX1)))%2==1?_*-this._odd_even:0,c=Math.floor((e-s)/o));}return i.row=c,i.col=l,i;},_updateCulling:function(){var t,e;this._enableCulling&&(this.node._updateWorldMatrix(),i.Mat4.invert(a,this.node._worldMatrix),t=cc.visibleRect,(e=cc.Camera.findCamera(this.node))&&(o.x=0,o.y=0,s.x=o.x+t.width,s.y=o.y+t.height,e.getScreenToWorldPoint(o,o),e.getScreenToWorldPoint(s,s),i.Vec2.transformMat4(o,o,a),i.Vec2.transformMat4(s,s,a),this._updateViewPort(o.x,o.y,s.x-o.x,s.y-o.y)));},getLayerOrientation:function(){return this._layerOrientation;},getProperties:function(){return this._properties;},_updateVertices:function(){var h=cc.TiledMap;var u=h.TileFlag.FLIPPED_MASK;var _=h.StaggerAxis;var d=h.Orientation;var f=this._vertices;f.length=0;var p=this._layerOrientation,m=this._tiles;if(m){var t=this._rightTop;t.row=-1,t.col=-1;var v=this._mapTileSize.width,y=this._mapTileSize.height,g=.5*v,b=.5*y,e=this._layerSize.height,C=this._layerSize.width,x=this._texGrids;var i,r,n,A,S,T,w,E=0;p===d.HEX&&(A=this._staggerAxis,S=this._diffX1,T=this._diffY1,w=this._odd_even);var a=0,o=0;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;var P,M,R=0,I=0;for(var s=0;s<e;++s){for(var c=0;c<C;++c){var B=E+c;if(i=x[l=(m[B]&u)>>>0],this._animations[l]&&(this._hasAniGrid=!0),i){switch(p){case d.ORTHO:r=(a=c)*v,n=(o=e-s-1)*y;break;case d.ISO:r=g*(a=e+c-s-1),n=b*(o=e+C-c-s-2);break;case d.HEX:r=c*(v-S)+(A===_.STAGGERAXIS_Y&&s%2==1?g*w:0),n=(e-s-1)*(y-T)+(A===_.STAGGERAXIS_X&&c%2==1?b*-w:0),a=c,o=e-s-1;}var l=f[o]=f[o]||{minCol:0,maxCol:0};var D=l[a]=l[a]||{};l.minCol>a&&(l.minCol=a),l.maxCol<a&&(l.maxCol=a),t.row<o&&(t.row=o),t.col<a&&(t.col=a),l=i.tileset.tileOffset,r+=this._offset.x+l.x,n+=this._offset.y-l.y,R=(R=-l.y+i.tileset._tileSize.height-y)<0?0:R,P=l.y<0?0:l.y,M=-l.x<0?0:-l.x,I=(I=l.x+i.tileset._tileSize.width-v)<0?0:I,this._rightOffset<M&&(this._rightOffset=M),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<P&&(this._topOffset=P),this._downOffset<R&&(this._downOffset=R),D.left=r,D.bottom=n,D.index=B;}}E+=C;}this._verticesDirty=!1;}},getTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;r=this._tiledTiles[r];return!r&&i&&((r=(i=new cc.Node()).addComponent(cc.TiledTile))._x=t,r._y=e,r._layer=this,r._updateInfo(),i.parent=this.node),r;},setTiledTileAt:function(t,e,i){if(this._isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this._tiles)return cc.logID(7236),null;t=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this._tiledTiles[t]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this._tiledTiles.some(function(t,e){return!!t;}),i;},getTexture:function(t){return t=t||0,this._textures&&0<=t&&this._textures.length>t?this._textures[t]:null;},getTextures:function(){return this._textures;},setTexture:function(t){this.setTextures([t]);},setTextures:function(t){this._textures=t,this._activateMaterial();},getLayerSize:function(){return this._layerSize;},getMapTileSize:function(){return this._mapTileSize;},getTileSet:function(t){return t=t||0,this._tilesets&&0<=t&&this._tilesets.length>t?this._tilesets[t]:null;},getTileSets:function(){return this._tilesets;},setTileSet:function(t){this.setTileSets([t]);},setTileSets:function(r){this._tilesets=r;var t=this._textures=[];var n=this._texGrids=[];for(var e=0;e<r.length;e++){var i=r[e];i&&(t[e]=i.sourceImage);}cc.TiledMap.loadAllTextures(t,function(){for(var t=0,e=r.length;t<e;++t){var i=r[t];i&&cc.TiledMap.fillTextureGrids(i,n,t);}this._prepareToRender();}.bind(this));},_traverseAllGrid:function(){var t=this._tiles;var e=this._texGrids;var i=this._tilesetIndexArr;var r={};var n=cc.TiledMap.TileFlag.FLIPPED_MASK;for(var a=i.length=0;a<t.length;a++){var o=t[a];var s;0!==o&&((s=e[o=(o&n)>>>0])?r[s=s.texId]||(r[s]=!0,i.push(s)):cc.error("CCTiledLayer:_traverseAllGrid grid is null, gid is:",o));}},_init:function(t,e,i,r,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var a=t._layerSize;this._layerName=t.name,this._tiles=t._tiles,this._properties=t.properties,this._layerSize=a,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this._renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=r,this._texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();a=this._mapTileSize.width;i=this._mapTileSize.height;r=this._layerSize.width;n=this._layerSize.height;var o,s,c;this._layerOrientation===cc.TiledMap.Orientation.HEX?(o=(e=cc.TiledMap).StaggerAxis,e=e.StaggerIndex,c=s=0,this._odd_even=this._staggerIndex===e.STAGGERINDEX_ODD?1:-1,this._staggerAxis===o.STAGGERAXIS_X?(this._diffX1=(a-this._hexSideLength)/2,this._diffY1=0,c=i*(n+.5),s=(a+this._hexSideLength)*Math.floor(r/2)+a*(r%2)):(this._diffX1=0,this._diffY1=(i-this._hexSideLength)/2,s=a*(r+.5),c=(i+this._hexSideLength)*Math.floor(n/2)+i*(n%2)),this.node.setContentSize(s,c)):this._layerOrientation===cc.TiledMap.Orientation.ISO?this.node.setContentSize(.5*a*(e=r+n),.5*i*e):this.node.setContentSize(r*a,n*i),this._offset=cc.v2(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender();},_prepareToRender:function(){this._updateVertices(),this._traverseAllGrid(),this._updateAllUserNode(),this._activateMaterial();},_activateMaterial:function(){var t=this._tilesetIndexArr;if(0!==t.length){var e=this._texIdToMatIndex={};var i=this._textures;var r=t.length;for(var n=0;n<r;n++){var a=t[n];var o=i[a];var s=this._materials[n];s=s||_.getBuiltinMaterial("2d-sprite"),(s=u.default.create(s,this)).define("CC_USE_MODEL",!0),s.setProperty("texture",o),this._materials[n]=s,e[a]=n;}this._materials.length=r,this.markForRender(!0);}else this.disableRender();}});cc.TiledLayer=e.exports=t;},{"../core/assets/material/CCMaterial":53,"../core/assets/material/material-variant":60,"../core/components/CCRenderComponent":89,"../core/renderer/render-flow":221,"../core/value-types":279}],338:[function(t,e,i){"use strict";t("./CCTMXXMLParser"),t("./CCTiledMapAsset"),t("./CCTiledLayer"),t("./CCTiledTile"),t("./CCTiledObjectGroup");t=cc.Enum({ORTHO:0,HEX:1,ISO:2});var r=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5});var n=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:4026531840,FLIPPED_MASK:268435455});var a=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1});var o=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1});var s=cc.Enum({RightDown:0,RightUp:1,LeftDown:2,LeftUp:3});var c=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4,TEXT:5});t=cc.Class({name:"cc.TiledMap",extends:cc.Component,editor:!1,ctor:function(){this._texGrids=[],this._textures=[],this._tilesets=[],this._animations=[],this._imageLayers=[],this._layers=[],this._groups=[],this._images=[],this._properties=[],this._tileProperties=[],this._mapSize=cc.size(0,0),this._tileSize=cc.size(0,0);},statics:{Orientation:t,Property:r,TileFlag:n,StaggerAxis:a,StaggerIndex:o,TMXObjectType:c,RenderOrder:s},properties:{_tmxFile:{default:null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile;},set:function(t,e){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile());},type:cc.TiledMapAsset}},getMapSize:function(){return this._mapSize;},getTileSize:function(){return this._tileSize;},getMapOrientation:function(){return this._mapOrientation;},getObjectGroups:function(){return this._groups;},getObjectGroup:function(t){var e=this._groups;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getGroupName()===t)return n;}return null;},enableCulling:function(t){var e=this._layers;for(var i=0;i<e.length;++i)e[i].enableCulling(t);},getProperties:function(){return this._properties;},getLayers:function(){return this._layers;},getLayer:function(t){var e=this._layers;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getLayerName()===t)return n;}return null;},_changeLayer:function(t,e){var i=this._layers;for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a&&a.getLayerName()===t)return void(i[r]=e);}},getProperty:function(t){return this._properties[t.toString()];},getPropertiesForGID:function(t){return this._tileProperties[t];},__preload:function(){this._tmxFile&&this._applyFile();},onEnable:function(){this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this);},onDisable:function(){this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._syncAnchorPoint,this);},_applyFile:function(){var t=this._tmxFile;if(t){var e=t.textures;var i=t.textureNames;var h=t.textureSizes;var r={};var n={};for(var a=0;a<e.length;++a){var o=i[a];r[o]=e[a],n[o]=h[a];}var u={};e=t.imageLayerTextures,i=t.imageLayerTextureNames;for(var s=0;s<e.length;++s)u[i[s]]=e[s];var c=t.tsxFileNames;var _=t.tsxFiles;var d={};for(var l=0;l<c.length;++l)0<c[l].length&&(d[c[l]]=_[l].text);t=new cc.TMXMapInfo(t.tmxXmlStr,d,r,n,u);var f=t.getTilesets();f&&0!==f.length||cc.logID(7241),this._buildWithMapInfo(t);}else this._releaseMapInfo();},_releaseMapInfo:function(){var t=this._layers;for(var e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(!0),t[e].node.destroy();t.length=0;var r=this._groups;for(var n=0,a=r.length;n<a;n++)r[n].node.removeFromParent(!0),r[n].node.destroy();r.length=0;var o=this._images;for(var s=0,c=o.length;s<c;s++)o[s].removeFromParent(!0),o[s].destroy();o.length=0;},_syncAnchorPoint:function(){var t=this.node.getAnchorPoint();var e=this.node.width*t.x;var i=this.node.height*(1-t.y);var r,n;for(r=0,n=this._layers.length;r<n;r++)this._layers[r].node.setAnchorPoint(t);for(r=0,n=this._groups.length;r<n;r++){var a=this._groups[r];var o=a.node;o.anchorX=.5,o.anchorY=.5,o.x=a._offset.x-e+o.width*o.anchorX,o.y=a._offset.y+i-o.height*o.anchorY;}for(r=0,n=this._images.length;r<n;r++){var s=this._images[r];s.anchorX=.5,s.anchorY=.5,s.x=s._offset.x-e+s.width*s.anchorX,s.y=s._offset.y+i-s.height*s.anchorY;}},_fillAniGrids:function(t,e){for(var i in e){i=e[i];if(i){var r=i.frames;for(var n=0;n<r.length;n++){var a=r[n];a.grid=t[a.tileid];}}}},_buildLayerAndGroup:function(){var h=this._tilesets;var t=this._texGrids;var u=this._animations;for(var e=t.length=0,_=h.length;e<_;++e){var d=h[e];d&&cc.TiledMap.fillTextureGrids(d,t,e);}this._fillAniGrids(t,u);var i=this._layers;var r=this._groups;var n=this._images;var a={};for(var f=0,p=i.length;f<p;f++)a[i[f].node._name]=!0;for(var m=0,v=r.length;m<v;m++)a[r[m].node._name]=!0;for(var y=0,g=n.length;y<g;y++)a[n[y]._name]=!0;i=this._layers=[],r=this._groups=[],n=this._images=[];var b=this._mapInfo;var C=this.node;var o=b.getAllChildren();var x=this._textures;var A=0;var S=0;if(o&&0<o.length)for(var T=0,w=o.length;T<w;T++){var s=o[T];var c=s.name;var l=this.node.getChildByName(c);var E;a[c]=!1,l||((l=new cc.Node()).name=c,C.addChild(l)),l.setSiblingIndex(T),l.active=s.visible,s instanceof cc.TMXLayerInfo?((c=(c=l.getComponent(cc.TiledLayer))||l.addComponent(cc.TiledLayer))._init(s,b,h,x,t),s.ownTiles=!1,i.push(c)):s instanceof cc.TMXObjectGroupInfo?((c=(c=l.getComponent(cc.TiledObjectGroup))||l.addComponent(cc.TiledObjectGroup))._init(s,b,t),r.push(c)):s instanceof cc.TMXImageLayerInfo&&(c=s.sourceImage,l.opacity=s.opacity,l.layerInfo=s,l._offset=cc.v2(s.offset.x,-s.offset.y),(E=(s=(s=l.getComponent(cc.Sprite))||l.addComponent(cc.Sprite)).spriteFrame||new cc.SpriteFrame()).setTexture(c),s.spriteFrame=E,l.width=c.width,l.height=c.height,n.push(l)),A=Math.max(A,l.width),S=Math.max(S,l.height);}var P=C.children;for(var M=0,R=P.length;M<R;M++){var I=P[M];a[I._name]&&I.destroy();}this.node.width=A,this.node.height=S,this._syncAnchorPoint();},_buildWithMapInfo:function(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var e=this._tilesets;var i=[];for(var r=this._textures.length=0,n=e.length;r<n;++r){var a=e[r];a&&a.sourceImage&&(this._textures[r]=a.sourceImage,i.push(a.sourceImage));}for(var o=0;o<this._imageLayers.length;o++){var s=this._imageLayers[o];s&&s.sourceImage&&i.push(s.sourceImage);}cc.TiledMap.loadAllTextures(i,function(){this._buildLayerAndGroup();}.bind(this));},update:function(t){var e=this._animations;var i=this._texGrids;for(var r in e){var n=e[r];var a=n.frames;var o=a[n.frameIdx];n.dt+=t,o.duration<n.dt&&(n.dt=0,n.frameIdx++,n.frameIdx>=a.length&&(n.frameIdx=0),o=a[n.frameIdx]),i[r]=o.grid;}}});cc.TiledMap=e.exports=t,cc.TiledMap.loadAllTextures=function(t,e){var i=t.length;if(0!==i){var r=0;var n=function(){i<=++r&&e();};for(var a=0;a<i;a++){var o=t[a];o.loaded?n():o.once("load",function(){n();});}}else e();},cc.TiledMap.fillTextureGrids=function(t,e,h){var i=t.sourceImage;t.imageSize.width&&t.imageSize.height||(t.imageSize.width=i.width,t.imageSize.height=i.height);var u=t._tileSize.width,_=t._tileSize.height,r=i.width,n=i.height,i=t.spacing,a=t.margin,d=Math.floor((r-2*a+i)/(u+i)),a=Math.floor((n-2*a+i)/(_+i))*d,o=t.firstGid,s=null,c=!!e[o],l=cc.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX?.5:0;var f=t.firstGid+(a=a<=0?1:a);for(;o<f&&((c=c&&!e[o]?!1:c)||!e[o]);++o)t.rectForGID(o,s={texId:h,tileset:t,x:0,y:0,width:u,height:_,t:0,l:0,r:0,b:0,gid:o}),s.x+=l,s.y+=l,s.width-=2*l,s.height-=2*l,s.t=s.y/n,s.l=s.x/r,s.r=(s.x+s.width)/r,s.b=(s.y+s.height)/n,e[o]=s;},cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",function(){return cc.errorID(7203),[];},!1);},{"./CCTMXXMLParser":336,"./CCTiledLayer":337,"./CCTiledMapAsset":339,"./CCTiledObjectGroup":341,"./CCTiledTile":342}],339:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.TiledMapAsset",extends:cc.Asset,properties:{tmxXmlStr:"",textures:{default:[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{default:[],type:[cc.Size]},imageLayerTextures:{default:[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=r,e.exports=r;},{}],340:[function(t,e,i){"use strict";var r=(t=t("../renderer/core/input-assembler"))&&t.__esModule?t:{default:t};t=cc.Class({name:"cc.TiledMapRenderDataList",ctor:function(){this._dataList=[],this._offset=0;},_pushRenderData:function(){var t={};t.ia=new r.default(),t.nodesRenderList=[],this._dataList.push(t);},popRenderData:function(t){this._offset>=this._dataList.length&&this._pushRenderData();var e=this._dataList[this._offset];e.nodesRenderList.length=0;var i=e.ia;return i._vertexBuffer=t._vb,i._indexBuffer=t._ib,i._start=t.indiceOffset,i._count=0,this._offset++,e;},pushNodesList:function(t,e){t.nodesRenderList.push(e);},reset:function(){this._offset=0;}});cc.TiledMapRenderDataList=e.exports=t;},{"../renderer/core/input-assembler":302}],341:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.TiledObjectGroup",extends:cc.Component,getPositionOffset:function(){return this._positionOffset;},getProperties:function(){this._properties;},getGroupName:function(){return this._groupName;},getProperty:function(t){return this._properties[t.toString()];},getObject:function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r;}return null;},getObjects:function(){return this._objects;},_init:function(h,t,u){var e=cc.TiledMap;var _=e.TMXObjectType;var d=e.Orientation;var f=e.StaggerAxis;e=e.TileFlag;var p=e.FLIPPED_MASK;var m=e.HORIZONTAL;var v=e.VERTICAL;this._groupName=h.name,this._positionOffset=h.offset,this._mapInfo=t,this._properties=h.getProperties(),this._offset=cc.v2(h.offset.x,-h.offset.y),this._opacity=h._opacity;var i=t._mapSize;var r=t._tileSize;var e=0,y=0;t.orientation===d.HEX?t.getStaggerAxis()===f.STAGGERAXIS_X?(y=r.height*(i.height+.5),e=(r.width+t.getHexSideLength())*Math.floor(i.width/2)+r.width*(i.width%2)):(e=r.width*(i.width+.5),y=(r.height+t.getHexSideLength())*Math.floor(i.height/2)+r.height*(i.height%2)):y=t.orientation===d.ISO?(f=i.width+i.height,e=.5*r.width*f,.5*r.height*f):(e=i.width*r.width,i.height*r.height),this.node.setContentSize(e,y);var g=e*this.node.anchorX;var b=y*(1-this.node.anchorY);var C=h._objects;var x={};for(var A=0,S=C.length;A<S;A++){var n=C[A];var a=n.type;n.offset=cc.v2(n.x,n.y);var T=n.points||n.polylinePoints;if(T)for(var w=0;w<T.length;w++)T[w].y*=-1;var E,o;var s,P,c,M,R,I,l;d.ISO!==t.orientation?n.y=y-n.y:(E=n.x/r.height,o=n.y/r.height,n.x=.5*r.width*(i.height+E-o),n.y=.5*r.height*(i.width+i.height-E-o)),a===_.TEXT&&(x[E="text"+n.id]=!0,(o=(o=this.node.getChildByName(E))||new cc.Node()).anchorX=0,o.anchorY=1,o.angle=-n.rotation,o.x=n.x-g,o.y=n.y-b,o.name=E,o.parent=this.node,o.color=n.color,o.opacity=this._opacity,o.setSiblingIndex(A),(s=(s=o.getComponent(cc.Label))||o.addComponent(cc.Label)).overflow=cc.Label.Overflow.SHRINK,s.lineHeight=n.height,s.string=n.text,s.horizontalAlign=n.halign,s.verticalAlign=n.valign,s.fontSize=n.pixelsize,o.width=n.width,o.height=n.height),a!==_.IMAGE||(a=u[((s=n.gid)&p)>>>0])&&(l=a.tileset,x[P="img"+n.id]=!0,c=this.node.getChildByName(P),M=n.width||a.width,R=n.height||a.height,I=l.tileOffset.x,l=l.tileOffset.y,c instanceof cc.PrivateNode&&(c.removeFromParent(),c.destroy(),c=null),c=c||new cc.Node(),d.ISO==t.orientation?c.anchorX=.5+I/M:c.anchorX=I/M,c.anchorY=l/R,c.angle=-n.rotation,c.x=n.x-g,c.y=n.y-b,c.name=P,c.parent=this.node,c.opacity=this._opacity,c.setSiblingIndex(A),l=(l=(I=(I=c.getComponent(cc.Sprite))||c.addComponent(cc.Sprite)).spriteFrame)||new cc.SpriteFrame(),(s&m)>>>0?l.setFlipX(!0):l.setFlipX(!1),(s&v)>>>0?l.setFlipY(!0):l.setFlipY(!1),l.setTexture(a.tileset.sourceImage,cc.rect(a)),I.spriteFrame=l,I.setVertsDirty(),c.width=M,c.height=R);}this._objects=C;var B=this.node.children;var D=/^(?:img|text)\d+$/;for(var L=0,V=B.length;L<V;L++){var O=B[L];var F=O._name;D.test(F)&&!x[F]&&O.destroy();}}});cc.TiledObjectGroup=e.exports=r;},{}],342:[function(t,e,i){"use strict";var r=cc.Class({name:"cc.TiledTile",extends:cc.Component,editor:!1,ctor:function(){this._layer=null;},properties:{_x:0,_y:0,x:{get:function(){return this._x;},set:function(t){t!==this._x&&(this._layer&&this._layer._isInvalidPosition(t,this._y)?cc.warn("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.width):(this._resetTile(),this._x=t,this._updateInfo()));},type:cc.Integer},y:{get:function(){return this._y;},set:function(t){t!==this._y&&(this._layer&&this._layer._isInvalidPosition(this._x,t)?cc.warn("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer._layerSize.height):(this._resetTile(),this._y=t,this._updateInfo()));},type:cc.Integer},gid:{get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0;},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y);},type:cc.Integer}},onEnable:function(){var t=this.node.parent;this._layer=t.getComponent(cc.TiledLayer),this._resetTile(),this._updateInfo();},onDisable:function(){this._resetTile();},_resetTile:function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null);},_updateInfo:function(){var t,e;this._layer&&(t=this._x,e=this._y,this._layer.getTiledTileAt(t,e)?cc.warn("There is already a TiledTile at [%s, %s]",t,e):(this.node.setPosition(this._layer.getPositionAt(t,e)),this._layer.setTiledTileAt(t,e,this)));}});cc.TiledTile=e.exports=r;},{}],343:[function(t,e,i){"use strict";t("./CCTiledMap"),t("./CCTiledMapRenderDataList"),t("./tiledmap-buffer"),t("./tmx-layer-assembler");},{"./CCTiledMap":338,"./CCTiledMapRenderDataList":340,"./tiledmap-buffer":344,"./tmx-layer-assembler":345}],344:[function(t,e,i){"use strict";t=cc.Class({name:"cc.TiledMapBuffer",extends:t("../core/renderer/webgl/quad-buffer"),_updateOffset:function(){var t=this._offsetInfo;t.vertexOffset=this.vertexOffset,t.indiceOffset=this.indiceOffset,t.byteOffset=this.byteOffset;},adjust:function(t,e){this.vertexOffset+=t,this.indiceOffset+=e,this.indiceStart=this.indiceOffset,this.byteOffset=this.byteOffset+t*this._vertexBytes,this._dirty=!0;}});cc.TiledMapBuffer=e.exports=t;},{"../core/renderer/webgl/quad-buffer":249}],345:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../core/renderer/assembler"))&&r.__esModule?r:{default:r};var r;var d=t("../core/value-types");function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var n=t("./CCTiledLayer");var a=t("./CCTiledMap");var O=a.TileFlag;var F=O.FLIPPED_MASK;var o=t("../core/renderer/");var s=t("../core/renderer/webgl/vertex-format").vfmtPosUvColor;var N=parseInt(10922.5);var f=a.RenderOrder;var c=t("../core/renderer/render-flow");var p=cc.mat4();var m=cc.v3();var v={row:0,col:0};var w={x:0,y:0};var E={x:0,y:0};var P={x:0,y:0};var k={x:0,y:0};var M=null,G=null,z=0,R=0,U=0,W=0,y=null,I=null,B=null,D=null,H=null,L=null,V=null,j=null;function _visitUserNode(t){t._updateLocalMatrix(),d.Mat4.mul(t._worldMatrix,y,t._matrix),t._renderFlag&=~(c.FLAG_TRANSFORM|c.FLAG_BREAK_FLOW),c.visitRootNode(t),t._renderFlag|=c.FLAG_BREAK_FLOW;}function _flush(){0!==G._count&&(I.material=M.material,I.node=L.node,I._flushIA(M.ia),N<=z?(D.uploadData(),D.switchBuffer(),V=D._vData,j=D._uintVData,M=B.popRenderData(D),G=M.ia,z=R=0):(M=B.popRenderData(D),G=M.ia),M.material=H);}function _renderNodes(t,e){var i=L._getNodesByRowCol(t,e);if(i&&0!=i.count){var r=i.list;var n=0,a=0;for(_flush(),I.worldMatDirty++;n<i.count;){var o=r[a];a++,o&&(_visitUserNode(o.node),n!==a&&((r[n]=o)._index=n),n++);}r.length=n,I.worldMatDirty--,B.pushNodesList(M,r),I._flush(),I.node=L.node;}}a=function(t){var e;e=t,(i=TmxAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(TmxAssembler);function TmxAssembler(){return t.apply(this,arguments)||this;}var i=TmxAssembler.prototype;return i.updateRenderData=function(t){t._renderDataList||(t._buffer=new cc.TiledMapBuffer(o._handle,s),t._renderDataList=new cc.TiledMapRenderDataList());},i.fillBuffers=function(t,e){if(0!==t._vertices.length){t._updateCulling();var h=t.node;if(U=t._leftDownToCenterX,W=t._leftDownToCenterY,y=h._worldMatrix,I=e,B=(L=t)._renderDataList,D=t._buffer,t._isCullingDirty()||t._isUserNodeDirty()||t._hasAnimation()||t._hasTiledNode()){var i,r;D.reset();var n=((r=t._enableCulling?(i=(n=t._cullingRect).leftDown,n.rightTop):(i=v,t._rightTop)).row-i.row+1)*(r.col-i.col+1);switch(N<n&&(n=N),D.request(4*n,6*n),t._renderOrder){case f.RightDown:this.traverseGrids(i,r,-1,1);break;case f.LeftDown:this.traverseGrids(i,r,-1,-1);break;case f.RightUp:this.traverseGrids(i,r,1,1);break;case f.LeftUp:this.traverseGrids(i,r,1,-1);}t._setCullingDirty(!1),t._setUserNodeDirty(!1);}else{var a;var o;var s;for(var c=0;c<B._offset;c++){if(0<(o=(a=B._dataList[c]).nodesRenderList).length){e.worldMatDirty++;for(var l=0;l<o.length;l++)if(s=o[l])for(var u=0;u<s.length;u++){var _=s[u];_&&_visitUserNode(_.node);}e.worldMatDirty--,e._flush();}0<a.ia._count&&(e.material=a.material,e.node=h,e._flushIA(a.ia));}}j=V=L=H=D=B=I=y=G=M=null;}},i.traverseGrids=function(t,e,h,u){if(B.reset(),!(e.row<0||e.col<0)){M=B.popRenderData(D),G=M.ia,V=D._vData,j=D._uintVData,R=z=0,H=null;var _=L.node._color._val;var d=L._tiledTiles;var f=L._texGrids;var p=L._tiles;var m=L._texIdToMatIndex;var v=L._materials;var y=L._vertices;var i,r,g,n,b,a,C;var o,x;var s,A=-1;var S,T;for(b=-1==h?(n=e.row,t.row):(n=t.row,e.row);0<=(b-n)*h;n+=h)for(i=y[n],T=0==(S=L._getNodesCountByRow(n))&&null!=i,g=1==u?(r=T&&t.col<i.minCol?i.minCol:t.col,T&&e.col>i.maxCol?i.maxCol:e.col):(r=T&&e.col>i.maxCol?i.maxCol:e.col,T&&t.col<i.minCol?i.minCol:t.col);0<=(g-r)*u;r+=u)(c=i&&i[r])?(a=f[((C=p[c.index])&F)>>>0])&&(A!==a.texId&&(-1!==A&&_flush(),s=m[A=a.texId],H=v[s],M.material=H),H&&(s=c.left-U,o=c.bottom-W,x=s+(l=a.tileset._tileSize).width,l=o+l.height,(c=d[c.index])?this.fillByTiledNode(c.node,V,j,s,x,l,o):(V[R]=s,V[R+1]=l,j[R+4]=_,V[R+5]=s,V[R+6]=o,j[R+9]=_,V[R+10]=x,V[R+11]=l,j[R+14]=_,V[R+15]=x,V[R+16]=o,j[R+19]=_),c=a,l=C,w.x=c.l,w.y=c.t,E.x=c.r,E.y=c.t,P.x=c.l,P.y=c.b,k.x=c.r,k.y=c.b,c=null,(l&O.DIAGONAL)>>>0&&(c=E,E=P,P=c),(l&O.HORIZONTAL)>>>0&&(c=w,w=E,E=c,c=P,P=k,k=c),(l&O.VERTICAL)>>>0&&(c=w,w=P,P=c,c=E,E=k,k=c),V[R+2]=w.x,V[R+3]=w.y,V[R+7]=P.x,V[R+8]=P.y,V[R+12]=E.x,V[R+13]=E.y,V[R+17]=k.x,V[R+18]=k.y,R+=20,D.adjust(4,6),G._count+=6,z++,0<S&&_renderNodes(n,r),N<=z&&_flush())):0<S&&_renderNodes(n,r);var c,l;D.uploadData(),0<G._count&&(I.material=M.material,I.node=L.node,I._flushIA(M.ia));}},i.fillByTiledNode=function(t,e,i,r,n,a,o){t._updateLocalMatrix(),d.Mat4.copy(p,t._matrix),d.Vec3.set(m,-(r+U),-(o+W),0),d.Mat4.transform(p,p,m);var s=p.m;var c=s[0];var l=s[1];var h=s[4];var u=s[5];var _=s[12];s=s[13];t=t._color._val;e[R]=r*c+a*h+_,e[R+1]=r*l+a*u+s,i[R+4]=t,e[R+5]=r*c+o*h+_,e[R+6]=r*l+o*u+s,i[R+9]=t,e[R+10]=n*c+a*h+_,e[R+11]=n*l+a*u+s,i[R+14]=t,e[R+15]=n*c+o*h+_,e[R+16]=n*l+o*u+s,i[R+19]=t;},TmxAssembler;}(r.default);i.default=a,r.default.register(n,a),e.exports=i.default;},{"../core/renderer/":220,"../core/renderer/assembler":217,"../core/renderer/render-flow":221,"../core/renderer/webgl/vertex-format":252,"../core/value-types":279,"./CCTiledLayer":337,"./CCTiledMap":338}],346:[function(t,e,i){"use strict";var r=t("./video-player-impl");var n=r.EventType;var a=cc.Enum({REMOTE:0,LOCAL:1});t=cc.Class({name:"cc.VideoPlayer",extends:cc.Component,editor:!1,properties:{_resourceType:a.REMOTE,resourceType:{tooltip:!1,type:a,set:function(t){this._resourceType=t,this._updateVideoSource();},get:function(){return this._resourceType;}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource();},get:function(){return this._remoteURL;}},_clip:{default:null,type:cc.Asset},clip:{tooltip:!1,get:function(){return this._clip;},set:function(t){this._clip=t,this._updateVideoSource();},type:cc.Asset},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._impl&&this._impl.seekTo(t);},get:function(){return this._impl?this._currentStatus===n.NONE||this._currentStatus===n.STOPPED||this._currentStatus===n.META_LOADED||this._currentStatus===n.READY_TO_PLAY?0:this._currentStatus===n.COMPLETED?this._impl.duration():this._impl.currentTime():-1;}},_volume:1,volume:{get:function(){return this._volume;},set:function(t){this._volume=t,this.isPlaying()&&!this._mute&&this._syncVolume();},range:[0,1],type:cc.Float,tooltip:!1},_mute:!1,mute:{get:function(){return this._mute;},set:function(t){this._mute=t,this._syncVolume();},tooltip:!1},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._impl&&this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio);}},_isFullscreen:{default:!1,formerlySerializedAs:"_N$isFullscreen"},isFullscreen:{get:function(){return this._isFullscreen=this._impl&&this._impl.isFullScreenEnabled(),this._isFullscreen;},set:function(t){this._isFullscreen=t,this._impl&&this._impl.setFullScreenEnabled(t);},animatable:!1,tooltip:!1},_stayOnBottom:!1,stayOnBottom:{get:function(){return this._stayOnBottom;},set:function(t){this._stayOnBottom=t,this._impl&&this._impl.setStayOnBottom(t);},animatable:!1,tooltip:!1},videoPlayerEvent:{default:[],type:cc.Component.EventHandler}},statics:{EventType:n,ResourceType:a,Impl:r},ctor:function(){this._impl=new r(),this._currentStatus=n.NONE;},_syncVolume:function(){var t=this._impl;var e;t&&(e=this._mute?0:this._volume,t.setVolume(e));},_updateVideoSource:function(){var t="";this.resourceType===a.REMOTE?t=this.remoteURL:this._clip&&(t=this._clip.nativeUrl||""),t&&cc.loader.md5Pipe&&(t=cc.loader.md5Pipe.transformURL(t)),this._impl.setURL(t,this._mute||0===this._volume),this._impl.setKeepAspectRatioEnabled(this.keepAspectRatio);},onLoad:function(){var t=this._impl;t&&(t.createDomElementIfNeeded(this._mute||0===this._volume),t.setStayOnBottom(this._stayOnBottom),this._updateVideoSource(),t.seekTo(this.currentTime),t.setFullScreenEnabled(this._isFullscreen),this.pause(),t.setEventListener(n.PLAYING,this.onPlaying.bind(this)),t.setEventListener(n.PAUSED,this.onPasued.bind(this)),t.setEventListener(n.STOPPED,this.onStopped.bind(this)),t.setEventListener(n.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(n.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(n.CLICKED,this.onClicked.bind(this)),t.setEventListener(n.READY_TO_PLAY,this.onReadyToPlay.bind(this)));},onRestore:function(){this._impl||(this._impl=new r());},onEnable:function(){this._impl&&this._impl.enable();},onDisable:function(){this._impl&&this._impl.disable();},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null);},update:function(t){this._impl&&this._impl.updateMatrix(this.node);},onReadyToPlay:function(){this._currentStatus=n.READY_TO_PLAY,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.READY_TO_PLAY),this.node.emit("ready-to-play",this);},onMetaLoaded:function(){this._currentStatus=n.META_LOADED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.META_LOADED),this.node.emit("meta-loaded",this);},onClicked:function(){this._currentStatus=n.CLICKED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.CLICKED),this.node.emit("clicked",this);},onPlaying:function(){this._currentStatus=n.PLAYING,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PLAYING),this.node.emit("playing",this);},onPasued:function(){this._currentStatus=n.PAUSED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PAUSED),this.node.emit("paused",this);},onStopped:function(){this._currentStatus=n.STOPPED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.STOPPED),this.node.emit("stopped",this);},onCompleted:function(){this._currentStatus=n.COMPLETED,cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.COMPLETED),this.node.emit("completed",this);},play:function(){this._impl&&(this._syncVolume(),this._impl.play());},resume:function(){this._impl&&(this._syncVolume(),this._impl.resume());},pause:function(){this._impl&&this._impl.pause();},stop:function(){this._impl&&this._impl.stop();},getDuration:function(){return this._impl?this._impl.duration():-1;},isPlaying:function(){return!!this._impl&&this._impl.isPlaying();}});cc.VideoPlayer=e.exports=t;},{"./video-player-impl":347}],347:[function(t,e,o){"use strict";var i=t("../core/platform/utils");var _=t("../core/platform/CCSys");var r=t("../core/platform/CCMacro");var n=1,a=4;var d=cc.mat4();var f=cc.Class({name:"VideoPlayerImpl",ctor:function(){this._EventList={},this._video=null,this._url="",this._waitingFullscreen=!1,this._fullScreenEnabled=!1,this._stayOnBottom=!1,this._loadedmeta=!1,this._loaded=!1,this._visible=!1,this._playing=!1,this._ignorePause=!1,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={};},_bindEvent:function(){var t=this._video,e=this;var i=this.__eventListeners;i.loadedmetadata=function(){e._loadedmeta=!0,e._forceUpdate=!0,e._waitingFullscreen&&(e._waitingFullscreen=!1,e._toggleFullscreen(!0)),e._dispatchEvent(f.EventType.META_LOADED);},i.ended=function(){e._video===t&&(e._playing=!1,e._dispatchEvent(f.EventType.COMPLETED));},i.play=function(){e._video===t&&(e._playing=!0,e._updateVisibility(),e._dispatchEvent(f.EventType.PLAYING));},i.pause=function(){e._video===t&&(e._playing=!1,e._ignorePause||e._dispatchEvent(f.EventType.PAUSED));},i.click=function(){e._dispatchEvent(f.EventType.CLICKED);},t.addEventListener("loadedmetadata",i.loadedmetadata),t.addEventListener("ended",i.ended),t.addEventListener("play",i.play),t.addEventListener("pause",i.pause),t.addEventListener("click",i.click),i.onCanPlay=function(){var t;e._loaded||e._playing||(t=e._video).readyState!==a&&t.readyState!==n||(t.currentTime=0,e._loaded=!0,e._forceUpdate=!0,e._dispatchEvent(f.EventType.READY_TO_PLAY),e._updateVisibility());},t.addEventListener("canplay",i.onCanPlay),t.addEventListener("canplaythrough",i.onCanPlay),t.addEventListener("suspend",i.onCanPlay);},_updateVisibility:function(){var t=this._video;t&&(this._visible?t.style.visibility="visible":(t.style.visibility="hidden",t.pause(),this._playing=!1));},_updateSize:function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px");},_createDom:function(t){var e=document.createElement("video");e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["z-index"]=this._stayOnBottom?r.MIN_ZINDEX:0,e.className="cocosVideo",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),t&&e.setAttribute("muted",""),this._video=e,cc.game.container.appendChild(e);},createDomElementIfNeeded:function(t){this._video||this._createDom(t);},removeDom:function(){var t=this._video;var e;t&&(i.contains(cc.game.container,t)&&cc.game.container.removeChild(t),e=this.__eventListeners,t.removeEventListener("loadedmetadata",e.loadedmetadata),t.removeEventListener("ended",e.ended),t.removeEventListener("play",e.play),t.removeEventListener("pause",e.pause),t.removeEventListener("click",e.click),t.removeEventListener("canplay",e.onCanPlay),t.removeEventListener("canplaythrough",e.onCanPlay),t.removeEventListener("suspend",e.onCanPlay),e.loadedmetadata=null,e.ended=null,e.play=null,e.pause=null,e.click=null,e.onCanPlay=null),this._video=null,this._url="";},setURL:function(t,e){var i,r;if(this._url!==t){this.removeDom(),this._url=t,this.createDomElementIfNeeded(e),this._bindEvent();var n=this._video;n.style.visibility="hidden",this._loaded=!1,this._playing=!1,this._loadedmeta=!1,(i=document.createElement("source")).src=t,n.appendChild(i),r=cc.path.extname(t);var a=f._polyfill;for(var o=0;o<a.canPlayType.length;o++)r!==a.canPlayType[o]&&((i=document.createElement("source")).src=t.replace(r,a.canPlayType[o]),n.appendChild(i));}},getURL:function(){return this._url;},play:function(){var t=this._video;t&&this._visible&&!this._playing&&(f._polyfill.autoplayAfterOperation?setTimeout(function(){t.play();},20):t.play());},pause:function(){var t=this._video;this._playing&&t&&t.pause();},resume:function(){this.play();},stop:function(){var t=this._video;t&&this._visible&&(this._ignorePause=!0,t.currentTime=0,t.pause(),setTimeout(function(){this._dispatchEvent(f.EventType.STOPPED),this._ignorePause=!1;}.bind(this),0));},setVolume:function(t){var e=this._video;e&&(e.volume=t);},seekTo:function(t){var e=this._video;e&&(this._loaded?e.currentTime=t:e.addEventListener(f._polyfill.event,function cb(){e.currentTime=t,e.removeEventListener(f._polyfill.event,cb);}),f._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){e.play();},20));},isPlaying:function(){var t=this._video;return f._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){t.play();},20),this._playing;},duration:function(){var t=this._video;var e=-1;return t&&(e=t.duration)<=0&&cc.logID(7702),e;},currentTime:function(){var t=this._video;return t?t.currentTime:-1;},setKeepAspectRatioEnabled:function(){cc.logID(7700);},isKeepAspectRatioEnabled:function(){return!0;},_toggleFullscreen:function(t){var i=this,r=this._video;r&&(t?(_.browserType===_.BROWSER_TYPE_IE&&(r.style.transform=""),cc.screen.requestFullScreen(r,function(t){var e=_.browserType===_.BROWSER_TYPE_IE?document.msFullscreenElement:document.fullscreenElement;i._fullScreenEnabled=e===r;},function(t){i._fullScreenEnabled=!1;})):cc.screen.fullScreen()&&cc.screen.exitFullScreen(r));},setStayOnBottom:function(t){this._stayOnBottom=t,this._video&&(this._video.style["z-index"]=t?r.MIN_ZINDEX:0);},setFullScreenEnabled:function(t){!this._loadedmeta&&t?this._waitingFullscreen=!0:this._toggleFullscreen(t);},isFullScreenEnabled:function(){return this._fullScreenEnabled;},setEventListener:function(t,e){this._EventList[t]=e;},removeEventListener:function(t){this._EventList[t]=null;},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._video.src);},onPlayEvent:function(){this._EventList[f.EventType.PLAYING].call(this,this,this._video.src);},enable:function(){var t=f.elements;-1===t.indexOf(this)&&t.push(this),this.setVisible(!0);},disable:function(){var t=f.elements;var e=t.indexOf(this);-1!==e&&t.splice(e,1),this.setVisible(!1);},destroy:function(){this.disable(),this.removeDom();},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility());},updateMatrix:function(t){var e,i,r,n,a,h,o,u,s,c,l;this._video&&this._visible&&!this._fullScreenEnabled&&(t.getWorldMatrix(d),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(d,d,cc.game.canvas.width,cc.game.canvas.height),e=d.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,r=i=1/cc.view._devicePixelRatio,s=cc.game.container,n=e[0]*i,a=e[1],h=e[4],o=e[5]*r,u=s&&s.style.paddingLeft?parseInt(s.style.paddingLeft):0,s=s&&s.style.paddingBottom?parseInt(s.style.paddingBottom):0,f._polyfill.zoomInvalid?(this._updateSize(this._w*n,this._h*o),o=n=1,c=this._w*i,l=this._h*r):(c=this._w*i,l=this._h*r,this._updateSize(this._w,this._h)),c=c*e[0]*t._anchorPoint.x,l=l*e[5]*t._anchorPoint.y,t="matrix("+n+","+-a+","+-h+","+o+","+(e[12]*i-c+u)+","+-(e[13]*r-l+s)+")",this._video.style.transform=t,this._video.style["-webkit-transform"]=t,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px",_.browserType!==_.BROWSER_TYPE_IE&&(this._forceUpdate=!1)));}});f.EventType={NONE:-1,PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},f.elements=[],f.pauseElements=[],cc.game.on(cc.game.EVENT_HIDE,function(){var t=f.elements;for(var e,i=0;i<t.length;i++)(e=t[i]).isPlaying()&&(e.pause(),f.pauseElements.push(e));}),cc.game.on(cc.game.EVENT_SHOW,function(){var t=f.pauseElements;var e=t.pop();for(;e;)e.play(),e=t.pop();}),f._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]};t=document.createElement("video");t.canPlayType&&(t.canPlayType("video/ogg")&&(f._polyfill.canPlayType.push(".ogg"),f._polyfill.canPlayType.push(".ogv")),t.canPlayType("video/mp4")&&f._polyfill.canPlayType.push(".mp4"),t.canPlayType("video/webm")&&f._polyfill.canPlayType.push(".webm")),_.browserType===_.BROWSER_TYPE_FIREFOX&&(f._polyfill.autoplayAfterOperation=!0),_.OS_ANDROID!==_.os||_.browserType!==_.BROWSER_TYPE_SOUGOU&&_.browserType!==_.BROWSER_TYPE_360||(f._polyfill.zoomInvalid=!0);t=document.createElement("style");t.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(t),e.exports=f;},{"../core/platform/CCMacro":194,"../core/platform/CCSys":198,"../core/platform/utils":213}],348:[function(t,e,i){"use strict";t=t("./webview-impl");var r=t.EventType;function emptyCallback(){}var n=cc.Class({name:"cc.WebView",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_url:"",url:{type:cc.String,tooltip:!1,get:function(){return this._url;},set:function(t){this._url=t;var e=this._impl;e&&e.loadURL(t);}},webviewEvents:{default:[],type:cc.Component.EventHandler}},statics:{EventType:r,Impl:t},ctor:function(){this._impl=new n.Impl();},onRestore:function(){this._impl||(this._impl=new n.Impl());},onEnable:function(){var t=this._impl;t.createDomElementIfNeeded(this.node.width,this.node.height),t.setEventListener(r.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(r.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(r.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setVisible(!0);},onDisable:function(){var t=this._impl;t.setVisible(!1),t.setEventListener(r.LOADED,emptyCallback),t.setEventListener(r.LOADING,emptyCallback),t.setEventListener(r.ERROR,emptyCallback);},onDestroy:function(){this._impl&&(this._impl.destroy(),this._impl=null);},update:function(t){this._impl&&this._impl.updateMatrix(this.node);},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADED),this.node.emit("loaded",this);},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.LOADING),this.node.emit("loading",this),!0;},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,r.ERROR),this.node.emit("error",this);},setJavascriptInterfaceScheme:function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t);},setOnJSCallback:function(t){this._impl&&this._impl.setOnJSCallback(t);},evaluateJS:function(t){this._impl&&this._impl.evaluateJS(t);}});cc.WebView=e.exports=n;},{"./webview-impl":349}],349:[function(t,e,i){"use strict";var r=t("../core/platform/utils");t=t("../core/platform/CCSys");var _=cc.mat4();var n=cc.Class({name:"WebViewImpl",ctor:function(){this._EventList={},this._visible=!1,this._parent=null,this._div=null,this._iframe=null,this._listener=null,this._forceUpdate=!1,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this.__eventListeners={};},_updateVisibility:function(){var t;this._div&&(t=this._div,this._visible?t.style.visibility="visible":t.style.visibility="hidden");},_updateSize:function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px");},_initEvent:function(){var t=this._iframe;var e,i;t&&(e=this.__eventListeners,i=this,e.load=function(){i._forceUpdate=!0,i._dispatchEvent(n.EventType.LOADED);},e.error=function(){i._dispatchEvent(n.EventType.ERROR);},t.addEventListener("load",e.load),t.addEventListener("error",e.error));},_initStyle:function(){var t;this._div&&((t=this._div).style.position="absolute",t.style.bottom="0px",t.style.left="0px");},_setOpacity:function(t){var e=this._iframe;e&&e.style&&(e.style.opacity=t/255);},_createDom:function(t,e){n._polyfill.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe),this._iframe.style.width="100%",this._iframe.style.height="100%"):this._div=this._iframe=document.createElement("iframe"),n._polyfill.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF",this._div.style.height=e+"px",this._div.style.width=t+"px",this._div.style.overflow="scroll",this._iframe.style.border="none",cc.game.container.appendChild(this._div),this._updateVisibility();},_createNativeControl:function(t,e){this._createDom(t,e),this._initStyle(),this._initEvent();},createDomElementIfNeeded:function(t,e){this._div?this._updateSize(t,e):this._createNativeControl(t,e);},removeDom:function(){var t=this._div;t&&(r.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._div=null);t=this._iframe;var e;t&&(e=this.__eventListeners,t.removeEventListener("load",e.load),t.removeEventListener("error",e.error),e.load=null,e.error=null,this._iframe=null);},setOnJSCallback:function(t){},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,r){},loadHTMLString:function(t,e){},loadURL:function(t){var e=this._iframe;var i;e&&(e.src=t,i=this,e.addEventListener("load",function cb(){i._loaded=!0,i._updateVisibility(),e.removeEventListener("load",cb);}),this._dispatchEvent(n.EventType.LOADING));},stopLoading:function(){cc.logID(7800);},reload:function(){var t=this._iframe;!t||(t=t.contentWindow)&&t.location&&t.location.reload();},canGoBack:function(){return cc.logID(7801),!0;},canGoForward:function(){return cc.logID(7802),!0;},goBack:function(){try{if(n._polyfill.closeHistory)return cc.logID(7803);var t=this._iframe;var e;!t||(e=t.contentWindow)&&e.location&&e.history.back.call(e);}catch(t){cc.log(t);}},goForward:function(){try{if(n._polyfill.closeHistory)return cc.logID(7804);var t=this._iframe;var e;!t||(e=t.contentWindow)&&e.location&&e.history.forward.call(e);}catch(t){cc.log(t);}},evaluateJS:function(t){var e=this._iframe;if(e){e=e.contentWindow;try{e.eval(t),this._dispatchEvent(n.EventType.JS_EVALUATED);}catch(t){console.error(t);}}},setScalesPageToFit:function(){cc.logID(7805);},setEventListener:function(t,e){this._EventList[t]=e;},removeEventListener:function(t){this._EventList[t]=null;},_dispatchEvent:function(t){t=this._EventList[t];t&&t.call(this,this,this._iframe.src);},_createRenderCmd:function(){return new n.RenderCmd(this);},destroy:function(){this.removeDom();},setVisible:function(t){this._visible!==t&&(this._visible=!!t,this._updateVisibility());},updateMatrix:function(t){var e,i,r,n,a,h,u,o,s,c,l;this._div&&this._visible&&(t.getWorldMatrix(_),(e=cc.Camera._findRendererCamera(t))&&e.worldMatrixToScreen(_,_,cc.game.canvas.width,cc.game.canvas.height),e=_.m,!this._forceUpdate&&this._m00===e[0]&&this._m01===e[1]&&this._m04===e[4]&&this._m05===e[5]&&this._m12===e[12]&&this._m13===e[13]&&this._w===t._contentSize.width&&this._h===t._contentSize.height||(this._m00=e[0],this._m01=e[1],this._m04=e[4],this._m05=e[5],this._m12=e[12],this._m13=e[13],this._w=t._contentSize.width,this._h=t._contentSize.height,r=i=1/cc.view._devicePixelRatio,o=cc.game.container,l=e[0]*i,n=e[1],a=e[4],h=e[5]*r,u=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,o=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,this._updateSize(this._w,this._h),s=this._w*i,c=this._h*r,s=s*e[0]*t._anchorPoint.x,c=c*e[5]*t._anchorPoint.y,l="matrix("+l+","+-n+","+-a+","+h+","+(e[12]*i-s+u)+","+-(e[13]*r-c+o)+")",this._div.style.transform=l,this._div.style["-webkit-transform"]=l,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px",this._setOpacity(t.opacity),this._forceUpdate=!1));}});n.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3};var a=n._polyfill={devicePixelRatio:!1,enableDiv:!1};t.os===t.OS_IOS&&(a.enableDiv=!0),t.isMobile?t.browserType===t.BROWSER_TYPE_FIREFOX&&(a.enableBG=!0):t.browserType===t.BROWSER_TYPE_IE&&(a.closeHistory=!0),e.exports=n;},{"../core/platform/CCSys":198,"../core/platform/utils":213}],350:[function(t,e,i){"use strict";t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle"),t("./cocos2d/tilemap"),t("./cocos2d/videoplayer/CCVideoPlayer"),t("./cocos2d/webview/CCWebView"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./cocos2d/actions"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated");},{"./cocos2d/actions":8,"./cocos2d/animation":17,"./cocos2d/core":135,"./cocos2d/core/components/CCStudioComponent":95,"./cocos2d/deprecated":291,"./cocos2d/particle":297,"./cocos2d/particle/CCParticleAsset":294,"./cocos2d/tilemap":343,"./cocos2d/tilemap/CCTiledMapAsset":339,"./cocos2d/videoplayer/CCVideoPlayer":346,"./cocos2d/webview/CCWebView":348,"./extensions/ccpool/CCNodePool":351,"./extensions/dragonbones":void 0,"./extensions/spine":354}],351:[function(t,e,i){"use strict";cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[];},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length;},clear:function(){var t=this._pool.length;for(var e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0;},put:function(t){var e;t&&-1===this._pool.indexOf(t)&&(t.removeFromParent(!1),(e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null)&&e.unuse&&e.unuse(),this._pool.push(t));},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return t&&t.reuse&&t.reuse.apply(t,arguments),e;}},e.exports=cc.NodePool;},{}],352:[function(t,e,r){"use strict";var d=(i=t("../../cocos2d/core/value-types/mat4"))&&i.__esModule?i:{default:i};var f=t("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM;function Zp2(){}var c="ATTACHED_NODE_TREE";var l="ATTACHED_NODE:";function Fp2(t){Object.defineProperty(t,"_worldMatDirty",{get:function(){return!0;},set:function(t){}}),t._calculWorldMatrix=Zp2,t._mulMat=Zp2;}var p=new d.default();var i=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={};},init:function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t;},reset:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null;},_prepareAttachNode:function(){var t;if(this._skeleton)return t=this._skeletonNode.getChildByName(c),t&&t.isValid||(t=new cc.Node(c),Fp2(t),this._skeletonNode.addChild(t)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=t;},_buildBoneAttachedNode:function(t,e){var i=l+t.data.name;i=new cc.Node(i);return this._buildBoneRelation(i,t,e),i;},_buildBoneRelation:function(t,e,i){Fp2(t),t._bone=e,t._boneIndex=i,this._attachedNodeArray.push(t),this._boneIndexToNode[i]=t;},getAttachedRootNode:function(){return this._attachedRootNode;},getAttachedNodes:function(t){var e=this._attachedNodeArray;var i=[];if(!this._inited)return i;for(var r=0,n=e.length;r<n;r++){var a=e[r];a&&a.isValid&&a.name===l+t&&i.push(a);}return i;},_rebuildNodeArray:function(){var t=this._boneIndexToNode={};var e=this._attachedNodeArray;var i=this._attachedNodeArray=[];for(var r=0,n=e.length;r<n;r++){var a=e[r];a&&a.isValid&&!a._toRemove&&(i.push(a),t[a._boneIndex]=a);}},_sortNodeArray:function(){this._attachedNodeArray.sort(function(t,e){return t._boneIndex<e._boneIndex?-1:1;});},_getNodeByBoneIndex:function(t){t=this._boneIndexToNode[t];return t&&t.isValid?t:null;},destroyAttachedNodes:function(t){if(this._inited){var e=this._attachedNodeArray;var i=function markTree(t){var e=t.children;for(var i=0,r=e.length;i<r;i++){var n=e[i];n&&markTree(n);}t._toRemove=!0;};for(var r=0,n=e.length;r<n;r++){var a=e[r];a&&a.isValid&&a.name.split(l)[1]===t&&(i(a),a.removeFromParent(!0),a.destroy(),e[r]=null);}this._rebuildNodeArray();}},generateAttachedNodes:function(t){var e=[];if(!this._inited)return e;var r=this._prepareAttachNode();if(!r)return e;var i=[];var n=this._skeleton.bones;for(var a=0,o=n.length;a<o;a++){var s=n[a];s.data.name==t&&i.push(s);}var c=function(t){if(t){var e=t.data;var i=this._getNodeByBoneIndex(e.index);if(i)return i;i=this._buildBoneAttachedNode(t,e.index);e=c(t.parent)||r;return i.parent=e,i;}}.bind(this);for(var l=0,h=i.length;l<h;l++){var u=c(i[l]);e.push(u);}return this._sortNodeArray(),e;},destroyAllAttachedNodes:function(){var t;this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},!this._inited||(t=this._skeletonNode.getChildByName(c))&&(t.removeFromParent(!0),t.destroy());},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var t=this._prepareAttachNode();if(t){var e=this._skeleton.bones;for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=n.data;var o=null;var s;(o=n.parent?(s=n.parent.data.index,this._boneIndexToNode[s]):t)&&((s=o.getChildByName(l+a.name))&&s.isValid?this._buildBoneRelation(s,n,a.index):(s=this._buildBoneAttachedNode(n,a.index),o.addChild(s)));}return t;}}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName(c);},_associateAttachedNode:function(){if(this._inited){var t=this._skeletonNode.getChildByName(c);if(t&&t.isValid){this._attachedRootNode=t,this._boneIndexToNode={},this._attachedNodeArray.length=0,Fp2(t),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();var e=this._skeleton.bones;for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=n.data;var o=null;var s;!(o=n.parent?(s=n.parent.data.index,this._boneIndexToNode[s]):t)||(s=o.getChildByName(l+a.name))&&s.isValid&&this._buildBoneRelation(s,n,a.index);}}}},_syncAttachedNode:function(){if(this._inited){var t=this._attachedRootNode;var e=this._attachedNodeArray;if(!t||!t.isValid)return this._attachedRootNode=null,void(e.length=0);var h=this._skeletonNode._worldMatrix;d.default.copy(t._worldMatrix,h),t._renderFlag&=~f;var i;if(i=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){var u=this._skeletonNode._mulMat;var r=!1;for(var n=0,_=e.length;n<_;n++){var a=e[n];a&&a.isValid?(c=i[a._boneIndex])?(o=a._worldMatrix,s=t._worldMatrix,c=c,l=void 0,(l=p.m)[0]=c.a,l[1]=c.c,l[4]=c.b,l[5]=c.d,l[12]=c.worldX,l[13]=c.worldY,u(o,s,p),a._renderFlag&=~f):(a.removeFromParent(!0),a.destroy(),r=!(e[n]=null)):r=!(e[n]=null);}var o,s,c,l;r&&this._rebuildNodeArray();}}}});e.exports=sp.AttachUtil=i;},{"../../cocos2d/core/renderer/render-flow":221,"../../cocos2d/core/value-types/mat4":281}],353:[function(t,e,h){"use strict";var r=t("./track-entry-listeners");var i=t("../../cocos2d/core/components/CCRenderComponent");var n=t("./lib/spine");var a=t("../../cocos2d/core/graphics/graphics");var o=t("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER;var s=t("./skeleton-cache");var c=t("./AttachUtil");t=cc.Enum({default:-1});var u=cc.Enum({"<None>":0});var l=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton",extends:i,editor:!1,statics:{AnimationCacheMode:l},properties:{paused:{default:!1,visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData();},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||"";},set:function(t){(this.defaultAnimation=t)?this.setAnimation(0,t,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose());},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0;}else{t=t[this.defaultSkin];if(void 0!==t)return t;}}return 0;},set:function(t){if(!(e=this.skeletonData?this.skeletonData.getSkinsEnum():e))return cc.errorID("",this.name);var e=e[t];void 0!==e?(this.defaultSkin=e,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name);},type:t,visible:!0,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){e=e[t];if(void 0!==e)return e;}}return 0;},set:function(t){if(0!==t){if(!(e=this.skeletonData?this.skeletonData.getAnimsEnum():e))return cc.errorID(7502,this.name);var e=e[t];void 0!==e?this.animation=e:cc.errorID(7503,this.name);}else this.animation="";},type:u,visible:!0,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:l.REALTIME,_defaultCacheMode:{default:0,type:l,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode);},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{default:!0,tooltip:!1},premultipliedAlpha:{default:!0,tooltip:!1},timeScale:{default:1,tooltip:!1},debugSlots:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw();}},debugBones:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw();}},debugMesh:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw();}},useTint:{default:!1,tooltip:!1,notify:function(){this._updateUseTint();}},enableBatch:{default:!1,notify:function(){this._updateBatch();},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null,this._skeleton=null,this._rootBone=null,this._listener=null,this._materialCache={},this._debugRenderer=null,this._startSlotIndex=-1,this._endSlotIndex=-1,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this.attachUtil=new c();},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine");},_updateMaterial:function(){var t=this.useTint||this.isAnimationCached()&&!0;var e=this.getMaterial(0);e&&(e.define("USE_TINT",t),e.define("CC_USE_MODEL",!this.enableBatch)),this._materialCache={};},disableRender:function(){this._super(),this.node._renderFlag&=~o;},markForRender:function(t){this._super(t),t?this.node._renderFlag|=o:this.node._renderFlag&=~o;},_updateUseTint:function(){var t=this.getMaterial(0);var e;t&&(e=this.useTint||this.isAnimationCached()&&!0,t.define("USE_TINT",e)),this._materialCache={};},_updateBatch:function(){var t=this.getMaterial(0);t&&t.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={};},_validateRender:function(){var t=this.skeletonData;t&&t.isTexturesLoaded()?this._super():this.disableRender();},setSkeletonData:function(t){var e;null!=t.width&&null!=t.height&&this.node.setContentSize(t.width,t.height),this._cacheMode===l.SHARED_CACHE?this._skeletonCache=s.sharedCache:this._cacheMode===l.PRIVATE_CACHE&&(this._skeletonCache=new s(),this._skeletonCache.enablePrivateMode()),this.isAnimationCached()?((this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode"),e=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t),this._skeleton=e.skeleton,this._clipper=e.clipper):(this._skeleton=new n.Skeleton(t),this._clipper=new n.SkeletonClipping()),this._rootBone=this._skeleton.getRootBone(),this.markForRender(!0);},setSlotsRange:function(t,e){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e);},setAnimationStateData:function(t){this.isAnimationCached()?cc.warn("'setAnimationStateData' interface can not be invoked in cached mode."):(t=new n.AnimationState(t),this._listener&&(this._state&&this._state.removeListener(this._listener),t.addListener(this._listener)),this._state=t);},__preload:function(){this._super();var t=this.node.children;for(var e=0,i=t.length;e<i;e++){var r=t[e];r&&"DEBUG_DRAW_NODE"===r._name&&r.destroy();}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._updateBatch();},setAnimationCacheMode:function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint());},isAnimationCached:function(){return this._cacheMode!==l.REALTIME;},update:function(t){if(!this.paused)if(t*=this.timeScale*sp.timeScale,this.isAnimationCached()){var e;if(this._isAniComplete)return 0!==this._animationQueue.length||this._headAniInfo?(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,void(this._accTime>this._headAniInfo.delay&&(e=this._headAniInfo,this._headAniInfo=null,this.setAnimation(0,e.animationName,e.loop)))):void((e=this._frameCache)&&e.isInvalid()&&(e.updateToFrame(),e=e.frames,this._curFrame=e[e.length-1]));this._updateCache(t);}else this._updateRealtime(t);},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry));},_updateCache:function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames;var r=s.FrameTime;0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;t=Math.floor(this._accTime/r);if(e.isCompleted||e.updateToFrame(t),e.isCompleted&&t>=i.length){if(this._playCount++,0<this._playTimes&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();t=this._accTime=0,this._emitCacheCompleteEvent();}this._curFrame=i[t];}},_updateRealtime:function(t){var e=this._skeleton;var i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)));},setVertexEffectDelegate:function(t){this._effectDelegate=t;},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform();},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose();},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose();},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose();},updateAnimationCache:function(t){var e;this.isAnimationCached()&&(e=this.skeletonData._uuid,this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t));},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid);},findBone:function(t){return this._skeleton?this._skeleton.findBone(t):null;},findSlot:function(t){return this._skeleton?this._skeleton.findSlot(t):null;},setSkin:function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache();},getAttachment:function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null;},setAttachment:function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache();},getTextureAtlas:function(t){return t.region;},setMix:function(t,e,i){this._state&&this._state.data.setMix(t,e,i);},setAnimation:function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var r=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,e);(r=r||this._skeletonCache.initAnimationCache(this.skeletonData._uuid,e))&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=r,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0]);}else if(this._skeleton){r=this._skeleton.data.findAnimation(e);if(!r)return cc.logID(7509,e),null;e=this._state.setAnimationWith(t,r,i);return this._state.apply(this._skeleton),e;}return null;},addAnimation:function(t,e,i,r){var n;if(r=r||0,this.isAnimationCached())0!==t&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:r});else if(this._skeleton)return(n=this._skeleton.data.findAnimation(e))?this._state.addAnimationWith(t,n,i,r):(cc.logID(7510,e),null);return null;},findAnimation:function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null;},getCurrent:function(t){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null;},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks();},clearTrack:function(t){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t);},setStartListener:function(t){this._ensureListener(),this._listener.start=t;},setInterruptListener:function(t){this._ensureListener(),this._listener.interrupt=t;},setEndListener:function(t){this._ensureListener(),this._listener.end=t;},setDisposeListener:function(t){this._ensureListener(),this._listener.dispose=t;},setCompleteListener:function(t){this._ensureListener(),this._listener.complete=t;},setEventListener:function(t){this._ensureListener(),this._listener.event=t;},setTrackStartListener:function(t,e){r.getListeners(t).start=e;},setTrackInterruptListener:function(t,e){r.getListeners(t).interrupt=e;},setTrackEndListener:function(t,e){r.getListeners(t).end=e;},setTrackDisposeListener:function(t,e){r.getListeners(t).dispose=e;},setTrackCompleteListener:function(t,i){r.getListeners(t).complete=function(t){var e=Math.floor(t.trackTime/t.animationEnd);i(t,e);};},setTrackEventListener:function(t,e){r.getListeners(t).event=e;},getState:function(){return this._state;},_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new r(),this._state&&this._state.addListener(this._listener));},_updateSkeletonData:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new n.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin);}catch(t){cc.warn(t);}this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation;}else this.disableRender();}else this.disableRender();},_refreshInspector:function(){this._updateAnimEnum(),this._updateSkinEnum(),Editor.Utils.refreshSelectedInspector("node",this.node.uuid);},_updateDebugDraw:function(){var t;this.debugBones||this.debugSlots?(this._debugRenderer||((t=new cc.PrivateNode()).name="DEBUG_DRAW_NODE",(t=t.addComponent(a)).lineWidth=1,t.strokeColor=cc.color(255,0,0,255),this._debugRenderer=t),this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")):this._debugRenderer&&(this._debugRenderer.node.parent=null);}}),e.exports=sp.Skeleton;},{"../../cocos2d/core/components/CCRenderComponent":89,"../../cocos2d/core/graphics/graphics":131,"../../cocos2d/core/renderer/render-flow":221,"./AttachUtil":352,"./lib/spine":355,"./skeleton-cache":356,"./track-entry-listeners":360}],354:[function(t,e,i){"use strict";var r="undefined"==typeof window?global:window;r.spine=t("./lib/spine"),r.sp={},sp._timeScale=1,Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale;},set:function(t){this._timeScale=t;},configurable:!0}),sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=r.spine,t("./skeleton-texture"),t("./skeleton-data"),t("./vertex-effect-delegate"),t("./Skeleton"),t("./spine-assembler");},{"./Skeleton":353,"./lib/spine":355,"./skeleton-data":357,"./skeleton-texture":358,"./spine-assembler":359,"./vertex-effect-delegate":361}],355:[function(n,a,o){"use strict";s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);})(t,e);};var y=function(t,e){function __(){this.constructor=t;}s(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __());};var s;var c,l;function IkConstraintData(t){t=h.call(this,t,0,!1)||this;return t.bones=new Array(),t.bendDirection=1,t.compress=!1,t.stretch=!1,t.uniform=!1,t.mix=1,t.softness=0,t;}var h;function PathConstraintData(t){t=_.call(this,t,0,!1)||this;return t.bones=new Array(),t;}var _;!function(N){Animation.prototype.hasTimeline=function(t){return 1==this.timelineIds[t];},Animation.prototype.apply=function(t,e,i,r,n,a,o,s){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(i%=this.duration,0<e&&(e%=this.duration));var c=this.timelines;for(var l=0,h=c.length;l<h;l++)c[l].apply(t,e,i,n,a,o,s);},Animation.binarySearch=function(t,e,i){var r=0;var n=t.length/(i=void 0===i?1:i)-2;if(0==n)return i;var a=n>>>1;for(;;){if(t[(a+1)*i]<=e?r=a+1:n=a,r==n)return(r+1)*i;a=r+n>>>1;}},Animation.linearSearch=function(t,e,i){for(var r=0,n=t.length-i;r<=n;r+=i)if(t[r]>e)return r;return-1;};var G=Animation;function Animation(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=i;}var k;var f;var e;N.Animation=G,(t=k=N.MixBlend||(N.MixBlend={}))[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",(t=f=N.MixDirection||(N.MixDirection={}))[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",(t=e=N.TimelineType||(N.TimelineType={}))[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor";CurveTimeline.prototype.getFrameCount=function(){return this.curves.length/CurveTimeline.BEZIER_SIZE+1;},CurveTimeline.prototype.setLinear=function(t){this.curves[t*CurveTimeline.BEZIER_SIZE]=CurveTimeline.LINEAR;},CurveTimeline.prototype.setStepped=function(t){this.curves[t*CurveTimeline.BEZIER_SIZE]=CurveTimeline.STEPPED;},CurveTimeline.prototype.getCurveType=function(t){t*=CurveTimeline.BEZIER_SIZE;if(t==this.curves.length)return CurveTimeline.LINEAR;t=this.curves[t];return t==CurveTimeline.LINEAR?CurveTimeline.LINEAR:t==CurveTimeline.STEPPED?CurveTimeline.STEPPED:CurveTimeline.BEZIER;},CurveTimeline.prototype.setCurve=function(h,t,e,i,r){var u=.03*(2*-t+i),_=.03*(2*-e+r);var n=.006*(3*(t-i)+1),a=.006*(3*(e-r)+1);var d=2*u+n,f=2*_+a;var o=.3*t+u+.16666667*n,s=.3*e+_+.16666667*a;var c=h*CurveTimeline.BEZIER_SIZE;var l=this.curves;l[c++]=CurveTimeline.BEZIER;var p=o,m=s;for(var v=c+CurveTimeline.BEZIER_SIZE-1;c<v;c+=2)l[c]=p,l[c+1]=m,o+=d,s+=f,d+=n,f+=a,p+=o,m+=s;},CurveTimeline.prototype.getCurvePercent=function(t,e){e=N.MathUtils.clamp(e,0,1);var i=this.curves;var r=t*CurveTimeline.BEZIER_SIZE;t=i[r];if(t==CurveTimeline.LINEAR)return e;if(t==CurveTimeline.STEPPED)return 0;var n=0;for(var a=++r,o=r+CurveTimeline.BEZIER_SIZE-1;r<o;r+=2){var s,c;if(e<=(n=i[r]))return c=s=void 0,(c=r==a?s=0:(s=i[r-2],i[r-1]))+(i[r+1]-c)*(e-s)/(n-s);}t=i[r-1];return t+(1-t)*(e-n)/(1-n);},CurveTimeline.LINEAR=0,CurveTimeline.STEPPED=1,CurveTimeline.BEZIER=2,CurveTimeline.BEZIER_SIZE=19;var t=CurveTimeline;function CurveTimeline(t){if(t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=N.Utils.newFloatArray((t-1)*CurveTimeline.BEZIER_SIZE);}N.CurveTimeline=t;y(RotateTimeline,r=t),RotateTimeline.prototype.getPropertyId=function(){return(e.rotate<<24)+this.boneIndex;},RotateTimeline.prototype.setFrame=function(t,e,i){this.frames[t<<=1]=e,this.frames[t+RotateTimeline.ROTATION]=i;},RotateTimeline.prototype.apply=function(t,h,e,u,i,r,_){var n=this.frames;var a=t.bones[this.boneIndex];if(a.active)if(e<n[0])switch(r){case k.setup:return void(a.rotation=a.data.rotation);case k.first:var o=a.data.rotation-a.rotation;a.rotation+=(o-360*(16384-(16384.499999999996-o/360|0)))*i;}else if(e>=n[n.length-RotateTimeline.ENTRIES]){var s=n[n.length+RotateTimeline.PREV_ROTATION];switch(r){case k.setup:a.rotation=a.data.rotation+s*i;break;case k.first:case k.replace:s=(s+=a.data.rotation-a.rotation)-360*(16384-(16384.499999999996-s/360|0));case k.add:a.rotation+=s*i;}}else{t=G.binarySearch(n,e,RotateTimeline.ENTRIES);var c=n[t+RotateTimeline.PREV_ROTATION];var d=n[t];e=this.getCurvePercent((t>>1)-1,1-(e-d)/(n[t+RotateTimeline.PREV_TIME]-d));var l=n[t+RotateTimeline.ROTATION]-c;switch(l=c+(l-360*(16384-(16384.499999999996-l/360|0)))*e,r){case k.setup:a.rotation=a.data.rotation+(l-360*(16384-(16384.499999999996-l/360|0)))*i;break;case k.first:case k.replace:l+=a.data.rotation-a.rotation;case k.add:a.rotation+=(l-360*(16384-(16384.499999999996-l/360|0)))*i;}}},RotateTimeline.ENTRIES=2,RotateTimeline.PREV_TIME=-2,RotateTimeline.PREV_ROTATION=-1,RotateTimeline.ROTATION=1;var i=RotateTimeline;function RotateTimeline(t){var e=r.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t<<1),e;}var r;N.RotateTimeline=i;y(TranslateTimeline,n=t),TranslateTimeline.prototype.getPropertyId=function(){return(e.translate<<24)+this.boneIndex;},TranslateTimeline.prototype.setFrame=function(t,e,i,r){this.frames[t*=TranslateTimeline.ENTRIES]=e,this.frames[t+TranslateTimeline.X]=i,this.frames[t+TranslateTimeline.Y]=r;},TranslateTimeline.prototype.apply=function(t,l,e,h,i,r,u){var n=this.frames;var a=t.bones[this.boneIndex];if(a.active)if(e<n[0])switch(r){case k.setup:return a.x=a.data.x,void(a.y=a.data.y);case k.first:a.x+=(a.data.x-a.x)*i,a.y+=(a.data.y-a.y)*i;}else{var o=0,s=0;var c;switch(e>=n[n.length-TranslateTimeline.ENTRIES]?(o=n[n.length+TranslateTimeline.PREV_X],s=n[n.length+TranslateTimeline.PREV_Y]):(o=n[(t=G.binarySearch(n,e,TranslateTimeline.ENTRIES))+TranslateTimeline.PREV_X],s=n[t+TranslateTimeline.PREV_Y],c=n[t],e=this.getCurvePercent(t/TranslateTimeline.ENTRIES-1,1-(e-c)/(n[t+TranslateTimeline.PREV_TIME]-c)),o+=(n[t+TranslateTimeline.X]-o)*e,s+=(n[t+TranslateTimeline.Y]-s)*e),r){case k.setup:a.x=a.data.x+o*i,a.y=a.data.y+s*i;break;case k.first:case k.replace:a.x+=(a.data.x+o-a.x)*i,a.y+=(a.data.y+s-a.y)*i;break;case k.add:a.x+=o*i,a.y+=s*i;}}},TranslateTimeline.ENTRIES=3,TranslateTimeline.PREV_TIME=-3,TranslateTimeline.PREV_X=-2,TranslateTimeline.PREV_Y=-1,TranslateTimeline.X=1,TranslateTimeline.Y=2;i=TranslateTimeline;function TranslateTimeline(t){var e=n.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*TranslateTimeline.ENTRIES),e;}var n;N.TranslateTimeline=i;y(ScaleTimeline,o=i),ScaleTimeline.prototype.getPropertyId=function(){return(e.scale<<24)+this.boneIndex;},ScaleTimeline.prototype.apply=function(t,h,e,u,i,r,_){var n=this.frames;var a=t.bones[this.boneIndex];if(a.active)if(e<n[0])switch(r){case k.setup:return a.scaleX=a.data.scaleX,void(a.scaleY=a.data.scaleY);case k.first:a.scaleX+=(a.data.scaleX-a.scaleX)*i,a.scaleY+=(a.data.scaleY-a.scaleY)*i;}else{var o=0,s=0;var d;if(s=e>=n[n.length-ScaleTimeline.ENTRIES]?(o=n[n.length+ScaleTimeline.PREV_X]*a.data.scaleX,n[n.length+ScaleTimeline.PREV_Y]*a.data.scaleY):(o=n[(t=G.binarySearch(n,e,ScaleTimeline.ENTRIES))+ScaleTimeline.PREV_X],s=n[t+ScaleTimeline.PREV_Y],d=n[t],e=this.getCurvePercent(t/ScaleTimeline.ENTRIES-1,1-(e-d)/(n[t+ScaleTimeline.PREV_TIME]-d)),o=(o+(n[t+ScaleTimeline.X]-o)*e)*a.data.scaleX,(s+(n[t+ScaleTimeline.Y]-s)*e)*a.data.scaleY),1==i)r==k.add?(a.scaleX+=o-a.data.scaleX,a.scaleY+=s-a.data.scaleY):(a.scaleX=o,a.scaleY=s);else{var c=0,l=0;if(_==f.mixOut)switch(r){case k.setup:c=a.data.scaleX,l=a.data.scaleY,a.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-c)*i,a.scaleY=l+(Math.abs(s)*N.MathUtils.signum(l)-l)*i;break;case k.first:case k.replace:c=a.scaleX,l=a.scaleY,a.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-c)*i,a.scaleY=l+(Math.abs(s)*N.MathUtils.signum(l)-l)*i;break;case k.add:c=a.scaleX,l=a.scaleY,a.scaleX=c+(Math.abs(o)*N.MathUtils.signum(c)-a.data.scaleX)*i,a.scaleY=l+(Math.abs(s)*N.MathUtils.signum(l)-a.data.scaleY)*i;}else switch(r){case k.setup:c=Math.abs(a.data.scaleX)*N.MathUtils.signum(o),l=Math.abs(a.data.scaleY)*N.MathUtils.signum(s),a.scaleX=c+(o-c)*i,a.scaleY=l+(s-l)*i;break;case k.first:case k.replace:c=Math.abs(a.scaleX)*N.MathUtils.signum(o),l=Math.abs(a.scaleY)*N.MathUtils.signum(s),a.scaleX=c+(o-c)*i,a.scaleY=l+(s-l)*i;break;case k.add:c=N.MathUtils.signum(o),l=N.MathUtils.signum(s),a.scaleX=Math.abs(a.scaleX)*c+(o-Math.abs(a.data.scaleX)*c)*i,a.scaleY=Math.abs(a.scaleY)*l+(s-Math.abs(a.data.scaleY)*l)*i;}}}};var a=ScaleTimeline;function ScaleTimeline(t){return o.call(this,t)||this;}var o;N.ScaleTimeline=a;y(ShearTimeline,s=i),ShearTimeline.prototype.getPropertyId=function(){return(e.shear<<24)+this.boneIndex;},ShearTimeline.prototype.apply=function(t,l,e,h,i,r,u){var n=this.frames;var a=t.bones[this.boneIndex];if(a.active)if(e<n[0])switch(r){case k.setup:return a.shearX=a.data.shearX,void(a.shearY=a.data.shearY);case k.first:a.shearX+=(a.data.shearX-a.shearX)*i,a.shearY+=(a.data.shearY-a.shearY)*i;}else{var o=0,s=0;var c;switch(e>=n[n.length-ShearTimeline.ENTRIES]?(o=n[n.length+ShearTimeline.PREV_X],s=n[n.length+ShearTimeline.PREV_Y]):(o=n[(t=G.binarySearch(n,e,ShearTimeline.ENTRIES))+ShearTimeline.PREV_X],s=n[t+ShearTimeline.PREV_Y],c=n[t],e=this.getCurvePercent(t/ShearTimeline.ENTRIES-1,1-(e-c)/(n[t+ShearTimeline.PREV_TIME]-c)),o+=(n[t+ShearTimeline.X]-o)*e,s+=(n[t+ShearTimeline.Y]-s)*e),r){case k.setup:a.shearX=a.data.shearX+o*i,a.shearY=a.data.shearY+s*i;break;case k.first:case k.replace:a.shearX+=(a.data.shearX+o-a.shearX)*i,a.shearY+=(a.data.shearY+s-a.shearY)*i;break;case k.add:a.shearX+=o*i,a.shearY+=s*i;}}};a=ShearTimeline;function ShearTimeline(t){return s.call(this,t)||this;}var s;N.ShearTimeline=a;y(ColorTimeline,c=t),ColorTimeline.prototype.getPropertyId=function(){return(e.color<<24)+this.slotIndex;},ColorTimeline.prototype.setFrame=function(t,e,i,r,n,a){this.frames[t*=ColorTimeline.ENTRIES]=e,this.frames[t+ColorTimeline.R]=i,this.frames[t+ColorTimeline.G]=r,this.frames[t+ColorTimeline.B]=n,this.frames[t+ColorTimeline.A]=a;},ColorTimeline.prototype.apply=function(t,h,e,u,i,_,d){var r=t.slots[this.slotIndex];if(r.bone.active){t=this.frames;if(e<t[0])switch(_){case k.setup:return void r.color.setFromColor(r.data.color);case k.first:var n=r.color,f=r.data.color;n.add((f.r-n.r)*i,(f.g-n.g)*i,(f.b-n.b)*i,(f.a-n.a)*i);}else{var a=0,o=0,s=0,c=0;var l,p;e>=t[t.length-ColorTimeline.ENTRIES]?(a=t[(l=t.length)+ColorTimeline.PREV_R],o=t[l+ColorTimeline.PREV_G],s=t[l+ColorTimeline.PREV_B],c=t[l+ColorTimeline.PREV_A]):(a=t[(l=G.binarySearch(t,e,ColorTimeline.ENTRIES))+ColorTimeline.PREV_R],o=t[l+ColorTimeline.PREV_G],s=t[l+ColorTimeline.PREV_B],c=t[l+ColorTimeline.PREV_A],p=t[l],e=this.getCurvePercent(l/ColorTimeline.ENTRIES-1,1-(e-p)/(t[l+ColorTimeline.PREV_TIME]-p)),a+=(t[l+ColorTimeline.R]-a)*e,o+=(t[l+ColorTimeline.G]-o)*e,s+=(t[l+ColorTimeline.B]-s)*e,c+=(t[l+ColorTimeline.A]-c)*e),1==i?r.color.set(a,o,s,c):(n=r.color,_==k.setup&&n.setFromColor(r.data.color),n.add((a-n.r)*i,(o-n.g)*i,(s-n.b)*i,(c-n.a)*i));}}},ColorTimeline.ENTRIES=5,ColorTimeline.PREV_TIME=-5,ColorTimeline.PREV_R=-4,ColorTimeline.PREV_G=-3,ColorTimeline.PREV_B=-2,ColorTimeline.PREV_A=-1,ColorTimeline.R=1,ColorTimeline.G=2,ColorTimeline.B=3,ColorTimeline.A=4;i=ColorTimeline;function ColorTimeline(t){var e=c.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*ColorTimeline.ENTRIES),e;}var c;N.ColorTimeline=i;y(TwoColorTimeline,l=t),TwoColorTimeline.prototype.getPropertyId=function(){return(e.twoColor<<24)+this.slotIndex;},TwoColorTimeline.prototype.setFrame=function(t,e,i,r,n,a,o,s,c){this.frames[t*=TwoColorTimeline.ENTRIES]=e,this.frames[t+TwoColorTimeline.R]=i,this.frames[t+TwoColorTimeline.G]=r,this.frames[t+TwoColorTimeline.B]=n,this.frames[t+TwoColorTimeline.A]=a,this.frames[t+TwoColorTimeline.R2]=o,this.frames[t+TwoColorTimeline.G2]=s,this.frames[t+TwoColorTimeline.B2]=c;},TwoColorTimeline.prototype.apply=function(t,h,e,u,i,_,d){var r=t.slots[this.slotIndex];if(r.bone.active){t=this.frames;if(e<t[0])switch(_){case k.setup:return r.color.setFromColor(r.data.color),void r.darkColor.setFromColor(r.data.darkColor);case k.first:var n=r.color,a=r.darkColor,f=r.data.color,p=r.data.darkColor;n.add((f.r-n.r)*i,(f.g-n.g)*i,(f.b-n.b)*i,(f.a-n.a)*i),a.add((p.r-a.r)*i,(p.g-a.g)*i,(p.b-a.b)*i,0);}else{var o=0,s=0,c=0,m=0,v=0,y=0,g=0;var l,b;e>=t[t.length-TwoColorTimeline.ENTRIES]?(o=t[(l=t.length)+TwoColorTimeline.PREV_R],s=t[l+TwoColorTimeline.PREV_G],c=t[l+TwoColorTimeline.PREV_B],m=t[l+TwoColorTimeline.PREV_A],v=t[l+TwoColorTimeline.PREV_R2],y=t[l+TwoColorTimeline.PREV_G2],g=t[l+TwoColorTimeline.PREV_B2]):(o=t[(l=G.binarySearch(t,e,TwoColorTimeline.ENTRIES))+TwoColorTimeline.PREV_R],s=t[l+TwoColorTimeline.PREV_G],c=t[l+TwoColorTimeline.PREV_B],m=t[l+TwoColorTimeline.PREV_A],v=t[l+TwoColorTimeline.PREV_R2],y=t[l+TwoColorTimeline.PREV_G2],g=t[l+TwoColorTimeline.PREV_B2],b=t[l],e=this.getCurvePercent(l/TwoColorTimeline.ENTRIES-1,1-(e-b)/(t[l+TwoColorTimeline.PREV_TIME]-b)),o+=(t[l+TwoColorTimeline.R]-o)*e,s+=(t[l+TwoColorTimeline.G]-s)*e,c+=(t[l+TwoColorTimeline.B]-c)*e,m+=(t[l+TwoColorTimeline.A]-m)*e,v+=(t[l+TwoColorTimeline.R2]-v)*e,y+=(t[l+TwoColorTimeline.G2]-y)*e,g+=(t[l+TwoColorTimeline.B2]-g)*e),1==i?(r.color.set(o,s,c,m),r.darkColor.set(v,y,g,1)):(n=r.color,a=r.darkColor,_==k.setup&&(n.setFromColor(r.data.color),a.setFromColor(r.data.darkColor)),n.add((o-n.r)*i,(s-n.g)*i,(c-n.b)*i,(m-n.a)*i),a.add((v-a.r)*i,(y-a.g)*i,(g-a.b)*i,0));}}},TwoColorTimeline.ENTRIES=8,TwoColorTimeline.PREV_TIME=-8,TwoColorTimeline.PREV_R=-7,TwoColorTimeline.PREV_G=-6,TwoColorTimeline.PREV_B=-5,TwoColorTimeline.PREV_A=-4,TwoColorTimeline.PREV_R2=-3,TwoColorTimeline.PREV_G2=-2,TwoColorTimeline.PREV_B2=-1,TwoColorTimeline.R=1,TwoColorTimeline.G=2,TwoColorTimeline.B=3,TwoColorTimeline.A=4,TwoColorTimeline.R2=5,TwoColorTimeline.G2=6,TwoColorTimeline.B2=7;a=TwoColorTimeline;function TwoColorTimeline(t){var e=l.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*TwoColorTimeline.ENTRIES),e;}var l;function AttachmentTimeline(t){this.frames=N.Utils.newFloatArray(t),this.attachmentNames=new Array(t);}N.TwoColorTimeline=a,AttachmentTimeline.prototype.getPropertyId=function(){return(e.attachment<<24)+this.slotIndex;},AttachmentTimeline.prototype.getFrameCount=function(){return this.frames.length;},AttachmentTimeline.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i;},AttachmentTimeline.prototype.apply=function(t,e,i,r,n,a,o){var s=t.slots[this.slotIndex];if(s.bone.active){if(o==f.mixOut&&a==k.setup)return o=s.data.attachmentName,void s.setAttachment(null==o?null:t.getAttachment(this.slotIndex,o));o=this.frames;i<o[0]?a!=k.setup&&a!=k.first||(a=s.data.attachmentName,s.setAttachment(null==a?null:t.getAttachment(this.slotIndex,a))):(s=0,s=i>=o[o.length-1]?o.length-1:G.binarySearch(o,i,1)-1,a=this.attachmentNames[s],t.slots[this.slotIndex].setAttachment(null==a?null:t.getAttachment(this.slotIndex,a)));}},N.AttachmentTimeline=AttachmentTimeline;var h=null;y(DeformTimeline,u=t),DeformTimeline.prototype.getPropertyId=function(){return(e.deform<<27)+ +this.attachment.id+this.slotIndex;},DeformTimeline.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i;},DeformTimeline.prototype.apply=function(t,h,u,_,e,d,f){t=t.slots[this.slotIndex];if(t.bone.active){var i=t.getAttachment();if(i instanceof N.VertexAttachment&&i.deformAttachment==this.attachment){var p=t.deform;0==p.length&&(d=k.setup);t=this.frameVertices;var r=t[0].length;var m=this.frames;if(u<m[0]){var n=i;switch(d){case k.setup:return void(p.length=0);case k.first:if(1==e){p.length=0;break;}var v=N.Utils.setArraySize(p,r);if(null==n.bones){var a=n.vertices;for(var o=0;o<r;o++)v[o]+=(a[o]-v[o])*e;}else{e=1-e;for(o=0;o<r;o++)v[o]*=e;}}}else{var s=N.Utils.setArraySize(p,r);if(u>=m[m.length-1]){var c=t[m.length-1];if(1==e){if(d==k.add){if(null==(n=i).bones){a=n.vertices;for(var y=0;y<r;y++)s[y]+=c[y]-a[y];}else for(var g=0;g<r;g++)s[g]+=c[g];}else N.Utils.arrayCopy(c,0,s,0,r);}else switch(d){case k.setup:if(null==i.bones){a=i.vertices;for(var b=0;b<r;b++){var C=a[b];s[b]=C+(c[b]-C)*e;}}else for(var x=0;x<r;x++)s[x]=c[x]*e;break;case k.first:case k.replace:for(var A=0;A<r;A++)s[A]+=(c[A]-s[A])*e;case k.add:if(null==(n=i).bones){a=n.vertices;for(var S=0;S<r;S++)s[S]+=(c[S]-a[S])*e;}else for(var T=0;T<r;T++)s[T]+=c[T]*e;}}else{var w=G.binarySearch(m,u);var E=t[w-1];var P=t[w];t=m[w];var M=this.getCurvePercent(w-1,1-(u-t)/(m[w-1]-t));if(1==e){if(d==k.add){if(null==(n=i).bones){a=n.vertices;for(var R=0;R<r;R++){var l=E[R];s[R]+=l+(P[R]-l)*M-a[R];}}else for(var I=0;I<r;I++){l=E[I];s[I]+=l+(P[I]-l)*M;}}else for(var B=0;B<r;B++){l=E[B];s[B]=l+(P[B]-l)*M;}}else switch(d){case k.setup:if(null==i.bones){a=i.vertices;for(var D=0;D<r;D++){l=E[D],C=a[D];s[D]=C+(l+(P[D]-l)*M-C)*e;}}else for(var L=0;L<r;L++){l=E[L];s[L]=(l+(P[L]-l)*M)*e;}break;case k.first:case k.replace:for(var V=0;V<r;V++){l=E[V];s[V]+=(l+(P[V]-l)*M-s[V])*e;}break;case k.add:if(null==(n=i).bones){a=n.vertices;for(var O=0;O<r;O++){l=E[O];s[O]+=(l+(P[O]-l)*M-a[O])*e;}}else for(var F=0;F<r;F++){l=E[F];s[F]+=(l+(P[F]-l)*M)*e;}}}}}}};i=DeformTimeline;function DeformTimeline(t){var e=u.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t),e.frameVertices=new Array(t),null==h&&(h=N.Utils.newFloatArray(64)),e;}var u;function EventTimeline(t){this.frames=N.Utils.newFloatArray(t),this.events=new Array(t);}function DrawOrderTimeline(t){this.frames=N.Utils.newFloatArray(t),this.drawOrders=new Array(t);}N.DeformTimeline=i,EventTimeline.prototype.getPropertyId=function(){return e.event<<24;},EventTimeline.prototype.getFrameCount=function(){return this.frames.length;},EventTimeline.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e;},EventTimeline.prototype.apply=function(t,e,i,r,n,a,o){if(null!=r){var s=this.frames;var c=this.frames.length;if(i<e)this.apply(t,e,Number.MAX_VALUE,r,n,a,o),e=-1;else if(e>=s[c-1])return;if(!(i<s[0])){var l=0;if(e<s[0])l=0;else{var h=s[l=G.binarySearch(s,e)];for(;0<l&&s[l-1]==h;)l--;}for(;l<c&&i>=s[l];l++)r.push(this.events[l]);}}},N.EventTimeline=EventTimeline,DrawOrderTimeline.prototype.getPropertyId=function(){return e.drawOrder<<24;},DrawOrderTimeline.prototype.getFrameCount=function(){return this.frames.length;},DrawOrderTimeline.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i;},DrawOrderTimeline.prototype.apply=function(t,l,e,h,u,i,r){var n=t.drawOrder;var a=t.slots;if(r!=f.mixOut||i!=k.setup){r=this.frames;if(e<r[0])i!=k.setup&&i!=k.first||N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{i=e>=r[r.length-1]?r.length-1:G.binarySearch(r,e)-1;var o=this.drawOrders[i];if(null==o)N.Utils.arrayCopy(a,0,n,0,a.length);else for(var s=0,c=o.length;s<c;s++)n[s]=a[o[s]];}}else N.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);},N.DrawOrderTimeline=DrawOrderTimeline;y(IkConstraintTimeline,_=t),IkConstraintTimeline.prototype.getPropertyId=function(){return(e.ikConstraint<<24)+this.ikConstraintIndex;},IkConstraintTimeline.prototype.setFrame=function(t,e,i,r,n,a,o){this.frames[t*=IkConstraintTimeline.ENTRIES]=e,this.frames[t+IkConstraintTimeline.MIX]=i,this.frames[t+IkConstraintTimeline.SOFTNESS]=r,this.frames[t+IkConstraintTimeline.BEND_DIRECTION]=n,this.frames[t+IkConstraintTimeline.COMPRESS]=a?1:0,this.frames[t+IkConstraintTimeline.STRETCH]=o?1:0;},IkConstraintTimeline.prototype.apply=function(t,h,e,u,i,r,n){var a=this.frames;var o=t.ikConstraints[this.ikConstraintIndex];var s,c,l;if(o.active)if(e<a[0])switch(r){case k.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case k.first:o.mix+=(o.data.mix-o.mix)*i,o.softness+=(o.data.softness-o.softness)*i,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch;}else e>=a[a.length-IkConstraintTimeline.ENTRIES]?r==k.setup?(o.mix=o.data.mix+(a[a.length+IkConstraintTimeline.PREV_MIX]-o.data.mix)*i,o.softness=o.data.softness+(a[a.length+IkConstraintTimeline.PREV_SOFTNESS]-o.data.softness)*i,n==f.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=a[a.length+IkConstraintTimeline.PREV_BEND_DIRECTION],o.compress=0!=a[a.length+IkConstraintTimeline.PREV_COMPRESS],o.stretch=0!=a[a.length+IkConstraintTimeline.PREV_STRETCH])):(o.mix+=(a[a.length+IkConstraintTimeline.PREV_MIX]-o.mix)*i,o.softness+=(a[a.length+IkConstraintTimeline.PREV_SOFTNESS]-o.softness)*i,n==f.mixIn&&(o.bendDirection=a[a.length+IkConstraintTimeline.PREV_BEND_DIRECTION],o.compress=0!=a[a.length+IkConstraintTimeline.PREV_COMPRESS],o.stretch=0!=a[a.length+IkConstraintTimeline.PREV_STRETCH])):(s=a[(t=G.binarySearch(a,e,IkConstraintTimeline.ENTRIES))+IkConstraintTimeline.PREV_MIX],c=a[t+IkConstraintTimeline.PREV_SOFTNESS],l=a[t],e=this.getCurvePercent(t/IkConstraintTimeline.ENTRIES-1,1-(e-l)/(a[t+IkConstraintTimeline.PREV_TIME]-l)),r==k.setup?(o.mix=o.data.mix+(s+(a[t+IkConstraintTimeline.MIX]-s)*e-o.data.mix)*i,o.softness=o.data.softness+(c+(a[t+IkConstraintTimeline.SOFTNESS]-c)*e-o.data.softness)*i,n==f.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=a[t+IkConstraintTimeline.PREV_BEND_DIRECTION],o.compress=0!=a[t+IkConstraintTimeline.PREV_COMPRESS],o.stretch=0!=a[t+IkConstraintTimeline.PREV_STRETCH])):(o.mix+=(s+(a[t+IkConstraintTimeline.MIX]-s)*e-o.mix)*i,o.softness+=(c+(a[t+IkConstraintTimeline.SOFTNESS]-c)*e-o.softness)*i,n==f.mixIn&&(o.bendDirection=a[t+IkConstraintTimeline.PREV_BEND_DIRECTION],o.compress=0!=a[t+IkConstraintTimeline.PREV_COMPRESS],o.stretch=0!=a[t+IkConstraintTimeline.PREV_STRETCH])));},IkConstraintTimeline.ENTRIES=6,IkConstraintTimeline.PREV_TIME=-6,IkConstraintTimeline.PREV_MIX=-5,IkConstraintTimeline.PREV_SOFTNESS=-4,IkConstraintTimeline.PREV_BEND_DIRECTION=-3,IkConstraintTimeline.PREV_COMPRESS=-2,IkConstraintTimeline.PREV_STRETCH=-1,IkConstraintTimeline.MIX=1,IkConstraintTimeline.SOFTNESS=2,IkConstraintTimeline.BEND_DIRECTION=3,IkConstraintTimeline.COMPRESS=4,IkConstraintTimeline.STRETCH=5;a=IkConstraintTimeline;function IkConstraintTimeline(t){var e=_.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*IkConstraintTimeline.ENTRIES),e;}var _;N.IkConstraintTimeline=a;y(TransformConstraintTimeline,d=t),TransformConstraintTimeline.prototype.getPropertyId=function(){return(e.transformConstraint<<24)+this.transformConstraintIndex;},TransformConstraintTimeline.prototype.setFrame=function(t,e,i,r,n,a){this.frames[t*=TransformConstraintTimeline.ENTRIES]=e,this.frames[t+TransformConstraintTimeline.ROTATE]=i,this.frames[t+TransformConstraintTimeline.TRANSLATE]=r,this.frames[t+TransformConstraintTimeline.SCALE]=n,this.frames[t+TransformConstraintTimeline.SHEAR]=a;},TransformConstraintTimeline.prototype.apply=function(t,h,e,u,i,_,d){var r=this.frames;var n=t.transformConstraints[this.transformConstraintIndex];if(n.active)if(e<r[0]){var a=n.data;switch(_){case k.setup:return n.rotateMix=a.rotateMix,n.translateMix=a.translateMix,n.scaleMix=a.scaleMix,void(n.shearMix=a.shearMix);case k.first:n.rotateMix+=(a.rotateMix-n.rotateMix)*i,n.translateMix+=(a.translateMix-n.translateMix)*i,n.scaleMix+=(a.scaleMix-n.scaleMix)*i,n.shearMix+=(a.shearMix-n.shearMix)*i;}}else{var t=0,o=0,s=0,c=0;var l,f;e>=r[r.length-TransformConstraintTimeline.ENTRIES]?(t=r[(l=r.length)+TransformConstraintTimeline.PREV_ROTATE],o=r[l+TransformConstraintTimeline.PREV_TRANSLATE],s=r[l+TransformConstraintTimeline.PREV_SCALE],c=r[l+TransformConstraintTimeline.PREV_SHEAR]):(t=r[(l=G.binarySearch(r,e,TransformConstraintTimeline.ENTRIES))+TransformConstraintTimeline.PREV_ROTATE],o=r[l+TransformConstraintTimeline.PREV_TRANSLATE],s=r[l+TransformConstraintTimeline.PREV_SCALE],c=r[l+TransformConstraintTimeline.PREV_SHEAR],f=r[l],e=this.getCurvePercent(l/TransformConstraintTimeline.ENTRIES-1,1-(e-f)/(r[l+TransformConstraintTimeline.PREV_TIME]-f)),t+=(r[l+TransformConstraintTimeline.ROTATE]-t)*e,o+=(r[l+TransformConstraintTimeline.TRANSLATE]-o)*e,s+=(r[l+TransformConstraintTimeline.SCALE]-s)*e,c+=(r[l+TransformConstraintTimeline.SHEAR]-c)*e),_==k.setup?(a=n.data,n.rotateMix=a.rotateMix+(t-a.rotateMix)*i,n.translateMix=a.translateMix+(o-a.translateMix)*i,n.scaleMix=a.scaleMix+(s-a.scaleMix)*i,n.shearMix=a.shearMix+(c-a.shearMix)*i):(n.rotateMix+=(t-n.rotateMix)*i,n.translateMix+=(o-n.translateMix)*i,n.scaleMix+=(s-n.scaleMix)*i,n.shearMix+=(c-n.shearMix)*i);}},TransformConstraintTimeline.ENTRIES=5,TransformConstraintTimeline.PREV_TIME=-5,TransformConstraintTimeline.PREV_ROTATE=-4,TransformConstraintTimeline.PREV_TRANSLATE=-3,TransformConstraintTimeline.PREV_SCALE=-2,TransformConstraintTimeline.PREV_SHEAR=-1,TransformConstraintTimeline.ROTATE=1,TransformConstraintTimeline.TRANSLATE=2,TransformConstraintTimeline.SCALE=3,TransformConstraintTimeline.SHEAR=4;i=TransformConstraintTimeline;function TransformConstraintTimeline(t){var e=d.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*TransformConstraintTimeline.ENTRIES),e;}var d;N.TransformConstraintTimeline=i;y(PathConstraintPositionTimeline,p=t),PathConstraintPositionTimeline.prototype.getPropertyId=function(){return(e.pathConstraintPosition<<24)+this.pathConstraintIndex;},PathConstraintPositionTimeline.prototype.setFrame=function(t,e,i){this.frames[t*=PathConstraintPositionTimeline.ENTRIES]=e,this.frames[t+PathConstraintPositionTimeline.VALUE]=i;},PathConstraintPositionTimeline.prototype.apply=function(t,e,i,l,r,n,h){var a=this.frames;var o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(i<a[0])switch(n){case k.setup:return void(o.position=o.data.position);case k.first:o.position+=(o.data.position-o.position)*r;}else{t=0;var s,c;i>=a[a.length-PathConstraintPositionTimeline.ENTRIES]?t=a[a.length+PathConstraintPositionTimeline.PREV_VALUE]:(t=a[(s=G.binarySearch(a,i,PathConstraintPositionTimeline.ENTRIES))+PathConstraintPositionTimeline.PREV_VALUE],c=a[s],i=this.getCurvePercent(s/PathConstraintPositionTimeline.ENTRIES-1,1-(i-c)/(a[s+PathConstraintPositionTimeline.PREV_TIME]-c)),t+=(a[s+PathConstraintPositionTimeline.VALUE]-t)*i),n==k.setup?o.position=o.data.position+(t-o.data.position)*r:o.position+=(t-o.position)*r;}},PathConstraintPositionTimeline.ENTRIES=2,PathConstraintPositionTimeline.PREV_TIME=-2,PathConstraintPositionTimeline.PREV_VALUE=-1,PathConstraintPositionTimeline.VALUE=1;a=PathConstraintPositionTimeline;function PathConstraintPositionTimeline(t){var e=p.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*PathConstraintPositionTimeline.ENTRIES),e;}var p;N.PathConstraintPositionTimeline=a;y(PathConstraintSpacingTimeline,m=a),PathConstraintSpacingTimeline.prototype.getPropertyId=function(){return(e.pathConstraintSpacing<<24)+this.pathConstraintIndex;},PathConstraintSpacingTimeline.prototype.apply=function(t,e,i,l,r,n,h){var a=this.frames;var o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(i<a[0])switch(n){case k.setup:return void(o.spacing=o.data.spacing);case k.first:o.spacing+=(o.data.spacing-o.spacing)*r;}else{t=0;var s,c;i>=a[a.length-PathConstraintSpacingTimeline.ENTRIES]?t=a[a.length+PathConstraintSpacingTimeline.PREV_VALUE]:(t=a[(s=G.binarySearch(a,i,PathConstraintSpacingTimeline.ENTRIES))+PathConstraintSpacingTimeline.PREV_VALUE],c=a[s],i=this.getCurvePercent(s/PathConstraintSpacingTimeline.ENTRIES-1,1-(i-c)/(a[s+PathConstraintSpacingTimeline.PREV_TIME]-c)),t+=(a[s+PathConstraintSpacingTimeline.VALUE]-t)*i),n==k.setup?o.spacing=o.data.spacing+(t-o.data.spacing)*r:o.spacing+=(t-o.spacing)*r;}};i=PathConstraintSpacingTimeline;function PathConstraintSpacingTimeline(t){return m.call(this,t)||this;}var m;N.PathConstraintSpacingTimeline=i;y(PathConstraintMixTimeline,v=t),PathConstraintMixTimeline.prototype.getPropertyId=function(){return(e.pathConstraintMix<<24)+this.pathConstraintIndex;},PathConstraintMixTimeline.prototype.setFrame=function(t,e,i,r){this.frames[t*=PathConstraintMixTimeline.ENTRIES]=e,this.frames[t+PathConstraintMixTimeline.ROTATE]=i,this.frames[t+PathConstraintMixTimeline.TRANSLATE]=r;},PathConstraintMixTimeline.prototype.apply=function(t,l,e,h,i,r,u){var n=this.frames;var a=t.pathConstraints[this.pathConstraintIndex];if(a.active)if(e<n[0])switch(r){case k.setup:return a.rotateMix=a.data.rotateMix,void(a.translateMix=a.data.translateMix);case k.first:a.rotateMix+=(a.data.rotateMix-a.rotateMix)*i,a.translateMix+=(a.data.translateMix-a.translateMix)*i;}else{var t=0,o=0;var s,c;e>=n[n.length-PathConstraintMixTimeline.ENTRIES]?(t=n[n.length+PathConstraintMixTimeline.PREV_ROTATE],o=n[n.length+PathConstraintMixTimeline.PREV_TRANSLATE]):(t=n[(s=G.binarySearch(n,e,PathConstraintMixTimeline.ENTRIES))+PathConstraintMixTimeline.PREV_ROTATE],o=n[s+PathConstraintMixTimeline.PREV_TRANSLATE],c=n[s],e=this.getCurvePercent(s/PathConstraintMixTimeline.ENTRIES-1,1-(e-c)/(n[s+PathConstraintMixTimeline.PREV_TIME]-c)),t+=(n[s+PathConstraintMixTimeline.ROTATE]-t)*e,o+=(n[s+PathConstraintMixTimeline.TRANSLATE]-o)*e),r==k.setup?(a.rotateMix=a.data.rotateMix+(t-a.data.rotateMix)*i,a.translateMix=a.data.translateMix+(o-a.data.translateMix)*i):(a.rotateMix+=(t-a.rotateMix)*i,a.translateMix+=(o-a.translateMix)*i);}},PathConstraintMixTimeline.ENTRIES=3,PathConstraintMixTimeline.PREV_TIME=-3,PathConstraintMixTimeline.PREV_ROTATE=-2,PathConstraintMixTimeline.PREV_TRANSLATE=-1,PathConstraintMixTimeline.ROTATE=1,PathConstraintMixTimeline.TRANSLATE=2;a=PathConstraintMixTimeline;function PathConstraintMixTimeline(t){var e=v.call(this,t)||this;return e.frames=N.Utils.newFloatArray(t*PathConstraintMixTimeline.ENTRIES),e;}var v;N.PathConstraintMixTimeline=a;}(r=r||{}),function(S){AnimationState.prototype.update=function(t){t*=this.timeScale;var e=this.tracks;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(null!=n){n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;var a=t*n.timeScale;if(0<n.delay){if(n.delay-=a,0<n.delay)continue;a=-n.delay,n.delay=0;}var o=n.next;if(null!=o){var s=n.trackLast-o.delay;if(0<=s){for(o.delay=0,o.trackTime+=0==n.timeScale?0:(s/n.timeScale+t)*o.timeScale,n.trackTime+=a,this.setCurrent(i,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue;}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[i]=null,this.queue.end(n),this.disposeNext(n);continue;}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){var c=n.mixingFrom;for((n.mixingFrom=null)!=c&&(c.mixingTo=null);null!=c;)this.queue.end(c),c=c.mixingFrom;}n.trackTime+=a;}}this.queue.drain();},AnimationState.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var r=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,0<t.mixTime&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1);},AnimationState.prototype.apply=function(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();var e=this.events;var h=this.tracks;var u=!1;for(var i=0,_=h.length;i<_;i++){var r=h[i];if(!(null==r||0<r.delay)){u=!0;var n=0==i?S.MixBlend.first:r.mixBlend;var a=r.alpha;null!=r.mixingFrom?a*=this.applyMixingFrom(r,t,n):r.trackTime>=r.trackEnd&&null==r.next&&(a=0);var d=r.animationLast,o=r.getAnimationTime();var s=r.animation.timelines.length;var f=r.animation.timelines;if(0==i&&1==a||n==S.MixBlend.add)for(var c=0;c<s;c++)S.Utils.webkit602BugfixHelper(a,n),f[c].apply(t,d,o,e,a,n,S.MixDirection.mixIn);else{var p=r.timelineMode;var m=0==r.timelinesRotation.length;m&&S.Utils.setArraySize(r.timelinesRotation,s<<1,null);var v=r.timelinesRotation;for(c=0;c<s;c++){var l=f[c];var y=(p[c]&AnimationState.NOT_LAST-1)==AnimationState.SUBSEQUENT?n:S.MixBlend.setup;l instanceof S.RotateTimeline?this.applyRotateTimeline(l,t,o,a,y,v,c<<1,m):(S.Utils.webkit602BugfixHelper(a,n),l.apply(t,d,o,e,a,y,S.MixDirection.mixIn));}}this.queueEvents(r,o),e.length=0,r.nextAnimationLast=o,r.nextTrackLast=r.trackTime;}}return this.queue.drain(),u;},AnimationState.prototype.applyMixingFrom=function(t,e,i){var r=t.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,e,i);var n=0;0==t.mixDuration?(n=1,i==S.MixBlend.first&&(i=S.MixBlend.setup)):(1<(n=t.mixTime/t.mixDuration)&&(n=1),i!=S.MixBlend.first&&(i=r.mixBlend));var h=n<r.eventThreshold?this.events:null;var u=n<r.attachmentThreshold,_=n<r.drawOrderThreshold;var d=r.animationLast,a=r.getAnimationTime();var f=r.animation.timelines.length;var p=r.animation.timelines;var m=r.alpha*t.interruptAlpha,v=m*(1-n);if(i==S.MixBlend.add)for(var o=0;o<f;o++)p[o].apply(e,d,a,h,v,i,S.MixDirection.mixOut);else{var y=r.timelineMode;var g=r.timelineHoldMix;var b=0==r.timelinesRotation.length;b&&S.Utils.setArraySize(r.timelinesRotation,f<<1,null);var C=r.timelinesRotation;for(o=r.totalAlpha=0;o<f;o++){var s=p[o];var x=S.MixDirection.mixOut;var c=void 0;var l=0;switch(y[o]&AnimationState.NOT_LAST-1){case AnimationState.SUBSEQUENT:if(c=i,!u&&s instanceof S.AttachmentTimeline){if((y[o]&AnimationState.NOT_LAST)==AnimationState.NOT_LAST)continue;c=S.MixBlend.setup;}if(!_&&s instanceof S.DrawOrderTimeline)continue;l=v;break;case AnimationState.FIRST:c=S.MixBlend.setup,l=v;break;case AnimationState.HOLD:c=S.MixBlend.setup,l=m;break;default:c=S.MixBlend.setup;var A=g[o];l=m*Math.max(0,1-A.mixTime/A.mixDuration);}r.totalAlpha+=l,s instanceof S.RotateTimeline?this.applyRotateTimeline(s,e,a,l,c,C,o<<1,b):(S.Utils.webkit602BugfixHelper(l,i),c==S.MixBlend.setup&&(s instanceof S.AttachmentTimeline?!u&&(y[o]&AnimationState.NOT_LAST)!=AnimationState.NOT_LAST||(x=S.MixDirection.mixIn):s instanceof S.DrawOrderTimeline&&_&&(x=S.MixDirection.mixIn)),s.apply(e,d,a,h,l,c,x));}}return 0<t.mixDuration&&this.queueEvents(r,a),this.events.length=0,r.nextAnimationLast=a,r.nextTrackLast=r.trackTime,n;},AnimationState.prototype.applyRotateTimeline=function(h,u,t,_,d,e,i,f){if(f&&(e[i]=0),1!=_){var r=h;var n=r.frames;var a=u.bones[r.boneIndex];if(a.active){var p=0,o=0;if(t<n[0])switch(d){case S.MixBlend.setup:a.rotation=a.data.rotation;default:return;case S.MixBlend.first:p=a.rotation,o=a.data.rotation;}else p=(d==S.MixBlend.setup?a.data:a).rotation,t>=n[n.length-S.RotateTimeline.ENTRIES]?o=a.data.rotation+n[n.length+S.RotateTimeline.PREV_ROTATION]:(l=n[(c=S.Animation.binarySearch(n,t,S.RotateTimeline.ENTRIES))+S.RotateTimeline.PREV_ROTATION],s=n[c],r=r.getCurvePercent((c>>1)-1,1-(t-s)/(n[c+S.RotateTimeline.PREV_TIME]-s)),o=n[c+S.RotateTimeline.ROTATION]-l,o=l+(o-=360*(16384-(16384.499999999996-o/360|0)))*r+a.data.rotation,o-=360*(16384-(16384.499999999996-o/360|0)));var s=0,n=o-p;var c,l;0==(n-=360*(16384-(16384.499999999996-n/360|0)))?s=e[i]:(l=c=0,l=f?(c=0,n):(c=e[i],e[i+1]),r=0<n,f=0<=c,S.MathUtils.signum(l)!=S.MathUtils.signum(n)&&Math.abs(l)<=90&&(180<Math.abs(c)&&(c+=360*S.MathUtils.signum(c)),f=r),s=n+c-c%360,f!=r&&(s+=360*S.MathUtils.signum(c)),e[i]=s),e[i+1]=n,a.rotation=(p+=s*_)-360*(16384-(16384.499999999996-p/360|0));}}else h.apply(u,0,t,null,1,d,S.MixDirection.mixIn);},AnimationState.prototype.queueEvents=function(t,e){var i=t.animationStart,r=t.animationEnd;var n=r-i;var a=t.trackLast%n;var o=this.events;var s=0,c=o.length;for(;s<c;s++){var l=o[s];if(l.time<a)break;l.time>r||this.queue.event(t,l);}for((t.loop?0==n||a>t.trackTime%n:r<=e&&t.animationLast<r)&&this.queue.complete(t);s<c;s++)o[s].time<i||this.queue.event(t,o[s]);},AnimationState.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain();},AnimationState.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){t=this.tracks[t];if(null!=t){this.queue.end(t),this.disposeNext(t);var e=t;for(;;){var i=e.mixingFrom;if(null==i)break;this.queue.end(i),e.mixingFrom=null,e.mixingTo=null,e=i;}this.tracks[t.trackIndex]=null,this.queue.drain();}}},AnimationState.prototype.setCurrent=function(t,e,i){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(i&&this.queue.interrupt(r),((e.mixingFrom=r).mixingTo=e).mixTime=0,null!=r.mixingFrom&&0<r.mixDuration&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e);},AnimationState.prototype.setAnimation=function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,i);},AnimationState.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var r=!0;var n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));e=this.trackEntry(t,e,i,n);return this.setCurrent(t,e,r),this.queue.drain(),e;},AnimationState.prototype.addAnimation=function(t,e,i,r){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,i,r);},AnimationState.prototype.addAnimationWith=function(t,e,i,r){if(null==e)throw new Error("animation cannot be null.");var n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;i=this.trackEntry(t,e,i,n);return null==n?(this.setCurrent(t,i,!0),this.queue.drain()):(n.next=i,r<=0&&(0!=(t=n.animationEnd-n.animationStart)?(n.loop?r+=t*(1+(n.trackTime/t|0)):r+=Math.max(t,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime)),i.delay=r,i;},AnimationState.prototype.setEmptyAnimation=function(t,e){t=this.setAnimationWith(t,AnimationState.emptyAnimation,!1);return t.mixDuration=e,t.trackEnd=e,t;},AnimationState.prototype.addEmptyAnimation=function(t,e,i){i<=0&&(i-=e);t=this.addAnimationWith(t,AnimationState.emptyAnimation,!1,i);return t.mixDuration=e,t.trackEnd=e,t;},AnimationState.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,r=this.tracks.length;i<r;i++){var n=this.tracks[i];null!=n&&this.setEmptyAnimation(n.trackIndex,t);}this.queue.drainDisabled=e,this.queue.drain();},AnimationState.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(S.Utils.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null);},AnimationState.prototype.trackEntry=function(t,e,i,r){var n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=i,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n;},AnimationState.prototype.disposeNext=function(t){var e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null;},AnimationState.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++)if(null!=(i=this.tracks[t])){for(;null!=i.mixingFrom;)i=i.mixingFrom;for(;null!=i.mixingFrom&&i.mixBlend==S.MixBlend.add||this.computeHold(i),null!=(i=i.mixingTo););}this.propertyIDs.clear();for(t=this.tracks.length-1;0<=t;t--){var i=this.tracks[t];for(;null!=i;)this.computeNotLast(i),i=i.mixingFrom;}},AnimationState.prototype.computeHold=function(t){var e=t.mixingTo;var i=t.animation.timelines;var r=t.animation.timelines.length;var n=S.Utils.setArraySize(t.timelineMode,r);t.timelineHoldMix.length=0;var h=S.Utils.setArraySize(t.timelineHoldMix,r);var a=this.propertyIDs;if(null!=e&&e.holdPrevious)for(var o=0;o<r;o++)a.add(i[o].getPropertyId()),n[o]=AnimationState.HOLD;else t:for(o=0;o<r;o++){var s=i[o];var c=s.getPropertyId();if(a.add(c)){if(null==e||s instanceof S.AttachmentTimeline||s instanceof S.DrawOrderTimeline||s instanceof S.EventTimeline||!e.animation.hasTimeline(c))n[o]=AnimationState.FIRST;else{for(var l=e.mixingTo;null!=l;l=l.mixingTo)if(!l.animation.hasTimeline(c)){if(0<t.mixDuration){n[o]=AnimationState.HOLD_MIX,h[o]=l;continue t;}break;}n[o]=AnimationState.HOLD;}}else n[o]=AnimationState.SUBSEQUENT;}},AnimationState.prototype.computeNotLast=function(t){var e=t.animation.timelines;var i=t.animation.timelines.length;var r=t.timelineMode;var n=this.propertyIDs;for(var a=0;a<i;a++){var o;e[a]instanceof S.AttachmentTimeline&&(o=e[a],n.add(o.slotIndex)||(r[a]|=AnimationState.NOT_LAST));}},AnimationState.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t];},AnimationState.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t);},AnimationState.prototype.removeListener=function(t){t=this.listeners.indexOf(t);0<=t&&this.listeners.splice(t,1);},AnimationState.prototype.clearListeners=function(){this.listeners.length=0;},AnimationState.prototype.clearListenerNotifications=function(){this.queue.clear();},AnimationState.emptyAnimation=new S.Animation("<empty>",[],0),AnimationState.SUBSEQUENT=0,AnimationState.FIRST=1,AnimationState.HOLD=2,AnimationState.HOLD_MIX=3,AnimationState.NOT_LAST=4;var t=AnimationState;function AnimationState(t){this.tracks=new Array(),this.timeScale=1,this.events=new Array(),this.listeners=new Array(),this.queue=new i(this),this.propertyIDs=new S.IntSet(),this.animationsChanged=!1,this.trackEntryPool=new S.Pool(function(){return new e();}),this.data=t;}S.AnimationState=t;TrackEntry.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0;},TrackEntry.prototype.getAnimationTime=function(){var t;return this.loop?0==(t=this.animationEnd-this.animationStart)?this.animationStart:this.trackTime%t+this.animationStart:Math.min(this.trackTime+this.animationStart,this.animationEnd);},TrackEntry.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t;},TrackEntry.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart;},TrackEntry.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0;};var e=TrackEntry;function TrackEntry(){this.mixBlend=S.MixBlend.replace,this.timelineMode=new Array(),this.timelineHoldMix=new Array(),this.timelinesRotation=new Array();}S.TrackEntry=e;EventQueue.prototype.start=function(t){this.objects.push(s.start),this.objects.push(t),this.animState.animationsChanged=!0;},EventQueue.prototype.interrupt=function(t){this.objects.push(s.interrupt),this.objects.push(t);},EventQueue.prototype.end=function(t){this.objects.push(s.end),this.objects.push(t),this.animState.animationsChanged=!0;},EventQueue.prototype.dispose=function(t){this.objects.push(s.dispose),this.objects.push(t);},EventQueue.prototype.complete=function(t){this.objects.push(s.complete),this.objects.push(t);},EventQueue.prototype.event=function(t,e){this.objects.push(s.event),this.objects.push(t),this.objects.push(e);},EventQueue.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;var t=this.objects;var e=this.animState.listeners;for(var i=0;i<t.length;i+=2){var r=t[i];var n=t[i+1];switch(r){case s.start:null!=n.listener&&n.listener.start&&n.listener.start(n);for(var a=0;a<e.length;a++)e[a].start&&e[a].start(n);break;case s.interrupt:null!=n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(a=0;a<e.length;a++)e[a].interrupt&&e[a].interrupt(n);break;case s.end:null!=n.listener&&n.listener.end&&n.listener.end(n);for(a=0;a<e.length;a++)e[a].end&&e[a].end(n);case s.dispose:null!=n.listener&&n.listener.dispose&&n.listener.dispose(n);for(a=0;a<e.length;a++)e[a].dispose&&e[a].dispose(n);this.animState.trackEntryPool.free(n);break;case s.complete:null!=n.listener&&n.listener.complete&&n.listener.complete(n);for(a=0;a<e.length;a++)e[a].complete&&e[a].complete(n);break;case s.event:var o=t[2+i++];null!=n.listener&&n.listener.event&&n.listener.event(n,o);for(a=0;a<e.length;a++)e[a].event&&e[a].event(n,o);}}this.clear(),this.drainDisabled=!1;}},EventQueue.prototype.clear=function(){this.objects.length=0;};var i=EventQueue;function EventQueue(t){this.objects=[],this.drainDisabled=!1,this.animState=t;}var s;function AnimationStateAdapter(){}S.EventQueue=i,(t=s=S.EventType||(S.EventType={}))[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",AnimationStateAdapter.prototype.start=function(t){},AnimationStateAdapter.prototype.interrupt=function(t){},AnimationStateAdapter.prototype.end=function(t){},AnimationStateAdapter.prototype.dispose=function(t){},AnimationStateAdapter.prototype.complete=function(t){},AnimationStateAdapter.prototype.event=function(t,e){},S.AnimationStateAdapter=AnimationStateAdapter;}(r=r||{}),function(t){function AnimationStateData(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t;}AnimationStateData.prototype.setMix=function(t,e,i){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);t=this.skeletonData.findAnimation(e);if(null==t)throw new Error("Animation not found: "+e);this.setMixWith(r,t,i);},AnimationStateData.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");t=t.name+"."+e.name;this.animationToMixTime[t]=i;},AnimationStateData.prototype.getMix=function(t,e){t=t.name+"."+e.name;e=this.animationToMixTime[t];return void 0===e?this.defaultMix:e;},t.AnimationStateData=AnimationStateData;}(r=r||{}),function(_){function AssetManager(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e;}AssetManager.downloadText=function(t,e,i){var r=new XMLHttpRequest();r.open("GET",t,!0),r.onload=function(){200==r.status?e(r.responseText):i(r.status,r.responseText);},r.onerror=function(){i(r.status,r.responseText);},r.send();},AssetManager.downloadBinary=function(t,e,i){var r=new XMLHttpRequest();r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status?e(new Uint8Array(r.response)):i(r.status,r.responseText);},r.onerror=function(){i(r.status,r.responseText);},r.send();},AssetManager.prototype.loadBinary=function(i,e,r){var n=this;void 0===e&&(e=null),void 0===r&&(r=null),i=this.pathPrefix+i,this.toLoad++,AssetManager.downloadBinary(i,function(t){n.assets[i]=t,e&&e(i,t),n.toLoad--,n.loaded++;},function(t,e){n.errors[i]="Couldn't load binary "+i+": status "+status+", "+e,r&&r(i,"Couldn't load binary "+i+": status "+status+", "+e),n.toLoad--,n.loaded++;});},AssetManager.prototype.loadText=function(i,e,r){var n=this;void 0===e&&(e=null),void 0===r&&(r=null),i=this.pathPrefix+i,this.toLoad++,AssetManager.downloadText(i,function(t){n.assets[i]=t,e&&e(i,t),n.toLoad--,n.loaded++;},function(t,e){n.errors[i]="Couldn't load text "+i+": status "+status+", "+e,r&&r(i,"Couldn't load text "+i+": status "+status+", "+e),n.toLoad--,n.loaded++;});},AssetManager.prototype.loadTexture=function(i,r,e){var n=this;void 0===r&&(r=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++;var a=new Image();a.crossOrigin="anonymous",a.onload=function(t){var e=n.textureLoader(a);n.assets[i]=e,n.toLoad--,n.loaded++,r&&r(i,a);},a.onerror=function(t){n.errors[i]="Couldn't load image "+i,n.toLoad--,n.loaded++,e&&e(i,"Couldn't load image "+i);},a.src=i;},AssetManager.prototype.loadTextureData=function(i,t,r,e){var n=this;void 0===r&&(r=null),void 0===e&&(e=null),i=this.pathPrefix+i,this.toLoad++;var a=new Image();a.onload=function(t){var e=n.textureLoader(a);n.assets[i]=e,n.toLoad--,n.loaded++,r&&r(i,a);},a.onerror=function(t){n.errors[i]="Couldn't load image "+i,n.toLoad--,n.loaded++,e&&e(i,"Couldn't load image "+i);},a.src=t;},AssetManager.prototype.loadTextureAtlas=function(s,c,l){var h=this;void 0===c&&(c=null),void 0===l&&(l=null);var u=0<=s.lastIndexOf("/")?s.substring(0,s.lastIndexOf("/")):"";s=this.pathPrefix+s,this.toLoad++,AssetManager.downloadText(s,function(n){var a={count:0};var o=new Array();try{new _.TextureAtlas(n,function(t){o.push(u+"/"+t);t=document.createElement("img");return t.width=16,t.height=16,new _.FakeTexture(t);});}catch(t){var e=t;return h.errors[s]="Couldn't load texture atlas "+s+": "+e.message,l&&l(s,"Couldn't load texture atlas "+s+": "+e.message),h.toLoad--,void h.loaded++;}for(var t=0,i=o;t<i.length;t++)!function(t){var r=!1;h.loadTexture(t,function(e,t){if(a.count++,a.count==o.length)if(r)h.errors[s]="Couldn't load texture atlas page "+e+"} of atlas "+s,l&&l(s,"Couldn't load texture atlas page "+e+" of atlas "+s),h.toLoad--,h.loaded++;else try{var i=new _.TextureAtlas(n,function(t){return h.get(u+"/"+t);});h.assets[s]=i,c&&c(s,i),h.toLoad--,h.loaded++;}catch(t){e=t;h.errors[s]="Couldn't load texture atlas "+s+": "+e.message,l&&l(s,"Couldn't load texture atlas "+s+": "+e.message),h.toLoad--,h.loaded++;}},function(t,e){r=!0,a.count++,a.count==o.length&&(h.errors[s]="Couldn't load texture atlas page "+t+"} of atlas "+s,l&&l(s,"Couldn't load texture atlas page "+t+" of atlas "+s),h.toLoad--,h.loaded++);});}(i[t]);},function(t,e){h.errors[s]="Couldn't load texture atlas "+s+": status "+status+", "+e,l&&l(s,"Couldn't load texture atlas "+s+": status "+status+", "+e),h.toLoad--,h.loaded++;});},AssetManager.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t];},AssetManager.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null;},AssetManager.prototype.removeAll=function(){for(var t in this.assets){t=this.assets[t];t.dispose&&t.dispose();}this.assets={};},AssetManager.prototype.isLoadingComplete=function(){return 0==this.toLoad;},AssetManager.prototype.getToLoad=function(){return this.toLoad;},AssetManager.prototype.getLoaded=function(){return this.loaded;},AssetManager.prototype.dispose=function(){this.removeAll();},AssetManager.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length;},AssetManager.prototype.getErrors=function(){return this.errors;},_.AssetManager=AssetManager;}(r=r||{}),function(r){function AtlasAttachmentLoader(t){this.atlas=t;}AtlasAttachmentLoader.prototype.newRegionAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new r.RegionAttachment(e);return e.setRegion(i),e;},AtlasAttachmentLoader.prototype.newMeshAttachment=function(t,e,i){i=this.atlas.findRegion(i);if(null==i)return null;i.renderObject=i;e=new r.MeshAttachment(e);return e.region=i,e;},AtlasAttachmentLoader.prototype.newBoundingBoxAttachment=function(t,e){return new r.BoundingBoxAttachment(e);},AtlasAttachmentLoader.prototype.newPathAttachment=function(t,e){return new r.PathAttachment(e);},AtlasAttachmentLoader.prototype.newPointAttachment=function(t,e){return new r.PointAttachment(e);},AtlasAttachmentLoader.prototype.newClippingAttachment=function(t,e){return new r.ClippingAttachment(e);},r.AtlasAttachmentLoader=AtlasAttachmentLoader;}(r=r||{}),(t=(t=r=r||{}).BlendMode||(t.BlendMode={}))[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen",function(T){function Bone(t,e,i){if(this.children=new Array(),this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose();}Bone.prototype.isActive=function(){return this.active;},Bone.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY);},Bone.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY);},Bone.prototype.updateWorldTransformWith=function(h,u,t,e,i,r,_){this.ax=h,this.ay=u,this.arotation=t,this.ascaleX=e,this.ascaleY=i,this.ashearX=r,this.ashearY=_,this.appliedValid=!0;var d=this.parent;var f,p,m;if(null==d)return y=t+90+_,p=(f=this.skeleton).scaleX,m=f.scaleY,this.a=T.MathUtils.cosDeg(t+r)*e*p,this.b=T.MathUtils.cosDeg(y)*i*p,this.c=T.MathUtils.sinDeg(t+r)*e*m,this.d=T.MathUtils.sinDeg(y)*i*m,this.worldX=h*p+f.x,void(this.worldY=u*m+f.y);var n=d.a,a=d.b,o=d.c,v=d.d;switch(this.worldX=n*h+a*u+d.worldX,this.worldY=o*h+v*u+d.worldY,this.data.transformMode){case T.TransformMode.Normal:var y=t+90+_;var g=T.MathUtils.cosDeg(t+r)*e;var b=T.MathUtils.cosDeg(y)*i;var C=T.MathUtils.sinDeg(t+r)*e;var x=T.MathUtils.sinDeg(y)*i;return this.a=n*g+a*C,this.b=n*b+a*x,this.c=o*g+v*C,void(this.d=o*b+v*x);case T.TransformMode.OnlyTranslation:y=t+90+_;this.a=T.MathUtils.cosDeg(t+r)*e,this.b=T.MathUtils.cosDeg(y)*i,this.c=T.MathUtils.sinDeg(t+r)*e,this.d=T.MathUtils.sinDeg(y)*i;break;case T.TransformMode.NoRotationOrReflection:var s=0;var c=t+r-(s=1e-4<(l=n*n+o*o)?(a=o*(l=Math.abs(n*v-a*o)/l),v=n*l,Math.atan2(o,n)*T.MathUtils.radDeg):(o=n=0,90-Math.atan2(v,a)*T.MathUtils.radDeg));s=t+_-s+90;g=T.MathUtils.cosDeg(c)*e;b=T.MathUtils.cosDeg(s)*i;C=T.MathUtils.sinDeg(c)*e;x=T.MathUtils.sinDeg(s)*i;this.a=n*g-a*C,this.b=n*b-a*x,this.c=o*g+v*C,this.d=o*b+v*x;break;case T.TransformMode.NoScale:case T.TransformMode.NoScaleOrReflection:c=T.MathUtils.cosDeg(t);s=T.MathUtils.sinDeg(t);var A=(n*c+a*s)/this.skeleton.scaleX;c=(o*c+v*s)/this.skeleton.scaleY;var l;A*=l=1e-5<(l=Math.sqrt(A*A+c*c))?1/l:l,c*=l,l=Math.sqrt(A*A+c*c),this.data.transformMode==T.TransformMode.NoScale&&n*v-a*o<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(l=-l);s=Math.PI/2+Math.atan2(c,A);var S=Math.cos(s)*l;s=Math.sin(s)*l;g=T.MathUtils.cosDeg(r)*e;b=T.MathUtils.cosDeg(90+_)*i;C=T.MathUtils.sinDeg(r)*e;x=T.MathUtils.sinDeg(90+_)*i;this.a=A*g+S*C,this.b=A*b+S*x,this.c=c*g+s*C,this.d=c*b+s*x;}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY;},Bone.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY;},Bone.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*T.MathUtils.radDeg;},Bone.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*T.MathUtils.radDeg;},Bone.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c);},Bone.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d);},Bone.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*T.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*T.MathUtils.radDeg);var e=t.a,i=t.b,r=t.c,n=t.d;var a=1/(e*n-i*r);var o=this.worldX-t.worldX,t=this.worldY-t.worldY;this.ax=o*n*a-t*i*a,this.ay=t*e*a-o*r*a;t=a*n;o=a*e;n=a*i;e=a*r;i=t*this.a-n*this.c;a=t*this.b-n*this.d;r=o*this.c-e*this.a;t=o*this.d-e*this.b;this.ashearX=0,this.ascaleX=Math.sqrt(i*i+r*r),1e-4<this.ascaleX?(this.ascaleY=(n=i*t-a*r)/this.ascaleX,this.ashearY=Math.atan2(i*a+r*t,n)*T.MathUtils.radDeg,this.arotation=Math.atan2(r,i)*T.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(a*a+t*t),this.ashearY=0,this.arotation=90-Math.atan2(t,a)*T.MathUtils.radDeg);},Bone.prototype.worldToLocal=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;var a=1/(e*n-i*r);var o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*n*a-s*i*a,t.y=s*e*a-o*r*a,t;},Bone.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t;},Bone.prototype.worldToLocalRotation=function(t){var e=T.MathUtils.sinDeg(t),t=T.MathUtils.cosDeg(t);return Math.atan2(this.a*e-this.c*t,this.d*t-this.b*e)*T.MathUtils.radDeg+this.rotation-this.shearX;},Bone.prototype.localToWorldRotation=function(t){t-=this.rotation-this.shearX;var e=T.MathUtils.sinDeg(t),t=T.MathUtils.cosDeg(t);return Math.atan2(t*this.c+e*this.d,t*this.a+e*this.b)*T.MathUtils.radDeg;},Bone.prototype.rotateWorld=function(t){var e=this.a,i=this.b,r=this.c,n=this.d;var a=T.MathUtils.cosDeg(t),t=T.MathUtils.sinDeg(t);this.a=a*e-t*r,this.b=a*i-t*n,this.c=t*e+a*r,this.d=t*i+a*n,this.appliedValid=!1;},T.Bone=Bone;}(r=r||{}),(c=r=r||{}).BoneData=function(t,e,i){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=l.Normal,this.skinRequired=!1,this.color=new c.Color(),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=i;},(t=l=c.TransformMode||(c.TransformMode={}))[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",(r||(r={})).ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i;},(r||(r={})).Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e;},(r||(r={})).EventData=function(t){this.name=t;},function(Y){function IkConstraint(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array();for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name);}IkConstraint.prototype.isActive=function(){return this.active;},IkConstraint.prototype.apply=function(){this.update();},IkConstraint.prototype.update=function(){var t=this.target;var e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix);}},IkConstraint.prototype.apply1=function(t,e,i,r,n,h,a){t.appliedValid||t.updateAppliedTransform();var o=t.parent;var s=1/(o.a*o.d-o.b*o.c);e-=o.worldX,i-=o.worldY;var c=(e*o.d-i*o.b)*s-t.ax,i=(i*o.a-e*o.c)*s-t.ay;e=Math.atan2(i,c)*Y.MathUtils.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(e+=180),180<e?e-=360:e<-180&&(e+=360);o=t.ascaleX,s=t.ascaleY;var l;(r||n)&&(l=t.data.length*o,c=Math.sqrt(c*c+i*i),(r&&c<l||n&&l<c&&1e-4<l)&&(o*=i=(c/l-1)*a+1,h&&(s*=i))),t.updateWorldTransformWith(t.ax,t.ay,t.arotation+e*a,o,s,t.ashearX,t.ashearY);},IkConstraint.prototype.apply2=function(t,e,h,u,_,d,f,p){if(0!=p){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var m=t.ax,v=t.ay,y=t.ascaleX,g=y,b=t.ascaleY,C=e.ascaleX;var x=0,A=0,S=0;S=y<0?(y=-y,x=180,-1):(x=0,1),b<0&&(b=-b,S=-S),A=C<0?(C=-C,180):0;var T=e.ax,w=0,E=0,P=0,i=t.a,r=t.b,n=t.c,M=t.d;var R=Math.abs(y-b)<=1e-4;P=R?(E=i*T+r*(w=e.ay)+t.worldX,n*T+M*w+t.worldY):(w=0,E=i*T+t.worldX,n*T+t.worldY);var a=t.parent;i=a.a,r=a.b,n=a.c;var I=1/(i*(M=a.d)-r*n),B=E-a.worldX,o=P-a.worldY;E=(B*M-o*r)*I-m,P=(o*i-B*n)*I-v;var D,L,s=Math.sqrt(E*E+P*P),V=e.data.length*C;if(s<1e-4)return this.apply1(t,h,u,!1,d,!1,p),void e.updateWorldTransformWith(T,w,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var O=((B=h-a.worldX)*M-(o=u-a.worldY)*r)*I-m,F=(o*i-B*n)*I-v;var N=O*O+F*F;0!=f&&(f*=y*(C+1)/2,0<(P=(E=Math.sqrt(N))-s-V*y+f)&&(N=(O-=(h=(P-f*(1-(h=Math.min(1,P/(2*f))-1)*h))/E)*O)*O+(F-=h*F)*F));t:if(R){var c=(N-s*s-(V*=y)*V)/(2*s*V);c<-1?c=-1:1<c&&(c=1,d&&(g*=(Math.sqrt(N)/(s+V)-1)*p+1)),L=Math.acos(c)*_,i=s+V*c,r=V*Math.sin(L),D=Math.atan2(F*i-O*r,O*i+F*r);}else{var k=(i=y*V)*i,G=(r=b*V)*r,z=Math.atan2(F,O);var c=-2*G*s,U=G-k;if(0<=(M=c*c-4*U*(n=G*s*s+k*N-k*G))){var l=Math.sqrt(M);c=(l=-(c+(l=c<0?-l:l))/2)/U,U=n/l;l=Math.abs(c)<Math.abs(U)?c:U;if(l*l<=N){o=Math.sqrt(N-l*l)*_,D=z-Math.atan2(o,l),L=Math.atan2(o/b,(l-s)/y);break t;}}var c=Y.MathUtils.PI,U=s-i,l=U*U,W=0;var H=0,j=s+i,X=j*j,q=0;-1<=(n=-i*s/(k-G))&&n<=1&&(n=Math.acos(n),(M=(B=i*Math.cos(n)+s)*B+(o=r*Math.sin(n))*o)<l&&(c=n,l=M,U=B,W=o),X<M&&(H=n,X=M,j=B,q=o)),L=N<=(l+X)/2?(D=z-Math.atan2(W*_,U),c*_):(D=z-Math.atan2(q*_,j),H*_);}u=Math.atan2(w,T)*S;a=t.arotation;180<(D=(D-u)*Y.MathUtils.radDeg+x-a)?D-=360:D<-180&&(D+=360),t.updateWorldTransformWith(m,v,a+D*p,g,t.ascaleY,0,0),a=e.arotation,180<(L=((L+u)*Y.MathUtils.radDeg-e.ashearX)*S+A-a)?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(T,w,a+L*p,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);}else e.updateWorldTransform();},Y.IkConstraint=IkConstraint;}(r=r||{}),t=r=r||{},h=t.ConstraintData,y(IkConstraintData,h),t.IkConstraintData=IkConstraintData,function(Y){function PathConstraint(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array(),this.positions=new Array(),this.world=new Array(),this.curves=new Array(),this.lengths=new Array(),this.segments=new Array(),this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array();for(var i=0,r=t.bones.length;i<r;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix;}PathConstraint.prototype.isActive=function(){return this.active;},PathConstraint.prototype.apply=function(){this.update();},PathConstraint.prototype.update=function(){var h=this.target.getAttachment();if(h instanceof Y.PathAttachment){var u=this.rotateMix,_=this.translateMix;var d=0<u;if(0<_||d){var f=this.data;var p=f.spacingMode==Y.SpacingMode.Percent;var m=f.rotateMode;var v=m==Y.RotateMode.Tangent,y=m==Y.RotateMode.ChainScale;var g=this.bones.length,b=v?g:g+1;var C=this.bones;var x=Y.Utils.setArraySize(this.spaces,b),A=null;var S=this.spacing;if(y||!p){y&&(A=Y.Utils.setArraySize(this.lengths,g));var T=f.spacingMode==Y.SpacingMode.Length;for(var t=0,w=b-1;t<w;){var e=(r=C[t]).data.length;var E;e<PathConstraint.epsilon?(y&&(A[t]=0),x[++t]=0):p?(y&&(n=e*r.a,a=e*r.c,E=Math.sqrt(n*n+a*a),A[t]=E),x[++t]=S):(n=e*r.a,a=e*r.c,E=Math.sqrt(n*n+a*a),y&&(A[t]=E),x[++t]=(T?e+S:S)*E/e);}}else for(t=1;t<b;t++)x[t]=S;var P=this.computeWorldPositions(h,b,v,f.positionMode==Y.PositionMode.Percent,p);var M=P[0],R=P[1],I=f.offsetRotation;var B=!1;0==I?B=m==Y.RotateMode.Chain:(B=!1,I*=0<(i=this.target.bone).a*i.d-i.b*i.c?Y.MathUtils.degRad:-Y.MathUtils.degRad);for(var t=0,i=3;t<g;t++,i+=3){var r;(r=C[t]).worldX+=(M-r.worldX)*_,r.worldY+=(R-r.worldY)*_;var n,a,D=(n=P[i])-M,L=(a=P[i+1])-R;var o,V,O,F,s,c,l,N;!y||0!=(o=A[t])&&(o=(Math.sqrt(D*D+L*L)/o-1)*u+1,r.a*=o,r.c*=o),M=n,R=a,d&&(o=r.a,V=r.b,O=r.c,F=r.d,l=c=s=0,s=v?P[i-1]:0==x[t+1]?P[i+2]:Math.atan2(L,D),s-=Math.atan2(O,o),B?(c=Math.cos(s),l=Math.sin(s),M+=((N=r.data.length)*(c*o-l*O)-D)*u,R+=(N*(l*o+c*O)-L)*u):s+=I,s>Y.MathUtils.PI?s-=Y.MathUtils.PI2:s<-Y.MathUtils.PI&&(s+=Y.MathUtils.PI2),s*=u,c=Math.cos(s),l=Math.sin(s),r.a=c*o-l*O,r.b=c*V-l*F,r.c=l*o+c*O,r.d=l*V+c*F),r.appliedValid=!1;}}}},PathConstraint.prototype.computeWorldPositions=function(t,h,u,_,d){var f=this.target;var p=this.position;var m=this.spaces,v=Y.Utils.setArraySize(this.positions,3*h+2),e=null;var y=t.closed;var i=t.worldVerticesLength,g=i/6,b=PathConstraint.NONE;if(!t.constantSpeed){var C=t.lengths;var x=C[g-=y?1:2];if(_&&(p*=x),d)for(var r=1;r<h;r++)m[r]*=x;e=Y.Utils.setArraySize(this.world,8);for(var r=0,A=0,n=0;r<h;r++,A+=3){var a=p+=H=m[r];if(y)(a%=x)<0&&(a+=x),n=0;else{if(a<0){b!=PathConstraint.BEFORE&&(b=PathConstraint.BEFORE,t.computeWorldVertices(f,2,4,e,0,2)),this.addBeforePosition(a,e,0,v,A);continue;}if(x<a){b!=PathConstraint.AFTER&&(b=PathConstraint.AFTER,t.computeWorldVertices(f,i-6,4,e,0,2)),this.addAfterPosition(a-x,e,0,v,A);continue;}}for(;;n++){var S=C[n];if(!(S<a)){0==n?a/=S:a=(a-(q=C[n-1]))/(S-q);break;}}n!=b&&(b=n,y&&n==g?(t.computeWorldVertices(f,i-4,4,e,0,2),t.computeWorldVertices(f,0,4,e,4,2)):t.computeWorldVertices(f,6*n+2,8,e,0,2)),this.addCurvePosition(a,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],v,A,u||0<r&&0==H);}return v;}y?(e=Y.Utils.setArraySize(this.world,i+=2),t.computeWorldVertices(f,2,i-4,e,0,2),t.computeWorldVertices(f,0,2,e,i-4,2),e[i-2]=e[0],e[i-1]=e[1]):(g--,e=Y.Utils.setArraySize(this.world,i-=4),t.computeWorldVertices(f,2,i,e,0,2));var T=Y.Utils.setArraySize(this.curves,g);var o=0;var w=e[0],E=e[1],P=0,M=0,R=0,I=0,B=0,D=0;var L=0,V=0,O=0,F=0,N=0,k=0,s=0,c=0;for(var r=0,G=2;r<g;r++,G+=6)P=e[G],M=e[G+1],R=e[G+2],I=e[G+3],N=2*(L=.1875*(w-2*P+R))+(O=.09375*(3*(P-R)-w+(B=e[G+4]))),k=2*(V=.1875*(E-2*M+I))+(F=.09375*(3*(M-I)-E+(D=e[G+5]))),s=.75*(P-w)+L+.16666667*O,c=.75*(M-E)+V+.16666667*F,o+=Math.sqrt(s*s+c*c),s+=N,c+=k,N+=O,k+=F,o+=Math.sqrt(s*s+c*c),s+=N,c+=k,o+=Math.sqrt(s*s+c*c),s+=N+O,c+=k+F,o+=Math.sqrt(s*s+c*c),T[r]=o,w=B,E=D;if(p*=_?o:o/t.lengths[g-1],d)for(r=1;r<h;r++)m[r]*=o;var z=this.segments;var U=0;for(var r=0,A=0,n=0,W=0;r<h;r++,A+=3){var H;a=p+=H=m[r];if(y)(a%=o)<0&&(a+=o),n=0;else{if(a<0){this.addBeforePosition(a,e,0,v,A);continue;}if(o<a){this.addAfterPosition(a-o,e,i-4,v,A);continue;}}for(;;n++){var j=T[n];if(!(j<a)){0==n?a/=j:a=(a-(q=T[n-1]))/(j-q);break;}}if(n!=b){var l=6*(b=n);for(w=e[l],E=e[l+1],P=e[l+2],M=e[l+3],R=e[l+4],I=e[l+5],N=2*(L=.03*(w-2*P+R))+(O=.006*(3*(P-R)-w+(B=e[l+6]))),k=2*(V=.03*(E-2*M+I))+(F=.006*(3*(M-I)-E+(D=e[l+7]))),s=.3*(P-w)+L+.16666667*O,c=.3*(M-E)+V+.16666667*F,U=Math.sqrt(s*s+c*c),z[0]=U,l=1;l<8;l++)s+=N,c+=k,N+=O,k+=F,U+=Math.sqrt(s*s+c*c),z[l]=U;s+=N,c+=k,U+=Math.sqrt(s*s+c*c),z[8]=U,s+=N+O,c+=k+F,U+=Math.sqrt(s*s+c*c),z[9]=U,W=0;}for(a*=U;;W++){var X=z[W];if(!(X<a)){var q;0==W?a/=X:a=W+(a-(q=z[W-1]))/(X-q);break;}}this.addCurvePosition(.1*a,w,E,P,M,R,I,B,D,v,A,u||0<r&&0==H);}return v;},PathConstraint.prototype.addBeforePosition=function(t,e,i,r,n){var a=e[i],o=e[i+1],s=e[i+2]-a,e=e[i+3]-o,i=Math.atan2(e,s);r[n]=a+t*Math.cos(i),r[n+1]=o+t*Math.sin(i),r[n+2]=i;},PathConstraint.prototype.addAfterPosition=function(t,e,i,r,n){var a=e[i+2],o=e[i+3],s=a-e[i],e=o-e[i+1],i=Math.atan2(e,s);r[n]=a+t*Math.cos(i),r[n+1]=o+t*Math.sin(i),r[n+2]=i;},PathConstraint.prototype.addCurvePosition=function(t,e,i,r,n,h,u,a,_,o,s,d){if(0==t||isNaN(t))return o[s]=e,o[s+1]=i,void(o[s+2]=Math.atan2(n-i,r-e));var f=t*t,p=f*t,c=1-t,m=c*c,l=m*c;var v=c*t,y=3*v,c=c*y,y=y*t;a=e*l+r*c+h*y+a*p,l=i*l+n*c+u*y+_*p;o[s]=a,o[s+1]=l,d&&(o[s+2]=t<.001?Math.atan2(n-i,r-e):Math.atan2(l-(i*m+n*v*2+u*f),a-(e*m+r*v*2+h*f)));},PathConstraint.NONE=-1,PathConstraint.BEFORE=-2,PathConstraint.AFTER=-3,PathConstraint.epsilon=1e-5,Y.PathConstraint=PathConstraint;}(r=r||{}),t=r=r||{},_=t.ConstraintData,y(PathConstraintData,_),e=PathConstraintData,t.PathConstraintData=e,(e=t.PositionMode||(t.PositionMode={}))[e.Fixed=0]="Fixed",e[e.Percent=1]="Percent",(e=t.SpacingMode||(t.SpacingMode={}))[e.Length=0]="Length",e[e.Fixed=1]="Fixed",e[e.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale",function(t){Assets.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t;};var n=Assets;function Assets(t){this.toLoad=new Array(),this.assets={},this.clientId=t;}function SharedAssetManager(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t;}SharedAssetManager.prototype.queueAsset=function(t,e,i){var r=this.clientAssets[t];return null==r&&(r=new n(t),this.clientAssets[t]=r),null!==e&&(r.textureLoader=e),r.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0);},SharedAssetManager.prototype.loadText=function(t,e){var i=this;var r;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((r=new XMLHttpRequest()).onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200<=r.status&&r.status<300?i.rawAssets[e]=r.responseText:i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText);},r.open("GET",e,!0),r.send());},SharedAssetManager.prototype.loadJson=function(t,e){var i=this;var r;e=this.pathPrefix+e,this.queueAsset(t,null,e)&&((r=new XMLHttpRequest()).onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200<=r.status&&r.status<300?i.rawAssets[e]=JSON.parse(r.responseText):i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText);},r.open("GET",e,!0),r.send());},SharedAssetManager.prototype.loadTexture=function(t,e,i){var r=this;var n;i=this.pathPrefix+i,this.queueAsset(t,e,i)&&((n=new Image()).src=i,n.crossOrigin="anonymous",n.onload=function(t){r.rawAssets[i]=n;},n.onerror=function(t){r.errors[i]="Couldn't load image "+i;});},SharedAssetManager.prototype.get=function(t,e){e=this.pathPrefix+e;t=this.clientAssets[t];return null==t||t.assets[e];},SharedAssetManager.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e];var r=t.assets[i];null!=r||null!=(r=this.rawAssets[i])&&(r instanceof HTMLImageElement?t.assets[i]=t.textureLoader(r):t.assets[i]=r);}},SharedAssetManager.prototype.isLoadingComplete=function(t){t=this.clientAssets[t];return null==t||(this.updateClientAssets(t),t.toLoad.length==t.loaded());},SharedAssetManager.prototype.dispose=function(){},SharedAssetManager.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length;},SharedAssetManager.prototype.getErrors=function(){return this.errors;},t.SharedAssetManager=SharedAssetManager;}(r=r||{}),function(y){function Skeleton(t){if(this._updateCache=new Array(),this.updateCacheReset=new Array(),this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array();for(var e=0;e<t.bones.length;e++){var i=t.bones[e];var r=void 0;var n;null==i.parent?r=new y.Bone(i,this,null):(n=this.bones[i.parent.index],r=new y.Bone(i,this,n),n.children.push(r)),this.bones.push(r);}this.slots=new Array(),this.drawOrder=new Array();for(e=0;e<t.slots.length;e++){var a=t.slots[e];r=this.bones[a.boneData.index];a=new y.Slot(a,r);this.slots.push(a),this.drawOrder.push(a);}this.ikConstraints=new Array();for(e=0;e<t.ikConstraints.length;e++){var o=t.ikConstraints[e];this.ikConstraints.push(new y.IkConstraint(o,this));}this.transformConstraints=new Array();for(e=0;e<t.transformConstraints.length;e++){var s=t.transformConstraints[e];this.transformConstraints.push(new y.TransformConstraint(s,this));}this.pathConstraints=new Array();for(e=0;e<t.pathConstraints.length;e++){var c=t.pathConstraints[e];this.pathConstraints.push(new y.PathConstraint(c,this));}this.color=new y.Color(1,1,1,1),this.updateCache();}Skeleton.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;var t=this.bones;for(var e=0,i=t.length;e<i;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin){var h=this.skin.bones;for(e=0,i=this.skin.bones.length;e<i;e++){var r=this.bones[h[e].index];for(;r.sorted=!1,r.active=!0,null!=(r=r.parent););}}var n=this.ikConstraints;var a=this.transformConstraints;var o=this.pathConstraints;var s=n.length,u=a.length,_=o.length;var d=s+u+_;t:for(e=0;e<d;e++){for(var c=0;c<s;c++)if((l=n[c]).data.order==e){this.sortIkConstraint(l);continue t;}for(c=0;c<u;c++)if((l=a[c]).data.order==e){this.sortTransformConstraint(l);continue t;}for(c=0;c<_;c++){var l;if((l=o[c]).data.order==e){this.sortPathConstraint(l);continue t;}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e]);},Skeleton.prototype.sortIkConstraint=function(t){var e,i,r;t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&y.Utils.contains(this.skin.constraints,t.data,!0)),t.active&&(e=t.target,this.sortBone(e),i=(e=t.bones)[0],this.sortBone(i),1<e.length&&(r=e[e.length-1],-1<this._updateCache.indexOf(r)||this.updateCacheReset.push(r)),this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0);},Skeleton.prototype.sortPathConstraint=function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&y.Utils.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;var i=e.data.index;var r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,r);for(var n=0,a=this.data.skins.length;n<a;n++)this.sortPathConstraintAttachment(this.data.skins[n],i,r);e=e.getAttachment();e instanceof y.PathAttachment&&this.sortPathConstraintAttachmentWith(e,r);var o=t.bones;var s=o.length;for(n=0;n<s;n++)this.sortBone(o[n]);this._updateCache.push(t);for(n=0;n<s;n++)this.sortReset(o[n].children);for(n=0;n<s;n++)o[n].sorted=!0;}},Skeleton.prototype.sortTransformConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&y.Utils.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones;var i=e.length;if(t.data.local)for(var r=0;r<i;r++){var n=e[r];this.sortBone(n.parent),-1<this._updateCache.indexOf(n)||this.updateCacheReset.push(n);}else for(r=0;r<i;r++)this.sortBone(e[r]);this._updateCache.push(t);for(var a=0;a<i;a++)this.sortReset(e[a].children);for(a=0;a<i;a++)e[a].sorted=!0;}},Skeleton.prototype.sortPathConstraintAttachment=function(t,e,i){var r=t.attachments[e];if(r)for(var n in r)this.sortPathConstraintAttachmentWith(r[n],i);},Skeleton.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof y.PathAttachment){var i=t.bones;if(null==i)this.sortBone(e);else{var r=this.bones;var n=0;for(;n<i.length;){var a=i[n++];for(var o=n+a;n<o;n++){var s=i[n];this.sortBone(r[s]);}}}}},Skeleton.prototype.sortBone=function(t){var e;t.sorted||(null!=(e=t.parent)&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t));},Skeleton.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1);}},Skeleton.prototype.updateWorldTransform=function(){var t=this.updateCacheReset;for(var e=0,i=t.length;e<i;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0;}var n=this._updateCache;for(e=0,i=n.length;e<i;e++)n[e].update();},Skeleton.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose();},Skeleton.prototype.setBonesToSetupPose=function(){var t=this.bones;for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,i=r.length;e<i;e++)(s=r[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;var n=this.transformConstraints;for(e=0,i=n.length;e<i;e++){var a=(s=n[e]).data;s.rotateMix=a.rotateMix,s.translateMix=a.translateMix,s.scaleMix=a.scaleMix,s.shearMix=a.shearMix;}var o=this.pathConstraints;for(e=0,i=o.length;e<i;e++){var s;a=(s=o[e]).data;s.position=a.position,s.spacing=a.spacing,s.rotateMix=a.rotateMix,s.translateMix=a.translateMix;}},Skeleton.prototype.setSlotsToSetupPose=function(){var t=this.slots;y.Utils.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,i=t.length;e<i;e++)t[e].setToSetupPose();},Skeleton.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0];},Skeleton.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");var e=this.bones;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n;}return null;},Skeleton.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");var e=this.bones;for(var i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1;},Skeleton.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");var e=this.slots;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n;}return null;},Skeleton.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");var e=this.slots;for(var i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1;},Skeleton.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e);},Skeleton.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{var e=this.slots;for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=n.data.attachmentName;null==a||null!=(a=t.getAttachment(i,a))&&n.setAttachment(a);}}this.skin=t,this.updateCache();}},Skeleton.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e);},Skeleton.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i;}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null;},Skeleton.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");var i=this.slots;for(var r=0,n=i.length;r<n;r++){var a=i[r];if(a.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void a.setAttachment(o);}}throw new Error("Slot not found: "+t);},Skeleton.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.ikConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n;}return null;},Skeleton.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.transformConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n;}return null;},Skeleton.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.pathConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n;}return null;},Skeleton.prototype.getBounds=function(h,u,t){if(void 0===t&&(t=new Array(2)),null==h)throw new Error("offset cannot be null.");if(null==u)throw new Error("size cannot be null.");var _=this.drawOrder;var e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(var d=0,f=_.length;d<f;d++){var a=_[d];if(a.bone.active){var o=0;var s=null;var c=a.getAttachment();if(c instanceof y.RegionAttachment?(s=y.Utils.setArraySize(t,o=8,0),c.computeWorldVertices(a.bone,s,0,2)):c instanceof y.MeshAttachment&&(o=(c=c).worldVerticesLength,s=y.Utils.setArraySize(t,o,0),c.computeWorldVertices(a,0,o,s,0,2)),null!=s)for(var l=0,p=s.length;l<p;l+=2){var m=s[l],v=s[l+1];e=Math.min(e,m),i=Math.min(i,v),r=Math.max(r,m),n=Math.max(n,v);}}}h.set(e,i),u.set(r-e,n-i);},Skeleton.prototype.update=function(t){this.time+=t;},y.Skeleton=Skeleton;}(r=r||{});var H=r=r||{};function SkeletonBinary(t){this.scale=1,this.linkedMeshes=new Array(),this.attachmentLoader=t;}SkeletonBinary.prototype.readSkeletonData=function(h){var t=this.scale;var e=new H.SkeletonData();e.name="";var i=new m(h);e.hash=i.readString(),e.version=i.readString(),e.x=i.readFloat(),e.y=i.readFloat(),e.width=i.readFloat(),e.height=i.readFloat();var u=i.readBoolean();u&&(e.fps=i.readFloat(),e.imagesPath=i.readString(),e.audioPath=i.readString());var r=0;r=i.readInt(!0);for(var n=0;n<r;n++)i.strings.push(i.readString());r=i.readInt(!0);for(n=0;n<r;n++){var _=i.readString();var d=0==n?null:e.bones[i.readInt(!0)];(a=new H.BoneData(n,_,d)).rotation=i.readFloat(),a.x=i.readFloat()*t,a.y=i.readFloat()*t,a.scaleX=i.readFloat(),a.scaleY=i.readFloat(),a.shearX=i.readFloat(),a.shearY=i.readFloat(),a.length=i.readFloat()*t,a.transformMode=SkeletonBinary.TransformModeValues[i.readInt(!0)],a.skinRequired=i.readBoolean(),u&&H.Color.rgba8888ToColor(a.color,i.readInt32()),e.bones.push(a);}r=i.readInt(!0);for(n=0;n<r;n++){var f=i.readString();var p=e.bones[i.readInt(!0)];var a=new H.SlotData(n,f,p);H.Color.rgba8888ToColor(a.color,i.readInt32());f=i.readInt32();-1!=f&&H.Color.rgb888ToColor(a.darkColor=new H.Color(),f),a.attachmentName=i.readStringRef(),a.blendMode=SkeletonBinary.BlendModeValues[i.readInt(!0)],e.slots.push(a);}r=i.readInt(!0);for(var n=0,o=void 0;n<r;n++){(a=new H.IkConstraintData(i.readString())).order=i.readInt(!0),a.skinRequired=i.readBoolean(),o=i.readInt(!0);for(var s=0;s<o;s++)a.bones.push(e.bones[i.readInt(!0)]);a.target=e.bones[i.readInt(!0)],a.mix=i.readFloat(),a.softness=i.readFloat()*t,a.bendDirection=i.readByte(),a.compress=i.readBoolean(),a.stretch=i.readBoolean(),a.uniform=i.readBoolean(),e.ikConstraints.push(a);}r=i.readInt(!0);for(n=0,o=void 0;n<r;n++){(a=new H.TransformConstraintData(i.readString())).order=i.readInt(!0),a.skinRequired=i.readBoolean(),o=i.readInt(!0);for(s=0;s<o;s++)a.bones.push(e.bones[i.readInt(!0)]);a.target=e.bones[i.readInt(!0)],a.local=i.readBoolean(),a.relative=i.readBoolean(),a.offsetRotation=i.readFloat(),a.offsetX=i.readFloat()*t,a.offsetY=i.readFloat()*t,a.offsetScaleX=i.readFloat(),a.offsetScaleY=i.readFloat(),a.offsetShearY=i.readFloat(),a.rotateMix=i.readFloat(),a.translateMix=i.readFloat(),a.scaleMix=i.readFloat(),a.shearMix=i.readFloat(),e.transformConstraints.push(a);}r=i.readInt(!0);for(n=0,o=void 0;n<r;n++){(a=new H.PathConstraintData(i.readString())).order=i.readInt(!0),a.skinRequired=i.readBoolean(),o=i.readInt(!0);for(s=0;s<o;s++)a.bones.push(e.bones[i.readInt(!0)]);a.target=e.slots[i.readInt(!0)],a.positionMode=SkeletonBinary.PositionModeValues[i.readInt(!0)],a.spacingMode=SkeletonBinary.SpacingModeValues[i.readInt(!0)],a.rotateMode=SkeletonBinary.RotateModeValues[i.readInt(!0)],a.offsetRotation=i.readFloat(),a.position=i.readFloat(),a.positionMode==H.PositionMode.Fixed&&(a.position*=t),a.spacing=i.readFloat(),a.spacingMode!=H.SpacingMode.Length&&a.spacingMode!=H.SpacingMode.Fixed||(a.spacing*=t),a.rotateMix=i.readFloat(),a.translateMix=i.readFloat(),e.pathConstraints.push(a);}h=this.readSkin(i,e,!0,u);null!=h&&(e.defaultSkin=h,e.skins.push(h));n=e.skins.length;for(H.Utils.setArraySize(e.skins,r=n+i.readInt(!0));n<r;n++)e.skins[n]=this.readSkin(i,e,!1,u);r=this.linkedMeshes.length;for(n=0;n<r;n++){var c=this.linkedMeshes[n];var l=null==c.skin?e.defaultSkin:e.findSkin(c.skin);if(null==l)throw new Error("Skin not found: "+c.skin);l=l.getAttachment(c.slotIndex,c.parent);if(null==l)throw new Error("Parent mesh not found: "+c.parent);c.mesh.deformAttachment=c.inheritDeform?l:c.mesh,c.mesh.setParentMesh(l),c.mesh.updateUVs();}this.linkedMeshes.length=0,r=i.readInt(!0);for(n=0;n<r;n++)(a=new H.EventData(i.readStringRef())).intValue=i.readInt(!1),a.floatValue=i.readFloat(),a.stringValue=i.readString(),a.audioPath=i.readString(),null!=a.audioPath&&(a.volume=i.readFloat(),a.balance=i.readFloat()),e.events.push(a);r=i.readInt(!0);for(n=0;n<r;n++)e.animations.push(this.readAnimation(i,i.readString(),e));return e;},SkeletonBinary.prototype.readSkin=function(t,e,h,u){var i=null;var r=0;if(h){if(0==(r=t.readInt(!0)))return null;i=new H.Skin("default");}else{(i=new H.Skin(t.readStringRef())).bones.length=t.readInt(!0);for(var n=0,a=i.bones.length;n<a;n++)i.bones[n]=e.bones[t.readInt(!0)];for(n=0,a=t.readInt(!0);n<a;n++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(n=0,a=t.readInt(!0);n<a;n++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(n=0,a=t.readInt(!0);n<a;n++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);r=t.readInt(!0);}for(n=0;n<r;n++){var o=t.readInt(!0);for(var s=0,_=t.readInt(!0);s<_;s++){var c=t.readStringRef();var l=this.readAttachment(t,e,i,o,c,u);null!=l&&i.setAttachment(o,c,l);}}return i;},SkeletonBinary.prototype.readAttachment=function(t,h,u,_,d,e){var f=this.scale;var i=t.readStringRef();null==i&&(i=d);d=t.readByte();switch(SkeletonBinary.AttachmentTypeValues[d]){case H.AttachmentType.Region:var r=t.readStringRef();var p=t.readFloat();var m=t.readFloat();var v=t.readFloat();var y=t.readFloat();var n=t.readFloat();var g=t.readFloat();var a=t.readFloat();var o=t.readInt32();null==r&&(r=i);var s=this.attachmentLoader.newRegionAttachment(u,i,r);return null==s?null:(s.path=r,s.x=m*f,s.y=v*f,s.scaleX=y,s.scaleY=n,s.rotation=p,s.width=g*f,s.height=a*f,H.Color.rgba8888ToColor(s.color,o),s.updateOffset(),s);case H.AttachmentType.BoundingBox:var c=t.readInt(!0);var b=this.readVertices(t,c);o=e?t.readInt32():0;y=this.attachmentLoader.newBoundingBoxAttachment(u,i);return null==y?null:(y.worldVerticesLength=c<<1,y.vertices=b.vertices,y.bones=b.bones,e&&H.Color.rgba8888ToColor(y.color,o),y);case H.AttachmentType.Mesh:r=t.readStringRef();o=t.readInt32();c=t.readInt(!0);n=this.readFloatArray(t,c<<1,1);s=this.readShortArray(t);b=this.readVertices(t,c);y=t.readInt(!0);var C=null;g=0,a=0;return e&&(C=this.readShortArray(t),g=t.readFloat(),a=t.readFloat()),null==r&&(r=i),null==(l=this.attachmentLoader.newMeshAttachment(u,i,r))?null:(l.path=r,H.Color.rgba8888ToColor(l.color,o),l.bones=b.bones,l.vertices=b.vertices,l.worldVerticesLength=c<<1,l.triangles=s,l.regionUVs=n,l.updateUVs(),l.hullLength=y<<1,e&&(l.edges=C,l.width=g*f,l.height=a*f),l);case H.AttachmentType.LinkedMesh:r=t.readStringRef();o=t.readInt32();s=t.readStringRef();n=t.readStringRef();y=t.readBoolean();g=0,a=0;var l;return e&&(g=t.readFloat(),a=t.readFloat()),null==r&&(r=i),null==(l=this.attachmentLoader.newMeshAttachment(u,i,r))?null:(l.path=r,H.Color.rgba8888ToColor(l.color,o),e&&(l.width=g*f,l.height=a*f),this.linkedMeshes.push(new T(l,s,_,n,y)),l);case H.AttachmentType.Path:C=t.readBoolean();g=t.readBoolean();c=t.readInt(!0);b=this.readVertices(t,c);var x=H.Utils.newArray(c/3,0);for(var A=0,S=x.length;A<S;A++)x[A]=t.readFloat()*f;o=e?t.readInt32():0;return null==(r=this.attachmentLoader.newPathAttachment(u,i))?null:(r.closed=C,r.constantSpeed=g,r.worldVerticesLength=c<<1,r.vertices=b.vertices,r.bones=b.bones,r.lengths=x,e&&H.Color.rgba8888ToColor(r.color,o),r);case H.AttachmentType.Point:p=t.readFloat();m=t.readFloat();v=t.readFloat();o=e?t.readInt32():0;a=this.attachmentLoader.newPointAttachment(u,i);return null==a?null:(a.x=m*f,a.y=v*f,a.rotation=p,e&&H.Color.rgba8888ToColor(a.color,o),a);case H.AttachmentType.Clipping:s=t.readInt(!0);c=t.readInt(!0);b=this.readVertices(t,c);o=e?t.readInt32():0;n=this.attachmentLoader.newClippingAttachment(u,i);return null==n?null:(n.endSlot=h.slots[s],n.worldVerticesLength=c<<1,n.vertices=b.vertices,n.bones=b.bones,e&&H.Color.rgba8888ToColor(n.color,o),n);}return null;},SkeletonBinary.prototype.readVertices=function(t,e){var i=e<<1;var r=new d();var n=this.scale;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,i,n),r;var a=new Array();var o=new Array();for(var s=0;s<e;s++){var c=t.readInt(!0);o.push(c);for(var l=0;l<c;l++)o.push(t.readInt(!0)),a.push(t.readFloat()*n),a.push(t.readFloat()*n),a.push(t.readFloat());}return r.vertices=H.Utils.toFloatArray(a),r.bones=o,r;},SkeletonBinary.prototype.readFloatArray=function(t,e,i){var r=new Array(e);if(1==i)for(var n=0;n<e;n++)r[n]=t.readFloat();else for(n=0;n<e;n++)r[n]=t.readFloat()*i;return r;},SkeletonBinary.prototype.readShortArray=function(t){var e=t.readInt(!0);var i=new Array(e);for(var r=0;r<e;r++)i[r]=t.readShort();return i;},SkeletonBinary.prototype.readAnimation=function(t,h,u){var e=new Array();var _=this.scale;var i=0;var d=new H.Color();var f=new H.Color();for(var r=0,n=t.readInt(!0);r<n;r++){var p=t.readInt(!0);for(var a=0,m=t.readInt(!0);a<m;a++){var v=t.readByte();var o=t.readInt(!0);switch(v){case SkeletonBinary.SLOT_ATTACHMENT:(c=new H.AttachmentTimeline(o)).slotIndex=p;for(var s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readStringRef());e.push(c),i=Math.max(i,c.frames[o-1]);break;case SkeletonBinary.SLOT_COLOR:(c=new H.ColorTimeline(o)).slotIndex=p;for(s=0;s<o;s++){var y=t.readFloat();H.Color.rgba8888ToColor(d,t.readInt32()),c.setFrame(s,y,d.r,d.g,d.b,d.a),s<o-1&&this.readCurve(t,s,c);}e.push(c),i=Math.max(i,c.frames[(o-1)*H.ColorTimeline.ENTRIES]);break;case SkeletonBinary.SLOT_TWO_COLOR:(c=new H.TwoColorTimeline(o)).slotIndex=p;for(s=0;s<o;s++){y=t.readFloat();H.Color.rgba8888ToColor(d,t.readInt32()),H.Color.rgb888ToColor(f,t.readInt32()),c.setFrame(s,y,d.r,d.g,d.b,d.a,f.r,f.g,f.b),s<o-1&&this.readCurve(t,s,c);}e.push(c),i=Math.max(i,c.frames[(o-1)*H.TwoColorTimeline.ENTRIES]);}}}for(r=0,n=t.readInt(!0);r<n;r++){var g=t.readInt(!0);for(a=0,m=t.readInt(!0);a<m;a++){v=t.readByte();o=t.readInt(!0);switch(v){case SkeletonBinary.BONE_ROTATE:(c=new H.RotateTimeline(o)).boneIndex=g;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat()),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.RotateTimeline.ENTRIES]);break;case SkeletonBinary.BONE_TRANSLATE:case SkeletonBinary.BONE_SCALE:case SkeletonBinary.BONE_SHEAR:var c=void 0;var b=1;v==SkeletonBinary.BONE_SCALE?c=new H.ScaleTimeline(o):v==SkeletonBinary.BONE_SHEAR?c=new H.ShearTimeline(o):(c=new H.TranslateTimeline(o),b=_),c.boneIndex=g;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat()*b,t.readFloat()*b),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.TranslateTimeline.ENTRIES]);}}}for(r=0,n=t.readInt(!0);r<n;r++){var C=t.readInt(!0);o=t.readInt(!0);(c=new H.IkConstraintTimeline(o)).ikConstraintIndex=C;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat(),t.readFloat()*_,t.readByte(),t.readBoolean(),t.readBoolean()),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.IkConstraintTimeline.ENTRIES]);}for(r=0,n=t.readInt(!0);r<n;r++){C=t.readInt(!0);o=t.readInt(!0);(c=new H.TransformConstraintTimeline(o)).transformConstraintIndex=C;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.TransformConstraintTimeline.ENTRIES]);}for(r=0,n=t.readInt(!0);r<n;r++){C=t.readInt(!0);var x=u.pathConstraints[C];for(a=0,m=t.readInt(!0);a<m;a++){v=t.readByte();o=t.readInt(!0);switch(v){case SkeletonBinary.PATH_POSITION:case SkeletonBinary.PATH_SPACING:c=void 0;b=1;v==SkeletonBinary.PATH_SPACING?(c=new H.PathConstraintSpacingTimeline(o),x.spacingMode!=H.SpacingMode.Length&&x.spacingMode!=H.SpacingMode.Fixed||(b=_)):(c=new H.PathConstraintPositionTimeline(o),x.positionMode==H.PositionMode.Fixed&&(b=_)),c.pathConstraintIndex=C;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat()*b),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.PathConstraintPositionTimeline.ENTRIES]);break;case SkeletonBinary.PATH_MIX:(c=new H.PathConstraintMixTimeline(o)).pathConstraintIndex=C;for(s=0;s<o;s++)c.setFrame(s,t.readFloat(),t.readFloat(),t.readFloat()),s<o-1&&this.readCurve(t,s,c);e.push(c),i=Math.max(i,c.frames[(o-1)*H.PathConstraintMixTimeline.ENTRIES]);}}}for(r=0,n=t.readInt(!0);r<n;r++){var A=u.skins[t.readInt(!0)];for(a=0,m=t.readInt(!0);a<m;a++){p=t.readInt(!0);for(var S=0,T=t.readInt(!0);S<T;S++){var w=A.getAttachment(p,t.readStringRef());var E=null!=w.bones;var P=w.vertices;var M=E?P.length/3*2:P.length;o=t.readInt(!0);(c=new H.DeformTimeline(o)).slotIndex=p,c.attachment=w;for(s=0;s<o;s++){y=t.readFloat();var R=void 0;var I=t.readInt(!0);if(0==I)R=E?H.Utils.newFloatArray(M):P;else{R=H.Utils.newFloatArray(M);var B=t.readInt(!0);if(I+=B,1==_)for(var l=B;l<I;l++)R[l]=t.readFloat();else for(l=B;l<I;l++)R[l]=t.readFloat()*_;if(!E)for(var l=0,D=R.length;l<D;l++)R[l]+=P[l];}c.setFrame(s,y,R),s<o-1&&this.readCurve(t,s,c);}e.push(c),i=Math.max(i,c.frames[o-1]);}}}var L=t.readInt(!0);if(0<L){c=new H.DrawOrderTimeline(L);var V=u.slots.length;for(r=0;r<L;r++){y=t.readFloat();var O=t.readInt(!0);var F=H.Utils.newArray(V,0);for(a=V-1;0<=a;a--)F[a]=-1;var N=H.Utils.newArray(V-O,0);var k=0,G=0;for(a=0;a<O;a++){p=t.readInt(!0);for(;k!=p;)N[G++]=k++;F[k+t.readInt(!0)]=k++;}for(;k<V;)N[G++]=k++;for(a=V-1;0<=a;a--)-1==F[a]&&(F[a]=N[--G]);c.setFrame(r,y,F);}e.push(c),i=Math.max(i,c.frames[L-1]);}var z=t.readInt(!0);if(0<z){c=new H.EventTimeline(z);for(r=0;r<z;r++){y=t.readFloat();var U=u.events[t.readInt(!0)];var W=new H.Event(y,U);W.intValue=t.readInt(!1),W.floatValue=t.readFloat(),W.stringValue=t.readBoolean()?t.readString():U.stringValue,null!=W.data.audioPath&&(W.volume=t.readFloat(),W.balance=t.readFloat()),c.setFrame(r,W);}e.push(c),i=Math.max(i,c.frames[z-1]);}return new H.Animation(h,e,i);},SkeletonBinary.prototype.readCurve=function(t,e,i){switch(t.readByte()){case SkeletonBinary.CURVE_STEPPED:i.setStepped(e);break;case SkeletonBinary.CURVE_BEZIER:this.setCurve(i,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat());}},SkeletonBinary.prototype.setCurve=function(t,e,i,r,n,a){t.setCurve(e,i,r,n,a);},SkeletonBinary.AttachmentTypeValues=[0,1,2,3,4,5,6],SkeletonBinary.TransformModeValues=[H.TransformMode.Normal,H.TransformMode.OnlyTranslation,H.TransformMode.NoRotationOrReflection,H.TransformMode.NoScale,H.TransformMode.NoScaleOrReflection],SkeletonBinary.PositionModeValues=[H.PositionMode.Fixed,H.PositionMode.Percent],SkeletonBinary.SpacingModeValues=[H.SpacingMode.Length,H.SpacingMode.Fixed,H.SpacingMode.Percent],SkeletonBinary.RotateModeValues=[H.RotateMode.Tangent,H.RotateMode.Chain,H.RotateMode.ChainScale],SkeletonBinary.BlendModeValues=[H.BlendMode.Normal,H.BlendMode.Additive,H.BlendMode.Multiply,H.BlendMode.Screen],SkeletonBinary.BONE_ROTATE=0,SkeletonBinary.BONE_TRANSLATE=1,SkeletonBinary.BONE_SCALE=2,SkeletonBinary.BONE_SHEAR=3,SkeletonBinary.SLOT_ATTACHMENT=0,SkeletonBinary.SLOT_COLOR=1,SkeletonBinary.SLOT_TWO_COLOR=2,SkeletonBinary.PATH_POSITION=0,SkeletonBinary.PATH_SPACING=1,SkeletonBinary.PATH_MIX=2,SkeletonBinary.CURVE_LINEAR=0,SkeletonBinary.CURVE_STEPPED=1,SkeletonBinary.CURVE_BEZIER=2,H.SkeletonBinary=SkeletonBinary,BinaryInput.prototype.readByte=function(){return this.buffer.getInt8(this.index++);},BinaryInput.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t;},BinaryInput.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t;},BinaryInput.prototype.readInt=function(t){var e=this.readByte();var i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&this.readByte())<<28)))),t?i:i>>>1^-(1&i);},BinaryInput.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1];},BinaryInput.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return"";}t--;var e="";for(var i=0;i<t;){var r=this.readByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&r)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(r),i++;}}return e;},BinaryInput.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t;},BinaryInput.prototype.readBoolean=function(){return 0!=this.readByte();};var m=BinaryInput;function BinaryInput(t,e,i,r){void 0===e&&(e=new Array()),void 0===i&&(i=0),void 0===r&&(r=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=r;}var T=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n;};var d=function(t,e){void 0===e&&(e=null),this.bones=t=void 0===t?null:t,this.vertices=e;};var f;!function(u){function SkeletonBounds(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array(),this.polygons=new Array(),this.polygonPool=new u.Pool(function(){return u.Utils.newFloatArray(16);});}SkeletonBounds.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes;var r=this.polygons;var n=this.polygonPool;var a=t.slots;var h=a.length;i.length=0,n.freeAll(r);for(var o=r.length=0;o<h;o++){var s=a[o];var c,l;s.bone.active&&(c=s.getAttachment())instanceof u.BoundingBoxAttachment&&(i.push(c=c),(l=n.obtain()).length!=c.worldVerticesLength&&(l=u.Utils.newFloatArray(c.worldVerticesLength)),r.push(l),c.computeWorldVertices(s,0,c.worldVerticesLength,l,0,2));}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY);},SkeletonBounds.prototype.aabbCompute=function(){var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;var n=this.polygons;for(var a=0,h=n.length;a<h;a++){var o=n[a];var s=o;for(var c=0,u=o.length;c<u;c+=2){var l=s[c];var _=s[c+1];t=Math.min(t,l),e=Math.min(e,_),i=Math.max(i,l),r=Math.max(r,_);}}this.minX=t,this.minY=e,this.maxX=i,this.maxY=r;},SkeletonBounds.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY;},SkeletonBounds.prototype.aabbIntersectsSegment=function(t,e,i,r){var n=this.minX;var a=this.minY;var o=this.maxX;var s=this.maxY;if(t<=n&&i<=n||e<=a&&r<=a||o<=t&&o<=i||s<=e&&s<=r)return!1;r=(r-e)/(i-t);i=r*(n-t)+e;if(a<i&&i<s)return!0;if(a<(i=r*(o-t)+e)&&i<s)return!0;i=(a-e)/r+t;return n<i&&i<o||n<(i=(s-e)/r+t)&&i<o;},SkeletonBounds.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY;},SkeletonBounds.prototype.containsPoint=function(t,e){var i=this.polygons;for(var r=0,n=i.length;r<n;r++)if(this.containsPointPolygon(i[r],t,e))return this.boundingBoxes[r];return null;},SkeletonBounds.prototype.containsPointPolygon=function(t,h,e){var i=t;var r=t.length;var n=r-2;var a=!1;for(var o=0;o<r;o+=2){var s=i[o+1];var c=i[n+1];var l;!(s<e&&e<=c||c<e&&e<=s)||(l=i[o])+(e-s)/(c-s)*(i[n]-l)<h&&(a=!a),n=o;}return a;},SkeletonBounds.prototype.intersectsSegment=function(t,e,i,r){var n=this.polygons;for(var a=0,o=n.length;a<o;a++)if(this.intersectsSegmentPolygon(n[a],t,e,i,r))return this.boundingBoxes[a];return null;},SkeletonBounds.prototype.intersectsSegmentPolygon=function(h,t,e,i,r){var n=h;var u=h.length;var _=t-i,d=e-r;var f=t*r-e*i;var a=n[u-2],o=n[u-1];for(var p=0;p<u;p+=2){var s=n[p],c=n[p+1];var m=a*c-o*s;var l=a-s,v=o-c;var y=_*v-d*l;l=(f*l-_*m)/y;if((a<=l&&l<=s||s<=l&&l<=a)&&(t<=l&&l<=i||i<=l&&l<=t)){l=(f*v-d*m)/y;if((o<=l&&l<=c||c<=l&&l<=o)&&(e<=l&&l<=r||r<=l&&l<=e))return!0;}a=s,o=c;}return!1;},SkeletonBounds.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");t=this.boundingBoxes.indexOf(t);return-1==t?null:this.polygons[t];},SkeletonBounds.prototype.getWidth=function(){return this.maxX-this.minX;},SkeletonBounds.prototype.getHeight=function(){return this.maxY-this.minY;},u.SkeletonBounds=SkeletonBounds;}(r=r||{}),function(K){function SkeletonClipping(){this.triangulator=new K.Triangulator(),this.clippingPolygon=new Array(),this.clipOutput=new Array(),this.clippedVertices=new Array(),this.clippedTriangles=new Array(),this.scratch=new Array();}SkeletonClipping.prototype.clipStart=function(t,e){if(null!=this.clipAttachment)return 0;var i=(this.clipAttachment=e).worldVerticesLength;var r=K.Utils.setArraySize(this.clippingPolygon,i);e.computeWorldVertices(t,0,i,r,0,2);e=this.clippingPolygon;SkeletonClipping.makeClockwise(e);var n=this.clippingPolygons=this.triangulator.decompose(e,this.triangulator.triangulate(e));for(var a=0,o=n.length;a<o;a++){var s=n[a];SkeletonClipping.makeClockwise(s),s.push(s[0]),s.push(s[1]);}return n.length;},SkeletonClipping.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd();},SkeletonClipping.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0);},SkeletonClipping.prototype.isClipping=function(){return null!=this.clipAttachment;},SkeletonClipping.prototype.clipTriangles=function(t,h,u,_,d,e,i,f,p,m,v,y){var g=this.clipOutput,b=this.clippedVertices;var C=this.clippedTriangles;var x=this.clippingPolygons;var A=this.clippingPolygons.length;var S=f?12:8;var r=0;m=m||0,v=v||0,y=y||0,b.length=0,C.length=0;t:for(var T=m,w=m+_;T<w;T+=3){var E=u[T]*p;var P=E+v;var M=E+y;var R=t[P],I=t[P+1];var B=d[M],D=d[M+1];var L=t[P=(E=u[T+1]*p)+v],V=t[P+1];var O=d[M=E+y],F=d[M+1];var N=t[P=(E=u[T+2]*p)+v],n=t[P+1];var k=d[M=E+y],G=d[M+1];for(var z=0;z<A;z++){var a=b.length;if(!this.clip(R,I,L,V,N,n,x[z],g)){(o=K.Utils.setArraySize(b,a+3*S))[a]=R,o[a+1]=I,o[a+2]=e.r,o[a+3]=e.g,o[a+4]=e.b,o[a+5]=e.a,f?(o[a+6]=B,o[a+7]=D,o[a+8]=i.r,o[a+9]=i.g,o[a+10]=i.b,o[a+11]=i.a,o[a+12]=L,o[a+13]=V,o[a+14]=e.r,o[a+15]=e.g,o[a+16]=e.b,o[a+17]=e.a,o[a+18]=O,o[a+19]=F,o[a+20]=i.r,o[a+21]=i.g,o[a+22]=i.b,o[a+23]=i.a,o[a+24]=N,o[a+25]=n,o[a+26]=e.r,o[a+27]=e.g,o[a+28]=e.b,o[a+29]=e.a,o[a+30]=k,o[a+31]=G,o[a+32]=i.r,o[a+33]=i.g,o[a+34]=i.b,o[a+35]=i.a):(o[a+6]=B,o[a+7]=D,o[a+8]=L,o[a+9]=V,o[a+10]=e.r,o[a+11]=e.g,o[a+12]=e.b,o[a+13]=e.a,o[a+14]=O,o[a+15]=F,o[a+16]=N,o[a+17]=n,o[a+18]=e.r,o[a+19]=e.g,o[a+20]=e.b,o[a+21]=e.a,o[a+22]=k,o[a+23]=G),a=C.length,(Q=K.Utils.setArraySize(C,a+3))[a]=r,Q[a+1]=r+1,Q[a+2]=r+2,r+=3;continue t;}var U=g.length;if(0!=U){var W=V-n,H=N-L,j=R-N,X=n-I;var q=1/(W*j+H*(I-n));var Y=U>>1;var J=this.clipOutput;var o=K.Utils.setArraySize(b,a+Y*S);for(var s=0;s<U;s+=2){var c=J[s],l=J[s+1];o[a]=c,o[a+1]=l,o[a+2]=e.r,o[a+3]=e.g,o[a+4]=e.b,o[a+5]=e.a;c=c-N,l=l-n;var Z=(W*c+H*l)*q;c=(X*c+j*l)*q;l=1-Z-c;o[a+6]=B*Z+O*c+k*l,o[a+7]=D*Z+F*c+G*l,f&&(o[a+8]=i.r,o[a+9]=i.g,o[a+10]=i.b,o[a+11]=i.a),a+=S;}a=C.length;var Q=K.Utils.setArraySize(C,a+3*(Y-2));Y--;for(s=1;s<Y;s++)Q[a]=r,Q[a+1]=r+s,Q[a+2]=r+s+1,a+=3;r+=1+Y;}}}},SkeletonClipping.prototype.clip=function(h,u,_,d,f,p,m,t){var e=t;var v=!1;var i=null;2<=m.length%4?(i=t,t=this.scratch):i=this.scratch,i.length=0,i.push(h),i.push(u),i.push(_),i.push(d),i.push(f),i.push(p),i.push(h),i.push(u),t.length=0;var y=m;var g=m.length-4;for(var r=0;;r+=2){var n=y[r],a=y[r+1];var o=y[r+2],s=y[r+3];var b=n-o,C=a-s;var x=i;var A=i.length-2,S=t.length;for(var c=0;c<A;c+=2){var l=x[c],T=x[c+1];var w=x[c+2],E=x[c+3];var P=0<b*(E-s)-C*(w-o);if(0<b*(T-s)-C*(l-o)){if(P){t.push(w),t.push(E);continue;}var M=(R=E-T)*(o-n)-(I=w-l)*(s-a);1e-6<Math.abs(M)?(t.push(n+(o-n)*(B=(I*(a-T)-R*(n-l))/M)),t.push(a+(s-a)*B)):(t.push(n),t.push(a));}else{var R,I,B;P&&(M=(R=E-T)*(o-n)-(I=w-l)*(s-a),1e-6<Math.abs(M)?(t.push(n+(o-n)*(B=(I*(a-T)-R*(n-l))/M)),t.push(a+(s-a)*B)):(t.push(n),t.push(a)),t.push(w),t.push(E));}v=!0;}if(S==t.length)return!(e.length=0);if(t.push(t[0]),t.push(t[1]),r==g)break;S=t;(t=i).length=0,i=S;}if(e!=t)for(var r=e.length=0,D=t.length-2;r<D;r++)e[r]=t[r];else e.length=e.length-2;return v;},SkeletonClipping.makeClockwise=function(t){var e=t;t=t.length;var i,r,n,a=e[t-2]*e[1]-e[0]*e[t-1];for(var o=0,s=t-3;o<s;o+=2)i=e[o],r=e[o+1],n=e[o+2],a+=i*e[o+3]-n*r;if(!(a<0))for(var o=0,c=t-2,s=t>>1;o<s;o+=2){var h=e[o],u=e[o+1];var l=c-o;e[o]=e[l],e[o+1]=e[1+l],e[l]=h,e[1+l]=u;}},K.SkeletonClipping=SkeletonClipping;}(r=r||{}),function(t){function SkeletonData(){this.bones=new Array(),this.slots=new Array(),this.skins=new Array(),this.events=new Array(),this.animations=new Array(),this.ikConstraints=new Array(),this.transformConstraints=new Array(),this.pathConstraints=new Array(),this.fps=0;}SkeletonData.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");var e=this.bones;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");var e=this.bones;for(var i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1;},SkeletonData.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");var e=this.slots;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");var e=this.slots;for(var i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1;},SkeletonData.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");var e=this.skins;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");var e=this.events;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");var e=this.animations;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.ikConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.transformConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");var e=this.pathConstraints;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n;}return null;},SkeletonData.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");var e=this.pathConstraints;for(var i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1;},t.SkeletonData=SkeletonData;}(r=r||{}),function(et){function SkeletonJson(t){this.scale=1,this.linkedMeshes=new Array(),this.attachmentLoader=t;}SkeletonJson.prototype.readSkeletonData=function(t){var h=this.scale;var e=new et.SkeletonData();var i="string"==typeof t?JSON.parse(t):t;t=i.skeleton;if(null!=t&&(e.hash=t.hash,e.version=t.spine,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e.fps=t.fps,e.imagesPath=t.images),i.bones)for(var r=0;r<i.bones.length;r++){var n=i.bones[r];var u=null;var _=this.getValue(n,"parent",null);if(null!=_&&null==(u=e.findBone(_)))throw new Error("Parent bone not found: "+_);(o=new et.BoneData(e.bones.length,n.name,u)).length=this.getValue(n,"length",0)*h,o.x=this.getValue(n,"x",0)*h,o.y=this.getValue(n,"y",0)*h,o.rotation=this.getValue(n,"rotation",0),o.scaleX=this.getValue(n,"scaleX",1),o.scaleY=this.getValue(n,"scaleY",1),o.shearX=this.getValue(n,"shearX",0),o.shearY=this.getValue(n,"shearY",0),o.transformMode=SkeletonJson.transformModeFromString(this.getValue(n,"transform","normal")),o.skinRequired=this.getValue(n,"skin",!1),e.bones.push(o);}if(i.slots)for(r=0;r<i.slots.length;r++){var d=(S=i.slots[r]).name;var a=S.bone;var f=e.findBone(a);if(null==f)throw new Error("Slot bone not found: "+a);var o=new et.SlotData(e.slots.length,d,f);f=this.getValue(S,"color",null);null!=f&&o.color.setFromString(f);f=this.getValue(S,"dark",null);null!=f&&(o.darkColor=new et.Color(1,1,1,1),o.darkColor.setFromString(f)),o.attachmentName=this.getValue(S,"attachment",null),o.blendMode=SkeletonJson.blendModeFromString(this.getValue(S,"blend","normal")),e.slots.push(o);}if(i.ik)for(r=0;r<i.ik.length;r++){var s=i.ik[r];(o=new et.IkConstraintData(s.name)).order=this.getValue(s,"order",0),o.skinRequired=this.getValue(s,"skin",!1);for(var p=0;p<s.bones.length;p++){a=s.bones[p];if(null==(C=e.findBone(a)))throw new Error("IK bone not found: "+a);o.bones.push(C);}var m=s.target;if(o.target=e.findBone(m),null==o.target)throw new Error("IK target bone not found: "+m);o.mix=this.getValue(s,"mix",1),o.softness=this.getValue(s,"softness",0)*h,o.bendDirection=this.getValue(s,"bendPositive",!0)?1:-1,o.compress=this.getValue(s,"compress",!1),o.stretch=this.getValue(s,"stretch",!1),o.uniform=this.getValue(s,"uniform",!1),e.ikConstraints.push(o);}if(i.transform)for(r=0;r<i.transform.length;r++){s=i.transform[r];(o=new et.TransformConstraintData(s.name)).order=this.getValue(s,"order",0),o.skinRequired=this.getValue(s,"skin",!1);for(p=0;p<s.bones.length;p++){a=s.bones[p];if(null==(C=e.findBone(a)))throw new Error("Transform constraint bone not found: "+a);o.bones.push(C);}m=s.target;if(o.target=e.findBone(m),null==o.target)throw new Error("Transform constraint target bone not found: "+m);o.local=this.getValue(s,"local",!1),o.relative=this.getValue(s,"relative",!1),o.offsetRotation=this.getValue(s,"rotation",0),o.offsetX=this.getValue(s,"x",0)*h,o.offsetY=this.getValue(s,"y",0)*h,o.offsetScaleX=this.getValue(s,"scaleX",0),o.offsetScaleY=this.getValue(s,"scaleY",0),o.offsetShearY=this.getValue(s,"shearY",0),o.rotateMix=this.getValue(s,"rotateMix",1),o.translateMix=this.getValue(s,"translateMix",1),o.scaleMix=this.getValue(s,"scaleMix",1),o.shearMix=this.getValue(s,"shearMix",1),e.transformConstraints.push(o);}if(i.path)for(r=0;r<i.path.length;r++){s=i.path[r];(o=new et.PathConstraintData(s.name)).order=this.getValue(s,"order",0),o.skinRequired=this.getValue(s,"skin",!1);for(p=0;p<s.bones.length;p++){a=s.bones[p];if(null==(C=e.findBone(a)))throw new Error("Transform constraint bone not found: "+a);o.bones.push(C);}m=s.target;if(o.target=e.findSlot(m),null==o.target)throw new Error("Path target slot not found: "+m);o.positionMode=SkeletonJson.positionModeFromString(this.getValue(s,"positionMode","percent")),o.spacingMode=SkeletonJson.spacingModeFromString(this.getValue(s,"spacingMode","length")),o.rotateMode=SkeletonJson.rotateModeFromString(this.getValue(s,"rotateMode","tangent")),o.offsetRotation=this.getValue(s,"rotation",0),o.position=this.getValue(s,"position",0),o.positionMode==et.PositionMode.Fixed&&(o.position*=h),o.spacing=this.getValue(s,"spacing",0),o.spacingMode!=et.SpacingMode.Length&&o.spacingMode!=et.SpacingMode.Fixed||(o.spacing*=h),o.rotateMix=this.getValue(s,"rotateMix",1),o.translateMix=this.getValue(s,"translateMix",1),e.pathConstraints.push(o);}if(i.skins){var v=i.skins;if(!(v instanceof Array)){var y=[];for(var g in v)y.push({name:g,attachments:v[g]});v=y;}for(r=0;r<v.length;r++){var c=v[r];var b=new et.Skin(c.name);if(c.bones)for(var l=0;l<c.bones.length;l++){var C;if(null==(C=e.findBone(c.bones[l])))throw new Error("Skin bone not found: "+c.bones[r]);b.bones.push(C);}if(c.ik)for(l=0;l<c.ik.length;l++){if(null==(x=e.findIkConstraint(c.ik[l])))throw new Error("Skin IK constraint not found: "+c.ik[r]);b.constraints.push(x);}if(c.transform)for(l=0;l<c.transform.length;l++){if(null==(x=e.findTransformConstraint(c.transform[l])))throw new Error("Skin transform constraint not found: "+c.transform[r]);b.constraints.push(x);}if(c.path)for(l=0;l<c.path.length;l++){var x;if(null==(x=e.findPathConstraint(c.path[l])))throw new Error("Skin path constraint not found: "+c.path[r]);b.constraints.push(x);}for(var d in c.attachments){var A=e.findSlot(d);if(null==A)throw new Error("Slot not found: "+d);var S;for(var T in S=c.attachments[d]){var w=this.readAttachment(S[T],b,A.index,T,e);null!=w&&b.setAttachment(A.index,T,w);}}e.skins.push(b),"default"==b.name&&(e.defaultSkin=b);}}for(var r=0,E=this.linkedMeshes.length;r<E;r++){var P=this.linkedMeshes[r];if(null==(b=null==P.skin?e.defaultSkin:e.findSkin(P.skin)))throw new Error("Skin not found: "+P.skin);var M=b.getAttachment(P.slotIndex,P.parent);if(null==M)throw new Error("Parent mesh not found: "+P.parent);P.mesh.deformAttachment=P.inheritDeform?M:P.mesh,P.mesh.setParentMesh(M),P.mesh.updateUVs();}if(this.linkedMeshes.length=0,i.events)for(var R in i.events){var I=i.events[R];(o=new et.EventData(R)).intValue=this.getValue(I,"int",0),o.floatValue=this.getValue(I,"float",0),o.stringValue=this.getValue(I,"string",""),o.audioPath=this.getValue(I,"audio",null),null!=o.audioPath&&(o.volume=this.getValue(I,"volume",1),o.balance=this.getValue(I,"balance",0)),e.events.push(o);}if(i.animations)for(var B in i.animations){var D=i.animations[B];this.readAnimation(D,B,e);}return e;},SkeletonJson.prototype.readAttachment=function(t,e,h,i,u){var r=this.scale;switch(i=this.getValue(t,"name",i),this.getValue(t,"type","region")){case"region":var n=this.getValue(t,"path",i);var a=this.attachmentLoader.newRegionAttachment(e,i,n);return null==a?null:(a.path=n,a.x=this.getValue(t,"x",0)*r,a.y=this.getValue(t,"y",0)*r,a.scaleX=this.getValue(t,"scaleX",1),a.scaleY=this.getValue(t,"scaleY",1),a.rotation=this.getValue(t,"rotation",0),a.width=t.width*r,a.height=t.height*r,null!=(l=this.getValue(t,"color",null))&&a.color.setFromString(l),a.updateOffset(),a);case"boundingbox":a=this.attachmentLoader.newBoundingBoxAttachment(e,i);return null==a?null:(this.readVertices(t,a,t.vertexCount<<1),null!=(l=this.getValue(t,"color",null))&&a.color.setFromString(l),a);case"mesh":case"linkedmesh":n=this.getValue(t,"path",i);a=this.attachmentLoader.newMeshAttachment(e,i,n);if(null==a)return null;a.path=n,null!=(l=this.getValue(t,"color",null))&&a.color.setFromString(l),a.width=this.getValue(t,"width",0)*r,a.height=this.getValue(t,"height",0)*r;var o=this.getValue(t,"parent",null);if(null!=o)return this.linkedMeshes.push(new d(a,this.getValue(t,"skin",null),h,o,this.getValue(t,"deform",!0))),a;o=t.uvs;return this.readVertices(t,a,o.length),a.triangles=t.triangles,a.regionUVs=o,a.updateUVs(),a.edges=this.getValue(t,"edges",null),a.hullLength=2*this.getValue(t,"hull",0),a;case"path":if(null==(n=this.attachmentLoader.newPathAttachment(e,i)))return null;n.closed=this.getValue(t,"closed",!1),n.constantSpeed=this.getValue(t,"constantSpeed",!0);var s=t.vertexCount;this.readVertices(t,n,s<<1);var _=et.Utils.newArray(s/3,0);for(var c=0;c<t.lengths.length;c++)_[c]=t.lengths[c]*r;return n.lengths=_,null!=(l=this.getValue(t,"color",null))&&n.color.setFromString(l),n;case"point":o=this.attachmentLoader.newPointAttachment(e,i);return null==o?null:(o.x=this.getValue(t,"x",0)*r,o.y=this.getValue(t,"y",0)*r,o.rotation=this.getValue(t,"rotation",0),null!=(l=this.getValue(t,"color",null))&&o.color.setFromString(l),o);case"clipping":a=this.attachmentLoader.newClippingAttachment(e,i);if(null==a)return null;n=this.getValue(t,"end",null);if(null!=n){o=u.findSlot(n);if(null==o)throw new Error("Clipping end slot not found: "+n);a.endSlot=o;}s=t.vertexCount;var l;return this.readVertices(t,a,s<<1),null!=(l=this.getValue(t,"color",null))&&a.color.setFromString(l),a;}return null;},SkeletonJson.prototype.readVertices=function(h,t,e){var i=this.scale;t.worldVerticesLength=e;var r=h.vertices;if(e!=r.length){var n=new Array();var a=new Array();for(c=0,l=r.length;c<l;){var o=r[c++];a.push(o);for(var u=c+4*o;c<u;c+=4)a.push(r[c]),n.push(r[c+1]*i),n.push(r[c+2]*i),n.push(r[c+3]);}t.bones=a,t.vertices=et.Utils.toFloatArray(n);}else{var s=et.Utils.toFloatArray(r);if(1!=i)for(var c=0,l=r.length;c<l;c++)s[c]*=i;t.vertices=s;}},SkeletonJson.prototype.readAnimation=function(t,h,e){var u=this.scale;var i=new Array();var r=0;if(t.slots)for(var _ in t.slots){var d=t.slots[_];if(-1==(Q=e.findSlotIndex(_)))throw new Error("Slot not found: "+_);for(var n in d){var a=d[n];if("attachment"==n){(l=new et.AttachmentTimeline(a.length)).slotIndex=Q;var o=0;for(var s=0;s<a.length;s++){var c=a[s];l.setFrame(o++,this.getValue(c,"time",0),c.name);}i.push(l),r=Math.max(r,l.frames[l.getFrameCount()-1]);}else if("color"==n){(l=new et.ColorTimeline(a.length)).slotIndex=Q;o=0;for(s=0;s<a.length;s++){c=a[s];var f=new et.Color();f.setFromString(c.color),l.setFrame(o,this.getValue(c,"time",0),f.r,f.g,f.b,f.a),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.ColorTimeline.ENTRIES]);}else{if("twoColor"!=n)throw new Error("Invalid timeline type for a slot: "+n+" ("+_+")");(l=new et.TwoColorTimeline(a.length)).slotIndex=Q;o=0;for(s=0;s<a.length;s++){c=a[s];var p=new et.Color();var m=new et.Color();p.setFromString(c.light),m.setFromString(c.dark),l.setFrame(o,this.getValue(c,"time",0),p.r,p.g,p.b,p.a,m.r,m.g,m.b),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.TwoColorTimeline.ENTRIES]);}}}if(t.bones)for(var v in t.bones){var y=t.bones[v];var g=e.findBoneIndex(v);if(-1==g)throw new Error("Bone not found: "+v);for(var n in y){a=y[n];if("rotate"===n){(l=new et.RotateTimeline(a.length)).boneIndex=g;o=0;for(s=0;s<a.length;s++){c=a[s];l.setFrame(o,this.getValue(c,"time",0),this.getValue(c,"angle",0)),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.RotateTimeline.ENTRIES]);}else{if("translate"!==n&&"scale"!==n&&"shear"!==n)throw new Error("Invalid timeline type for a bone: "+n+" ("+v+")");var l=null;var b=1,C=0;"scale"===n?(l=new et.ScaleTimeline(a.length),C=1):"shear"===n?l=new et.ShearTimeline(a.length):(l=new et.TranslateTimeline(a.length),b=u),l.boneIndex=g;o=0;for(s=0;s<a.length;s++){c=a[s];var x=this.getValue(c,"x",C),A=this.getValue(c,"y",C);l.setFrame(o,this.getValue(c,"time",0),x*b,A*b),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.TranslateTimeline.ENTRIES]);}}}if(t.ik)for(var S in t.ik){var T=t.ik[S];var w=e.findIkConstraint(S);(l=new et.IkConstraintTimeline(T.length)).ikConstraintIndex=e.ikConstraints.indexOf(w);o=0;for(s=0;s<T.length;s++){c=T[s];l.setFrame(o,this.getValue(c,"time",0),this.getValue(c,"mix",1),this.getValue(c,"softness",0)*u,this.getValue(c,"bendPositive",!0)?1:-1,this.getValue(c,"compress",!1),this.getValue(c,"stretch",!1)),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.IkConstraintTimeline.ENTRIES]);}if(t.transform)for(var S in t.transform){T=t.transform[S];w=e.findTransformConstraint(S);(l=new et.TransformConstraintTimeline(T.length)).transformConstraintIndex=e.transformConstraints.indexOf(w);o=0;for(s=0;s<T.length;s++){c=T[s];l.setFrame(o,this.getValue(c,"time",0),this.getValue(c,"rotateMix",1),this.getValue(c,"translateMix",1),this.getValue(c,"scaleMix",1),this.getValue(c,"shearMix",1)),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.TransformConstraintTimeline.ENTRIES]);}var E=t.path||t.paths;if(E)for(var S in E){T=E[S];var P=e.findPathConstraintIndex(S);if(-1==P)throw new Error("Path constraint not found: "+S);var M=e.pathConstraints[P];for(var n in T){a=T[n];if("position"===n||"spacing"===n){l=null;b=1;"spacing"===n?(l=new et.PathConstraintSpacingTimeline(a.length),M.spacingMode!=et.SpacingMode.Length&&M.spacingMode!=et.SpacingMode.Fixed||(b=u)):(l=new et.PathConstraintPositionTimeline(a.length),M.positionMode==et.PositionMode.Fixed&&(b=u)),l.pathConstraintIndex=P;o=0;for(s=0;s<a.length;s++){c=a[s];l.setFrame(o,this.getValue(c,"time",0),this.getValue(c,n,0)*b),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.PathConstraintPositionTimeline.ENTRIES]);}else if("mix"===n){(l=new et.PathConstraintMixTimeline(a.length)).pathConstraintIndex=P;o=0;for(s=0;s<a.length;s++){c=a[s];l.setFrame(o,this.getValue(c,"time",0),this.getValue(c,"rotateMix",1),this.getValue(c,"translateMix",1)),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[(l.getFrameCount()-1)*et.PathConstraintMixTimeline.ENTRIES]);}}}if(t.deform)for(var R in t.deform){var I=t.deform[R];var B=e.findSkin(R);if(null==B)throw new Error("Skin not found: "+R);for(var _ in I){d=I[_];if(-1==(Q=e.findSlotIndex(_)))throw new Error("Slot not found: "+d.name);for(var n in d){a=d[n];var D=B.getAttachment(Q,n);if(null!=D){var L=null!=D.bones;var V=D.vertices;var O=L?V.length/3*2:V.length;(l=new et.DeformTimeline(a.length)).slotIndex=Q,l.attachment=D;o=0;for(var F=0;F<a.length;F++){c=a[F];var N=void 0;var k=this.getValue(c,"vertices",null);if(null==k)N=L?et.Utils.newFloatArray(O):V;else{N=et.Utils.newFloatArray(O);var G=this.getValue(c,"offset",0);if(et.Utils.arrayCopy(k,0,N,G,k.length),1!=u)for(var z=(s=G)+k.length;s<z;s++)N[s]*=u;if(!L)for(s=0;s<O;s++)N[s]+=V[s];}l.setFrame(o,this.getValue(c,"time",0),N),this.readCurve(c,l,o),o++;}i.push(l),r=Math.max(r,l.frames[l.getFrameCount()-1]);}}}}var U=t.drawOrder;if(null!=(U=null==U?t.draworder:U)){l=new et.DrawOrderTimeline(U.length);var W=e.slots.length;o=0;for(F=0;F<U.length;F++){var H=U[F];var j=null;var X=this.getValue(H,"offsets",null);if(null!=X){j=et.Utils.newArray(W,-1);var q=et.Utils.newArray(W-X.length,0);var Y=0,J=0;for(s=0;s<X.length;s++){var Z=X[s];var Q;if(-1==(Q=e.findSlotIndex(Z.slot)))throw new Error("Slot not found: "+Z.slot);for(;Y!=Q;)q[J++]=Y++;j[Y+Z.offset]=Y++;}for(;Y<W;)q[J++]=Y++;for(s=W-1;0<=s;s--)-1==j[s]&&(j[s]=q[--J]);}l.setFrame(o++,this.getValue(H,"time",0),j);}i.push(l),r=Math.max(r,l.frames[l.getFrameCount()-1]);}if(t.events){l=new et.EventTimeline(t.events.length);o=0;for(s=0;s<t.events.length;s++){var K=t.events[s];var $=e.findEvent(K.name);if(null==$)throw new Error("Event not found: "+K.name);var tt=new et.Event(et.Utils.toSinglePrecision(this.getValue(K,"time",0)),$);tt.intValue=this.getValue(K,"int",$.intValue),tt.floatValue=this.getValue(K,"float",$.floatValue),tt.stringValue=this.getValue(K,"string",$.stringValue),null!=tt.data.audioPath&&(tt.volume=this.getValue(K,"volume",1),tt.balance=this.getValue(K,"balance",0)),l.setFrame(o++,tt);}i.push(l),r=Math.max(r,l.frames[l.getFrameCount()-1]);}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new et.Animation(h,i,r));},SkeletonJson.prototype.readCurve=function(t,e,i){var r=t.curve;r&&("stepped"==r?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(r)?e.setCurve(i,r[0],r[1],r[2],r[3]):e.setCurve(i,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)));},SkeletonJson.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i;},SkeletonJson.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.BlendMode.Normal;if("additive"==t)return et.BlendMode.Additive;if("multiply"==t)return et.BlendMode.Multiply;if("screen"==t)return et.BlendMode.Screen;throw new Error("Unknown blend mode: "+t);},SkeletonJson.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return et.PositionMode.Fixed;if("percent"==t)return et.PositionMode.Percent;throw new Error("Unknown position mode: "+t);},SkeletonJson.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return et.SpacingMode.Length;if("fixed"==t)return et.SpacingMode.Fixed;if("percent"==t)return et.SpacingMode.Percent;throw new Error("Unknown position mode: "+t);},SkeletonJson.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return et.RotateMode.Tangent;if("chain"==t)return et.RotateMode.Chain;if("chainscale"==t)return et.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+t);},SkeletonJson.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return et.TransformMode.Normal;if("onlytranslation"==t)return et.TransformMode.OnlyTranslation;if("norotationorreflection"==t)return et.TransformMode.NoRotationOrReflection;if("noscale"==t)return et.TransformMode.NoScale;if("noscaleorreflection"==t)return et.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t);},et.SkeletonJson=SkeletonJson;var d=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n;};}(r=r||{}),function(c){var a=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i;};function Skin(t){if(this.attachments=new Array(),this.bones=Array(),this.constraints=new Array(),null==t)throw new Error("name cannot be null.");this.name=t;}c.SkinEntry=a,Skin.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=i;},Skin.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];var r=!1;for(var n=0;n<this.bones.length;n++)if(this.bones[n]==i){r=!0;break;}r||this.bones.push(i);}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];r=!1;for(n=0;n<this.constraints.length;n++)if(this.constraints[n]==a){r=!0;break;}r||this.constraints.push(a);}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment);}},Skin.prototype.copySkin=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];var r=!1;for(var n=0;n<this.bones.length;n++)if(this.bones[n]==i){r=!0;break;}r||this.bones.push(i);}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];r=!1;for(n=0;n<this.constraints.length;n++)if(this.constraints[n]==a){r=!0;break;}r||this.constraints.push(a);}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];null!=s.attachment&&(s.attachment instanceof c.MeshAttachment?s.attachment=s.attachment.newLinkedMesh():s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment));}},Skin.prototype.getAttachment=function(t,e){t=this.attachments[t];return t?t[e]:null;},Skin.prototype.removeAttachment=function(t,e){t=this.attachments[t];t&&(t[e]=null);},Skin.prototype.getAttachments=function(){var t=new Array();for(var e=0;e<this.attachments.length;e++){var i=this.attachments[e];if(i)for(var r in i){var n=i[r];n&&t.push(new a(e,r,n));}}return t;},Skin.prototype.getAttachmentsForSlot=function(t,e){var i=this.attachments[t];if(i)for(var r in i){var n=i[r];n&&e.push(new a(t,r,n));}},Skin.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0;},Skin.prototype.attachAll=function(t,e){var i=0;for(var r=0;r<t.slots.length;r++){var n=t.slots[r];var a=n.getAttachment();if(a&&i<e.attachments.length){var o=e.attachments[i];for(var s in o)if(a==o[s]){s=this.getAttachment(i,s);null!=s&&n.setAttachment(s);break;}}i++;}},c.Skin=Skin;}(r=r||{}),function(i){function Slot(t,e){if(this.deform=new Array(),null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new i.Color(),this.darkColor=null==t.darkColor?null:new i.Color(),this.setToSetupPose();}Slot.prototype.getSkeleton=function(){return this.bone.skeleton;},Slot.prototype.getAttachment=function(){return this.attachment;},Slot.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0);},Slot.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t;},Slot.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime;},Slot.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)));},i.Slot=Slot;}(r=r||{}),(f=r=r||{}).SlotData=function(t,e,i){if(this.color=new f.Color(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=i;};var t=r=r||{};Texture.prototype.getImage=function(){return this._image;},Texture.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return p.Nearest;case"linear":return p.Linear;case"mipmap":return p.MipMap;case"mipmapnearestnearest":return p.MipMapNearestNearest;case"mipmaplinearnearest":return p.MipMapLinearNearest;case"mipmapnearestlinear":return p.MipMapNearestLinear;case"mipmaplinearlinear":return p.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t);}},Texture.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return v.MirroredRepeat;case"clamptoedge":return v.ClampToEdge;case"repeat":return v.Repeat;default:throw new Error("Unknown texture wrap "+t);}};var e=Texture;function Texture(t){this._image=t;}var p;var v;t.Texture=e,(i=p=t.TextureFilter||(t.TextureFilter={}))[i.Nearest=9728]="Nearest",i[i.Linear=9729]="Linear",i[i.MipMap=9987]="MipMap",i[i.MipMapNearestNearest=9984]="MipMapNearestNearest",i[i.MipMapLinearNearest=9985]="MipMapLinearNearest",i[i.MipMapNearestLinear=9986]="MipMapNearestLinear",i[i.MipMapLinearLinear=9987]="MipMapLinearLinear",(i=v=t.TextureWrap||(t.TextureWrap={}))[i.MirroredRepeat=33648]="MirroredRepeat",i[i.ClampToEdge=33071]="ClampToEdge",i[i.Repeat=10497]="Repeat",t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0;},y(FakeTexture,g=e),FakeTexture.prototype.setFilters=function(t,e){},FakeTexture.prototype.setWraps=function(t,e){},FakeTexture.prototype.dispose=function(){};var i=FakeTexture;function FakeTexture(){return null!==g&&g.apply(this,arguments)||this;}var g;function TransformConstraintData(t){t=b.call(this,t,0,!1)||this;return t.bones=new Array(),t.rotateMix=0,t.translateMix=0,t.scaleMix=0,t.shearMix=0,t.offsetRotation=0,t.offsetX=0,t.offsetY=0,t.offsetScaleX=0,t.offsetScaleY=0,t.offsetShearY=0,t.relative=!1,t.local=!1,t;}var b;var C;t.FakeTexture=i,function(u){function TextureAtlas(t,e){this.pages=new Array(),this.regions=new Array(),this.load(t,e);}TextureAtlas.prototype.load=function(h,t){if(null==t)throw new Error("textureLoader cannot be null.");var e=new _(h);var i=new Array(4);var r=null;for(;;){var n=e.readLine();if(null==n)break;var a,o,s,c,l;0==(n=n.trim()).length?r=null:r?((a=new f()).name=n,a.page=r,"true"==(l=e.readValue()).toLocaleLowerCase()?a.degrees=90:"false"==l.toLocaleLowerCase()?a.degrees=0:a.degrees=parseFloat(l),a.rotate=90==a.degrees,e.readTuple(i),l=parseInt(i[0]),o=parseInt(i[1]),e.readTuple(i),s=parseInt(i[0]),c=parseInt(i[1]),a.u=l/r.width,a.v=o/r.height,a.rotate?(a.u2=(l+c)/r.width,a.v2=(o+s)/r.height):(a.u2=(l+s)/r.width,a.v2=(o+c)/r.height),a.x=l,a.y=o,a.width=Math.abs(s),a.height=Math.abs(c),4==e.readTuple(i)&&4==e.readTuple(i)&&e.readTuple(i),a.originalWidth=parseInt(i[0]),a.originalHeight=parseInt(i[1]),e.readTuple(i),a.offsetX=parseInt(i[0]),a.offsetY=parseInt(i[1]),a.index=parseInt(e.readValue()),a.texture=r.texture,this.regions.push(a)):((r=new d()).name=n,2==e.readTuple(i)&&(r.width=parseInt(i[0]),r.height=parseInt(i[1]),e.readTuple(i)),e.readTuple(i),r.minFilter=u.Texture.filterFromString(i[0]),r.magFilter=u.Texture.filterFromString(i[1]),l=e.readValue(),r.uWrap=u.TextureWrap.ClampToEdge,r.vWrap=u.TextureWrap.ClampToEdge,"x"==l?r.uWrap=u.TextureWrap.Repeat:"y"==l?r.vWrap=u.TextureWrap.Repeat:"xy"==l&&(r.uWrap=r.vWrap=u.TextureWrap.Repeat),r.texture=t(n),r.texture.setFilters(r.minFilter,r.magFilter),r.texture.setWraps(r.uWrap,r.vWrap),r.width=r.texture.getImage().width,r.height=r.texture.getImage().height,this.pages.push(r));}},TextureAtlas.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null;},TextureAtlas.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose();},u.TextureAtlas=TextureAtlas;TextureAtlasReader.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++];},TextureAtlasReader.prototype.readValue=function(){var t=this.readLine();var e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim();},TextureAtlasReader.prototype.readTuple=function(t){var e=this.readLine();var i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);var r=0,n=i+1;for(;r<3;r++){var a=e.indexOf(",",n);if(-1==a)break;t[r]=e.substr(n,a-n).trim(),n=a+1;}return t[r]=e.substring(n).trim(),r+1;};var _=TextureAtlasReader;function TextureAtlasReader(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/);}var d=function(){};u.TextureAtlasPage=d;t=u.TextureRegion,y(TextureAtlasRegion,t);var f=TextureAtlasRegion;function TextureAtlasRegion(){return null!==t&&t.apply(this,arguments)||this;}var t;u.TextureAtlasRegion=f;}(r=r||{}),function(T){function TransformConstraint(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new T.Vector2(),this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array();for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name);}TransformConstraint.prototype.isActive=function(){return this.active;},TransformConstraint.prototype.apply=function(){this.update();},TransformConstraint.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld();},TransformConstraint.prototype.applyAbsoluteWorld=function(){var h=this.rotateMix,u=this.translateMix,_=this.scaleMix,d=this.shearMix;var t=this.target;var e=t.a,f=t.b,p=t.c,m=t.d;var v=0<e*m-f*p?T.MathUtils.degRad:-T.MathUtils.degRad;var y=this.data.offsetRotation*v;var g=this.data.offsetShearY*v;var b=this.bones;for(var C=0,x=b.length;C<x;C++){var i=b[C];var A=!1;var S;var r;var n;var a,o,s,c,l;0!=h&&(r=i.a,a=i.b,n=i.c,o=i.d,(c=Math.atan2(p,e)-Math.atan2(n,r)+y)>T.MathUtils.PI?c-=T.MathUtils.PI2:c<-T.MathUtils.PI&&(c+=T.MathUtils.PI2),c*=h,S=Math.cos(c),s=Math.sin(c),i.a=S*r-s*n,i.b=S*a-s*o,i.c=s*r+S*n,i.d=s*a+S*o,A=!0),0!=u&&(r=this.temp,t.localToWorld(r.set(this.data.offsetX,this.data.offsetY)),i.worldX+=(r.x-i.worldX)*u,i.worldY+=(r.y-i.worldY)*u,A=!0),0<_&&(l=Math.sqrt(i.a*i.a+i.c*i.c),n=Math.sqrt(e*e+p*p),1e-5<l&&(l=(l+(n-l+this.data.offsetScaleX)*_)/l),i.a*=l,i.c*=l,l=Math.sqrt(i.b*i.b+i.d*i.d),n=Math.sqrt(f*f+m*m),1e-5<l&&(l=(l+(n-l+this.data.offsetScaleY)*_)/l),i.b*=l,i.d*=l,A=!0),0<d&&(a=i.b,o=i.d,s=Math.atan2(o,a),(c=Math.atan2(m,f)-Math.atan2(p,e)-(s-Math.atan2(i.c,i.a)))>T.MathUtils.PI?c-=T.MathUtils.PI2:c<-T.MathUtils.PI&&(c+=T.MathUtils.PI2),c=s+(c+g)*d,l=Math.sqrt(a*a+o*o),i.b=Math.cos(c)*l,i.d=Math.sin(c)*l,A=!0),A&&(i.appliedValid=!1);}},TransformConstraint.prototype.applyRelativeWorld=function(){var h=this.rotateMix,u=this.translateMix,_=this.scaleMix,d=this.shearMix;var t=this.target;var e=t.a,f=t.b,i=t.c,p=t.d;var m=0<e*p-f*i?T.MathUtils.degRad:-T.MathUtils.degRad;var v=this.data.offsetRotation*m,y=this.data.offsetShearY*m;var g=this.bones;for(var b=0,C=g.length;b<C;b++){var r=g[b];var n=!1;var x,A,S;var a;var o,s,c,l;0!=h&&(a=r.a,s=r.b,x=r.c,c=r.d,(o=Math.atan2(i,e)+v)>T.MathUtils.PI?o-=T.MathUtils.PI2:o<-T.MathUtils.PI&&(o+=T.MathUtils.PI2),o*=h,A=Math.cos(o),S=Math.sin(o),r.a=A*a-S*x,r.b=A*s-S*c,r.c=S*a+A*x,r.d=S*s+A*c,n=!0),0!=u&&(a=this.temp,t.localToWorld(a.set(this.data.offsetX,this.data.offsetY)),r.worldX+=a.x*u,r.worldY+=a.y*u,n=!0),0<_&&(l=(Math.sqrt(e*e+i*i)-1+this.data.offsetScaleX)*_+1,r.a*=l,r.c*=l,l=(Math.sqrt(f*f+p*p)-1+this.data.offsetScaleY)*_+1,r.b*=l,r.d*=l,n=!0),0<d&&((o=Math.atan2(p,f)-Math.atan2(i,e))>T.MathUtils.PI?o-=T.MathUtils.PI2:o<-T.MathUtils.PI&&(o+=T.MathUtils.PI2),s=r.b,c=r.d,o=Math.atan2(c,s)+(o-T.MathUtils.PI/2+y)*d,l=Math.sqrt(s*s+c*c),r.b=Math.cos(o)*l,r.d=Math.sin(o)*l,n=!0),n&&(r.appliedValid=!1);}},TransformConstraint.prototype.applyAbsoluteLocal=function(){var h=this.rotateMix,t=this.translateMix,e=this.scaleMix,u=this.shearMix;var i=this.target;i.appliedValid||i.updateAppliedTransform();var _=this.bones;for(var r=0,d=_.length;r<d;r++){var n=_[r];n.appliedValid||n.updateAppliedTransform();var a=n.arotation;0!=h&&(l=i.arotation-a+this.data.offsetRotation,a+=(l-=360*(16384-(16384.499999999996-l/360|0)))*h);var o=n.ax,f=n.ay;0!=t&&(o+=(i.ax-o+this.data.offsetX)*t,f+=(i.ay-f+this.data.offsetY)*t);var s=n.ascaleX,c=n.ascaleY;0!=e&&(1e-5<s&&(s=(s+(i.ascaleX-s+this.data.offsetScaleX)*e)/s),1e-5<c&&(c=(c+(i.ascaleY-c+this.data.offsetScaleY)*e)/c));var p=n.ashearY;var l;0!=u&&(l=i.ashearY-p+this.data.offsetShearY,l-=360*(16384-(16384.499999999996-l/360|0)),n.shearY+=l*u),n.updateWorldTransformWith(o,f,a,s,c,n.ashearX,p);}},TransformConstraint.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix;var n=this.target;n.appliedValid||n.updateAppliedTransform();var a=this.bones;for(var o=0,h=a.length;o<h;o++){var s=a[o];s.appliedValid||s.updateAppliedTransform();var u=s.arotation;0!=t&&(u+=(n.arotation+this.data.offsetRotation)*t);var _=s.ax,d=s.ay;0!=e&&(_+=(n.ax+this.data.offsetX)*e,d+=(n.ay+this.data.offsetY)*e);var c=s.ascaleX,l=s.ascaleY;0!=i&&(1e-5<c&&(c*=(n.ascaleX-1+this.data.offsetScaleX)*i+1),1e-5<l&&(l*=(n.ascaleY-1+this.data.offsetScaleY)*i+1));var f=s.ashearY;0!=r&&(f+=(n.ashearY+this.data.offsetShearY)*r),s.updateWorldTransformWith(_,d,u,c,l,s.ashearX,f);}},T.TransformConstraint=TransformConstraint;}(r=r||{}),e=r=r||{},b=e.ConstraintData,y(TransformConstraintData,b),e.TransformConstraintData=TransformConstraintData,function(t){function Triangulator(){this.convexPolygons=new Array(),this.convexPolygonsIndices=new Array(),this.indicesArray=new Array(),this.isConcaveArray=new Array(),this.triangles=new Array(),this.polygonPool=new t.Pool(function(){return new Array();}),this.polygonIndicesPool=new t.Pool(function(){return new Array();});}Triangulator.prototype.triangulate=function(h){var t=h;var e=h.length>>1;var i=this.indicesArray;for(var r=i.length=0;r<e;r++)i[r]=r;var n=this.isConcaveArray;for(var r=n.length=0,u=e;r<u;++r)n[r]=Triangulator.isConcave(r,e,t,i);var a=this.triangles;for(a.length=0;3<e;){var o=e-1,r=0,s=1;for(;;){t:if(!n[r]){var _=i[o]<<1,d=i[r]<<1,f=i[s]<<1;var p=t[_],m=t[1+_];var v=t[d],y=t[1+d];var g=t[f],b=t[1+f];for(var c=(s+1)%e;c!=o;c=(c+1)%e)if(n[c]){var l=i[c]<<1;var C=t[l],l=t[1+l];if(Triangulator.positiveArea(g,b,p,m,C,l)&&Triangulator.positiveArea(p,m,v,y,C,l)&&Triangulator.positiveArea(v,y,g,b,C,l))break t;}break;}if(0==s){for(;n[r]&&0<--r;);break;}o=r,s=((r=s)+1)%e;}a.push(i[(e+r-1)%e]),a.push(i[r]),a.push(i[(r+1)%e]),i.splice(r,1),n.splice(r,1);var x=(--e+r-1)%e;var A=r==e?0:r;n[x]=Triangulator.isConcave(x,e,t,i),n[A]=Triangulator.isConcave(A,e,t,i);}return 3==e&&(a.push(i[2]),a.push(i[0]),a.push(i[1])),a;},Triangulator.prototype.decompose=function(h,u){var t=h;var e=this.convexPolygons;this.polygonPool.freeAll(e),e.length=0;var i=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(i),i.length=0;var r=this.polygonIndicesPool.obtain();r.length=0;var n=this.polygonPool.obtain();var _=-1,d=n.length=0;for(var a=0,f=u.length;a<f;a+=3){var p=u[a]<<1,m=u[a+1]<<1,v=u[a+2]<<1;var y=t[p],g=t[1+p];var b=t[m],C=t[1+m];var o=t[v],s=t[1+v];var x=!1;_==p&&(c=n.length-4,k=Triangulator.winding(n[c],n[c+1],n[c+2],n[c+3],o,s),G=Triangulator.winding(o,s,n[0],n[1],n[2],n[3]),k==d&&G==d&&(n.push(o),n.push(s),r.push(v),x=!0)),x||(0<n.length?(e.push(n),i.push(r)):(this.polygonPool.free(n),this.polygonIndicesPool.free(r)),(n=this.polygonPool.obtain()).length=0,n.push(y),n.push(g),n.push(b),n.push(C),n.push(o),n.push(s),(r=this.polygonIndicesPool.obtain()).length=0,r.push(p),r.push(m),r.push(v),d=Triangulator.winding(y,g,b,C,o,s),_=p);}0<n.length&&(e.push(n),i.push(r));for(a=0,f=e.length;a<f;a++)if(0!=(r=i[a]).length){var A=r[0];var S=r[r.length-1];var c;var T=(n=e[a])[c=n.length-4],w=n[c+1];var E=n[c+2],P=n[c+3];var M=n[0],R=n[1];var I=n[2],B=n[3];var D=Triangulator.winding(T,w,E,P,M,R);for(var l=0;l<f;l++){var L,V,O,F,N,k,G;l!=a&&3==(L=i[l]).length&&(V=L[0],O=L[1],F=L[2],o=(N=e[l])[N.length-2],s=N[N.length-1],V==A&&O==S&&(k=Triangulator.winding(T,w,E,P,o,s),G=Triangulator.winding(o,s,M,R,I,B),k==D&&G==D&&(N.length=0,L.length=0,n.push(o),n.push(s),r.push(F),T=E,w=P,E=o,P=s,l=0)));}}for(a=e.length-1;0<=a;a--)0==(n=e[a]).length&&(e.splice(a,1),this.polygonPool.free(n),r=i[a],i.splice(a,1),this.polygonIndicesPool.free(r));return e;},Triangulator.isConcave=function(t,e,i,r){var n=r[(e+t-1)%e]<<1;var a=r[t]<<1;r=r[(t+1)%e]<<1;return!this.positiveArea(i[n],i[1+n],i[a],i[1+a],i[r],i[1+r]);},Triangulator.positiveArea=function(t,e,i,r,n,a){return 0<=t*(a-r)+i*(e-a)+n*(r-e);},Triangulator.winding=function(t,e,i,r,n,a){i-=t,r-=e;return 0<=n*r-a*i+i*e-t*r?1:-1;},t.Triangulator=Triangulator;}(r=r||{}),function(t){function IntSet(){this.array=new Array();}function Color(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.r=t=void 0===t?0:t,this.g=e,this.b=i,this.a=r;}function MathUtils(){}IntSet.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e;},IntSet.prototype.contains=function(t){return null!=this.array[0|t];},IntSet.prototype.remove=function(t){this.array[0|t]=void 0;},IntSet.prototype.clear=function(){this.array.length=0;},t.IntSet=IntSet,Color.prototype.set=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this.clamp(),this;},Color.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this;},Color.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this;},Color.prototype.add=function(t,e,i,r){return this.r+=t,this.g+=e,this.b+=i,this.a+=r,this.clamp(),this;},Color.prototype.clamp=function(){return this.r<0?this.r=0:1<this.r&&(this.r=1),this.g<0?this.g=0:1<this.g&&(this.g=1),this.b<0?this.b=0:1<this.b&&(this.b=1),this.a<0?this.a=0:1<this.a&&(this.a=1),this;},Color.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255;},Color.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255;},Color.WHITE=new Color(1,1,1,1),Color.RED=new Color(1,0,0,1),Color.GREEN=new Color(0,1,0,1),Color.BLUE=new Color(0,0,1,1),Color.MAGENTA=new Color(1,0,1,1),t.Color=Color,MathUtils.clamp=function(t,e,i){return t<e?e:i<t?i:t;},MathUtils.cosDeg=function(t){return Math.cos(t*MathUtils.degRad);},MathUtils.sinDeg=function(t){return Math.sin(t*MathUtils.degRad);},MathUtils.signum=function(t){return 0<t?1:t<0?-1:0;},MathUtils.toInt=function(t){return 0<t?Math.floor(t):Math.ceil(t);},MathUtils.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e;},MathUtils.randomTriangular=function(t,e){return MathUtils.randomTriangularWith(t,e,.5*(t+e));},MathUtils.randomTriangularWith=function(t,e,i){var r=Math.random();var n=e-t;return r<=(i-t)/n?t+Math.sqrt(r*n*(i-t)):e-Math.sqrt((1-r)*n*(e-i));},MathUtils.PI2=2*(MathUtils.PI=3.1415927),MathUtils.radDeg=MathUtils.radiansToDegrees=180/MathUtils.PI,MathUtils.degRad=MathUtils.degreesToRadians=MathUtils.PI/180,t.MathUtils=MathUtils;Interpolation.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i);};var e=Interpolation;function Interpolation(){}t.Interpolation=e;y(Pow,i=e),Pow.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1;};e=Pow;function Pow(t){var e=i.call(this)||this;return e.power=2,e.power=t,e;}var i;t.Pow=e;y(PowOut,r=e),PowOut.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1;};e=PowOut;function PowOut(t){return r.call(this,t)||this;}var r;function Utils(){}function DebugUtils(){}function Pool(t){this.items=new Array(),this.instantiator=t;}function Vector2(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e;}function TimeKeeper(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0;}function WindowedMean(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t);}t.PowOut=e,Utils.arrayCopy=function(t,e,i,r,n){for(var a=e,o=r;a<e+n;a++,o++)i[o]=t[a];},Utils.setArraySize=function(t,e,i){void 0===i&&(i=0);var r=t.length;if(r==e)return t;if(r<(t.length=e))for(var n=r;n<e;n++)t[n]=i;return t;},Utils.ensureArrayCapacity=function(t,e,i){return void 0===i&&(i=0),t.length>=e?t:Utils.setArraySize(t,e,i);},Utils.newArray=function(t,e){var i=new Array(t);for(var r=0;r<t;r++)i[r]=e;return i;},Utils.newFloatArray=function(t){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);var e=new Array(t);for(var i=0;i<e.length;i++)e[i]=0;return e;},Utils.newShortArray=function(t){if(Utils.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);var e=new Array(t);for(var i=0;i<e.length;i++)e[i]=0;return e;},Utils.toFloatArray=function(t){return Utils.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t;},Utils.toSinglePrecision=function(t){return Utils.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t;},Utils.webkit602BugfixHelper=function(t,e){},Utils.contains=function(t,e,i){void 0===i&&(i=!0);for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1;},Utils.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t.Utils=Utils,DebugUtils.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY);}},t.DebugUtils=DebugUtils,Pool.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator();},Pool.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t);},Pool.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e];},Pool.prototype.clear=function(){this.items.length=0;},t.Pool=Pool,Vector2.prototype.set=function(t,e){return this.x=t,this.y=e,this;},Vector2.prototype.length=function(){var t=this.x;var e=this.y;return Math.sqrt(t*t+e*e);},Vector2.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this;},t.Vector2=Vector2,TimeKeeper.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0);},t.TimeKeeper=TimeKeeper,WindowedMean.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length;},WindowedMean.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0;},WindowedMean.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){var t=0;for(var e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1;}return this.mean;}return 0;},t.WindowedMean=WindowedMean;}(r=r||{}),Math.fround||(Math.fround=(C=new Float32Array(1),function(t){return C[0]=t,C[0];}));var x=r=r||{};function J2T(t){if(null==t)throw new Error("name cannot be null.");this.name=t;}function VertexAttachment(t){t=A.call(this,t)||this;return t.id=(65535&VertexAttachment.nextID++)<<11,t.worldVerticesLength=0,t.deformAttachment=t;}var A;function BoundingBoxAttachment(t){t=w.call(this,t)||this;return t.color=new S.Color(1,1,1,1),t;}var S,w;function ClippingAttachment(t){t=P.call(this,t)||this;return t.color=new E.Color(.2275,.2275,.8078,1),t;}var E,P;function MeshAttachment(t){t=M.call(this,t)||this;return t.color=new u.Color(1,1,1,1),t.tempColor=new u.Color(0,0,0,0),t;}var u,M;function PathAttachment(t){t=I.call(this,t)||this;return t.closed=!1,t.constantSpeed=!1,t.color=new R.Color(1,1,1,1),t;}var R,I;function PointAttachment(t){t=D.call(this,t)||this;return t.color=new B.Color(.38,.94,0,1),t;}var B,D;function RegionAttachment(t){t=V.call(this,t)||this;return t.x=0,t.y=0,t.scaleX=1,t.scaleY=1,t.rotation=0,t.width=0,t.height=0,t.color=new L.Color(1,1,1,1),t.offset=L.Utils.newFloatArray(8),t.uvs=L.Utils.newFloatArray(8),t.tempColor=new L.Color(1,1,1,1),t;}var L,V;var r;function SwirlEffect(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e;}var O;x.Attachment=J2T,y(VertexAttachment,A=J2T),VertexAttachment.prototype.computeWorldVertices=function(h,u,_,t,d,f){_=d+(_>>1)*f;var p=h.bone.skeleton;var m=h.deform;var e=this.vertices;var i=this.bones;if(null!=i){var r=0,v=0;for(var y=0;y<u;y+=2)r+=(n=i[r])+1,v+=n;var g=p.bones;if(0==m.length)for(s=d,c=3*v;s<_;s+=f){var b=0,C=0;var n=i[r++];for(n+=r;r<n;r++,c+=3){l=g[i[r]];var a=e[c],o=e[c+1],x=e[c+2];b+=(a*l.a+o*l.b+l.worldX)*x,C+=(a*l.c+o*l.d+l.worldY)*x;}t[s]=b,t[s+1]=C;}else{var A=m;for(var s=d,c=3*v,S=v<<1;s<_;s+=f){b=0,C=0;n=i[r++];for(n+=r;r<n;r++,c+=3,S+=2){l=g[i[r]];a=e[c]+A[S],o=e[c+1]+A[S+1],x=e[c+2];b+=(a*l.a+o*l.b+l.worldX)*x,C+=(a*l.c+o*l.d+l.worldY)*x;}t[s]=b,t[s+1]=C;}}}else{var l;0<m.length&&(e=m);var T=(l=h.bone).worldX;var w=l.worldY;var E=l.a,c=l.b,P=l.c,M=l.d;for(var R=u,s=d;s<_;R+=2,s+=f){var a=e[R],o=e[R+1];t[s]=a*E+o*c+T,t[s+1]=a*P+o*M+w;}}},VertexAttachment.prototype.copyTo=function(t){null!=this.bones?(t.bones=new Array(this.bones.length),x.Utils.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=x.Utils.newFloatArray(this.vertices.length),x.Utils.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment;},VertexAttachment.nextID=0,x.VertexAttachment=VertexAttachment,(t=(t=r=r||{}).AttachmentType||(t.AttachmentType={}))[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",S=r=r||{},w=S.VertexAttachment,y(BoundingBoxAttachment,w),BoundingBoxAttachment.prototype.copy=function(){var t=new BoundingBoxAttachment(name);return this.copyTo(t),t.color.setFromColor(this.color),t;},S.BoundingBoxAttachment=BoundingBoxAttachment,E=r=r||{},P=E.VertexAttachment,y(ClippingAttachment,P),ClippingAttachment.prototype.copy=function(){var t=new ClippingAttachment(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t;},E.ClippingAttachment=ClippingAttachment,u=r=r||{},M=u.VertexAttachment,y(MeshAttachment,M),MeshAttachment.prototype.updateUVs=function(){var t=this.regionUVs;null!=this.uvs&&this.uvs.length==t.length||(this.uvs=u.Utils.newFloatArray(t.length));var e=this.uvs;var h=this.uvs.length;var i=this.region.u,r=this.region.v,n=0,a=0;if(this.region instanceof u.TextureAtlasRegion){var o=this.region;var s=o.texture.getImage().width,c=o.texture.getImage().height;switch(o.degrees){case 90:i-=(o.originalHeight-o.offsetY-o.height)/s,r-=(o.originalWidth-o.offsetX-o.width)/c,n=o.originalHeight/s,a=o.originalWidth/c;for(var l=0;l<h;l+=2)e[l]=i+t[l+1]*n,e[l+1]=r+(1-t[l])*a;return;case 180:i-=(o.originalWidth-o.offsetX-o.width)/s,r-=o.offsetY/c,n=o.originalWidth/s,a=o.originalHeight/c;for(l=0;l<h;l+=2)e[l]=i+(1-t[l])*n,e[l+1]=r+(1-t[l+1])*a;return;case 270:i-=o.offsetY/s,r-=o.offsetX/c,n=o.originalHeight/s,a=o.originalWidth/c;for(l=0;l<h;l+=2)e[l]=i+(1-t[l+1])*n,e[l+1]=r+t[l]*a;return;}i-=o.offsetX/s,r-=(o.originalHeight-o.offsetY-o.height)/c,n=o.originalWidth/s,a=o.originalHeight/c;}else null==this.region?(i=r=0,n=a=1):(n=this.region.u2-i,a=this.region.v2-r);for(l=0;l<h;l+=2)e[l]=i+t[l]*n,e[l+1]=r+t[l+1]*a;},MeshAttachment.prototype.getParentMesh=function(){return this.parentMesh;},MeshAttachment.prototype.setParentMesh=function(t){null!=(this.parentMesh=t)&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength);},MeshAttachment.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new MeshAttachment(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),u.Utils.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),u.Utils.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),u.Utils.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),u.Utils.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t;},MeshAttachment.prototype.newLinkedMesh=function(){var t=new MeshAttachment(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t;},u.MeshAttachment=MeshAttachment,R=r=r||{},I=R.VertexAttachment,y(PathAttachment,I),PathAttachment.prototype.copy=function(){var t=new PathAttachment(name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),R.Utils.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t;},R.PathAttachment=PathAttachment,B=r=r||{},D=B.VertexAttachment,y(PointAttachment,D),PointAttachment.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e;},PointAttachment.prototype.computeWorldRotation=function(t){var e=B.MathUtils.cosDeg(this.rotation),i=B.MathUtils.sinDeg(this.rotation);var r=e*t.a+i*t.b;e=e*t.c+i*t.d;return Math.atan2(e,r)*B.MathUtils.radDeg;},PointAttachment.prototype.copy=function(){var t=new PointAttachment(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t;},B.PointAttachment=PointAttachment,L=r=r||{},V=L.Attachment,y(RegionAttachment,V),RegionAttachment.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX;var e=this.height/this.region.originalHeight*this.scaleY;var i=-this.width/2*this.scaleX+this.region.offsetX*t;var r=-this.height/2*this.scaleY+this.region.offsetY*e;t=i+this.region.width*t;e=r+this.region.height*e;var n=this.rotation*Math.PI/180;var a=Math.cos(n);n=Math.sin(n);var o=i*a+this.x;i*=n;var s=r*a+this.y;r*=n;var c=t*a+this.x;t*=n;a=e*a+this.y;e*=n;n=this.offset;n[RegionAttachment.OX1]=o-r,n[RegionAttachment.OY1]=s+i,n[RegionAttachment.OX2]=o-e,n[RegionAttachment.OY2]=a+i,n[RegionAttachment.OX3]=c-e,n[RegionAttachment.OY3]=a+t,n[RegionAttachment.OX4]=c-r,n[RegionAttachment.OY4]=s+t;},RegionAttachment.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2);},RegionAttachment.prototype.computeWorldVertices=function(t,e,i,h){var r=this.offset;var n=t.worldX,a=t.worldY;var o=t.a,s=t.b,u=t.c,t=t.d;var c,l;c=r[RegionAttachment.OX1],l=r[RegionAttachment.OY1],e[i]=c*o+l*s+n,e[i+1]=c*u+l*t+a,c=r[RegionAttachment.OX2],l=r[RegionAttachment.OY2],e[i+=h]=c*o+l*s+n,e[i+1]=c*u+l*t+a,c=r[RegionAttachment.OX3],l=r[RegionAttachment.OY3],e[i+=h]=c*o+l*s+n,e[i+1]=c*u+l*t+a,c=r[RegionAttachment.OX4],l=r[RegionAttachment.OY4],e[i+=h]=c*o+l*s+n,e[i+1]=c*u+l*t+a;},RegionAttachment.prototype.copy=function(){var t=new RegionAttachment(name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,L.Utils.arrayCopy(this.uvs,0,t.uvs,0,8),L.Utils.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t;},RegionAttachment.OX1=0,RegionAttachment.OY1=1,RegionAttachment.OX2=2,RegionAttachment.OY2=3,RegionAttachment.OX3=4,RegionAttachment.OY3=5,RegionAttachment.OX4=6,RegionAttachment.OY4=7,RegionAttachment.X1=0,RegionAttachment.Y1=1,RegionAttachment.C1R=2,RegionAttachment.C1G=3,RegionAttachment.C1B=4,RegionAttachment.C1A=5,RegionAttachment.U1=6,RegionAttachment.V1=7,RegionAttachment.X2=8,RegionAttachment.Y2=9,RegionAttachment.C2R=10,RegionAttachment.C2G=11,RegionAttachment.C2B=12,RegionAttachment.C2A=13,RegionAttachment.U2=14,RegionAttachment.V2=15,RegionAttachment.X3=16,RegionAttachment.Y3=17,RegionAttachment.C3R=18,RegionAttachment.C3G=19,RegionAttachment.C3B=20,RegionAttachment.C3A=21,RegionAttachment.U3=22,RegionAttachment.V3=23,RegionAttachment.X4=24,RegionAttachment.Y4=25,RegionAttachment.C4R=26,RegionAttachment.C4G=27,RegionAttachment.C4B=28,RegionAttachment.C4A=29,RegionAttachment.U4=30,RegionAttachment.V4=31,L.RegionAttachment=RegionAttachment,function(n){function JitterEffect(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e;}JitterEffect.prototype.begin=function(t){},JitterEffect.prototype.transform=function(t,e,i,r){t.x+=n.MathUtils.randomTriangular(-this.jitterX,this.jitterY),t.y+=n.MathUtils.randomTriangular(-this.jitterX,this.jitterY);},JitterEffect.prototype.end=function(){},n.JitterEffect=JitterEffect;}(r=r||{}),O=r=r||{},SwirlEffect.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY;},SwirlEffect.prototype.transform=function(t,e,i,r){var n=this.angle*O.MathUtils.degreesToRadians;var a=t.x-this.worldX;var o=t.y-this.worldY;var s=Math.sqrt(a*a+o*o);s<this.radius&&(n=this.interpolation.apply(0,n,(this.radius-s)/this.radius),s=Math.cos(n),n=Math.sin(n),t.x=s*a-n*o+this.worldX,t.y=n*a+s*o+this.worldY);},SwirlEffect.prototype.end=function(){},SwirlEffect.interpolation=new O.PowOut(2),O.SwirlEffect=SwirlEffect,a.exports=r;},{}],356:[function(t,e,i){"use strict";var o=t("./track-entry-listeners");var M=t("./lib/spine");var R=[];var F=[];var N=0;var I=0;var B=0;var k=null;var G=null;var D=0;var z=0;var L=0;var v=0;var y=null;var g=null;var V=0,O=0;var b,C,x,A;var S,T;var p=new M.Color(1,1,1,1);var m=new M.Color(1,1,1,1);var U=[0,1,2,2,3,0];var a=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null;},init:function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t;},clear:function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame();},bind:function(t){var e=function(t){t&&t.animation.name===this._animationName&&(this.isCompleted=!0);}.bind(this);t.complete=e;},unbind:function(t){t.complete=null;},begin:function(){var t,e,i,r;this._invalid&&((r=(t=this._skeletonInfo).curAnimationCache)&&r!==this&&(this._privateMode?r.invalidAllFrame():r.updateToFrame()),r=t.skeleton,e=t.listener,i=t.state,r=r.data.findAnimation(this._animationName),i.setAnimationWith(0,r,!1),this.bind(e),(t.curAnimationCache=this)._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1);},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener));},_needToUpdate:function(t){return!this.isCompleted&&this.totalTime<30&&(null==t||this._frameIdx<t);},updateToFrame:function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._skeletonInfo;var i=e.skeleton;var r=e.clipper;var n=e.state;for(;i.update(1/60),n.update(1/60),n.apply(i),i.updateWorldTransform(),this._frameIdx++,this._updateFrame(i,r,this._frameIdx),this.totalTime+=1/60,this._needToUpdate(t););this.end();}},isInited:function(){return this._inited;},isInvalid:function(){return this._invalid;},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0;},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame();},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame());},_updateFrame:function(t,e,i){v=L=z=D=I=N=B=0,g=y=G=k=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};i=this.frames[i];var r=this._tempSegments=i.segments;var h=this._tempColors=i.colors;var u=this._tempBoneInfos=i.boneInfos;this._traverseSkeleton(t,e),0<v&&(h[v-1].vfOffset=B),h.length=v,u.length=N;t=L-1;if(0<=t&&(0<z?((e=r[t]).indexCount=z,e.vfCount=6*D,e.vertexCount=D,r.length=L):r.length=L-1),0!=r.length){var n=i.vertices;var a=i.uintVert;(!n||n.length<B)&&(n=i.vertices=new Float32Array(B),a=i.uintVert=new Uint32Array(n.buffer));for(var o=0,s=0;o<B;)n[o++]=R[s++],n[o++]=R[s++],n[o++]=R[s++],n[o++]=R[s++],a[o++]=R[s++],a[o++]=R[s++];var c=i.indices;(!c||c.length<I)&&(c=i.indices=new Uint16Array(I));for(var l=0;l<I;l++)c[l]=F[l];i.vertices=n,i.uintVert=a,i.indices=c;}},fillVertices:function(t,e,i,r,n){if(A=i.a*e.a*t.a*255,b=e.r*t.r*255,C=e.g*t.g*255,x=e.b*t.b*255,p.r=b*i.r,p.g=C*i.g,p.b=x*i.b,p.a=A,null==n.darkColor?m.set(0,0,0,1):(m.r=n.darkColor.r*b,m.g=n.darkColor.g*C,m.b=n.darkColor.b*x),m.a=0,S=(p.a<<24>>>0)+(p.b<<16)+(p.g<<8)+p.r,T=(m.a<<24>>>0)+(m.b<<16)+(m.g<<8)+m.r,y===S&&g===T||(e=this._tempColors,y=S,g=T,0<v&&(e[v-1].vfOffset=B),e[v++]={fr:p.r,fg:p.g,fb:p.b,fa:p.a,dr:m.r,dg:m.g,db:m.b,da:m.a,vfOffset:0}),r.isClipping()){r.clipTriangles(R,V,F,O,R,p,m,!0,6,I,B,B+2);var a=r.clippedVertices;var o=r.clippedTriangles;O=o.length,V=a.length/12*6;for(var h=0,u=I,_=o.length;h<_;)F[u++]=o[h++];for(var s=0,d=a.length,c=B;s<d;s+=12,c+=6)R[c]=a[s],R[c+1]=a[s+1],R[c+2]=a[s+6],R[c+3]=a[s+7],R[c+4]=S,R[c+5]=T;}else for(var l=B,f=B+V;l<f;l+=6)R[l+4]=S,R[l+5]=T;},_traverseSkeleton:function(t,e){var h=this._tempSegments;var u=this._tempBoneInfos;var _=t.color;var i,d,r;var f,p;var n;var a;var o;var s;var m=t.bones;if(this._enableCacheAttachedInfo)for(var v=0,y=m.length;v<y;v++,N++){var c=m[v];var l=u[N];(l=l||(u[N]={})).a=c.a,l.b=c.b,l.c=c.c,l.d=c.d,l.worldX=c.worldX,l.worldY=c.worldY;}for(var g=0,b=t.drawOrder.length;g<b;g++)if(s=t.drawOrder[g],O=V=0,i=s.getAttachment()){if(f=i instanceof M.RegionAttachment,p=i instanceof M.MeshAttachment,i instanceof M.ClippingAttachment)e.clipStart(s,i);else if(f||p){if(n=i.region.texture._texture){if(o=s.data.blendMode,k===n.url&&G===o||(k=n.url,G=o,0<=(a=L-1)&&(0<z?((a=h[a]).indexCount=z,a.vertexCount=D,a.vfCount=6*D):L--),h[L]={tex:n,blendMode:o,indexCount:0,vertexCount:0,vfCount:0},L++,D=z=0),f?(r=U,V=24,O=6,i.computeWorldVertices(s.bone,R,B,6)):p&&(r=i.triangles,V=6*(i.worldVerticesLength>>1),O=r.length,i.computeWorldVertices(s,0,i.worldVerticesLength,R,B,6)),0!=V&&0!=O){for(var C=0,x=I,A=r.length;C<A;)F[x++]=r[C++];d=i.uvs;for(var S=B,T=B+V,w=0;S<T;S+=6,w+=2)R[S+2]=d[w],R[S+3]=d[w+1];if(a=i.color,n=s.color,this.fillVertices(_,a,n,e,s),0<O){for(var E=I,P=I+O;E<P;E++)F[E]+=D;I+=O,B+=V,z+=O,D+=V/6;}e.clipEndWithSlot(s);}else e.clipEndWithSlot(s);}else e.clipEndWithSlot(s);}else e.clipEndWithSlot(s);}else e.clipEndWithSlot(s);e.clipEnd();}});t=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._skeletonCache={};},enablePrivateMode:function(){this._privateMode=!0;},clear:function(){this._animationPool={},this._skeletonCache={};},removeSkeleton:function(t){var e=this._skeletonCache[t];if(e){var i=e.animationsCache;for(var r in i){var n=i[r];n&&(this._animationPool[t+"#"+r]=n).clear();}delete this._skeletonCache[t];}},getSkeletonCache:function(t,e){var i=this._skeletonCache[t];var r,n,a;return i||(e=new M.Skeleton(e),r=new M.SkeletonClipping(),n=new M.AnimationStateData(e.data),n=new M.AnimationState(n),a=new o(),n.addListener(a),this._skeletonCache[t]=i={skeleton:e,clipper:r,state:n,listener:a,animationsCache:{},curAnimationCache:null}),i;},getAnimationCache:function(t,e){t=this._skeletonCache[t];return t?t.animationsCache[e]:null;},invalidAnimationCache:function(t){t=this._skeletonCache[t];if(t&&t.skeleton){var e=t.animationsCache;for(var i in e)e[i].invalidAllFrame();}},initAnimationCache:function(t,e){if(!e)return null;var i=this._skeletonCache[t];var r=i&&i.skeleton;if(!r)return null;if(!r.data.findAnimation(e))return null;r=i.animationsCache;var n=r[e];return n||((n=this._animationPool[t=t+"#"+e])?delete this._animationPool[t]:(n=new a())._privateMode=this._privateMode,n.init(i,e),r[e]=n),n;},updateAnimationCache:function(t,e){if(e){e=this.initAnimationCache(t,e);if(!e)return null;e.updateAllFrame();}else{e=this._skeletonCache[t];if(e&&e.skeleton){var i=e.animationsCache;for(var r in i)i[r].updateAllFrame();}}}});t.FrameTime=1/60,t.sharedCache=new t(),e.exports=t;},{"./lib/spine":355,"./track-entry-listeners":360}],357:[function(t,e,i){"use strict";var r=t("./skeleton-cache").sharedCache;t=cc.Class({name:"sp.SkeletonData",extends:cc.Asset,ctor:function(){this.reset();},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):"";}},skeletonJson:{get:function(){return this._skeletonJson;},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash);}},_atlasText:"",atlasText:{get:function(){return this._atlasText;},set:function(t){this._atlasText=t,this.reset();}},textures:{default:[],type:[cc.Texture2D]},textureNames:{default:[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer;},set:function(t){this._buffer=t.buffer||t,this.reset();},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null;},ensureTexturesLoaded:function(t,e){var i=this.textures;var r=i.length;if(0!=r){var n=0;var a=function(){r<=++n&&(t&&t.call(e,!0),t=null);};for(var o=0;o<r;o++){var s=i[o];s.loaded?a():s.once("load",a);}}else t.call(e,!1);},isTexturesLoaded:function(){var t=this.textures;var e=t.length;for(var i=0;i<e;i++)if(!t[i].loaded)return!1;return!0;},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&0<this.textures.length)&&this.textureNames&&0<this.textureNames.length)return t||cc.errorID(7507,this.name),null;t=this._getAtlas(t);if(!t)return null;var e=new sp.spine.AtlasAttachmentLoader(t);var i=null;var r=null;return i=this.skeletonJson?(r=new sp.spine.SkeletonJson(e),this.skeletonJson):(r=new sp.spine.SkeletonBinary(e),new Uint8Array(this._nativeAsset)),r.scale=this.scale,this._skeletonCache=r.readSkeletonData(i),t.dispose(),this._skeletonCache;},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(t){var e=this.textureNames;for(var i=0;i<e.length;i++){var r,n;if(e[i]===t)return r=this.textures[i],(n=new sp.SkeletonTexture({width:r.width,height:r.height})).setRealTexture(r),n;}return cc.errorID(7506,t),null;},_getAtlas:function(t){return this._atlasCache||(this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||cc.errorID(7508,this.name),null));},destroy:function(){r.removeSkeleton(this._uuid),this._super();}});sp.SkeletonData=e.exports=t;},{"./skeleton-cache":356}],358:[function(t,e,i){"use strict";sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture",extends:sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(t){this._texture=t;},getRealTexture:function(){return this._texture;},setFilters:function(t,e){this._texture&&this._texture.setFilters(t,e);},setWraps:function(t,e){this._texture&&this._texture.setWrapMode(t,e);},dispose:function(){}});},{}],359:[function(t,e,i){"use strict";i.__esModule=!0,i.default=void 0;r=(r=t("../../cocos2d/core/renderer/assembler"))&&r.__esModule?r:{default:r};var r;function _createSuper(i){return function(){var t=_getPrototypeOf(i);e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0;}catch(t){return!1;}}()?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments);t=this;var e;if(!e||"object"!=typeof e&&"function"!=typeof e){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t;}return e;};}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t);})(t);}var n=t("./Skeleton");var H=t("./lib/spine");var a=t("../../cocos2d/core/renderer/render-flow");t=t("../../cocos2d/core/renderer/webgl/vertex-format");var o=t.vfmtPosUvColor;var s=t.vfmtPosUvTwoColor;var c=cc.gfx;var M=0;var j=[0,1,2,2,3,0];var X=cc.color(0,0,255,255);var q=cc.color(255,0,0,255);var Y=cc.color(0,255,0,255);var J=cc.color(255,255,0,255);var g=null;var b=null;var C=null,x=null;var A;var S;var Z;var Q;var O;var K;var $;var tt;var T,w,E,P;var R,I;var l;var F;var et;g=new H.Color(1,1,1,1),b=new H.Color(1,1,1,1),C=new H.Vector2(),x=new H.Vector2();var B,D,N=0,k=0,it=0,G=0,z=0;var L,V,rt;var nt;var at;var ot,st,ct,lt,ht,ut,_t,dt;var h,u,_,d,f,p,m;var U,W,ft,pt,mt,vt;function _getSlotMaterial(t,e){var i,r;switch(e){case H.BlendMode.Additive:i=A?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE;break;case H.BlendMode.Multiply:i=cc.macro.DST_COLOR,r=cc.macro.ONE_MINUS_SRC_ALPHA;break;case H.BlendMode.Screen:i=cc.macro.ONE,r=cc.macro.ONE_MINUS_SRC_COLOR;break;default:H.BlendMode.Normal;i=A?cc.macro.ONE:cc.macro.SRC_ALPHA,r=cc.macro.ONE_MINUS_SRC_ALPHA;}e=!U.enableBatch;var n=U._materials[0];if(!n)return null;var a=t.getId()+i+r+O+e;var o=U._materialCache;var s=o[a];return s||(o.baseMaterial?s=cc.MaterialVariant.create(n):o.baseMaterial=s=n,s.define("CC_USE_MODEL",e),s.define("USE_TINT",O),s.setProperty("texture",t),s.setBlend(!0,c.BLEND_FUNC_ADD,i,r,c.BLEND_FUNC_ADD,i,r),o[a]=s),s;}function _handleColor(t){f=t.fa*P,h=T*(S=A?f/255:1),u=w*S,_=E*S,d=t.fr*h,m=t.fg*u,p=t.fb*_,R=(f<<24>>>0)+(p<<16)+(m<<8)+d,f=t.dr*h,p=t.dg*u,m=t.db*_,I=((A?255:0)<<24>>>0)+(m<<16)+(p<<8)+f;}function _spineColorToInt32(t){return(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r;}t=function(t){var e;e=t,(i=SpineAssembler).prototype=Object.create(e.prototype),(i.prototype.constructor=i).__proto__=e;_createSuper(SpineAssembler);function SpineAssembler(){return t.apply(this,arguments)||this;}var i=SpineAssembler.prototype;return i.updateRenderData=function(t){t.isAnimationCached()||(t=t._skeleton)&&t.updateWorldTransform();},i.fillVertices=function(t,h,e,u,_){var i=W._vData,d=W._iData,r=W._uintVData;if(g.a=e.a*h.a*t.a*P*255,S=A?g.a:255,L=T*h.r*t.r*S,V=w*h.g*t.g*S,rt=E*h.b*t.b*S,g.r=L*e.r,g.g=V*e.g,g.b=rt*e.b,null==_.darkColor?b.set(0,0,0,1):(b.r=_.darkColor.r*L,b.g=_.darkColor.g*V,b.b=_.darkColor.b*rt),b.a=A?255:0,u.isClipping()){h=i.subarray(k+2);u.clipTriangles(i.subarray(k),N,d.subarray(z),G,h,g,b,O,F);var n=new Float32Array(u.clippedVertices);t=u.clippedTriangles;if(G=t.length,N=n.length/et*F,e=W.request(N/F,G),z=e.indiceOffset,it=e.vertexOffset,k=e.byteOffset>>2,i=W._vData,d=W._iData,r=W._uintVData,d.set(t,z),vt)for(var a=0,f=n.length,o=k;a<f;a+=et,o+=F)C.x=n[a],C.y=n[a+1],g.set(n[a+2],n[a+3],n[a+4],n[a+5]),x.x=n[a+6],x.y=n[a+7],O?b.set(n[a+8],n[a+9],n[a+10],n[a+11]):b.set(0,0,0,0),vt.transform(C,x,g,b),i[o]=C.x,i[o+1]=C.y,i[o+2]=x.x,i[o+3]=x.y,r[o+4]=_spineColorToInt32(g),O&&(r[o+5]=_spineColorToInt32(b));else for(var s=0,p=n.length,c=k;s<p;s+=et,c+=F)i[c]=n[s],i[c+1]=n[s+1],i[c+2]=n[s+6],i[c+3]=n[s+7],R=(n[s+5]<<24>>>0)+(n[s+4]<<16)+(n[s+3]<<8)+n[s+2],r[c+4]=R,O&&(I=(n[s+11]<<24>>>0)+(n[s+10]<<16)+(n[s+9]<<8)+n[s+8],r[c+5]=I);}else if(vt)for(var l=k,m=k+N;l<m;l+=F)C.x=i[l],C.y=i[l+1],x.x=i[l+2],x.y=i[l+3],vt.transform(C,x,g,b),i[l]=C.x,i[l+1]=C.y,i[l+2]=x.x,i[l+3]=x.y,r[l+4]=_spineColorToInt32(g),O&&(r[l+5]=_spineColorToInt32(b));else{R=_spineColorToInt32(g),I=_spineColorToInt32(b);for(var v=k,y=k+N;v<y;v+=F)r[v+4]=R,O&&(r[v+5]=I);}},i.realTimeTraverse=function(h){var t;var u;var e=U._skeleton;var _=e.color;var i=U._debugRenderer;var r=U._clipper;var d=null;var f,n;var p,m;var a;var o;var s;Z=U._startSlotIndex,Q=U._endSlotIndex,nt=-1==Z?!0:!1,K=U.debugSlots,$=U.debugBones,tt=U.debugMesh,i&&($||K||tt)&&(i.clear(),i.lineWidth=2),et=O?12:8;for(var v=z=G=it=k=N=0,y=e.drawOrder.length;v<y;v++)if(o=e.drawOrder[v],nt=0<=Z&&Z==o.data.index?!0:nt){if(0<=Q&&Q==o.data.index&&(nt=!1),G=N=0,s=o.getAttachment()){if(p=s instanceof H.RegionAttachment,m=s instanceof H.MeshAttachment,s instanceof H.ClippingAttachment)r.clipStart(o,s);else if(p||m){if(d=_getSlotMaterial(s.region.texture._texture,o.data.blendMode)){if(!at&&d.getHash()===ft.material.getHash()||(at=!1,ft._flush(),ft.node=pt,ft.material=d),p){if(n=j,N=4*F,G=6,a=W.request(4,6),z=a.indiceOffset,it=a.vertexOffset,k=a.byteOffset>>2,t=W._vData,u=W._iData,s.computeWorldVertices(o.bone,t,k,F),i&&K){i.strokeColor=X,i.moveTo(t[k],t[k+1]);for(var g=k+F,b=k+N;g<b;g+=F)i.lineTo(t[g],t[g+1]);i.close(),i.stroke();}}else if(m&&(n=s.triangles,N=(s.worldVerticesLength>>1)*F,G=n.length,a=W.request(N/F,G),z=a.indiceOffset,it=a.vertexOffset,k=a.byteOffset>>2,t=W._vData,u=W._iData,s.computeWorldVertices(o,0,s.worldVerticesLength,t,k,F),i&&tt)){i.strokeColor=J;for(var C=0,x=n.length;C<x;C+=3){var A=n[C]*F+k;var S=n[C+1]*F+k;var T=n[C+2]*F+k;i.moveTo(t[A],t[A+1]),i.lineTo(t[S],t[S+1]),i.lineTo(t[T],t[T+1]),i.close(),i.stroke();}}if(0!=N&&0!=G){u.set(n,z),f=s.uvs;for(var w=k,E=k+N,P=0;w<E;w+=F,P+=2)t[w+2]=f[P],t[w+3]=f[P+1];if(p=s.color,m=o.color,this.fillVertices(_,p,m,r,o),0<G){for(var M=z,R=z+G;M<R;M++)u[M]+=it;if(h){s=h.m,ct=s[0],lt=s[4],ht=s[12],ut=s[1],_t=s[5],dt=s[13];for(var c=k,I=k+N;c<I;c+=F)ot=t[c],st=t[c+1],t[c]=ot*ct+st*lt+ht,t[c+1]=ot*ut+st*_t+dt;}W.adjust(N/F,G);}r.clipEndWithSlot(o);}else r.clipEndWithSlot(o);}else r.clipEndWithSlot(o);}else r.clipEndWithSlot(o);}else r.clipEndWithSlot(o);}else r.clipEndWithSlot(o);if(r.clipEnd(),i&&$){var l;i.strokeColor=q,i.fillColor=X;for(var B=0,D=e.bones.length;B<D;B++){var L=(l=e.bones[B]).data.length*l.a+l.worldX;var V=l.data.length*l.c+l.worldY;i.moveTo(l.worldX,l.worldY),i.lineTo(L,V),i.stroke(),i.circle(l.worldX,l.worldY,1.5*Math.PI),i.fill(),0===B&&(i.fillColor=Y);}}},i.cacheTraverse=function(t){var e=U._curFrame;if(e){var h=e.segments;if(0!=h.length){var i,u,_;var d=e.vertices;var f=e.indices;var r,n=0,p=0;t&&(t=t.m,ct=t[0],ut=t[1],lt=t[4],_t=t[5],ht=t[12],dt=t[13]);var m=16&M;var v=m&&1===ct&&0===ut&&0===lt&&1===_t;var y=0;var g=e.colors;var a=g[y++];var b=a.vfOffset;_handleColor(a);for(var C=0,x=h.length;C<x;C++){var o=h[C];if(r=_getSlotMaterial(o.tex,o.blendMode)){!at&&r.getHash()===ft.material.getHash()||(at=!1,ft._flush(),ft.node=pt,ft.material=r),B=o.vertexCount,G=o.indexCount,r=W.request(B,G),z=r.indiceOffset,it=r.vertexOffset,D=r.byteOffset>>2,i=W._vData,u=W._iData,_=W._uintVData;for(var A=z,S=z+G;A<S;A++)u[A]=it+f[p++];if(r=o.vfCount,i.set(d.subarray(n,n+r),D),n+=r,v)for(var s=D,T=D+r;s<T;s+=6)i[s]+=ht,i[s+1]+=dt;else if(m)for(var c=D,w=D+r;c<w;c+=6)ot=i[c],st=i[c+1],i[c]=ot*ct+st*lt+ht,i[c+1]=ot*ut+st*_t+dt;if(W.adjust(B,G),mt){var E=n-r;for(var l=4+D,P=4+D+r;l<P;l+=6,E+=6)b<=E&&(_handleColor(a=g[y++]),b=a.vfOffset),_[l]=R,_[l+1]=I;}}}}}},i.fillBuffers=function(t,e){var i=t.node;i._renderFlag|=a.FLAG_UPDATE_RENDER_DATA,t._skeleton&&(i=i._color,T=i.r/255,w=i.g/255,E=i.b/255,P=i.a/255,O=t.useTint||t.isAnimationCached(),l=O?s:o,F=O?6:5,pt=t.node,W=e.getBuffer("spine",l),ft=e,at=!0,A=(U=t).premultipliedAlpha,M=0,mt=!(S=1),vt=t._effectDelegate&&t._effectDelegate._vertexEffect,4294967295===i._val&&!A||(mt=!0),O&&(M|=1),i=void 0,U.enableBatch&&(i=pt._worldMatrix,at=!1,M|=16),t.isAnimationCached()?this.cacheTraverse(i):(vt&&vt.begin(t._skeleton),this.realTimeTraverse(i),vt&&vt.end()),e.worldMatDirty++,t.attachUtil._syncAttachedNode(),U=ft=W=pt=void 0,vt=null);},i.postFillBuffers=function(t,e){e.worldMatDirty--;},SpineAssembler;}(r.default);i.default=t,r.default.register(n,t),e.exports=i.default;},{"../../cocos2d/core/renderer/assembler":217,"../../cocos2d/core/renderer/render-flow":221,"../../cocos2d/core/renderer/webgl/vertex-format":252,"./Skeleton":353,"./lib/spine":355}],360:[function(t,e,i){"use strict";function ZuT(){this.start=null,this.end=null,this.complete=null,this.event=null,this.interrupt=null,this.dispose=null;}ZuT.getListeners=function(t){return t.listener||(t.listener=new ZuT()),t.listener;},e.exports=ZuT;},{}],361:[function(t,e,i){"use strict";var r=t("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none";},clear:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none";},initJitter:function(t,e){return this._effectType="jitter",this._vertexEffect=new r.JitterEffect(t,e),this._vertexEffect;},initSwirlWithPow:function(t,e){return this._interpolation=new r.Pow(e),this._vertexEffect=new r.SwirlEffect(t,this._interpolation),this._vertexEffect;},initSwirlWithPowOut:function(t,e){return this._interpolation=new r.PowOut(e),this._vertexEffect=new r.SwirlEffect(t,this._interpolation),this._vertexEffect;},getJitterVertexEffect:function(){return this._vertexEffect;},getSwirlVertexEffect:function(){return this._vertexEffect;},getVertexEffect:function(){return this._vertexEffect;},getEffectType:function(){return this._effectType;}}),e.exports=sp.VertexEffectDelegate;},{"./lib/spine":355}],362:[function(t,e,i){"use strict";var r;r=function(H){function b2Maybe(t,e){return void 0!==t?t:e;}var B=1e37;var E=1e-5;var y=E*E;var m=3.14159265359;var M=.008;var P=2/180*m;var p=8/180*m;var S=.5*m;var T=S*S;var t=2/180*m;b2Version.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision;};var e=b2Version;function b2Version(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i;}var i=new e(2,3,2);function b2MakeArray(t,e){var i=[];for(var r=0;r<t;++r)i.push(e(r));return i;}function b2MakeNumberArray(t,e){void 0===e&&(e=0);var i=[];for(var r=0;r<t;++r)i.push(e);return i;}var r=m/180;var n=180/m;var a=2*m;var D=Math.abs;var L=Math.min;var V=Math.max;function b2Clamp(t,e,i){return t<e?e:i<t?i:t;}var o=isFinite;function b2Sq(t){return t*t;}function b2InvSqrt(t){return 1/Math.sqrt(t);}var X=Math.sqrt;var s=Math.pow;var c=Math.cos;var l=Math.sin;var h=Math.acos;var u=Math.asin;var v=Math.atan2;b2Vec2.prototype.Clone=function(){return new b2Vec2(this.x,this.y);},b2Vec2.prototype.SetZero=function(){return this.x=0,this.y=0,this;},b2Vec2.prototype.Set=function(t,e){return this.x=t,this.y=e,this;},b2Vec2.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this;},b2Vec2.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this;},b2Vec2.prototype.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this;},b2Vec2.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this;},b2Vec2.prototype.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this;},b2Vec2.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this;},b2Vec2.prototype.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this;},b2Vec2.prototype.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this;},b2Vec2.prototype.Dot=function(t){return this.x*t.x+this.y*t.y;},b2Vec2.prototype.Cross=function(t){return this.x*t.y-this.y*t.x;},b2Vec2.prototype.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e);},b2Vec2.prototype.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e;},b2Vec2.prototype.Normalize=function(){var t=this.Length();var e;return E<=t&&(this.x*=e=1/t,this.y*=e),t;},b2Vec2.prototype.SelfNormalize=function(){var t=this.Length();return E<=t&&(this.x*=t=1/t,this.y*=t),this;},b2Vec2.prototype.SelfRotate=function(t){var e=Math.cos(t);t=Math.sin(t);var i=this.x;return this.x=e*i-t*this.y,this.y=t*i+e*this.y,this;},b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y);},b2Vec2.prototype.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this;},b2Vec2.prototype.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this;},b2Vec2.prototype.SelfMinV=function(t){return this.x=L(this.x,t.x),this.y=L(this.y,t.y),this;},b2Vec2.prototype.SelfMaxV=function(t){return this.x=V(this.x,t.x),this.y=V(this.y,t.y),this;},b2Vec2.prototype.SelfAbs=function(){return this.x=D(this.x),this.y=D(this.y),this;},b2Vec2.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this;},b2Vec2.prototype.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this;},b2Vec2.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2Vec2();});},b2Vec2.AbsV=function(t,e){return e.x=D(t.x),e.y=D(t.y),e;},b2Vec2.MinV=function(t,e,i){return i.x=L(t.x,e.x),i.y=L(t.y,e.y),i;},b2Vec2.MaxV=function(t,e,i){return i.x=V(t.x,e.x),i.y=V(t.y,e.y),i;},b2Vec2.ClampV=function(t,e,i,r){return r.x=b2Clamp(t.x,e.x,i.x),r.y=b2Clamp(t.y,e.y,i.y),r;},b2Vec2.RotateV=function(t,e,i){var r=t.x,t=t.y;var n=Math.cos(e);e=Math.sin(e);return i.x=n*r-e*t,i.y=e*r+n*t,i;},b2Vec2.DotVV=function(t,e){return t.x*e.x+t.y*e.y;},b2Vec2.CrossVV=function(t,e){return t.x*e.y-t.y*e.x;},b2Vec2.CrossVS=function(t,e,i){var r=t.x;return i.x=e*t.y,i.y=-e*r,i;},b2Vec2.CrossVOne=function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e;},b2Vec2.CrossSV=function(t,e,i){var r=e.x;return i.x=-t*e.y,i.y=t*r,i;},b2Vec2.CrossOneV=function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e;},b2Vec2.AddVV=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i;},b2Vec2.SubVV=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i;},b2Vec2.MulSV=function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i;},b2Vec2.MulVS=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i;},b2Vec2.AddVMulSV=function(t,e,i,r){return r.x=t.x+e*i.x,r.y=t.y+e*i.y,r;},b2Vec2.SubVMulSV=function(t,e,i,r){return r.x=t.x-e*i.x,r.y=t.y-e*i.y,r;},b2Vec2.AddVCrossSV=function(t,e,i,r){var n=i.x;return r.x=t.x-e*i.y,r.y=t.y+e*n,r;},b2Vec2.MidVV=function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i;},b2Vec2.ExtVV=function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i;},b2Vec2.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y;},b2Vec2.DistanceVV=function(t,e){var i=t.x-e.x;t=t.y-e.y;return Math.sqrt(i*i+t*t);},b2Vec2.DistanceSquaredVV=function(t,e){var i=t.x-e.x;t=t.y-e.y;return i*i+t*t;},b2Vec2.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e;},b2Vec2.ZERO=new b2Vec2(0,0),b2Vec2.UNITX=new b2Vec2(1,0),b2Vec2.UNITY=new b2Vec2(0,1),b2Vec2.s_t0=new b2Vec2(),b2Vec2.s_t1=new b2Vec2(),b2Vec2.s_t2=new b2Vec2(),b2Vec2.s_t3=new b2Vec2();var j=b2Vec2;function b2Vec2(t,e){void 0===e&&(e=0),this.x=t=void 0===t?0:t,this.y=e;}var _=new j(0,0);b2Vec3.prototype.Clone=function(){return new b2Vec3(this.x,this.y,this.z);},b2Vec3.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this;},b2Vec3.prototype.SetXYZ=function(t,e,i){return this.x=t,this.y=e,this.z=i,this;},b2Vec3.prototype.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this;},b2Vec3.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this;},b2Vec3.prototype.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this;},b2Vec3.prototype.SelfAddXYZ=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this;},b2Vec3.prototype.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this;},b2Vec3.prototype.SelfSubXYZ=function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this;},b2Vec3.prototype.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this;},b2Vec3.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z;},b2Vec3.CrossV3V3=function(t,e,i){var r=t.x,n=t.y,t=t.z;var a=e.x,o=e.y,e=e.z;return i.x=n*e-t*o,i.y=t*a-r*e,i.z=r*o-n*a,i;},b2Vec3.ZERO=new b2Vec3(0,0,0),b2Vec3.s_t0=new b2Vec3();var d=b2Vec3;function b2Vec3(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.x=t=void 0===t?0:t,this.y=e,this.z=i;}b2Mat22.prototype.Clone=function(){return new b2Mat22().Copy(this);},b2Mat22.FromVV=function(t,e){return new b2Mat22().SetVV(t,e);},b2Mat22.FromSSSS=function(t,e,i,r){return new b2Mat22().SetSSSS(t,e,i,r);},b2Mat22.FromAngle=function(t){return new b2Mat22().SetAngle(t);},b2Mat22.prototype.SetSSSS=function(t,e,i,r){return this.ex.Set(t,i),this.ey.Set(e,r),this;},b2Mat22.prototype.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this;},b2Mat22.prototype.SetAngle=function(t){var e=Math.cos(t);t=Math.sin(t);return this.ex.Set(e,t),this.ey.Set(-t,e),this;},b2Mat22.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this;},b2Mat22.prototype.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this;},b2Mat22.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this;},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x);},b2Mat22.prototype.GetInverse=function(t){var e=this.ex.x;var i=this.ey.x;var r=this.ex.y;var n=this.ey.y;var a=e*n-i*r;return t.ex.x=(a=0!==a?1/a:a)*n,t.ey.x=-a*i,t.ex.y=-a*r,t.ey.y=a*e,t;},b2Mat22.prototype.Solve=function(t,e,i){var r=this.ex.x,n=this.ey.x;var a=this.ex.y,o=this.ey.y;var s=r*o-n*a;return i.x=(s=0!==s?1/s:s)*(o*t-n*e),i.y=s*(r*e-a*t),i;},b2Mat22.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this;},b2Mat22.prototype.SelfInv=function(){return this.GetInverse(this),this;},b2Mat22.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this;},b2Mat22.prototype.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this;},b2Mat22.AbsM=function(t,e){var i=t.ex,t=t.ey;return e.ex.x=D(i.x),e.ex.y=D(i.y),e.ey.x=D(t.x),e.ey.y=D(t.y),e;},b2Mat22.MulMV=function(t,e,i){var r=t.ex,t=t.ey;var n=e.x,e=e.y;return i.x=r.x*n+t.x*e,i.y=r.y*n+t.y*e,i;},b2Mat22.MulTMV=function(t,e,i){var r=t.ex,t=t.ey;var n=e.x,e=e.y;return i.x=r.x*n+r.y*e,i.y=t.x*n+t.y*e,i;},b2Mat22.AddMM=function(t,e,i){var r=t.ex,t=t.ey;var n=e.ex,e=e.ey;return i.ex.x=r.x+n.x,i.ex.y=r.y+n.y,i.ey.x=t.x+e.x,i.ey.y=t.y+e.y,i;},b2Mat22.MulMM=function(t,e,i){var r=t.ex.x,n=t.ex.y;var a=t.ey.x,t=t.ey.y;var o=e.ex.x,s=e.ex.y;var c=e.ey.x,e=e.ey.y;return i.ex.x=r*o+a*s,i.ex.y=n*o+t*s,i.ey.x=r*c+a*e,i.ey.y=n*c+t*e,i;},b2Mat22.MulTMM=function(t,e,i){var r=t.ex.x,n=t.ex.y;var a=t.ey.x,t=t.ey.y;var o=e.ex.x,s=e.ex.y;var c=e.ey.x,e=e.ey.y;return i.ex.x=r*o+n*s,i.ex.y=a*o+t*s,i.ey.x=r*c+n*e,i.ey.y=a*c+t*e,i;},b2Mat22.IDENTITY=new b2Mat22();var g=b2Mat22;function b2Mat22(){this.ex=new j(1,0),this.ey=new j(0,1);}b2Mat33.prototype.Clone=function(){return new b2Mat33().Copy(this);},b2Mat33.prototype.SetVVV=function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this;},b2Mat33.prototype.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this;},b2Mat33.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this;},b2Mat33.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this;},b2Mat33.prototype.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this;},b2Mat33.prototype.Solve33=function(t,e,i,h){var u=this.ex.x,_=this.ex.y,d=this.ex.z;var r=this.ey.x,n=this.ey.y,a=this.ey.z;var o=this.ez.x,s=this.ez.y,c=this.ez.z;var l=u*(n*c-a*s)+_*(a*o-r*c)+d*(r*s-n*o);return h.x=(l=0!==l?1/l:l)*(t*(n*c-a*s)+e*(a*o-r*c)+i*(r*s-n*o)),h.y=l*(u*(e*c-i*s)+_*(i*o-t*c)+d*(t*s-e*o)),h.z=l*(u*(n*i-a*e)+_*(a*t-r*i)+d*(r*e-n*t)),h;},b2Mat33.prototype.Solve22=function(t,e,i){var r=this.ex.x,n=this.ey.x;var a=this.ex.y,o=this.ey.y;var s=r*o-n*a;return i.x=(s=0!==s?1/s:s)*(o*t-n*e),i.y=s*(r*e-a*t),i;},b2Mat33.prototype.GetInverse22=function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y;var a=e*n-i*r;t.ex.x=(a=0!==a?1/a:a)*n,t.ey.x=-a*i,t.ex.z=0,t.ex.y=-a*r,t.ey.y=a*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0;},b2Mat33.prototype.GetSymInverse33=function(t){var e=d.DotV3V3(this.ex,d.CrossV3V3(this.ey,this.ez,d.s_t0));var i=this.ex.x,r=this.ey.x,n=this.ez.x;var a=this.ey.y,o=this.ez.y;var s=this.ez.z;t.ex.x=(e=0!==e?1/e:e)*(a*s-o*o),t.ex.y=e*(n*o-r*s),t.ex.z=e*(r*o-n*a),t.ey.x=t.ex.y,t.ey.y=e*(i*s-n*n),t.ey.z=e*(n*r-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*a-r*r);},b2Mat33.MulM33V3=function(t,e,i){var r=e.x,n=e.y,e=e.z;return i.x=t.ex.x*r+t.ey.x*n+t.ez.x*e,i.y=t.ex.y*r+t.ey.y*n+t.ez.y*e,i.z=t.ex.z*r+t.ey.z*n+t.ez.z*e,i;},b2Mat33.MulM33XYZ=function(t,e,i,r,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*r,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*r,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*r,n;},b2Mat33.MulM33V2=function(t,e,i){var r=e.x,e=e.y;return i.x=t.ex.x*r+t.ey.x*e,i.y=t.ex.y*r+t.ey.y*e,i;},b2Mat33.MulM33XY=function(t,e,i,r){return r.x=t.ex.x*e+t.ey.x*i,r.y=t.ex.y*e+t.ey.y*i,r;},b2Mat33.IDENTITY=new b2Mat33();var f=b2Mat33;function b2Mat33(){this.ex=new d(1,0,0),this.ey=new d(0,1,0),this.ez=new d(0,0,1);}b2Rot.prototype.Clone=function(){return new b2Rot().Copy(this);},b2Rot.prototype.Copy=function(t){return this.s=t.s,this.c=t.c,this;},b2Rot.prototype.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this;},b2Rot.prototype.SetIdentity=function(){return this.s=0,this.c=1,this;},b2Rot.prototype.GetAngle=function(){return Math.atan2(this.s,this.c);},b2Rot.prototype.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t;},b2Rot.prototype.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t;},b2Rot.MulRR=function(t,e,i){var r=t.c,t=t.s;var n=e.c,e=e.s;return i.s=t*n+r*e,i.c=r*n-t*e,i;},b2Rot.MulTRR=function(t,e,i){var r=t.c,t=t.s;var n=e.c,e=e.s;return i.s=r*e-t*n,i.c=r*n+t*e,i;},b2Rot.MulRV=function(t,e,i){var r=t.c,t=t.s;var n=e.x,e=e.y;return i.x=r*n-t*e,i.y=t*n+r*e,i;},b2Rot.MulTRV=function(t,e,i){var r=t.c,t=t.s;var n=e.x,e=e.y;return i.x=r*n+t*e,i.y=-t*n+r*e,i;},b2Rot.IDENTITY=new b2Rot();var R=b2Rot;function b2Rot(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t));}b2Transform.prototype.Clone=function(){return new b2Transform().Copy(this);},b2Transform.prototype.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this;},b2Transform.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this;},b2Transform.prototype.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this;},b2Transform.prototype.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this;},b2Transform.prototype.SetPosition=function(t){return this.p.Copy(t),this;},b2Transform.prototype.SetPositionXY=function(t,e){return this.p.Set(t,e),this;},b2Transform.prototype.SetRotation=function(t){return this.q.Copy(t),this;},b2Transform.prototype.SetRotationAngle=function(t){return this.q.SetAngle(t),this;},b2Transform.prototype.GetPosition=function(){return this.p;},b2Transform.prototype.GetRotation=function(){return this.q;},b2Transform.prototype.GetRotationAngle=function(){return this.q.GetAngle();},b2Transform.prototype.GetAngle=function(){return this.q.GetAngle();},b2Transform.MulXV=function(t,e,i){var r=t.q.c,n=t.q.s;var a=e.x,e=e.y;return i.x=r*a-n*e+t.p.x,i.y=n*a+r*e+t.p.y,i;},b2Transform.MulTXV=function(t,e,i){var r=t.q.c,n=t.q.s;var a=e.x-t.p.x;e=e.y-t.p.y;return i.x=r*a+n*e,i.y=-n*a+r*e,i;},b2Transform.MulXX=function(t,e,i){return R.MulRR(t.q,e.q,i.q),j.AddVV(R.MulRV(t.q,e.p,i.p),t.p,i.p),i;},b2Transform.MulTXX=function(t,e,i){return R.MulTRR(t.q,e.q,i.q),R.MulTRV(t.q,j.SubVV(e.p,t.p,i.p),i.p),i;},b2Transform.IDENTITY=new b2Transform();var I=b2Transform;function b2Transform(){this.p=new j(),this.q=new R();}b2Sweep.prototype.Clone=function(){return new b2Sweep().Copy(this);},b2Sweep.prototype.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this;},b2Sweep.prototype.GetTransform=function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;i=i*this.a0+e*this.a;return t.q.SetAngle(i),t.p.SelfSub(R.MulRV(t.q,this.localCenter,j.s_t0)),t;},b2Sweep.prototype.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);var i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t;},b2Sweep.prototype.Normalize=function(){var t=a*Math.floor(this.a0/a);this.a0-=t,this.a-=t;};var b=b2Sweep;function b2Sweep(){this.localCenter=new j(),this.c0=new j(),this.c=new j(),this.a0=0,this.a=0,this.alpha0=0;}b2Color.prototype.Clone=function(){return new b2Color().Copy(this);},b2Color.prototype.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this;},b2Color.prototype.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a;},b2Color.prototype.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a;},b2Color.prototype.Set=function(t,e,i,r){void 0===r&&(r=this.a),this.SetRGBA(t,e,i,r);},b2Color.prototype.SetByteRGB=function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this;},b2Color.prototype.SetByteRGBA=function(t,e,i,r){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=r/255,this;},b2Color.prototype.SetRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this;},b2Color.prototype.SetRGBA=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this;},b2Color.prototype.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this;},b2Color.prototype.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e;},b2Color.prototype.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this;},b2Color.prototype.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e;},b2Color.prototype.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this;},b2Color.prototype.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e;},b2Color.prototype.Mix=function(t,e){b2Color.MixColors(this,t,e);},b2Color.MixColors=function(t,e,i){var r=i*(e.r-t.r);var n=i*(e.g-t.g);var a=i*(e.b-t.b);i*=e.a-t.a;t.r+=r,t.g+=n,t.b+=a,t.a+=i,e.r-=r,e.g-=n,e.b-=a,e.a-=i;},b2Color.prototype.MakeStyleString=function(t){return void 0===t&&(t=this.a),b2Color.MakeStyleString(this.r,this.g,this.b,t);},b2Color.MakeStyleString=function(t,e,i,r){return t*=255,e*=255,i*=255,(r=void 0===r?1:r)<1?"rgba("+t+","+e+","+i+","+r+")":"rgb("+t+","+e+","+i+")";},b2Color.ZERO=new b2Color(0,0,0,0),b2Color.RED=new b2Color(1,0,0),b2Color.GREEN=new b2Color(0,1,0),b2Color.BLUE=new b2Color(0,0,1);var C=b2Color;function b2Color(t,e,i,r){void 0===e&&(e=.5),void 0===i&&(i=.5),void 0===r&&(r=1),this.r=t=void 0===t?.5:t,this.g=e,this.b=i,this.a=r;}(x=H.b2DrawFlags||(H.b2DrawFlags={}))[x.e_none=0]="e_none",x[x.e_shapeBit=1]="e_shapeBit",x[x.e_jointBit=2]="e_jointBit",x[x.e_aabbBit=4]="e_aabbBit",x[x.e_pairBit=8]="e_pairBit",x[x.e_centerOfMassBit=16]="e_centerOfMassBit",x[x.e_particleBit=32]="e_particleBit",x[x.e_controllerBit=64]="e_controllerBit",x[x.e_all=63]="e_all";b2Draw.prototype.SetFlags=function(t){this.m_drawFlags=t;},b2Draw.prototype.GetFlags=function(){return this.m_drawFlags;},b2Draw.prototype.AppendFlags=function(t){this.m_drawFlags|=t;},b2Draw.prototype.ClearFlags=function(t){this.m_drawFlags&=~t;};var x=b2Draw;function b2Draw(){this.m_drawFlags=0;}b2Timer.prototype.Reset=function(){return this.m_start=Date.now(),this;},b2Timer.prototype.GetMilliseconds=function(){return Date.now()-this.m_start;};var A=b2Timer;function b2Timer(){this.m_start=Date.now();}b2Counter.prototype.GetCount=function(){return this.m_count;},b2Counter.prototype.GetMinCount=function(){return this.m_min_count;},b2Counter.prototype.GetMaxCount=function(){return this.m_max_count;},b2Counter.prototype.ResetCount=function(){var t=this.m_count;return this.m_count=0,t;},b2Counter.prototype.ResetMinCount=function(){this.m_min_count=0;},b2Counter.prototype.ResetMaxCount=function(){this.m_max_count=0;},b2Counter.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count);},b2Counter.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count);};var w=b2Counter;function b2Counter(){this.m_count=0,this.m_min_count=0,this.m_max_count=0;}b2GrowableStack.prototype.Reset=function(){return this.m_count=0,this;},b2GrowableStack.prototype.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++;},b2GrowableStack.prototype.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if((this.m_stack[this.m_count]=null)===t)throw new Error();return t;},b2GrowableStack.prototype.GetCount=function(){return this.m_count;};var O=b2GrowableStack;function b2GrowableStack(t){this.m_stack=[],this.m_count=0,this.m_stack=b2MakeArray(t,function(t){return null;}),this.m_count=0;}function t8T(){}function r8T(){}b2DistanceProxy.prototype.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this;},b2DistanceProxy.prototype.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this;},b2DistanceProxy.prototype.SetShape=function(t,e){t.SetupDistanceProxy(this,e);},b2DistanceProxy.prototype.SetVerticesRadius=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i;},b2DistanceProxy.prototype.GetSupport=function(t){var e=0;var i=j.DotVV(this.m_vertices[0],t);for(var r=1;r<this.m_count;++r){var n=j.DotVV(this.m_vertices[r],t);i<n&&(e=r,i=n);}return e;},b2DistanceProxy.prototype.GetSupportVertex=function(t){var e=0;var i=j.DotVV(this.m_vertices[0],t);for(var r=1;r<this.m_count;++r){var n=j.DotVV(this.m_vertices[r],t);i<n&&(e=r,i=n);}return this.m_vertices[e];},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count;},b2DistanceProxy.prototype.GetVertex=function(t){return this.m_vertices[t];};var F=b2DistanceProxy;function b2DistanceProxy(){this.m_buffer=j.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0;}b2SimplexCache.prototype.Reset=function(){return this.metric=0,this.count=0,this;};var N=b2SimplexCache;function b2SimplexCache(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0];}b2DistanceInput.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this;};var k=b2DistanceInput;function b2DistanceInput(){this.proxyA=new F(),this.proxyB=new F(),this.transformA=new I(),this.transformB=new I(),this.useRadii=!1;}b2DistanceOutput.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this;};var G=b2DistanceOutput;function b2DistanceOutput(){this.pointA=new j(),this.pointB=new j(),this.distance=0,this.iterations=0;}function D8T(){this.proxyA=new F(),this.proxyB=new F(),this.transformA=new I(),this.transformB=new I(),this.translationB=new j();}function h8T(){this.point=new j(),this.normal=new j(),this.lambda=0,this.iterations=0;}H.b2_gjkCalls=0,H.b2_gjkIters=0,H.b2_gjkMaxIters=0;b2SimplexVertex.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this;};var z=b2SimplexVertex;function b2SimplexVertex(){this.wA=new j(),this.wB=new j(),this.w=new j(),this.a=0,this.indexA=0,this.indexB=0;}b2Simplex.prototype.ReadCache=function(t,e,i,r,h){this.m_count=t.count;var u=this.m_vertices;for(var n=0;n<this.m_count;++n){(l=u[n]).indexA=t.indexA[n],l.indexB=t.indexB[n];var a=e.GetVertex(l.indexA);var o=r.GetVertex(l.indexB);I.MulXV(i,a,l.wA),I.MulXV(h,o,l.wB),j.SubVV(l.wB,l.wA,l.w),l.a=0;}var s,c;var l;1<this.m_count&&(s=t.metric,((c=this.GetMetric())<.5*s||2*s<c||c<E)&&(this.m_count=0)),0===this.m_count&&((l=u[0]).indexA=0,l.indexB=0,a=e.GetVertex(0),o=r.GetVertex(0),I.MulXV(i,a,l.wA),I.MulXV(h,o,l.wB),j.SubVV(l.wB,l.wA,l.w),l.a=1,this.m_count=1);},b2Simplex.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;var e=this.m_vertices;for(var i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB;},b2Simplex.prototype.GetSearchDirection=function(t){switch(this.m_count){case 1:return j.NegV(this.m_v1.w,t);case 2:var e=j.SubVV(this.m_v2.w,this.m_v1.w,t);return 0<j.CrossVV(e,j.NegV(this.m_v1.w,j.s_t0))?j.CrossOneV(e,t):j.CrossVOne(e,t);default:return t.SetZero();}},b2Simplex.prototype.GetClosestPoint=function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return t.SetZero();}},b2Simplex.prototype.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return j.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return j.CrossVV(j.SubVV(this.m_v2.w,this.m_v1.w,j.s_t0),j.SubVV(this.m_v3.w,this.m_v1.w,j.s_t1));default:return 0;}},b2Simplex.prototype.Solve2=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=j.SubVV(e,t,b2Simplex.s_e12);t=-j.DotVV(t,i);if(t<=0)return this.m_v1.a=1,void(this.m_count=1);e=j.DotVV(e,i);if(e<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);i=1/(e+t);this.m_v1.a=e*i,this.m_v2.a=t*i,this.m_count=2;},b2Simplex.prototype.Solve3=function(){var t=this.m_v1.w;var e=this.m_v2.w;var i=this.m_v3.w;var r=j.SubVV(e,t,b2Simplex.s_e12);var n=j.DotVV(t,r);var a=j.DotVV(e,r);n=-n;var o=j.SubVV(i,t,b2Simplex.s_e13);var s=j.DotVV(t,o);var h=j.DotVV(i,o);s=-s;var c=j.SubVV(i,e,b2Simplex.s_e23);var l=j.DotVV(e,c);c=j.DotVV(i,c);l=-l;r=j.CrossVV(r,o);o=r*j.CrossVV(e,i);i=r*j.CrossVV(i,t);r*=j.CrossVV(t,e);if(n<=0&&s<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<a&&0<n&&r<=0)return this.m_v1.a=a*(t=1/(a+n)),this.m_v2.a=n*t,void(this.m_count=2);if(0<h&&0<s&&i<=0)return this.m_v1.a=h*(e=1/(h+s)),this.m_v3.a=s*e,this.m_count=2,void this.m_v2.Copy(this.m_v3);if(a<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&c<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(0<c&&0<l&&o<=0)return this.m_v2.a=c*(n=1/(c+l)),this.m_v3.a=l*n,this.m_count=2,void this.m_v1.Copy(this.m_v3);t=1/(o+i+r);this.m_v1.a=o*t,this.m_v2.a=i*t,this.m_v3.a=r*t,this.m_count=3;},b2Simplex.s_e12=new j(),b2Simplex.s_e13=new j(),b2Simplex.s_e23=new j();var U=b2Simplex;function b2Simplex(){this.m_v1=new z(),this.m_v2=new z(),this.m_v3=new z(),this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3;}var W=new U();var q=[0,0,0];var Y=[0,0,0];var J=new j();var Z=new j();var Q=new j();var K=new j();var $=new j();function b2Distance(t,e,i){++H.b2_gjkCalls;var r=i.proxyA;var n=i.proxyB;var a=i.transformA;var h=i.transformB;var o=W;o.ReadCache(e,r,a,n,h);var u=o.m_vertices;var _=q;var d=Y;var f;var s=0;for(;s<20;){f=o.m_count;for(var c=0;c<f;++c)_[c]=u[c].indexA,d[c]=u[c].indexB;switch(o.m_count){case 1:break;case 2:o.Solve2();break;case 3:o.Solve3();}if(3===o.m_count)break;var p=o.GetSearchDirection(Z);if(p.LengthSquared()<y)break;var l=u[o.m_count];l.indexA=r.GetSupport(R.MulTRV(a.q,j.NegV(p,j.s_t0),K)),I.MulXV(a,r.GetVertex(l.indexA),l.wA),l.indexB=n.GetSupport(R.MulTRV(h.q,p,$)),I.MulXV(h,n.GetVertex(l.indexB),l.wB),j.SubVV(l.wB,l.wA,l.w),++s,++H.b2_gjkIters;var m=!1;for(c=0;c<f;++c)if(l.indexA===_[c]&&l.indexB===d[c]){m=!0;break;}if(m)break;++o.m_count;}var v;H.b2_gjkMaxIters=V(H.b2_gjkMaxIters,s),o.GetWitnessPoints(t.pointA,t.pointB),t.distance=j.DistanceVV(t.pointA,t.pointB),t.iterations=s,o.WriteCache(e),i.useRadii&&(e=r.m_radius,i=n.m_radius,t.distance>e+i&&t.distance>E?(t.distance-=e+i,(v=j.SubVV(t.pointB,t.pointA,Q)).Normalize(),t.pointA.SelfMulAdd(e,v),t.pointB.SelfMulSub(i,v)):(e=j.MidVV(t.pointA,t.pointB,J),t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0));}var tt=new j();var et=new U();var it=new j();var rt=new j();var nt=new j();var at=new j();var ot=new j();var st=new j();(_t=H.b2ContactFeatureType||(H.b2ContactFeatureType={}))[_t.e_vertex=0]="e_vertex",_t[_t.e_face=1]="e_face";Object.defineProperty(b2ContactFeature.prototype,"key",{get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key;},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255;},enumerable:!0,configurable:!0}),Object.defineProperty(b2ContactFeature.prototype,"indexA",{get:function(){return this._indexA;},set:function(t){this._indexA=t,this._key_invalid=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(b2ContactFeature.prototype,"indexB",{get:function(){return this._indexB;},set:function(t){this._indexB=t,this._key_invalid=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(b2ContactFeature.prototype,"typeA",{get:function(){return this._typeA;},set:function(t){this._typeA=t,this._key_invalid=!0;},enumerable:!0,configurable:!0}),Object.defineProperty(b2ContactFeature.prototype,"typeB",{get:function(){return this._typeB;},set:function(t){this._typeB=t,this._key_invalid=!0;},enumerable:!0,configurable:!0});var ct=b2ContactFeature;function b2ContactFeature(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0;}b2ContactID.prototype.Copy=function(t){return this.key=t.key,this;},b2ContactID.prototype.Clone=function(){return new b2ContactID().Copy(this);},Object.defineProperty(b2ContactID.prototype,"key",{get:function(){return this.cf.key;},set:function(t){this.cf.key=t;},enumerable:!0,configurable:!0});var lt=b2ContactID;function b2ContactID(){this.cf=new ct();}b2ManifoldPoint.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2ManifoldPoint();});},b2ManifoldPoint.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0;},b2ManifoldPoint.prototype.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this;};var ht=b2ManifoldPoint;function b2ManifoldPoint(){this.localPoint=new j(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new lt();}(_t=H.b2ManifoldType||(H.b2ManifoldType={}))[_t.e_unknown=-1]="e_unknown",_t[_t.e_circles=0]="e_circles",_t[_t.e_faceA=1]="e_faceA",_t[_t.e_faceB=2]="e_faceB";b2Manifold.prototype.Reset=function(){for(var t=0;t<2;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=H.b2ManifoldType.e_unknown,this.pointCount=0;},b2Manifold.prototype.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<2;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this;},b2Manifold.prototype.Clone=function(){return new b2Manifold().Copy(this);};var ut=b2Manifold;function b2Manifold(){this.points=ht.MakeArray(2),this.localNormal=new j(),this.localPoint=new j(),this.type=H.b2ManifoldType.e_unknown,this.pointCount=0;}b2WorldManifold.prototype.Initialize=function(t,e,i,r,n){if(0!==t.pointCount)switch(t.type){case H.b2ManifoldType.e_circles:this.normal.Set(1,0);var a=I.MulXV(e,t.localPoint,b2WorldManifold.Initialize_s_pointA);var h=I.MulXV(r,t.points[0].localPoint,b2WorldManifold.Initialize_s_pointB);j.DistanceSquaredVV(a,h)>y&&j.SubVV(h,a,this.normal).SelfNormalize();var o=j.AddVMulSV(a,i,this.normal,b2WorldManifold.Initialize_s_cA);var s=j.SubVMulSV(h,n,this.normal,b2WorldManifold.Initialize_s_cB);j.MidVV(o,s,this.points[0]),this.separations[0]=j.DotVV(j.SubVV(s,o,j.s_t0),this.normal);break;case H.b2ManifoldType.e_faceA:R.MulRV(e.q,t.localNormal,this.normal);var u=I.MulXV(e,t.localPoint,b2WorldManifold.Initialize_s_planePoint);for(var c=0;c<t.pointCount;++c){var l=I.MulXV(r,t.points[c].localPoint,b2WorldManifold.Initialize_s_clipPoint);var _=i-j.DotVV(j.SubVV(l,u,j.s_t0),this.normal);o=j.AddVMulSV(l,_,this.normal,b2WorldManifold.Initialize_s_cA);s=j.SubVMulSV(l,n,this.normal,b2WorldManifold.Initialize_s_cB);j.MidVV(o,s,this.points[c]),this.separations[c]=j.DotVV(j.SubVV(s,o,j.s_t0),this.normal);}break;case H.b2ManifoldType.e_faceB:R.MulRV(r.q,t.localNormal,this.normal);u=I.MulXV(r,t.localPoint,b2WorldManifold.Initialize_s_planePoint);for(c=0;c<t.pointCount;++c){l=I.MulXV(e,t.points[c].localPoint,b2WorldManifold.Initialize_s_clipPoint);_=n-j.DotVV(j.SubVV(l,u,j.s_t0),this.normal);s=j.AddVMulSV(l,_,this.normal,b2WorldManifold.Initialize_s_cB);o=j.SubVMulSV(l,i,this.normal,b2WorldManifold.Initialize_s_cA);j.MidVV(o,s,this.points[c]),this.separations[c]=j.DotVV(j.SubVV(o,s,j.s_t0),this.normal);}this.normal.SelfNeg();}},b2WorldManifold.Initialize_s_pointA=new j(),b2WorldManifold.Initialize_s_pointB=new j(),b2WorldManifold.Initialize_s_cA=new j(),b2WorldManifold.Initialize_s_cB=new j(),b2WorldManifold.Initialize_s_planePoint=new j(),b2WorldManifold.Initialize_s_clipPoint=new j();var _t=b2WorldManifold;function b2WorldManifold(){this.normal=new j(),this.points=j.MakeArray(2),this.separations=b2MakeNumberArray(2);}(dt=H.b2PointState||(H.b2PointState={}))[dt.b2_nullState=0]="b2_nullState",dt[dt.b2_addState=1]="b2_addState",dt[dt.b2_persistState=2]="b2_persistState",dt[dt.b2_removeState=3]="b2_removeState";b2ClipVertex.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2ClipVertex();});},b2ClipVertex.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this;};var dt=b2ClipVertex;function b2ClipVertex(){this.v=new j(),this.id=new lt();}b2RayCastInput.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this;};var ft=b2RayCastInput;function b2RayCastInput(){this.p1=new j(),this.p2=new j(),this.maxFraction=1;}b2RayCastOutput.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this;};var pt=b2RayCastOutput;function b2RayCastOutput(){this.normal=new j(),this.fraction=0;}b2AABB.prototype.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this;},b2AABB.prototype.IsValid=function(){var t=this.upperBound.x-this.lowerBound.x;var e=this.upperBound.y-this.lowerBound.y;return 0<=t&&0<=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid();},b2AABB.prototype.GetCenter=function(){return j.MidVV(this.lowerBound,this.upperBound,this.m_cache_center);},b2AABB.prototype.GetExtents=function(){return j.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent);},b2AABB.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y));},b2AABB.prototype.Combine1=function(t){return this.lowerBound.x=L(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=L(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=V(this.upperBound.x,t.upperBound.x),this.upperBound.y=V(this.upperBound.y,t.upperBound.y),this;},b2AABB.prototype.Combine2=function(t,e){return this.lowerBound.x=L(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=L(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=V(t.upperBound.x,e.upperBound.x),this.upperBound.y=V(t.upperBound.y,e.upperBound.y),this;},b2AABB.Combine=function(t,e,i){return i.Combine2(t,e),i;},b2AABB.prototype.Contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y;},b2AABB.prototype.RayCast=function(h,t){var e=-B;var i=B;var r=t.p1.x;var n=t.p1.y;var u=t.p2.x-t.p1.x;var _=t.p2.y-t.p1.y;var d=D(u);var f=D(_);var a=h.normal;if(d<E){if(r<this.lowerBound.x||this.upperBound.x<r)return!1;}else{var o=1/u;var s=(this.lowerBound.x-r)*o;var c=-1;if((l=(this.upperBound.x-r)*o)<s&&(p=s,s=l,l=p,c=1),e<s&&(a.x=c,a.y=0,e=s),(i=L(i,l))<e)return!1;}if(f<E){if(n<this.lowerBound.y||this.upperBound.y<n)return!1;}else{o=1/_;s=(this.lowerBound.y-n)*o;var l;c=-1;var p;if((l=(this.upperBound.y-n)*o)<s&&(p=s,s=l,l=p,c=1),e<s&&(a.x=0,a.y=c,e=s),(i=L(i,l))<e)return!1;}return!(e<0||t.maxFraction<e)&&(h.fraction=e,!0);},b2AABB.prototype.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y);},b2AABB.prototype.TestOverlap=function(t){var e=t.lowerBound.x-this.upperBound.x;var i=t.lowerBound.y-this.upperBound.y;var r=this.lowerBound.x-t.upperBound.x;t=this.lowerBound.y-t.upperBound.y;return!(0<e||0<i)&&!(0<r||0<t);};var mt=b2AABB;function b2AABB(){this.lowerBound=new j(),this.upperBound=new j(),this.m_cache_center=new j(),this.m_cache_extent=new j();}function b2TestOverlapAABB(t,e){var i=e.lowerBound.x-t.upperBound.x;var r=e.lowerBound.y-t.upperBound.y;var n=t.lowerBound.x-e.upperBound.x;t=t.lowerBound.y-e.upperBound.y;return!(0<i||0<r)&&!(0<n||0<t);}function b2ClipSegmentToLine(t,e,i,r,n){var a=0;var o=e[0];e=e[1];var s=j.DotVV(i,o.v)-r;i=j.DotVV(i,e.v)-r;return s<=0&&t[a++].Copy(o),i<=0&&t[a++].Copy(e),s*i<0&&((r=t[a].v).x=o.v.x+(s=s/(s-i))*(e.v.x-o.v.x),r.y=o.v.y+s*(e.v.y-o.v.y),(i=t[a].id).cf.indexA=n,i.cf.indexB=o.id.cf.indexB,i.cf.typeA=H.b2ContactFeatureType.e_vertex,i.cf.typeB=H.b2ContactFeatureType.e_face,++a),a;}var vt=new k();var yt=new N();var gt=new G();function b2TestOverlapShape(t,e,i,r,n,a){var o=vt.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,r),o.transformA.Copy(n),o.transformB.Copy(a),o.useRadii=!0;t=yt.Reset();t.count=0;e=gt.Reset();return b2Distance(e,t,o),e.distance<10*E;}function verify(t){if(null===t)throw new Error();return t;}b2TreeNode.prototype.IsLeaf=function(){return null===this.child1;};var bt=b2TreeNode;function b2TreeNode(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new mt(),this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t;}b2DynamicTree.prototype.Query=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var r=i.Pop();if(r.aabb.TestOverlap(t))if(r.IsLeaf()){if(!e(r))return;}else i.Push(verify(r.child1)),i.Push(verify(r.child2));}}},b2DynamicTree.prototype.QueryPoint=function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);0<i.GetCount();){var r=i.Pop();if(r.aabb.TestContain(t))if(r.IsLeaf()){if(!e(r))return;}else i.Push(verify(r.child1)),i.Push(verify(r.child2));}}},b2DynamicTree.prototype.RayCast=function(t,h){if(null!==this.m_root){var e=t.p1;var i=t.p2;var u=j.SubVV(i,e,b2DynamicTree.s_r);u.Normalize();var _=j.CrossOneV(u,b2DynamicTree.s_v);var d=j.AbsV(_,b2DynamicTree.s_abs_v);var r=t.maxFraction;var n=b2DynamicTree.s_segmentAABB;var a=e.x+r*(i.x-e.x);var o=e.y+r*(i.y-e.y);n.lowerBound.x=L(e.x,a),n.lowerBound.y=L(e.y,o),n.upperBound.x=V(e.x,a),n.upperBound.y=V(e.y,o);var s=this.m_stack.Reset();for(s.Push(this.m_root);0<s.GetCount();){var c=s.Pop();if(b2TestOverlapAABB(c.aabb,n)){var l=c.aabb.GetCenter();var f=c.aabb.GetExtents();if(!(0<D(j.DotVV(_,j.SubVV(e,l,j.s_t0)))-j.DotVV(d,f)))if(c.IsLeaf()){l=b2DynamicTree.s_subInput;l.p1.Copy(t.p1),l.p2.Copy(t.p2),l.maxFraction=r;f=h(l,c);if(0===f)return;0<f&&(a=e.x+(r=f)*(i.x-e.x),o=e.y+r*(i.y-e.y),n.lowerBound.x=L(e.x,a),n.lowerBound.y=L(e.y,o),n.upperBound.x=V(e.x,a),n.upperBound.y=V(e.y,o));}else s.Push(verify(c.child1)),s.Push(verify(c.child2));}}}},b2DynamicTree.prototype.AllocateNode=function(){var t;return this.m_freeList?(t=this.m_freeList,this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,delete t.userData,t):new bt(b2DynamicTree.s_node_id++);},b2DynamicTree.prototype.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t;},b2DynamicTree.prototype.CreateProxy=function(t,e){var i=this.AllocateNode();return i.aabb.lowerBound.x=t.lowerBound.x-.1,i.aabb.lowerBound.y=t.lowerBound.y-.1,i.aabb.upperBound.x=t.upperBound.x+.1,i.aabb.upperBound.y=t.upperBound.y+.1,i.userData=e,i.height=0,this.InsertLeaf(i),i;},b2DynamicTree.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t);},b2DynamicTree.prototype.MoveProxy=function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=.1+2*(0<i.x?i.x:-i.x);i=.1+2*(0<i.y?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-i,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+i,this.InsertLeaf(t),!0;},b2DynamicTree.prototype.InsertLeaf=function(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);var e=t.aabb;var i=this.m_root;for(;!i.IsLeaf();){var r=verify(i.child1);var n=verify(i.child2);var h=i.aabb.GetPerimeter();var a=b2DynamicTree.s_combinedAABB;a.Combine2(i.aabb,e);a=a.GetPerimeter();var u=2*a;a=2*(a-h);h=void 0;var o=b2DynamicTree.s_aabb;var _=void 0;h=r.IsLeaf()?(o.Combine2(e,r.aabb),o.GetPerimeter()+a):(o.Combine2(e,r.aabb),_=r.aabb.GetPerimeter(),o.GetPerimeter()-_+a);var d=void 0;if(d=n.IsLeaf()?(o.Combine2(e,n.aabb),o.GetPerimeter()+a):(o.Combine2(e,n.aabb),_=n.aabb.GetPerimeter(),o.GetPerimeter()-_+a),u<h&&u<d)break;i=h<d?r:n;}var s=i;var f=s.parent;var c=this.AllocateNode();c.parent=f,delete c.userData,c.aabb.Combine2(e,s.aabb),c.height=s.height+1,f?(f.child1===s?f.child1=c:f.child2=c,c.child1=s,c.child2=t,s.parent=c,t.parent=c):(c.child1=s,c.child2=t,s.parent=c,t.parent=c,this.m_root=c);var l=t.parent;for(;null!==l;){r=verify((l=this.Balance(l)).child1);n=verify(l.child2);l.height=1+V(r.height,n.height),l.aabb.Combine2(r.aabb,n.aabb),l=l.parent;}},b2DynamicTree.prototype.RemoveLeaf=function(t){if(t!==this.m_root){var e=verify(t.parent);var i=e&&e.parent;if(t=e.child1===t?verify(e.child2):verify(e.child1),i){i.child1===e?i.child1=t:i.child2=t,t.parent=i,this.FreeNode(e);var r=i;for(;r;){var n=verify((r=this.Balance(r)).child1);var a=verify(r.child2);r.aabb.Combine2(n.aabb,a.aabb),r.height=1+V(n.height,a.height),r=r.parent;}}else(this.m_root=t).parent=null,this.FreeNode(e);}else this.m_root=null;},b2DynamicTree.prototype.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e=verify(t.child1);var i=verify(t.child2);var r=i.height-e.height;return 1<r?(n=verify(i.child1),a=verify(i.child2),i.child1=t,i.parent=t.parent,null!==(t.parent=i).parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>a.height?(i.child2=n,((t.child2=a).parent=t).aabb.Combine2(e.aabb,a.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+V(e.height,a.height),i.height=1+V(t.height,n.height)):(i.child2=a,((t.child2=n).parent=t).aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,a.aabb),t.height=1+V(e.height,n.height),i.height=1+V(t.height,a.height)),i):r<-1?(n=verify(e.child1),a=verify(e.child2),e.child1=t,e.parent=t.parent,null!==(t.parent=e).parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,n.height>a.height?(e.child2=n,((t.child1=a).parent=t).aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+V(i.height,a.height),e.height=1+V(t.height,n.height)):(e.child2=a,((t.child1=n).parent=t).aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+V(i.height,n.height),e.height=1+V(t.height,a.height)),e):t;var n,a;},b2DynamicTree.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height;},b2DynamicTree.GetAreaNode=function(t){if(null===t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return(e+=b2DynamicTree.GetAreaNode(t.child1))+b2DynamicTree.GetAreaNode(t.child2);},b2DynamicTree.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return b2DynamicTree.GetAreaNode(this.m_root)/t;},b2DynamicTree.prototype.ComputeHeightNode=function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1);t=this.ComputeHeightNode(t.child2);return 1+V(e,t);},b2DynamicTree.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root);},b2DynamicTree.prototype.ValidateStructure=function(t){var e;null!==t&&(this.m_root,(t=t).IsLeaf()||(e=verify(t.child1),t=verify(t.child2),this.ValidateStructure(e),this.ValidateStructure(t)));},b2DynamicTree.prototype.ValidateMetrics=function(t){var e;null!==t&&((t=t).IsLeaf()||(e=verify(t.child1),t=verify(t.child2),b2DynamicTree.s_aabb.Combine2(e.aabb,t.aabb),this.ValidateMetrics(e),this.ValidateMetrics(t)));},b2DynamicTree.prototype.Validate=function(){},b2DynamicTree.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=verify(t.child1);t=verify(t.child2);t=D(t.height-i.height);return V(e,t);},b2DynamicTree.prototype.GetMaxBalance=function(){return b2DynamicTree.GetMaxBalanceNode(this.m_root,0);},b2DynamicTree.prototype.RebuildBottomUp=function(){this.Validate();},b2DynamicTree.ShiftOriginNode=function(t,e){var i,r;null!==t&&(t.height<=1||(i=t.child1,r=t.child2,b2DynamicTree.ShiftOriginNode(i,e),b2DynamicTree.ShiftOriginNode(r,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)));},b2DynamicTree.prototype.ShiftOrigin=function(t){b2DynamicTree.ShiftOriginNode(this.m_root,t);},b2DynamicTree.s_r=new j(),b2DynamicTree.s_v=new j(),b2DynamicTree.s_abs_v=new j(),b2DynamicTree.s_segmentAABB=new mt(),b2DynamicTree.s_subInput=new ft(),b2DynamicTree.s_combinedAABB=new mt(),b2DynamicTree.s_aabb=new mt(),b2DynamicTree.s_node_id=0;var Ct=b2DynamicTree;function b2DynamicTree(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new O(256);}var xt=function(t,e){this.proxyA=t,this.proxyB=e;};b2BroadPhase.prototype.CreateProxy=function(t,e){t=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(t),t;},b2BroadPhase.prototype.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t);},b2BroadPhase.prototype.MoveProxy=function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t);},b2BroadPhase.prototype.TouchProxy=function(t){this.BufferMove(t);},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount;},b2BroadPhase.prototype.UpdatePairs=function(t){var n=this;this.m_pairCount=0;var e=this;for(var i=0;i<this.m_moveCount;++i)!function(t){var r=e.m_moveBuffer[t];if(null===r)return;t=r.aabb;e.m_tree.Query(t,function(t){return t.m_id===r.m_id||(t=t.m_id<r.m_id?(e=t,r):(e=r,t),n.m_pairCount===n.m_pairBuffer.length?n.m_pairBuffer[n.m_pairCount]=new xt(e,t):((i=n.m_pairBuffer[n.m_pairCount]).proxyA=e,i.proxyB=t),++n.m_pairCount),!0;var e;var i;});}(i);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(b2PairLessThan);var r=0;for(;r<this.m_pairCount;){var a=this.m_pairBuffer[r];var o=a.proxyA.userData;var s=a.proxyB.userData;for(o&&s&&t(o,s),++r;r<this.m_pairCount;){var c=this.m_pairBuffer[r];if(c.proxyA.m_id!==a.proxyA.m_id||c.proxyB.m_id!==a.proxyB.m_id)break;++r;}}},b2BroadPhase.prototype.Query=function(t,e){this.m_tree.Query(t,e);},b2BroadPhase.prototype.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e);},b2BroadPhase.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e);},b2BroadPhase.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight();},b2BroadPhase.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance();},b2BroadPhase.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio();},b2BroadPhase.prototype.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t);},b2BroadPhase.prototype.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount;},b2BroadPhase.prototype.UnBufferMove=function(t){t=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[t]=null;};var At=b2BroadPhase;function b2BroadPhase(){this.m_tree=new Ct(),this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[];}function b2PairLessThan(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id;}H.b2_toiTime=0,H.b2_toiMaxTime=0,H.b2_toiCalls=0,H.b2_toiIters=0,H.b2_toiMaxIters=0,H.b2_toiRootIters=0,H.b2_toiMaxRootIters=0;var St=new I();var Tt=new I();var wt=new j();var Et=new j();var Pt=new j();var Mt=new j();var Rt=new j();var It=function(){this.proxyA=new F(),this.proxyB=new F(),this.sweepA=new b(),this.sweepB=new b(),this.tMax=0;};(Bt=H.b2TOIOutputState||(H.b2TOIOutputState={}))[Bt.e_unknown=0]="e_unknown",Bt[Bt.e_failed=1]="e_failed",Bt[Bt.e_overlapped=2]="e_overlapped",Bt[Bt.e_touching=3]="e_touching",Bt[Bt.e_separated=4]="e_separated";var Bt=function(){this.state=H.b2TOIOutputState.e_unknown,this.t=0;};(Dt=H.b2SeparationFunctionType||(H.b2SeparationFunctionType={}))[Dt.e_unknown=-1]="e_unknown",Dt[Dt.e_points=0]="e_points",Dt[Dt.e_faceA=1]="e_faceA",Dt[Dt.e_faceB=2]="e_faceB";b2SeparationFunction.prototype.Initialize=function(t,e,i,r,n,a){this.m_proxyA=e,this.m_proxyB=r;e=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);r=St;i=Tt;if(this.m_sweepA.GetTransform(r,a),this.m_sweepB.GetTransform(i,a),1===e)return this.m_type=H.b2SeparationFunctionType.e_points,o=this.m_proxyA.GetVertex(t.indexA[0]),u=this.m_proxyB.GetVertex(t.indexB[0]),s=I.MulXV(r,o,wt),c=I.MulXV(i,u,Et),j.SubVV(c,s,this.m_axis),l=this.m_axis.Normalize(),this.m_localPoint.SetZero(),l;var o;if(t.indexA[0]===t.indexA[1])return this.m_type=H.b2SeparationFunctionType.e_faceB,n=this.m_proxyB.GetVertex(t.indexB[0]),a=this.m_proxyB.GetVertex(t.indexB[1]),j.CrossVOne(j.SubVV(a,n,j.s_t0),this.m_axis).SelfNormalize(),h=R.MulRV(i.q,this.m_axis,Pt),j.MidVV(n,a,this.m_localPoint),c=I.MulXV(i,this.m_localPoint,Et),o=this.m_proxyA.GetVertex(t.indexA[0]),s=I.MulXV(r,o,wt),(l=j.DotVV(j.SubVV(s,c,j.s_t0),h))<0&&(this.m_axis.SelfNeg(),l=-l),l;this.m_type=H.b2SeparationFunctionType.e_faceA;e=this.m_proxyA.GetVertex(t.indexA[0]);n=this.m_proxyA.GetVertex(t.indexA[1]);j.CrossVOne(j.SubVV(n,e,j.s_t0),this.m_axis).SelfNormalize();var h=R.MulRV(r.q,this.m_axis,Pt);j.MidVV(e,n,this.m_localPoint);var s=I.MulXV(r,this.m_localPoint,wt);var u=this.m_proxyB.GetVertex(t.indexB[0]);var c=I.MulXV(i,u,Et);var l;return(l=j.DotVV(j.SubVV(c,s,j.s_t0),h))<0&&(this.m_axis.SelfNeg(),l=-l),l;},b2SeparationFunction.prototype.FindMinSeparation=function(t,e,h){var i=St;var r=Tt;switch(this.m_sweepA.GetTransform(i,h),this.m_sweepB.GetTransform(r,h),this.m_type){case H.b2SeparationFunctionType.e_points:var n=R.MulTRV(i.q,this.m_axis,Mt);var a=R.MulTRV(r.q,j.NegV(this.m_axis,j.s_t0),Rt);t[0]=this.m_proxyA.GetSupport(n),e[0]=this.m_proxyB.GetSupport(a);var o=this.m_proxyA.GetVertex(t[0]);var u=this.m_proxyB.GetVertex(e[0]);var s=I.MulXV(i,o,wt);var c=I.MulXV(r,u,Et);return j.DotVV(j.SubVV(c,s,j.s_t0),this.m_axis);case H.b2SeparationFunctionType.e_faceA:var l=R.MulRV(i.q,this.m_axis,Pt);s=I.MulXV(i,this.m_localPoint,wt);a=R.MulTRV(r.q,j.NegV(l,j.s_t0),Rt);t[0]=-1,e[0]=this.m_proxyB.GetSupport(a);u=this.m_proxyB.GetVertex(e[0]);c=I.MulXV(r,u,Et);return j.DotVV(j.SubVV(c,s,j.s_t0),l);case H.b2SeparationFunctionType.e_faceB:l=R.MulRV(r.q,this.m_axis,Pt);c=I.MulXV(r,this.m_localPoint,Et);n=R.MulTRV(i.q,j.NegV(l,j.s_t0),Mt);e[0]=-1,t[0]=this.m_proxyA.GetSupport(n);o=this.m_proxyA.GetVertex(t[0]);s=I.MulXV(i,o,wt);return j.DotVV(j.SubVV(s,c,j.s_t0),l);default:return t[0]=-1,e[0]=-1,0;}},b2SeparationFunction.prototype.Evaluate=function(t,e,i){var r=St;var n=Tt;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),this.m_type){case H.b2SeparationFunctionType.e_points:var a=this.m_proxyA.GetVertex(t);var o=this.m_proxyB.GetVertex(e);var s=I.MulXV(r,a,wt);var c=I.MulXV(n,o,Et);return j.DotVV(j.SubVV(c,s,j.s_t0),this.m_axis);case H.b2SeparationFunctionType.e_faceA:var l=R.MulRV(r.q,this.m_axis,Pt);s=I.MulXV(r,this.m_localPoint,wt);o=this.m_proxyB.GetVertex(e);c=I.MulXV(n,o,Et);return j.DotVV(j.SubVV(c,s,j.s_t0),l);case H.b2SeparationFunctionType.e_faceB:l=R.MulRV(n.q,this.m_axis,Pt);c=I.MulXV(n,this.m_localPoint,Et);a=this.m_proxyA.GetVertex(t);s=I.MulXV(r,a,wt);return j.DotVV(j.SubVV(s,c,j.s_t0),l);default:return 0;}};var Dt=b2SeparationFunction;function b2SeparationFunction(){this.m_sweepA=new b(),this.m_sweepB=new b(),this.m_type=H.b2SeparationFunctionType.e_unknown,this.m_localPoint=new j(),this.m_axis=new j();}var Lt=new A();var Vt=new N();var Ot=new k();var Ft=new G();var Nt=new Dt();var kt=[0];var Gt=[0];var zt=new b();var Ut=new b();function b2TimeOfImpact(t,e){var h=Lt.Reset();++H.b2_toiCalls,t.state=H.b2TOIOutputState.e_unknown,t.t=e.tMax;var u=e.proxyA;var _=e.proxyB;var d=zt.Copy(e.sweepA);var f=Ut.Copy(e.sweepB);d.Normalize(),f.Normalize();var p=e.tMax;var i=u.m_radius+_.m_radius;var r=V(M,i-.024);var n=0;var m=0;var v=Vt;v.count=0;var a=Ot;for(a.proxyA.Copy(e.proxyA),a.proxyB.Copy(e.proxyB),a.useRadii=!1;;){var o=St;var y=Tt;d.GetTransform(o,n),f.GetTransform(y,n),a.transformA.Copy(o),a.transformB.Copy(y);o=Ft;if(b2Distance(o,v,a),o.distance<=0){t.state=H.b2TOIOutputState.e_overlapped,t.t=0;break;}if(o.distance<r+.002){t.state=H.b2TOIOutputState.e_touching,t.t=n;break;}var s=Nt;s.Initialize(v,u,d,_,f,n);var g=!1;var b=p;var C=0;for(;;){var x=kt;var A=Gt;var S=s.FindMinSeparation(x,A,b);if(r+.002<S){t.state=H.b2TOIOutputState.e_separated,t.t=p,g=!0;break;}if(r-.002<S){n=b;break;}var c=s.Evaluate(x[0],A[0],n);if(c<r-.002){t.state=H.b2TOIOutputState.e_failed,t.t=n,g=!0;break;}if(c<=r+.002){t.state=H.b2TOIOutputState.e_touching,t.t=n,g=!0;break;}var T=0;var w=n;var E=b;for(;;){var l;l=1&T?w+(r-c)*(E-w)/(S-c):.5*(w+E),++T,++H.b2_toiRootIters;var P=s.Evaluate(x[0],A[0],l);if(D(P-r)<.002){b=l;break;}if(r<P?(w=l,c=P):(E=l,S=P),50===T)break;}if(H.b2_toiMaxRootIters=V(H.b2_toiMaxRootIters,T),8===++C)break;}if(++m,++H.b2_toiIters,g)break;if(20===m){t.state=H.b2TOIOutputState.e_failed,t.t=n;break;}}H.b2_toiMaxIters=V(H.b2_toiMaxIters,m);i=h.GetMilliseconds();H.b2_toiMaxTime=V(H.b2_toiMaxTime,i),H.b2_toiTime+=i;}var Wt=new j();var Ht=new j();function b2CollideCircles(t,e,i,r,n){t.pointCount=0;i=I.MulXV(i,e.m_p,Wt);n=I.MulXV(n,r.m_p,Ht);i=j.DistanceSquaredVV(i,n);n=e.m_radius+r.m_radius;n*n<i||(t.type=H.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0);}var jt=new j();var Xt=new j();var qt=new j();function b2CollidePolygonAndCircle(t,e,i,r,n){t.pointCount=0;n=I.MulXV(n,r.m_p,jt);var a=I.MulTXV(i,n,Xt);var h=0;var u=-B;var o=e.m_radius+r.m_radius;var _=e.m_count;var d=e.m_vertices;var s=e.m_normals;for(var c=0;c<_;++c){var f=j.DotVV(s[c],j.SubVV(a,d[c],j.s_t0));if(o<f)return;u<f&&(u=f,h=c);}i=h;n=d[i];e=d[(i+1)%_];if(u<E)return t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(s[h]),j.MidVV(n,e,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);var l=j.DotVV(j.SubVV(a,n,j.s_t0),j.SubVV(e,n,j.s_t1));var p=j.DotVV(j.SubVV(a,e,j.s_t0),j.SubVV(n,e,j.s_t1));l<=0?j.DistanceSquaredVV(a,n)>o*o||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,j.SubVV(a,n,t.localNormal).SelfNormalize(),t.localPoint.Copy(n),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0):p<=0?j.DistanceSquaredVV(a,e)>o*o||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,j.SubVV(a,e,t.localNormal).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0):(l=j.MidVV(n,e,qt),o<j.DotVV(j.SubVV(a,l,j.s_t1),s[i])||(t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(s[i]).SelfNormalize(),t.localPoint.Copy(l),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0));}var Yt=new j();var Jt=new j();var Zt=new j();var Qt=new j();function b2EdgeSeparation(t,e,i,r,n){var h=t.m_vertices;t=t.m_normals;var u=r.m_count;var a=r.m_vertices;r=R.MulRV(e.q,t[i],Yt);var _=R.MulTRV(n.q,r,Jt);var o=0;var s=B;for(var c=0;c<u;++c){var l=j.DotVV(a[c],_);l<s&&(s=l,o=c);}t=I.MulXV(e,h[i],Zt);e=I.MulXV(n,a[o],Qt);return j.DotVV(j.SubVV(e,t,j.s_t0),r);}var Kt=new j();var $t=new j();function b2FindMaxSeparation(h,t,e,i,r){var n=t.m_count;var u=t.m_normals;var a=j.SubVV(I.MulXV(r,i.m_centroid,j.s_t0),I.MulXV(e,t.m_centroid,j.s_t1),Kt);var _=R.MulTRV(e.q,a,$t);var o=0;var d=-B;for(var f=0;f<n;++f){var p=j.DotVV(u[f],_);d<p&&(d=p,o=f);}var s=b2EdgeSeparation(t,e,o,i,r);a=(o+n-1)%n;var m=b2EdgeSeparation(t,e,a,i,r);var v=(o+1)%n;var y=b2EdgeSeparation(t,e,v,i,r);var c=0;var l=0;var g=0;if(s<m&&y<m)g=-1,c=a,l=m;else{if(!(s<y))return h[0]=o,s;g=1,c=v,l=y;}for(;;){if(!(l<(s=b2EdgeSeparation(t,e,o=-1===g?(c+n-1)%n:(c+1)%n,i,r))))break;c=o,l=s;}return h[0]=c,l;}var te=new j();var ee=dt.MakeArray(2);var ie=dt.MakeArray(2);var re=dt.MakeArray(2);var ne=[0];var ae=[0];var oe=new j();var se=new j();var ce=new j();var le=new j();var he=new j();var ue=new j();var _e=new j();var de=new j();function b2CollidePolygons(h,t,e,i,r){h.pointCount=0;var u=t.m_radius+i.m_radius;var n=ne;n[0]=0;var _=b2FindMaxSeparation(n,t,e,i,r);if(!(u<_)){var a=ae;a[0]=0;var o=b2FindMaxSeparation(a,i,r,t,e);if(!(u<o)){var d;var s=0;var f=0;f=.98*_+.001<o?(A=i,x=t,c=r,d=e,s=a[0],h.type=H.b2ManifoldType.e_faceB,1):(A=t,x=i,c=e,d=r,s=n[0],h.type=H.b2ManifoldType.e_faceA,0);_=ee;o=_;a=A;t=c;i=s;e=x;r=d;a=a.m_normals;var p=e.m_count;n=e.m_vertices;var m=e.m_normals;var v=R.MulTRV(r.q,R.MulRV(t.q,a[i],j.s_t0),te);var y=0;var g=B;for(var b=0;b<p;++b){var C=j.DotVV(v,m[b]);C<g&&(g=C,y=b);}t=((e=y)+1)%p,a=o[0],I.MulXV(r,n[e],a.v),(a=a.id.cf).indexA=i,a.indexB=e,a.typeA=H.b2ContactFeatureType.e_face,a.typeB=H.b2ContactFeatureType.e_vertex,e=o[1],I.MulXV(r,n[t],e.v),(a=e.id.cf).indexA=i,a.indexB=t,a.typeA=H.b2ContactFeatureType.e_face,a.typeB=H.b2ContactFeatureType.e_vertex;var x=A.m_count;o=A.m_vertices;r=s;n=(s+1)%x;e=o[r];i=o[n];t=j.SubVV(i,e,oe);t.Normalize();a=j.CrossVOne(t,se);var A=j.MidVV(e,i,ce);s=R.MulRV(c.q,t,he);var S=j.CrossVOne(s,le);x=I.MulXV(c,e,_e);o=I.MulXV(c,i,de);var T=j.DotVV(S,x);t=-j.DotVV(s,x)+u;e=j.DotVV(s,o)+u;var c=ie;var w=re;i=j.NegV(s,ue);if(!(b2ClipSegmentToLine(c,_,i,t,r)<2||b2ClipSegmentToLine(w,c,s,e,n)<2)){h.localNormal.Copy(a),h.localPoint.Copy(A);var E=0;for(var P=0;P<2;++P){var l=w[P];var M;j.DotVV(S,l.v)-T<=u&&(M=h.points[E],I.MulTXV(d,l.v,M.localPoint),M.id.Copy(l.id),f&&(l=M.id.cf,M.id.cf.indexA=l.indexB,M.id.cf.indexB=l.indexA,M.id.cf.typeA=l.typeB,M.id.cf.typeB=l.typeA),++E);}h.pointCount=E;}}}}var fe=new j();var pe=new j();var me=new j();var ve=new j();var ye=new j();var ge=new j();var be=new j();var Ce=new lt();function b2CollideEdgeAndCircle(t,e,i,h,r){t.pointCount=0;i=I.MulTXV(i,I.MulXV(r,h.m_p,j.s_t0),fe);r=e.m_vertex1;var n=e.m_vertex2;var a=j.SubVV(n,r,pe);var u=j.DotVV(a,j.SubVV(n,i,j.s_t0));var _=j.DotVV(a,j.SubVV(i,r,j.s_t0));var d=e.m_radius+h.m_radius;var o=Ce;if(o.cf.indexB=0,o.cf.typeB=H.b2ContactFeatureType.e_vertex,_<=0){var s=r;var c=j.SubVV(i,s,me);if(d*d<j.DotVV(c,c))return;if(e.m_hasVertex0){c=e.m_vertex0;var l=r;c=j.SubVV(l,c,ve);if(0<j.DotVV(c,j.SubVV(l,i,j.s_t0)))return;}return o.cf.indexA=0,o.cf.typeA=H.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=H.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(s),t.points[0].id.Copy(o),void t.points[0].localPoint.Copy(h.m_p);}if(u<=0){c=n;l=j.SubVV(i,c,me);if(d*d<j.DotVV(l,l))return;if(e.m_hasVertex3){s=e.m_vertex3;l=n;e=j.SubVV(s,l,ye);if(0<j.DotVV(e,j.SubVV(i,l,j.s_t0)))return;}return o.cf.indexA=1,o.cf.typeA=H.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=H.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(o),void t.points[0].localPoint.Copy(h.m_p);}s=j.DotVV(a,a);e=ge;e.x=1/s*(u*r.x+_*n.x),e.y=1/s*(u*r.y+_*n.y);l=j.SubVV(i,e,me);d*d<j.DotVV(l,l)||(c=be.Set(-a.y,a.x),j.DotVV(c,j.SubVV(i,r,j.s_t0))<0&&c.Set(-c.x,-c.y),c.Normalize(),o.cf.indexA=0,o.cf.typeA=H.b2ContactFeatureType.e_face,t.pointCount=1,t.type=H.b2ManifoldType.e_faceA,t.localNormal.Copy(c),t.localPoint.Copy(r),t.points[0].id.Copy(o),t.points[0].localPoint.Copy(h.m_p));}var xe=function(){this.type=0,this.index=0,this.separation=0;};var Ae=function(){this.vertices=j.MakeArray(8),this.normals=j.MakeArray(8),this.count=0;};var Se=function(){this.i1=0,this.i2=0,this.v1=new j(),this.v2=new j(),this.normal=new j(),this.sideNormal1=new j(),this.sideOffset1=0,this.sideNormal2=new j(),this.sideOffset2=0;};function b2EPCollider(){this.m_polygonB=new Ae(),this.m_xf=new I(),this.m_centroidB=new j(),this.m_v0=new j(),this.m_v1=new j(),this.m_v2=new j(),this.m_v3=new j(),this.m_normal0=new j(),this.m_normal1=new j(),this.m_normal2=new j(),this.m_normal=new j(),this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new j(),this.m_upperLimit=new j(),this.m_radius=0,this.m_front=!1;}b2EPCollider.prototype.Collide=function(t,h,e,u,_){I.MulTXX(e,_,this.m_xf),I.MulXV(this.m_xf,u.m_centroid,this.m_centroidB),this.m_v0.Copy(h.m_vertex0),this.m_v1.Copy(h.m_vertex1),this.m_v2.Copy(h.m_vertex2),this.m_v3.Copy(h.m_vertex3);e=h.m_hasVertex0;_=h.m_hasVertex3;var i=j.SubVV(this.m_v2,this.m_v1,b2EPCollider.s_edge1);i.Normalize(),this.m_normal1.Set(i.y,-i.x);var r=j.DotVV(this.m_normal1,j.SubVV(this.m_centroidB,this.m_v1,j.s_t0));var n=0;var d=0;var f=!1;var p=!1;e&&((o=j.SubVV(this.m_v1,this.m_v0,b2EPCollider.s_edge0)).Normalize(),this.m_normal0.Set(o.y,-o.x),f=0<=j.CrossVV(o,i),n=j.DotVV(this.m_normal0,j.SubVV(this.m_centroidB,this.m_v0,j.s_t0))),_&&((o=j.SubVV(this.m_v3,this.m_v2,b2EPCollider.s_edge2)).Normalize(),this.m_normal2.Set(o.y,-o.x),p=0<j.CrossVV(i,o),d=j.DotVV(this.m_normal2,j.SubVV(this.m_centroidB,this.m_v2,j.s_t0))),e&&_?f&&p?(this.m_front=0<=n||0<=r||0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=0<=n||0<=r&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=0<=d||0<=n&&0<=r,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=0<=n&&0<=r&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):e?f?(this.m_front=0<=n||0<=r,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1)),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_front=0<=n&&0<=r,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):_?p?(this.m_front=0<=r||0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=0<=r&&0<=d,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg()),this.m_upperLimit.Copy(this.m_normal1)):(this.m_front=0<=r,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=u.m_count;for(var a=0;a<u.m_count;++a)I.MulXV(this.m_xf,u.m_vertices[a],this.m_polygonB.vertices[a]),R.MulRV(this.m_xf.q,u.m_normals[a],this.m_polygonB.normals[a]);this.m_radius=u.m_radius+h.m_radius,t.pointCount=0;i=this.ComputeEdgeSeparation(b2EPCollider.s_edgeAxis);if(0!==i.type&&!(i.separation>this.m_radius)){var o=this.ComputePolygonSeparation(b2EPCollider.s_polygonAxis);if(!(0!==o.type&&o.separation>this.m_radius)){var m;m=0!==o.type&&o.separation>.98*i.separation+.001?o:i;e=b2EPCollider.s_ie;var s=b2EPCollider.s_rf;if(1===m.type){t.type=H.b2ManifoldType.e_faceA;var v=0;var y=j.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(a=1;a<this.m_polygonB.count;++a){var g=j.DotVV(this.m_normal,this.m_polygonB.normals[a]);g<y&&(y=g,v=a);}f=v;n=(f+1)%this.m_polygonB.count;(c=e[0]).v.Copy(this.m_polygonB.vertices[f]),c.id.cf.indexA=0,c.id.cf.indexB=f,c.id.cf.typeA=H.b2ContactFeatureType.e_face,c.id.cf.typeB=H.b2ContactFeatureType.e_vertex,(l=e[1]).v.Copy(this.m_polygonB.vertices[n]),l.id.cf.indexA=0,l.id.cf.indexB=n,l.id.cf.typeA=H.b2ContactFeatureType.e_face,l.id.cf.typeB=H.b2ContactFeatureType.e_vertex,this.m_front?(s.i1=0,s.i2=1,s.v1.Copy(this.m_v1),s.v2.Copy(this.m_v2),s.normal.Copy(this.m_normal1)):(s.i1=1,s.i2=0,s.v1.Copy(this.m_v2),s.v2.Copy(this.m_v1),s.normal.Copy(this.m_normal1).SelfNeg());}else{var c;var l;t.type=H.b2ManifoldType.e_faceB,(c=e[0]).v.Copy(this.m_v1),c.id.cf.indexA=0,c.id.cf.indexB=m.index,c.id.cf.typeA=H.b2ContactFeatureType.e_vertex,c.id.cf.typeB=H.b2ContactFeatureType.e_face,(l=e[1]).v.Copy(this.m_v2),l.id.cf.indexA=0,l.id.cf.indexB=m.index,l.id.cf.typeA=H.b2ContactFeatureType.e_vertex,l.id.cf.typeB=H.b2ContactFeatureType.e_face,s.i1=m.index,s.i2=(s.i1+1)%this.m_polygonB.count,s.v1.Copy(this.m_polygonB.vertices[s.i1]),s.v2.Copy(this.m_polygonB.vertices[s.i2]),s.normal.Copy(this.m_polygonB.normals[s.i1]);}s.sideNormal1.Set(s.normal.y,-s.normal.x),s.sideNormal2.Copy(s.sideNormal1).SelfNeg(),s.sideOffset1=j.DotVV(s.sideNormal1,s.v1),s.sideOffset2=j.DotVV(s.sideNormal2,s.v2);_=b2EPCollider.s_clipPoints1;var b=b2EPCollider.s_clipPoints2;if(!(b2ClipSegmentToLine(_,e,s.sideNormal1,s.sideOffset1,s.i1)<2||b2ClipSegmentToLine(b,_,s.sideNormal2,s.sideOffset2,s.i2)<2)){1===m.type?(t.localNormal.Copy(s.normal),t.localPoint.Copy(s.v1)):(t.localNormal.Copy(u.m_normals[s.i1]),t.localPoint.Copy(u.m_vertices[s.i1]));var C=0;for(a=0;a<2;++a){var x;j.DotVV(s.normal,j.SubVV(b[a].v,s.v1,j.s_t0))<=this.m_radius&&(x=t.points[C],1===m.type?(I.MulTXV(this.m_xf,b[a].v,x.localPoint),x.id=b[a].id):(x.localPoint.Copy(b[a].v),x.id.cf.typeA=b[a].id.cf.typeB,x.id.cf.typeB=b[a].id.cf.typeA,x.id.cf.indexA=b[a].id.cf.indexB,x.id.cf.indexB=b[a].id.cf.indexA),++C);}t.pointCount=C;}}}},b2EPCollider.prototype.ComputeEdgeSeparation=function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=B;for(var i=0;i<this.m_polygonB.count;++i){var r=j.DotVV(this.m_normal,j.SubVV(this.m_polygonB.vertices[i],this.m_v1,j.s_t0));r<e.separation&&(e.separation=r);}return e;},b2EPCollider.prototype.ComputePolygonSeparation=function(t){var e=t;e.type=0,e.index=-1,e.separation=-B;var i=b2EPCollider.s_perp.Set(-this.m_normal.y,this.m_normal.x);for(var r=0;r<this.m_polygonB.count;++r){var n=j.NegV(this.m_polygonB.normals[r],b2EPCollider.s_n);var a=j.DotVV(n,j.SubVV(this.m_polygonB.vertices[r],this.m_v1,j.s_t0));var o=j.DotVV(n,j.SubVV(this.m_polygonB.vertices[r],this.m_v2,j.s_t0));a=L(a,o);if(a>this.m_radius)return e.type=2,e.index=r,e.separation=a,e;if(0<=j.DotVV(n,i)){if(j.DotVV(j.SubVV(n,this.m_upperLimit,j.s_t0),this.m_normal)<-P)continue;}else if(j.DotVV(j.SubVV(n,this.m_lowerLimit,j.s_t0),this.m_normal)<-P)continue;a>e.separation&&(e.type=2,e.index=r,e.separation=a);}return e;},b2EPCollider.s_edge1=new j(),b2EPCollider.s_edge0=new j(),b2EPCollider.s_edge2=new j(),b2EPCollider.s_ie=dt.MakeArray(2),b2EPCollider.s_rf=new Se(),b2EPCollider.s_clipPoints1=dt.MakeArray(2),b2EPCollider.s_clipPoints2=dt.MakeArray(2),b2EPCollider.s_edgeAxis=new xe(),b2EPCollider.s_polygonAxis=new xe(),b2EPCollider.s_n=new j(),b2EPCollider.s_perp=new j();var Te=new b2EPCollider();function b2CollideEdgeAndPolygon(t,e,i,r,n){Te.Collide(t,e,i,r,n);}var we=function(){this.mass=0,this.center=new j(0,0),this.I=0;};(Se=H.b2ShapeType||(H.b2ShapeType={}))[Se.e_unknown=-1]="e_unknown",Se[Se.e_circleShape=0]="e_circleShape",Se[Se.e_edgeShape=1]="e_edgeShape",Se[Se.e_polygonShape=2]="e_polygonShape",Se[Se.e_chainShape=3]="e_chainShape",Se[Se.e_shapeTypeCount=4]="e_shapeTypeCount";b2Shape.prototype.Copy=function(t){return this.m_radius=t.m_radius,this;},b2Shape.prototype.GetType=function(){return this.m_type;};var Ee=b2Shape;function b2Shape(t,e){this.m_type=H.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e;}var Pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);};function __extends(t,e){function __(){this.constructor=t;}Pe(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __());}__extends(b2CircleShape,Me=Ee),b2CircleShape.prototype.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this;},b2CircleShape.prototype.Clone=function(){return new b2CircleShape().Copy(this);},b2CircleShape.prototype.Copy=function(t){return Me.prototype.Copy.call(this,t),this.m_p.Copy(t.m_p),this;},b2CircleShape.prototype.GetChildCount=function(){return 1;},b2CircleShape.prototype.TestPoint=function(t,e){t=I.MulXV(t,this.m_p,b2CircleShape.TestPoint_s_center);e=j.SubVV(e,t,b2CircleShape.TestPoint_s_d);return j.DotVV(e,e)<=b2Sq(this.m_radius);},b2CircleShape.prototype.ComputeDistance=function(t,e,i,r){t=I.MulXV(t,this.m_p,b2CircleShape.ComputeDistance_s_center);return j.SubVV(e,t,i),i.Normalize()-this.m_radius;},b2CircleShape.prototype.RayCast=function(t,e,i,r){i=I.MulXV(i,this.m_p,b2CircleShape.RayCast_s_position);i=j.SubVV(e.p1,i,b2CircleShape.RayCast_s_s);var n=j.DotVV(i,i)-b2Sq(this.m_radius);var a=j.SubVV(e.p2,e.p1,b2CircleShape.RayCast_s_r);var o=j.DotVV(i,a);var s=j.DotVV(a,a);n=o*o-s*n;if(n<0||s<E)return!1;o=-(o+X(n));return 0<=o&&o<=e.maxFraction*s&&(t.fraction=o/=s,j.AddVMulSV(i,o,a,t.normal).SelfNormalize(),!0);},b2CircleShape.prototype.ComputeAABB=function(t,e,i){e=I.MulXV(e,this.m_p,b2CircleShape.ComputeAABB_s_p);t.lowerBound.Set(e.x-this.m_radius,e.y-this.m_radius),t.upperBound.Set(e.x+this.m_radius,e.y+this.m_radius);},b2CircleShape.prototype.ComputeMass=function(t,e){var i=b2Sq(this.m_radius);t.mass=e*m*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+j.DotVV(this.m_p,this.m_p));},b2CircleShape.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius;},b2CircleShape.prototype.ComputeSubmergedArea=function(t,e,i,r){i=I.MulXV(i,this.m_p,new j());e=-(j.DotVV(t,i)-e);if(e<-this.m_radius+E)return 0;if(e>this.m_radius)return r.Copy(i),m*this.m_radius*this.m_radius;var n=this.m_radius*this.m_radius;var a=e*e;e=n*(u(e/this.m_radius)+m/2)+e*X(n-a);n=-2/3*s(n-a,1.5)/e;return r.x=i.x+t.x*n,r.y=i.y+t.y*n,e;},b2CircleShape.prototype.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y);},b2CircleShape.TestPoint_s_center=new j(),b2CircleShape.TestPoint_s_d=new j(),b2CircleShape.ComputeDistance_s_center=new j(),b2CircleShape.RayCast_s_position=new j(),b2CircleShape.RayCast_s_s=new j(),b2CircleShape.RayCast_s_r=new j(),b2CircleShape.ComputeAABB_s_p=new j();xe=b2CircleShape;function b2CircleShape(t){t=Me.call(this,H.b2ShapeType.e_circleShape,t=void 0===t?0:t)||this;return t.m_p=new j(),t;}var Me;__extends(b2PolygonShape,Re=Ee),b2PolygonShape.prototype.Clone=function(){return new b2PolygonShape().Copy(this);},b2PolygonShape.prototype.Copy=function(t){Re.prototype.Copy.call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this;},b2PolygonShape.prototype.GetChildCount=function(){return 1;},b2PolygonShape.prototype.Set=function(h,t,u){if(void 0===u&&(u=0),(t=void 0===t?h.length:t)<3)return this.SetAsBox(1,1);var e=L(t,8);var i=b2PolygonShape.Set_s_ps;var _=0;for(var r=0;r<e;++r){var n=h[u+r];var d=!0;for(var a=0;a<_;++a)if(j.DistanceSquaredVV(n,i[a])<16e-6){d=!1;break;}d&&i[_++].Copy(n);}if((e=_)<3)return this.SetAsBox(1,1);var o=0;var f=i[0].x;for(r=1;r<e;++r){var p=i[r].x;(f<p||p===f&&i[r].y<i[o].y)&&(o=r,f=p);}var s=b2PolygonShape.Set_s_hull;var c=0;var m=o;for(;;){s[c]=m;var l=0;for(a=1;a<e;++a){var v,y;l!==m?(v=j.SubVV(i[l],i[s[c]],b2PolygonShape.Set_s_r),n=j.SubVV(i[a],i[s[c]],b2PolygonShape.Set_s_v),(y=j.CrossVV(v,n))<0&&(l=a),0===y&&n.LengthSquared()>v.LengthSquared()&&(l=a)):l=a;}if(++c,(m=l)===o)break;}this.m_count=c,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count);for(r=0;r<c;++r)this.m_vertices[r].Copy(i[s[r]]);for(r=0;r<c;++r){var g=this.m_vertices[r];var b=this.m_vertices[(r+1)%c];b=j.SubVV(b,g,j.s_t0);j.CrossVOne(b,this.m_normals[r]).SelfNormalize();}return b2PolygonShape.ComputeCentroid(this.m_vertices,c,this.m_centroid),this;},b2PolygonShape.prototype.SetAsArray=function(t,e){return void 0===e&&(e=t.length),this.Set(t,e);},b2PolygonShape.prototype.SetAsBox=function(t,e,i,r){if(void 0===r&&(r=0),this.m_count=4,this.m_vertices=j.MakeArray(this.m_count),this.m_normals=j.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new I();n.SetPosition(i),n.SetRotationAngle(r);for(var a=0;a<this.m_count;++a)I.MulXV(n,this.m_vertices[a],this.m_vertices[a]),R.MulRV(n.q,this.m_normals[a],this.m_normals[a]);}return this;},b2PolygonShape.prototype.TestPoint=function(t,e){var i=I.MulTXV(t,e,b2PolygonShape.TestPoint_s_pLocal);for(var r=0;r<this.m_count;++r)if(0<j.DotVV(this.m_normals[r],j.SubVV(i,this.m_vertices[r],j.s_t0)))return!1;return!0;},b2PolygonShape.prototype.ComputeDistance=function(t,h,e,u){var i=I.MulTXV(t,h,b2PolygonShape.ComputeDistance_s_pLocal);var r=-B;var n=b2PolygonShape.ComputeDistance_s_normalForMaxDistance.Copy(i);for(var a=0;a<this.m_count;++a){var o=j.DotVV(this.m_normals[a],j.SubVV(i,this.m_vertices[a],j.s_t0));r<o&&(r=o,n.Copy(this.m_normals[a]));}if(0<r){var s=b2PolygonShape.ComputeDistance_s_minDistance.Copy(n);var c=r*r;for(a=0;a<this.m_count;++a){var l=j.SubVV(i,this.m_vertices[a],b2PolygonShape.ComputeDistance_s_distance);var _=l.LengthSquared();_<c&&(s.Copy(l),c=_);}return R.MulRV(t.q,s,e),e.Normalize(),Math.sqrt(c);}return R.MulRV(t.q,n,e),r;},b2PolygonShape.prototype.RayCast=function(t,e,i,h){var r=I.MulTXV(i,e.p1,b2PolygonShape.RayCast_s_p1);var u=I.MulTXV(i,e.p2,b2PolygonShape.RayCast_s_p2);var _=j.SubVV(u,r,b2PolygonShape.RayCast_s_d);var n=0,a=e.maxFraction;var o=-1;for(var s=0;s<this.m_count;++s){var c=j.DotVV(this.m_normals[s],j.SubVV(this.m_vertices[s],r,j.s_t0));var l=j.DotVV(this.m_normals[s],_);if(0===l){if(c<0)return!1;}else l<0&&c<n*l?(n=c/l,o=s):0<l&&c<a*l&&(a=c/l);if(a<n)return!1;}return 0<=o&&(t.fraction=n,R.MulRV(i.q,this.m_normals[o],t.normal),!0);},b2PolygonShape.prototype.ComputeAABB=function(t,e,i){var r=I.MulXV(e,this.m_vertices[0],t.lowerBound);var n=t.upperBound.Copy(r);for(var a=0;a<this.m_count;++a){var o=I.MulXV(e,this.m_vertices[a],b2PolygonShape.ComputeAABB_s_v);j.MinV(o,r,r),j.MaxV(o,n,n);}t=this.m_radius;r.SelfSubXY(t,t),n.SelfAddXY(t,t);},b2PolygonShape.prototype.ComputeMass=function(t,e){var i=b2PolygonShape.ComputeMass_s_center.SetZero();var r=0;var h=0;var n=b2PolygonShape.ComputeMass_s_s.SetZero();for(var a=0;a<this.m_count;++a)n.SelfAdd(this.m_vertices[a]);n.SelfMul(1/this.m_count);for(a=0;a<this.m_count;++a){var o=j.SubVV(this.m_vertices[a],n,b2PolygonShape.ComputeMass_s_e1);var s=j.SubVV(this.m_vertices[(a+1)%this.m_count],n,b2PolygonShape.ComputeMass_s_e2);var u=j.CrossVV(o,s);var c=.5*u;r+=c,i.SelfAdd(j.MulSV(1/3*c,j.AddVV(o,s,j.s_t0),j.s_t1));c=o.x;o=o.y;var l=s.x;s=s.y;h+=1/3*.25*u*(c*c+l*c+l*l+(o*o+s*o+s*s));}t.mass=e*r,i.SelfMul(1/r),j.AddVV(i,n,t.center),t.I=e*h,t.I+=t.mass*(j.DotVV(t.center,t.center)-j.DotVV(i,i));},b2PolygonShape.prototype.Validate=function(){for(var t=0;t<this.m_count;++t){var e=t;var i=(t+1)%this.m_count;var r=this.m_vertices[e];var n=j.SubVV(this.m_vertices[i],r,b2PolygonShape.Validate_s_e);for(var a=0;a<this.m_count;++a)if(a!==e&&a!==i){var o=j.SubVV(this.m_vertices[a],r,b2PolygonShape.Validate_s_v);if(j.CrossVV(n,o)<0)return!1;}}return!0;},b2PolygonShape.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius;},b2PolygonShape.prototype.ComputeSubmergedArea=function(t,e,h,u){var _=R.MulTRV(h.q,t,b2PolygonShape.ComputeSubmergedArea_s_normalL);var d=e-j.DotVV(t,h.p);var i=b2PolygonShape.ComputeSubmergedArea_s_depths;var f=0;var r=-1;var n=-1;var p=!1;for(var a=0;a<this.m_count;++a){i[a]=j.DotVV(_,this.m_vertices[a])-d;var m=i[a]<-E;0<a&&(m?p||(r=a-1,f++):p&&(n=a-1,f++)),p=m;}switch(f){case 0:var v;return p?(this.ComputeMass(v=b2PolygonShape.ComputeSubmergedArea_s_md,1),I.MulXV(h,v.center,u),v.mass):0;case 1:-1===r?r=this.m_count-1:n=this.m_count-1;}e=(r+1)%this.m_count;var o=(n+1)%this.m_count;t=(0-i[r])/(i[e]-i[r]);var y=(0-i[n])/(i[o]-i[n]);var s=b2PolygonShape.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[r].x*(1-t)+this.m_vertices[e].x*t,this.m_vertices[r].y*(1-t)+this.m_vertices[e].y*t);var g=b2PolygonShape.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[n].x*(1-y)+this.m_vertices[o].x*y,this.m_vertices[n].y*(1-y)+this.m_vertices[o].y*y);var b=0;var C=b2PolygonShape.ComputeSubmergedArea_s_center.SetZero();var c=this.m_vertices[e];var l;var x=e;for(;x!==o;){l=(x=(x+1)%this.m_count)===o?g:this.m_vertices[x];var A=.5*((c.x-s.x)*(l.y-s.y)-(c.y-s.y)*(l.x-s.x));b+=A,C.x+=A*(s.x+c.x+l.x)/3,C.y+=A*(s.y+c.y+l.y)/3,c=l;}return C.SelfMul(1/b),I.MulXV(h,C,u),b;},b2PolygonShape.prototype.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count);},b2PolygonShape.ComputeCentroid=function(t,e,i){var r=i;r.SetZero();var n=0;var h=b2PolygonShape.ComputeCentroid_s_pRef.SetZero();for(var a=0;a<e;++a){var o=h;var s=t[a];var c=t[(a+1)%e];var l=j.SubVV(s,o,b2PolygonShape.ComputeCentroid_s_e1);var u=j.SubVV(c,o,b2PolygonShape.ComputeCentroid_s_e2);l=.5*j.CrossVV(l,u);n+=l,r.x+=1/3*l*(o.x+s.x+c.x),r.y+=1/3*l*(o.y+s.y+c.y);}return r.SelfMul(1/n),r;},b2PolygonShape.Set_s_ps=j.MakeArray(8),b2PolygonShape.Set_s_hull=b2MakeNumberArray(8),b2PolygonShape.Set_s_r=new j(),b2PolygonShape.Set_s_v=new j(),b2PolygonShape.TestPoint_s_pLocal=new j(),b2PolygonShape.ComputeDistance_s_pLocal=new j(),b2PolygonShape.ComputeDistance_s_normalForMaxDistance=new j(),b2PolygonShape.ComputeDistance_s_minDistance=new j(),b2PolygonShape.ComputeDistance_s_distance=new j(),b2PolygonShape.RayCast_s_p1=new j(),b2PolygonShape.RayCast_s_p2=new j(),b2PolygonShape.RayCast_s_d=new j(),b2PolygonShape.ComputeAABB_s_v=new j(),b2PolygonShape.ComputeMass_s_center=new j(),b2PolygonShape.ComputeMass_s_s=new j(),b2PolygonShape.ComputeMass_s_e1=new j(),b2PolygonShape.ComputeMass_s_e2=new j(),b2PolygonShape.Validate_s_e=new j(),b2PolygonShape.Validate_s_v=new j(),b2PolygonShape.ComputeSubmergedArea_s_normalL=new j(),b2PolygonShape.ComputeSubmergedArea_s_depths=b2MakeNumberArray(8),b2PolygonShape.ComputeSubmergedArea_s_md=new we(),b2PolygonShape.ComputeSubmergedArea_s_intoVec=new j(),b2PolygonShape.ComputeSubmergedArea_s_outoVec=new j(),b2PolygonShape.ComputeSubmergedArea_s_center=new j(),b2PolygonShape.ComputeCentroid_s_pRef=new j(),b2PolygonShape.ComputeCentroid_s_e1=new j(),b2PolygonShape.ComputeCentroid_s_e2=new j();Se=b2PolygonShape;function b2PolygonShape(){var t=Re.call(this,H.b2ShapeType.e_polygonShape,.016)||this;return t.m_centroid=new j(0,0),t.m_vertices=[],t.m_normals=[],t.m_count=0,t;}var Re;__extends(b2EdgeShape,Be=Ee),b2EdgeShape.prototype.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this;},b2EdgeShape.prototype.Clone=function(){return new b2EdgeShape().Copy(this);},b2EdgeShape.prototype.Copy=function(t){return Be.prototype.Copy.call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this;},b2EdgeShape.prototype.GetChildCount=function(){return 1;},b2EdgeShape.prototype.TestPoint=function(t,e){return!1;},b2EdgeShape.prototype.ComputeDistance=function(t,e,i,r){var n=I.MulXV(t,this.m_vertex1,b2EdgeShape.ComputeDistance_s_v1);t=I.MulXV(t,this.m_vertex2,b2EdgeShape.ComputeDistance_s_v2);var a=j.SubVV(e,n,b2EdgeShape.ComputeDistance_s_d);n=j.SubVV(t,n,b2EdgeShape.ComputeDistance_s_s);var o=j.DotVV(a,n);var s;return 0<o&&((s=j.DotVV(n,n))<o?j.SubVV(e,t,a):a.SelfMulSub(o/s,n)),i.Copy(a),i.Normalize();},b2EdgeShape.prototype.RayCast=function(t,e,i,l){var r=I.MulTXV(i,e.p1,b2EdgeShape.RayCast_s_p1);var n=I.MulTXV(i,e.p2,b2EdgeShape.RayCast_s_p2);n=j.SubVV(n,r,b2EdgeShape.RayCast_s_d);var a=this.m_vertex1;var o=this.m_vertex2;var s=j.SubVV(o,a,b2EdgeShape.RayCast_s_e);s=t.normal.Set(s.y,-s.x).SelfNormalize();var c=j.DotVV(s,j.SubVV(a,r,j.s_t0));s=j.DotVV(s,n);if(0===s)return!1;s=c/s;if(s<0||e.maxFraction<s)return!1;e=j.AddVMulSV(r,s,n,b2EdgeShape.RayCast_s_q);r=j.SubVV(o,a,b2EdgeShape.RayCast_s_r);n=j.DotVV(r,r);if(0===n)return!1;o=j.DotVV(j.SubVV(e,a,j.s_t0),r)/n;return!(o<0||1<o)&&(t.fraction=s,R.MulRV(i.q,t.normal,t.normal),0<c&&t.normal.SelfNeg(),!0);},b2EdgeShape.prototype.ComputeAABB=function(t,e,i){var r=I.MulXV(e,this.m_vertex1,b2EdgeShape.ComputeAABB_s_v1);e=I.MulXV(e,this.m_vertex2,b2EdgeShape.ComputeAABB_s_v2);j.MinV(r,e,t.lowerBound),j.MaxV(r,e,t.upperBound);r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r);},b2EdgeShape.prototype.ComputeMass=function(t,e){t.mass=0,j.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0;},b2EdgeShape.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius;},b2EdgeShape.prototype.ComputeSubmergedArea=function(t,e,i,r){return r.SetZero(),0;},b2EdgeShape.prototype.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3);},b2EdgeShape.ComputeDistance_s_v1=new j(),b2EdgeShape.ComputeDistance_s_v2=new j(),b2EdgeShape.ComputeDistance_s_d=new j(),b2EdgeShape.ComputeDistance_s_s=new j(),b2EdgeShape.RayCast_s_p1=new j(),b2EdgeShape.RayCast_s_p2=new j(),b2EdgeShape.RayCast_s_d=new j(),b2EdgeShape.RayCast_s_e=new j(),b2EdgeShape.RayCast_s_q=new j(),b2EdgeShape.RayCast_s_r=new j(),b2EdgeShape.ComputeAABB_s_v1=new j(),b2EdgeShape.ComputeAABB_s_v2=new j();var Ie=b2EdgeShape;function b2EdgeShape(){var t=Be.call(this,H.b2ShapeType.e_edgeShape,.016)||this;return t.m_vertex1=new j(),t.m_vertex2=new j(),t.m_vertex0=new j(),t.m_vertex3=new j(),t.m_hasVertex0=!1,t.m_hasVertex3=!1,t;}var Be;__extends(b2ChainShape,Le=Ee),b2ChainShape.prototype.CreateLoop=function(t,e,i){if(void 0===i&&(i=0),(e=void 0===e?t.length:e)<3)return this;this.m_count=e+1,this.m_vertices=j.MakeArray(this.m_count);for(var r=0;r<e;++r)this.m_vertices[r].Copy(t[i+r]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this;},b2ChainShape.prototype.CreateChain=function(t,e,i){void 0===e&&(e=t.length),void 0===i&&(i=0),this.m_count=e,this.m_vertices=j.MakeArray(e);for(var r=0;r<e;++r)this.m_vertices[r].Copy(t[i+r]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this;},b2ChainShape.prototype.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this;},b2ChainShape.prototype.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this;},b2ChainShape.prototype.Clone=function(){return new b2ChainShape().Copy(this);},b2ChainShape.prototype.Copy=function(t){return Le.prototype.Copy.call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this;},b2ChainShape.prototype.GetChildCount=function(){return this.m_count-1;},b2ChainShape.prototype.GetChildEdge=function(t,e){t.m_type=H.b2ShapeType.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),0<e?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex);},b2ChainShape.prototype.TestPoint=function(t,e){return!1;},b2ChainShape.prototype.ComputeDistance=function(t,e,i,r){var n=b2ChainShape.ComputeDistance_s_edgeShape;return this.GetChildEdge(n,r),n.ComputeDistance(t,e,i,0);},b2ChainShape.prototype.RayCast=function(t,e,i,r){var n=b2ChainShape.RayCast_s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[r]),n.m_vertex2.Copy(this.m_vertices[(r+1)%this.m_count]),n.RayCast(t,e,i,0);},b2ChainShape.prototype.ComputeAABB=function(t,e,i){var r=this.m_vertices[i];i=this.m_vertices[(i+1)%this.m_count];r=I.MulXV(e,r,b2ChainShape.ComputeAABB_s_v1);e=I.MulXV(e,i,b2ChainShape.ComputeAABB_s_v2);j.MinV(r,e,t.lowerBound),j.MaxV(r,e,t.upperBound);},b2ChainShape.prototype.ComputeMass=function(t,e){t.mass=0,t.center.SetZero(),t.I=0;},b2ChainShape.prototype.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius;},b2ChainShape.prototype.ComputeSubmergedArea=function(t,e,i,r){return r.SetZero(),0;},b2ChainShape.prototype.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",8);for(var e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false");},b2ChainShape.ComputeDistance_s_edgeShape=new Ie(),b2ChainShape.RayCast_s_edgeShape=new Ie(),b2ChainShape.ComputeAABB_s_v1=new j(),b2ChainShape.ComputeAABB_s_v2=new j();var De=b2ChainShape;function b2ChainShape(){var t=Le.call(this,H.b2ShapeType.e_chainShape,.016)||this;return t.m_vertices=[],t.m_count=0,t.m_prevVertex=new j(),t.m_nextVertex=new j(),t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t;}var Le;b2Filter.prototype.Clone=function(){return new b2Filter().Copy(this);},b2Filter.prototype.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this;},b2Filter.DEFAULT=new b2Filter();var Ve=b2Filter;function b2Filter(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0;}var Oe=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new Ve();};var Fe=function(t){this.aabb=new mt(),this.childIndex=0,this.fixture=t;};b2Fixture.prototype.GetType=function(){return this.m_shape.GetType();},b2Fixture.prototype.GetShape=function(){return this.m_shape;},b2Fixture.prototype.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t);},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor;},b2Fixture.prototype.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter();},b2Fixture.prototype.GetFilterData=function(){return this.m_filter;},b2Fixture.prototype.Refilter=function(){var t=this.m_body.GetContactList();for(;t;){var e=t.contact;var i=e.GetFixtureA();var r=e.GetFixtureB();i!==this&&r!==this||e.FlagForFiltering(),t=t.next;}var n=this.m_body.GetWorld();if(null!==n){var a=n.m_contactManager.m_broadPhase;for(var o=0;o<this.m_proxyCount;++o)a.TouchProxy(this.m_proxies[o].treeNode);}},b2Fixture.prototype.GetBody=function(){return this.m_body;},b2Fixture.prototype.GetNext=function(){return this.m_next;},b2Fixture.prototype.GetUserData=function(){return this.m_userData;},b2Fixture.prototype.SetUserData=function(t){this.m_userData=t;},b2Fixture.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t);},b2Fixture.prototype.ComputeDistance=function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i);},b2Fixture.prototype.RayCast=function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i);},b2Fixture.prototype.GetMassData=function(t){return void 0===t&&(t=new we()),this.m_shape.ComputeMass(t,this.m_density),t;},b2Fixture.prototype.SetDensity=function(t){this.m_density=t;},b2Fixture.prototype.GetDensity=function(){return this.m_density;},b2Fixture.prototype.GetFriction=function(){return this.m_friction;},b2Fixture.prototype.SetFriction=function(t){this.m_friction=t;},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution;},b2Fixture.prototype.SetRestitution=function(t){this.m_restitution=t;},b2Fixture.prototype.GetAABB=function(t){return this.m_proxies[t].aabb;},b2Fixture.prototype.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e);},b2Fixture.prototype.Create=function(t){var e=this;this.m_userData=t.userData,this.m_friction=b2Maybe(t.friction,.2),this.m_restitution=b2Maybe(t.restitution,0),this.m_next=null,this.m_filter.Copy(b2Maybe(t.filter,Ve.DEFAULT)),this.m_isSensor=b2Maybe(t.isSensor,!1),this.m_proxies=b2MakeArray(this.m_shape.GetChildCount(),function(t){return new Fe(e);}),this.m_proxyCount=0,this.m_density=b2Maybe(t.density,0);},b2Fixture.prototype.Destroy=function(){},b2Fixture.prototype.CreateProxies=function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var r=this.m_proxies[i]=new Fe(this);this.m_shape.ComputeAABB(r.aabb,t,i),r.treeNode=e.CreateProxy(r.aabb,r),r.childIndex=i;}},b2Fixture.prototype.DestroyProxies=function(){var t=this.m_body.m_world.m_contactManager.m_broadPhase;for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode;}this.m_proxyCount=0;},b2Fixture.prototype.TouchProxies=function(){var t=this.m_body.m_world.m_contactManager.m_broadPhase;var e=this.m_proxyCount;for(var i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode);},b2Fixture.prototype.Synchronize=function(t,e){if(0!==this.m_proxyCount){var i=this.m_body.m_world.m_contactManager.m_broadPhase;for(var r=0;r<this.m_proxyCount;++r){var n=this.m_proxies[r];var a=b2Fixture.Synchronize_s_aabb1;var o=b2Fixture.Synchronize_s_aabb2;this.m_shape.ComputeAABB(a,t,r),this.m_shape.ComputeAABB(o,e,r),n.aabb.Combine2(a,o);a=j.SubVV(e.p,t.p,b2Fixture.Synchronize_s_displacement);i.MoveProxy(n.treeNode,n.aabb,a);}}},b2Fixture.Synchronize_s_aabb1=new mt(),b2Fixture.Synchronize_s_aabb2=new mt(),b2Fixture.Synchronize_s_displacement=new j();var Ne=b2Fixture;function b2Fixture(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new Ve(),this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone();}(Ge=H.b2BodyType||(H.b2BodyType={}))[Ge.b2_unknown=-1]="b2_unknown",Ge[Ge.b2_staticBody=0]="b2_staticBody",Ge[Ge.b2_kinematicBody=1]="b2_kinematicBody",Ge[Ge.b2_dynamicBody=2]="b2_dynamicBody";function N9T(){this.type=H.b2BodyType.b2_staticBody,this.position=new j(0,0),this.angle=0,this.linearVelocity=new j(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1;}b2Body.prototype.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof Ee?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t);},b2Body.prototype.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error();var e=new Ne(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,0<e.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,e;},b2Body.prototype.CreateFixtureShapeDensity=function(t,e){void 0===e&&(e=0);var i=b2Body.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i);},b2Body.prototype.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error();var e=this.m_fixtureList;var i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break;}e=(i=e).m_next;}var r=this.m_contactList;for(;r;){var n=r.contact;r=r.next;var a=n.GetFixtureA();var o=n.GetFixtureB();t!==a&&t!==o||this.m_world.m_contactManager.Destroy(n);}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData();},b2Body.prototype.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e);},b2Body.prototype.SetTransformXY=function(t,e,i){if(this.m_world.IsLocked())throw new Error();this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),I.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts();},b2Body.prototype.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle());},b2Body.prototype.GetTransform=function(){return this.m_xf;},b2Body.prototype.GetPosition=function(){return this.m_xf.p;},b2Body.prototype.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle());},b2Body.prototype.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle());},b2Body.prototype.GetAngle=function(){return this.m_sweep.a;},b2Body.prototype.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t);},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c;},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter;},b2Body.prototype.SetLinearVelocity=function(t){this.m_type!==H.b2BodyType.b2_staticBody&&(0<j.DotVV(t,t)&&this.SetAwake(!0),this.m_linearVelocity.Copy(t));},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity;},b2Body.prototype.SetAngularVelocity=function(t){this.m_type!==H.b2BodyType.b2_staticBody&&(0<t*t&&this.SetAwake(!0),this.m_angularVelocity=t);},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity;},b2Body.prototype.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t;},b2Body.prototype.ApplyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x));},b2Body.prototype.ApplyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y));},b2Body.prototype.ApplyTorque=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t));},b2Body.prototype.ApplyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)));},b2Body.prototype.ApplyLinearImpulseToCenter=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y));},b2Body.prototype.ApplyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type===H.b2BodyType.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t));},b2Body.prototype.GetMass=function(){return this.m_mass;},b2Body.prototype.GetInertia=function(){return this.m_I+this.m_mass*j.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter);},b2Body.prototype.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*j.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t;},b2Body.prototype.SetMassData=function(t){if(this.m_world.IsLocked())throw new Error();var e;this.m_type===H.b2BodyType.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*j.DotVV(t.center,t.center),this.m_invI=1/this.m_I),e=b2Body.SetMassData_s_oldCenter.Copy(this.m_sweep.c),this.m_sweep.localCenter.Copy(t.center),I.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(this.m_sweep.c,e,j.s_t0),this.m_linearVelocity));},b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===H.b2BodyType.b2_staticBody||this.m_type===H.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);var t=b2Body.ResetMassData_s_localCenter.SetZero();for(var e=this.m_fixtureList;e;e=e.m_next){var i;0!==e.m_density&&(i=e.GetMassData(b2Body.ResetMassData_s_massData),this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I);}0<this.m_mass?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*j.DotVV(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=b2Body.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),I.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(this.m_sweep.c,r,j.s_t0),this.m_linearVelocity);},b2Body.prototype.GetWorldPoint=function(t,e){return I.MulXV(this.m_xf,t,e);},b2Body.prototype.GetWorldVector=function(t,e){return R.MulRV(this.m_xf.q,t,e);},b2Body.prototype.GetLocalPoint=function(t,e){return I.MulTXV(this.m_xf,t,e);},b2Body.prototype.GetLocalVector=function(t,e){return R.MulTRV(this.m_xf.q,t,e);},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(t,e){return j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(t,this.m_sweep.c,j.s_t0),e);},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e);},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping;},b2Body.prototype.SetLinearDamping=function(t){this.m_linearDamping=t;},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping;},b2Body.prototype.SetAngularDamping=function(t){this.m_angularDamping=t;},b2Body.prototype.GetGravityScale=function(){return this.m_gravityScale;},b2Body.prototype.SetGravityScale=function(t){this.m_gravityScale=t;},b2Body.prototype.SetType=function(t){if(this.m_world.IsLocked())throw new Error();if(this.m_type!==t){this.m_type=t,this.ResetMassData(),this.m_type===H.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;var e=this.m_contactList;for(;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact);}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies();}},b2Body.prototype.GetType=function(){return this.m_type;},b2Body.prototype.SetBullet=function(t){this.m_bulletFlag=t;},b2Body.prototype.IsBullet=function(){return this.m_bulletFlag;},b2Body.prototype.SetSleepingAllowed=function(t){(this.m_autoSleepFlag=t)||this.SetAwake(!0);},b2Body.prototype.IsSleepingAllowed=function(){return this.m_autoSleepFlag;},b2Body.prototype.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);},b2Body.prototype.IsAwake=function(){return this.m_awakeFlag;},b2Body.prototype.SetActive=function(t){if(this.m_world.IsLocked())throw new Error();if(t!==this.IsActive())if(this.m_activeFlag=t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies();var i=this.m_contactList;for(;i;){var r=i;i=i.next,this.m_world.m_contactManager.Destroy(r.contact);}this.m_contactList=null;}},b2Body.prototype.IsActive=function(){return this.m_activeFlag;},b2Body.prototype.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData());},b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotationFlag;},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList;},b2Body.prototype.GetJointList=function(){return this.m_jointList;},b2Body.prototype.GetContactList=function(){return this.m_contactList;},b2Body.prototype.GetNext=function(){return this.m_next;},b2Body.prototype.GetUserData=function(){return this.m_userData;},b2Body.prototype.SetUserData=function(t){this.m_userData=t;},b2Body.prototype.GetWorld=function(){return this.m_world;},b2Body.prototype.Dump=function(t){var e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");var i="";switch(this.m_type){case H.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case H.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case H.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody";}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(var r=this.m_fixtureList;r;r=r.m_next)t("  {\n"),r.Dump(t,e),t("  }\n");t("}\n");},b2Body.prototype.SynchronizeFixtures=function(){var t=b2Body.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),R.MulRV(t.q,this.m_sweep.localCenter,t.p),j.SubVV(this.m_sweep.c0,t.p,t.p);for(var e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf);},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),R.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),j.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p);},b2Body.prototype.ShouldCollide=function(t){return(this.m_type!==H.b2BodyType.b2_staticBody||t.m_type!==H.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(t);},b2Body.prototype.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0;},b2Body.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),R.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),j.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p);},b2Body.prototype.GetControllerList=function(){return this.m_controllerList;},b2Body.prototype.GetControllerCount=function(){return this.m_controllerCount;},b2Body.CreateFixtureShapeDensity_s_def=new Oe(),b2Body.SetMassData_s_oldCenter=new j(),b2Body.ResetMassData_s_localCenter=new j(),b2Body.ResetMassData_s_oldCenter=new j(),b2Body.ResetMassData_s_massData=new we(),b2Body.SynchronizeFixtures_s_xf1=new I();var ke=b2Body;function b2Body(t,e){this.m_type=H.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new I(),this.m_xf0=new I(),this.m_sweep=new b(),this.m_linearVelocity=new j(),this.m_angularVelocity=0,this.m_force=new j(),this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=b2Maybe(t.bullet,!1),this.m_fixedRotationFlag=b2Maybe(t.fixedRotation,!1),this.m_autoSleepFlag=b2Maybe(t.allowSleep,!0),this.m_awakeFlag=b2Maybe(t.awake,!0),this.m_activeFlag=b2Maybe(t.active,!0),this.m_world=e,this.m_xf.p.Copy(b2Maybe(t.position,j.ZERO)),this.m_xf.q.SetAngle(b2Maybe(t.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(b2Maybe(t.linearVelocity,j.ZERO)),this.m_angularVelocity=b2Maybe(t.angularVelocity,0),this.m_linearDamping=b2Maybe(t.linearDamping,0),this.m_angularDamping=b2Maybe(t.angularDamping,0),this.m_gravityScale=b2Maybe(t.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=b2Maybe(t.type,H.b2BodyType.b2_staticBody),t.type===H.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0;}(Ge=H.b2JointType||(H.b2JointType={}))[Ge.e_unknownJoint=0]="e_unknownJoint",Ge[Ge.e_revoluteJoint=1]="e_revoluteJoint",Ge[Ge.e_prismaticJoint=2]="e_prismaticJoint",Ge[Ge.e_distanceJoint=3]="e_distanceJoint",Ge[Ge.e_pulleyJoint=4]="e_pulleyJoint",Ge[Ge.e_mouseJoint=5]="e_mouseJoint",Ge[Ge.e_gearJoint=6]="e_gearJoint",Ge[Ge.e_wheelJoint=7]="e_wheelJoint",Ge[Ge.e_weldJoint=8]="e_weldJoint",Ge[Ge.e_frictionJoint=9]="e_frictionJoint",Ge[Ge.e_ropeJoint=10]="e_ropeJoint",Ge[Ge.e_motorJoint=11]="e_motorJoint",Ge[Ge.e_areaJoint=12]="e_areaJoint",(Ge=H.b2LimitState||(H.b2LimitState={}))[Ge.e_inactiveLimit=0]="e_inactiveLimit",Ge[Ge.e_atLowerLimit=1]="e_atLowerLimit",Ge[Ge.e_atUpperLimit=2]="e_atUpperLimit",Ge[Ge.e_equalLimits=3]="e_equalLimits";b2Jacobian.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this;},b2Jacobian.prototype.Set=function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this;};var Ge=b2Jacobian;function b2Jacobian(){this.linear=new j(),this.angularA=0,this.angularB=0;}var ze=function(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e;};function D9T(t){this.type=H.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=t;}b2Joint.prototype.GetType=function(){return this.m_type;},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA;},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB;},b2Joint.prototype.GetNext=function(){return this.m_next;},b2Joint.prototype.GetUserData=function(){return this.m_userData;},b2Joint.prototype.SetUserData=function(t){this.m_userData=t;},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive();},b2Joint.prototype.GetCollideConnected=function(){return this.m_collideConnected;},b2Joint.prototype.Dump=function(t){t("// Dump is not supported for this joint type.\n");},b2Joint.prototype.ShiftOrigin=function(t){};var Ue=b2Joint;function b2Joint(t){this.m_type=H.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new ze(this,t.bodyB),this.m_edgeB=new ze(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=b2Maybe(t.collideConnected,!1),this.m_userData=t.userData;}__extends(b2DistanceJointDef,He=D9T),b2DistanceJointDef.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.length=j.DistanceVV(i,r),this.frequencyHz=0,this.dampingRatio=0;};var We=b2DistanceJointDef;function b2DistanceJointDef(){var t=He.call(this,H.b2JointType.e_distanceJoint)||this;return t.localAnchorA=new j(),t.localAnchorB=new j(),t.length=1,t.frequencyHz=0,t.dampingRatio=0,t;}var He;__extends(b2DistanceJoint,Xe=Ue),b2DistanceJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2DistanceJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2DistanceJoint.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e;},b2DistanceJoint.prototype.GetReactionTorque=function(t){return 0;},b2DistanceJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2DistanceJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2DistanceJoint.prototype.SetLength=function(t){this.m_length=t;},b2DistanceJoint.prototype.Length=function(){return this.m_length;},b2DistanceJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t;},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz;},b2DistanceJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio;},b2DistanceJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2DistanceJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.velocities[this.m_indexA].v;var n=t.velocities[this.m_indexA].w;var a=t.positions[this.m_indexB].c;var o=t.positions[this.m_indexB].a;var s=t.velocities[this.m_indexB].v;var c=t.velocities[this.m_indexB].w;i=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(o);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(o,this.m_lalcB,this.m_rB),this.m_u.x=a.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-e.y-this.m_rA.y;i=this.m_u.Length();M<i?this.m_u.SelfMul(1/i):this.m_u.SetZero();o=j.CrossVV(this.m_rA,this.m_u);a=j.CrossVV(this.m_rB,this.m_u);e=this.m_invMassA+this.m_invIA*o*o+this.m_invMassB+this.m_invIB*a*a;var l;this.m_mass=0!==e?1/e:0,0<this.m_frequencyHz?(o=i-this.m_length,a=2*m*this.m_frequencyHz,i=2*this.m_mass*this.m_dampingRatio*a,a=this.m_mass*a*a,l=t.step.dt,this.m_gamma=l*(i+l*a),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*l*a*this.m_gamma,e+=this.m_gamma,this.m_mass=0!==e?1/e:0):(this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,i=j.MulSV(this.m_impulse,this.m_u,b2DistanceJoint.InitVelocityConstraints_s_P),r.SelfMulSub(this.m_invMassA,i),n-=this.m_invIA*j.CrossVV(this.m_rA,i),s.SelfMulAdd(this.m_invMassB,i),c+=this.m_invIB*j.CrossVV(this.m_rB,i)):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=c;},b2DistanceJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=j.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA);var o=j.AddVCrossSV(r,n,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB);o=j.DotVV(this.m_u,j.SubVV(o,a,j.s_t0));a=-this.m_mass*(o+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;o=j.MulSV(a,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,o),i-=this.m_invIA*j.CrossVV(this.m_rA,o),r.SelfMulAdd(this.m_invMassB,o),n+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2DistanceJoint.prototype.SolvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.positions[this.m_indexB].c;var n=t.positions[this.m_indexB].a;var a=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(n);a=R.MulRV(a,this.m_lalcA,this.m_rA);o=R.MulRV(o,this.m_lalcB,this.m_rB);var s=this.m_u;var c;s.x=r.x+o.x-e.x-a.x,s.y=r.y+o.y-e.y-a.y,c=b2Clamp(this.m_u.Normalize()-this.m_length,-.2,.2);var l=-this.m_mass*c;l=j.MulSV(l,s,b2DistanceJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*j.CrossVV(a,l),r.SelfMulAdd(this.m_invMassB,l),n+=this.m_invIB*j.CrossVV(o,l),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,D(c)<M;},b2DistanceJoint.InitVelocityConstraints_s_P=new j(),b2DistanceJoint.SolveVelocityConstraints_s_vpA=new j(),b2DistanceJoint.SolveVelocityConstraints_s_vpB=new j(),b2DistanceJoint.SolveVelocityConstraints_s_P=new j(),b2DistanceJoint.SolvePositionConstraints_s_P=new j();var je=b2DistanceJoint;function b2DistanceJoint(t){var e=Xe.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_gamma=0,e.m_impulse=0,e.m_length=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new j(),e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_frequencyHz=b2Maybe(t.frequencyHz,0),e.m_dampingRatio=b2Maybe(t.dampingRatio,0),e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_length=t.length,e;}var Xe;__extends(b2AreaJointDef,Ye=D9T),b2AreaJointDef.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t);};var qe=b2AreaJointDef;function b2AreaJointDef(){var t=Ye.call(this,H.b2JointType.e_areaJoint)||this;return t.bodies=[],t.frequencyHz=0,t.dampingRatio=0,t;}var Ye;__extends(b2AreaJoint,Ze=Ue),b2AreaJoint.prototype.GetAnchorA=function(t){return t;},b2AreaJoint.prototype.GetAnchorB=function(t){return t;},b2AreaJoint.prototype.GetReactionForce=function(t,e){return e;},b2AreaJoint.prototype.GetReactionTorque=function(t){return 0;},b2AreaJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t);},b2AreaJoint.prototype.GetFrequency=function(){return this.m_frequencyHz;},b2AreaJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t);},b2AreaJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio;},b2AreaJoint.prototype.Dump=function(t){t("Area joint dumping is not supported.\n");},b2AreaJoint.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length];var r=this.m_bodies[(e+1)%this.m_bodies.length];i=t.positions[i.m_islandIndex].c;r=t.positions[r.m_islandIndex].c;var n=this.m_deltas[e];j.SubVV(r,i,n);}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(e=0;e<this.m_bodies.length;++e){var a=this.m_bodies[e];var o=t.velocities[a.m_islandIndex].v;n=this.m_deltas[e];o.x+=a.m_invMass*n.y*.5*this.m_impulse,o.y+=a.m_invMass*-n.x*.5*this.m_impulse;}}else this.m_impulse=0;},b2AreaJoint.prototype.SolveVelocityConstraints=function(t){var e=0;var i=0;for(var r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r];var a=t.velocities[n.m_islandIndex].v;e+=(s=this.m_deltas[r]).LengthSquared()/n.GetMass(),i+=j.CrossVV(a,s);}var o=-2*i/e;this.m_impulse+=o;for(r=0;r<this.m_bodies.length;++r){n=this.m_bodies[r];a=t.velocities[n.m_islandIndex].v;var s=this.m_deltas[r];a.x+=n.m_invMass*s.y*.5*o,a.y+=n.m_invMass*-s.x*.5*o;}},b2AreaJoint.prototype.SolvePositionConstraints=function(t){var e=0;var i=0;for(var r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r];var a=this.m_bodies[(r+1)%this.m_bodies.length];var o=t.positions[n.m_islandIndex].c;a=t.positions[a.m_islandIndex].c;var s=(l=j.SubVV(a,o,this.m_delta)).Length();s<E&&(s=1),this.m_normals[r].x=l.y/s,this.m_normals[r].y=-l.x/s,e+=s,i+=j.CrossVV(o,a);}var h=.5*(this.m_targetArea-(i*=.5))/e;var u=!0;for(r=0;r<this.m_bodies.length;++r){n=this.m_bodies[r];o=t.positions[n.m_islandIndex].c;var c=(r+1)%this.m_bodies.length;var l;(l=j.AddVV(this.m_normals[r],this.m_normals[c],this.m_delta)).SelfMul(h);c=l.LengthSquared();c>b2Sq(.2)&&l.SelfMul(.2/X(c)),64e-6<c&&(u=!1),o.x+=l.x,o.y+=l.y;}return u;};var Je=b2AreaJoint;function b2AreaJoint(t){var e=Ze.call(this,t)||this;e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_impulse=0,e.m_targetArea=0,e.m_bodies=t.bodies,e.m_frequencyHz=b2Maybe(t.frequencyHz,0),e.m_dampingRatio=b2Maybe(t.dampingRatio,0),e.m_targetLengths=b2MakeNumberArray(t.bodies.length),e.m_normals=j.MakeArray(t.bodies.length),e.m_joints=[],e.m_deltas=j.MakeArray(t.bodies.length),e.m_delta=new j();var i=new We();i.frequencyHz=e.m_frequencyHz,i.dampingRatio=e.m_dampingRatio;for(var r=e.m_targetArea=0;r<e.m_bodies.length;++r){var n=e.m_bodies[r];var a=e.m_bodies[(r+1)%e.m_bodies.length];var o=n.GetWorldCenter();var s=a.GetWorldCenter();e.m_targetLengths[r]=j.DistanceVV(o,s),e.m_targetArea+=j.CrossVV(o,s),i.Initialize(n,a,o,s),e.m_joints[r]=n.GetWorld().CreateJoint(i);}return e.m_targetArea*=.5,e;}var Ze;__extends(b2FrictionJointDef,Ke=D9T),b2FrictionJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB);};var Qe=b2FrictionJointDef;function b2FrictionJointDef(){var t=Ke.call(this,H.b2JointType.e_frictionJoint)||this;return t.localAnchorA=new j(),t.localAnchorB=new j(),t.maxForce=0,t.maxTorque=0,t;}var Ke;__extends(b2FrictionJoint,ti=Ue),b2FrictionJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.positions[this.m_indexB].a;var u=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;e=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(r);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);e=R.MulRV(e,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);r=R.MulRV(r,this.m_lalcB,this.m_rB);var a=this.m_invMassA,o=this.m_invMassB;var s=this.m_invIA,c=this.m_invIB;var l=this.m_K;l.ex.x=a+o+s*e.y*e.y+c*r.y*r.y,l.ex.y=-s*e.x*e.y-c*r.x*r.y,l.ey.x=l.ex.y,l.ey.y=a+o+s*e.x*e.x+c*r.x*r.x,l.GetInverse(this.m_linearMass),this.m_angularMass=s+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,e=this.m_linearImpulse,h.SelfMulSub(a,e),i-=s*(j.CrossVV(this.m_rA,e)+this.m_angularImpulse),u.SelfMulAdd(o,e),n+=c*(j.CrossVV(this.m_rB,e)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2FrictionJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var h=this.m_invMassA,u=this.m_invMassB;var a=this.m_invIA,o=this.m_invIB;var _=t.step.dt;var s=-this.m_angularMass*(n-i);var c=this.m_angularImpulse;var l=_*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+s,-l,l),i-=a*(s=this.m_angularImpulse-c);c=j.SubVV(j.AddVCrossSV(r,n+=o*s,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2);s=g.MulMV(this.m_linearMass,c,b2FrictionJoint.SolveVelocityConstraints_s_impulseV).SelfNeg();c=b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(s);l=_*this.m_maxForce;this.m_linearImpulse.LengthSquared()>l*l&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(l)),j.SubVV(this.m_linearImpulse,c,s),e.SelfMulSub(h,s),i-=a*j.CrossVV(this.m_rA,s),r.SelfMulAdd(u,s),n+=o*j.CrossVV(this.m_rB,s),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2FrictionJoint.prototype.SolvePositionConstraints=function(t){return!0;},b2FrictionJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2FrictionJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2FrictionJoint.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e;},b2FrictionJoint.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse;},b2FrictionJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2FrictionJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2FrictionJoint.prototype.SetMaxForce=function(t){this.m_maxForce=t;},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce;},b2FrictionJoint.prototype.SetMaxTorque=function(t){this.m_maxTorque=t;},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque;},b2FrictionJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2=new j(),b2FrictionJoint.SolveVelocityConstraints_s_impulseV=new j(),b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV=new j();var $e=b2FrictionJoint;function b2FrictionJoint(t){var e=ti.call(this,t)||this;return e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_linearImpulse=new j(),e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new g(),e.m_angularMass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_K=new g(),e.m_localAnchorA.Copy(t.localAnchorA),e.m_localAnchorB.Copy(t.localAnchorB),e.m_linearImpulse.SetZero(),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_maxTorque=b2Maybe(t.maxTorque,0),e.m_linearMass.SetZero(),e;}var ti;__extends(b2GearJointDef,ii=D9T);var ei=b2GearJointDef;function b2GearJointDef(){var t=ii.call(this,H.b2JointType.e_gearJoint)||this;return t.ratio=1,t;}var ii;__extends(b2GearJoint,ni=Ue),b2GearJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.positions[this.m_indexB].a;var u=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=t.positions[this.m_indexC].a;var _=t.velocities[this.m_indexC].v;var o=t.velocities[this.m_indexC].w;var s=t.positions[this.m_indexD].a;var d=t.velocities[this.m_indexD].v;var c=t.velocities[this.m_indexD].w;e=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(r),a=this.m_qC.SetAngle(a),s=this.m_qD.SetAngle(s);var l;this.m_mass=0,this.m_typeA===H.b2JointType.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC):(l=R.MulRV(a,this.m_localAxisC,b2GearJoint.InitVelocityConstraints_s_u),j.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC),a=R.MulRV(a,this.m_lalcC,b2GearJoint.InitVelocityConstraints_s_rC),j.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA),e=R.MulRV(e,this.m_lalcA,b2GearJoint.InitVelocityConstraints_s_rA),this.m_JvAC.Copy(l),this.m_JwC=j.CrossVV(a,l),this.m_JwA=j.CrossVV(e,l),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA),this.m_typeB===H.b2JointType.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)):(l=R.MulRV(s,this.m_localAxisD,b2GearJoint.InitVelocityConstraints_s_u),j.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD),a=R.MulRV(s,this.m_lalcD,b2GearJoint.InitVelocityConstraints_s_rD),j.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB),e=R.MulRV(r,this.m_lalcB,b2GearJoint.InitVelocityConstraints_s_rB),j.MulSV(this.m_ratio,l,this.m_JvBD),this.m_JwD=this.m_ratio*j.CrossVV(a,l),this.m_JwB=this.m_ratio*j.CrossVV(e,l),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB),this.m_mass=0<this.m_mass?1/this.m_mass:0,t.step.warmStarting?(h.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),i+=this.m_iA*this.m_impulse*this.m_JwA,u.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),n+=this.m_iB*this.m_impulse*this.m_JwB,_.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),o-=this.m_iC*this.m_impulse*this.m_JwC,d.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=c;},b2GearJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=t.velocities[this.m_indexC].v;var o=t.velocities[this.m_indexC].w;var s=t.velocities[this.m_indexD].v;var c=t.velocities[this.m_indexD].w;var l=j.DotVV(this.m_JvAC,j.SubVV(e,a,j.s_t0))+j.DotVV(this.m_JvBD,j.SubVV(r,s,j.s_t0));l+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*n-this.m_JwD*c);l=-this.m_mass*l;this.m_impulse+=l,e.SelfMulAdd(this.m_mA*l,this.m_JvAC),i+=this.m_iA*l*this.m_JwA,r.SelfMulAdd(this.m_mB*l,this.m_JvBD),n+=this.m_iB*l*this.m_JwB,a.SelfMulSub(this.m_mC*l,this.m_JvAC),o-=this.m_iC*l*this.m_JwC,s.SelfMulSub(this.m_mD*l,this.m_JvBD),c-=this.m_iD*l*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=c;},b2GearJoint.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c;var u=t.positions[this.m_indexA].a;var _=t.positions[this.m_indexB].c;var d=t.positions[this.m_indexB].a;var f=t.positions[this.m_indexC].c;var p=t.positions[this.m_indexC].a;var m=t.positions[this.m_indexD].c;var v=t.positions[this.m_indexD].a;var e=this.m_qA.SetAngle(u),y=this.m_qB.SetAngle(d),i=this.m_qC.SetAngle(p),r=this.m_qD.SetAngle(v);var g=this.m_JvAC,b=this.m_JvBD;var n,a,o,C;var s=0;var c;e=this.m_typeA===H.b2JointType.e_revoluteJoint?(g.SetZero(),o=n=1,s+=this.m_iA+this.m_iC,u-p-this.m_referenceAngleA):(c=R.MulRV(i,this.m_localAxisC,b2GearJoint.SolvePositionConstraints_s_u),l=R.MulRV(i,this.m_lalcC,b2GearJoint.SolvePositionConstraints_s_rC),e=R.MulRV(e,this.m_lalcA,b2GearJoint.SolvePositionConstraints_s_rA),g.Copy(c),o=j.CrossVV(l,c),n=j.CrossVV(e,c),s+=this.m_mC+this.m_mA+this.m_iC*o*o+this.m_iA*n*n,l=this.m_lalcC,i=R.MulTRV(i,j.AddVV(e,j.SubVV(h,f,j.s_t0),j.s_t0),j.s_t0),j.DotVV(j.SubVV(i,l,j.s_t0),this.m_localAxisC)),c=this.m_typeB===H.b2JointType.e_revoluteJoint?(b.SetZero(),a=this.m_ratio,C=this.m_ratio,s+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d-v-this.m_referenceAngleB):(c=R.MulRV(r,this.m_localAxisD,b2GearJoint.SolvePositionConstraints_s_u),i=R.MulRV(r,this.m_lalcD,b2GearJoint.SolvePositionConstraints_s_rD),l=R.MulRV(y,this.m_lalcB,b2GearJoint.SolvePositionConstraints_s_rB),j.MulSV(this.m_ratio,c,b),C=this.m_ratio*j.CrossVV(i,c),a=this.m_ratio*j.CrossVV(l,c),s+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*C*C+this.m_iB*a*a,y=this.m_lalcD,i=R.MulTRV(r,j.AddVV(l,j.SubVV(_,m,j.s_t0),j.s_t0),j.s_t0),j.DotVV(j.SubVV(i,y,j.s_t0),this.m_localAxisD));r=e+this.m_ratio*c-this.m_constant;var l=0;return h.SelfMulAdd(this.m_mA*(l=0<s?-r/s:l),g),u+=this.m_iA*l*n,_.SelfMulAdd(this.m_mB*l,b),d+=this.m_iB*l*a,f.SelfMulSub(this.m_mC*l,g),p-=this.m_iC*l*o,m.SelfMulSub(this.m_mD*l,b),v-=this.m_iD*l*C,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=d,t.positions[this.m_indexC].a=p,t.positions[this.m_indexD].a=v,!0;},b2GearJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2GearJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2GearJoint.prototype.GetReactionForce=function(t,e){return j.MulSV(t*this.m_impulse,this.m_JvAC,e);},b2GearJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA;},b2GearJoint.prototype.GetJoint1=function(){return this.m_joint1;},b2GearJoint.prototype.GetJoint2=function(){return this.m_joint2;},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio;},b2GearJoint.prototype.SetRatio=function(t){this.m_ratio=t;},b2GearJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;var r=this.m_joint1.m_index;var n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",r),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2GearJoint.InitVelocityConstraints_s_u=new j(),b2GearJoint.InitVelocityConstraints_s_rA=new j(),b2GearJoint.InitVelocityConstraints_s_rB=new j(),b2GearJoint.InitVelocityConstraints_s_rC=new j(),b2GearJoint.InitVelocityConstraints_s_rD=new j(),b2GearJoint.SolvePositionConstraints_s_u=new j(),b2GearJoint.SolvePositionConstraints_s_rA=new j(),b2GearJoint.SolvePositionConstraints_s_rB=new j(),b2GearJoint.SolvePositionConstraints_s_rC=new j(),b2GearJoint.SolvePositionConstraints_s_rD=new j();var ri=b2GearJoint;function b2GearJoint(t){var e=ni.call(this,t)||this;e.m_typeA=H.b2JointType.e_unknownJoint,e.m_typeB=H.b2JointType.e_unknownJoint,e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_localAnchorC=new j(),e.m_localAnchorD=new j(),e.m_localAxisC=new j(),e.m_localAxisD=new j(),e.m_referenceAngleA=0,e.m_referenceAngleB=0,e.m_constant=0,e.m_ratio=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_indexC=0,e.m_indexD=0,e.m_lcA=new j(),e.m_lcB=new j(),e.m_lcC=new j(),e.m_lcD=new j(),e.m_mA=0,e.m_mB=0,e.m_mC=0,e.m_mD=0,e.m_iA=0,e.m_iB=0,e.m_iC=0,e.m_iD=0,e.m_JvAC=new j(),e.m_JvBD=new j(),e.m_JwA=0,e.m_JwB=0,e.m_JwC=0,e.m_JwD=0,e.m_mass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_qC=new R(),e.m_qD=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_lalcC=new j(),e.m_lalcD=new j(),e.m_joint1=t.joint1,e.m_joint2=t.joint2,e.m_typeA=e.m_joint1.GetType(),e.m_typeB=e.m_joint2.GetType(),e.m_bodyC=e.m_joint1.GetBodyA(),e.m_bodyA=e.m_joint1.GetBodyB();var i=e.m_bodyA.m_xf;var r=e.m_bodyA.m_sweep.a;var n=e.m_bodyC.m_xf;var a=e.m_bodyC.m_sweep.a;i=e.m_typeA===H.b2JointType.e_revoluteJoint?(c=t.joint1,e.m_localAnchorC.Copy(c.m_localAnchorA),e.m_localAnchorA.Copy(c.m_localAnchorB),e.m_referenceAngleA=c.m_referenceAngle,e.m_localAxisC.SetZero(),r-a-e.m_referenceAngleA):(s=t.joint1,e.m_localAnchorC.Copy(s.m_localAnchorA),e.m_localAnchorA.Copy(s.m_localAnchorB),e.m_referenceAngleA=s.m_referenceAngle,e.m_localAxisC.Copy(s.m_localXAxisA),r=e.m_localAnchorC,a=R.MulTRV(n.q,j.AddVV(R.MulRV(i.q,e.m_localAnchorA,j.s_t0),j.SubVV(i.p,n.p,j.s_t1),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,r,j.s_t0),e.m_localAxisC)),e.m_bodyD=e.m_joint2.GetBodyA(),e.m_bodyB=e.m_joint2.GetBodyB();n=e.m_bodyB.m_xf;a=e.m_bodyB.m_sweep.a;r=e.m_bodyD.m_xf;var o=e.m_bodyD.m_sweep.a;var s,c;return o=e.m_typeB===H.b2JointType.e_revoluteJoint?(c=t.joint2,e.m_localAnchorD.Copy(c.m_localAnchorA),e.m_localAnchorB.Copy(c.m_localAnchorB),e.m_referenceAngleB=c.m_referenceAngle,e.m_localAxisD.SetZero(),a-o-e.m_referenceAngleB):(s=t.joint2,e.m_localAnchorD.Copy(s.m_localAnchorA),e.m_localAnchorB.Copy(s.m_localAnchorB),e.m_referenceAngleB=s.m_referenceAngle,e.m_localAxisD.Copy(s.m_localXAxisA),c=e.m_localAnchorD,a=R.MulTRV(r.q,j.AddVV(R.MulRV(n.q,e.m_localAnchorB,j.s_t0),j.SubVV(n.p,r.p,j.s_t1),j.s_t0),j.s_t0),j.DotVV(j.SubVV(a,c,j.s_t0),e.m_localAxisD)),e.m_ratio=b2Maybe(t.ratio,1),e.m_constant=i+e.m_ratio*o,e.m_impulse=0,e;}var ni;__extends(b2MotorJointDef,oi=D9T),b2MotorJointDef.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);t=this.bodyA.GetAngle();e=this.bodyB.GetAngle();this.angularOffset=e-t;};var ai=b2MotorJointDef;function b2MotorJointDef(){var t=oi.call(this,H.b2JointType.e_motorJoint)||this;return t.linearOffset=new j(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t;}var oi;__extends(b2MotorJoint,ci=Ue),b2MotorJoint.prototype.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t;},b2MotorJoint.prototype.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t;},b2MotorJoint.prototype.GetReactionForce=function(t,e){return j.MulSV(t,this.m_linearImpulse,e);},b2MotorJoint.prototype.GetReactionTorque=function(t){return t*this.m_angularImpulse;},b2MotorJoint.prototype.SetLinearOffset=function(t){j.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t));},b2MotorJoint.prototype.GetLinearOffset=function(){return this.m_linearOffset;},b2MotorJoint.prototype.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t);},b2MotorJoint.prototype.GetAngularOffset=function(){return this.m_angularOffset;},b2MotorJoint.prototype.SetMaxForce=function(t){this.m_maxForce=t;},b2MotorJoint.prototype.GetMaxForce=function(){return this.m_maxForce;},b2MotorJoint.prototype.SetMaxTorque=function(t){this.m_maxTorque=t;},b2MotorJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque;},b2MotorJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var h=t.positions[this.m_indexA].c;var e=t.positions[this.m_indexA].a;var u=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var _=t.positions[this.m_indexB].c;var d=t.positions[this.m_indexB].a;var f=t.velocities[this.m_indexB].v;var p=t.velocities[this.m_indexB].w;var r=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(d);r=R.MulRV(r,j.SubVV(this.m_linearOffset,this.m_localCenterA,j.s_t0),this.m_rA);n=R.MulRV(n,j.NegV(this.m_localCenterB,j.s_t0),this.m_rB);var a=this.m_invMassA,o=this.m_invMassB;var s=this.m_invIA,c=this.m_invIB;var l=this.m_K;l.ex.x=a+o+s*r.y*r.y+c*n.y*n.y,l.ex.y=-s*r.x*r.y-c*n.x*n.y,l.ey.x=l.ex.y,l.ey.y=a+o+s*r.x*r.x+c*n.x*n.x,l.GetInverse(this.m_linearMass),this.m_angularMass=s+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),j.SubVV(j.AddVV(_,n,j.s_t0),j.AddVV(h,r,j.s_t1),this.m_linearError),this.m_angularError=d-e-this.m_angularOffset,t.step.warmStarting?(this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio,l=this.m_linearImpulse,u.SelfMulSub(a,l),i-=s*(j.CrossVV(r,l)+this.m_angularImpulse),f.SelfMulAdd(o,l),p+=c*(j.CrossVV(n,l)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=p;},b2MotorJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var h=this.m_invMassA,u=this.m_invMassB;var a=this.m_invIA,_=this.m_invIB;var d=t.step.dt;var o=t.step.inv_dt;var s=n-i+o*this.m_correctionFactor*this.m_angularError;s=-this.m_angularMass*s;var c=this.m_angularImpulse;var l=d*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+s,-l,l),i-=a*(s=this.m_angularImpulse-c);c=this.m_rA;var f=this.m_rB;s=j.AddVV(j.SubVV(j.AddVV(r,j.CrossSV(n+=_*s,f,j.s_t0),j.s_t0),j.AddVV(e,j.CrossSV(i,c,j.s_t1),j.s_t1),j.s_t2),j.MulSV(o*this.m_correctionFactor,this.m_linearError,j.s_t3),b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2);o=g.MulMV(this.m_linearMass,s,b2MotorJoint.SolveVelocityConstraints_s_impulse_v2).SelfNeg();s=b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(o);l=d*this.m_maxForce;this.m_linearImpulse.LengthSquared()>l*l&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(l)),j.SubVV(this.m_linearImpulse,s,o),e.SelfMulSub(h,o),i-=a*j.CrossVV(c,o),r.SelfMulAdd(u,o),n+=_*j.CrossVV(f,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2MotorJoint.prototype.SolvePositionConstraints=function(t){return!0;},b2MotorJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2=new j(),b2MotorJoint.SolveVelocityConstraints_s_impulse_v2=new j(),b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2=new j();var si=b2MotorJoint;function b2MotorJoint(t){var e=ci.call(this,t)||this;return e.m_linearOffset=new j(),e.m_angularOffset=0,e.m_linearImpulse=new j(),e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_correctionFactor=.3,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_linearError=new j(),e.m_angularError=0,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new g(),e.m_angularMass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_K=new g(),e.m_linearOffset.Copy(b2Maybe(t.linearOffset,j.ZERO)),e.m_linearImpulse.SetZero(),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_maxTorque=b2Maybe(t.maxTorque,0),e.m_correctionFactor=b2Maybe(t.correctionFactor,.3),e;}var ci;__extends(b2MouseJointDef,hi=D9T);var li=b2MouseJointDef;function b2MouseJointDef(){var t=hi.call(this,H.b2JointType.e_mouseJoint)||this;return t.target=new j(),t.maxForce=0,t.frequencyHz=5,t.dampingRatio=.7,t;}var hi;__extends(b2MouseJoint,_i=Ue),b2MouseJoint.prototype.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t);},b2MouseJoint.prototype.GetTarget=function(){return this.m_targetA;},b2MouseJoint.prototype.SetMaxForce=function(t){this.m_maxForce=t;},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce;},b2MouseJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t;},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz;},b2MouseJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio;},b2MouseJoint.prototype.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c;var i=t.positions[this.m_indexB].a;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;i=this.m_qB.SetAngle(i);var a=this.m_bodyB.GetMass();var o=2*m*this.m_frequencyHz;var s=2*a*this.m_dampingRatio*o;a*=o*o;o=t.step.dt;this.m_gamma=o*(s+o*a),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=o*a*this.m_gamma,j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(i,this.m_lalcB,this.m_rB);s=this.m_K;s.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,s.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,s.ey.x=s.ex.y,s.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,s.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r.x+=this.m_invMassB*this.m_impulse.x,r.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*j.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n;},b2MouseJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexB].v;var i=t.velocities[this.m_indexB].w;var r=j.AddVCrossSV(e,i,this.m_rB,b2MouseJoint.SolveVelocityConstraints_s_Cdot);r=g.MulMV(this.m_mass,j.AddVV(r,j.AddVV(this.m_C,j.MulSV(this.m_gamma,this.m_impulse,j.s_t0),j.s_t0),j.s_t0).SelfNeg(),b2MouseJoint.SolveVelocityConstraints_s_impulse);var n=b2MouseJoint.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),j.SubVV(this.m_impulse,n,r),e.SelfMulAdd(this.m_invMassB,r),i+=this.m_invIB*j.CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=i;},b2MouseJoint.prototype.SolvePositionConstraints=function(t){return!0;},b2MouseJoint.prototype.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t;},b2MouseJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2MouseJoint.prototype.GetReactionForce=function(t,e){return j.MulSV(t,this.m_impulse,e);},b2MouseJoint.prototype.GetReactionTorque=function(t){return 0;},b2MouseJoint.prototype.Dump=function(t){t("Mouse joint dumping is not supported.\n");},b2MouseJoint.prototype.ShiftOrigin=function(t){this.m_targetA.SelfSub(t);},b2MouseJoint.SolveVelocityConstraints_s_Cdot=new j(),b2MouseJoint.SolveVelocityConstraints_s_impulse=new j(),b2MouseJoint.SolveVelocityConstraints_s_oldImpulse=new j();var ui=b2MouseJoint;function b2MouseJoint(t){var e=_i.call(this,t)||this;return e.m_localAnchorB=new j(),e.m_targetA=new j(),e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_beta=0,e.m_impulse=new j(),e.m_maxForce=0,e.m_gamma=0,e.m_indexA=0,e.m_indexB=0,e.m_rB=new j(),e.m_localCenterB=new j(),e.m_invMassB=0,e.m_invIB=0,e.m_mass=new g(),e.m_C=new j(),e.m_qB=new R(),e.m_lalcB=new j(),e.m_K=new g(),e.m_targetA.Copy(b2Maybe(t.target,j.ZERO)),I.MulTXV(e.m_bodyB.GetTransform(),e.m_targetA,e.m_localAnchorB),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_impulse.SetZero(),e.m_frequencyHz=b2Maybe(t.frequencyHz,0),e.m_dampingRatio=b2Maybe(t.dampingRatio,0),e.m_beta=0,e.m_gamma=0,e;}var _i;__extends(b2PrismaticJointDef,fi=D9T),b2PrismaticJointDef.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();};var di=b2PrismaticJointDef;function b2PrismaticJointDef(){var t=fi.call(this,H.b2JointType.e_prismaticJoint)||this;return t.localAnchorA=new j(),t.localAnchorB=new j(),t.localAxisA=new j(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t;}var fi;__extends(b2PrismaticJoint,mi=Ue),b2PrismaticJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var r=t.velocities[this.m_indexA].w;var n=t.positions[this.m_indexB].c;var a=t.positions[this.m_indexB].a;var u=t.velocities[this.m_indexB].v;var _=t.velocities[this.m_indexB].w;i=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(a);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var o=R.MulRV(i,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);a=R.MulRV(a,this.m_lalcB,this.m_rB);n=j.AddVV(j.SubVV(n,e,j.s_t0),j.SubVV(a,o,j.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_d);var e=this.m_invMassA,s=this.m_invMassB;var c=this.m_invIA,l=this.m_invIB;R.MulRV(i,this.m_localXAxisA,this.m_axis),this.m_a1=j.CrossVV(j.AddVV(n,o,j.s_t0),this.m_axis),this.m_a2=j.CrossVV(a,this.m_axis),this.m_motorMass=e+s+c*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),R.MulRV(i,this.m_localYAxisA,this.m_perp),this.m_s1=j.CrossVV(j.AddVV(n,o,j.s_t0),this.m_perp),this.m_s2=j.CrossVV(a,this.m_perp),this.m_K.ex.x=e+s+c*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.ex.y=c*this.m_s1+l*this.m_s2,this.m_K.ex.z=c*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=c+l,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=c*this.m_a1+l*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=e+s+c*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(i=j.DotVV(this.m_axis,n),D(this.m_upperTranslation-this.m_lowerTranslation)<.016?this.m_limitState=H.b2LimitState.e_equalLimits:i<=this.m_lowerTranslation?this.m_limitState!==H.b2LimitState.e_atLowerLimit&&(this.m_limitState=H.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):i>=this.m_upperTranslation?this.m_limitState!==H.b2LimitState.e_atUpperLimit&&(this.m_limitState=H.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,o=j.AddVV(j.MulSV(this.m_impulse.x,this.m_perp,j.s_t0),j.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,j.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_P),a=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,h.SelfMulSub(e,o),r-=c*a,u.SelfMulAdd(s,o),_+=l*n):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=_;},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(t){var h=t.velocities[this.m_indexA].v;var e=t.velocities[this.m_indexA].w;var u=t.velocities[this.m_indexB].v;var i=t.velocities[this.m_indexB].w;var _=this.m_invMassA,d=this.m_invMassB;var f=this.m_invIA,p=this.m_invIB;this.m_enableMotor&&this.m_limitState!==H.b2LimitState.e_equalLimits&&(l=j.DotVV(this.m_axis,j.SubVV(u,h,j.s_t0))+this.m_a2*i-this.m_a1*e,l=this.m_motorMass*(this.m_motorSpeed-l),c=this.m_motorImpulse,s=t.step.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Clamp(this.m_motorImpulse+l,-s,s),l=this.m_motorImpulse-c,s=j.MulSV(l,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),c=l*this.m_a1,l=l*this.m_a2,h.SelfMulSub(_,s),e-=f*c,u.SelfMulAdd(d,s),i+=p*l);var m=j.DotVV(this.m_perp,j.SubVV(u,h,j.s_t0))+this.m_s2*i-this.m_s1*e;var v=i-e;var r,n,a,o,s,c,l;l=this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit?(n=j.DotVV(this.m_axis,j.SubVV(u,h,j.s_t0))+this.m_a2*i-this.m_a1*e,r=b2PrismaticJoint.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),n=this.m_K.Solve33(-m,-v,-n,b2PrismaticJoint.SolveVelocityConstraints_s_df3),this.m_impulse.SelfAdd(n),this.m_limitState===H.b2LimitState.e_atLowerLimit?this.m_impulse.z=V(this.m_impulse.z,0):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=L(this.m_impulse.z,0)),a=-m-(this.m_impulse.z-r.z)*this.m_K.ez.x,o=-v-(this.m_impulse.z-r.z)*this.m_K.ez.y,(a=this.m_K.Solve22(a,o,b2PrismaticJoint.SolveVelocityConstraints_s_f2r)).x+=r.x,a.y+=r.y,this.m_impulse.x=a.x,this.m_impulse.y=a.y,n.x=this.m_impulse.x-r.x,n.y=this.m_impulse.y-r.y,n.z=this.m_impulse.z-r.z,s=j.AddVV(j.MulSV(n.x,this.m_perp,j.s_t0),j.MulSV(n.z,this.m_axis,j.s_t1),b2PrismaticJoint.SolveVelocityConstraints_s_P),c=n.x*this.m_s1+n.y+n.z*this.m_a1,n.x*this.m_s2+n.y+n.z*this.m_a2):(o=this.m_K.Solve22(-m,-v,b2PrismaticJoint.SolveVelocityConstraints_s_df2),this.m_impulse.x+=o.x,this.m_impulse.y+=o.y,s=j.MulSV(o.x,this.m_perp,b2PrismaticJoint.SolveVelocityConstraints_s_P),c=o.x*this.m_s1+o.y,o.x*this.m_s2+o.y),h.SelfMulSub(_,s),e-=f*c,u.SelfMulAdd(d,s),i+=p*l,t.velocities[this.m_indexA].w=e,t.velocities[this.m_indexB].w=i;},b2PrismaticJoint.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c;var u=t.positions[this.m_indexA].a;var _=t.positions[this.m_indexB].c;var d=t.positions[this.m_indexB].a;var e=this.m_qA.SetAngle(u),i=this.m_qB.SetAngle(d);var f=this.m_invMassA,p=this.m_invMassB;var r=this.m_invIA,n=this.m_invIB;var a=R.MulRV(e,this.m_lalcA,this.m_rA);i=R.MulRV(i,this.m_lalcB,this.m_rB);var o=j.SubVV(j.AddVV(_,i,j.s_t0),j.AddVV(h,a,j.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_d);var m=R.MulRV(e,this.m_localXAxisA,this.m_axis);var v=j.CrossVV(j.AddVV(o,a,j.s_t0),m);var y=j.CrossVV(i,m);e=R.MulRV(e,this.m_localYAxisA,this.m_perp);a=j.CrossVV(j.AddVV(o,a,j.s_t0),e);i=j.CrossVV(i,e);var s=b2PrismaticJoint.SolvePositionConstraints_s_impulse;var g=j.DotVV(e,o);var b=d-u-this.m_referenceAngle;var c=D(g);var C=D(b);var l=!1;var x=0;var A,S,T;this.m_enableLimit&&(o=j.DotVV(m,o),D(this.m_upperTranslation-this.m_lowerTranslation)<.016?(x=b2Clamp(o,-.2,.2),c=V(c,D(o)),l=!0):o<=this.m_lowerTranslation?(x=b2Clamp(o-this.m_lowerTranslation+M,-.2,0),c=V(c,this.m_lowerTranslation-o),l=!0):o>=this.m_upperTranslation&&(x=b2Clamp(o-this.m_upperTranslation-M,0,.2),c=V(c,o-this.m_upperTranslation),l=!0)),l?(0===(S=r+n)&&(S=1),o=r*v+n*y,l=f+p+r*v*v+n*y*y,(w=this.m_K3).ex.SetXYZ(f+p+r*a*a+n*i*i,A=r*a+n*i,T=r*a*v+n*i*y),w.ey.SetXYZ(A,S,o),w.ez.SetXYZ(T,o,l),s=w.Solve33(-g,-b,-x,s)):(0===(S=r+n)&&(S=1),(T=this.m_K2).ex.Set(f+p+r*a*a+n*i*i,A=r*a+n*i),T.ey.Set(A,S),o=T.Solve(-g,-b,b2PrismaticJoint.SolvePositionConstraints_s_impulse1),s.x=o.x,s.y=o.y,s.z=0);l=j.AddVV(j.MulSV(s.x,e,j.s_t0),j.MulSV(s.z,m,j.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_P);var w=s.x*a+s.y+s.z*v;x=s.x*i+s.y+s.z*y;return h.SelfMulSub(f,l),u-=r*w,_.SelfMulAdd(p,l),d+=n*x,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=d,c<=M&&C<=P;},b2PrismaticJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2PrismaticJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2PrismaticJoint.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e;},b2PrismaticJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.y;},b2PrismaticJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2PrismaticJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2PrismaticJoint.prototype.GetLocalAxisA=function(){return this.m_localXAxisA;},b2PrismaticJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle;},b2PrismaticJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PrismaticJoint.GetJointTranslation_s_pA);var e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PrismaticJoint.GetJointTranslation_s_pB);e=j.SubVV(e,t,b2PrismaticJoint.GetJointTranslation_s_d);t=this.m_bodyA.GetWorldVector(this.m_localXAxisA,b2PrismaticJoint.GetJointTranslation_s_axis);return j.DotVV(e,t);},b2PrismaticJoint.prototype.GetJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;j.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=R.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=R.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB);var n=j.AddVV(t.m_sweep.c,i,j.s_t0);var a=j.AddVV(e.m_sweep.c,r,j.s_t1);a=j.SubVV(a,n,j.s_t2);n=t.GetWorldVector(this.m_localXAxisA,this.m_axis);var o=t.m_linearVelocity;var s=e.m_linearVelocity;t=t.m_angularVelocity;e=e.m_angularVelocity;return j.DotVV(a,j.CrossSV(t,n,j.s_t0))+j.DotVV(n,j.SubVV(j.AddVCrossSV(s,e,r,j.s_t0),j.AddVCrossSV(o,t,i,j.s_t1),j.s_t0));},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit;},b2PrismaticJoint.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0);},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation;},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation;},b2PrismaticJoint.prototype.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0);},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor;},b2PrismaticJoint.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t);},b2PrismaticJoint.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t);},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;},b2PrismaticJoint.prototype.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t);},b2PrismaticJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce;},b2PrismaticJoint.prototype.GetMotorForce=function(t){return t*this.m_motorImpulse;},b2PrismaticJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2PrismaticJoint.InitVelocityConstraints_s_d=new j(),b2PrismaticJoint.InitVelocityConstraints_s_P=new j(),b2PrismaticJoint.SolveVelocityConstraints_s_P=new j(),b2PrismaticJoint.SolveVelocityConstraints_s_f2r=new j(),b2PrismaticJoint.SolveVelocityConstraints_s_f1=new d(),b2PrismaticJoint.SolveVelocityConstraints_s_df3=new d(),b2PrismaticJoint.SolveVelocityConstraints_s_df2=new j(),b2PrismaticJoint.SolvePositionConstraints_s_d=new j(),b2PrismaticJoint.SolvePositionConstraints_s_impulse=new d(),b2PrismaticJoint.SolvePositionConstraints_s_impulse1=new j(),b2PrismaticJoint.SolvePositionConstraints_s_P=new j(),b2PrismaticJoint.GetJointTranslation_s_pA=new j(),b2PrismaticJoint.GetJointTranslation_s_pB=new j(),b2PrismaticJoint.GetJointTranslation_s_d=new j(),b2PrismaticJoint.GetJointTranslation_s_axis=new j();var pi=b2PrismaticJoint;function b2PrismaticJoint(t){var e=mi.call(this,t)||this;return e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_localXAxisA=new j(),e.m_localYAxisA=new j(),e.m_referenceAngle=0,e.m_impulse=new d(0,0,0),e.m_motorImpulse=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorForce=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_limitState=H.b2LimitState.e_inactiveLimit,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_axis=new j(0,0),e.m_perp=new j(0,0),e.m_s1=0,e.m_s2=0,e.m_a1=0,e.m_a2=0,e.m_K=new f(),e.m_K3=new f(),e.m_K2=new g(),e.m_motorMass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_rA=new j(),e.m_rB=new j(),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,j.ZERO)),e.m_localXAxisA.Copy(b2Maybe(t.localAxisA,new j(1,0))).SelfNormalize(),j.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_lowerTranslation=b2Maybe(t.lowerTranslation,0),e.m_upperTranslation=b2Maybe(t.upperTranslation,0),e.m_maxMotorForce=b2Maybe(t.maxMotorForce,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableLimit=b2Maybe(t.enableLimit,!1),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e;}var mi;__extends(b2PulleyJointDef,yi=D9T),b2PulleyJointDef.prototype.Initialize=function(t,e,i,r,n,a,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(r),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(a,this.localAnchorB),this.lengthA=j.DistanceVV(n,i),this.lengthB=j.DistanceVV(a,r),this.ratio=o;};var vi=b2PulleyJointDef;function b2PulleyJointDef(){var t=yi.call(this,H.b2JointType.e_pulleyJoint)||this;return t.groundAnchorA=new j(-1,1),t.groundAnchorB=new j(1,1),t.localAnchorA=new j(-1,0),t.localAnchorB=new j(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t;}var yi;__extends(b2PulleyJoint,bi=Ue),b2PulleyJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.velocities[this.m_indexA].v;var n=t.velocities[this.m_indexA].w;var a=t.positions[this.m_indexB].c;var o=t.positions[this.m_indexB].a;var s=t.velocities[this.m_indexB].v;var c=t.velocities[this.m_indexB].w;i=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(o);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(o,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(a).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);i=this.m_uA.Length();o=this.m_uB.Length();.08<i?this.m_uA.SelfMul(1/i):this.m_uA.SetZero(),.08<o?this.m_uB.SelfMul(1/o):this.m_uB.SetZero();e=j.CrossVV(this.m_rA,this.m_uA);a=j.CrossVV(this.m_rB,this.m_uB);i=this.m_invMassA+this.m_invIA*e*e;o=this.m_invMassB+this.m_invIB*a*a;this.m_mass=i+this.m_ratio*this.m_ratio*o,0<this.m_mass&&(this.m_mass=1/this.m_mass),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,e=j.MulSV(-this.m_impulse,this.m_uA,b2PulleyJoint.InitVelocityConstraints_s_PA),a=j.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,b2PulleyJoint.InitVelocityConstraints_s_PB),r.SelfMulAdd(this.m_invMassA,e),n+=this.m_invIA*j.CrossVV(this.m_rA,e),s.SelfMulAdd(this.m_invMassB,a),c+=this.m_invIB*j.CrossVV(this.m_rB,a)):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=c;},b2PulleyJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=j.AddVCrossSV(e,i,this.m_rA,b2PulleyJoint.SolveVelocityConstraints_s_vpA);var o=j.AddVCrossSV(r,n,this.m_rB,b2PulleyJoint.SolveVelocityConstraints_s_vpB);a=-j.DotVV(this.m_uA,a)-this.m_ratio*j.DotVV(this.m_uB,o);o=-this.m_mass*a;this.m_impulse+=o;a=j.MulSV(-o,this.m_uA,b2PulleyJoint.SolveVelocityConstraints_s_PA);o=j.MulSV(-this.m_ratio*o,this.m_uB,b2PulleyJoint.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,a),i+=this.m_invIA*j.CrossVV(this.m_rA,a),r.SelfMulAdd(this.m_invMassB,o),n+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2PulleyJoint.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c;var e=t.positions[this.m_indexA].a;var u=t.positions[this.m_indexB].c;var _=t.positions[this.m_indexB].a;var i=this.m_qA.SetAngle(e),r=this.m_qB.SetAngle(_);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);i=R.MulRV(i,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);r=R.MulRV(r,this.m_lalcB,this.m_rB);var n=this.m_uA.Copy(h).SelfAdd(i).SelfSub(this.m_groundAnchorA);var a=this.m_uB.Copy(u).SelfAdd(r).SelfSub(this.m_groundAnchorB);var o=n.Length();var s=a.Length();.08<o?n.SelfMul(1/o):n.SetZero(),.08<s?a.SelfMul(1/s):a.SetZero();var c=j.CrossVV(i,n);var l=j.CrossVV(r,a);c=this.m_invMassA+this.m_invIA*c*c;l=this.m_invMassB+this.m_invIB*l*l;c+=this.m_ratio*this.m_ratio*l;0<c&&(c=1/c);l=this.m_constant-o-this.m_ratio*s;o=D(l);s=-c*l;c=j.MulSV(-s,n,b2PulleyJoint.SolvePositionConstraints_s_PA);l=j.MulSV(-this.m_ratio*s,a,b2PulleyJoint.SolvePositionConstraints_s_PB);return h.SelfMulAdd(this.m_invMassA,c),e+=this.m_invIA*j.CrossVV(i,c),u.SelfMulAdd(this.m_invMassB,l),_+=this.m_invIB*j.CrossVV(r,l),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=_,o<M;},b2PulleyJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2PulleyJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2PulleyJoint.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e;},b2PulleyJoint.prototype.GetReactionTorque=function(t){return 0;},b2PulleyJoint.prototype.GetGroundAnchorA=function(){return this.m_groundAnchorA;},b2PulleyJoint.prototype.GetGroundAnchorB=function(){return this.m_groundAnchorB;},b2PulleyJoint.prototype.GetLengthA=function(){return this.m_lengthA;},b2PulleyJoint.prototype.GetLengthB=function(){return this.m_lengthB;},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio;},b2PulleyJoint.prototype.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PulleyJoint.GetCurrentLengthA_s_p);var e=this.m_groundAnchorA;return j.DistanceVV(t,e);},b2PulleyJoint.prototype.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PulleyJoint.GetCurrentLengthB_s_p);var e=this.m_groundAnchorB;return j.DistanceVV(t,e);},b2PulleyJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2PulleyJoint.prototype.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t);},b2PulleyJoint.InitVelocityConstraints_s_PA=new j(),b2PulleyJoint.InitVelocityConstraints_s_PB=new j(),b2PulleyJoint.SolveVelocityConstraints_s_vpA=new j(),b2PulleyJoint.SolveVelocityConstraints_s_vpB=new j(),b2PulleyJoint.SolveVelocityConstraints_s_PA=new j(),b2PulleyJoint.SolveVelocityConstraints_s_PB=new j(),b2PulleyJoint.SolvePositionConstraints_s_PA=new j(),b2PulleyJoint.SolvePositionConstraints_s_PB=new j(),b2PulleyJoint.GetCurrentLengthA_s_p=new j(),b2PulleyJoint.GetCurrentLengthB_s_p=new j();var gi=b2PulleyJoint;function b2PulleyJoint(t){var e=bi.call(this,t)||this;return e.m_groundAnchorA=new j(),e.m_groundAnchorB=new j(),e.m_lengthA=0,e.m_lengthB=0,e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_constant=0,e.m_ratio=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_uA=new j(),e.m_uB=new j(),e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_groundAnchorA.Copy(b2Maybe(t.groundAnchorA,new j(-1,1))),e.m_groundAnchorB.Copy(b2Maybe(t.groundAnchorB,new j(1,0))),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,new j(-1,0))),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,new j(1,0))),e.m_lengthA=b2Maybe(t.lengthA,0),e.m_lengthB=b2Maybe(t.lengthB,0),e.m_ratio=b2Maybe(t.ratio,1),e.m_constant=b2Maybe(t.lengthA,0)+e.m_ratio*b2Maybe(t.lengthB,0),e.m_impulse=0,e;}var bi;__extends(b2RevoluteJointDef,xi=D9T),b2RevoluteJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();};var Ci=b2RevoluteJointDef;function b2RevoluteJointDef(){var t=xi.call(this,H.b2JointType.e_revoluteJoint)||this;return t.localAnchorA=new j(0,0),t.localAnchorB=new j(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t;}var xi;__extends(b2RevoluteJoint,Si=Ue),b2RevoluteJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.positions[this.m_indexB].a;var u=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=this.m_qA.SetAngle(e),o=this.m_qB.SetAngle(r);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(a,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(o,this.m_lalcB,this.m_rB);a=this.m_invMassA,o=this.m_invMassB;var s=this.m_invIA,c=this.m_invIB;var l=s+c===0;this.m_mass.ex.x=a+o+this.m_rA.y*this.m_rA.y*s+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*s-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*s-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=a+o+this.m_rA.x*this.m_rA.x*s+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*s+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=s+c,this.m_motorMass=s+c,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!l||(this.m_motorImpulse=0),this.m_enableLimit&&!l?(l=r-e-this.m_referenceAngle,D(this.m_upperAngle-this.m_lowerAngle)<2*P?this.m_limitState=H.b2LimitState.e_equalLimits:l<=this.m_lowerAngle?(this.m_limitState!==H.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=H.b2LimitState.e_atLowerLimit):l>=this.m_upperAngle?(this.m_limitState!==H.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=H.b2LimitState.e_atUpperLimit):(this.m_limitState=H.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=H.b2LimitState.e_inactiveLimit,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,r=b2RevoluteJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),h.SelfMulSub(a,r),i-=s*(j.CrossVV(this.m_rA,r)+this.m_motorImpulse+this.m_impulse.z),u.SelfMulAdd(o,r),n+=c*(j.CrossVV(this.m_rB,r)+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var h=this.m_invMassA,u=this.m_invMassB;var _=this.m_invIA,d=this.m_invIB;var a=_+d===0;var o,f,p,s,c,l;this.m_enableMotor&&this.m_limitState!==H.b2LimitState.e_equalLimits&&!a&&(c=n-i-this.m_motorSpeed,c=-this.m_motorMass*c,o=this.m_motorImpulse,l=t.step.dt*this.m_maxMotorTorque,this.m_motorImpulse=b2Clamp(this.m_motorImpulse+c,-l,l),i-=_*(c=this.m_motorImpulse-o),n+=d*c),this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit&&!a?(l=j.SubVV(j.AddVCrossSV(r,n,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot1),o=this.m_mass.Solve33(l.x,l.y,n-i,b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v3).SelfNeg(),this.m_limitState===H.b2LimitState.e_equalLimits?this.m_impulse.SelfAdd(o):this.m_limitState===H.b2LimitState.e_atLowerLimit?this.m_impulse.z+o.z<0?(f=-l.x+this.m_impulse.z*this.m_mass.ez.x,p=-l.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(f,p,b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2),o.x=s.x,o.y=s.y,o.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(o):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(0<this.m_impulse.z+o.z?(f=-l.x+this.m_impulse.z*this.m_mass.ez.x,p=-l.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(f,p,b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2),o.x=s.x,o.y=s.y,o.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0):this.m_impulse.SelfAdd(o)),c=b2RevoluteJoint.SolveVelocityConstraints_s_P.Set(o.x,o.y),e.SelfMulSub(h,c),i-=_*(j.CrossVV(this.m_rA,c)+o.z),r.SelfMulAdd(u,c),n+=d*(j.CrossVV(this.m_rB,c)+o.z)):(a=j.SubVV(j.AddVCrossSV(r,n,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2),l=this.m_mass.Solve22(-a.x,-a.y,b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2),this.m_impulse.x+=l.x,this.m_impulse.y+=l.y,e.SelfMulSub(h,l),i-=_*j.CrossVV(this.m_rA,l),r.SelfMulAdd(u,l),n+=d*j.CrossVV(this.m_rB,l)),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2RevoluteJoint.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c;var e=t.positions[this.m_indexA].a;var u=t.positions[this.m_indexB].c;var i=t.positions[this.m_indexB].a;var r=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(i);var a=0;var o=this.m_invIA+this.m_invIB===0;this.m_enableLimit&&this.m_limitState!==H.b2LimitState.e_inactiveLimit&&!o&&(o=i-e-this.m_referenceAngle,c=0,this.m_limitState===H.b2LimitState.e_equalLimits?(s=b2Clamp(o-this.m_lowerAngle,-p,p),c=-this.m_motorMass*s,a=D(s)):this.m_limitState===H.b2LimitState.e_atLowerLimit?(a=-(s=o-this.m_lowerAngle),s=b2Clamp(s+P,-p,0),c=-this.m_motorMass*s):this.m_limitState===H.b2LimitState.e_atUpperLimit&&(s=b2Clamp((a=s=o-this.m_upperAngle)-P,0,p),c=-this.m_motorMass*s),e-=this.m_invIA*c,i+=this.m_invIB*c),r.SetAngle(e),n.SetAngle(i),j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);o=R.MulRV(r,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var s=R.MulRV(n,this.m_lalcB,this.m_rB);var c=j.SubVV(j.AddVV(u,s,j.s_t0),j.AddVV(h,o,j.s_t1),b2RevoluteJoint.SolvePositionConstraints_s_C_v2);r=c.Length();var n=this.m_invMassA,_=this.m_invMassB;var d=this.m_invIA,f=this.m_invIB;var l=this.m_K;l.ex.x=n+_+d*o.y*o.y+f*s.y*s.y,l.ex.y=-d*o.x*o.y-f*s.x*s.y,l.ey.x=l.ex.y,l.ey.y=n+_+d*o.x*o.x+f*s.x*s.x;l=l.Solve(c.x,c.y,b2RevoluteJoint.SolvePositionConstraints_s_impulse).SelfNeg();return h.SelfMulSub(n,l),e-=d*j.CrossVV(o,l),u.SelfMulAdd(_,l),i+=f*j.CrossVV(s,l),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=i,r<=M&&a<=P;},b2RevoluteJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2RevoluteJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2RevoluteJoint.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e;},b2RevoluteJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z;},b2RevoluteJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2RevoluteJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2RevoluteJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle;},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle;},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity;},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor;},b2RevoluteJoint.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t);},b2RevoluteJoint.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse;},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t);},b2RevoluteJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque;},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit;},b2RevoluteJoint.prototype.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0);},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle;},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle;},b2RevoluteJoint.prototype.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e);},b2RevoluteJoint.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t);},b2RevoluteJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2RevoluteJoint.InitVelocityConstraints_s_P=new j(),b2RevoluteJoint.SolveVelocityConstraints_s_P=new j(),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2=new j(),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot1=new j(),b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v3=new d(),b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2=new j(),b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2=new j(),b2RevoluteJoint.SolvePositionConstraints_s_C_v2=new j(),b2RevoluteJoint.SolvePositionConstraints_s_impulse=new j();var Ai=b2RevoluteJoint;function b2RevoluteJoint(t){var e=Si.call(this,t)||this;return e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_impulse=new d(),e.m_motorImpulse=0,e.m_enableMotor=!1,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_referenceAngle=0,e.m_lowerAngle=0,e.m_upperAngle=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new f(),e.m_motorMass=0,e.m_limitState=H.b2LimitState.e_inactiveLimit,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_K=new g(),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,j.ZERO)),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_impulse.SetZero(),e.m_motorImpulse=0,e.m_lowerAngle=b2Maybe(t.lowerAngle,0),e.m_upperAngle=b2Maybe(t.upperAngle,0),e.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableLimit=b2Maybe(t.enableLimit,!1),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e.m_limitState=H.b2LimitState.e_inactiveLimit,e;}var Si;__extends(b2RopeJointDef,wi=D9T);var Ti=b2RopeJointDef;function b2RopeJointDef(){var t=wi.call(this,H.b2JointType.e_ropeJoint)||this;return t.localAnchorA=new j(-1,0),t.localAnchorB=new j(1,0),t.maxLength=0,t;}var wi;__extends(b2RopeJoint,Pi=Ue),b2RopeJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.velocities[this.m_indexA].v;var n=t.velocities[this.m_indexA].w;var a=t.positions[this.m_indexB].c;var o=t.positions[this.m_indexB].a;var s=t.velocities[this.m_indexB].v;var c=t.velocities[this.m_indexB].w;i=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(o);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(i,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(o,this.m_lalcB,this.m_rB),this.m_u.Copy(a).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();i=this.m_length-this.m_maxLength;if(this.m_state=0<i?H.b2LimitState.e_atUpperLimit:H.b2LimitState.e_inactiveLimit,!(this.m_length>M))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);o=j.CrossVV(this.m_rA,this.m_u);a=j.CrossVV(this.m_rB,this.m_u);e=this.m_invMassA+this.m_invIA*o*o+this.m_invMassB+this.m_invIB*a*a;this.m_mass=0!==e?1/e:0,t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,i=j.MulSV(this.m_impulse,this.m_u,b2RopeJoint.InitVelocityConstraints_s_P),r.SelfMulSub(this.m_invMassA,i),n-=this.m_invIA*j.CrossVV(this.m_rA,i),s.SelfMulAdd(this.m_invMassB,i),c+=this.m_invIB*j.CrossVV(this.m_rB,i)):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=c;},b2RopeJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=j.AddVCrossSV(e,i,this.m_rA,b2RopeJoint.SolveVelocityConstraints_s_vpA);var o=j.AddVCrossSV(r,n,this.m_rB,b2RopeJoint.SolveVelocityConstraints_s_vpB);var s=this.m_length-this.m_maxLength;o=j.DotVV(this.m_u,j.SubVV(o,a,j.s_t0));s<0&&(o+=t.step.inv_dt*s);a=-this.m_mass*o;s=this.m_impulse;this.m_impulse=L(0,this.m_impulse+a),a=this.m_impulse-s;o=j.MulSV(a,this.m_u,b2RopeJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,o),i-=this.m_invIA*j.CrossVV(this.m_rA,o),r.SelfMulAdd(this.m_invMassB,o),n+=this.m_invIB*j.CrossVV(this.m_rB,o),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2RopeJoint.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.positions[this.m_indexB].c;var n=t.positions[this.m_indexB].a;var a=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(n);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);a=R.MulRV(a,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);o=R.MulRV(o,this.m_lalcB,this.m_rB);var s=this.m_u.Copy(r).SelfAdd(o).SelfSub(e).SelfSub(a);var c=s.Normalize();l=b2Clamp(c-this.m_maxLength,0,.2);var l=-this.m_mass*l;l=j.MulSV(l,s,b2RopeJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,l),i-=this.m_invIA*j.CrossVV(a,l),r.SelfMulAdd(this.m_invMassB,l),n+=this.m_invIB*j.CrossVV(o,l),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,c-this.m_maxLength<M;},b2RopeJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2RopeJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2RopeJoint.prototype.GetReactionForce=function(t,e){return j.MulSV(t*this.m_impulse,this.m_u,e);},b2RopeJoint.prototype.GetReactionTorque=function(t){return 0;},b2RopeJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2RopeJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2RopeJoint.prototype.SetMaxLength=function(t){this.m_maxLength=t;},b2RopeJoint.prototype.GetMaxLength=function(){return this.m_maxLength;},b2RopeJoint.prototype.GetLimitState=function(){return this.m_state;},b2RopeJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2RopeJoint.InitVelocityConstraints_s_P=new j(),b2RopeJoint.SolveVelocityConstraints_s_vpA=new j(),b2RopeJoint.SolveVelocityConstraints_s_vpB=new j(),b2RopeJoint.SolveVelocityConstraints_s_P=new j(),b2RopeJoint.SolvePositionConstraints_s_P=new j();var Ei=b2RopeJoint;function b2RopeJoint(t){var e=Pi.call(this,t)||this;return e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_maxLength=0,e.m_length=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new j(),e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_state=H.b2LimitState.e_inactiveLimit,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,new j(-1,0))),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,new j(1,0))),e.m_maxLength=b2Maybe(t.maxLength,0),e;}var Pi;__extends(b2WeldJointDef,Ri=D9T),b2WeldJointDef.prototype.Initialize=function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle();};var Mi=b2WeldJointDef;function b2WeldJointDef(){var t=Ri.call(this,H.b2JointType.e_weldJoint)||this;return t.localAnchorA=new j(),t.localAnchorB=new j(),t.referenceAngle=0,t.frequencyHz=0,t.dampingRatio=0,t;}var Ri;__extends(b2WeldJoint,Bi=Ue),b2WeldJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var u=t.velocities[this.m_indexA].w;var i=t.positions[this.m_indexB].a;var _=t.velocities[this.m_indexB].v;var d=t.velocities[this.m_indexB].w;var r=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(i);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),R.MulRV(r,this.m_lalcA,this.m_rA),j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),R.MulRV(n,this.m_lalcB,this.m_rB);r=this.m_invMassA,n=this.m_invMassB;var a=this.m_invIA,o=this.m_invIB;var s=this.m_K;var c,f,p;var l;s.ex.x=r+n+this.m_rA.y*this.m_rA.y*a+this.m_rB.y*this.m_rB.y*o,s.ey.x=-this.m_rA.y*this.m_rA.x*a-this.m_rB.y*this.m_rB.x*o,s.ez.x=-this.m_rA.y*a-this.m_rB.y*o,s.ex.y=s.ey.x,s.ey.y=r+n+this.m_rA.x*this.m_rA.x*a+this.m_rB.x*this.m_rB.x*o,s.ez.y=this.m_rA.x*a+this.m_rB.x*o,s.ex.z=s.ez.x,s.ey.z=s.ez.y,s.ez.z=a+o,0<this.m_frequencyHz?(s.GetInverse22(this.m_mass),i=i-e-this.m_referenceAngle,e=2*m*this.m_frequencyHz,f=2*(l=0<(c=a+o)?1/c:0)*this.m_dampingRatio*e,p=t.step.dt,this.m_gamma=p*(f+p*(f=l*e*e)),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=i*p*f*this.m_gamma,c+=this.m_gamma,this.m_mass.ez.z=0!==c?1/c:0):(s.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0),t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),l=b2WeldJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),h.SelfMulSub(r,l),u-=a*(j.CrossVV(this.m_rA,l)+this.m_impulse.z),_.SelfMulAdd(n,l),d+=o*(j.CrossVV(this.m_rB,l)+this.m_impulse.z)):this.m_impulse.SetZero(),t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=d;},b2WeldJoint.prototype.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v;var i=t.velocities[this.m_indexA].w;var r=t.velocities[this.m_indexB].v;var n=t.velocities[this.m_indexB].w;var a=this.m_invMassA,h=this.m_invMassB;var o=this.m_invIA,s=this.m_invIB;var c,l;0<this.m_frequencyHz?(c=-this.m_mass.ez.z*(n-i+this.m_bias+this.m_gamma*this.m_impulse.z),this.m_impulse.z+=c,i-=o*c,c=j.SubVV(j.AddVCrossSV(r,n+=s*c,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),l=f.MulM33XY(this.m_mass,c.x,c.y,b2WeldJoint.SolveVelocityConstraints_s_impulse1).SelfNeg(),this.m_impulse.x+=l.x,this.m_impulse.y+=l.y,e.SelfMulSub(a,l=l),i-=o*j.CrossVV(this.m_rA,l),r.SelfMulAdd(h,l),n+=s*j.CrossVV(this.m_rB,l)):(c=j.SubVV(j.AddVCrossSV(r,n,this.m_rB,j.s_t0),j.AddVCrossSV(e,i,this.m_rA,j.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),c=f.MulM33XYZ(this.m_mass,c.x,c.y,n-i,b2WeldJoint.SolveVelocityConstraints_s_impulse).SelfNeg(),this.m_impulse.SelfAdd(c),l=b2WeldJoint.SolveVelocityConstraints_s_P.Set(c.x,c.y),e.SelfMulSub(a,l),i-=o*(j.CrossVV(this.m_rA,l)+c.z),r.SelfMulAdd(h,l),n+=s*(j.CrossVV(this.m_rB,l)+c.z)),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n;},b2WeldJoint.prototype.SolvePositionConstraints=function(t){var h=t.positions[this.m_indexA].c;var e=t.positions[this.m_indexA].a;var u=t.positions[this.m_indexB].c;var i=t.positions[this.m_indexB].a;var r=this.m_qA.SetAngle(e),n=this.m_qB.SetAngle(i);var _=this.m_invMassA,d=this.m_invMassB;var a=this.m_invIA,o=this.m_invIB;j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);r=R.MulRV(r,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);n=R.MulRV(n,this.m_lalcB,this.m_rB);var f,p;var s=this.m_K;var c,l;return s.ex.x=_+d+r.y*r.y*a+n.y*n.y*o,s.ey.x=-r.y*r.x*a-n.y*n.x*o,s.ez.x=-r.y*a-n.y*o,s.ex.y=s.ey.x,s.ey.y=_+d+r.x*r.x*a+n.x*n.x*o,s.ez.y=r.x*a+n.x*o,s.ex.z=s.ez.x,s.ey.z=s.ez.y,s.ez.z=a+o,0<this.m_frequencyHz?(f=(c=j.SubVV(j.AddVV(u,n,j.s_t0),j.AddVV(h,r,j.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1)).Length(),p=0,l=s.Solve22(c.x,c.y,b2WeldJoint.SolvePositionConstraints_s_P).SelfNeg(),h.SelfMulSub(_,l),e-=a*j.CrossVV(r,l),u.SelfMulAdd(d,l),i+=o*j.CrossVV(n,l)):(c=j.SubVV(j.AddVV(u,n,j.s_t0),j.AddVV(h,r,j.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1),n=i-e-this.m_referenceAngle,f=c.Length(),p=D(n),r=s.Solve33(c.x,c.y,n,b2WeldJoint.SolvePositionConstraints_s_impulse).SelfNeg(),l=b2WeldJoint.SolvePositionConstraints_s_P.Set(r.x,r.y),h.SelfMulSub(_,l),e-=a*(j.CrossVV(this.m_rA,l)+r.z),u.SelfMulAdd(d,l),i+=o*(j.CrossVV(this.m_rB,l)+r.z)),t.positions[this.m_indexA].a=e,t.positions[this.m_indexB].a=i,f<=M&&p<=P;},b2WeldJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2WeldJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2WeldJoint.prototype.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e;},b2WeldJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z;},b2WeldJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2WeldJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2WeldJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle;},b2WeldJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t;},b2WeldJoint.prototype.GetFrequency=function(){return this.m_frequencyHz;},b2WeldJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t;},b2WeldJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio;},b2WeldJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2WeldJoint.InitVelocityConstraints_s_P=new j(),b2WeldJoint.SolveVelocityConstraints_s_Cdot1=new j(),b2WeldJoint.SolveVelocityConstraints_s_impulse1=new j(),b2WeldJoint.SolveVelocityConstraints_s_impulse=new d(),b2WeldJoint.SolveVelocityConstraints_s_P=new j(),b2WeldJoint.SolvePositionConstraints_s_C1=new j(),b2WeldJoint.SolvePositionConstraints_s_P=new j(),b2WeldJoint.SolvePositionConstraints_s_impulse=new d();var Ii=b2WeldJoint;function b2WeldJoint(t){var e=Bi.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_bias=0,e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_referenceAngle=0,e.m_gamma=0,e.m_impulse=new d(0,0,0),e.m_indexA=0,e.m_indexB=0,e.m_rA=new j(),e.m_rB=new j(),e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new f(),e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_K=new f(),e.m_frequencyHz=b2Maybe(t.frequencyHz,0),e.m_dampingRatio=b2Maybe(t.dampingRatio,0),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,j.ZERO)),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_impulse.SetZero(),e;}var Bi;__extends(b2WheelJointDef,Li=D9T),b2WheelJointDef.prototype.Initialize=function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA);};var Di=b2WheelJointDef;function b2WheelJointDef(){var t=Li.call(this,H.b2JointType.e_wheelJoint)||this;return t.localAnchorA=new j(0,0),t.localAnchorB=new j(0,0),t.localAxisA=new j(1,0),t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.frequencyHz=2,t.dampingRatio=.7,t;}var Li;__extends(b2WheelJoint,Oi=Ue),b2WheelJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed;},b2WheelJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque;},b2WheelJoint.prototype.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t;},b2WheelJoint.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz;},b2WheelJoint.prototype.SetSpringDampingRatio=function(t){this.m_dampingRatio=t;},b2WheelJoint.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio;},b2WheelJoint.prototype.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB;var r=this.m_invIA,n=this.m_invIB;var a=t.positions[this.m_indexA].c;var o=t.positions[this.m_indexA].a;var h=t.velocities[this.m_indexA].v;var u=t.velocities[this.m_indexA].w;var s=t.positions[this.m_indexB].c;var c=t.positions[this.m_indexB].a;var _=t.velocities[this.m_indexB].v;var d=t.velocities[this.m_indexB].w;o=this.m_qA.SetAngle(o),c=this.m_qB.SetAngle(c);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=R.MulRV(o,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);c=R.MulRV(c,this.m_lalcB,this.m_rB);s=j.SubVV(j.AddVV(s,c,j.s_t0),j.AddVV(a,l,j.s_t1),b2WheelJoint.InitVelocityConstraints_s_d);R.MulRV(o,this.m_localYAxisA,this.m_ay),this.m_sAy=j.CrossVV(j.AddVV(s,l,j.s_t0),this.m_ay),this.m_sBy=j.CrossVV(c,this.m_ay),this.m_mass=e+i+r*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz?(R.MulRV(o,this.m_localXAxisA,this.m_ax),this.m_sAx=j.CrossVV(j.AddVV(s,l,j.s_t0),this.m_ax),this.m_sBx=j.CrossVV(c,this.m_ax),0<(a=e+i+r*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx)&&(this.m_springMass=1/a,o=j.DotVV(s,this.m_ax),l=2*m*this.m_frequencyHz,c=2*this.m_springMass*this.m_dampingRatio*l,e=this.m_springMass*l*l,i=t.step.dt,this.m_gamma=i*(c+i*e),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=o*i*e*this.m_gamma,this.m_springMass=a+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass))):this.m_springImpulse=0,this.m_enableMotor?(this.m_motorMass=r+n,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting?(this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio,s=j.AddVV(j.MulSV(this.m_impulse,this.m_ay,j.s_t0),j.MulSV(this.m_springImpulse,this.m_ax,j.s_t1),b2WheelJoint.InitVelocityConstraints_s_P),l=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,c=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse,h.SelfMulSub(this.m_invMassA,s),u-=this.m_invIA*l,_.SelfMulAdd(this.m_invMassB,s),d+=this.m_invIB*c):(this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0),t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=d;},b2WheelJoint.prototype.SolveVelocityConstraints=function(t){var h=this.m_invMassA,u=this.m_invMassB;var e=this.m_invIA,i=this.m_invIB;var r=t.velocities[this.m_indexA].v;var n=t.velocities[this.m_indexA].w;var a=t.velocities[this.m_indexB].v;var o=t.velocities[this.m_indexB].w;var s=j.DotVV(this.m_ax,j.SubVV(a,r,j.s_t0))+this.m_sBx*o-this.m_sAx*n;var c=-this.m_springMass*(s+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var l=j.MulSV(c,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P);var _=c*this.m_sAx;var d=c*this.m_sBx;r.SelfMulSub(h,l),n-=e*_,a.SelfMulAdd(u,l);s=(o+=i*d)-n-this.m_motorSpeed;c=-this.m_motorMass*s;var f=this.m_motorImpulse;var p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+c,-p,p),n-=e*(c=this.m_motorImpulse-f),o+=i*c;s=j.DotVV(this.m_ay,j.SubVV(a,r,j.s_t0))+this.m_sBy*o-this.m_sAy*n;c=-this.m_mass*s;this.m_impulse+=c;l=j.MulSV(c,this.m_ay,b2WheelJoint.SolveVelocityConstraints_s_P);_=c*this.m_sAy;d=c*this.m_sBy;r.SelfMulSub(h,l),n-=e*_,a.SelfMulAdd(u,l),o+=i*d,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o;},b2WheelJoint.prototype.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c;var i=t.positions[this.m_indexA].a;var r=t.positions[this.m_indexB].c;var n=t.positions[this.m_indexB].a;var a=this.m_qA.SetAngle(i),o=this.m_qB.SetAngle(n);j.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var s=R.MulRV(a,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);o=R.MulRV(o,this.m_lalcB,this.m_rB);var c=j.AddVV(j.SubVV(r,e,j.s_t0),j.SubVV(o,s,j.s_t1),b2WheelJoint.SolvePositionConstraints_s_d);a=R.MulRV(a,this.m_localYAxisA,this.m_ay);s=j.CrossVV(j.AddVV(c,s,j.s_t0),a);o=j.CrossVV(o,a);c=j.DotVV(c,this.m_ay);var l=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;a=j.MulSV(l=0!==l?-c/l:0,a,b2WheelJoint.SolvePositionConstraints_s_P);s*=l;l*=o;return e.SelfMulSub(this.m_invMassA,a),i-=this.m_invIA*s,r.SelfMulAdd(this.m_invMassB,a),n+=this.m_invIB*l,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,D(c)<=M;},b2WheelJoint.prototype.GetDefinition=function(t){return t;},b2WheelJoint.prototype.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t);},b2WheelJoint.prototype.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t);},b2WheelJoint.prototype.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e;},b2WheelJoint.prototype.GetReactionTorque=function(t){return t*this.m_motorImpulse;},b2WheelJoint.prototype.GetLocalAnchorA=function(){return this.m_localAnchorA;},b2WheelJoint.prototype.GetLocalAnchorB=function(){return this.m_localAnchorB;},b2WheelJoint.prototype.GetLocalAxisA=function(){return this.m_localXAxisA;},b2WheelJoint.prototype.GetJointTranslation=function(){return this.GetPrismaticJointTranslation();},b2WheelJoint.prototype.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed();},b2WheelJoint.prototype.GetJointAngle=function(){return this.GetRevoluteJointAngle();},b2WheelJoint.prototype.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed();},b2WheelJoint.prototype.GetPrismaticJointTranslation=function(){var t=this.m_bodyA;var e=this.m_bodyB;var i=t.GetWorldPoint(this.m_localAnchorA,new j());e=e.GetWorldPoint(this.m_localAnchorB,new j());e=j.SubVV(e,i,new j());i=t.GetWorldVector(this.m_localXAxisA,new j());return j.DotVV(e,i);},b2WheelJoint.prototype.GetPrismaticJointSpeed=function(){var t=this.m_bodyA;var e=this.m_bodyB;j.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=R.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);j.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=R.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB);var n=j.AddVV(t.m_sweep.c,i,j.s_t0);var a=j.AddVV(e.m_sweep.c,r,j.s_t1);a=j.SubVV(a,n,j.s_t2);n=t.GetWorldVector(this.m_localXAxisA,new j());var o=t.m_linearVelocity;var s=e.m_linearVelocity;t=t.m_angularVelocity;e=e.m_angularVelocity;return j.DotVV(a,j.CrossSV(t,n,j.s_t0))+j.DotVV(n,j.SubVV(j.AddVCrossSV(s,e,r,j.s_t0),j.AddVCrossSV(o,t,i,j.s_t1),j.s_t0));},b2WheelJoint.prototype.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a;},b2WheelJoint.prototype.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t;},b2WheelJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor;},b2WheelJoint.prototype.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t);},b2WheelJoint.prototype.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t);},b2WheelJoint.prototype.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t);},b2WheelJoint.prototype.GetMotorTorque=function(t){return t*this.m_motorImpulse;},b2WheelJoint.prototype.Dump=function(t){var e=this.m_bodyA.m_islandIndex;var i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index);},b2WheelJoint.InitVelocityConstraints_s_d=new j(),b2WheelJoint.InitVelocityConstraints_s_P=new j(),b2WheelJoint.SolveVelocityConstraints_s_P=new j(),b2WheelJoint.SolvePositionConstraints_s_d=new j(),b2WheelJoint.SolvePositionConstraints_s_P=new j();var Vi=b2WheelJoint;function b2WheelJoint(t){var e=Oi.call(this,t)||this;return e.m_frequencyHz=0,e.m_dampingRatio=0,e.m_localAnchorA=new j(),e.m_localAnchorB=new j(),e.m_localXAxisA=new j(),e.m_localYAxisA=new j(),e.m_impulse=0,e.m_motorImpulse=0,e.m_springImpulse=0,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableMotor=!1,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new j(),e.m_localCenterB=new j(),e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_ax=new j(),e.m_ay=new j(),e.m_sAx=0,e.m_sBx=0,e.m_sAy=0,e.m_sBy=0,e.m_mass=0,e.m_motorMass=0,e.m_springMass=0,e.m_bias=0,e.m_gamma=0,e.m_qA=new R(),e.m_qB=new R(),e.m_lalcA=new j(),e.m_lalcB=new j(),e.m_rA=new j(),e.m_rB=new j(),e.m_frequencyHz=b2Maybe(t.frequencyHz,2),e.m_dampingRatio=b2Maybe(t.dampingRatio,.7),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,j.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,j.ZERO)),e.m_localXAxisA.Copy(b2Maybe(t.localAxisA,j.UNITX)),j.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e.m_ax.SetZero(),e.m_ay.SetZero(),e;}var Oi;function b2MixFriction(t,e){return X(t*e);}function b2MixRestitution(t,e){return e<t?t:e;}var Fi=function(t){this.prev=null,this.next=null,this.contact=t;};b2Contact.prototype.GetManifold=function(){return this.m_manifold;},b2Contact.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody();var i=this.m_fixtureB.GetBody();var r=this.m_fixtureA.GetShape();var n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),r.m_radius,i.GetTransform(),n.m_radius);},b2Contact.prototype.IsTouching=function(){return this.m_touchingFlag;},b2Contact.prototype.SetEnabled=function(t){this.m_enabledFlag=t;},b2Contact.prototype.IsEnabled=function(){return this.m_enabledFlag;},b2Contact.prototype.GetNext=function(){return this.m_next;},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA;},b2Contact.prototype.GetChildIndexA=function(){return this.m_indexA;},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB;},b2Contact.prototype.GetChildIndexB=function(){return this.m_indexB;},b2Contact.prototype.FlagForFiltering=function(){this.m_filterFlag=!0;},b2Contact.prototype.SetFriction=function(t){this.m_friction=t;},b2Contact.prototype.GetFriction=function(){return this.m_friction;},b2Contact.prototype.ResetFriction=function(){this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction);},b2Contact.prototype.SetRestitution=function(t){this.m_restitution=t;},b2Contact.prototype.GetRestitution=function(){return this.m_restitution;},b2Contact.prototype.ResetRestitution=function(){this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution);},b2Contact.prototype.SetTangentSpeed=function(t){this.m_tangentSpeed=t;},b2Contact.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed;},b2Contact.prototype.Reset=function(t,e,i,r){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution);},b2Contact.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e;e=!(this.m_enabledFlag=!0);var i=this.m_touchingFlag;var r=this.m_fixtureA.IsSensor();var n=this.m_fixtureB.IsSensor();r=r||n;n=this.m_fixtureA.GetBody();var a=this.m_fixtureB.GetBody();var h=n.GetTransform();var u=a.GetTransform();if(r){var _=this.m_fixtureA.GetShape();var d=this.m_fixtureB.GetShape();e=b2TestOverlapShape(_,this.m_indexA,d,this.m_indexB,h,u),this.m_manifold.pointCount=0;}else{this.Evaluate(this.m_manifold,h,u),e=0<this.m_manifold.pointCount;for(var o=0;o<this.m_manifold.pointCount;++o){var s=this.m_manifold.points[o];s.normalImpulse=0,s.tangentImpulse=0;var f=s.id;for(var c=0;c<this.m_oldManifold.pointCount;++c){var l=this.m_oldManifold.points[c];if(l.id.key===f.key){s.normalImpulse=l.normalImpulse,s.tangentImpulse=l.tangentImpulse;break;}}}e!==i&&(n.SetAwake(!0),a.SetAwake(!0));}this.m_touchingFlag=e,!i&&e&&t&&t.BeginContact(this),i&&!e&&t&&t.EndContact(this),!r&&e&&t&&t.PreSolve(this,this.m_oldManifold);},b2Contact.prototype.ComputeTOI=function(t,e){var i=b2Contact.ComputeTOI_s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=M;t=b2Contact.ComputeTOI_s_output;return b2TimeOfImpact(t,i),t.t;},b2Contact.ComputeTOI_s_input=new It(),b2Contact.ComputeTOI_s_output=new Bt();var Ni=b2Contact;function b2Contact(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new ut(),this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new ut(),this.m_nodeA=new Fi(this),this.m_nodeB=new Fi(this);}__extends(b2CircleContact,Gi=Ni),b2CircleContact.Create=function(t){return new b2CircleContact();},b2CircleContact.Destroy=function(t,e){},b2CircleContact.prototype.Reset=function(t,e,i,r){Gi.prototype.Reset.call(this,t,e,i,r);},b2CircleContact.prototype.Evaluate=function(t,e,i){b2CollideCircles(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i);};var ki=b2CircleContact;function b2CircleContact(){return Gi.call(this)||this;}var Gi;__extends(b2PolygonContact,Ui=Ni),b2PolygonContact.Create=function(t){return new b2PolygonContact();},b2PolygonContact.Destroy=function(t,e){},b2PolygonContact.prototype.Reset=function(t,e,i,r){Ui.prototype.Reset.call(this,t,e,i,r);},b2PolygonContact.prototype.Evaluate=function(t,e,i){b2CollidePolygons(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i);};var zi=b2PolygonContact;function b2PolygonContact(){return Ui.call(this)||this;}var Ui;__extends(b2PolygonAndCircleContact,Hi=Ni),b2PolygonAndCircleContact.Create=function(t){return new b2PolygonAndCircleContact();},b2PolygonAndCircleContact.Destroy=function(t,e){},b2PolygonAndCircleContact.prototype.Reset=function(t,e,i,r){Hi.prototype.Reset.call(this,t,e,i,r);},b2PolygonAndCircleContact.prototype.Evaluate=function(t,e,i){b2CollidePolygonAndCircle(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i);};var Wi=b2PolygonAndCircleContact;function b2PolygonAndCircleContact(){return Hi.call(this)||this;}var Hi;__extends(b2EdgeAndCircleContact,Xi=Ni),b2EdgeAndCircleContact.Create=function(t){return new b2EdgeAndCircleContact();},b2EdgeAndCircleContact.Destroy=function(t,e){},b2EdgeAndCircleContact.prototype.Reset=function(t,e,i,r){Xi.prototype.Reset.call(this,t,e,i,r);},b2EdgeAndCircleContact.prototype.Evaluate=function(t,e,i){b2CollideEdgeAndCircle(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i);};var ji=b2EdgeAndCircleContact;function b2EdgeAndCircleContact(){return Xi.call(this)||this;}var Xi;__extends(b2EdgeAndPolygonContact,Yi=Ni),b2EdgeAndPolygonContact.Create=function(t){return new b2EdgeAndPolygonContact();},b2EdgeAndPolygonContact.Destroy=function(t,e){},b2EdgeAndPolygonContact.prototype.Reset=function(t,e,i,r){Yi.prototype.Reset.call(this,t,e,i,r);},b2EdgeAndPolygonContact.prototype.Evaluate=function(t,e,i){b2CollideEdgeAndPolygon(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i);};var qi=b2EdgeAndPolygonContact;function b2EdgeAndPolygonContact(){return Yi.call(this)||this;}var Yi;__extends(b2ChainAndCircleContact,Zi=Ni),b2ChainAndCircleContact.Create=function(t){return new b2ChainAndCircleContact();},b2ChainAndCircleContact.Destroy=function(t,e){},b2ChainAndCircleContact.prototype.Reset=function(t,e,i,r){Zi.prototype.Reset.call(this,t,e,i,r);},b2ChainAndCircleContact.prototype.Evaluate=function(t,e,i){var r=this.m_fixtureA.GetShape();var n=this.m_fixtureB.GetShape();var a=b2ChainAndCircleContact.Evaluate_s_edge;r.GetChildEdge(a,this.m_indexA),b2CollideEdgeAndCircle(t,a,e,n,i);},b2ChainAndCircleContact.Evaluate_s_edge=new Ie();var Ji=b2ChainAndCircleContact;function b2ChainAndCircleContact(){return Zi.call(this)||this;}var Zi;__extends(b2ChainAndPolygonContact,Ki=Ni),b2ChainAndPolygonContact.Create=function(t){return new b2ChainAndPolygonContact();},b2ChainAndPolygonContact.Destroy=function(t,e){},b2ChainAndPolygonContact.prototype.Reset=function(t,e,i,r){Ki.prototype.Reset.call(this,t,e,i,r);},b2ChainAndPolygonContact.prototype.Evaluate=function(t,e,i){var r=this.m_fixtureA.GetShape();var n=this.m_fixtureB.GetShape();var a=b2ChainAndPolygonContact.Evaluate_s_edge;r.GetChildEdge(a,this.m_indexA),b2CollideEdgeAndPolygon(t,a,e,n,i);},b2ChainAndPolygonContact.Evaluate_s_edge=new Ie();var Qi=b2ChainAndPolygonContact;function b2ChainAndPolygonContact(){return Ki.call(this)||this;}var Ki;var $i=function(){this.createFcn=null,this.destroyFcn=null,this.primary=!1;};b2ContactFactory.prototype.AddType=function(e,t,i,r){var n=this;var a=b2MakeArray(256,function(t){return e(n.m_allocator);});function poolCreateFcn(t){return a.pop()||e(t);}function poolDestroyFcn(t,e){a.push(t);}this.m_registers[i][r].createFcn=poolCreateFcn,this.m_registers[i][r].destroyFcn=poolDestroyFcn,this.m_registers[i][r].primary=!0,i!==r&&(this.m_registers[r][i].createFcn=poolCreateFcn,this.m_registers[r][i].destroyFcn=poolDestroyFcn,this.m_registers[r][i].primary=!1);},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=[];for(var t=0;t<H.b2ShapeType.e_shapeTypeCount;t++){this.m_registers[t]=[];for(var e=0;e<H.b2ShapeType.e_shapeTypeCount;e++)this.m_registers[t][e]=new $i();}this.AddType(ki.Create,ki.Destroy,H.b2ShapeType.e_circleShape,H.b2ShapeType.e_circleShape),this.AddType(Wi.Create,Wi.Destroy,H.b2ShapeType.e_polygonShape,H.b2ShapeType.e_circleShape),this.AddType(zi.Create,zi.Destroy,H.b2ShapeType.e_polygonShape,H.b2ShapeType.e_polygonShape),this.AddType(ji.Create,ji.Destroy,H.b2ShapeType.e_edgeShape,H.b2ShapeType.e_circleShape),this.AddType(qi.Create,qi.Destroy,H.b2ShapeType.e_edgeShape,H.b2ShapeType.e_polygonShape),this.AddType(Ji.Create,Ji.Destroy,H.b2ShapeType.e_chainShape,H.b2ShapeType.e_circleShape),this.AddType(Qi.Create,Qi.Destroy,H.b2ShapeType.e_chainShape,H.b2ShapeType.e_polygonShape);},b2ContactFactory.prototype.Create=function(t,e,i,r){var n=t.GetType();var a=i.GetType();n=this.m_registers[n][a];return n.createFcn?(a=n.createFcn(this.m_allocator),n.primary?a.Reset(t,e,i,r):a.Reset(i,r,t,e),a):null;},b2ContactFactory.prototype.Destroy=function(t){var e=t.m_fixtureA;var i=t.m_fixtureB;0<t.m_manifold.pointCount&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));e=e.GetType();i=i.GetType();e=this.m_registers[e][i];e.destroyFcn&&e.destroyFcn(t,this.m_allocator);};var tr=b2ContactFactory;function b2ContactFactory(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters();}b2DestructionListener.prototype.SayGoodbyeJoint=function(t){},b2DestructionListener.prototype.SayGoodbyeFixture=function(t){},b2DestructionListener.prototype.SayGoodbyeParticleGroup=function(t){},b2DestructionListener.prototype.SayGoodbyeParticle=function(t,e){};var er=b2DestructionListener;function b2DestructionListener(){}b2ContactFilter.prototype.ShouldCollide=function(t,e){var i=t.GetBody();var r=e.GetBody();if(r.GetType()===H.b2BodyType.b2_staticBody&&i.GetType()===H.b2BodyType.b2_staticBody)return!1;if(!r.ShouldCollideConnected(i))return!1;r=t.GetFilterData();i=e.GetFilterData();return r.groupIndex===i.groupIndex&&0!==r.groupIndex?0<r.groupIndex:0!=(r.maskBits&i.categoryBits)&&0!=(r.categoryBits&i.maskBits);},b2ContactFilter.prototype.ShouldCollideFixtureParticle=function(t,e,i){return!0;},b2ContactFilter.prototype.ShouldCollideParticleParticle=function(t,e,i){return!0;},b2ContactFilter.b2_defaultFilter=new b2ContactFilter();var ir=b2ContactFilter;function b2ContactFilter(){}var rr=function(){this.normalImpulses=b2MakeNumberArray(2),this.tangentImpulses=b2MakeNumberArray(2),this.count=0;};b2ContactListener.prototype.BeginContact=function(t){},b2ContactListener.prototype.EndContact=function(t){},b2ContactListener.prototype.BeginContactFixtureParticle=function(t,e){},b2ContactListener.prototype.EndContactFixtureParticle=function(t,e){},b2ContactListener.prototype.BeginContactParticleParticle=function(t,e){},b2ContactListener.prototype.EndContactParticleParticle=function(t,e){},b2ContactListener.prototype.PreSolve=function(t,e){},b2ContactListener.prototype.PostSolve=function(t,e){},b2ContactListener.b2_defaultListener=new b2ContactListener();var nr=b2ContactListener;function b2ContactListener(){}b2QueryCallback.prototype.ReportFixture=function(t){return!0;},b2QueryCallback.prototype.ReportParticle=function(t,e){return!1;},b2QueryCallback.prototype.ShouldQueryParticleSystem=function(t){return!0;};var ar=b2QueryCallback;function b2QueryCallback(){}b2RayCastCallback.prototype.ReportFixture=function(t,e,i,r){return r;},b2RayCastCallback.prototype.ReportParticle=function(t,e,i,r,n){return 0;},b2RayCastCallback.prototype.ShouldQueryParticleSystem=function(t){return!0;};var or=b2RayCastCallback;function b2RayCastCallback(){}b2ContactManager.prototype.AddPair=function(t,e){var i=t.fixture;var r=e.fixture;var n=t.childIndex;var a=e.childIndex;var o=i.GetBody();t=r.GetBody();if(o!==t){var s=t.GetContactList();for(;s;){if(s.other===o){var c=s.contact.GetFixtureA();var l=s.contact.GetFixtureB();var h=s.contact.GetChildIndexA();var u=s.contact.GetChildIndexB();if(c===i&&l===r&&h===n&&u===a)return;if(c===r&&l===i&&h===a&&u===n)return;}s=s.next;}this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,r)||null!==(e=this.m_contactFactory.Create(i,n,r,a))&&(i=e.GetFixtureA(),r=e.GetFixtureB(),n=e.GetChildIndexA(),a=e.GetChildIndexB(),o=i.m_body,t=r.m_body,e.m_prev=null,e.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=e),((this.m_contactList=e).m_nodeA.contact=e).m_nodeA.other=t,e.m_nodeA.prev=null,e.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=e.m_nodeA),o.m_contactList=e.m_nodeA,(e.m_nodeB.contact=e).m_nodeB.other=o,e.m_nodeB.prev=null,e.m_nodeB.next=t.m_contactList,null!==t.m_contactList&&(t.m_contactList.prev=e.m_nodeB),t.m_contactList=e.m_nodeB,i.IsSensor()||r.IsSensor()||(o.SetAwake(!0),t.SetAwake(!0)),++this.m_contactCount);}},b2ContactManager.prototype.FindNewContacts=function(){var i=this;this.m_broadPhase.UpdatePairs(function(t,e){i.AddPair(t,e);});},b2ContactManager.prototype.Destroy=function(t){var e=t.GetFixtureA();var i=t.GetFixtureB();e=e.GetBody();i=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===e.m_contactList&&(e.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===i.m_contactList&&(i.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount;},b2ContactManager.prototype.Collide=function(){var t=this.m_contactList;for(;t;){var e=t.GetFixtureA();var i=t.GetFixtureB();var r=t.GetChildIndexA();var n=t.GetChildIndexB();var a=e.GetBody();var o=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){t=(s=t).m_next,this.Destroy(s);continue;}t.m_filterFlag=!1;}a=a.IsAwake()&&a.m_type!==H.b2BodyType.b2_staticBody;o=o.IsAwake()&&o.m_type!==H.b2BodyType.b2_staticBody;var s;a||o?(a=e.m_proxies[r].treeNode,o=i.m_proxies[n].treeNode,b2TestOverlapAABB(a.aabb,o.aabb)?(t.Update(this.m_contactListener),t=t.m_next):(t=(s=t).m_next,this.Destroy(s))):t=t.m_next;}};var sr=b2ContactManager;function b2ContactManager(){this.m_broadPhase=new At(),this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=ir.b2_defaultFilter,this.m_contactListener=nr.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new tr(this.m_allocator);}b2Profile.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this;};var cr=b2Profile;function b2Profile(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0;}b2TimeStep.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this;};var lr=b2TimeStep;function b2TimeStep(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1;}b2Position.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2Position();});};var hr=b2Position;function b2Position(){this.c=new j(),this.a=0;}b2Velocity.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2Velocity();});};var ur=b2Velocity;function b2Velocity(){this.v=new j(),this.w=0;}var _r=function(){this.step=new lr();};b2VelocityConstraintPoint.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2VelocityConstraintPoint();});};var dr=b2VelocityConstraintPoint;function b2VelocityConstraintPoint(){this.rA=new j(),this.rB=new j(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0;}b2ContactVelocityConstraint.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2ContactVelocityConstraint();});};var fr=b2ContactVelocityConstraint;function b2ContactVelocityConstraint(){this.points=dr.MakeArray(2),this.normal=new j(),this.tangent=new j(),this.normalMass=new g(),this.K=new g(),this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0;}b2ContactPositionConstraint.MakeArray=function(t){return b2MakeArray(t,function(t){return new b2ContactPositionConstraint();});};var pr=b2ContactPositionConstraint;function b2ContactPositionConstraint(){this.localPoints=j.MakeArray(2),this.localNormal=new j(),this.localPoint=new j(),this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new j(),this.localCenterB=new j(),this.invIA=0,this.invIB=0,this.type=H.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0;}var mr=function(){this.step=new lr(),this.count=0,this.allocator=null;};b2PositionSolverManifold.prototype.Initialize=function(t,e,i,r){var n=b2PositionSolverManifold.Initialize_s_pointA;var a=b2PositionSolverManifold.Initialize_s_pointB;var o=b2PositionSolverManifold.Initialize_s_planePoint;var s=b2PositionSolverManifold.Initialize_s_clipPoint;switch(t.type){case H.b2ManifoldType.e_circles:I.MulXV(e,t.localPoint,n),I.MulXV(i,t.localPoints[0],a),j.SubVV(a,n,this.normal).SelfNormalize(),j.MidVV(n,a,this.point),this.separation=j.DotVV(j.SubVV(a,n,j.s_t0),this.normal)-t.radiusA-t.radiusB;break;case H.b2ManifoldType.e_faceA:R.MulRV(e.q,t.localNormal,this.normal),I.MulXV(e,t.localPoint,o),I.MulXV(i,t.localPoints[r],s),this.separation=j.DotVV(j.SubVV(s,o,j.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(s);break;case H.b2ManifoldType.e_faceB:R.MulRV(i.q,t.localNormal,this.normal),I.MulXV(i,t.localPoint,o),I.MulXV(e,t.localPoints[r],s),this.separation=j.DotVV(j.SubVV(s,o,j.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(s),this.normal.SelfNeg();}},b2PositionSolverManifold.Initialize_s_pointA=new j(),b2PositionSolverManifold.Initialize_s_pointB=new j(),b2PositionSolverManifold.Initialize_s_planePoint=new j(),b2PositionSolverManifold.Initialize_s_clipPoint=new j();var vr=b2PositionSolverManifold;function b2PositionSolverManifold(){this.normal=new j(),this.point=new j(),this.separation=0;}b2ContactSolver.prototype.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){var h=V(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<h;)this.m_positionConstraints[this.m_positionConstraints.length]=new pr();}if(this.m_velocityConstraints.length<this.m_count){h=V(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<h;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new fr();}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var e=0;e<this.m_count;++e){var i=this.m_contacts[e];var r=i.m_fixtureA;var n=i.m_fixtureB;var u=r.GetShape();var _=n.GetShape();u=u.m_radius;_=_.m_radius;r=r.GetBody();n=n.GetBody();var a=i.GetManifold();var d=a.pointCount;var o=this.m_velocityConstraints[e];o.friction=i.m_friction,o.restitution=i.m_restitution,o.tangentSpeed=i.m_tangentSpeed,o.indexA=r.m_islandIndex,o.indexB=n.m_islandIndex,o.invMassA=r.m_invMass,o.invMassB=n.m_invMass,o.invIA=r.m_invI,o.invIB=n.m_invI,o.contactIndex=e,o.pointCount=d,o.K.SetZero(),o.normalMass.SetZero();var s=this.m_positionConstraints[e];s.indexA=r.m_islandIndex,s.indexB=n.m_islandIndex,s.invMassA=r.m_invMass,s.invMassB=n.m_invMass,s.localCenterA.Copy(r.m_sweep.localCenter),s.localCenterB.Copy(n.m_sweep.localCenter),s.invIA=r.m_invI,s.invIB=n.m_invI,s.localNormal.Copy(a.localNormal),s.localPoint.Copy(a.localPoint),s.pointCount=d,s.radiusA=u,s.radiusB=_,s.type=a.type;for(var c=0;c<d;++c){var f=a.points[c];var l=o.points[c];this.m_step.warmStarting?(l.normalImpulse=this.m_step.dtRatio*f.normalImpulse,l.tangentImpulse=this.m_step.dtRatio*f.tangentImpulse):(l.normalImpulse=0,l.tangentImpulse=0),l.rA.SetZero(),l.rB.SetZero(),l.normalMass=0,l.tangentMass=0,l.velocityBias=0,s.localPoints[c].Copy(f.localPoint);}}return this;},b2ContactSolver.prototype.InitializeVelocityConstraints=function(){var t=b2ContactSolver.InitializeVelocityConstraints_s_xfA;var e=b2ContactSolver.InitializeVelocityConstraints_s_xfB;var i=b2ContactSolver.InitializeVelocityConstraints_s_worldManifold;for(var h=0;h<this.m_count;++h){var r=this.m_velocityConstraints[h];var n=this.m_positionConstraints[h];var u=n.radiusA;var _=n.radiusB;var d=this.m_contacts[r.contactIndex].GetManifold();var a=r.indexA;var f=r.indexB;var p=r.invMassA;var m=r.invMassB;var v=r.invIA;var y=r.invIB;var g=n.localCenterA;n=n.localCenterB;var b=this.m_positions[a].c;var C=this.m_positions[a].a;var x=this.m_velocities[a].v;var A=this.m_velocities[a].w;var S=this.m_positions[f].c;a=this.m_positions[f].a;var T=this.m_velocities[f].v;var w=this.m_velocities[f].w;t.q.SetAngle(C),e.q.SetAngle(a),j.SubVV(b,R.MulRV(t.q,g,j.s_t0),t.p),j.SubVV(S,R.MulRV(e.q,n,j.s_t0),e.p),i.Initialize(d,t,u,e,_),r.normal.Copy(i.normal),j.CrossVOne(r.normal,r.tangent);var E=r.pointCount;for(var o=0;o<E;++o){var s=r.points[o];j.SubVV(i.points[o],b,s.rA),j.SubVV(i.points[o],S,s.rB);var c=j.CrossVV(s.rA,r.normal);var l=j.CrossVV(s.rB,r.normal);c=p+m+v*c*c+y*l*l;s.normalMass=0<c?1/c:0;l=r.tangent;c=j.CrossVV(s.rA,l);l=j.CrossVV(s.rB,l);c=p+m+v*c*c+y*l*l;s.tangentMass=0<c?1/c:0,s.velocityBias=0;l=j.DotVV(r.normal,j.SubVV(j.AddVCrossSV(T,w,s.rB,j.s_t0),j.AddVCrossSV(x,A,s.rA,j.s_t1),j.s_t0));l<-1&&(s.velocityBias+=-r.restitution*l);}r.pointCount;}},b2ContactSolver.prototype.WarmStart=function(){var t=b2ContactSolver.WarmStart_s_P;for(var e=0;e<this.m_count;++e){var i=this.m_velocityConstraints[e];var r=i.indexA;var n=i.indexB;var a=i.invMassA;var h=i.invIA;var u=i.invMassB;var _=i.invIB;var d=i.pointCount;var f=this.m_velocities[r].v;var o=this.m_velocities[r].w;var p=this.m_velocities[n].v;var s=this.m_velocities[n].w;var m=i.normal;var v=i.tangent;for(var c=0;c<d;++c){var l=i.points[c];j.AddVV(j.MulSV(l.normalImpulse,m,j.s_t0),j.MulSV(l.tangentImpulse,v,j.s_t1),t),o-=h*j.CrossVV(l.rA,t),f.SelfMulSub(a,t),s+=_*j.CrossVV(l.rB,t),p.SelfMulAdd(u,t);}this.m_velocities[r].w=o,this.m_velocities[n].w=s;}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){var t=b2ContactSolver.SolveVelocityConstraints_s_dv;var e=b2ContactSolver.SolveVelocityConstraints_s_P;for(var h=0;h<this.m_count;++h){var i=this.m_velocityConstraints[h];var u=i.indexA;var _=i.indexB;var d=i.invMassA;var f=i.invIA;var p=i.invMassB;var m=i.invIB;var v=i.pointCount;var r=this.m_velocities[u].v;var n=this.m_velocities[u].w;var a=this.m_velocities[_].v;var o=this.m_velocities[_].w;var y=i.normal;var g=i.tangent;var b=i.friction;for(var s=0;s<v;++s){var c=i.points[s];j.SubVV(j.AddVCrossSV(a,o,c.rB,j.s_t0),j.AddVCrossSV(r,n,c.rA,j.s_t1),t);var C=j.DotVV(t,g)-i.tangentSpeed;var l=c.tangentMass*-C;C=b*c.normalImpulse;l=(A=b2Clamp(c.tangentImpulse+l,-C,C))-c.tangentImpulse,c.tangentImpulse=A,j.MulSV(l,g,e),r.SelfMulSub(d,e),n-=f*j.CrossVV(c.rA,e),a.SelfMulAdd(p,e),o+=m*j.CrossVV(c.rB,e);}i.pointCount;for(s=0;s<v;++s){c=i.points[s];j.SubVV(j.AddVCrossSV(a,o,c.rB,j.s_t0),j.AddVCrossSV(r,n,c.rA,j.s_t1),t);var x=j.DotVV(t,y);l=-c.normalMass*(x-c.velocityBias);var A;l=(A=V(c.normalImpulse+l,0))-c.normalImpulse,c.normalImpulse=A,j.MulSV(l,y,e),r.SelfMulSub(d,e),n-=f*j.CrossVV(c.rA,e),a.SelfMulAdd(p,e),o+=m*j.CrossVV(c.rB,e);}this.m_velocities[u].w=n,this.m_velocities[_].w=o;}},b2ContactSolver.prototype.StoreImpulses=function(){for(var t=0;t<this.m_count;++t){var e=this.m_velocityConstraints[t];var i=this.m_contacts[e.contactIndex].GetManifold();for(var r=0;r<e.pointCount;++r)i.points[r].normalImpulse=e.points[r].normalImpulse,i.points[r].tangentImpulse=e.points[r].tangentImpulse;}},b2ContactSolver.prototype.SolvePositionConstraints=function(){var t=b2ContactSolver.SolvePositionConstraints_s_xfA;var e=b2ContactSolver.SolvePositionConstraints_s_xfB;var i=b2ContactSolver.SolvePositionConstraints_s_psm;var r=b2ContactSolver.SolvePositionConstraints_s_rA;var n=b2ContactSolver.SolvePositionConstraints_s_rB;var a=b2ContactSolver.SolvePositionConstraints_s_P;var o=0;for(var h=0;h<this.m_count;++h){var s=this.m_positionConstraints[h];var u=s.indexA;var _=s.indexB;var d=s.localCenterA;var f=s.invMassA;var p=s.invIA;var m=s.localCenterB;var v=s.invMassB;var y=s.invIB;var g=s.pointCount;var b=this.m_positions[u].c;var C=this.m_positions[u].a;var x=this.m_positions[_].c;var A=this.m_positions[_].a;for(var S=0;S<g;++S){t.q.SetAngle(C),e.q.SetAngle(A),j.SubVV(b,R.MulRV(t.q,d,j.s_t0),t.p),j.SubVV(x,R.MulRV(e.q,m,j.s_t0),e.p),i.Initialize(s,t,e,S);var T=i.normal;var c=i.point;var l=i.separation;j.SubVV(c,b,r),j.SubVV(c,x,n),o=L(o,l);c=b2Clamp(.2*(l+M),-.2,0);l=j.CrossVV(r,T);var w=j.CrossVV(n,T);l=f+v+p*l*l+y*w*w;j.MulSV(0<l?-c/l:0,T,a),b.SelfMulSub(f,a),C-=p*j.CrossVV(r,a),x.SelfMulAdd(v,a),A+=y*j.CrossVV(n,a);}this.m_positions[u].a=C,this.m_positions[_].a=A;}return-.024<o;},b2ContactSolver.prototype.SolveTOIPositionConstraints=function(h,u){var t=b2ContactSolver.SolveTOIPositionConstraints_s_xfA;var e=b2ContactSolver.SolveTOIPositionConstraints_s_xfB;var i=b2ContactSolver.SolveTOIPositionConstraints_s_psm;var r=b2ContactSolver.SolveTOIPositionConstraints_s_rA;var _=b2ContactSolver.SolveTOIPositionConstraints_s_rB;var n=b2ContactSolver.SolveTOIPositionConstraints_s_P;var d=0;for(var f=0;f<this.m_count;++f){var a=this.m_positionConstraints[f];var o=a.indexA;var s=a.indexB;var p=a.localCenterA;var m=a.localCenterB;var v=a.pointCount;var y=0;var g=0;o!==h&&o!==u||(y=a.invMassA,g=a.invIA);var b=0;var C=0;s!==h&&s!==u||(b=a.invMassB,C=a.invIB);var x=this.m_positions[o].c;var A=this.m_positions[o].a;var S=this.m_positions[s].c;var T=this.m_positions[s].a;for(var w=0;w<v;++w){t.q.SetAngle(A),e.q.SetAngle(T),j.SubVV(x,R.MulRV(t.q,p,j.s_t0),t.p),j.SubVV(S,R.MulRV(e.q,m,j.s_t0),e.p),i.Initialize(a,t,e,w);var E=i.normal;var c=i.point;var l=i.separation;j.SubVV(c,x,r),j.SubVV(c,S,_),d=L(d,l);c=b2Clamp(.75*(l+M),-.2,0);l=j.CrossVV(r,E);var P=j.CrossVV(_,E);l=y+b+g*l*l+C*P*P;j.MulSV(0<l?-c/l:0,E,n),x.SelfMulSub(y,n),A-=g*j.CrossVV(r,n),S.SelfMulAdd(b,n),T+=C*j.CrossVV(_,n);}this.m_positions[o].a=A,this.m_positions[s].a=T;}return-.012<=d;},b2ContactSolver.InitializeVelocityConstraints_s_xfA=new I(),b2ContactSolver.InitializeVelocityConstraints_s_xfB=new I(),b2ContactSolver.InitializeVelocityConstraints_s_worldManifold=new _t(),b2ContactSolver.WarmStart_s_P=new j(),b2ContactSolver.SolveVelocityConstraints_s_dv=new j(),b2ContactSolver.SolveVelocityConstraints_s_dv1=new j(),b2ContactSolver.SolveVelocityConstraints_s_dv2=new j(),b2ContactSolver.SolveVelocityConstraints_s_P=new j(),b2ContactSolver.SolveVelocityConstraints_s_a=new j(),b2ContactSolver.SolveVelocityConstraints_s_b=new j(),b2ContactSolver.SolveVelocityConstraints_s_x=new j(),b2ContactSolver.SolveVelocityConstraints_s_d=new j(),b2ContactSolver.SolveVelocityConstraints_s_P1=new j(),b2ContactSolver.SolveVelocityConstraints_s_P2=new j(),b2ContactSolver.SolveVelocityConstraints_s_P1P2=new j(),b2ContactSolver.SolvePositionConstraints_s_xfA=new I(),b2ContactSolver.SolvePositionConstraints_s_xfB=new I(),b2ContactSolver.SolvePositionConstraints_s_psm=new vr(),b2ContactSolver.SolvePositionConstraints_s_rA=new j(),b2ContactSolver.SolvePositionConstraints_s_rB=new j(),b2ContactSolver.SolvePositionConstraints_s_P=new j(),b2ContactSolver.SolveTOIPositionConstraints_s_xfA=new I(),b2ContactSolver.SolveTOIPositionConstraints_s_xfB=new I(),b2ContactSolver.SolveTOIPositionConstraints_s_psm=new vr(),b2ContactSolver.SolveTOIPositionConstraints_s_rA=new j(),b2ContactSolver.SolveTOIPositionConstraints_s_rB=new j(),b2ContactSolver.SolveTOIPositionConstraints_s_P=new j();var yr=b2ContactSolver;function b2ContactSolver(){this.m_step=new lr(),this.m_allocator=null,this.m_positionConstraints=pr.MakeArray(1024),this.m_velocityConstraints=fr.MakeArray(1024),this.m_count=0;}b2Island.prototype.Initialize=function(t,e,i,r,n){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=n,this.m_positions.length<t){var a=V(2*this.m_positions.length,t);for(;this.m_positions.length<a;)this.m_positions[this.m_positions.length]=new hr();}if(this.m_velocities.length<t){a=V(2*this.m_velocities.length,t);for(;this.m_velocities.length<a;)this.m_velocities[this.m_velocities.length]=new ur();}},b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0;},b2Island.prototype.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t;},b2Island.prototype.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t;},b2Island.prototype.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t;},b2Island.prototype.Solve=function(h,t,u,_){var e=b2Island.s_timer.Reset();var i=t.dt;for(var r=0;r<this.m_bodyCount;++r){var n=this.m_bodies[r];this.m_positions[r].c.Copy(n.m_sweep.c);var d=n.m_sweep.a;var a=this.m_velocities[r].v.Copy(n.m_linearVelocity);var o=n.m_angularVelocity;n.m_sweep.c0.Copy(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_type===H.b2BodyType.b2_dynamicBody&&(a.x+=i*(n.m_gravityScale*u.x+n.m_invMass*n.m_force.x),a.y+=i*(n.m_gravityScale*u.y+n.m_invMass*n.m_force.y),o+=i*n.m_invI*n.m_torque,a.SelfMul(1/(1+i*n.m_linearDamping)),o*=1/(1+i*n.m_angularDamping)),this.m_positions[r].a=d,this.m_velocities[r].w=o;}e.Reset();var f=b2Island.s_solverData;f.step.Copy(t),f.positions=this.m_positions,f.velocities=this.m_velocities;var s=b2Island.s_contactSolverDef;s.step.Copy(t),s.contacts=this.m_contacts,s.count=this.m_contactCount,s.positions=this.m_positions,s.velocities=this.m_velocities,s.allocator=this.m_allocator;var p=b2Island.s_contactSolver.Initialize(s);p.InitializeVelocityConstraints(),t.warmStarting&&p.WarmStart();for(r=0;r<this.m_jointCount;++r)this.m_joints[r].InitVelocityConstraints(f);h.solveInit=e.GetMilliseconds(),e.Reset();for(r=0;r<t.velocityIterations;++r){for(var c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(f);p.SolveVelocityConstraints();}p.StoreImpulses(),h.solveVelocity=e.GetMilliseconds();for(r=0;r<this.m_bodyCount;++r){var m=this.m_positions[r].c;d=this.m_positions[r].a;a=this.m_velocities[r].v;o=this.m_velocities[r].w;var l=j.MulSV(i,a,b2Island.s_translation);4<j.DotVV(l,l)&&(v=2/l.Length(),a.SelfMul(v));l=i*o;var v;T<l*l&&(o*=v=S/D(l)),m.x+=i*a.x,m.y+=i*a.y,d+=i*o,this.m_positions[r].a=d,this.m_velocities[r].w=o;}e.Reset();var y=!1;for(r=0;r<t.positionIterations;++r){var g=p.SolvePositionConstraints();var b=!0;for(c=0;c<this.m_jointCount;++c){var C=this.m_joints[c].SolvePositionConstraints(f);b=b&&C;}if(g&&b){y=!0;break;}}for(r=0;r<this.m_bodyCount;++r){var x=this.m_bodies[r];x.m_sweep.c.Copy(this.m_positions[r].c),x.m_sweep.a=this.m_positions[r].a,x.m_linearVelocity.Copy(this.m_velocities[r].v),x.m_angularVelocity=this.m_velocities[r].w,x.SynchronizeTransform();}if(h.solvePosition=e.GetMilliseconds(),this.Report(p.m_velocityConstraints),_){var A=B;for(r=0;r<this.m_bodyCount;++r)(n=this.m_bodies[r]).GetType()!==H.b2BodyType.b2_staticBody&&(A=!n.m_autoSleepFlag||.0012184696791469947<n.m_angularVelocity*n.m_angularVelocity||1e-4<j.DotVV(n.m_linearVelocity,n.m_linearVelocity)?n.m_sleepTime=0:(n.m_sleepTime+=i,L(A,n.m_sleepTime)));if(.5<=A&&y)for(r=0;r<this.m_bodyCount;++r)(n=this.m_bodies[r]).SetAwake(!1);}},b2Island.prototype.SolveTOI=function(t,e,i){for(var r=0;r<this.m_bodyCount;++r){var n=this.m_bodies[r];this.m_positions[r].c.Copy(n.m_sweep.c),this.m_positions[r].a=n.m_sweep.a,this.m_velocities[r].v.Copy(n.m_linearVelocity),this.m_velocities[r].w=n.m_angularVelocity;}var a=b2Island.s_contactSolverDef;a.contacts=this.m_contacts,a.count=this.m_contactCount,a.allocator=this.m_allocator,a.step.Copy(t),a.positions=this.m_positions,a.velocities=this.m_velocities;var o=b2Island.s_contactSolver.Initialize(a);for(r=0;r<t.positionIterations;++r)if(o.SolveTOIPositionConstraints(e,i))break;this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,o.InitializeVelocityConstraints();for(r=0;r<t.velocityIterations;++r)o.SolveVelocityConstraints();var s=t.dt;for(r=0;r<this.m_bodyCount;++r){var h=this.m_positions[r].c;var u=this.m_positions[r].a;var _=this.m_velocities[r].v;var c=this.m_velocities[r].w;var l=j.MulSV(s,_,b2Island.s_translation);4<j.DotVV(l,l)&&(d=2/l.Length(),_.SelfMul(d));l=s*c;var d;T<l*l&&(c*=d=S/D(l)),h.SelfMulAdd(s,_),u+=s*c,this.m_positions[r].a=u,this.m_velocities[r].w=c;l=this.m_bodies[r];l.m_sweep.c.Copy(h),l.m_sweep.a=u,l.m_linearVelocity.Copy(_),l.m_angularVelocity=c,l.SynchronizeTransform();}this.Report(o.m_velocityConstraints);},b2Island.prototype.Report=function(t){if(null!==this.m_listener)for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];if(i){var r=t[e];var n=b2Island.s_impulse;n.count=r.pointCount;for(var a=0;a<r.pointCount;++a)n.normalImpulses[a]=r.points[a].normalImpulse,n.tangentImpulses[a]=r.points[a].tangentImpulse;this.m_listener.PostSolve(i,n);}}},b2Island.s_timer=new A(),b2Island.s_solverData=new _r(),b2Island.s_contactSolverDef=new mr(),b2Island.s_contactSolver=new yr(),b2Island.s_translation=new j(),b2Island.s_impulse=new rr();var gr=b2Island;function b2Island(){this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=hr.MakeArray(1024),this.m_velocities=ur.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0;}(Lr=H.b2ParticleFlag||(H.b2ParticleFlag={}))[Lr.b2_waterParticle=0]="b2_waterParticle",Lr[Lr.b2_zombieParticle=2]="b2_zombieParticle",Lr[Lr.b2_wallParticle=4]="b2_wallParticle",Lr[Lr.b2_springParticle=8]="b2_springParticle",Lr[Lr.b2_elasticParticle=16]="b2_elasticParticle",Lr[Lr.b2_viscousParticle=32]="b2_viscousParticle",Lr[Lr.b2_powderParticle=64]="b2_powderParticle",Lr[Lr.b2_tensileParticle=128]="b2_tensileParticle",Lr[Lr.b2_colorMixingParticle=256]="b2_colorMixingParticle",Lr[Lr.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Lr[Lr.b2_barrierParticle=1024]="b2_barrierParticle",Lr[Lr.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Lr[Lr.b2_reactiveParticle=4096]="b2_reactiveParticle",Lr[Lr.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Lr[Lr.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Lr[Lr.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Lr[Lr.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Lr[Lr.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var br=function(){this.flags=0,this.position=new j(),this.velocity=new j(),this.color=new C(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null;};function b2CalculateParticleIterations(t,e,i){return b2Clamp(Math.ceil(Math.sqrt(t/(.01*e))*i),1,8);}b2ParticleHandle.prototype.GetIndex=function(){return this.m_index;},b2ParticleHandle.prototype.SetIndex=function(t){this.m_index=t;};var Cr=b2ParticleHandle;function b2ParticleHandle(){this.m_index=-1;}(Lr=H.b2ParticleGroupFlag||(H.b2ParticleGroupFlag={}))[Lr.b2_solidParticleGroup=1]="b2_solidParticleGroup",Lr[Lr.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Lr[Lr.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Lr[Lr.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Lr[Lr.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Lr[Lr.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var xr=function(){this.flags=0,this.groupFlags=0,this.position=new j(),this.angle=0,this.linearVelocity=new j(),this.angularVelocity=0,this.color=new C(),this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null;};b2ParticleGroup.prototype.GetNext=function(){return this.m_next;},b2ParticleGroup.prototype.GetParticleSystem=function(){return this.m_system;},b2ParticleGroup.prototype.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex;},b2ParticleGroup.prototype.GetBufferIndex=function(){return this.m_firstIndex;},b2ParticleGroup.prototype.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex;},b2ParticleGroup.prototype.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error();var t=0;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t;},b2ParticleGroup.prototype.GetGroupFlags=function(){return this.m_groupFlags;},b2ParticleGroup.prototype.SetGroupFlags=function(t){t|=this.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t);},b2ParticleGroup.prototype.GetMass=function(){return this.UpdateStatistics(),this.m_mass;},b2ParticleGroup.prototype.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia;},b2ParticleGroup.prototype.GetCenter=function(){return this.UpdateStatistics(),this.m_center;},b2ParticleGroup.prototype.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity;},b2ParticleGroup.prototype.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity;},b2ParticleGroup.prototype.GetTransform=function(){return this.m_transform;},b2ParticleGroup.prototype.GetPosition=function(){return this.m_transform.p;},b2ParticleGroup.prototype.GetAngle=function(){return this.m_transform.q.GetAngle();},b2ParticleGroup.prototype.GetLinearVelocityFromWorldPoint=function(t,e){var i=b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),j.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,j.SubVV(t,this.m_center,i),e);},b2ParticleGroup.prototype.GetUserData=function(){return this.m_userData;},b2ParticleGroup.prototype.SetUserData=function(t){this.m_userData=t;},b2ParticleGroup.prototype.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t);},b2ParticleGroup.prototype.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t);},b2ParticleGroup.prototype.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error();for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t);},b2ParticleGroup.prototype.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error();if(!this.m_system.m_velocityBuffer.data)throw new Error();var t=new j();var e=new j();if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);var n;0<this.m_mass&&(n=1/this.m_mass,this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)),this.m_inertia=0,this.m_angularVelocity=0;for(r=this.m_firstIndex;r<this.m_lastIndex;r++)j.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,t),j.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,e),this.m_inertia+=i*j.DotVV(t,t),this.m_angularVelocity+=i*j.CrossVV(t,e);0<this.m_inertia&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp;}},b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0=new j();var Ar=b2ParticleGroup;function b2ParticleGroup(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new j(),this.m_linearVelocity=new j(),this.m_angularVelocity=0,this.m_transform=new I(),this.m_userData=null,this.m_system=t;}b2StackQueue.prototype.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(0<this.m_capacity?(this.m_buffer.concat(b2MakeArray(this.m_capacity,function(t){return null;})),this.m_capacity*=2):(this.m_buffer.concat(b2MakeArray(1,function(t){return null;})),this.m_capacity=1));}this.m_buffer[this.m_back]=t,this.m_back++;},b2StackQueue.prototype.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++;},b2StackQueue.prototype.Empty=function(){return this.m_front===this.m_back;},b2StackQueue.prototype.Front=function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error();return t;};var Sr=b2StackQueue;function b2StackQueue(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=b2MakeArray(t,function(t){return null;}),this.m_capacity=t;}b2VoronoiDiagram.prototype.AddGenerator=function(t,e,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(t),r.tag=e,r.necessary=i;},b2VoronoiDiagram.prototype.Generate=function(h,u){var _=1/h;var t=new j(+B,+B);var d=new j(-B,-B);var f=0;for(var e=0;e<this.m_generatorCount;e++)(o=this.m_generatorBuffer[e]).necessary&&(j.MinV(t,o.center,t),j.MaxV(d,o.center,d),++f);if(0===f)return this.m_countX=0,void(this.m_countY=0);t.x-=u,t.y-=u,d.x+=u,d.y+=u,this.m_countX=1+Math.floor(_*(d.x-t.x)),this.m_countY=1+Math.floor(_*(d.y-t.y)),this.m_diagram=[];var i=new Sr(4*this.m_countX*this.m_countY);for(e=0;e<this.m_generatorCount;e++){(o=this.m_generatorBuffer[e]).center.SelfSub(t).SelfMul(_);var r=Math.floor(o.center.x);var n=Math.floor(o.center.y);0<=r&&0<=n&&r<this.m_countX&&n<this.m_countY&&i.Push(new b2VoronoiDiagram.Task(r,n,r+n*this.m_countX,o));}for(;!i.Empty();){r=(s=i.Front()).m_x;n=s.m_y;var a=s.m_i;var o=s.m_generator;i.Pop(),this.m_diagram[a]||(this.m_diagram[a]=o,0<r&&i.Push(new b2VoronoiDiagram.Task(r-1,n,a-1,o)),0<n&&i.Push(new b2VoronoiDiagram.Task(r,n-1,a-this.m_countX,o)),r<this.m_countX-1&&i.Push(new b2VoronoiDiagram.Task(r+1,n,a+1,o)),n<this.m_countY-1&&i.Push(new b2VoronoiDiagram.Task(r,n+1,a+this.m_countX,o)));}for(n=0;n<this.m_countY;n++)for(r=0;r<this.m_countX-1;r++){a=r+n*this.m_countX;(c=this.m_diagram[a])!==(l=this.m_diagram[a+1])&&(i.Push(new b2VoronoiDiagram.Task(r,n,a,l)),i.Push(new b2VoronoiDiagram.Task(r+1,n,a+1,c)));}for(n=0;n<this.m_countY-1;n++)for(r=0;r<this.m_countX;r++){a=r+n*this.m_countX;(c=this.m_diagram[a])!==(l=this.m_diagram[a+this.m_countX])&&(i.Push(new b2VoronoiDiagram.Task(r,n,a,l)),i.Push(new b2VoronoiDiagram.Task(r,n+1,a+this.m_countX,c)));}for(;!i.Empty();){var s;r=(s=i.Front()).m_x;n=s.m_y;a=s.m_i;e=s.m_generator;var c;var l;var p,m,v;i.Pop(),(c=this.m_diagram[a])!==(l=e)&&(p=c.center.x-r,m=c.center.y-n,(v=l.center.x-r)*v+(v=l.center.y-n)*v<p*p+m*m&&(this.m_diagram[a]=l,0<r&&i.Push(new b2VoronoiDiagram.Task(r-1,n,a-1,l)),0<n&&i.Push(new b2VoronoiDiagram.Task(r,n-1,a-this.m_countX,l)),r<this.m_countX-1&&i.Push(new b2VoronoiDiagram.Task(r+1,n,a+1,l)),n<this.m_countY-1&&i.Push(new b2VoronoiDiagram.Task(r,n+1,a+this.m_countX,l))));}},b2VoronoiDiagram.prototype.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var r=i+e*this.m_countX;var n=this.m_diagram[r];var a=this.m_diagram[r+1];var o=this.m_diagram[r+this.m_countX];r=this.m_diagram[r+1+this.m_countX];a!==o&&(n!==a&&n!==o&&(n.necessary||a.necessary||o.necessary)&&t(n.tag,a.tag,o.tag),r!==a&&r!==o&&(n.necessary||a.necessary||o.necessary)&&t(a.tag,r.tag,o.tag));}};var Tr=b2VoronoiDiagram;function b2VoronoiDiagram(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=b2MakeArray(t,function(t){return new b2VoronoiDiagram.Generator();}),this.m_generatorCapacity=t;}function std_iter_swap(t,e,i){var r=t[e];t[e]=t[i],t[i]=r;}function default_compare(t,e){return t<e;}function std_sort(t,e,i,r){void 0===e&&(e=0),void 0===i&&(i=t.length-e),void 0===r&&(r=default_compare);var n=e;var a=[];var o=0;for(;;){for(;n+1<i;i++){var s=t[n+Math.floor(Math.random()*(i-n))];a[o++]=i;for(var c=n-1;;){for(;r(t[++c],s););for(;r(s,t[--i]););if(i<=c)break;std_iter_swap(t,c,i);}}if(0===o)break;n=i,i=a[--o];}return t;}function std_stable_sort(t,e,i,r){return std_sort(t,e=void 0===e?0:e,i=void 0===i?t.length-e:i,r=void 0===r?default_compare:r);}function std_remove_if(t,e,i){void 0===i&&(i=t.length);var r=0;for(var n=0;n<i;++n)e(t[n])||(n!==r?std_iter_swap(t,r++,n):++r);return r;}function std_lower_bound(t,e,i,r,n){void 0===n&&(n=default_compare);var a=i-e;for(;0<a;){var o=Math.floor(a/2);var s=e+o;n(t[s],r)?(e=++s,a-=o+1):a=o;}return e;}function std_upper_bound(t,e,i,r,n){void 0===n&&(n=default_compare);var a=i-e;for(;0<a;){var o=Math.floor(a/2);var s=e+o;n(r,t[s])?a=o:(e=++s,a-=o+1);}return e;}function std_rotate(t,e,i,r){var n=i;for(;e!==n;)std_iter_swap(t,e++,n++),n===r?n=i:e===i&&(i=n);}(Lr=Tr=b2VoronoiDiagram||{}).Generator=function(){this.center=new j(),this.tag=0,this.necessary=!1;},Lr.Task=function(t,e,i,r){this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=r;};b2GrowableBuffer.prototype.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++;},b2GrowableBuffer.prototype.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t;}},b2GrowableBuffer.prototype.Grow=function(){var t=this.capacity?2*this.capacity:256;this.Reserve(t);},b2GrowableBuffer.prototype.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0);},b2GrowableBuffer.prototype.Shorten=function(t){},b2GrowableBuffer.prototype.Data=function(){return this.data;},b2GrowableBuffer.prototype.GetCount=function(){return this.count;},b2GrowableBuffer.prototype.SetCount=function(t){this.count=t;},b2GrowableBuffer.prototype.GetCapacity=function(){return this.capacity;},b2GrowableBuffer.prototype.RemoveIf=function(t){this.count=std_remove_if(this.data,t,this.count);},b2GrowableBuffer.prototype.Unique=function(t){this.count=function(t,e,i,r){if(e===i)return i;var n=e;for(;++e!==i;)r(t[n],t[e])||std_iter_swap(t,++n,e);return++n;}(this.data,0,this.count,t);};var wr=b2GrowableBuffer;function b2GrowableBuffer(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t;}__extends(b2FixtureParticleQueryCallback,Pr=ar),b2FixtureParticleQueryCallback.prototype.ShouldQueryParticleSystem=function(t){return!1;},b2FixtureParticleQueryCallback.prototype.ReportFixture=function(t){if(t.IsSensor())return!0;var e=t.GetShape().GetChildCount();for(var i=0;i<e;i++){var r=t.GetAABB(i);var n=this.m_system.GetInsideBoundsEnumerator(r);var a;for(;0<=(a=n.GetNext());)this.ReportFixtureAndParticle(t,i,a);}return!0;},b2FixtureParticleQueryCallback.prototype.ReportParticle=function(t,e){return!1;},b2FixtureParticleQueryCallback.prototype.ReportFixtureAndParticle=function(t,e,i){};var Er=b2FixtureParticleQueryCallback;function b2FixtureParticleQueryCallback(t){var e=Pr.call(this)||this;return e.m_system=t,e;}var Pr;b2ParticleContact.prototype.SetIndices=function(t,e){this.indexA=t,this.indexB=e;},b2ParticleContact.prototype.SetWeight=function(t){this.weight=t;},b2ParticleContact.prototype.SetNormal=function(t){this.normal.Copy(t);},b2ParticleContact.prototype.SetFlags=function(t){this.flags=t;},b2ParticleContact.prototype.GetIndexA=function(){return this.indexA;},b2ParticleContact.prototype.GetIndexB=function(){return this.indexB;},b2ParticleContact.prototype.GetWeight=function(){return this.weight;},b2ParticleContact.prototype.GetNormal=function(){return this.normal;},b2ParticleContact.prototype.GetFlags=function(){return this.flags;},b2ParticleContact.prototype.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y;},b2ParticleContact.prototype.IsNotEqual=function(t){return!this.IsEqual(t);},b2ParticleContact.prototype.ApproximatelyEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&D(this.weight-t.weight)<.01&&j.DistanceSquaredVV(this.normal,t.normal)<1e-4;};var Mr=b2ParticleContact;function b2ParticleContact(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new j(),this.flags=0;}var Rr=function(){this.index=0,this.weight=0,this.normal=new j(),this.mass=0;};var Ir=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0;};var Br=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new j(0,0),this.pb=new j(0,0),this.pc=new j(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0;};b2ParticleSystemDef.prototype.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this;},b2ParticleSystemDef.prototype.Clone=function(){return new b2ParticleSystemDef().Copy(this);};var Dr=b2ParticleSystemDef;function b2ParticleSystemDef(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60;}function b2ParticleSystem(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_flagsBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_positionBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_velocityBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_groupBuffer=[],this.m_userDataBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_bodyContactCountBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_consecutiveContactStepsBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_stuckParticleBuffer=new wr(function(){return 0;}),this.m_proxyBuffer=new wr(function(){return new b2ParticleSystem.Proxy();}),this.m_contactBuffer=new wr(function(){return new Mr();}),this.m_bodyContactBuffer=new wr(function(){return new Rr();}),this.m_pairBuffer=new wr(function(){return new Ir();}),this.m_triadBuffer=new wr(function(){return new Br();}),this.m_expirationTimeBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_indexByExpirationTimeBuffer=new b2ParticleSystem.UserOverridableBuffer(),this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Dr(),this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge);}H.b2ParticleSystem=(b2ParticleSystem.computeTag=function(t,e){return(e+b2ParticleSystem.yOffset>>>0<<b2ParticleSystem.yShift)+(b2ParticleSystem.xScale*t+b2ParticleSystem.xOffset>>>0)>>>0;},b2ParticleSystem.computeRelativeTag=function(t,e,i){return t+(i<<b2ParticleSystem.yShift)+(e<<b2ParticleSystem.xShift)>>>0;},b2ParticleSystem.prototype.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity);},b2ParticleSystem.prototype.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error();if(this.m_count>=this.m_internalAllocatedCapacity&&(e=this.m_count?2*this.m_count:256,this.ReallocateInternalAllocatedBuffers(e)),this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return-1;this.DestroyOldestParticle(0,!1),this.SolveZombie();}var e=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error();if(this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new j()).Copy(b2Maybe(t.position,j.ZERO)),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new j()).Copy(b2Maybe(t.velocity,j.ZERO)),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new j()).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0);var i=new C().Copy(b2Maybe(t.color,C.ZERO));!this.m_colorBuffer.data&&i.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new C()).Copy(i)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);i=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()];var r=b2Maybe(t.lifetime,0);var n=0<r;if(this.m_expirationTimeBuffer.data||n){if(this.SetParticleLifetime(e,n?r:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error();this.m_indexByExpirationTimeBuffer.data[e]=e;}i.index=e;n=b2Maybe(t.group,null);return(this.m_groupBuffer[e]=n)&&(n.m_firstIndex<n.m_lastIndex?this.RotateBuffer(n.m_firstIndex,n.m_lastIndex,e):n.m_firstIndex=e,n.m_lastIndex=1+e),this.SetParticleFlags(e,b2Maybe(t.flags,0)),e;},b2ParticleSystem.prototype.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Cr()).SetIndex(t),this.m_handleIndexBuffer.data[t]=e);},b2ParticleSystem.prototype.DestroyParticle=function(t,e){if(void 0===e&&(e=!1),!this.m_flagsBuffer.data)throw new Error();var i=H.b2ParticleFlag.b2_zombieParticle;e&&(i|=H.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i);},b2ParticleSystem.prototype.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error();if(!this.m_expirationTimeBuffer.data)throw new Error();i=this.m_indexByExpirationTimeBuffer.data[i-(t+1)];t=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(0<this.m_expirationTimeBuffer.data[i]?i:t,e);},b2ParticleSystem.prototype.DestroyParticlesInShape=function(t,e,i){void 0===i&&(i=!1);var r=b2ParticleSystem.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error();i=new b2ParticleSystem.DestroyParticlesInShapeCallback(this,t,e,i);return t.ComputeAABB(r,e,0),this.m_world.QueryAABB(i,r),i.Destroyed();},b2ParticleSystem.prototype.CreateParticleGroup=function(t){var e=b2ParticleSystem.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error();var i=e;i.SetPositionAngle(b2Maybe(t.position,j.ZERO),b2Maybe(t.angle,0));e=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,b2Maybe(t.shapeCount,t.shapes.length),t,i),t.positionData){var r=b2Maybe(t.particleCount,t.positionData.length);for(var n=0;n<r;n++){var a=t.positionData[n];this.CreateParticleForGroup(t,i,a);}}var o=this.m_count;var s=new Ar(this);s.m_firstIndex=e,s.m_lastIndex=o,s.m_strength=b2Maybe(t.strength,1),s.m_userData=t.userData,s.m_transform.Copy(i),s.m_prev=null,s.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=s),this.m_groupList=s,++this.m_groupCount;for(n=e;n<o;n++)this.m_groupBuffer[n]=s;this.SetGroupFlags(s,b2Maybe(t.groupFlags,0));var c=new b2ParticleSystem.ConnectionFilter();return this.UpdateContacts(!0),this.UpdatePairsAndTriads(e,o,c),t.group&&(this.JoinParticleGroups(t.group,s),s=t.group),s;},b2ParticleSystem.prototype.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error();this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new b2ParticleSystem.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var r=e.m_firstIndex;r<e.m_lastIndex;r++)this.m_groupBuffer[r]=t;i=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,i),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e);},b2ParticleSystem.prototype.SplitParticleGroup=function(t){this.UpdateContacts(!0);var e=b2MakeArray(t.GetParticleCount(),function(t){return new b2ParticleSystem.ParticleListNode();});b2ParticleSystem.InitializeParticleLists(t,e),this.MergeParticleListsInContact(t,e);var i=b2ParticleSystem.FindLongestParticleList(t,e);this.MergeZombieParticleListNodes(t,e,i),this.CreateParticleGroupsFromParticleList(t,e,i),this.UpdatePairsAndTriadsWithParticleList(t,e);},b2ParticleSystem.prototype.GetParticleGroupList=function(){return this.m_groupList;},b2ParticleSystem.prototype.GetParticleGroupCount=function(){return this.m_groupCount;},b2ParticleSystem.prototype.GetParticleCount=function(){return this.m_count;},b2ParticleSystem.prototype.GetMaxParticleCount=function(){return this.m_def.maxCount;},b2ParticleSystem.prototype.SetMaxParticleCount=function(t){this.m_def.maxCount=t;},b2ParticleSystem.prototype.GetAllParticleFlags=function(){return this.m_allParticleFlags;},b2ParticleSystem.prototype.GetAllGroupFlags=function(){return this.m_allGroupFlags;},b2ParticleSystem.prototype.SetPaused=function(t){this.m_paused=t;},b2ParticleSystem.prototype.GetPaused=function(){return this.m_paused;},b2ParticleSystem.prototype.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density;},b2ParticleSystem.prototype.GetDensity=function(){return this.m_def.density;},b2ParticleSystem.prototype.SetGravityScale=function(t){this.m_def.gravityScale=t;},b2ParticleSystem.prototype.GetGravityScale=function(){return this.m_def.gravityScale;},b2ParticleSystem.prototype.SetDamping=function(t){this.m_def.dampingStrength=t;},b2ParticleSystem.prototype.GetDamping=function(){return this.m_def.dampingStrength;},b2ParticleSystem.prototype.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t;},b2ParticleSystem.prototype.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations;},b2ParticleSystem.prototype.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter;},b2ParticleSystem.prototype.GetRadius=function(){return this.m_particleDiameter/2;},b2ParticleSystem.prototype.GetPositionBuffer=function(){if(!this.m_positionBuffer.data)throw new Error();return this.m_positionBuffer.data;},b2ParticleSystem.prototype.GetVelocityBuffer=function(){if(!this.m_velocityBuffer.data)throw new Error();return this.m_velocityBuffer.data;},b2ParticleSystem.prototype.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data;},b2ParticleSystem.prototype.GetGroupBuffer=function(){return this.m_groupBuffer;},b2ParticleSystem.prototype.GetWeightBuffer=function(){return this.m_weightBuffer;},b2ParticleSystem.prototype.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data;},b2ParticleSystem.prototype.GetFlagsBuffer=function(){if(!this.m_flagsBuffer.data)throw new Error();return this.m_flagsBuffer.data;},b2ParticleSystem.prototype.SetParticleFlags=function(t,e){if(!this.m_flagsBuffer.data)throw new Error();this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&H.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&H.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e;},b2ParticleSystem.prototype.GetParticleFlags=function(t){if(!this.m_flagsBuffer.data)throw new Error();return this.m_flagsBuffer.data[t];},b2ParticleSystem.prototype.SetFlagsBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e);},b2ParticleSystem.prototype.SetPositionBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e);},b2ParticleSystem.prototype.SetVelocityBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e);},b2ParticleSystem.prototype.SetColorBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e);},b2ParticleSystem.prototype.SetUserDataBuffer=function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e);},b2ParticleSystem.prototype.GetContacts=function(){return this.m_contactBuffer.data;},b2ParticleSystem.prototype.GetContactCount=function(){return this.m_contactBuffer.count;},b2ParticleSystem.prototype.GetBodyContacts=function(){return this.m_bodyContactBuffer.data;},b2ParticleSystem.prototype.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count;},b2ParticleSystem.prototype.GetPairs=function(){return this.m_pairBuffer.data;},b2ParticleSystem.prototype.GetPairCount=function(){return this.m_pairBuffer.count;},b2ParticleSystem.prototype.GetTriads=function(){return this.m_triadBuffer.data;},b2ParticleSystem.prototype.GetTriadCount=function(){return this.m_triadBuffer.count;},b2ParticleSystem.prototype.SetStuckThreshold=function(t){0<(this.m_stuckThreshold=t)&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data));},b2ParticleSystem.prototype.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data();},b2ParticleSystem.prototype.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount();},b2ParticleSystem.prototype.ComputeCollisionEnergy=function(){if(!this.m_velocityBuffer.data)throw new Error();var t=b2ParticleSystem.ComputeCollisionEnergy_s_v;var e=this.m_velocityBuffer.data;var i=0;for(var r=0;r<this.m_contactBuffer.count;r++){var n=this.m_contactBuffer.data[r];var a=n.indexA;var o=n.indexB;n=n.normal;o=j.SubVV(e[o],e[a],t);a=j.DotVV(o,n);a<0&&(i+=a*a);}return .5*this.GetParticleMass()*i;},b2ParticleSystem.prototype.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t;},b2ParticleSystem.prototype.GetStrictContactCheck=function(){return this.m_def.strictContactCheck;},b2ParticleSystem.prototype.SetParticleLifetime=function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i){var r=this.GetParticleCount();for(var n=0;n<r;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;}i=e/this.m_def.lifetimeGranularity;e=0<i?this.GetQuantizedTimeElapsed()+i:i;e!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=e,this.m_expirationTimeBufferRequiresSorting=!0);},b2ParticleSystem.prototype.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t]);},b2ParticleSystem.prototype.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t;},b2ParticleSystem.prototype.GetDestructionByAge=function(){return this.m_def.destroyByAge;},b2ParticleSystem.prototype.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data;},b2ParticleSystem.prototype.ExpirationTimeToLifetime=function(t){return(0<t?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity;},b2ParticleSystem.prototype.GetIndexByExpirationTimeBuffer=function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error();return this.m_indexByExpirationTimeBuffer.data;},b2ParticleSystem.prototype.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e);},b2ParticleSystem.prototype.ApplyLinearImpulse=function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error();var r=this.m_velocityBuffer.data;var n=(e-t)*this.GetParticleMass();var a=new j().Copy(i).SelfMul(1/n);for(var o=t;o<e;o++)r[o].SelfAdd(a);},b2ParticleSystem.IsSignificantForce=function(t){return 0!==t.x||0!==t.y;},b2ParticleSystem.prototype.ParticleApplyForce=function(t,e){if(!this.m_flagsBuffer.data)throw new Error();b2ParticleSystem.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e));},b2ParticleSystem.prototype.ApplyForce=function(t,e,i){var r=new j().Copy(i).SelfMul(1/(e-t));if(b2ParticleSystem.IsSignificantForce(r)){this.PrepareForceBuffer();for(var n=t;n<e;n++)this.m_forceBuffer[n].SelfAdd(r);}},b2ParticleSystem.prototype.GetNext=function(){return this.m_next;},b2ParticleSystem.prototype.QueryAABB=function(t,e){if(0!==this.m_proxyBuffer.count){var i=this.m_proxyBuffer.count;var r=std_lower_bound(this.m_proxyBuffer.data,0,i,b2ParticleSystem.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),b2ParticleSystem.Proxy.CompareProxyTag);var n=std_upper_bound(this.m_proxyBuffer.data,r,i,b2ParticleSystem.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),b2ParticleSystem.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error();var a=this.m_positionBuffer.data;for(var o=r;o<n;++o){var s=this.m_proxyBuffer.data[o].index;var c=a[s];if(e.lowerBound.x<c.x&&c.x<e.upperBound.x&&e.lowerBound.y<c.y&&c.y<e.upperBound.y&&!t.ReportParticle(this,s))break;}}},b2ParticleSystem.prototype.QueryShapeAABB=function(t,e,i,r){var n=b2ParticleSystem.QueryShapeAABB_s_aabb;e.ComputeAABB(n,i,r=void 0===r?0:r),this.QueryAABB(t,n);},b2ParticleSystem.prototype.QueryPointAABB=function(t,e,i){var r=b2ParticleSystem.QueryPointAABB_s_aabb;r.lowerBound.Set(e.x-(i=void 0===i?M:i),e.y-i),r.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,r);},b2ParticleSystem.prototype.RayCast=function(h,t,e){var i=b2ParticleSystem.RayCast_s_aabb;var u=b2ParticleSystem.RayCast_s_p;var _=b2ParticleSystem.RayCast_s_v;var d=b2ParticleSystem.RayCast_s_n;var f=b2ParticleSystem.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error();var p=this.m_positionBuffer.data;j.MinV(t,e,i.lowerBound),j.MaxV(t,e,i.upperBound);var r=1;var n=j.SubVV(e,t,_);var a=j.DotVV(n,n);var m=this.GetInsideBoundsEnumerator(i);var v;for(;0<=(v=m.GetNext());){var o=j.SubVV(t,p[v],u);var s=j.DotVV(o,n);var c=s*s-a*(j.DotVV(o,o)-this.m_squaredDiameter);if(0<=c){c=X(c);var l=(-s-c)/a;if(!(r<l)&&!(l<0&&((l=(-s+c)/a)<0||r<l))){s=j.AddVMulSV(o,l,n,d);s.Normalize();c=h.ReportParticle(this,v,j.AddVMulSV(t,l,n,f),s,l);if((r=L(r,c))<=0)break;}}}}},b2ParticleSystem.prototype.ComputeAABB=function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+B,t.lowerBound.y=+B,t.upperBound.x=-B,t.upperBound.y=-B,!this.m_positionBuffer.data)throw new Error();var i=this.m_positionBuffer.data;for(var r=0;r<e;r++){var n=i[r];j.MinV(t.lowerBound,n,t.lowerBound),j.MaxV(t.upperBound,n,t.upperBound);}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter;},b2ParticleSystem.prototype.FreeBuffer=function(t,e){null!==t&&(t.length=0);},b2ParticleSystem.prototype.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity);},b2ParticleSystem.prototype.ReallocateBuffer3=function(t,e,i){if(i<=e)throw new Error();e=t?t.slice():[];return e.length=i,e;},b2ParticleSystem.prototype.ReallocateBuffer5=function(t,e,i,r,n){if(r<=i)throw new Error();if(e&&!(r<=e))throw new Error();return t=n&&!t||e?t:this.ReallocateBuffer3(t,i,r);},b2ParticleSystem.prototype.ReallocateBuffer4=function(t,e,i,r){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,r);},b2ParticleSystem.prototype.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),(t=[]).length=this.m_internalAllocatedCapacity),t;},b2ParticleSystem.prototype.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0);},b2ParticleSystem.prototype.ReallocateInternalAllocatedBuffers=function(t){function LimitCapacity(t,e){return e&&e<t?e:t;}var e;t=LimitCapacity(t,this.m_def.maxCount),t=LimitCapacity(t,this.m_flagsBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_positionBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_velocityBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_colorBuffer.userSuppliedCapacity),t=LimitCapacity(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t&&(this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1),e=0<this.m_stuckThreshold,this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,e),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,e),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,e),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t);},b2ParticleSystem.prototype.CreateParticleForGroup=function(t,e,i){var r=new br();r.flags=b2Maybe(t.flags,0),I.MulXV(e,i,r.position),j.AddVV(b2Maybe(t.linearVelocity,j.ZERO),j.CrossSV(b2Maybe(t.angularVelocity,0),j.SubVV(r.position,b2Maybe(t.position,j.ZERO),j.s_t0),j.s_t0),r.velocity),r.color.Copy(b2Maybe(t.color,C.ZERO)),r.lifetime=b2Maybe(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r);},b2ParticleSystem.prototype.CreateParticlesStrokeShapeForGroup=function(t,e,i){var r=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge;var h=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d;var u=b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p;var n=b2Maybe(e.stride,0);0===n&&(n=this.GetParticleStride());var a=0;var _=t.GetChildCount();for(var o=0;o<_;o++){var s=null;t.GetType()===H.b2ShapeType.e_edgeShape?s=t:t.GetChildEdge(s=r,o);var c=j.SubVV(s.m_vertex2,s.m_vertex1,h);var l=c.Length();for(;a<l;){var d=j.AddVMulSV(s.m_vertex1,a/l,c,u);this.CreateParticleForGroup(e,i,d),a+=n;}a-=l;}},b2ParticleSystem.prototype.CreateParticlesFillShapeForGroup=function(t,e,i){var r=b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb;var h=b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p;var n=b2Maybe(e.stride,0);0===n&&(n=this.GetParticleStride());var a=I.IDENTITY;var o=r;t.ComputeAABB(o,a,0);for(var s=Math.floor(o.lowerBound.y/n)*n;s<o.upperBound.y;s+=n)for(var c=Math.floor(o.lowerBound.x/n)*n;c<o.upperBound.x;c+=n){var l=h.Set(c,s);t.TestPoint(a,l)&&this.CreateParticleForGroup(e,i,l);}},b2ParticleSystem.prototype.CreateParticlesWithShapeForGroup=function(t,e,i){switch(t.GetType()){case H.b2ShapeType.e_edgeShape:case H.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case H.b2ShapeType.e_polygonShape:case H.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i);}},b2ParticleSystem.prototype.CreateParticlesWithShapesForGroup=function(t,e,i,r){t=new b2ParticleSystem.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(t,i,r);},b2ParticleSystem.prototype.CloneParticle=function(t,e){var i=new br();if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;e=this.CreateParticle(i);return this.m_handleIndexBuffer.data&&((i=this.m_handleIndexBuffer.data[t])&&i.SetIndex(e),this.m_handleIndexBuffer.data[e]=i,this.m_handleIndexBuffer.data[t]=null),this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[t]),e;},b2ParticleSystem.prototype.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e);},b2ParticleSystem.prototype.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount;},b2ParticleSystem.ParticleCanBeConnected=function(t,e){return 0!=(t&(H.b2ParticleFlag.b2_wallParticle|H.b2ParticleFlag.b2_springParticle|H.b2ParticleFlag.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&H.b2ParticleGroupFlag.b2_rigidParticleGroup);},b2ParticleSystem.prototype.UpdatePairsAndTriads=function(t,e,m){var g=b2ParticleSystem.UpdatePairsAndTriads_s_dab;var b=b2ParticleSystem.UpdatePairsAndTriads_s_dbc;var C=b2ParticleSystem.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var v=this.m_positionBuffer.data;var i=0;for(var r=t;r<e;r++)i|=this.m_flagsBuffer.data[r];if(i&b2ParticleSystem.k_pairFlags)for(var s=0;s<this.m_contactBuffer.count;s++){var c=this.m_contactBuffer.data[s];var n=c.indexA;var a=c.indexB;var o=this.m_flagsBuffer.data[n];var l=this.m_flagsBuffer.data[a];var h=this.m_groupBuffer[n];var u=this.m_groupBuffer[a];t<=n&&n<e&&t<=a&&a<e&&!((o|l)&H.b2ParticleFlag.b2_zombieParticle)&&(o|l)&b2ParticleSystem.k_pairFlags&&(m.IsNecessary(n)||m.IsNecessary(a))&&b2ParticleSystem.ParticleCanBeConnected(o,h)&&b2ParticleSystem.ParticleCanBeConnected(l,u)&&m.ShouldCreatePair(n,a)&&((o=this.m_pairBuffer.data[this.m_pairBuffer.Append()]).indexA=n,o.indexB=a,o.flags=c.flags,o.strength=L(h?h.m_strength:1,u?u.m_strength:1),o.distance=j.DistanceVV(v[n],v[a])),std_stable_sort(this.m_pairBuffer.data,0,this.m_pairBuffer.count,b2ParticleSystem.ComparePairIndices),this.m_pairBuffer.Unique(b2ParticleSystem.MatchPairIndices);}if(i&b2ParticleSystem.k_triadFlags){var _=new Tr(e-t);for(r=t;r<e;r++){var d=this.m_flagsBuffer.data[r];var f=this.m_groupBuffer[r];d&H.b2ParticleFlag.b2_zombieParticle||!b2ParticleSystem.ParticleCanBeConnected(d,f)||_.AddGenerator(v[r],r,m.IsNecessary(r));}var p=this.GetParticleStride();_.Generate(p/2,2*p);var y=this;_.GetNodes(function(t,e,i){if(!y.m_flagsBuffer.data)throw new Error();var h=y.m_flagsBuffer.data[t];var u=y.m_flagsBuffer.data[e];var _=y.m_flagsBuffer.data[i];var r,n,a,o,s,d,c,f,p,l;(h|u|_)&b2ParticleSystem.k_triadFlags&&m.ShouldCreateTriad(t,e,i)&&(r=v[t],n=v[e],a=v[i],o=j.SubVV(r,n,g),s=j.SubVV(n,a,b),d=j.SubVV(a,r,C),c=4*y.m_squaredDiameter,j.DotVV(o,o)>c||j.DotVV(s,s)>c||j.DotVV(d,d)>c||(c=y.m_groupBuffer[t],f=y.m_groupBuffer[e],p=y.m_groupBuffer[i],(l=y.m_triadBuffer.data[y.m_triadBuffer.Append()]).indexA=t,l.indexB=e,l.indexC=i,l.flags=h|u|_,l.strength=L(L(c?c.m_strength:1,f?f.m_strength:1),p?p.m_strength:1),t=(r.x+n.x+a.x)/3,e=(r.y+n.y+a.y)/3,l.pa.x=r.x-t,l.pa.y=r.y-e,l.pb.x=n.x-t,l.pb.y=n.y-e,l.pc.x=a.x-t,l.pc.y=a.y-e,l.ka=-j.DotVV(d,o),l.kb=-j.DotVV(o,s),l.kc=-j.DotVV(s,d),l.s=j.CrossVV(r,n)+j.CrossVV(n,a)+j.CrossVV(a,r)));}),std_stable_sort(this.m_triadBuffer.data,0,this.m_triadBuffer.count,b2ParticleSystem.CompareTriadIndices),this.m_triadBuffer.Unique(b2ParticleSystem.MatchTriadIndices);}},b2ParticleSystem.prototype.UpdatePairsAndTriadsWithReactiveParticles=function(){var t=new b2ParticleSystem.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,t),!this.m_flagsBuffer.data)throw new Error();for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=~H.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~H.b2ParticleFlag.b2_reactiveParticle;},b2ParticleSystem.ComparePairIndices=function(t,e){var i=t.indexA-e.indexA;return 0!=i?i<0:t.indexB<e.indexB;},b2ParticleSystem.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB;},b2ParticleSystem.CompareTriadIndices=function(t,e){var i=t.indexA-e.indexA;if(0!=i)return i<0;i=t.indexB-e.indexB;return 0!=i?i<0:t.indexC<e.indexC;},b2ParticleSystem.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC;},b2ParticleSystem.InitializeParticleLists=function(t,e){var i=t.GetBufferIndex();var r=t.GetParticleCount();for(var n=0;n<r;n++){var a=e[n];(a.list=a).next=null,a.count=1,a.index=n+i;}},b2ParticleSystem.prototype.MergeParticleListsInContact=function(t,e){var i=t.GetBufferIndex();for(var r=0;r<this.m_contactBuffer.count;r++){var n=this.m_contactBuffer.data[r];var a=n.indexA;n=n.indexB;var o;t.ContainsParticle(a)&&t.ContainsParticle(n)&&(a=e[a-i].list)!==(n=e[n-i].list)&&(a.count<n.count&&(o=a,a=n,n=o),b2ParticleSystem.MergeParticleLists(a,n));}},b2ParticleSystem.MergeParticleLists=function(t,e){for(var i=e;;){i.list=t;var r=i.next;if(!r){i.next=t.next;break;}i=r;}t.next=e,t.count+=e.count,e.count=0;},b2ParticleSystem.FindLongestParticleList=function(t,e){var i=t.GetParticleCount();var r=e[0];for(var n=0;n<i;n++){var a=e[n];r.count<a.count&&(r=a);}return r;},b2ParticleSystem.prototype.MergeZombieParticleListNodes=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error();var r=t.GetParticleCount();for(var n=0;n<r;n++){var a=e[n];a!==i&&this.m_flagsBuffer.data[a.index]&H.b2ParticleFlag.b2_zombieParticle&&b2ParticleSystem.MergeParticleListAndNode(i,a);}},b2ParticleSystem.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0;},b2ParticleSystem.prototype.CreateParticleGroupsFromParticleList=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error();var r=t.GetParticleCount();var n=new xr();n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var a=0;a<r;a++){var o=e[a];if(o.count&&o!==i){var s=this.CreateParticleGroup(n);for(var c=o;c;c=c.next){var l=c.index;var h=this.CloneParticle(l,s);this.m_flagsBuffer.data[l]|=H.b2ParticleFlag.b2_zombieParticle,c.index=h;}}}},b2ParticleSystem.prototype.UpdatePairsAndTriadsWithParticleList=function(t,e){var i=t.GetBufferIndex();for(var r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r];var a=n.indexA;var o=n.indexB;t.ContainsParticle(a)&&(n.indexA=e[a-i].index),t.ContainsParticle(o)&&(n.indexB=e[o-i].index);}for(r=0;r<this.m_triadBuffer.count;r++){var s=this.m_triadBuffer.data[r];a=s.indexA;o=s.indexB;var c=s.indexC;t.ContainsParticle(a)&&(s.indexA=e[a-i].index),t.ContainsParticle(o)&&(s.indexB=e[o-i].index),t.ContainsParticle(c)&&(s.indexC=e[c-i].index);}},b2ParticleSystem.prototype.ComputeDepth=function(){var h=[];var u=0;for(var t=0;t<this.m_contactBuffer.count;t++){var e=(s=this.m_contactBuffer.data[t]).indexA;var i=s.indexB;var _=this.m_groupBuffer[e];var d=this.m_groupBuffer[i];_&&_===d&&_.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(h[u++]=s);}var f=[];var p=0;for(var r=this.m_groupList;r;r=r.GetNext())if(r.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){f[p++]=r,this.SetGroupFlags(r,r.m_groupFlags&~H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var n=r.m_firstIndex;n<r.m_lastIndex;n++)this.m_accumulationBuffer[n]=0;}for(t=0;t<u;t++){e=(s=h[t]).indexA;i=s.indexB;var a=s.weight;this.m_accumulationBuffer[e]+=a,this.m_accumulationBuffer[i]+=a;}for(n=0;n<p;n++)for(var o=(r=f[n]).m_firstIndex;o<r.m_lastIndex;o++){a=this.m_accumulationBuffer[o];this.m_depthBuffer[o]=a<.8?0:B;}var m=X(this.m_count)>>0;for(var v=0;v<m;v++){var y=!1;for(t=0;t<u;t++){var s;e=(s=h[t]).indexA;i=s.indexB;var c=1-s.weight;var g=this.m_depthBuffer[e];var b=this.m_depthBuffer[i];var C=b+c;c=g+c;C<g&&(this.m_depthBuffer[e]=C,y=!0),c<b&&(this.m_depthBuffer[i]=c,y=!0);}if(!y)break;}for(n=0;n<p;n++)for(var l=(r=f[n]).m_firstIndex;l<r.m_lastIndex;l++)this.m_depthBuffer[l]<B?this.m_depthBuffer[l]*=this.m_particleDiameter:this.m_depthBuffer[l]=0;},b2ParticleSystem.prototype.GetInsideBoundsEnumerator=function(t){var e=b2ParticleSystem.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1);t=b2ParticleSystem.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1);var i=this.m_proxyBuffer.count;var r=std_lower_bound(this.m_proxyBuffer.data,0,i,e,b2ParticleSystem.Proxy.CompareProxyTag);i=std_upper_bound(this.m_proxyBuffer.data,0,i,t,b2ParticleSystem.Proxy.CompareTagProxy);return new b2ParticleSystem.InsideBoundsEnumerator(this,e,t,r,i);},b2ParticleSystem.prototype.UpdateAllParticleFlags=function(){if(!this.m_flagsBuffer.data)throw new Error();for(var t=this.m_allParticleFlags=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1;},b2ParticleSystem.prototype.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1;},b2ParticleSystem.prototype.AddContact=function(t,e,i){if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();var r=b2ParticleSystem.AddContact_s_d;var n=this.m_positionBuffer.data;n=j.SubVV(n[e],n[t],r);r=j.DotVV(n,n);var a,o;r<this.m_squaredDiameter&&(a=b2InvSqrt(r),isFinite(a)||(a=198177537e11),(o=this.m_contactBuffer.data[this.m_contactBuffer.Append()]).indexA=t,o.indexB=e,o.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],o.weight=1-r*a*this.m_inverseDiameter,j.MulSV(a,n,o.normal));},b2ParticleSystem.prototype.FindContacts_Reference=function(t){var e=this.m_proxyBuffer.count;for(var i=this.m_contactBuffer.count=0,r=0;i<e;i++){var n=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0);for(var a=i+1;a<e&&!(n<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);var o=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);for(;r<e&&!(o<=this.m_proxyBuffer.data[r].tag);r++);var s=b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1);for(a=r;a<e&&!(s<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);}},b2ParticleSystem.prototype.FindContacts=function(t){this.FindContacts_Reference(t);},b2ParticleSystem.prototype.UpdateProxies_Reference=function(t){if(!this.m_positionBuffer.data)throw new Error();var e=this.m_positionBuffer.data;var i=this.m_inverseDiameter;for(var r=0;r<this.m_proxyBuffer.count;++r){var n=this.m_proxyBuffer.data[r];var a=e[n.index];n.tag=b2ParticleSystem.computeTag(i*a.x,i*a.y);}},b2ParticleSystem.prototype.UpdateProxies=function(t){this.UpdateProxies_Reference(t);},b2ParticleSystem.prototype.SortProxies=function(t){std_sort(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,b2ParticleSystem.Proxy.CompareProxyProxy);},b2ParticleSystem.prototype.FilterContacts=function(t){var e=this.GetParticleContactFilter();var i;null!==e&&(i=this).m_contactBuffer.RemoveIf(function(t){return 0!=(t.flags&H.b2ParticleFlag.b2_particleContactFilterParticle)&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB);});},b2ParticleSystem.prototype.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error();},b2ParticleSystem.prototype.NotifyContactListenerPostContact=function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var r=this.m_contactBuffer.data[i];e.BeginContactParticleParticle(this,r);}throw new Error();}},b2ParticleSystem.b2ParticleContactIsZombie=function(t){return(t.flags&H.b2ParticleFlag.b2_zombieParticle)===H.b2ParticleFlag.b2_zombieParticle;},b2ParticleSystem.prototype.UpdateContacts=function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var e=new b2ParticleSystem.b2ParticlePairSet();this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(b2ParticleSystem.b2ParticleContactIsZombie);},b2ParticleSystem.prototype.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error();},b2ParticleSystem.prototype.NotifyBodyContactListenerPostContact=function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var r=this.m_bodyContactBuffer.data[i];e.BeginContactFixtureParticle(this,r);}throw new Error();}},b2ParticleSystem.prototype.UpdateBodyContacts=function(){var t=b2ParticleSystem.UpdateBodyContacts_s_aabb;var e=new b2ParticleSystem.FixtureParticleSet();if(this.NotifyBodyContactListenerPreContact(e),0<this.m_stuckThreshold){if(!this.m_bodyContactCountBuffer.data)throw new Error();if(!this.m_lastBodyContactStepBuffer.data)throw new Error();if(!this.m_consecutiveContactStepsBuffer.data)throw new Error();var i=this.GetParticleCount();for(var r=0;r<i;r++)this.m_bodyContactCountBuffer.data[r]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[r]+1&&(this.m_consecutiveContactStepsBuffer.data[r]=0);}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);this.ComputeAABB(t);var n=new b2ParticleSystem.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(n,t),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e);},b2ParticleSystem.prototype.Solve=function(t){var e=b2ParticleSystem.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&H.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var i=e.Copy(t);if(i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&H.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&H.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&b2ParticleSystem.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&H.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&H.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&H.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();for(var r=0;r<this.m_count;r++)this.m_positionBuffer.data[r].SelfMulAdd(i.dt,this.m_velocityBuffer.data[r]);}},b2ParticleSystem.prototype.SolveCollision=function(t){var e=b2ParticleSystem.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var i=this.m_positionBuffer.data;var r=this.m_velocityBuffer.data;var n=e;n.lowerBound.x=+B,n.lowerBound.y=+B,n.upperBound.x=-B,n.upperBound.y=-B;for(var a=0;a<this.m_count;a++){var o=r[a];var s=i[a];var c=s.x+t.dt*o.x;o=s.y+t.dt*o.y;n.lowerBound.x=L(n.lowerBound.x,L(s.x,c)),n.lowerBound.y=L(n.lowerBound.y,L(s.y,o)),n.upperBound.x=V(n.upperBound.x,V(s.x,c)),n.upperBound.y=V(n.upperBound.y,V(s.y,o));}e=new b2ParticleSystem.SolveCollisionCallback(this,t);this.m_world.QueryAABB(e,n);},b2ParticleSystem.prototype.LimitVelocity=function(t){if(!this.m_velocityBuffer.data)throw new Error();var e=this.m_velocityBuffer.data;var i=this.GetCriticalVelocitySquared(t);for(var r=0;r<this.m_count;r++){var n=e[r];var a=j.DotVV(n,n);i<a&&n.SelfMul(X(i/a));}},b2ParticleSystem.prototype.SolveGravity=function(t){if(!this.m_velocityBuffer.data)throw new Error();var e=b2ParticleSystem.SolveGravity_s_gravity;var i=this.m_velocityBuffer.data;var r=j.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(var n=0;n<this.m_count;n++)i[n].SelfAdd(r);},b2ParticleSystem.prototype.SolveBarrier=function(h){var u=b2ParticleSystem.SolveBarrier_s_aabb;var _=b2ParticleSystem.SolveBarrier_s_va;var d=b2ParticleSystem.SolveBarrier_s_vb;var f=b2ParticleSystem.SolveBarrier_s_pba;var p=b2ParticleSystem.SolveBarrier_s_vba;var m=b2ParticleSystem.SolveBarrier_s_vc;var v=b2ParticleSystem.SolveBarrier_s_pca;var y=b2ParticleSystem.SolveBarrier_s_vca;var g=b2ParticleSystem.SolveBarrier_s_qba;var b=b2ParticleSystem.SolveBarrier_s_qca;var C=b2ParticleSystem.SolveBarrier_s_dv;var x=b2ParticleSystem.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var A=this.m_positionBuffer.data;var S=this.m_velocityBuffer.data;for(var T=0;T<this.m_count;T++)0!=(this.m_flagsBuffer.data[T]&b2ParticleSystem.k_barrierWallFlags)&&S[T].SetZero();var w=2.5*h.dt;var E=this.GetParticleMass();for(var P=0;P<this.m_pairBuffer.count;P++){var t=this.m_pairBuffer.data[P];if(t.flags&H.b2ParticleFlag.b2_barrierParticle){var M=t.indexA;t=t.indexB;var R=A[M];var I=A[t];var B=u;j.MinV(R,I,B.lowerBound),j.MaxV(R,I,B.upperBound);var D=this.m_groupBuffer[M];var L=this.m_groupBuffer[t];var V=this.GetLinearVelocity(D,M,R,_);M=this.GetLinearVelocity(L,t,I,d);var O=j.SubVV(I,R,f);var e=j.SubVV(M,V,p);var F=this.GetInsideBoundsEnumerator(B);var N;for(;0<=(N=F.GetNext());){var k=A[N];var i=this.m_groupBuffer[N];if(D!==i&&L!==i){var G=this.GetLinearVelocity(i,N,k,m);var z=j.SubVV(k,R,v);var U=j.SubVV(G,V,y);var r=j.CrossVV(e,U);var n=j.CrossVV(O,U)-j.CrossVV(z,e);var a=j.CrossVV(O,z);var o=void 0,s=void 0;var c=g,W=b;if(0===r){if(0==n)continue;if(!(0<=(s=-a/n)&&s<w))continue;if(j.AddVMulSV(O,s,e,c),j.AddVMulSV(z,s,U,W),!(0<=(o=j.DotVV(c,W)/j.DotVV(c,c))&&o<=1))continue;}else{a=n*n-4*a*r;if(a<0)continue;a=X(a);var l=(-n-a)/(2*r);n=(-n+a)/(2*r);if(n<l&&(a=l,l=n,n=a),s=l,j.AddVMulSV(O,s,e,c),j.AddVMulSV(z,s,U,W),o=j.DotVV(c,W)/j.DotVV(c,c),!(0<=s&&s<w&&0<=o&&o<=1)){if(!(0<=(s=n)&&s<w))continue;if(j.AddVMulSV(O,s,e,c),j.AddVMulSV(z,s,U,W),!(0<=(o=j.DotVV(c,W)/j.DotVV(c,c))&&o<=1))continue;}}r=C;r.x=V.x+o*e.x-G.x,r.y=V.y+o*e.y-G.y;a=j.MulSV(E,r,x);i&&this.IsRigidGroup(i)?(l=i.GetMass(),n=i.GetInertia(),0<l&&i.m_linearVelocity.SelfMulAdd(1/l,a),0<n&&(i.m_angularVelocity+=j.CrossVV(j.SubVV(k,i.GetCenter(),j.s_t0),a)/n)):S[N].SelfAdd(r),this.ParticleApplyForce(N,a.SelfMul(-h.inv_dt));}}}}},b2ParticleSystem.prototype.SolveStaticPressure=function(t){if(!this.m_flagsBuffer.data)throw new Error();this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);t=this.GetCriticalPressure(t);var e=this.m_def.staticPressureStrength*t;var h=.25*t;var u=this.m_def.staticPressureRelaxation;for(var i=0;i<this.m_def.staticPressureIterations;i++){for(var r=0;r<this.m_count;r++)this.m_accumulationBuffer[r]=0;for(var n=0;n<this.m_contactBuffer.count;n++){var a=this.m_contactBuffer.data[n];var o,s;a.flags&H.b2ParticleFlag.b2_staticPressureParticle&&(o=a.indexA,s=a.indexB,c=a.weight,this.m_accumulationBuffer[o]+=c*this.m_staticPressureBuffer[s],this.m_accumulationBuffer[s]+=c*this.m_staticPressureBuffer[o]);}for(r=0;r<this.m_count;r++){var c=this.m_weightBuffer[r];var l;this.m_flagsBuffer.data[r]&H.b2ParticleFlag.b2_staticPressureParticle?(l=this.m_accumulationBuffer[r],this.m_staticPressureBuffer[r]=b2Clamp((l+e*(c-1))/(c+u),0,h)):this.m_staticPressureBuffer[r]=0;}}},b2ParticleSystem.prototype.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(t=0;t<this.m_bodyContactBuffer.count;t++){var e=(r=this.m_bodyContactBuffer.data[t]).index;var i=r.weight;this.m_weightBuffer[e]+=i;}for(t=0;t<this.m_contactBuffer.count;t++){var r;e=(r=this.m_contactBuffer.data[t]).indexA;var n=r.indexB;i=r.weight;this.m_weightBuffer[e]+=i,this.m_weightBuffer[n]+=i;}},b2ParticleSystem.prototype.SolvePressure=function(h){var u=b2ParticleSystem.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var _=this.m_positionBuffer.data;var t=this.m_velocityBuffer.data;var d=this.GetCriticalPressure(h);var f=this.m_def.pressureStrength*d;var p=.25*d;for(var e=0;e<this.m_count;e++){var i=this.m_weightBuffer[e];var r=f*V(0,i-1);this.m_accumulationBuffer[e]=L(r,p);}if(this.m_allParticleFlags&b2ParticleSystem.k_noPressureFlags)for(e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&b2ParticleSystem.k_noPressureFlags&&(this.m_accumulationBuffer[e]=0);if(this.m_allParticleFlags&H.b2ParticleFlag.b2_staticPressureParticle)for(e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&H.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[e]+=this.m_staticPressureBuffer[e]);var m=h.dt/(this.m_def.density*this.m_particleDiameter);var v=this.GetParticleInvMass();for(var n=0;n<this.m_bodyContactBuffer.count;n++){var a=(l=this.m_bodyContactBuffer.data[n]).index;var o=l.body;i=l.weight;var y=l.mass;var s=l.normal;var g=_[a];r=this.m_accumulationBuffer[a]+f*i;var c=j.MulSV(m*i*y*r,s,u);t[a].SelfMulSub(v,c),o.ApplyLinearImpulse(c,g,!0);}for(n=0;n<this.m_contactBuffer.count;n++){var l;a=(l=this.m_contactBuffer.data[n]).indexA;o=l.indexB;i=l.weight;s=l.normal;r=this.m_accumulationBuffer[a]+this.m_accumulationBuffer[o];c=j.MulSV(m*i*r,s,u);t[a].SelfSub(c),t[o].SelfAdd(c);}},b2ParticleSystem.prototype.SolveDamping=function(h){var u=b2ParticleSystem.SolveDamping_s_v;var _=b2ParticleSystem.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var d=this.m_positionBuffer.data;var t=this.m_velocityBuffer.data;var f=this.m_def.dampingStrength;var p=1/this.GetCriticalVelocity(h);var m=this.GetParticleInvMass();for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=(o=this.m_bodyContactBuffer.data[e]).index;var r=o.body;var n=o.weight;var v=o.mass;var a=o.normal;var y=d[i];var g=j.SubVV(r.GetLinearVelocityFromWorldPoint(y,j.s_t0),t[i],u);(s=j.DotVV(g,a))<0&&(c=V(f*n,L(-p*s,.5)),l=j.MulSV(c*v*s,a,_),t[i].SelfMulAdd(m,l),r.ApplyLinearImpulse(l.SelfNeg(),y,!0));}for(e=0;e<this.m_contactBuffer.count;e++){var o;i=(o=this.m_contactBuffer.data[e]).indexA;r=o.indexB;n=o.weight;a=o.normal;g=j.SubVV(t[r],t[i],u);var s;var c,l;(s=j.DotVV(g,a))<0&&(c=V(f*n,L(-p*s,.5)),l=j.MulSV(c*s,a,_),t[i].SelfAdd(l),t[r].SelfSub(l));}},b2ParticleSystem.prototype.SolveRigidDamping=function(){var h=b2ParticleSystem.SolveRigidDamping_s_t0;var u=b2ParticleSystem.SolveRigidDamping_s_t1;var _=b2ParticleSystem.SolveRigidDamping_s_p;var d=b2ParticleSystem.SolveRigidDamping_s_v;var t=[0],e=[0],i=[0];var f=[0],p=[0],m=[0];if(!this.m_positionBuffer.data)throw new Error();var v=this.m_positionBuffer.data;var y=this.m_def.dampingStrength;for(var r=0;r<this.m_bodyContactBuffer.count;r++){var n=(a=this.m_bodyContactBuffer.data[r]).index;(c=this.m_groupBuffer[n])&&this.IsRigidGroup(c)&&(o=a.body,s=a.normal,g=a.weight,l=v[n],A=j.SubVV(o.GetLinearVelocityFromWorldPoint(l,h),c.GetLinearVelocityFromWorldPoint(l,u),d),(S=j.DotVV(A,s))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(t,e,i,!0,c,n,l,s),this.InitDampingParameter(f,p,m,o.GetMass(),o.GetInertia()-o.GetMass()*o.GetLocalCenter().LengthSquared(),o.GetWorldCenter(),l,s),T=y*L(g,1)*this.ComputeDampingImpulse(t[0],e[0],i[0],f[0],p[0],m[0],S),this.ApplyDamping(t[0],e[0],i[0],!0,c,n,T,s),o.ApplyLinearImpulse(j.MulSV(-T,s,j.s_t0),l,!0)));}for(r=0;r<this.m_contactBuffer.count;r++){var a;n=(a=this.m_contactBuffer.data[r]).indexA;var o=a.indexB;var s=a.normal;var g=a.weight;var c=this.m_groupBuffer[n];var b=this.m_groupBuffer[o];var C=this.IsRigidGroup(c);var x=this.IsRigidGroup(b);var l,A,S,T;c!==b&&(C||x)&&(l=j.MidVV(v[n],v[o],_),A=j.SubVV(this.GetLinearVelocity(b,o,l,h),this.GetLinearVelocity(c,n,l,u),d),(S=j.DotVV(A,s))<0&&(this.InitDampingParameterWithRigidGroupOrParticle(t,e,i,C,c,n,l,s),this.InitDampingParameterWithRigidGroupOrParticle(f,p,m,x,b,o,l,s),T=y*g*this.ComputeDampingImpulse(t[0],e[0],i[0],f[0],p[0],m[0],S),this.ApplyDamping(t[0],e[0],i[0],C,c,n,T,s),this.ApplyDamping(f[0],p[0],m[0],x,b,o,-T,s)));}},b2ParticleSystem.prototype.SolveExtraDamping=function(){var t=b2ParticleSystem.SolveExtraDamping_s_v;var e=b2ParticleSystem.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var i=this.m_velocityBuffer.data;var h=this.m_positionBuffer.data;var u=this.GetParticleInvMass();for(var r=0;r<this.m_bodyContactBuffer.count;r++){var n=this.m_bodyContactBuffer.data[r];var a=n.index;var o,s,c,l;this.m_flagsBuffer.data[a]&b2ParticleSystem.k_extraDampingFlags&&(o=n.body,l=n.mass,n=n.normal,s=h[a],c=j.SubVV(o.GetLinearVelocityFromWorldPoint(s,j.s_t0),i[a],t),(c=j.DotVV(c,n))<0&&(l=j.MulSV(.5*l*c,n,e),i[a].SelfMulAdd(u,l),o.ApplyLinearImpulse(l.SelfNeg(),s,!0)));}},b2ParticleSystem.prototype.SolveWall=function(){if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var t=this.m_velocityBuffer.data;for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&H.b2ParticleFlag.b2_wallParticle&&t[e].SetZero();},b2ParticleSystem.prototype.SolveRigid=function(t){var e=b2ParticleSystem.SolveRigid_s_position;var i=b2ParticleSystem.SolveRigid_s_rotation;var r=b2ParticleSystem.SolveRigid_s_transform;var n=b2ParticleSystem.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var h=this.m_positionBuffer.data;var u=this.m_velocityBuffer.data;for(var a=this.m_groupList;a;a=a.GetNext())if(a.m_groupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup){a.UpdateStatistics();var o=i;o.SetAngle(t.dt*a.m_angularVelocity);var _=j.AddVV(a.m_center,j.SubVV(j.MulSV(t.dt,a.m_linearVelocity,j.s_t0),R.MulRV(o,a.m_center,j.s_t1),j.s_t0),e);var s=r;s.SetPositionRotation(_,o),I.MulXX(s,a.m_transform,a.m_transform);var c=n;c.p.x=t.inv_dt*s.p.x,c.p.y=t.inv_dt*s.p.y,c.q.s=t.inv_dt*s.q.s,c.q.c=t.inv_dt*(s.q.c-1);for(var l=a.m_firstIndex;l<a.m_lastIndex;l++)I.MulXV(c,h[l],u[l]);}},b2ParticleSystem.prototype.SolveElastic=function(h){var u=b2ParticleSystem.SolveElastic_s_pa;var _=b2ParticleSystem.SolveElastic_s_pb;var d=b2ParticleSystem.SolveElastic_s_pc;var f=b2ParticleSystem.SolveElastic_s_r;var t=b2ParticleSystem.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var p=this.m_positionBuffer.data;var m=this.m_velocityBuffer.data;var v=h.inv_dt*this.m_def.elasticStrength;for(var y=0;y<this.m_triadBuffer.count;y++){var e=this.m_triadBuffer.data[y];var g,b,C,i,r,n,a,o,s,c,l;e.flags&H.b2ParticleFlag.b2_elasticParticle&&(a=e.indexA,o=e.indexB,s=e.indexC,g=e.pa,b=e.pb,C=e.pc,i=u.Copy(p[a]),r=_.Copy(p[o]),n=d.Copy(p[s]),a=m[a],o=m[o],s=m[s],i.SelfMulAdd(h.dt,a),r.SelfMulAdd(h.dt,o),n.SelfMulAdd(h.dt,s),c=(i.x+r.x+n.x)/3,l=(i.y+r.y+n.y)/3,i.x-=c,i.y-=l,r.x-=c,r.y-=l,n.x-=c,n.y-=l,(c=f).s=j.CrossVV(g,i)+j.CrossVV(b,r)+j.CrossVV(C,n),c.c=j.DotVV(g,i)+j.DotVV(b,r)+j.DotVV(C,n),l=b2InvSqrt(c.s*c.s+c.c*c.c),isFinite(l)||(l=198177537e11),c.s*=l,c.c*=l,l=v*e.strength,R.MulRV(c,g,t),j.SubVV(t,i,t),j.MulSV(l,t,t),a.SelfAdd(t),R.MulRV(c,b,t),j.SubVV(t,r,t),j.MulSV(l,t,t),o.SelfAdd(t),R.MulRV(c,C,t),j.SubVV(t,n,t),j.MulSV(l,t,t),s.SelfAdd(t));}},b2ParticleSystem.prototype.SolveSpring=function(t){var h=b2ParticleSystem.SolveSpring_s_pa;var u=b2ParticleSystem.SolveSpring_s_pb;var _=b2ParticleSystem.SolveSpring_s_d;var d=b2ParticleSystem.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var e=this.m_positionBuffer.data;var i=this.m_velocityBuffer.data;var f=t.inv_dt*this.m_def.springStrength;for(var r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r];var a,o,s,c,l;n.flags&H.b2ParticleFlag.b2_springParticle&&(a=n.indexA,o=n.indexB,c=h.Copy(e[a]),s=u.Copy(e[o]),a=i[a],o=i[o],c.SelfMulAdd(t.dt,a),s.SelfMulAdd(t.dt,o),s=j.SubVV(s,c,_),c=n.distance,l=s.Length(),n=f*n.strength,n=j.MulSV(n*(c-l)/l,s,d),a.SelfSub(n),o.SelfAdd(n));}},b2ParticleSystem.prototype.SolveTensile=function(t){var h=b2ParticleSystem.SolveTensile_s_weightedNormal;var u=b2ParticleSystem.SolveTensile_s_s;var _=b2ParticleSystem.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error();var d=this.m_velocityBuffer.data;for(var e=0;e<this.m_count;e++)this.m_accumulation2Buffer[e]=new j(),this.m_accumulation2Buffer[e].SetZero();for(var i=0;i<this.m_contactBuffer.count;i++){var f;(r=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_tensileParticle&&(n=r.indexA,a=r.indexB,o=r.weight,s=r.normal,f=j.MulSV((1-o)*o,s,h),this.m_accumulation2Buffer[n].SelfSub(f),this.m_accumulation2Buffer[a].SelfAdd(f));}t=this.GetCriticalVelocity(t);var p=this.m_def.surfaceTensionPressureStrength*t;var m=this.m_def.surfaceTensionNormalStrength*t;var v=.5*t;for(i=0;i<this.m_contactBuffer.count;i++){var r;var n,a,o,s,c,l;(r=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_tensileParticle&&(n=r.indexA,a=r.indexB,o=r.weight,s=r.normal,c=this.m_weightBuffer[n]+this.m_weightBuffer[a],l=j.SubVV(this.m_accumulation2Buffer[a],this.m_accumulation2Buffer[n],u),c=L(p*(c-2)+m*j.DotVV(l,s),v)*o,l=j.MulSV(c,s,_),d[n].SelfSub(l),d[a].SelfAdd(l));}},b2ParticleSystem.prototype.SolveViscous=function(){var t=b2ParticleSystem.SolveViscous_s_v;var h=b2ParticleSystem.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var u=this.m_positionBuffer.data;var e=this.m_velocityBuffer.data;var _=this.m_def.viscousStrength;var d=this.GetParticleInvMass();for(var i=0;i<this.m_bodyContactBuffer.count;i++){var r=(a=this.m_bodyContactBuffer.data[i]).index;var f,n;this.m_flagsBuffer.data[r]&H.b2ParticleFlag.b2_viscousParticle&&(o=a.body,s=a.weight,f=a.mass,n=u[r],c=j.SubVV(o.GetLinearVelocityFromWorldPoint(n,j.s_t0),e[r],t),l=j.MulSV(_*f*s,c,h),e[r].SelfMulAdd(d,l),o.ApplyLinearImpulse(l.SelfNeg(),n,!0));}for(i=0;i<this.m_contactBuffer.count;i++){var a;var o,s,c,l;(a=this.m_contactBuffer.data[i]).flags&H.b2ParticleFlag.b2_viscousParticle&&(r=a.indexA,o=a.indexB,s=a.weight,c=j.SubVV(e[o],e[r],t),l=j.MulSV(_*s,c,h),e[r].SelfAdd(l),e[o].SelfSub(l));}},b2ParticleSystem.prototype.SolveRepulsive=function(t){var e=b2ParticleSystem.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error();var i=this.m_velocityBuffer.data;var r=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(var n=0;n<this.m_contactBuffer.count;n++){var a=this.m_contactBuffer.data[n];var o,s,c;a.flags&H.b2ParticleFlag.b2_repulsiveParticle&&(o=a.indexA,s=a.indexB,this.m_groupBuffer[o]!==this.m_groupBuffer[s]&&(c=a.weight,a=a.normal,c=j.MulSV(r*c,a,e),i[o].SelfSub(c),i[s].SelfAdd(c)));}},b2ParticleSystem.prototype.SolvePowder=function(h){var t=b2ParticleSystem.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var u=this.m_positionBuffer.data;var e=this.m_velocityBuffer.data;var i=this.m_def.powderStrength*this.GetCriticalVelocity(h);var _=this.GetParticleInvMass();for(var r=0;r<this.m_bodyContactBuffer.count;r++){var n=(a=this.m_bodyContactBuffer.data[r]).index;var d,f;this.m_flagsBuffer.data[n]&H.b2ParticleFlag.b2_powderParticle&&.25<(o=a.weight)&&(s=a.body,d=a.mass,f=u[n],c=a.normal,l=j.MulSV(i*d*(o-.25),c,t),e[n].SelfMulSub(_,l),s.ApplyLinearImpulse(l,f,!0));}for(r=0;r<this.m_contactBuffer.count;r++){var a;var o,s,c,l;(a=this.m_contactBuffer.data[r]).flags&H.b2ParticleFlag.b2_powderParticle&&.25<(o=a.weight)&&(n=a.indexA,s=a.indexB,c=a.normal,l=j.MulSV(i*(o-.25),c,t),e[n].SelfSub(l),e[s].SelfAdd(l));}},b2ParticleSystem.prototype.SolveSolid=function(t){var e=b2ParticleSystem.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error();var i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);var r=t.inv_dt*this.m_def.ejectionStrength;for(var n=0;n<this.m_contactBuffer.count;n++){var a=this.m_contactBuffer.data[n];var o=a.indexA;var s=a.indexB;var c,l;this.m_groupBuffer[o]!==this.m_groupBuffer[s]&&(c=a.weight,a=a.normal,l=this.m_depthBuffer[o]+this.m_depthBuffer[s],l=j.MulSV(r*l*c,a,e),i[o].SelfSub(l),i[s].SelfAdd(l));}},b2ParticleSystem.prototype.SolveForce=function(t){if(!this.m_velocityBuffer.data)throw new Error();var e=this.m_velocityBuffer.data;var i=t.dt*this.GetParticleInvMass();for(var r=0;r<this.m_count;r++)e[r].SelfMulAdd(i,this.m_forceBuffer[r]);this.m_hasForce=!1;},b2ParticleSystem.prototype.SolveColorMixing=function(){if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_colorBuffer.data)throw new Error();var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e];var r=i.indexA;i=i.indexB;this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[i]&H.b2ParticleFlag.b2_colorMixingParticle&&(r=this.m_colorBuffer.data[r],i=this.m_colorBuffer.data[i],C.MixColors(r,i,t));}},b2ParticleSystem.prototype.SolveZombie=function(){if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();var t=0;var e=[];for(var i=0;i<this.m_count;i++)e[i]=-1;var h=0;for(i=0;i<this.m_count;i++){var u=this.m_flagsBuffer.data[i];var _,r;u&H.b2ParticleFlag.b2_zombieParticle?(_=this.m_world.m_destructionListener,u&H.b2ParticleFlag.b2_destructionListenerParticle&&_&&_.SayGoodbyeParticle(this,i),this.m_handleIndexBuffer.data&&(r=this.m_handleIndexBuffer.data[i])&&(r.SetIndex(-1),this.m_handleIndexBuffer.data[i]=null),e[i]=-1):(i!==(e[i]=t)&&(this.m_handleIndexBuffer.data&&((r=this.m_handleIndexBuffer.data[i])&&r.SetIndex(t),this.m_handleIndexBuffer.data[t]=r),this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[i],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[i]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[i]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[i]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[i]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[i]),this.m_groupBuffer[t]=this.m_groupBuffer[i],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[i]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[i]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[i]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[i]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[i]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[i])),t++,h|=u);}var d=function(t){return t.index<0;},f=function(t){return t.indexA<0||t.indexB<0;},p=function(t){return t.index<0;},m=function(t){return t.indexA<0||t.indexB<0;},v=function(t){return t.indexA<0||t.indexB<0||t.indexC<0;};for(var n=0;n<this.m_proxyBuffer.count;n++){var y=this.m_proxyBuffer.data[n];y.index=e[y.index];}this.m_proxyBuffer.RemoveIf(d);for(n=0;n<this.m_contactBuffer.count;n++)(a=this.m_contactBuffer.data[n]).indexA=e[a.indexA],a.indexB=e[a.indexB];this.m_contactBuffer.RemoveIf(f);for(n=0;n<this.m_bodyContactBuffer.count;n++){var a;(a=this.m_bodyContactBuffer.data[n]).index=e[a.index];}this.m_bodyContactBuffer.RemoveIf(p);for(n=0;n<this.m_pairBuffer.count;n++){var o=this.m_pairBuffer.data[n];o.indexA=e[o.indexA],o.indexB=e[o.indexB];}this.m_pairBuffer.RemoveIf(m);for(n=0;n<this.m_triadBuffer.count;n++){var s=this.m_triadBuffer.data[n];s.indexA=e[s.indexA],s.indexB=e[s.indexB],s.indexC=e[s.indexC];}if(this.m_triadBuffer.RemoveIf(v),this.m_indexByExpirationTimeBuffer.data){var g=0;for(var b=0;b<this.m_count;b++){var C=e[this.m_indexByExpirationTimeBuffer.data[b]];-1!==C&&(this.m_indexByExpirationTimeBuffer.data[g++]=C);}}for(var c=this.m_groupList;c;c=c.GetNext()){var l=t;var x=0;var A=!1;for(i=c.m_firstIndex;i<c.m_lastIndex;i++){var S=e[i];0<=S?(l=L(l,S),x=V(x,S+1)):A=!0;}l<x?(c.m_firstIndex=l,c.m_lastIndex=x,A&&c.m_groupFlags&H.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(c,c.m_groupFlags|H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(c.m_firstIndex=0,c.m_lastIndex=0,c.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(c,c.m_groupFlags|H.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed));}this.m_count=t,this.m_allParticleFlags=h,this.m_needsUpdateAllParticleFlags=!1;for(c=this.m_groupList;c;){var T=c.GetNext();c.m_groupFlags&H.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(c),c=T;}},b2ParticleSystem.prototype.SolveLifetimes=function(t){if(!this.m_expirationTimeBuffer.data)throw new Error();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error();this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed();var r=this.m_expirationTimeBuffer.data;var i=this.m_indexByExpirationTimeBuffer.data;t=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(std_sort(i,0,t,function(t,e){t=r[t];e=r[e];var i=t<=0;return i==e<=0?e<t:i;}),this.m_expirationTimeBufferRequiresSorting=!1);for(var n=t-1;0<=n;--n){var a=i[n];var o=r[a];if(e<o||o<=0)break;this.DestroyParticle(a);}},b2ParticleSystem.prototype.RotateBuffer=function(e,i,r){if(e!==i&&i!==r){if(!this.m_flagsBuffer.data)throw new Error();if(!this.m_positionBuffer.data)throw new Error();if(!this.m_velocityBuffer.data)throw new Error();if(std_rotate(this.m_flagsBuffer.data,e,i,r),this.m_lastBodyContactStepBuffer.data&&std_rotate(this.m_lastBodyContactStepBuffer.data,e,i,r),this.m_bodyContactCountBuffer.data&&std_rotate(this.m_bodyContactCountBuffer.data,e,i,r),this.m_consecutiveContactStepsBuffer.data&&std_rotate(this.m_consecutiveContactStepsBuffer.data,e,i,r),std_rotate(this.m_positionBuffer.data,e,i,r),std_rotate(this.m_velocityBuffer.data,e,i,r),std_rotate(this.m_groupBuffer,e,i,r),this.m_hasForce&&std_rotate(this.m_forceBuffer,e,i,r),this.m_staticPressureBuffer&&std_rotate(this.m_staticPressureBuffer,e,i,r),this.m_depthBuffer&&std_rotate(this.m_depthBuffer,e,i,r),this.m_colorBuffer.data&&std_rotate(this.m_colorBuffer.data,e,i,r),this.m_userDataBuffer.data&&std_rotate(this.m_userDataBuffer.data,e,i,r),this.m_handleIndexBuffer.data){std_rotate(this.m_handleIndexBuffer.data,e,i,r);for(var t=e;t<r;++t){var l=this.m_handleIndexBuffer.data[t];l&&l.SetIndex(newIndices(l.GetIndex()));}}if(this.m_expirationTimeBuffer.data){std_rotate(this.m_expirationTimeBuffer.data,e,i,r);var h=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error();var u=this.m_indexByExpirationTimeBuffer.data;for(t=0;t<h;++t)u[t]=newIndices(u[t]);}for(var n=0;n<this.m_proxyBuffer.count;n++){var _=this.m_proxyBuffer.data[n];_.index=newIndices(_.index);}for(n=0;n<this.m_contactBuffer.count;n++)(a=this.m_contactBuffer.data[n]).indexA=newIndices(a.indexA),a.indexB=newIndices(a.indexB);for(n=0;n<this.m_bodyContactBuffer.count;n++){var a;(a=this.m_bodyContactBuffer.data[n]).index=newIndices(a.index);}for(n=0;n<this.m_pairBuffer.count;n++){var o=this.m_pairBuffer.data[n];o.indexA=newIndices(o.indexA),o.indexB=newIndices(o.indexB);}for(n=0;n<this.m_triadBuffer.count;n++){var s=this.m_triadBuffer.data[n];s.indexA=newIndices(s.indexA),s.indexB=newIndices(s.indexB),s.indexC=newIndices(s.indexC);}for(var c=this.m_groupList;c;c=c.GetNext())c.m_firstIndex=newIndices(c.m_firstIndex),c.m_lastIndex=newIndices(c.m_lastIndex-1)+1;}function newIndices(t){return t<e?t:t<i?t+r-i:t<r?t+e-i:t;}},b2ParticleSystem.prototype.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt;},b2ParticleSystem.prototype.GetCriticalVelocitySquared=function(t){t=this.GetCriticalVelocity(t);return t*t;},b2ParticleSystem.prototype.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t);},b2ParticleSystem.prototype.GetParticleStride=function(){return .75*this.m_particleDiameter;},b2ParticleSystem.prototype.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t;},b2ParticleSystem.prototype.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/.75);return this.m_inverseDensity*t*t;},b2ParticleSystem.prototype.GetFixtureContactFilter=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null;},b2ParticleSystem.prototype.GetParticleContactFilter=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null;},b2ParticleSystem.prototype.GetFixtureContactListener=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null;},b2ParticleSystem.prototype.GetParticleContactListener=function(){return this.m_allParticleFlags&H.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null;},b2ParticleSystem.prototype.SetUserOverridableBuffer=function(t,e,i){t.data=e,t.userSuppliedCapacity=i;},b2ParticleSystem.prototype.SetGroupFlags=function(t,e){var i=t.m_groupFlags;(i^e)&H.b2ParticleGroupFlag.b2_solidParticleGroup&&(e|=H.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&H.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e;},b2ParticleSystem.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index;},b2ParticleSystem.prototype.RemoveSpuriousBodyContacts=function(){std_sort(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,b2ParticleSystem.BodyContactCompare);var a=b2ParticleSystem.RemoveSpuriousBodyContacts_s_n;var o=b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos;var s=b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal;var c=this;var l=-1;var h=0;this.m_bodyContactBuffer.count=std_remove_if(this.m_bodyContactBuffer.data,function(t){if(t.index!==l&&(h=0,l=t.index),3<h++)return!0;var e=a.Copy(t.normal);if(e.SelfMul(c.m_particleDiameter*(1-t.weight)),!c.m_positionBuffer.data)throw new Error();var i=j.AddVV(c.m_positionBuffer.data[t.index],e,o);if(t.fixture.TestPoint(i))return!1;var r=t.fixture.GetShape().GetChildCount();for(var n=0;n<r;n++)if(t.fixture.ComputeDistance(i,s,n)<M)return!1;return!0;},this.m_bodyContactBuffer.count);},b2ParticleSystem.prototype.DetectStuckParticle=function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error();if(!this.m_consecutiveContactStepsBuffer.data)throw new Error();if(!this.m_lastBodyContactStepBuffer.data)throw new Error();++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp;}},b2ParticleSystem.prototype.ValidateParticleIndex=function(t){return 0<=t&&t<this.GetParticleCount()&&-1!==t;},b2ParticleSystem.prototype.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296);},b2ParticleSystem.prototype.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296);},b2ParticleSystem.prototype.ForceCanBeApplied=function(t){return!(t&H.b2ParticleFlag.b2_wallParticle);},b2ParticleSystem.prototype.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0;}},b2ParticleSystem.prototype.IsRigidGroup=function(t){return null!==t&&0!=(t.m_groupFlags&H.b2ParticleGroupFlag.b2_rigidParticleGroup);},b2ParticleSystem.prototype.GetLinearVelocity=function(t,e,i,r){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,r);if(!this.m_velocityBuffer.data)throw new Error();return r.Copy(this.m_velocityBuffer.data[e]);},b2ParticleSystem.prototype.InitDampingParameter=function(t,e,i,r,n,a,o,s){t[0]=0<r?1/r:0,e[0]=0<n?1/n:0,i[0]=j.CrossVV(j.SubVV(o,a,j.s_t0),s);},b2ParticleSystem.prototype.InitDampingParameterWithRigidGroupOrParticle=function(t,e,i,r,n,a,o,s){if(n&&r)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),o,s);else{if(!this.m_flagsBuffer.data)throw new Error();r=this.m_flagsBuffer.data[a];this.InitDampingParameter(t,e,i,r&H.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,o,o,s);}},b2ParticleSystem.prototype.ComputeDampingImpulse=function(t,e,i,r,n,a,o){t=t+e*i*i+r+n*a*a;return 0<t?o/t:0;},b2ParticleSystem.prototype.ApplyDamping=function(t,e,i,r,n,a,o,s){if(n&&r)n.m_linearVelocity.SelfMulAdd(o*t,s),n.m_angularVelocity+=o*i*e;else{if(!this.m_velocityBuffer.data)throw new Error();this.m_velocityBuffer.data[a].SelfMulAdd(o*t,s);}},b2ParticleSystem.xTruncBits=12,b2ParticleSystem.yTruncBits=12,b2ParticleSystem.tagBits=32,b2ParticleSystem.yOffset=1<<b2ParticleSystem.yTruncBits-1,b2ParticleSystem.yShift=b2ParticleSystem.tagBits-b2ParticleSystem.yTruncBits,b2ParticleSystem.xShift=b2ParticleSystem.tagBits-b2ParticleSystem.yTruncBits-b2ParticleSystem.xTruncBits,b2ParticleSystem.xScale=1<<b2ParticleSystem.xShift,b2ParticleSystem.xOffset=b2ParticleSystem.xScale*(1<<b2ParticleSystem.xTruncBits-1),b2ParticleSystem.yMask=(1<<b2ParticleSystem.yTruncBits)-1<<b2ParticleSystem.yShift,b2ParticleSystem.xMask=~b2ParticleSystem.yMask,b2ParticleSystem.DestroyParticlesInShape_s_aabb=new mt(),b2ParticleSystem.CreateParticleGroup_s_transform=new I(),b2ParticleSystem.ComputeCollisionEnergy_s_v=new j(),b2ParticleSystem.QueryShapeAABB_s_aabb=new mt(),b2ParticleSystem.QueryPointAABB_s_aabb=new mt(),b2ParticleSystem.RayCast_s_aabb=new mt(),b2ParticleSystem.RayCast_s_p=new j(),b2ParticleSystem.RayCast_s_v=new j(),b2ParticleSystem.RayCast_s_n=new j(),b2ParticleSystem.RayCast_s_point=new j(),b2ParticleSystem.k_pairFlags=H.b2ParticleFlag.b2_springParticle,b2ParticleSystem.k_triadFlags=H.b2ParticleFlag.b2_elasticParticle,b2ParticleSystem.k_noPressureFlags=H.b2ParticleFlag.b2_powderParticle|H.b2ParticleFlag.b2_tensileParticle,b2ParticleSystem.k_extraDampingFlags=H.b2ParticleFlag.b2_staticPressureParticle,b2ParticleSystem.k_barrierWallFlags=H.b2ParticleFlag.b2_barrierParticle|H.b2ParticleFlag.b2_wallParticle,b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge=new Ie(),b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d=new j(),b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p=new j(),b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb=new mt(),b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p=new j(),b2ParticleSystem.UpdatePairsAndTriads_s_dab=new j(),b2ParticleSystem.UpdatePairsAndTriads_s_dbc=new j(),b2ParticleSystem.UpdatePairsAndTriads_s_dca=new j(),b2ParticleSystem.AddContact_s_d=new j(),b2ParticleSystem.UpdateBodyContacts_s_aabb=new mt(),b2ParticleSystem.Solve_s_subStep=new lr(),b2ParticleSystem.SolveCollision_s_aabb=new mt(),b2ParticleSystem.SolveGravity_s_gravity=new j(),b2ParticleSystem.SolveBarrier_s_aabb=new mt(),b2ParticleSystem.SolveBarrier_s_va=new j(),b2ParticleSystem.SolveBarrier_s_vb=new j(),b2ParticleSystem.SolveBarrier_s_pba=new j(),b2ParticleSystem.SolveBarrier_s_vba=new j(),b2ParticleSystem.SolveBarrier_s_vc=new j(),b2ParticleSystem.SolveBarrier_s_pca=new j(),b2ParticleSystem.SolveBarrier_s_vca=new j(),b2ParticleSystem.SolveBarrier_s_qba=new j(),b2ParticleSystem.SolveBarrier_s_qca=new j(),b2ParticleSystem.SolveBarrier_s_dv=new j(),b2ParticleSystem.SolveBarrier_s_f=new j(),b2ParticleSystem.SolvePressure_s_f=new j(),b2ParticleSystem.SolveDamping_s_v=new j(),b2ParticleSystem.SolveDamping_s_f=new j(),b2ParticleSystem.SolveRigidDamping_s_t0=new j(),b2ParticleSystem.SolveRigidDamping_s_t1=new j(),b2ParticleSystem.SolveRigidDamping_s_p=new j(),b2ParticleSystem.SolveRigidDamping_s_v=new j(),b2ParticleSystem.SolveExtraDamping_s_v=new j(),b2ParticleSystem.SolveExtraDamping_s_f=new j(),b2ParticleSystem.SolveRigid_s_position=new j(),b2ParticleSystem.SolveRigid_s_rotation=new R(),b2ParticleSystem.SolveRigid_s_transform=new I(),b2ParticleSystem.SolveRigid_s_velocityTransform=new I(),b2ParticleSystem.SolveElastic_s_pa=new j(),b2ParticleSystem.SolveElastic_s_pb=new j(),b2ParticleSystem.SolveElastic_s_pc=new j(),b2ParticleSystem.SolveElastic_s_r=new R(),b2ParticleSystem.SolveElastic_s_t0=new j(),b2ParticleSystem.SolveSpring_s_pa=new j(),b2ParticleSystem.SolveSpring_s_pb=new j(),b2ParticleSystem.SolveSpring_s_d=new j(),b2ParticleSystem.SolveSpring_s_f=new j(),b2ParticleSystem.SolveTensile_s_weightedNormal=new j(),b2ParticleSystem.SolveTensile_s_s=new j(),b2ParticleSystem.SolveTensile_s_f=new j(),b2ParticleSystem.SolveViscous_s_v=new j(),b2ParticleSystem.SolveViscous_s_f=new j(),b2ParticleSystem.SolveRepulsive_s_f=new j(),b2ParticleSystem.SolvePowder_s_f=new j(),b2ParticleSystem.SolveSolid_s_f=new j(),b2ParticleSystem.RemoveSpuriousBodyContacts_s_n=new j(),b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos=new j(),b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal=new j(),b2ParticleSystem),function(_){function Proxy(){this.index=-1,this.tag=0;}function InsideBoundsEnumerator(t,e,i,r,n){this.m_system=t,this.m_xLower=(e&_.xMask)>>>0,this.m_xUpper=(i&_.xMask)>>>0,this.m_yLower=(e&_.yMask)>>>0,this.m_yUpper=(i&_.yMask)>>>0,this.m_first=r,this.m_last=n;}function FixedSetAllocator(){}_.UserOverridableBuffer=function(){this.data=null,this.userSuppliedCapacity=0;},Proxy.CompareProxyProxy=function(t,e){return t.tag<e.tag;},Proxy.CompareTagProxy=function(t,e){return t<e.tag;},Proxy.CompareProxyTag=function(t,e){return t.tag<e;},_.Proxy=Proxy,InsideBoundsEnumerator.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&_.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++;}return-1;},_.InsideBoundsEnumerator=InsideBoundsEnumerator,_.ParticleListNode=function(){this.next=null,this.count=0,this.index=0;},FixedSetAllocator.prototype.Allocate=function(t,e){return e;},FixedSetAllocator.prototype.Clear=function(){},FixedSetAllocator.prototype.GetCount=function(){return 0;},FixedSetAllocator.prototype.Invalidate=function(t){},FixedSetAllocator.prototype.GetValidBuffer=function(){return[];},FixedSetAllocator.prototype.GetBuffer=function(){return[];},FixedSetAllocator.prototype.SetCount=function(t){},_.FixedSetAllocator=FixedSetAllocator,_.FixtureParticle=function(t,e){this.second=-1,this.first=t,this.second=e;};__extends(FixtureParticleSet,e=_.FixedSetAllocator),FixtureParticleSet.prototype.Initialize=function(t,e){},FixtureParticleSet.prototype.Find=function(t){return-1;};var t=FixtureParticleSet;function FixtureParticleSet(){return null!==e&&e.apply(this,arguments)||this;}var e;_.FixtureParticleSet=t,_.ParticlePair=function(t,e){this.first=-1,this.second=-1,this.first=t,this.second=e;};__extends(b2ParticlePairSet,i=_.FixedSetAllocator),b2ParticlePairSet.prototype.Initialize=function(t,e){},b2ParticlePairSet.prototype.Find=function(t){return-1;};t=b2ParticlePairSet;function b2ParticlePairSet(){return null!==i&&i.apply(this,arguments)||this;}var i;function ConnectionFilter(){}_.b2ParticlePairSet=t,ConnectionFilter.prototype.IsNecessary=function(t){return!0;},ConnectionFilter.prototype.ShouldCreatePair=function(t,e){return!0;},ConnectionFilter.prototype.ShouldCreateTriad=function(t,e,i){return!0;},_.ConnectionFilter=ConnectionFilter;__extends(DestroyParticlesInShapeCallback,a=ar),DestroyParticlesInShapeCallback.prototype.ReportFixture=function(t){return!1;},DestroyParticlesInShapeCallback.prototype.ReportParticle=function(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error();return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0;},DestroyParticlesInShapeCallback.prototype.Destroyed=function(){return this.m_destroyed;};t=DestroyParticlesInShapeCallback;function DestroyParticlesInShapeCallback(t,e,i,r){var n=a.call(this)||this;return n.m_callDestructionListener=!1,n.m_destroyed=0,n.m_system=t,n.m_shape=e,n.m_xf=i,n.m_callDestructionListener=r,n.m_destroyed=0,n;}var a;_.DestroyParticlesInShapeCallback=t;__extends(JoinParticleGroupsFilter,r=_.ConnectionFilter),JoinParticleGroupsFilter.prototype.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t;},JoinParticleGroupsFilter.prototype.ShouldCreateTriad=function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i);};t=JoinParticleGroupsFilter;function JoinParticleGroupsFilter(t){var e=r.call(this)||this;return e.m_threshold=0,e.m_threshold=t,e;}var r;_.JoinParticleGroupsFilter=t;__extends(CompositeShape,n=Ee),CompositeShape.prototype.Clone=function(){throw new Error();},CompositeShape.prototype.GetChildCount=function(){return 1;},CompositeShape.prototype.TestPoint=function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1;},CompositeShape.prototype.ComputeDistance=function(t,e,i,r){return 0;},CompositeShape.prototype.RayCast=function(t,e,i,r){return!1;},CompositeShape.prototype.ComputeAABB=function(t,e,i){var r=new mt();t.lowerBound.x=+B,t.lowerBound.y=+B,t.upperBound.x=-B,t.upperBound.y=-B;for(var n=0;n<this.m_shapeCount;n++){var a=this.m_shapes[n].GetChildCount();for(var o=0;o<a;o++){var s=r;this.m_shapes[n].ComputeAABB(s,e,o),t.Combine1(s);}}},CompositeShape.prototype.ComputeMass=function(t,e){},CompositeShape.prototype.SetupDistanceProxy=function(t,e){},CompositeShape.prototype.ComputeSubmergedArea=function(t,e,i,r){return 0;},CompositeShape.prototype.Dump=function(t){};t=CompositeShape;function CompositeShape(t,e){void 0===e&&(e=t.length);var i=n.call(this,H.b2ShapeType.e_unknown,0)||this;return i.m_shapeCount=0,i.m_shapes=t,i.m_shapeCount=e,i;}var n;_.CompositeShape=t;__extends(ReactiveFilter,o=_.ConnectionFilter),ReactiveFilter.prototype.IsNecessary=function(t){if(!this.m_flagsBuffer.data)throw new Error();return 0!=(this.m_flagsBuffer.data[t]&H.b2ParticleFlag.b2_reactiveParticle);};t=ReactiveFilter;function ReactiveFilter(t){var e=o.call(this)||this;return e.m_flagsBuffer=t,e;}var o;_.ReactiveFilter=t;__extends(UpdateBodyContactsCallback,s=Er),UpdateBodyContactsCallback.prototype.ShouldCollideFixtureParticle=function(t,e,i){if(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&H.b2ParticleFlag.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i);return!0;},UpdateBodyContactsCallback.prototype.ReportFixtureAndParticle=function(t,e,i){var r=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n;var n=_.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error();if(!this.m_system.m_positionBuffer.data)throw new Error();var a=this.m_system.m_positionBuffer.data[i];e=t.ComputeDistance(a,r,e);var o,h,s,c,l;e<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,i)&&(c=(o=t.GetBody()).GetWorldCenter(),h=0<(s=o.GetMass())?1/s:0,s=0<(s=o.GetInertia()-s*o.GetLocalCenter().LengthSquared())?1/s:0,l=this.m_system.m_flagsBuffer.data[i]&H.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),a=j.SubVV(a,c,n),n=l+h+s*(c=j.CrossVV(a,r))*c,(l=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()]).index=i,l.body=o,l.fixture=t,l.weight=1-e*this.m_system.m_inverseDiameter,l.normal.Copy(r.SelfNeg()),l.mass=0<n?1/n:0,this.m_system.DetectStuckParticle(i));},UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n=new j(),UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp=new j();t=UpdateBodyContactsCallback;function UpdateBodyContactsCallback(t,e){t=s.call(this,t)||this;return t.m_contactFilter=e,t;}var s;_.UpdateBodyContactsCallback=t;__extends(SolveCollisionCallback,c=Er),SolveCollisionCallback.prototype.ReportFixtureAndParticle=function(t,e,i){var r=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p1;var n=_.SolveCollisionCallback.ReportFixtureAndParticle_s_output;var a=_.SolveCollisionCallback.ReportFixtureAndParticle_s_input;var o=_.SolveCollisionCallback.ReportFixtureAndParticle_s_p;var h=_.SolveCollisionCallback.ReportFixtureAndParticle_s_v;var u=_.SolveCollisionCallback.ReportFixtureAndParticle_s_f;var s=t.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error();if(!this.m_system.m_velocityBuffer.data)throw new Error();var c=this.m_system.m_positionBuffer.data[i];var l=this.m_system.m_velocityBuffer.data[i];0===this.m_system.m_iterationIndex?(r=I.MulTXV(s.m_xf0,c,r),t.GetShape().GetType()===H.b2ShapeType.e_circleShape&&(r.SelfSub(s.GetLocalCenter()),R.MulRV(s.m_xf0.q,r,r),R.MulTRV(s.m_xf.q,r,r),r.SelfAdd(s.GetLocalCenter())),I.MulXV(s.m_xf,r,a.p1)):a.p1.Copy(c),j.AddVMulSV(c,this.m_step.dt,l,a.p2),a.maxFraction=1,t.RayCast(n,a,e)&&(s=n.normal,(r=o).x=(1-n.fraction)*a.p1.x+n.fraction*a.p2.x+M*s.x,r.y=(1-n.fraction)*a.p1.y+n.fraction*a.p2.y+M*s.y,(t=h).x=this.m_step.inv_dt*(r.x-c.x),t.y=this.m_step.inv_dt*(r.y-c.y),this.m_system.m_velocityBuffer.data[i].Copy(t),(e=u).x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(l.x-t.x),e.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(l.y-t.y),this.m_system.ParticleApplyForce(i,e));},SolveCollisionCallback.prototype.ReportParticle=function(t,e){return!1;},SolveCollisionCallback.ReportFixtureAndParticle_s_p1=new j(),SolveCollisionCallback.ReportFixtureAndParticle_s_output=new pt(),SolveCollisionCallback.ReportFixtureAndParticle_s_input=new ft(),SolveCollisionCallback.ReportFixtureAndParticle_s_p=new j(),SolveCollisionCallback.ReportFixtureAndParticle_s_v=new j(),SolveCollisionCallback.ReportFixtureAndParticle_s_f=new j();t=SolveCollisionCallback;function SolveCollisionCallback(t,e){t=c.call(this,t)||this;return t.m_step=e,t;}var c;_.SolveCollisionCallback=t;}(H.b2ParticleSystem||(H.b2ParticleSystem={}));b2World.prototype.SetDestructionListener=function(t){this.m_destructionListener=t;},b2World.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t;},b2World.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t;},b2World.prototype.SetDebugDraw=function(t){this.m_debugDraw=t;},b2World.prototype.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error();t=new ke(t,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t;},b2World.prototype.DestroyBody=function(t){if(this.IsLocked())throw new Error();var e=t.m_jointList;for(;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e;}t.m_jointList=null;var r=t.m_controllerList;for(;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t);}var a=t.m_contactList;for(;a;){var o=a;a=a.next,this.m_contactManager.Destroy(o.contact);}t.m_contactList=null;var s=t.m_fixtureList;for(;s;){var c=s;s=s.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(),c.Destroy(),t.m_fixtureList=s,--t.m_fixtureCount;}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount;},b2World._Joint_Create=function(t,e){switch(t.type){case H.b2JointType.e_distanceJoint:return new je(t);case H.b2JointType.e_mouseJoint:return new ui(t);case H.b2JointType.e_prismaticJoint:return new pi(t);case H.b2JointType.e_revoluteJoint:return new Ai(t);case H.b2JointType.e_pulleyJoint:return new gi(t);case H.b2JointType.e_gearJoint:return new ri(t);case H.b2JointType.e_wheelJoint:return new Vi(t);case H.b2JointType.e_weldJoint:return new Ii(t);case H.b2JointType.e_frictionJoint:return new $e(t);case H.b2JointType.e_ropeJoint:return new Ei(t);case H.b2JointType.e_motorJoint:return new si(t);case H.b2JointType.e_areaJoint:return new Je(t);}throw new Error();},b2World._Joint_Destroy=function(t,e){},b2World.prototype.CreateJoint=function(t){if(this.IsLocked())throw new Error();var e=b2World._Joint_Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=t.bodyA;var r=t.bodyB;if(!t.collideConnected){var n=r.GetContactList();for(;n;)n.other===i&&n.contact.FlagForFiltering(),n=n.next;}return e;},b2World.prototype.DestroyJoint=function(t){if(this.IsLocked())throw new Error();var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA;var r=t.m_bodyB;if(i.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,b2World._Joint_Destroy(t,null),--this.m_jointCount,!e){var n=r.GetContactList();for(;n;)n.other===i&&n.contact.FlagForFiltering(),n=n.next;}},b2World.prototype.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error();t=new H.b2ParticleSystem(t,this);return t.m_prev=null,t.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=t),this.m_particleSystemList=t;},b2World.prototype.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error();t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next);},b2World.prototype.CalculateReasonableParticleIterations=function(t){return null===this.m_particleSystemList?1:b2CalculateParticleIterations(this.m_gravity.Length(),function(t){var e=B;for(var i=t.GetParticleSystemList();null!==i;i=i.m_next)e=L(e,i.GetRadius());return e;}(this),t);},b2World.prototype.Step=function(t,e,i,r){void 0===r&&(r=this.CalculateReasonableParticleIterations(t));var n=b2World.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var a=b2World.Step_s_step;a.dt=t,a.velocityIterations=e,a.positionIterations=i,a.particleIterations=r,a.inv_dt=0<t?1/t:0,a.dtRatio=this.m_inv_dt0*t,a.warmStarting=this.m_warmStarting;e=b2World.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=e.GetMilliseconds(),this.m_stepComplete&&0<a.dt){i=b2World.Step_s_timer.Reset();for(var o=this.m_particleSystemList;o;o=o.m_next)o.Solve(a);this.Solve(a),this.m_profile.solve=i.GetMilliseconds();}this.m_continuousPhysics&&0<a.dt&&(r=b2World.Step_s_timer.Reset(),this.SolveTOI(a),this.m_profile.solveTOI=r.GetMilliseconds()),0<a.dt&&(this.m_inv_dt0=a.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds();},b2World.prototype.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0;},b2World.prototype.DrawParticleSystem=function(t){var e,i,r;null===this.m_debugDraw||(e=t.GetParticleCount())&&(i=t.GetRadius(),r=t.GetPositionBuffer(),t.m_colorBuffer.data?(t=t.GetColorBuffer(),this.m_debugDraw.DrawParticles(r,i,t,e)):this.m_debugDraw.DrawParticles(r,i,null,e));},b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var t=this.m_debugDraw.GetFlags();var e=b2World.DrawDebugData_s_color.SetRGB(0,0,0);if(t&H.b2DrawFlags.e_shapeBit)for(var i=this.m_bodyList;i;i=i.m_next){var r=i.m_xf;this.m_debugDraw.PushTransform(r);for(var n=i.GetFixtureList();n;n=n.m_next)i.IsActive()?i.GetType()===H.b2BodyType.b2_staticBody?e.SetRGB(.5,.9,.5):i.GetType()===H.b2BodyType.b2_kinematicBody?e.SetRGB(.5,.5,.9):i.IsAwake()?e.SetRGB(.9,.7,.7):e.SetRGB(.6,.6,.6):e.SetRGB(.5,.5,.3),this.DrawShape(n,e);this.m_debugDraw.PopTransform(r);}if(t&H.b2DrawFlags.e_particleBit)for(var a=this.m_particleSystemList;a;a=a.m_next)this.DrawParticleSystem(a);if(t&H.b2DrawFlags.e_jointBit)for(var o=this.m_jointList;o;o=o.m_next)this.DrawJoint(o);if(t&H.b2DrawFlags.e_aabbBit){e.SetRGB(.9,.3,.9);var s=b2World.DrawDebugData_s_vs;for(i=this.m_bodyList;i;i=i.m_next)if(i.IsActive())for(n=i.GetFixtureList();n;n=n.m_next)for(var h=0;h<n.m_proxyCount;++h){var c=n.m_proxies[h].treeNode.aabb;s[0].Set(c.lowerBound.x,c.lowerBound.y),s[1].Set(c.upperBound.x,c.lowerBound.y),s[2].Set(c.upperBound.x,c.upperBound.y),s[3].Set(c.lowerBound.x,c.upperBound.y),this.m_debugDraw.DrawPolygon(s,4,e);}}if(t&H.b2DrawFlags.e_centerOfMassBit)for(i=this.m_bodyList;i;i=i.m_next)(r=b2World.DrawDebugData_s_xf).q.Copy(i.m_xf.q),r.p.Copy(i.GetWorldCenter()),this.m_debugDraw.DrawTransform(r);if(t&H.b2DrawFlags.e_controllerBit)for(var l=this.m_controllerList;l;l=l.m_next)l.Draw(this.m_debugDraw);}},b2World.prototype.QueryAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.Query(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t);}),e instanceof ar)for(var r=this.m_particleSystemList;r;r=r.m_next)e.ShouldQueryParticleSystem(r)&&r.QueryAABB(e,t);},b2World.prototype.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(null,t,function(t){return e.push(t),!0;}),e;},b2World.prototype.QueryPointAABB=function(e,t,i){if(this.m_contactManager.m_broadPhase.QueryPoint(t,function(t){t=t.userData.fixture;return e?e.ReportFixture(t):!i||i(t);}),e instanceof ar)for(var r=this.m_particleSystemList;r;r=r.m_next)e.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(e,t);},b2World.prototype.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(null,t,function(t){return e.push(t),!0;}),e;},b2World.prototype.QueryFixtureShape=function(i,r,n,a,o){var t=b2World.QueryFixtureShape_s_aabb;if(r.ComputeAABB(t,a,n),this.m_contactManager.m_broadPhase.Query(t,function(t){t=t.userData;var e=t.fixture;if(b2TestOverlapShape(r,n,e.GetShape(),t.childIndex,a,e.GetBody().GetTransform())){if(i)return i.ReportFixture(e);if(o)return o(e);}return!0;}),i instanceof ar)for(var e=this.m_particleSystemList;e;e=e.m_next)i.ShouldQueryParticleSystem(e)&&e.QueryAABB(i,t);},b2World.prototype.QueryAllFixtureShape=function(t,e,i,r){return void 0===r&&(r=[]),this.QueryFixtureShape(null,t,e,i,function(t){return r.push(t),!0;}),r;},b2World.prototype.QueryFixturePoint=function(e,i,r){if(this.m_contactManager.m_broadPhase.QueryPoint(i,function(t){t=t.userData.fixture;if(t.TestPoint(i)){if(e)return e.ReportFixture(t);if(r)return r(t);}return!0;}),e)for(var t=this.m_particleSystemList;t;t=t.m_next)e.ShouldQueryParticleSystem(t)&&t.QueryPointAABB(e,i);},b2World.prototype.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(null,t,function(t){return e.push(t),!0;}),e;},b2World.prototype.RayCast=function(a,o,s,c){var t=b2World.RayCast_s_input;if(t.maxFraction=1,t.p1.Copy(o),t.p2.Copy(s),this.m_contactManager.m_broadPhase.RayCast(t,function(t,e){e=e.userData;var i=e.fixture;e=e.childIndex;var r=b2World.RayCast_s_output;if(i.RayCast(r,t,e)){e=r.fraction;var n=b2World.RayCast_s_point;if(n.Set((1-e)*o.x+e*s.x,(1-e)*o.y+e*s.y),a)return a.ReportFixture(i,n,r.normal,e);if(c)return c(i,n,r.normal,e);}return t.maxFraction;}),a)for(var e=this.m_particleSystemList;e;e=e.m_next)a.ShouldQueryParticleSystem(e)&&e.RayCast(a,o,s);},b2World.prototype.RayCastOne=function(t,e){var n=null;var a=1;return this.RayCast(null,t,e,function(t,e,i,r){return r<a&&(a=r,n=t),a;}),n;},b2World.prototype.RayCastAll=function(t,e,n){return void 0===n&&(n=[]),this.RayCast(null,t,e,function(t,e,i,r){return n.push(t),1;}),n;},b2World.prototype.GetBodyList=function(){return this.m_bodyList;},b2World.prototype.GetJointList=function(){return this.m_jointList;},b2World.prototype.GetParticleSystemList=function(){return this.m_particleSystemList;},b2World.prototype.GetContactList=function(){return this.m_contactManager.m_contactList;},b2World.prototype.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0);},b2World.prototype.GetAllowSleeping=function(){return this.m_allowSleep;},b2World.prototype.SetWarmStarting=function(t){this.m_warmStarting=t;},b2World.prototype.GetWarmStarting=function(){return this.m_warmStarting;},b2World.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t;},b2World.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics;},b2World.prototype.SetSubStepping=function(t){this.m_subStepping=t;},b2World.prototype.GetSubStepping=function(){return this.m_subStepping;},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount();},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount;},b2World.prototype.GetJointCount=function(){return this.m_jointCount;},b2World.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount;},b2World.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight();},b2World.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance();},b2World.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality();},b2World.prototype.SetGravity=function(t,e){if(void 0===e&&(e=!0),!j.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0);},b2World.prototype.GetGravity=function(){return this.m_gravity;},b2World.prototype.IsLocked=function(){return this.m_locked;},b2World.prototype.SetAutoClearForces=function(t){this.m_clearForces=t;},b2World.prototype.GetAutoClearForces=function(){return this.m_clearForces;},b2World.prototype.ShiftOrigin=function(t){if(this.IsLocked())throw new Error();for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t);},b2World.prototype.GetContactManager=function(){return this.m_contactManager;},b2World.prototype.GetProfile=function(){return this.m_profile;},b2World.prototype.Dump=function(t){if(!this.m_locked){t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");var e=0;for(var i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(var r=this.m_jointList;r;r=r.m_next)r.m_index=e,++e;for(r=this.m_jointList;r;r=r.m_next)r.m_type!==H.b2JointType.e_gearJoint&&(t("{\n"),r.Dump(t),t("}\n"));for(r=this.m_jointList;r;r=r.m_next)r.m_type===H.b2JointType.e_gearJoint&&(t("{\n"),r.Dump(t),t("}\n"));}},b2World.prototype.DrawJoint=function(t){if(null!==this.m_debugDraw){var e=t.GetBodyA();var i=t.GetBodyB();e=e.m_xf;i=i.m_xf;var r=e.p;var n=i.p;var a=t.GetAnchorA(b2World.DrawJoint_s_p1);var o=t.GetAnchorB(b2World.DrawJoint_s_p2);var s=b2World.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case H.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(a,o,s);break;case H.b2JointType.e_pulleyJoint:var c=t;var l=c.GetGroundAnchorA();c=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,a,s),this.m_debugDraw.DrawSegment(c,o,s),this.m_debugDraw.DrawSegment(l,c,s);break;case H.b2JointType.e_mouseJoint:l=b2World.DrawJoint_s_c;l.Set(0,1,0),this.m_debugDraw.DrawPoint(a,4,l),this.m_debugDraw.DrawPoint(o,4,l),l.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(a,o,l);break;default:this.m_debugDraw.DrawSegment(r,a,s),this.m_debugDraw.DrawSegment(a,o,s),this.m_debugDraw.DrawSegment(n,o,s);}}},b2World.prototype.DrawShape=function(t,e){if(null!==this.m_debugDraw){var i=t.GetShape();switch(i.m_type){case H.b2ShapeType.e_circleShape:var r=i.m_p;var n=i.m_radius;var a=j.UNITX;this.m_debugDraw.DrawSolidCircle(r,n,a,e);break;case H.b2ShapeType.e_edgeShape:var o=i.m_vertex1;var s=i.m_vertex2;this.m_debugDraw.DrawSegment(o,s,e);break;case H.b2ShapeType.e_chainShape:r=i;var h=r.m_count;var c=r.m_vertices;n=b2World.DrawShape_s_ghostColor.SetRGBA(.75*e.r,.75*e.g,.75*e.b,e.a);o=c[0];this.m_debugDraw.DrawPoint(o,4,e),r.m_hasPrevVertex&&(a=r.m_prevVertex,this.m_debugDraw.DrawSegment(a,o,n),this.m_debugDraw.DrawCircle(a,.1,n));for(var l=1;l<h;++l){s=c[l];this.m_debugDraw.DrawSegment(o,s,e),this.m_debugDraw.DrawPoint(s,4,e),o=s;}r.m_hasNextVertex&&(a=r.m_nextVertex,this.m_debugDraw.DrawSegment(a,o,n),this.m_debugDraw.DrawCircle(a,.1,n));break;case H.b2ShapeType.e_polygonShape:r=i.m_count;c=i.m_vertices;this.m_debugDraw.DrawSolidPolygon(c,r,e);}}},b2World.prototype.Solve=function(h){for(var t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(var u=this.m_controllerList;u;u=u.m_next)u.Step(h);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(var _=this.m_contactManager.m_contactList;_;_=_.m_next)_.m_islandFlag=!1;for(var d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;var i=this.s_stack;for(var r=this.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&r.IsAwake()&&r.IsActive()&&r.GetType()!==H.b2BodyType.b2_staticBody){e.Clear();var n=0;for((i[n++]=r).m_islandFlag=!0;0<n;){if(!(t=i[--n]))throw new Error();if(e.AddBody(t),t.m_awakeFlag=!0,t.GetType()!==H.b2BodyType.b2_staticBody){for(var a=t.m_contactList;a;a=a.next){var o=a.contact;if(!o.m_islandFlag&&o.IsEnabled()&&o.IsTouching()){var f=o.m_fixtureA.m_isSensor;var p=o.m_fixtureB.m_isSensor;if(!f&&!p){if(e.AddContact(o),o.m_islandFlag=!0,!(c=a.other))throw new Error();c.m_islandFlag||((i[n++]=c).m_islandFlag=!0);}}}for(var s=t.m_jointList;s;s=s.next){var c;s.joint.m_islandFlag||(c=s.other).IsActive()&&(e.AddJoint(s.joint),s.joint.m_islandFlag=!0,c.m_islandFlag||((i[n++]=c).m_islandFlag=!0));}}}var m=new cr();e.Solve(m,h,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=m.solveInit,this.m_profile.solveVelocity+=m.solveVelocity,this.m_profile.solvePosition+=m.solvePosition;for(var l=0;l<e.m_bodyCount;++l)(t=e.m_bodies[l]).GetType()===H.b2BodyType.b2_staticBody&&(t.m_islandFlag=!1);}for(l=0;l<i.length&&i[l];++l)i[l]=null;var v=new A();for(t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==H.b2BodyType.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=v.GetMilliseconds();},b2World.prototype.SolveTOI=function(h){var t=this.m_island;if(t.Initialize(64,32,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var u=this.m_bodyList;u;u=u.m_next)u.m_islandFlag=!1,u.m_sweep.alpha0=0;for(var e=this.m_contactManager.m_contactList;e;e=e.m_next)e.m_toiFlag=!1,e.m_islandFlag=!1,e.m_toiCount=0,e.m_toi=1;}for(;;){var i=null;var _=1;for(e=this.m_contactManager.m_contactList;e;e=e.m_next)if(e.IsEnabled()&&!(8<e.m_toiCount)){var d=1;if(e.m_toiFlag)d=e.m_toi;else{var f=e.GetFixtureA();var p=e.GetFixtureB();if(f.IsSensor()||p.IsSensor())continue;var r=f.GetBody();var m=p.GetBody();var n=r.m_type;var v=m.m_type;var y=r.IsAwake()&&n!==H.b2BodyType.b2_staticBody;var a=m.IsAwake()&&v!==H.b2BodyType.b2_staticBody;if(!y&&!a)continue;y=r.IsBullet()||n!==H.b2BodyType.b2_dynamicBody;a=m.IsBullet()||v!==H.b2BodyType.b2_dynamicBody;if(!y&&!a)continue;n=r.m_sweep.alpha0;r.m_sweep.alpha0<m.m_sweep.alpha0?(n=m.m_sweep.alpha0,r.m_sweep.Advance(n)):m.m_sweep.alpha0<r.m_sweep.alpha0&&(n=r.m_sweep.alpha0,m.m_sweep.Advance(n));v=e.GetChildIndexA();y=e.GetChildIndexB();a=b2World.SolveTOI_s_toi_input;a.proxyA.SetShape(f.GetShape(),v),a.proxyB.SetShape(p.GetShape(),y),a.sweepA.Copy(r.m_sweep),a.sweepB.Copy(m.m_sweep),a.tMax=1;f=b2World.SolveTOI_s_toi_output;b2TimeOfImpact(f,a);v=f.t;d=f.state===H.b2TOIOutputState.e_touching?L(n+(1-n)*v,1):1,e.m_toi=d,e.m_toiFlag=!0;}d<_&&(i=e,_=d);}if(null===i||1-10*E<_){this.m_stepComplete=!0;break;}var g=i.GetFixtureA();var b=i.GetFixtureB();var o=g.GetBody();var s=b.GetBody();g=b2World.SolveTOI_s_backup1.Copy(o.m_sweep);b=b2World.SolveTOI_s_backup2.Copy(s.m_sweep);if(o.Advance(_),s.Advance(_),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,i.IsEnabled()&&i.IsTouching()){o.SetAwake(!0),s.SetAwake(!0),t.Clear(),t.AddBody(o),t.AddBody(s),t.AddContact(i),o.m_islandFlag=!0,s.m_islandFlag=!0,i.m_islandFlag=!0;for(var C=0;C<2;++C)if((w=0===C?o:s).m_type===H.b2BodyType.b2_dynamicBody)for(var c=w.m_contactList;c&&t.m_bodyCount!==t.m_bodyCapacity&&t.m_contactCount!==t.m_contactCapacity;c=c.next){var x=c.contact;var l,A,S;x.m_islandFlag||((l=c.other).m_type!==H.b2BodyType.b2_dynamicBody||w.IsBullet()||l.IsBullet())&&(S=x.m_fixtureA.m_isSensor,A=x.m_fixtureB.m_isSensor,S||A||(S=b2World.SolveTOI_s_backup.Copy(l.m_sweep),l.m_islandFlag||l.Advance(_),x.Update(this.m_contactManager.m_contactListener),x.IsEnabled()&&x.IsTouching()?(x.m_islandFlag=!0,t.AddContact(x),l.m_islandFlag||(l.m_islandFlag=!0,l.m_type!==H.b2BodyType.b2_staticBody&&l.SetAwake(!0),t.AddBody(l))):(l.m_sweep.Copy(S),l.SynchronizeTransform())));}var T=b2World.SolveTOI_s_subStep;T.dt=(1-_)*h.dt,T.inv_dt=1/T.dt,T.dtRatio=1,T.positionIterations=20,T.velocityIterations=h.velocityIterations,T.particleIterations=h.particleIterations,T.warmStarting=!1,t.SolveTOI(T,o.m_islandIndex,s.m_islandIndex);for(C=0;C<t.m_bodyCount;++C){var w;if((w=t.m_bodies[C]).m_islandFlag=!1,w.m_type===H.b2BodyType.b2_dynamicBody){w.SynchronizeFixtures();for(c=w.m_contactList;c;c=c.next)c.contact.m_toiFlag=!1,c.contact.m_islandFlag=!1;}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break;}}else i.SetEnabled(!1),o.m_sweep.Copy(g),s.m_sweep.Copy(b),o.SynchronizeTransform(),s.SynchronizeTransform();}},b2World.prototype.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t;},b2World.prototype.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t;},b2World.Step_s_step=new lr(),b2World.Step_s_stepTimer=new A(),b2World.Step_s_timer=new A(),b2World.DrawDebugData_s_color=new C(0,0,0),b2World.DrawDebugData_s_vs=j.MakeArray(4),b2World.DrawDebugData_s_xf=new I(),b2World.QueryFixtureShape_s_aabb=new mt(),b2World.RayCast_s_input=new ft(),b2World.RayCast_s_output=new pt(),b2World.RayCast_s_point=new j(),b2World.DrawJoint_s_p1=new j(),b2World.DrawJoint_s_p2=new j(),b2World.DrawJoint_s_color=new C(.5,.8,.8),b2World.DrawJoint_s_c=new C(),b2World.DrawShape_s_ghostColor=new C(),b2World.SolveTOI_s_subStep=new lr(),b2World.SolveTOI_s_backup=new b(),b2World.SolveTOI_s_backup1=new b(),b2World.SolveTOI_s_backup2=new b(),b2World.SolveTOI_s_toi_input=new It(),b2World.SolveTOI_s_toi_output=new Bt();var Lr=b2World;function b2World(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new sr(),this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new j(),this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new cr(),this.m_island=new gr(),this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t);}var Vr=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e;};b2Controller.prototype.GetNext=function(){return this.m_next;},b2Controller.prototype.GetPrev=function(){return this.m_prev;},b2Controller.prototype.GetBodyList=function(){return this.m_bodyList;},b2Controller.prototype.AddBody=function(t){var e=new Vr(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount;},b2Controller.prototype.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error();var e=this.m_bodyList;for(;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error();e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount;},b2Controller.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0;};var Or=b2Controller;function b2Controller(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null;}__extends(b2BuoyancyController,Nr=Or),b2BuoyancyController.prototype.Step=function(h){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()){var i=new j();var r=new j();var n=0;var a=0;for(var o=e.GetFixtureList();o;o=o.m_next){var s=new j();var c=o.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),s);n+=c,i.x+=c*s.x,i.y+=c*s.y;var u;a+=c*(u=this.useDensity?o.GetDensity():1),r.x+=c*s.x*u,r.y+=c*s.y*u;}var l;i.x/=n,i.y/=n,r.x/=a,r.y/=a,n<E||((l=this.gravity.Clone().SelfNeg()).SelfMul(this.density*n),e.ApplyForce(l,r),(l=e.GetLinearVelocityFromWorldPoint(i,new j())).SelfSub(this.velocity),l.SelfMul(-this.linearDrag*n),e.ApplyForce(l,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*n*e.GetAngularVelocity()*this.angularDrag));}}}},b2BuoyancyController.prototype.Draw=function(t){var e=new j();var i=new j();e.x=this.normal.x*this.offset+100*this.normal.y,e.y=this.normal.y*this.offset-100*this.normal.x,i.x=this.normal.x*this.offset-100*this.normal.y,i.y=this.normal.y*this.offset+100*this.normal.x;var r=new C(0,0,.8);t.DrawSegment(e,i,r);};var Fr=b2BuoyancyController;function b2BuoyancyController(){var t=null!==Nr&&Nr.apply(this,arguments)||this;return t.normal=new j(0,1),t.offset=0,t.density=0,t.velocity=new j(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new j(0,0),t;}var Nr;__extends(b2ConstantAccelController,Gr=Or),b2ConstantAccelController.prototype.Step=function(t){var e=j.MulSV(t.dt,this.A,b2ConstantAccelController.Step_s_dtA);for(var i=this.m_bodyList;i;i=i.nextBody){var r=i.body;r.IsAwake()&&r.SetLinearVelocity(j.AddVV(r.GetLinearVelocity(),e,j.s_t0));}},b2ConstantAccelController.prototype.Draw=function(t){},b2ConstantAccelController.Step_s_dtA=new j();var kr=b2ConstantAccelController;function b2ConstantAccelController(){var t=null!==Gr&&Gr.apply(this,arguments)||this;return t.A=new j(0,0),t;}var Gr;__extends(b2ConstantForceController,Ur=Or),b2ConstantForceController.prototype.Step=function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter());}},b2ConstantForceController.prototype.Draw=function(t){};var zr=b2ConstantForceController;function b2ConstantForceController(){var t=null!==Ur&&Ur.apply(this,arguments)||this;return t.F=new j(0,0),t;}var Ur;__extends(b2GravityController,Hr=Or),b2GravityController.prototype.Step=function(h){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody){var e=(n=t.body).GetWorldCenter();var u=n.GetMass();for(var i=this.m_bodyList;i&&i!==t;i=i.nextBody){var r=(a=i.body).GetWorldCenter();var _=a.GetMass();(c=(o=r.x-e.x)*o+(s=r.y-e.y)*s)<E||((l=b2GravityController.Step_s_f.Set(o,s)).SelfMul(this.G/c/X(c)*u*_),n.IsAwake()&&n.ApplyForce(l,e),a.IsAwake()&&a.ApplyForce(l.SelfMul(-1),r));}}else for(t=this.m_bodyList;t;t=t.nextBody){var n;e=(n=t.body).GetWorldCenter();u=n.GetMass();for(i=this.m_bodyList;i&&i!==t;i=i.nextBody){var a;r=(a=i.body).GetWorldCenter();_=a.GetMass();var o;var s;var c;var l;(c=(o=r.x-e.x)*o+(s=r.y-e.y)*s)<E||((l=b2GravityController.Step_s_f.Set(o,s)).SelfMul(this.G/c*u*_),n.IsAwake()&&n.ApplyForce(l,e),a.IsAwake()&&a.ApplyForce(l.SelfMul(-1),r));}}},b2GravityController.prototype.Draw=function(t){},b2GravityController.Step_s_f=new j();var Wr=b2GravityController;function b2GravityController(){var t=null!==Hr&&Hr.apply(this,arguments)||this;return t.G=1,t.invSqr=!0,t;}var Hr;__extends(b2TensorDampingController,Xr=Or),b2TensorDampingController.prototype.Step=function(t){var e=t.dt;if(!(e<=E)){e>this.maxTimestep&&0<this.maxTimestep&&(e=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var r=i.body;var n;r.IsAwake()&&(n=r.GetWorldVector(g.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity(),j.s_t0),j.s_t1),b2TensorDampingController.Step_s_damping),r.SetLinearVelocity(j.AddVV(r.GetLinearVelocity(),j.MulSV(e,n,j.s_t0),j.s_t1)));}}},b2TensorDampingController.prototype.Draw=function(t){},b2TensorDampingController.prototype.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=0<t||0<e?1/V(t,e):0;},b2TensorDampingController.Step_s_damping=new j();var jr=b2TensorDampingController;function b2TensorDampingController(){var t=null!==Xr&&Xr.apply(this,arguments)||this;return t.T=new g(),t.maxTimestep=0,t;}var Xr;function iOT(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new j(0,0),this.damping=.1,this.k2=.9,this.k3=.1;}b2Rope.prototype.GetVertexCount=function(){return this.m_count;},b2Rope.prototype.GetVertices=function(){return this.m_ps;},b2Rope.prototype.Initialize=function(t){this.m_count=t.count,this.m_ps=j.MakeArray(this.m_count),this.m_p0s=j.MakeArray(this.m_count),this.m_vs=j.MakeArray(this.m_count),this.m_ims=b2MakeNumberArray(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=0<i?1/i:0;}var r=this.m_count-1;var n=this.m_count-2;this.m_Ls=b2MakeNumberArray(r),this.m_as=b2MakeNumberArray(n);for(e=0;e<r;++e){var a=this.m_ps[e];var o=this.m_ps[e+1];this.m_Ls[e]=j.DistanceVV(a,o);}for(e=0;e<n;++e){a=this.m_ps[e];o=this.m_ps[e+1];var s=this.m_ps[e+2];var c=j.SubVV(o,a,j.s_t0);s=j.SubVV(s,o,j.s_t1);var l=j.CrossVV(c,s);c=j.DotVV(c,s);this.m_as[e]=v(l,c);}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3;},b2Rope.prototype.Step=function(t,e){if(0!==t){var i=Math.exp(-t*this.m_damping);for(var r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),0<this.m_ims[r]&&this.m_vs[r].SelfMulAdd(t,this.m_gravity),this.m_vs[r].SelfMul(i),this.m_ps[r].SelfMulAdd(t,this.m_vs[r]);for(r=0;r<e;++r)this.SolveC2(),this.SolveC3(),this.SolveC2();var n=1/t;for(r=0;r<this.m_count;++r)j.MulSV(n,j.SubVV(this.m_ps[r],this.m_p0s[r],j.s_t0),this.m_vs[r]);}},b2Rope.prototype.SolveC2=function(){var t=this.m_count-1;for(var e=0;e<t;++e){var i=this.m_ps[e];var r=this.m_ps[e+1];var n=j.SubVV(r,i,b2Rope.s_d);var a=n.Normalize();var o=this.m_ims[e];var s=this.m_ims[e+1];var c;o+s!==0&&(c=s/(o+s),i.SelfMulSub(this.m_k2*(o/(o+s))*(this.m_Ls[e]-a),n),r.SelfMulAdd(this.m_k2*c*(this.m_Ls[e]-a),n));}},b2Rope.prototype.SetAngle=function(t){var e=this.m_count-2;for(var i=0;i<e;++i)this.m_as[i]=t;},b2Rope.prototype.SolveC3=function(){var h=this.m_count-2;for(var t=0;t<h;++t){var u=this.m_ps[t];var e=this.m_ps[t+1];var _=this.m_ps[t+2];var d=this.m_ims[t];var f=this.m_ims[t+1];var p=this.m_ims[t+2];var i=j.SubVV(e,u,b2Rope.s_d1);var r=j.SubVV(_,e,b2Rope.s_d2);var n=i.LengthSquared();var a=r.LengthSquared();if(n*a!=0){var o=j.CrossVV(i,r);var s=j.DotVV(i,r);var c=v(o,s);o=j.MulSV(-1/n,i.SelfSkew(),b2Rope.s_Jd1);s=j.MulSV(1/a,r.SelfSkew(),b2Rope.s_Jd2);n=j.NegV(o,b2Rope.s_J1);i=j.SubVV(o,s,b2Rope.s_J2);a=s;r=d*j.DotVV(n,n)+f*j.DotVV(i,i)+p*j.DotVV(a,a);if(0!=r){r=1/r;var l=c-this.m_as[t];for(;m<l;)l=(c-=2*m)-this.m_as[t];for(;l<-m;)l=(c+=2*m)-this.m_as[t];o=-this.m_k3*r*l;u.SelfMulAdd(d*o,n),e.SelfMulAdd(f*o,i),_.SelfMulAdd(p*o,a);}}}},b2Rope.prototype.Draw=function(t){var e=new C(.4,.5,.7);for(var i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e);},b2Rope.s_d=new j(),b2Rope.s_d1=new j(),b2Rope.s_d2=new j(),b2Rope.s_Jd1=new j(),b2Rope.s_Jd2=new j(),b2Rope.s_J1=new j(),b2Rope.s_J2=new j();var qr=b2Rope;function b2Rope(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new j(),this.m_damping=0,this.m_k2=1,this.m_k3=.1;}H.b2Assert=function(t){var e=[];for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!t)throw new(Error.bind.apply(Error,[void 0].concat(e)))();},H.b2Maybe=b2Maybe,H.b2_maxFloat=B,H.b2_epsilon=E,H.b2_epsilon_sq=y,H.b2_pi=m,H.b2_maxManifoldPoints=2,H.b2_maxPolygonVertices=8,H.b2_aabbExtension=.1,H.b2_aabbMultiplier=2,H.b2_linearSlop=M,H.b2_angularSlop=P,H.b2_polygonRadius=.016,H.b2_maxSubSteps=8,H.b2_maxTOIContacts=32,H.b2_velocityThreshold=1,H.b2_maxLinearCorrection=.2,H.b2_maxAngularCorrection=p,H.b2_maxTranslation=2,H.b2_maxTranslationSquared=4,H.b2_maxRotation=S,H.b2_maxRotationSquared=T,H.b2_baumgarte=.2,H.b2_toiBaumgarte=.75,H.b2_invalidParticleIndex=-1,H.b2_maxParticleIndex=2147483647,H.b2_particleStride=.75,H.b2_minParticleWeight=1,H.b2_maxParticlePressure=.25,H.b2_maxParticleForce=.5,H.b2_maxTriadDistance=2,H.b2_maxTriadDistanceSquared=4,H.b2_minParticleSystemBufferCapacity=256,H.b2_barrierCollisionTime=2.5,H.b2_timeToSleep=.5,H.b2_linearSleepTolerance=.01,H.b2_angularSleepTolerance=t,H.b2Alloc=function(t){return null;},H.b2Free=function(t){},H.b2Log=function(t){var e=[];for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];},H.b2Version=e,H.b2_version=i,H.b2_branch="master",H.b2_commit="fbf51801d80fc389d43dc46524520e89043b6faf",H.b2ParseInt=function(t){return parseInt(t,10);},H.b2ParseUInt=function(t){return Math.abs(parseInt(t,10));},H.b2MakeArray=b2MakeArray,H.b2MakeNullArray=function(t){var e=[];for(var i=0;i<t;++i)e.push(null);return e;},H.b2MakeNumberArray=b2MakeNumberArray,H.b2_pi_over_180=r,H.b2_180_over_pi=n,H.b2_two_pi=a,H.b2Abs=D,H.b2Min=L,H.b2Max=V,H.b2Clamp=b2Clamp,H.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i;},H.b2IsValid=o,H.b2Sq=b2Sq,H.b2InvSqrt=b2InvSqrt,H.b2Sqrt=X,H.b2Pow=s,H.b2DegToRad=function(t){return t*r;},H.b2RadToDeg=function(t){return t*n;},H.b2Cos=c,H.b2Sin=l,H.b2Acos=h,H.b2Asin=u,H.b2Atan2=v,H.b2NextPowerOfTwo=function(t){return(t=(t=(t=(t=(t|=t>>1&2147483647)|t>>2&1073741823)|t>>4&268435455)|t>>8&16777215)|t>>16&65535)+1;},H.b2IsPowerOfTwo=function(t){return 0<t&&0==(t&t-1);},H.b2Random=function(){return 2*Math.random()-1;},H.b2RandomRange=function(t,e){return(e-t)*Math.random()+t;},H.b2Vec2=j,H.b2Vec2_zero=_,H.b2Vec3=d,H.b2Mat22=g,H.b2Mat33=f,H.b2Rot=R,H.b2Transform=I,H.b2Sweep=b,H.b2Color=C,H.b2Draw=x,H.b2Timer=A,H.b2Counter=w,H.b2GrowableStack=O,H.b2BlockAllocator=t8T,H.b2StackAllocator=r8T,H.b2ContactFeature=ct,H.b2ContactID=lt,H.b2ManifoldPoint=ht,H.b2Manifold=ut,H.b2WorldManifold=_t,H.b2GetPointStates=function(t,e,i,r){var n;for(n=0;n<i.pointCount;++n){var a=i.points[n].id.key;t[n]=H.b2PointState.b2_removeState;for(var o=0,s=r.pointCount;o<s;++o)if(r.points[o].id.key===a){t[n]=H.b2PointState.b2_persistState;break;}}for(;n<2;++n)t[n]=H.b2PointState.b2_nullState;for(n=0;n<r.pointCount;++n){a=r.points[n].id.key;e[n]=H.b2PointState.b2_addState;for(o=0,s=i.pointCount;o<s;++o)if(i.points[o].id.key===a){e[n]=H.b2PointState.b2_persistState;break;}}for(;n<2;++n)e[n]=H.b2PointState.b2_nullState;},H.b2ClipVertex=dt,H.b2RayCastInput=ft,H.b2RayCastOutput=pt,H.b2AABB=mt,H.b2TestOverlapAABB=b2TestOverlapAABB,H.b2ClipSegmentToLine=b2ClipSegmentToLine,H.b2TestOverlapShape=b2TestOverlapShape,H.b2DistanceProxy=F,H.b2SimplexCache=N,H.b2DistanceInput=k,H.b2DistanceOutput=G,H.b2ShapeCastInput=D8T,H.b2ShapeCastOutput=h8T,H.b2_gjk_reset=function(){H.b2_gjkCalls=0,H.b2_gjkIters=0,H.b2_gjkMaxIters=0;},H.b2SimplexVertex=z,H.b2Simplex=U,H.b2Distance=b2Distance,H.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA;var r=e.proxyB;var h=V(i.m_radius,.016)+V(r.m_radius,.016);var n=e.transformA;var a=e.transformB;var o=e.translationB;var u=tt.Set(0,0);var _=0;var s=et;s.m_count=0;var d=s.m_vertices;var f=i.GetSupport(R.MulTRV(n.q,j.NegV(o,j.s_t1),j.s_t0));var p=I.MulXV(n,i.GetVertex(f),it);var m=r.GetSupport(R.MulTRV(a.q,o,j.s_t0));var v=I.MulXV(a,r.GetVertex(m),rt);var c=j.SubVV(p,v,nt);var y=V(.016,h-.016);var g=0;for(;g<20&&.004<D(c.Length()-y);){t.iterations+=1,f=i.GetSupport(R.MulTRV(n.q,j.NegV(c,j.s_t1),j.s_t0)),p=I.MulXV(n,i.GetVertex(f),it),m=r.GetSupport(R.MulTRV(a.q,c,j.s_t0)),v=I.MulXV(a,r.GetVertex(m),rt);var l=j.SubVV(p,v,at);c.Normalize();l=j.DotVV(c,l);var b=j.DotVV(c,o);if(_*b<l-y){if(b<=0)return!1;if(1<(_=(l-y)/b))return!1;u.Copy(c).SelfNeg(),s.m_count=0;}l=d[s.m_count];switch(l.indexA=m,l.wA.Copy(v).SelfMulAdd(_,o),l.indexB=f,l.wB.Copy(p),l.w.Copy(l.wB).SelfSub(l.wA),l.a=1,s.m_count+=1,s.m_count){case 1:break;case 2:s.Solve2();break;case 3:s.Solve3();}if(3===s.m_count)return!1;s.GetClosestPoint(c),++g;}return s.GetWitnessPoints(ot,st),0<c.LengthSquared()&&(u.Copy(c).SelfNeg(),u.Normalize()),t.normal.Copy(u),t.lambda=_,t.iterations=g,!0;},H.b2Pair=xt,H.b2BroadPhase=At,H.b2PairLessThan=b2PairLessThan,H.b2TreeNode=bt,H.b2DynamicTree=Ct,H.b2_toi_reset=function(){H.b2_toiTime=0,H.b2_toiMaxTime=0,H.b2_toiCalls=0,H.b2_toiIters=0,H.b2_toiMaxIters=0,H.b2_toiRootIters=0,H.b2_toiMaxRootIters=0;},H.b2TOIInput=It,H.b2TOIOutput=Bt,H.b2SeparationFunction=Dt,H.b2TimeOfImpact=b2TimeOfImpact,H.b2CollideCircles=b2CollideCircles,H.b2CollidePolygonAndCircle=b2CollidePolygonAndCircle,H.b2CollidePolygons=b2CollidePolygons,H.b2CollideEdgeAndCircle=b2CollideEdgeAndCircle,H.b2CollideEdgeAndPolygon=b2CollideEdgeAndPolygon,H.b2MassData=we,H.b2Shape=Ee,H.b2CircleShape=xe,H.b2PolygonShape=Se,H.b2EdgeShape=Ie,H.b2ChainShape=De,H.b2Filter=Ve,H.b2FixtureDef=Oe,H.b2FixtureProxy=Fe,H.b2Fixture=Ne,H.b2BodyDef=N9T,H.b2Body=ke,H.b2World=Lr,H.b2DestructionListener=er,H.b2ContactFilter=ir,H.b2ContactImpulse=rr,H.b2ContactListener=nr,H.b2QueryCallback=ar,H.b2RayCastCallback=or,H.b2Island=gr,H.b2Profile=cr,H.b2TimeStep=lr,H.b2Position=hr,H.b2Velocity=ur,H.b2SolverData=_r,H.b2ContactManager=sr,H.b2MixFriction=b2MixFriction,H.b2MixRestitution=b2MixRestitution,H.b2ContactEdge=Fi,H.b2Contact=Ni,H.b2ContactRegister=$i,H.b2ContactFactory=tr,H.g_blockSolve=!1,H.b2VelocityConstraintPoint=dr,H.b2ContactVelocityConstraint=fr,H.b2ContactPositionConstraint=pr,H.b2ContactSolverDef=mr,H.b2PositionSolverManifold=vr,H.b2ContactSolver=yr,H.b2CircleContact=ki,H.b2PolygonContact=zi,H.b2PolygonAndCircleContact=Wi,H.b2EdgeAndCircleContact=ji,H.b2EdgeAndPolygonContact=qi,H.b2ChainAndCircleContact=Ji,H.b2ChainAndPolygonContact=Qi,H.b2Jacobian=Ge,H.b2JointEdge=ze,H.b2JointDef=D9T,H.b2Joint=Ue,H.b2AreaJointDef=qe,H.b2AreaJoint=Je,H.b2DistanceJointDef=We,H.b2DistanceJoint=je,H.b2FrictionJointDef=Qe,H.b2FrictionJoint=$e,H.b2GearJointDef=ei,H.b2GearJoint=ri,H.b2MotorJointDef=ai,H.b2MotorJoint=si,H.b2MouseJointDef=li,H.b2MouseJoint=ui,H.b2PrismaticJointDef=di,H.b2PrismaticJoint=pi,H.b2_minPulleyLength=2,H.b2PulleyJointDef=vi,H.b2PulleyJoint=gi,H.b2RevoluteJointDef=Ci,H.b2RevoluteJoint=Ai,H.b2RopeJointDef=Ti,H.b2RopeJoint=Ei,H.b2WeldJointDef=Mi,H.b2WeldJoint=Ii,H.b2WheelJointDef=Di,H.b2WheelJoint=Vi,H.b2ControllerEdge=Vr,H.b2Controller=Or,H.b2BuoyancyController=Fr,H.b2ConstantAccelController=kr,H.b2ConstantForceController=zr,H.b2GravityController=Wr,H.b2TensorDampingController=jr,H.b2ParticleDef=br,H.b2CalculateParticleIterations=b2CalculateParticleIterations,H.b2ParticleHandle=Cr,H.b2ParticleGroupDef=xr,H.b2ParticleGroup=Ar,H.b2GrowableBuffer=wr,H.b2FixtureParticleQueryCallback=Er,H.b2ParticleContact=Mr,H.b2ParticleBodyContact=Rr,H.b2ParticlePair=Ir,H.b2ParticleTriad=Br,H.b2ParticleSystemDef=Dr,H.b2RopeDef=iOT,H.b2Rope=qr,Object.defineProperty(H,"__esModule",{value:!0});},"object"==typeof i&&void 0!==e?r(i):"function"==typeof define&&define.amd?define(["exports"],r):r((void 0).box2d={});},{}],363:[function(t,e,i){"use strict";var r="undefined"==typeof window?global:window;r.cc=r.cc||{},cc.internal=cc.internal||{},t("./predefine"),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/object"),t("./polyfill/array-buffer"),t("./polyfill/number"),t("./polyfill/typescript"),t("./cocos2d/core/predefine"),t("./cocos2d"),t("./extends"),e.exports=r.cc;},{"./cocos2d":292,"./cocos2d/core/predefine":214,"./extends":350,"./package":void 0,"./polyfill/array":365,"./polyfill/array-buffer":364,"./polyfill/misc":366,"./polyfill/number":367,"./polyfill/object":368,"./polyfill/string":369,"./polyfill/typescript":370,"./predefine":371}],364:[function(t,e,i){"use strict";var r;ArrayBuffer.isView||(r=Object.getPrototypeOf(Int8Array),ArrayBuffer.isView="function"==typeof r?function(t){return t instanceof r;}:function(t){if("object"!=typeof t)return!1;t=t.constructor;return t===Float32Array||t===Uint8Array||t===Uint32Array||t===Int8Array;});},{}],365:[function(t,e,i){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t);}),Array.prototype.find||(Array.prototype.find=function(t){var e=this.length;for(var i=0;i<e;i++){var r=this[i];if(t.call(this,r,i,this))return r;}}),Array.prototype.includes||(Array.prototype.includes=function(t){return-1!==this.indexOf(t);});},{}],366:[function(t,e,i){"use strict";var r,n;Math.sign||(Math.sign=function(t){return 0===(t=+t)||isNaN(t)?t:0<t?1:-1;}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E;}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t;}),console.time||(r=window.performance||Date,n=Object.create(null),console.time=function(t){n[t]=r.now();},console.timeEnd=function(t){var e=n[t];e=r.now()-e;console.log(t+": "+e+"ms");});},{}],367:[function(t,e,i){"use strict";Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt;},{}],368:[function(t,e,i){"use strict";Object.assign||(Object.assign=function(t,e){return cc.js.mixin(t,e);}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(t){var e={};var i=Object.getOwnPropertyNames(t);Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t)));for(var r=0;r<i.length;++r){var n=i[r];e[n]=Object.getOwnPropertyDescriptor(t,n);}return e;});},{}],369:[function(t,e,i){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.lastIndexOf(t,e=e||0)===e;}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;t=this.indexOf(t,e);return-1!==t&&t===e;}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"");});},{}],370:[function(t,e,i){"use strict";var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);};window.__extends=function(t,e){function __(){this.constructor=t;}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __());},window.__assign=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t;},window.__rest=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(i[r[n]]=t[r[n]]);return i;},window.__decorate=function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;0<=s;s--)(n=t[s])&&(o=(a<3?n(o):3<a?n(e,i,o):n(e,i))||o);return 3<a&&o&&Object.defineProperty(e,i,o),o;},window.__param=function(i,r){return function(t,e){r(t,e,i);};},window.__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e);},window.__awaiter=function(i,r,n,a){return new(n=n||Promise)(function(t,e){function fulfilled(t){try{step(a.next(t));}catch(t){e(t);}}function rejected(t){try{step(a.throw(t));}catch(t){e(t);}}function step(e){e.done?t(e.value):new n(function(t){t(e.value);}).then(fulfilled,rejected);}step((a=a.apply(i,r||[])).next());});},window.__generator=function(r,n){var a,o,s,t,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1];},trys:[],ops:[]};return t={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this;}),t;function verb(i){return function(t){var e=[i,t];if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,o=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){c=0;continue;}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){c.label=e[1];break;}if(6===e[0]&&c.label<s[1]){c.label=s[1],s=e;break;}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(e);break;}s[2]&&c.ops.pop(),c.trys.pop();continue;}e=n.call(r,c);}catch(t){e=[6,t],o=0;}finally{a=s=0;}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0};};}},window.__exportStar=function(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i]);},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return{value:(t=t&&i>=t.length?void 0:t)&&t[i++],done:!t};}};},window.__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,a=i.call(t),o=[];try{for(;(void 0===e||0<e--)&&!(r=a.next()).done;)o.push(r.value);}catch(t){n={error:t};}finally{try{r&&!r.done&&(i=a.return)&&i.call(a);}finally{if(n)throw n.error;}}return o;},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t;},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t);},window.__asyncGenerator=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=i.apply(t,e||[]),o=[];return n={},verb("next"),verb("throw"),verb("return"),n[Symbol.asyncIterator]=function(){return this;},n;function verb(r){a[r]&&(n[r]=function(i){return new Promise(function(t,e){1<o.push([r,i,t,e])||resume(r,i);});});}function resume(t,e){try{(i=a[t](e)).value instanceof __await?Promise.resolve(i.value.v).then(fulfill,reject):settle(o[0][2],i);}catch(t){settle(o[0][3],t);}var i;}function fulfill(t){resume("next",t);}function reject(t){resume("throw",t);}function settle(t,e){t(e),o.shift(),o.length&&resume(o[0][0],o[0][1]);}},window.__asyncDelegator=function(r){var t,n;return t={},verb("next"),verb("throw",function(t){throw t;}),verb("return"),t[Symbol.iterator]=function(){return this;},t;function verb(e,i){t[e]=r[e]?function(t){return(n=!n)?{value:__await(r[e](t)),done:"return"===e}:i?i(t):t;}:i;}},window.__asyncValues=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=o[Symbol.asyncIterator];return e?e.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),t={},verb("next"),verb("throw"),verb("return"),t[Symbol.asyncIterator]=function(){return this;},t);function verb(a){t[a]=o[a]&&function(n){return new Promise(function(t,e){var i,r;n=o[a](n),i=t,t=e,r=n.done,e=n.value,Promise.resolve(e).then(function(t){i({value:t,done:r});},t);});};}},window.__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t;},window.__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e;},window.__importDefault=function(t){return t&&t.__esModule?t:{default:t};};},{}],371:[function(t,e,i){"use strict";var r="undefined"==typeof window?global:window;function defineDeprecatedMacroGetter(e,i){void 0===r[e]&&Object.defineProperty(r,e,{get:function(){var t;return"CC_WECHATGAMESUB"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===e?t="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===e&&(t="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,e,t),i;}});}function defined(t){return"object"==typeof r[t];}a=!(n="CC_BUILD"),void 0===r[n]&&(r[n]=a),r.CC_BUILD=!0,r.CC_DEV=!1,r.CC_DEBUG=!0,r.CC_JSB=!1,r.CC_NATIVERENDERER=!1,r.CC_SUPPORT_JIT=!1,r.CC_PHYSICS_BUILTIN=!1,r.CC_PHYSICS_CANNON=!1,r.CC_EDITOR=!1,r.CC_PREVIEW=!1,r.CC_TEST=!1,r.CC_RUNTIME=!1,r.CC_JSB=!1;var n=!(!defined("wx")||!wx.getSharedCanvas);var a=!(!defined("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas);var o=defined("bk");defineDeprecatedMacroGetter("CC_WECHATGAMESUB",n),defineDeprecatedMacroGetter("CC_WECHATGAME",a),defineDeprecatedMacroGetter("CC_QQPLAY",o);r.CocosEngine=cc.ENGINE_VERSION="2.3.3";},{}]},{},[363]);