(window || global).regeneratorRuntime = void 0;var e = function (t, n) {
  return (e = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) {
    e.__proto__ = t;
  } || function (e, t) {
    for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]);
  })(t, n);
};function t(t, n) {
  function r() {
    this.constructor = t;
  }e(t, n), t.prototype = null === n ? Object.create(n) : (r.prototype = n.prototype, new r());
}var n = function () {
  return (n = Object.assign || function (e) {
    for (var t, n = 1, r = arguments.length; n < r; n++) for (var i in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i]);return e;
  }).apply(this, arguments);
};function r(e, t, n, r) {
  return new (n || (n = Promise))(function (i, s) {
    function o(e) {
      try {
        c(r.next(e));
      } catch (e) {
        s(e);
      }
    }function a(e) {
      try {
        c(r.throw(e));
      } catch (e) {
        s(e);
      }
    }function c(e) {
      e.done ? i(e.value) : new n(function (t) {
        t(e.value);
      }).then(o, a);
    }c((r = r.apply(e, t || [])).next());
  });
}function i(e, t) {
  var n,
      r,
      i,
      s,
      o = { label: 0, sent: function () {
      if (1 & i[0]) throw i[1];return i[1];
    }, trys: [], ops: [] };return s = { next: a(0), throw: a(1), return: a(2) }, "function" == typeof Symbol && (s[Symbol.iterator] = function () {
    return this;
  }), s;function a(s) {
    return function (a) {
      return function (s) {
        if (n) throw new TypeError("Generator is already executing.");for (; o;) try {
          if (n = 1, r && (i = 2 & s[0] ? r.return : s[0] ? r.throw || ((i = r.return) && i.call(r), 0) : r.next) && !(i = i.call(r, s[1])).done) return i;switch (r = 0, i && (s = [2 & s[0], i.value]), s[0]) {case 0:case 1:
              i = s;break;case 4:
              return o.label++, { value: s[1], done: !1 };case 5:
              o.label++, r = s[1], s = [0];continue;case 7:
              s = o.ops.pop(), o.trys.pop();continue;default:
              if (!(i = o.trys, (i = i.length > 0 && i[i.length - 1]) || 6 !== s[0] && 2 !== s[0])) {
                o = 0;continue;
              }if (3 === s[0] && (!i || s[1] > i[0] && s[1] < i[3])) {
                o.label = s[1];break;
              }if (6 === s[0] && o.label < i[1]) {
                o.label = i[1], i = s;break;
              }if (i && o.label < i[2]) {
                o.label = i[2], o.ops.push(s);break;
              }i[2] && o.ops.pop(), o.trys.pop();continue;}s = t.call(e, o);
        } catch (e) {
          s = [6, e], r = 0;
        } finally {
          n = i = 0;
        }if (5 & s[0]) throw s[1];return { value: s[0] ? s[1] : void 0, done: !0 };
      }([s, a]);
    };
  }
}function s() {
  for (var e = 0, t = 0, n = arguments.length; t < n; t++) e += arguments[t].length;var r = Array(e),
      i = 0;for (t = 0; t < n; t++) for (var s = arguments[t], o = 0, a = s.length; o < a; o++, i++) r[i] = s[o];return r;
}var o = function (e) {
  return "[SDK] " + e;
};function a(e) {
  for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];console.log.apply(console, s([o(e)], t));
}function c(e) {
  for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];console.info.apply(console, s([o(e)], t));
}function u(e) {
  for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];console.warn.apply(console, s([o(e)], t));
}var h = "4.1.0",
    d = "wx",
    f = "new_promise",
    l = "2/24/2021, 5:49:11 PM";var p = "object" == typeof window.tt && "object" == typeof window.wx && window.tt === window.wx ? (u("当前为头条环境, 但是使用的是微信sdk, 请使用头条sdk"), "tt") : "object" == typeof window.wx ? "wx" : "debug",
    g = { errCode: 500, errMsg: "未知错误" },
    v = { errCode: 1e3, errMsg: "网络错误" };function m(e) {
  var t = this;this.data = e, this._stopped = !1, this.stopPropagation = function () {
    t._stopped = !0;
  }, this.isStopped = function () {
    return t._stopped;
  };
}var _,
    w,
    y,
    I = {},
    T = { _on: function (e, t, n, r) {
    if (void 0 === n && (n = 0), void 0 === r && (r = !1), t) {
      var i = I[e] || [];i.push({ priority: n, listener: t, once: r }), I[e] = i.sort(function (e, t) {
        return e.priority < t.priority ? 1 : e.priority > t.priority ? -1 : 0;
      });
    }
  }, once: function (e, t, n) {
    void 0 === n && (n = 0), this._on(e, t, n, !0);
  }, on: function (e, t, n) {
    void 0 === n && (n = 0), this._on(e, t, n, !1);
  }, off: function (e, t) {
    var n = I[e];n && (n = n.filter(function (e) {
      return e.listener !== t;
    }), I[e] = n);
  }, dispatch: function (e, t) {
    this._dispatch(e, t);
  }, _dispatch: function (e, t) {
    var n = I[e];if (n && !(n.length <= 0)) for (var r = new m(t), i = 0; i < n.length; i++) {
      var s = n[i];try {
        s.listener(r);
      } catch (t) {
        u("EventBus invoke '" + e + "' exception: ", t);
      }if (s.once && this.off(e, s.listener), r.isStopped()) break;
    }
  } },
    S = { _inited: !1, init: function (e) {
    return !!this._checkValid(e) && (this.config = e, this._print(e), T.dispatch("EVT_SDK_READY", this.config), !0);
  }, sdkConfig: function () {
    return this.config || {};
  }, _checkValid: function (e) {
    return this._inited ? (u("already initiated"), !1) : this._checkConfigValid(e) ? (this._inited = !0, !0) : (function (e) {
      for (var t = [], n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];console.error.apply(console, s([o(e)], t));
    }("initiate failed, please check config!"), !1);
  }, _checkConfigValid: function (e) {
    return e.env && e.gameId && e.gameVersion;
  }, _print: function (e) {
    c("/*************************/"), c(" SDK(" + h + ") initiated"), c(" TagTime: " + l), c(" Platform: " + d), c(" ApiType: " + f), c(" Env: " + e.env), c(" GameID: " + e.gameId), c(" GameVersion: " + e.gameVersion), c("/*************************/");
  } };function b(e) {
  return "https://" + e + ".hortorgames.com";
}var E = { host: { prod: "wxmini", test: "wxmini-test", dev: "wxmini-dev" }, server: { prod: "platform", test: "platform-test", dev: "platform-dev" }, log: { prod: "wxmini-log", test: "wxmini-test", dev: "wxmini-dev" } },
    C = { HOST: (_ = {}, _.Prod = b(E.host.prod), _.Test = b(E.host.test), _.Dev = b(E.host.dev), _), HOST_SERVER: (w = {}, w.Prod = b(E.server.prod), w.Test = b(E.server.test), w.Dev = b(E.server.dev), w), HOST_LOG: (y = {}, y.Prod = b(E.log.prod), y.Test = b(E.log.test), y.Dev = b(E.log.dev), y) },
    O = function () {
  var e = S.sdkConfig() && S.sdkConfig().env || "Prod",
      t = C.HOST;return (void 0 === t ? {} : t)[e];
},
    k = function () {
  var e = S.sdkConfig() && S.sdkConfig().env || "Prod",
      t = C.HOST_SERVER;return (void 0 === t ? {} : t)[e];
},
    A = function () {
  var e = S.sdkConfig() && S.sdkConfig().env || "Prod",
      t = C.HOST_LOG;return (void 0 === t ? {} : t)[e];
},
    x = window || global || {};x.$__sdk__ || (x.$__sdk__ = {});var D = { platform: x.$__sdk__.platform },
    R = { request: function (e, t, n, s, o, a) {
    return void 0 === a && (a = !0), r(this, void 0, void 0, function () {
      var r, c, h, d, f, l, p;return i(this, function (i) {
        switch (i.label) {case 0:
            r = null, i.label = 1;case 1:
            return i.trys.push([1, 3,, 4]), c = Object.assign({}, o, { "content-type": a ? "application/json" : "application/x-www-form-urlencoded" }), h = this._jointQuery(t, n || {}), [4, D.platform.network.request(e, h, s, c)];case 2:
            return d = i.sent(), f = d.data, l = void 0 === f ? {} : f, this._checkRespValid(d) ? [2, { meta: l.meta, data: l.data }] : (r = l.meta, [3, 4]);case 3:
            return u("request get failed", p = i.sent()), r = p, [3, 4];case 4:
            return [4, this._onFailed(r)];case 5:
            return [2, i.sent()];}
      });
    });
  }, get: function (e, t) {
    return void 0 === t && (t = null), this.request("GET", e, t);
  }, post: function (e, t, n) {
    return void 0 === n && (n = null), this.request("POST", e, n, t, {}, !0);
  }, postForm: function (e, t, n) {
    return void 0 === n && (n = null), this.request("POST", e, n, t, {}, !1);
  }, _onFailed: function (e) {
    var t = e && e.errCode ? e : v;return a("--- net error ---", e, t), Promise.reject(t);
  }, _checkRespValid: function (e) {
    return 200 === e.statusCode && e.data && (!e.data.meta || 0 === e.data.meta.errCode);
  }, _jointQuery: function (e, t) {
    return Object.keys(t).forEach(function (n, r) {
      var i = 0 === r && e.indexOf("?") < 0 ? "?" : "&";e += "" + i + n + "=" + t[n];
    }), e;
  } },
    P = { isFun: function (e) {
    return "function" == typeof e;
  }, isNull: function (e) {
    return null == e;
  }, toNStr: function (e, t) {
    return void 0 === t && (t = ""), "string" == typeof e ? e : this.toStr(e, t);
  }, toStr: function (e, t) {
    if (void 0 === t && (t = ""), this.isNull(e)) return t;try {
      return JSON.stringify(e);
    } catch (e) {
      return t;
    }
  }, toNumber: function (e, t) {
    void 0 === t && (t = 0);try {
      return Number(e) || t;
    } catch (e) {
      return t;
    }
  }, toBoolean: function (e, t) {
    void 0 === t && (t = !1);try {
      return !!JSON.parse(e);
    } catch (n) {
      return !!e || t;
    }
  }, toObject: function (e, t) {
    void 0 === t && (t = void 0);try {
      return JSON.parse(e);
    } catch (e) {
      return t;
    }
  }, isEmpty: function (e) {
    return this.isNull(e) || "" === e;
  }, wait: function (e) {
    return new Promise(function (t) {
      setTimeout(t, e);
    });
  }, toLine: function (e) {
    return e.replace(/([A-Z])/g, "_$1").toLowerCase();
  }, startsWith: function (e, t) {
    return e.slice(0, t.length) === t;
  }, endsWith: function (e, t) {
    return -1 !== e.indexOf(t, e.length - t.length);
  }, generateGuid: function () {
    for (var e = [], t = "0123456789abcdef", n = 0; n < 36; ++n) e[n] = t.substr(Math.floor(16 * Math.random()), 1);return e[14] = "4", e[19] = t.substr(3 & e[19] | 8, 1), e[8] = e[13] = e[18] = e[23] = "-", e.join("");
  } };function U() {
  this.timer = null;
}U.prototype = { setTimer: function (e) {
    this.timer = e;
  }, getTimer: function () {
    return this.timer;
  } };var L = { getTime: function () {
    return Date.now();
  }, getTimeSec: function () {
    return Math.floor(this.getTime() / 1e3);
  }, todayStart: function (e) {
    var t = e ? new Date(e) : new Date();return new Date(t.getFullYear(), t.getMonth(), t.getDate()).getTime();
  }, toMSecond: function (e) {
    return 3600 * e * 1e3;
  }, resetInterval: function (e, t) {
    var n = new U();return n.setTimer(setTimeout(function r() {
      e && !1 !== e() && n.setTimer(setTimeout(r, t));
    }, t)), n;
  }, reclearInterval: function (e) {
    var t = e && e.getTimer ? e.getTimer() : null;t && (clearTimeout(t), e.setTimer(null));
  } },
    V = { geVersion: function (e, t) {
    return this._compareVersion(e, t) >= 0;
  }, ltVersion: function (e, t) {
    return this._compareVersion(e, t) < 0;
  }, _compareVersion: function (e, t) {
    for (var n = e.split("."), r = t.split("."), i = Math.max(n.length, r.length), s = 0; s < i; s++) {
      var o = parseInt(n[s], 10) || 0,
          a = parseInt(r[s], 10) || 0;if (o > a) return 1;if (o < a) return -1;
    }return 0;
  } },
    N = { reset: function (e, t) {
    var n = Object.assign({}, e);return Object.keys(t || {}).forEach(function (r) {
      P.isNull(e[r]) && !P.isNull(t[r]) && (n[r] = t[r]);
    }), n;
  }, copy: function (e, t) {
    if (void 0 === t && (t = []), P.isNull(e)) return {};var n = {};return Object.keys(e).forEach(function (r) {
      t && t.indexOf(r) > -1 || P.isNull(e[r]) || (n[r] = e[r]);
    }), n;
  }, deepCopyTo: function (e, t, n, r, i) {
    var s = this;return void 0 === n && (n = 0), void 0 === r && (r = []), void 0 === i && (i = 0), null === e || "object" != typeof e || !t || 0 !== n && i >= n ? e : (Object.keys(e).forEach(function (o) {
      r && r.indexOf(o) > -1 || (t[o] = s.deepCopyTo(e[o], t[o], n, r, ++i));
    }), t);
  }, queryToJson: function (e) {
    if (P.isEmpty(e)) return {};try {
      var t = {};return decodeURIComponent(e).split("&").forEach(function (e) {
        if (e && e.split) {
          var n = e.split("=");t[n[0]] = n[1];
        }
      }), t;
    } catch (e) {
      return {};
    }
  }, jsonToQuery: function (e, t) {
    if (P.isNull(e)) return "";try {
      var n = [];return Object.keys(e).forEach(function (r) {
        if (!P.isNull(e[r])) {
          var i = t ? encodeURIComponent(e[r]) : e[r];n.push(r + "=" + i);
        }
      }), n.join("&");
    } catch (e) {
      return "";
    }
  }, addToQuery: function (e, t) {
    var n = this.queryToJson(e),
        r = this.reset(n, t);return this.jsonToQuery(r);
  }, defineProperty: function (e, t, n) {
    if (e) {
      var r = "function" == typeof e[t] ? e[t].bind(e) : e[t];Object.defineProperty(e, t, { value: n(r) });
    }
  } },
    M = n(n(n(n(n({}, P), L), V), { pkgError: function (e, t) {
    return { errCode: e && e.errCode || t.errCode, errMsg: e && (e.errMsg || e.message) || t.errMsg };
  } }), N),
    q = { getString: function (e, t) {
    return void 0 === t && (t = ""), this._get(e, function (e) {
      return M.toStr(e, t);
    });
  }, getNumber: function (e, t) {
    return void 0 === t && (t = 0), this._get(e, function (e) {
      return M.toNumber(e, t);
    });
  }, getBoolean: function (e, t) {
    return void 0 === t && (t = !1), this._get(e, function (e) {
      return M.toBoolean(e, t);
    });
  }, get: function (e, t) {
    return void 0 === t && (t = void 0), this._get(e, function (e) {
      return M.toObject(e, t);
    });
  }, set: function (e, t) {
    return this._set(e, t);
  }, remove: function (e) {
    return D.platform.storage.removeStorage(e);
  }, clear: function () {
    return D.platform.storage.clearStorage();
  }, _get: function (e, t) {
    return t(D.platform.storage.getStorage(e));
  }, _set: function (e, t) {
    var n = M.toStr(t);return D.platform.storage.setStorage(e, n);
  } },
    H = {};function F(e, t) {
  var n = H[e] || [];n.push(t), H[e] = n;
}function G(e, t) {
  return r(this, void 0, void 0, function () {
    var n, r, s, o;return i(this, function (i) {
      switch (i.label) {case 0:
          if (!(n = this.getProcessors(e))) return [2, t];r = {}, s = 0, i.label = 1;case 1:
          return s < n.length ? [4, n[s](t)] : [3, 4];case 2:
          o = i.sent(), r = Object.assign(r, o || {}), i.label = 3;case 3:
          return s++, [3, 1];case 4:
          return [2, r];}
    });
  });
}var j = T,
    K = D,
    B = a,
    W = R,
    z = { _logs: [], _delayer: void 0, post: function (e, t) {
    void 0 === t && (t = !1), e && (this._logs.push(e), t ? this._report() : this._delayReport());
  }, _init: function () {
    j.on("EVT_REPORT_LOG", this._onReport.bind(this));
  }, _onReport: function (e) {
    var t = e.data || {},
        n = t.log,
        r = t.immediate;this.post(n, r);
  }, _report: function () {
    var e = this._logs;this._logs = [];var t = K.platform.information,
        n = t.getUserInfo() || {},
        r = n.userId,
        i = n.uniqueId,
        s = t.getConfig(),
        o = { gameId: s.gameId, userId: r, uniqueId: i, gameVersion: s.gameVersion, sysInfo: t.getSystemStr(), logs: e },
        a = function () {
      var e = A() + "/mini/api/v1/log/multi";W.post(e, o).then(function () {
        B("log zcz success", o);
      }).catch(function (e) {
        B("log zcz fail", e);
      });
    };S.sdkConfig() && S.sdkConfig().env ? (B("normal report"), a()) : j.once("EVT_SDK_READY", function () {
      B("sdk ready report"), a();
    });
  }, _delayReport: function () {
    var e = this;if (!this._delayer) {
      var t = (K.platform.information.getConfig() || {}).logReportFrequency,
          n = void 0 === t ? 5e3 : t;this._delayer = setTimeout(function () {
        e._report(), e._delayer = null;
      }, n);
    }
  } };z._init();var Q = { post: z.post.bind(z) };function J(e) {
  return void 0 === e && (e = {}), Q.post(e.data, e.immediate);
}var Y = { AggrType: { SWITCH: "customSwitch", IP_REGION: "ipregion", SHARE: "share" }, post: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a, c, u, h, d, f, l, p, g;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = S.sdkConfig(), n = t.gameId, r = t.gameVersion, s = D.platform.information, o = s.getUserInfo() || {}, a = o.uniqueId, c = o.userId, u = o.name, h = s.getSystemStr(), [4, G("PROC_PRE_AGGR", e)];case 1:
            return d = i.sent(), f = Object.keys(d), l = { gameId: n, gameVersion: r, openId: c, uniqueId: a, userId: a, servers: f, nickName: u || "", params: d, sysInfo: h }, p = k() + "/platform-gateway-server/api/v1/aggr", [4, R.post(p, l)];case 2:
            return g = i.sent(), [4, this._renderResult(g.data, d)];case 3:
            return [2, i.sent()];}
      });
    });
  }, _renderResult: function (e, t) {
    return r(this, void 0, void 0, function () {
      var n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return n = e || {}, r = {}, Object.keys(n).forEach(function (e) {
              var t = { data: null, err: null },
                  i = n[e] || {},
                  s = i.data,
                  o = i.meta;o && o.errCode ? t.err = o : t.data = s, r[e] = t;
            }), [4, G("PROC_REQ_AGGR", { req: t, resp: r })];case 1:
            return s = i.sent(), [2, Object.assign(r, s)];}
      });
    });
  } };function X() {
  return Promise.resolve({ type: Y.AggrType });
}function $(e) {
  return Y.post(e);
}var Z = function (e) {
  return S.init(e);
};function ee(e) {
  return Z(e);
}var te = { getExtUserInfo: function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return e = S.sdkConfig().gameId, t = D.platform.information, n = (t.getUserInfo() || {}).uniqueId, r = { userId: n, gameId: e }, s = k() + "/wechat/user-info", [4, R.get(s, r)];case 1:
            return [2, i.sent().data];}
      });
    });
  } };function ne() {
  return te.getExtUserInfo();
}var re = { init: function () {
    F("PROC_PRE_AGGR", this._processAggr.bind(this));
  }, checkIps: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a, c, u, h;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = e.interfaceIds, n = e.userId, r = S.sdkConfig(), s = r.gameId, o = r.gameVersion, a = D.platform.information, c = (a.getUserInfo() || {}).uniqueId, u = { gameId: s, gameVersion: o, interfaceIds: t || [], userId: n || c }, h = k() + "/ipregion/api/v1/blockstatus/multi", [4, R.post(h, u)];case 1:
            return [2, i.sent().data];}
      });
    });
  }, _processAggr: function (e) {
    if (!e || !e.ipregion) return null;var t = (D.platform.information.getUserInfo() || {}).uniqueId,
        n = Object.assign({}, e.ipregion);return e.ipregion.userId || (n = Object.assign(n, { userId: t || "" })), { ipregion: n };
  } };function ie(e) {
  return re.checkIps(e);
}re.init();var se = { Text: 1, Image: 2, Scroll: 4 },
    oe = se.Text | se.Image,
    ae = { NoticeTypes: se, getNotice: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = S.sdkConfig().gameId, n = Object.assign({}, { gameId: t, tp: oe }, e || {}), r = k() + "/capi/v1/notice", [4, R.get(r, n)];case 1:
            return [2, i.sent().data];}
      });
    });
  } };function ce(e) {
  return void 0 === e && (e = {}), ae.getNotice(e);
}var ue = { ERROR: "error", WARN: "warn", DEBUG: "debug" },
    he = { LOG_TP: ue, init: function () {
    var e = this;T.on("EVT_LOGIN_FAIL", function (t) {
      e.postLog(ue.ERROR, t.data);
    }), T.on("EVT_ON_ERROR", function (t) {
      e.postLog(ue.ERROR, t.data);
    });
  }, postLog: function (e, t, n) {
    t && "object" == typeof t && !n && (n = t, t = "");var r = n || {},
        i = r.msg,
        s = r.errMsg,
        o = r.message,
        c = r.logTp,
        u = t || i || o || s;a(e + ": " + u, n);var h = D.platform.information,
        d = h.getUserInfo() || {},
        f = d.userId,
        l = d.uniqueId,
        p = h.getConfig(),
        g = p.gameId,
        v = p.gameVersion,
        m = h.getSystemStr(),
        _ = Object.assign({ msg: u, logTp: c, gameId: g, gameVersion: v, userId: f, uniqueId: l, sysInfo: m, hortorMsg: u, hortorLogTp: e }, n || {}),
        w = k() + "/wxlog/api/v1/log";R.post(w, _).then(function () {
      a("log remote success");
    }).catch(function (e) {
      a("log remote fail", e);
    });
  } };function de(e) {
  void 0 === e && (e = {}), he.postLog(he.LOG_TP.DEBUG, e.msg, e.data);
}function fe(e) {
  void 0 === e && (e = {}), he.postLog(he.LOG_TP.WARN, e.msg, e.data);
}function le(e) {
  void 0 === e && (e = {}), he.postLog(he.LOG_TP.ERROR, e.msg, e.data);
}he.init();var pe,
    ge,
    ve,
    me = { init: function () {
    F("PROC_PRE_AGGR", this._processAggr.bind(this)), F("PROC_REQ_AGGR", this._processAggrReq.bind(this));
  }, _renderSwitches: function (e) {
    var t = [];return e.map(function (e) {
      if (e) {
        var n = "string" == typeof e ? e : e.switchId;t.some(function (e) {
          return e.switchId === n;
        }) || t.push({ switchId: n });
      }
    }), t;
  }, _renderParams: function (e) {
    var t = {};if (e) for (var n in e) {
      var r = e[n];void 0 !== r && "nickName" !== n && (t[n] = r);
    }return t;
  }, _getRequestData: function (e, t) {
    var n = (t || {}).nickName,
        r = D.platform.information,
        i = r && r.getUserInfo() || {},
        s = i.userId,
        o = i.uniqueId,
        a = i.name,
        c = i.channel,
        u = r && r.getLaunchOpts() || {},
        h = u.scene,
        d = u.custom.channel,
        f = S.sdkConfig();return { gameId: f.gameId, gameVersion: f.gameVersion, nickName: n || a || "", uniqueId: o, channel: c, openId: s, scene: h, currentChannel: d, defCustomParams: this._renderParams(t), switches: this._renderSwitches(e) };
  }, _transformResult: function (e, t) {
    var n = (e || {}).rlt,
        r = void 0 === n ? [] : n,
        i = {};return t.map(function (e, t) {
      i[e.switchId] = !!r[t];
    }), a("switch result", i), i;
  }, _processAggr: function (e) {
    if (!e || !e.customSwitch) return null;var t = e.customSwitch,
        n = t.switches,
        r = t.params;return { customSwitch: this._getRequestData(n, r) };
  }, _processAggrReq: function (e) {
    if (!(e && e.resp && e.req && e.req.customSwitch && e.resp.customSwitch)) return null;var t = e.req.customSwitch.switches,
        n = e.resp.customSwitch.data;return { customSwitch: { data: this._transformResult(n, t) } };
  }, check: function (e, t) {
    return r(this, void 0, void 0, function () {
      var n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return n = k() + "/custom-switch/api/v1/switch/multi/status", r = this._getRequestData(e, t), [4, R.post(n, r)];case 1:
            return s = i.sent(), [2, this._transformResult(s.data, r.switches)];}
      });
    });
  } };function _e(e) {
  return me.check(e.switches, e.params);
}function we(e, t) {
  var n = ye().SDKVersion;return !(!wx[e] || !M.geVersion(n, t));
}function ye() {
  return ge || ((ge = wx.getSystemInfoSync()).hortorSDKVersion = h), ge || {};
}function Ie() {
  if (!ve) {
    var e = ye();ve = JSON.stringify({ SDKVersion: e.SDKVersion, brand: e.brand, model: e.model, system: e.system, version: e.version, screenHeight: e.screenHeight, screenWidth: e.screenWidth, pixelRatio: e.pixelRatio, benchmarkLevel: e.benchmarkLevel, hortorSDKVersion: e.hortorSDKVersion });
  }return ve;
}function Te() {
  return r(this, void 0, void 0, function () {
    return i(this, function (e) {
      switch (e.label) {case 0:
          return pe ? [3, 2] : (we("offNetworkStatusChange", "2.8.1") && M.defineProperty(wx, "offNetworkStatusChange", be), Se(), [4, new Promise(function (e, t) {
            wx.getNetworkType({ success: e, fail: t });
          })]);case 1:
          pe = e.sent(), e.label = 2;case 2:
          return [2, pe];}
    });
  });
}function Se() {
  var e;e = function (e) {
    pe = e;
  }, M.isFun(e) && we("onNetworkStatusChange", "1.1.0") && wx.onNetworkStatusChange(e);
}function be(e) {
  return function (t) {
    M.isFun(e) && e(t), Se();
  };
}me.init();var Ee = we("createBannerAd", "2.0.4"),
    Ce = we("createRewardedVideoAd", "2.0.4"),
    Oe = we("createRewardedVideoAd", "2.8.0"),
    ke = we("createInterstitialAd", "2.6.0"),
    Ae = we("createGridAd", "2.9.2");var xe,
    De = { errCode: 1001, errMsg: "微信Code获取失败" },
    Re = { errCode: 1002, errMsg: "支付取消" },
    Pe = { errCode: 1003, errMsg: "支付失败" },
    Ue = { errCode: 1005, errMsg: "拒绝授权获取用户信息" },
    Le = { errCode: 1006, errMsg: "需要用户授权" },
    Ve = { errCode: 1007, errMsg: "获取用户信息失败" },
    Ne = { errCode: 20002, errMsg: "订单数据不全，请传入创建订单返回的全部数据" },
    Me = { errCode: 20008, errMsg: "当前版本不支持使用动态分享" },
    qe = { errCode: 20009, errMsg: "频繁调用分享" },
    He = { errCode: 20005, errMsg: "获取分享数据失败" },
    Fe = { errCode: 3e4, errMsg: "方法暂不支持" },
    Ge = { errCode: 30001, errMsg: "传参错误" },
    je = { errCode: 30002, errMsg: "未登录" },
    Ke = { errCode: 30003, errMsg: "已销毁" },
    Be = { errCode: 20013, errMsg: "录音时长太短" },
    We = { errCode: 1004, errMsg: "暂无广告" },
    ze = { errCode: 1005, errMsg: "微信广告单元id参数必填" },
    Qe = { errCode: 1006, errMsg: "无效hortor视频广告" },
    Je = { SUC: "success", FAIL: "fail", AUTO: void 0 };function Ye() {
  return wx.getLaunchOptionsSync();
}function Xe(e) {
  wx.onShow(e);
}function $e(e) {
  wx.onHide(e);
}function Ze(e) {
  wx.onError(e);
}function et() {
  T.on("EVT_ON_SHOW", rt), Ze(function (e) {
    T.dispatch("EVT_ON_ERROR", e);
  });
}function nt() {
  return xe || it(Ye()), xe;
}function rt(e) {
  it(e.data);
}function it(e) {
  a("onShow", e), xe = n(n({}, e), { custom: st(e) });
}function st(e) {
  var t = (e || {}).query,
      n = void 0 === t ? {} : t,
      r = { channel: n.channel || n.c || "hortor", origChannel: n.origChannel || "", shareConfigId: n.shareConfigId || "", activityId: n.activityId || "", h_shareCode: n.h_shareCode || "", pageQuery: n.scene || "", boxCode: n.wallCode || n.horwall || "" },
      i = M.queryToJson(n.scene);return r.channel = i.channel || i.c || r.channel, r.origChannel = i.origChannel || r.origChannel, r.boxCode = i.wallCode || i.horwall || r.boxCode, r;
}function ot() {
  return nt() || {};
}function at() {
  return S.sdkConfig() || {};
}et();var ct = { create: function (e) {
    var t = e.adUnitId,
        n = function (e) {
      return Ee ? wx.createBannerAd(e) : null;
    }(e);return n && (M.defineProperty(n, "show", this._showHandler.bind(this, t)), M.defineProperty(n, "hide", this._hideHandler.bind(this, t)), n.onError(function (e) {
      a("banner ad err", e);
    })), n;
  }, _showHandler: function (e, t) {
    var n = this;return function () {
      return new Promise(function (r, i) {
        n._postLog(e, 28), t().then(function (t) {
          r(t), a("banner ad show"), n._postLog(e, 21);
        }).catch(function (e) {
          i(e), a("banner ad show fail", e);
        });
      });
    };
  }, _hideHandler: function (e, t) {
    var n = this;return function (r) {
      t(r), a("banner ad hide"), n._postLog(e, 22);
    };
  }, _postLog: function (e, t) {
    var n = ot(),
        r = n.scene,
        i = { adUnitId: e, logType: t, channel: (n.custom || {}).channel, scene: r };T.dispatch("EVT_REPORT_LOG", { log: i });
  } };function ut(e) {
  var t = (e || {}).adUnitId;return this.options = e || {}, this.adUnitId = t, this.adInstance = null, this.destroyed = !1, this.create(e), this;
}ut.prototype = { bindedOnClose: null, injectKeys: ["Close", "Error", "Load"], injectHandlers: {}, create: function (e) {
    var t,
        n = (t = e, ke ? wx.createInterstitialAd(t) : null);return n && (M.defineProperty(n, "show", this._showHandler.bind(this)), M.defineProperty(n, "destroy", this._destroyHandler.bind(this)), M.defineProperty(n, "offClose", this._offCloseHandler.bind(this)), this.adInstance = n, this._bindOnClose(), n.onError(function (e) {
      a("interstitial ad err", e);
    })), n;
  }, destroy: function () {
    !this.destroyed && this.adInstance && (this.destroyed = !0, this.adInstance.destroy(), this.adInstance = null);
  }, setOptions: function (e) {
    var t = this;e && (this.options = e, this.injectKeys.forEach(function (n) {
      var r = "on" + n;M.isFun(e[r]) && (t.options = t.options || {}, t.options[r] = e[r]);
    }));
  }, bindHandlers: function () {
    var e = this;this.adInstance && this.injectKeys.forEach(function (t) {
      var n = "on" + t,
          r = function (t) {
        e.options && M.isFun(e.options[n]) && e.options[n](t);
      };e.injectHandlers[n] = r, e.adInstance[n] && e.adInstance[n](r);
    });
  }, unbindHandlers: function () {
    var e = this;this.adInstance && (this.injectKeys.forEach(function (t) {
      var n = "off" + t,
          r = "on" + t,
          i = e.injectHandlers[r];e.adInstance[n] && i && e.adInstance[n](i);
    }), this.options = null, this.injectHandlers = {});
  }, _showHandler: function (e) {
    var t = this;return function () {
      return new Promise(function (n, r) {
        M.isFun(e) || r(Fe), t._postLog(25), e().then(function (e) {
          n(e), t._postLog(26), t._stdInterstitialAdLog(!0);
        }).catch(function (e) {
          r(e), t._stdInterstitialAdLog(!1, e.errCode), a("interstitial ad show fail", e);
        });
      });
    };
  }, _stdInterstitialAdLog: function (e, t) {
    void 0 === t && (t = 0), a("interstitial this.options", this.options);var n = this.options,
        r = n.adUnitId,
        i = n.sequenceInfo;T.dispatch("EVT_INTERSTITIAL_AD_SHOW", { adUnitId: r, isEnded: e, playFailCode: t, spentTime: 0, sequenceInfo: i, adType: 1 });
  }, _destroyHandler: function (e) {
    var t = this;return function (n) {
      t._unbindOnClose(), t.destroyed = !0, t.adInstance = null, M.isFun(e) && e(n);
    };
  }, _offCloseHandler: function (e) {
    var t = this;return function (n) {
      M.isFun(e) && (e(n), n || t.destroyed || (t._unbindOnClose(), t._bindOnClose()));
    };
  }, _unbindOnClose: function () {
    var e = this.adInstance;this.bindedOnClose && e && M.isFun(e.offClose) && e.offClose(this.bindedOnClose), this.bindedOnClose = null;
  }, _bindOnClose: function () {
    var e = this,
        t = this.adInstance;!this.bindedOnClose && t && M.isFun(t.onClose) && (this.bindedOnClose = function () {
      a("interstitial ad close"), e._postLog(27);
    }, t.onClose(this.bindedOnClose));
  }, _postLog: function (e) {
    var t = ot(),
        n = t.scene,
        r = (t.custom || {}).channel;T.dispatch("EVT_REPORT_LOG", { log: { adUnitId: this.adUnitId, logType: e, channel: r, scene: n } });
  } };var ht = {},
    dt = { create: function (e) {
    return new ut(e).adInstance;
  }, createAdManager: function (e) {
    var t = e.adUnitId,
        n = new ut(e);return n.bindHandlers(), ht[t] = n, n;
  }, preLoad: function (e) {
    return r(this, void 0, void 0, function () {
      var t,
          n = this;return i(this, function (r) {
        if (!(t = e.adUnitIds) || !t.length) throw Ge;if (!ke) throw Fe;return t.forEach(function (e) {
          ht[e] = ht[e] || n.createAdManager({ adUnitId: e });
        }), a("preLoad ad success"), [2, ht];
      });
    });
  }, show: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            if (a("show interstitial ad ", e), t = e.adUnitId, (n = ht[t] || this.createAdManager(e)).setOptions(e), !(r = n.adInstance)) throw Fe;return [4, r.show()];case 1:
            return [2, i.sent()];}
      });
    });
  }, getInterstitialAd: function (e) {
    a("get interstitial ad ", e);var t = e.adUnitId,
        n = (ht[t] || this.createAdManager(e)).adInstance;if (!n) throw Fe;return n;
  }, _destroy: function (e) {
    var t = ht[e];t && (t.unbindHandlers(), t.destroy(), ht[e] = null);
  }, destroy: function (e) {
    var t = this;a("destroy interstitial ad", e);var n = (e || {}).adUnitId;if (n) return this._destroy(n);Object.keys(ht || {}).forEach(function (e) {
      t._destroy(e);
    });
  } },
    ft = "/ad-platform-server/api/v1/platform/strategy",
    lt = "/ad-platform-server/api/v1/platform/fetch",
    pt = "hortor",
    gt = "wx",
    vt = "",
    mt = "无hortor视频广告",
    _t = "无微信视频广告",
    wt = "暂无视频广告",
    yt = "hortor视频广告",
    It = "微信视频广告",
    Tt = "视频广告冻结期间, 暂无视频广告",
    St = function (e, t) {
  var n = ot(),
      r = n.scene,
      i = { adUnitId: e, logType: t, channel: (n.custom || {}).channel, scene: r };T.dispatch("EVT_REPORT_LOG", { log: i });
},
    bt = function (e) {
  var t = e.sequenceInfo;T.dispatch("EVT_VIDEO_AD_PLAY_FINISH", { sequenceInfo: t, adType: 2 }), T.dispatch("EVT_HORTOR_AD_PLAY_SUCCESS");
};function Et() {
  var e = at(),
      t = e.videoCoolTime,
      n = e.videoTimeout;this.adInstance = void 0, this.loaded = !1, this.loading = !0, this.loadReported = !1, this.coolLoad = !1, this.coolTimer = null, this.loadCoolTime = t || 18e4, this.callTimeout = n || 5e3, this.destroyed = !1, this.fstLoaded = !1, this.cacheQueue = [], this.isOnlyUseWX = !0, this.cacheHortorAdInfo = null, this.isNeedConsumeQueue = !0, this.preAd = 0, this.videoPlayFreezeTime = 0, this.videoPlayFreezeEnable = 0, this.activeFreezeTime = 0, this.freezeTimer = 0, T.on("EVT_HORTOR_AD_PLAY_SUCCESS", this._initVideoFreezeTime.bind(this));
}Et.prototype = { _sCool: function () {
    this.coolLoad = !1, this.coolTimer = null;
  }, _sRest: function () {
    this.loaded = !1, this.loading = !0, this.isNeedConsumeQueue = !0, this._sCool();
  }, _sLoad: function (e) {
    a("ad loaded", e), this.loaded = !0, this.loading = !1, this.fstLoaded = !0, this._sCool();
  }, _sError: function (e) {
    a("ad err", e), this.loaded = !1, this.loading = !1, this.fstLoaded = !0;var t = e.errCode;!this.coolTimer && [1002, 1004].indexOf(t) > -1 && (this.coolLoad = !0, this.coolTimer = setTimeout(this._sCool.bind(this), this.loadCoolTime));
  }, _loadAd: function (e, t) {
    return r(this, void 0, void 0, function () {
      var n;return i(this, function (r) {
        switch (r.label) {case 0:
            a("ad reload"), r.label = 1;case 1:
            if (r.trys.push([1, 3,, 4]), this.coolLoad && t) throw t;return [4, e.load()];case 2:
            return r.sent(), this._sLoad(), [2, !0];case 3:
            throw n = r.sent(), this._sError(n), n;case 4:
            return [2];}
      });
    });
  }, _showAd: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            a("ad show"), n.label = 1;case 1:
            return n.trys.push([1, 3,, 5]), [4, e.show()];case 2:
            return [2, n.sent()];case 3:
            return t = n.sent(), [4, this._loadAd(e, t)];case 4:
            return n.sent(), [2, e.show()];case 5:
            return [2];}
      });
    });
  }, _waitResult: function (e) {
    var t = this;return a("ad wait"), new Promise(function (n, r) {
      var i = setTimeout(function () {
        if (a("ad wait timeout"), t.fstLoaded) return t._sLoad("fake"), n(!0);t._loadAd(e).then(n).catch(r);
      }, t.callTimeout);e.onLoad(function (t) {
        e.offLoad(this), clearTimeout(i), n(!0);
      }), e.onError(function (t) {
        e.offError(this), clearTimeout(i), r(t);
      });
    });
  }, getInstance: function (e) {
    if (void 0 !== this.adInstance) return this.adInstance;var t = function (e) {
      return Ce ? wx.createRewardedVideoAd(e) : null;
    }(e);return this.adInstance = t, t ? (t.onLoad(this._sLoad.bind(this)), t.onError(this._sError.bind(this)), this.adInstance) : null;
  }, _getAdInstance: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        if (this.destroyed) throw Ke;if (!(t = this.getInstance(e))) throw Fe;return [2, t];
      });
    });
  }, _checkLoaded: function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return this.loaded ? [2, !0] : this.loading ? [4, this._waitResult(e)] : [3, 2];case 1:
            return [2, t.sent()];case 2:
            return this.coolLoad ? [3, 4] : (a("ad try load"), [4, this._loadAd(e)]);case 3:
            return [2, t.sent()];case 4:
            if (!this.loaded) throw We;return [2, !0];}
      });
    });
  }, destroy: function () {
    this.adInstance && (this.adInstance.destroy(), this.adInstance = null), this.destroyed = !0, this._sRest(), this.loading = !1;
  }, _showStart: function (e) {
    this.loadReported = !1, T.dispatch("EVT_VIDEO_AD_PLAY_START", { adUnitId: e });
  }, _showSuccess: function (e) {
    T.dispatch("EVT_VIDEO_AD_PLAY_START", { adUnitId: e, playSuccess: !0 });
  }, _showFinish: function (e, t, n, r, i) {
    void 0 === n && (n = 0);var s = r ? Math.max(M.getTime() - r, 0) : 0;T.dispatch("EVT_VIDEO_AD_PLAY_FINISH", { adUnitId: e, isEnded: t, playFailCode: n, spentTime: s, sequenceInfo: i, adType: 0 }), t && this._initVideoFreezeTime();
  }, _initVideoFreezeTime: function () {
    var e = q.get("__sdk_std_seq") || {};if (this.videoPlayFreezeEnable = e.video_play_freeze_enable || 0, this.videoPlayFreezeTime = e.video_play_freeze_time || 0, this.activeFreezeTime = this.videoPlayFreezeTime, clearTimeout(this.freezeTimer), !(this.activeFreezeTime <= 0 || 0 === this.videoPlayFreezeEnable)) {
      var t = this,
          n = function () {
        t.activeFreezeTime--, clearTimeout(t.freezeTimer), t.activeFreezeTime <= 0 || (t.freezeTimer = setTimeout(function () {
          n();
        }, 1e3));
      };n();
    }
  }, show: function (e) {
    return r(this, void 0, void 0, function () {
      var t,
          n,
          r,
          s,
          o,
          c,
          u,
          h,
          d,
          f,
          l = this;return i(this, function (i) {
        switch (i.label) {case 0:
            return a("调用展示广告"), [4, this._getAdInstance(e)];case 1:
            t = i.sent(), n = e.adUnitId, r = e.onClose, s = e.sequenceInfo, a("showing ad", n), o = M.getTime(), c = function (e) {
              t.offClose(c), r && r(e);var i = (e || {}).isEnded,
                  a = void 0 === i || i;St(n, a ? 17 : 18), l._showFinish(n, a, 0, o, s);
            }, t.onClose(c), St(n, 15), this._showStart(n), i.label = 2;case 2:
            return i.trys.push([2, 5,, 6]), [4, this._checkLoaded(t)];case 3:
            return i.sent(), [4, this._showAd(t)];case 4:
            return u = i.sent(), this._showSuccess(n), this._sRest(), St(n, 16), [2, u];case 5:
            throw h = i.sent(), t.offClose(c), d = (h || {}).errCode, f = void 0 === d ? 1 : d, this._showFinish(n, !1, f, o, s), a("ad show err", n, h), T.dispatch("EVT_VIDEO_AD_ERROR", { adUnitId: n, err: h }), h;case 6:
            return [2];}
      });
    });
  }, prepareShowHortorVedioAd: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return t = JSON.parse(JSON.stringify(this.cacheHortorAdInfo)), this.cacheHortorAdInfo = null, this.isNeedConsumeQueue = !0, [4, this._hortorAdCheck(e)];case 1:
            return n.sent(), [2, new Promise(function (e, n) {
              var r = t || {},
                  i = r.jumpConfig,
                  s = r.videoResource;i && s ? e(t) : n(Qe);
            })];}
      });
    });
  }, check: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return [4, this._getAdInstance(e)];case 1:
            t = i.sent(), a("checking ad", n = e.adUnitId), this.loadReported || St(n, 23), i.label = 2;case 2:
            return i.trys.push([2, 4, 5, 6]), [4, this._checkLoaded(t)];case 3:
            return r = i.sent(), this.loadReported || St(n, 24), [2, r];case 4:
            throw s = i.sent(), a("ad check err", n, s), T.dispatch("EVT_VIDEO_AD_ERROR", { adUnitId: n, err: s }), s;case 5:
            return this.loadReported = !0, [7];case 6:
            return [2];}
      });
    });
  }, _getConnomHorotrAdParams: function (e) {
    var t = D.platform.information,
        n = t.getUserInfo() || {},
        r = n.gameId,
        i = n.uniqueId,
        s = n.openId,
        o = t.getSystemInfo();return { adPositionId: e.hortorAdUnitId, gameId: r, uniqueId: i, openId: s, sysInfo: JSON.stringify(o) };
  }, _getAdQueueInfo: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, o, a, c, u;return i(this, function (i) {
        switch (i.label) {case 0:
            if (n = (t = this).isOnlyUseWX, (r = t.cacheQueue).length > 1) return [2, { isOnlyUseWX: n, cacheQueue: r }];o = "" + k() + ft, a = this._getConnomHorotrAdParams(e), i.label = 1;case 1:
            return i.trys.push([1, 3,, 4]), [4, R.post(o, a)];case 2:
            return c = i.sent().data, u = c.strategyList || [], this.isOnlyUseWX = c.isOnlyUseWX, this.cacheQueue = s(this.cacheQueue, u), [2, { isOnlyUseWX: this.isOnlyUseWX, cacheQueue: this.cacheQueue }];case 3:
            return i.sent(), [2, Promise.resolve({ isOnlyUseWX: this.isOnlyUseWX, cacheQueue: this.cacheQueue })];case 4:
            return [2];}
      });
    });
  }, _hortorAdCheck: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, c;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = { isHaveAd: !1, adType: pt, msg: mt, isFreeze: !1, freezeTime: 0 }, this.cacheHortorAdInfo ? [2, Object.assign(t, { isHaveAd: !0, msg: yt })] : (n = "" + k() + lt, r = this._getConnomHorotrAdParams(e), [4, R.post(n, r)]);case 1:
            return s = i.sent(), o = s.data, c = s.meta, a("get ad info", o, c), c && 0 !== c.errCode ? [2, t] : (this.cacheHortorAdInfo = o, [2, Object.assign(t, { isHaveAd: !0, msg: yt })]);}
      });
    });
  }, _wxAdCheck: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return a("_wxAdCheck"), [4, this.check(e)];case 1:
            return a("wx ad check", t = n.sent()), [2, { isHaveAd: t, adType: gt, msg: t ? It : _t, isFreeze: !1, freezeTime: 0 }];}
      });
    });
  }, _consumeQueue: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o;return i(this, function (i) {
        switch (i.label) {case 0:
            return i.trys.push([0, 6,, 7]), t = ["_wxAdCheck", "_hortorAdCheck"], n = 0, this.isNeedConsumeQueue ? (n = this.cacheQueue.shift(), this.preAd = n, this.isNeedConsumeQueue = !1, a("consume queue", n)) : a("no consume queue", n = this.preAd), r = null, n >= t.length ? [4, this._wxAdCheck(e)] : [3, 2];case 1:
            return [2, r = i.sent()];case 2:
            return s = t[n], o = t[Number(!n)], [4, this[s](e)];case 3:
            return (r = i.sent()).isHaveAd ? [3, 5] : [4, this[o](e)];case 4:
            r = i.sent(), i.label = 5;case 5:
            return r.isHaveAd || (r = { isHaveAd: !1, adType: vt, msg: wt, isFreeze: !1, freezeTime: 0 }), [2, r];case 6:
            throw i.sent();case 7:
            return [2];}
      });
    });
  }, mixCheck: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, c, u, h, d;return i(this, function (i) {
        switch (i.label) {case 0:
            if (t = {}, n = e.adUnitId, r = e.hortorAdUnitId, !n) throw ze;return o = (s = this).activeFreezeTime, s.videoPlayFreezeEnable && o > 0 ? [2, t = { isHaveAd: !1, adType: vt, msg: Tt, isFreeze: !0, freezeTime: this.activeFreezeTime }] : (c = !0, r ? [4, this._getAdQueueInfo(e)] : [3, 2]);case 1:
            u = i.sent(), h = u.isOnlyUseWX, d = u.cacheQueue, c = h || 0 === d.length, a("get ad queue", u), i.label = 2;case 2:
            return c ? (a("isWxAd"), [4, this._wxAdCheck(e)]) : [3, 4];case 3:
            return a("adInfo", t = i.sent()), [2, t];case 4:
            return [4, this._consumeQueue(e)];case 5:
            return a("ad result", t = i.sent()), [2, t];}
      });
    });
  } };var Ct = { managerOrder: [], adManagers: {}, idToManagerKeys: {}, _getOpt: function (e) {
    var t = Object.assign({}, e),
        n = t.multiton,
        r = t.type;return t.multiton = !(!n && !r || !Oe), t;
  }, _getManagerKey: function (e) {
    var t = e.adUnitId,
        n = e.multiton,
        r = e.type,
        i = this.idToManagerKeys[t];return i || (n ? (this.idToManagerKeys[t] = r || t, r || t) : (this.idToManagerKeys[t] = "global", "global"));
  }, _getAdManager: function (e) {
    var t = this._getManagerKey(e),
        n = this.adManagers[t] || null;if (n) return n;var r = at().maxTempVideoAdLen;this.managerOrder.length >= r && this.destroy(this.managerOrder[0]);var i = e.adUnitId,
        s = new Et();return a("create adManager", t, i), this.adManagers[t] = s, this.managerOrder.push(t), this.idToManagerKeys[i] = t, s;
  }, destroy: function (e) {
    var t = "";if ((t = "string" == typeof e ? this.idToManagerKeys[e] || e || "" : e ? this._getManagerKey(this._getOpt(e)) : "") && "global" !== t) {
      var n = this.adManagers[t];if (n) {
        n.destroy(), this.adManagers[t] = null;var r = this.managerOrder.indexOf(t);r > -1 && this.managerOrder.splice(r, 1), a("destroy adManager", t);
      }
    }
  }, check: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return t = this._getOpt(e), [4, this._getAdManager(t).check(t)];case 1:
            return [2, n.sent()];}
      });
    });
  }, mixCheck: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return t = this._getOpt(e), [4, this._getAdManager(t).mixCheck(t)];case 1:
            return [2, n.sent()];}
      });
    });
  }, show: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return t = this._getOpt(e), [4, this._getAdManager(t).show(t)];case 1:
            return [2, n.sent()];}
      });
    });
  }, prepareShowHortorVedioAd: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return t = this._getOpt(e), [4, this._getAdManager(t).prepareShowHortorVedioAd(t)];case 1:
            return [2, n.sent()];}
      });
    });
  }, play: function (e) {
    var t = this;return new Promise(function (n, r) {
      var i = (e || {}).G$8L;t.show(Object.assign({}, e || {}, { onClose: function (e) {
          n(e || { isEnded: !0 });
        } })).then(function (e) {
        i && i(e);
      }).catch(r);
    });
  }, getVideoAd: function (e) {
    var t = this._getOpt(e);return this._getAdManager(t).getInstance(t);
  }, adPointShow: function (e) {
    St(e, 20);
  }, hortorAdPlaySuccess: function (e) {
    bt(e);
  } },
    Ot = { create: function (e) {
    var t = e.adUnitId,
        n = function (e) {
      return Ae ? wx.createGridAd(e) : null;
    }(e);return n && (M.defineProperty(n, "show", this._showHandler.bind(this, t)), M.defineProperty(n, "hide", this._hideHandler.bind(this, t)), n.onError(function (e) {
      a("grid ad err", e);
    })), n;
  }, _showHandler: function (e, t) {
    var n = this;return function () {
      return new Promise(function (r, i) {
        n._postLog(e, 41), t().then(function (t) {
          r(t), a("grid ad show"), n._postLog(e, 42);
        }).catch(function (e) {
          i(e), a("grid ad show fail", e);
        });
      });
    };
  }, _hideHandler: function (e, t) {
    var n = this;return function (r) {
      t(r), a("grid ad hide"), n._postLog(e, 43);
    };
  }, _postLog: function (e, t) {
    var n = ot(),
        r = n.scene,
        i = { adUnitId: e, logType: t, channel: (n.custom || {}).channel, scene: r };T.dispatch("EVT_REPORT_LOG", { log: i });
  } };function kt(e) {
  return ct.create(e);
}function At(e) {
  return Ot.create(e);
}function xt(e) {
  return dt.preLoad(e);
}function Dt(e) {
  return dt.show(e);
}function Rt(e) {
  return dt.destroy(e);
}function Pt(e) {
  Ct.adPointShow(e.id);
}function Ut(e) {
  Ct.hortorAdPlaySuccess(e);
}function Lt(e) {
  return Ct.check(e);
}function Vt(e) {
  return Ct.mixCheck(e);
}function Nt(e) {
  return Ct.show(e);
}function Mt(e) {
  return Ct.prepareShowHortorVedioAd(e);
}function qt(e) {
  return Ct.play(e);
}function Ht(e) {
  Ct.destroy(e);
}function Ft(e) {
  return Ct.getVideoAd(e);
}function Gt(e) {
  return dt.getInterstitialAd(e);
}var jt = function () {
  var e = at();return "__sdk_login_" + e.gameId + "_" + e.env;
},
    Kt = void 0,
    Bt = function () {
  return void 0 === Kt && (a("get login storage", jt()), Kt = q.get(jt(), null)), Kt;
},
    Wt = void 0,
    zt = {},
    Qt = { clearUserInfo: function () {
    return Kt = null, q.remove(jt());
  }, getUserInfo: function (e) {
    var t = Bt() || {},
        n = t.userInfo,
        r = t.saveTime;if (!n || !r) return null;var i = ((n || {}).userSdk || {}).hasUserInfo;if (!e && !i) return null;var s = at().expireTime || 86400,
        o = M.getTimeSec();return r + s < o || r > o ? null : n;
  }, setUserInfo: function (e) {
    var t = e || {},
        n = t.encryptUserInfo,
        r = t.userSdk;if (!n) return !1;var i = { userInfo: e, saveTime: M.getTimeSec() };q.set(jt(), i), i.userInfo = Object.assign(e, { userSdk: this._inheritOldData(r) }), Kt = i;
  }, _inheritOldData: function (e) {
    var t = this.getTempUser();if (!t || !e) return e;var n = t.isNewUser;return M.isNull(n) || (e.isNewUser = !!n), e;
  }, getSDKUserInfo: function () {
    var e = ((Bt() || {}).userInfo || {}).userSdk;return e && (e.gameUser = this.getGameUser()), e;
  }, updateIsNewUser: function () {
    var e = Bt();e.userInfo.userSdk.isNewUser = !1, q.set(jt(), e), Kt = void 0;
  }, setTempUser: function (e) {
    var t = (e || {}).userSdk;Wt = t ? this._inheritOldData(t) : null;
  }, getTempUser: function () {
    if (!Wt) {
      var e = ((Bt() || {}).userInfo || {}).userSdk;Wt = e || null;
    }return Wt;
  }, setGameUser: function (e) {
    zt = Object.assign(zt, e), T.dispatch("EVT_SET_GAMEUSER", zt);
  }, getGameUser: function () {
    return zt;
  } };var Jt,
    Yt = { canUseAdvised: we("checkIsUserAdvisedToRest", "1.9.97"), checkNeedRest: function (e) {
    var t = this;return new Promise(function (n, r) {
      t.canUseAdvised ? wx.checkIsUserAdvisedToRest({ todayPlayedTime: e, success: function (e) {
          n(e.result);
        }, fail: function (e) {
          r(e);
        } }) : r(Fe);
    });
  } };function Xt(e) {
  this.beatTotal = {}, this.canReport = !0, this._init(e);
}function $t() {
  return function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return e = (Qt.getSDKUserInfo() || {}).uniqueId, t = { uniqueId: e }, n = k() + "/common/api/v1/realname", [4, R.get(n, t)];case 1:
            return (r = i.sent()).data ? [2, Promise.resolve(r.data)] : [2, Promise.reject(r.meta)];}
      });
    });
  }().then(function (e) {
    return Promise.resolve(e);
  }).catch(function (e) {
    return Promise.reject(e);
  });
}function Zt(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a;return i(this, function (i) {
        switch (i.label) {case 0:
            if (n = (t = e || {}).name, r = t.idCard, s = (Qt.getSDKUserInfo() || {}).uniqueId, o = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/, !s) throw je;if (!n || !r || !o.test(r.toString())) throw Ge;return a = k() + "/common/api/v1/realname", [4, R.postForm(a, { uniqueId: s, name: n, idCard: r })];case 1:
            return [2, i.sent().data];}
      });
    });
  }(e);
}function en(e) {
  return void 0 === e && (e = {}), function (e, t) {
    if (void 0 === t && (t = {}), !Yt.canUseAdvised) return !1;a("startCheck");var n = t.maxGameTime,
        r = void 0 === n ? 10800 : n,
        i = t.space,
        s = void 0 === i ? 300 : i,
        o = t.reportOnStart,
        c = void 0 !== o && o,
        u = parseInt(String(r / 60)),
        h = { beatFreq: s, reportFreq: { default: s }, onReport: e, reportOnStart: c };return h.reportFreq[u.toString()] = r, Jt ? (t && Jt.resetOpt(h), Jt.restart()) : (Jt = new Xt(h)).start();
  }(e.listener, e.config);
}function tn() {
  return Jt ? Jt.stop() : (a("did not startCheck"), !1);
}function nn(e, t) {
  return "function" == typeof (null == e ? void 0 : e.listener) ? e : (u("请正确调用api: ", t + "({ listener: listenFunction })"), "function" == typeof e ? { listener: e } : { listener: function () {} });
}function rn() {
  return nt() || {};
}function sn() {
  return S.sdkConfig() || {};
}function on() {
  return function () {
    var e = ye(),
        t = e.screenHeight,
        n = void 0 === t ? 0 : t,
        r = e.screenWidth;return { result: n / (void 0 === r ? 1 : r) > 2 };
  }();
}function an(e) {
  Xe((e = nn(e, "onShow")).listener);
}function cn(e) {
  var t;e = nn(e, "offShow"), t = e.listener, wx.offShow(t);
}function un(e) {
  $e((e = nn(e, "onHide")).listener);
}function hn(e) {
  var t;e = nn(e, "offHide"), t = e.listener, wx.offHide(t);
}function dn(e) {
  Ze((e = nn(e, "onError")).listener);
}function fn(e) {
  var t;e = nn(e, "offError"), t = e.listener, wx.offError(t);
}function ln(e) {
  void 0 === e && (e = {}), this.lastIndex = -1, this.allZero = !1, this.allWeight = 0, this.unitWeight = 100, this.opt = e, this._init();
}Xt.prototype = { _init: function (e) {
    this.opt = !e && this.opt ? this.opt : M.reset(e, { storageKey: "__sdk_BeatTotal", beatFreq: 5, reportFreq: { 5: 30, 30: 60, default: 300 }, onReport: null, reportOnStart: !1 }), a("HeartBeat opt", this.opt), this._bindEvent();
  }, _bindEvent: function () {
    this.starter = this.start.bind(this), this.pauseer = this.pause.bind(this), T.on("EVT_ON_SHOW", this.starter), T.on("EVT_ON_HIDE", this.pauseer);
  }, _unbindEvent: function () {
    T.off("EVT_ON_SHOW", this.starter), T.off("EVT_ON_HIDE", this.pauseer);
  }, start: function (e) {
    return void 0 === e && (e = ""), this._heartBeat("isBeat" === e), this._timer = setTimeout(this.start.bind(this, "isBeat"), 1e3 * this.opt.beatFreq), !!this._timer;
  }, pause: function () {
    return this._timer && (clearTimeout(this._timer), this._timer = null), !!this._timer;
  }, stop: function () {
    return this.canReport = !1, this._unbindEvent(), this.pause();
  }, restart: function () {
    return this.stop(), this._bindEvent(), this.canReport = !0, this.start();
  }, resetOpt: function (e) {
    this.opt = Object.assign(this.opt, e);
  }, _heartBeat: function (e) {
    if (this.pause(), this.today = new Date().toLocaleDateString(), e) {
      var t = this._getTodayTotal() + this.opt.beatFreq;this._checkReport(t), this._setTodayTotal(t);
    } else this.opt.reportOnStart && this._checkReport();
  }, _checkReport: function (e) {
    var t = e || this._getTodayTotal(),
        n = this.opt.reportFreq,
        r = 0;for (var i in n) {
      var s = 60 * Number(i);if (r = n[i], !isNaN(s) && t <= s) break;
    }a("heart beat " + this.today, r, t), t && t % r == 0 && this.canReport && this._onReport(t);
  }, _setTodayTotal: function (e) {
    this.beatTotal[this.today] = e || 0;var t = this.opt.storageKey;q.set(t, this.today + "_" + e);
  }, _getTodayTotal: function (e) {
    if (void 0 === e && (e = this.today), M.isNull(this.beatTotal[this.today])) {
      var t = this.opt.storageKey,
          n = (q.get(t) || "").split("_");this.beatTotal[this.today] = this.today === n[0] ? Number(n[1]) : 0;
    }return this.beatTotal[this.today];
  }, _onReport: function (e) {
    a("heart beat report");var t = (this.opt || {}).onReport;Yt.checkNeedRest(e).then(function (n) {
      n && M.isFun(t) && t(e);
    }).catch(function (e) {
      a("heart beat report err", e);
    });
  } }, et(), ln.prototype = { _init: function () {
    var e = this.opt,
        t = e.list,
        n = e.lastIndex,
        r = e.weightCount;if (t && t.length) {
      this.lastIndex = "number" == typeof n ? n : -1;var i = 0;"number" == typeof r ? i = r : t.map(function (e) {
        var t = e.weight;i += (void 0 === t ? 0 : t) - 0;
      }), 0 === i && (this.allZero = !0, i = t.length * this.unitWeight), this.allWeight = i;
    }
  }, _setLastIndex: function (e) {
    this.lastIndex = e;
  }, _getLastIndex: function () {
    return this.lastIndex;
  }, _getRandomIndex: function () {
    var e = this,
        t = this.opt.list,
        n = Math.floor(Math.random() * this.allWeight),
        r = 0;return t.findIndex(function (t) {
      var i = e.allZero ? e.unitWeight : t.weight,
          s = !!(r <= n && n < r + i);return s || (r += i), s;
    });
  }, _getUniqueIndex: function () {
    var e = this._getLastIndex(),
        t = this._getRandomIndex();return t !== e ? (this._setLastIndex(t), t) : this._getUniqueIndex();
  }, getIndex: function () {
    var e = -1;switch (this.opt.list.length) {case 0:
        e = -1;break;case 1:
        e = 0;break;default:
        e = this._getUniqueIndex();}return e;
  }, getData: function () {
    var e = (this.opt || {}).list;return (void 0 === e ? [] : e)[this.getIndex()];
  } };var pn = { _canUseNavigate: we("navigateToMiniProgram", "2.2.0"), navigateToMiniProgram: function (e, t) {
    var n = this;return new Promise(function (r, i) {
      if (!n._canUseNavigate) return t ? r(n.previewImage(t)) : i(Ge);var s = Object.assign({}, e, { success: r, fail: function (e) {
          var s = (e || {}).errMsg;if ((void 0 === s ? "" : s).indexOf("cancel") > -1) e.isCancel = !0;else if (t) return r(n.previewImage(t));i(e || Ge);
        } });wx.navigateToMiniProgram(s);
    });
  }, previewImage: function (e) {
    return new Promise(function (t, n) {
      if (!e) return n(Ge);wx.previewImage({ current: e, urls: [e], success: t, fail: n });
    });
  } },
    gn = "/cross/api/v1/fetch",
    vn = "/cross/api/v1/log/multi",
    mn = "_CSDK_LastIndex",
    _n = "_CSDK_RulesInfo",
    wn = { errCode: 5e4, errMsg: "adsId is null" },
    yn = { errCode: 50001, errMsg: "没有广告数据" },
    In = { errCode: 50002, errMsg: "not stopLoop" },
    Tn = { errCode: 50003, errMsg: "not setOnLoop" },
    Sn = { errCode: 50004, errMsg: "still jumping" },
    bn = 1,
    En = 2,
    Cn = 3,
    On = 4,
    kn = null,
    An = "",
    xn = function () {
  if (!An) {
    var e = ye();An = JSON.stringify({ SDKVersion: e.SDKVersion, brand: e.brand, model: e.model, system: e.system, version: e.version, crossSDKV: e.hortorSDKVersion });
  }return An;
},
    Dn = [],
    Rn = xn,
    Pn = function (e) {
  Dn.push(e), kn || (kn = setTimeout(function () {
    !function () {
      if (Dn.length) {
        var e = at() || {},
            t = e.gameId,
            n = e.gameVersion,
            r = Qt.getSDKUserInfo() || {},
            i = r.userId,
            s = r.uniqueId,
            o = { gameId: t, gameVersion: n, openId: i, sex: r.sex, userId: s, channel: r.channel, origChannel: r.origChannel, logs: Dn, sysInfo: xn() },
            c = "" + k() + vn;R.post(c, o).catch(function (e) {
          a("cross report fail", e);
        }), Dn = [];
      }
    }(), kn = null;
  }, 1e3));
},
    Un = null,
    Ln = { openCount: {} },
    Vn = function () {
  var e = M.todayStart(),
      t = Un || q.get(_n, null);return Un = t && t.time && t.time < e ? Ln : t || Ln;
},
    Nn = function (e) {
  var t = e || {},
      n = t.adsId,
      r = t.prId,
      i = Vn();n && (i.openCount[n] = i.openCount[n] || 0, i.openCount[n] += 1), r && (i.openCount[r] = i.openCount[r] || 0, i.openCount[r] += 1), function (e) {
    (Un = e || Ln).time = M.getTime(), q.set(_n, Un);
  }(i);
},
    Mn = function (e) {
  return Vn().openCount[e] || 0;
};function qn(e) {
  var t = e || {},
      n = t.adsId,
      r = t.playerOptions;this.adsId = n, this.playerOptions = r, this.options = M.copy(e, ["adsId", "success", "fail"]), this.adsData = {}, this.adsMap = {}, this.randomer = null, this.nowAd = null, this.destroied = !1, this.jumping = !1;
}qn.prototype = { getAdsData: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return this.randomer && this.adsData ? [2, this.adsData] : [4, this._loadData()];case 1:
            return [2, e.sent()];}
      });
    });
  }, getAdDataList: function () {
    return this.getAdsData();
  }, getAdDataListWithPlayerOptions: function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return [4, this._loadData(e)];case 1:
            return [2, t.sent()];}
      });
    });
  }, getAdDataWithPlayerOptions: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return [4, this._loadData(e)];case 1:
            if (t = i.sent(), !this._checkAds(t)) throw yn;if (n = this.randomer.getIndex(), q.set(this._getSTGKey(), n), r = t.ads, !(s = r ? r[n] : null) || !this._checkAd(s)) throw yn;return this.nowAd = s, this.reportShow([s]), a("cross get ad", s), [2, s];}
      });
    });
  }, _getSTGKey: function () {
    return "" + mn + this.adsId;
  }, _loadData: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a, c, u, h, d, f, l;return i(this, function (i) {
        switch (i.label) {case 0:
            if (!this.adsId) throw wn;return t = (at() || {}).gameId, n = Qt.getSDKUserInfo() || {}, r = n.userId, s = n.uniqueId, o = n.sex, a = n.channel, c = n.origChannel, u = n.createdAt, h = Object.assign({ adsId: this.adsId, gameId: t, openId: r, userId: s, sex: o, channel: a, origChannel: c, userCreatedAt: u || 0, sysInfo: Rn() }, this.options), this.playerOptions && (h = Object.assign(h, this.playerOptions)), delete h.playerOptions, e && e.playerOptions && (h = Object.assign(h, e.playerOptions)), d = "" + k() + gn, [4, R.postForm(d, h)];case 1:
            if (f = i.sent().data, !(l = (f || {}).ads) || !l.length) throw yn;return this.nowAd = l[0], [2, this._renderData(f)];}
      });
    });
  }, _renderData: function (e) {
    var t = this,
        n = e.ads,
        r = [];n.map(function (e) {
      if (e) {
        e.show_duration = e.show_duration - 0 || 0;var n = {},
            i = e.jumpConfig || {},
            s = ["jumpConfig"];for (var o in e) s.indexOf(o) < 0 && (n[o] = i[o] || e[o]);t.adsMap[e.prId] = n, r.push(n);
      }
    });var i = q.getNumber(this._getSTGKey(), -1);return this.randomer = new ln({ list: r, lastIndex: i }), this.adsData = Object.assign({}, e, { ads: r }), a("cross adsData", this.adsData), this.adsData;
  }, getAdData: function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return [4, this.getAdsData()];case 1:
            if (e = i.sent(), !this._checkAds(e)) throw yn;if (t = this.randomer.getIndex(), q.set(this._getSTGKey(), t), n = e.ads, !(r = n ? n[t] : null) || !this._checkAd(r)) throw yn;return this.nowAd = r, this.reportShow([r]), a("cross get ad", r), [2, r];}
      });
    });
  }, _checkAds: function (e) {
    var t = (e || {}).max_open_count;return !t || Mn(this.adsId) < t;
  }, _checkAd: function (e) {
    var t = e || {},
        n = t.prId,
        r = t.adType,
        i = (t.screen_info || {}).screenOpenCnt;return r === On && i ? Mn(n) < i : !!n;
  }, _afterShow: function (e) {
    var t = e || {},
        n = t.prId,
        r = t.adType,
        i = (t.screen_info || {}).screenOpenCnt;n && r === On && i && Nn({ adsId: this.adsId, prId: n });
  }, setOnLoop: function (e) {
    M.isFun(e) && (this._loopEnv = e);
  }, _loop: function () {
    return r(this, void 0, void 0, function () {
      var e,
          t,
          n = this;return i(this, function (r) {
        switch (r.label) {case 0:
            if (!this._loopEnv) throw Tn;return this._clearLoop(), [4, this.getAdData()];case 1:
            return e = r.sent(), this._loopEnv(e), (t = e.show_duration) && (this._looper = setTimeout(function () {
              n._loop().catch(function () {});
            }, 1e3 * t)), [2];}
      });
    });
  }, _clearLoop: function () {
    this._looper && (clearTimeout(this._looper), this._looper = null);
  }, startLoop: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            if (this._looper) throw In;return [4, this._loop()];case 1:
            return e.sent(), a("cross loop started"), [2];}
      });
    });
  }, stopLoop: function () {
    this._clearLoop(), a("cross loop stoped");
  }, _jump: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, c, u, h, d, f, l, p;return i(this, function (i) {
        switch (i.label) {case 0:
            if (t = (this.nowAd || {}).prId, n = (e || {}).prId, r = n || t, !(s = this.adsMap[r])) throw yn;return this.reportClick(r), o = s.url, c = s.appId, u = s.path, h = s.envVersion, d = s.extraData, f = s.use_code_jump, d = d || {}, f ? [4, pn.previewImage(o)] : [3, 2];case 1:
            return i.sent(), [3, 4];case 2:
            return l = (at() || {}).gameId, p = (Qt.getSDKUserInfo() || {}).uniqueId, d = Object.assign(d, { origGameId: l || "", origUniqueId: p || "" }), a("cross jump params", { appId: c, path: u, envVersion: h, extraData: d }, o), [4, pn.navigateToMiniProgram({ appId: c, path: u, envVersion: h, extraData: d }, o)];case 3:
            i.sent(), i.label = 4;case 4:
            return this.reportJumped(r), this._loop().catch(function () {}), [2];}
      });
    });
  }, jump: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            if (this.jumping) throw Sn;this.jumping = !0, n.label = 1;case 1:
            return n.trys.push([1, 3, 4, 5]), [4, this._jump(e)];case 2:
            return n.sent(), [3, 5];case 3:
            throw a("cross jump fail", t = n.sent()), t;case 4:
            return this.jumping = !1, [7];case 5:
            return [2];}
      });
    });
  }, reportShow: function (e) {
    var t = this,
        n = this.adsData.ads;(e || n || []).map(function (e) {
      var n = e ? "string" == typeof e ? e : e.prId : "";t._report(En, n), t._afterShow(t.adsMap[n]);
    });
  }, reportClick: function (e) {
    this._report(Cn, e);
  }, reportJumped: function (e) {
    this._report(bn, e);
  }, _report: function (e, t) {
    t && Pn({ logType: e, prId: t, adsId: this.adsId });
  }, destroy: function () {
    this.stopLoop(), this.adsData = {}, this.adsMap = {}, this.randomer = null, this.nowAd = null, this.destroied = !0;
  } };var Hn = {},
    Fn = function (e) {
  var t = (e || {}).adsId,
      n = Hn[t];return n && !n.destroied || (Hn[t] = new qn(e)), Hn[t];
};function Gn(e) {
  return Fn(e);
}var jn = { _canUseCustomer: we("openCustomerServiceConversation", "2.0.3"), openCustomerServiceConversation: function (e) {
    var t = this;return new Promise(function (n, r) {
      t._canUseCustomer ? wx.openCustomerServiceConversation(Object.assign({}, e, { success: n, fail: r })) : r(Fe);
    });
  } },
    Kn = { _getAppInfo: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a, c;return i(this, function (i) {
        switch (i.label) {case 0:
            if (this.jumpInfo) return [2, this.jumpInfo];if (t = at().gameId, n = Qt.getSDKUserInfo() || {}, r = n.uniqueId, s = n.channel, !(o = Object.assign({}, e || {}, { fromGameId: t, fromUserId: r, channel: s })).fromUserId) throw je;return a = k() + "/sdk/conf/api/v1/customer/get", [4, R.get(a, o)];case 1:
            return c = i.sent().data, this.jumpInfo = c || {}, [2, c];}
      });
    });
  }, goCustomer: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return [4, this._getAppInfo(e)];case 1:
            return t = n.sent(), [4, pn.navigateToMiniProgram(t, t.url)];case 2:
            return n.sent(), [2];}
      });
    });
  } };function Bn(e) {
  return Kn.goCustomer(e);
}function Wn(e) {
  return jn.openCustomerServiceConversation(e);
}function zn(e, t) {
  return Q.post(e, t);
}var Qn = we("createGameBanner", "2.7.5"),
    Jn = we("createGameIcon", "2.8.3"),
    Yn = we("createGamePortal", "2.7.5");function Xn() {
  this.canUseAd = Qn;
}function $n() {
  this.canUseAd = Jn;
}function Zn() {
  this.canUseAd = Yn;
}Xn.prototype = { constructor: Xn, _postLog: function (e, t) {
    var n = ot(),
        r = n.scene;zn({ adUnitId: e, channel: (n.custom || {}).channel, scene: r, logType: t });
  }, _showHandler: function (e, t) {
    var n = this;return function () {
      return new Promise(function (r, i) {
        if (!M.isFun(t)) return i(Fe);n._postLog(e, 32), t().then(function (t) {
          r(t), n._postLog(e, 33), a("game banner show succ", e);
        }).catch(i);
      });
    };
  }, _hideHandler: function (e, t) {
    var n = this;return function () {
      return n._postLog(e, 34), a("game banner hide", e), M.isFun(t) && t();
    };
  }, _create: function (e) {
    if (!this.canUseAd) return null;var t = e.adUnitId;if (!t) return null;var n = function (e) {
      return Qn ? wx.createGameBanner(e) : null;
    }(e);return n ? (this.defineProperty(n, "show", this._showHandler.bind(this, t)), this.defineProperty(n, "hide", this._hideHandler.bind(this, t)), n) : null;
  }, create: function (e) {
    return this._create(e);
  } }, $n.prototype = { constructor: $n, _postLog: function (e, t) {
    var n = ot(),
        r = n.scene;zn({ adUnitId: e, channel: (n.custom || {}).channel, scene: r, logType: t });
  }, _showHandler: function (e, t, n) {
    var r = this;return function () {
      return new Promise(function (i, s) {
        if (!M.isFun(n)) return s(Fe);r._postLog(t, 35), e.load().then(function () {
          n().then(function (e) {
            i(e), r._postLog(t, 36), a("game icon show succ", t);
          }).catch(s);
        }).catch(s);
      });
    };
  }, _hideHandler: function (e, t) {
    var n = this;return function () {
      return n._postLog(e, 37), a("game icon hide", e), M.isFun(t) && t();
    };
  }, _create: function (e) {
    if (!this.canUseAd) return null;var t = e.adUnitId,
        n = e.count;if (!t) return null;e.count = n || 1;var r = function (e) {
      return Jn ? wx.createGameIcon(e) : null;
    }(e);return r ? (this.defineProperty(r, "show", this._showHandler.bind(this, r, t)), this.defineProperty(r, "hide", this._hideHandler.bind(this, t)), r) : null;
  }, create: function (e) {
    return this._create(e);
  } }, Zn.prototype = { constructor: Zn, _postLog: function (e, t) {
    var n = ot(),
        r = n.scene;zn({ adUnitId: e, channel: (n.custom || {}).channel, scene: r, logType: t });
  }, _showHandler: function (e, t, n) {
    var r = this;return function () {
      return new Promise(function (i, s) {
        if (!M.isFun(n)) return s(Fe);r._postLog(t, 29), e.load().then(function () {
          n().then(function (e) {
            i(e), r._postLog(t, 30), a("game portal show succ", t);
          }).catch(s);
        }).catch(s);
      });
    };
  }, _closeHandler: function (e) {
    var t = this;return function () {
      t._postLog(e, 31), a("game portal closed", e);
    };
  }, _offCloseHandler: function (e) {
    return function (t) {
      M.isFun(t) && M.isFun(e) && e(t);
    };
  }, _create: function (e) {
    if (!this.canUseAd) return null;var t = e.adUnitId;if (!t) return null;var n = function (e) {
      return Yn ? wx.createGamePortal(e) : null;
    }(e);return n ? (this.defineProperty(n, "show", this._showHandler.bind(this, n, t)), this.defineProperty(n, "offClose", this._offCloseHandler.bind(this)), n.onClose(this._closeHandler(t)), n) : null;
  }, create: function (e) {
    return this._create(e);
  } };var er = { GameBanner: new Xn(), GameIcon: new $n(), GamePortal: new Zn() };function tr(e) {
  return er.GameBanner.create(e);
}function nr(e) {
  return er.GameIcon.create(e);
}function rr(e) {
  return er.GamePortal.create(e);
}var ir,
    sr = we("getGameRecorder", "2.8.0"),
    or = we("getGameRecorder", "2.10.0"),
    ar = { getGameRecorder: function () {
    if (!sr) return null;var e = wx.getGameRecorder();return e && e.isFrameSupported() ? e : null;
  }, createGameRecorderShareButton: function (e) {
    if (!sr) return null;var t = Object.assign({}, e.share);t.shareConfigId = this._renderShareId(t), t.shareGuid = this._renderShareGuid(t), t.title = this._renderTitle(t), t.query = this._renderQuery(t), e.share = t;var n = wx.createGameRecorderShareButton(e);return n && (n.hide(), M.deepCopyTo(e, n, 0, ["text"])), this._shareStart(t), n;
  }, _renderTitle: function (e) {
    var t = e.title || "";return JSON.stringify(t);
  }, _shareStart: function (e) {
    var t = e.button,
        n = e.bgm,
        r = e.timeRange,
        i = e.volume,
        s = e.atempo,
        o = e.audioMix,
        a = { shareData: e, wx_share_type: 2, extend: { videoShareInfo: JSON.stringify({ button: t, bgm: n, timeRange: r, volume: i, atempo: s, audioMix: o }) } };T.dispatch("EVT_SHARE_START", { wx_share_type: 2 }), setTimeout(function () {
      T.dispatch("EVT_SHARE_END", a);
    }, 0);
  }, _renderShareId: function (e) {
    var t = e || {},
        n = t.query,
        r = void 0 === n ? "" : n,
        i = t.id;return i || M.queryToJson(r).shareConfigId || "";
  }, _renderShareGuid: function (e) {
    var t = e || {},
        n = t.query,
        r = t.shareGuid,
        i = void 0 === r ? "" : r;if (!M.isEmpty(i)) return i;var s = M.queryToJson(n);return M.isEmpty(s.share_guid) ? M.generateGuid() : s.share_guid;
  }, _renderQuery: function (e) {
    var t = e || {},
        n = t.query,
        r = t.shareConfigId,
        i = t.shareGuid,
        s = M.getTimeSec(),
        o = Qt.getSDKUserInfo() || {},
        a = o.h_shareCode,
        c = void 0 === a ? "" : a,
        u = o.channel,
        h = void 0 === u ? "hortor_" : u,
        d = o.origChannel,
        f = void 0 === d ? "" : d,
        l = { channel: M.endsWith(h, "_") ? h : h + "_", h_shareCode: c, timestamp: s, origChannel: f, shareConfigId: r, share_guid: i };return M.addToQuery(n, l);
  } },
    cr = ["start", "stop", "pause", "resume", "abort", "timeUpdate", "error"];function ur(e) {
  return this.listener = null, this.timer = null, this.startTime = 0, this.duration = 1e3 * (e.duration || 0), this.recorder = ar.getGameRecorder(), this.options = e, this;
}function hr() {
  return "boolean" != typeof ir && (ir = null != ar.getGameRecorder()), ir;
}function dr() {
  return hr();
}function fr() {
  return function () {
    if (!or) return !1;var e = ar.getGameRecorder();return !!e && e.isAtempoSupported();
  }();
}function lr() {
  return !!(e = ar.getGameRecorder()) && e.isSoundSupported();var e;
}function pr() {
  return function () {
    if (!or) return !1;var e = ar.getGameRecorder();return !!e && e.isVolumeSupported();
  }();
}function gr(e) {
  return t = e, hr() ? new ur(t) : null;var t;
}function vr(e) {
  return function (e) {
    return hr() ? ar.createGameRecorderShareButton(e) : null;
  }(e);
}ur.prototype = { bindRecordListener: function (e) {
    this.listener = e, this._bindEvent();
  }, unbindRecordListener: function () {
    this._unbindEvent(), this.listener = null;
  }, isValid: function () {
    return null !== this.recorder;
  }, start: function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return this._checkValid(), e && (this.options = Object.assign({}, e, this.options)), this.duration = this.options && 1e3 * (this.options.duration || 0) || 0, this.bindRecordListener(this.options.listener), [4, this.recorder.start(this.options)];case 1:
            return t.sent(), [2];}
      });
    });
  }, stop: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return this._checkValid(), this._stopMonitor(), [4, this.recorder.stop()];case 1:
            return e.sent(), [2];}
      });
    });
  }, pause: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return this._checkValid(), this._stopMonitor(), this.duration = Math.max(0, this.duration - (M.getTime() - this.startTime)), [4, this.recorder.pause()];case 1:
            return e.sent(), [2];}
      });
    });
  }, resume: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return this._checkValid(), [4, this.recorder.resume()];case 1:
            return e.sent(), [2];}
      });
    });
  }, abort: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return this._checkValid(), this._stopMonitor(), [4, this.recorder.abort()];case 1:
            return e.sent(), [2];}
      });
    });
  }, _bindEvent: function () {
    var e = this;cr.forEach(function (t) {
      var n = function (n) {
        if (a("GameRecord receive " + t, n), e.listener) {
          switch (t) {case "start":case "resume":
              e.startTime = M.getTime(), e._startMonitor(e.duration);}var r = "on" + t.charAt(0).toUpperCase() + t.slice(1);"function" == typeof e.listener[r] && e.listener[r](n);
        }
      },
          r = e.recorder[t + "Handler"];r && e.recorder.off(t, r), e.recorder[t + "Handler"] = n, e.recorder.on(t, n);
    });
  }, _unbindEvent: function () {
    var e = this;cr.forEach(function (t) {
      var n = e.recorder[t + "Handler"];e.recorder.off(t, n);
    });
  }, _checkValid: function () {
    if (!this.isValid()) throw this.listener && this.listener.onError && this.listener.onError({ error: Fe }), Fe;
  }, _startMonitor: function (e) {
    e && (this._stopMonitor(), this.timer = setTimeout(this.stop.bind(this), e));
  }, _stopMonitor: function () {
    this.timer && (clearTimeout(this.timer), this.timer = null);
  } };var mr = we("createUserInfoButton", "2.0.1");function _r() {
  return new Promise(function (e, t) {
    wx.getUserInfo({ withCredentials: !0, lang: "zh_CN", success: function (n) {
        if ((n || {}).encryptedData) return e(n);t(Ve);
      }, fail: t });
  });
}var wr,
    yr = function (e) {
  return new Promise(function (t, n) {
    wx.showModal(Object.assign({ success: t, fail: n }, e));
  });
},
    Ir = { getStorage: function (e) {
    try {
      return wx.getStorageSync(e);
    } catch (e) {
      return null;
    }
  }, setStorage: function (e, t) {
    if (M.isNull(t)) return !1;try {
      return wx.setStorageSync(e, t), !0;
    } catch (e) {
      return !1;
    }
  }, removeStorage: function (e) {
    try {
      return wx.removeStorageSync(e), !0;
    } catch (e) {
      return !1;
    }
  }, clearStorage: function () {
    try {
      return wx.clearStorageSync(), !0;
    } catch (e) {
      return !1;
    }
  } };function Tr(e, t) {
  return r(this, void 0, void 0, function () {
    var n;return i(this, function (r) {
      switch (r.label) {case 0:
          return T.dispatch("EVT_LOGIN_START"), [4, Er(e, t, !1)];case 1:
          return n = r.sent(), Hr(3), T.dispatch("EVT_ON_LOGIN", n), [2, n.encryptUserInfo];}
    });
  });
}function Sr(e) {
  var t = at().getUserInfoBtn,
      n = function (e) {
    return mr ? wx.createUserInfoButton(Object.assign({}, { lang: "zh_CN" }, e)) : null;
  }(e || t);return n && n.onTap(function (e) {
    var t = e || {},
        n = t.userInfo,
        r = t.encryptedData,
        i = n || {},
        s = i.nickName,
        o = i.gender;s && T.dispatch("EVT_ON_AUTH", { nickName: s, gender: o }), r || (T.dispatch("EVT_AUTH_DENY"), Hr(10, { errMsg: e.errMsg }));
  }), n;
}function br() {
  return r(this, void 0, void 0, function () {
    return i(this, function (e) {
      switch (e.label) {case 0:
          return e.trys.push([0, 5,, 6]), mr ? [4, new Promise(function (e, t) {
            wx.getSetting({ success: function (t) {
                e(t.authSetting["scope.userInfo"]);
              }, fail: t });
          })] : [3, 2];case 1:
          return [2, e.sent()];case 2:
          return [4, new Promise(function (e, t) {
            wx.authorize({ scope: "scope.userInfo", success: function () {
                e(!0);
              }, fail: t });
          })];case 3:
          return [2, e.sent()];case 4:
          return [3, 6];case 5:
          return a("checkAuth fail", e.sent()), [2, !1];case 6:
          return [2];}
    });
  });
}function Er(e, t, n) {
  return r(this, void 0, void 0, function () {
    var r, s, o, c, u, h, d, f, l, p;return i(this, function (i) {
      switch (i.label) {case 0:
          return i.trys.push([0, 6,, 7]), [4, Cr(t, n)];case 1:
          return r = i.sent(), s = at().gameId, r && (o = r.userSdk) && o.gameId === s ? (a("storageInfo", r), [2, r]) : (T.dispatch("EVT_TRACK_LOGIN", { stage: "开始请求微信登录", storageInfo: r, req: { btnConfig: e, isWeak: t, forceAuth: n } }), [4, kr()]);case 2:
          return c = i.sent(), T.dispatch("EVT_TRACK_LOGIN", { stage: "微信登录返回结果", code: c, req: { btnConfig: e, isWeak: t, forceAuth: n } }), u = new Date().getTime(), T.dispatch("EVT_TRACK_LOGIN", { stage: "开始请求平台登录", startTime: u, req: { btnConfig: e, isWeak: t, forceAuth: n } }), [4, Ar(c, t, n)];case 3:
          return h = i.sent(), d = new Date().getTime(), f = d - u, l = (h || {}).userSdk, T.dispatch("EVT_TRACK_LOGIN", { stage: "平台登录返回结果", platUserInfo: h, costTime: f, req: { btnConfig: e, isWeak: t, forceAuth: n } }), l && l.isAuth ? [2, h] : [4, xr(e)];case 4:
          return [4, Dr(i.sent())];case 5:
          return [2, i.sent()];case 6:
          throw p = i.sent(), T.dispatch("EVT_TRACK_LOGIN", { stage: "登录失败", error: p, req: { btnConfig: e, isWeak: t, forceAuth: n } }), M.pkgError(p, g);case 7:
          return [2];}
    });
  });
}function Cr(e, t) {
  return r(this, void 0, void 0, function () {
    var n;return i(this, function (r) {
      switch (r.label) {case 0:
          return t ? [2, null] : (n = Qt.getUserInfo(e)) ? [4, Or()] : [2, null];case 1:
          return [2, r.sent() ? n : null];}
    });
  });
}function Or() {
  return r(this, void 0, void 0, function () {
    var e;return i(this, function (t) {
      switch (t.label) {case 0:
          return t.trys.push([0, 2,, 3]), [4, new Promise(function (e, t) {
            wx.checkSession({ success: e, fail: t });
          })];case 1:
          return t.sent(), T.dispatch("EVT_SESSION", {}), [2, !0];case 2:
          return u("session fail", e = t.sent()), T.dispatch("EVT_SESSION", { err: e }), [2, !1];case 3:
          return [2];}
    });
  });
}function kr() {
  return r(this, void 0, void 0, function () {
    var e, t;return i(this, function (n) {
      switch (n.label) {case 0:
          return n.trys.push([0, 2,, 3]), [4, new Promise(function (e, t) {
            wx.login({ success: function (n) {
                var r = (n || {}).code;if (r) return e(r);t(De);
              }, fail: t });
          })];case 1:
          return e = n.sent(), T.dispatch("EVT_WX_LOGIN", { code: e }), [2, e];case 2:
          throw t = n.sent(), T.dispatch("EVT_WX_LOGIN", { err: t }), M.pkgError(t, De);case 3:
          return [2];}
    });
  });
}function Ar(e, t, n) {
  return r(this, void 0, void 0, function () {
    var r, s, o, c, d, f, l, p, g, m, _, w, y, I, T, S, b, E, C, k, A;return i(this, function (i) {
      switch (i.label) {case 0:
          r = at().gameId, s = ot(), o = s.custom, c = s.query, d = s.scene, f = s.referrerInfo, l = "", p = "", f && f.extraData && (l = f.extraData.origGameId || "", p = f.extraData.origUniqueId || ""), m = (g = o || {}).channel, _ = g.origChannel, w = g.pageQuery, y = g.shareConfigId, I = g.activityId, T = g.h_shareCode, S = g.boxCode, b = "";try {
            b = JSON.stringify(s);
          } catch (e) {
            u("launchOptions error", e);
          }E = { origGameId: l, origUniqueId: p, version: h, gameId: r, channel: m, origChannel: _, query: w, queryRaw: JSON.stringify(c), shareConfigId: y, activityId: I, h_shareCode: T, boxCode: S, isWeak: t, forceAuth: n, code: e, sysInfo: Ie(), scene: d, rawData: b }, i.label = 1;case 1:
          return i.trys.push([1, 3,, 4]), C = O() + "/mini/api/v1/code", a("login code params", E), [4, R.postForm(C, E)];case 2:
          return a("entry login", k = i.sent().data), Ur(k), Qt.setTempUser(k), [2, k];case 3:
          throw u("entry err", A = i.sent()), Qt.clearUserInfo(), M.pkgError(A, v);case 4:
          return [2];}
    });
  });
}function xr(e) {
  return r(this, void 0, void 0, function () {
    var t;return i(this, function (n) {
      switch (n.label) {case 0:
          return t = null, mr ? [4, Rr(e)] : [3, 2];case 1:
          return t = n.sent(), [3, 4];case 2:
          return [4, Mr()];case 3:
          t = n.sent(), n.label = 4;case 4:
          return a("fetch userinfo", t), [2, t];}
    });
  });
}function Dr(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s, o, a, c, h, d, f, l;return i(this, function (i) {
      switch (i.label) {case 0:
          n = (t = e || {}).encryptedData, r = t.iv, s = Qt.getTempUser() || {}, o = s.userId, a = s.uniqueId, c = at().gameId, h = { entryAlias: "minisdk", gameId: c, userId: o, uniqueId: a, encryptedData: n, iv: r }, i.label = 1;case 1:
          return i.trys.push([1, 3,, 4]), d = O() + "/mini/api/v1/userinfo", [4, R.postForm(d, h)];case 2:
          if (!(f = i.sent().data) || !f.encryptUserInfo) throw v;return Ur(f), [2, f];case 3:
          throw u("_postUserInfo err", l = i.sent()), M.pkgError(l, v);case 4:
          return [2];}
    });
  });
}function Rr(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s, o, a;return i(this, function (i) {
      switch (i.label) {case 0:
          return [4, br()];case 1:
          return i.sent() ? [4, Pr()] : [3, 3];case 2:
          return n = i.sent(), [3, 4];case 3:
          n = null, i.label = 4;case 4:
          if (t = n) return [2, t];if (T.dispatch("EVT_NEED_AUTH"), r = at().getUserInfoBtn, o = (s = e || {}).useGameBtn, a = s.config, o || !a && !r) throw Le;return [4, Lr(e)];case 5:
          return [2, i.sent()];}
    });
  });
}function Pr() {
  return r(this, void 0, void 0, function () {
    return i(this, function (e) {
      switch (e.label) {case 0:
          return e.trys.push([0, 2,, 3]), [4, _r()];case 1:
          return [2, e.sent()];case 2:
          return e.sent(), [2, null];case 3:
          return [2];}
    });
  });
}function Ur(e) {
  var t = e || {},
      n = t.encryptUserInfo,
      r = t.userSdk,
      i = at().gameId;n && (!function () {
    if (Qt.getUserInfo(!0)) return;var e = ot() || {},
        t = e.custom || {},
        n = t.shareConfigId,
        r = t.activityId,
        i = M.copy(e, ["custom"]);Hr(1, { content: i, shareConfigId: n, activityId: r });
  }(), r && (r.gameId = i), Qt.setUserInfo(e));
}function Lr(e) {
  var t = e || {},
      n = t.config,
      r = t.onTap,
      i = t.G$8L,
      s = t.stayOnDeny;return new Promise(function (e, t) {
    var o = Vr(n);if (!o) throw Fe;o.onTap(function (n) {
      var i = (n || {}).encryptedData;i ? e(n) : s || t(Ue), r && r(n), !i && s || Nr();
    }), o.show(), i && i();
  });
}function Vr(e) {
  return Nr(), wr = Sr(e);
}function Nr() {
  wr && (wr.hide(), wr.destroy(), wr = null);
}function Mr() {
  return r(this, void 0, void 0, function () {
    var e;return i(this, function (t) {
      switch (t.label) {case 0:
          return [4, br()];case 1:
          return (e = t.sent()) ? [3, 3] : [4, qr()];case 2:
          e = t.sent(), t.label = 3;case 3:
          if (!e) throw Ue;return [4, _r()];case 4:
          return [2, t.sent()];}
    });
  });
}function qr() {
  return r(this, void 0, void 0, function () {
    return i(this, function (e) {
      switch (e.label) {case 0:
          return e.trys.push([0, 4,, 5]), [4, new Promise(function (e, t) {
            wx.openSetting({ success: function (t) {
                e(t.authSetting["scope.userInfo"]);
              }, fail: t });
          })];case 1:
          return e.sent() ? [2, !0] : [4, yr({ title: "提示", content: "需要开启访问用户信息权限", showCancel: !0, cancelText: "知道了", confirmText: "去设置" })];case 2:
          return e.sent().confirm ? [4, qr()] : [2, !1];case 3:
          return [2, e.sent()];case 4:
          return a("low auth fail", e.sent()), [2, !1];case 5:
          return [2];}
    });
  });
}function Hr(e, t) {
  var n = Qt.getTempUser() || {},
      r = n.userId,
      i = n.uniqueId,
      s = ot(),
      o = "";try {
    o = JSON.stringify(s);
  } catch (e) {
    u("_postLog err", e);
  }var a = Ir.getStorage("__sdk_postLog_rawData_logType_" + e + "__");a && a === o ? o = "" : Ir.setStorage("__sdk_postLog_rawData_logType_" + e + "__", o);var c = s.custom,
      h = s.scene,
      d = c || {},
      f = s.coldStart ? 0 : 1,
      l = { logType: e, channel: d.channel, origChannel: d.origChannel, shareConfigId: d.shareConfigId, scene: h, userId: r, uniqueId: i };3 === e && (l.open_type = f), o && (l.rawData = o);var p = t ? Object.assign(l, t) : l;T.dispatch("EVT_REPORT_LOG", { log: p });
}function Fr(e) {
  return Sr(e);
}function Gr(e) {
  return Tr(e, !1);
}function jr(e) {
  return Tr(e, !0);
}function Kr(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return T.dispatch("EVT_UPDATE_START"), [4, Er(e, !1, !0)];case 1:
            return t = n.sent(), Hr(3), T.dispatch("EVT_ON_UPDATE", t), [2, t.encryptUserInfo];}
      });
    });
  }(e);
}function Br(e) {
  var t;e = nn(e, "registerOnLogin"), t = e.listener, T.on("EVT_ON_LOGIN", t);
}function Wr(e) {
  return wr && !e ? wr : Vr(e);
}function zr(e) {
  !function (e) {
    Qt.setGameUser(e);
  }(e);
}var Qr = function (e) {
  return new Promise(function (t, n) {
    wx.requestMidasPayment(Object.assign({}, e, { success: t, fail: n }));
  });
},
    Jr = 1,
    Yr = 3;function Xr(e, t, n) {
  T.dispatch("EVT_REPORT_LOG", { log: { orderId: t, logType: e, errMsg: n } });
}function $r(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s, o, c, u, h, d, f;return i(this, function (i) {
      switch (i.label) {case 0:
          n = (t = e || {}).orderId, r = t.appId, s = t.path, o = t.extraData, c = t.envVersion, u = void 0 === c ? "release" : c, h = encodeURIComponent("o=" + n), d = s || "/pages/index/index?scene=" + h, i.label = 1;case 1:
          return i.trys.push([1, 3,, 7]), [4, pn.navigateToMiniProgram({ appId: r, path: d, extraData: o, envVersion: u })];case 2:
          return [2, i.sent()];case 3:
          if (!(f = i.sent()) || !f.isCancel) return [3, 4];throw Re;case 4:
          return a("jumpAppPay fail", f), [4, Zr(e)];case 5:
          return [2, i.sent()];case 6:
          return [3, 7];case 7:
          return [2];}
    });
  });
}function Zr(e) {
  return r(this, void 0, void 0, function () {
    var t, n;return i(this, function (r) {
      switch (r.label) {case 0:
          return t = e.orderId, n = O() + "/mini/api/v1/minicode/create2?orderId=" + t, [4, pn.previewImage(n)];case 1:
          return [2, r.sent()];}
    });
  });
}function ei(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s;return i(this, function (i) {
      switch (i.label) {case 0:
          if (t = e.path, n = e.title, r = e.imgUrl, s = { showMessageCard: !0, sendMessageTitle: n, sendMessageImg: r, sendMessagePath: t }, !n || !r || !t) throw Ne;return [4, jn.openCustomerServiceConversation(s)];case 1:
          return [2, i.sent()];}
    });
  });
}function ti(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            if (t = e.orderId, n = e.midashiPayInfo, !t) throw Ne;Xr(13, t, "[SDK] call midashi: " + t), i.label = 1;case 1:
            return i.trys.push([1, 4,, 5]), [4, Qr(n)];case 2:
            return i.sent(), Xr(8, t, "[SDK] midashi success: " + t), s = O() + "/mini/api/v1/pay/callback", [4, R.post(s, { orderId: t })];case 3:
            if ("success" !== i.sent().data) throw Pe;return Xr(9, t, "[SDK] MinigameCallback Success: " + t), [3, 5];case 4:
            throw r = i.sent(), Xr(7, t, JSON.stringify(r)), s = O() + "/mini/api/v1/order/cancel", R.post(s, { orderId: t }).catch(function () {}), T.dispatch("EVY_PAY_FAIL", { payType: 0, err: r }), r;case 5:
            return [2];}
      });
    });
  }(e);
}function ni(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            if (t = e.orderId, n = e.jumpType, !t || "number" != typeof n) throw Ne;i.label = 1;case 1:
            return i.trys.push([1, 7,, 8]), n !== Jr ? [3, 3] : [4, $r(e)];case 2:
            return [2, i.sent()];case 3:
            return n !== Yr ? [3, 5] : [4, ei(e)];case 4:
            return [2, i.sent()];case 5:
            return [4, Zr(e)];case 6:
            return [2, i.sent()];case 7:
            throw r = i.sent(), T.dispatch("EVY_PAY_FAIL", { payType: n, err: r }), Xr(7, t, JSON.stringify(r)), r;case 8:
            return [2];}
      });
    });
  }(e);
}var ri = { _canUseRecorder: we("getRecorderManager", "1.6.0"), getRecorder: function () {
    if (this._canUseRecorder) return wx.getRecorderManager();
  } },
    ii = function (e) {
  return new Promise(function (t, n) {
    wx.uploadFile({ url: e.url, filePath: e.filePath, name: e.fileName, formData: e.formData, success: function (e) {
        t(e);
      }, fail: function (e) {
        n(e);
      } });
  });
},
    si = function () {
  function e(e) {
    return encodeURIComponent(e).replace(/!/g, "%21").replace(/'/g, "%27").replace(/\(/g, "%28").replace(/\)/g, "%29").replace(/\*/g, "%2A");
  }var t = t || function (e, t) {
    var n = {},
        r = n.lib = {},
        i = function () {},
        s = r.Base = { extend: function (e) {
        i.prototype = this;var t = new i();return e && t.mixIn(e), t.hasOwnProperty("init") || (t.init = function () {
          t.$super.init.apply(this, arguments);
        }), t.init.prototype = t, t.$super = this, t;
      }, create: function () {
        var e = this.extend();return e.init.apply(e, arguments), e;
      }, init: function () {}, mixIn: function (e) {
        for (var t in e) e.hasOwnProperty(t) && (this[t] = e[t]);e.hasOwnProperty("toString") && (this.toString = e.toString);
      }, clone: function () {
        return this.init.prototype.extend(this);
      } },
        o = r.WordArray = s.extend({ init: function (e, t) {
        e = this.words = e || [], this.sigBytes = null != t ? t : 4 * e.length;
      }, toString: function (e) {
        return (e || c).stringify(this);
      }, concat: function (e) {
        var t = this.words,
            n = e.words,
            r = this.sigBytes;if (e = e.sigBytes, this.clamp(), r % 4) for (var i = 0; i < e; i++) t[r + i >>> 2] |= (n[i >>> 2] >>> 24 - i % 4 * 8 & 255) << 24 - (r + i) % 4 * 8;else if (65535 < n.length) for (i = 0; i < e; i += 4) t[r + i >>> 2] = n[i >>> 2];else t.push.apply(t, n);return this.sigBytes += e, this;
      }, clamp: function () {
        var t = this.words,
            n = this.sigBytes;t[n >>> 2] &= 4294967295 << 32 - n % 4 * 8, t.length = e.ceil(n / 4);
      }, clone: function () {
        var e = s.clone.call(this);return e.words = this.words.slice(0), e;
      }, random: function (t) {
        for (var n = [], r = 0; r < t; r += 4) n.push(4294967296 * e.random() | 0);return new o.init(n, t);
      } }),
        a = n.enc = {},
        c = a.Hex = { stringify: function (e) {
        var t = e.words;e = e.sigBytes;for (var n = [], r = 0; r < e; r++) {
          var i = t[r >>> 2] >>> 24 - r % 4 * 8 & 255;n.push((i >>> 4).toString(16)), n.push((15 & i).toString(16));
        }return n.join("");
      }, parse: function (e) {
        for (var t = e.length, n = [], r = 0; r < t; r += 2) n[r >>> 3] |= parseInt(e.substr(r, 2), 16) << 24 - r % 8 * 4;return new o.init(n, t / 2);
      } },
        u = a.Latin1 = { stringify: function (e) {
        var t = e.words;e = e.sigBytes;for (var n = [], r = 0; r < e; r++) n.push(String.fromCharCode(t[r >>> 2] >>> 24 - r % 4 * 8 & 255));return n.join("");
      }, parse: function (e) {
        for (var t = e.length, n = [], r = 0; r < t; r++) n[r >>> 2] |= (255 & e.charCodeAt(r)) << 24 - r % 4 * 8;return new o.init(n, t);
      } },
        h = a.Utf8 = { stringify: function (e) {
        try {
          return decodeURIComponent(escape(u.stringify(e)));
        } catch (e) {
          throw Error("Malformed UTF-8 data");
        }
      }, parse: function (e) {
        return u.parse(unescape(encodeURIComponent(e)));
      } },
        d = r.BufferedBlockAlgorithm = s.extend({ reset: function () {
        this._data = new o.init(), this._nDataBytes = 0;
      }, _append: function (e) {
        "string" == typeof e && (e = h.parse(e)), this._data.concat(e), this._nDataBytes += e.sigBytes;
      }, _process: function (t) {
        var n = this._data,
            r = n.words,
            i = n.sigBytes,
            s = this.blockSize,
            a = i / (4 * s);if (t = (a = t ? e.ceil(a) : e.max((0 | a) - this._minBufferSize, 0)) * s, i = e.min(4 * t, i), t) {
          for (var c = 0; c < t; c += s) this._doProcessBlock(r, c);c = r.splice(0, t), n.sigBytes -= i;
        }return new o.init(c, i);
      }, clone: function () {
        var e = s.clone.call(this);return e._data = this._data.clone(), e;
      }, _minBufferSize: 0 });r.Hasher = d.extend({ cfg: s.extend(), init: function (e) {
        this.cfg = this.cfg.extend(e), this.reset();
      }, reset: function () {
        d.reset.call(this), this._doReset();
      }, update: function (e) {
        return this._append(e), this._process(), this;
      }, finalize: function (e) {
        return e && this._append(e), this._doFinalize();
      }, blockSize: 16, _createHelper: function (e) {
        return function (t, n) {
          return new e.init(n).finalize(t);
        };
      }, _createHmacHelper: function (e) {
        return function (t, n) {
          return new f.HMAC.init(e, n).finalize(t);
        };
      } });var f = n.algo = {};return n;
  }(Math);!function () {
    var e = t,
        n = (s = e.lib).WordArray,
        r = s.Hasher,
        i = [],
        s = e.algo.SHA1 = r.extend({ _doReset: function () {
        this._hash = new n.init([1732584193, 4023233417, 2562383102, 271733878, 3285377520]);
      }, _doProcessBlock: function (e, t) {
        for (var n = this._hash.words, r = n[0], s = n[1], o = n[2], a = n[3], c = n[4], u = 0; 80 > u; u++) {
          if (16 > u) i[u] = 0 | e[t + u];else {
            var h = i[u - 3] ^ i[u - 8] ^ i[u - 14] ^ i[u - 16];i[u] = h << 1 | h >>> 31;
          }h = (r << 5 | r >>> 27) + c + i[u], h = 20 > u ? h + (1518500249 + (s & o | ~s & a)) : 40 > u ? h + (1859775393 + (s ^ o ^ a)) : 60 > u ? h + ((s & o | s & a | o & a) - 1894007588) : h + ((s ^ o ^ a) - 899497514), c = a, a = o, o = s << 30 | s >>> 2, s = r, r = h;
        }n[0] = n[0] + r | 0, n[1] = n[1] + s | 0, n[2] = n[2] + o | 0, n[3] = n[3] + a | 0, n[4] = n[4] + c | 0;
      }, _doFinalize: function () {
        var e = this._data,
            t = e.words,
            n = 8 * this._nDataBytes,
            r = 8 * e.sigBytes;return t[r >>> 5] |= 128 << 24 - r % 32, t[14 + (r + 64 >>> 9 << 4)] = Math.floor(n / 4294967296), t[15 + (r + 64 >>> 9 << 4)] = n, e.sigBytes = 4 * t.length, this._process(), this._hash;
      }, clone: function () {
        var e = r.clone.call(this);return e._hash = this._hash.clone(), e;
      } });e.SHA1 = r._createHelper(s), e.HmacSHA1 = r._createHmacHelper(s);
  }(), function () {
    var e = t,
        n = e.enc.Utf8;e.algo.HMAC = e.lib.Base.extend({ init: function (e, t) {
        e = this._hasher = new e.init(), "string" == typeof t && (t = n.parse(t));var r = e.blockSize,
            i = 4 * r;t.sigBytes > i && (t = e.finalize(t)), t.clamp();for (var s = this._oKey = t.clone(), o = this._iKey = t.clone(), a = s.words, c = o.words, u = 0; u < r; u++) a[u] ^= 1549556828, c[u] ^= 909522486;s.sigBytes = o.sigBytes = i, this.reset();
      }, reset: function () {
        var e = this._hasher;e.reset(), e.update(this._iKey);
      }, update: function (e) {
        return this._hasher.update(e), this;
      }, finalize: function (e) {
        var t = this._hasher;return e = t.finalize(e), t.reset(), t.finalize(this._oKey.clone().concat(e));
      } });
  }(), function () {
    var e = t,
        n = e.lib.WordArray;e.enc.Base64 = { stringify: function (e) {
        var t = e.words,
            n = e.sigBytes,
            r = this._map;e.clamp();for (var i = [], s = 0; s < n; s += 3) for (var o = (t[s >>> 2] >>> 24 - s % 4 * 8 & 255) << 16 | (t[s + 1 >>> 2] >>> 24 - (s + 1) % 4 * 8 & 255) << 8 | t[s + 2 >>> 2] >>> 24 - (s + 2) % 4 * 8 & 255, a = 0; a < 4 && s + .75 * a < n; a++) i.push(r.charAt(o >>> 6 * (3 - a) & 63));var c = r.charAt(64);if (c) for (; i.length % 4;) i.push(c);return i.join("");
      }, parse: function (e) {
        var t = e.length,
            r = this._map,
            i = r.charAt(64);if (i) {
          var s = e.indexOf(i);-1 != s && (t = s);
        }for (var o = [], a = 0, c = 0; c < t; c++) if (c % 4) {
          var u = r.indexOf(e.charAt(c - 1)) << c % 4 * 2,
              h = r.indexOf(e.charAt(c)) >>> 6 - c % 4 * 2;o[a >>> 2] |= (u | h) << 24 - a % 4 * 8, a++;
        }return n.create(o, a);
      }, _map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" };
  }();return function (n) {
    if (!n.SecretId) return console.error("missing param SecretId");if (!n.SecretKey) return console.error("missing param SecretKey");if ("4.0" === n.Version) return function (e) {
      var n = e.Pathname || "/",
          r = e.Expires,
          i = "",
          s = "",
          o = e.Bucket.match(/^(.+)-(\d+)$/);o && (i = o[1], s = o[2]);var a = parseInt(String(Math.random() * Math.pow(2, 32))),
          c = parseInt(String(Date.now() / 1e3)),
          u = c + (void 0 === r ? 900 : 1 * r || 0),
          h = "/" + s + "/" + i + encodeURIComponent(n).replace(/%2F/g, "/"),
          d = "a=" + s + "&b=" + i + "&k=" + e.SecretId + "&e=" + u + "&t=" + c + "&r=" + a + "&f=" + h,
          f = t.HmacSHA1(d, e.SecretKey),
          l = t.enc.Utf8.parse(d);return f.concat(l).toString(t.enc.Base64);
    }(n);var r = (n = n || {}).SecretId,
        i = n.SecretKey,
        s = (n.Method || "get").toLowerCase(),
        o = n.Query || {},
        a = n.Headers || {},
        c = n.Pathname || "/",
        u = n.Expires,
        h = function (e) {
      var t = [];for (var n in e) e.hasOwnProperty(n) && t.push(n);return t.sort(function (e, t) {
        return (e = e.toLowerCase()) === (t = t.toLowerCase()) ? 0 : e > t ? 1 : -1;
      });
    },
        d = function (t) {
      var n,
          r,
          i,
          s = [],
          o = h(t);for (n = 0; n < o.length; n++) i = void 0 === t[r = o[n]] || null === t[r] ? "" : "" + t[r], r = e(r = r.toLowerCase()), i = e(i) || "", s.push(r + "=" + i);return s.join("&");
    },
        f = parseInt(String(new Date().getTime() / 1e3)) - 1,
        l = f + (void 0 === u ? 900 : 1 * u || 0),
        p = r,
        g = f + ";" + l,
        v = f + ";" + l,
        m = h(a).join(";").toLowerCase(),
        _ = h(o).join(";").toLowerCase(),
        w = t.HmacSHA1(v, i).toString(),
        y = [s, c, d(o), d(a), ""].join("\n"),
        I = ["sha1", g, t.SHA1(y).toString(), ""].join("\n");return ["q-sign-algorithm=sha1", "q-ak=" + p, "q-sign-time=" + g, "q-key-time=" + v, "q-header-list=" + m, "q-url-param-list=" + _, "q-signature=" + t.HmacSHA1(I, w).toString()].join("&");
  };
}(),
    oi = { upload: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return [4, this._getCredit()];case 1:
            return t = i.sent(), [4, this._getAuth(t)];case 2:
            return n = i.sent(), r = e.substr(e.lastIndexOf("/") + 1), [4, this._upload(n, e, { key: t.pathName + "/" + r, success_action_status: 200, Signature: n.Authorization, "x-cos-security-token": n.XCosSecurityToken, "Content-Type": "" })];case 3:
            return [2, i.sent()];}
      });
    });
  }, _upload: function (e, t, n) {
    return r(this, void 0, void 0, function () {
      return i(this, function (r) {
        switch (r.label) {case 0:
            return [4, ii(Object.assign({}, e, { fileName: "file", filePath: t, formData: n }))];case 1:
            return 200 !== r.sent().statusCode ? [3, 2] : [2, e.fileUrl + "/" + n.key];case 2:
            return [4, Promise.reject(new Error("upload failed!"))];case 3:
            r.sent(), a("upload failed!"), r.label = 4;case 4:
            return [2];}
      });
    });
  }, _getCredit: function () {
    return r(this, void 0, void 0, function () {
      var e;return i(this, function (t) {
        switch (t.label) {case 0:
            return (e = this._getCreditFromStorage()) ? [2, e] : [4, this._requestCredit()];case 1:
            return [2, t.sent()];}
      });
    });
  }, _getAuth: function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        return [2, { pathName: e.pathName, url: e.upUrl, fileUrl: e.cdnUrl, XCosSecurityToken: e.sessionToken, Authorization: si({ SecretId: e.tmpSecretId, SecretKey: e.tmpSecretKey, Method: "POST", Pathname: "/" }) }];
      });
    });
  }, _requestCredit: function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r, s, o, a;return i(this, function (i) {
        switch (i.label) {case 0:
            return e = at(), t = e.gameId, n = e.gameVersion, r = (Qt.getSDKUserInfo() || {}).uniqueId, s = { gameId: t, gameVersion: n, userId: r }, o = k() + "/cos-server/api/v1/cos/tmpsts", [4, R.get(o, s)];case 1:
            return a = i.sent(), this._setCreditToStorage(a.data), [2, a.data];}
      });
    });
  }, _setCreditToStorage: function (e) {
    this._creditCache = e, q.set("UploadCredit", e);
  }, _getCreditFromStorage: function () {
    var e = this._creditCache || q.get("UploadCredit") || {},
        t = e.expire;return (!t || M.getTime() > t) && (q.remove("UploadCredit"), e = null), this._creditCache = e, this._creditCache;
  } },
    ai = ["onStart", "onStop", "onPause", "onResume", "onError", "onFrameRecorded", "onInterruptionBegin", "onInterruptionEnd"];function ci() {
  return this.config = null, this.isCanceled = !1, this.listener = null, this.recorder = ri.getRecorder(), this;
}ci.prototype = { isValid: function () {
    return null != this.recorder;
  }, bindRecordListener: function (e) {
    this.listener = e, this._bindEvent();
  }, unbindRecordListener: function () {
    this._unbindEvent(), this.listener = null;
  }, start: function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        return this.config = e || {}, this._checkValid(), this.recorder.start(e), [2];
      });
    });
  }, stop: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        return this._checkValid(), this.recorder.stop(), [2];
      });
    });
  }, cancel: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        return this._checkValid(), this.isCanceled = !0, this.recorder.stop(), [2];
      });
    });
  }, pause: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        return this._checkValid(), this.recorder.pause(), [2];
      });
    });
  }, resume: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        return this._checkValid(), this.recorder.resume(), [2];
      });
    });
  }, _checkValid: function () {
    if (!this.isValid()) throw this.listener && this.listener.onError && this.listener.onError(Fe), Fe;
  }, _bindEvent: function () {
    var e = this;ai.forEach(function (t) {
      e.recorder[t](function (n, r) {
        if (e.listener) return "onStop" === t ? e._handleOnStop(n, r) : void (e.listener[t] && e.listener[t](n));
      });
    });
  }, _unbindEvent: function () {
    var e = this;ai.forEach(function (t) {
      e.recorder[t] = null;
    });
  }, _handleOnStop: function (e, t) {
    return r(this, void 0, void 0, function () {
      var n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            if (this.isCanceled) return this.isCanceled = !1, [2, this.listener.onCancel && this.listener.onCancel()];if (t) return [2, this.listener.onError && this.listener.onError(t)];if (!this.config) return [2, this.listener.onError && this.listener.onError(Ge)];if (e.duration < this.config.minDuration && this.listener.onError && this.listener.onError(Be), e.url = e.tempFilePath, this.config.disableUpload) return [3, 4];i.label = 1;case 1:
            return i.trys.push([1, 3,, 4]), n = e, [4, oi.upload(e.url)];case 2:
            return n.url = i.sent(), [3, 4];case 3:
            return r = i.sent(), this.listener.onError && this.listener.onError(r), [3, 4];case 4:
            return this.listener.onStop(e), [2];}
      });
    });
  } };var ui = function () {
  var e = new ci();return e.isValid() ? e : null;
};function hi() {
  return ui();
}var di,
    fi,
    li,
    pi = function () {
  return { ins: ui(), start: function (e) {
      if (this.ins) {
        var t = e.config;this.ins.bindRecordListener(e), this.ins.start(t).catch(function () {});
      }
    }, stop: function () {
      this.ins && this.ins.stop().catch(function () {});
    }, cancel: function () {
      this.ins && this.ins.cancel().catch(function () {});
    }, pause: function () {
      this.ins && this.ins.pause().catch(function () {});
    }, resume: function () {
      this.ins && this.ins.resume().catch(function () {});
    } };
},
    gi = { _opt: { newDays: 3, newShareLimitHours: 2, newShareLimitTimes: 15, firstShareFail: !0, successTimesAfterFail: 1, shareFailRate: .3 }, _save: null, _resetHour: 0, _getSave: function () {
    return this._save || (this._save = q.get("__sdk_share_rules") || { shareCounts: [], forceSucTimes: 0, updateTime: 0 }), this._save;
  }, _setSave: function (e) {
    e && (this._save = Object.assign({}, this._save || {}, e), this._save.updateTime = M.getTime(), q.set("__sdk_share_rules", this._save));
  }, checkStorage: function (e) {
    var t = this._getSave(),
        n = t.updateTime,
        r = t.todayStart,
        i = e.now,
        s = n || 0,
        o = r + M.toMSecond(this._resetHour);(i > o && s < o || s > i) && (this._save.shareCounts = [], this._save.forceSucTimes = 0);
  }, setOptions: function (e) {
    this._opt = e || this._opt;
  }, getShareState: function () {
    return Je;
  }, getDays: function (e) {
    var t = 1e3 * ~~(Qt.getSDKUserInfo() || {}).createdAt;return t ? (e - M.todayStart(t)) / M.toMSecond(24) : 0;
  }, _getResult: function (e) {
    var t = e.days,
        n = this._getSave(),
        r = n.shareCounts,
        i = n.forceSucTimes,
        s = r.length,
        o = this._opt,
        a = o.firstShareFail,
        c = o.shareFailRate,
        u = void 0 === c ? 0 : c;return t < 1 && 0 === s ? Je.AUTO : a && t >= 1 && 0 === s ? Je.FAIL : i ? Je.AUTO : u && Math.random() < u ? Je.FAIL : Je.AUTO;
  }, getResult: function (e) {
    var t = this._getResult(e),
        n = this._getSave().forceSucTimes,
        r = n;(r > 0 && r--, t === Je.FAIL) && (r = this._opt.successTimesAfterFail || 1);return r !== n && this._setSave({ forceSucTimes: r }), t;
  }, canUse: function (e) {
    var t = e.now,
        n = e.days;if (e.forceShare) return !0;if (n < this._opt.newDays) {
      var r = this._opt,
          i = r.newShareLimitTimes,
          s = r.newShareLimitHours,
          o = this._getSave().shareCounts,
          a = void 0 === o ? [] : o,
          c = t - (a[0] || 0),
          u = a.length,
          h = M.toMSecond(s);if (u >= i && c < h) return !1;
    }return !0;
  }, consume: function () {
    var e = this._opt.newShareLimitTimes,
        t = this._getSave().shareCounts,
        n = void 0 === t ? [] : t;n.push(M.getTime());var r = n.length - e;r > 0 && n.splice(0, r), this._setSave({ shareCounts: n });
  } },
    vi = { ad: 0, share: 1, interstitial: 100 },
    mi = [0, 1, 100],
    _i = !1,
    wi = vi;function yi(e) {
  li = Object.assign({}, li || {}, e || {}), gi.setOptions(li);
}function Ii(e, t) {
  return { type: e, shareGuid: M.generateGuid(), forceResult: t, isGray: !1, isLocal: !0 };
}function Ti(e) {
  var t,
      n = e || {},
      r = n.seq,
      i = void 0 === r ? [] : r,
      s = n.isGray,
      o = n.video_play_freeze_time,
      a = void 0 === o ? 0 : o,
      c = n.video_play_freeze_enable,
      u = void 0 === c ? 0 : c;s && !di.isGray && (di.seq = []);var h = i && i.length ? function (e) {
    return void 0 === e && (e = []), e.filter(function (e) {
      return mi.includes(e.type);
    }).map(function (e) {
      return e.isLocal = !1, e;
    });
  }(i) : li.defaultSeq.map(function (e) {
    return Ii(e);
  });(t = di.seq).push.apply(t, h), di.saveTime = M.getTime(), di.isGray = !!s, di.video_play_freeze_time = a, di.video_play_freeze_enable = u, q.set("__sdk_std_seq", di);
}function Si(e) {
  var t = e.forceShare,
      n = function (e) {
    li || yi({ newDays: 3, newShareLimitHours: 2, newShareLimitTimes: 15, firstShareFail: !0, successTimesAfterFail: 1, shareFailRate: .3, seqResetHour: 6, defaultSeq: [1, 0, 1, 0, 1, 0, 0, 1, 0, 0] }), di || (di = q.get("__sdk_std_seq") || { seq: [] }), gi.checkStorage(e);var t = di.saveTime;if (!t) return di;var n = e.now,
        r = t || 0,
        i = e.todayStart + M.toMSecond(li.seqResetHour);return (n > i && r < i || r > n) && (di.seq = []), di;
  }(e),
      r = n.seq,
      i = n.isGray;if ((r ? r.length : 0) <= 2 && function () {
    var e = Qt.getSDKUserInfo() || {},
        t = e.createdAt,
        n = e.uniqueId,
        r = e.userId,
        i = { gameId: at().gameId, uniqueId: n, openId: r, createdAt: t },
        s = k() + "/share_seq-server/api/v1/seq";R.get(s, i).then(function (e) {
      a("load std schemes: ", e), Ti(e && e.data);
    }).catch(function (e) {
      Ti(null);
    });
  }(), !i) return Ii(gi.canUse(e) ? vi.share : vi.ad);var s = t || !r.length ? Ii(vi.share) : r[0];return s.isGray = i || !1, s;
}function bi(e) {
  var t = fi || {},
      n = t.shareGuid,
      r = t.type;if (n) {
    var i = (e || {}).data;if (r === vi.share) {
      var s = i || {},
          o = s.shareData,
          c = s.shareSuccess,
          u = s.isForce,
          h = s.isActiveUse;if (((l = (o || {}).sequenceInfo) || {}).shareGuid != n) return;return u && !c ? (fi.forceResult = Je.AUTO, void a("seq change")) : void (c && !h && Ci());
    }if (r !== vi.ad) {
      if (r !== vi.interstitial) ;else {
        if (((l = (i || {}).sequenceInfo) || {}).shareGuid != n) return;(h = (i || {}).isActiveUse) || Ci();
      }
    } else {
      var d = i || {},
          f = d.isEnded,
          l = d.sequenceInfo,
          h = d.isActiveUse;if ((l || {}).shareGuid != n) return;!f && void 0 !== f || h || Ci();
    }
  }
}function Ei(e) {
  !function () {
    _i || (_i = !0, T.on("EVT_SHARE_END", bi.bind(this)), T.on("EVT_VIDEO_AD_PLAY_FINISH", bi.bind(this)), T.on("EVT_INTERSTITIAL_AD_SHOW", bi.bind(this)));
  }();var t = (e || {}).forceShare;if (fi) return fi;var n = M.getTime(),
      r = { now: n, days: gi.getDays(n), forceShare: t, todayStart: M.todayStart(n) };a("get seq by: ", r, di);var i = Si(r);i.type === vi.share && (i.forceResult = gi.getResult(r)), fi = i;var s = JSON.parse(JSON.stringify(i));return delete s.isLocal, s;
}function Ci(e) {
  if (void 0 === e && (e = !1), fi) {
    var t = fi.isLocal;e && fi && function (e) {
      var t = fi.type,
          n = fi;t === vi.ad && (a("use seq videoAd"), T.dispatch("EVT_VIDEO_AD_PLAY_FINISH", { sequenceInfo: n, adType: 0, isActiveUse: e }));t === vi.share && (a("use seq share", n), T.dispatch("EVT_SHARE_END", { wx_share_type: 3, shareData: { sequenceInfo: n, shareGuid: n.shareGuid }, isActiveUse: e }));t === vi.interstitial && (a("use seq interstitialAd"), T.dispatch("EVT_INTERSTITIAL_AD_SHOW", { sequenceInfo: n, adType: 1, isActiveUse: e }));
    }(e), fi = null;var n = (di || {}).seq;n && n.length && t === n[0].isLocal && (di.seq.shift(), q.set("__sdk_std_seq", di)), gi.consume(), a("seq consume");
  }
}function Oi() {
  return { newDays: 3, newShareLimitHours: 2, newShareLimitTimes: 15, firstShareFail: !0, successTimesAfterFail: 1, shareFailRate: .3, seqResetHour: 6, defaultSeq: [1, 0, 1, 0, 1, 0, 0, 1, 0, 0] };
}function ki(e) {
  yi(Object.assign(Ai(), e));
}function Ai() {
  return li || { newDays: 3, newShareLimitHours: 2, newShareLimitTimes: 15, firstShareFail: !0, successTimesAfterFail: 1, shareFailRate: .3, seqResetHour: 6, defaultSeq: [1, 0, 1, 0, 1, 0, 0, 1, 0, 0] };
}function xi() {
  return wi;
}function Di(e) {
  return Ei(e);
}function Ri() {
  Ci(!0);
}var Pi = {},
    Ui = function (e, t) {
  Pi[e] = t;
},
    Li = function (e) {
  return !!Pi[e];
},
    Vi = { _renderQuery: function (e) {
    var t = e || {},
        n = t.query,
        r = t.shareConfigId,
        i = t.activityId,
        s = t.shareGuid,
        o = M.getTimeSec(),
        a = Qt.getSDKUserInfo() || {},
        c = a.h_shareCode,
        u = void 0 === c ? "" : c,
        h = a.channel,
        d = void 0 === h ? "hortor_" : h,
        f = a.origChannel,
        l = void 0 === f ? "" : f,
        p = { channel: M.endsWith(d, "_") ? d : d + "_", h_shareCode: u, timestamp: o, origChannel: l, shareConfigId: r, activityId: i, share_guid: s };return M.addToQuery(n, p);
  }, _renderTitle: function (e) {
    var t = e || {},
        n = t.title,
        r = t.titleParams;if (!n) return "";r && "object" == typeof r && Object.keys(r).forEach(function (e) {
      if (new RegExp("({{" + e + "}})").test(n)) {
        var t = r[e] + "";n = n.replace(RegExp.$1, t);
      }
    });return n = n.replace(/({{[-\w]*}})/g, "");
  }, _renderImageUrl: function (e) {
    var t = e || {},
        n = t.imageUrl,
        r = t.imageParams;if (!n) return "";r && "object" == typeof r && Object.keys(r).forEach(function (e) {
      if (new RegExp("({{" + e + "}})").test(n)) {
        var t = r[e] + "";n = n.replace(RegExp.$1, t);
      }
    });return n = n.replace(/({{[-\w]*}})/g, "");
  }, _renderShareGuid: function (e) {
    var t = e || {},
        n = t.query,
        r = t.shareGuid,
        i = void 0 === r ? "" : r,
        s = (t.sequenceInfo || {}).shareGuid;if (!M.isEmpty(s)) return s;if (!M.isEmpty(i)) return i;var o = M.queryToJson(n);return M.isEmpty(o.share_guid) ? M.generateGuid() : o.share_guid;
  }, _renderForceResult: function (e) {
    return ((e || {}).sequenceInfo || {}).forceResult;
  }, _renderShareId: function (e) {
    var t = e || {},
        n = t.id,
        r = t.query;return n || M.queryToJson(r).shareConfigId || "";
  }, renderShare: function (e, t) {
    var n = (e || {}).beforeShare,
        r = M.isFun(n) ? n(t) : null,
        i = Object.assign({}, t || {}, e || {}, r || {});return i.shareConfigId = this._renderShareId(i), i.title = this._renderTitle(i), i.imageUrl = this._renderImageUrl(i), i.shareGuid = this._renderShareGuid(i), i.query = this._renderQuery(i), i.forceResult = this._renderForceResult(i), M.copy(i, ["id", "gameID", "beforeShare", "success", "fail", "complete"]);
  }, renderShareThemes: function (e) {
    if (!e || !e.length) return {};var t = {},
        n = {};for (var r in e.map(function (e) {
      t[e.type] = t[e.type] || [], t[e.type].push(e);
    }), t) n[r] = new ln({ list: t[r] });return n;
  }, renderPostParams: function (e) {
    var t = e || {},
        n = t.shareConfigId;return { shareConfigId: void 0 === n ? "" : n, customShareType: t.shareType, activityId: t.activityId, content: M.copy(e, ["activityId", "shareType", "shareConfigId"]) };
  } },
    Ni = we("updateShareMenu", "1.2.0"),
    Mi = we("updateShareMenu", "2.4.0");function qi(e) {
  wx.showShareMenu(e);
}function Hi(e) {
  return new Promise(function (t, n) {
    Ni ? void 0 === e.isUpdatableMessage || Mi ? wx.updateShareMenu(Object.assign({}, e || {}, { success: t, fail: n })) : n(Me) : n(Fe);
  });
}function Fi(e) {
  return new Promise(function (t, n) {
    wx.getShareInfo(Object.assign({}, e, { success: function (e) {
        "getShareInfo:ok" === e.errMsg ? t(e) : n(e);
      }, fail: n }));
  });
}function Gi(e) {
  we("onShareMessageToFriend", "2.9.4") && wx.onShareMessageToFriend(e);
}var ji = { set: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return n = (t = e || {}).activityId, r = t.templateInfo, [4, Hi({ withShareTicket: !0, isUpdatableMessage: !0, activityId: n, templateInfo: void 0 === r ? {} : r })];case 1:
            return [2, i.sent()];}
      });
    });
  }, clear: function () {
    return r(this, void 0, void 0, function () {
      return i(this, function (e) {
        switch (e.label) {case 0:
            return [4, M.wait(1)];case 1:
            return e.sent(), [4, Hi({ withShareTicket: !0, isUpdatableMessage: !1, templateInfo: {} })];case 2:
            return [2, e.sent()];}
      });
    });
  } };function Ki() {
  return this.forceResult = void 0, this.destroyed = !1, this.inited = !1, this;
}Ki.prototype = { init: function (e) {
    if (!this.inited) {
      this.inited = !0;var t = e || {},
          n = t.forceResult,
          r = t.shareSuccessDiff,
          i = t.onShareCallbackTime,
          s = t.success,
          o = t.fail,
          a = t.complete;this.successDiff = r || 2e3, this.onCallbackTime = i || 500, this.forceResult = n, this.showEnv = this.G$8L.bind(this, { success: s, fail: o, complete: a }), this._bind();
    }
  }, _bind: function () {
    T.on("EVT_ON_SHOW", this.showEnv);
  }, _unbind: function () {
    T.off("EVT_ON_SHOW", this.showEnv);
  }, G$8L: function (e, t) {
    if (!this.destroyed) {
      var n = e || {},
          r = n.success,
          i = n.fail,
          s = n.complete,
          o = ((t || {}).data || {}).hideDuration;this._check(o || 0).then(function (e) {
        s && M.isFun(s) && s(e), M.isFun(r) && r(e);
      }).catch(function (e) {
        s && M.isFun(s) && s(e), M.isFun(i) && i(e);
      });
    }
  }, _check: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n;return i(this, function (r) {
        switch (r.label) {case 0:
            return M.getTime(), t = this.successDiff, this.destroy(), [4, M.wait(this.onCallbackTime)];case 1:
            if (r.sent(), n = { isForce: !1, isFake: !0, diffTime: e, successDiff: t, errMsg: "微信分享回调已经废弃，这是模拟分享成功" }, this.forceResult === Je.SUC) return n.isForce = !0, n.errMsg = "强制分享成功", [2, n];if (this.forceResult === Je.FAIL) throw n.isForce = !0, n.errMsg = "强制分享失败", n;if (e < t) throw n.errMsg = "分享操作太快，模拟分享失败", n;return [2, n];}
      });
    });
  }, destroy: function () {
    this.destroyed || (this._unbind(), this.destroyed = !0);
  } };var Bi = { withShareTicket: !0, openGetShareTheme: !0, shareSuccessDiff: 2e3, onShareCallbackTime: 500, useShareAdapter: !0 },
    Wi = {},
    zi = {};function Qi() {
  F("PROC_REQ_AGGR", Ji), Yi(at());var e = Wi.openShareTimeline,
      t = void 0 !== e && e,
      n = we("onShareTimeline", "2.11.3") && t;qi(n ? { withShareTicket: !0, menus: ["shareAppMessage", "shareTimeline"] } : { withShareTicket: !0 }), ss(), n && os();var s = Wi || {},
      o = s.openGetShareTheme,
      c = void 0 === o || o,
      u = s.shareThemes;c && function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = (Wi || {}).gameId, n = { gameID: t }, e && e.length && (n.shareTypes = e), r = k() + "/share/api/v1/scheme/all", [4, R.post(r, n)];case 1:
            return [2, i.sent()];}
      });
    });
  }(u).then(function (e) {
    Xi(e);
  }).catch(function (e) {
    a("getShareTheme err", e);
  }), Gi(function (e) {
    T.dispatch("EVT_SHARE_FRIEND", e);
  });
}function Ji(e) {
  a("share process aggr req");var t = (e || {}).resp,
      n = (t || {}).share;return n && Xi(n), t || null;
}function Yi(e) {
  Wi = Object.assign({}, Wi || Bi, e || {});
}function Xi(e) {
  var t = ((e || {}).data || {}).schemes;t && (zi = Vi.renderShareThemes(function (e) {
    return e.map(function (e) {
      return 2 === e.shareScene && (e.imageUrl = e.thumbnailUrl, e.imageUrlId = e.thumbnailId, e.imagePreviewUrl = e.previewUrl, e.imagePreviewUrlId = e.previewId), e;
    });
  }(t)));
}function $i(e) {
  Ui("sharing", !0), e ? T.dispatch("EVT_SHARE_TIME_START", { wx_share_type: 1 }) : T.dispatch("EVT_SHARE_START", { wx_share_type: 0 });
}function Zi(e, t, r, i, s) {
  Ui("sharing", !1);var o = i ? Math.max(M.getTime() - i, 0) : 0,
      a = n(n({ shareData: t, shareSuccess: r, spentTime: o }, e), { wx_share_type: s ? 1 : 0 });return s ? T.dispatch("EVT_SHARE_TIME_END", a) : T.dispatch("EVT_SHARE_END", a), a;
}function es(e) {
  var t = (Wi || {}).shareData,
      n = (e || {}).shareType,
      r = n ? zi[n] : null,
      i = r ? r.getData() : t || {};return Vi.renderShare(e, i);
}function ts(e, t, r, i) {
  var s = M.getTime(),
      o = es(e),
      c = Wi || {},
      u = c.shareSuccessDiff,
      h = c.onShareCallbackTime,
      d = o || {},
      f = d.shareSuccessDiff,
      l = d.onShareCallbackTime,
      p = d.activityId,
      g = Object.assign({}, o, { shareSuccessDiff: f || u, onShareCallbackTime: l || h }),
      v = t || {},
      m = v.success,
      _ = v.fail,
      w = v.complete,
      y = Vi.renderPostParams(g),
      I = new Ki(),
      T = { complete: function (e) {
      I.destroy(), w && M.isFun(w) && w(e), p && ji.clear().catch(function (e) {
        a("update fail", e);
      });
    }, success: function (e) {
      a("share success", e);var t = Zi(e, g, !0, s);i || (ns(y, 2), ns(y, 12)), M.isFun(m) && m(t);
    }, fail: function (e) {
      a("share fail", e);var t = Zi(e, g, !1, s);M.isFun(_) && _(t);
    } },
      S = n(n({}, g), T);return I.init(S), ns(y, i ? 2 : 11), $i(), S;
}function ns(e, t) {
  T.dispatch("EVT_REPORT_LOG", { log: n(n({}, e), { logType: t }) });
}function rs(e, t) {
  return r(this, void 0, void 0, function () {
    return i(this, function (n) {
      switch (n.label) {case 0:
          if (Li("sharing")) throw qe;if (!e.activityId) return [3, 4];n.label = 1;case 1:
          return n.trys.push([1, 3,, 4]), [4, ji.set(e)];case 2:
          return n.sent(), [3, 4];case 3:
          return a("update share err", n.sent()), [3, 4];case 4:
          return [4, is(e, t)];case 5:
          return [2, n.sent()];}
    });
  });
}function is(e, t) {
  return new Promise(function (t, n) {
    var r,
        i = ts(e, { success: t, fail: n }, 0, !1);r = i, wx.shareAppMessage(r);
  });
}function ss(e) {
  !function (e) {
    wx.onShareAppMessage(e);
  }(function (t) {
    var n = e && M.isFun(e) ? e(t) : null,
        r = n || {};return ts(n, { success: r.success, fail: r.fail, complete: r.complete }, 0, !0);
  });
}function os(e) {
  !function (e) {
    wx.onShareTimeline && wx.onShareTimeline(e);
  }(function (t) {
    var r = e && M.isFun(e) ? e(t) : null,
        i = r || {};return function (e, t, r) {
      var i = M.getTime(),
          s = es(e),
          o = Wi || {},
          c = o.shareSuccessDiff,
          u = o.onShareCallbackTime,
          h = s || {},
          d = h.shareSuccessDiff,
          f = h.onShareCallbackTime,
          l = h.activityId,
          p = Object.assign({}, s, { shareSuccessDiff: d || c, onShareCallbackTime: f || u }),
          g = t || {},
          v = g.success,
          m = g.fail,
          _ = g.complete,
          w = Vi.renderPostParams(p),
          y = new Ki(),
          I = { complete: function (e) {
          a("share complete", e), y.destroy(), _ && M.isFun(_) && _(e), l && ji.clear().catch(function (e) {
            a("update fail", e);
          });
        }, success: function (e) {
          a("share success", e);var t = Zi(e, p, !0, i, !0);M.isFun(v) && v(t);
        }, fail: function (e) {
          a("share fail", e);var t = Zi(e, p, !1, i, !0);M.isFun(m) && m(t);
        } },
          T = n(n({}, p), I);return y.init(T), ns(w, 44), $i(!0), T;
    }(r, { success: i.success, fail: i.fail, complete: i.complete });
  });
}function as(e) {
  return rs(e, !0);
}function cs(e) {
  return rs(e, !1);
}function us(e) {
  return function (e) {
    ss(function () {
      return e;
    });
  }(e);
}function hs(e) {
  return function (e) {
    os(function () {
      return e;
    });
  }(e);
}function ds(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      var t, r, s, o, c, u, h, d;return i(this, function (i) {
        switch (i.label) {case 0:
            if (!(t = (e || {}).shareTicket)) throw Ge;return [4, Fi(e)];case 1:
            return r = i.sent(), s = (Wi || {}).gameId, o = (Qt.getSDKUserInfo() || {}).uniqueId, c = k() + "/mini/api/v1/shareinfo", a("getShareInfo params", u = n({ userId: o, gameId: s, shareTicket: t }, r)), [4, R.postForm(c, u)];case 2:
            if (h = i.sent().data, !(d = h) || !d.openGId) throw He;return [2, d];}
      });
    });
  }(e);
}function fs(e) {
  ns({ customShareType: e.shareType }, 19);
}function ls(e) {
  Yi(e);
}function ps(e) {
  return es(e);
}function gs(e) {
  return Hi(e);
}function vs(e) {
  return function (e) {
    return !!we("setMessageToFriendQuery", "2.9.0") && wx.setMessageToFriendQuery(e);
  }(e);
}function ms(e) {
  Gi((e = nn(e, "onShareMessageToFriend")).listener);
}function _s(e) {
  var t;e = nn(e, "onInteractiveStorageModified"), t = e.listener, we("onInteractiveStorageModified", "2.9.0") && wx.onInteractiveStorageModified(t);
}T.once("EVT_SDK_READY", Qi);var ws = "sdk_share",
    ys = "sdk_video_ad_show",
    Is = "track",
    Ts = "user_set",
    Ss = { ALI: 1, TGA: 2, STD: 4, SDK: 8 },
    bs = "begin",
    Es = "suc",
    Cs = "fail",
    Os = "abort",
    ks = "complete",
    As = { INIT: { topic: "", eventType: Is, eventName: "sdk_init", logType: Ss.TGA }, LOGIN: { topic: "", eventType: Is, eventName: "sdk_login", logType: Ss.TGA }, AUTH: { topic: "", eventType: Ts, eventName: "sdk_auth", logType: Ss.STD }, OPEN: { topic: "", eventType: Is, eventName: "sdk_open", logType: Ss.STD }, CLOSE: { topic: "", eventType: Is, eventName: "sdk_close", logType: Ss.STD }, SHARE: { topic: "", eventType: Is, eventName: ws, logType: Ss.TGA }, SHARE_END: { topic: "", eventType: Is, eventName: ws, logType: Ss.TGA | Ss.STD }, VIDEO_AD_SHOW: { topic: "", eventType: Is, eventName: ys, logType: Ss.TGA }, VIDEO_AD_END: { topic: "", eventType: Is, eventName: ys, logType: Ss.TGA | Ss.STD }, BEAT: { topic: "", eventType: Is, eventName: "sdk_heartbeat", logType: Ss.STD }, PROFILE: { topic: "", eventType: Ts, eventName: "sdk_user_profile", logType: Ss.STD }, SET_USER_INFO: { topic: "", eventType: Ts, eventName: "wx_game_role", logType: Ss.STD }, SHARE_FRIEND: { topic: "", eventType: Is, eventName: "sdk_share_to_friend", logType: Ss.TGA } },
    xs = {};Object.keys(As).map(function (e) {
  xs[e] = e, As[e].topic = e;
});var Ds = As,
    Rs = xs,
    Ps = { getCommonData: function () {
    return r(this, void 0, void 0, function () {
      var e;return i(this, function (t) {
        switch (t.label) {case 0:
            return this.baseData || (this.baseData = this._getBaseData()), [4, this._getChangeData()];case 1:
            return (e = t.sent()).clientInfo = Object.assign({}, this.baseData ? this.baseData.clientInfo : {}, e.clientInfo || {}), [2, Object.assign({}, this.baseData, e)];}
      });
    });
  }, getLogDataByTopic: function (e, t) {
    switch (e) {case Ds.OPEN.topic:
        return this._getOpenData(t);case Ds.AUTH.topic:
        return this._getAuthData(t);case Ds.SHARE.topic:
        return this._getShareData(t);case Ds.SHARE_END.topic:
        return this._getShareEndData(t);case Ds.VIDEO_AD_SHOW.topic:
        return this._getVideoAdPlayData(t);case Ds.VIDEO_AD_END.topic:
        return this._getVideoAdEndData(t);case Ds.LOGIN.topic:
        return this._getLoginData(t);case Ds.BEAT.topic:
        return this._getHeartbeatData(t);case Ds.PROFILE.topic:
        return this._getUserProfileData(t);case Ds.SET_USER_INFO.topic:
        return this._getGameUserData(t);default:
        return this._getBasicData(t);}
  }, refreshDataByTopic: function (e, t) {
    return e === Ds.OPEN.topic ? this._refreshOpenData(t) : t;
  }, _getdistinctId: function () {
    return this.distinctId || (this.distinctId = M.generateGuid()), this.distinctId;
  }, _getBaseData: function () {
    var e = at(),
        t = e.gameId,
        n = e.gameVersion,
        r = ye();return { gameId: t, gameVersion: n, logSource: "mini-sdk", clientInfo: { clientType: "weixin", version: r.version, language: r.language, model: r.model, system: r.system, brand: r.brand, pixelRatio: r.pixelRatio, screenWidth: r.screenWidth, screenHeight: r.screenHeight, platform: r.platform, sdkVersion: r.SDKVersion, hsdkVersion: r.hortorSDKVersion } };
  }, _getChangeData: function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r, s, o, a, c;return i(this, function (i) {
        switch (i.label) {case 0:
            return e = this._getdistinctId(), t = Qt.getSDKUserInfo() || {}, n = t.uniqueId, r = t.userId, s = t.channel, o = t.gameUser, a = void 0 === o ? {} : o, [4, Te()];case 1:
            return c = i.sent().networkType, [2, { distinctId: e, platformId: n, openId: r, channel: s, clientInfo: { netType: c }, accountId: a.accountId || "" }];}
      });
    });
  }, _pkg: function (e, t) {
    return { property: e, extra: t };
  }, _getBasicData: function (e) {
    var t = e || {},
        n = t.extend;if ("track" === t.eventType) {
      var r = ye(),
          i = (ot() || {}).scene,
          s = (r.platform || "").toLowerCase(),
          o = (this.networkType || "WIFI").toUpperCase();n = Object.assign({ "#scene": i || 0, "#os": { android: "Android", ios: "iOS" }[s] || "", "#os_version": r.system || "", "#screen_height": r.screenHeight || 0, "#network_type": o }, n || {});
    }return this._pkg(null, n);
  }, _getShareData: function (e) {
    var t = e || {},
        n = t.extend,
        r = t.wx_share_type;return this._pkg({ event_step: bs, wx_share_type: r }, n);
  }, _getShareEndData: function (e) {
    var t = e || {},
        n = t.shareData,
        r = t.shareSuccess,
        i = t.spentTime,
        s = t.extend,
        o = t.wx_share_type,
        a = n || {},
        c = a.title,
        u = a.imageUrl,
        h = a.shareType,
        d = a.shareConfigId,
        f = a.shareGuid,
        l = (a.sequenceInfo || {}).modelId;return this._pkg({ share_guid: f || "", share_content_id: d || "", share_content_title: c || "", share_content_img: u || "", share_content_type: h || "", share_use_time: i || 0, event_state: r ? 0 : 1, event_step: r ? Es : Cs, model_algorithm_id: l || "", wx_share_type: o }, s);
  }, _getVideoAdPlayData: function (e) {
    var t = e || {},
        n = t.adUnitId,
        r = t.playSuccess,
        i = t.extend;return this._pkg({ ad_id: n || "", event_step: r ? Es : bs }, i);
  }, _getVideoAdEndData: function (e) {
    var t = e || {},
        n = t.adUnitId,
        r = t.isEnded,
        i = t.playFailCode,
        s = t.spentTime,
        o = t.sequenceInfo,
        a = t.extend,
        c = t.adType,
        u = o || {},
        h = u.modelId,
        d = u.shareGuid,
        f = void 0 === r ? -1 : r ? 0 : 1,
        l = i ? 1004 === i || 1002 === i ? 2 : 1 : 0 === i ? 0 : 1;return this._pkg({ ad_id: n || "", event_state: l, ad_close_type: f, ad_show_time: s || 0, event_step: l ? Cs : f > 0 ? Os : ks, model_algorithm_id: h || "", share_guid: d || "", ad_type: c || 0 }, a);
  }, _getGameUserData: function (e) {
    var t = (ot() || {}).query,
        n = "toNumber",
        r = "toNStr",
        i = { roleId: r, roleName: r, serverId: r, level: n, vipLevel: n, energy: n, money1Consume: n, teamName: r, teamJob: r, roleCtime: n, id: r, wxUnionId: r, extend: "", accountId: r },
        s = { query_string: JSON.stringify(t) },
        o = (e || {}).extend;return Object.keys(i).map(function (t) {
      var n = e[t],
          r = i[t];if (r) {
        var o = "user_" + M.toLine(t);s[o] = M[r](n);
      }
    }), this._pkg(s, o);
  }, _getAuthData: function (e) {
    var t = Qt.getSDKUserInfo() || {},
        n = t.name,
        r = t.sex,
        i = ((ot() || {}).query || {}).share_guid,
        s = e || {},
        o = s.gender,
        a = void 0 === o ? r : o,
        c = s.nickName,
        u = void 0 === c ? n : c,
        h = s.extend;return this._pkg({ gender: a || 0, nick: u || "", share_guid: i || "" }, h);
  }, _getOpenData: function (e) {
    var t = Qt.getSDKUserInfo() || {},
        n = t.isNewUser,
        r = t.createdAt;n && (a("change local isNewUser to false"), Qt.updateIsNewUser());var i = ot() || {},
        s = i.query,
        o = i.scene,
        c = i.coldStart,
        u = i.referrerInfo,
        h = (s || {}).share_guid,
        d = e || {},
        f = d.isColdStart,
        l = void 0 === f ? !!c : f,
        p = d.isNewUser,
        g = void 0 === p ? n : p,
        v = d.extend,
        m = Object.assign(s, { referrerInfo: u }),
        _ = this._pkg({ is_new_user: g ? 0 : 1, open_type: l ? 0 : 1, source_type: o || 0, share_guid: h || "", query_string: JSON.stringify(m), reg_time: r }, v);return a("onShowReport", _), _;
  }, _getUserProfileData: function (e) {
    var t = e || {},
        n = t.label,
        r = t.extend;return this._pkg({ wx_tags_general: n || 0 }, r);
  }, _getHeartbeatData: function (e) {
    var t = (e || {}).interval;return this._pkg({ interval: t || 60 });
  }, _getLoginData: function (e) {
    var t = (Qt.getSDKUserInfo() || {}).isNewUser,
        n = ot() || {},
        r = n.query,
        i = n.scene,
        s = (r || {}).shareConfigId,
        o = e || {},
        a = o.isNewUser,
        c = void 0 === a ? t : a,
        u = o.extend,
        h = this._getBasicData({ eventType: "track" });return u = Object.assign(h.extra || {}, u || {}), this._pkg({ is_new: c, f_share_id: s, wx_scene: i }, u);
  }, _refreshOpenData: function (e) {
    var t = Qt.getSDKUserInfo() || {},
        n = t.isNewUser,
        r = t.createdAt;return e && e.property && (e.property.is_new_user = n ? 0 : 1, e.property.reg_time = r), e;
  } },
    Us = { temps: void 0, report: function (e) {
    var t = this,
        n = this._getTempLogs(e && e.logs);if (this._clearTempLogs(), n && n.length) {
      var r = k() + "/htlog/api/v1/log",
          i = Object.assign({}, e, { logs: n });R.post(r, i).then(function () {
        a("std log", i);
      }).catch(function (e) {
        e && e.errCode === v.errCode && t._setTempLogs(n);
      });
    }
  }, _getTempLogs: function (e) {
    return void 0 === this.temps && (this.temps = q.get("__sdk_fail_logs")), this._limitLogs((this.temps || []).concat(e || []));
  }, _setTempLogs: function (e) {
    this.temps = this._limitLogs(e), q.set("__sdk_fail_logs", this.temps);
  }, _clearTempLogs: function () {
    this.temps = [], q.set("__sdk_fail_logs", "");
  }, _limitLogs: function (e) {
    var t = (e ? e.length : 0) - 50;return (e || []).slice(t > 0 ? t : 0);
  } },
    Ls = { lastLog: {}, logs: [], reporting: !1, delayCollect: 800, delayReport: 5e3, collect: function (e) {
    if (e) {
      var t = e.topic;if (t) {
        var n = this.lastLog[t],
            r = n && !n.fromPlatform ? n : e;0 === ((n || {}).params || {}).open_type && (r.params.open_type = 0), this.lastLog[t] = r, n || setTimeout(this._reduceLog.bind(this, t), this.delayCollect);
      } else this._reportLog(e);
    }
  }, _reportLog: function (e) {
    var t = e || {},
        n = t.immediateReport,
        r = t.params;r && (this.logs.push(r), this._report(n).catch(function () {}));
  }, _reduceLog: function (e) {
    var t = this.lastLog[e];t && (this._reportLog(t), this.lastLog[e] = null);
  }, _report: function (e) {
    return r(this, void 0, void 0, function () {
      var t, r;return i(this, function (i) {
        switch (i.label) {case 0:
            return e ? [3, 2] : this.reporting ? [2] : (this.reporting = !0, [4, M.wait(this.delayReport)]);case 1:
            i.sent(), this.reporting = !1, i.label = 2;case 2:
            return [4, Ps.getCommonData()];case 3:
            return t = i.sent(), r = this.logs, Us.report(n(n({}, t), { logs: r })), this.logs = [], [2];}
      });
    });
  } };function Vs(e, t, n) {
  return this.guid = M.generateGuid(), this.opt = e, this.topic = e.topic, this.fromPlatform = !!n, this._init(t), this;
}Vs.prototype = { _init: function (e) {
    var t = { immediateReport: !1, stopWhenShare: !1, callAfterLogin: !1 };switch (this.topic) {case Ds.CLOSE.topic:
        t.stopWhenShare = !0, t.immediateReport = !0;break;case Ds.OPEN.topic:
        t.stopWhenShare = !0, t.callAfterLogin = this.fromPlatform;}this.config = t, this.data = {}, this.createAt = M.getTime(), this._setData(e);
  }, getConfig: function () {
    return this.config;
  }, start: function () {
    this.startTime = M.getTime();
  }, stop: function (e) {
    e && (e.spentTime = this.startTime ? Math.max(0, M.getTime() - this.startTime) : 0), this._setData(e);
  }, refreshData: function () {
    return this.data = Ps.refreshDataByTopic(this.topic, this.data), this;
  }, _setData: function (e) {
    var t = Ps.getLogDataByTopic(this.topic, e),
        n = t.property,
        r = t.extra,
        i = this.data,
        s = i.property,
        o = i.extra;return n && (this.data.property = Object.assign(s || {}, n)), r && (this.data.extra = Object.assign(o || {}, r)), this;
  }, _getData: function () {
    var e = this.opt,
        t = e.eventName,
        n = e.eventType,
        r = e.logType;return Object.assign({}, this.data, { logId: this.guid, logType: r, eventType: n, eventName: t, timestamp: this.createAt || 0 });
  }, toLogData: function () {
    var e = this._getData(),
        t = this.getConfig().immediateReport;return { topic: this.topic, fromPlatform: this.fromPlatform, immediateReport: t, params: e };
  } };var Ns = [],
    Ms = Ss,
    qs = Rs;function Hs() {
  T.on("EVT_SET_GAMEUSER", function (e) {
    Gs(Rs.SET_USER_INFO, e.data);
  });var e = at(),
      t = e.autoUploadSDTLog,
      n = e.stdAutoUpload,
      r = e.tgaAutoUpload,
      i = e.stdHeartBeatInterval;if (!1 !== r || n || t) {
    if (Fs(Ds.INIT, { eventType: "track", eventName: "sdk_init" }, !0), T.on("EVT_ON_SHOW", function () {
      Fs(Ds.OPEN, null, !0);
    }), T.on("EVT_ON_HIDE", function () {
      Fs(Ds.CLOSE, null, !0);
    }), T.on("EVT_SHARE_START", function (e) {
      Fs(Ds.SHARE, e.data, !0);
    }), T.on("EVT_SHARE_END", function (e) {
      Fs(Ds.SHARE_END, e.data, !0);
    }), T.on("EVT_SHARE_TIME_START", function (e) {
      Fs(Ds.SHARE, e.data, !0);
    }), T.on("EVT_SHARE_TIME_END", function (e) {
      Fs(Ds.SHARE_END, e.data, !0);
    }), T.on("EVT_VIDEO_AD_PLAY_START", function (e) {
      Fs(Ds.VIDEO_AD_SHOW, e.data, !0);
    }), T.on("EVT_VIDEO_AD_PLAY_FINISH", function (e) {
      Fs(Ds.VIDEO_AD_END, e.data, !0);
    }), T.on("EVT_INTERSTITIAL_AD_SHOW", function (e) {
      Fs(Ds.VIDEO_AD_END, e.data, !0);
    }), T.on("EVT_ON_AUTH", function (e) {
      Fs(Ds.AUTH, e.data, !0);
    }), T.once("EVT_ON_LOGIN", function (e) {
      Fs(Ds.LOGIN, e.data, !0), new Promise(function (e, t) {
        we("getUserGameLabel", "2.9.3") ? wx.getUserGameLabel({ success: e, fail: t }) : t(Fe);
      }).then(function (e) {
        Fs(Ds.PROFILE, e, !0);
      }).catch(function (e) {});
    }), i) {
      var s = i - 0 || 60,
          o = { interval: s };isNaN(s) || M.resetInterval(function () {
        Fs(Ds.BEAT, o, !0);
      }, 1e3 * s);
    }T.on("EVT_SHARE_FRIEND", function (e) {
      Fs(Ds.SHARE_FRIEND, { extend: e.data }, !0);
    });
  }
}function Fs(e, t, n) {
  var r = Ss.TGA,
      i = Ss.STD,
      s = at(),
      o = s.autoUploadSDTLog,
      a = s.stdAutoUpload,
      c = s.tgaAutoUpload,
      u = e.logType;a || o || (u = (u | i) === u ? u ^ i : u), !1 === c && (u = (u | r) === u ? u ^ r : u), u && (e.logType = u, js(e, t, n));
}function Gs(e, t) {
  var n = Ds[e];n && js(Object.assign({}, n, t || {}), t);
}function js(e, t, n) {
  var r = new Vs(e, t, n),
      i = r.getConfig(),
      s = i.stopWhenShare,
      o = i.callAfterLogin;Li("sharing") && s || (o ? function (e) {
    if (!M.isFun(e)) return;var t = Qt.getSDKUserInfo() || {},
        n = t.uniqueId;if (t.userId && n) return void e();Ns.push(e), T.once("EVT_ON_LOGIN", function (e) {
      Ns.forEach(function (t) {
        return t(e);
      }), Ns = [];
    });
  }(function () {
    Ls.collect(r.refreshData().toLogData());
  }) : Ls.collect(r.toLogData()));
}!function () {
  T.once("EVT_SDK_READY", Hs.bind(this));
}();var Ks = qs;function Bs(e) {
  return Gs(e.topic, e.data);
}function Ws(e) {
  return Bs({ topic: qs.SET_USER_INFO, data: e });
}function zs() {
  return Ms;
}function Qs(e) {
  return js(e, e, !1);
}var Js = we("requestSubscribeMessage", "2.8.3"),
    Ys = we("requestSubscribeWhatsNew", "2.10.4");function Xs(e) {
  return new Promise(function (t, n) {
    Js ? wx.requestSubscribeMessage(Object.assign({}, e, { success: t, fail: n })) : n(Fe);
  });
}function $s(e) {
  return new Promise(function (t, n) {
    Ys ? wx.getWhatsNewSubscriptionsSetting(Object.assign({}, e, { success: t, fail: n })) : n(Fe);
  });
}function Zs(e) {
  return new Promise(function (t, n) {
    Ys ? wx.requestSubscribeWhatsNew(Object.assign({}, e, { success: t, fail: n })) : n(Fe);
  });
}var eo = { accept: "acceptIds", reject: "rejectIds", ban: "banIds" };function to(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s;return i(this, function (i) {
      switch (i.label) {case 0:
          n = (t = e || {}).playerId, t.tmplIds, i.label = 1;case 1:
          return i.trys.push([1, 3,, 4]), [4, Xs(e)];case 2:
          return r = i.sent(), no(s = function (e, t) {
            var n = { playerId: t };for (var r in eo) n[eo[r]] = [];for (var r in e) {
              var i = eo[e[r]];n[i] && n[i].push(r);
            }return n;
          }(r, n), 0), [2, s];case 3:
          return a("订阅消息 err", i.sent()), [3, 4];case 4:
          return [2];}
    });
  });
}function no(e, t) {
  if (void 0 === t && (t = 0), !(t > 3)) {
    var n = at(),
        r = n.gameId;if (n.reportSubscribeMessage) {
      var i = e || {},
          s = i.acceptIds,
          o = void 0 === s ? [] : s,
          c = i.playerId;if (o.length) {
        var u = Qt.getSDKUserInfo() || {},
            h = u.userId,
            d = u.uniqueId,
            f = { gameId: r, playerId: M.toNStr(c), openId: h, uniqueId: d, templateIds: o },
            l = k() + "/wxlog/api/v1/log/msg/subscribe";R.post(l, f).then(function () {
          a("subscribe count add", f);
        }).catch(function () {
          setTimeout(function () {
            no(e, ++t);
          }, 5e3);
        });
      }
    }
  }
}function ro(e) {
  return to(e);
}function io() {
  return function () {
    return r(this, void 0, void 0, function () {
      var e, t, n, r, s;return i(this, function (i) {
        switch (i.label) {case 0:
            return e = at().gameId, t = Qt.getSDKUserInfo() || {}, n = t.userId, r = t.uniqueId, s = k() + "/wxlog/api/v1/log/msg/subscribe/num", [4, R.get(s, { gameId: e, openId: n, uniqueId: r })];case 1:
            return [2, i.sent().data];}
      });
    });
  }();
}function so(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return [4, $s(e)];case 1:
            return [2, t.sent()];}
      });
    });
  }(e);
}function oo(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return [4, Zs(e)];case 1:
            return [2, t.sent()];}
      });
    });
  }(e);
}var ao = we("getSetting", "1.2.0"),
    co = we("authorize", "1.2.0"),
    uo = we("joinVoIPChat", "2.7.0"),
    ho = we("exitVoIPChat", "2.7.0"),
    fo = we("updateVoIPChatMuteConfig", "2.7.0"),
    lo = we("onVoIPChatMembersChanged", "2.7.0"),
    po = we("onVoIPChatSpeakersChanged", "2.7.0"),
    go = we("onVoIPChatInterrupted", "2.7.0"),
    vo = we("offVoIPChatSpeakersChanged", "2.9.0"),
    mo = we("offVoIPChatMembersChanged", "2.9.0"),
    _o = we("offVoIPChatInterrupted", "2.9.0"),
    wo = function () {
  return Promise.reject(Fe);
};function yo(e) {
  return ao ? new Promise(function (t, n) {
    wx.getSetting({ success: function (n) {
        t(!!n.authSetting[e]);
      }, fail: n });
  }) : wo();
}function Io(e) {
  return co ? new Promise(function (t, n) {
    wx.authorize({ scope: e, success: function () {
        t(!0);
      }, fail: function () {
        t(!1);
      } });
  }) : wo();
}function To(e) {
  return uo ? new Promise(function (t, n) {
    wx.joinVoIPChat(Object.assign(e, { success: t, fail: n }));
  }) : wo();
}function So() {
  return yo("scope.record");
}function bo() {
  return Io("scope.record");
}function Eo() {
  return yo("scope.camera");
}function Co() {
  return Io("scope.camera");
}function Oo(e) {
  return r(this, void 0, void 0, function () {
    var t, n, r, s, o, a, c, u, h, d, f, l, p;return i(this, function (i) {
      switch (i.label) {case 0:
          t = e.groupId, n = k() + "/mini/api/v1/sign/voip_chat", r = S.sdkConfig(), s = r.gameId, o = r.appId, a = D.platform.information, c = (a.getUserInfo() || {}).uniqueId, i.label = 1;case 1:
          return i.trys.push([1, 3,, 4]), [4, R.post(n, { appId: o, gameId: s, uniqueId: c, groupId: t })];case 2:
          return u = i.sent(), h = u.data, d = h.sign, f = h.nonceStr, l = h.timeStamp, [2, To(Object.assign(e, { signature: d, nonceStr: f, timeStamp: l }))];case 3:
          return p = i.sent(), [2, Promise.reject(p)];case 4:
          return [2];}
    });
  });
}function ko(e) {
  return function (e) {
    return ho ? new Promise(function (t, n) {
      wx.exitVoIPChat(Object.assign(e, { success: t, fail: n }));
    }) : wo();
  }(e);
}function Ao(e) {
  return function (e) {
    return fo ? new Promise(function (t, n) {
      wx.updateVoIPChatMuteConfig(Object.assign(e, { success: t, fail: n }));
    }) : wo();
  }(e);
}function xo(e) {
  return function (e) {
    return !!lo && (wx.onVoIPChatMembersChanged(e.listener), !0);
  }(e);
}function Do(e) {
  return function (e) {
    return !!mo && (wx.offVoIPChatMembersChanged(e.listener), !0);
  }(e = nn(e, "offVoIPChatMembersChanged"));
}function Ro(e) {
  return function (e) {
    return !!po && (wx.onVoIPChatSpeakersChanged(e.listener), !0);
  }(e);
}function Po(e) {
  return function (e) {
    return !!vo && (wx.offVoIPChatSpeakersChanged(e.listener), !0);
  }(e = nn(e, "offVoIPChatSpeakersChanged"));
}function Uo(e) {
  return function (e) {
    return !!go && (wx.onVoIPChatInterrupted(e.listener), !0);
  }(e);
}function Lo(e) {
  return function (e) {
    return !!_o && (wx.offVoIPChatInterrupted(e.listener), !0);
  }(e = nn(e, "offVoIPChatInterrupted"));
}var Vo = "/wall/api/v1/tasks",
    No = "/wall/api/v1/go_task",
    Mo = "/wall/api/v1/log",
    qo = "/wall/api/v1/award",
    Ho = "/wall/api/v1/task/status",
    Fo = { TasksErr: { errCode: 70001, errMsg: "获取任务失败" }, NoTask: { errCode: 70002, errMsg: "任务不存在" }, GoErr: { errCode: 70003, errMsg: "跳转任务失败" }, AwardGetted: { errCode: 70004, errMsg: "已经领取奖励" }, GetAwardErr: { errCode: 70005, errMsg: "领奖失败" } },
    Go = 2,
    jo = 3,
    Ko = 4,
    Bo = 5,
    Wo = 6,
    zo = 8,
    Qo = "panel",
    Jo = "banner",
    Yo = { InBox: 1, InGame: 2, Login: 3, Play: 4, PlayNoSDK: 5 },
    Xo = "",
    $o = function () {
  if (!Xo) {
    var e = ye();Xo = JSON.stringify({ SDKVersion: e.SDKVersion, brand: e.brand, model: e.model, system: e.system, version: e.version, wallSDKV: e.hortorSDKVersion });
  }return Xo;
},
    Zo = function (e) {
  var t = at() || {},
      n = t.gameId,
      r = t.key,
      i = t.gameVersion,
      s = Qt.getSDKUserInfo() || {},
      o = s.userId,
      a = s.uniqueId,
      c = s.sex,
      u = s.channel,
      h = s.origChannel,
      d = Qt.getGameUser().serverId,
      f = void 0 === d ? "" : d;return Object.assign({ gameId: n, key: r, gameVersion: i, openId: o, gameServerId: f, sex: c, uniqueId: a, channel: u, origChannel: h, sysInfo: $o() }, e || {});
},
    ea = "",
    ta = Zo,
    na = function () {
  return ea;
},
    ra = function (e, t) {
  !function (e) {
    var t = (ot().custom || {}).boxCode,
        n = void 0 === t ? "" : t,
        r = Zo(Object.assign({ traceId: "", wallCode: n }, e || {})),
        i = "" + k() + Mo;R.postForm(i, r).then(function (e) {
      var t = ((e || {}).data || {}).traceIdStr;ea = t || "";
    }).catch(function (e) {
      a("wall report fail", e);
    });
  }(n({ logType: e }, t));
};var ia = { createQRCode: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, c;return i(this, function (i) {
        switch (i.label) {case 0:
            return i.trys.push([0, 4, 5, 6]), a("creating code ", e), n = (t = e || {}).codeUrl, r = t.backUrl, wx.showLoading(Object.assign({ title: "请稍等..." }, u || {})), [4, this._createImages({ codeUrl: n, backUrl: r })];case 1:
            return s = i.sent(), [4, this._drawQRCodeMiniGame(s)];case 2:
            return o = i.sent().tempFilePath, [4, pn.previewImage(o)];case 3:
            return [2, i.sent()];case 4:
            throw a("create code fail ", c = i.sent()), c;case 5:
            return wx.hideLoading(), [7];case 6:
            return [2];}var u;
      });
    });
  }, _createImages: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, a, c;return i(this, function (i) {
        switch (i.label) {case 0:
            for (r in t = {}, n = [], e) n.push(r);s = 0, i.label = 1;case 1:
            return s < n.length ? (o = n[s], a = t, c = o, [4, (u = e[o], new Promise(function (e, t) {
              var n = wx.createImage();n.src = u, n.onload = function (t) {
                e(n);
              }, n.onerror = t;
            }))]) : [3, 4];case 2:
            a[c] = i.sent(), i.label = 3;case 3:
            return s++, [3, 1];case 4:
            return [4, M.wait(100)];case 5:
            return i.sent(), [2, t];}var u;
      });
    });
  }, _drawQRCodeMiniGame: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = e.backUrl, n = e.codeUrl, (r = { w: 750, h: 1334, cw: 260, cp: .05, cx: .5, cy: .828 }).cx = parseInt(String(r.cx * r.w), 10), r.cy = parseInt(String(r.cy * r.h), 10), r.cp = parseInt(String(r.cp * r.cw), 10), r.cr = parseInt(String(r.cw / 2), 10), r.cqw = parseInt(String(r.cw - 2 * r.cp), 10), r.cqx = parseInt(String(r.cx - r.cqw / 2), 10), r.cqy = parseInt(String(r.cy - r.cqw / 2), 10), (s = wx.createCanvas()).width = r.w, s.height = r.h, (o = s.getContext("2d")).drawImage(t, 0, 0, r.w, r.h), o.beginPath(), o.arc(r.cx, r.cy, r.cr, 0, 2 * Math.PI), o.fillStyle = "rgba(255,255,255,1)", o.fill(), o.clip(), o.drawImage(n, r.cqx, r.cqy, r.cqw, r.cqw), [4, M.wait(100)];case 1:
            return i.sent(), [4, this._toTempFilePath(s, r)];case 2:
            return [2, i.sent()];}
      });
    });
  }, _toTempFilePath: function (e, t) {
    return new Promise(function (n, r) {
      var i = t.x,
          s = void 0 === i ? 0 : i,
          o = t.y,
          a = void 0 === o ? 0 : o,
          c = t.w,
          u = t.h;e.toTempFilePath({ x: s, y: a, width: c, height: u, destWidth: c, destHeight: u, success: n, fail: r });
    });
  } },
    sa = !1,
    oa = { logined: !1, tasksMap: {}, lastTask: null, onlineTimer: null, onlineTime: 0, onlineTotal: 0, allTasks: [], dataSource: "", init: function () {
    T.once("EVT_ON_SHOW", this._onLaunch.bind(this)), T.once("EVT_SET_GAMEUSER", this._onLogined.bind(this));
  }, _onLaunch: function () {
    a("wall launched");var e = Qt.getSDKUserInfo() || {},
        t = e.userId,
        n = e.uniqueId;if (t && n) return ra(Go);T.once("EVT_ON_LOGIN", function () {
      ra(Go);
    });
  }, _onLogined: function () {
    this.logined || (this.logined = !0, a("wall logined"), this.postLog(jo), this._startOnline(), this._bindEvent());
  }, _startOnline: function () {
    var e = this;if ((ot().custom || {}).boxCode) {
      (at() || {}).taskCheckDelay;var t = function () {
        e.onlineTime += 10, e.onlineTotal += 10;var t = na();!t || e.onlineTime < 60 || (e.postLog(Wo, { wallCode: "", online: e.onlineTime, onlineTotal: e.onlineTotal, traceIdStr: t }), e.onlineTime = 0);
      },
          n = function () {
        a("wall start beat"), M.reclearInterval(e.onlineTimer), e.onlineTimer = M.resetInterval(t, 1e4);
      };T.on("EVT_ON_SHOW", n), T.on("EVT_ON_HIDE", function () {
        a("wall clear beat"), M.reclearInterval(e.onlineTimer);
      }), n();
    }
  }, _bindEvent: function () {
    var e = this,
        t = null,
        n = (at() || {}).taskCheckDelay || 1500;T.on("EVT_ON_SHOW", function (r) {
      var i = (r || {}).data;e._fixOnlineLog(i), t = setTimeout(e.checkLastTask.bind(e), n);
    }), T.on("EVT_ON_HIDE", function () {
      t && (clearTimeout(t), t = null);
    });
  }, _getTasks: function (e) {
    return r(this, void 0, void 0, function () {
      var t,
          n,
          r,
          s,
          o,
          c,
          u = this;return i(this, function (i) {
        switch (i.label) {case 0:
            return t = "" + k() + Vo, n = ta(), e && e.playerOptions && (n = Object.assign(n, e.playerOptions)), [4, R.postForm(t, n)];case 1:
            if (r = i.sent().data, o = (s = r || {}).tasks, (c = s.dataSource) && (this.dataSource = c), a("wall get tasks", r), !o) throw Fo.TasksErr;return o.length && (sa = !!o[0].isABTest), o.map(function (e) {
              u.tasksMap[e.taskId] = e;
            }), this.allTasks = o, [2, r];}
      });
    });
  }, getTasks: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return n.trys.push([0, 2,, 3]), [4, this._getTasks(e)];case 1:
            return [2, n.sent()];case 2:
            throw a("wall get tasks err", t = n.sent()), t;case 3:
            return [2];}
      });
    });
  }, _goTask: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o, c, u, h, d, f, l, p, g, v, m, _, w, y, I;return i(this, function (i) {
        switch (i.label) {case 0:
            if (n = (t = e || {}).taskId, r = t.wallPosition, !(s = this.tasksMap[n])) throw Fo.NoTask;return (o = ta({ taskId: n, wallPosition: r, isABTest: sa }) || {}).dataSource = this.dataSource, c = "" + k() + No, [4, R.postForm(c, o)];case 1:
            if (u = i.sent().data, h = (u || {}).traceId, a("wall go task", u), !h) throw u || Fo.GoErr;f = (d = u || {}).useNav, l = d.appId, p = d.appPath, g = d.appEnvVersion, v = d.appExtraData, m = d.mixedQrcodeImg, _ = { appId: l, path: p, envVersion: g || "release", extraData: v ? JSON.parse(v) : {} }, w = (at() || {}).gameId, y = (Qt.getSDKUserInfo() || {}).uniqueId, _.extraData = Object.assign(_.extraData, { origGameId: w || "", origUniqueId: y || "" }), i.label = 2;case 2:
            return i.trys.push([2, 7,, 9]), f && pn._canUseNavigate ? (a("wall jump params", _, m), [4, pn.navigateToMiniProgram(_, m)]) : [3, 4];case 3:
            return i.sent(), [3, 6];case 4:
            return [4, pn.previewImage(m)];case 5:
            i.sent(), i.label = 6;case 6:
            return [3, 9];case 7:
            if ((I = i.sent()).isCancel) throw I;return a("wall try go err", I), [4, ia.createQRCode({ codeUrl: u.qrcodeImg, backUrl: u.qrcodeBg, posX: u.qrcodePosX, posY: u.qrcodePosY })];case 8:
            return i.sent(), [3, 9];case 9:
            return this.postLog(Bo, { taskId: n, traceId: h, wallPosition: r, isABTest: sa }), this._setLastTask(s, h), [2, u];}
      });
    });
  }, goTask: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return n.trys.push([0, 2,, 3]), a("wall start go", e), [4, this._goTask(e)];case 1:
            return [2, n.sent()];case 2:
            throw a("wall go task err", t = n.sent()), t;case 3:
            return [2];}
      });
    });
  }, _getAward: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o;return i(this, function (i) {
        switch (i.label) {case 0:
            if (!(t = this.tasksMap[e])) throw Fo.NoTask;if (0 != t.awareAccpetStatus) throw Fo.AwardGetted;return n = ta({ taskId: e }), r = "" + k() + qo, [4, R.postForm(r, n)];case 1:
            if (s = i.sent().data, o = (s || {}).traceId, a("wall get award", s), !o) throw s || Fo.GetAwardErr;return [2, s];}
      });
    });
  }, getAward: function (e) {
    return r(this, void 0, void 0, function () {
      var t;return i(this, function (n) {
        switch (n.label) {case 0:
            return n.trys.push([0, 2,, 3]), [4, this._getAward(e)];case 1:
            return [2, n.sent()];case 2:
            throw a("wall get award err", t = n.sent()), t;case 3:
            return [2];}
      });
    });
  }, _setLastTask: function (e, t) {
    this.lastTask = n({ traceId: "" + t }, e);
  }, _checkLastTask: function (e) {
    return r(this, void 0, void 0, function () {
      var t, n, r, s, o;return i(this, function (i) {
        switch (i.label) {case 0:
            return n = (t = e || {}).taskId, r = t.actionType, n && -1 !== [Yo.Play, Yo.PlayNoSDK].indexOf(r) ? (a("wall check task", n, r), s = "" + k() + Ho, [4, R.get(s, ta({ taskId: n }))]) : [2, null];case 1:
            return o = i.sent().data, (o || {}).isAlert ? [4, yr(Object.assign({ title: "提醒", content: "还有游戏没体验完", showCancel: !1, confirmText: "确定" }, o))] : [2, null];case 2:
            return [2, i.sent()];}
      });
    });
  }, checkLastTask: function () {
    var e = this;this._checkLastTask(this.lastTask).then(function () {
      e.lastTask = null;
    }).catch(function (e) {
      a("wall check task err", e);
    });
  }, _fixOnlineLog: function (e) {
    var t = this.lastTask || {},
        n = t.traceId,
        r = t.taskId,
        i = t.actionType;if (r && n && i === Yo.PlayNoSDK) {
      var s = (e || {}).hideDuration;a("wall fix log", r, s);var o = Math.floor(s / 1e3);this.postLog(zo, { traceId: n, traceIdStr: n, onlineTotal: o, online: 60, wallCode: "" });
    }
  }, postLog: function (e, t) {
    void 0 === t && (t = {}), t.dataSource = this.dataSource, ra(e, t);
  }, logOpenTaskPanel: function () {
    var e = this.allTasks.map(function (e) {
      return e.gameId;
    }).join(",");this.postLog(Ko, { wallPosition: Qo, isABTest: sa, adGames: e });
  } };oa.init();var aa = Object.freeze({ __proto__: null, getTasks: function (e) {
    return oa.getTasks(e);
  }, goTask: function (e) {
    return oa.goTask({ taskId: e, wallPosition: Qo });
  }, getAward: function (e) {
    return oa.getAward(e);
  }, logOpenTaskPanel: function () {
    oa.logOpenTaskPanel();
  }, goBannerTask: function (e) {
    return oa.goTask({ taskId: e, wallPosition: Jo });
  }, logShowBanner: function (e) {
    oa.postLog(Ko, { taskId: e, wallPosition: Jo });
  } });function ca() {
  return aa;
}var ua = we("setUserCloudStorage", "1.9.92"),
    ha = we("createGameClubButton", "2.0.3"),
    da = we("onUserCaptureScreen", "2.8.1");function fa(e) {
  return new Promise(function (t, n) {
    ua ? wx.setUserCloudStorage(Object.assign({}, e, { success: t, fail: n })) : n(Fe);
  });
}function la(e) {
  var t = function (e) {
    return ha ? wx.createGameClubButton(e) : null;
  }(e);return t && t.onTap(function () {
    !function () {
      var e = ot(),
          t = e.scene,
          n = { channel: (e.custom || {}).channel, scene: t, logType: 14 };T.dispatch("EVT_REPORT_LOG", n);
    }();
  }), t;
}var pa = { gameEvent: null, eventBind: !1, init: function () {
    var e = this;T.on("EVT_SDK_READY", function () {
      at().reportCaptureScreen && e.onUserCaptureScreen();
    });
  }, onUserCaptureScreen: function (e) {
    var t = this;M.isFun(e) && (this.gameEvent = e), this.eventBind || (this.eventBind = !0, function (e) {
      da && "function" == typeof e && wx.onUserCaptureScreen(function (t) {
        e(t);
      });
    }(function (e) {
      t.gameEvent && t.gameEvent(e), T.dispatch("EVT_REPORT_LOG", { log: { logType: 38 } }), a("capture screen");
    }));
  } };function ga(e) {
  return function (e) {
    return r(this, void 0, void 0, function () {
      return i(this, function (t) {
        switch (t.label) {case 0:
            return [4, fa(e)];case 1:
            return [2, t.sent()];}
      });
    });
  }(e);
}function va(e) {
  return la(e);
}function ma(e) {
  e = nn(e, "onUserCaptureScreen"), pa.onUserCaptureScreen(e.listener);
}pa.init();var _a,
    wa = we("createFeedbackButton", "2.1.2"),
    ya = we("getLogManager", "2.1.0");function Ia(e) {
  return function (e) {
    return ya ? wx.getLogManager(e) : null;
  }(e);
}function Ta(e) {
  return function (e) {
    return wa ? wx.createFeedbackButton(e) : null;
  }(e);
}function Sa(e, t, n) {
  _a || (_a = Ia()), _a && _a[e]("SDK " + t, n || "");
}function ba(e) {
  return Ia(e);
}function Ea(e) {
  return Ta(e);
}T.on("EVT_UPDATE_START", function () {
  Sa("log", "update start");
}), T.on("EVT_LOGIN_START", function () {
  Sa("log", "login start");
}), T.on("EVT_SESSION", function (e) {
  var t = ((e || {}).data || {}).err;if (t) return Sa("warn", "checkSession err:", t);Sa("log", "checkSession success");
}), T.on("EVT_WX_LOGIN", function (e) {
  var t = ((e || {}).data || {}).err;if (t) return Sa("warn", "wx login err:", t);Sa("log", "wx logined");
}), T.on("EVT_TRACK_LOGIN", function (e) {
  Sa("log", "tracklogin: ", e && e.data);
}), T.on("EVT_NEED_AUTH", function () {
  Sa("log", "wx need auth");
}), T.on("EVT_ON_AUTH", function () {
  Sa("log", "wx authed");
}), T.on("EVT_AUTH_DENY", function () {
  Sa("log", "wx auth deny");
}), T.on("EVT_ON_LOGIN", function () {
  Sa("log", "logined");
}), T.on("EVT_ON_UPDATE", function () {
  Sa("log", "updated");
}), T.on("EVT_ON_SHOW", function (e) {
  Sa("log", "onshow");
}), T.on("EVT_ON_ERROR", function (e) {
  Sa("warn", "onerr:", e && e.data);
}), T.on("EVY_PAY_FAIL", function (e) {
  Sa("warn", "pay fail:", e && e.data);
}), T.on("EVT_VIDEO_AD_ERROR", function (e) {
  Sa("warn", "video ad err:", e && e.data);
});var Ca = { getUserInfo: function () {
    return Qt.getSDKUserInfo();
  }, getSystemStr: function () {
    return Ie();
  }, getSystemInfo: function () {
    return ye();
  }, getNetStatus: function () {
    return Te();
  }, getLaunchOpts: function () {
    return ot();
  }, getConfig: function () {
    return at();
  } },
    Oa = { request: function (e, t, n, r, i) {
    return new Promise(function (s, o) {
      var a = { url: t, method: e, data: n, header: r, responseType: i, success: function (e) {
          s(e);
        }, fail: function (e) {
          o(e);
        } };wx.request(a);
    });
  } },
    ka = { _isShowed: !1, _isLaunched: !1, _sdkInited: !1, _hideAt: 0, init: function () {
    Xe(this._handleOnShow.bind(this)), $e(this._handleOnHide.bind(this)), T.once("EVT_SDK_READY", this._onSDKInit.bind(this), -1);
  }, _onSDKInit: function () {
    var e = this;this._sdkInited = !0, this._isShowed ? this._triggerOnShow() : setTimeout(function () {
      e._isShowed || e._triggerOnShow();
    }, 2e3);
  }, _triggerOnShow: function () {
    var e = Ye();this._handleOnShow(e);
  }, _handleOnShow: function (e) {
    var t = this._hideAt ? Date.now() - this._hideAt : 0;e.hideDuration = t, this._isShowed = !0, e.coldStart = !this._isLaunched, T.dispatch("EVT_ON_SHOW", e), (Qt.getTempUser() || {}).userId && this._logOnShow(e), this._sdkInited && (this._isLaunched = !0);
  }, _handleOnHide: function (e) {
    this._hideAt = Date.now(), T.dispatch("EVT_ON_HIDE", e);
  }, _logOnShow: function (e) {
    void 0 === e && (e = {}), e && delete e.hideDuration;var t = e.scene,
        n = e.coldStart,
        r = Qt.getTempUser() || {},
        i = r.userId,
        s = r.uniqueId,
        o = ot().custom || {},
        c = o.channel,
        h = o.origChannel,
        d = o.shareConfigId,
        f = n ? 0 : 1,
        l = "";try {
      e = Object.assign(e, { at: "onShow" }), l = JSON.stringify(e);
    } catch (e) {
      u("_logOnShow err", e);
    }var p = Ir.getStorage("__sdk_logOnShow_rawData__");p && p === l ? l = "" : Ir.setStorage("__sdk_logOnShow_rawData__", l), a("onshow report");var g = { logType: 3, channel: c, origChannel: h, shareConfigId: d, scene: t, userId: i, uniqueId: s, open_type: f, rawData: l };l && T.dispatch("EVT_REPORT_LOG", { log: g });
  } },
    Aa = { network: Oa, storage: Ir, information: Ca };D.platform = Aa, ka.init();var xa = function () {
  function e(e, t) {
    this.wx = e, this._temp = null, this._max = t.MaxTempFailLogLength || 0, this.enable = t.EnabledTempFailLog;
  }return e.prototype.setStorage = function (e) {
    try {
      this._temp = e, this.wx.setStorageSync("__APM_TEMP_LOGS", e);
    } catch (e) {
      console.log("[APM] set storage err: ", e);
    }
  }, e.prototype.getStorage = function () {
    var e = this._temp;if (e) return e;try {
      e = this.wx.getStorageSync("__APM_TEMP_LOGS"), this._temp = e;
    } catch (t) {
      e = "", console.log("[APM] get storage err: ", t);
    }return e;
  }, e.prototype.limitLens = function (e, t) {
    var n = e,
        r = e.length - t;return t > 0 && r > 0 && (n = e.slice(r)), n;
  }, e.prototype.setTemp = function (e) {
    if (this.enable) {
      var t = this._temp || [];t.push(e), this._temp = this.limitLens(t, this._max), console.log("[APM] storage fail log: ", this._temp), this.setStorage(this._temp);
    }
  }, e.prototype.mergeNum = function (e, t) {
    var n = e || t;if (n) {
      for (var r in t = t || {}, e = e || {}, n) t[r] = t[r] || 0, t[r] += e[r] || 0;return t;
    }
  }, e.prototype.mergeTemp = function (e, t) {
    var n = t || {},
        r = n.logs,
        i = n.sockets,
        s = n.times,
        o = e || {},
        a = o.logs,
        c = o.sockets,
        u = o.times,
        h = {};h.logs = this.limitLens((a || []).concat(r || []), this._max), h.sockets = this.mergeNum(i, c);var d = s || u;if (d) for (var f in h.times = {}, d) h.times[f] = this.mergeNum((s || {})[f], (u || {})[f]);return h;
  }, e.prototype.getTemp = function (e) {
    var t = this;if (!this.enable) return e;var n = this.getStorage(),
        r = Object.assign({}, e || {});return n && n.length && (n.forEach(function (e) {
      r = t.mergeTemp(e, r);
    }), console.log("[APM] merge storage log: ", r), this.clear()), r;
  }, e.prototype.checkTemp = function () {
    return this.enable && this.getStorage();
  }, e.prototype.clear = function () {
    this.setStorage("");
  }, e;
}(),
    Da = function () {
  function e(e, t) {
    this.clientInfo = null, this.wx = e, this.config = t, this.initNetworkType(), this.logTemper = new xa(this.wx, t);
  }return e.prototype.setUserInfo = function (e) {
    this.config.userInfo = Object.assign(this.config.userInfo || {}, e);
  }, e.prototype.initNetworkType = function () {
    var e = this;this.netTp = "unknown", this.wx.getNetworkType({ success: function (t) {
        e.netTp = t.networkType;
      } }), this.wx.onNetworkStatusChange && "function" == typeof this.wx.onNetworkStatusChange && (this.bindedNetChangge || (this.bindedNetChangge = !0, this.wx.onNetworkStatusChange(function (t) {
      e.netTp = t.networkType;
    })));
  }, e.prototype.getClientInfo = function () {
    if (this.clientInfo) return this.clientInfo.netType = this.netTp, this.clientInfo;var e = this.wx.getSystemInfoSync();return this.clientInfo = { version: e.version, system: e.system, platform: e.platform, sdk: e.SDKVersion, model: e.model, netType: this.netTp, brand: e.brand };
  }, e.prototype.report = function (e, t) {
    var n = this;void 0 === e && (e = {});var r = e.logs,
        i = e.times,
        s = e.sockets;if (this.logTemper.checkTemp() || e.logs && e.logs.length || e.times || e.sockets) {
      var o = [];0 === r.length ? (i && (o = [{ type: "req-times" }]), s && (o = [{ type: "socket-track" }])) : o = r.map(function (e) {
        return e.toJSON();
      });var a = this.logTemper.getTemp({ logs: o, times: i, sockets: s }),
          c = this.config,
          u = { game: { gameId: c.gameId, version: c.gameVersion, env: c.env }, client: this.getClientInfo(), user: c.userInfo, logs: a.logs, requestInfo: a.times, socketInfo: a.sockets };this.post(u, function (e, r) {
        r ? n.logTemper.setTemp(a) : t && t(e);
      });
    }
  }, e.prototype.getReportUrl = function () {
    return this.config.Debug ? this.config.reportUrlDev : this.config.reportUrlProc;
  }, e.prototype.post = function (e, t) {
    this.wx.request({ url: this.getReportUrl(), method: "POST", data: e, header: { "content-type": "application/json" }, success: function (e) {
        void 0 === e && (e = {}), t && t(e.data);
      }, fail: function (e) {
        t && t(null, e);
      } });
  }, e;
}(),
    Ra = ["wxmini", "wxmini-log", "platform", "wxmini-test", "platform-test", "wxmini-dev", "platform-dev"],
    Pa = "requestTimes",
    Ua = "downloadTimes",
    La = function () {
  function e(e) {
    this.collector = e, this.reset();
  }return e.prototype.getPlatformByUrl = function (e) {
    var t = e.split("//"),
        n = t.length ? t[1].split(".") : [],
        r = n.length ? n[0] : "";return Ra.indexOf(r) > -1 ? "platformSource" : "gameSource";
  }, e.prototype.add = function (e, t) {
    if (e) {
      this.hadData = !0;var n = this.getPlatformByUrl(e);this.requestInfo[n][t] += 1;
    }
  }, e.prototype.reset = function () {
    this.hadData = !1, this.requestInfo = { platformSource: { requestTimes: 0, downloadTimes: 0 }, gameSource: { requestTimes: 0, downloadTimes: 0 } };
  }, e.prototype.getInfo = function () {
    return this.hadData ? this.requestInfo : void 0;
  }, e;
}(),
    Va = "connectTimes",
    Na = "disconnectTimes",
    Ma = function () {
  function e(e) {
    this.collector = e, this.reset();
  }return e.prototype.add = function (e) {
    e && (this.hasSocketData = !0, this.socketInfo[e] += 1);
  }, e.prototype.reset = function () {
    this.hasSocketData = !1, this.socketInfo = { connectTimes: 0, disconnectTimes: 0 };
  }, e.prototype.getInfo = function () {
    return this.hasSocketData ? this.socketInfo : void 0;
  }, e;
}(),
    qa = { Debug: !1, ReportDelay: 6e4, ErrorReportDelay: 2e3, ClearRepeatLog: !0, EnabledDownLoadErr: !0, EnabledDownLoadPerf: !1, EnabledUpLoadErr: !0, EnabledUpLoadPerf: !1, EnabledConsoleErr: !1, EnabledAppOnErr: !0, EnabledAppLaunch: !1, EnabledPagePerf: !1, EnabledResErr: !0, EnabledResPerf: !1, EnabledSocket: !1, EnabledSocketTimes: !0, EnabledMemoryWarning: !0, EnabledTempFailLog: !1, MaxTempFailLogLength: 100, Filters: [], reportUrlProc: "https://platform.hortorgames.com/wxlog/api/v1/apmlog", reportUrlDev: "https://platform-test.hortorgames.com/wxlog/api/v1/apmlog" },
    Ha = { Filters: [/\/v1\/statlog$/, /\/v1\/log$/, /\/v1\/log\/multi$/] },
    Fa = function () {
  function e(e) {
    this.modalStack = [], this.showIng = !1, this.wx = e;
  }return e.prototype.isFun = function (e) {
    return !(!e || "function" != typeof e);
  }, e.prototype.show = function (e) {
    var t = this;if (this.showIng) return this.modalStack.push(this.show.bind(this, e));this.showIng = !0;var n = e.success;this.wx.showModal(Object.assign(e, { success: function (e) {
        if (t.showIng = !1, t.modalStack.length) {
          var r = t.modalStack.pop();t.isFun(r) && r();
        }t.isFun(n) && n(e);
      } }));
  }, e.prototype.alert = function (e, t, n) {
    this.show({ title: t, content: e, showCancel: !1, confirmText: "知道了", success: n });
  }, e;
}(),
    Ga = function () {
  function e(e, t) {
    this.logs = [], this.started = !1, this.wx = e, this.modal = new Fa(e), this.config = t, this.reporter = new Da(this.wx, t), this.timeser = new La(), this.socketTimeser = new Ma();
  }return e.prototype.clearReporter = function (e) {
    return e && clearTimeout(e), null;
  }, e.prototype.finalReport = function () {
    var e = this,
        t = this.logs,
        n = this.timeser.getInfo(),
        r = this.socketTimeser.getInfo();this.reporter.report({ logs: t, times: n, sockets: r }, function (t) {
      void 0 === t && (t = {});var n = t.data || [];if (n.length) {
        var r = n.join(", ");r && e.modal.alert("" + r, "错误ID");
      }
    }), this.logs = [], this.timeser.reset(), this.socketTimeser.reset(), this.errorReporter = this.clearReporter(this.errorReporter), this.fixedReporter = this.clearReporter(this.fixedReporter), this.fixedReport();
  }, e.prototype.fixedReport = function () {
    this.fixedReporter = setTimeout(this.finalReport.bind(this), this.config.ReportDelay);
  }, e.prototype.startFixedReport = function () {
    this.started || (this.started = !0, this.fixedReport());
  }, e.prototype.tryReport = function (e) {
    this.checkValid(e) && (this.add(e), this.errorReporter || (this.errorReporter = setTimeout(this.finalReport.bind(this), this.config.ErrorReportDelay)));
  }, e.prototype.collect = function (e) {
    this.checkValid(e) && this.add(e);
  }, e.prototype.checkValid = function (e) {
    return !(!e || e.resURI && e.resURI.startsWith(this.reporter.getReportUrl())) && (!e.resURI || (this.filters || (this.filters = Ha.Filters || [], this.filters = this.filters.concat(this.config.Filters)), !this.filters.length || !this.filters.some(function (t) {
      return t && t.test && t.test(e.resURI);
    })));
  }, e.prototype.isRepeat = function (e, t) {
    if (void 0 === e && (e = {}), void 0 === t && (t = {}), e.id && e.id === t.id) return !0;if (!this.config.ClearRepeatLog) return !1;return ["resURI", "logType", "extra"].every(function (n) {
      return JSON.stringify(e[n]) == JSON.stringify(t[n]);
    });
  }, e.prototype.add = function (e) {
    var t = this;this.logs.some(function (n, r) {
      if (t.isRepeat(e, n)) return (!e.timestamp || e.timestamp > n.timestamp) && (t.logs[r] = e), !0;
    }) || (this.logs.push(e), this.startFixedReport());
  }, e.prototype.addTimes = function (e, t) {
    this.checkValid({ resURI: e }) && (this.timeser.add(e, t), this.startFixedReport());
  }, e.prototype.addSocketTimes = function (e) {
    this.socketTimeser.add(e), this.startFixedReport();
  }, e;
}(),
    ja = 1,
    Ka = "unc-err",
    Ba = "res-req",
    Wa = "res-err",
    za = "down-err",
    Qa = "down-req",
    Ja = "up-req",
    Ya = "up-err",
    Xa = "soc-req",
    $a = "soc-err",
    Za = "game-notice",
    ec = "game-track",
    tc = "mem-warn",
    nc = function () {
  function e(e, t) {
    void 0 === t && (t = {}), this.id = ja++, this.logType = e, this.extra = {}, this.collected = !1, this.collector = t;
  }return e.prototype.setType = function (e) {
    return this.logType = e, this;
  }, e.prototype.addExtra = function (e) {
    return e.url && (this.resURI = e.url), e.errMsg && !e.msg && (e.msg = e.errMsg), this.extra = Object.assign(this.extra, e), this;
  }, e.prototype.start = function () {
    return this.startTime = new Date().getTime(), this;
  }, e.prototype.end = function () {
    return this.timestamp = new Date().getTime() - this.startTime, this.timestamp = this.timestamp < 0 ? 0 : this.timestamp, this.collect(), this;
  }, e.prototype.collect = function () {
    return this.collected || "function" != typeof this.collector.collect || (this.collected = !0, this.collector.collect(this)), this;
  }, e.prototype.tryReport = function () {
    return this.collected || "function" != typeof this.collector.tryReport || (this.collected = !0, this.collector.tryReport(this)), this;
  }, e.prototype.toJSON = function () {
    return { res: this.resURI, type: this.logType, ts: this.timestamp, ext: this.extra };
  }, e;
}(),
    rc = function () {
  function e(e) {
    var t = e.wx,
        n = e.config,
        r = e.collector;this.wx = t, this.config = n, this.collector = r;
  }return e.prototype.handle = function () {}, e.prototype.isFun = function (e) {
    return !(!e || "function" != typeof e);
  }, e.prototype.tracker = function (e, t) {
    return void 0 === t && (t = {}), new nc(e, this.collector).addExtra(t);
  }, e;
}();function ic(e, t, n) {
  var r = e[t];Object.defineProperty(e, t, { value: n(r) });
}var sc = function (e) {
  function n(t) {
    return e.call(this, t) || this;
  }return t(n, e), n.prototype.handle = function () {
    (this.config.EnabledDownLoadErr || this.config.EnabledDownLoadPerf) && ic(this.wx, "downloadFile", this.downloadFileHandler.bind(this));
  }, n.prototype.downloadFileHandler = function (e) {
    var t = this;return function (n) {
      var r = t.tracker("", { url: n.url, filePath: n.filePath }).start();t.collector.addTimes(n.url, Ua);var i = function (e) {
        console.log("[APM] download err", e), t.config.EnabledDownLoadErr && r.setType(za).addExtra(e).end();
      };return e(Object.assign({}, n, { success: function (e) {
          void 0 === e && (e = {});var s,
              o = e.statusCode,
              a = e.header ? e.header["Content-Length"] : 0;200 == o ? (s = { status: o, size: a }, t.config.EnabledDownLoadPerf && r.setType(Qa).addExtra(s).end()) : i({ status: o, err: e.data, size: a }), n.success && n.success.call(this, e);
        }, fail: function (e) {
          i({ err: e }), n.fail && n.fail.call(this, e);
        } }));
    };
  }, n;
}(rc),
    oc = function (e) {
  function n(t) {
    return e.call(this, t) || this;
  }return t(n, e), n.prototype.handle = function () {
    (this.config.EnabledResErr || this.config.EnabledResPerf) && ic(this.wx, "request", this.requestHandler.bind(this));
  }, n.prototype.requestHandler = function (e) {
    var t = this;return function (n) {
      var r = t.tracker("", { url: n.url, method: n.method }).start();t.collector.addTimes(n.url, Pa);var i = function (e) {
        console.log("[APM] request err", e), t.config.EnabledResErr && r.setType(Wa).addExtra(e).end();
      };return e(Object.assign({}, n, { success: function (e) {
          void 0 === e && (e = {});var s,
              o = e.header ? e.header["Content-Length"] : 0,
              a = e.statusCode;200 == a ? (s = { status: a, size: o }, t.config.EnabledResPerf && r.setType(Ba).addExtra(s).end()) : i({ status: a, err: e.data, size: o }), n.success && n.success.call(this, e);
        }, fail: function (e) {
          i({ err: e }), n.fail && n.fail.call(this, e);
        } }));
    };
  }, n;
}(rc),
    ac = function (e) {
  function n(t) {
    return e.call(this, t) || this;
  }return t(n, e), n.prototype.handle = function () {
    (this.config.EnabledUpLoadErr || this.config.EnabledUpLoadPerf) && ic(this.wx, "uploadFile", this.uploadFileHandler.bind(this));
  }, n.prototype.uploadFileHandler = function (e) {
    var t = this;return function (n) {
      var r = t.tracker("", { url: n.url, filePath: n.method }).start(),
          i = function (e) {
        console.log("[APM] upload err", e), t.config.EnabledUpLoadErr && r.setType(Ya).addExtra(e).end();
      };return e(Object.assign({}, n, { success: function (e) {
          void 0 === e && (e = {});var s,
              o = e.statusCode,
              a = e.header ? e.header["Content-Length"] : 0;200 == o ? (s = { status: o, size: a }, t.config.EnabledUpLoadPerf && r.setType(Ja).addExtra(s).end()) : i({ status: o, err: e.data, size: a }), n.success && n.success.call(this, e);
        }, fail: function (e) {
          i({ err: e }), n.fail && n.fail.call(this, e);
        } }));
    };
  }, n;
}(rc),
    cc = function (e) {
  function n(t) {
    return e.call(this, t) || this;
  }return t(n, e), n.prototype.handle = function () {
    (this.config.EnabledSocket || this.config.EnabledSocketTimes) && ic(this.wx, "connectSocket", this.connectSocketHandler.bind(this));
  }, n.prototype.connectSocketHandler = function (e) {
    var t = this;return function (n) {
      var r = void 0;if (t.config.EnabledSocket) {
        var i = { url: n.url, method: n.method, protocols: n.protocols },
            s = t.tracker("", i).start();(r = e(Object.assign({}, n, { success: function (e) {
            var t;t = { status: 200 }, s.setType(Xa).addExtra(t).end(), n.success && n.success.call(this, e);
          }, fail: function (e) {
            !function (e) {
              s.setType($a).addExtra(e).end();
            }({ err: e }), n.fail && n.fail.call(this, e);
          } }))) && r.onError(function (e) {
          !function (e) {
            t.tracker($a, i).addExtra(e).collect();
          }({ err: e });
        });
      } else r = e(n);return r && t.config.EnabledSocketTimes && (t.collector.addSocketTimes(Va), r.onClose(function (e) {
        1e3 !== e.code && t.collector.addSocketTimes(Na);
      })), r;
    };
  }, n;
}(rc),
    uc = function (e) {
  function n(t) {
    return e.call(this, t) || this;
  }return t(n, e), n.prototype.handle = function () {
    "undefined" != typeof console && this.config.EnabledConsoleErr && ic(console, "error", this.consoleErrorHandler.bind(this)), this.wx.onError && this.config.EnabledAppOnErr && (ic(this.wx, "onError", this.onErrorhandler.bind(this)), this.bindOnError(), this.wx.offError && ic(this.wx, "offError", this.offErrorhandler.bind(this)));
  }, n.prototype.renderErrMsg = function (e) {
    if (void 0 === e && (e = ""), e && "string" != typeof e) return { msg: JSON.stringify(e) };var t = e.split("\n"),
        n = t.slice(0, 2).join("\n"),
        r = t.slice(2),
        i = (r[1] || "").split(":"),
        s = (i.pop() || "").replace(")", "") - 0,
        o = (i.pop() || "") - 0;return { line: o = isNaN(o) ? 0 : o, column: s, msg: n, stack: r };
  }, n.prototype.bindOnError = function () {
    var e = this;this.bindedOnError || (this.bindedOnError = !0, this.wx.onError(function (t) {
      console.log("[APM] onError error", t);var n = e.renderErrMsg(t.message);n.stack = t.stack || n.stack, e.tracker(Ka).addExtra(n).tryReport();
    }));
  }, n.prototype.onErrorhandler = function (e) {
    var t = this;return function (n) {
      return t.bindOnError(), e(n);
    };
  }, n.prototype.offErrorhandler = function (e) {
    var t = this;return function (n) {
      var r = e(n);return n || (t.bindedOnError = !1, t.bindOnError()), r;
    };
  }, n.prototype.consoleErrorHandler = function (e) {
    var t = this,
        n = function (e) {
      void 0 === e && (e = {});var n = t.renderErrMsg(e[0]);t.tracker(Ka).addExtra(n).tryReport();
    };return function () {
      for (var t = [], r = 0; r < arguments.length; r++) t[r] = arguments[r];return n(t), e.apply(void 0, t);
    };
  }, n;
}(rc),
    hc = function (e) {
  function n(t) {
    var n = e.call(this, t) || this;return n.bindTimes = 0, n.reported = !1, n;
  }return t(n, e), n.prototype.handle = function () {
    this.isFun(this.wx.onMemoryWarning) && this.config.EnabledMemoryWarning && (ic(this.wx, "onMemoryWarning", this.memoryWranHandler.bind(this)), this.firstBind());
  }, n.prototype.firstBind = function () {
    this.wx.onMemoryWarning(function (e) {});
  }, n.prototype.report = function (e, t) {
    this.reported || t != this.bindTimes || (console.log("[APM] onMemoryWarning", e), this.tracker(tc).addExtra(e || {}).collect(), this.reported = !0);
  }, n.prototype.memoryWranHandler = function (e) {
    var t = this;return function (n) {
      var r = ++t.bindTimes;return e(function (e) {
        t.report(e, r), t.isFun(n) && n(e);
      });
    };
  }, n;
}(rc),
    dc = function () {
  function e(e, t) {
    this.wx = e, this.config = t, this.collector = new Ga(e, t);var n = { wx: e, config: t, collector: this.collector };this.handlers = [new cc(n), new uc(n), new oc(n), new sc(n), new ac(n), new hc(n)];
  }return e.prototype.track = function () {
    return this.handlers.forEach(function (e) {
      e.handle();
    }), this;
  }, e.prototype.tracker = function (e, t) {
    return void 0 === t && (t = {}), new nc(e, this.collector).addExtra(t);
  }, e.prototype.setUserInfo = function (e) {
    this.collector && this.collector.reporter.setUserInfo(e);
  }, e;
}(),
    fc = { version: "4.1.0", date: 1601443721480, mode: "dev" },
    lc = new (function () {
  function e() {}return e.prototype.init = function (e) {
    var t = Object.assign({}, e);t.Debug = !t.env || "Prod" !== t.env || t.Debug, console.warn("[APM] config: ", t), this.wxTracker = new dc(wx, Object.assign({}, qa, fc, t)).track();
  }, e.prototype.notify = function (e) {
    var t = e.msg,
        n = e.data;return this.wxTracker ? this.wxTracker.tracker(Za, Object.assign({ msg: t }, n)).collect() : { errMsg: "please init apm first" };
  }, e.prototype.notifyError = function (e) {
    var t = e.msg,
        n = e.data;return this.notify({ msg: t, data: n });
  }, e.prototype.newTracker = function (e) {
    var t = e.msg,
        n = e.data;return this.wxTracker ? this.wxTracker.tracker(ec, Object.assign({ msg: t }, n)) : { errMsg: "please init apm first" };
  }, e.prototype.setUserInfo = function (e) {
    this.wxTracker ? (this.wxTracker.setUserInfo(e), console.warn("[APM] setUserInfo: ", e)) : console.warn("[APM] warning: 请先调用apm.init再设置用户信息");
  }, e;
}())();T.on("EVT_ON_LOGIN", function (e) {
  var t, n;lc.setUserInfo({ userId: null === (n = null === (t = null == e ? void 0 : e.data) || void 0 === t ? void 0 : t.userSdk) || void 0 === n ? void 0 : n.uniqueId });
});var pc = lc;export { Ks as DefLogTopics, Pt as adPointShow, $ as aggregationRequest, pc as apm, $t as checkCertification, dr as checkGameRecorder, fr as checkGameRecorderAtempo, lr as checkGameRecorderSound, pr as checkGameRecorderVolume, ie as checkIPs, Vt as checkMixVideoAd, en as checkRest, _e as checkSwitches, Lt as checkVideoAd, Bs as coverDefLog, kt as createBannerAd, Gn as createCrossAd, Ea as createFeedbackButton, tr as createGameBanner, va as createGameClubButton, nr as createGameIcon, rr as createGamePortal, Fr as createGetUserInfoBtn, At as createGridAd, Wn as customerService, de as debugLog, Rt as destroyInterstitialAd, Ht as destroyVideoAd, le as errorLog, ko as exitVoIPChat, X as getAggregationTypes, sn as getConfig, ne as getExtUserInfo, zs as getGameLogTypes, gr as getGameRecorder, vr as getGameRecorderShareButton, Wr as getGetUserInfoBtn, Gt as getInterstitialAd, ba as getLogManager, on as getNotchInfo, ce as getNotice, hi as getRecorder, pi as getRecorderInstance, Oi as getSTDDefOptions, Ai as getSTDOptions, xi as getSTDSeqTypes, ps as getShareData, ds as getShareInfo, io as getSubscribeMessageCount, Ft as getVideoAd, ca as getWallInstance, so as getWhatsNewSubscriptionsSetting, Bn as goCustomer, Ut as hortorAdPlaySuccess, Ca as information, ee as init, Oo as joinVoIPChat, ni as jumpPay, rn as launchOptions, Gr as login, ti as midasPay, Oa as network, Di as nextSTDSeq, fn as offError, hn as offHide, cn as offShow, Lo as offVoIPChatInterrupted, Do as offVoIPChatMembersChanged, Po as offVoIPChatSpeakersChanged, dn as onError, un as onHide, _s as onInteractiveStorageModified, us as onShareAppMessage, ms as onShareMessageToFriend, hs as onShareTimeline, an as G$8L, ma as onUserCaptureScreen, Uo as onVoIPChatInterrupted, xo as onVoIPChatMembersChanged, Ro as onVoIPChatSpeakersChanged, p as platformType, qt as playVideoAd, Qs as postGameLog, J as postLog, xt as preloadInterstitialAds, Mt as prepareShowHortorVedioAd, Eo as queryVoIPAuthCamera, So as queryVoIPAuthRecord, Br as registerOnLogin, Ws as reportGameUserInfo, ro as requestSubscribeMessage, oo as requestSubscribeWhatsNew, Co as requestVoIPAuthCamera, bo as requestVoIPAuthRecord, ls as resetShareConfig, Zt as setCertification, zr as setGameUserInfo, vs as setMessageToFriendQuery, ki as setSTDOptions, ga as setUserCloudStorage, cs as shareAppMessage, as as shareMessage, fs as sharePointShow, Dt as showInterstitialAd, Nt as showVideoAd, tn as stopCheckRest, Ir as storage, gs as updateShareMenu, Kr as updateUserInfo, Ao as updateVoIPChatMuteConfig, Ri as useSTDSeq, fe as warnLog, jr as weakLogin };