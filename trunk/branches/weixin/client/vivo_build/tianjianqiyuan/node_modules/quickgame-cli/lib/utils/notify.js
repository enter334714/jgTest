"use strict";var _JSON$parse,clients,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_http=_interopRequireDefault(require("http")),_fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),pathClientLog=_path.default.join(__dirname,"../../client.json"),clientExists=!1;function getDeviceInfo(e,t){var n=_http.default.request({path:"/deviceinfo",host:e.ip,port:e.port,timeout:3e3},function(e){e.on("data",function(e){t(null,JSON.parse(e))})}).on("error",function(e){t(e)}).on("timeout",function(){n.abort()});n.end()}function sendUpdateReq(e){var t="http://".concat(e.ip,":").concat(e.port,"/update"),e={host:e.ip,port:e.port,path:"/update",timeout:3e3,method:"get"},n=_http.default.request(e,function(e){console.log("### App Server ### 通知手机更新rpk文件成功: ".concat(t," ")),e.setEncoding("utf8")}).on("error",function(e){console.log("### App Server ### 通知手机更新rpk文件失败(可忽略): ".concat(t," 错误信息: ").concat(e.message))}).on("timeout",function(){console.log("### App Server ### 通知手机更新rpk文件超时(可忽略): ".concat(t)),n.abort()});n.end()}!_fs.default.existsSync(pathClientLog)||(clients=(_JSON$parse=JSON.parse(_fs.default.readFileSync(pathClientLog).toString())).clients)instanceof Array&&0<clients.length&&(clients.forEach(function(t){"127.0.0.1"!==t.ip?sendUpdateReq(t):getDeviceInfo(t,function(e){e||sendUpdateReq(t)})}),clientExists=!0),clientExists||console.log("### App Server ### 没有记录手机地址，不会通知手机更新rpk文件");