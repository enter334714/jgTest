var Laya=window.Laya=function(_j,_a){var _k={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(_a,_b){return 1==arguments.length?_k.__presubstr.call(this,_a):_k.__presubstr.call(this,_a,0<_b?_b:this.length+_b)},__init:function(_a){_a.forEach(function(_a){_a.__init$&&_a.__init$()})},__isClass:function(_a){return _a&&(_a.__isclass||_a==Object||_a==String||_a==Array)},__newvec:function(_a,_b){var _c=[];_c.length=_a;for(var _d=0;_d<_a;_d++)_c[_d]=_b;return _c},__extend:function(_a,_b){for(var _c in _b)if(_b.hasOwnProperty(_c)){var _d=Object.getOwnPropertyDescriptor(_b,_c),_e=_d.get,_f=_d.set;_e||_f?_e&&_f?Object.defineProperty(_a,_c,_d):(_e&&Object.defineProperty(_a,_c,_e),_f&&Object.defineProperty(_a,_c,_f)):_a[_c]=_b[_c]}function _g(){_k.un(this,"constructor",_a)}_g.prototype=_b.prototype,_a.prototype=new _g,_k.un(_a.prototype,"__imps",_k.__copy({},_b.prototype.__imps))},__copy:function(_a,_b){if(!_b)return null;for(var _c in _a=_a||{},_b)_a[_c]=_b[_c];return _a},__package:function(_a,_b){if(!_k.__packages[_a]){_k.__packages[_a]=!0;var _c=_j,_d=_a.split(".");if(1<_d.length)for(var _e=0,_f=_d.length-1;_e<_f;_e++){var _g=_c[_d[_e]];_c=_g||(_c[_d[_e]]={})}_c[_d[_d.length-1]]||(_c[_d[_d.length-1]]=_b||{})}},__hasOwnProperty:function(_a,_b){return _b=_b||this,Object.hasOwnProperty.call(_b,_a)||function _a(_b,_c){if(Object.hasOwnProperty.call(_c.prototype,_b))return!0;var _d=_c.prototype.__super;return null==_d?null:_a(_b,_d)}(_a,_b.__class)},__typeof:function(_a,_b){if(!_a||!_b)return!1;if(_b===String)return"string"==typeof _a;if(_b===Number)return"number"==typeof _a;if(_b.__interface__)_b=_b.__interface__;else if("string"!=typeof _b)return _a instanceof _b;return _a.__imps&&_a.__imps[_b]||_a.__class==_b},__as:function(_a,_b){return this.__typeof(_a,_b)?_a:null},__int:function(_a){return _a?parseInt(_a):0},interface:function(_a,_b){_k.__package(_a,{});var _c=_k.__internals,_d=_c[_a]=_c[_a]||{self:_a};if(_b){var _e=_b.split(",");_d.extend=[];for(var _f=0;_f<_e.length;_f++){var _g=_e[_f];_c[_g]=_c[_g]||{self:_g},_d.extend.push(_c[_g])}}var _h=_j,_i=_a.split(".");for(_f=0;_f<_i.length-1;_f++)_h=_h[_i[_f]];_h[_i[_i.length-1]]={__interface__:_a}},class:function(_a,_b,_c,_d){if(_c&&_k.__extend(_a,_c),_b)if(_k.__package(_b,_a),_k.__classmap[_b]=_a,0<_b.indexOf(".")){if(0==_b.indexOf("laya.")){var _e=_b.split(".");_d=_d||_e[_e.length-1],_k[_d]&&console.log("Warning!,this class["+_d+"] already exist:",_k[_d]),_k[_d]=_a}}else"Main"==_b?_j.Main=_a:"MainWX"==_b?_j.MainWX=_a:(_k[_b]&&console.log("Error!,this class["+_b+"] already exist:",_k[_b]),_k[_b]=_a);var _f=_k.un,_g=_a.prototype;_f(_g,"hasOwnProperty",_k.__hasOwnProperty),_f(_g,"__class",_a),_f(_g,"__super",_c),_f(_g,"__className",_b),_f(_a,"__super",_c),_f(_a,"__className",_b),_f(_a,"__isclass",!0),_f(_a,"super",function(_a){this.__super.call(_a)})},imps:function(_a,_b){if(!_b)return null;var _e=_a.__imps||_k.un(_a,"__imps",{});function _f(_a){var _b,_c;if((_b=_k.__internals[_a])&&(_e[_a]=!0,_c=_b.extend))for(var _d=0;_d<_c.length;_d++)_f(_c[_d].self)}for(var _c in _b)_f(_c)},superSet:function(_a,_b,_c,_d){var _e=_a.prototype["_$set_"+_c];_e&&_e.call(_b,_d)},superGet:function(_a,_b,_c){var _d=_a.prototype["_$get_"+_c];return _d?_d.call(_b):null},getset:function(_a,_b,_c,_d,_e){_a?(_d&&(_b["_$GET_"+_c]=_d),_e&&(_b["_$SET_"+_c]=_e)):(_d&&_k.un(_b,"_$get_"+_c,_d),_e&&_k.un(_b,"_$set_"+_c,_e)),_d&&_e?Object.defineProperty(_b,_c,{get:_d,set:_e,enumerable:!1,configurable:!0}):(_d&&Object.defineProperty(_b,_c,{get:_d,enumerable:!1,configurable:!0}),_e&&Object.defineProperty(_b,_c,{set:_e,enumerable:!1,configurable:!0}))},static:function(_c,_d){for(var _e=0,_a=_d.length;_e<_a;_e+=2)if("length"==_d[_e])_c.length=_d[_e+1].call(_c);else{function _b(){var _b=_d[_e],_a=_d[_e+1];Object.defineProperty(_c,_b,{get:function(){return delete this[_b],this[_b]=_a.call(this)},set:function(_a){delete this[_b],this[_b]=_a},enumerable:!0,configurable:!0})}_b()}},un:function(_a,_b,_c){return _c||(_c=_a[_b]),_k.__propun.value=_c,Object.defineProperty(_a,_b,_k.__propun),_c},uns:function(_b,_a){_a.forEach(function(_a){_k.un(_b,_a)})}};return _j.console=_j.console||{log:function(){}},_j.trace=_j.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),_k}(window,document);!function(_a,_b,_c){_c.un,_c.uns,_c.static,_c.class,_c.getset,_c.__newvec}(window,document,Laya),function(_g,_b,_x){_x.un,_x.uns;var _i=_x.static,_p=_x.class,_k=_x.getset;_x.__newvec;_x.interface("laya.runtime.IMarket"),_x.interface("laya.filters.IFilter"),_x.interface("laya.display.ILayout"),_x.interface("laya.resource.IDispose"),_x.interface("laya.runtime.IPlatform"),_x.interface("laya.resource.IDestroy"),_x.interface("laya.runtime.IConchNode"),_x.interface("laya.filters.IFilterAction"),_x.interface("laya.runtime.ICPlatformClass"),_x.interface("laya.resource.ICreateResource"),_x.interface("laya.runtime.IConchRenderObject"),_x.interface("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var _D=function(){function _f(){}return _p(_f,"laya.utils.RunDriver"),_f.FILTER_ACTIONS=[],_f.pixelRatio=-1,_f._charSizeTestDiv=null,_f.now=function(){return Date.now()},_f.getWindow=function(){return _g},_f.getPixelRatio=function(){if(_f.pixelRatio<0){var _a=_M.context,_b=_a.backingStorePixelRatio||_a.webkitBackingStorePixelRatio||_a.mozBackingStorePixelRatio||_a.msBackingStorePixelRatio||_a.oBackingStorePixelRatio||_a.backingStorePixelRatio||1;(_f.pixelRatio=(_M.window.devicePixelRatio||1)/_b)<1&&(_f.pixelRatio=1)}return _f.pixelRatio},_f.getIncludeStr=function(_a){return null},_f.createShaderCondition=function(_a){var _b="(function() {return "+_a+";})";return _x._runScript(_b)},_f.fontMap=[],_f.measureText=function(_a,_b){var _c=_f.hanzi.test(_a);if(_c&&_f.fontMap[_b])return _f.fontMap[_b];var _d=_M.context;_d.font=_b;var _e=_d.measureText(_a);return _e||(_e={width:16,height:16}),_c&&(_f.fontMap[_b]=_e),_e},_f.getWebGLContext=function(_a){},_f.beginFlush=function(){},_f.endFinish=function(){},_f.addToAtlas=null,_f.flashFlushImage=function(_a){},_f.drawToCanvas=function(_a,_b,_c,_d,_e,_f){var _g=_ta.create("2D"),_h=new _I(_c,_d,_g);return _J.renders[_b]._fun(_a,_h,_e,_f),_g},_f.createParticleTemplate2D=null,_f.createGLTextur=null,_f.createWebGLContext2D=null,_f.changeWebGLSize=function(_a,_b){},_f.createRenderSprite=function(_a,_b){return new _J(_a,_b)},_f.createFilterAction=function(_a){return new _t},_f.createGraphics=function(){return new _m},_f.clear=function(_a){_H._context.ctx.clear()},_f.cancelLoadByUrl=function(_a){},_f.clearAtlas=function(_a){},_f.isAtlas=function(_a){return!1},_f.addTextureToAtlas=function(_a){},_f.getTexturePixels=function(_a,_b,_c,_d,_e){return null},_f.skinAniSprite=function(){return null},_f.update3DLoop=function(){},_i(_f,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),_f}(),_d=(_k(1,_x,"alertGlobalError",null,function(_a){var _f=0;_M.window.onerror=_a?function(_a,_b,_c,_d,_e){_f++<5&&_e&&alert(_e.stack||_e)}:null}),_x.init=function(_a,_b,_c){for(var _d=[],_e=2,_f=arguments.length;_e<_f;_e++)_d.push(arguments[_e]);if(!_x._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=_x._arrayBufferSlice),_x._isinit=!0,_M.__init__(),_K.__init__(),_m.__init__(),_x.timer=new _W,_x.scaleTimer=new _W,_x.loader=new _ia,_$.__init__(),_e=0;for(var _g=_d.length;_e<_g;_e++)_d[_e].enable&&_d[_e].enable();return _n.__init__(),_h.__init__(),_L.__init__(),_O.beginCheck(),_x._currentStage=_x.stage=new _ra,_x.stage.conchModel&&_x.stage.conchModel.setRootNode(),_x._getUrlPath(),_x.render=new _H(0,0),_x.stage.size(_a,_b),_J.__init__(),_l.__init__(),_o.instance.__init__(_x.stage,_H.canvas),_va.__init__(),_C.autoStopMusic=!0,_A.__init__(),_H.canvas}},_x._getUrlPath=function(){var _a=_M.window.location,_b=_a.pathname;_b=_b&&":"==_b.charAt(2)?_b.substring(1):_b,_G.rootPath=_G.basePath=_G.getPath("file:"==_a.protocol?_b:_a.protocol+"//"+_a.host+_a.pathname)},_x._arrayBufferSlice=function(_a,_b){var _c=new Uint8Array(this,_a,_b-_a),_d=new Uint8Array(_c.length);return _d.set(_c),_d.buffer},_x._runScript=function(_a){return _M.window[_x._evcode](_a)},_x.stage=null,_x.timer=null,_x.scaleTimer=null,_x.loader=null,_x.version="1.8.6",_x.render=null,_x._currentStage=null,_x._isinit=!1,_x.isDebug=!1,_x.MiniAdpter={init:function(){_g.navigator&&_g.navigator.userAgent&&-1<_g.navigator.userAgent.indexOf("MiniGame")&&console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}},_i(_x,["conchMarket",function(){return this.conchMarket=_g.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=_g.PlatformClass},"_evcode",function(){return this._evcode="e"+String.fromCharCode(118)+"al"}]),function(){function _a(){}return _p(_a,"Config"),_a.WebGLTextCacheCount=500,_a.atlasEnable=!1,_a.showCanvasMark=!1,_a.animationInterval=50,_a.isAntialias=!1,_a.isAlpha=!1,_a.premultipliedAlpha=!0,_a.isStencil=!0,_a.preserveDrawingBuffer=!1,_a}()),_j=function(){function _j(){this._events=null}_p(_j,"laya.events.EventDispatcher");var _a=_j.prototype;return _a.hasListener=function(_a){return!!(this._events&&this._events[_a])},_a.getListener=function(_a){return this._events?this._events[_a]:null},_a.event=function(_a,_b){if(!this._events||!this._events[_a])return!1;var _c=this._events[_a];if(_c.lock)_c.queue||(_c.queue=[]),_c.queue.push(_b);else{var _d;for(_c.lock=!0,_c.cursor=_c.head;_c.cursor;)(_d=_c.cursor).recover?(_c.head=_c.tail=_c.cursor=null,console.error("node is recover："+_d.id)):(_c.cursor=_d.next,_d.once&&_j.delNode(_c,_d),_d.method&&(null!=_b?_d.args?_d.method.apply(_d.caller,_d.args.concat(_b)):_b instanceof Array?_d.method.apply(_d.caller,_b):_d.caller?_d.method.call(_d.caller,_b):_x.recordError("事件派发错误","node.caller:"+_d.caller+"node.method:"+_d.method+"data:"+_b+"node.prev"+_d.prev):_d.method.apply(_d.caller,_d.args)),_d.once&&_j.recoverHandler(_d));_c.lock=!1,!_c.head&&this._events&&this._events[_a]==_c&&delete this._events[_a],_c.queue&&_c.queue.length&&this.event(_a,_c.queue.shift())}return!0},_a.on=function(_a,_b,_c,_d){return this._createListener(_a,_b,_c,_d,!1)},_a.once=function(_a,_b,_c,_d){return this._createListener(_a,_b,_c,_d,!0)},_a._createListener=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=!0),_f&&this.off(_a,_b,_c,_e);var _g=_j.createHandler(_b||this,_c,_d,_e);this._events||(this._events={});var _h=this._events,_i=_h[_a];return _i?_i.tail?(_g.prev=_i.tail,_i.tail.next=_g,_i.tail=_g):_i.head=_i.tail=_g:_h[_a]={head:_g,tail:_g,cursor:null,lock:!1},this},_a.off=function(_a,_b,_c,_d){if(void 0===_d&&(_d=!1),!this._events||!this._events[_a])return this;for(var _e=this._events[_a],_f=_e.head;_f;){if((!_b||_f.caller===_b)&&_f.method===_c&&(!_d||_f.once)){_j.delNode(_e,_f),_e.cursor==_f&&(_e.cursor=_f.next),_j.recoverHandler(_f);break}_f=_f.next}return this},_a.offAll=function(_a){var _b=this._events;if(!_b)return this;if(_a)this._recoverHandlers(_b[_a]),delete _b[_a];else{for(var _c in _b)this._recoverHandlers(_b[_c]);this._events=null}return this},_a._recoverHandlers=function(_a){if(_a){for(var _b=_a.head;_b;){_j.delNode(_a,_b);var _c=_b.next;_j.recoverHandler(_b),_b=_c}_a.cursor=null}},_a.isMouseEvent=function(_a){return _j.MOUSE_EVENTS[_a]},_j.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},_j.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0})},_j.delNode=function(_a,_b){_b.prev?_b.prev.next=_b.next:_a.head=_b.next,_b.next?_b.next.prev=_b.prev:_a.tail=_b.prev},_j.createHandler=function(_a,_b,_c,_d){var _e=500<_j._freeHandler.length?_j._freeHandler.shift():null;if(_e)if(_e.recover)_e.recover=!1,_e.caller=_a,_e.method=_b,_e.args=_c,_e.once=_d;else{var _f="";try{arguments.propertyIsEnumerable.caller}catch(_a){_f=_a.stack}var _g=_e.caller?(_e.caller.__proto__&&_e.caller.__proto__.constructor&&_e.caller.__proto__.constructor.name)+"|"+_e.caller.__className+"|"+_e.caller.name:"",_h=_e.method?_e.method.name:"";_x.recordError("EventDispatcher重复创建","caller="+_g+"  method="+_h+"  stack="+_f),_e={id:++_j._nodeCount,caller:_a,method:_b,args:_c,once:_d,recover:!1}}else _e={id:++_j._nodeCount,caller:_a,method:_b,args:_c,once:_d,recover:!1};return _e.prev=_e.next=null,_e},_j.recoverHandler=function(_a){if(_a.recover){if(_j._errorCount<5){_j._errorCount++;var _b="";try{arguments.propertyIsEnumerable.caller}catch(_a){_b=_a.stack}var _c=_a.caller?(_a.caller.__proto__&&_a.caller.__proto__.constructor&&_a.caller.__proto__.constructor.name)+"|"+_a.caller.__className+"|"+_a.caller.name:"",_d=_a.method?_a.method.name:"";_x.recordError("EventDispatcher重复回收","id="+_a.id+"  caller="+_c+"  method="+_d+"  stack="+_b)}_a.caller=_a.method=_a.args=_a.prev=null}else _a.recover=!0,_a.caller=_a.method=_a.args=_a.prev=_a.next=null,_j._freeHandler&&_j._freeHandler.length<3e3&&_j._freeHandler.push(_a)},_j._freeHandler=[],_j._nodeCount=0,_j._errorCount=0,_j}(),_s=function(){function _e(_a,_b,_c,_d){this.once=!1,void(this._id=0)===_d&&(_d=!1),this.setTo(_a,_b,_c,_d)}_p(_e,"laya.utils.Handler");var _a=_e.prototype;return _a.setTo=function(_a,_b,_c,_d){return this._id=_e._gid++,this.caller=_a,this.method=_b,this.args=_c,this.once=_d,this},_a.run=function(){if(null==this.method)return null;var _a=this._id,_b=this.method.apply(this.caller,this.args);return this._id===_a&&this.once&&this.recover(),_b},_a.runWith=function(_a){if(null==this.method)return null;var _b=this._id;if(null==_a)var _c=this.method.apply(this.caller,this.args);else _c=this.args||_a.unshift?this.args?this.method.apply(this.caller,this.args.concat(_a)):this.method.apply(this.caller,_a):this.method.call(this.caller,_a);return this._id===_b&&this.once&&this.recover(),_c},_a.clear=function(){return this.caller=null,this.method=null,this.args=null,this},_a.recover=function(){0<this._id&&(this._id=0,this.clear())},_e.create=function(_a,_b,_c,_d){return void 0===_d&&(_d=!0),new _e(_a,_b,_c,_d)},_e._gid=1,_e}(),_B=function(){function _a(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}_p(_a,"laya.display.BitmapFont");var _b=_a.prototype;return _b.loadFont=function(_a,_b){this._path=_a,this._complete=_b,_x.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],_s.create(this,this.onLoaded))},_b.onLoaded=function(){this.parseFont(_ha.getRes(this._path),_ha.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.runWith(this._texture?this:null)},_b.parseFont=function(_a,_b){if(null!=_a&&null!=_b){this._texture=_b;var _c=_a.getElementsByTagName("info");if(!_c[0].getAttributeNode)return this.parseFont2(_a,_b);this.fontSize=parseInt(_c[0].getAttributeNode("size").nodeValue);var _d,_e=_c[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(_e[0]),parseInt(_e[1]),parseInt(_e[2]),parseInt(_e[3])],_d=_a.getElementsByTagName("char");var _f=0;for(_f=0;_f<_d.length;_f++){var _g=_d[_f],_h=parseInt(_g.getAttributeNode("id").nodeValue),_i=parseInt(_g.getAttributeNode("xoffset").nodeValue)/1,_j=parseInt(_g.getAttributeNode("yoffset").nodeValue)/1,_k=parseInt(_g.getAttributeNode("xadvance").nodeValue)/1,_l=new _z;_l.x=parseInt(_g.getAttributeNode("x").nodeValue),_l.y=parseInt(_g.getAttributeNode("y").nodeValue),_l.width=parseInt(_g.getAttributeNode("width").nodeValue),_l.height=parseInt(_g.getAttributeNode("height").nodeValue);var _m=_ka.create(_b,_l.x,_l.y,_l.width,_l.height,_i,_j);this._maxWidth=Math.max(this._maxWidth,_k+this.letterSpacing),this._fontCharDic[_h]=_m,this._fontWidthMap[_h]=_k}}},_b.parseFont2=function(_a,_b){if(null!=_a&&null!=_b){this._texture=_b;var _c=_a.getElementsByTagName("info");this.fontSize=parseInt(_c[0].attributes.size.nodeValue);var _d=_c[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(_d[0]),parseInt(_d[1]),parseInt(_d[2]),parseInt(_d[3])];var _e=_a.getElementsByTagName("char"),_f=0;for(_f=0;_f<_e.length;_f++){var _g=_e[_f].attributes,_h=parseInt(_g.id.nodeValue),_i=parseInt(_g.xoffset.nodeValue)/1,_j=parseInt(_g.yoffset.nodeValue)/1,_k=parseInt(_g.xadvance.nodeValue)/1,_l=new _z;_l.x=parseInt(_g.x.nodeValue),_l.y=parseInt(_g.y.nodeValue),_l.width=parseInt(_g.width.nodeValue),_l.height=parseInt(_g.height.nodeValue);var _m=_ka.create(_b,_l.x,_l.y,_l.width,_l.height,_i,_j);this._maxWidth=Math.max(this._maxWidth,_k+this.letterSpacing),this._fontCharDic[_h]=_m,this._fontWidthMap[_h]=_k}}},_b.getCharTexture=function(_a){return this._fontCharDic[_a.charCodeAt(0)]},_b.destroy=function(){if(this._texture){for(var _a in this._fontCharDic){var _b=this._fontCharDic[_a];_b&&_b.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},_b.setSpaceWidth=function(_a){this._spaceWidth=_a},_b.getCharWidth=function(_a){var _b=_a.charCodeAt(0);return this._fontWidthMap[_b]?this._fontWidthMap[_b]+this.letterSpacing:" "==_a?this._spaceWidth+this.letterSpacing:0},_b.getTextWidth=function(_a){for(var _b=0,_c=0,_d=_a.length;_c<_d;_c++)_b+=this.getCharWidth(_a.charAt(_c));return _b},_b.getMaxWidth=function(){return this._maxWidth},_b.getMaxHeight=function(){return this.fontSize},_b.drawText=function(_a,_b,_c,_d,_e,_f){var _g,_h=this.getTextWidth(_a),_i=0;"center"===_e&&(_i=(_f-_h)/2),"right"===_e&&(_i=_f-_h);for(var _j=0,_k=0,_l=_a.length;_k<_l;_k++)(_g=this.getCharTexture(_a.charAt(_k)))&&(_b.graphics.drawTexture(_g,_c+_j+_i,_d),_j+=this.getCharWidth(_a.charAt(_k)))},_a}(),_h=function(){function _c(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=_c._TF_EMPTY}_p(_c,"laya.display.css.Style");var _a=_c.prototype;return _a.getTransform=function(){return this._tf},_a.setTransform=function(_a){this._tf="none"!==_a&&_a?_a:_c._TF_EMPTY},_a.setTranslateX=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.translateX=_a},_a.setTranslateY=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.translateY=_a},_a.setScaleX=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.scaleX=_a},_a.setScale=function(_a,_b){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.scaleX=_a,this._tf.scaleY=_b},_a.setScaleY=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.scaleY=_a},_a.setRotate=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.rotate=_a},_a.setSkewX=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.skewX=_a},_a.setSkewY=function(_a){this._tf===_c._TF_EMPTY&&(this._tf=new _e),this._tf.skewY=_a},_a.destroy=function(){this.scrollRect=null},_a.render=function(_a,_b,_c,_d){},_a.getCSSStyle=function(){return _ba.EMPTY},_a._enableLayout=function(){return!1},_k(0,_a,"scaleX",function(){return this._tf.scaleX},function(_a){this.setScaleX(_a)}),_k(0,_a,"transform",function(){return this.getTransform()},function(_a){this.setTransform(_a)}),_k(0,_a,"translateX",function(){return this._tf.translateX},function(_a){this.setTranslateX(_a)}),_k(0,_a,"translateY",function(){return this._tf.translateY},function(_a){this.setTranslateY(_a)}),_k(0,_a,"scaleY",function(){return this._tf.scaleY},function(_a){this.setScaleY(_a)}),_k(0,_a,"block",function(){return 0!=(1&this._type)}),_k(0,_a,"skewY",function(){return this._tf.skewY},function(_a){this.setSkewY(_a)}),_k(0,_a,"rotate",function(){return this._tf.rotate},function(_a){this.setRotate(_a)}),_k(0,_a,"skewX",function(){return this._tf.skewX},function(_a){this.setSkewX(_a)}),_k(0,_a,"paddingLeft",function(){return 0}),_k(0,_a,"paddingTop",function(){return 0}),_k(0,_a,"absolute",function(){return!0}),_c.__init__=function(){_c._TF_EMPTY=new _e,_c.EMPTY=new _c},_c.EMPTY=null,_c._TF_EMPTY=null,_c}(),_n=function(){function _b(_a){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=_Q.create(_b.defaultColor),this.family=_b.defaultFamily,this.stroke=_b._STROKE,this.size=_b.defaultSize,_a&&_a!==_b.EMPTY&&_a.copyTo(this)}_p(_b,"laya.display.css.Font");var _a=_b.prototype;return _a.set=function(_a){this._text=null;for(var _b=_a.split(" "),_c=0,_d=_b.length;_c<_d;_c++){var _e=_b[_c];switch(_e){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<_e.indexOf("px")&&(this.size=parseInt(_e),this.family=_b[_c+1],_c++)}},_a.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},_a.copyTo=function(_a){_a._type=this._type,_a._text=this._text,_a._weight=this._weight,_a._color=this._color,_a.family=this.family,_a.stroke=this.stroke!=_b._STROKE?this.stroke.slice():_b._STROKE,_a.indent=this.indent,_a.size=this.size},_k(0,_a,"password",function(){return 0!=(1024&this._type)},function(_a){_a?this._type|=1024:this._type&=-1025}),_k(0,_a,"color",function(){return this._color.strColor},function(_a){this._color=_Q.create(_a)}),_k(0,_a,"italic",function(){return 0!=(512&this._type)},function(_a){_a?this._type|=512:this._type&=-513}),_k(0,_a,"bold",function(){return 0!=(2048&this._type)},function(_a){_a?this._type|=2048:this._type&=-2049}),_k(0,_a,"weight",function(){return""+this._weight},function(_a){var _b=0;switch(_a){case"normal":break;case"bold":this.bold=!0,_b=700;break;case"bolder":_b=800;break;case"lighter":_b=100;break;default:_b=parseInt(_a)}this._weight=_b,this._text=null}),_k(0,_a,"decoration",function(){return this._decoration?this._decoration.value:null},function(_a){var _b=_a.split(" ");switch(this._decoration||(this._decoration={}),_b[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=_b[0]}_b[1]&&(this._decoration.color=_Q.create(_b)),this._decoration.value=_a}),_b.__init__=function(){_b.EMPTY=new _b(null)},_b.EMPTY=null,_b.defaultColor="#000000",_b.defaultSize=12,_b.defaultFamily="Arial",_b.defaultFont="12px Arial",_b._STROKE=[0,"#000000"],_b._ITALIC=512,_b._PASSWORD=1024,_b._BOLD=2048,_b}(),_e=function(){function _a(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return _p(_a,"laya.display.css.TransformInfo"),_a}(),_m=function(){function _l(){if(this._one=null,this._cmds=null,this._render=this._renderEmpty,_H.isConchNode){this._nativeObj=new _g._conchGraphics,this.id=this._nativeObj.conchID}}_p(_l,"laya.display.Graphics");var _a=_l.prototype;return _a.destroy=function(){this.clear(),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},_a.clear=function(_a){void 0===_a&&(_a=!1);var _b=0,_c=0;if(_a){var _d=this._one;if(this._cmds){for(_c=this._cmds.length,_b=0;_b<_c;_b++)!(_d=this._cmds[_b])||_d.callee!==_H._context._drawTexture&&_d.callee!==_H._context._drawTextureWithTransform||(_d[0]=null,_l._cache.push(_d));this._cmds.length=0}else _d&&(!_d||_d.callee!==_H._context._drawTexture&&_d.callee!==_H._context._drawTextureWithTransform||(_d[0]=null,_l._cache.push(_d)))}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._sp&&(this._sp._renderType&=-514),this._repaint(),this._vectorgraphArray){for(_b=0,_c=this._vectorgraphArray.length;_b<_c;_b++)_Z.getInstance().deleteShape(this._vectorgraphArray[_b]);this._vectorgraphArray.length=0}},_a._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},_a._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=new _c,this._graphicBounds._graphics=this)},_a._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},_a._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},_a.getBounds=function(_a){return void 0===_a&&(_a=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(_a)},_a.getBoundPoints=function(_a){return void 0===_a&&(_a=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(_a)},_a._addCmd=function(_a){this._cmds=this._cmds||[],_a.callee=_a.shift(),this._cmds.push(_a)},_a.setFilters=function(_a){this._saveToCmd(_H._context._setFilters,_a)},_a.drawTexture=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_g&&(_g=1),!_a||_g<.01)return null;_d||(_d=_a.sourceWidth),_e||(_e=_a.sourceHeight),_g=_g<0?0:1<_g?1:_g;var _h,_i=!_H.isWebGL&&(_M.onFirefox||_M.onEdge||_M.onIE||_M.onSafari)?.5:0,_j=_d/_a.sourceWidth,_k=_e/_a.sourceHeight;return _d=_a.width*_j,_e=_a.height*_k,_a.loaded&&(_d<=0||_e<=0)?null:(_b+=_a.offsetX*_j,_c+=_a.offsetY*_k,this._sp&&(this._sp._renderType|=512),_b-=_i,_c-=_i,_d+=2*_i,_e+=2*_i,_l._cache.length?((_h=_l._cache.pop())[0]=_a,_h[1]=_b,_h[2]=_c,_h[3]=_d,_h[4]=_e,_h[5]=_f,_h[6]=_g):_h=[_a,_b,_c,_d,_e,_f,_g],_h.callee=_f||1!=_g?_H._context._drawTextureWithTransform:_H._context._drawTexture,null!=this._one||_f||1!=_g?this._saveToCmd(_h.callee,_h):(this._one=_h,this._render=this._renderOneImg),_a.loaded||_a.once("loaded",this,this._textureLoaded,[_a,_h]),this._repaint(),_h)},_a.cleanByTexture=function(_a,_b,_c,_d,_e){if(void 0===_d&&(_d=0),void 0===_e&&(_e=0),!_a)return this.clear();if(this._one&&this._render===this._renderOneImg){_d||(_d=_a.sourceWidth),_e||(_e=_a.sourceHeight);var _f=_d/_a.sourceWidth,_g=_e/_a.sourceHeight;_d=_a.width*_f,_e=_a.height*_g,_b+=_a.offsetX*_f,_c+=_a.offsetY*_g,this._one[0]=_a,this._one[1]=_b,this._one[2]=_c,this._one[3]=_d,this._one[4]=_e,this._repaint()}else this.clear(),_a&&this.drawTexture(_a,_b,_c,_d,_e)},_a.drawTextures=function(_a,_b){_a&&this._saveToCmd(_H._context._drawTextures,[_a,_b])},_a.fillTexture=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_f&&(_f="repeat"),_a){var _h=[_a,_b,_c,_d,_e,_f,_g||_y.EMPTY,{}];_a.loaded||_a.once("loaded",this,this._textureLoaded,[_a,_h]),this._saveToCmd(_H._context._fillTexture,_h)}},_a._textureLoaded=function(_a,_b){_b[3]=_b[3]||_a.width,_b[4]=_b[4]||_a.height,this._repaint()},_a.fillCircle=function(_a,_b,_c,_d,_e,_f,_g){_c.bitmap.enableMerageInAtlas=!1;var _h=new Float32Array(2*(_g+1)),_i=new Float32Array(2*(_g+1)),_j=new Uint16Array(3*_g),_k=2*Math.PI/_g,_l=0;_h[0]=_d,_h[1]=_e,_i[0]=_d/_c.width,_i[1]=_e/_c.height;for(var _m=2,_n=0;_n<_g;_n++){var _o=_f*Math.cos(_l)+_d,_p=_f*Math.sin(_l)+_e;_h[_m]=_o,_h[_m+1]=_p,_i[_m]=_o/_c.width,_i[_m+1]=_p/_c.height,_l+=_k,_m+=2}for(_n=_m=0;_n<_g;_n++)_j[_m++]=0,_j[_m++]=_n+1,_j[_m++]=_g+1<=_n+2?1:_n+2;this.drawTriangles(_c,_a,_b,_h,_i,_j)},_a.drawTriangles=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){void 0===_h&&(_h=1),this._saveToCmd(_H._context.drawTriangles,[_a,_b,_c,_d,_e,_f,_g,_h,_i,_j])},_a._saveToCmd=function(_a,_b){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=_b,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(_b)),_b.callee=_a,this._repaint(),_b},_a.clipRect=function(_a,_b,_c,_d){this._saveToCmd(_H._context._clipRect,[_a,_b,_c,_d])},_a.fillText=function(_a,_b,_c,_d,_e,_f,_g){void 0===_g&&(_g=0),this._saveToCmd(_H._context._fillText,[_a,_b,_c,_d||_n.defaultFont,_e,_f])},_a.fillBorderText=function(_a,_b,_c,_d,_e,_f,_g,_h){this._saveToCmd(_H._context._fillBorderText,[_a,_b,_c,_d||_n.defaultFont,_e,_f,_g,_h])},_a.strokeText=function(_a,_b,_c,_d,_e,_f,_g){this._saveToCmd(_H._context._strokeText,[_a,_b,_c,_d||_n.defaultFont,_e,_f,_g])},_a.alpha=function(_a){_a=_a<0?0:1<_a?1:_a,this._saveToCmd(_H._context._alpha,[_a])},_a.setAlpha=function(_a){_a=_a<0?0:1<_a?1:_a,this._saveToCmd(_H._context._setAlpha,[_a])},_a.transform=function(_a,_b,_c){void 0===_b&&(_b=0),void 0===_c&&(_c=0),this._saveToCmd(_H._context._transform,[_a,_b,_c])},_a.rotate=function(_a,_b,_c){void 0===_b&&(_b=0),void 0===_c&&(_c=0),this._saveToCmd(_H._context._rotate,[_a,_b,_c])},_a.scale=function(_a,_b,_c,_d){void 0===_c&&(_c=0),void 0===_d&&(_d=0),this._saveToCmd(_H._context._scale,[_a,_b,_c,_d])},_a.translate=function(_a,_b){this._saveToCmd(_H._context._translate,[_a,_b])},_a.save=function(){this._saveToCmd(_H._context._save,[])},_a.restore=function(){this._saveToCmd(_H._context._restore,[])},_a.replaceText=function(_a){this._repaint();var _b=this._cmds;if(_b){for(var _c=_b.length-1;-1<_c;_c--)if(this._isTextCmd(_b[_c].callee))return _b[_c][0].toUpperCase?_b[_c][0]=_a:_b[_c][0].setText(_a),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=_a:this._one[0].setText(_a),!0;return!1},_a._isTextCmd=function(_a){return _a===_H._context._fillText||_a===_H._context._fillBorderText||_a===_H._context._strokeText},_a.replaceTextColor=function(_a){this._repaint();var _b=this._cmds;if(_b)for(var _c=_b.length-1;-1<_c;_c--)this._isTextCmd(_b[_c].callee)&&(_b[_c][4]=_a,_b[_c][0].toUpperCase||(_b[_c][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=_a,this._one[0].toUpperCase||(this._one[0].changed=!0))},_a.loadImage=function(_a,_b,_c,_d,_e,_f){var _g=this;void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),void 0===_e&&(_e=0);var _h=_ha.getRes(_a);function _i(_a){_a&&(_g.drawTexture(_a,_b,_c,_d,_e),null!=_f&&_f.call(_g._sp,_a))}_h?_i(_h):_x.loader.load(_a,_s.create(null,_i),null,"image")},_a._renderEmpty=function(_a,_b,_c,_d){},_a._renderAll=function(_a,_b,_c,_d){for(var _e,_f=this._cmds,_g=0,_h=_f.length;_g<_h;_g++)(_e=_f[_g]).callee.call(_b,_c,_d,_e)},_a._renderOne=function(_a,_b,_c,_d){this._one.callee.call(_b,_c,_d,this._one)},_a._renderOneImg=function(_a,_b,_c,_d){this._one.callee.call(_b,_c,_d,this._one),2305!==_a._renderType&&(_a._renderType|=1)},_a.drawLine=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=1);var _g=0;_H.isWebGL&&(_g=_Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(_g));var _h=_f%2==0?0:.5,_i=[_a+_h,_b+_h,_c+_h,_d+_h,_e,_f,_g];this._saveToCmd(_H._context._drawLine,_i)},_a.drawLines=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=1);var _f=0;if(_c&&!(_c.length<4)){_H.isWebGL&&(_f=_Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(_f));var _g=_e%2==0?0:.5,_h=[_a+_g,_b+_g,_c,_d,_e,_f];this._saveToCmd(_H._context._drawLines,_h)}},_a.drawCurves=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=1);var _f=[_a,_b,_c,_d,_e];this._saveToCmd(_H._context._drawCurves,_f)},_a.drawRect=function(_a,_b,_c,_d,_e,_f,_g){void 0===_g&&(_g=1);var _h=_f?_g/2:0,_i=_f?_g:0,_j=[_a+_h,_b+_h,_c-_i,_d-_i,_e,_f,_g];this._saveToCmd(_H._context._drawRect,_j)},_a.drawCircle=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=1);var _g=_e?_f/2:0,_h=0;_H.isWebGL&&(_h=_Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(_h));var _i=[_a,_b,_c-_g,_d,_e,_f,_h];this._saveToCmd(_H._context._drawCircle,_i)},_a.drawPie=function(_a,_b,_c,_d,_e,_f,_g,_h){void 0===_h&&(_h=1);var _i=_g?_h/2:0,_j=_g?_h:0,_k=0;_H.isWebGL&&(_k=_Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(_k));var _l=[_a+_i,_b+_i,_c-_j,_d,_e,_f,_g,_h,_k];_l[3]=_Y.toRadian(_d),_l[4]=_Y.toRadian(_e),this._saveToCmd(_H._context._drawPie,_l)},_a.drawPoly=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=1);var _g=0,_h=!1;_H.isWebGL&&(_g=_Z.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(_g),_h=!(6<_c.length));var _i=_e?_f%2==0?0:.5:0,_j=[_a+_i,_b+_i,_c,_d,_e,_f,_g,_h];this._saveToCmd(_H._context._drawPoly,_j)},_a.drawPath=function(_a,_b,_c,_d,_e){var _f=[_a,_b,_c,_d,_e];this._saveToCmd(_H._context._drawPath,_f)},_k(0,_a,"cmds",function(){return this._cmds},function(_a){this._sp&&(this._sp._renderType|=512),this._cmds=_a,this._render=this._renderAll,this._repaint()}),_l.__init__=function(){if(_H.isConchNode){for(var _a=laya.display.Graphics.prototype,_b=_M.window.ConchGraphics.prototype,_c=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],_d=0,_e=_c.length;_d<=_e;_d++){var _f=_c[_d];_a[_f]=_b[_f]}_a._saveToCmd=null,_b.drawImageS&&(_a.drawTextures=function(_a,_b){if(_a&&_a.loaded&&_a.bitmap&&_a.source){var _c=_a.uv,_d=_a.bitmap.width,_e=_a.bitmap.height;this.drawImageS(_a.bitmap.source,_c[0]*_d,_c[1]*_e,(_c[2]-_c[0])*_d,(_c[5]-_c[3])*_e,_a.offsetX,_a.offsetY,_a.width,_a.height,_b)}}),_a.drawTexture=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_g&&(_g=1),_a)if(_a.loaded){if(_a.loaded&&_a.bitmap&&_a.source&&(_d||(_d=_a.sourceWidth),_e||(_e=_a.sourceHeight),_g=_g<0?0:1<_g?1:_g,_d=_d-_a.sourceWidth+_a.width,_e=_e-_a.sourceHeight+_a.height,!(_d<=0||_e<=0))){_b+=_a.offsetX,_c+=_a.offsetY;var _h=_a.uv,_i=_a.bitmap.width,_j=_a.bitmap.height;_h[4]<_h[0]&&_h[5]<_h[1]?this.drawImageM(_a.bitmap.source,_h[4]*_i,_h[5]*_j,(_h[0]-_h[4])*_i,(_h[1]-_h[5])*_j,_b,_c,_d,_e,_f,_g):this.drawImageM(_a.bitmap.source,_h[0]*_i,_h[1]*_j,(_h[2]-_h[0])*_i,(_h[5]-_h[3])*_j,_b,_c,_d,_e,_f,_g),this._repaint()}}else _a.once("loaded",this,function(){this.drawTexture(_a,_b,_c,_d,_e,_f)})},_a.fillTexture=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_f&&(_f="repeat"),_a&&_a.loaded){var _h,_i=_H._context.ctx,_j=_a.bitmap.width,_k=_a.bitmap.height,_l=_a.uv;_h=_a.uv!=_ka.DEF_UV?_i.createPattern(_a.bitmap.source,_f,_l[0]*_j,_l[1]*_k,(_l[2]-_l[0])*_j,(_l[5]-_l[3])*_k):_i.createPattern(_a.bitmap.source,_f);var _m=0,_n=0;_g&&(_b+=_g.x%_a.width,_c+=_g.y%_a.height,_m-=_g.x%_a.width,_n-=_g.y%_a.height),this._fillImage(_h,_b,_c,_m,_n,_d,_e)}}}},_l._cache=[],_l}(),_c=function(){function _t(){this._cacheBoundsType=!1}_p(_t,"laya.display.GraphicsBounds");var _a=_t.prototype;return _a.destroy=function(){this._graphics=null,this._temp=null,this._rstBoundPoints=null,this._bounds=null},_a.reset=function(){this._temp&&(this._temp.length=0)},_a.getBounds=function(_a){return void 0===_a&&(_a=!1),(!this._bounds||!this._temp||this._temp.length<1||_a!=this._cacheBoundsType)&&(this._bounds=_z._getWrapRec(this.getBoundPoints(_a),this._bounds)),this._cacheBoundsType=_a,this._bounds},_a.getBoundPoints=function(_a){return void 0===_a&&(_a=!1),(!this._temp||this._temp.length<1||_a!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(_a)),this._cacheBoundsType=_a,this._rstBoundPoints=_Y.copyArray(this._rstBoundPoints,this._temp)},_a._getCmdPoints=function(_a){void 0===_a&&(_a=!1);var _b,_c,_d=_H._context,_e=this._graphics.cmds;if((_b=this._temp||(this._temp=[])).length=0,_e||null==this._graphics._one||(_t._tempCmds.length=0,_t._tempCmds.push(this._graphics._one),_e=_t._tempCmds),!_e)return _b;(_c=_t._tempMatrixArrays).length=0;var _f=_t._initMatrix;_f.identity();for(var _g,_h,_i=_t._tempMatrix,_j=NaN,_k=NaN,_l=NaN,_m=NaN,_n=NaN,_o=NaN,_p=0,_q=_e.length;_p<_q;_p++)if((_g=_e[_p]).callee)switch(_g.callee){case _d._save:case 7:_c.push(_f),_f=_f.clone();break;case _d._restore:case 8:_f=_c.pop();break;case _d._scale:case 5:_i.identity(),_i.translate(-_g[2],-_g[3]),_i.scale(_g[0],_g[1]),_i.translate(_g[2],_g[3]),this._switchMatrix(_f,_i);break;case _d._rotate:case 3:_i.identity(),_i.translate(-_g[1],-_g[2]),_i.rotate(_g[0]),_i.translate(_g[1],_g[2]),this._switchMatrix(_f,_i);break;case _d._translate:case 6:_i.identity(),_i.translate(_g[0],_g[1]),this._switchMatrix(_f,_i);break;case _d._transform:case 4:_i.identity(),_i.translate(-_g[1],-_g[2]),_i.concat(_g[0]),_i.translate(_g[1],_g[2]),this._switchMatrix(_f,_i);break;case 16:case 24:_t._addPointArrToRst(_b,_z._getBoundPointS(_g[0],_g[1],_g[2],_g[3]),_f);break;case 17:_f.copyTo(_i),_i.concat(_g[4]),_t._addPointArrToRst(_b,_z._getBoundPointS(_g[0],_g[1],_g[2],_g[3]),_i);break;case _d._drawTexture:_h=_g[0],_a?_g[3]&&_g[4]?_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_g[3],_g[4]),_f):(_h=_g[0],_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_h.width,_h.height),_f)):(_j=(_g[3]||_h.sourceWidth)/_h.width,_k=(_g[4]||_h.sourceHeight)/_h.height,_l=_j*_h.sourceWidth,_m=_k*_h.sourceHeight,_n=0<_h.offsetX?_h.offsetX:0,_o=0<_h.offsetY?_h.offsetY:0,_n*=_j,_o*=_k,_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1]-_n,_g[2]-_o,_l,_m),_f));break;case _d._fillTexture:_g[3]&&_g[4]?_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_g[3],_g[4]),_f):(_h=_g[0],_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_h.width,_h.height),_f));break;case _d._drawTextureWithTransform:var _r;_r=_g[5]?(_f.copyTo(_i),_i.concat(_g[5]),_i):_f,_a?_g[3]&&_g[4]?_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_g[3],_g[4]),_r):(_h=_g[0],_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1],_g[2],_h.width,_h.height),_r)):(_h=_g[0],_j=(_g[3]||_h.sourceWidth)/_h.width,_k=(_g[4]||_h.sourceHeight)/_h.height,_l=_j*_h.sourceWidth,_m=_k*_h.sourceHeight,_n=0<_h.offsetX?_h.offsetX:0,_o=0<_h.offsetY?_h.offsetY:0,_n*=_j,_o*=_k,_t._addPointArrToRst(_b,_z._getBoundPointS(_g[1]-_n,_g[2]-_o,_l,_m),_r));break;case _d._drawRect:case 13:_t._addPointArrToRst(_b,_z._getBoundPointS(_g[0],_g[1],_g[2],_g[3]),_f);break;case _d._drawCircle:case _d._fillCircle:case 14:_t._addPointArrToRst(_b,_z._getBoundPointS(_g[0]-_g[2],_g[1]-_g[2],_g[2]+_g[2],_g[2]+_g[2]),_f);break;case _d._drawLine:case 20:_t._tempPoints.length=0;var _s;_s=.5*_g[5],_g[0]==_g[2]?_t._tempPoints.push(_g[0]+_s,_g[1],_g[2]+_s,_g[3],_g[0]-_s,_g[1],_g[2]-_s,_g[3]):_g[1]==_g[3]?_t._tempPoints.push(_g[0],_g[1]+_s,_g[2],_g[3]+_s,_g[0],_g[1]-_s,_g[2],_g[3]-_s):_t._tempPoints.push(_g[0],_g[1],_g[2],_g[3]),_t._addPointArrToRst(_b,_t._tempPoints,_f);break;case _d._drawCurves:case 22:_t._addPointArrToRst(_b,_u.I.getBezierPoints(_g[2]),_f,_g[0],_g[1]);break;case _d._drawPoly:case _d._drawLines:case 18:_t._addPointArrToRst(_b,_g[2],_f,_g[0],_g[1]);break;case _d._drawPath:case 19:_t._addPointArrToRst(_b,this._getPathPoints(_g[2]),_f,_g[0],_g[1]);break;case _d._drawPie:case 15:_t._addPointArrToRst(_b,this._getPiePoints(_g[0],_g[1],_g[2],_g[3],_g[4]),_f)}return 200<_b.length?_b=_Y.copyArray(_b,_z._getWrapRec(_b)._getBoundPoints()):8<_b.length&&(_b=_v.scanPList(_b)),_b},_a._switchMatrix=function(_a,_b){_b.concat(_a),_b.copyTo(_a)},_a._getPiePoints=function(_a,_b,_c,_d,_e){var _f=_t._tempPoints;_t._tempPoints.length=0,_f.push(_a,_b);var _g=(_e-_d)%(2*Math.PI)/10,_h=NaN,_i=_d;for(_h=0;_h<=10;_h++)_f.push(_a+_c*Math.cos(_i),_b+_c*Math.sin(_i)),_i+=_g;return _f},_a._getPathPoints=function(_a){var _b,_c,_d=0,_e=_t._tempPoints;for(_e.length=0,_b=_a.length,_d=0;_d<_b;_d++)1<(_c=_a[_d]).length&&(_e.push(_c[1],_c[2]),3<_c.length&&_e.push(_c[3],_c[4]));return _e},_t._addPointArrToRst=function(_a,_b,_c,_d,_e){void 0===_d&&(_d=0),void 0===_e&&(_e=0);var _f,_g=0;for(_f=_b.length,_g=0;_g<_f;_g+=2)_t._addPointToRst(_a,_b[_g]+_d,_b[_g+1]+_e,_c)},_t._addPointToRst=function(_a,_b,_c,_d){var _e=_y.TEMP;_e.setTo(_b||0,_c||0),_d.transformPoint(_e),_a.push(_e.x,_e.y)},_t._tempPoints=[],_t._tempMatrixArrays=[],_t._tempCmds=[],_i(_t,["_tempMatrix",function(){return this._tempMatrix=new _E},"_initMatrix",function(){return this._initMatrix=new _E}]),_t}(),_f=function(){function _a(){}_p(_a,"laya.events.Event");var _b=_a.prototype;return _b.setTo=function(_a,_b,_c){return this.type=_a,this.currentTarget=_b,this.target=_c,this},_b.stopPropagation=function(){this._stoped=!0},_k(0,_b,"stageY",function(){return _x.stage.mouseY}),_k(0,_b,"charCode",function(){return this.nativeEvent.charCode}),_k(0,_b,"touches",function(){var _a=this.nativeEvent.touches;if(_a)for(var _b=_x.stage,_c=0,_d=_a.length;_c<_d;_c++){var _e=_a[_c],_f=_y.TEMP;_f.setTo(_e.clientX,_e.clientY),_b._canvasTransform.invertTransformPoint(_f),_b.transform.invertTransformPoint(_f),_e.stageX=_f.x,_e.stageY=_f.y}return _a}),_k(0,_b,"keyLocation",function(){return this.nativeEvent.keyLocation}),_k(0,_b,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),_k(0,_b,"altKey",function(){return this.nativeEvent.altKey}),_k(0,_b,"shiftKey",function(){return this.nativeEvent.shiftKey}),_k(0,_b,"stageX",function(){return _x.stage.mouseX}),_a.EMPTY=new _a,_a.MOUSE_DOWN="mousedown",_a.MOUSE_UP="mouseup",_a.CLICK="click",_a.RIGHT_MOUSE_DOWN="rightmousedown",_a.RIGHT_MOUSE_UP="rightmouseup",_a.RIGHT_CLICK="rightclick",_a.MOUSE_MOVE="mousemove",_a.MOUSE_OVER="mouseover",_a.MOUSE_OUT="mouseout",_a.MOUSE_WHEEL="mousewheel",_a.ROLL_OVER="mouseover",_a.ROLL_OUT="mouseout",_a.DOUBLE_CLICK="doubleclick",_a.CHANGE="change",_a.CHANGED="changed",_a.RESIZE="resize",_a.ADDED="added",_a.REMOVED="removed",_a.DISPLAY="display",_a.UNDISPLAY="undisplay",_a.ERROR="error",_a.COMPLETE="complete",_a.LOADED="loaded",_a.INITED="inited",_a.PROGRESS="progress",_a.INPUT="input",_a.RENDER="render",_a.OPEN="open",_a.MESSAGE="message",_a.CLOSE="close",_a.KEY_DOWN="keydown",_a.KEY_PRESS="keypress",_a.KEY_UP="keyup",_a.FRAME="enterframe",_a.DRAG_START="dragstart",_a.DRAG_MOVE="dragmove",_a.DRAG_END="dragend",_a.ENTER="enter",_a.SELECT="select",_a.BLUR="blur",_a.FOCUS="focus",_a.VISIBILITY_CHANGE="visibilitychange",_a.FOCUS_CHANGE="focuschange",_a.PLAYED="played",_a.PAUSED="paused",_a.STOPPED="stopped",_a.START="start",_a.END="end",_a.ENABLE_CHANGED="enablechanged",_a.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",_a.COMPONENT_ADDED="componentadded",_a.COMPONENT_REMOVED="componentremoved",_a.LAYER_CHANGED="layerchanged",_a.HIERARCHY_LOADED="hierarchyloaded",_a.RECOVERED="recovered",_a.RELEASED="released",_a.LINK="link",_a.LABEL="label",_a.FULL_SCREEN_CHANGE="fullscreenchange",_a.DEVICE_LOST="devicelost",_a.MESH_CHANGED="meshchanged",_a.MATERIAL_CHANGED="materialchanged",_a.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",_a.ANIMATION_CHANGED="animationchanged",_a.TRIGGER_ENTER="triggerenter",_a.TRIGGER_STAY="triggerstay",_a.TRIGGER_EXIT="triggerexit",_a.TRAIL_FILTER_CHANGE="trailfilterchange",_a.DOMINO_FILTER_CHANGE="dominofilterchange",_a}(),_l=(function(){function _a(){}_p(_a,"laya.events.Keyboard"),_a.NUMBER_0=48,_a.NUMBER_1=49,_a.NUMBER_2=50,_a.NUMBER_3=51,_a.NUMBER_4=52,_a.NUMBER_5=53,_a.NUMBER_6=54,_a.NUMBER_7=55,_a.NUMBER_8=56,_a.NUMBER_9=57,_a.A=65,_a.B=66,_a.C=67,_a.D=68,_a.E=69,_a.F=70,_a.G=71,_a.H=72,_a.I=73,_a.J=74,_a.K=75,_a.L=76,_a.M=77,_a.N=78,_a.O=79,_a.P=80,_a.Q=81,_a.R=82,_a.S=83,_a.T=84,_a.U=85,_a.V=86,_a.W=87,_a.X=88,_a.Y=89,_a.Z=90,_a.F1=112,_a.F2=113,_a.F3=114,_a.F4=115,_a.F5=116,_a.F6=117,_a.F7=118,_a.F8=119,_a.F9=120,_a.F10=121,_a.F11=122,_a.F12=123,_a.F13=124,_a.F14=125,_a.F15=126,_a.NUMPAD=21,_a.NUMPAD_0=96,_a.NUMPAD_1=97,_a.NUMPAD_2=98,_a.NUMPAD_3=99,_a.NUMPAD_4=100,_a.NUMPAD_5=101,_a.NUMPAD_6=102,_a.NUMPAD_7=103,_a.NUMPAD_8=104,_a.NUMPAD_9=105,_a.NUMPAD_ADD=107,_a.NUMPAD_DECIMAL=110,_a.NUMPAD_DIVIDE=111,_a.NUMPAD_ENTER=108,_a.NUMPAD_MULTIPLY=106,_a.NUMPAD_SUBTRACT=109,_a.SEMICOLON=186,_a.EQUAL=187,_a.COMMA=188,_a.MINUS=189,_a.PERIOD=190,_a.SLASH=191,_a.BACKQUOTE=192,_a.LEFTBRACKET=219,_a.BACKSLASH=220,_a.RIGHTBRACKET=221,_a.QUOTE=222,_a.ALTERNATE=18,_a.BACKSPACE=8,_a.CAPS_LOCK=20,_a.COMMAND=15,_a.CONTROL=17,_a.DELETE=46,_a.ENTER=13,_a.ESCAPE=27,_a.PAGE_UP=33,_a.PAGE_DOWN=34,_a.END=35,_a.HOME=36,_a.LEFT=37,_a.UP=38,_a.RIGHT=39,_a.DOWN=40,_a.SHIFT=16,_a.SPACE=32,_a.TAB=9,_a.INSERT=45}(),function(){function _e(){}return _p(_e,"laya.events.KeyBoardManager"),_e.__init__=function(){_e._addEvent("keydown"),_e._addEvent("keypress"),_e._addEvent("keyup")},_e._addEvent=function(_b){_M.document.addEventListener(_b,function(_a){laya.events.KeyBoardManager._dispatch(_a,_b)},!0)},_e._dispatch=function(_a,_b){if(_e.enabled){_e._event._stoped=!1,_e._event.nativeEvent=_a,_e._event.keyCode=_a.keyCode||_a.which||_a.charCode,"keydown"===_b?_e._pressKeys[_e._event.keyCode]=!0:"keyup"===_b&&(_e._pressKeys[_e._event.keyCode]=null);for(var _c=_x.stage.focus&&null!=_x.stage.focus.event&&_x.stage.focus.displayedInStage?_x.stage.focus:_x.stage,_d=_c;_d;)_d.event(_b,_e._event.setTo(_b,_d,_c)),_d=_d.parent}},_e.hasKeyDown=function(_a){return _e._pressKeys[_a]},_e._pressKeys={},_e.enabled=!0,_i(_e,["_event",function(){return this._event=new _f}]),_e}()),_o=(function(){function _a(){}_p(_a,"laya.events.KeyLocation"),_a.STANDARD=0,_a.LEFT=1,_a.RIGHT=2,_a.NUM_PAD=3}(),function(){function _k(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseEventTime=_M.now(),this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new _f,this._matrix=new _E,this._point=new _y,this._rect=new _z,this._prePoint=new _y,this._curTouchID=NaN}_p(_k,"laya.events.MouseManager");var _a=_k.prototype;return _a.__init__=function(_a,_b){var _c=this;this._stage=_a;var _d=this,_e=this._eventList;_b.oncontextmenu=function(_a){if(_k.enabled)return!1},_b.addEventListener("mousedown",function(_a){_k.enabled&&(_M.onIE||_a.preventDefault(),_e.push(_a),_d.mouseDownTime=_M.now())}),_b.addEventListener("mouseup",function(_a){_k.enabled&&(_a.preventDefault(),_e.push(_a),_d.mouseDownTime=-_M.now())},!0),_b.addEventListener("mousemove",function(_a){if(_k.enabled){_a.preventDefault();var _b=_M.now();if(_b-_d._lastMoveTimer<10)return;_d._lastMoveTimer=_b,_e.push(_a)}},!0),_b.addEventListener("mouseout",function(_a){_k.enabled&&_e.push(_a)}),_b.addEventListener("mouseover",function(_a){_k.enabled&&_e.push(_a)}),_b.addEventListener("touchstart",function(_a){_k.enabled&&(_e.push(_a),_k._isFirstTouch||_va.isInputting||_a.preventDefault(),_d.mouseDownTime=_M.now())}),_b.addEventListener("touchend",function(_a){_k.enabled?(_k._isFirstTouch||_va.isInputting||_a.preventDefault(),_k._isFirstTouch=!1,_e.push(_a),_d.mouseDownTime=-_M.now()):_c._curTouchID=NaN},!0),_b.addEventListener("touchmove",function(_a){_k.enabled&&(_a.preventDefault(),_e.push(_a))},!0),_b.addEventListener("touchcancel",function(_a){_k.enabled?(_a.preventDefault(),_e.push(_a)):_c._curTouchID=NaN},!0),_b.addEventListener("mousewheel",function(_a){_k.enabled&&_e.push(_a)}),_b.addEventListener("DOMMouseScroll",function(_a){_k.enabled&&_e.push(_a)})},_a.initEvent=function(_a,_b){var _c;this._event._stoped=!1,this._event.nativeEvent=_b||_a,this._target=null,this._point.setTo(_a.pageX||_a.clientX,_a.pageY||_a.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y,this._event.touchId=_a.identifier||0,this._tTouchID=this._event.touchId,(_c=_q.I._event)._stoped=!1,_c.nativeEvent=this._event.nativeEvent,_c.touchId=this._event.touchId},_a.checkMouseWheel=function(_a){this._event.delta=_a.wheelDelta?.025*_a.wheelDelta:-_a.detail;for(var _b=_q.I.getLastOvers(),_c=0,_d=_b.length;_c<_d;_c++){var _e=_b[_c];_e.event("mousewheel",this._event.setTo("mousewheel",_e,this._target))}},_a.onMouseMove=function(_a){_q.I.onMouseMove(_a,this._tTouchID)},_a.onMouseDown=function(_a){if(_va.isInputting&&_x.stage.focus&&_x.stage.focus.focus&&!_x.stage.focus.contains(this._target)){var _b=_x.stage.focus._tf||_x.stage.focus,_c=_a._tf||_a;_c instanceof laya.display.Input&&_c.multiline==_b.multiline?_b._focusOut():_b.focus=!1}_q.I.onMouseDown(_a,this._tTouchID,this._isLeftMouse)},_a.onMouseUp=function(_a){_q.I.onMouseUp(_a,this._tTouchID,this._isLeftMouse)},_a.check=function(_a,_b,_c,_d){this._point.setTo(_b,_c),_a.fromParentPoint(this._point),_b=this._point.x,_c=this._point.y;var _e=_a.scrollRect;if(_e&&(this._rect.setTo(_e.x,_e.y,_e.width,_e.height),!this._rect.contains(_b,_c)))return!1;if(!this.disableMouseEvent){if(_a.hitTestPrior&&!_a.mouseThrough&&!this.hitTest(_a,_b,_c))return!1;for(var _f=_a._childs.length-1;-1<_f;_f--){var _g=_a._childs[_f];if(!_g.destroyed&&_g.mouseEnabled&&_g.visible&&this.check(_g,_b,_c,_d))return!0}}var _h=!(!_a.hitTestPrior||_a.mouseThrough||this.disableMouseEvent)||this.hitTest(_a,_b,_c);return _h?(this._target=_a,_d.call(this,_a)):_d===this.onMouseUp&&_a===this._stage&&(this._target=this._stage,_d.call(this,this._target)),_h},_a.hitTest=function(_a,_b,_c){var _d=!1;if(_a.scrollRect&&(_b-=_a.scrollRect.x,_c-=_a.scrollRect.y),_a.hitArea instanceof laya.utils.HitArea)return _a.hitArea.isHit(_b,_c);if(0<_a.width&&0<_a.height||_a.mouseThrough||_a.hitArea)if(_a.mouseThrough)_d=_a.getGraphicBounds().contains(_b,_c);else{var _e=this._rect;_a.hitArea?_e=_a.hitArea:_e.setTo(0,0,_a.width,_a.height),_d=_e.contains(_b,_c)}return _d},_a.runEvent=function(){var _a=this._eventList.length;if(_a){var _b=this;_b.mouseEventTime=_M.now();var _c,_d=0,_e=0,_f=0;try{for(;_d<_a;){var _g=this._eventList[_d];switch("mousemove"!==_g.type&&(this._prePoint.x=this._prePoint.y=-1e6),_g.type){case"mousedown":this._touchIDs[0]=this._id++,_k._isTouchRespond?_k._isTouchRespond=!1:(_b._isLeftMouse=0===_g.button,_b.initEvent(_g),_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseDown));break;case"mouseup":_b._isLeftMouse=0===_g.button,_b.initEvent(_g),_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-_g.clientX)+Math.abs(this._prePoint.y-_g.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=_g.clientX,this._prePoint.y=_g.clientY,_b.initEvent(_g),_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseMove));break;case"touchstart":_k._isTouchRespond=!0,_b._isLeftMouse=!0;var _h=_g.changedTouches;for(_e=0,_f=_h.length;_e<_f;_e++)_c=_h[_e],(_k.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=_c.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[_c.identifier]=this._id++,_b.initEvent(_c,_g),_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseDown));break;case"touchend":case"touchcancel":_k._isTouchRespond=!0,_b._isLeftMouse=!0;var _i=_g.changedTouches;for(_e=0,_f=_i.length;_e<_f;_e++)if(_c=_i[_e],_k.multiTouchEnabled||_c.identifier==this._curTouchID){this._curTouchID=NaN,_b.initEvent(_c,_g);_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseUp)||_b.onMouseUp(null)}break;case"touchmove":var _j=_g.changedTouches;for(_e=0,_f=_j.length;_e<_f;_e++)_c=_j[_e],(_k.multiTouchEnabled||_c.identifier==this._curTouchID)&&(_b.initEvent(_c,_g),_b.check(_b._stage,_b.mouseX,_b.mouseY,_b.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":_b.checkMouseWheel(_g);break;case"mouseout":_q.I.stageMouseOut();break;case"mouseover":_b._stage.event("mouseover",_b._event.setTo("mouseover",_b._stage,_b._stage))}_d++}}catch(_a){throw this._eventList.length=0,_a}this._eventList.length=0}},_k.enabled=!0,_k.multiTouchEnabled=!0,_k._isTouchRespond=!1,_k._isFirstTouch=!0,_i(_k,["instance",function(){return this.instance=new _k}]),_k}()),_q=function(){function _o(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new _f}_p(_o,"laya.events.TouchManager");var _a=_o.prototype;return _a._clearTempArrs=function(){_o._oldArr.length=0,_o._newArr.length=0,_o._tEleArr.length=0},_a.getTouchFromArr=function(_a,_b){var _c,_d,_e=0;for(_c=_b.length,_e=0;_e<_c;_e++)if((_d=_b[_e]).id==_a)return _d;return null},_a.removeTouchFromArr=function(_a,_b){var _c=0;for(_c=_b.length-1;0<=_c;_c--)_b[_c].id==_a&&_b.splice(_c,1)},_a.createTouchO=function(_a,_b){var _c;return(_c=_U.getItem("TouchData")||{}).id=_b,_c.tar=_a,_c},_a.onMouseDown=function(_a,_b,_c){var _d,_e,_f,_g;(void 0===_c&&(_c=!1),this.enable)&&(_d=this.getTouchFromArr(_b,this.preOvers),_f=this.getEles(_a,null,_o._tEleArr),_d?_d.tar=_a:(_e=this.createTouchO(_a,_b),this.preOvers.push(_e)),_M.onMobile&&this.sendEvents(_f,"mouseover",_b),_g=_c?this.preDowns:this.preRightDowns,(_d=this.getTouchFromArr(_b,_g))?_d.tar=_a:(_e=this.createTouchO(_a,_b),_g.push(_e)),this.sendEvents(_f,_c?"mousedown":"rightmousedown",_b),this._clearTempArrs())},_a.sendEvents=function(_a,_b,_c){void 0===_c&&(_c=0);var _d,_e,_f,_g=0;for(_d=_a.length,this._event._stoped=!1,_e=_a[0],_g=0;_g<_d;_g++){if((_f=_a[_g]).destroyed)return;if(_f.event(_b,this._event.setTo(_b,_f,_e)),this._event._stoped)break}},_a.getEles=function(_a,_b,_c){for(_c?_c.length=0:_c=[];_a&&_a!=_b;)_c.push(_a),_a=_a.parent;return _c},_a.checkMouseOutAndOverOfMove=function(_a,_b,_c){if(void 0===_c&&(_c=0),_b!=_a){var _d,_e,_f=0,_g=0;if(_b.contains(_a))_e=this.getEles(_a,_b,_o._tEleArr),this.sendEvents(_e,"mouseover",_c);else if(_a.contains(_b))_e=this.getEles(_b,_a,_o._tEleArr),this.sendEvents(_e,"mouseout",_c);else{var _h,_i;(_e=_o._tEleArr).length=0,_h=this.getEles(_b,null,_o._oldArr),_i=this.getEles(_a,null,_o._newArr),_g=_h.length;var _j=0;for(_f=0;_f<_g;_f++){if(_d=_h[_f],0<=(_j=_i.indexOf(_d))){_i.splice(_j,_i.length-_j);break}_e.push(_d)}0<_e.length&&this.sendEvents(_e,"mouseout",_c),0<_i.length&&this.sendEvents(_i,"mouseover",_c)}}},_a.onMouseMove=function(_a,_b){var _c,_d;this.enable&&((_c=this.getTouchFromArr(_b,this.preOvers))?(this.checkMouseOutAndOverOfMove(_a,_c.tar),_c.tar=_a,_d=this.getEles(_a,null,_o._tEleArr)):(_d=this.getEles(_a,null,_o._tEleArr),this.sendEvents(_d,"mouseover",_b),this.preOvers.push(this.createTouchO(_a,_b))),this.sendEvents(_d,"mousemove",_b),this._clearTempArrs())},_a.getLastOvers=function(){return(_o._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,_o._tEleArr):(_o._tEleArr.push(_x.stage),_o._tEleArr)},_a.stageMouseOut=function(){var _a;_a=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(_a,"mouseout",0)},_a.onMouseUp=function(_a,_b,_c){if(void 0===_c&&(_c=!1),this.enable){var _d,_e,_f,_g,_h,_i,_j=0,_k=0,_l=_M.onMobile;if(_e=this.getEles(_a,null,_o._tEleArr),this.sendEvents(_e,_c?"mouseup":"rightmouseup",_b),_i=_c?this.preDowns:this.preRightDowns,_d=this.getTouchFromArr(_b,_i)){var _m,_n=_M.now();if(_m=_n-this._lastClickTime<300,this._lastClickTime=_n,_a==_d.tar)_h=_e;else for(_f=this.getEles(_d.tar,null,_o._oldArr),(_h=_o._newArr).length=0,_k=_f.length,_j=0;_j<_k;_j++)_g=_f[_j],0<=_e.indexOf(_g)&&_h.push(_g);0<_h.length&&this.sendEvents(_h,_c?"click":"rightclick",_b),_c&&_m&&this.sendEvents(_h,"doubleclick",_b),this.removeTouchFromArr(_b,_i),_d.tar=null,_U.recover("TouchData",_d)}else;(_d=this.getTouchFromArr(_b,this.preOvers))&&_l&&((_h=this.getEles(_d.tar,null,_h))&&0<_h.length&&this.sendEvents(_h,"mouseout",_b),this.removeTouchFromArr(_b,this.preOvers),_d.tar=null,_U.recover("TouchData",_d)),this._clearTempArrs()}},_o._oldArr=[],_o._newArr=[],_o._tEleArr=[],_i(_o,["I",function(){return this.I=new _o}]),_o}(),_r=function(){function _a(){this._action=null}_p(_a,"laya.filters.Filter");var _b=_a.prototype;return _x.imps(_b,{"laya.filters.IFilter":!0}),_b.callNative=function(_a){},_k(0,_b,"type",function(){return-1}),_k(0,_b,"action",function(){return this._action}),_a.BLUR=16,_a.COLOR=32,_a.GLOW=8,_a._filterStart=null,_a._filterEnd=null,_a._EndTarget=null,_a._recycleScope=null,_a._filter=null,_a._useSrc=null,_a._endSrc=null,_a._useOut=null,_a._endOut=null,_a}(),_t=function(){function _a(){this.data=null}_p(_a,"laya.filters.ColorFilterAction");var _b=_a.prototype;return _x.imps(_b,{"laya.filters.IFilterAction":!0}),_b.apply=function(_a){var _b=_a.ctx.ctx,_c=_a.ctx.ctx.canvas;if(0==_c.width||0==_c.height)return _c;for(var _d,_e=_b.getImageData(0,0,_c.width,_c.height),_f=_e.data,_g=0,_h=_f.length;_g<_h;_g+=4)_d=this.getColor(_f[_g],_f[_g+1],_f[_g+2],_f[_g+3]),0!=_f[_g+3]&&(_f[_g]=_d[0],_f[_g+1]=_d[1],_f[_g+2]=_d[2],_f[_g+3]=_d[3]);return _b.putImageData(_e,0,0),_a},_b.getColor=function(_a,_b,_c,_d){var _e=[];if(this.data._mat&&this.data._alpha){var _f=this.data._mat,_g=this.data._alpha;_e[0]=_f[0]*_a+_f[1]*_b+_f[2]*_c+_f[3]*_d+_g[0],_e[1]=_f[4]*_a+_f[5]*_b+_f[6]*_c+_f[7]*_d+_g[1],_e[2]=_f[8]*_a+_f[9]*_b+_f[10]*_c+_f[11]*_d+_g[2],_e[3]=_f[12]*_a+_f[13]*_b+_f[14]*_c+_f[15]*_d+_g[3]}return _e},_a}(),_u=(function(){function _a(){}_p(_a,"laya.maths.Arith"),_a.formatR=function(_a){return _a>Math.PI&&(_a-=2*Math.PI),_a<-Math.PI&&(_a+=2*Math.PI),_a},_a.isPOT=function(_a,_b){return 0<_a&&0==(_a&_a-1)&&0<_b&&0==(_b&_b-1)},_a.setMatToArray=function(_a,_b){_a.a,_a.b,_a.c,_a.d,_a.tx,_a.ty,_b[0]=_a.a,_b[1]=_a.b,_b[4]=_a.c,_b[5]=_a.d,_b[12]=_a.tx,_b[13]=_a.ty}}(),function(){function _a(){this._controlPoints=[new _y,new _y,new _y],this._calFun=this.getPoint2}_p(_a,"laya.maths.Bezier");var _b=_a.prototype;return _b._switchPoint=function(_a,_b){var _c=this._controlPoints.shift();_c.setTo(_a,_b),this._controlPoints.push(_c)},_b.getPoint2=function(_a,_b){var _c=this._controlPoints[0],_d=this._controlPoints[1],_e=this._controlPoints[2],_f=Math.pow(1-_a,2)*_c.x+2*_a*(1-_a)*_d.x+Math.pow(_a,2)*_e.x,_g=Math.pow(1-_a,2)*_c.y+2*_a*(1-_a)*_d.y+Math.pow(_a,2)*_e.y;_b.push(_f,_g)},_b.getPoint3=function(_a,_b){var _c=this._controlPoints[0],_d=this._controlPoints[1],_e=this._controlPoints[2],_f=this._controlPoints[3],_g=Math.pow(1-_a,3)*_c.x+3*_d.x*_a*(1-_a)*(1-_a)+3*_e.x*_a*_a*(1-_a)+_f.x*Math.pow(_a,3),_h=Math.pow(1-_a,3)*_c.y+3*_d.y*_a*(1-_a)*(1-_a)+3*_e.y*_a*_a*(1-_a)+_f.y*Math.pow(_a,3);_b.push(_g,_h)},_b.insertPoints=function(_a,_b){var _c,_d=NaN;for(_c=1/(_a=0<_a?_a:5),_d=0;_d<=1;_d+=_c)this._calFun(_d,_b)},_b.getBezierPoints=function(_a,_b,_c){void 0===_b&&(_b=5),void 0===_c&&(_c=2);var _d,_e,_f=0;if((_d=_a.length)<2*(_c+1))return[];switch(_e=[],_c){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=_c;)this._controlPoints.push(new _y);for(_f=0;_f<2*_c;_f+=2)this._switchPoint(_a[_f],_a[_f+1]);for(_f=2*_c;_f<_d;_f+=2)this._switchPoint(_a[_f],_a[_f+1]),_f/2%_c==0&&this.insertPoints(_b,_e);return _e},_i(_a,["I",function(){return this.I=new _a}]),_a}()),_v=function(){function _j(){}return _p(_j,"laya.maths.GrahamScan"),_j.multiply=function(_a,_b,_c){return(_a.x-_c.x)*(_b.y-_c.y)-(_b.x-_c.x)*(_a.y-_c.y)},_j.dis=function(_a,_b){return(_a.x-_b.x)*(_a.x-_b.x)+(_a.y-_b.y)*(_a.y-_b.y)},_j._getPoints=function(_a,_b,_c){for(void 0===_b&&(_b=!1),_j._mPointList||(_j._mPointList=[]);_j._mPointList.length<_a;)_j._mPointList.push(new _y);return _c||(_c=[]),_c.length=0,_b?_j.getFrom(_c,_j._mPointList,_a):_j.getFromR(_c,_j._mPointList,_a),_c},_j.getFrom=function(_a,_b,_c){var _d=0;for(_d=0;_d<_c;_d++)_a.push(_b[_d]);return _a},_j.getFromR=function(_a,_b,_c){var _d=0;for(_d=0;_d<_c;_d++)_a.push(_b.pop());return _a},_j.pListToPointList=function(_a,_b){void 0===_b&&(_b=!1);var _c=0,_d=_a.length/2,_e=_j._getPoints(_d,_b,_j._tempPointList);for(_c=0;_c<_d;_c++)_e[_c].setTo(_a[_c+_c],_a[_c+_c+1]);return _e},_j.pointListToPlist=function(_a){var _b,_c=0,_d=_a.length,_e=_j._temPList;for(_c=_e.length=0;_c<_d;_c++)_b=_a[_c],_e.push(_b.x,_b.y);return _e},_j.scanPList=function(_a){return _Y.copyArray(_a,_j.pointListToPlist(_j.scan(_j.pListToPointList(_a,!0))))},_j.scan=function(_a){var _b,_c,_d,_e=0,_f=0,_g=0,_h=_a.length,_i={};for((_c=_j._temArr).length=0,_e=(_h=_a.length)-1;0<=_e;_e--)_d=(_b=_a[_e]).x+"_"+_b.y,_i.hasOwnProperty(_d)||(_i[_d]=!0,_c.push(_b));for(_h=_c.length,_Y.copyArray(_a,_c),_e=1;_e<_h;_e++)(_a[_e].y<_a[_g].y||_a[_e].y==_a[_g].y&&_a[_e].x<_a[_g].x)&&(_g=_e);for(_b=_a[0],_a[0]=_a[_g],_a[_g]=_b,_e=1;_e<_h-1;_e++){for(_f=(_g=_e)+1;_f<_h;_f++)(0<_j.multiply(_a[_f],_a[_g],_a[0])||0==_j.multiply(_a[_f],_a[_g],_a[0])&&_j.dis(_a[0],_a[_f])<_j.dis(_a[0],_a[_g]))&&(_g=_f);_b=_a[_e],_a[_e]=_a[_g],_a[_g]=_b}if((_c=_j._temArr).length=0,_a.length<3)return _Y.copyArray(_c,_a);for(_c.push(_a[0],_a[1],_a[2]),_e=3;_e<_h;_e++){for(;2<=_c.length&&0<=_j.multiply(_a[_e],_c[_c.length-1],_c[_c.length-2]);)_c.pop();_a[_e]&&_c.push(_a[_e])}return _c},_j._mPointList=null,_j._tempPointList=[],_j._temPList=[],_j._temArr=[],_j}(),_w=function(){function _e(){}return _p(_e,"laya.maths.MathUtil"),_e.subtractVector3=function(_a,_b,_c){_c[0]=_a[0]-_b[0],_c[1]=_a[1]-_b[1],_c[2]=_a[2]-_b[2]},_e.lerp=function(_a,_b,_c){return _a*(1-_c)+_b*_c},_e.scaleVector3=function(_a,_b,_c){_c[0]=_a[0]*_b,_c[1]=_a[1]*_b,_c[2]=_a[2]*_b},_e.lerpVector3=function(_a,_b,_c,_d){var _e=_a[0],_f=_a[1],_g=_a[2];_d[0]=_e+_c*(_b[0]-_e),_d[1]=_f+_c*(_b[1]-_f),_d[2]=_g+_c*(_b[2]-_g)},_e.lerpVector4=function(_a,_b,_c,_d){var _e=_a[0],_f=_a[1],_g=_a[2],_h=_a[3];_d[0]=_e+_c*(_b[0]-_e),_d[1]=_f+_c*(_b[1]-_f),_d[2]=_g+_c*(_b[2]-_g),_d[3]=_h+_c*(_b[3]-_h)},_e.slerpQuaternionArray=function(_a,_b,_c,_d,_e,_f,_g){var _h,_i,_j,_k,_l,_m=_a[_b+0],_n=_a[_b+1],_o=_a[_b+2],_p=_a[_b+3],_q=_c[_d+0],_r=_c[_d+1],_s=_c[_d+2],_t=_c[_d+3];return(_i=_m*_q+_n*_r+_o*_s+_p*_t)<0&&(_i=-_i,_q=-_q,_r=-_r,_s=-_s,_t=-_t),_l=1e-6<1-_i?(_h=Math.acos(_i),_j=Math.sin(_h),_k=Math.sin((1-_e)*_h)/_j,Math.sin(_e*_h)/_j):(_k=1-_e,_e),_f[_g+0]=_k*_m+_l*_q,_f[_g+1]=_k*_n+_l*_r,_f[_g+2]=_k*_o+_l*_s,_f[_g+3]=_k*_p+_l*_t,_f},_e.getRotation=function(_a,_b,_c,_d){return Math.atan2(_d-_b,_c-_a)/Math.PI*180},_e.sortBigFirst=function(_a,_b){return _a==_b?0:_a<_b?1:-1},_e.sortSmallFirst=function(_a,_b){return _a==_b?0:_a<_b?-1:1},_e.sortNumBigFirst=function(_a,_b){return parseFloat(_b)-parseFloat(_a)},_e.sortNumSmallFirst=function(_a,_b){return parseFloat(_a)-parseFloat(_b)},_e.sortByKey=function(_c,_a,_b){var _d;return void 0===_a&&(_a=!1),void 0===_b&&(_b=!0),_d=_a?_b?_e.sortNumBigFirst:_e.sortBigFirst:_b?_e.sortNumSmallFirst:_e.sortSmallFirst,function(_a,_b){return _d(_a[_c],_b[_c])}},_e}(),_E=function(){function _c(_a,_b,_c,_d,_e,_f){this.inPool=!1,this.bTransform=!1,void 0===_a&&(_a=1),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=1),void 0===_e&&(_e=0),void 0===_f&&(_f=0),this.a=_a,this.b=_b,this.c=_c,this.d=_d,this.tx=_e,this.ty=_f,this._checkTransform()}_p(_c,"laya.maths.Matrix");var _a=_c.prototype;return _a.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},_a._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},_a.setTranslate=function(_a,_b){return this.tx=_a,this.ty=_b,this},_a.translate=function(_a,_b){return this.tx+=_a,this.ty+=_b,this},_a.scale=function(_a,_b){this.a*=_a,this.d*=_b,this.c*=_a,this.b*=_b,this.tx*=_a,this.ty*=_b,this.bTransform=!0},_a.rotate=function(_a){var _b=Math.cos(_a),_c=Math.sin(_a),_d=this.a,_e=this.c,_f=this.tx;this.a=_d*_b-this.b*_c,this.b=_d*_c+this.b*_b,this.c=_e*_b-this.d*_c,this.d=_e*_c+this.d*_b,this.tx=_f*_b-this.ty*_c,this.ty=_f*_c+this.ty*_b,this.bTransform=!0},_a.skew=function(_a,_b){var _c=Math.tan(_a),_d=Math.tan(_b),_e=this.a,_f=this.b;return this.a+=_d*this.c,this.b+=_d*this.d,this.c+=_c*_e,this.d+=_c*_f,this},_a.invertTransformPoint=function(_a){var _b=this.a,_c=this.b,_d=this.c,_e=this.d,_f=this.tx,_g=_b*_e-_c*_d,_h=_e/_g,_i=-_c/_g,_j=-_d/_g,_k=_b/_g,_l=(_d*this.ty-_e*_f)/_g,_m=-(_b*this.ty-_c*_f)/_g;return _a.setTo(_h*_a.x+_j*_a.y+_l,_i*_a.x+_k*_a.y+_m)},_a.transformPoint=function(_a){return _a.setTo(this.a*_a.x+this.c*_a.y+this.tx,this.b*_a.x+this.d*_a.y+this.ty)},_a.transformPointN=function(_a){return _a.setTo(this.a*_a.x+this.c*_a.y,this.b*_a.x+this.d*_a.y)},_a.transformPointArray=function(_a,_b){for(var _c=_a.length,_d=0;_d<_c;_d+=2){var _e=_a[_d],_f=_a[_d+1];_b[_d]=this.a*_e+this.c*_f+this.tx,_b[_d+1]=this.b*_e+this.d*_f+this.ty}return _b},_a.transformPointArrayScale=function(_a,_b){for(var _c=_a.length,_d=0;_d<_c;_d+=2){var _e=_a[_d],_f=_a[_d+1];_b[_d]=this.a*_e+this.c*_f,_b[_d+1]=this.b*_e+this.d*_f}return _b},_a.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},_a.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},_a.invert=function(){var _a=this.a,_b=this.b,_c=this.c,_d=this.d,_e=this.tx,_f=_a*_d-_b*_c;return this.a=_d/_f,this.b=-_b/_f,this.c=-_c/_f,this.d=_a/_f,this.tx=(_c*this.ty-_d*_e)/_f,this.ty=-(_a*this.ty-_b*_e)/_f,this},_a.setTo=function(_a,_b,_c,_d,_e,_f){return this.a=_a,this.b=_b,this.c=_c,this.d=_d,this.tx=_e,this.ty=_f,this},_a.concat=function(_a){var _b=this.a,_c=this.c,_d=this.tx;return this.a=_b*_a.a+this.b*_a.c,this.b=_b*_a.b+this.b*_a.d,this.c=_c*_a.a+this.d*_a.c,this.d=_c*_a.b+this.d*_a.d,this.tx=_d*_a.a+this.ty*_a.c+_a.tx,this.ty=_d*_a.b+this.ty*_a.d+_a.ty,this},_a.scaleEx=function(_a,_b){var _c=this.a,_d=this.b,_e=this.c,_f=this.d;0!==_d||0!==_e?(this.a=_a*_c,this.b=_a*_d,this.c=_b*_e):(this.a=_a*_c,this.b=0*_f,this.c=0*_c),this.d=_b*_f,this.bTransform=!0},_a.rotateEx=function(_a){var _b=Math.cos(_a),_c=Math.sin(_a),_d=this.a,_e=this.b,_f=this.c,_g=this.d;0!==_e||0!==_f?(this.a=_b*_d+_c*_f,this.b=_b*_e+_c*_g,this.c=-_c*_d+_b*_f,this.d=-_c*_e+_b*_g):(this.a=_b*_d,this.b=_c*_g,this.c=-_c*_d,this.d=_b*_g),this.bTransform=!0},_a.clone=function(){var _a=_c.create();return _a.a=this.a,_a.b=this.b,_a.c=this.c,_a.d=this.d,_a.tx=this.tx,_a.ty=this.ty,_a.bTransform=this.bTransform,_a},_a.copyTo=function(_a){return _a.a=this.a,_a.b=this.b,_a.c=this.c,_a.d=this.d,_a.tx=this.tx,_a.ty=this.ty,_a.bTransform=this.bTransform,_a},_a.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},_a.destroy=function(){if(!this.inPool){var _a=_c._cache;this.inPool=!0,_a._length||(_a._length=0),(_a[_a._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},_c.mul=function(_a,_b,_c){var _d=_a.a,_e=_a.b,_f=_a.c,_g=_a.d,_h=_a.tx,_i=_a.ty,_j=_b.a,_k=_b.b,_l=_b.c,_m=_b.d,_n=_b.tx,_o=_b.ty;return 0!==_k||0!==_l?(_c.a=_d*_j+_e*_l,_c.b=_d*_k+_e*_m,_c.c=_f*_j+_g*_l,_c.d=_f*_k+_g*_m,_c.tx=_j*_h+_l*_i+_n,_c.ty=_k*_h+_m*_i+_o):(_c.a=_d*_j,_c.b=_e*_m,_c.c=_f*_j,_c.d=_g*_m,_c.tx=_j*_h+_n,_c.ty=_m*_i+_o),_c},_c.mul16=function(_a,_b,_c){var _d=_a.a,_e=_a.b,_f=_a.c,_g=_a.d,_h=_a.tx,_i=_a.ty,_j=_b.a,_k=_b.b,_l=_b.c,_m=_b.d,_n=_b.tx,_o=_b.ty;return 0!==_k||0!==_l?(_c[0]=_d*_j+_e*_l,_c[1]=_d*_k+_e*_m,_c[4]=_f*_j+_g*_l,_c[5]=_f*_k+_g*_m,_c[12]=_j*_h+_l*_i+_n,_c[13]=_k*_h+_m*_i+_o):(_c[0]=_d*_j,_c[1]=_e*_m,_c[4]=_f*_j,_c[5]=_g*_m,_c[12]=_j*_h+_n,_c[13]=_m*_i+_o),_c},_c.mulPre=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=_a.a,_j=_a.b,_k=_a.c,_l=_a.d,_m=_a.tx,_n=_a.ty;return 0!==_c||0!==_d?(_h.a=_i*_b+_j*_d,_h.b=_i*_c+_j*_e,_h.c=_k*_b+_l*_d,_h.d=_k*_c+_l*_e,_h.tx=_b*_m+_d*_n+_f,_h.ty=_c*_m+_e*_n+_g):(_h.a=_i*_b,_h.b=_j*_e,_h.c=_k*_b,_h.d=_l*_e,_h.tx=_b*_m+_f,_h.ty=_e*_n+_g),_h},_c.mulPos=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=_a.a,_j=_a.b,_k=_a.c,_l=_a.d,_m=_a.tx,_n=_a.ty;return 0!==_j||0!==_k?(_h.a=_b*_i+_c*_k,_h.b=_b*_j+_c*_l,_h.c=_d*_i+_e*_k,_h.d=_d*_j+_e*_l,_h.tx=_i*_f+_k*_g+_m,_h.ty=_j*_f+_l*_g+_n):(_h.a=_b*_i,_h.b=_c*_l,_h.c=_d*_i,_h.d=_e*_l,_h.tx=_i*_f+_m,_h.ty=_l*_g+_n),_h},_c.preMul=function(_a,_b,_c){var _d=_a.a,_e=_a.b,_f=_a.c,_g=_a.d,_h=_b.a,_i=_b.b,_j=_b.c,_k=_b.d,_l=_b.tx,_m=_b.ty;return _c.a=_h*_d,_c.b=_c.c=0,_c.d=_k*_g,_c.tx=_l*_d+_a.tx,_c.ty=_m*_g+_a.ty,0===_i&&0===_j&&0===_e&&0===_f||(_c.a+=_i*_f,_c.d+=_j*_e,_c.b+=_h*_e+_i*_g,_c.c+=_j*_d+_k*_f,_c.tx+=_m*_f,_c.ty+=_l*_e),_c},_c.preMulXY=function(_a,_b,_c,_d){var _e=_a.a,_f=_a.b,_g=_a.c,_h=_a.d;return _d.a=_e,_d.b=_f,_d.c=_g,_d.d=_h,_d.tx=_b*_e+_a.tx+_c*_g,_d.ty=_c*_h+_a.ty+_b*_f,_d},_c.create=function(){var _a=_c._cache,_b=_a._length?_a[--_a._length]:new _c;return _b.inPool=!1,_b},_c.EMPTY=new _c,_c.TEMP=new _c,_c._cache=[],_c}(),_y=function(){function _a(_a,_b){void 0===_a&&(_a=0),void 0===_b&&(_b=0),this.x=_a,this.y=_b}_p(_a,"laya.maths.Point");var _b=_a.prototype;return _b.setTo=function(_a,_b){return this.x=_a,this.y=_b,this},_b.distance=function(_a,_b){return Math.sqrt((this.x-_a)*(this.x-_a)+(this.y-_b)*(this.y-_b))},_b.toString=function(){return this.x+","+this.y},_b.normalize=function(){var _a=Math.sqrt(this.x*this.x+this.y*this.y);if(0<_a){var _b=1/_a;this.x*=_b,this.y*=_b}},_a.TEMP=new _a,_a.EMPTY=new _a,_a}(),_z=function(){function _j(_a,_b,_c,_d){void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),this.x=_a,this.y=_b,this.width=_c,this.height=_d}_p(_j,"laya.maths.Rectangle");var _a=_j.prototype;return _a.setTo=function(_a,_b,_c,_d){return this.x=_a,this.y=_b,this.width=_c,this.height=_d,this},_a.copyFrom=function(_a){return this.x=_a.x,this.y=_a.y,this.width=_a.width,this.height=_a.height,this},_a.contains=function(_a,_b){return!(this.width<=0||this.height<=0)&&(_a>=this.x&&_a<this.right&&_b>=this.y&&_b<this.bottom)},_a.intersects=function(_a){return!(_a.x>this.x+this.width||_a.x+_a.width<this.x||_a.y>this.y+this.height||_a.y+_a.height<this.y)},_a.intersection=function(_a,_b){return this.intersects(_a)?(_b||(_b=new _j),_b.x=Math.max(this.x,_a.x),_b.y=Math.max(this.y,_a.y),_b.width=Math.min(this.right,_a.right)-_b.x,_b.height=Math.min(this.bottom,_a.bottom)-_b.y,_b):null},_a.union=function(_a,_b){return _b||(_b=new _j),this.clone(_b),_a.width<=0||_a.height<=0?_b:(_b.addPoint(_a.x,_a.y),_b.addPoint(_a.right,_a.bottom),this)},_a.clone=function(_a){return _a||(_a=new _j),_a.x=this.x,_a.y=this.y,_a.width=this.width,_a.height=this.height,_a},_a.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},_a.equals=function(_a){return!(!_a||_a.x!==this.x||_a.y!==this.y||_a.width!==this.width||_a.height!==this.height)},_a.addPoint=function(_a,_b){return this.x>_a&&(this.width+=this.x-_a,this.x=_a),this.y>_b&&(this.height+=this.y-_b,this.y=_b),this.width<_a-this.x&&(this.width=_a-this.x),this.height<_b-this.y&&(this.height=_b-this.y),this},_a._getBoundPoints=function(){var _a=_j._temB;return(_a.length=0)==this.width||0==this.height||_a.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),_a},_a.isEmpty=function(){return this.width<=0||this.height<=0},_k(0,_a,"right",function(){return this.x+this.width}),_k(0,_a,"bottom",function(){return this.y+this.height}),_j._getBoundPointS=function(_a,_b,_c,_d){var _e=_j._temA;return(_e.length=0)==_c||0==_d||_e.push(_a,_b,_a+_c,_b,_a,_b+_d,_a+_c,_b+_d),_e},_j._getWrapRec=function(_a,_b){if(!_a||_a.length<1)return _b?_b.setTo(0,0,0,0):_j.TEMP.setTo(0,0,0,0);_b=_b||new _j;var _c,_d,_e,_f,_g,_h=_a.length,_i=_y.TEMP;for(_e=_g=-(_d=_f=99999),_c=0;_c<_h;_c+=2)_i.x=_a[_c],_i.y=_a[_c+1],_d=_d<_i.x?_d:_i.x,_f=_f<_i.y?_f:_i.y,_e=_e>_i.x?_e:_i.x,_g=_g>_i.y?_g:_i.y;return _b.setTo(_d,_f,_e-_d,_g-_f)},_j.EMPTY=new _j,_j.TEMP=new _j,_j._temB=[],_j._temA=[],_j}(),_C=function(){function _i(){}return _p(_i,"laya.media.SoundManager"),_k(1,_i,"useAudioMusic",function(){return _i._useAudioMusic},function(_a){_i._useAudioMusic=_a,_i._musicClass=_a?_ca:null}),_k(1,_i,"autoStopMusic",function(){return _i._autoStopMusic},function(_a){_x.stage.off("blur",null,_i._stageOnBlur),_x.stage.off("focus",null,_i._stageOnFocus),_x.stage.off("visibilitychange",null,_i._visibilityChange),(_i._autoStopMusic=_a)&&(_x.stage.on("blur",null,_i._stageOnBlur),_x.stage.on("focus",null,_i._stageOnFocus),_x.stage.on("visibilitychange",null,_i._visibilityChange))}),_k(1,_i,"muted",function(){return _i._muted},function(_a){_a!=_i._muted&&(_a&&_i.stopAllSound(),_i.musicMuted=_a,_i._muted=_a)}),_k(1,_i,"musicMuted",function(){return _i._musicMuted},function(_a){_a!=_i._musicMuted&&(_a?(_i._tMusic&&_i._musicChannel&&!_i._musicChannel.isStopped?_i._musicChannel.pause():_i._musicChannel=null,_i._musicMuted=_a):(_i._musicMuted=_a,_i._tMusic&&_i._musicChannel&&_i._musicChannel.resume()))}),_k(1,_i,"soundMuted",function(){return _i._soundMuted},function(_a){_i._soundMuted=_a}),_i.addChannel=function(_a){0<=_i._channels.indexOf(_a)||(_i._channels.push(_a),_i.autoReleaseSound&&0!=_i._notUsedCount&&_i._notUsedUrls[_a.url]&&(delete _i._notUsedUrls[_a.url],0==--_i._notUsedCount&&_x.timer.clear(_i,_i.disposeSoundIfNotUsed)))},_i.removeChannel=function(_a){var _b=_i._channels,_c=_b.indexOf(_a);if(-1!=_c&&(_b.splice(_c,1),_i.autoReleaseSound)){var _d=_a.url,_e=_i.defaultIntervals[_d]||2e4;if(0<_e){var _f=!0;for(_c=_b.length-1;0<=_c;_c--)if(_b[_c].url==_d){_f=!1;break}_f&&(_i._notUsedUrls[_d]=Date.now()+_e,0==_i._notUsedCount++&&_x.timer.loop(1e4,_i,_i.disposeSoundIfNotUsed))}}},_i.disposeSoundIfNotUsed=function(){var _a=_i._notUsedUrls;if(0!=_i._notUsedCount){var _b=Date.now();for(var _c in _a)_b>=_a[_c]&&(delete _a[_c],--_i._notUsedCount,_i.destroySound(_c));if(0!=_i._notUsedCount)return}_x.timer.clear(_i,_i.disposeSoundIfNotUsed)},_i._visibilityChange=function(){_x.stage.isVisibility?_i._stageOnFocus():_i._stageOnBlur()},_i._stageOnBlur=function(){_i._isActive=!1,_i._musicChannel&&(_i._musicChannel.isStopped||(_i._blurPaused=!0,_i._musicChannel.pause())),_i.stopAllSound(),_x.stage.once("mousedown",null,_i._stageOnFocus)},_i._recoverWebAudio=function(){_fa.ctx&&"running"!=_fa.ctx.state&&_fa.ctx.resume&&_fa.ctx.resume()},_i._stageOnFocus=function(){if(_i._isActive=!0,_i._recoverWebAudio(),_x.stage.off("mousedown",null,_i._stageOnFocus),_i._blurPaused){var _a=_i._musicChannel;_a&&_i._music&&_a.isStopped&&(_i._blurPaused=!1,_i._music._disposed?_i.playMusic(_a.url,_a.loops,_a.startHandler,_a.completeHandler,_a.startTime):_a.audioBuffer?_a.resume():_i._music.play(_a.startTime,_a.loops,_a.startHandler,_a))}},_i.playSound=function(_a,_b,_c,_d,_e,_f){if(void 0===_b&&(_b=1),void 0===_f&&(_f=0),!_a)return null;if(_i._muted)return null;if(_i._recoverWebAudio(),_a==_i._tMusic){if(_i._musicMuted)return null}else{if(!_i._isActive)return null;if(_i._soundMuted)return null}var _g,_h=_i._pool[_a];return _e||(_e=_i._soundClass),_h||((_h=new _e).load(_a),_i._pool[_a]=_h),(_g=_h.play(_f,_b,_c))?(_a==_i._tMusic&&(_i._music=_h,_i._isActive||(_i._blurPaused=!0,_g.pause())),_g.url=_a,_g.volume=_a==_i._tMusic?_i.musicVolume:_i.soundVolume,_g.completeHandler=_d,_g):null},_i.destroySound=function(_a){var _b=_i._pool[_a];_b&&(delete _i._pool[_a],_b.dispose())},_i.playMusic=function(_a,_b,_c,_d,_e){return void 0===_b&&(_b=0),void 0===_e&&(_e=0),_i._tMusic=_a,_i._musicChannel&&_i._musicChannel.stop(),_i._musicChannel=_i.playSound(_a,_b,_c,_d,null,_e)},_i.stopSound=function(_a){for(var _b,_c=_i._channels.length-1;0<=_c;_c--)(_b=_i._channels[_c]).url==_a&&_b.stop()},_i.stopAll=function(){_i._tMusic=null;var _a=0;for(_a=_i._channels.length-1;0<=_a;_a--)_i._channels[_a].stop()},_i.stopAllSound=function(){var _a,_b=0;for(_b=_i._channels.length-1;0<=_b;_b--)(_a=_i._channels[_b]).url!=_i._tMusic&&_a.stop()},_i.stopMusic=function(){_i._musicChannel&&_i._musicChannel.stop(),_i._tMusic=null},_i.setSoundVolume=function(_a,_b){if(_b)_i._setVolume(_b,_a);else{_i.soundVolume=_a;var _c,_d=0;for(_d=_i._channels.length-1;0<=_d;_d--)(_c=_i._channels[_d]).url!=_i._tMusic&&(_c.volume=_a)}},_i.setMusicVolume=function(_a){_i.musicVolume=_a,_i._setVolume(_i._tMusic,_a)},_i._setVolume=function(_a,_b){for(var _c,_d=_i._channels.length-1;0<=_d;_d--)(_c=_i._channels[_d]).url==_a&&(_c.volume=_b)},_i.musicVolume=1,_i.soundVolume=1,_i.playbackRate=1,_i._useAudioMusic=!0,_i._muted=!1,_i._soundMuted=!1,_i._musicMuted=!1,_i._tMusic=null,_i._musicChannel=null,_i._music=null,_i._channels=[],_i._autoStopMusic=!1,_i._blurPaused=!1,_i._isActive=!0,_i._soundClass=null,_i._musicClass=null,_i.autoReleaseSound=!0,_i._pool={},_i.defaultIntervals={},_i._notUsedUrls={},_i._notUsedCount=0,_i}(),_A=function(){var _a;function _c(){}return _p(_c,"laya.net.LocalStorage"),_c.__init__=function(){_c._baseClass||(_c._baseClass=_a).init(),_c.items=_c._baseClass.items,_c.support=_c._baseClass.support},_c.setItem=function(_a,_b){_c._baseClass.setItem(_a,_b)},_c.getItem=function(_a){return _c._baseClass.getItem(_a)},_c.setJSON=function(_a,_b){_c._baseClass.setJSON(_a,_b)},_c.getJSON=function(_a){return _c._baseClass.getJSON(_a)},_c.removeItem=function(_a){_c._baseClass.removeItem(_a)},_c.clear=function(){_c._baseClass.clear()},_c._baseClass=null,_c.items=null,_c.support=!1,_c.__init$=function(){_a=function(){function _c(){}return _p(_c,""),_c.init=function(){try{_c.support=!0,_c.items=_g.localStorage,_c.setItem("laya","1"),_c.removeItem("laya")}catch(_a){_c.support=!1}_c.support||console.log("LocalStorage is not supprot or browser is private mode.")},_c.setItem=function(_a,_b){try{_c.support&&_c.items.setItem(_a,_b)}catch(_a){console.warn("set localStorage failed",_a)}},_c.getItem=function(_a){return _c.support?_c.items.getItem(_a):null},_c.setJSON=function(_a,_b){try{_c.support&&_c.items.setItem(_a,JSON.stringify(_b))}catch(_a){console.warn("set localStorage failed",_a)}},_c.getJSON=function(_a){return JSON.parse(_c.support?_c.items.getItem(_a):null)},_c.removeItem=function(_a){_c.support&&_c.items.removeItem(_a)},_c.clear=function(){_c.support&&_c.items.clear()},_c.items=null,_c.support=!1,_c}()},_c}(),_F=(function(){function _d(){}_p(_d,"laya.net.ResourceVersion"),_d.enable=function(_a,_b,_c){void 0===_c&&(_c=2),laya.net.ResourceVersion.type=_c,_x.loader.load(_a,_s.create(null,_d.onManifestLoaded,[_b]),null,"json"),_G.customFormat=_d.addVersionPrefix},_d.onManifestLoaded=function(_a,_b){_d.manifest=_b,_a.run(),_b||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},_d.addVersionPrefix=function(_a){return _d.manifest&&_d.manifest[_a]?2==_d.type?_d.manifest[_a]:_d.manifest[_a]+"/"+_a:_a},_d.FOLDER_VERSION=1,_d.FILENAME_VERSION=2,_d.manifest=null,_d.type=1}(),function(){function _a(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}_p(_a,"laya.net.TTFLoader");var _b=_a.prototype;return _b.load=function(_a){var _b=(this._url=_a).split(".ttf")[0].split("/");this.fontName=_b[_b.length-1],_M.window.conch?this._loadConch():_M.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},_b._loadConch=function(){this._http=new _ga,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},_b._onHttpLoaded=function(_a){_M.window.conch.setFontFaceFromBuffer(this.fontName,_a),this._clearHttp(),this._complete()},_b._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},_b._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},_b._complete=function(){_x.timer.clear(this,this._complete),_x.timer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},_b._checkComplete=function(){_D.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},_b._loadWithFontFace=function(){var _a=new _M.window.FontFace(this.fontName,"url('"+this._url+"')");_M.window.document.fonts.add(_a);var _b=this;_a.loaded.then(function(){_b._complete()}),_a.load()},_b._createDiv=function(){this._div=_M.createElement("div"),this._div.innerHTML="laya";var _a=this._div.style;_a.fontFamily=this.fontName,_a.position="absolute",_a.left="-100px",_a.top="-100px",_M.document.body.appendChild(this._div)},_b._loadWithCSS=function(){var _a=this,_b=_M.createElement("style");_b.type="text/css",_M.document.body.appendChild(_b),_b.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=_D.measureText("LayaTTFFont",this._fontTxt).width;var _c=this;_b.onload=function(){_x.timer.once(1e4,_c,_a._complete)},_x.timer.loop(20,this,this._checkComplete),this._createDiv()},_a._testString="LayaTTFFont",_a}()),_G=function(){function _d(_a){this._url=null,this._path=null,this._url=_d.formatURL(_a),this._path=_d.getPath(_a)}_p(_d,"laya.net.URL");var _a=_d.prototype;return _k(0,_a,"path",function(){return this._path}),_k(0,_a,"url",function(){return this._url}),_d.formatURL=function(_a,_b){if(!_a)return"null path";if(0<_a.indexOf(":"))return _a;null!=_d.customFormat&&(_a=_d.customFormat(_a,_b));var _c=_a.charAt(0);if("."===_c)return _d.formatRelativePath((_b||_d.basePath)+_a);if("~"===_c)return _d.rootPath+_a.substring(1);if("d"===_c){if(0===_a.indexOf("data:image"))return _a}else if("/"===_c)return _a;return(_b||_d.basePath)+_a},_d.formatRelativePath=function(_a){for(var _b=_a.split("/"),_c=0,_d=_b.length;_c<_d;_c++)".."==_b[_c]&&(_b.splice(_c-1,2),_c-=2);return _b.join("/")},_d.isAbsolute=function(_a){return 0<_a.indexOf(":")||"/"==_a.charAt(0)},_d.getPath=function(_a){var _b=_a.lastIndexOf("/");return 0<_b?_a.substr(0,_b+1):""},_d.getFileName=function(_a){var _b=_a.lastIndexOf("/");return 0<_b?_a.substr(_b+1):_a},_d.version={},_d.basePath="",_d.rootPath="",_d.customFormat=function(_a){var _b=_d.version[_a];return!_H.isConchApp&&_b&&(_a+="?v="+_b),_a},_d}(),_H=function(){function _e(_a,_b){this._timeId=0;var _c=_e._mainCanvas.source.style;_c.position="absolute",_c.top=_c.left="0px",_c.background="#000000",_e._mainCanvas.source.id="layaCanvas";var _d=laya.renders.Render.isWebGL;_e._mainCanvas.source.width=_a,_e._mainCanvas.source.height=_b,_d&&_e.WebGL.init(_e._mainCanvas,_a,_b),_M.container.appendChild(_e._mainCanvas.source),(_e._context=new _I(_a,_b,_d?null:_e._mainCanvas)).ctx.setIsMainContext(),_M.window.requestAnimationFrame(function _a(_b){_M.window.requestAnimationFrame(_a);_x.stage._loop()}),_x.stage.on("visibilitychange",this,this._onVisibilitychange)}_p(_e,"laya.renders.Render");var _a=_e.prototype;return _a._onVisibilitychange=function(){_x.stage.isVisibility?0!=this._timeId&&_M.window.clearInterval(this._timeId):this._timeId=_M.window.setInterval(this._enterFrame,1e3)},_a._enterFrame=function(_a){_x.stage._loop()},_k(1,_e,"context",function(){return _e._context}),_k(1,_e,"canvas",function(){return _e._mainCanvas.source}),_e._context=null,_e._mainCanvas=null,_e.WebGL=null,_e.isConchNode=!1,_e.isConchApp=!1,_e.isConchWebGL=!1,_e.isWebGL=!1,_e.is3DMode=!1,_e.optimizeTextureMemory=function(_a,_b){return!0},_e.__init$=function(){_g.ConchRenderType=_g.ConchRenderType||1,_g.ConchRenderType|=_g.conch?4:0,_e.isConchNode=5==(5&_g.ConchRenderType),_e.isConchApp=4==(4&_g.ConchRenderType),_e.isConchWebGL=6==_g.ConchRenderType},_e}(),_I=function(){function _g(_a,_b,_c){this.x=0,this.y=0,this._drawTexture=function(_a,_b,_c){_c[0].loaded&&this.ctx.drawTexture(_c[0],_c[1],_c[2],_c[3],_c[4],_a,_b)},this._fillTexture=function(_a,_b,_c){_c[0].loaded&&this.ctx.fillTexture(_c[0],_c[1]+_a,_c[2]+_b,_c[3],_c[4],_c[5],_c[6],_c[7])},this._drawTextureWithTransform=function(_a,_b,_c){_c[0].loaded&&this.ctx.drawTextureWithTransform(_c[0],_c[1],_c[2],_c[3],_c[4],_c[5],_a,_b,_c[6])},this._fillQuadrangle=function(_a,_b,_c){this.ctx.fillQuadrangle(_c[0],_c[1],_c[2],_c[3],_c[4])},this._drawRect=function(_a,_b,_c){var _d=this.ctx;null!=_c[4]&&(_d.fillStyle=_c[4],_d.fillRect(_a+_c[0],_b+_c[1],_c[2],_c[3],null)),null!=_c[5]&&(_d.strokeStyle=_c[5],_d.lineWidth=_c[6],_d.strokeRect(_a+_c[0],_b+_c[1],_c[2],_c[3],_c[6]))},this._drawPie=function(_a,_b,_c){var _d=this.ctx;_H.isWebGL&&_d.setPathId(_c[8]),_d.beginPath(),_H.isWebGL?(_d.movePath(_c[0]+_a,_c[1]+_b),_d.moveTo(0,0)):_d.moveTo(_a+_c[0],_b+_c[1]),_d.arc(_a+_c[0],_b+_c[1],_c[2],_c[3],_c[4]),_d.closePath(),this._fillAndStroke(_c[5],_c[6],_c[7],!0)},this._clipRect=function(_a,_b,_c){this.ctx.clipRect(_a+_c[0],_b+_c[1],_c[2],_c[3])},this._fillRect=function(_a,_b,_c){this.ctx.fillRect(_a+_c[0],_b+_c[1],_c[2],_c[3],_c[4])},this._drawCircle=function(_a,_b,_c){var _d=this.ctx;_H.isWebGL&&_d.setPathId(_c[6]),_V.drawCall++,_d.beginPath(),_H.isWebGL&&_d.movePath(_c[0]+_a,_c[1]+_b),_d.arc(_c[0]+_a,_c[1]+_b,_c[2],0,_g.PI2),_d.closePath(),this._fillAndStroke(_c[3],_c[4],_c[5],!0)},this._fillCircle=function(_a,_b,_c){_V.drawCall++;var _d=this.ctx;_d.beginPath(),_d.fillStyle=_c[3],_d.arc(_c[0]+_a,_c[1]+_b,_c[2],0,_g.PI2),_d.fill()},this._setShader=function(_a,_b,_c){this.ctx.setShader(_c[0])},this._drawLine=function(_a,_b,_c){var _d=this.ctx;_H.isWebGL&&_d.setPathId(_c[6]),_d.beginPath(),_d.strokeStyle=_c[4],_d.lineWidth=_c[5],_H.isWebGL?(_d.movePath(_a,_b),_d.moveTo(_c[0],_c[1]),_d.lineTo(_c[2],_c[3])):(_d.moveTo(_a+_c[0],_b+_c[1]),_d.lineTo(_a+_c[2],_b+_c[3])),_d.stroke()},this._drawLines=function(_a,_b,_c){var _d=this.ctx;_H.isWebGL&&_d.setPathId(_c[5]),_d.beginPath(),_a+=_c[0],_b+=_c[1],_H.isWebGL&&_d.movePath(_a,_b),_d.strokeStyle=_c[3],_d.lineWidth=_c[4];var _e=_c[2],_f=2,_g=_e.length;if(_H.isWebGL)for(_d.moveTo(_e[0],_e[1]);_f<_g;)_d.lineTo(_e[_f++],_e[_f++]);else for(_d.moveTo(_a+_e[0],_b+_e[1]);_f<_g;)_d.lineTo(_a+_e[_f++],_b+_e[_f++]);_d.stroke()},this._drawLinesWebGL=function(_a,_b,_c){this.ctx.drawLines(_a+this.x+_c[0],_b+this.y+_c[1],_c[2],_c[3],_c[4])},this._drawCurves=function(_a,_b,_c){this.ctx.drawCurves(_a,_b,_c)},this._draw=function(_a,_b,_c){_c[0].call(null,this,_a,_b)},this._transformByMatrix=function(_a,_b,_c){this.ctx.transformByMatrix(_c[0])},this._setTransform=function(_a,_b,_c){this.ctx.setTransform(_c[0],_c[1],_c[2],_c[3],_c[4],_c[5])},this._setTransformByMatrix=function(_a,_b,_c){this.ctx.setTransformByMatrix(_c[0])},this._save=function(_a,_b,_c){this.ctx.save()},this._restore=function(_a,_b,_c){this.ctx.restore()},this._translate=function(_a,_b,_c){this.ctx.translate(_c[0],_c[1])},this._transform=function(_a,_b,_c){this.ctx.translate(_c[1]+_a,_c[2]+_b);var _d=_c[0];this.ctx.transform(_d.a,_d.b,_d.c,_d.d,_d.tx,_d.ty),this.ctx.translate(-_a-_c[1],-_b-_c[2])},this._rotate=function(_a,_b,_c){this.ctx.translate(_c[1]+_a,_c[2]+_b),this.ctx.rotate(_c[0]),this.ctx.translate(-_a-_c[1],-_b-_c[2])},this._scale=function(_a,_b,_c){this.ctx.translate(_c[2]+_a,_c[3]+_b),this.ctx.scale(_c[0],_c[1]),this.ctx.translate(-_a-_c[2],-_b-_c[3])},this._alpha=function(_a,_b,_c){this.ctx.globalAlpha*=_c[0]},this._setAlpha=function(_a,_b,_c){this.ctx.globalAlpha=_c[0]},this._fillText=function(_a,_b,_c){this.ctx.fillText(_c[0],_c[1]+_a,_c[2]+_b,_c[3],_c[4],_c[5])},this._strokeText=function(_a,_b,_c){this.ctx.strokeText(_c[0],_c[1]+_a,_c[2]+_b,_c[3],_c[4],_c[5],_c[6])},this._fillBorderText=function(_a,_b,_c){this.ctx.fillBorderText(_c[0],_c[1]+_a,_c[2]+_b,_c[3],_c[4],_c[5],_c[6],_c[7])},this._blendMode=function(_a,_b,_c){this.ctx.globalCompositeOperation=_c[0]},this._beginClip=function(_a,_b,_c){this.ctx.beginClip&&this.ctx.beginClip(_a+_c[0],_b+_c[1],_c[2],_c[3])},this._setIBVB=function(_a,_b,_c){this.ctx.setIBVB(_c[0]+_a,_c[1]+_b,_c[2],_c[3],_c[4],_c[5],_c[6],_c[7])},this._fillTrangles=function(_a,_b,_c){this.ctx.fillTrangles(_c[0],_c[1]+_a,_c[2]+_b,_c[3],_c[4])},this._drawPath=function(_a,_b,_c){var _d=this.ctx;_H.isWebGL&&_d.setPathId(-1),_d.beginPath(),_a+=_c[0],_b+=_c[1],_H.isWebGL&&_d.movePath(_a,_b);for(var _e=_c[2],_f=0,_g=_e.length;_f<_g;_f++){var _h=_e[_f];switch(_h[0]){case"moveTo":_H.isWebGL?_d.moveTo(_h[1],_h[2]):_d.moveTo(_a+_h[1],_b+_h[2]);break;case"lineTo":_H.isWebGL?_d.lineTo(_h[1],_h[2]):_d.lineTo(_a+_h[1],_b+_h[2]);break;case"arcTo":_H.isWebGL?_d.arcTo(_h[1],_h[2],_h[3],_h[4],_h[5]):_d.arcTo(_a+_h[1],_b+_h[2],_a+_h[3],_b+_h[4],_h[5]);break;case"closePath":_d.closePath()}}var _i=_c[3];null!=_i&&(_d.fillStyle=_i.fillStyle,_d.fill());var _j=_c[4];null!=_j&&(_d.strokeStyle=_j.strokeStyle,_d.lineWidth=_j.lineWidth||1,_d.lineJoin=_j.lineJoin,_d.lineCap=_j.lineCap,_d.miterLimit=_j.miterLimit,_d.stroke())},this.drawPoly=function(_a,_b,_c){this.ctx.drawPoly(_a+this.x+_c[0],_b+this.y+_c[1],_c[2],_c[3],_c[4],_c[5],_c[6])},this._drawPoly=function(_a,_b,_c){var _d=this.ctx,_e=_c[2],_f=2,_g=_e.length;if(_H.isWebGL)for(_d.setPathId(_c[6]),_d.beginPath(),_a+=_c[0],_b+=_c[1],_d.movePath(_a,_b),_d.moveTo(_e[0],_e[1]);_f<_g;)_d.lineTo(_e[_f++],_e[_f++]);else for(_d.beginPath(),_a+=_c[0],_b+=_c[1],_d.moveTo(_a+_e[0],_b+_e[1]);_f<_g;)_d.lineTo(_a+_e[_f++],_b+_e[_f++]);_d.closePath(),this._fillAndStroke(_c[3],_c[4],_c[5],_c[7])},this._drawSkin=function(_a,_b,_c){var _d=_c[0];if(_d){var _e=this.ctx;_d.render(_e,_a,_b)}},this._drawParticle=function(_a,_b,_c){this.ctx.drawParticle(_a+this.x,_b+this.y,_c[0])},this._setFilters=function(_a,_b,_c){this.ctx.setFilters(_c)},_c?this.ctx=_c.getContext("2d"):(_c=_ta.create("3D"),this.ctx=_D.createWebGLContext2D(_c),_c._setContext(this.ctx)),_c.size(_a,_b),this.canvas=_c}_p(_g,"laya.renders.RenderContext");var _a=_g.prototype;return _a.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.ctx=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},_a.drawTexture=function(_a,_b,_c,_d,_e){_a.loaded&&this.ctx.drawTexture(_a,_b,_c,_d,_e,this.x,this.y)},_a._drawTextures=function(_a,_b,_c){_c[0].loaded&&this.ctx.drawTextures(_c[0],_c[1],_a+this.x,_b+this.y)},_a.drawTextureWithTransform=function(_a,_b,_c,_d,_e,_f,_g){_a.loaded&&this.ctx.drawTextureWithTransform(_a,_b,_c,_d,_e,_f,this.x,this.y,_g)},_a.fillQuadrangle=function(_a,_b,_c,_d,_e){this.ctx.fillQuadrangle(_a,_b,_c,_d,_e)},_a.drawCanvas=function(_a,_b,_c,_d,_e){this.ctx.drawCanvas(_a,_b+this.x,_c+this.y,_d,_e)},_a.drawRect=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=1);var _g=this.ctx;_g.strokeStyle=_e,_g.lineWidth=_f,_g.strokeRect(_a+this.x,_b+this.y,_c,_d,_f)},_a._fillAndStroke=function(_a,_b,_c,_d){void 0===_d&&(_d=!1);var _e=this.ctx;null!=_a&&(_e.fillStyle=_a,_H.isWebGL?_e.fill(_d):_e.fill()),null!=_b&&0<_c&&(_e.strokeStyle=_b,_e.lineWidth=_c,_e.stroke())},_a.clipRect=function(_a,_b,_c,_d){this.ctx.clipRect(_a+this.x,_b+this.y,_c,_d)},_a.fillRect=function(_a,_b,_c,_d,_e){this.ctx.fillRect(_a+this.x,_b+this.y,_c,_d,_e)},_a.drawCircle=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=1),_V.drawCall++;var _f=this.ctx;_f.beginPath(),_f.strokeStyle=_d,_f.lineWidth=_e,_f.arc(_a+this.x,_b+this.y,_c,0,_g.PI2),_f.stroke()},_a.drawTriangles=function(_a,_b,_c){if(_H.isWebGL)this.ctx.drawTriangles(_c[0],_a+_c[1],_b+_c[2],_c[3],_c[4],_c[5],_c[6],_c[7],_c[8],_c[9]);else{var _d=_c[5],_e=0,_f=_d.length,_g=this.ctx;for(_e=0;_e<_f;_e+=3){var _h=2*_d[_e],_i=2*_d[_e+1],_j=2*_d[_e+2];_g.drawTriangle(_c[0],_c[3],_c[4],_h,_i,_j,_c[6],!0)}}},_a.fillCircle=function(_a,_b,_c,_d){_V.drawCall++;var _e=this.ctx;_e.beginPath(),_e.fillStyle=_d,_e.arc(_a+this.x,_b+this.y,_c,0,_g.PI2),_e.fill()},_a.setShader=function(_a){this.ctx.setShader(_a)},_a.drawLine=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=1);var _g=this.ctx;_g.beginPath(),_g.strokeStyle=_e,_g.lineWidth=_f,_g.moveTo(this.x+_a,this.y+_b),_g.lineTo(this.x+_c,this.y+_d),_g.stroke()},_a.clear=function(){this.ctx.clear()},_a.transformByMatrix=function(_a){this.ctx.transformByMatrix(_a)},_a.setTransform=function(_a,_b,_c,_d,_e,_f){this.ctx.setTransform(_a,_b,_c,_d,_e,_f)},_a.setTransformByMatrix=function(_a){this.ctx.setTransformByMatrix(_a)},_a.save=function(){this.ctx.save()},_a.restore=function(){this.ctx.restore()},_a.translate=function(_a,_b){this.ctx.translate(_a,_b)},_a.transform=function(_a,_b,_c,_d,_e,_f){this.ctx.transform(_a,_b,_c,_d,_e,_f)},_a.rotate=function(_a){this.ctx.rotate(_a)},_a.scale=function(_a,_b){this.ctx.scale(_a,_b)},_a.alpha=function(_a){this.ctx.globalAlpha*=_a},_a.setAlpha=function(_a){this.ctx.globalAlpha=_a},_a.fillWords=function(_a,_b,_c,_d,_e,_f){void 0===_f&&(_f=0),this.ctx.fillWords(_a,_b,_c,_d,_e,_f)},_a.fillBorderWords=function(_a,_b,_c,_d,_e,_f,_g){this.ctx.fillBorderWords(_a,_b,_c,_d,_e,_f,_g)},_a.fillText=function(_a,_b,_c,_d,_e,_f){this.ctx.fillText(_a,_b+this.x,_c+this.y,_d,_e,_f)},_a.strokeText=function(_a,_b,_c,_d,_e,_f,_g){this.ctx.strokeText(_a,_b+this.x,_c+this.y,_d,_e,_f,_g)},_a.blendMode=function(_a){this.ctx.globalCompositeOperation=_a},_a.flush=function(){this.ctx.flush&&this.ctx.flush()},_a.addRenderObject=function(_a){this.ctx.addRenderObject(_a)},_a.beginClip=function(_a,_b,_c,_d){this.ctx.beginClip&&this.ctx.beginClip(_a,_b,_c,_d)},_a.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},_a.fillTrangles=function(_a,_b,_c){this.ctx.fillTrangles(_c[0],_c[1],_c[2],_c[3],4<_c.length?_c[4]:null)},_g.PI2=2*Math.PI,_g}(),_J=function(){function _g(_a,_b){switch(this._next=_b||_g.NORENDER,_a){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:case 517:return void(this._fun=this._image2);case 32:return void(this._fun=_r._filter);case 69905:return void(this._fun=_g._initRenderFun)}this.onCreate(_a)}_p(_g,"laya.renders.RenderSprite");var _a=_g.prototype;return _a.onCreate=function(_a){},_a._style=function(_a,_b,_c,_d){_a._style.render(_a,_b,_c,_d);var _e=this._next;_e._fun.call(_e,_a,_b,_c,_d)},_a._no=function(_a,_b,_c,_d){},_a._custom=function(_a,_b,_c,_d){_a.customRender(_b,_c,_d);var _e=_a._style._tf;this._next._fun.call(this._next,_a,_b,_c-_e.translateX,_d-_e.translateY)},_a._clip=function(_a,_b,_c,_d){var _e=this._next;if(_e!=_g.NORENDER){var _f=_a._style.scrollRect;_b.ctx.save(),_b.ctx.clipRect(_c,_d,_f.width,_f.height),_e._fun.call(_e,_a,_b,_c-_f.x,_d-_f.y),_b.ctx.restore()}},_a._blend=function(_a,_b,_c,_d){var _e=_a._style;_e.blendMode&&(_b.ctx.globalCompositeOperation=_e.blendMode);var _f=this._next;_f._fun.call(_f,_a,_b,_c,_d),_b.ctx.globalCompositeOperation="source-over"},_a._mask=function(_a,_b,_c,_d){var _e=this._next;_e._fun.call(_e,_a,_b,_c,_d);var _f=_a.mask;_f&&(_b.ctx.globalCompositeOperation="destination-in",(0<_f.numChildren||!_f.graphics._isOnlyOne())&&(_f.cacheAsBitmap=!0),_f.render(_b,_c-_a.pivotX,_d-_a.pivotY)),_b.ctx.globalCompositeOperation="source-over"},_a._graphics=function(_a,_b,_c,_d){var _e=_a._style._tf;_a._graphics&&_a._graphics._render(_a,_b,_c-_e.translateX,_d-_e.translateY);var _f=this._next;_f._fun.call(_f,_a,_b,_c,_d)},_a._image=function(_a,_b,_c,_d){var _e=_a._style;_b.ctx.drawTexture2(_c,_d,_e._tf.translateX,_e._tf.translateY,_a.transform,_e.alpha,_e.blendMode,_a._graphics._one)},_a._image2=function(_a,_b,_c,_d){var _e=_a._style._tf;_b.ctx.drawTexture2(_c,_d,_e.translateX,_e.translateY,_a.transform,1,null,_a._graphics._one)},_a._alpha=function(_a,_b,_c,_d){var _e;if(.01<(_e=_a._style.alpha)||_a._needRepaint()){var _f=_b.ctx.globalAlpha;_b.ctx.globalAlpha*=_e;var _g=this._next;_g._fun.call(_g,_a,_b,_c,_d),_b.ctx.globalAlpha=_f}},_a._transform=function(_a,_b,_c,_d){var _e=_a.transform,_f=this._next;_e&&_f!=_g.NORENDER?(_b.save(),_b.transform(_e.a,_e.b,_e.c,_e.d,_e.tx+_c,_e.ty+_d),_f._fun.call(_f,_a,_b,0,0),_b.restore()):_f._fun.call(_f,_a,_b,_c,_d)},_a._childs=function(_a,_b,_c,_d){var _e=_a._style,_f=_e._tf;if(_c=_c-_f.translateX+_e.paddingLeft,_d=_d-_f.translateY+_e.paddingTop,_e._calculation){var _g=_a._getWords();if(_g){var _h=_e;_h&&(_h.stroke?_b.fillBorderWords(_g,_c,_d,_h.font,_h.color,_h.strokeColor,_h.stroke):_b.fillWords(_g,_c,_d,_h.font,_h.color,"none"!=_h.textDecoration&&_h.underLine?1:0))}}var _i,_j=_a._childs,_k=_j.length;if(_a.viewport||_a.optimizeScrollRect&&_a._style.scrollRect){var _l=_a.viewport||_a._style.scrollRect,_m=_l.x,_n=_l.y,_o=_l.right,_p=_l.bottom,_q=NaN,_r=NaN;for(_s=0;_s<_k;++_s)(_i=_j[_s]).visible&&(_q=_i._x)<_o&&_q+_i.width>_m&&(_r=_i._y)<_p&&_r+_i.height>_n&&_i.render(_b,_c,_d)}else for(var _s=0;_s<_k;++_s)(_i=_j[_s])._style.visible&&_i.render(_b,_c,_d)},_a._canvas=function(_a,_b,_c,_d){var _e=_a._$P.cacheCanvas;if(_e){"bitmap"===_e.type?_V.canvasBitmap++:_V.canvasNormal++;var _f=_e.ctx;if(_a._needRepaint()||!_f)this._canvas_repaint(_a,_b,_c,_d);else{var _g=_e._cacheRec;_b.drawCanvas(_f.canvas,_c+_g.x,_d+_g.y,_g.width,_g.height)}}else this._next._fun.call(this._next,_a,_b,_c,_d)},_a._canvas_repaint=function(_a,_b,_c,_d){var _e=_a._$P.cacheCanvas,_f=this._next;if(_e){var _g,_h,_i,_j,_k=_e.ctx,_l=_a._needRepaint()||!_k,_m=_e.type;if("bitmap"===_m?_V.canvasBitmap++:_V.canvasNormal++,_l){var _n,_o;_e._cacheRec||(_e._cacheRec=new _z),_H.isWebGL&&"bitmap"!==_m?_e._cacheRec.setTo(-_a.pivotX,-_a.pivotY,1,1):((_j=_a.getSelfBounds()).x=_j.x-_a.pivotX,_j.y=_j.y-_a.pivotY,_j.x=_j.x-16,_j.y=_j.y-16,_j.width=_j.width+32,_j.height=_j.height+32,_j.x=Math.floor(_j.x+_c)-_c,_j.y=Math.floor(_j.y+_d)-_d,_j.width=Math.floor(_j.width),_j.height=Math.floor(_j.height),_e._cacheRec.copyFrom(_j)),_j=_e._cacheRec;var _p,_q=_H.isWebGL?1:_M.pixelRatio*_x.stage.clientScaleX,_r=_H.isWebGL?1:_M.pixelRatio*_x.stage.clientScaleY;if(!_H.isWebGL){var _s,_t=1,_u=1;for(_s=_a;_s&&_s!=_x.stage;)_t*=_s.scaleX,_u*=_s.scaleY,_s=_s.parent;_H.isWebGL?(_t<1&&(_q*=_t),_u<1&&(_r*=_u)):(1<_t&&(_q*=_t),1<_u&&(_r*=_u))}if(_a.scrollRect){var _v=_a.scrollRect;_j.x-=_v.x,_j.y-=_v.y}if(_n=_j.width*_q,_o=_j.height*_r,_h=_j.x,_i=_j.y,_H.isWebGL&&"bitmap"===_m&&(2048<_n||2048<_o))return console.warn("cache bitmap size larger than 2048,cache ignored"),_e.ctx&&(_U.recover("RenderContext",_e.ctx),_e.ctx.canvas.size(0,0),_e.ctx=null),void _f._fun.call(_f,_a,_b,_c,_d);if(_k||(_k=_e.ctx=_U.getItem("RenderContext")||new _I(_n,_o,_ta.create("AUTO"))),_k.ctx.sprite=_a,(_g=_k.canvas).clear(),(_g.width!=_n||_g.height!=_o)&&_g.size(_n,_o),"bitmap"===_m?_g.context.asBitmap=!0:"normal"===_m&&(_g.context.asBitmap=!1),1!=_q||1!=_r){var _w=_k.ctx;_w.save(),_w.scale(_q,_r),!_H.isConchWebGL&&_H.isConchApp&&(_p=_a._$P.cf)&&_w.setFilterMatrix&&_w.setFilterMatrix(_p._mat,_p._alpha),_f._fun.call(_f,_a,_k,-_h,-_i),_w.restore(),_H.isConchApp&&!_H.isConchWebGL||_a._applyFilters()}else _w=_k.ctx,!_H.isConchWebGL&&_H.isConchApp&&(_p=_a._$P.cf)&&_w.setFilterMatrix&&_w.setFilterMatrix(_p._mat,_p._alpha),_f._fun.call(_f,_a,_k,-_h,-_i),_H.isConchApp&&!_H.isConchWebGL||_a._applyFilters();_a._$P.staticCache&&(_e.reCache=!1),_V.canvasReCache++}else _h=(_j=_e._cacheRec).x,_i=_j.y,_g=_k.canvas;_b.drawCanvas(_g,_c+_h,_d+_i,_j.width,_j.height)}else _f._fun.call(_f,_a,_k,_c,_d)},_g.__init__=function(){var _a,_b,_c=0;for(_b=_D.createRenderSprite(69905,null),_a=_g.renders.length=4096,_c=0;_c<_a;_c++)_g.renders[_c]=_b;_g.renders[0]=_D.createRenderSprite(0,null),function(_a,_b){for(var _c=0,_d=0;_d<_a.length;_d++)_c|=_a[_d],_g.renders[_c]=_b}([1,512,4,2],new _g(1,null)),_g.renders[513]=_D.createRenderSprite(513,null),_g.renders[517]=new _g(517,null)},_g._initRenderFun=function(_a,_b,_c,_d){var _e=_a._renderType;(_g.renders[_e]=_g._getTypeRender(_e))._fun(_a,_b,_c,_d)},_g._getTypeRender=function(_a){for(var _b=null,_c=2048;1<_c;)_c&_a&&(_b=_D.createRenderSprite(_c,_b)),_c>>=1;return _b},_g.IMAGE=1,_g.ALPHA=2,_g.TRANSFORM=4,_g.BLEND=8,_g.CANVAS=16,_g.FILTERS=32,_g.MASK=64,_g.CLIP=128,_g.STYLE=256,_g.GRAPHICS=512,_g.CUSTOM=1024,_g.CHILDS=2048,_g.INIT=69905,_g.renders=[],_g.NORENDER=new _g(0,null),_g}(),_K=function(){function _h(){this._repaint=!1}_p(_h,"laya.resource.Context");var _a=_h.prototype;return _a.replaceReset=function(){var _a,_b,_c=0;for(_a=_h.replaceKeys.length,_c=0;_c<_a;_c++)_b=_h.replaceKeys[_c],this[_h.newKeys[_c]]=this[_b]},_a.replaceResotre=function(){this.__restore(),this.__reset()},_a.setIsMainContext=function(){},_a.drawTextures=function(_a,_b,_c,_d){_V.drawCall+=_b.length/2;for(var _e=_a.width,_f=_a.height,_g=0,_h=_b.length;_g<_h;_g+=2)this.drawTexture(_a,_b[_g],_b[_g+1],_e,_f,_c,_d)},_a.drawCanvas=function(_a,_b,_c,_d,_e){_V.drawCall++,this.drawImage(_a.source,_b,_c,_d,_e)},_a.fillRect=function(_a,_b,_c,_d,_e){_V.drawCall++,_e&&(this.fillStyle=_e),this.__fillRect(_a,_b,_c,_d)},_a.fillText=function(_a,_b,_c,_d,_e,_f){_V.drawCall++,3<arguments.length&&null!=_d&&(this.font=_d,this.fillStyle=_e,this.textAlign=_f,this.textBaseline="top"),this.__fillText(_a,_b,_c)},_a.fillBorderText=function(_a,_b,_c,_d,_e,_f,_g,_h){_V.drawCall++,this.font=_d,this.fillStyle=_e,this.textBaseline="top",this.strokeStyle=_f,this.lineWidth=_g,this.textAlign=_h,this.__strokeText(_a,_b,_c),this.__fillText(_a,_b,_c)},_a.strokeText=function(_a,_b,_c,_d,_e,_f,_g){_V.drawCall++,3<arguments.length&&null!=_d&&(this.font=_d,this.strokeStyle=_e,this.lineWidth=_f,this.textAlign=_g,this.textBaseline="top"),this.__strokeText(_a,_b,_c)},_a.transformByMatrix=function(_a){this.transform(_a.a,_a.b,_a.c,_a.d,_a.tx,_a.ty)},_a.setTransformByMatrix=function(_a){this.setTransform(_a.a,_a.b,_a.c,_a.d,_a.tx,_a.ty)},_a.clipRect=function(_a,_b,_c,_d){_V.drawCall++,this.beginPath(),this.rect(_a,_b,_c,_d),this.clip()},_a.drawTexture=function(_a,_b,_c,_d,_e,_f,_g){_V.drawCall++;var _h=_a.uv,_i=_a.bitmap.width,_j=_a.bitmap.height;this.drawImage(_a.source,_h[0]*_i,_h[1]*_j,(_h[2]-_h[0])*_i,(_h[5]-_h[3])*_j,_b+_f,_c+_g,_d,_e)},_a.drawTextureWithTransform=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){_V.drawCall++;var _j=_a.uv,_k=_a.bitmap.width,_l=_a.bitmap.height;this.save(),1!=_i&&(this.globalAlpha*=_i),_f?(this.transform(_f.a,_f.b,_f.c,_f.d,_f.tx+_g,_f.ty+_h),this.drawImage(_a.source,_j[0]*_k,_j[1]*_l,(_j[2]-_j[0])*_k,(_j[5]-_j[3])*_l,_b,_c,_d,_e)):this.drawImage(_a.source,_j[0]*_k,_j[1]*_l,(_j[2]-_j[0])*_k,(_j[5]-_j[3])*_l,_b+_g,_c+_h,_d,_e),this.restore()},_a.drawTexture2=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=_h[0];if(_i.loaded&&_i.bitmap&&_i.source){_V.drawCall++;var _j=1!==_f;if(_j){var _k=this.globalAlpha;this.globalAlpha*=_f}var _l=_i.uv,_m=_i.bitmap.width,_n=_i.bitmap.height;_e?(this.save(),this.transform(_e.a,_e.b,_e.c,_e.d,_e.tx+_a,_e.ty+_b),this.drawImage(_i.source,_l[0]*_m,_l[1]*_n,(_l[2]-_l[0])*_m,(_l[5]-_l[3])*_n,_h[1]-_c,_h[2]-_d,_h[3],_h[4]),this.restore()):this.drawImage(_i.source,_l[0]*_m,_l[1]*_n,(_l[2]-_l[0])*_m,(_l[5]-_l[3])*_n,_h[1]-_c+_a,_h[2]-_d+_b,_h[3],_h[4]),_j&&(this.globalAlpha=_k)}},_a.fillTexture=function(_a,_b,_c,_d,_e,_f,_g,_h){if(!_h.pat){if(_a.uv!=_ka.DEF_UV){var _i=new _ta("2D");_i.getContext("2d"),_i.size(_a.width,_a.height),_i.context.drawTexture(_a,0,0,_a.width,_a.height,0,0),_a=new _ka(_i)}_h.pat=this.createPattern(_a.bitmap.source,_f)}var _j=_b,_k=_c,_l=0,_m=0;_g&&(_j+=_g.x%_a.width,_k+=_g.y%_a.height,_l-=_g.x%_a.width,_m-=_g.y%_a.height),this.translate(_j,_k),this.fillRect(_l,_m,_d,_e,_h.pat),this.translate(-_j,-_k)},_a.drawTriangle=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=_a.bitmap,_j=_i.source,_k=_a.width,_l=_a.height,_m=_i.width,_n=_i.height,_o=_c[_d]*_m,_p=_c[_e]*_m,_q=_c[_f]*_m,_r=_c[_d+1]*_n,_s=_c[_e+1]*_n,_t=_c[_f+1]*_n,_u=_b[_d],_v=_b[_e],_w=_b[_f],_x=_b[_d+1],_y=_b[_e+1],_z=_b[_f+1];if(_h){var _A=(_u+_v+_w)/3,_B=(_x+_y+_z)/3,_C=_u-_A,_D=_x-_B,_E=Math.sqrt(_C*_C+_D*_D);_u=_A+_C/_E*(_E+1),_x=_B+_D/_E*(_E+1),_D=_y-_B,_v=_A+(_C=_v-_A)/(_E=Math.sqrt(_C*_C+_D*_D))*(_E+1),_y=_B+_D/_E*(_E+1),_D=_z-_B,_w=_A+(_C=_w-_A)/(_E=Math.sqrt(_C*_C+_D*_D))*(_E+1),_z=_B+_D/_E*(_E+1)}this.save(),_g&&this.transform(_g.a,_g.b,_g.c,_g.d,_g.tx,_g.ty),this.beginPath(),this.moveTo(_u,_x),this.lineTo(_v,_y),this.lineTo(_w,_z),this.closePath(),this.clip();var _F=1/(_o*_s+_r*_q+_p*_t-_s*_q-_r*_p-_o*_t),_G=_u*_s+_r*_w+_v*_t-_s*_w-_r*_v-_u*_t,_H=_o*_v+_u*_q+_p*_w-_v*_q-_u*_p-_o*_w,_I=_o*_s*_w+_r*_v*_q+_u*_p*_t-_u*_s*_q-_r*_p*_w-_o*_v*_t,_J=_x*_s+_r*_z+_y*_t-_s*_z-_r*_y-_x*_t,_K=_o*_y+_x*_q+_p*_z-_y*_q-_x*_p-_o*_z,_L=_o*_s*_z+_r*_y*_q+_x*_p*_t-_x*_s*_q-_r*_p*_z-_o*_y*_t;this.transform(_G*_F,_J*_F,_H*_F,_K*_F,_I*_F,_L*_F),this.drawImage(_j,_a.uv[0]*_m,_a.uv[1]*_n,_k,_l,_a.uv[0]*_m,_a.uv[1]*_n,_k,_l),this.restore()},_a.flush=function(){return 0},_a.fillWords=function(_a,_b,_c,_d,_e,_f){_d&&(this.font=_d),_e&&(this.fillStyle=_e);this.textBaseline="top",this.textAlign="left";for(var _g=0,_h=_a.length;_g<_h;_g++){var _i=_a[_g];if(this.__fillText(_i.char,_i.x+_b,_i.y+_c),1===_f){var _j=_i.height,_k=.5*_i.style.letterSpacing;_k||(_k=0),this.beginPath(),this.strokeStyle=_e,this.lineWidth=1,this.moveTo(_b+_i.x-_k+.5,_c+_i.y+_j+.5),this.lineTo(_b+_i.x+_i.width+_k+.5,_c+_i.y+_j+.5),this.stroke()}}},_a.fillBorderWords=function(_a,_b,_c,_d,_e,_f,_g){_d&&(this.font=_d),_e&&(this.fillStyle=_e),this.textBaseline="top",this.lineWidth=_g,this.textAlign="left",this.strokeStyle=_f;for(var _h=0,_i=_a.length;_h<_i;_h++){var _j=_a[_h];this.__strokeText(_j.char,_j.x+_b,_j.y+_c),this.__fillText(_j.char,_j.x+_b,_j.y+_c)}},_a.destroy=function(){this.canvas.width=this.canvas.height=0},_a.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},_a.drawCurves=function(_a,_b,_c){this.beginPath(),this.strokeStyle=_c[3],this.lineWidth=_c[4];var _d=_c[2];_a+=_c[0],_b+=_c[1],this.moveTo(_a+_d[0],_b+_d[1]);for(var _e=2,_f=_d.length;_e<_f;)this.quadraticCurveTo(_a+_d[_e++],_b+_d[_e++],_a+_d[_e++],_b+_d[_e++]);this.stroke()},_h.__init__=function(_b){var _c=laya.resource.Context.prototype;if(!(_b=_b||CanvasRenderingContext2D.prototype).inited){_b.inited=!0,_b.__fillText=_b.fillText,_b.__fillRect=_b.fillRect,_b.__strokeText=_b.strokeText;["drawTextures","drawTriangle","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"].forEach(function(_a){_b[_a]=_c[_a]})}},_h.replaceCanvasGetSet=function(_a,_b){var _c=Object.getOwnPropertyDescriptor(_a,_b);if(!_c||!_c.configurable)return!1;var _d,_e={};for(_d in _c)"set"!=_d&&(_e[_d]=_c[_d]);var _f=_c.set;return _e.set=function(_a){_f.call(this,_a);var _b=this.getContext("2d");_b&&"__reset"in _b&&_b.__reset()},Object.defineProperty(_a,_b,_e),!0},_h.replaceGetSet=function(_a,_b){var _c=Object.getOwnPropertyDescriptor(_a,_b);if(!_c||!_c.configurable)return!1;var _d,_e={};for(_d in _c)"set"!=_d&&(_e[_d]=_c[_d]);var _f=_c.set,_g="___"+_b+"__";return _h.newKeys.push(_g),_e.set=function(_a){_a!=this[_g]&&(this[_g]=_a,_f.call(this,_a))},Object.defineProperty(_a,_b,_e),!0},_h._default=new _h,_h.newKeys=[],_i(_h,["replaceKeys",function(){return this.replaceKeys=["font","fillStyle","textBaseline"]}]),_h}(),_L=function(){function _f(_a){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++_f._uniqueIDCounter,this._name=_a||"Content Manager",_f._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,_f._resourceManagers.push(this),this._resources=[],this._records={}}_p(_f,"laya.resource.ResourceManager");var _a=_f.prototype;return _x.imps(_a,{"laya.resource.IDispose":!0}),_a.getResourceByIndex=function(_a){return this._resources[_a]},_a.getResourcesLength=function(){return this._resources.length},_a.addResource=function(_a){return _a.resourceManager&&_a.resourceManager.removeResource(_a),-1===this._resources.indexOf(_a)&&((_a._resourceManager=this)._resources.push(_a),this.addRecord(_a.uri,_a.__className,_a.memorySize),this.addSize(_a.memorySize),!0)},_a.removeResource=function(_a){var _b=this._resources.indexOf(_a);return-1!==_b&&(this._resources.splice(_b,1),_a._resourceManager=null,this._memorySize-=_a.memorySize,this.addRecord(_a.uri,_a.__className,-_a.memorySize),!0)},_a.unload=function(){for(var _a=this._resources.slice(0,this._resources.length),_b=0;_b<_a.length;_b++){_a[_b].destroy()}_a.length=0},_a.dispose=function(){if(this===_f._systemResourceManager)throw new Error("systemResourceManager不能被释放！");_f._resourceManagers.splice(_f._resourceManagers.indexOf(this),1),_f._isResourceManagersSorted=!1;for(var _a=this._resources.slice(0,this._resources.length),_b=0;_b<_a.length;_b++){var _c=_a[_b];_c.resourceManager.removeResource(_c),_c.destroy()}_a.length=0},_a.addSize=function(_a){_a&&(this.autoRelease&&0<_a&&this._memorySize+_a>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=_a)},_a.addRecord=function(_a,_b,_c){DEBUG&&_c&&!_a&&console.error(_a,_b,_c),_a&&(this._records.hasOwnProperty(_b+"|"+_a)||(this._records[_b+"|"+_a]=0),this._records[_b+"|"+_a]+=_c,DEBUG&&this._records[_b+"|"+_a]<0&&console.error(_a,_b,this._records[_b+"|"+_a]))},_a.garbageCollection=function(_a){var _b=this._resources;(_b=_b.slice()).sort(function(_a,_b){if(!_a||!_b)throw new Error("a或b不能为空！");return _a.released&&_b.released?0:_a.released?1:_b.released?-1:_a._lastUseFrameCount-_b._lastUseFrameCount});for(var _c=_V.loopCount,_d=0,_e=_b.length;_d<_e;_d++){var _f=_b[_d];if(!(1<_c-_f._lastUseFrameCount))return void(this._memorySize>=_a&&(this._isOverflow=!0));if(_f.releaseResource(),this._memorySize<_a)return void(this._isOverflow=!1)}},_k(0,_a,"id",function(){return this._id}),_k(0,_a,"name",function(){return this._name},function(_a){!_a&&""===_a||this._name===_a||(this._name=_a,_f._isResourceManagersSorted=!1)}),_k(0,_a,"memorySize",function(){return this._memorySize}),_k(0,_a,"records",function(){return this._records}),_k(1,_f,"systemResourceManager",function(){return _f._systemResourceManager}),_f.__init__=function(){_f.currentResourceManager=_f.systemResourceManager},_f.getLoadedResourceManagerByIndex=function(_a){return _f._resourceManagers[_a]},_f.getLoadedResourceManagersCount=function(){return _f._resourceManagers.length},_f.recreateContentManagers=function(_a){void 0===_a&&(_a=!1);for(var _b=_f.currentResourceManager,_c=0;_c<_f._resourceManagers.length;_c++){_f.currentResourceManager=_f._resourceManagers[_c];for(var _d=0;_d<_f.currentResourceManager._resources.length;_d++)_f.currentResourceManager._resources[_d].releaseResource(_a),_f.currentResourceManager._resources[_d].activeResource(_a)}_f.currentResourceManager=_b},_f.releaseContentManagers=function(_a){void 0===_a&&(_a=!1);for(var _b=_f.currentResourceManager,_c=0;_c<_f._resourceManagers.length;_c++){_f.currentResourceManager=_f._resourceManagers[_c];for(var _d=0;_d<_f.currentResourceManager._resources.length;_d++){var _e=_f.currentResourceManager._resources[_d];!_e.released&&_e.releaseResource(_a)}}_f.currentResourceManager=_b},_f._uniqueIDCounter=0,_f._isResourceManagersSorted=!1,_f._resourceManagers=[],_i(_f,["_systemResourceManager",function(){return this._systemResourceManager=new _f("System Resource Manager")},"currentResourceManager",function(){return this.currentResourceManager=_f._systemResourceManager}]),_f}(),_M=(function(){function _a(){}_p(_a,"laya.system.System"),_a.changeDefinition=function(_a,_b){_x[_a]=_b;var _c=_a+"=classObj";_x._runScript(_c)},_a.__init__=function(){_H.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())}}(),function(){function _c(){}return _p(_c,"laya.utils.Browser"),_k(1,_c,"pixelRatio",function(){return _c.__init__(),-1<_c.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")?2:_D.getPixelRatio()}),_k(1,_c,"height",function(){return _c.__init__(),(_x.stage&&_x.stage.canvasRotation?_c.clientWidth:_c.clientHeight)*_c.pixelRatio}),_k(1,_c,"clientWidth",function(){return _c.__init__(),_c.window.innerWidth||_c.document.body.clientWidth}),_k(1,_c,"window",function(){return _c.__init__(),_c._window}),_k(1,_c,"clientHeight",function(){return _c.__init__(),_c.window.innerHeight||_c.document.body.clientHeight||_c.document.documentElement.clientHeight}),_k(1,_c,"width",function(){return _c.__init__(),(_x.stage&&_x.stage.canvasRotation?_c.clientHeight:_c.clientWidth)*_c.pixelRatio}),_k(1,_c,"container",function(){return _c.__init__(),_c._container||((_c._container=_c.createElement("div")).id="layaContainer",_c.document.body.appendChild(_c._container)),_c._container},function(_a){_c._container=_a}),_k(1,_c,"document",function(){return _c.__init__(),_c._document}),_c.__init__=function(){if(!_c._window){_c._window=_D.getWindow(),_c._document=_c.window.document,_c._window.addEventListener("message",function(_a){laya.utils.Browser._onMessage(_a)},!1),_c.document.__createElement=_c.document.createElement,_g.requestAnimationFrame=_g.requestAnimationFrame||_g.webkitRequestAnimationFrame||_g.mozRequestAnimationFrame||_g.oRequestAnimationFrame||_g.msRequestAnimationFrame||function(_a){return _g.setTimeout(_a,1e3/60)};var _a=_g.document.body.style;_a["-webkit-user-select"]="none",_a["-webkit-tap-highlight-color"]="rgba(200,200,200,0)",_c.userAgent=_c.window.navigator.userAgent,_c.onIOS=!!(_c.u=_c.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),_c.onMobile=-1<_c.u.indexOf("Mobile"),_c.onIPhone=-1<_c.u.indexOf("iPhone"),_c.onMac=-1<_c.u.indexOf("Mac OS X"),_c.onIPad=-1<_c.u.indexOf("iPad"),_c.onAndroid=-1<_c.u.indexOf("Android")||-1<_c.u.indexOf("Adr"),_c.onWP=-1<_c.u.indexOf("Windows Phone"),_c.onQQBrowser=-1<_c.u.indexOf("QQBrowser"),_c.onMQQBrowser=-1<_c.u.indexOf("MQQBrowser")||-1<_c.u.indexOf("Mobile")&&-1<_c.u.indexOf("QQ"),_c.onIE=!!_c.window.ActiveXObject||"ActiveXObject"in _c.window,_c.onWeiXin=-1<_c.u.indexOf("MicroMessenger"),_c.onPC=!_c.onMobile,_c.onSafari=-1<_c.u.indexOf("Safari"),_c.onFirefox=-1<_c.u.indexOf("Firefox"),_c.onEdge=-1<_c.u.indexOf("Edge"),_c.onMiniGame=-1<_c.u.indexOf("MiniGame"),_c.onLimixiu=-1<_c.u.indexOf("limixiu"),_c.httpProtocol="http:"==_c.window.location.protocol,_c.onMiniGame&&null==_c.window.focus&&console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0"),_c.webAudioEnabled=!!(_c.window.AudioContext||_c.window.webkitAudioContext||_c.window.mozAudioContext),_c.soundType=_c.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",_ea=_c.webAudioEnabled?_fa:_ca,_c.webAudioEnabled&&_fa.initWebAudio(),_ca._initMusicAudio(),_c.enableTouch="ontouchstart"in _g||_g.DocumentTouch&&_b instanceof DocumentTouch,_g.focus(),_C._soundClass=_ea,_C._musicClass=_ca,_H._mainCanvas=_H._mainCanvas||_ta.create("2D"),_c.canvas||(_c.canvas=_ta.create("2D"),_c.context=_c.canvas.getContext("2d"))}},_c._onMessage=function(_a){if(_a.data&&"size"==_a.data.name){if(_c.window.innerWidth=_a.data.width,_c.window.innerHeight=_a.data.height,_c.window.__innerHeight=_a.data.clientHeight,!_c.document.createEvent)return void console.warn("no document.createEvent");var _b=_c.document.createEvent("HTMLEvents");return _b.initEvent("resize",!1,!1),void _c.window.dispatchEvent(_b)}},_c.createElement=function(_a){return _c.__init__(),_c.document.__createElement(_a)},_c.getElementById=function(_a){return _c.__init__(),_c.document.getElementById(_a)},_c.removeElement=function(_a){_a&&_a.parentNode&&_a.parentNode.removeChild(_a)},_c.now=function(){return _D.now()},_c._window=null,_c._document=null,_c._container=null,_c.userAgent=null,_c.u=null,_c.onIOS=!1,_c.onMac=!1,_c.onMobile=!1,_c.onIPhone=!1,_c.onIPad=!1,_c.onAndroid=!1,_c.onWP=!1,_c.onQQBrowser=!1,_c.onMQQBrowser=!1,_c.onSafari=!1,_c.onFirefox=!1,_c.onEdge=!1,_c.onIE=!1,_c.onWeiXin=!1,_c.onMiniGame=!1,_c.onLimixiu=!1,_c.onPC=!1,_c.httpProtocol=!1,_c.webAudioEnabled=!1,_c.soundType=null,_c.enableTouch=!1,_c.canvas=null,_c.context=null,_c.__init$=function(){},_c}()),_N=function(){function _b(_a){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,_a?(this._u8d_=new Uint8Array(_a),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}_p(_b,"laya.utils.Byte");var _a=_b.prototype;return _a.___resizeBuffer=function(_b){try{var _a=new Uint8Array(_b);null!=this._u8d_&&(this._u8d_.length<=_b?_a.set(this._u8d_):_a.set(this._u8d_.subarray(0,_b))),this._u8d_=_a,this._d_=new DataView(_a.buffer)}catch(_a){throw"___resizeBuffer err:"+_b}},_a.getString=function(){return this.rUTF(this.getUint16())},_a.getFloat32Array=function(_a,_b){var _c=_a+_b;_c=_c>this._length?this._length:_c;var _d=new Float32Array(this._d_.buffer.slice(_a,_c));return this._pos_=_c,_d},_a.getUint8Array=function(_a,_b){var _c=_a+_b;_c=_c>this._length?this._length:_c;var _d=new Uint8Array(this._d_.buffer.slice(_a,_c));return this._pos_=_c,_d},_a.getInt16Array=function(_a,_b){var _c=_a+_b;_c=_c>this._length?this._length:_c;var _d=new Int16Array(this._d_.buffer.slice(_a,_c));return this._pos_=_c,_d},_a.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var _a=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,_a},_a.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var _a=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,_a},_a.writeFloat32=function(_a){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,_a,this._xd_),this._pos_+=4},_a.writeFloat64=function(_a){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,_a,this._xd_),this._pos_+=8},_a.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var _a=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,_a},_a.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var _a=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,_a},_a.writeInt32=function(_a){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,_a,this._xd_),this._pos_+=4},_a.writeUint32=function(_a){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,_a,this._xd_),this._pos_+=4},_a.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var _a=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,_a},_a.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var _a=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,_a},_a.writeUint16=function(_a){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,_a,this._xd_),this._pos_+=2},_a.writeInt16=function(_a){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,_a,this._xd_),this._pos_+=2},_a.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++)},_a.writeUint8=function(_a){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,_a),this._pos_++},_a._getUInt8=function(_a){return this._d_.getUint8(_a)},_a._getUint16=function(_a){return this._d_.getUint16(_a,this._xd_)},_a._getMatrix=function(){return new _E(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},_a.rUTF=function(_a){for(var _b=[],_c=this._pos_+_a,_d=0,_e=0,_f=0,_g=String.fromCharCode,_h=this._u8d_;this._pos_<_c;)(_d=_h[this._pos_++])<128?0!=_d&&_b.push(_g(_d)):_d<224?_b.push(_g((63&_d)<<6|127&_h[this._pos_++])):_d<240?(_e=_h[this._pos_++],_b.push(_g((31&_d)<<12|(127&_e)<<6|127&_h[this._pos_++]))):(_e=_h[this._pos_++],_f=_h[this._pos_++],_b.push(_g((15&_d)<<18|(127&_e)<<12|_f<<6&127|127&_h[this._pos_++]))),0;return _b.join("")},_a.getCustomString=function(_a){for(var _b=[],_c=0,_d=0,_e=0,_f=String.fromCharCode,_g=this._u8d_;0<_a;)if((_d=_g[this._pos_])<128)_b.push(_f(_d)),this._pos_++,_a--;else for(_c=_d-128,this._pos_++,_a-=_c;0<_c;)_d=_g[this._pos_++],_e=_g[this._pos_++],_b.push(_f(_e<<8|_d)),_c--;return _b.join("")},_a.clear=function(){this._pos_=0,this.length=0},_a.__getBuffer=function(){return this._d_.buffer},_a.writeUTFBytes=function(_a){for(var _b=0,_c=(_a+="").length;_b<_c;_b++){var _d=_a.charCodeAt(_b);_d<=127?this.writeByte(_d):_d<=2047?(this.ensureWrite(this._pos_+2),this._u8d_.set([192|_d>>6,128|63&_d],this._pos_),this._pos_+=2):_d<=65535?(this.ensureWrite(this._pos_+3),this._u8d_.set([224|_d>>12,128|_d>>6&63,128|63&_d],this._pos_),this._pos_+=3):(this.ensureWrite(this._pos_+4),this._u8d_.set([240|_d>>18,128|_d>>12&63,128|_d>>6&63,128|63&_d],this._pos_),this._pos_+=4)}},_a.writeUTFString=function(_a){var _b=this.pos;this.writeUint16(1),this.writeUTFBytes(_a);var _c=this.pos-_b-2;if(65536<=_c)throw"writeUTFString byte len more than 65536";this._d_.setUint16(_b,_c,this._xd_)},_a.readUTFString=function(){return this.readUTFBytes(this.getUint16())},_a.getUTFString=function(){return this.readUTFString()},_a.readUTFBytes=function(_a){if(void 0===_a&&(_a=-1),0==_a)return"";var _b=this.bytesAvailable;if(_b<_a)throw"readUTFBytes error - Out of bounds";return _a=0<_a?_a:_b,this.rUTF(_a)},_a.getUTFBytes=function(_a){return void 0===_a&&(_a=-1),this.readUTFBytes(_a)},_a.writeByte=function(_a){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,_a),this._pos_+=1},_a.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},_a.getByte=function(){return this.readByte()},_a.ensureWrite=function(_a){this._length<_a&&(this._length=_a),this._allocated_<_a&&(this.length=_a)},_a.writeArrayBuffer=function(_a,_b,_c){if(void 0===_b&&(_b=0),void 0===_c&&(_c=0),_b<0||_c<0)throw"writeArrayBuffer error - Out of bounds";0==_c&&(_c=_a.byteLength-_b),this.ensureWrite(this._pos_+_c);var _d=new Uint8Array(_a);this._u8d_.set(_d.subarray(_b,_b+_c),this._pos_),this._pos_+=_c},_k(0,_a,"buffer",function(){var _a=this._d_.buffer;return _a.byteLength==this.length?_a:_a.slice(0,this.length)}),_k(0,_a,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(_a){this._xd_="littleEndian"==_a}),_k(0,_a,"length",function(){return this._length},function(_a){this._allocated_<_a?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(_a,2*this._allocated_))):this._allocated_>_a&&this.___resizeBuffer(this._allocated_=_a),this._length=_a}),_k(0,_a,"pos",function(){return this._pos_},function(_a){this._pos_=_a}),_k(0,_a,"bytesAvailable",function(){return this._length-this._pos_}),_b.getSystemEndian=function(){if(!_b._sysEndian){var _a=new ArrayBuffer(2);new DataView(_a).setInt16(0,256,!0),_b._sysEndian=256===new Int16Array(_a)[0]?"littleEndian":"bigEndian"}return _b._sysEndian},_b.BIG_ENDIAN="bigEndian",_b.LITTLE_ENDIAN="littleEndian",_b._sysEndian=null,_b}(),_O=function(){function _e(){}return _p(_e,"laya.utils.CacheManager"),_e.regCacheByFunction=function(_a,_b){var _c;_e.unRegCacheByFunction(_a,_b),_c={tryDispose:_a,getCacheList:_b},_e._cacheList.push(_c)},_e.unRegCacheByFunction=function(_a,_b){var _c,_d=0;for(_c=_e._cacheList.length,_d=0;_d<_c;_d++)if(_e._cacheList[_d].tryDispose==_a&&_e._cacheList[_d].getCacheList==_b)return void _e._cacheList.splice(_d,1)},_e.forceDispose=function(){var _a=0,_b=_e._cacheList.length;for(_a=0;_a<_b;_a++)_e._cacheList[_a].tryDispose(!0)},_e.beginCheck=function(_a){void 0===_a&&(_a=15e3),_x.timer.loop(_a,null,_e._checkLoop)},_e.stopCheck=function(){_x.timer.clear(null,_e._checkLoop)},_e._checkLoop=function(){var _a=_e._cacheList;if(!(_a.length<1)){var _b,_c=_M.now(),_d=0;for(_b=_d=_a.length;0<_d&&(_a[_e._index=++_e._index%_b].tryDispose(!1),!(_M.now()-_c>_e.loopTimeLimit));)_d--}},_e.loopTimeLimit=2,_e._cacheList=[],_e._index=0,_e}(),_P=function(){function _n(){}return _p(_n,"laya.utils.ClassUtils"),_n.regClass=function(_a,_b){_n._classMap[_a]=_b},_n.getRegClass=function(_a){return _n._classMap[_a]},_n.getInstance=function(_a){var _b=_n.getClass(_a);return _b?new _b:(console.warn("[error] Undefined class:",_a),null)},_n.createByJson=function(_a,_b,_c,_d,_e){"string"==typeof _a&&(_a=JSON.parse(_a));var _f=_a.props;if(!_b&&!(_b=_e?_e.runWith(_a):_n.getInstance(_f.runtime||_a.type)))return null;var _g=_a.child;if(_g)for(var _h=0,_i=_g.length;_h<_i;_h++){var _j=_g[_h];if("render"!==_j.props.name&&"render"!==_j.props.renderType||!_b._$set_itemRender)if("Graphic"==_j.type)_n.addGraphicsToSprite(_j,_b);else if(_n.isDrawType(_j.type))_n.addGraphicToSprite(_j,_b,!0);else{var _k=_n.createByJson(_j,null,_c,_d,_e);"Script"==_j.type?_k.hasOwnProperty("owner")?_k.owner=_b:_k.hasOwnProperty("target")&&(_k.target=_b):"mask"==_j.props.renderType?_b.mask=_k:_b.addChild(_k)}else _b.itemRender=_j}if(_f)for(var _l in _f){var _m=_f[_l];"var"===_l&&_c?_c[_m]=_b:_m instanceof Array&&"function"==typeof _b[_l]?_b[_l].apply(_b,_m):_b[_l]=_m}return _d&&_a.customProps&&_d.runWith([_b,_a]),_b.created&&_b.created(),_b},_n.addGraphicsToSprite=function(_a,_b){var _c;if((_c=_a.child)&&!(_c.length<1)){var _d;_d=_n._getGraphicsFromSprite(_a,_b);var _e=0,_f=0;_a.props&&(_e=_n._getObjVar(_a.props,"x",0),_f=_n._getObjVar(_a.props,"y",0)),0!=_e&&0!=_f&&_d.translate(_e,_f);var _g,_h=0;for(_g=_c.length,_h=0;_h<_g;_h++)_n._addGraphicToGraphics(_c[_h],_d);0!=_e&&0!=_f&&_d.translate(-_e,-_f)}},_n.addGraphicToSprite=function(_a,_b,_c){var _d;void 0===_c&&(_c=!1),_d=_c?_n._getGraphicsFromSprite(_a,_b):_b.graphics,_n._addGraphicToGraphics(_a,_d)},_n._getGraphicsFromSprite=function(_a,_b){var _c,_d;if(!_a||!_a.props)return _b.graphics;switch(_d=_a.props.renderType){case"hit":case"unHit":var _e;_b.hitArea||(_b.hitArea=new _T),(_e=_b.hitArea)[_d]||(_e[_d]=new _m),_c=_e[_d]}return _c||(_c=_b.graphics),_c},_n._getTransformData=function(_a){var _b;(_a.hasOwnProperty("pivotX")||_a.hasOwnProperty("pivotY"))&&(_b=_b||new _E).translate(-_n._getObjVar(_a,"pivotX",0),-_n._getObjVar(_a,"pivotY",0));var _c=_n._getObjVar(_a,"scaleX",1),_d=_n._getObjVar(_a,"scaleY",1),_e=_n._getObjVar(_a,"rotation",0);_n._getObjVar(_a,"skewX",0),_n._getObjVar(_a,"skewY",0);return 1==_c&&1==_d&&0==_e||((_b=_b||new _E).scale(_c,_d),_b.rotate(.0174532922222222*_e)),_b},_n._addGraphicToGraphics=function(_a,_b){var _c,_d;if((_c=_a.props)&&(_d=_n.DrawTypeDic[_a.type])){var _e,_f;_e=_b;var _g=_n._getParams(_c,_d[1],_d[2],_d[3]);((_f=_n._tM)||1!=_n._alpha)&&(_e.save(),_f&&_e.transform(_f),1!=_n._alpha&&_e.alpha(_n._alpha)),_e[_d[0]].apply(_e,_g),(_f||1!=_n._alpha)&&_e.restore()}},_n._adptLineData=function(_a){return _a[2]=parseFloat(_a[0])+parseFloat(_a[2]),_a[3]=parseFloat(_a[1])+parseFloat(_a[3]),_a},_n._adptTextureData=function(_a){return _a[0]=_ha.getRes(_a[0]),_a},_n._adptLinesData=function(_a){return _a[2]=_n._getPointListByStr(_a[2]),_a},_n.isDrawType=function(_a){return"Image"!=_a&&_n.DrawTypeDic.hasOwnProperty(_a)},_n._getParams=function(_a,_b,_c,_d){var _e;void 0===_c&&(_c=0),(_e=_n._temParam).length=_b.length;var _f,_g,_h=0;for(_f=_b.length,_h=0;_h<_f;_h++)_e[_h]=_n._getObjVar(_a,_b[_h][0],_b[_h][1]);return _n._alpha=_n._getObjVar(_a,"alpha",1),_g=_n._getTransformData(_a),_n._tM=_g?(_c||(_c=0),_g.translate(_e[_c],_e[_c+1]),_e[_c]=_e[_c+1]=0,_g):null,_d&&_n[_d]&&(_e=_n[_d](_e)),_e},_n._getPointListByStr=function(_a){var _b,_c,_d=0;for(_c=(_b=_a.split(",")).length,_d=0;_d<_c;_d++)_b[_d]=parseFloat(_b[_d]);return _b},_n._getObjVar=function(_a,_b,_c){return _a.hasOwnProperty(_b)?_a[_b]:_c},_n._temParam=[],_n._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},_n.getClass=function(_a){var _b=_n._classMap[_a]||_a;return"string"==typeof _b?_x.__classmap[_b]:_b},_n._tM=null,_n._alpha=NaN,_i(_n,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),_n}(),_Q=function(){function _f(_a){if(this._color=[],"string"==typeof _a){null===(this.strColor=_a)&&(_a="#000000"),"#"==_a.charAt(0)&&(_a=_a.substr(1));var _b=_a.length;if(3==_b||4==_b){for(var _c="",_d=0;_d<_b;_d++)_c+=_a[_d]+_a[_d];_a=_c}var _e=this.numColor=parseInt(_a,16);if(8==_a.length)return void(this._color=[parseInt(_a.substr(0,2),16)/255,((16711680&_e)>>16)/255,((65280&_e)>>8)/255,(255&_e)/255])}else _e=this.numColor=_a,this.strColor=_Y.toHexColor(_e);this._color=[((16711680&_e)>>16)/255,((65280&_e)>>8)/255,(255&_e)/255,1],this._color.__id=++_f._COLODID}return _p(_f,"laya.utils.Color"),_f._initDefault=function(){for(var _a in _f._DEFAULT={},_f._COLOR_MAP)_f._SAVE[_a]=_f._DEFAULT[_a]=new _f(_f._COLOR_MAP[_a]);return _f._DEFAULT},_f._initSaveMap=function(){for(var _a in _f._SAVE_SIZE=0,_f._SAVE={},_f._DEFAULT)_f._SAVE[_a]=_f._DEFAULT[_a]},_f.create=function(_a){var _b=_f._SAVE[_a+""];return null!=_b?_b:(_f._SAVE_SIZE<1e3||_f._initSaveMap(),_f._SAVE[_a+""]=new _f(_a))},_f._SAVE={},_f._SAVE_SIZE=0,_f._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},_f._DEFAULT=_f._initDefault(),_f._COLODID=1,_f}(),_R=(function(){function _a(){this._values=[],this._keys=[]}_p(_a,"laya.utils.Dictionary");var _b=_a.prototype;_b.set=function(_a,_b){var _c=this.indexOf(_a);0<=_c?this._values[_c]=_b:(this._keys.push(_a),this._values.push(_b))},_b.indexOf=function(_a){var _b=this._keys.indexOf(_a);return 0<=_b?_b:(_a="string"==typeof _a?Number(_a):"number"==typeof _a?_a.toString():_a,this._keys.indexOf(_a))},_b.get=function(_a){var _b=this.indexOf(_a);return _b<0?null:this._values[_b]},_b.remove=function(_a){var _b=this.indexOf(_a);return 0<=_b&&(this._keys.splice(_b,1),this._values.splice(_b,1),!0)},_b.clear=function(){this._values.length=0,this._keys.length=0},_k(0,_b,"values",function(){return this._values}),_k(0,_b,"keys",function(){return this._keys})}(),function(){function _a(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}_p(_a,"laya.utils.Dragging");var _b=_a.prototype;return _b.start=function(_a,_b,_c,_d,_e,_f,_g,_h){void 0===_h&&(_h=.92),this.clearTimer(),this.target=_a,this.area=_b,this.hasInertia=_c,this.elasticDistance=_b?_d:0,this.elasticBackTime=_e,this.data=_f,this._disableMouseEvent=_g,this.ratio=_h,1!=_a.globalScaleX||1!=_a.globalScaleY?this._parent=_a.parent:this._parent=_x.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,_x.stage.on("mouseup",this,this.onStageMouseUp),_x.stage.on("mouseout",this,this.onStageMouseUp),_x.timer.frameLoop(1,this,this.loop)},_b.clearTimer=function(){_x.timer.clear(this,this.loop),_x.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},_b.stop=function(){this._dragging&&(_o.instance.disableMouseEvent=!1,_x.stage.off("mouseup",this,this.onStageMouseUp),_x.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},_b.loop=function(){var _a=this._parent.getMousePoint(),_b=_a.x,_c=_a.y,_d=_b-this._lastX,_e=_c-this._lastY;if(this._clickOnly){if(!(1<Math.abs(_d*_x.stage._canvasTransform.getScaleX())||1<Math.abs(_e*_x.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),_o.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(_d,_e);0==_d&&0==_e||(this._lastX=_b,this._lastY=_c,this.target.x+=_d*this._elasticRateX,this.target.y+=_e*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},_b.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var _a=this.area.x-this.target.x;else _a=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-_a/this.elasticDistance),this.target.y<this.area.y)var _b=this.area.y-this.target.y;else _b=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-_b/this.elasticDistance)}},_b.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},_b.onStageMouseUp=function(_a){if(_o.instance.disableMouseEvent=!1,_x.stage.off("mouseup",this,this.onStageMouseUp),_x.stage.off("mouseout",this,this.onStageMouseUp),_x.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var _b=this._offsets.length,_c=Math.min(_b,6),_d=this._offsets.length-_c,_e=_b-1;_d<_e;_e--)this._offsetY+=this._offsets[_e--],this._offsetX+=this._offsets[_e];this._offsetX=this._offsetX/_c*2,this._offsetY=this._offsetY/_c*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),_x.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},_b.checkElastic=function(){var _a=NaN,_b=NaN;if(this.target.x<this.area.x?_a=this.area.x:this.target.x>this.area.x+this.area.width&&(_a=this.area.x+this.area.width),this.target.y<this.area.y?_b=this.area.y:this.target.y>this.area.y+this.area.height&&(_b=this.area.y+this.area.height),isNaN(_a)&&isNaN(_b))this.clear();else{var _c={};isNaN(_a)||(_c.x=_a),isNaN(_b)||(_c.y=_b),this._tween=_X.to(this.target,_c,this.elasticBackTime,_S.sineOut,_s.create(this,this.clear),0,!1,!1)}},_b.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(_x.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},_b.clear=function(){if(this.target){this.clearTimer();var _a=this.target;this.target=null,this._parent=null,_a.event("dragend",this.data)}},_a}()),_S=function(){function _h(){}return _p(_h,"laya.utils.Ease"),_h.linearNone=function(_a,_b,_c,_d){return _c*_a/_d+_b},_h.linearIn=function(_a,_b,_c,_d){return _c*_a/_d+_b},_h.linearInOut=function(_a,_b,_c,_d){return _c*_a/_d+_b},_h.linearOut=function(_a,_b,_c,_d){return _c*_a/_d+_b},_h.bounceIn=function(_a,_b,_c,_d){return _c-_h.bounceOut(_d-_a,0,_c,_d)+_b},_h.bounceInOut=function(_a,_b,_c,_d){return _a<.5*_d?.5*_h.bounceIn(2*_a,0,_c,_d)+_b:.5*_h.bounceOut(2*_a-_d,0,_c,_d)+.5*_c+_b},_h.bounceOut=function(_a,_b,_c,_d){return(_a/=_d)<1/2.75?_c*(7.5625*_a*_a)+_b:_a<2/2.75?_c*(7.5625*(_a-=1.5/2.75)*_a+.75)+_b:_a<2.5/2.75?_c*(7.5625*(_a-=2.25/2.75)*_a+.9375)+_b:_c*(7.5625*(_a-=2.625/2.75)*_a+.984375)+_b},_h.backIn=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=1.70158),_c*(_a/=_d)*_a*((_e+1)*_a-_e)+_b},_h.backInOut=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=1.70158),(_a/=.5*_d)<1?.5*_c*(_a*_a*((1+(_e*=1.525))*_a-_e))+_b:_c/2*((_a-=2)*_a*((1+(_e*=1.525))*_a+_e)+2)+_b},_h.backOut=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=1.70158),_c*((_a=_a/_d-1)*_a*((_e+1)*_a+_e)+1)+_b},_h.elasticIn=function(_a,_b,_c,_d,_e,_f){var _g;return void 0===_e&&(_e=0),void 0===_f&&(_f=0),0==_a?_b:1==(_a/=_d)?_b+_c:(_f||(_f=.3*_d),_g=!_e||0<_c&&_e<_c||_c<0&&_e<-_c?(_e=_c,_f/4):_f/_h.PI2*Math.asin(_c/_e),-_e*Math.pow(2,10*(_a-=1))*Math.sin((_a*_d-_g)*_h.PI2/_f)+_b)},_h.elasticInOut=function(_a,_b,_c,_d,_e,_f){var _g;return void 0===_e&&(_e=0),void 0===_f&&(_f=0),0==_a?_b:2==(_a/=.5*_d)?_b+_c:(_f||(_f=_d*(.3*1.5)),_g=!_e||0<_c&&_e<_c||_c<0&&_e<-_c?(_e=_c,_f/4):_f/_h.PI2*Math.asin(_c/_e),_a<1?_e*Math.pow(2,10*(_a-=1))*Math.sin((_a*_d-_g)*_h.PI2/_f)*-.5+_b:_e*Math.pow(2,-10*(_a-=1))*Math.sin((_a*_d-_g)*_h.PI2/_f)*.5+_c+_b)},_h.elasticOut=function(_a,_b,_c,_d,_e,_f){var _g;return void 0===_e&&(_e=0),void 0===_f&&(_f=0),0==_a?_b:1==(_a/=_d)?_b+_c:(_f||(_f=.3*_d),_g=!_e||0<_c&&_e<_c||_c<0&&_e<-_c?(_e=_c,_f/4):_f/_h.PI2*Math.asin(_c/_e),_e*Math.pow(2,-10*_a)*Math.sin((_a*_d-_g)*_h.PI2/_f)+_c+_b)},_h.strongIn=function(_a,_b,_c,_d){return _c*(_a/=_d)*_a*_a*_a*_a+_b},_h.strongInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*_c*_a*_a*_a*_a*_a+_b:.5*_c*((_a-=2)*_a*_a*_a*_a+2)+_b},_h.strongOut=function(_a,_b,_c,_d){return _c*((_a=_a/_d-1)*_a*_a*_a*_a+1)+_b},_h.sineInOut=function(_a,_b,_c,_d){return.5*-_c*(Math.cos(Math.PI*_a/_d)-1)+_b},_h.sineIn=function(_a,_b,_c,_d){return-_c*Math.cos(_a/_d*_h.HALF_PI)+_c+_b},_h.sineOut=function(_a,_b,_c,_d){return _c*Math.sin(_a/_d*_h.HALF_PI)+_b},_h.quintIn=function(_a,_b,_c,_d){return _c*(_a/=_d)*_a*_a*_a*_a+_b},_h.quintInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*_c*_a*_a*_a*_a*_a+_b:.5*_c*((_a-=2)*_a*_a*_a*_a+2)+_b},_h.quintOut=function(_a,_b,_c,_d){return _c*((_a=_a/_d-1)*_a*_a*_a*_a+1)+_b},_h.quartIn=function(_a,_b,_c,_d){return _c*(_a/=_d)*_a*_a*_a+_b},_h.quartInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*_c*_a*_a*_a*_a+_b:.5*-_c*((_a-=2)*_a*_a*_a-2)+_b},_h.quartOut=function(_a,_b,_c,_d){return-_c*((_a=_a/_d-1)*_a*_a*_a-1)+_b},_h.cubicIn=function(_a,_b,_c,_d){return _c*(_a/=_d)*_a*_a+_b},_h.cubicInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*_c*_a*_a*_a+_b:.5*_c*((_a-=2)*_a*_a+2)+_b},_h.cubicOut=function(_a,_b,_c,_d){return _c*((_a=_a/_d-1)*_a*_a+1)+_b},_h.quadIn=function(_a,_b,_c,_d){return _c*(_a/=_d)*_a+_b},_h.quadInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*_c*_a*_a+_b:.5*-_c*(--_a*(_a-2)-1)+_b},_h.quadOut=function(_a,_b,_c,_d){return-_c*(_a/=_d)*(_a-2)+_b},_h.expoIn=function(_a,_b,_c,_d){return 0==_a?_b:_c*Math.pow(2,10*(_a/_d-1))+_b-.001*_c},_h.expoInOut=function(_a,_b,_c,_d){return 0==_a?_b:_a==_d?_b+_c:(_a/=.5*_d)<1?.5*_c*Math.pow(2,10*(_a-1))+_b:.5*_c*(2-Math.pow(2,-10*--_a))+_b},_h.expoOut=function(_a,_b,_c,_d){return _a==_d?_b+_c:_c*(1-Math.pow(2,-10*_a/_d))+_b},_h.circIn=function(_a,_b,_c,_d){return-_c*(Math.sqrt(1-(_a/=_d)*_a)-1)+_b},_h.circInOut=function(_a,_b,_c,_d){return(_a/=.5*_d)<1?.5*-_c*(Math.sqrt(1-_a*_a)-1)+_b:.5*_c*(Math.sqrt(1-(_a-=2)*_a)+1)+_b},_h.circOut=function(_a,_b,_c,_d){return _c*Math.sqrt(1-(_a=_a/_d-1)*_a)+_b},_h.HALF_PI=.5*Math.PI,_h.PI2=2*Math.PI,_h}(),_T=function(){function _l(){this._hit=null,this._unHit=null}_p(_l,"laya.utils.HitArea");var _a=_l.prototype;return _a.isHit=function(_a,_b){return!!_l.isHitGraphic(_a,_b,this.hit)&&!_l.isHitGraphic(_a,_b,this.unHit)},_a.contains=function(_a,_b){return this.isHit(_a,_b)},_k(0,_a,"hit",function(){return this._hit||(this._hit=new _m),this._hit},function(_a){this._hit=_a}),_k(0,_a,"unHit",function(){return this._unHit||(this._unHit=new _m),this._unHit},function(_a){this._unHit=_a}),_l.isHitGraphic=function(_a,_b,_c){if(!_c)return!1;var _d;if(!(_d=_c.cmds)&&_c._one&&((_d=_l._cmds).length=1,_d[0]=_c._one),!_d)return!1;var _e,_f,_g=0;for(_e=_d.length,_g=0;_g<_e;_g++)if(_f=_d[_g]){var _h=_H._context;switch(_f.callee){case _h._translate:case 6:_a-=_f[0],_b-=_f[1]}if(_l.isHitCmd(_a,_b,_f))return!0}return!1},_l.isHitCmd=function(_a,_b,_c){if(!_c)return!1;var _d=_H._context,_e=!1;switch(_c.callee){case _d._drawRect:case 13:_l._rec.setTo(_c[0],_c[1],_c[2],_c[3]),_e=_l._rec.contains(_a,_b);break;case _d._drawCircle:case _d._fillCircle:case 14:_e=(_a-=_c[0])*_a+(_b-=_c[1])*_b<_c[2]*_c[2];break;case _d._drawPoly:case 18:_a-=_c[0],_b-=_c[1],_e=_l.ptInPolygon(_a,_b,_c[2])}return _e},_l.ptInPolygon=function(_a,_b,_c){var _d;(_d=_l._ptPoint).setTo(_a,_b);var _e,_f=0,_g=NaN,_h=NaN,_i=NaN,_j=NaN;_e=_c.length;for(var _k=0;_k<_e;_k+=2){if(_g=_c[_k],_h=_c[_k+1],_i=_c[(_k+2)%_e],_h!=(_j=_c[(_k+3)%_e]))if(!(_d.y<Math.min(_h,_j)))if(!(_d.y>=Math.max(_h,_j)))(_d.y-_h)*(_i-_g)/(_j-_h)+_g>_d.x&&_f++}return _f%2==1},_l._cmds=[],_i(_l,["_rec",function(){return this._rec=new _z},"_ptPoint",function(){return this._ptPoint=new _y}]),_l}(),_U=(function(){function _e(_a,_b,_c,_d){this.char=_a,this.charNum=_a.charCodeAt(0),this._x=this._y=0,this.width=_b,this.height=_c,this.style=_d,this.isWord=!_e._isWordRegExp.test(_a)}_p(_e,"laya.utils.HTMLChar");var _a=_e.prototype;_x.imps(_a,{"laya.display.ILayout":!0}),_a.setSprite=function(_a){this._sprite=_a},_a.getSprite=function(){return this._sprite},_a._isChar=function(){return!0},_a._getCSSStyle=function(){return this.style},_k(0,_a,"width",function(){return this._w},function(_a){this._w=_a}),_k(0,_a,"x",function(){return this._x},function(_a){this._sprite&&(this._sprite.x=_a),this._x=_a}),_k(0,_a,"y",function(){return this._y},function(_a){this._sprite&&(this._sprite.y=_a),this._y=_a}),_k(0,_a,"height",function(){return this._h},function(_a){this._h=_a}),_e._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function _b(){}_p(_b,"laya.utils.Log"),_b.enable=function(){_b._logdiv||(_b._logdiv=_M.window.document.createElement("div"),_M.window.document.body.appendChild(_b._logdiv),_b._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},_b.toggle=function(){var _a=_b._logdiv.style;"1px"==_a.width?_a.width=_a.height="50%":_a.width=_a.height="1px"},_b.print=function(_a){_b._logdiv&&(_b.maxCount<=_b._count&&_b.clear(),_b._count++,_b._logdiv.innerText+=_a+"\n",_b._logdiv.scrollTop=_b._logdiv.scrollHeight)},_b.clear=function(){_b._logdiv.innerText="",_b._count=0},_b._logdiv=null,_b._count=0,_b.maxCount=20}(),function(){function _b(){}_p(_b,"laya.utils.Mouse"),_k(1,_b,"cursor",function(){return _b._style.cursor},function(_a){_b._style.cursor=_a}),_b.hide=function(){"none"!=_b.cursor&&(_b._preCursor=_b.cursor,_b.cursor="none")},_b.show=function(){"none"==_b.cursor&&(_b.cursor=_b._preCursor?_b._preCursor:"auto")},_b._preCursor=null,_i(_b,["_style",function(){return this._style=_M.document.body.style}])}(),function(){function _f(){}return _p(_f,"laya.utils.Pool"),_f.getPoolBySign=function(_a){return _f._poolDic[_a]||(_f._poolDic[_a]=[])},_f.clearBySign=function(_a){_f._poolDic[_a]&&(_f._poolDic[_a].length=0)},_f.recover=function(_a,_b){_b.__InPool||(_b.__InPool=!0,_f.getPoolBySign(_a).push(_b))},_f.getItemByClass=function(_a,_b){var _c=_f.getPoolBySign(_a),_d=_c.length?_c.pop():new _b;return _d.__InPool=!1,_d},_f.getItemByCreateFun=function(_a,_b,_c){var _d=_f.getPoolBySign(_a),_e=_d.length?_d.pop():_b.call(_c);return _e.__InPool=!1,_e},_f.getItem=function(_a){var _b=_f.getPoolBySign(_a),_c=_b.length?_b.pop():null;return _c&&(_c.__InPool=!1),_c},_f._poolDic={},_f.InPoolSign="__InPool",_f}()),_V=function(){function _i(){}return _p(_i,"laya.utils.Stat"),_k(1,_i,"onclick",null,function(_a){_i._sp&&_i._sp.on("click",_i._sp,_a),_i._canvas&&(_i._canvas.source.onclick=_a,_i._canvas.source.style.pointerEvents="")}),_i.show=function(_a,_b,_c){if(void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),!_H.isConchApp||_H.isConchWebGL){if(_H.isConchWebGL||_M.onMiniGame||_M.onLimixiu||(_i._useCanvas=!0),_i._show=!0,_i._fpsData.length=60,_i._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},_i._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},_i._view[2]={title:"DrawCall",value:"drawCall",color:"green",units:"int"},_i._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},_H.isWebGL)if(_i._view[4]={title:"Shader",value:"shaderCall",color:"red",units:"int"},_H.is3DMode){if(_i._view[0].title="FPS(3D)",_i._view[5]={title:"TriFaces",value:"trianglesFaces",color:"blue",units:"int"},_i._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},_i._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"},1==_c){var _d=8;_i._view[_d++]={title:"VATTRIBS",value:"MAX_VERTEX_ATTRIBS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"VUNIFORMS",value:"MAX_VERTEX_UNIFORM_VECTORS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"VARYINGS",value:"MAX_VARYING_VECTORS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"CTEXTURES",value:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"VTEXTURES",value:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"TEXTURES",value:"MAX_TEXTURE_IMAGE_UNITS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"FUNIFORMS",value:"MAX_FRAGMENT_UNIFORM_VECTORS",color:"white",units:"int",varying:1},_i._view[_d++]={title:"SVERSION",value:"SHADING_LANGUAGE_VERSION",color:"white",units:"string",varying:1},_i._view[_d++]={title:"VERSION",value:"VERSION",color:"white",units:"string",varying:1}}else if(2==_c){_d=8;_i._view[_d++]={title:"astc",value:"WEBGL_compressed_texture_astc",color:"white",units:"object",varying:2},_i._view[_d++]={title:"atc",value:"WEBGL_compressed_texture_atc",color:"white",units:"object",varying:2},_i._view[_d++]={title:"etc",value:"WEBGL_compressed_texture_etc",color:"white",units:"object",varying:2},_i._view[_d++]={title:"etc1",value:"WEBGL_compressed_texture_etc1",color:"white",units:"object",varying:2},_i._view[_d++]={title:"pvrtc",value:"WEBGL_compressed_texture_pvrtc",color:"white",units:"object",varying:2},_i._view[_d++]={title:"s3tc",value:"WEBGL_compressed_texture_s3tc",color:"white",units:"object",varying:2},_i._view[_d++]={title:"srgb",value:"WEBGL_compressed_texture_s3tc_srgb",color:"white",units:"object",varying:2}}}else _i._view[0].title="FPS(WebGL)",_i._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};else _i._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};_i._useCanvas?_i.createUIPre(_a,_b):_i.createUI(_a,_b),_i.enable()}else _M.window.conch.showFPS&&_M.window.conch.showFPS(_a,_b)},_i.createUIPre=function(_a,_b){var _c=_M.pixelRatio;_i._width=170*_c,_i._vx=75*_c,_i._height=_c*(12*_i._view.length+3*_c)+4,_i._fontSize=12*_c;for(var _d=0;_d<_i._view.length;_d++)_i._view[_d].x=4,_i._view[_d].y=_d*_i._fontSize+2*_c;_i._canvas||((_i._canvas=new _ta("2D")).size(_i._width,_i._height),(_i._ctx=_i._canvas.getContext("2d")).textBaseline="top",_i._ctx.font=_i._fontSize+"px Sans-serif",_i._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+_a+"px;top:"+_b+"px;width:"+_i._width/_c+"px;height:"+_i._height/_c+"px;"),_i._first=!0,_i.loop(),_i._first=!1,_M.container.appendChild(_i._canvas.source)},_i.createUI=function(_a,_b){var _c=_i._sp,_d=_M.pixelRatio;_c||(_c=new _la,(_i._leftText=new _qa).pos(5,5),_i._leftText.color="#ffffff",_c.addChild(_i._leftText),(_i._txt=new _qa).pos(80*_d,5),_i._txt.color="#ffffff",_c.addChild(_i._txt),_i._sp=_c),_c.pos(_a,_b);for(var _e="",_f=0;_f<_i._view.length;_f++){_e+=_i._view[_f].title+"\n"}_i._leftText.text=_e;var _g=170*_d,_h=_d*(12*_i._view.length+3*_d)+4;_i._txt.fontSize=_i._fontSize*_d,_i._leftText.fontSize=_i._fontSize*_d,_c.size(_g,_h),_c.graphics.clear(),_c.graphics.setAlpha(.5),_c.graphics.drawRect(0,0,_g,_h,"#999999"),_c.graphics.setAlpha(1),_i.loop()},_i.enable=function(){_x.timer.frameLoop(1,_i,_i.loop)},_i.hide=function(){_i._show=!1,_x.timer.clear(_i,_i.loop),_i._canvas&&_M.removeElement(_i._canvas.source)},_i.clear=function(){_i.trianglesFaces=_i.drawCall=_i.shaderCall=_i.spriteCount=_i.spriteRenderUseCacheCount=_i.treeNodeCollision=_i.treeSpriteCollision=_i.canvasNormal=_i.canvasBitmap=_i.canvasReCache=0},_i.loop=function(){_i._count++;var _a=_M.now();if(!(_a-_i._timer<1e3)){var _b=_i._count;if(_i.FPS=Math.round(1e3*_b/(_a-_i._timer)),_i._show){_i.trianglesFaces=Math.round(_i.trianglesFaces/_b),_i.spriteCount=_i._useCanvas?(_i.drawCall=Math.round(_i.drawCall/_b)-2,_i.shaderCall=Math.round(_i.shaderCall/_b),Math.round(_i.spriteCount/_b)-1):(_i.drawCall=Math.round(_i.drawCall/_b)-2,_i.shaderCall=Math.round(_i.shaderCall/_b)-4,Math.round(_i.spriteCount/_b)-4),_i.spriteRenderUseCacheCount=Math.round(_i.spriteRenderUseCacheCount/_b),_i.canvasNormal=Math.round(_i.canvasNormal/_b),_i.canvasBitmap=Math.round(_i.canvasBitmap/_b),_i.canvasReCache=Math.ceil(_i.canvasReCache/_b),_i.treeNodeCollision=Math.round(_i.treeNodeCollision/_b),_i.treeSpriteCollision=Math.round(_i.treeSpriteCollision/_b);var _c=0<_i.FPS?Math.floor(1e3/_i.FPS).toString():" ";_i._fpsStr=_i.FPS+(_i.renderSlow?" slow":"")+" "+_c,_i._spriteStr=_i.spriteCount+(_i.spriteRenderUseCacheCount?"/"+_i.spriteRenderUseCacheCount:""),_i._canvasStr=_i.canvasReCache+"/"+_i.canvasNormal+"/"+_i.canvasBitmap,_i.currentMemorySize=_L.systemResourceManager.memorySize,_i._useCanvas?_i.renderInfoPre():_i.renderInfo(),_i.clear()}_i._count=0,_i._timer=_a}},_i.renderInfoPre=function(){if(_i._canvas){var _a=_i._ctx;_a.clearRect(_i._first?0:_i._vx,0,_i._width,_i._height);for(var _b=_H.WebGL.mainContext,_c=0;_c<_i._view.length;_c++){var _d=_i._view[_c];_i._first&&(_a.fillStyle="white",_a.fillText(_d.title,_d.x,_d.y,null,null,null)),_a.fillStyle=_d.color;var _e=-1;if((_d=_i._view[_c]).varying){if(_b)switch(_d.varying){case 1:_e=_b.getParameter(_b[_d.value]);break;case 2:_e=_b.getExtension(_d.value)}}else _e=_i[_d.value];"M"==_d.units&&(_e=Math.floor(_e/1048576*100)/100+" M"),"K"==_d.units&&(_e=Math.floor(_e/1024*100)/100+" K"),"string"==_d.units&&(_e=_e.match(/\d+\.?\d/i)),_a.fillText(_e+"",_d.x+_i._vx,_d.y,null,null,null)}}},_i.renderInfo=function(){for(var _a="",_b=_H.WebGL.mainContext,_c=0;_c<_i._view.length;_c++){var _d=_i._view[_c],_e=-1;if(_d.varying){if(_b)switch(_d.varying){case 1:_e=_b.getParameter(_b[_d.value]);break;case 2:_e=_b.getExtension(_d.value)}}else _e=_i[_d.value];"M"==_d.units&&(_e=Math.floor(_e/1048576*100)/100+" M"),"K"==_d.units&&(_e=Math.floor(_e/1024*100)/100+" K"),"string"==_d.units&&(_e=_e.match(/\d+\.?\d/i)),_a+=_e+"\n"}_i._txt.text=_a},_i.FPS=0,_i.loopCount=0,_i.shaderCall=0,_i.drawCall=0,_i.trianglesFaces=0,_i.spriteCount=0,_i.spriteRenderUseCacheCount=0,_i.treeNodeCollision=0,_i.treeSpriteCollision=0,_i.canvasNormal=0,_i.canvasBitmap=0,_i.canvasReCache=0,_i.renderSlow=!1,_i.currentMemorySize=0,_i._fpsStr=null,_i._canvasStr=null,_i._spriteStr=null,_i._fpsData=[],_i._timer=0,_i._count=0,_i._view=[],_i._fontSize=12,_i._txt=null,_i._leftText=null,_i._sp=null,_i._show=!1,_i._useCanvas=!1,_i._canvas=null,_i._ctx=null,_i._first=!1,_i._vx=NaN,_i._width=0,_i._height=100,_i}(),_W=(function(){function _a(){this._strsToID={},this._idToStrs=[],this._length=0}_p(_a,"laya.utils.StringKey");var _b=_a.prototype;_b.add=function(_a){var _b=this._strsToID[_a];return null!=_b?_b:(this._idToStrs[this._length]=_a,this._strsToID[_a]=this._length++)},_b.getID=function(_a){var _b=this._strsToID[_a];return null==_b?-1:_b},_b.getName=function(_a){var _b=this._idToStrs[_a];return null==_b?void 0:_b}}(),function(){var _j;function _a(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map={},this._laters=[],this._handlers=[],this._temp=[],this._count=0,this._errorRecord=!1,this.currTimer=this._now(),this._lastTimer=this._now(),this._init()}_p(_a,"laya.utils.Timer");var _b=_a.prototype;return _b._init=function(){_x.timer&&_x.timer.frameLoop(1,this,this._update)},_b._now=function(){return Date.now()},_b._update=function(){if(this.scale<=0)this._lastTimer=this._now();else{var _a=this.currFrame=this.currFrame+this.scale,_b=this._now();this._delta=(_b-this._lastTimer)*this.scale;var _c=this.currTimer=this.currTimer+this._delta;_x.isDebug&&6e4<Math.abs(_b-this._lastTimer)&&console.error("系统时间错误！"+(_b-this._lastTimer)),this._lastTimer=_b;var _d=this._handlers;for(_g=this._count=0,_h=_d.length;_g<_h;_g++)if(null!==(_i=_d[_g]).method){var _e=_i.userFrame?_a:_c;if(_e>=_i.exeTime)if(_i.repeat)if(_i.jumpFrame)for(;_e>=_i.exeTime;)_i.exeTime+=_i.delay,_i.run(!1);else _i.exeTime+=_i.delay,_i.run(!1),_e>_i.exeTime&&(_i.exeTime+=Math.ceil((_e-_i.exeTime)/_i.delay)*_i.delay);else _i.run(!0)}else this._count++;(30<this._count||_a%200==0)&&this._clearHandlers();for(var _f=this._laters,_g=0,_h=_f.length-1;_g<=_h;_g++){var _i=_f[_g];this._isIgnoreRecover(_i)||(null!==_i.method&&(delete this._map[_i.key],_i.run(!1)),this._recoverHandler(_i)),_g===_h&&(_h=_f.length-1)}_f.length=0}},_b._clearHandlers=function(){for(var _a=this._handlers,_b=0,_c=_a.length;_b<_c;_b++){var _d=_a[_b];null!==_d.method?this._temp.push(_d):this._isIgnoreRecover(_d)?this._temp.push(_d):this._recoverHandler(_d)}this._handlers=this._temp,this._temp=_a,this._temp.length=0},_b._recoverHandler=function(_a){this._map[_a.key]==_a&&delete this._map[_a.key],_a.recover()},_b._create=function(_a,_b,_c,_d,_e,_f,_g,_h){if(!_c)return _e.apply(_d,_f),null;if(_g){var _i=this._getHandler(_d,_e);if(_i)return _i.repeat=_b,_i.userFrame=_a,_i.delay=_c,_i.ignoreRecover=_h,_i.caller=_d,_i.method=_e,_i.args=_f,_i.exeTime=_c+(_a?this.currFrame:this.currTimer+this._now()-this._lastTimer),_i}return(_i=_j.create()).repeat=_b,_i.userFrame=_a,_i.delay=_c,_i.ignoreRecover=_h,_i.caller=_d,_i.method=_e,_i.args=_f,_i.exeTime=_c+(_a?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1,this._indexHandler(_i),this._handlers.push(_i),_i},_b._indexHandler=function(_a){var _b=_a.caller,_c=_a.method,_d=_b?_b.$_GID||(_b.$_GID=_Y.getGID()):0,_e=_c.$_TID||(_c.$_TID=this._mid++);_a.key=_d+"_"+_e,this._map[_a.key]=_a},_b.once=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=!0),this._create(!1,!1,_a,_b,_c,_d,_e,!1)},_b.loop=function(_a,_b,_c,_d,_e,_f,_g){void 0===_e&&(_e=!0),void 0===_f&&(_f=!1),void 0===_g&&(_g=!1);var _h=this._create(!1,!0,_a,_b,_c,_d,_e,_g);_h&&(_h.jumpFrame=_f)},_b.frameOnce=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=!0),this._create(!0,!1,_a,_b,_c,_d,_e,!1)},_b.frameLoop=function(_a,_b,_c,_d,_e,_f){void 0===_e&&(_e=!0),void 0===_f&&(_f=!1),this._create(!0,!0,_a,_b,_c,_d,_e,_f)},_b.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+_j._freeCount},_b.clear=function(_a,_b){var _c=this._getHandler(_a,_b);return!(!_c||this._isIgnoreRecover(_c))&&(delete this._map[_c.key],_c.key=null,_c.clear(),!0)},_b.clearAll=function(_a){if(_a)for(var _b=0,_c=this._handlers.length;_b<_c;_b++){var _d=this._handlers[_b];_d.caller===_a&&(this._isIgnoreRecover(_d)||(delete this._map[_d.key],_d.key=null,_d.clear()))}},_b._getHandler=function(_a,_b){var _c=_a?_a.$_GID||(_a.$_GID=_Y.getGID()):0,_d=_b.$_TID||(_b.$_TID=this._mid++);return this._map[_c+"_"+_d]},_b._isIgnoreRecover=function(_a){if(_a.ignoreRecover||_a.caller&&"IgnoreRecover"==_a.caller.callername){if(this._errorRecord)console.warn("核心定时器销毁忽略");else{this._errorRecord=!0;var _b="";try{arguments.propertyIsEnumerable.caller}catch(_a){_b=_a.stack}_x.recordError("报错：核心定时器销毁忽略  "+_b)}return!0}return!1},_b.hasHandler=function(_a,_b){return this._map[_a.$_GID+"_"+_b.$_TID]},_b.callLater=function(_a,_b,_c){if(null==this._getHandler(_a,_b)){var _d=_j.create();_d.caller=_a,_d.method=_b,_d.args=_c,this._indexHandler(_d),this._laters.push(_d)}},_b.runCallLater=function(_a,_b){var _c=this._getHandler(_a,_b);_c&&null!=_c.method&&(this._isIgnoreRecover(_c)||(delete this._map[_c.key],_c.run(!0)))},_b.runTimer=function(_a,_b){this.runCallLater(_a,_b)},_k(0,_b,"delta",function(){return this._delta}),_a.__init$=function(){_j=function(){function _b(){this.key=null,this.repeat=!1,this.delay=0,this.userFrame=!1,this.ignoreRecover=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}_p(_b,"");var _a=_b.prototype;return _a.clear=function(){this.caller=null,this.method=null,this.args=null,this.ignoreRecover=!1},_a.recover=function(){this.clear(),this.args=_b._freeHandler,_b._freeHandler=this,_b._freeCount++},_a.run=function(_a){var _b=this.caller;if(_b&&_b.destroyed)return this.clear();var _c=this.method,_d=this.args;_a&&this.clear(),null!=_c&&(_d?_c.apply(_b,_d):_c.call(_b))},_b._freeHandler=null,_b._freeCount=0,_b.create=function(){var _a=_b._freeHandler;return _a?(_b._freeHandler=_a.args,--_b._freeCount,_a.args=null,_a):new _b},_b}()},_a}()),_X=function(){function _l(){this.gid=0}_p(_l,"laya.utils.Tween");var _a=_l.prototype;return _a.to=function(_a,_b,_c,_d,_e,_f,_g){return void 0===_f&&(_f=0),void 0===_g&&(_g=!1),this._create(_a,_b,_c,_d,_e,_f,_g,!0,!1,!0)},_a.from=function(_a,_b,_c,_d,_e,_f,_g){return void 0===_f&&(_f=0),void 0===_g&&(_g=!1),this._create(_a,_b,_c,_d,_e,_f,_g,!1,!1,!0)},_a._create=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){if(!_a)throw new Error("Tween:target is null");this._target=_a,this._duration=_c,this._ease=_d||_b.ease||_l.easeNone,this._complete=_e||_b.complete,this._delay=_f,this._props=[],this._usedTimer=0,this._startTimer=_M.now(),this._usedPool=_i,this._delayParam=null,this.update=_b.update;var _k=_a.$_GID||(_a.$_GID=_Y.getGID());return _l.tweenMap[_k]?(_g&&_l.clearTween(_a),_l.tweenMap[_k].push(this)):_l.tweenMap[_k]=[this],_j?_f<=0?this.firstStart(_a,_b,_h):(this._delayParam=[_a,_b,_h],_x.scaleTimer.once(_f,this,this.firstStart,this._delayParam)):this._initProps(_a,_b,_h),this},_a.firstStart=function(_a,_b,_c){this._delayParam=null,_a.destroyed?this.clear():(this._initProps(_a,_b,_c),this._beginLoop())},_a._initProps=function(_a,_b,_c){for(var _d in _b)if("number"==typeof _a[_d]){var _e=_c?_a[_d]:_b[_d],_f=_c?_b[_d]:_a[_d];this._props.push([_d,_e,_f-_e]),_c||(_a[_d]=_e)}},_a._beginLoop=function(){_x.scaleTimer.frameLoop(1,this,this._doEase)},_a._doEase=function(){this._updateEase(_M.now())},_a._updateEase=function(_a){var _b=this._target;if(_b){if(_b.destroyed)return _l.clearTween(_b);var _c=this._usedTimer=_a-this._startTimer-this._delay;if(!(_c<0)){if(_c>=this._duration)return this.complete();for(var _d=0<_c?this._ease(_c,0,1,this._duration):0,_e=this._props,_f=0,_g=_e.length;_f<_g;_f++){var _h=_e[_f];_b[_h[0]]=_h[1]+_d*_h[2]}this.update&&this.update.run()}}},_a.complete=function(){if(this._target){_x.scaleTimer.runTimer(this,this.firstStart);for(var _a=this._target,_b=this._props,_c=this._complete,_d=0,_e=_b.length;_d<_e;_d++){var _f=_b[_d];_a[_f[0]]=_f[1]+_f[2]}this.update&&this.update.run(),this.clear(),_c&&_c.run()}},_a.pause=function(){_x.scaleTimer.clear(this,this._beginLoop),_x.scaleTimer.clear(this,this._doEase),_x.scaleTimer.clear(this,this.firstStart);var _a;(_a=_M.now()-this._startTimer-this._delay)<0&&(this._usedTimer=_a)},_a.setStartTime=function(_a){this._startTimer=_a},_a.clear=function(){this._target&&(this._remove(),this._clear())},_a._clear=function(){this.pause(),_x.scaleTimer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,_U.recover("tween",this))},_a.recover=function(){this._usedPool=!0,this._clear()},_a._remove=function(){var _a=_l.tweenMap[this._target.$_GID];if(_a)for(var _b=0,_c=_a.length;_b<_c;_b++)if(_a[_b]===this){_a.splice(_b,1);break}},_a.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=_M.now(),this._delayParam)_x.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var _a=this._props,_b=0,_c=_a.length;_b<_c;_b++){var _d=_a[_b];this._target[_d[0]]=_d[1]}_x.scaleTimer.once(this._delay,this,this._beginLoop)}},_a.resume=function(){this._usedTimer>=this._duration||(this._startTimer=_M.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?_x.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},_k(0,_a,"progress",null,function(_a){var _b=_a*this._duration;this._startTimer=_M.now()-this._delay-_b}),_l.to=function(_a,_b,_c,_d,_e,_f,_g,_h){return void 0===_f&&(_f=0),void 0===_g&&(_g=!1),void 0===_h&&(_h=!0),_U.getItemByClass("tween",_l)._create(_a,_b,_c,_d,_e,_f,_g,!0,_h,!0)},_l.from=function(_a,_b,_c,_d,_e,_f,_g,_h){return void 0===_f&&(_f=0),void 0===_g&&(_g=!1),void 0===_h&&(_h=!0),_U.getItemByClass("tween",_l)._create(_a,_b,_c,_d,_e,_f,_g,!1,_h,!0)},_l.clearAll=function(_a){if(_a&&_a.$_GID){var _b=_l.tweenMap[_a.$_GID];if(_b){for(var _c=0,_d=_b.length;_c<_d;_c++)_b[_c]._clear();_b.length=0}}},_l.clear=function(_a){_a.clear()},_l.clearTween=function(_a){_l.clearAll(_a)},_l.easeNone=function(_a,_b,_c,_d){return _c*_a/_d+_b},_l.tweenMap={},_l}(),_Y=function(){function _h(){}return _p(_h,"laya.utils.Utils"),_h.toRadian=function(_a){return _a*_h._pi2},_h.toAngle=function(_a){return _a*_h._pi},_h.toHexColor=function(_a){if(_a<0||isNaN(_a))return null;for(var _b=_a.toString(16);_b.length<6;)_b="0"+_b;return"#"+_b},_h.getGID=function(){return _h._gid++},_h.concatArray=function(_a,_b){if(!_b)return _a;if(!_a)return _b;var _c=0,_d=_b.length;for(_c=0;_c<_d;_c++)_a.push(_b[_c]);return _a},_h.clearArray=function(_a){return _a&&(_a.length=0),_a},_h.copyArray=function(_a,_b){if(_a||(_a=[]),!_b)return _a;_a.length=_b.length;var _c=0,_d=_b.length;for(_c=0;_c<_d;_c++)_a[_c]=_b[_c];return _a},_h.getGlobalRecByPoints=function(_a,_b,_c,_d,_e){var _f,_g;return _f=new _y(_b,_c),_f=_a.localToGlobal(_f),_g=new _y(_d,_e),_g=_a.localToGlobal(_g),_z._getWrapRec([_f.x,_f.y,_g.x,_g.y])},_h.getGlobalPosAndScale=function(_a){return _h.getGlobalRecByPoints(_a,0,0,1,1)},_h.bind=function(_a,_b){return _a.bind(_b)},_h.measureText=function(_a,_b){return _D.measureText(_a,_b)},_h.contextMeasureText=function(_a){var _b=_M.context.measureText(_a);return _b||(_b={width:16,height:16}),_b},_h.updateOrder=function(_a){if(!_a||_a.length<2)return!1;for(var _b,_c=1,_d=0,_e=_a.length,_f=NaN;_c<_e;){for(_b=_a[_d=_c],_f=_a[_d]._zOrder;-1<--_d&&_a[_d]._zOrder>_f;)_a[_d+1]=_a[_d];_a[_d+1]=_b,_c++}var _g=_b.parent.conchModel;if(_g)if(null!=_g.updateZOrder)_g.updateZOrder();else{for(_c=0;_c<_e;_c++)_g.removeChild(_a[_c].conchModel);for(_c=0;_c<_e;_c++)_g.addChildAt(_a[_c].conchModel,_c)}return!0},_h.transPointList=function(_a,_b,_c){var _d=0,_e=_a.length;for(_d=0;_d<_e;_d+=2)_a[_d]+=_b,_a[_d+1]+=_c},_h.parseInt=function(_a,_b){void 0===_b&&(_b=0);var _c=_M.window.parseInt(_a,_b);return isNaN(_c)?0:_c},_h.getFileExtension=function(_a){_h._extReg.lastIndex=_a.lastIndexOf(".");var _b=_h._extReg.exec(_a);return _b&&1<_b.length?_b[1].toLowerCase():null},_h.getTransformRelativeToWindow=function(_a,_b,_c){var _d=_x.stage,_e=laya.utils.Utils.getGlobalPosAndScale(_a),_f=_d._canvasTransform.clone(),_g=_f.tx,_h=_f.ty;_f.rotate(-Math.PI/180*_x.stage.canvasDegree),_f.scale(_x.stage.clientScaleX,_x.stage.clientScaleY);var _i=_x.stage.canvasDegree%180!=0,_j=NaN,_k=NaN;_i?(_j=_c+_e.y,_k=_b+_e.x,_j*=_f.d,_k*=_f.a,90==_x.stage.canvasDegree?(_j=_g-_j,_k+=_h):(_j+=_g,_k=_h-_k)):(_j=_b+_e.x,_k=_c+_e.y,_j*=_f.a,_k*=_f.d,_j+=_g,_k+=_h);var _l=NaN,_m=NaN;return _m=_i?(_l=_f.d*_e.height,_f.a*_e.width):(_l=_f.a*_e.width,_f.d*_e.height),{x:_j,y:_k,scaleX:_l,scaleY:_m}},_h.fitDOMElementInArea=function(_a,_b,_c,_d,_e,_f){_a._fitLayaAirInitialized||(_a._fitLayaAirInitialized=!0,_a.style.transformOrigin=_a.style.webKittransformOrigin="left top",_a.style.position="absolute");var _g=_h.getTransformRelativeToWindow(_b,_c,_d);_a.style.transform=_a.style.webkitTransform="scale("+_g.scaleX+","+_g.scaleY+") rotate("+_x.stage.canvasDegree+"deg)",_a.style.width=_e+"px",_a.style.height=_f+"px",_a.style.left=_g.x+"px",_a.style.top=_g.y+"px"},_h.isOkTextureList=function(_a){if(!_a)return!1;var _b,_c=0,_d=_a.length;for(_c=0;_c<_d;_c++)if(!(_b=_a[_c])||!_b.source)return!1;return!0},_h.isOKCmdList=function(_a){if(!_a)return!1;var _b,_c,_d=0,_e=_a.length,_f=_H._context;for(_d=0;_d<_e;_d++)switch((_b=_a[_d]).callee){case _f._drawTexture:case _f._fillTexture:case _f._drawTextureWithTransform:if(!(_c=_b[0])||!_c.source)return!1}return!0},_h._gid=1,_h._pi=180/Math.PI,_h._pi2=Math.PI/180,_h._extReg=/\.(\w+)\??/g,_h.parseXMLFromString=function(_a){var _b;if(_a=_a.replace(/>\s+</g,"><"),-1<(_b=(new DOMParser).parseFromString(_a,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(_b.firstChild.firstChild.textContent);return _b},_h}(),_Z=function(){function _a(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],_H.isWebGL&&_O.regCacheByFunction(_Y.bind(this.startDispose,this),_Y.bind(this.getCacheList,this))}_p(_a,"laya.utils.VectorGraphManager");var _b=_a.prototype;return _b.getId=function(){return this._id++},_b.addShape=function(_a,_b){this.shapeDic[_a]=_b,this.useDic[_a]||(this.useDic[_a]=!0)},_b.addLine=function(_a,_b){this.shapeLineDic[_a]=_b,this.shapeLineDic[_a]||(this.shapeLineDic[_a]=!0)},_b.getShape=function(_a){this._checkKey&&null!=this.useDic[_a]&&(this.useDic[_a]=!0)},_b.deleteShape=function(_a){this.shapeDic[_a]&&(this.shapeDic[_a]=null,delete this.shapeDic[_a]),this.shapeLineDic[_a]&&(this.shapeLineDic[_a]=null,delete this.shapeLineDic[_a]),null!=this.useDic[_a]&&delete this.useDic[_a]},_b.getCacheList=function(){var _a,_b=[];for(_a in this.shapeDic)_b.push(this.shapeDic[_a]);for(_a in this.shapeLineDic)_b.push(this.shapeLineDic[_a]);return _b},_b.startDispose=function(_a){var _b;for(_b in this.useDic)this.useDic[_b]=!1;this._checkKey=!0},_b.endDispose=function(){if(this._checkKey){var _a;for(_a in this.useDic)this.useDic[_a]||this.deleteShape(_a);this._checkKey=!1}},_a.getInstance=function(){return _a.instance=_a.instance||new _a},_a.instance=null,_a}(),_$=function(){function _d(){this._obj=null,this._obj=_d.supportWeakMap?new _M.window.WeakMap:{},_d.supportWeakMap||_d._maps.push(this)}_p(_d,"laya.utils.WeakObject");var _a=_d.prototype;return _a.set=function(_a,_b){if(null!=_a)if(_d.supportWeakMap){var _c=_a;"string"!=typeof _a&&"number"!=typeof _a||(_c=_d._keys[_a])||(_c=_d._keys[_a]={k:_a}),this._obj.set(_c,_b)}else"string"==typeof _a||"number"==typeof _a?this._obj[_a]=_b:(_a.$_GID||(_a.$_GID=_Y.getGID()),this._obj[_a.$_GID]=_b)},_a.get=function(_a){if(null==_a)return null;if(_d.supportWeakMap){var _b="string"==typeof _a||"number"==typeof _a?_d._keys[_a]:_a;return _b?this._obj.get(_b):null}return"string"==typeof _a||"number"==typeof _a?this._obj[_a]:this._obj[_a.$_GID]},_a.del=function(_a){if(null!=_a)if(_d.supportWeakMap){var _b="string"==typeof _a||"number"==typeof _a?_d._keys[_a]:_a;if(!_b)return;this._obj.delete(_b)}else"string"==typeof _a||"number"==typeof _a?delete this._obj[_a]:delete this._obj[this._obj.$_GID]},_a.has=function(_a){if(null==_a)return!1;if(_d.supportWeakMap){var _b="string"==typeof _a||"number"==typeof _a?_d._keys[_a]:_a;return this._obj.has(_b)}return"string"==typeof _a||"number"==typeof _a?null!=this._obj[_a]:null!=this._obj[this._obj.$_GID]},_d.__init__=function(){(_d.supportWeakMap=null!=_M.window.WeakMap)||_x.timer.loop(_d.delInterval,null,_d.clearCache)},_d.clearCache=function(){for(var _a=0,_b=_d._maps.length;_a<_b;_a++){_d._maps[_a]._obj={}}},_d.supportWeakMap=!1,_d.delInterval=3e5,_d._keys={},_d._maps=[],_i(_d,["I",function(){return this.I=new _d}]),_d}(),__=function(){function _a(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}_p(_a,"laya.utils.WordText");var _b=_a.prototype;return _b.setText=function(_a){this.changed=!0,this._text=_a},_b.toString=function(){return this._text},_b.charCodeAt=function(_a){return this._text?this._text.charCodeAt(_a):NaN},_b.charAt=function(_a){return this._text?this._text.charAt(_a):null},_k(0,_b,"length",function(){return this._text?this._text.length:0}),_a}(),_aa=function(_a){function _g(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this._destroyed=!1,_g.__super.call(this),this._childs=_g.ARRAY_EMPTY,this._$P=_g.PROP_EMPTY,this.timer=_x.scaleTimer,this.conchModel=_H.isConchNode?this.createConchModel():null}_p(_g,"laya.display.Node",_j);var _b=_g.prototype;return _b._setBit=function(_a,_b){1==_a&&(this._getBit(_a)!=_b&&this._updateDisplayedInstage());_b?this._bits|=_a:this._bits&=~_a},_b._getBit=function(_a){return 0!=(this._bits&_a)},_b._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},_b._setUpNoticeType=function(_a){var _b=this;for(_b._setBit(_a,!0),_b=_b.parent;_b;){if(_b._getBit(_a))return;_b._setBit(_a,!0),_b=_b.parent}},_b.on=function(_a,_b,_c,_d){return"display"!==_a&&"undisplay"!==_a||this._getBit(1)||this._setUpNoticeType(1),this._createListener(_a,_b,_c,_d,!1)},_b.once=function(_a,_b,_c,_d){return"display"!==_a&&"undisplay"!==_a||this._getBit(1)||this._setUpNoticeType(1),this._createListener(_a,_b,_c,_d,!0)},_b.createConchModel=function(){return null},_b.destroy=function(_a){void 0===_a&&(_a=!0),this._destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(_a?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},_b.destroyChildren=function(){if(this._childs)for(var _a=this._childs.length-1;-1<_a;_a--)this._childs[_a].destroy(!0)},_b.addChild=function(_a){if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),_a._parent===this){var _b=this.getChildIndex(_a);_b!==this._childs.length-1&&(this._childs.splice(_b,1),this._childs.push(_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,this._childs.length-1)),this._childChanged())}else _a.parent&&_a.parent.removeChild(_a),this._childs===_g.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,this._childs.length-1),(_a.parent=this)._childChanged();return _a},_b.addChildren=function(_a){for(var _b=arguments,_c=0,_d=_b.length;_c<_d;)this.addChild(_b[_c++])},_b.addChildAt=function(_a,_b){if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),0<=_b&&_b<=this._childs.length){if(_a._parent===this){var _c=this.getChildIndex(_a);this._childs.splice(_c,1),this._childs.splice(_b,0,_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,_b)),this._childChanged()}else _a.parent&&_a.parent.removeChild(_a),this._childs===_g.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(_b,0,_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,_b),_a.parent=this;return _a}throw new Error("appendChildAt:The index is out of bounds")},_b.getChildIndex=function(_a){return this._childs.indexOf(_a)},_b.getChildByName=function(_a){var _b=this._childs;if(_b)for(var _c=0,_d=_b.length;_c<_d;_c++){var _e=_b[_c];if(_e.name===_a)return _e}return null},_b._get$P=function(_a){return this._$P[_a]},_b._set$P=function(_a,_b){return this.destroyed||(this._$P===_g.PROP_EMPTY&&(this._$P={}),this._$P[_a]=_b),_b},_b.getChildAt=function(_a){return this._childs[_a]},_b.setChildIndex=function(_a,_b){var _c=this._childs;if(_b<0||_b>=_c.length)throw new Error("setChildIndex:The index is out of bounds.");var _d=this.getChildIndex(_a);if(_d<0)throw new Error("setChildIndex:node is must child of this object.");return _c.splice(_d,1),_c.splice(_b,0,_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,_b)),this._childChanged(),_a},_b._childChanged=function(_a){},_b.removeChild=function(_a){if(!this._childs)return _a;var _b=this._childs.indexOf(_a);return this.removeChildAt(_b)},_b.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},_b.removeChildByName=function(_a){var _b=this.getChildByName(_a);return _b&&this.removeChild(_b),_b},_b.removeChildAt=function(_a){var _b=this.getChildAt(_a);if(_b){for(var _c=this._childs.length-1,_d=_a;_d<_c;++_d)this._childs[_d]=this._childs[_d+1];this._childs.length=_c,this.conchModel&&this.conchModel.removeChild(_b.conchModel),_b.parent=null}return _b},_b.removeChildren=function(_a,_b){if(void 0===_a&&(_a=0),void 0===_b&&(_b=2147483647),this._childs&&0<this._childs.length){var _c=this._childs;if(0===_a&&_f<=_b){var _d=_c;this._childs=_g.ARRAY_EMPTY}else _d=_c.splice(_a,_b-_a);for(var _e=0,_f=_d.length;_e<_f;_e++)_d[_e].parent=null,this.conchModel&&this.conchModel.removeChild(_d[_e].conchModel)}return this},_b.replaceChild=function(_a,_b){var _c=this._childs.indexOf(_b);return-1<_c?(this._childs.splice(_c,1,_a),this.conchModel&&(this.conchModel.removeChild(_b.conchModel),this.conchModel.addChildAt(_a.conchModel,_c)),_b.parent=null,_a.parent=this,_a):null},_b._updateDisplayedInstage=function(){var _a;_a=this;var _b=_x.stage;for(this._displayedInStage=!1;_a;){if(_a._getBit(1)){this._displayedInStage=_a._displayedInStage;break}if(_a==_b||_a._displayedInStage){this._displayedInStage=!0;break}_a=_a.parent}},_b._setDisplay=function(_a){this._displayedInStage!==_a&&((this._displayedInStage=_a)?this.event("display"):this.event("undisplay"))},_b._displayChild=function(_a,_b){var _c=_a._childs;if(_c)for(var _d=0;_d<_c.length;_d++){var _e=_c[_d];_e&&_e._getBit(1)&&(0<_e._childs.length?this._displayChild(_e,_b):_e._setDisplay(_b))}_a._setDisplay(_b)},_b.contains=function(_a){if(_a===this)return!0;for(;_a;){if(_a.parent===this)return!0;_a=_a.parent}return!1},_b.timerLoop=function(_a,_b,_c,_d,_e,_f){void 0===_e&&(_e=!0),void 0===_f&&(_f=!1),this.timer.loop(_a,_b,_c,_d,_e,_f)},_b.timerOnce=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=!0),this.timer._create(!1,!1,_a,_b,_c,_d,_e)},_b.frameLoop=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=!0),this.timer._create(!0,!0,_a,_b,_c,_d,_e)},_b.frameOnce=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=!0),this.timer._create(!0,!1,_a,_b,_c,_d,_e)},_b.clearTimer=function(_a,_b){this.timer.clear(_a,_b)},_k(0,_b,"numChildren",function(){return this._childs.length}),_k(0,_b,"destroyed",function(){return this._destroyed}),_k(0,_b,"parent",function(){return this._parent},function(_a){this._parent!==_a&&(_a?(this._parent=_a,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),_a.displayedInStage&&this._displayChild(this,!0)),_a._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=_a))}),_k(0,_b,"displayedInStage",function(){return this._getBit(1)||this._setUpNoticeType(1),this._displayedInStage}),_g.ARRAY_EMPTY=[],_g.PROP_EMPTY={},_g.NOTICE_DISPLAY=1,_g.MOUSEENABLE=2,_g}(),_ba=function(_a){function _m(_a){this._bgground=null,this._border=null,this._rect=null,this.underLine=0,this.lineHeight=0,_m.__super.call(this),this._padding=_m._PADDING,this._spacing=_m._SPACING,this._aligns=_m._ALIGNS,this._font=_n.EMPTY,this._ower=_a}_p(_m,"laya.display.css.CSSStyle",_a);var _b=_m.prototype;return _b.destroy=function(){this._ower=null,this._font=null,this._rect=null},_b.inherit=function(_a){this._font=_a._font,this._spacing=_a._spacing===_m._SPACING?_m._SPACING:_a._spacing.slice(),this.lineHeight=_a.lineHeight},_b._widthAuto=function(){return 0!=(262144&this._type)},_b.widthed=function(_a){return 0!=(8&this._type)},_b._calculation=function(_a,_b){if(_b.indexOf("%")<0)return!1;var _d=this._ower,_e=_d.parent,_f=this._rect;function _g(_a,_b,_c){return _a*_c[0]+_b*_c[1]+_c[2]}function _c(_a){var _b=_e.width,_c=_d.width;_f.width&&(_d.width=_g(_b,_c,_f.width)),_f.height&&(_d.height=_g(_b,_c,_f.height)),_f.left&&(_d.x=_g(_b,_c,_f.left)),_f.top&&(_d.y=_g(_b,_c,_f.top))}null===_f&&(_e._getCSSStyle()._type|=524288,_e.on("resize",this,_c),this._rect=_f={input:{}});var _h=_b.split(" ");return _h[0]=parseFloat(_h[0])/100,1==_h.length?_h[1]=_h[2]=0:(_h[1]=parseFloat(_h[1])/100,_h[2]=parseFloat(_h[2])),_f[_a]=_h,_f.input[_a]=_b,_c(),!0},_b.heighted=function(_a){return 0!=(8192&this._type)},_b.size=function(_a,_b){var _c=this._ower,_d=!1;-1!==_a&&_a!=this._ower.width&&(this._type|=8,this._ower.width=_a,_d=!0),-1!==_b&&_b!=this._ower.height&&(this._type|=8192,this._ower.height=_b,_d=!0),_d&&(_c._layoutLater(),524288&this._type&&_c.event("resize",this))},_b._getAlign=function(){return this._aligns[0]},_b._getValign=function(){return this._aligns[1]},_b._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},_b._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new _n(this._font))},_b.render=function(_a,_b,_c,_d){var _e=_a.width,_f=_a.height;_c-=_a.pivotX,_d-=_a.pivotY,this._bgground&&null!=this._bgground.color&&_b.ctx.fillRect(_c,_d,_e,_f,this._bgground.color),this._border&&this._border.color&&_b.drawRect(_c,_d,_e,_f,this._border.color.strColor,this._border.size)},_b.getCSSStyle=function(){return this},_b.cssText=function(_a){this.attrs(_m.parseOneCSS(_a,";"))},_b.attrs=function(_a){if(_a)for(var _b=0,_c=_a.length;_b<_c;_b++){var _d=_a[_b];this[_d[0]]=_d[1]}},_b.setTransform=function(_a){"none"===_a?this._tf=_h._TF_EMPTY:this.attrs(_m.parseOneCSS(_a,","))},_b.translate=function(_a,_b){this._tf===_h._TF_EMPTY&&(this._tf=new _e),this._tf.translateX=_a,this._tf.translateY=_b},_b.scale=function(_a,_b){this._tf===_h._TF_EMPTY&&(this._tf=new _e),this._tf.scaleX=_a,this._tf.scaleY=_b},_b._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},_k(0,_b,"block",_a.prototype._$get_block,function(_a){_a?this._type|=1:this._type&=-2}),_k(0,_b,"valign",function(){return _m._valigndef[this._aligns[1]]},function(_a){this._aligns===_m._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=_m._valigndef[_a]}),_k(0,_b,"height",null,function(_a){if(this._type|=8192,"string"==typeof _a){if(this._calculation("height",_a))return;_a=parseInt(_a)}this.size(-1,_a)}),_k(0,_b,"width",null,function(_a){if(this._type|=8,"string"==typeof _a){var _b=_a.indexOf("auto");if(0<=_b&&(this._type|=262144,_a=_a.substr(0,_b)),this._calculation("width",_a))return;_a=parseInt(_a)}this.size(_a,-1)}),_k(0,_b,"fontWeight",function(){return this._font.weight},function(_a){this._createFont().weight=_a}),_k(0,_b,"left",null,function(_a){var _b=this._ower;if("string"==typeof _a){if("center"===_a?_a="50% -50% 0":"right"===_a&&(_a="100% -100% 0"),this._calculation("left",_a))return;_a=parseInt(_a)}_b.x=_a}),_k(0,_b,"_translate",null,function(_a){this.translate(_a[0],_a[1])}),_k(0,_b,"absolute",function(){return 0!=(4&this._type)}),_k(0,_b,"top",null,function(_a){var _b=this._ower;if("string"==typeof _a){if("middle"===_a?_a="50% -50% 0":"bottom"===_a&&(_a="100% -100% 0"),this._calculation("top",_a))return;_a=parseInt(_a)}_b.y=_a}),_k(0,_b,"align",function(){return _m._aligndef[this._aligns[0]]},function(_a){this._aligns===_m._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=_m._aligndef[_a]}),_k(0,_b,"bold",function(){return this._font.bold},function(_a){this._createFont().bold=_a}),_k(0,_b,"padding",function(){return this._padding},function(_a){this._padding=_a}),_k(0,_b,"leading",function(){return this._spacing[1]},function(_a){"string"==typeof _a&&(_a=parseInt(_a+"")),this._spacing===_m._SPACING&&(this._spacing=[0,0]),this._spacing[1]=_a}),_k(0,_b,"lineElement",function(){return 0!=(65536&this._type)},function(_a){_a?this._type|=65536:this._type&=-65537}),_k(0,_b,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(_a){this.lineElement=!1,"right"===_a?this._type|=32768:this._type&=-32769}),_k(0,_b,"textDecoration",function(){return this._font.decoration},function(_a){this._createFont().decoration=_a}),_k(0,_b,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(_a){"nowrap"===_a&&(this._type|=131072),"none"===_a&&(this._type&=-131073)}),_k(0,_b,"background",null,function(_a){_a?(this._bgground||(this._bgground={}),this._bgground.color=_a,this._ower.conchModel&&this._ower.conchModel.bgColor(_a),this._type|=16384,this._ower._renderType|=256):this._bgground=null}),_k(0,_b,"wordWrap",function(){return 0==(131072&this._type)},function(_a){_a?this._type&=-131073:this._type|=131072}),_k(0,_b,"color",function(){return this._font.color},function(_a){this._createFont().color=_a}),_k(0,_b,"password",function(){return this._font.password},function(_a){this._createFont().password=_a}),_k(0,_b,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(_a){"none"===_a?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=_a),this._ower.conchModel&&this._ower.conchModel.bgColor(_a),this._ower._renderType|=256}),_k(0,_b,"font",function(){return this._font.toString()},function(_a){this._createFont().set(_a)}),_k(0,_b,"weight",null,function(_a){this._createFont().weight=_a}),_k(0,_b,"letterSpacing",function(){return this._spacing[0]},function(_a){"string"==typeof _a&&(_a=parseInt(_a+"")),this._spacing===_m._SPACING&&(this._spacing=[0,0]),this._spacing[0]=_a}),_k(0,_b,"fontSize",function(){return this._font.size},function(_a){this._createFont().size=_a}),_k(0,_b,"italic",function(){return this._font.italic},function(_a){this._createFont().italic=_a}),_k(0,_b,"fontFamily",function(){return this._font.family},function(_a){this._createFont().family=_a}),_k(0,_b,"stroke",function(){return this._font.stroke[0]},function(_a){this._createFont().stroke===_n._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=_a}),_k(0,_b,"strokeColor",function(){return this._font.stroke[1]},function(_a){this._createFont().stroke===_n._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=_a}),_k(0,_b,"border",function(){return this._border?this._border.value:""},function(_a){if("none"!=_a){this._border||(this._border={});var _b=(this._border.value=_a).split(" ");if(this._border.color=_Q.create(_b[_b.length-1]),1==_b.length)return this._border.size=1,void(this._border.type="solid");var _c=0;0<_b[0].indexOf("px")?(this._border.size=parseInt(_b[0]),_c++):this._border.size=1,this._border.type=_b[_c],this._ower._renderType|=256}else this._border=null}),_k(0,_b,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(_a){_a?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==_a?null:_Q.create(_a),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),this._ower._renderType|=256):this._border=null}),_k(0,_b,"position",function(){return 4&this._type?"absolute":""},function(_a){"absolute"==_a?this._type|=4:this._type&=-5}),_k(0,_b,"display",null,function(_a){switch(_a){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),_k(0,_b,"paddingLeft",function(){return this.padding[3]}),_k(0,_b,"paddingTop",function(){return this.padding[0]}),_k(0,_b,"_scale",null,function(_a){this._ower.scale(_a[0],_a[1])}),_k(0,_b,"_rotate",null,function(_a){this._ower.rotation=_a}),_m.parseOneCSS=function(_a,_b){for(var _c,_d=[],_e=_a.split(_b),_f=0,_g=_e.length;_f<_g;_f++){var _h=_e[_f],_i=_h.indexOf(":"),_j=_h.substr(0,_i).replace(/^\s+|\s+$/g,"");if(0!=_j.length){var _k=_h.substr(_i+1).replace(/^\s+|\s+$/g,""),_l=[_j,_k];switch(_j){case"italic":case"bold":_l[1]="true"==_k;break;case"line-height":_l[0]="lineHeight",_l[1]=parseInt(_k);break;case"font-size":_l[0]="fontSize",_l[1]=parseInt(_k);break;case"padding":1<(_c=_k.split(" ")).length||(_c[1]=_c[2]=_c[3]=_c[0]),_l[1]=[parseInt(_c[0]),parseInt(_c[1]),parseInt(_c[2]),parseInt(_c[3])];break;case"rotate":_l[0]="_rotate",_l[1]=parseFloat(_k);break;case"scale":_c=_k.split(" "),_l[0]="_scale",_l[1]=[parseFloat(_c[0]),parseFloat(_c[1])];break;case"translate":_c=_k.split(" "),_l[0]="_translate",_l[1]=[parseInt(_c[0]),parseInt(_c[1])];break;default:(_l[0]=_m._CSSTOVALUE[_j])||(_l[0]=_j)}_d.push(_l)}}return _d},_m.parseCSS=function(_a,_b){for(var _c;null!=(_c=_m._parseCSSRegExp.exec(_a));)_m.styleSheets[_c[1]]=_m.parseOneCSS(_c[2],";")},_m.EMPTY=new _m(null),_m._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},_m._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),_m._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},_m._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},_m.styleSheets={},_m.ALIGN_CENTER=1,_m.ALIGN_RIGHT=2,_m.VALIGN_MIDDLE=1,_m.VALIGN_BOTTOM=2,_m._CSS_BLOCK=1,_m._DISPLAY_NONE=2,_m._ABSOLUTE=4,_m._WIDTH_SET=8,_m._PADDING=[0,0,0,0],_m._RECT=[-1,-1,-1,-1],_m._SPACING=[0,0],_m._ALIGNS=[0,0,0],_m.ADDLAYOUTED=512,_m._NEWFONT=4096,_m._HEIGHT_SET=8192,_m._BACKGROUND_SET=16384,_m._FLOAT_RIGHT=32768,_m._LINE_ELEMENT=65536,_m._NOWARP=131072,_m._WIDTHAUTO=262144,_m._LISTERRESZIE=524288,_m}(_h),_ca=function(_a){function _g(){this.url=null,this.audio=null,this.loaded=!1,_g.__super.call(this)}_p(_g,"laya.media.h5audio.AudioSound",_j);var _b=_g.prototype;return _b.dispose=function(){var _a=_g._audioCache[this.url];_a&&(_a.src="",delete _g._audioCache[this.url])},_b.load=function(_a){var _b;if(_a=_G.formatURL(_a),(this.url=_a)==_C._tMusic?(_g._initMusicAudio(),(_b=_g._musicAudio).src!=_a&&(_g._audioCache[_b.src]=null,_b=null)):_b=_g._audioCache[_a],_b&&2<=_b.readyState)this.event("complete");else{_b||(_b=_a==_C._tMusic?(_g._initMusicAudio(),_g._musicAudio):_M.createElement("audio"),(_g._audioCache[_a]=_b).src=_a),_b.addEventListener("canplaythrough",_d),_b.addEventListener("error",_e);var _c=this;(this.audio=_b).load?_b.load():_e()}function _d(){_f(),_c.loaded=!0,_c.event("complete")}function _e(){_b.load=null,_f(),_c.event("error")}function _f(){_b.removeEventListener("canplaythrough",_d),_b.removeEventListener("error",_e)}},_b.play=function(_a,_b,_c){if(void 0===_a&&(_a=0),void 0===_b&&(_b=0),!this.url)return null;var _d,_e;if(!(_d=this.url==_C._tMusic?_g._musicAudio:_g._audioCache[this.url]))return null;_e=_U.getItem("audio:"+this.url),_H.isConchApp?_e||((_e=_M.createElement("audio")).src=this.url):this.url==_C._tMusic?(_g._initMusicAudio(),(_e=_g._musicAudio).src=this.url):_e=_e||_d.cloneNode(!0);var _f=new _ma(_e);return _f.url=this.url,_f.loops=_b,_f.startTime=_a,_f.startHandler=_c,_f.play(!1),_C.addChannel(_f),_f},_k(0,_b,"duration",function(){var _a;return(_a=_g._audioCache[this.url])?_a.duration:0}),_g._initMusicAudio=function(){_g._musicAudio||(_g._musicAudio||(_g._musicAudio=_M.createElement("audio")),_H.isConchApp||_M.document.addEventListener("mousedown",_g._makeMusicOK))},_g._makeMusicOK=function(){_M.document.removeEventListener("mousedown",_g._makeMusicOK),_g._musicAudio.src?_g._musicAudio.play():(_g._musicAudio.src="",_g._musicAudio.load())},_g._audioCache={},_g._musicAudio=null,_g}(),_da=function(_a){function _b(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.startHandler=null,this.completeHandler=null,_b.__super.call(this)}_p(_b,"laya.media.SoundChannel",_j);var _c=_b.prototype;return _c.play=function(){},_c.stop=function(){},_c.pause=function(){},_c.resume=function(){},_c.__runComplete=function(_a){_a&&_a.run()},_k(0,_c,"volume",function(){return 1},function(_a){}),_k(0,_c,"position",function(){return 0}),_k(0,_c,"duration",function(){return 0}),_b}(),_ea=function(_a){function _b(){_b.__super.call(this)}_p(_b,"laya.media.Sound",_j);var _c=_b.prototype;return _c.load=function(_a){},_c.play=function(_a,_b,_c){return void 0===_a&&(_a=0),void 0===_b&&(_b=0),null},_c.dispose=function(){},_k(0,_c,"duration",function(){return 0}),_b}(),_fa=function(_a){function _e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,_e.__super.call(this)}_p(_e,"laya.media.webaudio.WebAudioSound",_j);var _b=_e.prototype;return _b.load=function(_a){this.url=_a,this.audioBuffer=_e._dataCache[_a],this.audioBuffer?this._loaded(this.audioBuffer):(_e.e.on("loaded:"+_a,this,this._loaded),_e.e.on("err:"+_a,this,this._err),_e.__loadingSound[_a]||(_e.__loadingSound[_a]=!0,_x.loader.load(_a,_s.create(this,this.onloaded),null,_ha.BUFFER,4,!1,null,!0)))},_b.onloaded=function(_a){_a||this._err(),this._disposed?this._removeLoadEvents():(this.data=_a,_e.buffs.push({buffer:this.data,url:this.url}),_e.decode())},_b._err=function(){if(this._removeLoadEvents(),_e.__loadingSound[this.url]=!1,this.event("error"),this.__toPlays){var _a,_b,_c,_d=0;for(_a=(_b=this.__toPlays).length,_d=0;_d<_a;_d++)(_c=_b[_d])[3]&&!_c[3].isStopped&&_c[3].event("error");this.__toPlays.length=0}},_b._loaded=function(_a){this._removeLoadEvents(),this._disposed||(this.audioBuffer=_a,this.loaded=!0,this.event("complete"))},_b._removeLoadEvents=function(){_e.e.off("loaded:"+this.url,this,this._loaded),_e.e.off("err:"+this.url,this,this._err)},_b.__playAfterLoaded=function(){if(this.__toPlays){var _a,_b,_c,_d=0;for(_a=(_b=this.__toPlays).length,_d=0;_d<_a;_d++)(_c=_b[_d])[3]&&!_c[3].isStopped&&this.play(_c[0],_c[1],_c[2],_c[3]);this.__toPlays.length=0}},_b.play=function(_a,_b,_c,_d){return void 0===_a&&(_a=0),void 0===_b&&(_b=0),_d=_d||new _na,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([_a,_b,_c,_d]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),_d.url=this.url,_d.loops=_b,_d.audioBuffer=this.audioBuffer,_d.startTime=_a,_d.startHandler=_c,_d.play(!1),_C.addChannel(_d),_d},_b.dispose=function(){this._disposed=!0,delete _e._dataCache[this.url],delete _e.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},_k(0,_b,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),_e.decode=function(){if(!(_e.buffs.length<=0||_e.isDecoding))if(_e.isDecoding=!0,(_e.tInfo=_e.buffs.shift())&&_e.tInfo.buffer&&_e.tInfo.buffer.byteLength)try{_e.ctx.decodeAudioData(_e.tInfo.buffer,_e._done,_e._fail)}catch(_a){console.error("decodeAudioData error  byteLength:"+_e.tInfo.buffer.byteLength+"  url:"+_e.tInfo.url)}else _e._fail()},_e._done=function(_a){_e.e.event("loaded:"+_e.tInfo.url,_a),_e._dataCache[_e.tInfo.url]=_a,_e.isDecoding=!1,_e.decode()},_e._fail=function(){_e.e.event("err:"+_e.tInfo.url,null),_e.isDecoding=!1,_e.decode()},_e._playEmptySound=function(){if(null!=_e.ctx){if(_e._emptySource&&(_e._emptySource.stop(),_e._emptySource.disconnect(0),!_na._tryCleanFailed))try{_e._emptySource.buffer=null}catch(_a){_na._tryCleanFailed=!0}var _a=_e.ctx.createBufferSource();_a.buffer=_e._miniBuffer,_a.connect(_e.ctx.destination),_a.start(0,0,0),_e._emptySource=_a}},_e._unlock=function(){_e._unlocked||(_e._playEmptySound(),"running"==_e.ctx.state?(_M.document.removeEventListener("mousedown",_e._unlock,!0),_M.document.removeEventListener("touchend",_e._unlock,!0),_M.document.removeEventListener("touchstart",_e._unlock,!0),_e._unlocked=!0):"suspended"==_e.ctx.state&&_C._recoverWebAudio())},_e.initWebAudio=function(){"running"!=_e.ctx.state&&(_e._unlock(),_M.document.addEventListener("mousedown",_e._unlock,!0),_M.document.addEventListener("touchend",_e._unlock,!0),_M.document.addEventListener("touchstart",_e._unlock,!0))},_e._emptySource=null,_e._dataCache={},_e.buffs=[],_e.isDecoding=!1,_e._unlocked=!1,_e.tInfo=null,_e.__loadingSound={},_i(_e,["window",function(){return this.window=_M.window},"webAudioEnabled",function(){return this.webAudioEnabled=_e.window.AudioContext||_e.window.webkitAudioContext||_e.window.mozAudioContext},"ctx",function(){return this.ctx=_e.webAudioEnabled?new(_e.window.AudioContext||_e.window.webkitAudioContext||_e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=_e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new _j}]),_e}(),_ga=function(_a){function _b(){this._responseType=null,this._data=null,_b.__super.call(this),this._http=new _M.window.XMLHttpRequest}_p(_b,"laya.net.HttpRequest",_j);var _c=_b.prototype;return _c.send=function(_a,_b,_c,_d,_e){void 0===_c&&(_c="get"),void 0===_d&&(_d="text"),this._responseType=_d,this._data=null;var _f=this,_g=this._http;if(_g.open(_c,_a,!0),_e)for(var _h=0;_h<_e.length;_h++)_g.setRequestHeader(_e[_h++],_e[_h]);else _H.isConchApp||(_b&&"string"!=typeof _b?_g.setRequestHeader("Content-Type","application/json"):_g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));_g.responseType="arraybuffer"!==_d?"text":"arraybuffer",_g.onerror=function(_a){_f._onError(_a)},_g.onabort=function(_a){_f._onAbort(_a)},_g.onprogress=function(_a){_f._onProgress(_a)},_g.onload=function(_a){_f._onLoad(_a)},_g.send(_b)},_c._onProgress=function(_a){_a&&_a.lengthComputable&&this.event("progress",_a.loaded/_a.total)},_c._onAbort=function(_a){this.error("Request was aborted by user")},_c._onError=function(_a){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},_c._onLoad=function(_a){var _b=this._http,_c=void 0!==_b.status?_b.status:200;200===_c||204===_c||0===_c?this.complete():this.error("["+_b.status+"]"+_b.statusText+":"+_b.responseURL)},_c.error=function(_a){this.clear(),this.event("error",_a)},_c.complete=function(){this.clear();var _b=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=_Y.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(_a){_b=!1,this.error(_a.message)}_b&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},_c.clear=function(){var _a=this._http;_a.onerror=_a.onabort=_a.onprogress=_a.onload=null},_k(0,_c,"url",function(){return this._http.responseURL}),_k(0,_c,"http",function(){return this._http}),_k(0,_c,"data",function(){return this._data}),_b}(),_ha=function(_a){function _A(){this._data=null,this._class=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._customParse=!1,_A.__super.call(this),this._onImageCallback=this._loadImageComplete.bind(this),this._onLoadedCallback=this._loadedComplete.bind(this),this.priority=-1,this.realTime=!1}_p(_A,"laya.net.Loader",_j);var _b=_A.prototype;return _b.load=function(_a,_b,_c,_d,_e){if(_a&&""!=_a||console.error("Loader 加载的url不合法 "+_a),void 0===_c&&(_c=!0),void 0===_e&&(_e=!1),0===(this._url=_a).indexOf("data:image")?this._type=_b="image":this._type=_b||(_b=this.getTypeFromUrl(_a)),this._cache=_c,this._data=null,!_e&&_A.loadedMap[_a])return this._data=_A.loadedMap[_a],this.event("progress",1),void this.event("complete",this._data);if(_d&&_A.setGroup(_a,_d),null!=_A.parserMap[_b])return this._customParse=!0,void(_A.parserMap[_b]instanceof laya.utils.Handler?_A.parserMap[_b].runWith(this):_A.parserMap[_b].call(null,this));if("image"===_b||"htmlimage"===_b||"nativeimage"===_b)return this._loadImage(_a);if("ttf"===_b)return this._loadTTF(_a);switch(_b){case"atlas":case"plf":"json";break;case"font":"xml";break;case"pkm":"arraybuffer";break;default:_b}_A.preLoadedMap[_a]?this.onLoaded(_A.preLoadedMap[_a]):_g.resMgrLoad(_a,this._onLoadedCallback,0<=this.priority?this.priority:2,this.realTime)},_b.getTypeFromUrl=function(_a){var _b=_Y.getFileExtension(_a);return _b?_A.typeMap[_b]:(console.warn("Not recognize the resources suffix",_a),"text")},_b._loadTTF=function(_a){_a=_G.formatURL(_a);var _b=new _F;_b.complete=_s.create(this,this.onLoaded),_b.load(_a)},_b._loadImage=function(_a){_g.imgMgrLoad(_a,this._onImageCallback,0<=this.priority?this.priority:2,this.realTime)},_b._loadImageComplete=function(_a,_b,_c){if(null!=_c)if(_c instanceof ArrayBuffer){var _d=new DataView(_c),_e=new laya.webgl.resource.WebGLImage(new Uint8Array(_c,8),_a,0,!1,_d.getUint32(0),_d.getUint32(4));this.onLoaded(_e)}else if(_c instanceof _ka)_A.imgMgrSet[_a]=_b,_g.imgMgrLock(_a,_A.imgMgrSet[_a]),this._url=_a,this.complete(_c);else{var _f=-1!=_a.indexOf(".png",_a.length-4)?6408:6407;_e=new laya.webgl.resource.WebGLImage(_c,_a,_f,!1,_c.width,_c.height);this.onLoaded(_e)}else this.event("error","Load image failed")},_b.imageCancel=function(_a,_b,_c){_g.imgMgrCancel(_a,this._onImageCallback)},_b._loadSound=function(_a){var _b=new _C._soundClass,_c=this;function _d(){_b.offAll()}_b.on("complete",this,function(){_d(),_c.onLoaded(_b)}),_b.on("error",this,function(){_d(),_b.dispose(),_c.event("error","Load sound failed")}),_b.load(_a)},_b.onProgress=function(_a){"atlas"===this._type?this.event("progress",.3*_a):this.event("progress",_a)},_b.onError=function(_a){this.event("error",_a)},_b._loadedComplete=function(_a,_b,_c){if(null!=_c)switch(this._type){case"atlas":case"plf":case"json":var _d=new _N(_c);this.onLoaded(JSON.parse(_d.readUTFBytes()));break;case"font":_d=new _N(_c);this.onLoaded(_Y.parseXMLFromString(_d.readUTFBytes()));break;default:this.onLoaded(_c)}else this.event("error",_a)},_b.onLoaded=function(_a){var _b=this._type;if("plf"==_b)this.parsePLFData(_a),this.complete(_a);else if("image"===_b){var _c=new _ka(_a);_c.url=this._url,this.complete(_c)}else if("sound"===_b||"htmlimage"===_b||"nativeimage"===_b)this.complete(_a);else if("atlas"===_b){if(!_a.src&&!_a._setContext){if(!this._data){if((this._data=_a).meta&&_a.meta.image)for(var _d=_a.meta.image.split(","),_e=0<=this._url.indexOf("/")?"/":"\\",_f=this._url.lastIndexOf(_e),_g=0<=_f?this._url.substr(0,_f+1):"",_h=0,_i=_d.length;_h<_i;_h++)_d[_h]=_g+_d[_h];else _d=[this._url.replace(".json",".png")];_d.reverse(),_a.toLoads=_d,_a.pics=[]}return this.event("progress",.3+1/_d.length*.6),this._loadImage(_d.pop())}if(!this._data.pics)throw new Error("this._data.pics == null, "+this._url);if(this._data.pics.push(_a),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var _j=this._data.frames,_k=this._url.split("?")[0],_l=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:_k.substring(0,_k.lastIndexOf("."))+"/",_m=this._data.pics,_n=_G.formatURL(this._url),_o=_A.atlasMap[_n]||(_A.atlasMap[_n]=[]);_o.dir=_l;var _p=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var _q in _p=parseFloat(this._data.meta.scale),_j){var _r,_s=_j[_q],_t=_m[_s.frame.idx?_s.frame.idx:0],_u=_G.formatURL(_l+_q);_t.scaleRate=_p,_r=_ka.create(_t,_s.frame.x,_s.frame.y,_s.frame.w,_s.frame.h,_s.spriteSourceSize.x,_s.spriteSourceSize.y,_s.sourceSize.w,_s.sourceSize.h),_A.cacheRes(_u,_r),_A.keepCache(this._url,_l+_q),_r.url=_u,_o.push(_u)}else for(_q in _j)_t=_m[(_s=_j[_q]).frame.idx?_s.frame.idx:0],_u=_G.formatURL(_l+_q),_A.cacheRes(_u,_ka.create(_t,_s.frame.x,_s.frame.y,_s.frame.w,_s.frame.h,_s.spriteSourceSize.x,_s.spriteSourceSize.y,_s.sourceSize.w,_s.sourceSize.h)),_A.loadedMap[_u].url=_u,_A.keepCache(this._url,_l+_q),_o.push(_u);delete this._data.pics,this.complete(this._data)}else if("font"==_b){if(!_a.src)return this._data=_a,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var _v=new _B;_v.parseFont(this._data,_a);var _w=this._url.split(".fnt")[0].split("/"),_x=_w[_w.length-1];_qa.registerBitmapFont(_x,_v),this._data=_v,this.complete(this._data)}else if("pkm"==_b){var _y=_wa.create(_a,this._url),_z=new _ka(_y);_z.url=this._url,this.complete(_z)}else this.complete(_a)},_b.parsePLFData=function(_a){var _b,_c,_d;for(_b in _a)switch(_d=_a[_b],_b){case"json":case"text":for(_c in _d)_A.preLoadedMap[_G.formatURL(_c)]=_d[_c];break;default:for(_c in _d)_A.preLoadedMap[_G.formatURL(_c)]=_d[_c]}},_b.complete=function(_a){this._data=_a,this._customParse?this.event("loaded",_a instanceof Array?[_a]:_a):(_A._loaders.push(this),_A._isWorking||_A.checkNext())},_b.endLoad=function(_a){_a&&(this._data=_a),this._cache&&_A.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},_k(0,_b,"url",function(){return this._url}),_k(0,_b,"data",function(){return this._data}),_k(0,_b,"cache",function(){return this._cache}),_k(0,_b,"type",function(){return this._type}),_A.checkNext=function(){_A._isWorking=!0;for(var _a=_M.now();_A._startIndex<_A._loaders.length;)if(_M.now(),_A._loaders[_A._startIndex].endLoad(),_A._startIndex++,_M.now()-_a>_A.maxTimeOut)return console.warn("loader callback cost a long time:"+(_M.now()-_a)+" url="+_A._loaders[_A._startIndex-1].url),void _x.timer.frameOnce(1,null,_A.checkNext);_A._loaders.length=0,_A._startIndex=0,_A._isWorking=!1},_A.clearRes=function(_a,_b){if(null!=_a){void 0===_b&&(_b=!1),_a=_G.formatURL(_a);var _c=_A.getAtlas(_a);if(_c){for(var _d=0,_e=_c.length;_d<_e;_d++){var _f=_c[_d],_g=_A.getRes(_f);delete _A.loadedMap[_f],_A.clearCache(_a.substring(_G.basePath.length),_f.substring(_G.basePath.length)),_g&&_g.destroy(_b)}_c.length=0,delete _A.atlasMap[_a],delete _A.loadedMap[_a]}else{var _h=_A.loadedMap[_a];_h&&(delete _A.loadedMap[_a],_h instanceof laya.resource.Texture&&_h.bitmap&&_h.destroy(_b))}}},_A.clearTextureRes=function(_a){_a=_G.formatURL(_a);var _b=laya.net.Loader.getAtlas(_a),_c=_b&&0<_b.length?laya.net.Loader.getRes(_b[0]):laya.net.Loader.getRes(_a);_c&&_c.bitmap&&(_H.isConchApp&&!_H.isConchWebGL?_c.bitmap.source.releaseTexture&&_c.bitmap.source.releaseTexture():null==_c.bitmap._atlaser&&_c.bitmap.releaseResource(!0))},_A.getRes=function(_a){return _A.loadedMap[_G.formatURL(_a)]},_A.getAtlas=function(_a){return _A.atlasMap[_G.formatURL(_a)]},_A.cacheRes=function(_a,_b){_a=_G.formatURL(_a),null!=_A.loadedMap[_a]?console.warn("Resources already exist,is repeated loading:",_a):_A.loadedMap[_a]=_b},_A.setGroup=function(_a,_b){_A.groupMap[_b]||(_A.groupMap[_b]=[]),_A.groupMap[_b].push(_a)},_A.clearResByGroup=function(_a){if(_A.groupMap[_a]){var _b=_A.groupMap[_a],_c=0,_d=_b.length;for(_c=0;_c<_d;_c++)_A.clearRes(_b[_c]);_b.length=0}},_A.keepCache=function(_a,_b){if(_a&&_b){var _c=_A.cacheSet[_b];_c?-1==_c.indexOf(_a)&&_c.push(_a):_A.cacheSet[_b]=[_a]}},_A.clearCache=function(_a,_b){if(_a&&_b){var _c=_A.cacheSet[_b];if(_c){var _d=_c.indexOf(_a);if(-1!==_d){var _e=_c.length-1;0==_e?(delete _A.cacheSet[_b],0<_A.imgMgrSet[_b]?_g.imgMgrFree(_b,_A.imgMgrSet[_b]):_A.clearRes(_b,!0)):(_c[_d]=_c[_e],_c.length=_e)}}}},_A.saveObject=function(_a,_b,_c){if(_b&&_a){var _d=_A.objectSet[_a];_d?(console.warn("Loader.saveObject: "+_a),_d[0]=_b,_d[1]=_c):_A.objectSet[_a]=[_b,_c,[]]}},_A.findObject=function(_a){if(_a){var _b=_A.objectSet[_a];if(_b)return _b[0]}return null},_A.keepObject=function(_a,_b){if(_a&&_b){var _c=_A.objectSet[_b];_c&&-1===_c[2].indexOf(_a)&&_c[2].push(_a)}},_A.clearObject=function(_a,_b){if(_a&&_b){var _c=_A.objectSet[_b];if(_c){var _d=_c[2],_e=_d.indexOf(_a);if(-1!==_e){var _f=_d.length-1;0==_f?(delete _A.objectSet[_b],_c[1]&&_c[1].call(null,_c[0])):(_d[_e]=_d[_f],_d.length=_f)}}}},_A.TEXT="text",_A.JSON="json",_A.XML="xml",_A.BUFFER="arraybuffer",_A.IMAGE="image",_A.SOUND="sound",_A.ATLAS="atlas",_A.FONT="font",_A.TTF="ttf",_A.PLF="plf",_A.PKM="pkm",_A.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",pkm:"pkm",ttf:"ttf",plf:"plf"},_A.parserMap={},_A.groupMap={},_A.maxTimeOut=100,_A.loadedMap={},_A.preLoadedMap={},_A.atlasMap={},_A._loaders=[],_A._isWorking=!1,_A._startIndex=0,_A.imgCache={},_A.cacheSet={},_A.objectSet={},_A.imgMgrSet={},_A}(),_ia=function(_a){var _m;function _n(){this.retryNum=0,this.retryDelay=10,this.maxLoader=8,this._loaders=[],this._loaderCount=0,this._loaderMap={},this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},_n.__super.call(this);for(var _a=0;_a<this._maxPriority;_a++)this._resInfos[_a]=[]}_p(_n,"laya.net.LoaderManager",_j);var _b=_n.prototype;return _b.create=function(_a,_c,_b,_d,_e,_f,_g,_h){if(null==_f&&(_f=2),null==_g&&(_g=!0),_a instanceof Array){var _i=_a,_j=_i.length,_k=0;if(_b)var _l=_s.create(_b.caller,_b.method,_b.args,!1);for(var _m=0;_m<_j;_m++){var _n=_i[_m];"string"==typeof _n&&(_n=_i[_m]={url:_n}),_n.progress=0}for(_m=0;_m<_j;_m++){_n=_i[_m];var _o=_b?_s.create(null,_r,[_n],!1):null,_p=_b||_c?_s.create(null,_q,[_n]):null;this._create(_n.url,_p,_o,_n.clas||_d,_n.params||_e,null!=_n.priority&&0<=_n.priority?_n.priority:_f,_g,_n.group||_h)}function _q(_a,_b){_k++,_a.progress=1,_k===_j&&_c&&_c.run()}function _r(_a,_b){_a.progress=_b;for(var _c=0,_d=0;_d<_j;_d++){_c+=_i[_d].progress}var _e=_c/_j;_l.runWith(_e)}return!0}return this._create(_a,_c,_b,_d,_e,_f,_g,_h)},_b._create=function(_b,_c,_a,_d,_e,_f,_g,_h){_b&&""!=_b||console.error("加载的url不合法 "+_b),null==_f&&(_f=2),null==_g&&(_g=!0);var _i=_G.formatURL(_b),_j=this.getRes(_i);if(_j)!_j.hasOwnProperty("loaded")||_j.loaded?(_a&&_a.runWith(1),_c&&_c.run()):_c&&_x.loader._createListener(_b,_c.caller,_c.method,_c.args,!0,!1);else{var _k=_Y.getFileExtension(_b),_l=_n.createMap[_k];if(!_l)throw new Error("LoaderManager:unknown file("+_b+") extension with: "+_k+".");_d||(_d=_l[0]);var _m=_l[1];if("atlas"==_k)this.load(_b,_c,_a,_m,_f,_g);else{_d===_ka&&(_m="htmlimage"),(_j=_d?new _d:null).hasOwnProperty("_loaded")&&(_j._loaded=!1),_j._setUrl(_b),_h&&_j._setGroup(_h),this._createLoad(_j,_b,_s.create(null,function(_a){_j&&!_j.destroyed&&_a&&_j.onAsynLoaded.call(_j,_b,_a,_e),_c&&_c.run();_x.loader.event(_b)}),_a,_m,_f,!1,_h,!0),_g&&this.cacheRes(_i,_j)}}return _j},_b.load=function(_a,_b,_c,_d,_e,_f,_g,_h){_a&&""!=_a||console.error("加载的url不合法 "+_a);var _i=this;if(null==_e&&(_e=2),null==_f&&(_f=!0),void 0===_h&&(_h=!1),_a instanceof Array)return this._loadAssets(_a,_b,_c,_d,_e,_f,_g);var _j=_ha.getRes(_a);if(null!=_j)_x.timer.frameOnce(1,null,function(){_c&&_c.runWith(1),_b&&_b.runWith(_j),_i._loaderCount||_i.event("complete")});else{var _k=_n._resMap[_a];_k?(_b&&_k._createListener("complete",_b.caller,_b.method,_b.args,!1,!1),_c&&_k._createListener("progress",_c.caller,_c.method,_c.args,!1,!1)):((_k=this._infoPool.length?this._infoPool.pop():new _m).url=_a,_k.clas=null,_k.type=_d,_k.cache=_f,_k.group=_g,_k.ignoreCache=_h,_k.priority=_e,_b&&_k.on("complete",_b.caller,_b.method,_b.args),_c&&_k.on("progress",_c.caller,_c.method,_c.args),_n._resMap[_a]=_k,_e=_e<this._maxPriority?0<=_e?_e:0:this._maxPriority-1,this._resInfos[_e].push(_k),this._next())}return this},_b.cancel=function(_a,_b,_c){if(_j=_n._resMap[_a]){_b&&_j.off("complete",_b.caller,_b.method,!1),_c&&_j.off("progress",_c.caller,_c.method,!1);var _d=_j.getListener("complete"),_e=_j.getListener("progress");if(!(_d&&_d.head||_e&&_e.head)){if(_j.loader){var _f=_j.loader;_f.imageCancel(_a),_f.offAll(),_f._data=null,_f._customParse=!1,_f._url=null,_f._class=null,_f._type=null,this._loaders.push(_f),this._loaderCount--,delete this._loaderMap[_j.url]}for(var _g=0;_g<this._maxPriority;_g++)for(var _h=this._resInfos[_g],_i=_h.length-1;-1<_i;_i--){var _j;(_j=_h[_i])&&_j.url===_a&&(_h[_i]=null,_j.destroy(),_j.offAll(),this._infoPool.push(_j))}delete _n._resMap[_a],this._next()}}},_b._createLoad=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){var _j=this;if(null==_f&&(_f=2),null==_g&&(_g=!0),void 0===_i&&(_i=!1),_b instanceof Array)return this._loadAssets(_b,_c,_d,_e,_f,_g,_h);var _k=_ha.getRes(_b);if(null!=_k)_x.timer.frameOnce(1,null,function(){_d&&_d.runWith(1),_c&&_c.runWith(_k),_j._loaderCount||_j.event("complete")});else{var _l=_n._resMap[_b];_l?(_c&&_l._createListener("complete",_c.caller,_c.method,_c.args,!1,!1),_d&&_l._createListener("progress",_d.caller,_d.method,_d.args,!1,!1)):((_l=this._infoPool.length?this._infoPool.pop():new _m).url=_b,_l.clas=_a,_l.type=_e,_l.cache=_g,_l.group=_h,_l.ignoreCache=_i,_l.priority=_f,_c&&_l.on("complete",_c.caller,_c.method,_c.args),_d&&_l.on("progress",_d.caller,_d.method,_d.args),_n._resMap[_b]=_l,_f=_f<this._maxPriority?0<=_f?_f:0:this._maxPriority-1,this._resInfos[_f].push(_l),this._next())}return this},_b._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var _a=0;_a<this._maxPriority;_a++)for(var _b=this._resInfos[_a];0<_b.length;){var _c=_b.shift();if(_c)return this._doLoad(_c)}this._loaderCount||this.event("complete")}},_b._doLoad=function(_b){var _c=this._loaders.length?this._loaders.pop():new _ha;this._loaderCount++,(this._loaderMap[_b.url]=_c).on("complete",null,_e),_c.on("progress",null,function(_a){_b.event("progress",_a)}),_c.on("error",null,function(_a){_e(null)}),_b.loader=_c;var _d=this;function _e(_a){_c.offAll(),_c._data=null,_c._customParse=!1,_c._url=null,_c._class=null,_c._type=null,_d._loaders.push(_c),_d._loaderCount--,delete _d._loaderMap[_b.url],_d._endLoad(_b,_a instanceof Array?[_a]:_a),_d._next()}_c._class=_b.clas,1<=_b.priority?(_c.priority=_b.priority,_c.realTime=!1):(_c.priority=0,_c.realTime=!0),_c.load(_b.url,_b.type,_b.cache,_b.group,_b.ignoreCache)},_b._endLoad=function(_a,_b){var _c=_a.url;if(null==_b){var _d=this._failRes[_c]||0;if(_d<this.retryNum)return console.warn("[warn]Retry to load:",_c),this._failRes[_c]=_d+1,void _x.timer.once(this.retryDelay,this,this._addReTry,[_a],!1);console.warn("[error]Failed to load:",_c),this.event("error",_c)}this._failRes[_c]&&(this._failRes[_c]=0),delete _n._resMap[_c],_a.event("complete",_b),_a.destroy(),_a.offAll(),this._infoPool.push(_a)},_b._addReTry=function(_a){this._resInfos[this._maxPriority-1].push(_a),this._next()},_b.clearRes=function(_a,_b){void 0===_b&&(_b=!1),_ha.clearRes(_a,_b)},_b.getRes=function(_a){return _ha.getRes(_a)},_b.cacheRes=function(_a,_b){_ha.cacheRes(_a,_b)},_b.clearTextureRes=function(_a){_ha.clearTextureRes(_a)},_b.setGroup=function(_a,_b){_ha.setGroup(_a,_b)},_b.clearResByGroup=function(_a){_ha.clearResByGroup(_a)},_b.clearUnLoaded=function(){for(var _a=0;_a<this._maxPriority;_a++){for(var _b=this._resInfos[_a],_c=_b.length-1;-1<_c;_c--){var _d=_b[_c];_d&&(_d.destroy(),_d.offAll(),this._infoPool.push(_d))}_b.length=0}this._loaderCount=0,_n._resMap={}},_b.cancelLoadByUrls=function(_a){if(_a)for(var _b=0,_c=_a.length;_b<_c;_b++)this.cancelLoadByUrl(_a[_b])},_b.cancelLoadByUrl=function(_a){for(var _b=0;_b<this._maxPriority;_b++)for(var _c=this._resInfos[_b],_d=_c.length-1;-1<_d;_d--){var _e=_c[_d];_e&&_e.url===_a&&(_c[_d]=null,_e.destroy(),_e.offAll(),this._infoPool.push(_e))}_n._resMap[_a]&&delete _n._resMap[_a]},_b._loadAssets=function(_a,_c,_g,_b,_d,_e,_f){null==_d&&(_d=2),null==_e&&(_e=!0);for(var _h=_a.length,_i=0,_j=0,_k=[],_l=!0,_m=0;_m<_h;_m++){var _n=_a[_m];if(!_n)throw new Error("LoaderManager._loadAssets 加载列表错误 arr="+_a);"string"==typeof _n&&(_n={url:_n,type:_b,size:1,priority:_d}),_n.size||(_n.size=1),_n.progress=0,_j+=_n.size,_k.push(_n);var _o=_g?_s.create(null,_r,[_n],!1):null,_p=_c||_g?_s.create(null,_q,[_n]):null;this.load(_n.url,_p,_o,_n.type,null!=_n.priority&&0<=_n.priority?_n.priority:2,_e,_n.group||_f)}function _q(_a,_b){_i++,_a.progress=1,_b||(_l=!1),_i===_h&&_c&&_c.runWith(_l)}function _r(_a,_b){if(null!=_g){_a.progress=_b;for(var _c=0,_d=0;_d<_k.length;_d++){var _e=_k[_d];_c+=_e.size*_e.progress}var _f=_c/_j;_g.runWith(_f)}}return this},_n.cacheRes=function(_a,_b){_ha.cacheRes(_a,_b)},_n._resMap={},_i(_n,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),_n.__init$=function(){_m=function(_a){function _b(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=null,this.priority=-1,_b.__super.call(this)}return _p(_b,"",_j),_b.prototype.destroy=function(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.clas=null,this.loader=void 0,this.priority=-1},_b}()},_n}(),_ja=(function(_a){function _e(_a){_e.__super.call(this),_a||(_a=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var _b=0,_c=0,_d=0;_d<20;_d++)_d%5!=4?this._mat[_b++]=_a[_d]:this._alpha[_c++]=_a[_d];this._action=_D.createFilterAction(32),this._action.data=this}_p(_e,"laya.filters.ColorFilter",_r);var _b=_e.prototype;_x.imps(_b,{"laya.filters.IFilter":!0}),_b.callNative=function(_a){_a._$P.cf=this;_a.conchModel&&_a.conchModel.setFilterMatrix&&_a.conchModel.setFilterMatrix(this._mat,this._alpha)},_k(0,_b,"type",function(){return 32}),_k(0,_b,"action",function(){return this._action})}(),function(_a){function _d(_a,_b,_c){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===_b&&(_b=0),_d.__super.call(this),this._byteClass=_c||_N,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,_a&&0<_b&&_b<65535&&this.connect(_a,_b)}_p(_d,"laya.net.Socket",_j);var _b=_d.prototype;_b.connect=function(_a,_b){var _c="ws://"+_a+":"+_b;_c="https:"==_M.window.location.protocol?"wss://"+_a+":"+_b:"ws://"+_a+":"+_b,this.connectByUrl(_c)},_b.connectByUrl=function(_a){var _b=this;null!=this._socket&&this.close(),this._socket&&this.cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new _M.window.WebSocket(_a,this.protocols):this._socket=new _M.window.WebSocket(_a),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(_a){_b._onOpen(_a)},this._socket.onmessage=function(_a){_b._onMessage(_a)},this._socket.onclose=function(_a){_b._onClose(_a)},this._socket.onerror=function(_a){_b._onError(_a)}},_b.cleanSocket=function(){try{this._socket.close()}catch(_a){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},_b.close=function(){if(null!=this._socket)try{this._socket.close()}catch(_a){}},_b._onOpen=function(_a){this._connected=!0,this.event("open",_a)},_b._onMessage=function(_a){if(_a&&_a.data){var _b=_a.data;if(this.disableInput&&_b)this.event("message",_b);else{0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var _c=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,_b&&("string"==typeof _b?this._input.writeUTFBytes(_b):this._input.writeArrayBuffer(_b),this._addInputPosition=this._input.pos,this._input.pos=_c),this.event("message",_b)}}},_b._onClose=function(_a){this._connected=!1,this.event("close",_a)},_b._onError=function(_a){this.event("error",_a)},_b.send=function(_a){this._socket.send(_a)},_b.flush=function(){if(this._output&&0<this._output.length){var _b;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(_a){_b=_a}this._output.endian=this.endian,this._output.clear(),_b&&this.event("error",_b)}},_k(0,_b,"input",function(){return this._input}),_k(0,_b,"output",function(){return this._output}),_k(0,_b,"connected",function(){return this._connected}),_k(0,_b,"endian",function(){return this._endian},function(_a){this._endian=_a,null!=this._input&&(this._input.endian=_a),null!=this._output&&(this._output.endian=_a)}),_d.LITTLE_ENDIAN="littleEndian",_d.BIG_ENDIAN="bigEndian"}(),function(_a){function _h(){_h.__super.call(this),this._$1__id=++_h._uniqueIDCounter,this.__loaded=!0,this._destroyed=!1,this._referenceCount=0,(_h._idResourcesMap[this.id]=this)._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,_L.currentResourceManager&&_L.currentResourceManager.addResource(this)}_p(_h,"laya.resource.Resource",_j);var _b=_h.prototype;return _x.imps(_b,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),_b._setUrl=function(_a){var _b;this._url!==_a&&(this._url&&((_b=_h._urlResourcesMap[this._url]).splice(_b.indexOf(this),1),0===_b.length&&delete _h._urlResourcesMap[this._url]),_a&&((_b=_h._urlResourcesMap[_a])||(_h._urlResourcesMap[_a]=_b=[]),_b.push(this)),this._url=_a)},_b._getGroup=function(){return this._group},_b._setGroup=function(_a){var _b;this._group!==_a&&(this._group&&((_b=_h._groupResourcesMap[this._group]).splice(_b.indexOf(this),1),0===_b.length&&delete _h._groupResourcesMap[this._group]),_a&&((_b=_h._groupResourcesMap[_a])||(_h._groupResourcesMap[_a]=_b=[]),_b.push(this)),this._group=_a)},_b._addReference=function(){this._referenceCount++},_b._removeReference=function(){this._referenceCount--},_b._clearReference=function(){this._referenceCount=0},_b._endLoaded=function(){this.__loaded=!0,this.event("loaded",this)},_b.recreateResource=function(){this.completeCreate()},_b.disposeResource=function(){},_b.activeResource=function(_a){void 0===_a&&(_a=!1),this._lastUseFrameCount=_V.loopCount,!this._destroyed&&this.__loaded&&(this._released||_a)&&this.recreateResource()},_b.releaseResource=function(_a){return void 0===_a&&(_a=!0),!(!_a&&this.lock)&&(!(this._released&&!_a)&&(this.disposeResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},_b.onAsynLoaded=function(_a,_b,_c){throw new Error("Resource: must override this function!")},_b.destroy=function(){var _a;this._destroyed||(null!==this._resourceManager&&this._resourceManager.removeResource(this),this._destroyed=!0,this.lock=!1,this.releaseResource(),delete _h._idResourcesMap[this.id],this._url&&((_a=_h._urlResourcesMap[this._url])&&(_a.splice(_a.indexOf(this),1),0===_a.length&&delete _h._urlResourcesMap[this.url]),_ha.clearRes(this._url),this.__loaded||_D.cancelLoadByUrl(this._url)),this._group&&((_a=_h._groupResourcesMap[this._group]).splice(_a.indexOf(this),1),0===_a.length&&delete _h._groupResourcesMap[this.url]))},_b.completeCreate=function(){this._released=!1,this.event("recovered",this)},_b.dispose=function(){this.destroy()},_k(0,_b,"memorySize",function(){return this._memorySize},function(_a){var _b=_a-this._memorySize;this._memorySize=_a,this.resourceManager&&this.resourceManager.addRecord(this.uri,this.__className,_b),this.resourceManager&&this.resourceManager.addSize(_b)}),_k(0,_b,"_loaded",null,function(_a){this.__loaded=_a}),_k(0,_b,"loaded",function(){return this.__loaded}),_k(0,_b,"id",function(){return this._$1__id}),_k(0,_b,"destroyed",function(){return this._destroyed}),_k(0,_b,"group",function(){return this._getGroup()},function(_a){this._setGroup(_a)}),_k(0,_b,"resourceManager",function(){return this._resourceManager}),_k(0,_b,"url",function(){return this._url}),_k(0,_b,"released",function(){return this._released}),_k(0,_b,"referenceCount",function(){return this._referenceCount}),_h.getResourceByID=function(_a){return _h._idResourcesMap[_a]},_h.getResourceByURL=function(_a,_b){return void 0===_b&&(_b=0),null==_h._urlResourcesMap[_a]?null:_h._urlResourcesMap[_a][_b]},_h.getResourceCountByURL=function(_a){return _h._urlResourcesMap[_a].length},_h.destroyUnusedResources=function(_a){var _b;if(_a){var _c=_h._groupResourcesMap[_a];if(_c)for(var _d=_c.slice(),_e=0,_f=_d.length;_e<_f;_e++)(_b=_d[_e]).lock||0!==_b._referenceCount||_b.destroy()}else for(var _g in _h._idResourcesMap)(_b=_h._idResourcesMap[_g]).lock||0!==_b._referenceCount||_b.destroy()},_h._uniqueIDCounter=0,_h._idResourcesMap={},_h._urlResourcesMap={},_h._groupResourcesMap={},_h}()),_ka=function(_a){function _A(_a,_b){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,this._atlasID=-1,this.scaleRate=1,_A.__super.call(this),_a&&null!=_a._addReference&&_a._addReference(),this.setTo(_a,_b)}_p(_A,"laya.resource.Texture",_j);var _b=_A.prototype;return _b._setUrl=function(_a){this.url=_a},_b.setTo=function(_a,_b){if(_a instanceof _g.HTMLElement){var _c=_ta.create("2D",_a);this.bitmap=_c}else this.bitmap=_a;if(this.uv=_b||_A.DEF_UV,_a){this._w=_a.width,this._h=_a.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var _d=this;if(this._loaded)_D.addToAtlas&&_D.addToAtlas(_d);else{var _e=_a;_e instanceof laya.resource.HTMLImage&&_e.image&&_e.image.addEventListener("load",function(_a){_D.addToAtlas&&_D.addToAtlas(_d)},!1)}}},_b.active=function(){this.bitmap&&this.bitmap.activeResource()},_b.destroy=function(_a){if(void 0===_a&&(_a=!1),this.alphaTexture&&(this.alphaTexture.destroy(_a),this.alphaTexture=null),this.bitmap&&0<this.bitmap.referenceCount){var _b=this.bitmap;_a?(_H.isConchApp&&_b.source&&_b.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,_b.dispose(),_b._clearReference()):(_b._removeReference(),0==_b.referenceCount&&(_H.isConchApp&&_b.source&&_b.source.conchDestroy&&this.bitmap.source.conchDestroy(),this.bitmap=null,_b.dispose())),this.url&&this===_x.loader.getRes(this.url)&&_x.loader.clearRes(this.url,_a),this._loaded=!1}},_b.load=function(_a){var _b=this;this._loaded=!1,_a=_G.customFormat(_a);var _c=this.bitmap||(this.bitmap=_wa.create(_a));_c.uri=_a,_c&&_c._addReference();var _d=this;_c.onload=function(){_c.onload=null,_d._loaded=!0,_b.sourceWidth=_b._w=_c.width,_b.sourceHeight=_b._h=_c.height,_d.event("loaded",this),_D.addToAtlas&&_D.addToAtlas(_d)}},_b.addTextureToAtlas=function(_a){_D.addTextureToAtlas(this)},_b.getPixels=function(_a,_b,_c,_d){if(_H.isConchApp){var _e=this.bitmap;if(_e.source&&_e.source.getImageData){var _f=_e.source.getImageData(_a,_b,_c,_d),_g=new Uint8Array(_f);return Array.from(_g)}return null}return _H.isWebGL?_D.getTexturePixels(this,_a,_b,_c,_d):(_M.canvas.size(_c,_d),_M.canvas.clear(),_M.context.drawTexture(this,-_a,-_b,this.width,this.height,0,0),_M.context.getImageData(0,0,_c,_d).data)},_b.onAsynLoaded=function(_a,_b){if(_b){if("function"!=typeof _b._addReference)throw new Error("bitmap._addReference is not a function. "+_b.className+" "+typeof _b._addReference+" "+_b.constructor);_b._addReference()}this.setTo(_b,this.uv),this._loaded&&this.event("loaded",this)},_k(0,_b,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),_k(0,_b,"loaded",function(){return this._loaded}),_k(0,_b,"released",function(){return!this.bitmap||this.bitmap.released}),_k(0,_b,"width",function(){return this._w?this._w:this.uv&&this.uv!==_A.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(_a){this._w=_a,this.sourceWidth||(this.sourceWidth=_a)}),_k(0,_b,"repeat",function(){return!_H.isWebGL||!this.bitmap||this.bitmap.repeat},function(_a){_a&&_H.isWebGL&&this.bitmap&&(this.bitmap.repeat=_a)&&(this.bitmap.enableMerageInAtlas=!1)}),_k(0,_b,"height",function(){return this._h?this._h:this.uv&&this.uv!==_A.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(_a){this._h=_a,this.sourceHeight||(this.sourceHeight=_a)}),_k(0,_b,"isLinearSampling",function(){return!_H.isWebGL||9728!=this.bitmap.minFifter},function(_a){!_a&&_H.isWebGL&&(_a||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),_A.moveUV=function(_a,_b,_c){for(var _d=0;_d<8;_d+=2)_c[_d]+=_a,_c[_d+1]+=_b;return _c},_A.create=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){void 0===_f&&(_f=0),void 0===_g&&(_g=0),void 0===_h&&(_h=0),void 0===_i&&(_i=0);var _j=_a instanceof laya.resource.Texture,_k=_j?_a.uv:_A.DEF_UV,_l=_j?_a.bitmap:_a,_m=_D.isAtlas(_l);if(_m){var _n=_l._atlaser,_o=_a._atlasID;if(-1==_o)throw new Error("create texture error");_l=_n._inAtlasTextureBitmapValue[_o],_k=_n._inAtlasTextureOriUVValue[_o]}var _p=new _A(_l,null);_l.width&&_b+_d>_l.width&&(_d=_l.width-_b),_l.height&&_c+_e>_l.height&&(_e=_l.height-_c),_p.width=_d,_p.height=_e,_p.offsetX=_f,_p.offsetY=_g,_p.sourceWidth=_h||_d,_p.sourceHeight=_i||_e;var _q=1/_l.width,_r=1/_l.height;_b*=_q,_c*=_r,_d*=_q,_e*=_r;var _s=_p.uv[0],_t=_p.uv[1],_u=_p.uv[4],_v=_p.uv[5],_w=_u-_s,_x=_v-_t,_y=_A.moveUV(_k[0],_k[1],[_b,_c,_b+_d,_c,_b+_d,_c+_e,_b,_c+_e]);_p.uv=[_s+_y[0]*_w,_t+_y[1]*_x,_u-(1-_y[2])*_w,_t+_y[3]*_x,_u-(1-_y[4])*_w,_v-(1-_y[5])*_x,_s+_y[6]*_w,_v-(1-_y[7])*_x],_m&&_p.addTextureToAtlas();var _z=_l.scaleRate;return _z&&1!=_z?(_p.sourceWidth/=_z,_p.sourceHeight/=_z,_p.width/=_z,_p.height/=_z,_p.scaleRate=_z,_p.offsetX/=_z,_p.offsetY/=_z):_p.scaleRate=1,_p},_A.createFromTexture=function(_a,_b,_c,_d,_e){var _f=_a.scaleRate;1!=_f&&(_b*=_f,_c*=_f,_d*=_f,_e*=_f);var _g=_z.TEMP.setTo(_b-_a.offsetX,_c-_a.offsetY,_d,_e),_h=_g.intersection(_A._rect1.setTo(0,0,_a.width,_a.height),_A._rect2);if(!_h)return null;var _i=_A.create(_a,_h.x,_h.y,_h.width,_h.height,_h.x-_g.x,_h.y-_g.y,_d,_e);if(_i.bitmap&&_i.bitmap._removeReference)return _i.bitmap._removeReference(),_i;var _j="bitmap:"+(_i.bitmap?_i.bitmap.constructor?_i.bitmap.constructor.name:_i.bitmap.__className:"")+", url:"+(_a.url+" | "+(_i.bitmap?_i.bitmap.url:_a.url))+", x="+_b+",y="+_c+",width="+_d+",height="+_e+", result="+(_h?_h.x+","+_h.y+","+_h.width+","+_h.height:"null")+", rect="+_g.x+","+_g.y+","+_g.width+","+_g.height;throw new Error("报错：bitmap._removeReference is not a function  "+_j)},_A.DEF_UV=[0,0,1,0,1,1,0,1],_A.INV_UV=[0,1,1,1,1,0,0,0],_A._rect1=new _z,_A._rect2=new _z,_A}(),_a=function(_a){var _h;function _f(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,_f.__super.call(this)}_p(_f,"laya.utils.TimeLine",_j);var _b=_f.prototype;return _b.to=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=0),this._create(_a,_b,_c,_d,_e,!0)},_b.from=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=0),this._create(_a,_b,_c,_d,_e,!1)},_b._create=function(_a,_b,_c,_d,_e,_f){var _g=_U.getItemByClass("tweenData",_h);return _g.isTo=_f,_g.type=0,_g.target=_a,_g.duration=_c,_g.data=_b,_g.startTime=this._startTime+_e,_g.endTime=_g.startTime+_g.duration,_g.ease=_d,this._startTime=Math.max(_g.endTime,this._startTime),this._tweenDataList.push(_g),this._startTimeSort=!0,this._endTimeSort=!0,this},_b.addLabel=function(_a,_b){var _c=_U.getItemByClass("tweenData",_h);return _c.type=1,_c.data=_a,_c.endTime=_c.startTime=this._startTime+_b,this._labelDic||(this._labelDic={}),this._labelDic[_a]=_c,this._tweenDataList.push(_c),this},_b.removeLabel=function(_a){if(this._labelDic&&this._labelDic[_a]){var _b=this._labelDic[_a];if(_b){var _c=this._tweenDataList.indexOf(_b);-1<_c&&this._tweenDataList.splice(_c,1)}delete this._labelDic[_a]}},_b.gotoTime=function(_a){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var _b,_c,_d,_e;for(var _f in this._firstTweenDic)if(_c=this._firstTweenDic[_f])for(var _g in _c)_c.diyTarget.hasOwnProperty(_g)&&(_c.diyTarget[_g]=_c[_g]);for(_f in this._tweenDic)(_b=this._tweenDic[_f]).clear(),delete this._tweenDic[_f];if(this._index=0,this._gidIndex=0,this._currTime=_a,this._lastTime=_M.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=_d=this._tweenDataList.concat(),_d.sort(function(_a,_b){return _a.endTime>_b.endTime?1:_a.endTime<_b.endTime?-1:0})}else _d=this._endTweenDataList;for(var _h=0,_i=_d.length;_h<_i;_h++)if(0==(_e=_d[_h]).type){if(!(_a>=_e.endTime))break;this._index=Math.max(this._index,_h+1);var _j=_e.data;if(_e.isTo)for(var _k in _j)_e.target[_k]=_j[_k]}for(_h=0,_i=this._tweenDataList.length;_h<_i;_h++)0==(_e=this._tweenDataList[_h]).type&&_a>=_e.startTime&&_a<_e.endTime&&(this._index=Math.max(this._index,_h+1),this._gidIndex++,(_b=_U.getItemByClass("tween",_X))._create(_e.target,_e.data,_e.duration,_e.ease,_s.create(this,this._animComplete,[this._gidIndex]),0,!1,_e.isTo,!0,!1),_b.setStartTime(this._currTime-(_a-_e.startTime)),_b._updateEase(this._currTime),_b.gid=this._gidIndex,this._tweenDic[this._gidIndex]=_b)}},_b.gotoLabel=function(_a){if(null!=this._labelDic){var _b=this._labelDic[_a];_b&&this.gotoTime(_b.startTime)}},_b.pause=function(){_x.timer.clear(this,this._update)},_b.resume=function(){this.play(this._currTime,this._loopKey)},_b.play=function(_a,_b){if(void 0===_a&&(_a=0),void 0===_b&&(_b=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(_a,_b){return _a.startTime>_b.startTime?1:_a.startTime<_b.startTime?-1:0});for(var _c=0,_d=this._tweenDataList.length;_c<_d;_c++){var _e=this._tweenDataList[_c];if(null!=_e&&0==_e.type){var _f=_e.target,_g=_f.$_GID||(_f.$_GID=_Y.getGID()),_h=null;for(var _i in null==this._firstTweenDic[_g]?((_h={}).diyTarget=_f,this._firstTweenDic[_g]=_h):_h=this._firstTweenDic[_g],_e.data)null==_h[_i]&&(_h[_i]=_f[_i])}}}"string"==typeof _a?this.gotoLabel(_a):this.gotoTime(_a),this._loopKey=_b,this._lastTime=_M.now(),_x.timer.frameLoop(1,this,this._update)}},_b._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var _a in this._tweenDic)(_b=this._tweenDic[_a]).complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var _b,_c=_M.now(),_d=_c-this._lastTime,_e=this._currTime+=_d*this.scale;for(_a in this._lastTime=_c,this._tweenDic)(_b=this._tweenDic[_a])._updateEase(_e);if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var _f=this._tweenDataList[this._index];_e>=_f.startTime&&(this._index++,0==_f.type?(this._gidIndex++,(_b=_U.getItemByClass("tween",_X))._create(_f.target,_f.data,_f.duration,_f.ease,_s.create(this,this._animComplete,[this._gidIndex]),0,!1,_f.isTo,!0,!1),_b.setStartTime(_e),_b.gid=this._gidIndex,(this._tweenDic[this._gidIndex]=_b)._updateEase(_e)):this.event("label",_f.data))}},_b._animComplete=function(_a){this._tweenDic[_a]&&delete this._tweenDic[_a]},_b._complete=function(){this.event("complete")},_b.reset=function(){var _a;if(this._labelDic)for(_a in this._labelDic)delete this._labelDic[_a];for(_a in this._tweenDic)this._tweenDic[_a].clear(),delete this._tweenDic[_a];for(_a in this._firstTweenDic)delete this._firstTweenDic[_a];if(this._endTweenDataList=null,this._tweenDataList&&this._tweenDataList.length){var _b,_c=0;for(_b=this._tweenDataList.length,_c=0;_c<_b;_c++)this._tweenDataList[_c]&&this._tweenDataList[_c].destroy()}this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,_x.timer.clear(this,this._update)},_b.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},_k(0,_b,"index",function(){return this._frameIndex},function(_a){this._frameIndex=_a,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),_k(0,_b,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),_f.to=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=0),(new _f).to(_a,_b,_c,_d,_e)},_f.from=function(_a,_b,_c,_d,_e){return void 0===_e&&(_e=0),(new _f).from(_a,_b,_c,_d,_e)},_f.__init$=function(){_h=function(){function _a(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return _p(_a,""),_a.prototype.destroy=function(){this.target=null,this.ease=null,this.data=null,this.isTo=!0,this.type=0,_U.recover("tweenData",this)},_a}()},_f}(),_la=function(_e){function _c(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,_c.__super.call(this),this._style=_h.EMPTY}_p(_c,"laya.display.Sprite",_e);var _a=_c.prototype;return _x.imps(_a,{"laya.display.ILayout":!0}),_a.createConchModel=function(){return new ConchNode},_a.destroy=function(_a){if(void 0===_a&&(_a=!0),this._releaseMem(),!this._destroyed){this.filters=null;var _b=this.mask;_b&&(this.mask=null,_b.destroy(_a))}_e.prototype.destroy.call(this,_a),this._style&&this._style.destroy(),this._transform&&this._transform.destroy(),this._transform=null,this._style=null,this._graphics=null},_a.updateZOrder=function(){_Y.updateOrder(this._childs)&&this.repaint()},_a.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},_a.setBounds=function(_a){this._set$P("uBounds",_a)},_a.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new _z),_z._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},_a.getSelfBounds=function(){return this._$P.uBounds?this._$P.uBounds:(this._$P.mBounds||this._set$P("mBounds",new _z),_z._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds))},_a._boundPointsToParent=function(_a){void 0===_a&&(_a=!1);var _b=0,_c=0;this._style&&(_b=this._style._tf.translateX,_c=this._style._tf.translateY,_a=_a||0!==this._style._tf.rotate,this._style.scrollRect&&(_b+=this._style.scrollRect.x,_c+=this._style.scrollRect.y));var _d=this._getBoundPointsM(_a);if(!_d||_d.length<1)return _d;if(8!=_d.length&&(_d=_a?_v.scanPList(_d):_z._getWrapRec(_d,_z.TEMP)._getBoundPoints()),!this.transform)return _Y.transPointList(_d,this._x-_b,this._y-_c),_d;var _e=_y.TEMP,_f=0,_g=_d.length;for(_f=0;_f<_g;_f+=2)_e.x=_d[_f],_e.y=_d[_f+1],this.toParentPoint(_e),_d[_f]=_e.x,_d[_f+1]=_e.y;return _d},_a.getGraphicBounds=function(_a){return void 0===_a&&(_a=!1),this._graphics?this._graphics.getBounds(_a):_z.TEMP.setTo(0,0,0,0)},_a._getBoundPointsM=function(_a){if(void 0===_a&&(_a=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var _b=_Y.clearArray(this._$P.temBM),_c=_z.TEMP;return _c.copyFrom(this.scrollRect),_Y.concatArray(_b,_c._getBoundPoints()),_b}for(var _d,_e,_f,_g=this._graphics?this._graphics.getBoundPoints():_Y.clearArray(this._$P.temBM),_h=0,_i=(_f=this._childs).length;_h<_i;_h++)(_d=_f[_h])instanceof laya.display.Sprite&&1==_d.visible&&(_e=_d._boundPointsToParent(_a))&&(_g=_g?_Y.concatArray(_g,_e):_e);return _g},_a.getStyle=function(){return this._style===_h.EMPTY&&(this._style=new _h),this._style},_a.setStyle=function(_a){this._style=_a},_a._adjustTransform=function(){this._tfChanged=!1;var _a,_b=this._style._tf,_c=_b.scaleX,_d=_b.scaleY;if(_b.rotate||1!==_c||1!==_d||_b.skewX||_b.skewY){(_a=this._transform||(this._transform=_E.create())).bTransform=!0;var _e=.0174532922222222*(_b.rotate-_b.skewX),_f=.0174532922222222*(_b.rotate+_b.skewY),_g=Math.cos(_f),_h=Math.sin(_f),_i=Math.sin(_e),_j=Math.cos(_e);return _a.a=_c*_g,_a.b=_c*_h,_a.c=-_d*_i,_a.d=_d*_j,_a.tx=_a.ty=0,_a}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,_a},_a.pos=function(_a,_b,_c){if(void 0===_c&&(_c=!1),this._x!==_a||this._y!==_b){if(this.destroyed)return this;if(_c){this._x=_a,this._y=_b,this.conchModel&&this.conchModel.pos(this._x,this._y);var _d=this._parent;_d&&0===_d._repaint&&(_d._repaint=1,_d.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=_a,this.y=_b}return this},_a.pivot=function(_a,_b){return this.pivotX=_a,this.pivotY=_b,this},_a.size=function(_a,_b){return this.width=_a,this.height=_b,this},_a.scale=function(_a,_b,_c){void 0===_c&&(_c=!1);var _d=this.getStyle(),_e=_d._tf;if(_e.scaleX!=_a||_e.scaleY!=_b){if(this.destroyed)return this;if(_c){_d.setScale(_a,_b),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(_a,_b),this._renderType|=4;var _f=this._parent;_f&&0===_f._repaint&&(_f._repaint=1,_f.parentRepaint())}else this.scaleX=_a,this.scaleY=_b}return this},_a.skew=function(_a,_b){return this.skewX=_a,this.skewY=_b,this},_a.render=function(_a,_b,_c){_V.spriteCount++,_J.renders[this._renderType]._fun(this,_a,_b+this._x,_c+this._y),this._repaint=0},_a.drawToCanvas=function(_a,_b,_c,_d){if(_H.isConchNode){var _e=_ta.create("2D");return new _I(_a,_b,_e).ctx.setCanvasType(1),this.conchModel.drawToCanvas(_e.source,_c,_d),_e}return _D.drawToCanvas(this,this._renderType,_a,_b,_c,_d)},_a.customRender=function(_a,_b,_c){this._renderType|=1024},_a._applyFilters=function(){var _a;if(!_H.isWebGL&&((_a=this._$P.filters)&&!(_a.length<1)))for(var _b=0,_c=_a.length;_b<_c;_b++)_a[_b].action.apply(this._$P.cacheCanvas)},_a._isHaveGlowFilter=function(){var _a,_b=0;if(this.filters)for(_b=0;_b<this.filters.length;_b++)if(8==this.filters[_b].type)return!0;for(_b=0,_a=this._childs.length;_b<_a;_b++)if(this._childs[_b]._isHaveGlowFilter())return!0;return!1},_a.localToGlobal=function(_a,_b){void 0===_b&&(_b=!1),!0===_b&&(_a=new _y(_a.x,_a.y));for(var _c=this;_c&&_c!=_x.stage;)_a=_c.toParentPoint(_a),_c=_c.parent;return _a},_a.globalToLocal=function(_a,_b){void 0===_b&&(_b=!1),_b&&(_a=new _y(_a.x,_a.y));for(var _c=this,_d=[];_c&&_c!=_x.stage;)_d.push(_c),_c=_c.parent;for(var _e=_d.length-1;0<=_e;)_a=(_c=_d[_e]).fromParentPoint(_a),_e--;return _a},_a.toParentPoint=function(_a){if(!_a)return _a;_a.x-=this.pivotX,_a.y-=this.pivotY,this.transform&&this._transform.transformPoint(_a),_a.x+=this._x,_a.y+=this._y;var _b=this._style.scrollRect;return _b&&(_a.x-=_b.x,_a.y-=_b.y),_a},_a.fromParentPoint=function(_a){if(!_a)return _a;_a.x-=this._x,_a.y-=this._y;var _b=this._style.scrollRect;return _b&&(_a.x+=_b.x,_a.y+=_b.y),this.transform&&this._transform.invertTransformPoint(_a),_a.x+=this.pivotX,_a.y+=this.pivotY,_a},_a.on=function(_a,_b,_c,_d){return 1!==this._mouseEnableState&&this.isMouseEvent(_a)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(_a,_b,_c,_d,!1)):_e.prototype.on.call(this,_a,_b,_c,_d)},_a.once=function(_a,_b,_c,_d){return 1!==this._mouseEnableState&&this.isMouseEvent(_a)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(_a,_b,_c,_d,!0)):_e.prototype.once.call(this,_a,_b,_c,_d)},_a._$2__onDisplay=function(){if(1!==this._mouseEnableState){var _a=this;for(_a=_a.parent;_a&&1!==_a._mouseEnableState&&!_a._getBit(2);)_a.mouseEnabled=!0,_a._setBit(2,!0),_a=_a.parent}},_a.loadImage=function(_a,_b,_c,_d,_e,_f){var _g=this;return void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),void 0===_e&&(_e=0),this.graphics.loadImage(_a,_b,_c,_d,_e,function(_a){_g.destroyed||(_g.size(_b+(_d||_a.width),_c+(_e||_a.height)),_g.repaint(),_f&&_f.runWith(_a))}),this},_a.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},_a._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},_a._childChanged=function(_a){this._childs.length?this._renderType|=2048:this._renderType&=-2049,_a&&this._get$P("hasZorder")&&_x.timer.callLater(this,this.updateZOrder),this.repaint()},_a.parentRepaint=function(){var _a=this._parent;_a&&0===_a._repaint&&(_a._repaint=1,_a.parentRepaint())},_a.startDrag=function(_a,_b,_c,_d,_e,_f,_g){void 0===_b&&(_b=!1),void 0===_c&&(_c=0),void 0===_d&&(_d=300),void 0===_f&&(_f=!1),void 0===_g&&(_g=.92),this._$P.dragging||this._set$P("dragging",new _R),this._$P.dragging.start(this,_a,_b,_c,_d,_e,_f,_g)},_a.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},_a._releaseMem=function(){if(this._$P){var _a=this._$P.cacheCanvas;_a&&_a.ctx&&(_U.recover("RenderContext",_a.ctx),_a.ctx.canvas.size(0,0),_a.ctx=null);var _b=this._$P._filterCache;_b&&(_b.destroy(),_b.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1),this._$P._isHaveGlowFilter=null}},_a._setDisplay=function(_a){_a||this._releaseMem(),_e.prototype._setDisplay.call(this,_a)},_a.hitTestPoint=function(_a,_b){var _c=this.globalToLocal(_y.TEMP.setTo(_a,_b));return _a=_c.x,_b=_c.y,(this._$P.hitArea?this._$P.hitArea:0<this._width&&0<this._height?_z.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(_a,_b)},_a.getMousePoint=function(){return this.globalToLocal(_y.TEMP.setTo(_x.stage.mouseX,_x.stage.mouseY))},_a._getWords=function(){return null},_a._addChildsToLayout=function(_a){var _b=this._getWords();if(null==_b&&0==this._childs.length)return!1;if(_b)for(var _c=0,_d=_b.length;_c<_d;_c++)_a.push(_b[_c]);_c=0;for(var _e=this._childs.length;_c<_e;++_c){var _f=this._childs[_c];_f._style._enableLayout()&&_f._addToLayout(_a)}return!0},_a._addToLayout=function(_a){this._style.absolute||(this._style.block?_a.push(this):this._addChildsToLayout(_a)&&(this.x=this.y=0))},_a._isChar=function(){return!1},_a._getCSSStyle=function(){return this._style.getCSSStyle()},_a._setAttributes=function(_a,_b){switch(_a){case"x":this.x=parseFloat(_b);break;case"y":this.y=parseFloat(_b);break;case"width":this.width=parseFloat(_b);break;case"height":this.height=parseFloat(_b);break;default:this[_a]=_b}},_a._layoutLater=function(){this.parent&&this.parent._layoutLater()},_k(0,_a,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(_a){this._optimizeScrollRect!=_a&&(this._optimizeScrollRect=_a,this.conchModel&&this.conchModel.optimizeScrollRect(_a))}),_k(0,_a,"customRenderEnable",null,function(_a){if(_a&&(this._renderType|=1024,_H.isConchNode)){_c.CustomList.push(this);var _b=new _ta("2d");_b._setContext(new CanvasRenderingContext2D),this.customContext=new _I(0,0,_b),_b.context.setCanvasType&&_b.context.setCanvasType(2),this.conchModel.custom(_b.context)}}),_k(0,_a,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(_a){this.cacheAs=_a?this._$P.hasFilter?"none":"normal":"none"}),_k(0,_a,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(_a){var _b=this._$P.cacheCanvas;if(_a!==(_b?_b.type:"none")){if("none"!==_a)this._getBit(1)||this._setUpNoticeType(1),_b||(_b=this._set$P("cacheCanvas",_U.getItemByClass("cacheCanvas",Object))),_b.type=_a,_b.reCache=!0,this._renderType|=16,"bitmap"==_a&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1);else if(this._$P._mask);else if(this._$P.hasFilter)this._set$P("cacheForFilters",!0);else{if(_b){var _c=_b;_c&&_c.ctx&&(_U.recover("RenderContext",_c.ctx),_c.ctx.canvas.size(0,0),_c.ctx=null),_U.recover("cacheCanvas",_b)}this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)}this.repaint()}}),_k(0,_a,"zOrder",function(){return this._zOrder},function(_a){this._zOrder!=_a&&(this._zOrder=_a,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(_a),this._parent&&(_a&&this._parent._set$P("hasZorder",!0),_x.timer.callLater(this._parent,this.updateZOrder)))}),_k(0,_a,"rotation",function(){return this._style._tf.rotate},function(_a){var _b=this.getStyle();if(_b._tf.rotate!==_a){_b.setRotate(_a),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(_a),this._renderType|=4;var _c=this._parent;_c&&0===_c._repaint&&(_c._repaint=1,_c.parentRepaint())}}),_k(0,_a,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(_a){this._width!==_a&&(this._width=_a,this.conchModel&&this.conchModel.size(_a,this._height),this.repaint())}),_k(0,_a,"x",function(){return this._x},function(_a){if(this._x!==_a){if(this.destroyed)return;this._x=_a,this.conchModel&&this.conchModel.pos(_a,this._y);var _b=this._parent;_b&&0===_b._repaint&&(_b._repaint=1,_b.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),_k(0,_a,"globalScaleY",function(){for(var _a=1,_b=this;_b&&_b!==_x.stage;)_a*=_b.scaleY,_b=_b.parent;return _a}),_k(0,_a,"hitArea",function(){return this._$P.hitArea},function(_a){this._set$P("hitArea",_a)}),_k(0,_a,"staticCache",function(){return this._$P.staticCache},function(_a){this._set$P("staticCache",_a),_a||this.reCache()}),_k(0,_a,"texture",function(){return this._texture},function(_a){this._texture!=_a&&(this._texture=_a,this.graphics.cleanByTexture(_a,0,0))}),_k(0,_a,"y",function(){return this._y},function(_a){if(this._y!==_a){if(this.destroyed)return;this._y=_a,this.conchModel&&this.conchModel.pos(this._x,_a);var _b=this._parent;_b&&0===_b._repaint&&(_b._repaint=1,_b.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),_k(0,_a,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(_a){this._height!==_a&&(this._height=_a,this.conchModel&&this.conchModel.size(this._width,_a),this.repaint())}),_k(0,_a,"blendMode",function(){return this._style.blendMode},function(_a){this.getStyle().blendMode=_a,this.conchModel&&this.conchModel.blendMode(_a),_a&&"source-over"!=_a?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),_k(0,_a,"scaleX",function(){return this._style._tf.scaleX},function(_a){var _b=this.getStyle();if(_b._tf.scaleX!==_a){_b.setScaleX(_a),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(_a,_b._tf.scaleY),this._renderType|=4;var _c=this._parent;_c&&0===_c._repaint&&(_c._repaint=1,_c.parentRepaint())}}),_k(0,_a,"scaleY",function(){return this._style._tf.scaleY},function(_a){var _b=this.getStyle();if(_b._tf.scaleY!==_a){_b.setScaleY(_a),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(_b._tf.scaleX,_a),this._renderType|=4;var _c=this._parent;_c&&0===_c._repaint&&(_c._repaint=1,_c.parentRepaint())}}),_k(0,_a,"stage",function(){return _x.stage}),_k(0,_a,"skewX",function(){return this._style._tf.skewX},function(_a){var _b=this.getStyle();if(_b._tf.skewX!==_a){_b.setSkewX(_a),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(_a,_b._tf.skewY),this._renderType|=4;var _c=this._parent;_c&&0===_c._repaint&&(_c._repaint=1,_c.parentRepaint())}}),_k(0,_a,"scrollRect",function(){return this._style.scrollRect},function(_a){this.getStyle().scrollRect=_a,this.repaint(),_a?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(_a.x,_a.y,_a.width,_a.height)):(this._renderType&=-129,this.conchModel&&(_c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),_k(0,_a,"skewY",function(){return this._style._tf.skewY},function(_a){var _b=this.getStyle();if(_b._tf.skewY!==_a){_b.setSkewY(_a),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(_b._tf.skewX,_a),this._renderType|=4;var _c=this._parent;_c&&0===_c._repaint&&(_c._repaint=1,_c.parentRepaint())}}),_k(0,_a,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(_a){this._tfChanged=!1,(this._transform=_a)&&(this._x=_a.tx,this._y=_a.ty,_a.tx=_a.ty=0,this.conchModel&&this.conchModel.transform(_a.a,_a.b,_a.c,_a.d,this._x,this._y)),_a?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),_k(0,_a,"pivotX",function(){return this._style._tf.translateX},function(_a){this.getStyle().setTranslateX(_a),this.conchModel&&this.conchModel.pivot(_a,this._style._tf.translateY),this.repaint()}),_k(0,_a,"pivotY",function(){return this._style._tf.translateY},function(_a){this.getStyle().setTranslateY(_a),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,_a),this.repaint()}),_k(0,_a,"alpha",function(){return this._style.alpha},function(_a){this._style&&this._style.alpha!==_a&&(_a=_a<0?0:1<_a?1:_a,this.getStyle().alpha=_a,this.conchModel&&this.conchModel.alpha(_a),1!==_a?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),_k(0,_a,"visible",function(){return this._style.visible},function(_a){this._style&&this._style.visible!==_a&&(this.getStyle().visible=_a,this.conchModel&&this.conchModel.visible(_a),this.parentRepaint())}),_k(0,_a,"graphics",function(){return this._graphics||(this.graphics=_D.createGraphics())},function(_a){this._graphics&&(this._graphics._sp=null),(this._graphics=_a)?(this._renderType&=-2,this._renderType|=512,(_a._sp=this).conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(_c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),_k(0,_a,"filters",function(){return this._$P.filters},function(_a){_a&&0===_a.length&&(_a=null),this._$P.filters!=_a&&(this._set$P("filters",_a?_a.slice():null),_H.isConchApp&&(this.conchModel&&(_c.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),_H.isWebGL&&(_a&&_a.length?this._renderType|=32:this._renderType&=-33),_a&&0<_a.length?(this._getBit(1)||this._setUpNoticeType(1),_H.isWebGL&&1==_a.length&&_a[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(_H.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),_k(0,_a,"parent",_e.prototype._$get_parent,function(_a){_x.superSet(_aa,this,"parent",_a),_a&&this._getBit(2)&&this._$2__onDisplay()}),_k(0,_a,"mask",function(){return this._$P._mask},function(_a){_a&&this.mask&&this.mask._$P.maskParent||(_a?(this.cacheAs="bitmap",this._set$P("_mask",_a),_a._set$P("maskParent",this)):(this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",_a),this.cacheAs="none"),this.conchModel&&this.conchModel.mask(_a?_a.conchModel:null),this._renderType|=64,this.parentRepaint())}),_k(0,_a,"mouseEnabled",function(){return 1<this._mouseEnableState},function(_a){this._mouseEnableState=_a?2:1}),_k(0,_a,"globalScaleX",function(){for(var _a=1,_b=this;_b&&_b!==_x.stage;)_a*=_b.scaleX,_b=_b.parent;return _a}),_k(0,_a,"mouseX",function(){return this.getMousePoint().x}),_k(0,_a,"mouseY",function(){return this.getMousePoint().y}),_c.fromImage=function(_a){return(new _c).loadImage(_a)},_c._cachePool=[],_c.CustomList=[],_i(_c,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=_g.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),_c}(_aa),_ma=function(_a){function _b(_a){this._audio=null,this._onEnd=null,this._resumePlay=null,_b.__super.call(this),this._onEnd=_Y.bind(this.__onEnd,this),this._resumePlay=_Y.bind(this.__resumePlay,this),_a.addEventListener("ended",this._onEnd),this._audio=_a}_p(_b,"laya.media.h5audio.AudioSoundChannel",_da);var _c=_b.prototype;return _c.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(_x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},_c.__resumePlay=function(){this._audio&&this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime,_M.container.appendChild(this._audio),this._audio.play()}catch(_a){this.event("error")}},_c.play=function(_a){this.isStopped=!1;try{this._audio.playbackRate=_C.playbackRate,this._audio.currentTime=this.startTime}catch(_a){return void this._audio.addEventListener("canplay",this._resumePlay)}_C.addChannel(this),_M.container.appendChild(this._audio),!_a&&this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play()},_c.stop=function(){this.isStopped=!0,_C.removeChannel(this),this.startHandler=null,this.completeHandler=null,this._audio&&("pause"in this._audio&&_H.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),_M.onIE||this._audio!=_ca._musicAudio&&_U.recover("audio:"+this.url,this._audio),_M.removeElement(this._audio),this._audio=null)},_c.pause=function(){this.isStopped=!0,_C.removeChannel(this),"pause"in this._audio&&this._audio.pause()},_c.resume=function(){this._audio&&(this.isStopped=!1,_C.addChannel(this),this.startHandler&&this.startHandler.runWith(this),"play"in this._audio&&this._audio.play())},_k(0,_c,"position",function(){return this._audio?this._audio.currentTime:0}),_k(0,_c,"duration",function(){return this._audio?this._audio.duration:0}),_k(0,_c,"volume",function(){return this._audio?this._audio.volume:1},function(_a){this._audio&&(this._audio.volume=_a)}),_b}(),_na=function(_a){function _b(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=_fa.ctx,_b.__super.call(this),this._onPlayEnd=_Y.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}_p(_b,"laya.media.webaudio.WebAudioSoundChannel",_da);var _c=_b.prototype;return _c.play=function(_a){if(_C.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var _b=this.context,_c=this.gain,_d=_b.createBufferSource();(this.bufferSource=_d).buffer=this.audioBuffer,_d.connect(_c),_c&&_c.disconnect(),_c.connect(_b.destination),_d.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=_M.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.1):this.gain.gain.value=this._volume,0==this.loops&&(_d.loop=!0),_d.playbackRate.setTargetAtTime?_d.playbackRate.setTargetAtTime(_C.playbackRate,this.context.currentTime,.1):_d.playbackRate.value=_C.playbackRate,_d.start(0,this.startTime),!_a&&this.startHandler&&this.startHandler.runWith(this),this._currentTime=0}},_c.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(_x.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play(!0)},_c._clearBufferSource=function(){if(this.bufferSource){var _a=this.bufferSource;_a.stop?_a.stop(0):_a.noteOff(0),_a.disconnect(0),_a.onended=null,_b._tryCleanFailed||this._tryClearBuffer(_a),this.bufferSource=null}},_c._tryClearBuffer=function(_a){try{_a.buffer=null}catch(_a){_b._tryCleanFailed=!0}},_c.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,_C.removeChannel(this),this.startHandler=null,this.completeHandler=null},_c.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,_C.removeChannel(this)},_c.resume=function(){this.startTime=this._pauseTime,this.play(!1)},_k(0,_c,"position",function(){return this.bufferSource?(_M.now()-this._startTime)/1e3+this.startTime:0}),_k(0,_c,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),_k(0,_c,"volume",function(){return this._volume},function(_a){this.isStopped||(this._volume=_a,this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(_a,this.context.currentTime,.1):this.gain.gain.value=_a)}),_b._tryCleanFailed=!1,_b}(),_oa=function(_a){function _b(){_b.__super.call(this),this._w=0,this._h=0}_p(_b,"laya.resource.Bitmap",_ja);var _c=_b.prototype;return _k(0,_c,"width",function(){return this._w}),_k(0,_c,"height",function(){return this._h}),_k(0,_c,"source",function(){return this._source}),_b}(),_pa=function(_b){function _a(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,_a.__super.call(this),this._interval=_d.animationInterval,this._setUpNoticeType(1)}_p(_a,"laya.display.AnimationPlayerBase",_b);var _c=_a.prototype;return _c.play=function(_a,_b,_c,_d){void 0===_a&&(_a=0),void 0===_b&&(_b=!0),void 0===_c&&(_c=""),void 0===_d&&(_d=!0),this._isPlaying=!0,this.index="string"==typeof _a?this._getFrameByLabel(_a):_a,this.loop=_b,this._actionName=_c,this._isReverse=1==this.wrapMode,0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},_c._getFrameByLabel=function(_a){var _b=0;for(_b=0;_b<this._count;_b++)if(this._labels[_b]&&0<=this._labels[_b].indexOf(_a))return _b;return 0},_c._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},_c._setControlNode=function(_a){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),(this._controlNode=_a)&&_a!=this&&(_a.on("display",this,this._checkResumePlaying),_a.on("undisplay",this,this._checkResumePlaying))},_c._setDisplay=function(_a){_b.prototype._setDisplay.call(this,_a),this._checkResumePlaying()},_c._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},_c.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},_c.addLabel=function(_a,_b){this._labels||(this._labels={}),this._labels[_b]||(this._labels[_b]=[]),this._labels[_b].push(_a)},_c.removeLabel=function(_a){if(_a){if(this._labels)for(var _b in this._labels)this._removeLabelFromLabelList(this._labels[_b],_a)}else this._labels=null},_c._removeLabelFromLabelList=function(_a,_b){if(_a)for(var _c=_a.length-1;0<=_c;_c--)_a[_c]==_b&&_a.splice(_c,1)},_c.gotoAndStop=function(_a){this.index="string"==typeof _a?this._getFrameByLabel(_a):_a,this.stop()},_c._displayToIndex=function(_a){},_c.clear=function(){this.stop(),this._labels=null},_k(0,_c,"interval",function(){return this._interval},function(_a){this._interval!=_a&&(this._frameRateChanged=!0,this._interval=_a,this._isPlaying&&0<_a&&this.timerLoop(_a,this,this._frameLoop,null,!0,!0))}),_k(0,_c,"isPlaying",function(){return this._isPlaying}),_k(0,_c,"index",function(){return this._index},function(_a){if(this._index=_a,this._displayToIndex(_a),this._labels&&this._labels[_a])for(var _b=this._labels[_a],_c=0,_d=_b.length;_c<_d;_c++)this.event("label",_b[_c])}),_k(0,_c,"count",function(){return this._count}),_a.WRAP_POSITIVE=0,_a.WRAP_REVERSE=1,_a.WRAP_PINGPONG=2,_a}(_la),_qa=function(_b){function _n(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,_n.__super.call(this),this.overflow=_n.VISIBLE,this._style=new _ba(this),this._style.wordWrap=!1}_p(_n,"laya.display.Text",_b);var _a=_n.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._lines=null,this._words&&(this._words.length=0,this._words=null)},_a._getBoundPointsM=function(_a){void 0===_a&&(_a=!1);var _b=_z.TEMP;return _b.setTo(0,0,this.width,this.height),_b._getBoundPoints()},_a.getGraphicBounds=function(_a){void 0===_a&&(_a=!1);var _b=_z.TEMP;return _b.setTo(0,0,this.width,this.height),_b},_a._getCSSStyle=function(){return this._style},_a.lang=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k){if(_a=_n.langPacks&&_n.langPacks[_a]?_n.langPacks[_a]:_a,arguments.length<2)this._text=_a;else{for(var _l=0,_m=arguments.length;_l<_m;_l++)_a=_a.replace("{"+_l+"}",arguments[_l+1]);this._text=_a}},_a._isPassWordMode=function(){var _a=this._style.password;return"prompt"in this&&this.prompt==this._text&&(_a=!1),_a},_a._getPassWordTxt=function(_a){var _b;_b="";for(var _c=_a.length;0<_c;_c--)_b+="●";return _b},_a.renderText=function(_a,_b){var _c=this.graphics;_c.clear(!0);var _d=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(_M.onIPhone&&laya.display.Text._fontFamilyMap[this.font]||this.font);_M.context.font=_d;var _e=this.padding,_f=_e[3],_g="left",_h=this._lines,_i=this.leading+this._charSize.height,_j=this._currBitmapFont;_j&&(_i=this.leading+_j.getMaxHeight());var _k=_e[0];if(!_j&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(_g="right",_f=this._width-_e[1]):"center"==this.align&&(_g="center",_f=.5*this._width+_e[3]-_e[1])),0<this._height){var _l=this._textHeight>this._height?"top":this.valign;"middle"===_l?_k=.5*(this._height-_b*_i)+_e[0]-_e[2]:"bottom"===_l&&(_k=this._height-_b*_i-_e[2])}var _m=this._style;if(_j&&_j.autoScaleSize)var _n=_j.fontSize/this.fontSize;if(this._clipPoint)if(_c.save(),_j&&_j.autoScaleSize){var _o=0,_p=0;_o=this._width?this._width-_e[3]-_e[1]:this._textWidth,_p=this._height?this._height-_e[0]-_e[2]:this._textHeight,_o*=_n,_p*=_n,_c.clipRect(_e[3],_e[0],_o,_p)}else _c.clipRect(_e[3],_e[0],this._width?this._width-_e[3]-_e[1]:this._textWidth,this._height?this._height-_e[0]-_e[2]:this._textHeight);var _q=_m.password;"prompt"in this&&this.prompt==this._text&&(_q=!1);for(var _r=0,_s=0,_t=Math.min(this._lines.length,_b+_a)||1,_u=_a;_u<_t;_u++){var _v,_w=_h[_u];if(_q){var _x=_w.length;_w="";for(var _y=_x;0<_y;_y--)_w+="●"}if(_r=_f-(this._clipPoint?this._clipPoint.x:0),_s=_k+_i*_u-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(_g,_r,_s,_u),_j){var _z=this.width;_j.autoScaleSize&&(_z=this.width*_n),_j.drawText(_w,this,_r,_s,this.align,_z)}else _H.isWebGL?(this._words||(this._words=[]),(_v=this._words.length>_u-_a?this._words[_u-_a]:new __).setText(_w)):_v=_w,_m.stroke?_c.fillBorderText(_v,_r,_s,_d,this.color,_m.strokeColor,_m.stroke,_g):_c.fillText(_v,_r,_s,_d,this.color,_g)}if(_j&&_j.autoScaleSize){var _A=1/_n;this.scale(_A,_A)}this._clipPoint&&_c.restore(),this._startX=_f,this._startY=_k},_a.drawUnderline=function(_a,_b,_c,_d){var _e=this._lineWidths[_d];switch(_a){case"center":_b-=_e/2;break;case"right":_b-=_e}_c+=this._charSize.height,this._graphics.drawLine(_b,_c,_b+_e,_c,this.underlineColor||this.color,1)},_a.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);_M.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this.parseLines(this._getPassWordTxt(this._text)):this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new _y(0,0)):this._clipPoint=null;var _a=this._lines.length;if(this.overflow!=_n.VISIBLE){var _b=this.overflow==_n.HIDDEN?Math.floor:Math.ceil;_a=Math.min(_a,_b((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var _c=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(_c,_a),this.repaint()},_a.evalTextSize=function(){var _a,_b=NaN;_a=Math.max.apply(this,this._lineWidths),_b=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],_a==this._textWidth&&_b==this._textHeight||(this._textWidth=_a,this._textHeight=_b,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},_a.checkEnabledViewportOrNot=function(){return this.overflow==_n.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},_a.changeText=function(_a){this._text!==_a&&(this.lang(_a+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},_a.parseLines=function(_a){var _b=this.wordWrap||this.overflow==_n.HIDDEN;if(_b)var _c=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var _d=_Y.contextMeasureText(_n._testWord);_H.isConchApp&&0===_d.width&&0===_d.height&&(_d=_Y.contextMeasureText("W")),this._charSize.width=_d.width,this._charSize.height=_d.height||this.fontSize}for(var _e=_a.replace(/\r\n/g,"\n").split("\n"),_f=0,_g=_e.length;_f<_g;_f++){var _h=_e[_f];_b?this.parseLine(_h,_c):(this._lineWidths.push(this.getTextWidth(_h)),this._lines.push(_h))}},_a.parseLine=function(_a,_b){_M.context;var _c,_d=this._lines,_e=0,_f=NaN,_g=NaN,_h=0;if((_f=this.getTextWidth(_a))<=_b)return _d.push(_a),void this._lineWidths.push(_f);_f=this._charSize.width,0==(_e=Math.floor(_b/_f))&&(_e=1),_g=_f=this.getTextWidth(_a.substring(0,_e));for(var _i=_e,_j=_a.length;_i<_j;_i++)if(_b<(_g+=_f=this.getTextWidth(_a.charAt(_i))))if(this.wordWrap){var _k=_a.substring(_h,_i);if(_k.charCodeAt(_k.length-1)<255?(_c=/(?:\w|-)+$/.exec(_k))&&(_i=_c.index+_h,0==_c.index?_i+=_k.length:_k=_a.substring(_h,_i)):_n.RightToLeft&&(_c=/([\u0600-\u06FF])+$/.exec(_k))&&(_i=_c.index+_h,0==_c.index?_i+=_k.length:_k=_a.substring(_h,_i)),_d.push(_k),this._lineWidths.push(_g-_f),!((_h=_i)+_e<_j)){_d.push(_a.substring(_h,_j)),this._lineWidths.push(this.getTextWidth(_d[_d.length-1])),_h=-1;break}_i+=_e,_g=_f=this.getTextWidth(_a.substring(_h,_i)),_i--}else if(this.overflow==_n.HIDDEN)return _d.push(_a.substring(0,_i)),void this._lineWidths.push(this.getTextWidth(_d[_d.length-1]));this.wordWrap&&-1!=_h&&(_d.push(_a.substring(_h,_j)),this._lineWidths.push(this.getTextWidth(_d[_d.length-1])))},_a.getTextWidth=function(_a){return this._currBitmapFont?this._currBitmapFont.getTextWidth(_a):_Y.contextMeasureText(_a).width},_a.getWordWrapWidth=function(){var _a=this.padding,_b=NaN;return(_b=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(_b=this.wordWrap?100:_M.width),_b<=0&&(_b=100),_b-_a[3]-_a[1]},_a.getCharPoint=function(_a,_b){this._isChanged&&_x.timer.runCallLater(this,this.typeset);for(var _c=0,_d=this._lines,_e=0,_f=0,_g=_d.length;_f<_g;_f++){if(_a<(_c+=_d[_f].length)){var _h=_f;break}_e=_c}var _i=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;_M.context.font=_i;var _j=this.getTextWidth(this._text.substring(_e,_a));return(_b||new _y).setTo(this._startX+_j-(this._clipPoint?this._clipPoint.x:0),this._startY+_h*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},_k(0,_a,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(_a){_a!=this._width&&(_x.superSet(_la,this,"width",_a),this.isChanged=!0)}),_k(0,_a,"textWidth",function(){return this._isChanged&&_x.timer.runCallLater(this,this.typeset),this._textWidth}),_k(0,_a,"height",function(){return this._height?this._height:this.textHeight},function(_a){_a!=this._height&&(_x.superSet(_la,this,"height",_a),this.isChanged=!0)}),_k(0,_a,"textHeight",function(){return this._isChanged&&_x.timer.runCallLater(this,this.typeset),this._textHeight}),_k(0,_a,"padding",function(){return this._getCSSStyle().padding},function(_a){this._getCSSStyle().padding=_a,this.isChanged=!0}),_k(0,_a,"bold",function(){return this._getCSSStyle().bold},function(_a){this._getCSSStyle().bold=_a,this.isChanged=!0}),_k(0,_a,"text",function(){return this._text||""},function(_a){this._text!==_a&&(this.lang(_a+""),this.isChanged=!0,this.event("change"))}),_k(0,_a,"color",function(){return this._getCSSStyle().color},function(_a){this._getCSSStyle().color!=_a&&(this._getCSSStyle().color=_a,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),_k(0,_a,"font",function(){return this._getCSSStyle().fontFamily},function(_a){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),_n._bitmapFonts&&_n._bitmapFonts[_a]&&(this._currBitmapFont=_n._bitmapFonts[_a]),this._getCSSStyle().fontFamily=_a,this.isChanged=!0}),_k(0,_a,"fontSize",function(){return this._getCSSStyle().fontSize},function(_a){this._getCSSStyle().fontSize=_a,this.isChanged=!0}),_k(0,_a,"italic",function(){return this._getCSSStyle().italic},function(_a){this._getCSSStyle().italic=_a,this.isChanged=!0}),_k(0,_a,"align",function(){return this._getCSSStyle().align},function(_a){this._getCSSStyle().align=_a,this.isChanged=!0}),_k(0,_a,"valign",function(){return this._getCSSStyle().valign},function(_a){this._getCSSStyle().valign=_a,this.isChanged=!0}),_k(0,_a,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(_a){this._getCSSStyle().wordWrap=_a,this.isChanged=!0}),_k(0,_a,"leading",function(){return this._getCSSStyle().leading},function(_a){this._getCSSStyle().leading=_a,this.isChanged=!0}),_k(0,_a,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(_a){this._getCSSStyle().backgroundColor=_a,this.isChanged=!0}),_k(0,_a,"borderColor",function(){return this._getCSSStyle().borderColor},function(_a){this._getCSSStyle().borderColor=_a,this.isChanged=!0}),_k(0,_a,"stroke",function(){return this._getCSSStyle().stroke},function(_a){this._getCSSStyle().stroke=_a,this.isChanged=!0}),_k(0,_a,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(_a){this._getCSSStyle().strokeColor=_a,this.isChanged=!0}),_k(0,_a,"isChanged",null,function(_a){this._isChanged!==_a&&(this._isChanged=_a)&&_x.timer.callLater(this,this.typeset)}),_k(0,_a,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(_a){if(!(this.overflow!=_n.SCROLL||this.textWidth<this._width)&&this._clipPoint){_a=_a<this.padding[3]?this.padding[3]:_a;var _b=this._textWidth-this._width;_a=_b<_a?_b:_a;var _c=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=_a,this.renderText(this._lastVisibleLineIndex,_c)}}),_k(0,_a,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(_a){if(!(this.overflow!=_n.SCROLL||this.textHeight<this._height)&&this._clipPoint){_a=_a<this.padding[0]?this.padding[0]:_a;var _b=this._textHeight-this._height,_c=(_a=_b<_a?_b:_a)/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=_c;var _d=1+(this._height/(this._charSize.height+this.leading)|0);this._clipPoint.y=_a,this.renderText(_c,_d)}}),_k(0,_a,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),_k(0,_a,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),_k(0,_a,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),_k(0,_a,"underlineColor",function(){return this._underlineColor},function(_a){this._underlineColor=_a,this._isChanged=!0,this.typeset()}),_n.registerBitmapFont=function(_a,_b){_n._bitmapFonts||(_n._bitmapFonts={}),_n._bitmapFonts[_a]=_b},_n.unregisterBitmapFont=function(_a,_b){if(void 0===_b&&(_b=!0),_n._bitmapFonts&&_n._bitmapFonts[_a]){var _c=_n._bitmapFonts[_a];_b&&_c.destroy(),delete _n._bitmapFonts[_a]}},_n.setTextRightToLeft=function(){var _a;(_a=_M.canvas.source.style).display="none",_a.position="absolute",_a.direction="rtl",_H._mainCanvas.source.style.direction="rtl",laya.display.Text.RightToLeft=!0,_M.document.body.appendChild(_M.canvas.source)},_n.supportFont=function(_a){_M.context.font="10px sans-serif";var _b=_Y.contextMeasureText("abcji").width;_M.context.font="10px "+_a;var _c=_Y.contextMeasureText("abcji").width;return console.log(_b,_c),_b!==_c},_n._testWord="游",_n.langPacks=null,_n.VISIBLE="visible",_n.SCROLL="scroll",_n.HIDDEN="hidden",_n.CharacterCache=!0,_n.RightToLeft=!1,_n._bitmapFonts=null,_i(_n,["_fontFamilyMap",function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),_n}(_la),_ra=function(_l){function _g(){this.focus=null,this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._frameRate="fast",_g.__super.call(this),this.offset=new _y,this._canvasTransform=new _E,this._previousOrientation=_M.window.orientation;var _b=this;this.transform=_E.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var _a=_M.window,_c=this;_a.addEventListener("focus",function(){_b._isFocused=!0,_c.event("focus"),_c.event("focuschange")}),_a.addEventListener("blur",function(){_b._isFocused=!1,_c.event("blur"),_c.event("focuschange"),_c._isInputting()&&(_va.inputElement.target.focus=!1)});var _d="visibilityState",_e="visibilitychange",_f=_a.document;void 0!==_f.hidden?(_e="visibilitychange",_d="visibilityState"):void 0!==_f.mozHidden?(_e="mozvisibilitychange",_d="mozVisibilityState"):void 0!==_f.msHidden?(_e="msvisibilitychange",_d="msVisibilityState"):void 0!==_f.webkitHidden&&(_e="webkitvisibilitychange",_d="webkitVisibilityState"),_a.document.addEventListener(_e,function(){"hidden"==_M.document[_d]?_c._setStageVisible(!1):_c._setStageVisible(!0)}),_a.document.addEventListener("qbrowserVisibilityChange",function(_a){_c._setStageVisible(!_a.hidden)}),_a.addEventListener("resize",function(){var _a=_M.window.orientation;null!=_a&&_a!=_b._previousOrientation&&_c._isInputting()&&(_va.inputElement.target.focus=!1),_b._previousOrientation=_a,_c._isInputting()||_c._resetCanvas()}),_a.addEventListener("orientationchange",function(_a){_c._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),_M.onMobile&&this.on("mousedown",this,this._onmouseMove)}_p(_g,"laya.display.Stage",_l);var _a=_g.prototype;return _a._setStageVisible=function(_a){this._isVisibility!=_a&&(this._isVisibility=_a,this._isVisibility||this._isInputting()&&(_va.inputElement.target.focus=!1),this.event("visibilitychange"))},_a._isInputting=function(){return _M.onMobile&&_va.isInputting},_a._changeCanvasSize=function(){this.setScreenSize(_M.clientWidth*_M.pixelRatio,_M.clientHeight*_M.pixelRatio)},_a._resetCanvas=function(){if(this.screenAdaptationEnabled){var _a=_H._mainCanvas;_a.source.style;_a.size(1,1),_x.timer.once(100,this,this._changeCanvasSize)}},_a.setScreenSize=function(_a,_b){var _c=!1;if("none"!==this._screenMode&&(_c=(_a/_b<1?"vertical":"horizontal")!==this._screenMode)){var _d=_b;_b=_a,_a=_d}this.canvasRotation=_c;var _e=_H._mainCanvas,_f=_e.source.style,_g=this._canvasTransform.identity(),_h=this._scaleMode,_i=_a/this.designWidth,_j=_b/this.designHeight,_k=this.designWidth,_l=this.designHeight,_m=_a,_n=_b,_o=_M.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,_h){case"noscale":_i=_j=1,_m=this.designWidth,_n=this.designHeight;break;case"showall":_i=_j=Math.min(_i,_j),_k=_m=Math.round(this.designWidth*_i),_l=_n=Math.round(this.designHeight*_j);break;case"noborder":_i=_j=Math.max(_i,_j),_m=Math.round(this.designWidth*_i),_n=Math.round(this.designHeight*_j);break;case"full":_i=_j=1,this._width=_k=_a,this._height=_l=_b;break;case"fixedwidth":_j=_i,this._height=_l=Math.round(_b/_i);break;case"fixedheight":_i=_j,this._width=_k=Math.round(_a/_j);break;case"fixedauto":_a/_b<this.designWidth/this.designHeight?(_j=_i,this._height=_l=Math.round(_b/_i)):(_i=_j,this._width=_k=Math.round(_a/_j))}this._height=this._height+1&2147483646,this._width=this._width+1&2147483646,_k=_k+1&2147483646,_l=_l+1&2147483646,this.conchModel&&this.conchModel.size(this._width,this._height),_i*=this.scaleX,_j*=this.scaleY,1===_i&&1===_j?this.transform.identity():(this.transform.a=this._formatData(_i/(_m/_k)),this.transform.d=this._formatData(_j/(_n/_l)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),_e.size(_k,_l),_D.changeWebGLSize(_k,_l),_g.scale(_m/_k/_o,_n/_l/_o),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=(_a-_m)/_o:this.offset.x=.5*(_a-_m)/_o,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=(_b-_n)/_o:this.offset.y=.5*(_b-_n)/_o,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),_g.translate(this.offset.x,this.offset.y),this.canvasDegree=0,_c&&("horizontal"===this._screenMode?(_g.rotate(Math.PI/2),_g.translate(_b/_o,0),this.canvasDegree=90):(_g.rotate(-Math.PI/2),_g.translate(0,_a/_o),this.canvasDegree=-90)),_g.a=this._formatData(_g.a),_g.d=this._formatData(_g.d),_g.tx=this._formatData(_g.tx),_g.ty=this._formatData(_g.ty),_f.transformOrigin=_f.webkitTransformOrigin=_f.msTransformOrigin=_f.mozTransformOrigin=_f.oTransformOrigin="0px 0px 0px",_f.transform=_f.webkitTransform=_f.msTransform=_f.mozTransform=_f.oTransform="matrix("+_g.toString()+")",_g.translate(parseInt(_f.left)||0,parseInt(_f.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},_a._formatData=function(_a){return Math.abs(_a)<1e-6?0:Math.abs(1-_a)<.001?0<_a?1:-1:_a},_a.getMousePoint=function(){return _y.TEMP.setTo(this.mouseX,this.mouseY)},_a.repaint=function(){this._repaint=1},_a.parentRepaint=function(){},_a._loop=function(){return this.render(_H.context,0,0),!0},_a._onmouseMove=function(_a){this._mouseMoveTime=_M.now()},_a.getTimeFromFrameStart=function(){return _M.now()-this._frameStartTime},_a.render=function(_a,_b,_c){if("sleep"===this._frameRate&&!_H.isConchApp){var _d=_M.now();if(!(1e3<=_d-this._frameStartTime))return this._renderCount++,void(this._renderCount%2==0&&(_V.loopCount++,_o.instance.runEvent(),_x.timer._update()));this._frameStartTime=_d}if(this._renderCount++,_H.isFlash&&this.repaint(),this._style.visible){this._frameStartTime=_M.now();var _e="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),_f=this._renderCount%2==0;if(_V.renderSlow=!_e,_e||_f||_H.isConchApp){var _g;_V.loopCount++,_o.instance.runEvent(),_x.timer._update(),_D.update3DLoop();var _h=0,_i=0;if(_H.isConchNode)for(_h=0,_i=this._scenes.length;_h<_i;_h++)(_g=this._scenes[_h])&&_g._updateSceneConch();else for(_h=0,_i=this._scenes.length;_h<_i;_h++)(_g=this._scenes[_h])&&_g._updateScene();if(_H.isConchNode){var _j=_la.CustomList;for(_h=0,_i=_j.length;_h<_i;_h++){var _k=_j[_h];_k.customRender(_k.customContext,0,0)}return}}_H.isConchNode||this.renderingEnabled&&(_e||!_f||_H.isConchWebGL)&&(_H.isWebGL?_H.WebGL.mainContext&&!_H.WebGL.mainContext.isContextLost()&&(_a.clear(),_l.prototype.render.call(this,_a,_b,_c),_V._show&&_V._sp&&_V._sp.render(_a,_b,_c),_D.clear(this._bgColor),_D.beginFlush(),_a.flush(),_D.endFinish(),_Z.instance&&_Z.getInstance().endDispose()):(_D.clear(this._bgColor),_l.prototype.render.call(this,_a,_b,_c),_V._show&&_V._sp&&_V._sp.render(_a,_b,_c)))}else this._renderCount%5==0&&(_V.loopCount++,_o.instance.runEvent(),_x.timer._update())},_a._requestFullscreen=function(){var _a=_M.document.documentElement;_a.requestFullscreen?_a.requestFullscreen():_a.mozRequestFullScreen?_a.mozRequestFullScreen():_a.webkitRequestFullscreen?_a.webkitRequestFullscreen():_a.msRequestFullscreen&&_a.msRequestFullscreen()},_a._fullScreenChanged=function(){_x.stage.event("fullscreenchange")},_a.exitFullscreen=function(){var _a=_M.document;_a.exitFullscreen?_a.exitFullscreen():_a.mozCancelFullScreen?_a.mozCancelFullScreen():_a.webkitExitFullscreen&&_a.webkitExitFullscreen()},_k(0,_a,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),_k(0,_a,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),_k(0,_a,"frameRate",function(){return this._frameRate},function(_a){if(this._frameRate=_a,_H.isConchApp)switch(this._frameRate){case"slow":_M.window.conch&&_M.window.conchConfig.setSlowFrame&&_M.window.conchConfig.setSlowFrame(!0);break;case"fast":_M.window.conch&&_M.window.conchConfig.setSlowFrame&&_M.window.conchConfig.setSlowFrame(!1);break;case"mouse":_M.window.conch&&_M.window.conchConfig.setMouseFrame&&_M.window.conchConfig.setMouseFrame(2e3);break;case"sleep":_M.window.conch&&_M.window.conchConfig.setLimitFPS&&_M.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.")}}),_k(0,_a,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),_k(0,_a,"width",_l.prototype._$get_width,function(_a){this.designWidth=_a,_x.superSet(_la,this,"width",_a),_x.timer.callLater(this,this._changeCanvasSize)}),_k(0,_a,"alignH",function(){return this._alignH},function(_a){this._alignH=_a,_x.timer.callLater(this,this._changeCanvasSize)}),_k(0,_a,"isFocused",function(){return this._isFocused}),_k(0,_a,"height",_l.prototype._$get_height,function(_a){this.designHeight=_a,_x.superSet(_la,this,"height",_a),_x.timer.callLater(this,this._changeCanvasSize)}),_k(0,_a,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||_E.create()},_l.prototype._$set_transform),_k(0,_a,"isVisibility",function(){return this._isVisibility}),_k(0,_a,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),_k(0,_a,"scaleMode",function(){return this._scaleMode},function(_a){this._scaleMode=_a,_x.timer.callLater(this,this._changeCanvasSize)}),_k(0,_a,"alignV",function(){return this._alignV},function(_a){this._alignV=_a,_x.timer.callLater(this,this._changeCanvasSize)}),_k(0,_a,"bgColor",function(){return this._bgColor},function(_a){this._bgColor=_a,this.conchModel&&this.conchModel.bgColor(_a),_H.isWebGL&&(_a?_g._wgColor=_Q.create(_a)._color:_M.onMiniGame||(_g._wgColor=null)),_M.onLimixiu?_g._wgColor=_Q.create(_a)._color:_H.canvas.style.background=_a||"none"}),_k(0,_a,"mouseX",function(){return Math.round(_o.instance.mouseX/this.clientScaleX)}),_k(0,_a,"mouseY",function(){return Math.round(_o.instance.mouseY/this.clientScaleY)}),_k(0,_a,"screenMode",function(){return this._screenMode},function(_a){this._screenMode=_a}),_k(0,_a,"visible",_l.prototype._$get_visible,function(_a){this.visible!==_a&&(_x.superSet(_la,this,"visible",_a),_H._mainCanvas.source.style.visibility=_a?"visible":"hidden")}),_k(0,_a,"fullScreenEnabled",null,function(_a){var _b=_M.document,_c=_H.canvas;_a?(_c.addEventListener("mousedown",this._requestFullscreen),_c.addEventListener("touchstart",this._requestFullscreen),_b.addEventListener("fullscreenchange",this._fullScreenChanged),_b.addEventListener("mozfullscreenchange",this._fullScreenChanged),_b.addEventListener("webkitfullscreenchange",this._fullScreenChanged),_b.addEventListener("msfullscreenchange",this._fullScreenChanged)):(_c.removeEventListener("mousedown",this._requestFullscreen),_c.removeEventListener("touchstart",this._requestFullscreen),_b.removeEventListener("fullscreenchange",this._fullScreenChanged),_b.removeEventListener("mozfullscreenchange",this._fullScreenChanged),_b.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),_b.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),_g.SCALE_NOSCALE="noscale",_g.SCALE_EXACTFIT="exactfit",_g.SCALE_SHOWALL="showall",_g.SCALE_NOBORDER="noborder",_g.SCALE_FULL="full",_g.SCALE_FIXED_WIDTH="fixedwidth",_g.SCALE_FIXED_HEIGHT="fixedheight",_g.SCALE_FIXED_AUTO="fixedauto",_g.ALIGN_LEFT="left",_g.ALIGN_RIGHT="right",_g.ALIGN_CENTER="center",_g.ALIGN_TOP="top",_g.ALIGN_MIDDLE="middle",_g.ALIGN_BOTTOM="bottom",_g.SCREEN_NONE="none",_g.SCREEN_HORIZONTAL="horizontal",_g.SCREEN_VERTICAL="vertical",_g.FRAME_FAST="fast",_g.FRAME_SLOW="slow",_g.FRAME_MOUSE="mouse",_g.FRAME_SLEEP="sleep",_g.FRAME_MOUSE_THREDHOLD=2e3,_i(_g,["_wgColor",function(){return this._wgColor=[0,0,0,1]}]),_g}(_la),_sa=(function(_a){function _b(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,_b.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}_p(_b,"laya.media.SoundNode",_la);var _c=_b.prototype;_c._onParentChange=function(){this.target=this.parent},_c.play=function(_a,_b){void 0===_a&&(_a=1),isNaN(_a)&&(_a=1),this.url&&(this.stop(),this._channel=_C.playSound(this.url,_a,null,_b))},_c.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},_c._setPlayAction=function(_a,_b,_c,_d){void 0===_d&&(_d=!0),this[_c]&&_a&&(_d?_a.on(_b,this,this[_c]):_a.off(_b,this,this[_c]))},_c._setPlayActions=function(_a,_b,_c,_d){if(void 0===_d&&(_d=!0),_a&&_b){var _e,_f=_b.split(","),_g=0;for(_e=_f.length,_g=0;_g<_e;_g++)this._setPlayAction(_a,_f[_g],_c,_d)}},_k(0,_c,"playEvent",null,function(_a){(this._playEvents=_a)&&this._tar&&this._setPlayActions(this._tar,_a,"play")}),_k(0,_c,"target",null,function(_a){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=_a,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),_k(0,_c,"stopEvent",null,function(_a){(this._stopEvents=_a)&&this._tar&&this._setPlayActions(this._tar,_a,"stop")})}(),function(_a){function _b(){this._src=null,this._onload=null,this._onerror=null,_b.__super.call(this)}_p(_b,"laya.resource.FileBitmap",_oa);var _c=_b.prototype;return _k(0,_c,"src",function(){return this._src},function(_a){this._src=_a}),_k(0,_c,"onload",null,function(_a){}),_k(0,_c,"onerror",null,function(_a){}),_b}()),_ta=function(_a){function _c(_a,_b){this._is2D=!1,_c.__super.call(this);var _d=this;if(this._source=this,"2D"===_a||"AUTO"===_a&&!_H.isWebGL){this._is2D=!0,this._source=_b||_M.createElement("canvas"),this._w=this._source.width,this._h=this._source.height;var _e=this;_e.getContext=function(_a,_b){if(_d._ctx)return _d._ctx;var _c=_d._ctx=_d._source.getContext(_a,_b);return _c&&(_c._canvas=_e,_H.isFlash||_M.onLimixiu||(_c.size=function(_a,_b){})),_c}}this.uri="HTMLCanvas_"+this.id,this.lock=!0}_p(_c,"laya.resource.HTMLCanvas",_oa);var _b=_c.prototype;return _b.clear=function(){this._ctx&&this._ctx.clear()},_b.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},_b.release=function(){},_b._setContext=function(_a){this._ctx=_a},_b.getContext=function(_a,_b){return this._ctx?this._ctx:this._ctx=_c._createContext(this)},_b.getMemSize=function(){return 0},_b.size=function(_a,_b){(this._w!=_a||this._h!=_b||this._source&&(this._source.width!=_a||this._source.height!=_b))&&(this._w=_a,this._h=_b,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(_a,_b),this._source&&(this._source.height=_b,this._source.width=_a))},_b.getCanvas=function(){return this._source},_b.toBase64=function(_a,_b,_c){if(this._source)if(_H.isConchApp&&this._source.toBase64)this._source.toBase64(_a,_b,_c);else{var _d=this._source.toDataURL(_a,_b);_c.call(this,_d)}},_k(0,_b,"context",function(){return this._ctx}),_k(0,_b,"asBitmap",null,function(_a){}),_c.create=function(_a,_b){return new _c(_a,_b)},_c.TYPE2D="2D",_c.TYPE3D="3D",_c.TYPEAUTO="AUTO",_c._createContext=null,_c}(),_ua=(function(_a){function _i(_a,_b,_c,_d,_e,_f,_g,_h){throw _i.__super.call(this),new Error("不允许new！")}_p(_i,"laya.resource.HTMLSubImage",_oa),_i.create=function(_a,_b,_c,_d,_e,_f,_g,_h){return void 0===_h&&(_h=!1),new _i(_a,_b,_c,_d,_e,_f,_g,_h)}}(),function(_a){function _l(){this._frames=null,this._url=null,_l.__super.call(this),this._setControlNode(this)}_p(_l,"laya.display.Animation",_a);var _b=_l.prototype;_b.destroy=function(_a){void 0===_a&&(_a=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,_a),this._frames=null,this._labels=null},_b.play=function(_a,_b,_c,_d){void 0===_a&&(_a=0),void 0===_b&&(_b=!0),void 0===_c&&(_c=""),void 0===_d&&(_d=!0),_c&&this._setFramesFromCache(_c,_d),this._isPlaying=!0,this.index="string"==typeof _a?this._getFrameByLabel(_a):_a,this.loop=_b,this._actionName=_c,this._isReverse=1==this.wrapMode,this._frames&&0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},_b._setFramesFromCache=function(_a,_b){var _c;return void 0===_b&&(_b=!1),this._url&&(_a=this._url+"#"+_a),_a&&_l.framesMap[_a]?((_c=_l.framesMap[_a])instanceof Array?(this._frames=_l.framesMap[_a],this._count=this._frames.length):(_c.nodeRoot&&(_l.framesMap[_a]=this._parseGraphicAnimationByData(_c),_c=_l.framesMap[_a]),this._frames=_c.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=_c.interval),this._labels=this._copyLabels(_c.labels)),!0):(_b&&console.log("ani not found:",_a),!1)},_b._copyLabels=function(_a){if(!_a)return null;var _b,_c;for(_c in _b={},_a)_b[_c]=_Y.copyArray([],_a[_c]);return _b},_b._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&_a.prototype._frameLoop.call(this)},_b._displayToIndex=function(_a){this._frames&&(this.graphics=this._frames[_a])},_b.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},_b.loadImages=function(_a,_b){return void 0===_b&&(_b=""),this._url="",this._setFramesFromCache(_b)||(this.frames=_l.framesMap[_b]?_l.framesMap[_b]:_l.createFrames(_a,_b)),this},_b.loadAtlas=function(_b,_c,_d){void 0===_d&&(_d=""),this._url="";var _e=this;function _a(_a){_b===_a&&(_e.frames=_l.framesMap[_d]?_l.framesMap[_d]:_l.createFrames(_b,_d),_c&&_c.run())}return _e._setFramesFromCache(_d)||(_ha.getAtlas(_b)?_a(_b):_x.loader.load(_b,_s.create(null,_a,[_b]),null,"atlas")),this},_b.loadAnimation=function(_a,_b,_c){this._url=_a;return this._actionName||(this._actionName=""),this._setFramesFromCache("")?(this._setFramesFromCache(this._actionName,!0),this.index=0,_b&&_b.run()):!_c||_ha.getAtlas(_c)?this._loadAnimationData(_a,_b,_c):_x.loader.load(_c,_s.create(this,this._loadAnimationData,[_a,_b,_c]),null,"atlas"),this},_b._loadAnimationData=function(_h,_i,_a){var _j=this;if(!_a||_ha.getAtlas(_a)){var _k=this;_ha.getRes(_h)?_b(_h):_x.loader.load(_h,_s.create(null,_b,[_h]),null,"json"),_ha.clearRes(_h)}else console.warn("atlas load fail:"+_a);function _b(_a){if(_ha.getRes(_a)&&_h===_a){var _b;if(_l.framesMap[_h+"#"])_k._setFramesFromCache(_j._actionName,!0),_j.index=0,_j._checkResumePlaying();else{var _c=_k._parseGraphicAnimation(_ha.getRes(_h));if(!_c)return;var _d,_e=_c.animationList,_f=0,_g=_e.length;for(_f=0;_f<_g;_f++)_b=_e[_f],_l.framesMap[_h+"#"+_b.name]=_b,_d||(_d=_b);_d&&(_l.framesMap[_h+"#"]=_d,_k._setFramesFromCache(_j._actionName,!0),_j.index=0),_j._checkResumePlaying()}_i&&_i.run()}}},_b._parseGraphicAnimation=function(_a){return _xa.parseAnimationData(_a)},_b._parseGraphicAnimationByData=function(_a){return _xa.parseAnimationByData(_a)},_k(0,_b,"frames",function(){return this._frames},function(_a){(this._frames=_a)&&(this._count=_a.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),_k(0,_b,"autoPlay",null,function(_a){_a?this.play():this.stop()}),_k(0,_b,"source",null,function(_a){-1<_a.indexOf(".ani")?this.loadAnimation(_a):-1<_a.indexOf(".json")||-1<_a.indexOf("als")||-1<_a.indexOf("atlas")?this.loadAtlas(_a):this.loadImages(_a.split(","))}),_k(0,_b,"autoAnimation",null,function(_a){this.play(0,!0,_a,!1)}),_l.createFrames=function(_a,_b){var _c,_d,_e=0,_f=0;if("string"==typeof _a){var _g=_ha.getAtlas(_a);if(_g&&_g.length)for(_c=[],_e=0,_f=_g.length;_e<_f;_e++)(_d=new _D.createGraphics).drawTexture(_ha.getRes(_g[_e]),0,0),_c.push(_d)}else if(_a instanceof Array)for(_c=[],_e=0,_f=_a.length;_e<_f;_e++)(_d=new _D.createGraphics).loadImage(_a[_e],0,0),_c.push(_d);return _b&&(_l.framesMap[_b]=_c),_c},_l.clearCache=function(_a){var _b,_c=_l.framesMap,_d=_a+"#";for(_b in _c)_b!==_a&&0!=_b.indexOf(_d)||delete _l.framesMap[_b]},_l.framesMap={}}(_pa),function(_a){function _f(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,_f.__super.call(this),null==_f._sortIndexFun&&(_f._sortIndexFun=_w.sortByKey("index",!1,!0))}_p(_f,"laya.display.FrameAnimation",_a);var _b=_f.prototype;return _b._setUp=function(_a,_b){this._labels=null,this._animationNewFrames=null,this._targetDic=_a,this._animationData=_b,this.interval=1e3/_b.frameRate,_b.parsed?(this._count=_b.count,this._labels=_b.labels,this._animationNewFrames=_b.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),_b.parsed=!0,_b.labels=this._labels,_b.count=this._count,_b.animationNewFrames=this._animationNewFrames},_b.clear=function(){_a.prototype.clear.call(this),this._targetDic=null,this._animationData=null},_b._displayToIndex=function(_a){if(this._animationData){_a<0&&(_a=0),_a>this._count&&(_a=this._count);var _b=this._animationData.nodes,_c=0,_d=_b.length;for(_c=0;_c<_d;_c++)this._displayNodeToFrame(_b[_c],_a)}},_b._displayNodeToFrame=function(_a,_b,_c){_c||(_c=this._targetDic);var _d=_c[_a.target];if(_d){var _e,_f,_g,_h=_a.frames,_i=_a.keys,_j=0,_k=_i.length;for(_j=0;_j<_k;_j++)_g=(_f=_h[_e=_i[_j]]).length>_b?_f[_b]:_f[_f.length-1],_d[_e]=_g}},_b._calculateDatas=function(){if(this._animationData){var _a,_b=this._animationData.nodes,_c=0,_d=_b.length;for(_c=this._count=0;_c<_d;_c++)_a=_b[_c],this._calculateNodeKeyFrames(_a);this._count+=1}},_b._calculateNodeKeyFrames=function(_a){var _b,_c,_d=_a.keyframes,_e=_a.target;for(_b in _a.frames||(_a.frames={}),_a.keys?_a.keys.length=0:_a.keys=[],_a.initValues||(_a.initValues={}),_d)_c=_d[_b],_a.frames[_b]||(_a.frames[_b]=[]),this._targetDic&&this._targetDic[_e]&&(_a.initValues[_b]=this._targetDic[_e][_b]),_c.sort(_f._sortIndexFun),_a.keys.push(_b),this._calculateNodePropFrames(_c,_a.frames[_b],_b,_e)},_b.resetToInitState=function(){if(this._targetDic&&this._animationData){var _a,_b,_c=this._animationData.nodes,_d=0,_e=_c.length;for(_d=0;_d<_e;_d++)if(_b=(_a=_c[_d]).initValues){var _f,_g=this._targetDic[_a.target];if(_g)for(_f in _b)_g[_f]=_b[_f]}}},_b._calculateNodePropFrames=function(_a,_b,_c,_d){var _e=0,_f=_a.length-1;if(0<_f){for(_b.length=_a[_f].index+1,_e=0;_e<_f;_e++)this._dealKeyFrame(_a[_e]),this._calculateFrameValues(_a[_e],_a[_e+1],_b);this._dealKeyFrame(_a[_e])}0==_f&&(_b[_a[0].index]=_a[0].value,this._animationNewFrames&&(this._animationNewFrames[_a[0].index]=!0))},_b._dealKeyFrame=function(_a){_a.label&&""!=_a.label&&this.addLabel(_a.label,_a.index)},_b._calculateFrameValues=function(_a,_b,_c){var _d,_e=0,_f=_a.index,_g=_b.index,_h=_a.value,_i=_b.value-_a.value,_j=_g-_f;if(_g>this._count&&(this._count=_g),_a.tween)for(null==(_d=_S[_a.tweenMethod])&&(_d=_S.linearNone),_e=_f;_e<_g;_e++)_c[_e]=_d(_e-_f,_h,_i,_j),this._animationNewFrames&&(this._animationNewFrames[_e]=!0);else for(_e=_f;_e<_g;_e++)_c[_e]=_h;this._animationNewFrames&&(this._animationNewFrames[_a.index]=!0,this._animationNewFrames[_b.index]=!0),_c[_b.index]=_b.value},_f._sortIndexFun=null,_f}(_pa)),_va=function(_b){function _e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",_e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=_qa.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}_p(_e,"laya.display.Input",_b);var _a=_e.prototype;return _a.setSelection=function(_a,_b){this.focus=!0,laya.display.Input.inputElement.selectionStart=_a,laya.display.Input.inputElement.selectionEnd=_b},_a._onUnDisplay=function(_a){this.focus=!1},_a._onMouseDown=function(_a){this.focus=!0},_a._syncInputTransform=function(){var _a=this.nativeInput,_b=_Y.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),_c=this._width-this.padding[1]-this.padding[3],_d=this._height-this.padding[0]-this.padding[2];_H.isConchApp?(_a.setScale(_b.scaleX,_b.scaleY),_a.setSize(_c,_d),_a.setPos(_b.x,_b.y)):(_e.inputContainer.style.transform=_e.inputContainer.style.webkitTransform="scale("+_b.scaleX+","+_b.scaleY+") rotate("+_x.stage.canvasDegree+"deg)",_a.style.width=_c+"px",_a.style.height=_d+"px",_e.inputContainer.style.left=_b.x+"px",_e.inputContainer.style.top=_b.y+"px")},_a.select=function(){this.nativeInput&&this.nativeInput.select&&this.nativeInput.select()},_a._setInputMethod=function(){_e.input.parentElement&&_e.inputContainer.removeChild(_e.input),_e.area.parentElement&&_e.inputContainer.removeChild(_e.area),_e.inputElement=this._multiline?_e.area:_e.input,_e.inputContainer.appendChild(_e.inputElement),_qa.RightToLeft&&(_e.inputElement.style.direction="rtl")},_a._focusIn=function(){laya.display.Input.isInputting=!0;var _a=this.nativeInput;this._focus=!0;var _b=_a.style;_b.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),_a.readOnly=!this._editable,_H.isConchApp&&(_a.setType(this._type),_a.setForbidEdit(!this._editable)),_a.maxLength=this._maxChars;this.padding;if(_a.type=this._type,_a.value=this._content,_a.placeholder=this._prompt,_x.stage.off("keydown",this,this._onKeyDown),_x.stage.on("keydown",this,this._onKeyDown),(_x.stage.focus=this).event("focus"),_M.onPC&&_a.focus(),!_M.onMiniGame){this._text;this._text=null}this.typeset(),_a.setColor(this._originColor),_a.setFontSize(this.fontSize),_a.setFontFace(_M.onIPhone&&_qa._fontFamilyMap[this.font]||this.font),_H.isConchApp&&_a.setMultiAble&&_a.setMultiAble(this._multiline),_b.lineHeight=this.leading+this.fontSize+"px",_b.fontStyle=this.italic?"italic":"normal",_b.fontWeight=this.bold?"bold":"normal",_b.textAlign=this.align,_b.padding="0 0",this._syncInputTransform(),!_H.isConchApp&&_M.onPC&&_x.timer.frameLoop(1,this,this._syncInputTransform)},_a._setPromptColor=function(){(_e.promptStyleDOM=_M.getElementById("promptStyle"))||((_e.promptStyleDOM=_M.createElement("style")).setAttribute("id","promptStyle"),_M.document.head.appendChild(_e.promptStyleDOM)),_e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},_a._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(_x.superSet(_qa,this,"text",this._content),_x.superSet(_qa,this,"color",this._originColor)):(_x.superSet(_qa,this,"text",this._prompt),_x.superSet(_qa,this,"color",this._promptColor)),_x.stage.off("keydown",this,this._onKeyDown),_x.stage.focus=null,this.event("blur"),_H.isConchApp&&this.nativeInput.blur(),_M.onPC&&_x.timer.clear(this,this._syncInputTransform)},_a._onKeyDown=function(_a){13===_a.keyCode&&(_M.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},_a.changeText=function(_a){this._content=_a,this._focus?(this.nativeInput.value=_a||"",this.event("change")):_b.prototype.changeText.call(this,_a)},_k(0,_a,"color",_b.prototype._$get_color,function(_a){this._focus&&this.nativeInput.setColor(_a),_x.superSet(_qa,this,"color",this._content?_a:this._promptColor),this._originColor=_a}),_k(0,_a,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(_a){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),_k(0,_a,"multiline",function(){return this._multiline},function(_a){this._multiline=_a,this.valign=_a?"top":"middle"}),_k(0,_a,"maxChars",function(){return this._maxChars},function(_a){_a<=0&&(_a=1e5),this._maxChars=_a}),_k(0,_a,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(_a){_x.superSet(_qa,this,"color",this._originColor),_a+="",this._focus?(this.nativeInput.value=_a||"",this.event("change")):(this._multiline||(_a=_a.replace(/\r?\n/g,"")),(this._content=_a)?_x.superSet(_qa,this,"text",_a):(_x.superSet(_qa,this,"text",this._prompt),_x.superSet(_qa,this,"color",this.promptColor)))}),_k(0,_a,"nativeInput",function(){return this._multiline?_e.area:_e.input}),_k(0,_a,"prompt",function(){return this._prompt},function(_a){!this._text&&_a&&_x.superSet(_qa,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?_x.superSet(_qa,this,"text",this._text==this._prompt?_a:this._text):_x.superSet(_qa,this,"text",_a),this._prompt=_qa.langPacks&&_qa.langPacks[_a]?_qa.langPacks[_a]:_a}),_k(0,_a,"focus",function(){return this._focus},function(_a){var _b=this.nativeInput;this._focus!==_a&&(_a?(_b.target?_b.target._focusOut():this._setInputMethod(),(_b.target=this)._focusIn()):(_b.target=null,this._focusOut(),_M.document.body.scrollTop=0,_b.blur(),_H.isConchApp?_b.setPos(-1e4,-1e4):_e.inputContainer.contains(_b)&&_e.inputContainer.removeChild(_b)))}),_k(0,_a,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(_a){_a?(-1<(_a="[^"+_a+"]").indexOf("^^")&&(_a=_a.replace("^^","")),this._restrictPattern=new RegExp(_a,"g")):this._restrictPattern=null}),_k(0,_a,"editable",function(){return this._editable},function(_a){this._editable=_a,_H.isConchApp&&_e.input.setForbidEdit(!_a)}),_k(0,_a,"promptColor",function(){return this._promptColor},function(_a){this._promptColor=_a,this._content||_x.superSet(_qa,this,"color",_a)}),_k(0,_a,"type",function(){return this._type},function(_a){this._getCSSStyle().password="password"==_a,this._type=_a,_H.isConchApp&&this.nativeInput.setType(_a)}),_k(0,_a,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(_a){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),_k(0,_a,"asPassword",function(){return this._getCSSStyle().password},function(_a){this._getCSSStyle().password=_a,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),_e.__init__=function(){_e._createInputElement(),_M.onMobile&&_H.canvas.addEventListener(_e.IOS_IFRAME?_M.onMiniGame?"touchend":"click":"touchend",_e._popupInputMethod)},_e._popupInputMethod=function(_a){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},_e._createInputElement=function(){_e._initInput(_e.area=_M.createElement("textarea")),_e._initInput(_e.input=_M.createElement("input")),(_e.inputContainer=_M.createElement("div")).style.position="absolute",_e.inputContainer.style.zIndex=1e5,_M.container.appendChild(_e.inputContainer),_e.inputContainer.setPos=function(_a,_b){_e.inputContainer.style.left=_a+"px",_e.inputContainer.style.top=_b+"px"}},_e._initInput=function(_b){var _a=_b.style;_a.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",_a.resize="none",_a.backgroundColor="transparent",_a.border="none",_a.outline="none",_a.zIndex=1,_b.addEventListener("input",_e._processInputting),_b.addEventListener("mousemove",_e._stopEvent),_b.addEventListener("mousedown",_e._stopEvent),_b.addEventListener("touchmove",_e._stopEvent),_b.setFontFace=function(_a){_b.style.fontFamily=_a},_H.isConchApp||(_b.setColor=function(_a){_b.style.color=_a},_b.setFontSize=function(_a){_b.style.fontSize=_a+"px"})},_e._processInputting=function(_a){var _b=laya.display.Input.inputElement.target;if(_b){var _c=laya.display.Input.inputElement.value;_b._restrictPattern&&(_c=_c.replace(/\u2006|\x27/g,""),_b._restrictPattern.test(_c)&&(_c=_c.replace(_b._restrictPattern,""),laya.display.Input.inputElement.value=_c)),_b._text=_c,_b.event("input")}},_e._stopEvent=function(_a){"touchmove"==_a.type&&_a.preventDefault(),_a.stopPropagation&&_a.stopPropagation()},_e.TYPE_TEXT="text",_e.TYPE_PASSWORD="password",_e.TYPE_EMAIL="email",_e.TYPE_URL="url",_e.TYPE_NUMBER="number",_e.TYPE_RANGE="range",_e.TYPE_DATE="date",_e.TYPE_MONTH="month",_e.TYPE_WEEK="week",_e.TYPE_TIME="time",_e.TYPE_DATE_TIME="datetime",_e.TYPE_DATE_TIME_LOCAL="datetime-local",_e.TYPE_SEARCH="search",_e.input=null,_e.area=null,_e.inputElement=null,_e.inputContainer=null,_e.confirmButton=null,_e.promptStyleDOM=null,_e.inputHeight=45,_e.isInputting=!1,_e.stageMatrix=null,_i(_e,["IOS_IFRAME",function(){return this.IOS_IFRAME=_M.onIOS&&_M.window.top!=_M.window.self}]),_e}(_qa),_wa=function(_a){function _c(_a,_b){this._recreateLock=!1,this._needReleaseAgain=!1,this._enableMerageInAtlas=!0,_c.__super.call(this),_a&&this._init_(_a,_b)}_p(_c,"laya.resource.HTMLImage",_sa);var _b=_c.prototype;return _b._init_=function(_a,_b){this._src=_a,this._source=new _M.window.Image,_b&&(_b.onload&&(this.onload=_b.onload),_b.onerror&&(this.onerror=_b.onerror),_b.onCreate&&_b.onCreate(this)),0!=_a.indexOf("data:image")&&(this._source.crossOrigin=""),_a&&(this._source.src=_a)},_b.recreateResource=function(){var _a=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0;var _b=this;this._source=new _M.window.Image,this._source.crossOrigin="",this._source.onload=function(){if(_b._needReleaseAgain)return _b._needReleaseAgain=!1,_b._source.onload=null,void(_b._source=null);_b._source.onload=null,_b.memorySize=_a._w*_a._h*4,_b._recreateLock=!1,_b.completeCreate()},this._source.src=this._src}},_b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},_b.onresize=function(){this._w=this._source.width,this._h=this._source.height},_k(0,_b,"onload",null,function(_a){var _b=this;this._onload=_a,this._source&&(this._source.onload=null!=this._onload?function(){_b.onresize(),_b._onload()}:null)}),_k(0,_b,"onerror",null,function(_a){var _b=this;this._onerror=_a,this._source&&(this._source.onerror=null!=this._onerror?function(){_b._onerror()}:null)}),_k(0,_b,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(_a){this._enableMerageInAtlas=_a,_H.isConchApp&&this._source&&(this._source.enableMerageInAtlas=_a)}),_c.create=function(_a,_b){return new _c(_a,_b)},_c}(),_xa=(function(_f){function _a(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,_a.__super.call(this)}_p(_a,"laya.display.EffectAnimation",_f);var _b=_a.prototype;_b._onOtherBegin=function(_a){_a!=this&&this.stop()},_b.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},_b._onPlayAction=function(){this.play(0,!1)},_b.play=function(_a,_b,_c,_d){void 0===_a&&(_a=0),void 0===_b&&(_b=!0),void 0===_c&&(_c=""),void 0===_d&&(_d=!0),this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),laya.display.AnimationPlayerBase.prototype.play.call(this,_a,_b,_c,_d))},_b._recordInitData=function(){if(this._aniKeys){var _a,_b,_c=0;for(_a=this._aniKeys.length,_c=0;_c<_a;_c++)_b=this._aniKeys[_c],this._initData[_b]=this._target[_b]}},_b._displayToIndex=function(_a){if(this._animationData){_a<0&&(_a=0),_a>this._count&&(_a=this._count);var _b=this._animationData.nodes,_c=0,_d=_b.length;for(_d=1<_d?1:_d,_c=0;_c<_d;_c++)this._displayNodeToFrame(_b[_c],_a)}},_b._displayNodeToFrame=function(_a,_b,_c){if(this._target){var _d;_d=this._target;var _e,_f,_g,_h,_i=_a.frames,_j=_a.keys,_k=0,_l=_j.length;_h=_a.secondFrames;var _m,_n,_o,_p,_q=0;for(_k=0;_k<_l;_k++)_f=_i[_e=_j[_k]],_g=-1==(_q=_h[_e])?this._initData[_e]:_b<_q?(_o=(_n=_a.keyframes[_e])[0]).tween?(null==(_m=_S[_o.tweenMethod])&&(_m=_S.linearNone),_p=_n[1],_m(_b,this._initData[_e],_p.value-this._initData[_e],_p.index)):this._initData[_e]:_f.length>_b?_f[_b]:_f[_f.length-1],_d[_e]=_g}},_b._calculateNodeKeyFrames=function(_a){_f.prototype._calculateNodeKeyFrames.call(this,_a);var _b,_c,_d,_e=_a.keyframes;_a.target;for(_b in _d={},_a.secondFrames=_d,_e)(_c=_e[_b]).length<=1?_d[_b]=-1:_d[_b]=_c[1].index},_k(0,_b,"target",function(){return this._target},function(_a){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=_a,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),_k(0,_b,"playEvent",null,function(_a){(this._playEvents=_a)&&this.addEvent()}),_k(0,_b,"effectData",null,function(_a){var _b;_a&&((_b=_a.animations)&&_b[0]&&(this._setUp({},_b[0]),_b[0].nodes&&_b[0].nodes[0]&&(this._aniKeys=_b[0].nodes[0].keys)))}),_k(0,_b,"effectClass",null,function(_a){var _b,_c;(this._effectClass=_P.getClass(_a),this._effectClass)&&((_b=this._effectClass.uiView)&&(_c=_b.animations)&&_c[0]&&(this._setUp({},_c[0]),_c[0].nodes&&_c[0].nodes[0]&&(this._aniKeys=_c[0].nodes[0].keys)))}),_a.EffectAnimationBegin="effectanimationbegin"}(_ua),function(_b){var _B;function _C(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,_C.__super.call(this)}_p(_C,"laya.utils.GraphicAnimation",_b);var _a=_C.prototype;return _a._parseNodeList=function(_a){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[_a.compId]=_a.props,_a.compId&&this._nodeList.push(_a.compId);var _b=_a.child;if(_b){var _c=0,_d=_b.length;for(_c=0;_c<_d;_c++)this._parseNodeList(_b[_c])}},_a._calGraphicData=function(_a){var _b;if(this._setUp(null,_a),this._createGraphicData(),this._nodeIDAniDic)for(_b in this._nodeIDAniDic)this._nodeIDAniDic[_b]=null},_a._createGraphicData=function(){var _a,_b=[],_c=0,_d=this.count,_e=this._animationNewFrames;for(_e||(_e=[]),_c=0;_c<_d;_c++)!_e[_c]&&_a||(_a=this._createFrameGraphic(_c)),_b.push(_a);this._gList=_b},_a._createFrameGraphic=function(_a){var _b=_D.createGraphics();return _C._rootMatrix||(_C._rootMatrix=new _E),this._updateNodeGraphic(this._rootNode,_a,_C._rootMatrix,_b),_b},_a._updateNodeGraphic=function(_a,_b,_c,_d,_e){var _f;void 0===_e&&(_e=1);var _g,_h,_i,_j=(_f=this._nodeGDic[_a.compId]=this._getNodeGraphicData(_a.compId,_b,this._nodeGDic[_a.compId])).alpha*_e;if(!(_j<.01)&&(_f.resultTransform||(_f.resultTransform=_E.create()),_g=_f.resultTransform,_E.mul(_f.transform,_c,_g),_f.skin&&(_h=this._getTextureByUrl(_f.skin))&&(_g._checkTransform()?(_d.drawTexture(_h,0,0,_f.width,_f.height,_g,_j),_f.resultTransform=null):_d.drawTexture(_h,_g.tx,_g.ty,_f.width,_f.height,null,_j)),_i=_a.child)){var _k,_l=0;for(_k=_i.length,_l=0;_l<_k;_l++)this._updateNodeGraphic(_i[_l],_b,_g,_d,_j)}},_a._updateNoChilds=function(_a,_b){if(_a.skin){var _c=this._getTextureByUrl(_a.skin);if(_c){var _d=_a.transform;_d._checkTransform();!_d.bTransform?_b.drawTexture(_c,_d.tx,_d.ty,_a.width,_a.height,null,_a.alpha):_b.drawTexture(_c,0,0,_a.width,_a.height,_d.clone(),_a.alpha)}}},_a._updateNodeGraphic2=function(_a,_b,_c){var _d;if(_d=this._nodeGDic[_a.compId]=this._getNodeGraphicData(_a.compId,_b,this._nodeGDic[_a.compId]),_a.child){var _e=_d.transform;_e._checkTransform();var _f,_g;_g=(_f=!_e.bTransform)&&(0!=_e.tx||0!=_e.ty);var _h,_i,_j;if((_h=_e.bTransform||1!=_d.alpha)&&_c.save(),1!=_d.alpha&&_c.alpha(_d.alpha),_f?_g&&_c.translate(_e.tx,_e.ty):_c.transform(_e.clone()),_i=_a.child,_d.skin&&(_j=this._getTextureByUrl(_d.skin))&&_c.drawTexture(_j,0,0,_d.width,_d.height),_i){var _k,_l=0;for(_k=_i.length,_l=0;_l<_k;_l++)this._updateNodeGraphic2(_i[_l],_b,_c)}_h?_c.restore():_f?_g&&_c.translate(-_e.tx,-_e.ty):_c.transform(_e.clone().invert())}else this._updateNoChilds(_d,_c)},_a._calculateNodeKeyFrames=function(_a){_b.prototype._calculateNodeKeyFrames.call(this,_a),this._nodeIDAniDic[_a.target]=_a},_a.getNodeDataByID=function(_a){return this._nodeIDAniDic[_a]},_a._getParams=function(_a,_b,_c,_d){var _e=_C._temParam;_e.length=_b.length;var _f=0,_g=_b.length;for(_f=0;_f<_g;_f++)_e[_f]=this._getObjVar(_a,_b[_f][0],_c,_b[_f][1],_d);return _e},_a._getObjVar=function(_a,_b,_c,_d,_e){if(_a.hasOwnProperty(_b)){var _f=_a[_b];if(_c>=_f.length&&(_c=_f.length-1),null!=_a[_b][_c])return _a[_b][_c]}return _e.hasOwnProperty(_b)?_e[_b]:_d},_a._getNodeGraphicData=function(_a,_b,_c){_c||(_c=_B.create()),_c.transform?_c.transform.identity():_c.transform=_E.create();var _d=this.getNodeDataByID(_a);if(!_d)return _c;var _e,_f,_g=_d.frames,_h=this._getParams(_g,_C._drawTextureCmd,_b,this._nodeDefaultProps[_a]),_i=_h[0],_j=NaN,_k=NaN,_l=_h[5],_m=_h[6],_n=_h[13],_o=_h[14],_p=_h[7],_q=_h[8],_r=_h[9],_s=_h[11],_t=_h[12];_j=_h[3],_k=_h[4],0!=_j&&0!=_k||(_i=null),-1==_j&&(_j=0),-1==_k&&(_k=0),_c.skin=_i,_c.width=_j,_c.height=_k,_i&&((_e=this._getTextureByUrl(_i))?(_j||(_j=_e.sourceWidth),_k||(_k=_e.sourceHeight)):console.warn("lost skin:",_i,",you may load pics first")),_c.alpha=_h[10],_f=_c.transform,0!=_n&&(_l=_n*_j),0!=_o&&(_m=_o*_k),0==_l&&0==_m||_f.translate(-_l,-_m);var _u=null;if(_r||1!==_p||1!==_q||_s||_t){(_u=_C._tempMt).identity(),_u.bTransform=!0;var _v=.0174532922222222*(_r-_s),_w=.0174532922222222*(_r+_t),_x=Math.cos(_w),_y=Math.sin(_w),_z=Math.sin(_v),_A=Math.cos(_v);_u.a=_p*_x,_u.b=_p*_y,_u.c=-_q*_z,_u.d=_q*_A,_u.tx=_u.ty=0}return _u&&(_f=_E.mul(_f,_u,_f)),_f.translate(_h[1],_h[2]),_c},_a._getTextureByUrl=function(_a){return _ha.getRes(_a)},_a.setAniData=function(_a,_b){if(_a.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=_a,this._parseNodeList(_a);var _c,_d={},_e=[],_f=_a.animations,_g=0,_h=_f.length;for(_g=0;_g<_h;_g++)if(_c=_f[_g],this._labels=null,(!_b||_b==_c.name)&&_c){try{this._calGraphicData(_c)}catch(_a){console.warn("parse animation fail:"+_c.name+",empty animation created"),this._gList=[]}var _i={};_i.interval=1e3/_c.frameRate,_i.frames=this._gList,_i.labels=this._labels,_i.name=_c.name,_e.push(_i),_d[_c.name]=_i}this.animationList=_e,this.animationDic=_d}_C._temParam.length=0},_a.parseByData=function(_a){var _b,_c;_b=_a.nodeRoot,_c=_a.aniO,delete _a.nodeRoot,delete _a.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=_b,this._parseNodeList(_b),this._labels=null;try{this._calGraphicData(_c)}catch(_a){console.warn("parse animation fail:"+_c.name+",empty animation created"),this._gList=[]}var _d=_a;return _d.interval=1e3/_c.frameRate,_d.frames=this._gList,_d.labels=this._labels,_d.name=_c.name,_d},_a.setUpAniData=function(_a){if(_a.animations){var _b,_c={},_d=[],_e=_a.animations,_f=0,_g=_e.length;for(_f=0;_f<_g;_f++)if(_b=_e[_f]){var _h={};_h.name=_b.name,_h.aniO=_b,_h.nodeRoot=_a,_d.push(_h),_c[_b.name]=_h}this.animationList=_d,this.animationDic=_c}},_a._clear=function(){var _a,_b;if(this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic)for(_a in this._nodeGDic)(_b=this._nodeGDic[_a])&&_b.recover();this._nodeGDic=null},_C.parseAnimationByData=function(_a){var _b;return _C._I||(_C._I=new _C),_b=_C._I.parseByData(_a),_C._I._clear(),_b},_C.parseAnimationData=function(_a){var _b;return _C._I||(_C._I=new _C),_C._I.setUpAniData(_a),(_b={}).animationList=_C._I.animationList,_b.animationDic=_C._I.animationDic,_C._I._clear(),_b},_C._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]],_C._temParam=[],_C._I=null,_C._rootMatrix=null,_i(_C,["_tempMt",function(){return this._tempMt=new _E}]),_C.__init$=function(){_B=function(){function _a(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return _p(_a,""),_a.prototype.recover=function(){this.skin=null,this.width=0,this.height=0,this.alpha=1,this.transform&&(this.transform.destroy(),this.transform=null),this.resultTransform&&(this.resultTransform.destroy(),this.resultTransform=null),_U.recover("GraphicNode",this)},_a.create=function(){return _U.getItemByClass("GraphicNode",_a)},_a}()},_C}(_ua));_x.__init([_j,_ia,_H,_M,_W,_A,_a,_xa])}(window,document,Laya),function(_a,_b,_c){_c.un,_c.uns,_c.static;var _d=_c.class;_c.getset,_c.__newvec;new(function(){function _a(){}return _d(_a,"LayaMain"),_a}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(_a,_b,_w){_w.un,_w.uns;var _g=_w.static,_m=_w.class,_d=_w.getset,_f=_w.__newvec,_k=laya.maths.Arith,_l=laya.maths.Bezier,_c=laya.resource.Bitmap,_n=laya.utils.Browser,_i=laya.utils.Byte,_o=laya.utils.Color,_x=(laya.filters.ColorFilter,_w.Config),_e=laya.resource.Context,_y=(laya.events.Event,laya.filters.Filter),_h=laya.display.Graphics,_j=laya.resource.HTMLCanvas,_p=(laya.utils.HTMLChar,laya.resource.HTMLImage),_q=laya.resource.HTMLSubImage,_z=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),_A=laya.maths.Point,_B=laya.maths.Rectangle,_r=laya.renders.Render,_s=(laya.renders.RenderContext,laya.renders.RenderSprite),_t=laya.resource.Resource,_u=laya.resource.ResourceManager,_v=laya.utils.RunDriver,_C=laya.display.Sprite,_D=laya.display.Stage,_E=laya.utils.Stat,_F=laya.utils.StringKey,_G=(laya.display.css.Style,laya.system.System),_H=laya.display.Text,_I=laya.resource.Texture,_J=(laya.display.css.TransformInfo,laya.net.URL,laya.utils.Utils),_K=laya.utils.VectorGraphManager;laya.utils.WordText;_w.interface("laya.webgl.shapes.IShape"),_w.interface("laya.webgl.submit.ISubmit"),_w.interface("laya.webgl.text.ICharSegment"),_w.interface("laya.webgl.canvas.save.ISaveData"),_w.interface("laya.webgl.resource.IMergeAtlasBitmap"),_w.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var _L=function(){function _a(){}_m(_a,"laya.filters.webgl.FilterActionGL");var _b=_a.prototype;return _w.imps(_b,{"laya.filters.IFilterActionGL":!0}),_b.setValue=function(_a){},_b.setValueMix=function(_a){},_b.apply3d=function(_a,_b,_c,_d,_e){return null},_b.apply=function(_a){return null},_d(0,_b,"typeMix",function(){return 0}),_a}(),_M=function(){function _a(){}return _m(_a,"laya.webgl.shader.ShaderValue"),_a}(),_N=function(){var _d,_e;function _a(_a,_b,_c){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new _e,void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),this._cells=null,this._rowInfo=null,this._init(_a,_b),this._atlasID=_c}_m(_a,"laya.webgl.atlas.AtlasGrid");var _b=_a.prototype;return _b.getAltasID=function(){return this._atlasID},_b.setAltasID=function(_a){0<=_a&&(this._atlasID=_a)},_b.addTex=function(_a,_b,_c){var _d=this._get(_b,_c);return 0==_d.ret||(this._fill(_d.x,_d.y,_b,_c,_a),this._texCount++),_d},_b._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},_b._init=function(_a,_b){if(this._width=_a,this._height=_b,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=_f(this._height);for(var _c=0;_c<this._height;_c++)this._rowInfo[_c]=new _d;return this._clear(),!0},_b._get=function(_a,_b){var _c=new _P;if(_a>=this._failSize.width&&_b>=this._failSize.height)return _c;for(var _d=-1,_e=-1,_f=this._width,_g=this._height,_h=this._cells,_i=0;_i<_g;_i++)if(!(this._rowInfo[_i].spaceCount<_a))for(var _j=0;_j<_f;){var _k=3*(_i*_f+_j);if(0!=_h[_k]||_h[1+_k]<_a||_h[2+_k]<_b)_j+=_h[1+_k];else{_d=_j,_e=_i;for(var _l=0;_l<_a;_l++)if(_h[3*_l+_k+2]<_b){_d=-1;break}if(!(_d<0))return _c.ret=!0,_c.x=_d,_c.y=_e,_c;_j+=_h[1+_k]}}return _c},_b._fill=function(_a,_b,_c,_d,_e){var _f=this._width,_g=this._height;this._check(_a+_c<=_f&&_b+_d<=_g);for(var _h=_b;_h<_d+_b;++_h){this._check(this._rowInfo[_h].spaceCount>=_c),this._rowInfo[_h].spaceCount-=_c;for(var _i=0;_i<_c;_i++){var _j=3*(_a+_h*_f+_i);this._check(0==this._cells[_j]),this._cells[_j]=_e,this._cells[1+_j]=_c,this._cells[2+_j]=_d}}if(0<_a)for(_h=0;_h<_d;++_h){var _k=0;for(_i=_a-1;0<=_i&&0==this._cells[3*((_b+_h)*_f+_i)];--_i,++_k);for(_i=_k;0<_i;--_i)this._cells[3*((_b+_h)*_f+_a-_i)+1]=_i,this._check(0<_i)}if(0<_b)for(_i=_a;_i<_a+_c;++_i){for(_k=0,_h=_b-1;0<=_h&&0==this._cells[3*(_i+_h*_f)];--_h,_k++);for(_h=_k;0<_h;--_h)this._cells[3*(_i+(_b-_h)*_f)+2]=_h,this._check(0<_h)}},_b._check=function(_a){0==_a&&console.log("xtexMerger 错误啦")},_b._clear=function(){for(var _a=this._texCount=0;_a<this._height;_a++)this._rowInfo[_a].spaceCount=this._width;for(var _b=0;_b<this._height;_b++)for(var _c=0;_c<this._width;_c++){var _d=3*(_b*this._width+_c);this._cells[_d]=0,this._cells[1+_d]=this._width-_c,this._cells[2+_d]=this._width-_b}this._failSize.width=this._width+1,this._failSize.height=this._height+1},_a.__init$=function(){_d=function(){function _a(){this.spaceCount=0}return _m(_a,""),_a}(),_e=function(){function _a(){this.width=0,this.height=0}return _m(_a,""),_a}()},_a}(),_O=function(){function _r(_a,_b,_c,_d){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=_a,this._height=_b,this._gridSize=_c,this._maxAtlaserCount=_d,this._gridNumX=_a/_c,this._gridNumY=_b/_c,this._curAtlasIndex=0,this._atlaserArray=[]}_m(_r,"laya.webgl.atlas.AtlasResourceManager");var _a=_r.prototype;return _a.setAtlasParam=function(_a,_b,_c,_d){if(1==this._setAtlasParam)return _r._sid_=0,this._width=_a,this._height=_b,this._gridSize=_c,this._maxAtlaserCount=_d,this._gridNumX=_a/_c,this._gridNumY=_b/_c,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},_a.pushData=function(_a){var _b,_c=_a.bitmap,_d=-1,_e=null,_f=0,_g=0;for(_f=0,_b=this._atlaserArray.length;_f<_b&&(_g=(this._curAtlasIndex+_f)%_b,-1==(_d=(_e=this._atlaserArray[_g]).findBitmapIsExist(_c)));_f++);if(-1!=_d){var _h=_e.InAtlasWebGLImagesOffsetValue[_d];return _o=_h[0],_p=_h[1],_e.addToAtlas(_a,_o,_p),!0}this._setAtlasParam=!1;for(var _i=Math.ceil((_a.bitmap.width+2)/this._gridSize),_j=Math.ceil((_a.bitmap.height+2)/this._gridSize),_k=!1,_l=0;_l<2;_l++){var _m=this._maxAtlaserCount;for(_f=0;_f<_m;_f++){_g=(this._curAtlasIndex+_f)%_m,this._atlaserArray.length-1>=_g||this._atlaserArray.push(new _Ba(this._gridNumX,this._gridNumY,this._width,this._height,_r._sid_++));var _n=this._atlaserArray[_g],_o=0,_p=0,_q=_n.addTex(1,_i,_j);if(_q.ret){_o=_q.x*this._gridSize+1,_p=_q.y*this._gridSize+1,_c.lock=!0,_n.addToAtlasTexture(_c,_o,_p),_n.addToAtlas(_a,_o,_p),_k=!0,this._curAtlasIndex=_g;break}}if(_k)break;this._atlaserArray.push(new _Ba(this._gridNumX,this._gridNumY,this._width,this._height,_r._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return _k||console.log(">>>AtlasManager pushData error"),_k},_a.addToAtlas=function(_a){laya.webgl.atlas.AtlasResourceManager.instance.pushData(_a)},_a.garbageCollection=function(){if(!0===this._needGC){for(var _a=this._atlaserArray.length-this._maxAtlaserCount,_b=0;_b<_a;_b++)this._atlaserArray[_b].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas。");console.log(">>>>altas garbageCollection ="+_a),this._atlaserArray.splice(0,_a),this._needGC=!1}return!0},_a.freeAll=function(){for(var _a=0,_b=this._atlaserArray.length;_a<_b;_a++)this._atlaserArray[_a].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},_a.getAtlaserCount=function(){return this._atlaserArray.length},_a.getAtlaserByIndex=function(_a){return this._atlaserArray[_a]},_d(1,_r,"instance",function(){return _r._Instance||(_r._Instance=new _r(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),_r._Instance}),_d(1,_r,"enabled",function(){return _x.atlasEnable}),_d(1,_r,"atlasLimitWidth",function(){return _r._atlasLimitWidth},function(_a){_r._atlasLimitWidth=_a}),_d(1,_r,"atlasLimitHeight",function(){return _r._atlasLimitHeight},function(_a){_r._atlasLimitHeight=_a}),_r._enable=function(){_x.atlasEnable=!0},_r._disable=function(){_x.atlasEnable=!1},_r.__init__=function(){_r.atlasTextureWidth=2048,_r.atlasTextureHeight=2048,_r.maxTextureCount=6,_r.atlasLimitWidth=512,_r.atlasLimitHeight=512},_r._atlasLimitWidth=0,_r._atlasLimitHeight=0,_r.gridSize=16,_r.atlasTextureWidth=0,_r.atlasTextureHeight=0,_r.maxTextureCount=0,_r._atlasRestore=0,_r.BOARDER_TYPE_NO=0,_r.BOARDER_TYPE_RIGHT=1,_r.BOARDER_TYPE_LEFT=2,_r.BOARDER_TYPE_BOTTOM=4,_r.BOARDER_TYPE_TOP=8,_r.BOARDER_TYPE_ALL=15,_r._sid_=0,_r._Instance=null,_r}(),_P=function(){function _a(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return _m(_a,"laya.webgl.atlas.MergeFillInfo"),_a}(),_Q=function(){function _b(){}return _m(_b,"laya.webgl.canvas.BlendMode"),_b._init_=function(_a){_b.fns=[_b.BlendNormal,_b.BlendAdd,_b.BlendMultiply,_b.BlendScreen,_b.BlendOverlay,_b.BlendLight,_b.BlendMask,_b.BlendDestinationOut],_b.targetFns=[_b.BlendNormalTarget,_b.BlendAddTarget,_b.BlendMultiplyTarget,_b.BlendScreenTarget,_b.BlendOverlayTarget,_b.BlendLightTarget,_b.BlendMask,_b.BlendDestinationOut]},_b.BlendNormal=function(_a){_a.blendFunc(1,771)},_b.BlendAdd=function(_a){_a.blendFunc(1,772)},_b.BlendMultiply=function(_a){_a.blendFunc(774,771)},_b.BlendScreen=function(_a){_a.blendFunc(1,1)},_b.BlendOverlay=function(_a){_a.blendFunc(1,769)},_b.BlendLight=function(_a){_a.blendFunc(1,1)},_b.BlendNormalTarget=function(_a){_a.blendFunc(1,771)},_b.BlendAddTarget=function(_a){_a.blendFunc(1,772)},_b.BlendMultiplyTarget=function(_a){_a.blendFunc(774,771)},_b.BlendScreenTarget=function(_a){_a.blendFunc(1,1)},_b.BlendOverlayTarget=function(_a){_a.blendFunc(1,769)},_b.BlendLightTarget=function(_a){_a.blendFunc(1,1)},_b.BlendMask=function(_a){_a.blendFunc(0,770)},_b.BlendDestinationOut=function(_a){_a.blendFunc(0,0)},_b.activeBlendFunction=null,_b.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],_b.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},_b.NORMAL="normal",_b.ADD="add",_b.MULTIPLY="multiply",_b.SCREEN="screen",_b.LIGHT="light",_b.OVERLAY="overlay",_b.DESTINATIONOUT="destination-out",_b.fns=[],_b.targetFns=[],_b}(),_R=function(){function _c(_a){this._color=_o.create("black"),this.setValue(_a)}_m(_c,"laya.webgl.canvas.DrawStyle");var _a=_c.prototype;return _a.setValue=function(_a){if(_a){if("string"==typeof _a)return void(this._color=_o.create(_a));if(_a instanceof laya.utils.Color)return void(this._color=_a)}},_a.reset=function(){this._color=_o.create("black")},_a.equal=function(_a){return"string"==typeof _a?this._color.strColor===_a:_a instanceof laya.utils.Color&&this._color.numColor===_a.numColor},_a.toColorStr=function(){return this._color.strColor},_c.create=function(_a){var _b;if(_a&&("string"==typeof _a?_b=_o.create(_a):_a instanceof laya.utils.Color&&(_b=_a),_b))return _b._drawStyle||(_b._drawStyle=new _c(_a));return laya.webgl.canvas.DrawStyle.DEFAULT},_g(_c,["DEFAULT",function(){return this.DEFAULT=new _c("#000000")}]),_c}(),_S=function(){function _a(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];_ua.mainContext;this.ib=_$a.create(35048),this.vb=__a.create(5)}_m(_a,"laya.webgl.canvas.Path");var _b=_a.prototype;return _b.addPoint=function(_a,_b){this.tempArray.push(_a,_b)},_b.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},_b.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},_b.polygon=function(_a,_b,_c,_d,_e,_f){var _g;return this.geomatrys.push(this._curGeomatry=_g=new _Fa(_a,_b,_c,_d,_e,_f)),_d||(_g.fill=!1),null==_f&&(_g.borderWidth=0),_g},_b.setGeomtry=function(_a){this.geomatrys.push(this._curGeomatry=_a)},_b.drawLine=function(_a,_b,_c,_d,_e){var _f;return this.closePath?this.geomatrys.push(this._curGeomatry=_f=new _Ea(_a,_b,_c,_d,_e)):this.geomatrys.push(this._curGeomatry=_f=new _Da(_a,_b,_c,_d,_e)),_f.fill=!1,_f},_b.update=function(){var _a=this.ib._byteLength,_b=this.geomatrys.length;this.offset=_a;for(var _c=this.geoStart;_c<_b;_c++)this.geomatrys[_c].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=_b,this.count=(this.ib._byteLength-_a)/_pa.BYTES_PIDX},_b.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},_b.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},_a}(),_T=function(){function _h(){}_m(_h,"laya.webgl.canvas.save.SaveBase");var _a=_h.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!1},_a.restore=function(_a){this._dataObj[this._valueName]=this._value,(_h._cache[_h._cache._length++]=this)._newSubmit&&(_a._curSubmit=_fa.RENDERBASE,_a._renderKey=0)},_h._createArray=function(){var _a=[];return _a._length=0,_a},_h._init=function(){var _a=_h._namemap={};return _a[1]="ALPHA",_a[2]="fillStyle",_a[8]="font",_a[256]="lineWidth",_a[512]="strokeStyle",_a[8192]="_mergeID",_a[1024]=_a[2048]=_a[4096]=[],_a[16384]="textBaseline",_a[32768]="textAlign",_a[65536]="_nBlendType",_a[1048576]="shader",_a[2097152]="filters",_a},_h.save=function(_a,_b,_c,_d){if((_a._saveMark._saveuse&_b)!==_b){_a._saveMark._saveuse|=_b;var _e=_h._cache,_f=0<_e._length?_e[--_e._length]:new _h;_f._value=_c[_f._valueName=_h._namemap[_b]],_f._dataObj=_c,_f._newSubmit=_d;var _g=_a._save;_g[_g._length++]=_f}},_h._cache=laya.webgl.canvas.save.SaveBase._createArray(),_h._namemap=_h._init(),_h}(),_U=function(){function _f(){this._clipRect=new _B}_m(_f,"laya.webgl.canvas.save.SaveClipRect");var _a=_f.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!1},_a.restore=function(_a){_a._clipRect=this._clipSaveRect,(_f._cache[_f._cache._length++]=this)._submitScissor.submitLength=_a._submits._length-this._submitScissor.submitIndex,_a._curSubmit=_fa.RENDERBASE,_a._renderKey=0},_f.save=function(_a,_b){if(131072!=(131072&_a._saveMark._saveuse)){_a._saveMark._saveuse|=131072;var _c=_f._cache,_d=0<_c._length?_c[--_c._length]:new _f;_d._clipSaveRect=_a._clipRect,_a._clipRect=_d._clipRect.copyFrom(_a._clipRect),_d._submitScissor=_b;var _e=_a._save;_e[_e._length++]=_d}},_g(_f,["_cache",function(){return this._cache=_T._createArray()}]),_f}(),_V=function(){function _n(){this._contextX=0,this._contextY=0,this._clipRect=new _B,this._rect=new _B,this._matrix=new _z}_m(_n,"laya.webgl.canvas.save.SaveClipRectStencil");var _a=_n.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!1},_a.restore=function(_a){_ka.restore(_a,this._rect,this._saveMatrix,this._contextX,this._contextY),_a._clipRect=this._clipSaveRect,_a._curMat=this._saveMatrix,_a._x=this._contextX,_a._y=this._contextY,_n._cache[_n._cache._length++]=this,_a._curSubmit=_fa.RENDERBASE},_n.save=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){if(262144!=(262144&_a._saveMark._saveuse)){_a._saveMark._saveuse|=262144;var _k=_n._cache,_l=0<_k._length?_k[--_k._length]:new _n;_l._clipSaveRect=_a._clipRect,_l._clipRect.setTo(_g,_h,_i,_j),_a._clipRect=_l._clipRect,_l._rect.x=_c,_l._rect.y=_d,_l._rect.width=_e,_l._rect.height=_f,_l._contextX=_a._x,_l._contextY=_a._y,_l._saveMatrix=_a._curMat,_a._curMat.copyTo(_l._matrix),_a._curMat=_l._matrix,_l._submitStencil=_b;var _m=_a._save;_m[_m._length++]=_l}},_g(_n,["_cache",function(){return this._cache=_T._createArray()}]),_n}(),_W=function(){function _d(){this._saveuse=0}_m(_d,"laya.webgl.canvas.save.SaveMark");var _a=_d.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!0},_a.restore=function(_a){_a._saveMark=this._preSaveMark,_d._no[_d._no._length++]=this},_d.Create=function(_a){var _b=_d._no,_c=0<_b._length?_b[--_b._length]:new _d;return _c._saveuse=0,_c._preSaveMark=_a._saveMark,_a._saveMark=_c},_g(_d,["_no",function(){return this._no=_T._createArray()}]),_d}(),_X=function(){function _f(){this._matrix=new _z}_m(_f,"laya.webgl.canvas.save.SaveTransform");var _a=_f.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!1},_a.restore=function(_a){_a._curMat=this._savematrix,_f._no[_f._no._length++]=this},_f.save=function(_a){var _b=_a._saveMark;if(2048!=(2048&_b._saveuse)){_b._saveuse|=2048;var _c=_f._no,_d=0<_c._length?_c[--_c._length]:new _f;_d._savematrix=_a._curMat,_a._curMat=_a._curMat.copyTo(_d._matrix);var _e=_a._save;_e[_e._length++]=_d}},_g(_f,["_no",function(){return this._no=_T._createArray()}]),_f}(),_Y=function(){function _e(){}_m(_e,"laya.webgl.canvas.save.SaveTranslate");var _a=_e.prototype;return _w.imps(_a,{"laya.webgl.canvas.save.ISaveData":!0}),_a.isSaveMark=function(){return!1},_a.restore=function(_a){_a._curMat;_a._x=this._x,_a._y=this._y,_e._no[_e._no._length++]=this},_e.save=function(_a){var _b=_e._no,_c=0<_b._length?_b[--_b._length]:new _e;_c._x=_a._x,_c._y=_a._y;var _d=_a._save;_d[_d._length++]=_c},_g(_e,["_no",function(){return this._no=_T._createArray()}]),_e}(),_Z=function(){function _a(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new _B}_m(_a,"laya.webgl.resource.RenderTargetMAX");var _b=_a.prototype;return _b.setSP=function(_a){this._sp=_a},_b.size=function(_a,_b){var _c=this;this._width!==_a||this._height!==_b?(this.repaint=!0,this._width=_a,this._height=_b,this.target?this.target.size(_a,_b):this.target=_Ka.create(_a,_b),this.target.hasListener("recovered")||this.target.on("recovered",this,function(_a){_w.timer.callLater(_c._sp,_c._sp.repaint)})):this.target.size(_a,_b)},_b._flushToTarget=function(_a,_b){if(!_b._destroy){var _c=_sa.worldScissorTest,_d=_sa.worldClipRect;_sa.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,_sa.worldScissorTest=!1,_ua.mainContext.disable(3089);var _e=_sa.worldAlpha,_f=_sa.worldMatrix4,_g=_sa.worldMatrix,_h=_sa.worldFilters,_i=_sa.worldShaderDefines;if(_sa.worldMatrix=_z.EMPTY,_sa.restoreTempArray(),_sa.worldMatrix4=_sa.TEMPMAT4_ARRAY,_sa.worldAlpha=1,_sa.worldFilters=null,_sa.worldShaderDefines=null,_Ja.activeShader=null,_b.start(),_x.showCanvasMark?_b.clear(0,1,0,.3):_b.clear(0,0,0,0),_a.flush(),_b.end(),_Ja.activeShader=null,_sa.worldAlpha=_e,_sa.worldMatrix4=_f,_sa.worldMatrix=_g,_sa.worldFilters=_h,_sa.worldShaderDefines=_i,_sa.worldScissorTest=_c){var _j=_sa.height-_d.y-_d.height;_ua.mainContext.scissor(_d.x,_j,_d.width,_d.height),_ua.mainContext.enable(3089)}_sa.worldClipRect=_d}},_b.flush=function(_a){this.repaint&&(this._flushToTarget(_a,this.target),this.repaint=!1)},_b.drawTo=function(_a,_b,_c,_d,_e){_a.drawTexture(this.target.getTexture(),_b,_c,_d,_e,0,0)},_b.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},_a}(),_$=function(){function _a(){this.ALPHA=1,this.shaderType=0,this.defines=new _Ca}return _m(_a,"laya.webgl.shader.d2.Shader2D"),_a.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},_a.__init__=function(){var _a,_b;_Wa.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),_Wa.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),_Wa.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),_Wa.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4 vec4Color2 = texture2D(texture, v_texcoord + vec2FilterDir + vec2Off); \n\n      #ifdef TXTALPHA\n   vec4Color2.a = texture2D(texture1, v_texcoord + vec2FilterDir + vec2Off).a;\n   #endif\n\n    vec4Color += vec4Color2/floatIterationTotalTime;        \n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),_Wa.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),_Wa.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4 vec4Color1 = texture2D(texture, ctexcoord); \n\n      #ifdef TXTALPHA\n   vec4Color1.a = texture2D(texture1, ctexcoord).a;\n   #endif\n\n    vec4Color += vec4Color1*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),_Wa.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),_Wa.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),_a="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",_b='precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n\n   #ifdef TXTCOMPRESS\n   color.rgb *= color.a;\n   #endif\n\n   #ifdef TXTALPHA\n   color.rgba *= texture2D(texture1, v_texcoord).a;\n   #endif\n\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',_Wa.preCompile2D(0,1,_a,_b,null),_a="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",_b='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',_Wa.preCompile2D(0,2,_a,_b,null),_a="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",_b="precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",_Wa.preCompile2D(0,4,_a,_b,null),_a="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",_b='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n\n   #ifdef TXTALPHA\n   color.a = texture2D(texture1, newTexCoord).a;\n   #endif\n\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',_Wa.preCompile2D(0,256,_a,_b,null),_a="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",_b="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\n\n#ifdef TXTALPHA\nuniform sampler2D texture1;\n#endif\n\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\n   #ifdef TXTALPHA\n   t_color.a = texture2D(texture1, v_texcoord).a;\n   #endif\n\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",_Wa.preCompile2D(0,512,_a,_b,null)},_a}(),__=function(){function _b(_a,_b,_c){this._value=0,this._name2int=_a,this._int2name=_b,this._int2nameMap=_c}_m(_b,"laya.webgl.shader.ShaderDefines");var _a=_b.prototype;return _a.add=function(_a){return"string"==typeof _a&&(_a=this._name2int[_a]),this._value|=_a,this._value},_a.addInt=function(_a){return this._value|=_a,this._value},_a.remove=function(_a){return"string"==typeof _a&&(_a=this._name2int[_a]),this._value&=~_a,this._value},_a.isDefine=function(_a){return(this._value&_a)===_a},_a.getValue=function(){return this._value},_a.setValue=function(_a){this._value=_a},_a.toNameDic=function(){var _a=this._int2nameMap[this._value];return _a||_b._toText(this._value,this._int2name,this._int2nameMap)},_b._reg=function(_a,_b,_c,_d){_d[_c[_a]=_b]=_a},_b._toText=function(_a,_b,_c){var _d=_c[_a];if(_d)return _d;for(var _e={},_f=1,_g=0;_g<32&&!(_a<(_f=1<<_g));_g++)if(_a&_f){var _h=_b[_f];_h&&(_e[_h]="")}return _c[_a]=_e},_b._toInt=function(_a,_b){for(var _c=_a.split("."),_d=0,_e=0,_f=_c.length;_e<_f;_e++){var _g=_b[_c[_e]];if(!_g)throw new Error("Defines to int err:"+_a+"/"+_c[_e]);_d|=_g}return _d},_b}(),_aa=function(){function _g(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new _z}_m(_g,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var _a=_g.prototype;return _a.init=function(_a,_b,_c){if(_b)this._vs=_b;else{this._vs=[];var _d=_a.width,_e=_a.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(_d,0,1,0,1,1,1,1),this._vs.push(_d,_e,1,1,1,1,1,1),this._vs.push(0,_e,0,1,1,1,1,1)}_c?this._ps=_c:(_g._defaultPS||(_g._defaultPS=[]).push(0,1,3,3,1,2),this._ps=_g._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=_a},_a.init2=function(_a,_b,_c,_d,_e){this.transform&&(this.transform=null),_c?this._ps=_c:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=_d,this._uvs=_e,this.mEleNum=this._ps.length,this.mTexture=_a,(_r.isConchNode||_r.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},_a._initMyData=function(){var _a=0,_b=0,_c=4*this._verticles.length;this._vs=_g._tempVS;var _d=!1;if(_r.isConchNode||_r.isConchApp?(this._vs.length=_c,_d=!0):this._vs.length<_c&&(this._vs.length=_c,_d=!0),_g._tVSLen=_c,_d)for(;_a<_c;)this._vs[_a]=this._verticles[_b],this._vs[_a+1]=this._verticles[_b+1],this._vs[_a+2]=this._uvs[_b],this._vs[_a+3]=this._uvs[_b+1],this._vs[_a+4]=1,this._vs[_a+5]=1,this._vs[_a+6]=1,this._vs[_a+7]=1,_a+=8,_b+=2;else for(;_a<_c;)this._vs[_a]=this._verticles[_b],this._vs[_a+1]=this._verticles[_b+1],this._vs[_a+2]=this._uvs[_b],this._vs[_a+3]=this._uvs[_b+1],_a+=8,_b+=2},_a.getData2=function(_a,_b,_c){var _d;this.mVBBuffer=_a,this.mIBBuffer=_b,this._initMyData(),_a.appendEx2(this._vs,Float32Array,_g._tVSLen,4),this._indexStart=_b._byteLength,(_d=_g._tempIB).length<this._ps.length&&(_d.length=this._ps.length);for(var _e=0,_f=this._ps.length;_e<_f;_e++)_d[_e]=this._ps[_e]+_c;_b.appendEx2(_d,Uint16Array,this._ps.length,2)},_a.getData=function(_a,_b,_c){if(this.mVBBuffer=_a,this.mIBBuffer=_b,_a.append(this.mVBData),this._indexStart=_b._byteLength,this.mIBData.start!=_c){for(var _d=0,_e=this._ps.length;_d<_e;_d++)this.mIBData[_d]=this._ps[_d]+_c;this.mIBData.start=_c}_b.append(this.mIBData)},_a.render=function(_a,_b,_c){if(_r.isWebGL&&this.mTexture){_a._renderKey=0,_a._shader2D.glTexture=null,_ba.getInstance().addSkinMesh(this);var _d=_fa.createShape(_a,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,_ya.create(512,0));this.transform||(this.transform=_z.EMPTY),this.transform.translate(_b,_c),_z.mul(this.transform,_a._curMat,this._tempMatrix),this.transform.translate(-_b,-_c);var _e=_d.shaderValue,_f=_e.u_mmat2||_sa.getMatrArray();_sa.mat2MatArray(this._tempMatrix,_f),_e.textureHost=this.mTexture,_e.offsetX=0,_e.offsetY=0,_e.u_mmat2=_f,_e.ALPHA=_a._shader2D.ALPHA,_a._submits[_a._submits._length++]=_d}else _r.isConchApp&&this.mTexture&&(this.transform||(this.transform=_z.EMPTY),_a.setSkinMesh&&_a.setSkinMesh(_b,_c,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},_g._tempVS=[],_g._tempIB=[],_g._defaultPS=null,_g._tVSLen=0,_g}(),_ba=function(){function _a(){this.ib=null,this.vb=null;_ua.mainContext;this.ib=_$a.create(35048),this.vb=__a.create(8)}_m(_a,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var _b=_a.prototype;return _b.addSkinMesh=function(_a){_a.getData2(this.vb,this.ib,this.vb._byteLength/32)},_b.reset=function(){this.vb.clear(),this.ib.clear()},_a.getInstance=function(){return _a.instance=_a.instance||new _a},_a.instance=null,_a}(),_ca=function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h,_i){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===_i&&(_i=0),this.x=_a,this.y=_b,this.width=_c,this.height=_d,this.edges=_e,this.color=_f,this.borderWidth=_g,this.borderColor=_h}_m(_a,"laya.webgl.shapes.BasePoly");var _b=_a.prototype;return _w.imps(_b,{"laya.webgl.shapes.IShape":!0}),_b.getData=function(_a,_b,_c){},_b.rebuild=function(_a){},_b.setMatrix=function(_a){},_b.needUpdate=function(_a){return!0},_b.sector=function(_a,_b,_c){var _d=this.x,_e=this.y,_f=this.edges,_g=(this.r1-this.r0)/_f,_h=this.width,_i=this.height,_j=this.color,_k=(_j>>16&255)/255,_l=(_j>>8&255)/255,_m=(255&_j)/255;_a.push(_d,_e,_k,_l,_m);for(var _n=0;_n<_f+1;_n++)_a.push(_d+Math.sin(_g*_n+this.r0)*_h,_e+Math.cos(_g*_n+this.r0)*_i),_a.push(_k,_l,_m);for(_n=0;_n<_f;_n++)_b.push(_c,_c+_n+1,_c+_n+2)},_b.createLine2=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A=_a.concat(),_B=_e,_C=this.borderColor,_D=(_C>>16&255)/255,_E=(_C>>8&255)/255,_F=(255&_C)/255,_G=_A.length/2,_H=_d,_I=_c/2;_i=_A[0],_j=_A[1],_p=_i-(_k=_A[2]),_o=(_o=-(_j-(_l=_A[3])))/(_z=Math.sqrt(_o*_o+_p*_p))*_I,_p=_p/_z*_I,_B.push(_i-_o+this.x,_j-_p+this.y,_D,_E,_F,_i+_o+this.x,_j+_p+this.y,_D,_E,_F);for(var _J=1;_J<_G-1;_J++)_i=_A[2*(_J-1)],_j=_A[2*(_J-1)+1],_k=_A[2*_J],_l=_A[2*_J+1],_m=_A[2*(_J+1)],_n=_A[2*(_J+1)+1],_p=_i-_k,_r=_k-_m,_u=(-(_o=(_o=-(_j-_l))/(_z=Math.sqrt(_o*_o+_p*_p))*_I)+_i)*(-(_p=_p/_z*_I)+_l)-(-_o+_k)*(-_p+_j),_x=(-(_q=(_q=-(_l-_n))/(_z=Math.sqrt(_q*_q+_r*_r))*_I)+_m)*(-(_r=_r/_z*_I)+_l)-(-_q+_k)*(-_r+_n),_y=(_s=-_p+_j-(-_p+_l))*(_w=-_q+_k-(-_q+_m))-(_v=-_r+_n-(-_r+_l))*(_t=-_o+_k-(-_o+_i)),Math.abs(_y)<.1?(_y+=10.1,_B.push(_k-_o+this.x,_l-_p+this.y,_D,_E,_F,_k+_o+this.x,_l+_p+this.y,_D,_E,_F)):(((_g=(_t*_x-_w*_u)/_y)-_k)*(_g-_k)+((_h=(_v*_u-_s*_x)/_y)-_l)+(_h-_l),_B.push(_g+this.x,_h+this.y,_D,_E,_F,_k-(_g-_k)+this.x,_l-(_h-_l)+this.y,_D,_E,_F));_i=_A[_A.length-4],_j=_A[_A.length-3],_p=_i-(_k=_A[_A.length-2]),_o=(_o=-(_j-(_l=_A[_A.length-1])))/(_z=Math.sqrt(_o*_o+_p*_p))*_I,_p=_p/_z*_I,_B.push(_k-_o+this.x,_l-_p+this.y,_D,_E,_F,_k+_o+this.x,_l+_p+this.y,_D,_E,_F);var _K=_f;for(_J=1;_J<_K;_J++)_b.push(_H+2*(_J-1),_H+2*(_J-1)+1,_H+2*_J+1,_H+2*_J+1,_H+2*_J,_H+2*(_J-1));return _B},_b.createLine=function(_a,_b,_c,_d){var _e=_a.concat(),_f=_a,_g=this.borderColor,_h=(_g>>16&255)/255,_i=(_g>>8&255)/255,_j=(255&_g)/255;_e.splice(0,5);var _k,_l,_m,_n,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D,_E=_e.length/5,_F=_d,_G=_c/2;_m=_e[0],_n=_e[1],_t=_m-(_o=_e[5]),_s=(_s=-(_n-(_p=_e[6])))/(_D=Math.sqrt(_s*_s+_t*_t))*_G,_t=_t/_D*_G,_f.push(_m-_s,_n-_t,_h,_i,_j,_m+_s,_n+_t,_h,_i,_j);for(var _H=1;_H<_E-1;_H++)_m=_e[5*(_H-1)],_n=_e[5*(_H-1)+1],_o=_e[5*_H],_p=_e[5*_H+1],_q=_e[5*(_H+1)],_r=_e[5*(_H+1)+1],_t=_m-_o,_v=_o-_q,_y=(-(_s=(_s=-(_n-_p))/(_D=Math.sqrt(_s*_s+_t*_t))*_G)+_m)*(-(_t=_t/_D*_G)+_p)-(-_s+_o)*(-_t+_n),_B=(-(_u=(_u=-(_p-_r))/(_D=Math.sqrt(_u*_u+_v*_v))*_G)+_q)*(-(_v=_v/_D*_G)+_p)-(-_u+_o)*(-_v+_r),_C=(_w=-_t+_n-(-_t+_p))*(_A=-_u+_o-(-_u+_q))-(_z=-_v+_r-(-_v+_p))*(_x=-_s+_o-(-_s+_m)),Math.abs(_C)<.1?(_C+=10.1,_f.push(_o-_s,_p-_t,_h,_i,_j,_o+_s,_p+_t,_h,_i,_j)):(((_k=(_x*_B-_A*_y)/_C)-_o)*(_k-_o)+((_l=(_z*_y-_w*_B)/_C)-_p)+(_l-_p),_f.push(_k,_l,_h,_i,_j,_o-(_k-_o),_p-(_l-_p),_h,_i,_j));_m=_e[_e.length-10],_n=_e[_e.length-9],_t=_m-(_o=_e[_e.length-5]),_s=(_s=-(_n-(_p=_e[_e.length-4])))/(_D=Math.sqrt(_s*_s+_t*_t))*_G,_t=_t/_D*_G,_f.push(_o-_s,_p-_t,_h,_i,_j,_o+_s,_p+_t,_h,_i,_j);var _I=this.edges+1;for(_H=1;_H<_I;_H++)_b.push(_F+2*(_H-1),_F+2*(_H-1)+1,_F+2*_H+1,_F+2*_H+1,_F+2*_H,_F+2*(_H-1));return _f},_b.createLoopLine=function(_a,_b,_c,_d,_e,_f){var _g=_a.concat(),_h=_e||_a,_i=this.borderColor,_j=(_i>>16&255)/255,_k=(_i>>8&255)/255,_l=(255&_i)/255;_g.splice(0,5);var _m=[_g[0],_g[1]],_n=[_g[_g.length-5],_g[_g.length-4]],_o=_n[0]+.5*(_m[0]-_n[0]),_p=_n[1]+.5*(_m[1]-_n[1]);_g.unshift(_o,_p,0,0,0),_g.push(_o,_p,0,0,0);var _q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D,_E,_F,_G,_H,_I,_J,_K=_g.length/5,_L=_d,_M=_c/2;_s=_g[0],_t=_g[1],_z=_s-(_u=_g[5]),_y=(_y=-(_t-(_v=_g[6])))/(_J=Math.sqrt(_y*_y+_z*_z))*_M,_z=_z/_J*_M,_h.push(_s-_y,_t-_z,_j,_k,_l,_s+_y,_t+_z,_j,_k,_l);for(var _N=1;_N<_K-1;_N++)_s=_g[5*(_N-1)],_t=_g[5*(_N-1)+1],_u=_g[5*_N],_v=_g[5*_N+1],_w=_g[5*(_N+1)],_x=_g[5*(_N+1)+1],_z=_s-_u,_B=_u-_w,_E=(-(_y=(_y=-(_t-_v))/(_J=Math.sqrt(_y*_y+_z*_z))*_M)+_s)*(-(_z=_z/_J*_M)+_v)-(-_y+_u)*(-_z+_t),_H=(-(_A=(_A=-(_v-_x))/(_J=Math.sqrt(_A*_A+_B*_B))*_M)+_w)*(-(_B=_B/_J*_M)+_v)-(-_A+_u)*(-_B+_x),_I=(_C=-_z+_t-(-_z+_v))*(_G=-_A+_u-(-_A+_w))-(_F=-_B+_x-(-_B+_v))*(_D=-_y+_u-(-_y+_s)),Math.abs(_I)<.1?(_I+=10.1,_h.push(_u-_y,_v-_z,_j,_k,_l,_u+_y,_v+_z,_j,_k,_l)):(((_q=(_D*_H-_G*_E)/_I)-_u)*(_q-_u)+((_r=(_F*_E-_C*_H)/_I)-_v)+(_r-_v),_h.push(_q,_r,_j,_k,_l,_u-(_q-_u),_v-(_r-_v),_j,_k,_l));_f&&(_b=_f);var _O=this.edges+1;for(_N=1;_N<_O;_N++)_b.push(_L+2*(_N-1),_L+2*(_N-1)+1,_L+2*_N+1,_L+2*_N+1,_L+2*_N,_L+2*(_N-1));return _b.push(_L+2*(_N-1),_L+2*(_N-1)+1,_L+1,_L+1,_L,_L+2*(_N-1)),_h},_a}(),_da=function(){function _p(){}return _m(_p,"laya.webgl.shapes.Earcut"),_p.earcut=function(_a,_b,_c){_c=_c||2;var _d,_e,_f,_g,_h,_i,_j,_k=_b&&_b.length,_l=_k?_b[0]*_c:_a.length,_m=_p.linkedList(_a,0,_l,_c,!0),_n=[];if(!_m)return _n;if(_k&&(_m=_p.eliminateHoles(_a,_b,_m,_c)),_a.length>80*_c){_d=_f=_a[0],_e=_g=_a[1];for(var _o=_c;_o<_l;_o+=_c)(_h=_a[_o])<_d&&(_d=_h),(_i=_a[_o+1])<_e&&(_e=_i),_f<_h&&(_f=_h),_g<_i&&(_g=_i);_j=0!==(_j=Math.max(_f-_d,_g-_e))?1/_j:0}return _p.earcutLinked(_m,_n,_c,_d,_e,_j),_n},_p.linkedList=function(_a,_b,_c,_d,_e){var _f,_g;if(_e===0<_p.signedArea(_a,_b,_c,_d))for(_f=_b;_f<_c;_f+=_d)_g=_p.insertNode(_f,_a[_f],_a[_f+1],_g);else for(_f=_c-_d;_b<=_f;_f-=_d)_g=_p.insertNode(_f,_a[_f],_a[_f+1],_g);return _g&&_p.equals(_g,_g.next)&&(_p.removeNode(_g),_g=_g.next),_g},_p.filterPoints=function(_a,_b){if(!_a)return _a;_b||(_b=_a);var _c,_d=_a;do{if(_c=!1,_d.steiner||!_p.equals(_d,_d.next)&&0!==_p.area(_d.prev,_d,_d.next))_d=_d.next;else{if(_p.removeNode(_d),(_d=_b=_d.prev)===_d.next)break;_c=!0}}while(_c||_d!==_b);return _b},_p.earcutLinked=function(_a,_b,_c,_d,_e,_f,_g){if(_a){!_g&&_f&&_p.indexCurve(_a,_d,_e,_f);for(var _h,_i,_j=_a;_a.prev!==_a.next;)if(_h=_a.prev,_i=_a.next,_f?_p.isEarHashed(_a,_d,_e,_f):_p.isEar(_a))_b.push(_h.i/_c),_b.push(_a.i/_c),_b.push(_i.i/_c),_p.removeNode(_a),_a=_i.next,_j=_i.next;else if((_a=_i)===_j){_g?1===_g?(_a=_p.cureLocalIntersections(_a,_b,_c),_p.earcutLinked(_a,_b,_c,_d,_e,_f,2)):2===_g&&_p.splitEarcut(_a,_b,_c,_d,_e,_f):_p.earcutLinked(_p.filterPoints(_a,null),_b,_c,_d,_e,_f,1);break}}},_p.isEar=function(_a){var _b=_a.prev,_c=_a,_d=_a.next;if(0<=_p.area(_b,_c,_d))return!1;for(var _e=_a.next.next;_e!==_a.prev;){if(_p.pointInTriangle(_b.x,_b.y,_c.x,_c.y,_d.x,_d.y,_e.x,_e.y)&&0<=_p.area(_e.prev,_e,_e.next))return!1;_e=_e.next}return!0},_p.isEarHashed=function(_a,_b,_c,_d){var _e=_a.prev,_f=_a,_g=_a.next;if(0<=_p.area(_e,_f,_g))return!1;for(var _h=_e.x<_f.x?_e.x<_g.x?_e.x:_g.x:_f.x<_g.x?_f.x:_g.x,_i=_e.y<_f.y?_e.y<_g.y?_e.y:_g.y:_f.y<_g.y?_f.y:_g.y,_j=_e.x>_f.x?_e.x>_g.x?_e.x:_g.x:_f.x>_g.x?_f.x:_g.x,_k=_e.y>_f.y?_e.y>_g.y?_e.y:_g.y:_f.y>_g.y?_f.y:_g.y,_l=_p.zOrder(_h,_i,_b,_c,_d),_m=_p.zOrder(_j,_k,_b,_c,_d),_n=_a.nextZ;_n&&_n.z<=_m;){if(_n!==_a.prev&&_n!==_a.next&&_p.pointInTriangle(_e.x,_e.y,_f.x,_f.y,_g.x,_g.y,_n.x,_n.y)&&0<=_p.area(_n.prev,_n,_n.next))return!1;_n=_n.nextZ}for(_n=_a.prevZ;_n&&_n.z>=_l;){if(_n!==_a.prev&&_n!==_a.next&&_p.pointInTriangle(_e.x,_e.y,_f.x,_f.y,_g.x,_g.y,_n.x,_n.y)&&0<=_p.area(_n.prev,_n,_n.next))return!1;_n=_n.prevZ}return!0},_p.cureLocalIntersections=function(_a,_b,_c){var _d=_a;do{var _e=_d.prev,_f=_d.next.next;!_p.equals(_e,_f)&&_p.intersects(_e,_d,_d.next,_f)&&_p.locallyInside(_e,_f)&&_p.locallyInside(_f,_e)&&(_b.push(_e.i/_c),_b.push(_d.i/_c),_b.push(_f.i/_c),_p.removeNode(_d),_p.removeNode(_d.next),_d=_a=_f),_d=_d.next}while(_d!==_a);return _d},_p.splitEarcut=function(_a,_b,_c,_d,_e,_f){var _g=_a;do{for(var _h=_g.next.next;_h!==_g.prev;){if(_g.i!==_h.i&&_p.isValidDiagonal(_g,_h)){var _i=_p.splitPolygon(_g,_h);return _g=_p.filterPoints(_g,_g.next),_i=_p.filterPoints(_i,_i.next),_p.earcutLinked(_g,_b,_c,_d,_e,_f),void _p.earcutLinked(_i,_b,_c,_d,_e,_f)}_h=_h.next}_g=_g.next}while(_g!==_a)},_p.eliminateHoles=function(_a,_b,_c,_d){var _e,_f,_g,_h,_i,_j=[];for(_e=0,_f=_b.length;_e<_f;_e++)_g=_b[_e]*_d,_h=_e<_f-1?_b[_e+1]*_d:_a.length,(_i=_p.linkedList(_a,_g,_h,_d,!1))===_i.next&&(_i.steiner=!0),_j.push(_p.getLeftmost(_i));for(_j.sort(_p.compareX),_e=0;_e<_j.length;_e++)_p.eliminateHole(_j[_e],_c),_c=_p.filterPoints(_c,_c.next);return _c},_p.compareX=function(_a,_b){return _a.x-_b.x},_p.eliminateHole=function(_a,_b){if(_b=_p.findHoleBridge(_a,_b)){var _c=_p.splitPolygon(_b,_a);_p.filterPoints(_c,_c.next)}},_p.findHoleBridge=function(_a,_b){var _c,_d=_b,_e=_a.x,_f=_a.y,_g=-1/0;do{if(_f<=_d.y&&_f>=_d.next.y&&_d.next.y!==_d.y){var _h=_d.x+(_f-_d.y)*(_d.next.x-_d.x)/(_d.next.y-_d.y);if(_h<=_e&&_g<_h){if((_g=_h)===_e){if(_f===_d.y)return _d;if(_f===_d.next.y)return _d.next}_c=_d.x<_d.next.x?_d:_d.next}}_d=_d.next}while(_d!==_b);if(!_c)return null;if(_e===_g)return _c.prev;var _i,_j=_c,_k=_c.x,_l=_c.y,_m=1/0;for(_d=_c.next;_d!==_j;)_e>=_d.x&&_d.x>=_k&&_e!==_d.x&&_p.pointInTriangle(_f<_l?_e:_g,_f,_k,_l,_f<_l?_g:_e,_f,_d.x,_d.y)&&((_i=Math.abs(_f-_d.y)/(_e-_d.x))<_m||_i===_m&&_d.x>_c.x)&&_p.locallyInside(_d,_a)&&(_c=_d,_m=_i),_d=_d.next;return _c},_p.indexCurve=function(_a,_b,_c,_d){for(var _e=_a;null===_e.z&&(_e.z=_p.zOrder(_e.x,_e.y,_b,_c,_d)),_e.prevZ=_e.prev,_e.nextZ=_e.next,(_e=_e.next)!==_a;);_e.prevZ.nextZ=null,_e.prevZ=null,_p.sortLinked(_e)},_p.sortLinked=function(_a){var _b,_c,_d,_e,_f,_g,_h,_i,_j=1;do{for(_c=_a,_f=_a=null,_g=0;_c;){for(_g++,_d=_c,_b=_h=0;_b<_j&&(_h++,_d=_d.nextZ);_b++);for(_i=_j;0<_h||0<_i&&_d;)0!==_h&&(0===_i||!_d||_c.z<=_d.z)?(_c=(_e=_c).nextZ,_h--):(_d=(_e=_d).nextZ,_i--),_f?_f.nextZ=_e:_a=_e,_e.prevZ=_f,_f=_e;_c=_d}_f.nextZ=null,_j*=2}while(1<_g);return _a},_p.zOrder=function(_a,_b,_c,_d,_e){return(_a=1431655765&((_a=858993459&((_a=252645135&((_a=16711935&((_a=32767*(_a-_c)*_e)|_a<<8))|_a<<4))|_a<<2))|_a<<1))|(_b=1431655765&((_b=858993459&((_b=252645135&((_b=16711935&((_b=32767*(_b-_d)*_e)|_b<<8))|_b<<4))|_b<<2))|_b<<1))<<1},_p.getLeftmost=function(_a){for(var _b=_a,_c=_a;_b.x<_c.x&&(_c=_b),(_b=_b.next)!==_a;);return _c},_p.pointInTriangle=function(_a,_b,_c,_d,_e,_f,_g,_h){return 0<=(_e-_g)*(_b-_h)-(_a-_g)*(_f-_h)&&0<=(_a-_g)*(_d-_h)-(_c-_g)*(_b-_h)&&0<=(_c-_g)*(_f-_h)-(_e-_g)*(_d-_h)},_p.isValidDiagonal=function(_a,_b){return _a.next.i!==_b.i&&_a.prev.i!==_b.i&&!_p.intersectsPolygon(_a,_b)&&_p.locallyInside(_a,_b)&&_p.locallyInside(_b,_a)&&_p.middleInside(_a,_b)},_p.area=function(_a,_b,_c){return(_b.y-_a.y)*(_c.x-_b.x)-(_b.x-_a.x)*(_c.y-_b.y)},_p.equals=function(_a,_b){return _a.x===_b.x&&_a.y===_b.y},_p.intersects=function(_a,_b,_c,_d){return!!(_p.equals(_a,_b)&&_p.equals(_c,_d)||_p.equals(_a,_d)&&_p.equals(_c,_b))||0<_p.area(_a,_b,_c)!=0<_p.area(_a,_b,_d)&&0<_p.area(_c,_d,_a)!=0<_p.area(_c,_d,_b)},_p.intersectsPolygon=function(_a,_b){var _c=_a;do{if(_c.i!==_a.i&&_c.next.i!==_a.i&&_c.i!==_b.i&&_c.next.i!==_b.i&&_p.intersects(_c,_c.next,_a,_b))return!0;_c=_c.next}while(_c!==_a);return!1},_p.locallyInside=function(_a,_b){return _p.area(_a.prev,_a,_a.next)<0?0<=_p.area(_a,_b,_a.next)&&0<=_p.area(_a,_a.prev,_b):_p.area(_a,_b,_a.prev)<0||_p.area(_a,_a.next,_b)<0},_p.middleInside=function(_a,_b){for(var _c=_a,_d=!1,_e=(_a.x+_b.x)/2,_f=(_a.y+_b.y)/2;_c.y>_f!=_c.next.y>_f&&_c.next.y!==_c.y&&_e<(_c.next.x-_c.x)*(_f-_c.y)/(_c.next.y-_c.y)+_c.x&&(_d=!_d),(_c=_c.next)!==_a;);return _d},_p.splitPolygon=function(_a,_b){var _c=new _ea(_a.i,_a.x,_a.y),_d=new _ea(_b.i,_b.x,_b.y),_e=_a.next,_f=_b.prev;return(_a.next=_b).prev=_a,(_c.next=_e).prev=_c,(_d.next=_c).prev=_d,(_f.next=_d).prev=_f,_d},_p.insertNode=function(_a,_b,_c,_d){var _e=new _ea(_a,_b,_c);return _d?(_e.next=_d.next,(_e.prev=_d).next.prev=_e,_d.next=_e):(_e.prev=_e).next=_e,_e},_p.removeNode=function(_a){_a.next.prev=_a.prev,_a.prev.next=_a.next,_a.prevZ&&(_a.prevZ.nextZ=_a.nextZ),_a.nextZ&&(_a.nextZ.prevZ=_a.prevZ)},_p.signedArea=function(_a,_b,_c,_d){for(var _e=0,_f=_b,_g=_c-_d;_f<_c;_f+=_d)_e+=(_a[_g]-_a[_f])*(_a[_f+1]+_a[_g+1]),_g=_f;return _e},_p}(),_ea=function(){function _a(_a,_b,_c){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=_a,this.x=_b,this.y=_c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return _m(_a,"laya.webgl.shapes.EarcutNode"),_a}(),_fa=(function(){function _a(_a,_b,_c,_d,_e,_f,_g){this.lineWidth=_a,this.lineColor=_b,this.lineAlpha=_c,this.fillColor=_d,this.fillAlpha=_e,this.shape=_g,this.fill=_f}_m(_a,"laya.webgl.shapes.GeometryData");var _b=_a.prototype;_b.clone=function(){return new _a(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},_b.getIndexData=function(){return null},_b.getVertexData=function(){return null},_b.destroy=function(){this.shape=null}}(),function(){function _a(_a){if(_a instanceof Float32Array)this.points=_a;else if(_a instanceof Array){_a.length;this.points=new Float32Array(_a)}}_m(_a,"laya.webgl.shapes.Vertex");var _b=_a.prototype;_w.imps(_b,{"laya.webgl.shapes.IShape":!0}),_b.getData=function(_a,_b,_c){},_b.needUpdate=function(_a){return!1},_b.rebuild=function(_a){},_b.setMatrix=function(_a){}}(),function(){function _i(_a){void 0===_a&&(_a=1e4),this._renderType=_a}_m(_i,"laya.webgl.submit.Submit");var _a=_i.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a.releaseRender=function(){var _a=_i._cache;(_a[_a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},_a.getRenderType=function(){return this._renderType},_a.renderSubmit=function(){if(0===this._numEle)return 1;var _a=this.shaderValue.textureHost;if(_a){var _b=_a.source;if(!_a.bitmap||!_b)return 1;this.shaderValue.texture=_b,_a.alphaTexture&&_a.alphaTexture.source&&(this.shaderValue.texture1=_a.alphaTexture.source)}this._vb.bind_upload(this._ib);var _c=_ua.mainContext;return this.shaderValue.upload(),_Q.activeBlendFunction!==this._blendFn&&(_c.enable(3042),this._blendFn(_c),_Q.activeBlendFunction=this._blendFn),_E.drawCall++,_E.trianglesFaces+=this._numEle/3,_c.drawElements(4,this._numEle,5123,this._startIdx),1},_i.__init__=function(){var _a=_i.RENDERBASE=new _i(-1);_a.shaderValue=new _ya(0,0),_a.shaderValue.ALPHA=-1234},_i.createSubmit=function(_a,_b,_c,_d,_e){var _f=_i._cache._length?_i._cache[--_i._cache._length]:new _i;null==_c&&((_c=_f._selfVb||(_f._selfVb=__a.create(-1))).clear(),_d=0),_f._ib=_b,_f._vb=_c,_f._startIdx=_d*_pa.BYTES_PIDX,_f._numEle=0;var _g=_a._nBlendType;_f._blendFn=_a._targets?_Q.targetFns[_g]:_Q.fns[_g],_f.shaderValue=_e,_f.shaderValue.setValue(_a._shader2D);var _h=_a._shader2D.filters;return _h&&_f.shaderValue.setFilters(_h),_f},_i.createShape=function(_a,_b,_c,_d,_e,_f){var _g=_i._cache._length?_i._cache[--_i._cache._length]:new _i;_g._ib=_b,_g._vb=_c,_g._numEle=_d,_g._startIdx=_e,_g.shaderValue=_f,_g.shaderValue.setValue(_a._shader2D);var _h=_a._nBlendType;return _g._blendFn=_a._targets?_Q.targetFns[_h]:_Q.fns[_h],_g},_i.TYPE_2D=1e4,_i.TYPE_CANVAS=10003,_i.TYPE_CMDSETRT=10004,_i.TYPE_CUSTOM=10005,_i.TYPE_BLURRT=10006,_i.TYPE_CMDDESTORYPRERT=10007,_i.TYPE_DISABLESTENCIL=10008,_i.TYPE_OTHERIBVB=10009,_i.TYPE_PRIMITIVE=10010,_i.TYPE_RT=10011,_i.TYPE_BLUR_RT=10012,_i.TYPE_TARGET=10013,_i.TYPE_CHANGE_VALUE=10014,_i.TYPE_SHAPE=10015,_i.TYPE_TEXTURE=10016,_i.TYPE_FILLTEXTURE=10017,_i.RENDERBASE=null,_i._cache=((_i._cache=[])._length=0,_i._cache),_i}()),_ga=function(){function _d(){this.fun=null,this.args=null}_m(_d,"laya.webgl.submit.SubmitCMD");var _a=_d.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a.renderSubmit=function(){return this.fun.apply(null,this.args),1},_a.getRenderType=function(){return 0},_a.releaseRender=function(){var _a=_d._cache;_a[_a._length++]=this},_d.create=function(_a,_b){var _c=_d._cache._length?_d._cache[--_d._cache._length]:new _d;return _c.fun=_b,_c.args=_a,_c},_d._cache=((_d._cache=[])._length=0,_d._cache),_d}(),_ha=function(){function _b(){this.variables={}}_m(_b,"laya.webgl.submit.SubmitCMDScope");var _a=_b.prototype;return _a.getValue=function(_a){return this.variables[_a]},_a.addValue=function(_a,_b){return this.variables[_a]=_b},_a.setValue=function(_a,_b){return this.variables.hasOwnProperty(_a)?this.variables[_a]=_b:null},_a.clear=function(){for(var _a in this.variables)delete this.variables[_a]},_a.recycle=function(){this.clear(),_b.POOL.push(this)},_b.create=function(){var _a=_b.POOL.pop();return _a||(_a=new _b),_a},_b.POOL=[],_b}(),_ia=function(){function _l(){this.offset=0,this.startIndex=0,this._mat=_z.create()}_m(_l,"laya.webgl.submit.SubmitOtherIBVB");var _a=_l.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a.releaseRender=function(){var _a=_l._cache;(_a[_a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},_a.getRenderType=function(){return 10009},_a.renderSubmit=function(){var _a=this._shaderValue.textureHost;if(_a){var _b=_a.source;if(!_a.bitmap||!_b)return 1;this._shaderValue.texture=_b}this._vb.bind_upload(this._ib);var _c=_sa.worldMatrix4,_d=_z.TEMP;_z.mulPre(this._mat,_c[0],_c[1],_c[4],_c[5],_c[12],_c[13],_d);var _e=_sa.worldMatrix4=_l.tempMatrix4;_e[0]=_d.a,_e[1]=_d.b,_e[4]=_d.c,_e[5]=_d.d,_e[12]=_d.tx,_e[13]=_d.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var _f=_ua.mainContext;return _Q.activeBlendFunction!==this._blendFn&&(_f.enable(3042),this._blendFn(_f),_Q.activeBlendFunction=this._blendFn),_E.drawCall++,_E.trianglesFaces+=this._numEle/3,_f.drawElements(4,this._numEle,5123,this.startIndex),_sa.worldMatrix4=_c,_Ja.activeShader=null,1},_l.create=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){void 0===_i&&(_i=0);var _j=_l._cache._length?_l._cache[--_l._cache._length]:new _l;_j._ib=_c,_j._vb=_b,_j._numEle=_d,_j._shader=_e,_j._shaderValue=_f;var _k=_a._nBlendType;switch(_j._blendFn=_a._targets?_Q.targetFns[_k]:_Q.fns[_k],_i){case 0:_j.offset=0,_j.startIndex=_h/(_pa.BYTES_PE*_b.vertexStride)*1.5,_j.startIndex*=_pa.BYTES_PIDX;break;case 1:_j.startIndex=_g,_j.offset=_h}return _j},_l._cache=((_l._cache=[])._length=0,_l._cache),_l.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_l}(),_ja=function(){function _c(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new _B,this.screenRect=new _B}_m(_c,"laya.webgl.submit.SubmitScissor");var _a=_c.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a._scissor=function(_a,_b,_c,_d){var _e=_sa.worldMatrix4,_f=_e[0],_g=_e[5],_h=_e[12],_i=_e[13];if(_d*=_g,(_c*=_f)<1||_d<1)return!1;var _j=(_a=_a*_f+_h)+_c,_k=(_b=_b*_g+_i)+_d;_a<0&&(_c=_j-(_a=0)),_b<0&&(_d=_k-(_b=0));var _l=_sa.worldClipRect;if(_a=Math.max(_a,_l.x),_b=Math.max(_b,_l.y),_c=Math.min(_j,_l.right)-_a,_d=Math.min(_k,_l.bottom)-_b,_c<1||_d<1)return!1;var _m=_sa.worldScissorTest;return this.screenRect.copyFrom(_l),_l.x=_a,_l.y=_b,_l.width=_c,_l.height=_d,_sa.worldScissorTest=!0,_b=_sa.height-_b-_d,_ua.mainContext.scissor(_a,_b,_c,_d),_ua.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),_m?(_b=_sa.height-this.screenRect.y-this.screenRect.height,_ua.mainContext.scissor(this.screenRect.x,_b,this.screenRect.width,this.screenRect.height),_ua.mainContext.enable(3089)):(_ua.mainContext.disable(3089),_sa.worldScissorTest=!1),_l.copyFrom(this.screenRect),!0},_a._scissorWithTagart=function(_a,_b,_c,_d){if(_c<1||_d<1)return!1;var _e=_a+_c,_f=_b+_d;_a<0&&(_c=_e-(_a=0)),_b<0&&(_d=_f-(_b=0));var _g=_sa.worldClipRect;if(_a=Math.max(_a,_g.x),_b=Math.max(_b,_g.y),_c=Math.min(_e,_g.right)-_a,_d=Math.min(_f,_g.bottom)-_b,_c<1||_d<1)return!1;var _h=_sa.worldScissorTest;return this.screenRect.copyFrom(_g),_sa.worldScissorTest=!0,_g.x=_a,_g.y=_b,_g.width=_c,_g.height=_d,_b=_sa.height-_b-_d,_ua.mainContext.scissor(_a,_b,_c,_d),_ua.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),_h?(_b=_sa.height-this.screenRect.y-this.screenRect.height,_ua.mainContext.scissor(this.screenRect.x,_b,this.screenRect.width,this.screenRect.height),_ua.mainContext.enable(3089)):(_ua.mainContext.disable(3089),_sa.worldScissorTest=!1),_g.copyFrom(this.screenRect),!0},_a.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},_a.getRenderType=function(){return 0},_a.releaseRender=function(){var _a=_c._cache;(_a[_a._length++]=this).context=null},_c.create=function(_a){var _b=_c._cache._length?_c._cache[--_c._cache._length]:new _c;return _b.context=_a,_b},_c._cache=((_c._cache=[])._length=0,_c._cache),_c}(),_ka=function(){function _i(){this.step=0,this.blendMode=null,this.level=0}_m(_i,"laya.webgl.submit.SubmitStencil");var _a=_i.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},_a.getRenderType=function(){return 0},_a.releaseRender=function(){var _a=_i._cache;_a[_a._length++]=this},_a.do1=function(){var _a=_ua.mainContext;_a.enable(2960),_a.clear(1024),_a.colorMask(!1,!1,!1,!1),_a.stencilFunc(514,this.level,255),_a.stencilOp(7680,7680,7682)},_a.do2=function(){var _a=_ua.mainContext;_a.stencilFunc(514,this.level+1,255),_a.colorMask(!0,!0,!0,!0),_a.stencilOp(7680,7680,7680)},_a.do3=function(){var _a=_ua.mainContext;_a.colorMask(!0,!0,!0,!0),_a.stencilOp(7680,7680,7680),_a.clear(1024),_a.disable(2960)},_a.do4=function(){var _a=_ua.mainContext;0==this.level&&(_a.enable(2960),_a.clear(1024)),_a.colorMask(!1,!1,!1,!1),_a.stencilFunc(519,0,255),_a.stencilOp(7680,7680,7682)},_a.do5=function(){var _a=_ua.mainContext;_a.stencilFunc(514,this.level,255),_a.colorMask(!0,!0,!0,!0),_a.stencilOp(7680,7680,7680)},_a.do6=function(){var _a=_ua.mainContext;_Q.targetFns[_Q.TOINT[this.blendMode]](_a)},_a.do7=function(){var _a=_ua.mainContext;_a.colorMask(!1,!1,!1,!1),_a.stencilOp(7680,7680,7683)},_a.do8=function(){var _a=_ua.mainContext;_a.colorMask(!0,!0,!0,!0),_a.stencilFunc(514,this.level,255),_a.stencilOp(7680,7680,7680)},_i.restore=function(_a,_b,_c,_d,_e){var _f;if((_a._renderKey=0)<_i._mask&&_i._mask--,0==_i._mask)_f=laya.webgl.submit.SubmitStencil.create(3),_a.addRenderObject(_f),_a._curSubmit=_fa.RENDERBASE;else{_f=laya.webgl.submit.SubmitStencil.create(7),_a.addRenderObject(_f);var _g=_a._vb;_g._byteLength;if(_qa.fillRectImgVb(_g,null,_b.x,_b.y,_b.width,_b.height,_I.DEF_UV,_c,_d,_e,0,0)){_a._shader2D.glTexture=null;var _h=_a._curSubmit=_fa.createSubmit(_a,_a._ib,_g,(_g._byteLength-64)/32*3,_ya.create(2,0));_h.shaderValue.ALPHA=1,_a._submits[_a._submits._length++]=_h,_a._curSubmit._numEle+=6,_a._curSubmit=_fa.RENDERBASE}else alert("clipRect calc stencil rect error");_f=laya.webgl.submit.SubmitStencil.create(8),_a.addRenderObject(_f)}},_i.restore2=function(_a,_b){var _c;(_a._renderKey=0)<_i._mask&&_i._mask--,0==_i._mask?(_c=laya.webgl.submit.SubmitStencil.create(3),_a.addRenderObject(_c),_a._curSubmit=_fa.RENDERBASE):(_c=laya.webgl.submit.SubmitStencil.create(7),_a.addRenderObject(_c),_a._submits[_a._submits._length++]=_b,_c=laya.webgl.submit.SubmitStencil.create(8),_a.addRenderObject(_c))},_i.create=function(_a){var _b=_i._cache._length?_i._cache[--_i._cache._length]:new _i;return 5==(_b.step=_a)&&++_i._mask,_b.level=_i._mask,_b},_i._cache=((_i._cache=[])._length=0,_i._cache),_i._mask=0,_i}(),_la=function(){function _h(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}_m(_h,"laya.webgl.submit.SubmitTarget");var _a=_h.prototype;return _w.imps(_a,{"laya.webgl.submit.ISubmit":!0}),_a.renderSubmit=function(){this._vb.bind_upload(this._ib);var _a=this.scope.getValue(this.proName);return _a&&(this.shaderValue.texture=_a.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[_a.width,_a.height]),this.shaderValue.upload(),this.blend(),_E.drawCall++,_E.trianglesFaces+=this._numEle/3,_ua.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},_a.blend=function(){if(_Q.activeBlendFunction!==_Q.fns[this.blendType]){var _a=_ua.mainContext;_a.enable(3042),_Q.fns[this.blendType](_a),_Q.activeBlendFunction=_Q.fns[this.blendType]}},_a.getRenderType=function(){return 0},_a.releaseRender=function(){var _a=_h._cache;(_a[_a._length++]=this).shaderValue.release(),this.shaderValue=null,this._vb=null,this._ib=null},_h.create=function(_a,_b,_c,_d,_e,_f){var _g=_h._cache._length?_h._cache[--_h._cache._length]:new _h;return _g._ib=_b,_g._vb=_c,_g.proName=_f,_g._startIdx=_d*_pa.BYTES_PIDX,_g._numEle=0,_g.blendType=_a._nBlendType,_g.shaderValue=_e,_g.shaderValue.setValue(_a._shader2D),_g},_h._cache=((_h._cache=[])._length=0,_h._cache),_h}(),_ma=function(){function _a(){this._sourceStr=null}_m(_a,"laya.webgl.text.CharSegment");var _b=_a.prototype;return _w.imps(_b,{"laya.webgl.text.ICharSegment":!0}),_b.textToSpit=function(_a){this._sourceStr=_a},_b.getChar=function(_a){return this._sourceStr.charAt(_a)},_b.getCharCode=function(_a){return this._sourceStr.charCodeAt(_a)},_b.length=function(){return this._sourceStr.length},_a}(),_na=function(){var _a;function _E(){}return _m(_E,"laya.webgl.text.DrawText"),_E.__init__=function(){_E._charsTemp=new Array,_E._drawValue=new _a,_E._charSeg=new _ma},_E.customCharSeg=function(_a){_E._charSeg=_a},_E.getChar=function(_a,_b,_c){var _d=_Ta.createOneChar(_a,_c);return-1!=_b&&(_E._charsCache[_b]=_d),_d},_E._drawSlow=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o){var _p,_q,_r=_E._drawValue.value(_f,_h,_i,_j,_m,_n,_o),_s=0,_t=0,_u=_E._charsTemp,_v=0,_w=NaN;if(_d)for(_u.length=_d.length,_s=0,_t=_d.length;_s<_t;_s++)(_q=_d[_s])&&(_w=_q.charNum+_r.txtID,_u[_s]=_p=_E._charsCache[_w]||_E.getChar(_q.char,_w,_r),_p.active());else{var _x=_c instanceof laya.utils.WordText?_c.toString():_c;if(_H.CharacterCache){_E._charSeg.textToSpit(_x);var _y=_E._charSeg.length();for(_s=0,_t=_u.length=_y;_s<_t;_s++)_w=_E._charSeg.getCharCode(_s)+_r.txtID,_u[_s]=_p=_E._charsCache[_w]||_E.getChar(_E._charSeg.getChar(_s),_w,_r),_p.active(),_v+=_p.cw}else _u.length=0,(_p=_E.getChar(_x,-1,_r)).active(),_v+=_p.cw,_u[0]=_p}var _z=0;null!==_g&&"left"!==_g&&(_z=-("center"==_g?_v/2:_v));var _A,_B,_C=NaN,_D=0;if(_d)for(_s=0,_t=_u.length;_s<_t;_s++)_p=_u[_s],_q=_d[_s],_p&&_q&&!_p.isSpace&&(_C=_p.borderSize,_A=_p.texture,_b._drawText(_A,_k+_z+_q.x*_m-_C,_l+_q.y*_n-_C,_A.width,_A.height,_e,0,0,0,0));else{for(_s=0,_t=_u.length;_s<_t;_s++)(_p=_u[_s])&&!_p.isSpace&&(_C=_p.borderSize,_A=_p.texture,_b._drawText(_A,_k+_z-_C,_l-_C,_A.width,_A.height,_e,0,0,0,0),_a&&((_B=_a[_D++])||(_B=_a[_D-1]=[]),_B[0]=_A,_B[1]=_z-_C,_B[2]=-_C)),_z+=_p.cw;_a&&(_a.length=_D)}},_E._drawFast=function(_a,_b,_c,_d,_e){for(var _f,_g,_h=0,_i=_a.length;_h<_i;_h++)(_f=(_g=_a[_h])[0]).active(),_b._drawText(_f,_d+_g[1],_e+_g[2],_f.width,_f.height,_c,0,0,0,0)},_E.drawText=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l){if(void 0===_l&&(_l=0),!(_b&&0===_b.length||_c&&0===_c.length)){var _m=_d.a,_n=_d.d;(0!==_d.b||0!==_d.c)&&(_m=_n=1);var _o=1!==_m||1!==_n;if(_o&&_w.stage.transform){var _p=_w.stage.transform;_o=_p.a===_m&&_p.d===_n}else _o=!1;if(_o){var _q=(_d=_d.copyTo(_xa._tmpMatrix)).tx,_r=_d.ty;_d.scale(1/_m,1/_n),_d._checkTransform(),_j*=_m,_k*=_n,_j+=_q-_d.tx,_k+=_r-_d.ty}else _m=_n=1;if(_c)_E._drawSlow(null,_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_m,_n,_l);else{if(null===_b.toUpperCase){var _s=_m+1e5*_n,_t=_b;return void(_t.changed||_t.id!==_s?(_t.id=_s,_t.changed=!1,_E._drawSlow(_t.save,_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_m,_n,_l)):_E._drawFast(_t.save,_a,_d,_j,_k))}var _u=_b+_e.toString()+_g+_h+_i+_m+_n+_f,_v=_E._textsCache[_u];_H.CharacterCache?_v?_E._drawFast(_v,_a,_d,_j,_k):(_E._textsCache.__length||(_E._textsCache.__length=0),_E._textsCache.__length>_x.WebGLTextCacheCount&&((_E._textsCache={}).__length=0,_E._curPoolIndex=0),_E._textCachesPool[_E._curPoolIndex]?(_v=_E._textsCache[_u]=_E._textCachesPool[_E._curPoolIndex]).length=0:_E._textCachesPool[_E._curPoolIndex]=_v=_E._textsCache[_u]=[],_E._textsCache.__length++,_E._curPoolIndex++,_E._drawSlow(_v,_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_m,_n,_l)):_E._drawSlow(_v,_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_m,_n,_l)}}},_E._charsTemp=null,_E._textCachesPool=[],_E._curPoolIndex=0,_E._charsCache={},_E._textsCache={},_E._drawValue=null,_E.d=[],_E._charSeg=null,_E.__init$=function(){_a=function(){function _i(){}return _m(_i,""),_i.prototype.value=function(_a,_b,_c,_d,_e,_f,_g){this.font=_a,this.fillColor=_b,this.borderColor=_c,this.lineWidth=_d,this.scaleX=_e,this.scaleY=_f,this.underLine=_g;var _h=_a.toString()+_e+_f+_d+(_b?_b.toLowerCase():" ")+(_c?_c.toLowerCase():" ")+_g;return this.txtID=_i._keymap[_h],this.txtID||(this.txtID=1e-7*++_i._keymapCount,_i._keymap[_h]=this.txtID),this},_i.clear=function(){_i._keymap={},_i._keymapCount=1},_i._keymap={},_i._keymapCount=1,_i}()},_E}(),_oa=function(){function _e(_a){this._index=0,this._size=14,this._italic=-2,_e._cache2=_e._cache2||[],this.setFont(_a||"14px Arial")}_m(_e,"laya.webgl.text.FontInContext");var _a=_e.prototype;return _a.setFont=function(_a){var _b=_e._cache2[_a];if(_b)this._words=_b[0],this._size=_b[1];else{this._words=_a.split(" ");for(var _c=0,_d=this._words.length;_c<_d;_c++)if(0<this._words[_c].indexOf("px")){this._index=_c;break}this._size=parseInt(this._words[this._index]),_e._cache2[_a]=[this._words,this._size]}this._text=null,this._italic=-2},_a.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},_a.hasType=function(_a){for(var _b=0,_c=this._words.length;_b<_c;_b++)if(this._words[_b]===_a)return _b;return-1},_a.removeType=function(_a){for(var _b=0,_c=this._words.length;_b<_c;_b++)if(this._words[_b]===_a){this._words.splice(_b,1),this._index>_b&&this._index--;break}this._text=null,this._italic=-2},_a.copyTo=function(_a){return _a._text=this._text,_a._size=this._size,_a._index=this._index,_a._words=this._words.slice(),_a._italic=-2,_a},_a.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},_d(0,_a,"size",function(){return this._size},function(_a){this._size=_a,this._words[this._index]=_a+"px",this._text=null}),_e.create=function(_a){var _b=_e._cache[_a];return _b||(_b=_e._cache[_a]=new _e(_a))},_e.EMPTY=new _e,_e._cache={},_e._cache2=null,_e}(),_pa=function(){function _a(){}return _m(_a,"laya.webgl.utils.CONST3D2D"),_a.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_a.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],_a.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],_a._TMPARRAY=[],_a._OFFSETX=0,_a._OFFSETY=0,_g(_a,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),_a}(),_qa=function(){function _o(){}return _m(_o,"laya.webgl.utils.GlUtils"),_o.make2DProjection=function(_a,_b,_c){return[2/_a,0,0,0,0,-2/_b,0,0,0,0,2/_c,0,-1,1,0,1]},_o.fillIBQuadrangle=function(_a,_b){if(65535/4<_b)throw Error("IBQuadrangle count:"+_b+" must<:"+Math.floor(65535/4));_b=Math.floor(_b),_a._resizeBuffer(6*(_b+1)*2,!1),_a.byteLength=_a.bufferLength;for(var _c=_a.getUint16Array(),_d=0,_e=0;_e<_b;_e++)_c[_d++]=4*_e,_c[_d++]=4*_e+2,_c[_d++]=4*_e+1,_c[_d++]=4*_e,_c[_d++]=4*_e+3,_c[_d++]=4*_e+2;return _a.setNeedUpload(),!0},_o.expandIBQuadrangle=function(_a,_b){_a.bufferLength>=6*_b*2||_o.fillIBQuadrangle(_a,_b)},_o.mathCeilPowerOfTwo=function(_a){return _a--,_a|=_a>>1,_a|=_a>>2,_a|=_a>>4,_a|=_a>>8,_a|=_a>>16,++_a},_o.fillQuadrangleImgVb=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=16+(_a._byteLength>>2);_a.byteLength=_i<<2;var _j=_a.getFloat32Array();_j[(_i-=16)+2]=_e[0],_j[_i+3]=_e[1],_j[_i+6]=_e[2],_j[_i+7]=_e[3],_j[_i+10]=_e[4],_j[_i+11]=_e[5],_j[_i+14]=_e[6],_j[_i+15]=_e[7];var _k=_f.a,_l=_f.b,_m=_f.c,_n=_f.d;if(1!==_k||0!==_l||0!==_m||1!==_n){_f.bTransform=!0;var _o=_f.tx+_g,_p=_f.ty+_h;_j[_i]=(_d[0]+_b)*_k+(_d[1]+_c)*_m+_o,_j[_i+1]=(_d[0]+_b)*_l+(_d[1]+_c)*_n+_p,_j[_i+4]=(_d[2]+_b)*_k+(_d[3]+_c)*_m+_o,_j[_i+5]=(_d[2]+_b)*_l+(_d[3]+_c)*_n+_p,_j[_i+8]=(_d[4]+_b)*_k+(_d[5]+_c)*_m+_o,_j[_i+9]=(_d[4]+_b)*_l+(_d[5]+_c)*_n+_p,_j[_i+12]=(_d[6]+_b)*_k+(_d[7]+_c)*_m+_o,_j[_i+13]=(_d[6]+_b)*_l+(_d[7]+_c)*_n+_p}else _f.bTransform=!1,_b+=_f.tx+_g,_c+=_f.ty+_h,_j[_i]=_b+_d[0],_j[_i+1]=_c+_d[1],_j[_i+4]=_b+_d[2],_j[_i+5]=_c+_d[3],_j[_i+8]=_b+_d[4],_j[_i+9]=_c+_d[5],_j[_i+12]=_b+_d[6],_j[_i+13]=_c+_d[7];return _a._upload=!0},_o.fillTranglesVB=function(_a,_b,_c,_d,_e,_f,_g){var _h=(_a._byteLength>>2)+_d.length;_a.byteLength=_h<<2;var _i=_a.getFloat32Array();_h-=_d.length;for(var _j=_d.length,_k=_e.a,_l=_e.b,_m=_e.c,_n=_e.d,_o=0;_o<_j;_o+=4)if(_i[_h+_o+2]=_d[_o+2],_i[_h+_o+3]=_d[_o+3],1!==_k||0!==_l||0!==_m||1!==_n){_e.bTransform=!0;var _p=_e.tx+_f,_q=_e.ty+_g;_i[_h+_o]=(_d[_o]+_b)*_k+(_d[_o+1]+_c)*_m+_p,_i[_h+_o+1]=(_d[_o]+_b)*_l+(_d[_o+1]+_c)*_n+_q}else _e.bTransform=!1,_b+=_e.tx+_f,_c+=_e.ty+_g,_i[_h+_o]=_b+_d[_o],_i[_h+_o+1]=_c+_d[_o+1];return _a._upload=!0},_o.copyPreImgVb=function(_a,_b,_c){var _d=_a._byteLength>>2;_a.byteLength=_d+16<<2;for(var _e=_a.getFloat32Array(),_f=0,_g=_d-16;_f<4;_f++)_e[_d]=_e[_g]+_b,++_g,_e[++_d]=_e[_g]+_c,++_g,_e[++_d]=_e[_g],++_g,_e[++_d]=_e[_g],++_d,++_g;_a._upload=!0},_o.fillRectImgVb=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m){void 0===_m&&(_m=!1);var _n,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D=1,_E=_h.a,_F=_h.b,_G=_h.c,_H=_h.d,_I=_b&&_b.width<99999999;if(1!==_E||0!==_F||0!==_G||1!==_H?(_h.bTransform=!0,0===_F&&0===_G&&(_D=23,_v=_e+_c,_w=_f+_d,_n=_E*_c+(_x=_h.tx+_i),_p=_E*_v+_x,_o=_H*_d+(_y=_h.ty+_j),_q=_H*_w+_y)):(_D=23,_h.bTransform=!1,_p=(_n=_c+_h.tx+_i)+_e,_q=(_o=_d+_h.ty+_j)+_f),_I&&(_r=_b.x,_s=_b.y,_t=_b.width+_r,_u=_b.height+_s),1!==_D){if(Math.min(_n,_p)>=_t)return!1;if(Math.min(_o,_q)>=_u)return!1;if(Math.max(_p,_n)<=_r)return!1;if(Math.max(_q,_o)<=_s)return!1}var _J=_a._byteLength>>2;_a.byteLength=16+_J<<2;var _K=_a.getFloat32Array();switch(_K[2+_J]=_g[0],_K[3+_J]=_g[1],_K[6+_J]=_g[2],_K[7+_J]=_g[3],_K[10+_J]=_g[4],_K[11+_J]=_g[5],_K[14+_J]=_g[6],_K[15+_J]=_g[7],_D){case 1:_x=_h.tx+_i,_y=_h.ty+_j;var _L=_E*_c,_M=_G*_d,_N=_H*_d,_O=_F*_c,_P=_E*(_v=_e+_c),_Q=_G*(_w=_f+_d),_R=_H*_w,_S=_F*_v;_m?(_z=_L+_M+_x,_B=Math.round(_z)-_z,_A=_N+_O+_y,_C=Math.round(_A)-_A,_K[_J]=_z+_B,_K[1+_J]=_A+_C,_K[4+_J]=_P+_M+_x+_B,_K[5+_J]=_N+_S+_y+_C,_K[8+_J]=_P+_Q+_x+_B,_K[9+_J]=_R+_S+_y+_C,_K[12+_J]=_L+_Q+_x+_B,_K[13+_J]=_R+_O+_y+_C):(_K[_J]=_L+_M+_x,_K[1+_J]=_N+_O+_y,_K[4+_J]=_P+_M+_x,_K[5+_J]=_N+_S+_y,_K[8+_J]=_P+_Q+_x,_K[9+_J]=_R+_S+_y,_K[12+_J]=_L+_Q+_x,_K[13+_J]=_R+_O+_y);break;case 23:_m?(_z=_n+_k,_B=Math.round(_z)-_z,_A=_o,_C=Math.round(_A)-_A,_K[_J]=_z+_B,_K[1+_J]=_A+_C,_K[4+_J]=_p+_k+_B,_K[5+_J]=_o+_C,_K[8+_J]=_p+_B,_K[9+_J]=_q+_C,_K[12+_J]=_n+_B,_K[13+_J]=_q+_C):(_K[_J]=_n+_k,_K[1+_J]=_o,_K[4+_J]=_p+_k,_K[5+_J]=_o,_K[8+_J]=_p,_K[9+_J]=_q,_K[12+_J]=_n,_K[13+_J]=_q)}return _a._upload=!0},_o.fillLineVb=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=.5*_g,_j=_o._fillLineArray,_k=-(_d-_f),_l=_c-_e,_m=Math.sqrt(_k*_k+_l*_l);_k/=_m,_l/=_m,_k*=_i,_l*=_i,_j[0]=_c-_k,_j[1]=_d-_l,_j[4]=_c+_k,_j[5]=_d+_l,_j[8]=_e+_k,_j[9]=_f+_l,_j[12]=_e-_k,_j[13]=_f-_l,_h&&_h.transformPointArray(_j,_j);var _n=16+(_a._byteLength>>2);return _a.byteLength=_n<<2,_a.insertData(_j,_n-16),!0},_o._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_o}(),_ra=(function(){function _i(){}_m(_i,"laya.webgl.utils.MatirxArray"),_i.ArrayMul=function(_a,_b,_c){if(_a)if(_b)for(var _d=NaN,_e=NaN,_f=NaN,_g=NaN,_h=0;_h<4;_h++)_d=_a[_h],_e=_a[_h+4],_f=_a[_h+8],_g=_a[_h+12],_c[_h]=_d*_b[0]+_e*_b[1]+_f*_b[2]+_g*_b[3],_c[_h+4]=_d*_b[4]+_e*_b[5]+_f*_b[6]+_g*_b[7],_c[_h+8]=_d*_b[8]+_e*_b[9]+_f*_b[10]+_g*_b[11],_c[_h+12]=_d*_b[12]+_e*_b[13]+_f*_b[14]+_g*_b[15];else _i.copyArray(_a,_c);else _i.copyArray(_b,_c)},_i.copyArray=function(_a,_b){if(_a&&_b)for(var _c=0;_c<_a.length;_c++)_b[_c]=_a[_c]}}(),function(){function _b(_a,_b,_c){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=_a,this._vb=new __a(_a,35048),_b&&this._vb._resizeBuffer(_b,!1),this._ib=new _$a,_c&&this._ib._resizeBuffer(_c,!1)}_m(_b,"laya.webgl.utils.Mesh2D");var _a=_b.prototype;return _a.cloneWithNewVB=function(){var _a=new _b(this._stride,0,0);return _a._ib=this._ib,_a._quadNum=this._quadNum,_a._attribInfo=this._attribInfo,_a},_a.cloneWithNewVBIB=function(){var _a=new _b(this._stride,0,0);return _a._attribInfo=this._attribInfo,_a},_a.getVBW=function(){return this._vb.setNeedUpload(),this._vb},_a.getVBR=function(){return this._vb},_a.getIBR=function(){return this._ib},_a.getIBW=function(){return this._ib.setNeedUpload(),this._ib},_a.createQuadIB=function(_a){this._quadNum=_a,this._ib._resizeBuffer(6*_a*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var _b=this._ib.getUint16Array(),_c=0,_d=0,_e=0;_e<_a;_e++)_b[_c++]=_d,_b[_c++]=_d+2,_b[_c++]=_d+1,_b[_c++]=_d,_b[_c++]=_d+3,_b[_c++]=_d+2,_d+=4;this._ib.setNeedUpload()},_a.setAttributes=function(_a){if(this._attribInfo=_a,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},_a.getEleNum=function(){return this._ib.getBuffer().byteLength/2},_a.releaseMesh=function(){},_a.destroy=function(){},_a.clearVB=function(){this._vb.clear()},_b._gvaoid=0,_b}()),_sa=function(){function _e(){}return _m(_e,"laya.webgl.utils.RenderState2D"),_e.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},_e.mat2MatArray=function(_a,_b){var _c=_a,_d=_b;return _d[0]=_c.a,_d[1]=_c.b,_d[2]=_e.EMPTYMAT4_ARRAY[2],_d[3]=_e.EMPTYMAT4_ARRAY[3],_d[4]=_c.c,_d[5]=_c.d,_d[6]=_e.EMPTYMAT4_ARRAY[6],_d[7]=_e.EMPTYMAT4_ARRAY[7],_d[8]=_e.EMPTYMAT4_ARRAY[8],_d[9]=_e.EMPTYMAT4_ARRAY[9],_d[10]=_e.EMPTYMAT4_ARRAY[10],_d[11]=_e.EMPTYMAT4_ARRAY[11],_d[12]=_c.tx,_d[13]=_c.ty,_d[14]=_e.EMPTYMAT4_ARRAY[14],_d[15]=_e.EMPTYMAT4_ARRAY[15],_b},_e.restoreTempArray=function(){_e.TEMPMAT4_ARRAY[0]=1,_e.TEMPMAT4_ARRAY[1]=0,_e.TEMPMAT4_ARRAY[4]=0,_e.TEMPMAT4_ARRAY[5]=1,_e.TEMPMAT4_ARRAY[12]=0,_e.TEMPMAT4_ARRAY[13]=0},_e.clear=function(){_e.worldScissorTest=!1,_e.worldShaderDefines=null,_e.worldFilters=null,_e.worldAlpha=1,_e.worldClipRect.x=_e.worldClipRect.y=0,_e.worldClipRect.width=_e.width,_e.worldClipRect.height=_e.height,_e.curRenderTarget=null},_e._MAXSIZE=99999999,_e.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_e.worldMatrix4=_e.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_e.worldAlpha=1,_e.worldScissorTest=!1,_e.worldFilters=null,_e.worldShaderDefines=null,_e.curRenderTarget=null,_e.width=0,_e.height=0,_g(_e,["worldMatrix",function(){return this.worldMatrix=new _z},"worldClipRect",function(){return this.worldClipRect=new _B(0,0,99999999,99999999)}]),_e}(),_ta=function(){var _s,_c;function _t(_a,_b,_c,_d,_e){var _f=this;function _g(_a){var _b=[],_c=new _s(_b);return _f._compileToTree(_c,_a.split("\n"),0,_b,_e),_c}var _h=_n.now();this._VS=_g(_b),this._PS=_g(_c),this._nameMap=_d,2<_n.now()-_h&&console.log("ShaderCompile use time:"+(_n.now()-_h)+"  size:"+_b.length+"/"+_c.length)}_m(_t,"laya.webgl.utils.ShaderCompile");var _a=_t.prototype;return _a._compileToTree=function(_a,_b,_c,_d,_e){var _f,_g,_h,_i,_j,_k,_l,_m=0,_n=0,_o=0,_p=0;for(_n=_c;_n<_b.length;_n++)if(!((_h=_b[_n]).length<1)&&0!==(_m=_h.indexOf("//"))){if(0<=_m&&(_h=_h.substr(0,_m)),_f=_l||new _s(_d),_l=null,_f.text=_h,_f.noCompile=!0,0<=(_m=_h.indexOf("#"))){for(_i="#",_p=_m+1,_o=_h.length;_p<_o;_p++){var _q=_h.charAt(_p);if(" "===_q||"\t"===_q||"\r"===_q||"\n"===_q||"?"===_q)break;_i+=_q}switch(_f.name=_i){case"#ifdef":case"#ifndef":if(_f.src=_h,_f.noCompile=null!=_h.match(/[!&|()=<>]/),_f.noCompile?console.log("function():Boolean{return "+_h.substr(_m+_f.name.length)+"}"):(_k=_h.replace(/^\s*/,"").split(/\s+/),_f.setCondition(_k[1],"#ifdef"===_i?1:2),_f.text="//"+_f.text),_f.setParent(_a),_a=_f,_e)for(_k=_h.substr(_p).split(_t._splitToWordExps3),_p=0;_p<_k.length;_p++)(_h=_k[_p]).length&&(_e[_h]=!0);continue;case"#if":if(_f.src=_h,_f.noCompile=!0,_f.setParent(_a),_a=_f,_e)for(_k=_h.substr(_p).split(_t._splitToWordExps3),_p=0;_p<_k.length;_p++)(_h=_k[_p]).length&&"defined"!=_h&&(_e[_h]=!0);continue;case"#else":_f.src=_h,_g=(_a=_a.parent).childs[_a.childs.length-1],_f.noCompile=_g.noCompile,_f.noCompile||(_f.condition=_g.condition,_f.conditionType=1==_g.conditionType?2:1,_f.text="//"+_f.text+" "+_g.text+" "+_f.conditionType),_f.setParent(_a),_a=_f;continue;case"#endif":_g=(_a=_a.parent).childs[_a.childs.length-1],_f.noCompile=_g.noCompile,_f.noCompile||(_f.text="//"+_f.text),_f.setParent(_a);continue;case"#include":_k=_t.splitToWords(_h,null);var _r=_t.includes[_k[1]];if(!_r)throw"ShaderCompile error no this include file:"+_k[1];if((_m=_k[0].indexOf("?"))<0){_f.setParent(_a),_h=_r.getWith("with"==_k[2]?_k[3]:null),this._compileToTree(_f,_h.split("\n"),0,_d,_e),_f.text="";continue}_f.setCondition(_k[0].substr(_m+1),1),_f.text=_r.getWith("with"==_k[2]?_k[3]:null);break;case"#import":_j=(_k=_t.splitToWords(_h,null))[1],_d.push({node:_f,file:_t.includes[_j],ofs:_f.text.length});continue}}else{if((_g=_a.childs[_a.childs.length-1])&&!_g.name){0<_d.length&&_t.splitToWords(_h,_g),_l=_f,_g.text+="\n"+_h;continue}0<_d.length&&_t.splitToWords(_h,_f)}_f.setParent(_a)}},_a.createShader=function(_a,_b,_c){var _d={},_e="";if(_a)for(var _f in _a)_e+="#define "+_f+"\n",_d[_f]=!0;var _g=this._VS.toscript(_d,[]),_h=this._PS.toscript(_d,[]);return(_c||_Wa.create)(_e+_g.join("\n"),_e+_h.join("\n"),_b,this._nameMap)},_t._parseOne=function(_a,_b,_c,_d,_e,_f){var _g={type:_t.shaderParamsMap[_c[_d+1]],name:_c[_d+2],size:isNaN(parseInt(_c[_d+3]))?1:parseInt(_c[_d+3])};return _f&&("attribute"==_e?_a.push(_g):_b.push(_g)),":"==_c[_d+3]&&(_g.type=_c[_d+4],_d+=2),_d+=2},_t.addInclude=function(_a,_b){if(!_b||0===_b.length)throw new Error("add shader include file err:"+_a);if(_t.includes[_a])throw new Error("add shader include file err, has add:"+_a);_t.includes[_a]=new _c(_b)},_t.preGetParams=function(_a,_b){var _c=[_a,_b],_d={},_e=[],_f=[],_g={},_h=[];_d.attributes=_e,_d.uniforms=_f,_d.defines=_g;for(var _i=0,_j=0,_k=0;_k<2;_k++){_c[_k]=_c[_k].replace(_t._removeAnnotation,"");var _l,_m=_c[_k].match(_t._reg);for(_i=0,_j=_m.length;_i<_j;_i++){var _n=_m[_i];if("attribute"==_n||"uniform"==_n)_i=_t._parseOne(_e,_f,_m,_i,_n,!0);else{if("#define"==_n){_h[_n=_m[++_i]]=1;continue}if("#ifdef"==_n){_g[_l=_m[++_i]]=_g[_l]||[];for(_i++;_i<_j;_i++)if("attribute"==(_n=_m[_i])||"uniform"==_n)_i=_t._parseOne(_e,_f,_m,_i,_n,_h[_l]);else if("#else"==_n)for(_i++;_i<_j;_i++)if("attribute"==(_n=_m[_i])||"uniform"==_n)_i=_t._parseOne(_e,_f,_m,_i,_n,!_h[_l]);else if("#endif"==_n)break}}}}return _d},_t.splitToWords=function(_a,_b){for(var _c,_d,_e=[],_f=-1,_g=0,_h=_a.length;_g<_h;_g++)if(_c=_a.charAt(_g),0<=" \t=+-*/&%!<>()'\",;".indexOf(_c)){if(0<=_f&&1<_g-_f&&(_d=_a.substr(_f,_g-_f),_e.push(_d)),'"'==_c||"'"==_c){var _i=_a.indexOf(_c,_g+1);if(_i<0)throw"Sharder err:"+_a;_e.push(_a.substr(_g+1,_i-_g-1)),_g=_i,_f=-1;continue}"("==_c&&_b&&0<_e.length&&(_d=_e[_e.length-1]+";","vec4;main;".indexOf(_d)<0&&(_b.useFuns+=_d)),_f=-1}else _f<0&&(_f=_g);return _f<_h&&1<_h-_f&&(_d=_a.substr(_f,_h-_f),_e.push(_d)),_e},_t.IFDEF_NO=0,_t.IFDEF_YES=1,_t.IFDEF_ELSE=2,_t.IFDEF_PARENT=3,_t._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),_t._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),_t._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),_t.includes={},_g(_t,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),_t.__init$=function(){_s=function(){function _c(_a){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=_a}_m(_c,"");var _a=_c.prototype;return _a.setParent=function(_a){_a.childs.push(this),this.z=_a.z+1,this.parent=_a},_a.setCondition=function(_a,_b){_a&&(this.conditionType=_b,_a=_a.replace(/(\s*$)/g,""),this.condition=function(){return this[_a]},this.condition.__condition=_a)},_a.toscript=function(_a,_b){return this._toscript(_a,_b,++_c.__id)},_a._toscript=function(_d,_e,_f){if(this.childs.length<1&&!this.text)return _e;_e.length;if(this.condition){var _a=!!this.condition.call(_d);if(2===this.conditionType&&(_a=!_a),!_a)return _e}if(this.text&&_e.push(this.text),0<this.childs.length&&this.childs.forEach(function(_a,_b,_c){_a._toscript(_d,_e,_f)}),0<this.includefiles.length&&0<this.useFuns.length)for(var _b,_c=0,_g=this.includefiles.length;_c<_g;_c++)this.includefiles[_c].curUseID!=_f&&0<(_b=this.includefiles[_c].file.getFunsScript(this.useFuns)).length&&(this.includefiles[_c].curUseID=_f,_e[0]=_b+_e[0]);return _e},_c.__id=1,_c}(),_c=function(){function _a(_a){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=_a;for(var _b=0,_c=0,_d=0;!((_b=_a.indexOf("#begin",_b))<0);){for(_d=_b+5;!((_d=_a.indexOf("#end",_d))<0)&&"i"===_a.charAt(_d+4);)_d+=5;if(_d<0)throw"add include err,no #end:"+_a;_c=_a.indexOf("\n",_b);var _e=_t.splitToWords(_a.substr(_b,_c-_b),null);"code"==_e[1]?this.codes[_e[2]]=_a.substr(_c+1,_d-_c-1):"function"==_e[1]&&(_c=_a.indexOf("function",_b),_c+="function".length,this.funs[_e[3]]=_a.substr(_c+1,_d-_c-1),this.funnames+=_e[3]+";"),_b=_d+1}}_m(_a,"");var _b=_a.prototype;return _b.getWith=function(_a){var _b=_a?this.codes[_a]:this.script;if(!_b)throw"get with error:"+_a;return _b},_b.getFunsScript=function(_a){var _b="";for(var _c in this.funs)0<=_a.indexOf(_c+";")&&(_b+=this.funs[_c]);return _b},_a}()},_t}(),_ua=function(){function _g(){}return _m(_g,"laya.webgl.WebGL"),_g._uint8ArraySlice=function(){for(var _a=this.length,_b=new Uint8Array(this.length),_c=0;_c<_a;_c++)_b[_c]=this[_c];return _b},_g._float32ArraySlice=function(){for(var _a=this.length,_b=new Float32Array(this.length),_c=0;_c<_a;_c++)_b[_c]=this[_c];return _b},_g._uint16ArraySlice=function(_a){var _b,_c=arguments,_d=0,_e=0;if(0===_c.length)for(_d=this.length,_b=new Uint16Array(_d),_e=0;_e<_d;_e++)_b[_e]=this[_e];else if(2===_c.length){var _f=_c[0],_g=_c[1];if(_f<_g)for(_d=_g-_f,_b=new Uint16Array(_d),_e=_f;_e<_g;_e++)_b[_e-_f]=this[_e];else _b=new Uint16Array(0)}return _b},_g.expandContext=function(){var _a=_e.prototype,_b=CanvasRenderingContext2D.prototype;_b.fillTrangles=_a.fillTrangles,_Xa.__int__(null),_b.setIBVB=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){void 0===_i&&(_i=0),void 0===_j&&(_j=0),null===_c&&(this._ib=this._ib||_$a.QuadrangleIB,_c=this._ib,_qa.expandIBQuadrangle(_c,_d._byteLength/64+8)),this._setIBVB(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j)},_b.fillTrangles=function(_a,_b,_c,_d,_e){this._curMat=this._curMat||_z.create(),this._vb=this._vb||__a.create(),this._ib||(this._ib=_$a.create(),_qa.fillIBQuadrangle(this._ib,_g/4));var _f=this._vb,_g=_d.length>>4;_qa.fillTranglesVB(_f,_b,_c,_d,_e||this._curMat,0,0),_qa.expandIBQuadrangle(this._ib,_f._byteLength/64+8);var _h=new _ya(1,0);_h.textureHost=_a;var _i=new _Za("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; #ifdef TXTALPHA uniform sampler2D texture1; #endif void main() {vec4 color= texture2D(texture, v_texcoord); #ifdef TXTALPHA color.a = texture2D(texture1, v_texcoord).a; #endif color.a*=1.0; gl_FragColor= color;}");_f._vertType=3,this._setIBVB(_b,_c,this._ib,_f,6*_g,_e,_i,_h,0,0)}},_g.enable=function(){if(_n.__init__(),_r.isConchApp&&!_r.isConchWebGL)return _v.skinAniSprite=function(){return new _aa},_g.expandContext(),!1;if(_v.getWebGLContext=function(_a){for(var _b,_c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],_d=0;_d<_c.length;_d++){try{_b=_a.getContext(_c[_d],{stencil:_x.isStencil,alpha:_x.isAlpha,antialias:_x.isAntialias,premultipliedAlpha:_x.premultipliedAlpha,preserveDrawingBuffer:_x.preserveDrawingBuffer})}catch(_a){}if(_b)return _b}return null},null==(_g.mainContext=_g.mainContext||_v.getWebGLContext(_r._mainCanvas)))return!1;if(_r.isWebGL)return!0;_p.create=function(_a,_b){return new _ab(_a,_b)},_q.create=function(_a,_b,_c,_d,_e,_f,_g){return new _Va(_a,_b,_c,_d,_e,_f,_g)},_r.WebGL=_g,_r.isWebGL=!0,_na.__init__(),_v.createRenderSprite=function(_a,_b){return new _za(_a,_b)},_v.createWebGLContext2D=function(_a){return new _xa(_a)},_v.changeWebGLSize=function(_a,_b){laya.webgl.WebGL.onStageResize(_a,_b)},_v.createGraphics=function(){return new _wa};var _a=_v.createFilterAction;return _v.createFilterAction=_a||function(_a){return new _Aa},_v.clear=function(_a){_sa.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var _b=_r.context.ctx,_c=0==_b._submits._length||_x.preserveDrawingBuffer?_o.create(_a)._color:_D._wgColor;_c&&_b.clearBG(_c[0],_c[1],_c[2],_c[3]),_sa.clear()},_v.addToAtlas=function(_a,_b){void 0===_b&&(_b=!1);var _c=_a.bitmap;_r.optimizeTextureMemory(_a.url,_a)?_w.__typeof(_c,"laya.webgl.resource.IMergeAtlasBitmap")&&_c.allowMerageInAtlas&&_c.on("recovered",_a,_a.addTextureToAtlas):_c.enableMerageInAtlas=!1},_v.isAtlas=function(_a){return _a instanceof laya.webgl.atlas.AtlasWebGLCanvas},_O._enable(),_v.beginFlush=function(){for(var _a=_O.instance,_b=_a.getAtlaserCount(),_c=0;_c<_b;_c++){var _d=_a.getAtlaserByIndex(_c).texture;_d._flashCacheImageNeedFlush&&_v.flashFlushImage(_d)}},_v.drawToCanvas=function(_a,_b,_c,_d,_e,_f){(_c<=0||_d<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),_c|=0,_d|=0,_e|=0,_f|=0;var _g=_Ka.create(_c,_d,6408,5121,0,!1);_g.start(),_g.clear(0,0,0,0),_r.context.clear(),_s.renders[_b]._fun(_a,_r.context,_e,_sa.height-_d+_f),_r.context.flush(),_g.end();var _h=_g.getData(0,0,_c,_d);if(_g.recycle(),_h.byteLength==_c*_d*4){var _i=new _Sa;_i._canvas=_n.createElement("canvas"),_i.size(_c,_d);var _j=_i._canvas.getContext("2d");_n.canvas.size(_c,_d);var _k=_n.context,_l=_k.createImageData(_c,_d);return _l.data.set(new Uint8ClampedArray(_h.buffer)),_i._imgData=_l,_k.putImageData(_l,0,0),_j.save(),_j.translate(0,_d),_j.scale(1,-1),_j.drawImage(_n.canvas.source,0,0),_j.restore(),_i}console.log("drawToCanvas error: w:"+_c+",h:"+_d+",datalen:"+_h.byteLength)},_v.createFilterAction=function(_a){var _b;switch(_a){case 32:_b=new _Aa}return _b},_v.addTextureToAtlas=function(_a){_a._uvID++,_O._atlasRestore++,_a.bitmap.enableMerageInAtlas&&_O.instance.addToAtlas(_a)},_v.getTexturePixels=function(_a,_b,_c,_d,_e){_r.context.ctx.clear();var _f=new _C;_f.graphics.drawTexture(_a,-_b,-_c);var _g=_Ka.create(_d,_e);_g.start(),_g.clear(0,0,0,0),_f.render(_r.context,0,0),_r.context.ctx.flush(),_g.end();for(var _h=_g.getData(0,0,_d,_e),_i=[],_j=0,_k=_e-1;0<=_k;_k--)for(var _l=0;_l<_d;_l++)_j=4*(_k*_d+_l),_i.push(_h[_j]),_i.push(_h[_j+1]),_i.push(_h[_j+2]),_i.push(_h[_j+3]);return _i},_v.skinAniSprite=function(){return new _aa},_j.create=function(_a,_b){var _c=new _Sa;return _c._imgData=_b,_c.flipY=!1,_c},_y._filterStart=function(_a,_b,_c,_d,_e){var _f=_a.getValue("bounds"),_g=_Ka.create(_f.width,_f.height);if(_g.start(),_g.clear(0,0,0,0),_a.addValue("src",_g),_a.addValue("ScissorTest",_sa.worldScissorTest),_sa.worldScissorTest){var _h=new _B;_h.copyFrom(_c.ctx._clipRect),_a.addValue("clipRect",_h),_sa.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},_y._filterEnd=function(_a,_b,_c,_d,_e){var _f=_a.getValue("bounds");_a.getValue("src").end();var _g=_Ka.create(_f.width,_f.height);_g.start(),_g.clear(0,0,0,0),_a.addValue("out",_g),_b._set$P("_filterCache",_g),_b._set$P("_isHaveGlowFilter",_a.getValue("_isHaveGlowFilter"))},_y._EndTarget=function(_a,_b){if(_a.getValue("src").recycle(),_a.getValue("out").end(),_a.getValue("ScissorTest")){_sa.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),_b.ctx.save();var _c=_a.getValue("clipRect");_b.ctx.clipRect(_c.x,_c.y,_c.width,_c.height)}},_y._useSrc=function(_a){var _b=_a.getValue("out");_b.end(),(_b=_a.getValue("src")).start(),_b.clear(0,0,0,0)},_y._endSrc=function(_a){_a.getValue("src").end()},_y._useOut=function(_a){var _b=_a.getValue("src");_b.end(),(_b=_a.getValue("out")).start(),_b.clear(0,0,0,0)},_y._endOut=function(_a){_a.getValue("out").end()},_y._recycleScope=function(_a){_a.recycle()},_y._filter=function(_a,_b,_c,_d){var _e=this._next;if(_e){var _f,_g,_h=_a.filters,_i=_h.length;if(1==_i&&32==_h[0].type)return _b.ctx.save(),_b.ctx.setFilters([_h[0]]),_e._fun.call(_e,_a,_b,_c,_d),void _b.ctx.restore();var _j=_ha.create(),_k=_A.TEMP,_l=_b.ctx._getTransformMatrix(),_m=_z.create();_l.copyTo(_m);var _n=0,_o=0,_p=!1,_q=_a._$P._filterCache?_a._$P._filterCache:null;if(!_q||_a._repaint){_p=_a._isHaveGlowFilter(),_j.addValue("_isHaveGlowFilter",_p),_p&&(_n=50,_o=25),(_g=new _B).copyFrom(_a.getSelfBounds()),_g.x+=_a.x,_g.y+=_a.y,_g.x-=_a.pivotX+4,_g.y-=_a.pivotY+4;var _r=_g.x,_s=_g.y;if(_g.width+=_n+8,_g.height+=_n+8,_k.x=_g.x*_m.a+_g.y*_m.c,_k.y=_g.y*_m.d+_g.x*_m.b,_g.x=_k.x,_g.y=_k.y,_k.x=_g.width*_m.a+_g.height*_m.c,_k.y=_g.height*_m.d+_g.width*_m.b,_g.width=_k.x,_g.height=_k.y,_g.width<=0||_g.height<=0)return;_q&&_q.recycle(),_j.addValue("bounds",_g);var _t=_ga.create([_j,_a,_b,0,0],_y._filterStart);_b.addRenderObject(_t),_b.ctx._renderKey=0,_b.ctx._shader2D.glTexture=null;var _u=_a.x-_r+_o,_v=_a.y-_s+_o;_e._fun.call(_e,_a,_b,_u,_v),_t=_ga.create([_j,_a,_b,0,0],_y._filterEnd),_b.addRenderObject(_t);for(var _w=0;_w<_i;_w++){0!=_w&&(_t=_ga.create([_j],_y._useSrc),_b.addRenderObject(_t),_f=_ya.create(1,0),_z.TEMP.identity(),_b.ctx.drawTarget(_j,0,0,_g.width,_g.height,_z.TEMP,"out",_f,null,_Q.TOINT.overlay),_t=_ga.create([_j],_y._useOut),_b.addRenderObject(_t)),_h[_w].action.apply3d(_j,_a,_b,0,0)}_t=_ga.create([_j,_b],_y._EndTarget),_b.addRenderObject(_t)}else{if((_p=!!_a._$P._isHaveGlowFilter&&_a._$P._isHaveGlowFilter)&&(_n=50,_o=25),(_g=_a.getBounds()).width<=0||_g.height<=0)return;_g.width+=_n,_g.height+=_n,_k.x=_g.x*_m.a+_g.y*_m.c,_k.y=_g.y*_m.d+_g.x*_m.b,_g.x=_k.x,_g.y=_k.y,_k.x=_g.width*_m.a+_g.height*_m.c,_k.y=_g.height*_m.d+_g.width*_m.b,_g.width=_k.x,_g.height=_k.y,_j.addValue("out",_q)}_c=_c-_o-_a.x,_d=_d-_o-_a.y,_k.setTo(_c,_d),_m.transformPoint(_k),_c=_k.x+_g.x,_d=_k.y+_g.y,_f=_ya.create(1,0),_z.TEMP.identity(),_b.ctx.drawTarget(_j,_c,_d,_g.width,_g.height,_z.TEMP,"out",_f,null,_Q.TOINT.overlay),_t=_ga.create([_j],_y._recycleScope),_b.addRenderObject(_t),_m.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=_g._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=_g._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=_g._uint8ArraySlice),!0},_g.onStageResize=function(_a,_b){null!=_g.mainContext&&(_g.mainContext.viewport(0,0,_a,_b),_sa.width=_a,_sa.height=_b)},_g.onInvalidGLRes=function(){_O.instance.freeAll(),_u.releaseContentManagers(!0),_g.doNodeRepaint(_w.stage),_g.mainContext.viewport(0,0,_sa.width,_sa.height),_w.stage.event("devicelost")},_g.doNodeRepaint=function(_a){0==_a.numChildren&&_a.repaint();for(var _b=0;_b<_a.numChildren;_b++)_g.doNodeRepaint(_a.getChildAt(_b))},_g.init=function(_a,_b,_c){_g.mainCanvas=_a,_j._createContext=function(_a){return new _xa(_a)},_Sa._createContext=function(_a){return new _xa(_a)};var _d=laya.webgl.WebGL.mainContext;if(null!=_d.getShaderPrecisionFormat){var _e=_d.getShaderPrecisionFormat(35633,36338),_f=_d.getShaderPrecisionFormat(35632,36338);_g.shaderHighPrecision=!(!_e.precision||!_f.precision)}else _g.shaderHighPrecision=!1;if(_g.compressAstc=_d.getExtension("WEBGL_compressed_texture_astc"),_g.compressAtc=_d.getExtension("WEBGL_compressed_texture_atc"),_g.compressEtc=_d.getExtension("WEBGL_compressed_texture_etc"),_g.compressEtc1=_d.getExtension("WEBGL_compressed_texture_etc1"),_g.compressPvrtc=_d.getExtension("WEBGL_compressed_texture_pvrtc"),_g.compressS3tc=_d.getExtension("WEBGL_compressed_texture_s3tc"),_g.compressS3tc_srgb=_d.getExtension("WEBGL_compressed_texture_s3tc_srgb"),_g.compressAstc=_g.compressAstc?_g.compressAstc:{},_g.compressAtc=_g.compressAtc?_g.compressAtc:{},_g.compressEtc=_g.compressEtc?_g.compressEtc:{},_g.compressEtc1=_g.compressEtc1?_g.compressEtc1:{},_g.compressPvrtc=_g.compressPvrtc?_g.compressPvrtc:{},_g.compressS3tc=_g.compressS3tc?_g.compressS3tc:{},_g.compressS3tc_srgb=_g.compressS3tc_srgb?_g.compressS3tc_srgb:{},_d.deleteTexture1=_d.deleteTexture,_d.deleteTexture=function(_a){_a==_va.curBindTexValue&&(_va.curBindTexValue=null),_d.deleteTexture1(_a)},_g.onStageResize(_b,_c),null==_g.mainContext)throw new Error("webGL getContext err!");_G.__init__(),_O.__init__(),_Ca.__init__(),_fa.__init__(),_xa.__init__(),_ya.__init__(),_$.__init__(),_Xa.__int__(_d),_Q._init_(_d),_r.isConchApp&&conch.setOnInvalidGLRes(_g.onInvalidGLRes)},_g.mainCanvas=null,_g.antialias=!0,_g.shaderHighPrecision=!1,_g._bg_null=[0,0,0,0],_g}(),_va=function(){function _d(){}return _m(_d,"laya.webgl.WebGLContext"),_d.UseProgram=function(_a){return _d._useProgram!==_a&&(_ua.mainContext.useProgram(_a),_d._useProgram=_a,!0)},_d.setDepthTest=function(_a,_b){_b!==_d._depthTest&&((_d._depthTest=_b)?_a.enable(2929):_a.disable(2929))},_d.setDepthMask=function(_a,_b){_b!==_d._depthMask&&(_d._depthMask=_b,_a.depthMask(_b))},_d.setDepthFunc=function(_a,_b){_b!==_d._depthFunc&&(_d._depthFunc=_b,_a.depthFunc(_b))},_d.setBlend=function(_a,_b){_b!==_d._blend&&((_d._blend=_b)?_a.enable(3042):_a.disable(3042))},_d.setBlendFunc=function(_a,_b,_c){(_b!==_d._sFactor||_c!==_d._dFactor)&&(_d._sFactor=_b,_d._dFactor=_c,_a.blendFunc(_b,_c))},_d.setCullFace=function(_a,_b){_b!==_d._cullFace&&((_d._cullFace=_b)?_a.enable(2884):_a.disable(2884))},_d.setFrontFace=function(_a,_b){_b!==_d._frontFace&&(_d._frontFace=_b,_a.frontFace(_b))},_d.bindTexture=function(_a,_b,_c){_a.bindTexture(_b,_c),_d.curBindTexTarget=_b,_d.curBindTexValue=_c},_d.DEPTH_BUFFER_BIT=256,_d.STENCIL_BUFFER_BIT=1024,_d.COLOR_BUFFER_BIT=16384,_d.POINTS=0,_d.LINES=1,_d.LINE_LOOP=2,_d.LINE_STRIP=3,_d.TRIANGLES=4,_d.TRIANGLE_STRIP=5,_d.TRIANGLE_FAN=6,_d.ZERO=0,_d.ONE=1,_d.SRC_COLOR=768,_d.ONE_MINUS_SRC_COLOR=769,_d.SRC_ALPHA=770,_d.ONE_MINUS_SRC_ALPHA=771,_d.DST_ALPHA=772,_d.ONE_MINUS_DST_ALPHA=773,_d.DST_COLOR=774,_d.ONE_MINUS_DST_COLOR=775,_d.SRC_ALPHA_SATURATE=776,_d.FUNC_ADD=32774,_d.BLEND_EQUATION=32777,_d.BLEND_EQUATION_RGB=32777,_d.BLEND_EQUATION_ALPHA=34877,_d.FUNC_SUBTRACT=32778,_d.FUNC_REVERSE_SUBTRACT=32779,_d.BLEND_DST_RGB=32968,_d.BLEND_SRC_RGB=32969,_d.BLEND_DST_ALPHA=32970,_d.BLEND_SRC_ALPHA=32971,_d.CONSTANT_COLOR=32769,_d.ONE_MINUS_CONSTANT_COLOR=32770,_d.CONSTANT_ALPHA=32771,_d.ONE_MINUS_CONSTANT_ALPHA=32772,_d.BLEND_COLOR=32773,_d.ARRAY_BUFFER=34962,_d.ELEMENT_ARRAY_BUFFER=34963,_d.ARRAY_BUFFER_BINDING=34964,_d.ELEMENT_ARRAY_BUFFER_BINDING=34965,_d.STREAM_DRAW=35040,_d.STATIC_DRAW=35044,_d.DYNAMIC_DRAW=35048,_d.BUFFER_SIZE=34660,_d.BUFFER_USAGE=34661,_d.CURRENT_VERTEX_ATTRIB=34342,_d.FRONT=1028,_d.BACK=1029,_d.CULL_FACE=2884,_d.FRONT_AND_BACK=1032,_d.BLEND=3042,_d.DITHER=3024,_d.STENCIL_TEST=2960,_d.DEPTH_TEST=2929,_d.SCISSOR_TEST=3089,_d.POLYGON_OFFSET_FILL=32823,_d.SAMPLE_ALPHA_TO_COVERAGE=32926,_d.SAMPLE_COVERAGE=32928,_d.NO_ERROR=0,_d.INVALID_ENUM=1280,_d.INVALID_VALUE=1281,_d.INVALID_OPERATION=1282,_d.OUT_OF_MEMORY=1285,_d.CW=2304,_d.CCW=2305,_d.LINE_WIDTH=2849,_d.ALIASED_POINT_SIZE_RANGE=33901,_d.ALIASED_LINE_WIDTH_RANGE=33902,_d.CULL_FACE_MODE=2885,_d.FRONT_FACE=2886,_d.DEPTH_RANGE=2928,_d.DEPTH_WRITEMASK=2930,_d.DEPTH_CLEAR_VALUE=2931,_d.DEPTH_FUNC=2932,_d.STENCIL_CLEAR_VALUE=2961,_d.STENCIL_FUNC=2962,_d.STENCIL_FAIL=2964,_d.STENCIL_PASS_DEPTH_FAIL=2965,_d.STENCIL_PASS_DEPTH_PASS=2966,_d.STENCIL_REF=2967,_d.STENCIL_VALUE_MASK=2963,_d.STENCIL_WRITEMASK=2968,_d.STENCIL_BACK_FUNC=34816,_d.STENCIL_BACK_FAIL=34817,_d.STENCIL_BACK_PASS_DEPTH_FAIL=34818,_d.STENCIL_BACK_PASS_DEPTH_PASS=34819,_d.STENCIL_BACK_REF=36003,_d.STENCIL_BACK_VALUE_MASK=36004,_d.STENCIL_BACK_WRITEMASK=36005,_d.VIEWPORT=2978,_d.SCISSOR_BOX=3088,_d.COLOR_CLEAR_VALUE=3106,_d.COLOR_WRITEMASK=3107,_d.UNPACK_ALIGNMENT=3317,_d.PACK_ALIGNMENT=3333,_d.MAX_TEXTURE_SIZE=3379,_d.MAX_VIEWPORT_DIMS=3386,_d.SUBPIXEL_BITS=3408,_d.RED_BITS=3410,_d.GREEN_BITS=3411,_d.BLUE_BITS=3412,_d.ALPHA_BITS=3413,_d.DEPTH_BITS=3414,_d.STENCIL_BITS=3415,_d.POLYGON_OFFSET_UNITS=10752,_d.POLYGON_OFFSET_FACTOR=32824,_d.TEXTURE_BINDING_2D=32873,_d.SAMPLE_BUFFERS=32936,_d.SAMPLES=32937,_d.SAMPLE_COVERAGE_VALUE=32938,_d.SAMPLE_COVERAGE_INVERT=32939,_d.NUM_COMPRESSED_TEXTURE_FORMATS=34466,_d.COMPRESSED_TEXTURE_FORMATS=34467,_d.DONT_CARE=4352,_d.FASTEST=4353,_d.NICEST=4354,_d.GENERATE_MIPMAP_HINT=33170,_d.BYTE=5120,_d.UNSIGNED_BYTE=5121,_d.SHORT=5122,_d.UNSIGNED_SHORT=5123,_d.INT=5124,_d.UNSIGNED_INT=5125,_d.FLOAT=5126,_d.DEPTH_COMPONENT=6402,_d.ALPHA=6406,_d.RGB=6407,_d.RGBA=6408,_d.LUMINANCE=6409,_d.LUMINANCE_ALPHA=6410,_d.UNSIGNED_SHORT_4_4_4_4=32819,_d.UNSIGNED_SHORT_5_5_5_1=32820,_d.UNSIGNED_SHORT_5_6_5=33635,_d.FRAGMENT_SHADER=35632,_d.VERTEX_SHADER=35633,_d.MAX_VERTEX_ATTRIBS=34921,_d.MAX_VERTEX_UNIFORM_VECTORS=36347,_d.MAX_VARYING_VECTORS=36348,_d.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,_d.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,_d.MAX_TEXTURE_IMAGE_UNITS=34930,_d.MAX_FRAGMENT_UNIFORM_VECTORS=36349,_d.SHADER_TYPE=35663,_d.DELETE_STATUS=35712,_d.LINK_STATUS=35714,_d.VALIDATE_STATUS=35715,_d.ATTACHED_SHADERS=35717,_d.ACTIVE_UNIFORMS=35718,_d.ACTIVE_ATTRIBUTES=35721,_d.SHADING_LANGUAGE_VERSION=35724,_d.CURRENT_PROGRAM=35725,_d.NEVER=512,_d.LESS=513,_d.EQUAL=514,_d.LEQUAL=515,_d.GREATER=516,_d.NOTEQUAL=517,_d.GEQUAL=518,_d.ALWAYS=519,_d.KEEP=7680,_d.REPLACE=7681,_d.INCR=7682,_d.DECR=7683,_d.INVERT=5386,_d.INCR_WRAP=34055,_d.DECR_WRAP=34056,_d.VENDOR=7936,_d.RENDERER=7937,_d.VERSION=7938,_d.NEAREST=9728,_d.LINEAR=9729,_d.NEAREST_MIPMAP_NEAREST=9984,_d.LINEAR_MIPMAP_NEAREST=9985,_d.NEAREST_MIPMAP_LINEAR=9986,_d.LINEAR_MIPMAP_LINEAR=9987,_d.TEXTURE_MAG_FILTER=10240,_d.TEXTURE_MIN_FILTER=10241,_d.TEXTURE_WRAP_S=10242,_d.TEXTURE_WRAP_T=10243,_d.TEXTURE_2D=3553,_d.TEXTURE=5890,_d.TEXTURE_CUBE_MAP=34067,_d.TEXTURE_BINDING_CUBE_MAP=34068,_d.TEXTURE_CUBE_MAP_POSITIVE_X=34069,_d.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,_d.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,_d.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,_d.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,_d.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,_d.MAX_CUBE_MAP_TEXTURE_SIZE=34076,_d.TEXTURE0=33984,_d.TEXTURE1=33985,_d.TEXTURE2=33986,_d.TEXTURE3=33987,_d.TEXTURE4=33988,_d.TEXTURE5=33989,_d.TEXTURE6=33990,_d.TEXTURE7=33991,_d.TEXTURE8=33992,_d.TEXTURE9=33993,_d.TEXTURE10=33994,_d.TEXTURE11=33995,_d.TEXTURE12=33996,_d.TEXTURE13=33997,_d.TEXTURE14=33998,_d.TEXTURE15=33999,_d.TEXTURE16=34e3,_d.TEXTURE17=34001,_d.TEXTURE18=34002,_d.TEXTURE19=34003,_d.TEXTURE20=34004,_d.TEXTURE21=34005,_d.TEXTURE22=34006,_d.TEXTURE23=34007,_d.TEXTURE24=34008,_d.TEXTURE25=34009,_d.TEXTURE26=34010,_d.TEXTURE27=34011,_d.TEXTURE28=34012,_d.TEXTURE29=34013,_d.TEXTURE30=34014,_d.TEXTURE31=34015,_d.ACTIVE_TEXTURE=34016,_d.REPEAT=10497,_d.CLAMP_TO_EDGE=33071,_d.MIRRORED_REPEAT=33648,_d.FLOAT_VEC2=35664,_d.FLOAT_VEC3=35665,_d.FLOAT_VEC4=35666,_d.INT_VEC2=35667,_d.INT_VEC3=35668,_d.INT_VEC4=35669,_d.BOOL=35670,_d.BOOL_VEC2=35671,_d.BOOL_VEC3=35672,_d.BOOL_VEC4=35673,_d.FLOAT_MAT2=35674,_d.FLOAT_MAT3=35675,_d.FLOAT_MAT4=35676,_d.SAMPLER_2D=35678,_d.SAMPLER_CUBE=35680,_d.VERTEX_ATTRIB_ARRAY_ENABLED=34338,_d.VERTEX_ATTRIB_ARRAY_SIZE=34339,_d.VERTEX_ATTRIB_ARRAY_STRIDE=34340,_d.VERTEX_ATTRIB_ARRAY_TYPE=34341,_d.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,_d.VERTEX_ATTRIB_ARRAY_POINTER=34373,_d.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,_d.COMPILE_STATUS=35713,_d.LOW_FLOAT=36336,_d.MEDIUM_FLOAT=36337,_d.HIGH_FLOAT=36338,_d.LOW_INT=36339,_d.MEDIUM_INT=36340,_d.HIGH_INT=36341,_d.FRAMEBUFFER=36160,_d.RENDERBUFFER=36161,_d.RGBA4=32854,_d.RGB5_A1=32855,_d.RGB565=36194,_d.DEPTH_COMPONENT16=33189,_d.STENCIL_INDEX=6401,_d.STENCIL_INDEX8=36168,_d.DEPTH_STENCIL=34041,_d.RENDERBUFFER_WIDTH=36162,_d.RENDERBUFFER_HEIGHT=36163,_d.RENDERBUFFER_INTERNAL_FORMAT=36164,_d.RENDERBUFFER_RED_SIZE=36176,_d.RENDERBUFFER_GREEN_SIZE=36177,_d.RENDERBUFFER_BLUE_SIZE=36178,_d.RENDERBUFFER_ALPHA_SIZE=36179,_d.RENDERBUFFER_DEPTH_SIZE=36180,_d.RENDERBUFFER_STENCIL_SIZE=36181,_d.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,_d.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,_d.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,_d.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,_d.COLOR_ATTACHMENT0=36064,_d.DEPTH_ATTACHMENT=36096,_d.STENCIL_ATTACHMENT=36128,_d.DEPTH_STENCIL_ATTACHMENT=33306,_d.NONE=0,_d.FRAMEBUFFER_COMPLETE=36053,_d.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,_d.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,_d.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,_d.FRAMEBUFFER_UNSUPPORTED=36061,_d.FRAMEBUFFER_BINDING=36006,_d.RENDERBUFFER_BINDING=36007,_d.MAX_RENDERBUFFER_SIZE=34024,_d.INVALID_FRAMEBUFFER_OPERATION=1286,_d.UNPACK_FLIP_Y_WEBGL=37440,_d.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,_d.CONTEXT_LOST_WEBGL=37442,_d.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,_d.BROWSER_DEFAULT_WEBGL=37444,_d._useProgram=null,_d._depthTest=!0,_d._depthMask=!0,_d._blend=!1,_d._cullFace=!1,_d.curBindTexTarget=null,_d.curBindTexValue=null,_g(_d,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),_d}(),_wa=function(_a){function _b(){_b.__super.call(this)}_m(_b,"laya.webgl.display.GraphicsGL",_h);var _c=_b.prototype;return _c.setShader=function(_a){this._saveToCmd(_r.context._setShader,[_a])},_c.setIBVB=function(_a,_b,_c,_d,_e,_f){this._saveToCmd(_r.context._setIBVB,[_a,_b,_c,_d,_e,_f])},_c.drawParticle=function(_a,_b,_c){var _d=_v.createParticleTemplate2D(_c);_d.x=_a,_d.y=_b,this._saveToCmd(_r.context._drawParticle,[_d])},_b}(),_xa=function(_a){var _c;function _N(_a){this._x=0,this._y=0,this._id=++_N._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,_N.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=_N.MAXCLIPRECT,this.mOutPoint,this._canvas=_a,this._canvas._addReference(),_N._contextcount++,_r.isFlash?(this._ib=_$a.create(35044),_qa.fillIBQuadrangle(this._ib,16)):this._ib=_$a.QuadrangleIB,this.clear()}_m(_N,"laya.webgl.canvas.WebGLContext2D",_e);var _b=_N.prototype;return _b.setIsMainContext=function(){this._isMain=!0},_b.clearBG=function(_a,_b,_c,_d){var _e=_ua.mainContext;_e.clearColor(_a,_b,_c,_d),_e.clear(16384)},_b._getSubmits=function(){return this._submits},_b._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var _a=0,_b=this._submits._length;_a<_b;_a++)this._submits[_a].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},_b.destroy=function(){--_N._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas&&this._canvas._removeReference(),this._canvas=null,this._ib&&this._ib!=_$a.QuadrangleIB&&this._ib.releaseResource()},_b.clear=function(){this._submits||(this._other=_c.DEFAULT,this._curMat=_z.create(),this._vb=__a.create(-1),this._submits=[],this._save=[_W.Create(this)],this._save.length=10,this._shader2D=new _$,this._triangleMesh=_Ia.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=_c.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=_N.MAXCLIPRECT,this._curSubmit=_fa.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=_R.DEFAULT;for(var _a=0,_b=this._submits._length;_a<_b;_a++)this._submits[_a].releaseRender(),this._submits[_a]=null;this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},_b.size=function(_a,_b){if(this._width!=_a||this._height!=_b)if(0==_a||0==_b){0!=this._vb._byteLength&&(this._width=_a,this._height=_b,this._vb.clear(),this._vb.upload());for(var _c=0,_d=this._submits._length;_c<_d;_c++)this._submits[_c].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=_a,this._height=_b,this._targets&&this._targets.size(_a,_b),this._canvas.memorySize-=this._canvas.memorySize;0===_a&&0===_b&&this._releaseMem()},_b._getTransformMatrix=function(){return this._curMat},_b.translate=function(_a,_b){0===_a&&0===_b||(_Y.save(this),this._curMat.bTransform&&(_X.save(this),this._curMat.transformPointN(_A.TEMP.setTo(_a,_b)),_a=_A.TEMP.x,_b=_A.TEMP.y),this._x+=_a,this._y+=_b)},_b.save=function(){this._save[this._save._length++]=_W.Create(this)},_b.restore=function(){var _a=this._save._length;if(!(_a<1))for(var _b=_a-1;0<=_b;_b--){var _c=this._save[_b];if(_c.restore(this),_c.isSaveMark())return void(this._save._length=_b)}},_b._fillText=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){void 0===_j&&(_j=0);var _k=this._shader2D,_l=this._curSubmit.shaderValue,_m=_e?_oa.create(_e):this._other.font;if(_O.enabled)_k.ALPHA!==_l.ALPHA&&(_k.glTexture=null),_na.drawText(this,_a,_b,this._curMat,_m,_i||this._other.textAlign,_f,_g,_h,_c,_d,_j);else{this._shader2D.defines.getValue();var _n=_f?_o.create(_f)._color:_k.colorAdd;_k.ALPHA===_l.ALPHA&&_n===_k.colorAdd&&_l.colorAdd===_k.colorAdd||(_k.glTexture=null,_k.colorAdd=_n),_na.drawText(this,_a,_b,this._curMat,_m,_i||this._other.textAlign,_f,_g,_h,_c,_d,_j)}},_b.fillWords=function(_a,_b,_c,_d,_e,_f){this._fillText(null,_a,_b,_c,_d,_e,null,-1,null,_f)},_b.fillBorderWords=function(_a,_b,_c,_d,_e,_f,_g){this._fillBorderText(null,_a,_b,_c,_d,_e,_f,_g,null)},_b.fillText=function(_a,_b,_c,_d,_e,_f){this._fillText(_a,null,_b,_c,_d,_e,null,-1,_f)},_b.strokeText=function(_a,_b,_c,_d,_e,_f,_g){this._fillText(_a,null,_b,_c,_d,null,_e,_f||1,_g)},_b.fillBorderText=function(_a,_b,_c,_d,_e,_f,_g,_h){this._fillBorderText(_a,null,_b,_c,_d,_e,_f,_g,_h)},_b._fillBorderText=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){if(!_O.enabled)return this._fillText(_a,_b,_c,_d,_e,null,_g,_h||1,_i),void this._fillText(_a,_b,_c,_d,_e,_f,null,-1,_i);var _j=this._shader2D,_k=this._curSubmit.shaderValue;_j.ALPHA!==_k.ALPHA&&(_j.glTexture=null);var _l=_e?(_N._fontTemp.setFont(_e),_N._fontTemp):this._other.font;_na.drawText(this,_a,_b,this._curMat,_l,_i||this._other.textAlign,_f,_g,_h||1,_c,_d,0)},_b.fillRect=function(_a,_b,_c,_d,_e){var _f=this._vb;if(_qa.fillRectImgVb(_f,this._clipRect,_a,_b,_c,_d,_I.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var _g=this._shader2D.fillStyle;_e&&(this._shader2D.fillStyle=_R.create(_e));var _h=this._shader2D,_i=this._curSubmit.shaderValue;if(_h.fillStyle!==_i.fillStyle||_h.ALPHA!==_i.ALPHA){_h.glTexture=null;var _j=this._curSubmit=_fa.createSubmit(this,this._ib,_f,(_f._byteLength-64)/32*3,_ya.create(2,0));_j.shaderValue.color=_h.fillStyle._color._color,_j.shaderValue.ALPHA=_h.ALPHA,this._submits[this._submits._length++]=_j}this._curSubmit._numEle+=6,this._shader2D.fillStyle=_g}},_b.fillTexture=function(_a,_b,_c,_d,_e,_f,_g,_h){if(_a.loaded&&_a.bitmap&&_a.source){var _i=this._vb,_j=_a.bitmap.width,_k=_a.bitmap.height,_l=_a.uv,_m=_g.x%_a.width,_n=_g.y%_a.height;if(_j!=_h.w||_k!=_h.h){if(!_h.w&&!_h.h)switch(_h.oy=_h.ox=0,_f){case"repeat":_h.width=_d,_h.height=_e;break;case"repeat-x":_h.width=_d,_n<0?_a.height+_n>_e?_h.height=_e:_h.height=_a.height+_n:(_h.oy=_n,_a.height+_n>_e?_h.height=_e-_n:_h.height=_a.height);break;case"repeat-y":_m<0?_a.width+_m>_d?_h.width=_d:_h.width=_a.width+_m:(_h.ox=_m,_a.width+_m>_d?_h.width=_d-_m:_h.width=_a.width),_h.height=_e;break;case"no-repeat":_m<0?_a.width+_m>_d?_h.width=_d:_h.width=_a.width+_m:(_h.ox=_m,_a.width+_m>_d?_h.width=_d-_m:_h.width=_a.width),_n<0?_a.height+_n>_e?_h.height=_e:_h.height=_a.height+_n:(_h.oy=_n,_a.height+_n>_e?_h.height=_e-_n:_h.height=_a.height);break;default:_h.width=_d,_h.height=_e}_h.w=_j,_h.h=_k,_h.uv=[0,0,_h.width/_j,0,_h.width/_j,_h.height/_k,0,_h.height/_k]}if(_b+=_h.ox,_c+=_h.oy,_m-=_h.ox,_n-=_h.oy,_qa.fillRectImgVb(_i,this._clipRect,_b,_c,_h.width,_h.height,_h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var _o=_Ha.create(this,this._ib,_i,(_i._byteLength-64)/32*3,_ya.create(256,0)),_p=(this._submits[this._submits._length++]=_o).shaderValue;_p.textureHost=_a;var _q=_l[0]*_j,_r=_l[1]*_k,_s=(_l[2]-_l[0])*_j,_t=(_l[5]-_l[3])*_k,_u=-_m/_j,_v=-_n/_k;_p.u_TexRange[0]=_q/_j,_p.u_TexRange[1]=_s/_j,_p.u_TexRange[2]=_r/_k,_p.u_TexRange[3]=_t/_k,_p.u_offset[0]=_u,_p.u_offset[1]=_v,_O.enabled&&!this._isMain&&_o.addTexture(_a,(_i._byteLength>>2)-16),(this._curSubmit=_o)._renderType=10017,_o._numEle+=6}}else this.sprite&&_w.timer.callLater(this,this._repaintSprite)},_b.setShader=function(_a){_T.save(this,1048576,this._shader2D,!0),this._shader2D.shader=_a},_b.setFilters=function(_a){_T.save(this,2097152,this._shader2D,!0),this._shader2D.filters=_a,this._curSubmit=_fa.RENDERBASE,this._renderKey=0,this._drawCount++},_b.drawTexture=function(_a,_b,_c,_d,_e,_f,_g){this._drawTextureM(_a,_b,_c,_d,_e,_f,_g,null,1)},_b.addTextureVb=function(_a,_b,_c){var _d=this._curSubmit._vb||this._vb,_e=_d._byteLength>>2;_d.byteLength=_e+16<<2;for(var _f=_d.getFloat32Array(),_g=0;_g<16;_g+=4)_f[_e++]=_a[_g]+_b,_f[_e++]=_a[_g+1]+_c,_f[_e++]=_a[_g+2],_f[_e++]=_a[_g+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),_d._upload=!0},_b.willDrawTexture=function(_a,_b){if(!(_a.loaded&&_a.bitmap&&_a.source))return this.sprite&&_w.timer.callLater(this,this._repaintSprite),0;var _c=_a.bitmap,_d=_c.id+this._shader2D.ALPHA*_b+10016;if(_d==this._renderKey)return _d;var _e=this._shader2D,_f=_e.ALPHA,_g=this._curSubmit.shaderValue;_e.ALPHA*=_b,this._renderKey=_d,this._drawCount++,_e.glTexture=_c;var _h=this._vb,_i=null,_j=_h._byteLength/32*3,_k=_g.textureHost&&_g.textureHost==_a&&_g.textureHost.alphaTexture==_a.alphaTexture;return _i=_Ha.create(this,this._ib,_h,_j,_ya.create(1,0)),(this._submits[this._submits._length++]=_i).shaderValue.textureHost=_a,_i._renderType=10016,_i._preIsSameTextureShader=10016===this._curSubmit._renderType&&_e.ALPHA===_g.ALPHA&&_k,this._curSubmit=_i,_e.ALPHA=_f,_d},_b.drawTextures=function(_a,_b,_c,_d){if(_a.loaded&&_a.bitmap&&_a.source){var _e=this._clipRect;if(this._clipRect=_N.MAXCLIPRECT,this._drawTextureM(_a,_b[0],_b[1],_a.width,_a.height,_c,_d,null,1)){if(this._clipRect=_e,_E.drawCall++,!(_b.length<4)){for(var _f=this._curSubmit._vb||this._vb,_g=this._curMat.a,_h=this._curMat.d,_i=2,_j=_b.length;_i<_j;_i+=2)_qa.copyPreImgVb(_f,(_b[_i]-_b[_i-2])*_g,(_b[_i+1]-_b[_i-1])*_h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&_w.timer.callLater(this,this._repaintSprite)},_b._drawTextureM=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){if(!_a.loaded||!_a.source)return this.sprite&&_w.timer.callLater(this,this._repaintSprite),!1;var _j=this._curSubmit._vb||this._vb,_k=_a.bitmap;_b+=_f,_c+=_g,this._drawCount++;var _l=_k.id+this._shader2D.ALPHA*_i+10016;if(_l!=this._renderKey){this._renderKey=_l;var _m=this._curSubmit.shaderValue,_n=this._shader2D,_o=_n.ALPHA;_n.ALPHA*=_i,_n.glTexture=_k;var _p=this._vb,_q=null,_r=_p._byteLength/32*3,_s=_m.textureHost&&_m.textureHost==_a&&_m.textureHost.alphaTexture==_a.alphaTexture;_q=_Ha.create(this,this._ib,_p,_r,_ya.create(1,0)),(this._submits[this._submits._length++]=_q).shaderValue.textureHost=_a,_q._renderType=10016,_q._preIsSameTextureShader=10016===this._curSubmit._renderType&&_n.ALPHA===_m.ALPHA&&_s,this._curSubmit=_q,_j=this._curSubmit._vb||this._vb,_n.ALPHA=_o}return!!_qa.fillRectImgVb(_j,this._clipRect,_b,_c,_d||_a.width,_e||_a.height,_a.uv,_h||this._curMat,this._x,this._y,0,0)&&(_O.enabled&&!this._isMain&&this._curSubmit.addTexture(_a,(_j._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},_b._repaintSprite=function(){this.sprite&&this.sprite.repaint()},_b._drawText=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){var _k=_a.bitmap;this._drawCount++;var _l=_k.id+this._shader2D.ALPHA+10016;if(_l!=this._renderKey){this._renderKey=_l;var _m=this._curSubmit.shaderValue,_n=this._shader2D;_n.glTexture=_k;var _o=this._vb,_p=null,_q=_o._byteLength/32*3,_r=_m.textureHost&&_m.textureHost==_a&&_m.textureHost.alphaTexture==_a.alphaTexture;(_p=_O.enabled?_Ha.create(this,this._ib,_o,_q,_ya.create(1,0)):_Ha.create(this,this._ib,_o,_q,_Ya.create()))._preIsSameTextureShader=10016===this._curSubmit._renderType&&_n.ALPHA===_m.ALPHA&&_r,(this._submits[this._submits._length++]=_p).shaderValue.textureHost=_a,_p._renderType=10016,this._curSubmit=_p}_a.active();var _s=this._curSubmit._vb||this._vb;_qa.fillRectImgVb(_s,this._clipRect,_b+_g,_c+_h,_d||_a.width,_e||_a.height,_a.uv,_f||this._curMat,this._x,this._y,_i,_j,!0)&&(_O.enabled&&!this._isMain&&this._curSubmit.addTexture(_a,(_s._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},_b.drawTextureWithTransform=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){if(_f){var _j=this._curMat,_k=this._x,_l=this._y;(0!==_g||0!==_h)&&(this._x=_g*_j.a+_h*_j.c,this._y=_h*_j.d+_g*_j.b),_f&&_j.bTransform?(_z.mul(_f,_j,_N._tmpMatrix),(_f=_N._tmpMatrix)._checkTransform()):(this._x+=_j.tx,this._y+=_j.ty),this._drawTextureM(_a,_b,_c,_d,_e,0,0,_f,_i),this._x=_k,this._y=_l}else this._drawTextureM(_a,_b,_c,_d,_e,_g,_h,null,_i)},_b.fillQuadrangle=function(_a,_b,_c,_d,_e){var _f=this._curSubmit,_g=this._vb,_h=this._shader2D,_i=_f.shaderValue;if(this._renderKey=0,_a.bitmap){var _j=_a.bitmap;_h.glTexture==_j&&_h.ALPHA===_i.ALPHA||(_h.glTexture=_j,(_f=this._curSubmit=_fa.createSubmit(this,this._ib,_g,_g._byteLength/32*3,_ya.create(1,0))).shaderValue.glTexture=_j,this._submits[this._submits._length++]=_f),_qa.fillQuadrangleImgVb(_g,_b,_c,_d,_a.uv,_e||this._curMat,this._x,this._y)}else _f.shaderValue.fillStyle&&_f.shaderValue.fillStyle.equal(_a)&&_h.ALPHA===_i.ALPHA||(_h.glTexture=null,(_f=this._curSubmit=_fa.createSubmit(this,this._ib,_g,_g._byteLength/32*3,_ya.create(2,0))).shaderValue.defines.add(2),_f.shaderValue.fillStyle=_R.create(_a),this._submits[this._submits._length++]=_f),_qa.fillQuadrangleImgVb(_g,_b,_c,_d,_I.DEF_UV,_e||this._curMat,this._x,this._y);_f._numEle+=6},_b.drawTexture2=function(_a,_b,_c,_d,_e,_f,_g,_h){if(0!=_f){var _i=this._curMat;if(this._x=_a*_i.a+_b*_i.c,this._y=_b*_i.d+_a*_i.b,_e&&(_e=_i.bTransform||_e.bTransform?(_z.mul(_e,_i,_N._tmpMatrix),_N._tmpMatrix):(this._x+=_e.tx+_i.tx,this._y+=_e.ty+_i.ty,_z.EMPTY)),1!==_f||_g){var _j=this._shader2D.ALPHA,_k=this._nBlendType;this._shader2D.ALPHA=_f,_g&&(this._nBlendType=_Q.TOINT(_g)),this._drawTextureM(_h[0],_h[1]-_c,_h[2]-_d,_h[3],_h[4],0,0,_e,1),this._shader2D.ALPHA=_j,this._nBlendType=_k}else this._drawTextureM(_h[0],_h[1]-_c,_h[2]-_d,_h[3],_h[4],0,0,_e,1);this._x=this._y=0}},_b.drawCanvas=function(_a,_b,_c,_d,_e){var _f=_a.context;if(this._renderKey=0,_f._targets)this._submits[this._submits._length++]=_Ga.create(_f,0,null),this._curSubmit=_fa.RENDERBASE,_f._targets.drawTo(this,_b,_c,_d,_e);else{var _g=this._submits[this._submits._length++]=_Ga.create(_f,this._shader2D.ALPHA,this._shader2D.filters),_h=_d/_a.width,_i=_e/_a.height,_j=_g._matrix;this._curMat.copyTo(_j),1!=_h&&1!=_i&&_j.scale(_h,_i);var _k=_j.tx,_l=_j.ty;_j.tx=_j.ty=0,_j.transformPoint(_A.TEMP.setTo(_b,_c)),_j.translate(_A.TEMP.x+_k,_A.TEMP.y+_l),this._curSubmit=_fa.RENDERBASE}_x.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=_f._targets?"yellow":"green",this.strokeRect(_b-1,_c-1,_d+2,_e+2,1),this.strokeRect(_b,_c,_d,_e,1),this.restore())},_b.drawTarget=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){void 0===_j&&(_j=-1);var _k=this._vb;if(_qa.fillRectImgVb(_k,this._clipRect,_b,_c,_d,_e,_i||_I.DEF_UV,_f||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var _l=this._curSubmit=_la.create(this,this._ib,_k,(_k._byteLength-64)/32*3,_h,_g);_l.blendType=-1==_j?this._nBlendType:_j,_l.scope=_a,this._submits[this._submits._length++]=_l,this._curSubmit._numEle+=6}},_b.mixRGBandAlpha=function(_a){return this._mixRGBandAlpha(_a,this._shader2D.ALPHA)},_b._mixRGBandAlpha=function(_a,_b){var _c=(4278190080&_a)>>>24;return 0!=_c?_c*=_b:_c=255*_b,16777215&_a|_c<<24},_b.drawTriangles=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){if(!_a.loaded||!_a.source)return this.sprite&&_w.timer.callLater(this,this._repaintSprite),!1;this._drawCount++;_a.bitmap;var _k=this._mixRGBandAlpha(4294967295,_h),_l=(_d.length,_f.length);this._renderKey=-1;var _m=this._curSubmit=_Ha.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,_ya.create(1,0));return _m.shaderValue.textureHost=_a,_m._renderType=10016,this._submits[this._submits._length++]=_m,_g?(_N._tmpMatrix.a=_g.a,_N._tmpMatrix.b=_g.b,_N._tmpMatrix.c=_g.c,_N._tmpMatrix.d=_g.d,_N._tmpMatrix.tx=_g.tx+_b,_N._tmpMatrix.ty=_g.ty+_c,_z.mul(_N._tmpMatrix,this._curMat,_N._tmpMatrix)):(_N._tmpMatrix.a=this._curMat.a,_N._tmpMatrix.b=this._curMat.b,_N._tmpMatrix.c=this._curMat.c,_N._tmpMatrix.d=this._curMat.d,_N._tmpMatrix.tx=this._curMat.tx+_b,_N._tmpMatrix.ty=this._curMat.ty+_c),this._triangleMesh.addData(_d,_e,_f,_N._tmpMatrix,_k,this),this._curSubmit._numEle+=_l,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},_b.transform=function(_a,_b,_c,_d,_e,_f){_X.save(this),_z.mul(_z.TEMP.setTo(_a,_b,_c,_d,_e,_f),this._curMat,this._curMat),this._curMat._checkTransform()},_b.setTransformByMatrix=function(_a){_a.copyTo(this._curMat)},_b.transformByMatrix=function(_a){_X.save(this),_z.mul(_a,this._curMat,this._curMat),this._curMat._checkTransform()},_b.rotate=function(_a){_X.save(this),this._curMat.rotateEx(_a)},_b.scale=function(_a,_b){_X.save(this),this._curMat.scaleEx(_a,_b)},_b.clipRect=function(_a,_b,_c,_d){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var _e=_ka.create(4);this.addRenderObject(_e);var _f=this._vb,_g=_f._byteLength>>2;if(_qa.fillRectImgVb(_f,null,_a,_b,_c,_d,_I.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var _h=this._curSubmit=_fa.createSubmit(this,this._ib,_f,(_f._byteLength-64)/32*3,_ya.create(2,0));_h.shaderValue.ALPHA=1,this._submits[this._submits._length++]=_h,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var _i=_ka.create(5);this.addRenderObject(_i);var _j=_f.getFloat32Array(),_k=Math.min(Math.min(Math.min(_j[0+_g],_j[4+_g]),_j[8+_g]),_j[12+_g]),_l=Math.max(Math.max(Math.max(_j[0+_g],_j[4+_g]),_j[8+_g]),_j[12+_g]),_m=Math.min(Math.min(Math.min(_j[1+_g],_j[5+_g]),_j[9+_g]),_j[13+_g]),_n=Math.max(Math.max(Math.max(_j[1+_g],_j[5+_g]),_j[9+_g]),_j[13+_g]);_V.save(this,_i,_a,_b,_c,_d,_k,_m,_l-_k,_n-_m),this._curSubmit=_fa.RENDERBASE}else{_c*=this._curMat.a,_d*=this._curMat.d;var _o=_A.TEMP;this._curMat.transformPoint(_o.setTo(_a,_b)),_c<0&&(_o.x=_o.x+_c,_c=-_c),_d<0&&(_o.y=_o.y+_d,_d=-_d),this._renderKey=0;var _p=this._curSubmit=_ja.create(this);(this._submits[this._submits._length++]=_p).submitIndex=this._submits._length,_p.submitLength=9999999,_U.save(this,_p);var _q=this._clipRect,_r=_q.x,_s=_q.y,_t=_o.x+_c,_u=_o.y+_d;_r<_o.x&&(_q.x=_o.x),_s<_o.y&&(_q.y=_o.y),_q.width=Math.min(_t,_r+_q.width)-_q.x,_q.height=Math.min(_u,_s+_q.height)-_q.y,this._shader2D.glTexture=null,_p.clipRect.copyFrom(_q),this._curSubmit=_fa.RENDERBASE}},_b.setIBVB=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k){if(void 0===_i&&(_i=0),void 0===_j&&(_j=0),void 0===_k&&(_k=0),null===_c){if(_r.isFlash){var _l=_d;_l._selfIB||(_l._selfIB=_$a.create(35044)),_l._selfIB.clear(),_c=_l._selfIB}else _c=this._ib;_qa.expandIBQuadrangle(_c,_d._byteLength/(4*_d.vertexStride*4))}if(!_h||!_g)throw Error("setIBVB must input:shader shaderValues");var _m=_ia.create(this,_d,_c,_e,_g,_h,_i,_j,_k);_f||(_f=_z.EMPTY),_f.translate(_a,_b),_z.mul(_f,this._curMat,_m._mat),_f.translate(-_a,-_b),this._submits[this._submits._length++]=_m,this._curSubmit=_fa.RENDERBASE,this._renderKey=0},_b.addRenderObject=function(_a){this._submits[this._submits._length++]=_a},_b.fillTrangles=function(_a,_b,_c,_d,_e){var _f=this._curSubmit,_g=this._vb,_h=this._shader2D,_i=_f.shaderValue,_j=_d.length>>4,_k=_a.bitmap;this._renderKey=0,_h.glTexture==_k&&_h.ALPHA===_i.ALPHA||((_f=this._curSubmit=_fa.createSubmit(this,this._ib,_g,_g._byteLength/32*3,_ya.create(1,0))).shaderValue.textureHost=_a,this._submits[this._submits._length++]=_f),_qa.fillTranglesVB(_g,_b,_c,_d,_e||this._curMat,this._x,this._y),_f._numEle+=6*_j},_b.submitElement=function(_a,_b){var _c=this._submits;for(_b<0&&(_b=_c._length);_a<_b;)_a+=_c[_a].renderSubmit()},_b.finish=function(){_ua.mainContext.finish()},_b.flush=function(){var _a=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(_a>this._ib.bufferLength/12&&_qa.expandIBQuadrangle(this._ib,_a),!this._isMain&&_O.enabled&&_O._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=_O._atlasRestore;for(var _b=this._submits,_c=0,_d=_b._length;_c<_d;_c++){var _e=_b[_c];10016===_e.getRenderType()&&_e.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),_ba.instance&&_ba.getInstance().reset();var _f;for(_c=0,_f=this.meshlist.length;_c<_f;_c++){var _g=this.meshlist[_c];_g.canReuse?_g.releaseMesh():_g.destroy()}return this.meshlist.length=0,this._curSubmit=_fa.RENDERBASE,this._renderKey=0,this._triangleMesh=_Ia.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},_b.setPathId=function(_a){if(this.mId=_a,-1!=this.mId){this.mHaveKey=!1;var _b=_K.getInstance();_b.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,_b.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},_b.movePath=function(_a,_b){var _c=_a,_d=_b;_a=this._curMat.a*_c+this._curMat.c*_d+this._curMat.tx,_b=this._curMat.b*_c+this._curMat.d*_d+this._curMat.ty,this.mX+=_a,this.mY+=_b},_b.beginPath=function(){var _a=this._getPath();_a.tempArray.length=0,_a.closePath=!1,this.mX=0,this.mY=0},_b.closePath=function(){this._path.closePath=!0},_b.fill=function(_a){void 0===_a&&(_a=!1);var _b=this._getPath();this.drawPoly(0,0,_b.tempArray,this.fillStyle._color.numColor,0,0,_a)},_b.stroke=function(){var _a=this._getPath();if(0<this.lineWidth){if(-1==this.mId)_a.drawLine(0,0,_a.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var _b=_K.getInstance().shapeLineDic[this.mId];_b.rebuild(_a.tempArray),_a.setGeomtry(_b)}else _K.getInstance().addLine(this.mId,_a.drawLine(0,0,_a.tempArray,this.lineWidth,this.strokeStyle._color.numColor));_a.update();var _c=[this.mX,this.mY],_d=_fa.createShape(this,_a.ib,_a.vb,_a.count,_a.offset,_ya.create(4,0));_d.shaderValue.ALPHA=this._shader2D.ALPHA,_d.shaderValue.u_pos=_c,_d.shaderValue.u_mmat2=_sa.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=_d,this._renderKey=-1}},_b.line=function(_a,_b,_c,_d,_e,_f){var _g=this._curSubmit,_h=this._vb;if(_qa.fillLineVb(_h,this._clipRect,_a,_b,_c,_d,_e,_f)){this._renderKey=0;var _i=this._shader2D,_j=_g.shaderValue;_i.strokeStyle===_j.strokeStyle&&_i.ALPHA===_j.ALPHA||(_i.glTexture=null,(_g=this._curSubmit=_fa.createSubmit(this,this._ib,_h,(_h._byteLength-64)/32*3,_ya.create(2,0))).shaderValue.strokeStyle=_i.strokeStyle,_g.shaderValue.mainID=2,_g.shaderValue.ALPHA=_i.ALPHA,this._submits[this._submits._length++]=_g),_g._numEle+=6}},_b.moveTo=function(_a,_b,_c){void 0===_c&&(_c=!0);var _d=this._getPath();if(_c){var _e=_a,_f=_b;_a=this._curMat.a*_e+this._curMat.c*_f,_b=this._curMat.b*_e+this._curMat.d*_f}_d.addPoint(_a,_b)},_b.lineTo=function(_a,_b,_c){void 0===_c&&(_c=!0);var _d=this._getPath();if(_c){var _e=_a,_f=_b;_a=this._curMat.a*_e+this._curMat.c*_f,_b=this._curMat.b*_e+this._curMat.d*_f}_d.addPoint(_a,_b)},_b.drawCurves=function(_a,_b,_c){this.setPathId(-1),this.beginPath(),this.strokeStyle=_c[3],this.lineWidth=_c[4];var _d=_c[2];_a+=_c[0],_b+=_c[1],this.movePath(_a,_b),this.moveTo(_d[0],_d[1]);for(var _e=2,_f=_d.length;_e<_f;)this.quadraticCurveTo(_d[_e++],_d[_e++],_d[_e++],_d[_e++]);this.stroke()},_b.arcTo=function(_a,_b,_c,_d,_e){if(-1==this.mId||!this.mHaveKey){var _f=0,_g=0,_h=0,_i=this._getPath();this._curMat.copyTo(_N._tmpMatrix),_N._tmpMatrix.tx=_N._tmpMatrix.ty=0,_N._tempPoint.setTo(_i.getEndPointX(),_i.getEndPointY()),_N._tmpMatrix.invertTransformPoint(_N._tempPoint);var _j=_N._tempPoint.x-_a,_k=_N._tempPoint.y-_b,_l=Math.sqrt(_j*_j+_k*_k);if(!(_l<=1e-6)){var _m=_j/_l,_n=_k/_l,_o=_c-_a,_p=_d-_b,_q=_o*_o+_p*_p,_r=Math.sqrt(_q);if(!(_r<=1e-6)){var _s=_o/_r,_t=_p/_r,_u=_m+_s,_v=_n+_t,_w=Math.sqrt(_u*_u+_v*_v);if(!(_w<=1e-6)){var _x=_u/_w,_y=_v/_w,_z=Math.acos(_x*_m+_y*_n),_A=Math.PI/2-_z,_B=(_l=_e/Math.tan(_A))*_m+_a,_C=_l*_n+_b,_D=Math.sqrt(_l*_l+_e*_e),_E=_a+_x*_D,_F=_b+_y*_D,_G=0,_H=0;if(0<=_m*_t-_n*_s){var _I=2*_A/_N.SEGNUM;_G=Math.sin(_I),_H=Math.cos(_I)}else _I=2*-_A/_N.SEGNUM,_G=Math.sin(_I),_H=Math.cos(_I);_g=this._curMat.a*_B+this._curMat.c*_C,_h=this._curMat.b*_B+this._curMat.d*_C,_g==this._path.getEndPointX()&&_h==this._path.getEndPointY()||_i.addPoint(_g,_h);var _J=_B-_E,_K=_C-_F;for(_f=0;_f<_N.SEGNUM;_f++){var _L=_J*_H+_K*_G,_M=-_J*_G+_K*_H;_g=_L+_E,_h=_M+_F,_a=this._curMat.a*_g+this._curMat.c*_h,_h=_b=this._curMat.b*_g+this._curMat.d*_h,(_g=_a)==this._path.getEndPointX()&&_h==this._path.getEndPointY()||_i.addPoint(_g,_h),_J=_L,_K=_M}}}}}},_b.arc=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_f&&(_f=!1),void 0===_g&&(_g=!0),-1!=this.mId){var _h=_K.getInstance().shapeDic[this.mId];if(_h&&this.mHaveKey&&!_h.needUpdate(this._curMat))return;_b=_a=0}var _i,_j=0,_k=0,_l=0,_m=0,_n=0,_o=0,_p=0;if(_k=_e-_d,_f)if(Math.abs(_k)>=2*Math.PI)_k=2*-Math.PI;else for(;0<_k;)_k-=2*Math.PI;else if(Math.abs(_k)>=2*Math.PI)_k=2*Math.PI;else for(;_k<0;)_k+=2*Math.PI;_i=_k/(_p=_c<101?Math.max(10,_k*_c/5):_c<201?Math.max(10,_k*_c/20):Math.max(10,_k*_c/40))/2,_l=Math.abs(4/3*(1-Math.cos(_i))/Math.sin(_i)),_f&&(_l=-_l);var _q=this._getPath(),_r=NaN,_s=NaN;for(_o=0;_o<=_p;_o++)_j=_d+_k*(_o/_p),_m=_a+Math.cos(_j)*_c,_n=_b+Math.sin(_j)*_c,_g&&(_r=_m,_s=_n,_m=this._curMat.a*_r+this._curMat.c*_s,_n=this._curMat.b*_r+this._curMat.d*_s),_m==this._path.getEndPointX()&&_n==this._path.getEndPointY()||_q.addPoint(_m,_n);_m=_a+Math.cos(_e)*_c,_n=_b+Math.sin(_e)*_c,_g&&(_r=_m,_s=_n,_m=this._curMat.a*_r+this._curMat.c*_s,_n=this._curMat.b*_r+this._curMat.d*_s),_m==this._path.getEndPointX()&&_n==this._path.getEndPointY()||_q.addPoint(_m,_n)},_b.quadraticCurveTo=function(_a,_b,_c,_d){var _e=_l.I,_f=_c,_g=_d;_c=this._curMat.a*_f+this._curMat.c*_g,_d=this._curMat.b*_f+this._curMat.d*_g,_f=_a,_g=_b,_a=this._curMat.a*_f+this._curMat.c*_g,_b=this._curMat.b*_f+this._curMat.d*_g;for(var _h=_e.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),_a,_b,_c,_d],30,2),_i=0,_j=_h.length/2;_i<_j;_i++)this.lineTo(_h[2*_i],_h[2*_i+1],!1);this.lineTo(_c,_d,!1)},_b.rect=function(_a,_b,_c,_d){this._other=this._other.make(),this._other.path||(this._other.path=new _S),this._other.path.rect(_a,_b,_c,_d)},_b.strokeRect=function(_a,_b,_c,_d,_e){var _f=.5*_e;this.line(_a-_f,_b,_a+_c+_f,_b,_e,this._curMat),this.line(_a+_c,_b,_a+_c,_b+_d,_e,this._curMat),this.line(_a,_b,_a,_b+_d,_e,this._curMat),this.line(_a-_f,_b+_d,_a+_c+_f,_b+_d,_e,this._curMat)},_b.clip=function(){},_b.drawPoly=function(_a,_b,_c,_d,_e,_f,_g){void 0===_g&&(_g=!1),this._renderKey=0,this._shader2D.glTexture=null;var _h=this._getPath();if(-1==this.mId)_h.polygon(_a,_b,_c,_d,_e||1,_f);else if(this.mHaveKey){var _i=_K.getInstance().shapeDic[this.mId];_i.setMatrix(this._curMat),_i.rebuild(_h.tempArray),_h.setGeomtry(_i)}else{var _j=_h.polygon(_a,_b,_c,_d,_e||1,_f);_K.getInstance().addShape(this.mId,_j),_j.setMatrix(this._curMat)}_h.update();var _k,_l=[this.mX,this.mY];if((_k=_fa.createShape(this,_h.ib,_h.vb,_h.count,_h.offset,_ya.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,_k.shaderValue.u_pos=_l,_k.shaderValue.u_mmat2=_sa.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=_k,0<_e){if(this.mHaveLineKey){var _m=_K.getInstance().shapeLineDic[this.mId];_m.rebuild(_h.tempArray),_h.setGeomtry(_m)}else _K.getInstance().addShape(this.mId,_h.drawLine(_a,_b,_c,_e,_f));_h.update(),(_k=_fa.createShape(this,_h.ib,_h.vb,_h.count,_h.offset,_ya.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,_k.shaderValue.u_mmat2=_sa.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=_k}},_b.drawParticle=function(_a,_b,_c){_c.x=_a,_c.y=_b,this._submits[this._submits._length++]=_c},_b._getPath=function(){return this._path||(this._path=new _S)},_d(0,_b,"globalCompositeOperation",function(){return _Q.NAMES[this._nBlendType]},function(_a){var _b=_Q.TOINT[_a];null==_b||this._nBlendType===_b||(_T.save(this,65536,this,!0),this._curSubmit=_fa.RENDERBASE,this._renderKey=0,this._nBlendType=_b)}),_d(0,_b,"strokeStyle",function(){return this._shader2D.strokeStyle},function(_a){this._shader2D.strokeStyle.equal(_a)||(_T.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=_R.create(_a))}),_d(0,_b,"globalAlpha",function(){return this._shader2D.ALPHA},function(_a){(_a=Math.floor(1e3*_a)/1e3)!=this._shader2D.ALPHA&&(_T.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=_a)}),_d(0,_b,"asBitmap",null,function(_a){if(_a){if(this._targets||(this._targets=new _Z),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),_d(0,_b,"fillStyle",function(){return this._shader2D.fillStyle},function(_a){this._shader2D.fillStyle.equal(_a)||(_T.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=_R.create(_a))}),_d(0,_b,"textAlign",function(){return this._other.textAlign},function(_a){this._other.textAlign===_a||(this._other=this._other.make(),_T.save(this,32768,this._other,!1),this._other.textAlign=_a)}),_d(0,_b,"lineWidth",function(){return this._other.lineWidth},function(_a){this._other.lineWidth===_a||(this._other=this._other.make(),_T.save(this,256,this._other,!1),this._other.lineWidth=_a)}),_d(0,_b,"textBaseline",function(){return this._other.textBaseline},function(_a){this._other.textBaseline===_a||(this._other=this._other.make(),_T.save(this,16384,this._other,!1),this._other.textBaseline=_a)}),_d(0,_b,"font",null,function(_a){_a!=this._other.font.toString()&&(this._other=this._other.make(),_T.save(this,8,this._other,!1),this._other.font===_oa.EMPTY?this._other.font=new _oa(_a):this._other.font.setFont(_a))}),_N.__init__=function(){_c.DEFAULT=new _c},_N._tempPoint=new _A,_N._SUBMITVBSIZE=32e3,_N._MAXSIZE=99999999,_N._RECTVBSIZE=16,_N.MAXCLIPRECT=new _B(0,0,99999999,99999999),_N._COUNT=0,_N._tmpMatrix=new _z,_N.SEGNUM=32,_N._contextcount=0,_g(_N,["_fontTemp",function(){return this._fontTemp=new _oa},"_drawStyleTemp",function(){return this._drawStyleTemp=new _R(null)}]),_N.__init$=function(){_c=function(){function _a(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=_oa.EMPTY}_m(_a,"");var _b=_a.prototype;return _b.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=_oa.EMPTY},_b.make=function(){return this===_a.DEFAULT?new _a:this},_a.DEFAULT=null,_a}()},_N}(),_ya=function(_a){function _d(_a,_b){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,_d.__super.call(this),this.defines=new _Ca,this.position=_d._POSITION,this.mainID=_a,this.subID=_b,this.textureHost=null,this.texture=null,this.texture1=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=_a|_b,this._inClassCache=_d._cache[this._cacheID],0<_a&&!this._inClassCache&&(this._inClassCache=_d._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}_m(_d,"laya.webgl.shader.d2.value.Value2D",_M);var _b=_d.prototype;return _b.setValue=function(_a){},_b.refresh=function(){var _a=this.size;return _a[0]=_sa.width,_a[1]=_sa.height,this.alpha=this.ALPHA*_sa.worldAlpha,this.mmat=_sa.worldMatrix4,this},_b._ShaderWithCompile=function(){return _Wa.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,_Za.create)},_b._withWorldShaderDefines=function(){var _a=_sa.worldShaderDefines,_b=_Wa.sharders[this.mainID|this.defines._value|_a.getValue()];if(!_b){var _c,_d={};for(_c in this.defines.toNameDic())_d[_c]="";for(_c in _a.toNameDic())_d[_c]="";_b=_Wa.withCompile2D(0,this.mainID,_d,this.mainID|this.defines._value|_a.getValue(),_Za.create)}var _e=_sa.worldFilters;if(!_e)return _b;for(var _f,_g=_e.length,_h=0;_h<_g;_h++)(_f=_e[_h])&&_f.action.setValue(this);return _b},_b.upload=function(){var _a=_sa;this.alpha=this.ALPHA*_a.worldAlpha,_sa.worldMatrix4!==_sa.TEMPMAT4_ARRAY&&this.defines.add(128),this.textureHost&&this.textureHost.alphaTexture?this.defines.add(2048):this.defines.remove(2048),this.textureHost&&this.textureHost.bitmap&&(37815==this.textureHost.bitmap.format||37812==this.textureHost.bitmap.format||37821==this.textureHost.bitmap.format)?this.defines.add(4096):this.defines.remove(4096),_ua.shaderHighPrecision&&this.defines.add(1024);var _b,_c=_a.worldShaderDefines?this._withWorldShaderDefines():_Wa.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=_a.width,this.size[1]=_a.height,this.mmat=_a.worldMatrix4,_Ja.activeShader!==_c?_c._shaderValueWidth!==_a.width||_c._shaderValueHeight!==_a.height?(_c._shaderValueWidth=_a.width,_c._shaderValueHeight=_a.height):_b=_c._params2dQuick2||_c._make2dQuick2():_c._shaderValueWidth!==_a.width||_c._shaderValueHeight!==_a.height?(_c._shaderValueWidth=_a.width,_c._shaderValueHeight=_a.height):_b=_c._params2dQuick1||_c._make2dQuick1(),_c.upload(this,_b)},_b.setFilters=function(_a){if(this.filters=_a)for(var _b,_c=_a.length,_d=0;_d<_c;_d++)(_b=_a[_d])&&(this.defines.add(_b.type),_b.action.setValue(this))},_b.clear=function(){this.defines.setValue(this.subID)},_b.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.textureHost=null,this.mmat=null,this.clear()},_d._initone=function(_a,_b){_d._typeClass[_a]=_b,_d._cache[_a]=[],_d._cache[_a]._length=0},_d.__init__=function(){_d._POSITION=[2,5126,!1,4*_pa.BYTES_PE,0],_d._TEXCOORD=[2,5126,!1,4*_pa.BYTES_PE,2*_pa.BYTES_PE],_d._initone(2,_Na),_d._initone(4,_Qa),_d._initone(256,_Oa),_d._initone(512,_Ma),_d._initone(1,_Pa),_d._initone(65,_Ya),_d._initone(9,_Pa)},_d.create=function(_a,_b){var _c=_d._cache[_a|_b];return _c._length?_c[--_c._length]:new _d._typeClass[_a|_b](_b)},_d._POSITION=null,_d._TEXCOORD=null,_d._cache=[],_d._typeClass=[],_d.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_d}(),_za=function(_a){function _q(_a,_b){_q.__super.call(this,_a,_b)}_m(_q,"laya.webgl.utils.RenderSprite3D",_s);var _b=_q.prototype;return _b.onCreate=function(_a){switch(_a){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},_b._mask=function(_a,_b,_c,_d){var _e,_f,_g=this._next,_h=_a.mask;if(_h){_b.ctx.save();var _i=_b.ctx.globalCompositeOperation,_j=new _B;if(_j.copyFrom(_h.getBounds()),_j.width=Math.round(_j.width),_j.height=Math.round(_j.height),_j.x=Math.round(_j.x),_j.y=Math.round(_j.y),0<_j.width&&0<_j.height){var _k=_a._style._tf,_l=_ha.create();_l.addValue("bounds",_j),_e=_ga.create([_l,_b],laya.webgl.utils.RenderSprite3D.tmpTarget),_b.addRenderObject(_e),_h.render(_b,-_j.x,-_j.y),_e=_ga.create([_l],laya.webgl.utils.RenderSprite3D.endTmpTarget),_b.addRenderObject(_e),_b.ctx.save(),_b.clipRect(_c-_k.translateX+_j.x,_d-_k.translateY+_j.y,_j.width,_j.height),_g._fun.call(_g,_a,_b,_c,_d),_b.ctx.restore(),_f=_ka.create(6),_i=_b.ctx.globalCompositeOperation,_f.blendMode="mask",_b.addRenderObject(_f),_z.TEMP.identity();var _m=_ya.create(1,0),_n=_I.INV_UV,_o=_j.width,_p=_j.height;(_j.width<32||_j.height<32)&&((_n=_q.tempUV)[0]=0,_n[1]=0,_n[2]=32<=_j.width?1:_j.width/32,_n[3]=0,_n[4]=32<=_j.width?1:_j.width/32,_n[5]=32<=_j.height?1:_j.height/32,_n[6]=0,_n[7]=32<=_j.height?1:_j.height/32,_j.width=32<=_j.width?_j.width:32,_j.height=32<=_j.height?_j.height:32,_n[1]*=-1,_n[3]*=-1,_n[5]*=-1,_n[7]*=-1,_n[1]+=1,_n[3]+=1,_n[5]+=1,_n[7]+=1),_b.ctx.drawTarget(_l,_c+_j.x-_k.translateX,_d+_j.y-_k.translateY,_o,_p,_z.TEMP,"tmpTarget",_m,_n,6),_e=_ga.create([_l],laya.webgl.utils.RenderSprite3D.recycleTarget),_b.addRenderObject(_e),(_f=_ka.create(6)).blendMode=_i,_b.addRenderObject(_f)}_b.ctx.restore()}else _g._fun.call(_g,_a,_b,_c,_d)},_b._blend=function(_a,_b,_c,_d){var _e=_a._style,_f=this._next;_e.blendMode?(_b.ctx.save(),_b.ctx.globalCompositeOperation=_e.blendMode,_f._fun.call(_f,_a,_b,_c,_d),_b.ctx.restore()):_f._fun.call(_f,_a,_b,_c,_d)},_b._transform=function(_a,_b,_c,_d){var _e=_a.transform,_f=this._next;if(_e&&_f!=_s.NORENDER){var _g=_b.ctx;_a._style;_e.tx=_c,_e.ty=_d;var _h=_g._getTransformMatrix(),_i=_h.clone();_z.mul(_e,_h,_h),_h._checkTransform(),_e.tx=_e.ty=0,_f._fun.call(_f,_a,_b,0,0),_i.copyTo(_h),_i.destroy()}else _f._fun.call(_f,_a,_b,_c,_d)},_q.tmpTarget=function(_a,_b){var _c=_a.getValue("bounds"),_d=_Ka.create(_c.width,_c.height);_d.start(),_d.clear(0,0,0,0),_a.addValue("tmpTarget",_d)},_q.endTmpTarget=function(_a){_a.getValue("tmpTarget").end()},_q.recycleTarget=function(_a){_a.getValue("tmpTarget").recycle(),_a.recycle()},_g(_q,["tempUV",function(){return this.tempUV=new Array(8)}]),_q}(),_Aa=function(_a){function _b(){this.data=null,_b.__super.call(this)}_m(_b,"laya.filters.webgl.ColorFilterActionGL",_L);var _c=_b.prototype;return _w.imps(_c,{"laya.filters.IFilterActionGL":!0}),_c.setValue=function(_a){_a.colorMat=this.data._mat,_a.colorAlpha=this.data._alpha},_c.apply3d=function(_a,_b,_c,_d,_e){var _f=_a.getValue("bounds"),_g=_ya.create(1,0);_g.setFilters([this.data]);var _h=_z.TEMP;_h.identity(),_c.ctx.drawTarget(_a,0,0,_f.width,_f.height,_h,"src",_g)},_b}(),_Ba=function(_a){function _f(_a,_b,_c,_d,_e){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,_f.__super.call(this,_a,_b,_e),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new _Ra,this._atlasCanvas.uri="Atlaser.AtlasWebGLCanvas._atlasCanvas",(this._atlasCanvas._atlaser=this)._atlasCanvas.width=_c,this._atlasCanvas.height=_d,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}_m(_f,"laya.webgl.atlas.Atlaser",_N);var _b=_f.prototype;return _b.computeUVinAtlasTexture=function(_a,_b,_c,_d){var _e=_O.atlasTextureWidth,_f=_O.atlasTextureHeight,_g=_c/_e,_h=_d/_f,_i=(_c+_a.bitmap.width)/_e,_j=(_d+_a.bitmap.height)/_f,_k=_a.bitmap.width/_e,_l=_a.bitmap.height/_f;_a.uv=[_g+_b[0]*_k,_h+_b[1]*_l,_i-(1-_b[2])*_k,_h+_b[3]*_l,_i-(1-_b[4])*_k,_j-(1-_b[5])*_l,_g+_b[6]*_k,_j-(1-_b[7])*_l]},_b.findBitmapIsExist=function(_a){if(_a instanceof laya.webgl.resource.WebGLImage){var _b=_a,_c=_b.url,_d=this._InAtlasWebGLImagesKey[_c||_b.id];if(_d)return _d.offsetInfoID}return-1},_b.addToAtlasTexture=function(_a,_b,_c){if(_a instanceof laya.webgl.resource.WebGLImage){var _d=_a,_e=_d.url;this._InAtlasWebGLImagesKey[_e||_d.id]={bitmap:_a,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([_b,_c])}this._atlasCanvas.texSubImage2D(_b,_c,_a.atlasSource),_a.clearAtlasSource()},_b.addToAtlas=function(_a,_b,_c){_a._atlasID=this._inAtlasTextureKey.length;var _d=_a.uv.slice(),_e=_a.bitmap;this._inAtlasTextureKey.push(_a),this._inAtlasTextureOriUVValue.push(_d),this._inAtlasTextureBitmapValue.push(_e),this.computeUVinAtlasTexture(_a,_d,_b,_c),_a.bitmap=this._atlasCanvas},_b.clear=function(){for(var _a=0,_b=this._inAtlasTextureKey.length;_a<_b;_a++)this._inAtlasTextureKey[_a].bitmap=this._inAtlasTextureBitmapValue[_a],this._inAtlasTextureKey[_a].uv=this._inAtlasTextureOriUVValue[_a],this._inAtlasTextureKey[_a]._atlasID=-1,this._inAtlasTextureKey[_a].bitmap.lock=!1,this._inAtlasTextureKey[_a].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},_b.dispose=function(){this.clear(),this._atlasCanvas.destroy()},_d(0,_b,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),_d(0,_b,"texture",function(){return this._atlasCanvas}),_d(0,_b,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),_f}(),_Ca=function(_a){function _c(){_c.__super.call(this,_c.__name2int,_c.__int2name,_c.__int2nameMap)}return _m(_c,"laya.webgl.shader.d2.ShaderDefines2D",__),_c.__init__=function(){_c.reg("TEXTURE2D",1),_c.reg("COLOR2D",2),_c.reg("PRIMITIVE",4),_c.reg("GLOW_FILTER",8),_c.reg("BLUR_FILTER",16),_c.reg("COLOR_FILTER",32),_c.reg("COLOR_ADD",64),_c.reg("WORLDMAT",128),_c.reg("FILLTEXTURE",256),_c.reg("FSHIGHPRECISION",1024),_c.reg("TXTALPHA",2048),_c.reg("TXTCOMPRESS",4096)},_c.reg=function(_a,_b){__._reg(_a,_b,_c.__name2int,_c.__int2name)},_c.toText=function(_a,_b,_c){return __._toText(_a,_b,_c)},_c.toInt=function(_a){return __._toInt(_a,_c.__name2int)},_c.TEXTURE2D=1,_c.COLOR2D=2,_c.PRIMITIVE=4,_c.FILTERGLOW=8,_c.FILTERBLUR=16,_c.FILTERCOLOR=32,_c.COLORADD=64,_c.WORLDMAT=128,_c.FILLTEXTURE=256,_c.SKINMESH=512,_c.SHADERDEFINE_FSHIGHPRECISION=1024,_c.TXTALPHA=2048,_c.TXTCOMPRESS=4096,_c.__name2int={},_c.__int2name=[],_c.__int2nameMap=[],_c}(),_Da=(function(_a){function _h(_a,_b,_c,_d,_e,_f,_g){_h.__super.call(this,_a,_b,_c,_d,40,_e,_f,_g)}_m(_h,"laya.webgl.shapes.Ellipse",_ca)}(),function(_a){function _f(_a,_b,_c,_d,_e){this._points=[],this.rebuild(_c),_f.__super.call(this,_a,_b,0,0,0,_e,_d,_e,0)}_m(_f,"laya.webgl.shapes.Line",_ca);var _b=_f.prototype;return _b.rebuild=function(_a){var _b=_a.length;_b!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(_b/2-1)),this.mFloat32Array=new Float32Array(5*_b)),this._points.length=0;for(var _c=NaN,_d=NaN,_e=-1,_f=-1,_g=_a.length/2,_h=0;_h<_g;_h++)_c=_a[2*_h],_d=_a[2*_h+1],(.01<Math.abs(_e-_c)||.01<Math.abs(_f-_d))&&this._points.push(_c,_d),_e=_c,_f=_d},_b.getData=function(_a,_b,_c){var _d=[],_e=[];0<this.borderWidth&&this.createLine2(this._points,_d,this.borderWidth,_c,_e,this._points.length/2),this.mUint16Array.set(_d,0),this.mFloat32Array.set(_e,0),_a.append(this.mUint16Array),_b.append(this.mFloat32Array)},_f}()),_Ea=function(_a){function _l(_a,_b,_c,_d,_e){this._points=[];for(var _f=NaN,_g=NaN,_h=-1,_i=-1,_j=_c.length/2-1,_k=0;_k<_j;_k++)_f=_c[2*_k],_g=_c[2*_k+1],(.01<Math.abs(_h-_f)||.01<Math.abs(_i-_g))&&this._points.push(_f,_g),_h=_f,_i=_g;_f=_c[2*_j],_g=_c[2*_j+1],_h=this._points[0],_i=this._points[1],(.01<Math.abs(_h-_f)||.01<Math.abs(_i-_g))&&this._points.push(_f,_g),_l.__super.call(this,_a,_b,0,0,this._points.length/2,0,_d,_e)}_m(_l,"laya.webgl.shapes.LoopLine",_ca);var _b=_l.prototype;return _b.getData=function(_a,_b,_c){if(0<this.borderWidth){for(var _d=this.color,_e=(_d>>16&255)/255,_f=(_d>>8&255)/255,_g=(255&_d)/255,_h=[],_i=0,_j=0,_k=[],_l=Math.floor(this._points.length/2),_m=0;_m<_l;_m++)_i=this._points[2*_m],_j=this._points[2*_m+1],_h.push(this.x+_i,this.y+_j,_e,_f,_g);this.createLoopLine(_h,_k,this.borderWidth,_c+_h.length/5),_a.append(new Uint16Array(_k)),_b.append(new Float32Array(_h))}},_b.createLoopLine=function(_a,_b,_c,_d,_e,_f){_a.length;var _g=_a.concat(),_h=_e||_a,_i=this.borderColor,_j=(_i>>16&255)/255,_k=(_i>>8&255)/255,_l=(255&_i)/255,_m=[_g[0],_g[1]],_n=[_g[_g.length-5],_g[_g.length-4]],_o=_n[0]+.5*(_m[0]-_n[0]),_p=_n[1]+.5*(_m[1]-_n[1]);_g.unshift(_o,_p,0,0,0),_g.push(_o,_p,0,0,0);var _q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D,_E,_F,_G,_H,_I,_J,_K=_g.length/5,_L=_d,_M=_c/2;_s=_g[0],_t=_g[1],_z=_s-(_u=_g[5]),_y=(_y=-(_t-(_v=_g[6])))/(_J=Math.sqrt(_y*_y+_z*_z))*_M,_z=_z/_J*_M,_h.push(_s-_y,_t-_z,_j,_k,_l,_s+_y,_t+_z,_j,_k,_l);for(var _N=1;_N<_K-1;_N++)_s=_g[5*(_N-1)],_t=_g[5*(_N-1)+1],_u=_g[5*_N],_v=_g[5*_N+1],_w=_g[5*(_N+1)],_x=_g[5*(_N+1)+1],_z=_s-_u,_B=_u-_w,_E=(-(_y=(_y=-(_t-_v))/(_J=Math.sqrt(_y*_y+_z*_z))*_M)+_s)*(-(_z=_z/_J*_M)+_v)-(-_y+_u)*(-_z+_t),_H=(-(_A=(_A=-(_v-_x))/(_J=Math.sqrt(_A*_A+_B*_B))*_M)+_w)*(-(_B=_B/_J*_M)+_v)-(-_A+_u)*(-_B+_x),_I=(_C=-_z+_t-(-_z+_v))*(_G=-_A+_u-(-_A+_w))-(_F=-_B+_x-(-_B+_v))*(_D=-_y+_u-(-_y+_s)),Math.abs(_I)<.1?(_I+=10.1,_h.push(_u-_y,_v-_z,_j,_k,_l,_u+_y,_v+_z,_j,_k,_l)):(((_q=(_D*_H-_G*_E)/_I)-_u)*(_q-_u)+((_r=(_F*_E-_C*_H)/_I)-_v)+(_r-_v),_h.push(_q,_r,_j,_k,_l,_u-(_q-_u),_v-(_r-_v),_j,_k,_l));_f&&(_b=_f);var _O=this.edges+1;for(_N=1;_N<_O;_N++)_b.push(_L+2*(_N-1),_L+2*(_N-1)+1,_L+2*_N+1,_L+2*_N+1,_L+2*_N,_L+2*(_N-1));return _b.push(_L+2*(_N-1),_L+2*(_N-1)+1,_L+1,_L+1,_L,_L+2*(_N-1)),_h},_l}(),_Fa=function(_a){function _g(_a,_b,_c,_d,_e,_f){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=_z.create(),this._points=_c.slice(0,_c.length),_g.__super.call(this,_a,_b,0,0,this._points.length/2,_d,_e,_f)}_m(_g,"laya.webgl.shapes.Polygon",_ca);var _b=_g.prototype;return _b.rebuild=function(_a){this._repaint||(this._points.length=0,this._points=this._points.concat(_a))},_b.setMatrix=function(_a){_a.copyTo(this._mat)},_b.needUpdate=function(_a){return this._repaint=this._mat.a==_a.a&&this._mat.b==_a.b&&this._mat.c==_a.c&&this._mat.d==_a.d&&this._mat.tx==_a.tx&&this._mat.ty==_a.ty,!this._repaint},_b.getData=function(_a,_b,_c){var _d,_e=0,_f=this._points,_g=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=_c){for(this._start=_c,_d=[],_g=this.earcutTriangles.length,_e=0;_e<_g;_e++)_d.push(this.earcutTriangles[_e]+_c);this.mUint16Array=new Uint16Array(_d)}}else{this._start=_c,_d=[];var _h=[],_i=[],_j=this.color,_k=(_j>>16&255)/255,_l=(_j>>8&255)/255,_m=(255&_j)/255;for(_g=Math.floor(_f.length/2),_e=0;_e<_g;_e++)_h.push(this.x+_f[2*_e],this.y+_f[2*_e+1],_k,_l,_m),_i.push(this.x+_f[2*_e],this.y+_f[2*_e+1]);for(this.earcutTriangles=_da.earcut(_i,null,2),_g=this.earcutTriangles.length,_e=0;_e<_g;_e++)_d.push(this.earcutTriangles[_e]+_c);this.mUint16Array=new Uint16Array(_d),this.mFloat32Array=new Float32Array(_h)}_a.append(this.mUint16Array),_b.append(this.mFloat32Array)},_g}(),_Ga=function(_a){function _f(){this._matrix=new _z,this._matrix4=_pa.defaultMatrix4.concat(),_f.__super.call(this,1e4),this.shaderValue=new _ya(0,0)}_m(_f,"laya.webgl.submit.SubmitCanvas",_fa);var _b=_f.prototype;return _b.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var _a=_sa.worldAlpha,_b=_sa.worldMatrix4,_c=_sa.worldMatrix,_d=_sa.worldFilters,_e=_sa.worldShaderDefines,_f=this.shaderValue,_g=this._matrix,_h=this._matrix4,_i=_z.TEMP;return _z.mul(_g,_c,_i),_h[0]=_i.a,_h[1]=_i.b,_h[4]=_i.c,_h[5]=_i.d,_h[12]=_i.tx,_h[13]=_i.ty,_sa.worldMatrix=_i.clone(),_sa.worldMatrix4=_h,_sa.worldAlpha=_sa.worldAlpha*_f.alpha,_f.filters&&_f.filters.length&&(_sa.worldFilters=_f.filters,_sa.worldShaderDefines=_f.defines),this._ctx_src.flush(),_sa.worldAlpha=_a,_sa.worldMatrix4=_b,_sa.worldMatrix.destroy(),_sa.worldMatrix=_c,_sa.worldFilters=_d,_sa.worldShaderDefines=_e,1},_b.releaseRender=function(){var _a=_f._cache;this._ctx_src=null,_a[_a._length++]=this},_b.getRenderType=function(){return 10003},_f.create=function(_a,_b,_c){var _d=_f._cache._length?_f._cache[--_f._cache._length]:new _f;_d._ctx_src=_a;var _e=_d.shaderValue;return _e.alpha=_b,_e.defines.setValue(0),_c&&_c.length&&_e.setFilters(_c),_d},_f._cache=((_f._cache=[])._length=0,_f._cache),_f}(),_Ha=function(_a){function _j(_a){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===_a&&(_a=1e4),_j.__super.call(this,_a)}_m(_j,"laya.webgl.submit.SubmitTexture",_fa);var _b=_j.prototype;return _b.releaseRender=function(){var _a=_j._cache;(_a[_a._length++]=this).shaderValue.release(),this.shaderValue=null,this._preIsSameTextureShader=!1,this._blendFn=null,this._vb=null,this._ib=null,this._texs.length=0,this._vbPos.length=0,this._texsID.length=0,this._isSameTexture=!0},_b.addTexture=function(_a,_b){this._texsID[this._texs.length]=_a._uvID,this._texs.push(_a),this._vbPos.push(_b)},_b.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var _a=this.shaderValue.textureHost.bitmap;if(null!==_a)for(var _b=this._vb.getFloat32Array(),_c=0,_d=this._texs.length;_c<_d;_c++){var _e=this._texs[_c];_e.active();var _f=_e.uv;if(this._texsID[_c]!==_e._uvID){this._texsID[_c]=_e._uvID;var _g=this._vbPos[_c];_b[_g+2]=_f[0],_b[_g+3]=_f[1],_b[_g+6]=_f[2],_b[_g+7]=_f[3],_b[_g+10]=_f[4],_b[_g+11]=_f[5],_b[_g+14]=_f[6],_b[_g+15]=_f[7],this._vb.setNeedUpload()}_e.bitmap!==_a&&(this._isSameTexture=!1)}}},_b.renderSubmit=function(){if(0===this._numEle)return _j._shaderSet=!1,1;var _a=this.shaderValue.textureHost;if(_a){var _b=_a.source;if(!_a.bitmap||!_b)return _j._shaderSet=!1,1;this.shaderValue.texture=_b,_a.alphaTexture&&_a.alphaTexture.source&&(this.shaderValue.texture1=_a.alphaTexture.source)}this._vb.bind_upload(this._ib);var _c=_ua.mainContext;if(_Q.activeBlendFunction!==this._blendFn&&(_c.enable(3042),this._blendFn(_c),_Q.activeBlendFunction=this._blendFn),_E.drawCall++,_E.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&_Ja.activeShader&&_j._shaderSet?(_Ja.activeShader.uploadTexture2D(this.shaderValue.texture),this.shaderValue.texture1&&_Ja.activeShader.uploadTexture2D1(this.shaderValue.texture1)):this.shaderValue.upload(),_j._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var _d=_a.bitmap,_e=0,_f=_Ja.activeShader,_g=0,_h=this._texs.length;_g<_h;_g++){var _i=this._texs[_g];_i.bitmap===_d&&_g+1!==_h||(_f.uploadTexture2D(_i.source),_c.drawElements(4,6*(_g-_e+1),5123,this._startIdx+6*_e*_pa.BYTES_PIDX),_d=_i.bitmap,_e=_g)}else _c.drawElements(4,this._numEle,5123,this._startIdx);return 1},_j.create=function(_a,_b,_c,_d,_e){var _f=_j._cache._length?_j._cache[--_j._cache._length]:new _j;null==_c&&((_c=_f._selfVb||(_f._selfVb=__a.create(-1))).clear(),_d=0),_f._ib=_b,_f._vb=_c,_f._startIdx=_d*_pa.BYTES_PIDX,_f._numEle=0;var _g=_a._nBlendType;_f._blendFn=_a._targets?_Q.targetFns[_g]:_Q.fns[_g],_f.shaderValue=_e,_f.shaderValue.setValue(_a._shader2D);var _h=_a._shader2D.filters;return _h&&_f.shaderValue.setFilters(_h),_f},_j._cache=((_j._cache=[])._length=0,_j._cache),_j._shaderSet=!0,_j}(),_Ia=function(_a){function _r(){_r.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}_m(_r,"laya.webgl.utils.MeshTexture",_ra);var _b=_r.prototype;return _b.addData=function(_a,_b,_c,_d,_e,_f){for(var _g=_a.length/2,_h=this._vb.needSize(_g*_r.const_stride)>>2,_i=this._vb.getFloat32Array(),_j=0,_k=0;_k<_g;_k++){var _l=_a[_j],_m=_a[_j+1],_n=_l*_d.a+_m*_d.c+_d.tx,_o=_l*_d.b+_m*_d.d+_d.ty;_i[_h++]=_n,_i[_h++]=_o,_i[_h++]=_b[_j],_i[_h++]=_b[_j+1],_j+=2}this._vb.setNeedUpload();var _p=this.vertNum;if(0<_p){(_g=_c.length)>_r.tmpIdx.length&&(_r.tmpIdx=new Uint16Array(_g));for(var _q=0;_q<_g;_q++)_r.tmpIdx[_q]=_c[_q]+_p;this._ib.appendU16Array(_r.tmpIdx,_c.length)}else this._ib.append(_c);this._ib.setNeedUpload(),this.vertNum+=_g,this.indexNum+=_c.length},_b.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},_b.destroy=function(){this._ib.destroy(),this._vb.destroy()},_r.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new _r},_r.const_stride=16,_r._POOL=[],_g(_r,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),_r}(),_Ja=function(_a){function _b(){_b.__super.call(this),this.lock=!0}return _m(_b,"laya.webgl.shader.BaseShader",_t),_b.activeShader=null,_b.bindShader=null,_b}(),_Ka=function(_b){function _k(_a,_b,_c,_d,_e,_f,_g,_h,_i){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===_c&&(_c=6408),void 0===_d&&(_d=5121),void 0===_e&&(_e=34041),void 0===_f&&(_f=!1),void 0===_g&&(_g=!1),void 0===_h&&(_h=-1),void 0===_i&&(_i=-1),this._type=1,this._w=_a,this._h=_b,this._surfaceFormat=_c,this._surfaceType=_d,this._depthStencilFormat=_e,_r.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=_f,this._repeat=_g,this._minFifter=_h,this._magFifter=_i,this._createWebGLRenderTarget(),this.bitmap.lock=!0,_k.__super.call(this,this.bitmap,_I.INV_UV)}_m(_k,"laya.webgl.resource.RenderTarget2D",_b);var _a=_k.prototype;return _w.imps(_a,{"laya.resource.IDispose":!0}),_a.getType=function(){return this._type},_a.getTexture=function(){return this},_a.size=function(_a,_b){this._w==_a&&this._h==_b||(this._w=_a,this._h=_b,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},_a.release=function(){this.destroy()},_a.recycle=function(){_k.POOL.push(this)},_a.start=function(){var _a=_ua.mainContext;return this._preRenderTarget=_sa.curRenderTarget,_sa.curRenderTarget=this,_a.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(_a.viewport(0,0,this._w,this._h),this._svWidth=_sa.width,this._svHeight=_sa.height,_sa.width=this._w,_sa.height=this._h,_Ja.activeShader=null),this},_a.clear=function(_a,_b,_c,_d){void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=1);var _e=_ua.mainContext;_e.clearColor(_a,_b,_c,_d);var _f=16384;switch(this._depthStencilFormat){case 33189:_f|=256;break;case 36168:_f|=1024;break;case 34041:_f|=256,_f|=1024}_e.clear(_f)},_a.end=function(){var _a=_ua.mainContext;_a.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,_sa.curRenderTarget=this._preRenderTarget,1==this._type?(_a.viewport(0,0,this._svWidth,this._svHeight),_sa.width=this._svWidth,_sa.height=this._svHeight,_Ja.activeShader=null):_a.viewport(0,0,_w.stage.width,_w.stage.height)},_a.getData=function(_a,_b,_c,_d){var _e=_ua.mainContext;if(_e.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===_e.checkFramebufferStatus(36160)))return _e.bindFramebuffer(36160,null),null;var _f=new Uint8Array(this._w*this._h*4);return _e.readPixels(_a,_b,_c,_d,this._surfaceFormat,this._surfaceType,_f),_e.bindFramebuffer(36160,null),_f},_a.destroy=function(_a){void 0===_a&&(_a=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,_b.prototype.destroy.call(this))},_a.dispose=function(){},_a._createWebGLRenderTarget=function(){this.bitmap=new _Ua(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(_a){this.event("recovered")})},_d(0,_a,"surfaceFormat",function(){return this._surfaceFormat}),_d(0,_a,"magFifter",function(){return this._magFifter}),_d(0,_a,"surfaceType",function(){return this._surfaceType}),_d(0,_a,"mipMap",function(){return this._mipMap}),_d(0,_a,"depthStencilFormat",function(){return this._depthStencilFormat}),_d(0,_a,"minFifter",function(){return this._minFifter}),_d(0,_a,"source",function(){return this._alreadyResolved?_w.superGet(_I,this,"source"):null}),_k.create=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){void 0===_c&&(_c=6408),void 0===_d&&(_d=5121),void 0===_e&&(_e=34041),void 0===_f&&(_f=!1),void 0===_g&&(_g=!1),void 0===_h&&(_h=-1),void 0===_i&&(_i=-1);var _j=_k.POOL.pop();return _j||(_j=new _k(_a,_b)),_j.bitmap&&_j._w==_a&&_j._h==_b&&_j._surfaceFormat==_c&&_j._surfaceType==_d&&_j._depthStencilFormat==_e&&_j._mipMap==_f&&_j._repeat==_g&&_j._minFifter==_h&&_j._magFifter==_i||(_j._w=_a,_j._h=_b,_j._surfaceFormat=_c,_j._surfaceType=_d,_j._depthStencilFormat=_e,_r.isConchWebGL&&34041===_j._depthStencilFormat&&(_j._depthStencilFormat=33189),_j._mipMap=_f,_j._repeat=_g,_j._minFifter=_h,_j._magFifter=_i,_j.release(),_j._createWebGLRenderTarget()),_j},_k.TYPE2D=1,_k.TYPE3D=2,_k.POOL=[],_k}(_I),_La=function(_a){function _b(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,_b.__super.call(this),_b._gl=_ua.mainContext}_m(_b,"laya.webgl.utils.Buffer",_t);var _c=_b.prototype;return _c._bind=function(){this.activeResource(),_b._bindActive[this._bufferType]!==this._glBuffer&&(34962===this._bufferType&&(_b._bindVertexBuffer=this._glBuffer),_b._gl.bindBuffer(this._bufferType,_b._bindActive[this._bufferType]=this._glBuffer),_Ja.activeShader=null)},_c.recreateResource=function(){this._glBuffer||(this._glBuffer=_b._gl.createBuffer()),this.completeCreate()},_c.disposeResource=function(){this._glBuffer&&(_ua.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},_d(0,_c,"bufferUsage",function(){return this._bufferUsage}),_b._gl=null,_b._bindActive={},_b._bindVertexBuffer=null,_b._enableAtributes=[],_b}(),_Ma=function(_a){function _c(_a){this.texcoord=null,this.offsetX=300,this.offsetY=0,_c.__super.call(this,512,0);var _b=8*_pa.BYTES_PE;this.position=[2,5126,!1,_b,0],this.texcoord=[2,5126,!1,_b,2*_pa.BYTES_PE],this.color=[4,5126,!1,_b,4*_pa.BYTES_PE]}return _m(_c,"laya.webgl.shader.d2.skinAnishader.SkinSV",_ya),_c}(),_Na=function(_a){function _b(_a){_b.__super.call(this,2,0),this.color=[]}return _m(_b,"laya.webgl.shader.d2.value.Color2dSV",_ya),_b.prototype.setValue=function(_a){_a.fillStyle&&(this.color=_a.fillStyle._color._color),_a.strokeStyle&&(this.color=_a.strokeStyle._color._color)},_b}(),_Oa=function(_a){function _b(_a){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=_ya._TEXCOORD,_b.__super.call(this,256,0)}_m(_b,"laya.webgl.shader.d2.value.FillTextureSV",_ya);var _c=_b.prototype;return _c.setValue=function(_a){this.ALPHA=_a.ALPHA,_a.filters&&this.setFilters(_a.filters)},_c.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},_b}(),_Pa=function(_a){function _b(_a){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=_ya._TEXCOORD,void 0===_a&&(_a=0),_b.__super.call(this,1,_a)}_m(_b,"laya.webgl.shader.d2.value.TextureSV",_ya);var _c=_b.prototype;return _c.setValue=function(_a){this.ALPHA=_a.ALPHA,_a.filters&&this.setFilters(_a.filters)},_c.clear=function(){this.texture=null,this.texture1=null,this.shader=null,this.colorMat=null,this.colorAlpha=null,this.defines.setValue(0)},_b}(),_Qa=function(_a){function _b(_a){this.a_color=null,this.u_pos=[0,0],_b.__super.call(this,4,0),this.position=[2,5126,!1,5*_pa.BYTES_PE,0],this.a_color=[3,5126,!1,5*_pa.BYTES_PE,2*_pa.BYTES_PE]}return _m(_b,"laya.webgl.shader.d2.value.PrimitiveSV",_ya),_b}(),_Ra=function(_a){function _b(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,_b.__super.call(this)}_m(_b,"laya.webgl.atlas.AtlasWebGLCanvas",_a);var _c=_b.prototype;return _c.recreateResource=function(){var _a=_ua.mainContext,_b=this._source=_a.createTexture(),_c=_va.curBindTexTarget,_d=_va.curBindTexValue;_va.bindTexture(_a,3553,_b),_a.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),_a.texParameteri(3553,10241,9729),_a.texParameteri(3553,10240,9729),_a.texParameteri(3553,10242,33071),_a.texParameteri(3553,10243,33071),_c&&_d&&_va.bindTexture(_a,_c,_d),this.memorySize=this._w*this._h*4,this.completeCreate()},_c.disposeResource=function(){this._source&&(_ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},_c.texSubImage2D=function(_a,_b,_c){if(_r.isFlash){this._flashCacheImage||(this._flashCacheImage=_p.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var _d=_c.bitmapdata;this._flashCacheImage._image.copyPixels(_d,0,0,_d.width,_d.height,_a,_b),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var _e=_ua.mainContext,_f=_va.curBindTexTarget,_g=_va.curBindTexValue;_va.bindTexture(_e,3553,this._source),_e.pixelStorei(37441,!0),0<=_a-1&&_e.texSubImage2D(3553,0,_a-1,_b,6408,5121,_c),_a+1<=this._w&&_e.texSubImage2D(3553,0,_a+1,_b,6408,5121,_c),0<=_b-1&&_e.texSubImage2D(3553,0,_a,_b-1,6408,5121,_c),_b+1<=this._h&&_e.texSubImage2D(3553,0,_a,_b+1,6408,5121,_c),_e.texSubImage2D(3553,0,_a,_b,6408,5121,_c),_e.pixelStorei(37441,!1),_f&&_g&&_va.bindTexture(_e,_f,_g)}},_c.texSubImage2DPixel=function(_a,_b,_c,_d,_e){var _f=_ua.mainContext,_g=_va.curBindTexTarget,_h=_va.curBindTexValue;_va.bindTexture(_f,3553,this._source);var _i=new Uint8Array(_e.data);_f.pixelStorei(37441,!0),_f.texSubImage2D(3553,0,_a,_b,_c,_d,6408,5121,_i),_f.pixelStorei(37441,!1),_g&&_h&&_va.bindTexture(_f,_g,_h)},_d(0,_c,"width",_a.prototype._$get_width,function(_a){this._w=_a}),_d(0,_c,"height",_a.prototype._$get_height,function(_a){this._h=_a}),_b}(_c),_Sa=function(_a){function _e(){this.flipY=!0,this.alwaysChange=!1,_e.__super.call(this)}_m(_e,"laya.webgl.resource.WebGLCanvas",_c);var _b=_e.prototype;return _b.getCanvas=function(){return this._canvas},_b.clear=function(){this._ctx&&this._ctx.clear()},_b.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null,laya.resource.Resource.prototype.destroy.call(this)},_b._setContext=function(_a){this._ctx=_a},_b.getContext=function(_a,_b){return this._ctx?this._ctx:this._ctx=_e._createContext(this)},_b.size=function(_a,_b){this._w==_a&&this._h==_b||(this._w=_a,this._h=_b,this._ctx&&this._ctx.size(_a,_b),this._canvas&&(this._canvas.height=_b,this._canvas.width=_a))},_b.activeResource=function(_a){void 0===_a&&(_a=!1),this._source||this.recreateResource()},_b.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},_b.disposeResource=function(){this._source&&!this.iscpuSource&&(_ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},_b.createWebGlTexture=function(){var _a=_ua.mainContext;this._canvas;var _b=this._source=_a.createTexture();this.iscpuSource=!1;var _c=_va.curBindTexTarget,_d=_va.curBindTexValue;_va.bindTexture(_a,3553,_b),_a.pixelStorei(37440,this.flipY?1:0),_e.premulAlpha&&_a.pixelStorei(37441,!0),_a.texImage2D(3553,0,6408,6408,5121,this._imgData),_e.premulAlpha&&_a.pixelStorei(37441,!1),_a.texParameteri(3553,10240,9729),_a.texParameteri(3553,10241,9729),_a.texParameteri(3553,10242,33071),_a.texParameteri(3553,10243,33071),_a.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,_c&&_d&&_va.bindTexture(_a,_c,_d)},_b.reloadCanvasData=function(){var _a=_ua.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var _b=_va.curBindTexTarget,_c=_va.curBindTexValue;_va.bindTexture(_a,3553,this._source),_e.premulAlpha&&_a.pixelStorei(37441,!0),_a.texImage2D(3553,0,6408,6408,5121,this._imgData),_e.premulAlpha&&_a.pixelStorei(37441,!1),_a.pixelStorei(37440,0),_b&&_c&&_va.bindTexture(_a,_b,_c)},_b.texSubImage2D=function(_a,_b,_c){var _d=_ua.mainContext,_e=_va.curBindTexTarget,_f=_va.curBindTexValue;_va.bindTexture(_d,3553,this._source),_d.pixelStorei(37441,!0),_d.texSubImage2D(3553,0,_b,_c,6408,5121,_a._source),_d.pixelStorei(37441,!1),_e&&_f&&_va.bindTexture(_d,_e,_f)},_b.toBase64=function(_a,_b,_c){var _d=null;this._canvas&&(_d=this._canvas.toDataURL(_a,_b)),_c.call(this,_d)},_d(0,_b,"context",function(){return this._ctx}),_d(0,_b,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),_d(0,_b,"asBitmap",null,function(_a){this._ctx&&(this._ctx.asBitmap=_a)}),_e._createContext=null,_e.premulAlpha=!1,_e}(),_Ta=function(_a){function _f(_a,_b){this.CborderSize=12,_f.__super.call(this),this.char=_a,this.isSpace=" "===_a,this.xs=_b.scaleX,this.ys=_b.scaleY,this.font=_b.font.toString(),this.fontSize=_b.font.size,this.fillColor=_b.fillColor,this.borderColor=_b.borderColor,this.lineWidth=_b.lineWidth,this.underLine=_b.underLine;var _c,_d=_r.isConchApp;_d?((_c=ConchTextCanvas)._source=ConchTextCanvas,_c._source.canvas=ConchTextCanvas):_c=_n.canvas.source,this.canvas=_c,this._enableMerageInAtlas=!0,this._ctx=_d?_c:this.canvas.getContext("2d",void 0);var _e=_J.measureText(this.char,this.font);this.cw=_e.width*this.xs,this.ch=(_e.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new _I(this)}_m(_f,"laya.webgl.resource.WebGLCharImage",_c);var _b=_f.prototype;return _w.imps(_b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),_b.active=function(){this.texture.active()},_b.recreateResource=function(){var _a=_r.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),_a){var _b=this.fontSize;1==this.xs&&1==this.ys||(_b=parseInt(_b*(this.xs>this.ys?this.xs:this.ys)+""));var _c="normal 100 "+this.font;_c=_c.replace(_f._fontSizeReg,_b),this.borderColor&&(_c+=" 1 "+this.borderColor),this._ctx.font=_c,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.lineJoin="round",this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,_H.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var _d=this._ctx.measureText(this.char);_d||(_d={width:16});var _e=_d.width+1;this._ctx.lineTo(_e,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},_b.onresize=function(_a,_b){this._w=_a,this._h=_b,this._allowMerageInAtlas=!0},_b.clearAtlasSource=function(){},_d(0,_b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),_d(0,_b,"atlasSource",function(){return this.canvas}),_d(0,_b,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(_a){this._enableMerageInAtlas=_a}),_f.createOneChar=function(_a,_b){return new _f(_a,_b)},_f._fontSizeReg=new RegExp("\\d+(?=px)","g"),_f}(),_Ua=function(_a){function _j(_a,_b,_c,_d,_e,_f,_g,_h,_i){void 0===_c&&(_c=6408),void 0===_d&&(_d=5121),void 0===_e&&(_e=34041),void 0===_f&&(_f=!1),void 0===_g&&(_g=!1),void 0===_h&&(_h=-1),void 0===_i&&(_i=1),_j.__super.call(this),this.uri="WebGLRenderTarget_"+this.id,this._w=_a,this._h=_b,this._surfaceFormat=_c,this._surfaceType=_d,this._depthStencilFormat=_e,this._mipMap=_f,this._repeat=_g,this._minFifter=_h,this._magFifter=_i}_m(_j,"laya.webgl.resource.WebGLRenderTarget",_c);var _b=_j.prototype;return _b.recreateResource=function(){var _a=_ua.mainContext;this._frameBuffer||(this._frameBuffer=_a.createFramebuffer()),this._source||(this._source=_a.createTexture());var _b=_va.curBindTexTarget,_c=_va.curBindTexValue;_va.bindTexture(_a,3553,this._source),_a.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var _d=this._minFifter,_e=this._magFifter,_f=this._repeat?10497:33071,_g=_k.isPOT(this._w,this._h);if(_g?(this._mipMap?-1!==_d||(_d=9987):-1!==_d||(_d=9729),-1!==_e||(_e=9729),_a.texParameteri(3553,10241,_d),_a.texParameteri(3553,10240,_e),_a.texParameteri(3553,10242,_f),_a.texParameteri(3553,10243,_f),this._mipMap&&_a.generateMipmap(3553)):(-1!==_d||(_d=9729),-1!==_e||(_e=9729),_a.texParameteri(3553,10241,_d),_a.texParameteri(3553,10240,_e),_a.texParameteri(3553,10242,33071),_a.texParameteri(3553,10243,33071)),_a.bindFramebuffer(36160,this._frameBuffer),_a.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=_a.createRenderbuffer()),_a.bindRenderbuffer(36161,this._depthStencilBuffer),_a.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:_a.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:_a.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:_a.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}_a.bindFramebuffer(36160,null),_b&&_c&&_va.bindTexture(_a,_b,_c),_a.bindRenderbuffer(36161,null),_g&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},_b.disposeResource=function(){this._frameBuffer&&(_ua.mainContext.deleteTexture(this._source),_ua.mainContext.deleteFramebuffer(this._frameBuffer),_ua.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},_d(0,_b,"depthStencilBuffer",function(){return this._depthStencilBuffer}),_d(0,_b,"frameBuffer",function(){return this._frameBuffer}),_j}(),_Va=function(_a){function _h(_a,_b,_c,_d,_e,_f,_g){this.offsetX=0,this.offsetY=0,_h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=_f,this.canvas=_a,this._ctx=_a.getContext("2d",void 0),this._w=_d,this._h=_e,this.offsetX=_b,this.offsetY=_c,this.src=_g,this._enableMerageInAtlas=!0,_O.enabled&&this._w<_O.atlasLimitWidth&&this._h<_O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}_m(_h,"laya.webgl.resource.WebGLSubImage",_c);var _b=_h.prototype;return _w.imps(_b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),_b.size=function(_a,_b){this._w=_a,this._h=_b,this._ctx&&this._ctx.size(_a,_b),this.canvas&&(this.canvas.height=_b,this.canvas.width=_a)},_b.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},_b.createWebGlTexture=function(){var _a=_ua.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var _b=this._source=_a.createTexture(),_c=_va.curBindTexTarget,_d=_va.curBindTexValue;_va.bindTexture(_a,3553,_b),_a.pixelStorei(37441,!0),_a.texImage2D(3553,0,6408,6408,5121,this.canvas),_a.pixelStorei(37441,!1);var _e=this.minFifter,_f=this.magFifter,_g=this.repeat?10497:33071,_h=_k.isPOT(this.width,this.height);_h?(this.mipmap?-1!==_e||(_e=9987):-1!==_e||(_e=9729),-1!==_f||(_f=9729),_a.texParameteri(3553,10240,_f),_a.texParameteri(3553,10241,_e),_a.texParameteri(3553,10242,_g),_a.texParameteri(3553,10243,_g),this.mipmap&&_a.generateMipmap(3553)):(-1!==_e||(_e=9729),-1!==_f||(_f=9729),_a.texParameteri(3553,10241,_e),_a.texParameteri(3553,10240,_f),_a.texParameteri(3553,10242,33071),_a.texParameteri(3553,10243,33071)),_c&&_d&&_va.bindTexture(_a,_c,_d),this.canvas=null,_h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},_b.disposeResource=function(){_O.enabled&&this._allowMerageInAtlas||!this._source||(_ua.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},_b.clearAtlasSource=function(){},_d(0,_b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),_d(0,_b,"atlasSource",function(){return this.canvas}),_d(0,_b,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(_a){this._allowMerageInAtlas=_a}),_h}(),_Wa=function(_a){function _j(_a,_b,_c,_d){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,_j.__super.call(this),!_a||!_b)throw"Shader Error";this._id=++_j._count,this._vs=_a,this._ps=_b,this._nameMap=_d||{},null!=_c&&(_j.sharders[_c]=this)}_m(_j,"laya.webgl.shader.Shader",_Ja);var _b=_j.prototype;return _b.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},_b.disposeResource=function(){_ua.mainContext.deleteShader(this._vshader),_ua.mainContext.deleteShader(this._pshader),_ua.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},_b._compile=function(){if(!_ua.mainContext.isContextLost()&&this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var _a=[this._vs,this._ps],_b=_ua.mainContext;if(this._program=_b.createProgram(),this._vshader=_j._createShader(_b,_a[0],35633),this._pshader=_j._createShader(_b,_a[1],35632),_b.attachShader(this._program,this._vshader),_b.attachShader(this._program,this._pshader),_b.linkProgram(this._program),!_r.isConchApp&&!_b.getProgramParameter(this._program,35714))throw _b.getProgramInfoLog(this._program);var _c,_d,_e=0,_f=0;for(_f=_r.isConchApp?_b.getProgramParameterEx(this._vs,this._ps,"",35721):_b.getProgramParameter(this._program,35721),_e=0;_e<_f;_e++){var _g=null;_c={vartype:"attribute",glfun:null,ivartype:0,attrib:_g=_r.isConchApp?_b.getActiveAttribEx(this._vs,this._ps,"",_e):_b.getActiveAttrib(this._program,_e),location:_b.getAttribLocation(this._program,_g.name),name:_g.name,type:_g.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(_c)}var _h=0;for(_h=_r.isConchApp?_b.getProgramParameterEx(this._vs,this._ps,"",35718):_b.getProgramParameter(this._program,35718),_e=0;_e<_h;_e++){var _i=null;_i=_r.isConchApp?_b.getActiveUniformEx(this._vs,this._ps,"",_e):_b.getActiveUniform(this._program,_e),0<(_c={vartype:"uniform",glfun:null,ivartype:1,attrib:_g,location:_b.getUniformLocation(this._program,_i.name),name:_i.name,type:_i.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(_c.name=_c.name.substr(0,_c.name.length-3),_c.isArray=!0,_c.location=_b.getUniformLocation(this._program,_c.name)),this._params.push(_c)}for(_e=0,_d=this._params.length;_e<_d;_e++)if((_c=this._params[_e]).indexOfParams=_e,_c.index=1,_c.value=[_c.location,null],_c.codename=_c.name,_c.name=this._nameMap[_c.codename]?this._nameMap[_c.codename]:_c.codename,(this._paramsMap[_c.name]=_c)._this=this,_c.uploadedValue=[],"attribute"!==_c.vartype)switch(_c.type){case 5124:_c.fun=_c.isArray?this._uniform1iv:this._uniform1i;break;case 5126:_c.fun=_c.isArray?this._uniform1fv:this._uniform1f;break;case 35664:_c.fun=_c.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:_c.fun=_c.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:_c.fun=_c.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:_c.fun=this._uniform_sampler2D;break;case 35680:_c.fun=this._uniform_samplerCube;break;case 35676:_c.glfun=_b.uniformMatrix4fv,_c.fun=this._uniformMatrix4fv;break;case 35670:_c.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else _c.fun=this._attribute}},_b.getUniform=function(_a){return this._paramsMap[_a]},_b._attribute=function(_a,_b){var _c=_ua.mainContext,_d=_La._enableAtributes,_e=_a.location;return _d[_e]||_c.enableVertexAttribArray(_e),_c.vertexAttribPointer(_e,_b[0],_b[1],_b[2],_b[3],_b[4]+this._offset),_d[_e]=_La._bindVertexBuffer,1},_b._uniform1f=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b?(_ua.mainContext.uniform1f(_a.location,_c[0]=_b),1):0},_b._uniform1fv=function(_a,_b){if(_b.length<4){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_ua.mainContext.uniform1fv(_a.location,_b),_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3],1):0}return _ua.mainContext.uniform1fv(_a.location,_b),1},_b._uniform_vec2=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]?(_ua.mainContext.uniform2f(_a.location,_c[0]=_b[0],_c[1]=_b[1]),1):0},_b._uniform_vec2v=function(_a,_b){if(_b.length<2){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_ua.mainContext.uniform2fv(_a.location,_b),_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3],1):0}return _ua.mainContext.uniform2fv(_a.location,_b),1},_b._uniform_vec3=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]?(_ua.mainContext.uniform3f(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2]),1):0},_b._uniform_vec3v=function(_a,_b){return _ua.mainContext.uniform3fv(_a.location,_b),1},_b._uniform_vec4=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_ua.mainContext.uniform4f(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3]),1):0},_b._uniform_vec4v=function(_a,_b){return _ua.mainContext.uniform4fv(_a.location,_b),1},_b._uniformMatrix2fv=function(_a,_b){return _ua.mainContext.uniformMatrix2fv(_a.location,!1,_b),1},_b._uniformMatrix3fv=function(_a,_b){return _ua.mainContext.uniformMatrix3fv(_a.location,!1,_b),1},_b._uniformMatrix4fv=function(_a,_b){return _ua.mainContext.uniformMatrix4fv(_a.location,!1,_b),1},_b._uniform1i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b?(_ua.mainContext.uniform1i(_a.location,_c[0]=_b),1):0},_b._uniform1iv=function(_a,_b){return _ua.mainContext.uniform1iv(_a.location,_b),1},_b._uniform_ivec2=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]?(_ua.mainContext.uniform2i(_a.location,_c[0]=_b[0],_c[1]=_b[1]),1):0},_b._uniform_ivec2v=function(_a,_b){return _ua.mainContext.uniform2iv(_a.location,_b),1},_b._uniform_vec3i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]?(_ua.mainContext.uniform3i(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2]),1):0},_b._uniform_vec3vi=function(_a,_b){return _ua.mainContext.uniform3iv(_a.location,_b),1},_b._uniform_vec4i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_ua.mainContext.uniform4i(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3]),1):0},_b._uniform_vec4vi=function(_a,_b){return _ua.mainContext.uniform4iv(_a.location,_b),1},_b._uniform_sampler2D=function(_a,_b){var _c=_ua.mainContext,_d=_a.uploadedValue;return null==_d[0]?(_d[0]=this._curActTexIndex,_c.uniform1i(_a.location,this._curActTexIndex),_c.activeTexture(_j._TEXTURES[this._curActTexIndex]),_va.bindTexture(_c,3553,_b),this._curActTexIndex++,1):(_c.activeTexture(_j._TEXTURES[_d[0]]),_va.bindTexture(_c,3553,_b),0)},_b._uniform_samplerCube=function(_a,_b){var _c=_ua.mainContext,_d=_a.uploadedValue;return null==_d[0]?(_d[0]=this._curActTexIndex,_c.uniform1i(_a.location,this._curActTexIndex),_c.activeTexture(_j._TEXTURES[this._curActTexIndex]),_va.bindTexture(_c,34067,_b),this._curActTexIndex++,1):(_c.activeTexture(_j._TEXTURES[_d[0]]),_va.bindTexture(_c,34067,_b),0)},_b._noSetValue=function(_a){console.log("no....:"+_a.name)},_b.uploadOne=function(_a,_b){this.activeResource(),_va.UseProgram(this._program);var _c=this._paramsMap[_a];_c.fun.call(this,_c,_b)},_b.uploadTexture2D=function(_a){_E.shaderCall++;var _b=_ua.mainContext;_b.activeTexture(33984),_va.bindTexture(_b,3553,_a)},_b.uploadTexture2D1=function(_a){_E.shaderCall++;var _b=_ua.mainContext;_b.activeTexture(33985),_va.bindTexture(_b,3553,_a)},_b.upload=function(_a,_b){_Ja.activeShader=_Ja.bindShader=this,this._lastUseFrameCount===_E.loopCount||this.activeResource(),_va.UseProgram(this._program),this._reCompile?(_b=this._params,this._reCompile=!1):_b=_b||this._params;_ua.mainContext;for(var _c,_d,_e=_b.length,_f=0,_g=0;_g<_e;_g++)null!==(_d=_a[(_c=_b[_g]).name])&&(_f+=_c.fun.call(this,_c,_d));_E.shaderCall+=_f},_b.uploadArray=function(_a,_b,_c){_Ja.activeShader=this,(_Ja.bindShader=this).activeResource(),_va.UseProgram(this._program);this._params;for(var _d,_e,_f=0,_g=_b-2;0<=_g;_g-=2)(_e=this._paramsMap[_a[_g]])&&null!=(_d=_a[_g+1])&&(_c&&_c[_e.name]&&_c[_e.name].bind(),_f+=_e.fun.call(this,_e,_d));_E.shaderCall+=_f},_b.getParams=function(){return this._params},_j.getShader=function(_a){return _j.sharders[_a]},_j.create=function(_a,_b,_c,_d){return new _j(_a,_b,_c,_d)},_j.withCompile=function(_a,_b,_c,_d){if(_c&&_j.sharders[_c])return _j.sharders[_c];var _e=_j._preCompileShader[2e-4*_a];if(!_e)throw new Error("withCompile shader err!"+_a);return _e.createShader(_b,_c,_d)},_j.withCompile2D=function(_a,_b,_c,_d,_e){if(_d&&_j.sharders[_d])return _j.sharders[_d];var _f=_j._preCompileShader[2e-4*_a+_b];if(!_f)throw new Error("withCompile shader err!"+_a+" "+_b);return _f.createShader(_c,_d,_e)},_j.addInclude=function(_a,_b){_ta.addInclude(_a,_b)},_j.preCompile=function(_a,_b,_c,_d){var _e=2e-4*_a;_j._preCompileShader[_e]=new _ta(_e,_b,_c,_d)},_j.preCompile2D=function(_a,_b,_c,_d,_e){var _f=2e-4*_a+_b;_j._preCompileShader[_f]=new _ta(_f,_c,_d,_e)},_j._createShader=function(_a,_b,_c){var _d=_a.createShader(_c);return _a.shaderSource(_d,_b),_a.compileShader(_d),_d},_j._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],_j._count=0,_j._preCompileShader={},_j.SHADERNAME2ID=2e-4,_j.sharders=((_j.sharders=[]).length=32,_j.sharders),_g(_j,["nameKey",function(){return this.nameKey=new _F}]),_j}(),_Xa=function(_a){function _b(){this._maxsize=0,this._upload=!0,this._uploadSize=0,_b.__super.call(this),this.lock=!0,this.uri="Buffer2D_"+this.id}_m(_b,"laya.webgl.utils.Buffer2D",_a);var _c=_b.prototype;return _c.needSize=function(_a){var _b=this._byteLength;if(_a){var _c=this._byteLength+_a;_c<=this._buffer.byteLength||this._resizeBuffer(_c<<1,!0),this._byteLength=_c}return _b},_c._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),_E.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,_La._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),_La._gl.bufferSubData(this._bufferType,0,this._buffer)},_c._bufferSubData=function(_a,_b,_c){if(void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),this._maxsize=Math.max(this._maxsize,this._byteLength),_E.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,_La._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),_b||_c){var _d=this._buffer.slice(_b,_c);_La._gl.bufferSubData(this._bufferType,_a,_d)}else _La._gl.bufferSubData(this._bufferType,_a,this._buffer)},_c._checkArrayUse=function(){},_c._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},_c._bind_subUpload=function(_a,_b,_c){return void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(_a,_b,_c),!0)},_c._resizeBuffer=function(_a,_b){if(_a<this._buffer.byteLength)return this;if(this.memorySize=_a,_b&&this._buffer&&0<this._buffer.byteLength){var _c=new ArrayBuffer(_a);new Uint8Array(_c).set(new Uint8Array(this._buffer),0),this._buffer=_c}else this._buffer=new ArrayBuffer(_a);return this._checkArrayUse(),this._upload=!0,this},_c.append=function(_a){this._upload=!0;var _b,_c;_b=_a.byteLength,_a instanceof Uint8Array?(this._resizeBuffer(this._byteLength+_b,!0),_c=new Uint8Array(this._buffer,this._byteLength)):_a instanceof Uint16Array?(this._resizeBuffer(this._byteLength+_b,!0),_c=new Uint16Array(this._buffer,this._byteLength)):_a instanceof Float32Array&&(this._resizeBuffer(this._byteLength+_b,!0),_c=new Float32Array(this._buffer,this._byteLength)),_c.set(_a,0),this._byteLength+=_b,this._checkArrayUse()},_c.appendU16Array=function(_a,_b){this._resizeBuffer(this._byteLength+2*_b,!0);for(var _c=new Uint16Array(this._buffer,this._byteLength,_b),_d=0;_d<_b;_d++)_c[_d]=_a[_d];this._byteLength+=2*_b,this._checkArrayUse()},_c.appendEx=function(_a,_b){this._upload=!0;var _c;_c=_a.byteLength,this._resizeBuffer(this._byteLength+_c,!0),new _b(this._buffer,this._byteLength).set(_a,0),this._byteLength+=_c,this._checkArrayUse()},_c.appendEx2=function(_a,_b,_c,_d){void 0===_d&&(_d=1),this._upload=!0;var _e,_f;_e=_c*_d,this._resizeBuffer(this._byteLength+_e,!0),_f=new _b(this._buffer,this._byteLength);var _g=0;for(_g=0;_g<_c;_g++)_f[_g]=_a[_g];this._byteLength+=_e,this._checkArrayUse()},_c.getBuffer=function(){return this._buffer},_c.setNeedUpload=function(){this._upload=!0},_c.getNeedUpload=function(){return this._upload},_c.upload=function(){var _a=this._bind_upload();return _La._gl.bindBuffer(this._bufferType,null),_La._bindActive[this._bufferType]=null,_Ja.activeShader=null,_a},_c.subUpload=function(_a,_b,_c){void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0);var _d=this._bind_subUpload();return _La._gl.bindBuffer(this._bufferType,null),_La._bindActive[this._bufferType]=null,_Ja.activeShader=null,_d},_c.disposeResource=function(){_a.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},_c.clear=function(){this._byteLength=0,this._upload=!0},_d(0,_c,"bufferLength",function(){return this._buffer.byteLength}),_d(0,_c,"byteLength",null,function(_a){this._byteLength!==_a&&(_a<=this._buffer.byteLength||this._resizeBuffer(2*_a+256,!0),this._byteLength=_a)}),_b.__int__=function(_a){_$a.QuadrangleIB=_$a.create(35044),_qa.fillIBQuadrangle(_$a.QuadrangleIB,16)},_b.FLOAT32=4,_b.SHORT=2,_b}(_La),_Ya=(function(_b){function _c(_a){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,_c.__super.call(this,9)}_m(_c,"laya.webgl.shader.d2.value.GlowSV",_b);var _a=_c.prototype;_a.setValue=function(_a){_b.prototype.setValue.call(this,_a)},_a.clear=function(){_b.prototype.clear.call(this)}}(_Pa),function(_a){function _b(_a){_b.__super.call(this,64),this.defines.add(64)}_m(_b,"laya.webgl.shader.d2.value.TextSV",_a);var _c=_b.prototype;return _c.release=function(){(_b.pool[_b._length++]=this).clear()},_c.clear=function(){_a.prototype.clear.call(this)},_b.create=function(){return _b._length?_b.pool[--_b._length]:new _b(null)},_b.pool=[],_b._length=0,_b}(_Pa)),_Za=function(_a){function _e(_a,_b,_c,_d){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,_e.__super.call(this,_a,_b,_c,_d)}_m(_e,"laya.webgl.shader.d2.Shader2X",_a);var _b=_e.prototype;return _b.upload2dQuick1=function(_a){this.upload(_a,this._params2dQuick1||this._make2dQuick1())},_b._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var _a,_b=this._params,_c=0,_d=_b.length;_c<_d;_c++)_a=_b[_c],(_r.isFlash||"size"!==_a.name&&"position"!==_a.name&&"texcoord"!==_a.name)&&this._params2dQuick1.push(_a)}return this._params2dQuick1},_b.disposeResource=function(){_a.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},_b.upload2dQuick2=function(_a){this.upload(_a,this._params2dQuick2||this._make2dQuick2())},_b._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var _a,_b=this._params,_c=0,_d=_b.length;_c<_d;_c++)_a=_b[_c],(_r.isFlash||"size"!==_a.name)&&this._params2dQuick2.push(_a)}return this._params2dQuick2},_e.create=function(_a,_b,_c,_d){return new _e(_a,_b,_c,_d)},_e}(_Wa),_$a=function(_a){function _b(_a){this._uint8Array=null,this._uint16Array=null,void 0===_a&&(_a=35044),_b.__super.call(this),this._bufferUsage=_a,this._bufferType=34963,_r.isFlash||(this._buffer=new ArrayBuffer(8))}_m(_b,"laya.webgl.utils.IndexBuffer2D",_Xa);var _c=_b.prototype;return _c._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},_c.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},_c.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},_c.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},_b.QuadrangleIB=null,_b.create=function(_a){return void 0===_a&&(_a=35044),new _b(_a)},_b}(),__a=function(_a){function _c(_a,_b){this._floatArray32=null,this._vertexStride=0,_c.__super.call(this),this._vertexStride=_a,this._bufferUsage=_b,this._bufferType=34962,_r.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}_m(_c,"laya.webgl.utils.VertexBuffer2D",_a);var _b=_c.prototype;return _b.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},_b.bind=function(_a){_a&&_a._bind(),this._bind()},_b.insertData=function(_a,_b){this.getFloat32Array().set(_a,_b),this._upload=!0},_b.bind_upload=function(_a){_a._bind_upload()||_a._bind(),this._bind_upload()||this._bind()},_b._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},_b.disposeResource=function(){_a.prototype.disposeResource.call(this)},_b.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},_d(0,_b,"vertexStride",function(){return this._vertexStride}),_c.create=function(_a,_b){return void 0===_b&&(_b=35048),new _c(_a,_b)},_c}(_Xa),_ab=function(_a){function _h(_a,_b,_c,_d,_e,_f){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===_c&&(_c=6408),void 0===_d&&(_d=!0),_h.__super.call(this,_a,_b),_a){if(this._format=_c,this._mipmap=_d,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof _a)this._url=_a,this._src=_a,this._image=new _n.window.Image,_b&&(_b.onload&&(this.onload=_b.onload),_b.onerror&&(this.onerror=_b.onerror),_b.onCreate&&_b.onCreate(this)),this._image.crossOrigin=_a&&0==_a.indexOf("data:")?null:"",_a&&(this._image.src=_a);else if(_a instanceof ArrayBuffer){this._src=_b,this._url=this._src;var _g=new _i(_a);_g.readUTFBytes(4),_g.readUTFBytes(2),_g.getInt16();_g.endian="bigEndian",this._w=_g.getInt16(),this._h=_g.getInt16();_g.getInt16(),_g.getInt16();this._image=new Uint8Array(_a,_g.pos),this._format=_ua.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,_O.enabled&&this._w<_O.atlasLimitWidth&&this._h<_O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else{if(!(_a instanceof Uint8Array))return this._src=_b,this._url=this._src,this._image=_a.source||_a,this._$5__enableMerageInAtlas=!1,void this.onresize();this._src=_b,this._url=this._src,this._w=_e,this._h=_f,this._image=_a,this._format=0===_c?_a.byteLength/(_e*_f)==4?6408:6407:_c}this._$5__enableMerageInAtlas=!0}}_m(_h,"laya.webgl.resource.WebGLImage",_p);var _b=_h.prototype;return _w.imps(_b,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),_b._init_=function(_a,_b){},_b._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var _a=_ua.mainContext,_b=this._source=_a.createTexture(),_c=_va.curBindTexTarget,_d=_va.curBindTexValue;_va.bindTexture(_a,3553,_b);var _e=this.minFifter,_f=this.magFifter,_g=this.repeat?10497:33071,_h=_k.isPOT(this._w,this._h),_i=!1;switch(_h?(this.mipmap?-1!==_e||(_e=9987):-1!==_e||(_e=9729),-1!==_f||(_f=9729),_a.texParameteri(3553,10241,_e),_a.texParameteri(3553,10240,_f),_a.texParameteri(3553,10242,_g),_a.texParameteri(3553,10243,_g),this.mipmap&&_a.generateMipmap(3553)):(-1!==_e||(_e=9729),-1!==_f||(_f=9729),_a.texParameteri(3553,10241,_e),_a.texParameteri(3553,10240,_f),_a.texParameteri(3553,10242,33071),_a.texParameteri(3553,10243,33071)),_a.pixelStorei(37441,!0),this._format){case 6407:case 6408:this._image instanceof Uint8Array?(6407==this._format&&_a.pixelStorei(_a.UNPACK_ALIGNMENT,1),_a.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image)):(6407==this._format&&_a.pixelStorei(_a.UNPACK_ALIGNMENT,1),_a.texImage2D(3553,0,this._format,this._format,5121,this._image));break;case 6406:_i=!0,_a.texImage2D(3553,0,this._format,this._w,this._h,0,this._format,5121,this._image);break;case 35840:case 35841:case 35842:case 35843:case 33779:case 37815:case 37812:case 37821:case _ua.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:_i=!0,_a.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}_a.pixelStorei(37441,!1),_c&&_d&&_va.bindTexture(_a,_c,_d),this.uri||(this.uri=this._url),_i?this.memorySize=this._image.length:_h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._image.onload=null,this._image=null,this._recreateLock=!1},_b.recreateResource=function(){var _a=this;if(this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var _b=this;this._image=new _n.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(_b._needReleaseAgain)return _b._needReleaseAgain=!1,_b._image.onload=null,void(_b._image=null);_b._allowMerageInAtlas&&_b._enableMerageInAtlas?(_a.memorySize=0,_a._recreateLock=!1):_b._createWebGlTexture(),_b.completeCreate()},this._image.src=this._src}},_b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&_ua.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0},_b.onresize=function(){this._w=this._image.width,this._h=this._image.height,_O.enabled&&this._w<_O.atlasLimitWidth&&this._h<_O.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},_b.clearAtlasSource=function(){this._image=null},_d(0,_b,"format",function(){return this._format}),_d(0,_b,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(_a){this._$5__enableMerageInAtlas=_a}),_d(0,_b,"mipmap",function(){return this._mipmap}),_d(0,_b,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),_d(0,_b,"atlasSource",function(){return this._image}),_d(0,_b,"onload",null,function(_a){var _b=this;this._onload=_a,this._image&&(this._image.onload=null!=this._onload?function(){_b.onresize(),_b._onload()}:null)}),_d(0,_b,"onerror",null,function(_a){var _b=this;this._onerror=_a,this._image&&(this._image.onerror=null!=this._onerror?function(){_b._onerror()}:null)}),_h}();_w.__init([_na,_N,_xa,_ta])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(_f,_a,_d){_d.un,_d.uns;var _e=_d.static,_g=_d.class,_h=_d.getset,_i=(_d.__newvec,laya.utils.Browser,laya.display.css.CSSStyle),_o=laya.utils.ClassUtils,_l=(laya.events.Event,laya.utils.HTMLChar),_j=laya.net.Loader,_k=(laya.display.Node,laya.maths.Rectangle),_m=laya.renders.Render,_n=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.display.Sprite),_p=laya.utils.Stat,_J=laya.display.Text,_q=laya.resource.Texture,_r=laya.net.URL,_s=laya.utils.Utils,_t=function(){function _n(){}return _g(_n,"laya.html.utils.HTMLParse"),_n.parse=function(_a,_b,_c){_b=(_b="<root>"+(_b=_b.replace(/<br>/g,"<br/>"))+"</root>").replace(_n.spacePattern,_n.char255);var _d=_s.parseXMLFromString(_b);_n._parseXML(_a,_d.childNodes[0].childNodes,_c)},_n._parseXML=function(_a,_b,_c,_d){var _e=0,_f=0;if(_b.join||_b.item)for(_e=0,_f=_b.length;_e<_f;++_e)_n._parseXML(_a,_b[_e],_c,_d);else{var _g,_h,_i;if(3==_b.nodeType)return void(_a instanceof laya.html.dom.HTMLDivElement?(null==_b.nodeName&&(_b.nodeName="#text"),_h=_b.nodeName.toLowerCase(),0<(_i=_b.textContent.replace(/^\s+|\s+$/g,"")).length&&(_g=_o.getInstance(_h))&&(_a.addChild(_g),_g.innerTEXT=_i.replace(_n.char255AndOneSpacePattern," "))):0<(_i=_b.textContent.replace(/^\s+|\s+$/g,"")).length&&(_a.innerTEXT=_i.replace(_n.char255AndOneSpacePattern," ")));if("#comment"==(_h=_b.nodeName.toLowerCase()))return;if(_g=_o.getInstance(_h)){(_g=_a.addChild(_g)).URI=_c,_g.href=_d;var _j=_b.attributes;if(_j&&0<_j.length)for(_e=0,_f=_j.length;_e<_f;++_e){var _k=_j[_e],_l=_k.nodeName,_m=_k.value;_g._setAttributes(_l,_m)}_n._parseXML(_g,_b.childNodes,_c,_g.href)}else _n._parseXML(_a,_b.childNodes,_c,_d)}},_n.char255=String.fromCharCode(255),_n.spacePattern=/&nbsp;|&#160;/g,_n.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),_n}(),_u=function(){function _I(){}return _g(_I,"laya.html.utils.Layout"),_I.later=function(_a){null==_I._will&&(_I._will=[],_d.stage.frameLoop(1,null,function(){if(!(_I._will.length<1)){for(var _a=0;_a<_I._will.length;_a++)laya.html.utils.Layout.layout(_I._will[_a]);_I._will.length=0}})),_I._will.push(_a)},_I.layout=function(_a){if(!_a||!_a._style)return null;if(0==(512&_a._style._type))return null;_a.getStyle()._type&=-513;var _b=_I._multiLineLayout(_a);return _m.isConchApp&&_a.layaoutCallNative&&_a.layaoutCallNative(),_b},_I._multiLineLayout=function(_a){if(_J.RightToLeft)return _I._multiLineLayout2(_a);var _b=new Array;_a._addChildsToLayout(_b);var _c,_d,_e,_f,_g,_h=0,_i=_b.length,_j=_a._getCSSStyle(),_k=_j.letterSpacing,_l=_j.leading,_m=_j.lineHeight,_n=_j._widthAuto()||!_j.wordWrap,_o=_n?999999:_a.width,_p=(_a.height,0),_q=_j.italic?_j.fontSize/3:0,_r=_j._getAlign(),_s=_j._getValign(),_t=0!==_s||0!==_r||0!=_m,_u=0,_v=0,_w=0,_x=0,_y=new Array,_z=_y[0]=new _K,_A=!1,_B=!1;_z.h=0,_j.italic&&(_o-=_j.fontSize/3);var _C=0,_D=!0;function _E(){_z.y=_v,_v+=_z.h+_l,0==_z.h&&(_v+=_m),_z.mWidth=_C,_C=0,_z=new _K,_y.push(_z),_z.h=0,_A=!(_D=!(_u=0))}for(_h=0;_h<_i;_h++)if(null!=(_c=_b[_h]))if(_D=!1,_c instanceof laya.html.dom.HTMLBrElement)_E(),_z.y=_v;else{if(_c._isChar()){if((_f=_c).isWord)_A=_B||"\n"===_f.char,_z.wordStartIndex=_z.elements.length;else{if(_w=_f.width+_f.style.letterSpacin,0<_y.length&&_o<_u+_w&&0<_z.wordStartIndex){var _F;_F=_z.elements.length-_z.wordStartIndex+1,_z.elements.length=_z.wordStartIndex,_h-=_F,_E();continue}_A=!1,_C+=_f.width}_w=_f.width+_k,_x=_f.height,_B=!1,(_A=_A||_o<_u+_w)&&_E(),_z.minTextHeight=Math.min(_z.minTextHeight,_c.height)}else _d=_c._getCSSStyle(),_g=_c,_e=_d.padding,0===_d._getCssFloat()||(_t=!0),_A=_B||_d.lineElement,_w=_g.width*_g._style._tf.scaleX+_e[1]+_e[3]+_k,_x=_g.height*_g._style._tf.scaleY+_e[0]+_e[2],_B=_d.lineElement,(_A=_A||_o<_u+_w&&_d.wordWrap)&&_E();_z.elements.push(_c),_z.h=Math.max(_z.h,_x),_c.x=_u,_c.y=_v,_u+=_w,_z.w=_u-_k,_z.y=_v,_p=Math.max(_u+_q,_p)}else _D||(_u+=_I.DIV_ELEMENT_PADDING),_z.wordStartIndex=_z.elements.length;if(_v=_z.y+_z.h,_t){var _G=0,_H=_o;for(_n&&0<_a.width&&(_H=_a.width),_h=0,_i=_y.length;_h<_i;_h++)_y[_h].updatePos(0,_H,_h,_G,_r,_s,_m),_G+=Math.max(_m,_y[_h].h+_l);_v=_G}return _n&&(_a.width=_p),_v>_a.height&&(_a.height=_v),[_p,_v]},_I._multiLineLayout2=function(_a){var _b=new Array;_a._addChildsToLayout(_b);var _c,_d,_e,_f,_g,_h=0,_i=_b.length,_j=_a._getCSSStyle(),_k=_j.letterSpacing,_l=_j.leading,_m=_j.lineHeight,_n=_j._widthAuto()||!_j.wordWrap,_o=_n?999999:_a.width,_p=(_a.height,0),_q=_j.italic?_j.fontSize/3:0,_r=2-_j._getAlign(),_s=_j._getValign(),_t=0!==_s||0!=_r||0!=_m,_u=0,_v=0,_w=0,_x=0,_y=new Array,_z=_y[0]=new _K,_A=!1,_B=!1;_z.h=0,_j.italic&&(_o-=_j.fontSize/3);var _C=0,_D=!0;function _E(){_z.y=_v,_v+=_z.h+_l,0==_z.h&&(_v+=_m),_z.mWidth=_C,_C=0,_z=new _K,_y.push(_z),_z.h=0,_A=!(_D=!(_u=0))}for(_h=0;_h<_i;_h++)if(null!=(_c=_b[_h]))if(_D=!1,_c instanceof laya.html.dom.HTMLBrElement)_E(),_z.y=_v;else{if(_c._isChar()){if((_f=_c).isWord)_A=_B||"\n"===_f.char,_z.wordStartIndex=_z.elements.length;else{if(0<_y.length&&_o<_u+_w&&0<_z.wordStartIndex){var _F;_F=_z.elements.length-_z.wordStartIndex+1,_z.elements.length=_z.wordStartIndex,_h-=_F,_E();continue}_A=!1,_C+=_f.width}_w=_f.width+_k,_x=_f.height,_B=!1,(_A=_A||_o<_u+_w)&&_E(),_z.minTextHeight=Math.min(_z.minTextHeight,_c.height)}else _d=_c._getCSSStyle(),_g=_c,_e=_d.padding,0===_d._getCssFloat()||(_t=!0),_A=_B||_d.lineElement,_w=_g.width*_g._style._tf.scaleX+_e[1]+_e[3]+_k,_x=_g.height*_g._style._tf.scaleY+_e[0]+_e[2],_B=_d.lineElement,(_A=_A||_o<_u+_w&&_d.wordWrap)&&_E();_z.elements.push(_c),_z.h=Math.max(_z.h,_x),_c.x=_u,_c.y=_v,_u+=_w,_z.w=_u-_k,_z.y=_v,_p=Math.max(_u+_q,_p)}else _D||(_u+=_I.DIV_ELEMENT_PADDING),_z.wordStartIndex=_z.elements.length;if(_v=_z.y+_z.h,_t){var _G=0,_H=_o;for(_h=0,_i=_y.length;_h<_i;_h++)_y[_h].updatePos(0,_H,_h,_G,_r,_s,_m),_G+=Math.max(_m,_y[_h].h+_l);_v=_G}for(_n&&(_a.width=_p),_v>_a.height&&(_a.height=_v),_h=0,_i=_y.length;_h<_i;_h++)_y[_h].revertOrder(_o);return[_p,_v]},_I._will=null,_I.DIV_ELEMENT_PADDING=0,_I}(),_K=function(){function _a(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}_g(_a,"laya.html.utils.LayoutLine");var _b=_a.prototype;return _b.updatePos=function(_a,_b,_c,_d,_e,_f,_g){var _h,_i=0;0<this.elements.length&&(_i=(_h=this.elements[this.elements.length-1]).x+_h.width-this.elements[0].x);var _j=0,_k=NaN;1===_e&&(_j=(_b-_i)/2),2===_e&&(_j=_b-_i),0===_g||0!=_f||(_f=1);for(var _l=0,_m=this.elements.length;_l<_m;_l++){var _n=(_h=this.elements[_l])._getCSSStyle();switch(0!==_j&&(_h.x+=_j),_n._getValign()){case 0:_h.y=_d;break;case 1:var _o=0;99999!=this.minTextHeight&&(_o=this.minTextHeight);var _p=(_o+_g)/2;_p=Math.max(_p,this.h),_k=(laya.html.dom.HTMLImageElement,_d+_p-_h.height),_h.y=_k;break;case 2:_h.y=_d+(_g-_h.height)}}},_b.revertOrder=function(_a){var _b;if(0<this.elements.length){var _c,_d=0;for(_c=this.elements.length,_d=0;_d<_c;_d++)(_b=this.elements[_d]).x=_a-_b.x-_b.width}},_a}(),_v=function(_c){function _b(){this.URI=null,this._href=null,_b.__super.call(this),this._text=_b._EMPTYTEXT,this.setStyle(new _i(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}_g(_b,"laya.html.dom.HTMLElement",_c);var _a=_b.prototype;return _a.layaoutCallNative=function(){var _a=0;if(this._childs&&0<(_a=this._childs.length))for(var _b=0;_b<_a;_b++)this._childs[_b].layaoutCallNative&&this._childs[_b].layaoutCallNative();var _c=this._getWords();_c?laya.html.dom.HTMLElement.fillWords(this,_c,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear()},_a.appendChild=function(_a){return this.addChild(_a)},_a._getWords2=function(){var _a=this._text.text;if(!_a||0===_a.length)return null;var _b,_c,_d=0,_e=0;if(this._text.drawWords)_c=this._text.drawWords;else{for(_e=(_b=_a.split(" ")).length-1,_c=[],_d=0;_d<_e;_d++)_c.push(_b[_d]," ");0<=_e&&_c.push(_b[_e]),this._text.drawWords=_c}var _f,_g=this._text.words;if(_g&&_g.length===_c.length)return _g;null===_g&&(this._text.words=_g=[]),_g.length=_c.length;var _h=this.style,_i=_h.font;for(_d=0,_e=_c.length;_d<_e;_d++){_f=_s.measureText(_c[_d],_i);var _j=_g[_d]=new _l(_c[_d],_f.width,_f.height||_h.fontSize,_h);if(1<_j.char.length&&(_j.charNum=_j.char),this.href){var _k=new _n;this.addChild(_k),_j.setSprite(_k)}}return _g},_a._getWords=function(){if(!_J.CharacterCache)return this._getWords2();var _a=this._text.text;if(!_a||0===_a.length)return null;var _b,_c=this._text.words;if(_c&&_c.length===_a.length)return _c;null===_c&&(this._text.words=_c=[]),_c.length=_a.length;for(var _d=this.style,_e=_d.font,_f=0,_g=_a.length;_f<_g;_f++)if(_b=_s.measureText(_a.charAt(_f),_e)){var _h=_c[_f]=new _l(_a.charAt(_f),_b.width,_b.height||_d.fontSize,_d);if(this.href){var _i=new _n;this.addChild(_i),_h.setSprite(_i)}}else console.warn("_getWords size is null"+_a.charAt(_f),_e);return _c},_a.showLinkSprite=function(){var _a=this._text.words;if(_a)for(var _b,_c,_d=[],_e=0;_e<_a.length;_e++)_c=_a[_e],(_b=new _n).graphics.drawRect(0,0,_c.width,_c.height,"#ff0000"),_b.width=_c.width,_b.height=_c.height,this.addChild(_b),_d.push(_b)},_a._layoutLater=function(){var _a=this.style;512&_a._type||(_a.widthed(this)&&(0<this._childs.length||null!=this._getWords())&&_a.block?(_u.later(this),_a._type|=512):this.parent&&this.parent._layoutLater())},_a._setAttributes=function(_a,_b){switch(_a){case"style":return void this.style.cssText(_b);case"class":return void(this.className=_b)}_c.prototype._setAttributes.call(this,_a,_b)},_a.updateHref=function(){if(null!=this._href){var _a=this._getWords();if(_a)for(var _b,_c,_d=0;_d<_a.length;_d++)(_c=(_b=_a[_d]).getSprite())&&(_c.size(_b.width,_b.height),_c.on("click",this,this.onLinkHandler))}},_a.onLinkHandler=function(_a){switch(_a.type){case"click":for(var _b=this;_b;)_b.event("link",[this.href]),_b=_b.parent}},_a.formatURL=function(_a){return this.URI?_r.formatURL(_a,this.URI?this.URI.path:null):_a},_h(0,_a,"href",function(){return this._href},function(_a){null!=(this._href=_a)&&(this._getCSSStyle().underLine=1,this.updateHref())}),_h(0,_a,"color",null,function(_a){this.style.color=_a}),_h(0,_a,"onClick",null,function(_a){_d._runScript("fn=function(event){"+_a+";}"),this.on("click",this,void 0)}),_h(0,_a,"id",null,function(_a){_w.document.setElementById(_a,this)}),_h(0,_a,"innerTEXT",function(){return this._text.text},function(_a){this.text=_a}),_h(0,_a,"style",function(){return this._style}),_h(0,_a,"text",function(){return this._text.text},function(_a){this._text==_b._EMPTYTEXT?this._text={text:_a,words:null}:(this._text.text=_a,this._text.words&&(this._text.words.length=0)),_m.isConchApp&&this.layaoutCallNative(),this._renderType|=2048,this.repaint(),this.updateHref()}),_h(0,_a,"parent",_c.prototype._$get_parent,function(_a){if(_a instanceof laya.html.dom.HTMLElement){var _b=_a;this.URI||(this.URI=_b.URI),this.style.inherit(_b.style)}_d.superSet(_n,this,"parent",_a)}),_h(0,_a,"className",null,function(_a){this.style.attrs(_w.document.styleSheets["."+_a])}),_b.fillWords=function(_a,_b,_c,_d,_e,_f,_g){_a.graphics.clear();for(var _h=0,_i=_b.length;_h<_i;_h++){var _j=_b[_h];_a.graphics.fillText(_j.char,_j.x+_c,_j.y+_d,_e,_f,"left",_g)}},_b._EMPTYTEXT={text:null,words:null},_b}(_n),_b=(function(_a){function _b(){_b.__super.call(this),this.style.lineElement=!0,this.style.block=!0}_g(_b,"laya.html.dom.HTMLBrElement",_v)}(),function(_a){function _b(){this.contextHeight=NaN,this.contextWidth=NaN,_b.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}_g(_b,"laya.html.dom.HTMLDivElement",_a);var _c=_b.prototype;return _c.appendHTML=function(_a){_t.parse(this,_a,this.URI),this.layout()},_c._addChildsToLayout=function(_b){var _a=this._getWords();if(null==_a&&0==this._childs.length)return!1;_a&&_a.forEach(function(_a){_b.push(_a)});for(var _c=!0,_d=0,_e=this._childs.length;_d<_e;_d++){var _f=this._childs[_d];_c?_c=!1:_b.push(null),_f._addToLayout(_b)}return!0},_c._addToLayout=function(_a){this.layout()},_c.layout=function(){if(this.style){this.style._type|=512;var _a=_u.layout(this);if(_a){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new _k);var _b=this._$P.mHtmlBounds;_b.x=_b.y=0,_b.width=this.contextWidth=_a[0],_b.height=this.contextHeight=_a[1],this.setBounds(_b)}}},_h(0,_c,"height",function(){return this._height?this._height:this.contextHeight},_a.prototype._$set_height),_h(0,_c,"innerHTML",null,function(_a){this.destroyChildren(),this.appendHTML(_a)}),_h(0,_c,"width",function(){return this._width?this._width:this.contextWidth},function(_a){var _b=!1;_b=0===_a?_a!=this._width:_a!=this.width,_d.superSet(_v,this,"width",_a),_b&&this.layout()}),_b}(_v)),_w=function(_a){function _b(){this.all=new Array,this.styleSheets=_i.styleSheets,_b.__super.call(this)}_g(_b,"laya.html.dom.HTMLDocument",_v);var _c=_b.prototype;return _c.getElementById=function(_a){return this.all[_a]},_c.setElementById=function(_a,_b){this.all[_a]=_b},_e(_b,["document",function(){return this.document=new _b}]),_b}();(function(_a){function _b(){this._tex=null,this._url=null,this._renderArgs=[],_b.__super.call(this),this.style.block=!0}_g(_b,"laya.html.dom.HTMLImageElement",_v);var _c=_b.prototype;_c._addToLayout=function(_a){!this._style.absolute&&_a.push(this)},_c.render=function(_a,_b,_c){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(_p.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,_a.ctx.drawTexture2(_b,_c,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},_c.layaoutCallNative=function(){var _a=0;if(this._childs&&0<(_a=this._childs.length))for(var _b=0;_b<_a;_b++)this._childs[_b].layaoutCallNative&&this._childs[_b].layaoutCallNative()},_h(0,_c,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(_a){this._width!==_a&&(this._width=_a,this._style.width=_a,this.repaint())}),_h(0,_c,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(_a){this._height!==_a&&(this._height=_a,this._style.height=_a,this.repaint())}),_c.destroy=function(){null!=this._tex&&(this._tex.off("loaded",this,this.onloaded),_j.clearCache(this,this._url),this._tex=null),_v.prototype.destroy.call(this)},_c.onloaded=function(){var _a=this._style;_a&&!_a.widthed(this)&&this._width!=this._tex.width&&(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),_a&&!_a.heighted(this)&&this._height!=this._tex.height&&(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),_m.isConchApp&&(this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,this.graphics.drawTexture(this._tex,0,0,this._renderArgs[3],this._renderArgs[4])),this.repaint(),this.parentRepaint()},_c._loadImageComplete=function(_a,_b,_c){if(!this._destroyed)if(null!=_c)if(_c instanceof ArrayBuffer){var _d=new DataView(_c);new laya.webgl.resource.WebGLImage(new Uint8Array(_c,8),_a,0,!1,_d.getUint32(0),_d.getUint32(4));this.onloaded()}else if(_c instanceof _q)_j.imgMgrSet[_a]=_b,_f.imgMgrLock(_a,_j.imgMgrSet[_a]),this._url=_a,this._tex=_c,_j.keepCache(this,_a),_j.cacheRes(_a,this._tex),this.onloaded();else{var _e=-1!=_a.indexOf(".png",_a.length-4)?6408:6407;new laya.webgl.resource.WebGLImage(_c,_a,_e,!1,_c.width,_c.height);this.onloaded()}else this.event("error","Load image failed")},_h(0,_c,"src",null,function(_a){(_a=this.formatURL(_a),this._url!=_a)&&(null!=this._tex&&(_j.clearCache(this,this._url),this._tex.off("loaded",this,this.onloaded)),this._url=_a,(this._tex=_j.getRes(_a))?(_j.keepCache(this,_a),this.onloaded()):_f.imgMgrLoad(_a,this._loadImageComplete.bind(this),2,!1))})})(),function(_a){function _b(){this.type=null,_b.__super.call(this),this.visible=!1}_g(_b,"laya.html.dom.HTMLLinkElement",_a);var _c=_b.prototype;_c._onload=function(_a){switch(this.type){case"text/css":_i.parseCSS(_a,this.URI)}},_h(0,_c,"href",_a.prototype._$get_href,function(_a){var _b=this;_a=this.formatURL(_a),this.URI=new _r(_a);var _c=new _j;_c.once("complete",null,function(_a){_b._onload(_a)}),_c.load(_a,"text")}),_b._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(_v),function(_a){function _b(){_b.__super.call(this),this.visible=!1}_g(_b,"laya.html.dom.HTMLStyleElement",_a),_h(0,_b.prototype,"text",_a.prototype._$get_text,function(_a){_i.parseCSS(_a,null)})}(_v),function(_a){function _b(){_b.__super.call(this),this._getCSSStyle().valign="middle"}_g(_b,"laya.html.dom.HTMLIframeElement",_a),_h(0,_b.prototype,"href",_a.prototype._$get_href,function(_c){var _d=this;_c=this.formatURL(_c);var _a=new _j;_a.once("complete",null,function(_a){var _b=_d.URI;_d.URI=new _r(_c),_d.innerHTML=_a,!_b||(_d.URI=_b)}),_a.load(_c,"text")})}(_b)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(_e,_a,_p){_p.un,_p.uns;var _d=_p.static,_f=_p.class,_g=_p.getset,_c=(_p.__newvec,laya.display.Animation),_q=(laya.utils.Browser,laya.utils.ClassUtils),_h=laya.filters.ColorFilter,_i=laya.utils.Ease,_j=laya.events.Event,_k=(laya.events.EventDispatcher,laya.display.css.Font),_l=laya.display.FrameAnimation,_b=laya.display.Graphics,_m=laya.utils.Handler,_n=laya.display.Input,_s=laya.net.Loader,_o=(laya.display.Node,laya.maths.Point),_r=laya.maths.Rectangle,_t=laya.renders.Render,_u=laya.display.Sprite,_v=laya.display.Text,_w=laya.resource.Texture,_x=laya.utils.Tween,_y=laya.utils.Utils,_z=laya.utils.WeakObject;_p.interface("laya.ui.IItem"),_p.interface("laya.ui.ISelect"),_p.interface("laya.ui.IRender"),_p.interface("laya.ui.IComponent"),_p.interface("laya.ui.IBox","IComponent");var _A=function(){function _a(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return _f(_a,"laya.ui.LayoutStyle"),_d(_a,["EMPTY",function(){return this.EMPTY=new _a}]),_a}(),_B=function(){function _a(){}return _f(_a,"laya.ui.Styles"),_a.labelColor="#000000",_a.buttonStateNum=3,_a.scrollBarMinNum=15,_a.scrollBarDelayTime=500,_d(_a,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),_a}(),_C=function(){function _e(){}return _f(_e,"laya.ui.UIUtils"),_e.fillArray=function(_a,_b,_c){var _d=_a.concat();if(_b)for(var _e=_b.split(","),_f=0,_g=Math.min(_d.length,_e.length);_f<_g;_f++){var _h=_e[_f];_d[_f]="true"==_h||"false"!=_h&&_h,null!=_c&&(_d[_f]=_c(_h))}return _d},_e.toColor=function(_a){return _y.toHexColor(_a)},_e.gray=function(_a,_b){void 0===_b&&(_b=!0),_b?_e.addFilter(_a,_e.grayFilter):_e.clearFilter(_a,_h)},_e.addFilter=function(_a,_b){var _c=_a.filters||[];_c.push(_b),_a.filters=_c},_e.clearFilter=function(_a,_b){var _c=_a.filters;if(null!=_c&&0<_c.length){for(var _d=_c.length-1;-1<_d;_d--){var _e=_c[_d];_p.__typeof(_e,_b)&&_c.splice(_d,1)}_a.filters=_c}},_e._getReplaceStr=function(_a){return _e.escapeSequence[_a]},_e.adptString=function(_a){return _a.replace(/\\(\w)/g,_e._getReplaceStr)},_e.getBindFun=function(_a){var _b=_e._funMap.get(_a);if(null==_b){var _c='"'+_a+'"',_d="(function(data){if(data==null)return;with(data){try{\nreturn "+(_c=_c.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";_b=_p._runScript(_d),_e._funMap.set(_a,_b)}return _b},_d(_e,["grayFilter",function(){return this.grayFilter=new _h([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new _z}]),_e}(),_D=function(){function _a(){}return _f(_a,"UIConfig"),_a.touchScrollEnable=!0,_a.mouseWheelEnable=!0,_a.showButtons=!0,_a.popupBgColor="#000000",_a.popupBgAlpha=.5,_a.closeDialogOnSide=!0,_a}(),_E=function(_c){function _r(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,_r.__super.call(this),this._weakKeys=[]}_f(_r,"laya.ui.AutoBitmap",_c);var _a=_r.prototype;return _a.destroy=function(){if(_s.clearObject(this,this._weakKey),this._weakKeys){for(var _a=0,_b=this._weakKeys.length;_a<_b;++_a)_s.clearObject(this,this._weakKeys[_a]);this._weakKeys=null}_c.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},_a._setChanged=function(){this._isChanged||(this._isChanged=!0,_p.timer.callLater(this,this.changeSource))},_a.changeSource=function(){this._isChanged=!1;var _a=this._source;if(_a&&_a.bitmap){var _b=this.width,_c=this.height,_d=this._sizeGrid,_e=_a.sourceWidth,_f=_a.sourceHeight;if(!_d||_e===_b&&_f===_c)this.cleanByTexture(_a,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,_b,_c);else{_s.clearObject(this,this._weakKey),_a.$_GID||(_a.$_GID=_y.getGID());var _g=_a.$_GID+"."+_b+"."+_c+"."+_d.join("."),_h=_s.findObject(_g);if(_y.isOKCmdList(_h))return this._weakKey=_g,_s.keepObject(this,this._weakKey),void(this.cmds=_h);this.clear();var _i,_j,_k=_d[0],_l=_d[1],_m=_d[2],_n=_d[3],_o=_d[4],_p=!1;if(_b==_e&&(_n=_l=0),_c==_f&&(_k=_m=0),_b<_n+_l){var _q=_b;_p=!0,_b=_n+_l,this.save(),this.clipRect(0,0,_q,_c)}_n&&_k&&(_i=_r.getTexture(_a,0,0,_n,_k),_j=this._weakKeys[0],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[0]=_i.weakKey),this.drawTexture(_i,0,0,_n,_k)):(_s.clearObject(this,_j),this._weakKeys[0]="")),_l&&_k&&(_i=_r.getTexture(_a,_e-_l,0,_l,_k),_j=this._weakKeys[1],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[1]=_i.weakKey),this.drawTexture(_i,_b-_l,0,_l,_k)):(_s.clearObject(this,_j),this._weakKeys[1]="")),_n&&_m&&(_i=_r.getTexture(_a,0,_f-_m,_n,_m),_j=this._weakKeys[2],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[2]=_i.weakKey),this.drawTexture(_i,0,_c-_m,_n,_m)):(_s.clearObject(this,_j),this._weakKeys[2]="")),_l&&_m&&(_i=_r.getTexture(_a,_e-_l,_f-_m,_l,_m),_j=this._weakKeys[3],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[3]=_i.weakKey),this.drawTexture(_i,_b-_l,_c-_m,_l,_m)):(_s.clearObject(this,_j),this._weakKeys[3]="")),_k&&(_i=_r.getTexture(_a,_n,0,_e-_n-_l,_k),_j=this._weakKeys[4],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[4]=_i.weakKey),this.drawBitmap(_o,_i,_n,0,_b-_n-_l,_k)):(_s.clearObject(this,_j),this._weakKeys[4]="")),_m&&(_i=_r.getTexture(_a,_n,_f-_m,_e-_n-_l,_m),_j=this._weakKeys[5],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[5]=_i.weakKey),this.drawBitmap(_o,_i,_n,_c-_m,_b-_n-_l,_m)):(_s.clearObject(this,_j),this._weakKeys[5]="")),_n&&(_i=_r.getTexture(_a,0,_k,_n,_f-_k-_m),_j=this._weakKeys[6],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[6]=_i.weakKey),this.drawBitmap(_o,_i,0,_k,_n,_c-_k-_m)):(_s.clearObject(this,_j),this._weakKeys[6]="")),_l&&(_i=_r.getTexture(_a,_e-_l,_k,_l,_f-_k-_m),_j=this._weakKeys[7],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[7]=_i.weakKey),this.drawBitmap(_o,_i,_b-_l,_k,_l,_c-_k-_m)):(_s.clearObject(this,_j),this._weakKeys[7]="")),_i=_r.getTexture(_a,_n,_k,_e-_n-_l,_f-_k-_m),_j=this._weakKeys[8],_i?(_j!=_i.weakKey&&(_s.clearObject(this,_j),_s.keepObject(this,_i.weakKey),this._weakKeys[8]=_i.weakKey),this.drawBitmap(_o,_i,_n,_k,_b-_n-_l,_c-_k-_m)):(_s.clearObject(this,_j),this._weakKeys[8]=""),_p&&this.restore(),this.autoCacheCmd&&!_t.isConchApp&&(_s.saveObject(_g,this.cmds,null),this._weakKey=_g,_s.keepObject(this,this._weakKey))}this._repaint()}},_a.drawBitmap=function(_a,_b,_c,_d,_e,_f){void 0===_e&&(_e=0),void 0===_f&&(_f=0),_e<.1||_f<.1||(!_a||_b.width==_e&&_b.height==_f?this.drawTexture(_b,_c,_d,_e,_f):this.fillTexture(_b,_c,_d,_e,_f))},_a.clear=function(_a){void 0===_a&&(_a=!0),_c.prototype.clear.call(this,!1)},_g(0,_a,"sizeGrid",function(){return this._sizeGrid},function(_a){this._sizeGrid=_a,this._setChanged()}),_g(0,_a,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(_a){this._width!=_a&&(this._width=_a,this._setChanged())}),_g(0,_a,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(_a){this._height!=_a&&(this._height=_a,this._setChanged())}),_g(0,_a,"source",function(){return this._source},function(_a){_a?(this._source=_a,this._setChanged()):(this._source=null,this.clear())}),_r.getTexture=function(_a,_b,_c,_d,_e){_d<=0&&(_d=1),_e<=0&&(_e=1),_a.$_GID||(_a.$_GID=_y.getGID());var _f=_a.$_GID+"."+_b+"."+_c+"."+_d+"."+_e,_g=_s.findObject(_f);if((!_g||!_g.source)&&(_g=_w.createFromTexture(_a,_b,_c,_d,_e))){if(_a.alphaTexture){var _h=_a.width/_a.alphaTexture.width;_g.alphaTexture=_w.createFromTexture(_a.alphaTexture,_b/_h,_c/_h,_d/_h,_e/_h)}_s.saveObject(_f,_g),_g.weakKey=_f}return _g},_r}(_b),_F=(function(_a){function _b(){_b.__super.call(this)}_f(_b,"laya.ui.UIEvent",_j),_b.SHOW_TIP="showtip",_b.HIDE_TIP="hidetip"}(),function(_b){function _a(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,_a.__super.call(this),this._layout=_A.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}_f(_a,"laya.ui.Component",_b);var _c=_a.prototype;return _p.imps(_c,{"laya.ui.IComponent":!0}),_c.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},_c.preinitialize=function(){},_c.createChildren=function(){},_c.initialize=function(){},_c.callLater=function(_a,_b){_p.timer.callLater(this,_a,_b)},_c.runCallLater=function(_a){_p.timer.runCallLater(this,_a)},_c.commitMeasure=function(){},_c.changeSize=function(){this.event("resize")},_c.getLayout=function(){return this._layout===_A.EMPTY&&(this._layout=new _A),this._layout},_c._setLayoutEnabled=function(_a){this._layout&&this._layout.enable!=_a&&(this._layout.enable=_a,this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},_c.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},_c.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},_c.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},_c.resetLayoutX=function(){var _a=this._layout;if(isNaN(_a.anchorX)||(this.pivotX=_a.anchorX*this.width),this.layoutEnabled){var _b=this.parent;_b&&(isNaN(_a.centerX)?isNaN(_a.left)?isNaN(_a.right)||(this.x=Math.round(_b.width-this.displayWidth-_a.right+this.pivotX*this.scaleX)):(this.x=Math.round(_a.left+this.pivotX*this.scaleX),isNaN(_a.right)||(this.width=(_b._width-_a.left-_a.right)/(this.scaleX||.01))):this.x=Math.round(.5*(_b.width-this.displayWidth)+_a.centerX+this.pivotX*this.scaleX))}},_c.resetLayoutY=function(){var _a=this._layout;if(isNaN(_a.anchorY)||(this.pivotY=_a.anchorY*this.height),this.layoutEnabled){var _b=this.parent;_b&&(isNaN(_a.centerY)?isNaN(_a.top)?isNaN(_a.bottom)||(this.y=Math.round(_b.height-this.displayHeight-_a.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(_a.top+this.pivotY*this.scaleY),isNaN(_a.bottom)||(this.height=(_b._height-_a.top-_a.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(_b.height-this.displayHeight)+_a.centerY+this.pivotY*this.scaleY))}},_c.onMouseOver=function(_a){_p.stage.event("showtip",this._toolTip)},_c.onMouseOut=function(_a){_p.stage.event("hidetip",this._toolTip)},_g(0,_c,"displayWidth",function(){return this.width*this.scaleX}),_g(0,_c,"width",function(){return this._width?this._width:this.measureWidth},function(_a){this._width!=_a&&(this._width=_a,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),_g(0,_c,"measureWidth",function(){var _a=0;this.commitMeasure();for(var _b=this.numChildren-1;-1<_b;_b--){var _c=this.getChildAt(_b);_c.visible&&(_a=Math.max(_c.x+_c.width*_c.scaleX,_a))}return _a}),_g(0,_c,"displayHeight",function(){return this.height*this.scaleY}),_g(0,_c,"height",function(){return this._height?this._height:this.measureHeight},function(_a){this._height!=_a&&(this._height=_a,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),_g(0,_c,"dataSource",function(){return this._dataSource},function(_a){for(var _b in this._dataSource=_a,this._dataSource)this.hasOwnProperty(_b)&&"function"!=typeof this[_b]&&(this[_b]=this._dataSource[_b])}),_g(0,_c,"scaleY",_b.prototype._$get_scaleY,function(_a){_p.superGet(_u,this,"scaleY")!=_a&&(_p.superSet(_u,this,"scaleY",_a),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),_g(0,_c,"measureHeight",function(){var _a=0;this.commitMeasure();for(var _b=this.numChildren-1;-1<_b;_b--){var _c=this.getChildAt(_b);_c.visible&&(_a=Math.max(_c.y+_c.height*_c.scaleY,_a))}return _a}),_g(0,_c,"scaleX",_b.prototype._$get_scaleX,function(_a){_p.superGet(_u,this,"scaleX")!=_a&&(_p.superSet(_u,this,"scaleX",_a),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),_g(0,_c,"top",function(){return this._layout.top},function(_a){_a!=this._layout.top&&(this.getLayout().top=_a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),_g(0,_c,"bottom",function(){return this._layout.bottom},function(_a){_a!=this._layout.bottom&&(this.getLayout().bottom=_a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),_g(0,_c,"left",function(){return this._layout.left},function(_a){_a!=this._layout.left&&(this.getLayout().left=_a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),_g(0,_c,"right",function(){return this._layout.right},function(_a){_a!=this._layout.right&&(this.getLayout().right=_a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),_g(0,_c,"centerX",function(){return this._layout.centerX},function(_a){_a!=this._layout.centerX&&(this.getLayout().centerX=_a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),_g(0,_c,"centerY",function(){return this._layout.centerY},function(_a){_a!=this._layout.centerY&&(this.getLayout().centerY=_a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),_g(0,_c,"anchorX",function(){return this._layout.anchorX},function(_a){_a!=this._layout.anchorX&&(this.getLayout().anchorX=_a,this._setLayoutEnabled(!0)),this.resetLayoutX()}),_g(0,_c,"anchorY",function(){return this._layout.anchorY},function(_a){_a!=this._layout.anchorY&&(this.getLayout().anchorY=_a,this._setLayoutEnabled(!0)),this.resetLayoutY()}),_g(0,_c,"tag",function(){return this._tag},function(_a){this._tag=_a}),_g(0,_c,"toolTip",function(){return this._toolTip},function(_a){this._toolTip!=_a&&(null!=(this._toolTip=_a)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),_g(0,_c,"comXml",function(){return this._comXml},function(_a){this._comXml=_a}),_g(0,_c,"gray",function(){return this._gray},function(_a){_a!==this._gray&&(this._gray=_a,_C.gray(this,_a))}),_g(0,_c,"disabled",function(){return this._disabled},function(_a){_a!==this._disabled&&(this.gray=this._disabled=_a,this.mouseEnabled=!_a)}),_a}(_u)),_G=function(_a){function _b(){this.lockLayer=null,this.popupEffect=function(_a){_a.scale(1,1),_x.from(_a,{x:_p.stage.width/2,y:_p.stage.height/2,scaleX:0,scaleY:0},300,_i.backOut,_m.create(this,this.doOpen,[_a]))},this.closeEffect=function(_a,_b){_x.to(_a,{x:_p.stage.width/2,y:_p.stage.height/2,scaleX:0,scaleY:0},300,_i.strongOut,_m.create(this,this.doClose,[_a,_b]))},_b.__super.call(this),this.maskLayer=new _u,this.popupEffectHandler=_m.create(this,this.popupEffect,null,!1),this.closeEffectHandler=_m.create(this,this.closeEffect,null,!1),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,_p.stage.addChild(this),_p.stage.on("resize",this,this._onResize),_D.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}_f(_b,"laya.ui.DialogManager",_u);var _c=_b.prototype;return _c._closeOnSide=function(){var _a=this.getChildAt(this.numChildren-1);_a instanceof laya.ui.Dialog&&_a.close("side")},_c.setLockView=function(_a){this.lockLayer||(this.lockLayer=new _H,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(_p.stage.width,_p.stage.height)),this.lockLayer.removeChildren(),_a&&(_a.centerX=_a.centerY=0,this.lockLayer.addChild(_a))},_c._onResize=function(_a){var _b=this.maskLayer.width=_p.stage.width,_c=this.maskLayer.height=_p.stage.height;this.lockLayer&&this.lockLayer.size(_b,_c),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,_b,_c,_D.popupBgColor),this.maskLayer.alpha=_D.popupBgAlpha;for(var _d=this.numChildren-1;-1<_d;_d--){var _e=this.getChildAt(_d);_e.popupCenter&&this._centerDialog(_e)}},_c._centerDialog=function(_a){_a.x=Math.round((_p.stage.width-_a.width>>1)+_a.pivotX),_a.y=Math.round((_p.stage.height-_a.height>>1)+_a.pivotY)},_c.open=function(_a,_b,_c){void 0===_b&&(_b=!1),void 0===_c&&(_c=!1),_b&&this._closeAll(),_a.popupCenter&&this._centerDialog(_a),this.addChild(_a),(_a.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),_c&&null!=_a.popupEffect?_a.popupEffect.runWith(_a):this.doOpen(_a),this.event("open")},_c.doOpen=function(_a){_a.onOpened()},_c.lock=function(_a){this.lockLayer&&(_a?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},_c.close=function(_a,_b,_c){void 0===_c&&(_c=!1),_c&&null!=_a.closeEffect?_a.closeEffect.runWith([_a,_b]):this.doClose(_a,_b),this.event("close")},_c.doClose=function(_a,_b){_a.removeSelf(),_a.isModal&&this._checkMask(),_a.closeHandler&&_a.closeHandler.runWith(_b),_a.onClosed(_b)},_c.closeAll=function(){this._closeAll(),this.event("close")},_c._closeAll=function(){for(var _a=this.numChildren-1;-1<_a;_a--){var _b=this.getChildAt(_a);_b&&null!=_b.close&&this.doClose(_b)}},_c.getDialogsByGroup=function(_a){for(var _b=[],_c=this.numChildren-1;-1<_c;_c--){var _d=this.getChildAt(_c);_d&&_d.group===_a&&_b.push(_d)}return _b},_c.closeByGroup=function(_a){for(var _b=[],_c=this.numChildren-1;-1<_c;_c--){var _d=this.getChildAt(_c);_d&&_d.group===_a&&(_d.close(),_b.push(_d))}return _b},_c._checkMask=function(){this.maskLayer.removeSelf();for(var _a=this.numChildren-1;-1<_a;_a--){var _b=this.getChildAt(_a);if(_b&&_b.isModal)return void this.addChildAt(this.maskLayer,_a)}},_b}(),_H=function(_a){function _b(){_b.__super.call(this)}_f(_b,"laya.ui.Box",_a);var _c=_b.prototype;return _p.imps(_c,{"laya.ui.IBox":!0}),_g(0,_c,"dataSource",_a.prototype._$get_dataSource,function(_a){for(var _b in this._dataSource=_a){var _c=this.getChildByName(_b);_c?_c.dataSource=_a[_b]:this.hasOwnProperty(_b)&&"function"!=typeof this[_b]&&(this[_b]=_a[_b])}}),_b}(_F),_I=function(_b){function _c(_a,_b){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,_c.__super.call(this),this._labelColors=_B.buttonLabelColors,this._stateNum=_B.buttonStateNum,void 0===_b&&(_b=""),this.skin=_a,this.label=_b}_f(_c,"laya.ui.Button",_b);var _a=_c.prototype;return _p.imps(_a,{"laya.ui.ISelect":!0}),_a.destroy=function(_a){this.clearEvent(),_s.clearCache(this,this._skin),_s.clearObject(this,this._weakKey),void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(_a),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},_a.clearEvent=function(){this._skin&&_e.atalsNotify&&_e.atalsNotify.off(this._skin,this,this._setBtnSource)},_a.createChildren=function(){this.graphics=this._bitmap=new _E},_a.createText=function(){this._text||(this._text=new _v,this._text.overflow=_v.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},_a.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},_a.onMouse=function(_a){if(!1!==this.toggle||!this._selected)return"click"===_a.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=_c.stateMap[_a.type]))},_a.changeClips=function(){var _a=_s.getRes(this._skin);if(_a)if(this._skin&&""!=this._skin){_s.clearObject(this,this._weakKey);var _b=_a.sourceWidth,_c=_a.sourceHeight/this._stateNum;_a.$_GID||(_a.$_GID=_y.getGID());var _d=_a.$_GID+"-"+this._stateNum,_e=_s.findObject(_d);if(_y.isOkTextureList(_e)||(_e=null),_e)this._weakKey=_d,_s.keepObject(this,this._weakKey),this._sources=_e;else{if(this._sources=[],1===this._stateNum)this._sources.push(_a);else for(var _f=0;_f<this._stateNum;_f++){var _g=_w.createFromTexture(_a,0,_c*_f,_b,_c);if(_a.alphaTexture){var _h=_a.width/_a.alphaTexture.width;_g.alphaTexture=_w.createFromTexture(_a.alphaTexture,0/_h,_c*_f/_h,_b/_h,_c/_h)}this._sources.push(_g)}_s.saveObject(_d,this._sources),this._weakKey=_d,_s.keepObject(this,this._weakKey)}this._autoSize?(this._bitmap.width=this._width||_b,this._bitmap.height=this._height||_c,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=_b)}else console.warn("lose skin ",this._skin,this.name,this.__className)},_a.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var _a=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[_a]),this.label&&(this._text.color=this._labelColors[_a],this._strokeColors&&(this._text.strokeColor=this._strokeColors[_a]))},_a._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},_g(0,_a,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(_a){this.createText(),this._text.strokeColor=_a}),_g(0,_a,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),_g(0,_a,"skin",function(){return this._skin},function(_a){if(this._skin!=_a)if(this.clearEvent(),_s.clearCache(this,this._skin),this._skin=_a,_s.keepCache(this,this._skin),_s.getRes(this._skin))this.callLater(this.changeClips),this._setStateChanged();else{var _b=_e.resAtalsObj&&_e.resAtalsObj[this._skin];_b?(_e.atalsNotify&&_e.atalsNotify.once(this._skin,this,this._setBtnSource),0==this.width&&(this.width=_b.sourceW),0==this.height&&(this.height=_b.sourceH/this._stateNum)):console.warn("lose button skin ",this._skin,this.name,this.__className)}}),_a._setBtnSource=function(_a,_b){_a===this._skin&&_b&&(this.callLater(this.changeClips),this._setStateChanged(),this.clearEvent())},_g(0,_a,"state",function(){return this._state},function(_a){this._state!=_a&&(this._state=_a,this._setStateChanged())}),_g(0,_a,"text",function(){return this.createText(),this._text}),_g(0,_a,"stateNum",function(){return this._stateNum},function(_a){"string"==typeof _a&&(_a=parseInt(_a)),this._stateNum!=_a&&(this._stateNum=_a<1?1:3<_a?3:_a,this.callLater(this.changeClips))}),_g(0,_a,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(_a){this._strokeColors=_C.fillArray(_B.buttonLabelColors,_a,String),this._setStateChanged()}),_g(0,_a,"labelColors",function(){return this._labelColors.join(",")},function(_a){this._labelColors=_C.fillArray(_B.buttonLabelColors,_a,String),this._setStateChanged()}),_g(0,_a,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),_g(0,_a,"label",function(){return this._text?this._text.text:null},function(_a){(this._text||_a)&&(this.createText(),this._text.text!=_a&&(_a&&!this._text.parent&&this.addChild(this._text),this._text.text=(_a+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),_g(0,_a,"selected",function(){return this._selected},function(_a){this._selected!=_a&&(this._selected=_a,this.state=this._selected?2:0,this.event("change"))}),_g(0,_a,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(_a){this.createText(),this._text.padding=_C.fillArray(_B.labelPadding,_a,Number)}),_g(0,_a,"labelSize",function(){return this.createText(),this._text.fontSize},function(_a){this.createText(),this._text.fontSize=_a}),_g(0,_a,"labelStroke",function(){return this.createText(),this._text.stroke},function(_a){this.createText(),this._text.stroke=_a}),_g(0,_a,"labelBold",function(){return this.createText(),this._text.bold},function(_a){this.createText(),this._text.bold=_a}),_g(0,_a,"labelFont",function(){return this.createText(),this._text.font},function(_a){this.createText(),this._text.font=_a}),_g(0,_a,"labelAlign",function(){return this.createText(),this._text.align},function(_a){this.createText(),this._text.align=_a}),_g(0,_a,"clickHandler",function(){return this._clickHandler},function(_a){this._clickHandler=_a}),_g(0,_a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(_a){this._bitmap.sizeGrid=_C.fillArray(_B.defaultSizeGrid,_a,Number)}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_F,this,"width",_a),this._autoSize&&(this._bitmap.width=_a,this._text&&(this._text.width=_a))}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_F,this,"height",_a),this._autoSize&&(this._bitmap.height=_a,this._text&&(this._text.height=_a))}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)||"string"==typeof _a?this.label=_a+"":_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(_a){this._bitmap._offset=_a?_C.fillArray([1,1],_a,Number):[]}),_d(_c,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),_c}(_F),_J=function(_b){function _d(_a,_b,_c){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,this._complete=null,this._progress=null,_d.__super.call(this),void 0===_b&&(_b=1),void 0===_c&&(_c=1),this._clipX=_b,this._clipY=_c,this.skin=_a}_f(_d,"laya.ui.Clip",_b);var _a=_d.prototype;return _a.destroy=function(_a){this.clearEvent(),this.clearLoad(),_s.clearCache(this,this._skin),_s.clearObject(this,this._weakKey),void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},_a.dispose=function(){this.destroy(!0),_p.loader.clearRes(this._skin)},_a.createChildren=function(){this.graphics=this._bitmap=new _E},_a._onDisplay=function(_a){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},_a.changeClip=function(){if(this._clipChanged=!1,this._skin){var _a=_s.getRes(this._skin);if(_a)this.loadComplete(this._skin,_a);else{if(_e.resAtalsObj&&_e.resAtalsObj[this._skin])return;this.clearLoad(),this._complete=_m.create(this,this.loadComplete,[this._skin]),this._progress=null,_p.loader.load(this._skin,this._complete,this._progress)}}},_a.loadComplete=function(_a,_b){if(_a===this._skin&&_b){_s.clearObject(this,this._weakKey);var _c=this._clipWidth||Math.ceil(_b.sourceWidth/this._clipX),_d=this._clipHeight||Math.ceil(_b.sourceHeight/this._clipY),_e=this._skin+_c+_d,_f=_s.findObject(_e);if(_y.isOkTextureList(_f)||(_f=null),_f)this._weakKey=_e,_s.keepObject(this,this._weakKey),this._sources=_f;else{this._sources=[];for(var _g=0;_g<this._clipY;_g++)for(var _h=0;_h<this._clipX;_h++){var _i=_w.createFromTexture(_b,_c*_h,_d*_g,_c,_d);if(_b.alphaTexture){var _j=_b.width/_b.alphaTexture.width;_i.alphaTexture=_w.createFromTexture(_b.alphaTexture,_c*_h/_j,_d*_g/_j,_c/_j,_d/_j)}this._sources.push(_i)}_s.saveObject(_e,this._sources),this._weakKey=_e,_s.keepObject(this,this._weakKey)}this.index=this._index,this.event("loaded"),this.onCompResize()}},_a.play=function(_a,_b){void 0===_a&&(_a=0),void 0===_b&&(_b=-1),this._isPlaying=!0,this.index=_a,this._toIndex=_b,this._index++,_p.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},_a._loop=function(){this._style.visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},_a.stop=function(){this._isPlaying=!1,_p.timer.clear(this,this._loop),this.event("complete")},_a._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},_g(0,_a,"interval",function(){return this._interval},function(_a){this._interval!=_a&&(this._interval=_a,this._isPlaying&&this.play())}),_a.clearEvent=function(){this._skin&&_e.atalsNotify&&_e.atalsNotify.off(this._skin,this,this._setBtnSource)},_a.clearLoad=function(){this._skin&&((this._complete||this._progress)&&_p.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},_g(0,_a,"skin",function(){return this._skin},function(_a){if(this._skin!=_a)if(this.clearLoad(),this.clearEvent(),_s.clearCache(this,this._skin),this._skin=_a){_s.keepCache(this,this._skin);var _b=_s.getRes(_a),_c=_e.resAtalsObj&&_e.resAtalsObj[this._skin];!_b&&_c?_e.atalsNotify&&_e.atalsNotify.once(this._skin,this,this._setBtnSource):this._setClipChanged()}else this._bitmap.source=null}),_a._setBtnSource=function(_a,_b){_a===this._skin&&_b&&(this.loadComplete(_a,_b),this.clearEvent())},_g(0,_a,"sources",function(){return this._sources},function(_a){this._sources=_a,this.index=this._index,this.event("loaded")}),_g(0,_a,"clipX",function(){return this._clipX},function(_a){this._clipX=_a||1,this._setClipChanged()}),_g(0,_a,"clipY",function(){return this._clipY},function(_a){this._clipY=_a||1,this._setClipChanged()}),_g(0,_a,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),_g(0,_a,"clipWidth",function(){return this._clipWidth},function(_a){this._clipWidth=_a,this._setClipChanged()}),_g(0,_a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(_a){this._bitmap.sizeGrid=_C.fillArray(_B.defaultSizeGrid,_a,Number)}),_g(0,_a,"group",function(){return this._group},function(_a){_a&&this._skin&&_s.setGroup(this._skin,_a),this._group=_a}),_g(0,_a,"clipHeight",function(){return this._clipHeight},function(_a){this._clipHeight=_a,this._setClipChanged()}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_F,this,"width",_a),this._bitmap.width=_a}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_F,this,"height",_a),this._bitmap.height=_a}),_g(0,_a,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),_g(0,_a,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),_g(0,_a,"index",function(){return this._index},function(_a){this._index=_a,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[_a]),this.event("change")}),_g(0,_a,"autoPlay",function(){return this._autoPlay},function(_a){this._autoPlay!=_a&&((this._autoPlay=_a)?this.play():this.stop())}),_g(0,_a,"isPlaying",function(){return this._isPlaying},function(_a){this._isPlaying=_a}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)&&Math.floor(_a)==_a||"string"==typeof _a?this.index=parseInt(_a):_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"bitmap",function(){return this._bitmap}),_d}(_F),_K=function(_b){function _a(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,_a.__super.call(this)}_f(_a,"laya.ui.ColorPicker",_b);var _c=_a.prototype;return _c.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._colorPanel&&this._colorPanel.destroy(_a),this._colorButton&&this._colorButton.destroy(_a),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},_c.createChildren=function(){this.addChild(this._colorButton=new _I),this._colorPanel=new _H,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new _u),this._colorPanel.addChild(this._colorBlock=new _u),this._colorPanel.addChild(this._colorInput=new _n)},_c.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},_c.onPanelMouseDown=function(_a){_a.stopPropagation()},_c.changePanel=function(){this._panelChanged=!1;var _a=this._colorPanel.graphics;_a.clear(),_a.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(_a=this._colorTiles.graphics).clear();for(var _b=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],_c=0;_c<12;_c++)for(var _d=0;_d<20;_d++){var _e=0;_e=0===_d?_b[_c]:1===_d?0:51*(((3*_c+_d/6)%3<<0)+3*(_c/6<<0))<<16|_d%6*51<<8|(_c<<0)%6*51;var _f=_C.toColor(_e);this._colors.push(_f);var _g=_d*this._gridSize,_h=_c*this._gridSize;_a.drawRect(_g,_h,this._gridSize,this._gridSize,_f,"#000000")}},_c.onColorButtonClick=function(_a){this._colorPanel.parent?this.close():this.open()},_c.open=function(){var _a=this.localToGlobal(new _o),_b=_a.x+this._colorPanel.width<=_p.stage.width?_a.x:_p.stage.width-this._colorPanel.width,_c=_a.y+this._colorButton.height;_c=_c+this._colorPanel.height<=_p.stage.height?_c:_a.y-this._colorPanel.height,this._colorPanel.pos(_b,_c),this._colorPanel.zOrder=1001,_p._currentStage.addChild(this._colorPanel),_p.stage.on("mousedown",this,this.removeColorBox)},_c.close=function(){_p.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},_c.removeColorBox=function(_a){this.close()},_c.onColorFieldKeyDown=function(_a){13==_a.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),_a.stopPropagation())},_c.onColorInputChange=function(_a){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},_c.onColorTilesClick=function(_a){this.selectedColor=this.getColorByMouse(),this.close()},_c.onColorTilesMouseMove=function(_a){this._colorInput.focus=!1;var _b=this.getColorByMouse();this._colorInput.text=_b,this.drawBlock(_b)},_c.getColorByMouse=function(){var _a=this._colorTiles.getMousePoint(),_b=Math.floor(_a.x/this._gridSize),_c=Math.floor(_a.y/this._gridSize);return this._colors[20*_c+_b]},_c.drawBlock=function(_a){var _b=this._colorBlock.graphics;_b.clear();var _c=_a||"#ffffff";_b.drawRect(0,0,50,20,_c,this._borderColor),_a||_b.drawLine(0,0,50,20,"#ff0000")},_c.changeColor=function(){var _a=this.graphics;_a.clear();var _b=this._selectedColor||"#000000";_a.drawRect(0,0,this._colorButton.width,this._colorButton.height,_b)},_c._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},_g(0,_c,"inputBgColor",function(){return this._inputBgColor},function(_a){this._inputBgColor=_a,this._setPanelChanged()}),_g(0,_c,"selectedColor",function(){return this._selectedColor},function(_a){this._selectedColor!=_a&&(this._selectedColor=this._colorInput.text=_a,this.drawBlock(_a),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",_j.EMPTY.setTo("change",this,this)))}),_g(0,_c,"skin",function(){return this._colorButton.skin},function(_a){this._colorButton.skin=_a,this.changeColor()}),_g(0,_c,"bgColor",function(){return this._bgColor},function(_a){this._bgColor=_a,this._setPanelChanged()}),_g(0,_c,"borderColor",function(){return this._borderColor},function(_a){this._borderColor=_a,this._setPanelChanged()}),_g(0,_c,"inputColor",function(){return this._inputColor},function(_a){this._inputColor=_a,this._setPanelChanged()}),_a}(_F),_L=function(_b){function _c(_a,_b){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,_c.__super.call(this),this._itemColors=_B.comboBoxItemColors,this.skin=_a,this.labels=_b}_f(_c,"laya.ui.ComboBox",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._button&&this._button.destroy(_a),this._list&&this._list.destroy(_a),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},_a.createChildren=function(){this.addChild(this._button=new _I),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},_a._createList=function(){this._list=new _V,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},_a._setListEvent=function(_a){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=_m.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},_a.onListDown=function(_a){_a.stopPropagation()},_a.onScrollBarDown=function(_a){_a.stopPropagation()},_a.onButtonMouseDown=function(_a){this.callLater(this.switchTo,[!this._isOpen])},_a.changeList=function(){this._listChanged=!1;var _a=this.width-2,_b=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:_a,height:this._itemHeight,fontSize:this._itemSize,color:_b}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},_a.onlistItemMouse=function(_a,_b){var _c=_a.type;if("mouseover"===_c||"mouseout"===_c){if(this._isCustomList)return;var _d=this._list.getCell(_b);if(!_d)return;var _e=_d.getChildByName("label");_e&&("mouseover"===_c?(_e.bgColor=this._itemColors[0],_e.color=this._itemColors[1]):(_e.bgColor=null,_e.color=this._itemColors[2]))}else"click"===_c&&(this.selectedIndex=_b,this.isOpen=!1)},_a.switchTo=function(_a){this.isOpen=_a},_a.changeOpen=function(){this.isOpen=!this._isOpen},_a.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var _a=this._list.graphics;_a.clear(),_a.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var _b=this._list.array||[],_c=_b.length=0,_d=this._labels.length;_c<_d;_c++)_b.push({label:this._labels[_c]});this._list.height=this._listHeight,this._list.array=_b},_a.changeSelected=function(){this._button.label=this.selectedLabel},_a._onStageMouseWheel=function(_a){this._list&&!this._list.contains(_a.target)&&this.removeList(null)},_a.removeList=function(_a){_p.stage.off("mousedown",this,this.removeList),_p.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},_g(0,_a,"selectedIndex",function(){return this._selectedIndex},function(_a){this._selectedIndex!=_a&&(this._selectedIndex=_a,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[_j.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),_g(0,_a,"measureHeight",function(){return this._button.height}),_g(0,_a,"skin",function(){return this._button.skin},function(_a){this._button.skin!=_a&&(this._button.skin=_a,this._listChanged=!0)}),_g(0,_a,"measureWidth",function(){return this._button.width}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_F,this,"width",_a),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),_g(0,_a,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(_a){this.selectedIndex=this._labels.indexOf(_a)}),_g(0,_a,"labels",function(){return this._labels.join(",")},function(_a){0<this._labels.length&&(this.selectedIndex=-1),_a?this._labels=_a.split(","):this._labels.length=0,this._itemChanged=!0}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_F,this,"height",_a),this._button.height=this._height}),_g(0,_a,"selectHandler",function(){return this._selectHandler},function(_a){this._selectHandler=_a}),_g(0,_a,"visibleNum",function(){return this._visibleNum},function(_a){this._visibleNum=_a,this._listChanged=!0}),_g(0,_a,"labelBold",function(){return this._button.text.bold},function(_a){this._button.text.bold=_a}),_g(0,_a,"itemColors",function(){return String(this._itemColors)},function(_a){this._itemColors=_C.fillArray(this._itemColors,_a,String),this._listChanged=!0}),_g(0,_a,"itemSize",function(){return this._itemSize},function(_a){this._itemSize=_a,this._listChanged=!0}),_g(0,_a,"scrollBar",function(){return this.list.scrollBar}),_g(0,_a,"isOpen",function(){return this._isOpen},function(_a){if(this._isOpen!=_a)if(this._isOpen=_a,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var _b=this.localToGlobal(_o.TEMP.setTo(0,0)),_c=_b.y+this._button.height;_c=_c+this._listHeight<=_p.stage.height?_c:_b.y-this._listHeight,this._list.pos(_b.x,_c),this._list.zOrder=1001,_p._currentStage.addChild(this._list),_p.stage.once("mousedown",this,this.removeList),_p.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),_g(0,_a,"scrollBarSkin",function(){return this._scrollBarSkin},function(_a){this._scrollBarSkin=_a}),_g(0,_a,"sizeGrid",function(){return this._button.sizeGrid},function(_a){this._button.sizeGrid=_a}),_g(0,_a,"button",function(){return this._button}),_g(0,_a,"list",function(){return this._list||this._createList(),this._list},function(_a){_a&&(_a.removeSelf(),this._isCustomList=!0,this._list=_a,this._setListEvent(_a),this._itemHeight=_a.getCell(0).height+_a.spaceY)}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)&&Math.floor(_a)==_a||"string"==typeof _a?this.selectedIndex=parseInt(_a):_a instanceof Array?this.labels=_a.join(","):_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"labelColors",function(){return this._button.labelColors},function(_a){this._button.labelColors!=_a&&(this._button.labelColors=_a)}),_g(0,_a,"labelPadding",function(){return this._button.text.padding.join(",")},function(_a){this._button.text.padding=_C.fillArray(_B.labelPadding,_a,Number)}),_g(0,_a,"labelSize",function(){return this._button.text.fontSize},function(_a){this._button.text.fontSize=_a}),_g(0,_a,"labelFont",function(){return this._button.text.font},function(_a){this._button.text.font=_a}),_g(0,_a,"stateNum",function(){return this._button.stateNum},function(_a){this._button.stateNum=_a}),_c}(_F),_M=function(_b){function _c(_a){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,_c.__super.call(this),this._showButtons=_D.showButtons,this._touchScrollEnable=_D.touchScrollEnable,this._mouseWheelEnable=_D.mouseWheelEnable,this.skin=_a,this.max=1}_f(_c,"laya.ui.ScrollBar",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),this.stopScroll(),this.target=null,_b.prototype.destroy.call(this,_a),this.upButton&&this.upButton.destroy(_a),this.downButton&&this.downButton.destroy(_a),this.slider&&this.slider.destroy(_a),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},_a.createChildren=function(){this.addChild(this.slider=new _N),this.addChild(this.upButton=new _I),this.addChild(this.downButton=new _I)},_a.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},_a.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},_a.onButtonMouseDown=function(_a){var _b=_a.currentTarget===this.upButton;this.slide(_b),_p.timer.once(_B.scrollBarDelayTime,this,this.startLoop,[_b]),_p.stage.once("mouseup",this,this.onStageMouseUp)},_a.startLoop=function(_a){_p.timer.frameLoop(1,this,this.slide,[_a])},_a.slide=function(_a){_a?this.value-=this._scrollSize:this.value+=this._scrollSize},_a.onStageMouseUp=function(_a){_p.timer.clear(this,this.startLoop),_p.timer.clear(this,this.slide)},_a.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},_a.changeSize=function(){_b.prototype.changeSize.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},_a.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},_a.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},_a.setScroll=function(_a,_b,_c){this.runCallLater(this.changeSize),this.slider.setSlider(_a,_b,_c),this.slider.bar.visible=0<_b,!this._hide&&this.autoHide&&(this.visible=!1)},_a.onTargetMouseWheel=function(_a){this.value-=_a.delta*this._scrollSize,this.target=this._target},_a.onTargetMouseDown=function(_a){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new _o),this._lastPoint.setTo(_p.stage.mouseX,_p.stage.mouseY),_p.timer.clear(this,this.tweenMove),_x.clearTween(this),_p.stage.once("mouseup",this,this.onStageMouseUp2),_p.stage.once("mouseout",this,this.onStageMouseUp2),_p.timer.frameLoop(1,this,this.loop)},_a.loop=function(){var _a=_p.stage.mouseY,_b=_p.stage.mouseX;if(this._lastOffset=this.isVertical?_a-this._lastPoint.y:_b-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?_p.stage._canvasTransform.getScaleY():_p.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=_b,this._lastPoint.y=_a,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},_a.onStageMouseUp2=function(_a){if(_p.stage.off("mouseup",this,this.onStageMouseUp2),_p.stage.off("mouseout",this,this.onStageMouseUp2),_p.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?_x.to(this,{value:this.min},this.elasticBackTime,_i.sineOut,_m.create(this,this.elasticOver)):this._value>this.max&&_x.to(this,{value:this.max},this.elasticBackTime,_i.sineOut,_m.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?_p.stage.mouseY-this._lastPoint.y:_p.stage.mouseX-this._lastPoint.x);for(var _b=0,_c=Math.min(this._offsets.length,3),_d=0;_d<_c;_d++)_b+=this._offsets[this._offsets.length-1-_d];if(this._lastOffset=_b/_c,(_b=Math.abs(this._lastOffset))<2)return void this.event("end");60<_b&&(this._lastOffset=0<this._lastOffset?60:-60);var _e=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));_p.timer.frameLoop(1,this,this.tweenMove,[_e])}},_a.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&_x.to(this,{alpha:0},500),this.event("end")},_a.tweenMove=function(_a){this._lastOffset*=this.rollRatio;var _b=NaN;if(0<_a&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,_b=.5*-(this.min-_a-this.value),this._lastOffset>_b&&(this._lastOffset=_b)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,_b=.5*-(this.max+_a-this.value),this._lastOffset<_b&&(this._lastOffset=_b))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(_p.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?_x.to(this,{value:this.min},this.elasticBackTime,_i.sineOut,_m.create(this,this.elasticOver)):this._value>this.max?_x.to(this,{value:this.max},this.elasticBackTime,_i.sineOut,_m.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&_x.to(this,{alpha:0},500)}},_a.stopScroll=function(){this.onStageMouseUp2(null),_p.timer.clear(this,this.tweenMove),_x.clearTween(this)},_g(0,_a,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),_g(0,_a,"skin",function(){return this._skin},function(_a){this._skin!=_a&&(this._skin=_a,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),_g(0,_a,"max",function(){return this.slider.max},function(_a){this.slider.max=_a}),_g(0,_a,"showButtons",function(){return this._showButtons},function(_a){this._showButtons=_a,this.callLater(this.changeScrollBar)}),_g(0,_a,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),_g(0,_a,"min",function(){return this.slider.min},function(_a){this.slider.min=_a}),_g(0,_a,"value",function(){return this._value},function(_a){_a!==this._value&&(this._value=_a,this._isElastic||(this.slider._value!=_a&&(this.slider._value=_a,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),_g(0,_a,"isVertical",function(){return this.slider.isVertical},function(_a){this.slider.isVertical=_a}),_g(0,_a,"sizeGrid",function(){return this.slider.sizeGrid},function(_a){this.slider.sizeGrid=_a}),_g(0,_a,"scrollSize",function(){return this._scrollSize},function(_a){this._scrollSize=_a}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)||"string"==typeof _a?this.value=Number(_a):_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"thumbPercent",function(){return this._thumbPercent},function(_a){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),_a=1<=_a?.99:_a,this._thumbPercent=_a,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*_a,_B.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*_a,_B.scrollBarMinNum))}),_g(0,_a,"target",function(){return this._target},function(_a){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=_a)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),_g(0,_a,"hide",function(){return this._hide},function(_a){this._hide=_a,this.visible=!_a}),_g(0,_a,"touchScrollEnable",function(){return this._touchScrollEnable},function(_a){this._touchScrollEnable=_a,this.target=this._target}),_g(0,_a,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(_a){this._mouseWheelEnable=_a,this.target=this._target}),_g(0,_a,"tick",function(){return this.slider.tick},function(_a){this.slider.tick=_a}),_c}(_F),_N=function(_b){function _c(_a){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,_c.__super.call(this),this.skin=_a}_f(_c,"laya.ui.Slider",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._bg&&this._bg.destroy(_a),this._bar&&this._bar.destroy(_a),this._progress&&this._progress.destroy(_a),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},_a.createChildren=function(){this.addChild(this._bg=new _O),this.addChild(this._bar=new _I)},_a.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},_a.onBarMouseDown=function(_a){this._globalSacle||(this._globalSacle=new _o),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=_p.stage.mouseX,this._ty=_p.stage.mouseY,_p.stage.on("mousemove",this,this.mouseMove),_p.stage.once("mouseup",this,this.mouseUp),_p.stage.once("mouseout",this,this.mouseUp),this.showValueText()},_a.showValueText=function(){if(this.showLabel){var _a=laya.ui.Slider.label;this.addChild(_a),_a.textField.changeText(this._value+""),this.isVertical?(_a.x=this._bar.x+20,_a.y=.5*(this._bar.height-_a.height)+this._bar.y):(_a.y=this._bar.y-20,_a.x=.5*(this._bar.width-_a.width)+this._bar.x)}},_a.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},_a.mouseUp=function(_a){_p.stage.off("mousemove",this,this.mouseMove),_p.stage.off("mouseup",this,this.mouseUp),_p.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},_a.mouseMove=function(_a){var _b=this._value;this.isVertical?(this._bar.y+=(_p.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(_p.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=_p.stage.mouseX,this._ty=_p.stage.mouseY;var _c=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*_c)/_c,this._value!=_b&&this.sendChangeEvent(),this.showValueText()},_a.sendChangeEvent=function(_a){void 0===_a&&(_a="change"),this.event(_a),this.changeHandler&&this.changeHandler.runWith(this._value)},_a.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},_a.changeSize=function(){_b.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},_a.setSlider=function(_a,_b,_c){this._value=-1,this._min=_a,this._max=_a<_b?_b:_a,this.value=_c<_a?_a:_b<_c?_b:_c},_a.changeValue=function(){var _a=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*_a)/_a,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var _b=this._max-this._min;0===_b&&(_b=1),this.isVertical?(this._bar.y=(this._value-this._min)/_b*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/_b*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},_a.onBgMouseDown=function(_a){var _b=this._bg.getMousePoint();this.isVertical?this.value=_b.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=_b.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},_g(0,_a,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),_g(0,_a,"skin",function(){return this._skin},function(_a){if(this._skin!=_a){this._skin=_a,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var _b=this._skin.replace(".png","$progress.png");_s.getRes(_b)&&(this._progress||(this.addChild(this._progress=new _O),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=_b),this.setBarPoint(),this.callLater(this.changeValue)}}),_g(0,_a,"allowClickBack",function(){return this._allowClickBack},function(_a){this._allowClickBack!=_a&&((this._allowClickBack=_a)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),_g(0,_a,"max",function(){return this._max},function(_a){this._max!=_a&&(this._max=_a,this.callLater(this.changeValue))}),_g(0,_a,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),_g(0,_a,"tick",function(){return this._tick},function(_a){this._tick!=_a&&(this._tick=_a,this.callLater(this.changeValue))}),_g(0,_a,"sizeGrid",function(){return this._bg.sizeGrid},function(_a){this._bg.sizeGrid=_a,this._bar.sizeGrid=_a,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),_g(0,_a,"min",function(){return this._min},function(_a){this._min!=_a&&(this._min=_a,this.callLater(this.changeValue))}),_g(0,_a,"value",function(){return this._value},function(_a){if(this._value!=_a){var _b=this._value;this._value=_a,this.changeValue(),this._value!=_b&&this.sendChangeEvent()}}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)||"string"==typeof _a?this.value=Number(_a):_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"bar",function(){return this._bar}),_d(_c,["label",function(){return this.label=new _P}]),_c}(_F),_O=function(_b){function _c(_a){this._bitmap=null,this._skin=null,this._group=null,this._complete=null,this._progress=null,_c.__super.call(this),this.skin=_a}_f(_c,"laya.ui.Image",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,!0),this.clearLoad(),this.clearEvent(),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,_s.clearCache(this,this._skin)},_a.dispose=function(){this.destroy(!0),_s.clearCache(this,this._skin),this.clearEvent()},_a.createChildren=function(){this.graphics=this._bitmap=new _E},_a.setSource=function(_a,_b){_a===this._skin&&_b&&(this.source=_b,this.onCompResize(),this.clearEvent())},_a.clearEvent=function(){this._skin&&_e.atalsNotify&&_e.atalsNotify.off(this._skin,this,this.setSource)},_a.clearLoad=function(){this._skin&&((this._complete||this._progress)&&_p.loader.cancel(this._skin,this._complete,this._progress),this._complete=this._progress=null)},_g(0,_a,"source",function(){return this._bitmap.source},function(_a){this._bitmap&&(this._bitmap.source=_a,this.event("loaded"),this.repaint())}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"string"==typeof(this._dataSource=_a)?this.skin=_a:_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"measureHeight",function(){return this._bitmap.height}),_g(0,_a,"skin",function(){return this._skin},function(_a){if(this._skin!=_a)if(_s.clearCache(this,this._skin),this.clearEvent(),this.clearLoad(),this._skin=_a){_s.keepCache(this,this._skin);var _b=_s.getRes(_a),_c=_e.resAtalsObj&&_e.resAtalsObj[this._skin];_b?(this.source=_b,this.onCompResize()):_c?(_e.atalsNotify&&_e.atalsNotify.once(this._skin,this,this.setSource),0==this.width&&(this.width=_c.sourceW),0==this.height&&(this.height=_c.sourceH)):(this._complete=_m.create(this,this.setSource,[this._skin]),this._progress=null,_p.loader.load(this._skin,this._complete,this._progress,"image",1,!0,this._group))}else this.source=null}),_g(0,_a,"group",function(){return this._group},function(_a){_a&&this._skin&&_s.setGroup(this._skin,_a),this._group=_a}),_g(0,_a,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(_a){this._bitmap.sizeGrid=_C.fillArray(_B.defaultSizeGrid,_a,Number)}),_g(0,_a,"measureWidth",function(){return this._bitmap.width}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_F,this,"width",_a),this._bitmap.width=0==_a?1e-7:_a}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_F,this,"height",_a),this._bitmap.height=0==_a?1e-7:_a}),_c}(_F),_P=function(_b){function _c(_a){this._tf=null,_c.__super.call(this),void 0===_a&&(_a=""),_k.defaultColor=_B.labelColor,this.text=_a}_f(_c,"laya.ui.Label",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._tf=null},_a.createChildren=function(){this.addChild(this._tf=new _v)},_a.changeText=function(_a){this._tf.changeText(_a)},_g(0,_a,"padding",function(){return this._tf.padding.join(",")},function(_a){this._tf.padding=_C.fillArray(_B.labelPadding,_a,Number)}),_g(0,_a,"bold",function(){return this._tf.bold},function(_a){this._tf.bold=_a}),_g(0,_a,"align",function(){return this._tf.align},function(_a){this._tf.align=_a}),_g(0,_a,"text",function(){return this._tf.text},function(_a){this._tf.text!=_a&&(_a&&(_a=_C.adptString(_a+"")),this._tf.text=_a,this.event("change"),this._width&&this._height||this.onCompResize())}),_g(0,_a,"italic",function(){return this._tf.italic},function(_a){this._tf.italic=_a}),_g(0,_a,"wordWrap",function(){return this._tf.wordWrap},function(_a){this._tf.wordWrap=_a}),_g(0,_a,"font",function(){return this._tf.font},function(_a){this._tf.font=_a}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)||"string"==typeof _a?this.text=_a+"":_p.superSet(_F,this,"dataSource",_a)}),_g(0,_a,"color",function(){return this._tf.color},function(_a){this._tf.color=_a}),_g(0,_a,"valign",function(){return this._tf.valign},function(_a){this._tf.valign=_a}),_g(0,_a,"leading",function(){return this._tf.leading},function(_a){this._tf.leading=_a}),_g(0,_a,"fontSize",function(){return this._tf.fontSize},function(_a){this._tf.fontSize=_a}),_g(0,_a,"bgColor",function(){return this._tf.bgColor},function(_a){this._tf.bgColor=_a}),_g(0,_a,"borderColor",function(){return this._tf.borderColor},function(_a){this._tf.borderColor=_a}),_g(0,_a,"stroke",function(){return this._tf.stroke},function(_a){this._tf.stroke=_a}),_g(0,_a,"strokeColor",function(){return this._tf.strokeColor},function(_a){this._tf.strokeColor=_a}),_g(0,_a,"textField",function(){return this._tf}),_g(0,_a,"measureWidth",function(){return this._tf.width}),_g(0,_a,"measureHeight",function(){return this._tf.height}),_g(0,_a,"width",function(){return this._width||this._tf.text?_p.superGet(_F,this,"width"):0},function(_a){_p.superSet(_F,this,"width",_a),this._tf.width=_a}),_g(0,_a,"height",function(){return this._height||this._tf.text?_p.superGet(_F,this,"height"):0},function(_a){_p.superSet(_F,this,"height",_a),this._tf.height=_a}),_g(0,_a,"overflow",function(){return this._tf.overflow},function(_a){this._tf.overflow=_a}),_g(0,_a,"underline",function(){return this._tf.underline},function(_a){this._tf.underline=_a}),_g(0,_a,"underlineColor",function(){return this._tf.underlineColor},function(_a){this._tf.underlineColor=_a}),_c}(_F),_Q=function(_b){function _c(_a){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,_c.__super.call(this),this.skin=_a}_f(_c,"laya.ui.ProgressBar",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._bg&&this._bg.destroy(_a),this._bar&&this._bar.destroy(_a),this._bg=this._bar=null,this.changeHandler=null},_a.createChildren=function(){this.addChild(this._bg=new _O),this.addChild(this._bar=new _O)},_a.changeValue=function(){if(this.sizeGrid){var _a=this.sizeGrid.split(","),_b=Number(_a[3]),_c=Number(_a[1]),_d=(this.width-_b-_c)*this._value;this._bar.width=_b+_c+_d,this._bar.visible=this._bar.width>_b+_c}else this._bar.width=this.width*this._value},_g(0,_a,"measureHeight",function(){return this._bg.height}),_g(0,_a,"skin",function(){return this._skin},function(_a){this._skin!=_a&&(this._skin=_a,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),_g(0,_a,"measureWidth",function(){return this._bg.width}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_F,this,"height",_a),this._bg.height=this._height,this._bar.height=this._height}),_g(0,_a,"bar",function(){return this._bar}),_g(0,_a,"value",function(){return this._value},function(_a){this._value!=_a&&(_a=1<_a?1:_a<0?0:_a,this._value=_a,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(_a))}),_g(0,_a,"bg",function(){return this._bg}),_g(0,_a,"sizeGrid",function(){return this._bg.sizeGrid},function(_a){this._bg.sizeGrid=this._bar.sizeGrid=_a}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_F,this,"width",_a),this._bg.width=this._width,this.callLater(this.changeValue)}),_g(0,_a,"dataSource",_b.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)||"string"==typeof _a?this.value=Number(_a):_p.superSet(_F,this,"dataSource",_a)}),_c}(_F),_R=(function(_a){function _c(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,_c.__super.call(this),this._tipBox=new _F,this._tipBox.addChild(this._tipText=new _v),this._tipText.x=this._tipText.y=5,this._tipText.color=_c.tipTextColor,this._defaultTipHandler=this._showDefaultTip,_p.stage.on("showtip",this,this._onStageShowTip),_p.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}_f(_c,"laya.ui.TipManager",_F);var _b=_c.prototype;_b._onStageHideTip=function(_a){_p.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},_b._onStageShowTip=function(_a){_p.timer.once(_c.tipDelay,this,this._showTip,[_a],!0)},_b._showTip=function(_a){if("string"==typeof _a){var _b=String(_a);Boolean(_b)&&this._defaultTipHandler(_b)}else _a instanceof laya.utils.Handler?_a.run():"function"==typeof _a&&_a.apply();_p.stage.on("mousemove",this,this._onStageMouseMove),_p.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},_b._onStageMouseDown=function(_a){this.closeAll()},_b._onStageMouseMove=function(_a){this._showToStage(this,_c.offsetX,_c.offsetY)},_b._showToStage=function(_a,_b,_c){void 0===_b&&(_b=0),void 0===_c&&(_c=0);var _d=_a.getBounds();_a.x=_p.stage.mouseX+_b,_a.y=_p.stage.mouseY+_c,_a.x+_d.width>_p.stage.width&&(_a.x-=_d.width+_b),_a.y+_d.height>_p.stage.height&&(_a.y-=_d.height+_c)},_b.closeAll=function(){_p.timer.clear(this,this._showTip),_p.stage.off("mousemove",this,this._onStageMouseMove),_p.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},_b.showDislayTip=function(_a){this.addChild(_a),this._showToStage(this),_p._currentStage.addChild(this)},_b._showDefaultTip=function(_a){this._tipText.text=_a;var _b=this._tipBox.graphics;_b.clear(),_b.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,_c.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),_p._currentStage.addChild(this)},_g(0,_b,"defaultTipHandler",function(){return this._defaultTipHandler},function(_a){this._defaultTipHandler=_a}),_c.offsetX=10,_c.offsetY=15,_c.tipTextColor="#ffffff",_c.tipBackColor="#111111",_c.tipDelay=200}(),function(_a){var _n;function _o(){this._idMap=null,this._aniList=null,this._watchMap={},_o.__super.call(this)}_f(_o,"laya.ui.View",_H);var _b=_o.prototype;return _b.createView=function(_a){if(_a.animations&&!this._idMap&&(this._idMap={}),_o.createComp(_a,this,this),_a.animations){var _b,_c,_d=[],_e=_a.animations,_f=0,_g=_e.length;for(_f=0;_f<_g;_f++){switch(_b=new _l,_c=_e[_f],_b._setUp(this._idMap,_c),(this[_c.name]=_b)._setControlNode(this),_c.action){case 1:_b.play(0,!1);break;case 2:_b.play(0,!0)}_d.push(_b)}this._aniList=_d}0<this._width&&null==_a.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},_b.onEvent=function(_a,_b){},_b.loadUI=function(_a){var _b=_o.uiMap[_a];_b&&this.createView(_b)},_b.destroy=function(_a){void 0===_a&&(_a=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,this._watchMap=null,laya.ui.Component.prototype.destroy.call(this,_a)},_b.changeData=function(_a){var _b=this._watchMap[_a];if(_b){console.log("change",_a);for(var _c=0,_d=_b.length;_c<_d;_c++){_b[_c].exe(this)}}},_o._regs=function(){for(var _a in _o.uiClassMap)_q.regClass(_a,_o.uiClassMap[_a])},_o.createComp=function(_a,_b,_c,_d){if(!(_b=_b||_o.getCompInstance(_a)))return console.warn("can not create:"+_a.type),null;var _e=_a.child;if(_e)for(var _f=_b instanceof laya.ui.List,_g=0,_h=_e.length;_g<_h;_g++){var _i=_e[_g];if(!_b.hasOwnProperty("itemRender")||"render"!=_i.props.name&&"render"!==_i.props.renderType)if("Graphic"==_i.type)_q.addGraphicsToSprite(_i,_b);else if(_q.isDrawType(_i.type))_q.addGraphicToSprite(_i,_b,!0);else{if(_f){var _j=[],_k=_o.createComp(_i,null,_c,_j);_j.length&&(_k._$bindData=_j)}else _k=_o.createComp(_i,null,_c,_d);"Script"==_i.type?"owner"in _k?_k.owner=_b:"target"in _k&&(_k.target=_b):"mask"==_i.props.renderType||"mask"==_i.props.name?_b.mask=_k:_k instanceof laya.display.Sprite&&_b.addChild(_k)}else _b.itemRender=_i}var _l=_a.props;for(var _m in _l){var _n=_l[_m];_o.eventDic[_m]?_n&&_c&&_b.on(_m,_c,_c.onEvent,[_n]):_o.setCompValue(_b,_m,_n,_c,_d)}return _p.__typeof(_b,"laya.ui.IItem")&&_b.initItems(),_a.compId&&_c&&_c._idMap&&(_c._idMap[_a.compId]=_b),_b},_o.setCompValue=function(_a,_b,_c,_d,_e){if("string"==typeof _c&&-1<_c.indexOf("${")){if(_o._sheet||(_o._sheet=_q.getClass("laya.data.Table")),!_o._sheet)return void console.warn("Can not find class Sheet");if(_e)_e.push(_a,_b,_c);else if(_d){-1==_c.indexOf("].")&&(_c=_c.replace(".","[0]."));var _f,_g,_h=new _n(_a,_b,_c);_h.exe(_d);for(var _i=_c.replace(/\[.*?\]\./g,".");null!=(_f=_o._parseWatchData.exec(_i));){for(var _j=_f[1];null!=(_g=_o._parseKeyWord.exec(_j));){var _k=_g[0],_l=_d._watchMap[_k]||(_d._watchMap[_k]=[]);_l.push(_h),_o._sheet.I.notifer.on(_k,_d,_d.changeData,[_k])}(_l=_d._watchMap[_j]||(_d._watchMap[_j]=[])).push(_h),_o._sheet.I.notifer.on(_j,_d,_d.changeData,[_j])}}}else if("var"===_b&&_d)_d[_c]=_a;else if("onClick"==_b){var _m=_p._runScript("(function(){"+_c+"})");_a.on("click",_d,_m)}else _a[_b]="true"===_c||"false"!==_c&&_c},_o.getCompInstance=function(_a){var _b,_c=_a.props?_a.props.runtime:null;return _b=_c?_o.viewClassMap[_c]||_o.uiClassMap[_c]||_p.__classmap[_c]:_o.uiClassMap[_a.type],_a.props&&_a.props.hasOwnProperty("renderType")&&"instance"==_a.props.renderType?_b.instance:_b?new _b:null},_o.regComponent=function(_a,_b){_o.uiClassMap[_a]=_b,_q.regClass(_a,_b)},_o.regViewRuntime=function(_a,_b){_o.viewClassMap[_a]=_b},_o.uiMap={},_o.viewClassMap={},_o._sheet=null,_d(_o,["uiClassMap",function(){return this.uiClassMap={ViewStack:_aa,LinkButton:_I,TextArea:_ja,ColorPicker:_K,Box:_H,Button:_I,CheckBox:_S,Clip:_J,ComboBox:_L,Component:_F,HScrollBar:_W,HSlider:_Y,Image:_O,Label:_P,List:_V,Panel:_X,ProgressBar:_Q,Radio:_$,RadioGroup:_ha,ScrollBar:_M,Slider:_N,Tab:_ia,TextInput:_ca,View:_o,VScrollBar:_ba,VSlider:_da,Tree:__,HBox:_fa,VBox:_ga,Sprite:_u,Animation:_c,Text:_v,FontClip:_U}},"eventDic",function(){return this.eventDic={mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0,rightmousedown:!0,rightmouseup:!0,rightclick:!0}},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),_o.__init$=function(){_o._regs(),_n=function(){function _a(_a,_b,_c){this.comp=null,this.prop=null,this.value=null,this.comp=_a,this.prop=_b,this.value=_c}return _f(_a,""),_a.prototype.exe=function(_a){var _b=_C.getBindFun(this.value);this.comp[this.prop]=_b.call(this,_a)},_a}()},_o}()),_S=function(_a){function _c(_a,_b){void 0===_b&&(_b=""),_c.__super.call(this,_a,_b)}_f(_c,"laya.ui.CheckBox",_a);var _b=_c.prototype;return _b.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},_b.initialize=function(){_a.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},_g(0,_b,"dataSource",_a.prototype._$get_dataSource,function(_a){"boolean"==typeof(this._dataSource=_a)?this.selected=_a:"string"==typeof _a?this.selected="true"===_a:_p.superSet(_I,this,"dataSource",_a)}),_c}(_I),_T=function(_a){function _b(){this._space=0,this._align="none",this._itemChanged=!1,_b.__super.call(this)}_f(_b,"laya.ui.LayoutBox",_H);var _c=_b.prototype;return _c.addChild=function(_a){return _a.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,_a)},_c.onResize=function(_a){this._setItemChanged()},_c.addChildAt=function(_a,_b){return _a.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,_a,_b)},_c.removeChild=function(_a){return _a.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,_a)},_c.removeChildAt=function(_a){return this.getChildAt(_a).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,_a)},_c.refresh=function(){this._setItemChanged()},_c.changeItems=function(){this._itemChanged=!1},_c.sortItem=function(_a){_a&&_a.sort(function(_a,_b){return _a.y-_b.y})},_c._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},_g(0,_c,"space",function(){return this._space},function(_a){this._space=_a,this._setItemChanged()}),_g(0,_c,"align",function(){return this._align},function(_a){this._align=_a,this._setItemChanged()}),_b}(),_U=function(_b){function _c(_a,_b){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,_c.__super.call(this),_a&&(this.skin=_a),_b&&(this.sheet=_b)}_f(_c,"laya.ui.FontClip",_b);var _a=_c.prototype;return _a.createChildren=function(){this._bitmap=new _E,this.on("loaded",this,this._onClipLoaded)},_a._onClipLoaded=function(){this.callLater(this.changeValue)},_a.changeValue=function(){var _a;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),_a=this._sources[0]))){var _b="horizontal"===this._direction;_b?(this._wordsW=this._valueArr.length*(_a.sourceWidth+this.spaceX),this._wordsH=_a.sourceHeight):(this._wordsW=_a.sourceWidth,this._wordsH=(_a.sourceHeight+this.spaceY)*this._valueArr.length);var _c=0;if(this._width)switch(this._align){case"center":_c=.5*(this._width-this._wordsW);break;case"right":_c=this._width-this._wordsW;break;default:_c=0}for(var _d=0,_e=this._valueArr.length;_d<_e;_d++){var _f=this._indexMap[this._valueArr.charAt(_d)];this.sources[_f]&&(_a=this.sources[_f],_b?this.graphics.drawTexture(_a,_c+_d*(_a.sourceWidth+this.spaceX),0,_a.sourceWidth,_a.sourceHeight):this.graphics.drawTexture(_a,0+_c,_d*(_a.sourceHeight+this.spaceY),_a.sourceWidth,_a.sourceHeight))}this._width||(this.resetLayoutX(),this.callLater(this.changeSize)),this._height||(this.resetLayoutY(),this.callLater(this.changeSize))}},_a.destroy=function(_a){void 0===_a&&(_a=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),_b.prototype.destroy.call(this,_a)},_g(0,_a,"sheet",function(){return this._sheet},function(_a){_a+="";var _b=(this._sheet=_a).split(" ");this._clipX=String(_b[0]).length,this.clipY=_b.length,this._indexMap={};for(var _c=0;_c<this._clipY;_c++)for(var _d=_b[_c].split(""),_e=0,_f=_d.length;_e<_f;_e++)this._indexMap[_d[_e]]=_c*this._clipX+_e}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_J,this,"height",_a),this.callLater(this.changeValue)}),_g(0,_a,"direction",function(){return this._direction},function(_a){this._direction=_a,this.callLater(this.changeValue)}),_g(0,_a,"value",function(){return this._valueArr?this._valueArr:""},function(_a){_a+="",this._valueArr=_a,this.callLater(this.changeValue)}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_J,this,"width",_a),this.callLater(this.changeValue)}),_g(0,_a,"spaceX",function(){return this._spaceX},function(_a){this._spaceX=_a,"horizontal"===this._direction&&this.callLater(this.changeValue)}),_g(0,_a,"spaceY",function(){return this._spaceY},function(_a){this._spaceY=_a,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),_g(0,_a,"align",function(){return this._align},function(_a){this._align=_a,this.callLater(this.changeValue)}),_g(0,_a,"measureWidth",function(){return this._wordsW}),_g(0,_a,"measureHeight",function(){return this._wordsH}),_c}(_J),_V=function(_a){function _b(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._cells=[],this._offset=new _o,_b.__super.call(this)}_f(_b,"laya.ui.List",_a);var _c=_b.prototype;return _p.imps(_c,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),_c.destroy=function(_a){void 0===_a&&(_a=!0),this._content&&this._content.destroy(_a),this._scrollBar&&this._scrollBar.destroy(_a),laya.ui.Component.prototype.destroy.call(this,_a),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},_c.createChildren=function(){this.addChild(this._content=new _H)},_c.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=_p.superGet(_H,this,"cacheAs")),_p.superSet(_H,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},_c.onScrollEnd=function(){_p.superSet(_H,this,"cacheAs",this._$P.cacheAs)},_c._removePreScrollBar=function(){var _a=this.removeChildByName("scrollBar");_a&&_a.destroy(!0)},_c.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var _a=this._getOneCell(),_b=_a.width+this._spaceX||1,_c=_a.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/_b):Math.ceil(this._width/_b)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/_c):Math.round(this._height/_c));var _d=this._width?this._width:_b*this.repeatX-this._spaceX,_e=this._height?this._height:_c*this.repeatY-this._spaceY;this._cellSize=this._isVertical?_c:_b,this._cellOffset=this._isVertical?_c*Math.max(this._repeatY2,this._repeatY)-_e-this._spaceY:_b*Math.max(this._repeatX2,this._repeatX)-_d-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=_e:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=_d),this.setContentSize(_d,_e);var _f=this._isVertical?this.repeatX:this.repeatY,_g=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,_f,_g),this._createdLine=_g,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},_c._getOneCell=function(){if(0===this._cells.length){var _a=this.createItem();if(this._offset.setTo(_a.x,_a.y),this.cacheContent)return _a;this._cells.push(_a)}return this._cells[0]},_c._createItems=function(_a,_b,_c){var _d=this._content,_e=this._getOneCell(),_f=_e.width+this._spaceX,_g=_e.height+this._spaceY;if(this.cacheContent){var _h=new _H;_h.cacheAsBitmap=!0,_h.pos((this._isVertical?0:_a)*_f,(this._isVertical?_a:0)*_g),this._content.addChild(_h),this._content.optimizeScrollRect=!0,_d=_h}else{for(var _i=[],_j=this._cells.length-1;-1<_j;_j--){var _k=this._cells[_j];_k.removeSelf(),_i.push(_k)}this._cells.length=0}for(var _l=_a;_l<_c;_l++)for(var _m=0;_m<_b;_m++)(_e=_i&&_i.length?_i.pop():this.createItem()).x=(this._isVertical?_m:_l)*_f-_d.x,_e.y=(this._isVertical?_l:_m)*_g-_d.y,_e.name="item"+(_l*_b+_m),_d.addChild(_e),this.addCell(_e)},_c.createItem=function(){var _a=[];if("function"==typeof this._itemRender)var _b=new this._itemRender;else _b=_R.createComp(this._itemRender,null,null,_a);if(0==_a.length&&_b._watchMap){var _c=_b._watchMap;for(var _d in _c)for(var _e=_c[_d],_f=0;_f<_e.length;_f++){var _g=_e[_f];_a.push(_g.comp,_g.prop,_g.value)}}return _a.length&&(_b._$bindData=_a),_b},_c.addCell=function(_a){_a.on("click",this,this.onCellMouse),_a.on("rightclick",this,this.onCellMouse),_a.on("mouseover",this,this.onCellMouse),_a.on("mouseout",this,this.onCellMouse),_a.on("mousedown",this,this.onCellMouse),_a.on("mouseup",this,this.onCellMouse),this._cells.push(_a)},_c.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var _a=0,_b=_a=0;_b<1e4;_b++){var _c=this.getChildByName("item"+_b);if(!_c)break;this.addCell(_c),_a++}this.repeatY=_a}},_c.setContentSize=function(_a,_b){this._content.width=_a,this._content.height=_b,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new _r),this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,_a,_b),this._content.scrollRect=this._content.scrollRect),this.event("resize")},_c.onCellMouse=function(_a){"mousedown"===_a.type&&(this._isMoved=!1);var _b=_a.currentTarget,_c=this._startIndex+this._cells.indexOf(_b);_c<0||("click"===_a.type||"rightclick"===_a.type?this.selectEnable&&!this._isMoved?this.selectedIndex=_c:this.changeCellState(_b,!0,0):"mouseover"!==_a.type&&"mouseout"!==_a.type||this._selectedIndex===_c||this.changeCellState(_b,"mouseover"===_a.type,0),this.mouseHandler&&this.mouseHandler.runWith([_a,_c]))},_c.changeCellState=function(_a,_b,_c){var _d=_a.getChildByName("selectBox");_d&&(this.selectEnable=!0,_d.visible=_b,_d.index=_c)},_c.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},_c.onScrollBarChange=function(_a){this.runCallLater(this.changeCells);var _b=this._scrollBar.value,_c=this._isVertical?this.repeatX:this.repeatY,_d=this._isVertical?this.repeatY:this.repeatX,_e=Math.floor(_b/this._cellSize);if(this.cacheContent)_g=_d+1,this._createdLine-_e<_g&&(this._createItems(this._createdLine,_c,this._createdLine+_g),this.renderItems(this._createdLine*_c,0),this._createdLine+=_g);else{var _f=_e*_c,_g=0;if(_f>this._startIndex){_g=_f-this._startIndex;var _h=!0,_i=this._startIndex+_c*(_d+1);this._isMoved=!0}else _f<this._startIndex&&(_g=this._startIndex-_f,_h=!1,_i=this._startIndex-1,this._isMoved=!0);for(var _j=0;_j<_g;_j++){if(_h){var _k=this._cells.shift();this._cells[this._cells.length]=_k;var _l=_i+_j}else _k=this._cells.pop(),this._cells.unshift(_k),_l=_i-_j;var _m=Math.floor(_l/_c)*this._cellSize;this._isVertical?_k.y=_m:_k.x=_m,this.renderItem(_k,_l)}this._startIndex=_f,this.changeSelectStatus()}var _n=this._content.scrollRect;this._isVertical?(_n.y=_b-this._offset.y,_n.x=-this._offset.x):(_n.y=-this._offset.y,_n.x=_b-this._offset.x),this._content.scrollRect=_n},_c.posCell=function(_a,_b){if(this._scrollBar){var _c=this._isVertical?this.repeatX:this.repeatY,_d=(this._isVertical?this.repeatY:this.repeatX,Math.floor(_b/_c)*this._cellSize);this._isVertical?_a.y=_d:_a.x=_d}},_c.changeSelectStatus=function(){for(var _a=0,_b=this._cells.length;_a<_b;_a++)this.changeCellState(this._cells[_a],this._selectedIndex===this._startIndex+_a,1)},_c.renderItems=function(_a,_b){void 0===_a&&(_a=0),void 0===_b&&(_b=0);for(var _c=_a,_d=_b||this._cells.length;_c<_d;_c++)this.renderItem(this._cells[_c],this._startIndex+_c);this.changeSelectStatus()},_c.renderItem=function(_a,_b){this._array&&0<=_b&&_b<this._array.length?(_a.visible=!0,_a._$bindData?(_a._dataSource=this._array[_b],this._bindData(_a,this._array[_b])):_a.dataSource=this._array[_b],this.cacheContent||this.posCell(_a,_b),this.hasListener("render")&&this.event("render",[_a,_b]),this.renderHandler&&this.renderHandler.runWith([_a,_b])):(_a.visible=!1,_a.dataSource=null)},_c._bindData=function(_a,_b){for(var _c=_a._$bindData,_d=0,_e=_c.length;_d<_e;_d++){var _f=_c[_d++],_g=_c[_d++],_h=_c[_d],_i=_C.getBindFun(_h);_f[_g]=_i.call(this,_b)}},_c.refresh=function(){this.array=this._array},_c.getItem=function(_a){return-1<_a&&_a<this._array.length?this._array[_a]:null},_c.changeItem=function(_a,_b){-1<_a&&_a<this._array.length&&(this._array[_a]=_b,_a>=this._startIndex&&_a<this._startIndex+this._cells.length&&this.renderItem(this.getCell(_a),_a))},_c.setItem=function(_a,_b){this.changeItem(_a,_b)},_c.addItem=function(_a){this._array.push(_a),this.array=this._array},_c.addItemAt=function(_a,_b){this._array.splice(_b,0,_a),this.array=this._array},_c.deleteItem=function(_a){this._array.splice(_a,1),this.array=this._array},_c.getCell=function(_a){return this.runCallLater(this.changeCells),-1<_a&&this._cells?this._cells[(_a-this._startIndex)%this._cells.length]:null},_c.scrollTo=function(_a){if(this._scrollBar){var _b=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(_a/_b)*this._cellSize}else this.startIndex=_a},_c.tweenTo=function(_a,_b,_c){if(void 0===_b&&(_b=200),this._scrollBar){var _d=this._isVertical?this.repeatX:this.repeatY;_x.to(this._scrollBar,{value:Math.floor(_a/_d)*this._cellSize},_b,null,_c,0,!0)}else this.startIndex=_a,_c&&_c.run()},_c._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},_c.commitMeasure=function(){this.runCallLater(this.changeCells)},_g(0,_c,"cacheAs",_a.prototype._$get_cacheAs,function(_a){_p.superSet(_H,this,"cacheAs",_a),this._scrollBar&&(this._$P.cacheAs=null,"none"!==_a?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),_g(0,_c,"content",function(){return this._content}),_g(0,_c,"height",_a.prototype._$get_height,function(_a){_a!=this._height&&(_p.superSet(_H,this,"height",_a),this._setCellChanged())}),_g(0,_c,"itemRender",function(){return this._itemRender},function(_a){if(this._itemRender!=_a){this._itemRender=_a;for(var _b=this._cells.length-1;-1<_b;_b--)this._cells[_b].destroy();this._cells.length=0,this._setCellChanged()}}),_g(0,_c,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(_a){this._removePreScrollBar();var _b=new _ba;_b.name="scrollBar",_b.right=0,_a&&" "!=_a&&(_b.skin=_a),this.scrollBar=_b,this.addChild(_b),this._setCellChanged()}),_g(0,_c,"page",function(){return this._page},function(_a){this._page=_a,this._array&&(this._page=0<_a?_a:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),_g(0,_c,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(_a){this._removePreScrollBar();var _b=new _W;_b.name="scrollBar",_b.bottom=0,_a&&" "!=_a&&(_b.skin=_a),this.scrollBar=_b,this.addChild(_b),this._setCellChanged()}),_g(0,_c,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(_a){this._repeatX=_a,this._setCellChanged()}),_g(0,_c,"scrollBar",function(){return this._scrollBar},function(_a){this._scrollBar!=_a&&(this._scrollBar=_a)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),_g(0,_c,"width",_a.prototype._$get_width,function(_a){_a!=this._width&&(_p.superSet(_H,this,"width",_a),this._setCellChanged())}),_g(0,_c,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(_a){this._repeatY=_a,this._setCellChanged()}),_g(0,_c,"spaceX",function(){return this._spaceX},function(_a){this._spaceX=_a,this._setCellChanged()}),_g(0,_c,"spaceY",function(){return this._spaceY},function(_a){this._spaceY=_a,this._setCellChanged()}),_g(0,_c,"selectedIndex",function(){return this._selectedIndex},function(_a){this._selectedIndex!=_a&&(this._selectedIndex=_a,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(_a),this.startIndex=this._startIndex)}),_g(0,_c,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(_a){this.selectedIndex=this._array.indexOf(_a)}),_g(0,_c,"length",function(){return this._array?this._array.length:0}),_g(0,_c,"selection",function(){return this.getCell(this._selectedIndex)},function(_a){this.selectedIndex=this._startIndex+this._cells.indexOf(_a)}),_g(0,_c,"startIndex",function(){return this._startIndex},function(_a){this._startIndex=0<_a?_a:0,this.callLater(this.renderItems)}),_g(0,_c,"array",function(){return this._array},function(_a){this.runCallLater(this.changeCells),this._array=_a||[];var _b=this._array.length;if(this.totalPage=Math.ceil(_b/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<_b?this._selectedIndex:_b-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var _c=this._isVertical?this.repeatX:this.repeatY,_d=this._isVertical?this.repeatY:this.repeatX,_e=Math.ceil(_b/_c);1<(0<this._cellOffset?this.totalPage+1:this.totalPage)?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=_d/_e,this._scrollBar.setScroll(0,(_e-_d)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content}}),_g(0,_c,"dataSource",_a.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)&&Math.floor(_a)==_a||"string"==typeof _a?this.selectedIndex=parseInt(_a):_a instanceof Array?this.array=_a:_p.superSet(_H,this,"dataSource",_a)}),_g(0,_c,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),_b}(_H),_W=function(_a){function _b(){_b.__super.call(this)}return _f(_b,"laya.ui.HScrollBar",_a),_b.prototype.initialize=function(){_a.prototype.initialize.call(this),this.slider.isVertical=!1},_b}(_M),_X=function(_a){function _b(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,_b.__super.call(this),this.width=this.height=100}_f(_b,"laya.ui.Panel",_a);var _c=_b.prototype;return _c.destroy=function(_a){void 0===_a&&(_a=!0),laya.ui.Component.prototype.destroy.call(this,_a),this._content&&this._content.destroy(_a),this._vScrollBar&&this._vScrollBar.destroy(_a),this._hScrollBar&&this._hScrollBar.destroy(_a),this._vScrollBar=null,this._hScrollBar=null,this._content=null},_c.destroyChildren=function(){this._content.destroyChildren()},_c.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new _H)},_c.addChild=function(_a){return _a.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(_a)},_c.onResize=function(){this._setScrollChanged()},_c.addChildAt=function(_a,_b){return _a.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(_a,_b)},_c.removeChild=function(_a){return _a.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(_a)},_c.removeChildAt=function(_a){return this.getChildAt(_a).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(_a)},_c.removeChildren=function(_a,_b){return void 0===_a&&(_a=0),void 0===_b&&(_b=2147483647),this._content.removeChildren(_a,_b),this._setScrollChanged(),this},_c.getChildAt=function(_a){return this._content.getChildAt(_a)},_c.getChildByName=function(_a){return this._content.getChildByName(_a)},_c.getChildIndex=function(_a){return this._content.getChildIndex(_a)},_c.changeScroll=function(){this._scrollChanged=!1;var _a=this.contentWidth||1,_b=this.contentHeight||1,_c=this._vScrollBar,_d=this._hScrollBar,_e=_c&&_b>this._height,_f=_d&&_a>this._width,_g=_e?this._width-_c.width:this._width,_h=_f?this._height-_d.height:this._height;_c&&(_c.x=this._width-_c.width,_c.y=0,_c.height=this._height-(_f?_d.height:0),_c.scrollSize=Math.max(.033*this._height,1),_c.thumbPercent=_h/_b,_c.setScroll(0,_b-_h,_c.value)),_d&&(_d.x=0,_d.y=this._height-_d.height,_d.width=this._width-(_e?_c.width:0),_d.scrollSize=Math.max(.033*this._width,1),_d.thumbPercent=_g/_a,_d.setScroll(0,_a-_g,_d.value))},_c.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},_c.setContentSize=function(_a,_b){var _c=this._content;_c.width=_a,_c.height=_b,_c.scrollRect||(_c.scrollRect=new _r),_c.scrollRect.setTo(0,0,_a,_b),_c.scrollRect=_c.scrollRect},_c.onScrollBarChange=function(_a){var _b=this._content.scrollRect;if(_b){var _c=Math.round(_a.value);_a.isVertical?_b.y=_c:_b.x=_c,this._content.scrollRect=_b}},_c.scrollTo=function(_a,_b){void 0===_a&&(_a=0),void 0===_b&&(_b=0),this.vScrollBar&&(this.vScrollBar.value=_b),this.hScrollBar&&(this.hScrollBar.value=_a)},_c.refresh=function(){this.changeScroll()},_c.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=_p.superGet(_H,this,"cacheAs")),_p.superSet(_H,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},_c.onScrollEnd=function(){_p.superSet(_H,this,"cacheAs",this._$P.cacheAs)},_c._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},_g(0,_c,"numChildren",function(){return this._content.numChildren}),_g(0,_c,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(_a){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new _W),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=_a}),_g(0,_c,"contentWidth",function(){for(var _a=0,_b=this._content.numChildren-1;-1<_b;_b--){var _c=this._content.getChildAt(_b);_a=Math.max(_c.x+_c.width*_c.scaleX,_a)}return _a}),_g(0,_c,"contentHeight",function(){for(var _a=0,_b=this._content.numChildren-1;-1<_b;_b--){var _c=this._content.getChildAt(_b);_a=Math.max(_c.y+_c.height*_c.scaleY,_a)}return _a}),_g(0,_c,"width",_a.prototype._$get_width,function(_a){_p.superSet(_H,this,"width",_a),this._setScrollChanged()}),_g(0,_c,"hScrollBar",function(){return this._hScrollBar}),_g(0,_c,"content",function(){return this._content}),_g(0,_c,"height",_a.prototype._$get_height,function(_a){_p.superSet(_H,this,"height",_a),this._setScrollChanged()}),_g(0,_c,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(_a){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new _ba),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=_a}),_g(0,_c,"vScrollBar",function(){return this._vScrollBar}),_g(0,_c,"cacheAs",_a.prototype._$get_cacheAs,function(_a){_p.superSet(_H,this,"cacheAs",_a),this._$P.cacheAs=null,"none"!==_a?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),_b}(_H),_Y=function(_a){function _b(_a){_b.__super.call(this,_a),this.isVertical=!1}return _f(_b,"laya.ui.HSlider",_N),_b}(),_Z=function(_a){function _c(_a,_b){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,_c.__super.call(this),this.skin=_b,this.labels=_a}_f(_c,"laya.ui.UIGroup",_a);var _b=_c.prototype;return _p.imps(_b,{"laya.ui.IItem":!0}),_b.preinitialize=function(){this.mouseEnabled=!0},_b.destroy=function(_a){void 0===_a&&(_a=!0),laya.ui.Component.prototype.destroy.call(this,_a),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},_b.addItem=function(_a,_b){void 0===_b&&(_b=!0);var _c=_a,_d=this._items.length;if(_c.name="item"+_d,this.addChild(_c),this.initItems(),_b&&0<_d){var _e=this._items[_d-1];"horizontal"==this._direction?_c.x=_e.x+_e.width+this._space:_c.y=_e.y+_e.height+this._space}else _b&&(_c.x=0,_c.y=0);return _d},_b.delItem=function(_a,_b){void 0===_b&&(_b=!0);var _c=this._items.indexOf(_a);if(-1!=_c){var _d=_a;this.removeChild(_d);for(var _e=_c+1,_f=this._items.length;_e<_f;_e++){var _g=this._items[_e];_g.name="item"+(_e-1),_b&&("horizontal"==this._direction?_g.x-=_d.width+this._space:_g.y-=_d.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var _h;_h=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=_h}}},_b.initItems=function(){this._items||(this._items=[]);for(var _a=this._items.length=0;_a<1e4;_a++){var _b=this.getChildByName("item"+_a);if(null==_b)break;this._items.push(_b),_b.selected=_a===this._selectedIndex,_b.clickHandler=_m.create(this,this.itemClick,[_a],!1)}},_b.itemClick=function(_a){this.selectedIndex=_a},_b.setSelect=function(_a,_b){this._items&&-1<_a&&_a<this._items.length&&(this._items[_a].selected=_b)},_b.createItem=function(_a,_b){return null},_b.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var _a=0,_b=0,_c=this._items.length;_b<_c;_b++){var _d=this._items[_b];this._skin&&(_d.skin=this._skin),this._labelColors&&(_d.labelColors=this._labelColors),this._labelSize&&(_d.labelSize=this._labelSize),this._labelStroke&&(_d.labelStroke=this._labelStroke),this._labelStrokeColor&&(_d.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(_d.strokeColors=this._strokeColors),this._labelBold&&(_d.labelBold=this._labelBold),this._labelPadding&&(_d.labelPadding=this._labelPadding),this._labelAlign&&(_d.labelAlign=this._labelAlign),this._stateNum&&(_d.stateNum=this._stateNum),this._labelFont&&(_d.labelFont=this._labelFont),"horizontal"===this._direction?(_d.y=0,_d.x=_a,_a+=_d.width+this._space):(_d.x=0,_d.y=_a,_a+=_d.height+this._space)}this.changeSize()},_b.commitMeasure=function(){this.runCallLater(this.changeLabels)},_b._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},_g(0,_b,"labelStrokeColor",function(){return this._labelStrokeColor},function(_a){this._labelStrokeColor!=_a&&(this._labelStrokeColor=_a,this._setLabelChanged())}),_g(0,_b,"skin",function(){return this._skin},function(_a){this._skin!=_a&&(this._skin=_a,this._setLabelChanged())}),_g(0,_b,"selectedIndex",function(){return this._selectedIndex},function(_a){this._selectedIndex!=_a&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=_a,this.setSelect(_a,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),_g(0,_b,"labels",function(){return this._labels},function(_a){if(this._labels!=_a){if(this._labels=_a,this.removeChildren(),this._setLabelChanged(),this._labels)for(var _b=this._labels.split(","),_c=0,_d=_b.length;_c<_d;_c++){var _e=this.createItem(this._skin,_b[_c]);_e.name="item"+_c,this.addChild(_e)}this.initItems()}}),_g(0,_b,"strokeColors",function(){return this._strokeColors},function(_a){this._strokeColors!=_a&&(this._strokeColors=_a,this._setLabelChanged())}),_g(0,_b,"labelColors",function(){return this._labelColors},function(_a){this._labelColors!=_a&&(this._labelColors=_a,this._setLabelChanged())}),_g(0,_b,"labelStroke",function(){return this._labelStroke},function(_a){this._labelStroke!=_a&&(this._labelStroke=_a,this._setLabelChanged())}),_g(0,_b,"labelSize",function(){return this._labelSize},function(_a){this._labelSize!=_a&&(this._labelSize=_a,this._setLabelChanged())}),_g(0,_b,"stateNum",function(){return this._stateNum},function(_a){this._stateNum!=_a&&(this._stateNum=_a,this._setLabelChanged())}),_g(0,_b,"labelBold",function(){return this._labelBold},function(_a){this._labelBold!=_a&&(this._labelBold=_a,this._setLabelChanged())}),_g(0,_b,"labelFont",function(){return this._labelFont},function(_a){this._labelFont!=_a&&(this._labelFont=_a,this._setLabelChanged())}),_g(0,_b,"labelPadding",function(){return this._labelPadding},function(_a){this._labelPadding!=_a&&(this._labelPadding=_a,this._setLabelChanged())}),_g(0,_b,"direction",function(){return this._direction},function(_a){this._direction=_a,this._setLabelChanged()}),_g(0,_b,"space",function(){return this._space},function(_a){this._space=_a,this._setLabelChanged()}),_g(0,_b,"items",function(){return this._items}),_g(0,_b,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(_a){this.selectedIndex=this._items.indexOf(_a)}),_g(0,_b,"dataSource",_a.prototype._$get_dataSource,function(_a){"number"==typeof(this._dataSource=_a)&&Math.floor(_a)==_a||"string"==typeof _a?this.selectedIndex=parseInt(_a):_a instanceof Array?this.labels=_a.join(","):_p.superSet(_H,this,"dataSource",_a)}),_c}(_H),_$=function(_b){function _c(_a,_b){this._value=null,void 0===_b&&(_b=""),_c.__super.call(this,_a,_b)}_f(_c,"laya.ui.Radio",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._value=null},_a.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},_a.initialize=function(){_b.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},_a.onClick=function(_a){this.selected=!0},_g(0,_a,"value",function(){return null!=this._value?this._value:this.label},function(_a){this._value=_a}),_c}(_I),__=function(_a){function _b(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,_b.__super.call(this),this.width=this.height=200}_f(_b,"laya.ui.Tree",_a);var _c=_b.prototype;return _p.imps(_c,{"laya.ui.IRender":!0}),_c.destroy=function(_a){void 0===_a&&(_a=!0),laya.ui.Component.prototype.destroy.call(this,_a),this._list&&this._list.destroy(_a),this._list=null,this._source=null,this._renderHandler=null},_c.createChildren=function(){this.addChild(this._list=new _V),this._list.renderHandler=_m.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},_c.onListChange=function(_a){this.event("change")},_c.getArray=function(){var _a,_b=[];for(var _c in this._source)_a=this._source[_c],this.getParentOpenStatus(_a)&&(_a.x=this._spaceLeft*this.getDepth(_a),_b.push(_a));return _b},_c.getDepth=function(_a,_b){return void 0===_b&&(_b=0),null==_a.nodeParent?_b:this.getDepth(_a.nodeParent,_b+1)},_c.getParentOpenStatus=function(_a){var _b=_a.nodeParent;return null==_b||!!_b.isOpen&&(null==_b.nodeParent||this.getParentOpenStatus(_b))},_c.renderItem=function(_a,_b){var _c=_a.dataSource;if(_c){_a.left=_c.x;var _d=_a.getChildByName("arrow");_d&&(_c.hasChild?(_d.visible=!0,_d.index=_c.isOpen?1:0,_d.tag=_b,_d.off("click",this,this.onArrowClick),_d.on("click",this,this.onArrowClick)):_d.visible=!1);var _e=_a.getChildByName("folder");_e&&(2==_e.clipY?_e.index=_c.isDirectory?0:1:_e.index=_c.isDirectory?_c.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([_a,_b])}},_c.onArrowClick=function(_a){var _b=_a.currentTarget.tag;this._list.array[_b].isOpen=!this._list.array[_b].isOpen,this.event("open"),this._list.array=this.getArray()},_c.setItemState=function(_a,_b){this._list.array[_a]&&(this._list.array[_a].isOpen=_b,this._list.array=this.getArray())},_c.fresh=function(){this._list.array=this.getArray(),this.repaint()},_c.parseXml=function(_a,_b,_c,_d){var _e,_f=_a.childNodes,_g=_f.length;if(!_d){_e={};var _h,_i=_a.attributes;for(var _j in _i){var _k=(_h=_i[_j]).nodeName,_l=_h.nodeValue;_e[_k]="true"==_l||"false"!=_l&&_l}_e.nodeParent=_c,0<_g&&(_e.isDirectory=!0),_e.hasChild=0<_g,_b.push(_e)}for(var _m=0;_m<_g;_m++){var _n=_f[_m];this.parseXml(_n,_b,_e,!1)}},_c.parseOpenStatus=function(_a,_b){for(var _c=0,_d=_b.length;_c<_d;_c++){var _e=_b[_c];if(_e.isDirectory)for(var _f=0,_g=_a.length;_f<_g;_f++){var _h=_a[_f];if(_h.isDirectory&&this.isSameParent(_h,_e)&&_e.label==_h.label){_e.isOpen=_h.isOpen;break}}}},_c.isSameParent=function(_a,_b){return null==_a.nodeParent&&null==_b.nodeParent||null!=_a.nodeParent&&null!=_b.nodeParent&&(_a.nodeParent.label==_b.nodeParent.label&&this.isSameParent(_a.nodeParent,_b.nodeParent))},_c.filter=function(_a){if(Boolean(_a)){var _b=[];this.getFilterSource(this._source,_b,_a),this._list.array=_b}else this._list.array=this.getArray()},_c.getFilterSource=function(_a,_b,_c){var _d;for(var _e in _c=_c.toLocaleLowerCase(),_a)!(_d=_a[_e]).isDirectory&&-1<String(_d.label).toLowerCase().indexOf(_c)&&(_d.x=0,_b.push(_d)),_d.child&&0<_d.child.length&&this.getFilterSource(_d.child,_b,_c)},_g(0,_c,"spaceBottom",function(){return this._list.spaceY},function(_a){this._list.spaceY=_a}),_g(0,_c,"keepStatus",function(){return this._keepStatus},function(_a){this._keepStatus=_a}),_g(0,_c,"itemRender",function(){return this._list.itemRender},function(_a){this._list.itemRender=_a}),_g(0,_c,"array",function(){return this._list.array},function(_a){this._keepStatus&&this._list.array&&_a&&this.parseOpenStatus(this._list.array,_a),this._source=_a,this._list.array=this.getArray()}),_g(0,_c,"mouseHandler",function(){return this._list.mouseHandler},function(_a){this._list.mouseHandler=_a}),_g(0,_c,"dataSource",_a.prototype._$get_dataSource,function(_a){this._dataSource=_a,_p.superSet(_H,this,"dataSource",_a)}),_g(0,_c,"source",function(){return this._source}),_g(0,_c,"scrollBar",function(){return this._list.scrollBar}),_g(0,_c,"list",function(){return this._list}),_g(0,_c,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(_a){this._list.vScrollBarSkin=_a}),_g(0,_c,"renderHandler",function(){return this._renderHandler},function(_a){this._renderHandler=_a}),_g(0,_c,"selectedIndex",function(){return this._list.selectedIndex},function(_a){this._list.selectedIndex=_a}),_g(0,_c,"spaceLeft",function(){return this._spaceLeft},function(_a){this._spaceLeft=_a}),_g(0,_c,"selectedItem",function(){return this._list.selectedItem},function(_a){this._list.selectedItem=_a}),_g(0,_c,"width",_a.prototype._$get_width,function(_a){_p.superSet(_H,this,"width",_a),this._list.width=_a}),_g(0,_c,"height",_a.prototype._$get_height,function(_a){_p.superSet(_H,this,"height",_a),this._list.height=_a}),_g(0,_c,"xml",null,function(_a){var _b=[];this.parseXml(_a.childNodes[0],_b,null,!0),this.array=_b}),_g(0,_c,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),_b}(_H),_aa=function(_a){function _b(){this._items=null,this._selectedIndex=0,_b.__super.call(this),this._setIndexHandler=_m.create(this,this.setIndex,null,!1)}_f(_b,"laya.ui.ViewStack",_a);var _c=_b.prototype;return _p.imps(_c,{"laya.ui.IItem":!0}),_c.setItems=function(_a){this.removeChildren();for(var _b=0,_c=0,_d=_a.length;_c<_d;_c++){var _e=_a[_c];_e&&(_e.name="item"+_b,this.addChild(_e),_b++)}this.initItems()},_c.addItem=function(_a){_a.name="item"+this._items.length,this.addChild(_a),this.initItems()},_c.initItems=function(){this._items=[];for(var _a=0;_a<1e4;_a++){var _b=this.getChildByName("item"+_a);if(null==_b)break;this._items.push(_b),_b.visible=_a==this._selectedIndex}},_c.setSelect=function(_a,_b){this._items&&-1<_a&&_a<this._items.length&&(this._items[_a].visible=_b)},_c.setIndex=function(_a){this.selectedIndex=_a},_g(0,_c,"dataSource",_a.prototype._$get_dataSource,function(_a){if("number"==typeof(this._dataSource=_a)&&Math.floor(_a)==_a||"string"==typeof _a)this.selectedIndex=parseInt(_a);else for(var _b in this._dataSource)this.hasOwnProperty(_b)&&(this[_b]=this._dataSource[_b])}),_g(0,_c,"selectedIndex",function(){return this._selectedIndex},function(_a){this._selectedIndex!=_a&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=_a,this.setSelect(this._selectedIndex,!0))}),_g(0,_c,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(_a){this.selectedIndex=this._items.indexOf(_a)}),_g(0,_c,"items",function(){return this._items}),_g(0,_c,"setIndexHandler",function(){return this._setIndexHandler},function(_a){this._setIndexHandler=_a}),_b}(_H),_ba=function(_a){function _b(){_b.__super.call(this)}return _f(_b,"laya.ui.VScrollBar",_M),_b}(),_ca=function(_b){function _c(_a){this._bg=null,this._skin=null,_c.__super.call(this),void 0===_a&&(_a=""),this.text=_a,this.skin=this.skin}_f(_c,"laya.ui.TextInput",_b);var _a=_c.prototype;return _a.preinitialize=function(){this.mouseEnabled=!0},_a.destroy=function(_a){_s.clearCache(this,this._skin),void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._bg&&this._bg.destroy(),this._bg=null},_a.createChildren=function(){this.addChild(this._tf=new _n),this._tf.padding=_B.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},_a._onFocus=function(){this.event("focus",this)},_a._onBlur=function(){this.event("blur",this)},_a._onInput=function(){this.event("input",this)},_a._onEnter=function(){this.event("enter",this)},_a.initialize=function(){this.width=128,this.height=22},_a.select=function(){this._tf.select()},_a.setSelection=function(_a,_b){this._tf.setSelection(_a,_b)},_g(0,_a,"text",_b.prototype._$get_text,function(_a){this._tf.text!=_a&&(_a+="",this._tf.text=_a,this.event("change"))}),_g(0,_a,"bg",function(){return this._bg},function(_a){this.graphics=this._bg=_a}),_g(0,_a,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(_a){this._tf.inputElementYAdjuster=_a}),_g(0,_a,"multiline",function(){return this._tf.multiline},function(_a){this._tf.multiline=_a}),_g(0,_a,"skin",function(){return this._skin},function(_a){this._skin!=_a&&(_s.clearCache(this,this._skin),this._skin=_a,this._bg||(this.graphics=this._bg=new _E),_s.keepCache(this,this._skin),this._bg.source=_s.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),_g(0,_a,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(_a){this._bg||(this.graphics=this._bg=new _E),this._bg.sizeGrid=_C.fillArray(_B.defaultSizeGrid,_a,Number)}),_g(0,_a,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(_a){this._tf.inputElementXAdjuster=_a}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_P,this,"width",_a),this._bg&&(this._bg.width=_a)}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_P,this,"height",_a),this._bg&&(this._bg.height=_a)}),_g(0,_a,"editable",function(){return this._tf.editable},function(_a){this._tf.editable=_a}),_g(0,_a,"restrict",function(){return this._tf.restrict},function(_a){this._tf.restrict=_a}),_g(0,_a,"prompt",function(){return this._tf.prompt},function(_a){this._tf.prompt=_a}),_g(0,_a,"promptColor",function(){return this._tf.promptColor},function(_a){this._tf.promptColor=_a}),_g(0,_a,"maxChars",function(){return this._tf.maxChars},function(_a){this._tf.maxChars=_a}),_g(0,_a,"focus",function(){return this._tf.focus},function(_a){this._tf.focus=_a}),_g(0,_a,"type",function(){return this._tf.type},function(_a){this._tf.type=_a}),_g(0,_a,"asPassword",function(){return this._tf.asPassword},function(_a){this._tf.asPassword=_a}),_c}(_P),_da=function(_a){function _b(){_b.__super.call(this)}return _f(_b,"laya.ui.VSlider",_N),_b}(),_ea=function(_a){function _d(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,_d.__super.call(this)}_f(_d,"laya.ui.Dialog",_a);var _b=_d.prototype;return _b.initialize=function(){this.popupEffect=_d.manager.popupEffectHandler,this.closeEffect=_d.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},_b._dealDragArea=function(){var _a=this.getChildByName("drag");_a&&(this.dragArea=_a.x+","+_a.y+","+_a.width+","+_a.height,_a.removeSelf())},_b._onClick=function(_a){var _b=_a.target;if(_b)switch(_b.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(_b.name)}},_b.show=function(_a,_b){void 0===_a&&(_a=!1),void 0===_b&&(_b=!0),this._open(!1,_a,_b)},_b.popup=function(_a,_b){void 0===_a&&(_a=!1),void 0===_b&&(_b=!0),this._open(!0,_a,_b)},_b._open=function(_a,_b,_c){_d.manager.lock(!1),this.isModal=_a,_d.manager.open(this,_b,_c)},_b.onOpened=function(){},_b.close=function(_a,_b){void 0===_b&&(_b=!0),_d.manager.close(this,_a,_b)},_b.onClosed=function(_a){},_b._onMouseDown=function(_a){var _b=this.getMousePoint();this._dragArea.contains(_b.x,_b.y)?this.startDrag():this.stopDrag()},_g(0,_b,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(_a){if(_a){var _b=_C.fillArray([0,0,0,0],_a,Number);this._dragArea=new _r(_b[0],_b[1],_b[2],_b[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),_g(0,_b,"isPopup",function(){return null!=this.parent}),_g(0,_b,"zOrder",_a.prototype._$get_zOrder,function(_a){_p.superSet(_R,this,"zOrder",_a),_d.manager._checkMask()}),_g(1,_d,"manager",function(){return _d._manager=_d._manager||new _G},function(_a){_d._manager=_a}),_d.setLockView=function(_a){_d.manager.setLockView(_a)},_d.lock=function(_a){_d.manager.lock(_a)},_d.closeAll=function(){_d.manager.closeAll()},_d.getDialogsByGroup=function(_a){return _d.manager.getDialogsByGroup(_a)},_d.closeByGroup=function(_a){return _d.manager.closeByGroup(_a)},_d.CLOSE="close",_d.CANCEL="cancel",_d.SURE="sure",_d.NO="no",_d.OK="ok",_d.YES="yes",_d._manager=null,_d}(_R),_fa=function(_a){function _b(){_b.__super.call(this)}_f(_b,"laya.ui.HBox",_a);var _c=_b.prototype;return _c.sortItem=function(_a){_a&&_a.sort(function(_a,_b){return _a.x-_b.x})},_c.changeItems=function(){this._itemChanged=!1;for(var _a=[],_b=0,_c=0,_d=this.numChildren;_c<_d;_c++){var _e=this.getChildAt(_c);_e&&_e.layoutEnabled&&(_a.push(_e),_b=this._height?this._height:Math.max(_b,_e.height*_e.scaleY))}this.sortItem(_a);var _f=0;for(_c=0,_d=_a.length;_c<_d;_c++)(_e=_a[_c]).x=_f,_f+=_e.width*_e.scaleX+this._space,"top"==this._align?_e.y=0:"middle"==this._align?_e.y=.5*(_b-_e.height*_e.scaleY):"bottom"==this._align&&(_e.y=_b-_e.height*_e.scaleY);this.changeSize()},_g(0,_c,"height",_a.prototype._$get_height,function(_a){this._height!=_a&&(_p.superSet(_T,this,"height",_a),this.callLater(this.changeItems))}),_b.NONE="none",_b.TOP="top",_b.MIDDLE="middle",_b.BOTTOM="bottom",_b}(_T),_ga=function(_a){function _b(){_b.__super.call(this)}_f(_b,"laya.ui.VBox",_a);var _c=_b.prototype;return _c.changeItems=function(){this._itemChanged=!1;for(var _a=[],_b=0,_c=0,_d=this.numChildren;_c<_d;_c++){var _e=this.getChildAt(_c);_e&&_e.layoutEnabled&&(_a.push(_e),_b=this._width?this._width:Math.max(_b,_e.width*_e.scaleX))}this.sortItem(_a);var _f=0;for(_c=0,_d=_a.length;_c<_d;_c++)(_e=_a[_c]).y=_f,_f+=_e.height*_e.scaleY+this._space,"left"==this._align?_e.x=0:"center"==this._align?_e.x=.5*(_b-_e.width*_e.scaleX):"right"==this._align&&(_e.x=_b-_e.width*_e.scaleX);this.changeSize()},_g(0,_c,"width",_a.prototype._$get_width,function(_a){this._width!=_a&&(_p.superSet(_T,this,"width",_a),this.callLater(this.changeItems))}),_b.NONE="none",_b.LEFT="left",_b.CENTER="center",_b.RIGHT="right",_b}(_T),_ha=function(_a){function _b(){_b.__super.call(this)}return _f(_b,"laya.ui.RadioGroup",_Z),_b.prototype.createItem=function(_a,_b){return new _$(_a,_b)},_b}(),_ia=function(_a){function _b(){_b.__super.call(this)}return _f(_b,"laya.ui.Tab",_Z),_b.prototype.createItem=function(_a,_b){return new _I(_a,_b)},_b}(),_ja=function(_b){function _c(_a){this._vScrollBar=null,this._hScrollBar=null,void 0===_a&&(_a=""),_c.__super.call(this,_a)}_f(_c,"laya.ui.TextArea",_b);var _a=_c.prototype;return _a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},_a.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},_a.onVBarChanged=function(_a){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},_a.onHBarChanged=function(_a){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},_a.changeScroll=function(){var _a=this._vScrollBar&&0<this._tf.maxScrollY,_b=this._hScrollBar&&0<this._tf.maxScrollX,_c=_a?this._width-this._vScrollBar.width:this._width,_d=_b?this._height-this._hScrollBar.height:this._height,_e=this._tf.padding||_B.labelPadding;this._tf.width=_c,this._tf.height=_d,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-_e[2],this._vScrollBar.y=_e[1],this._vScrollBar.height=this._height-(_b?this._hScrollBar.height:0)-_e[1]-_e[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=_d/Math.max(this._tf.textHeight,_d),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=_a),this._hScrollBar&&(this._hScrollBar.x=_e[0],this._hScrollBar.y=this._height-this._hScrollBar.height-_e[3],this._hScrollBar.width=this._width-(_a?this._vScrollBar.width:0)-_e[0]-_e[2],this._hScrollBar.scrollSize=Math.max(.033*_c,1),this._hScrollBar.thumbPercent=_c/Math.max(this._tf.textWidth,_c),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=_b)},_a.scrollTo=function(_a){this.commitMeasure(),this._tf.scrollY=_a},_g(0,_a,"scrollY",function(){return this._tf.scrollY}),_g(0,_a,"width",_b.prototype._$get_width,function(_a){_p.superSet(_ca,this,"width",_a),this.callLater(this.changeScroll)}),_g(0,_a,"hScrollBar",function(){return this._hScrollBar}),_g(0,_a,"height",_b.prototype._$get_height,function(_a){_p.superSet(_ca,this,"height",_a),this.callLater(this.changeScroll)}),_g(0,_a,"maxScrollX",function(){return this._tf.maxScrollX}),_g(0,_a,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(_a){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new _ba),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=_a}),_g(0,_a,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(_a){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new _W),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=_a}),_g(0,_a,"vScrollBar",function(){return this._vScrollBar}),_g(0,_a,"maxScrollY",function(){return this._tf.maxScrollY}),_g(0,_a,"scrollX",function(){return this._tf.scrollX}),_c}(_ca);!function(_a){function _b(){this._uiView=null,this.isCloseOther=!1,_b.__super.call(this)}_f(_b,"laya.ui.AsynDialog",_ea);var _c=_b.prototype;_c.createView=function(_a){this._uiView=_a},_c._open=function(_a,_b,_c){this.isModal=_a,this.isCloseOther=_b,_ea.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},_c.onCreated=function(){this.createUI(),this.onOpen()},_c.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},_c.onOpen=function(){_ea.manager.open(this,this.isCloseOther),_ea.manager.lock(!1)},_c.close=function(_a,_b){void 0===_b&&(_b=!0),_ea.manager.close(this),this.onClose()},_c.onClose=function(){},_c.destroy=function(_a){void 0===_a&&(_a=!0),laya.ui.View.prototype.destroy.call(this,_a),this._uiView=null,this.onDestroy()},_c.onDestroy=function(){}}();_p.__init([_R])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(_m,_a,_v){_v.un,_v.uns;var _l=_v.static,_n=_v.class,_o=_v.getset,_d=_v.__newvec,_u=laya.maths.Arith,_g=laya.webgl.atlas.AtlasResourceManager,_c=laya.webgl.shader.BaseShader,_F=laya.utils.Browser,_h=laya.webgl.utils.Buffer,_w=laya.utils.Byte,_e=laya.utils.ClassUtils,_i=_v.Config,_f=(laya.events.Event,laya.events.EventDispatcher),_B=laya.utils.Handler,_r=laya.net.Loader,_b=laya.net.LoaderManager,_j=(laya.maths.MathUtil,laya.display.Node),_p=laya.renders.Render,_k=(laya.renders.RenderContext,laya.renders.RenderSprite,laya.webgl.utils.RenderState2D),_q=laya.resource.Resource,_s=laya.utils.RunDriver,_t=(laya.webgl.shader.Shader,laya.webgl.utils.ShaderCompile),_x=laya.display.Sprite,_y=laya.utils.Stat,_z=laya.utils.StringKey,_C=(laya.display.css.Style,laya.resource.Texture,laya.net.URL),_A=laya.utils.Utils,_D=laya.webgl.WebGL,_E=laya.webgl.WebGLContext;laya.webgl.canvas.WebGLContext2D;_v.interface("laya.d3.core.IClone"),_v.interface("laya.d3.graphics.IVertex"),_v.interface("laya.d3.core.render.IUpdate"),_v.interface("laya.d3.core.scene.ITreeNode"),_v.interface("laya.d3.core.render.IRenderable");(function(){function _I(){}_n(_I,"laya.d3.animation.AnimationClipParser01"),_I.READ_DATA=function(){_I._DATA.offset=_I._reader.getUint32(),_I._DATA.size=_I._reader.getUint32()},_I.READ_BLOCK=function(){for(var _a=_I._BLOCK.count=_I._reader.getUint16(),_b=_I._BLOCK.blockStarts=[],_c=_I._BLOCK.blockLengths=[],_d=0;_d<_a;_d++)_b.push(_I._reader.getUint32()),_c.push(_I._reader.getUint32())},_I.READ_STRINGS=function(){var _a=_I._reader.getUint32(),_b=_I._reader.getUint16(),_c=_I._reader.pos;_I._reader.pos=_a+_I._DATA.offset;for(var _d=0;_d<_b;_d++)_I._strings[_d]=_I._reader.readUTFString();_I._reader.pos=_c},_I.parse=function(_a,_b){_I._animationClip=_a;(_I._reader=_b).__getBuffer();_I.READ_DATA(),_I.READ_BLOCK(),_I.READ_STRINGS();for(var _c=0,_d=_I._BLOCK.count;_c<_d;_c++){var _e=_b.getUint16(),_f=_I._strings[_e],_g=_I["READ_"+_f];if(null==_g)throw new Error("model file err,no this function:"+_e+" "+_f);_g.call()}},_I.READ_ANIMATIONS=function(){var _a,_b=0,_c=0,_d=_I._reader,_e=_d.__getBuffer(),_f=[],_g=_d.getUint8();for(_f.length=_g,_b=0;_b<_g;_b++)_f[_b]=_d.getUint16();var _h=[],_i=_d.getUint16();for(_h.length=_i,_b=0;_b<_i;_b++)_h[_b]=_d.getFloat32();var _j=_I._animationClip;_j.name=_I._strings[_d.getUint16()];var _k=_j._duration=_d.getFloat32();_j.islooping=!!_d.getByte(),_j._frameRate=_d.getInt16();var _l=_d.getInt16(),_m=_j._nodes=new Array;_m.length=_l,(_j._publicClipDatas=[]).length=_l;var _n=_j._nodesMap={},_o=0,_p=0;for(_b=0;_b<_l;_b++){_a=_m[_b]=new _Q;var _q=_d.getUint16(),_r=_a.path=[];for(_r.length=_q,_c=0;_c<_q;_c++)_r[_c]=_I._strings[_d.getUint16()];var _s=_r.join("/"),_t=_n[_s];_t||(_n[_s]=_t=[]),_t.push(_a);var _u=_d.getInt16();-1!==_u&&(_a.componentType=_I._strings[_u]);var _v=_O._propertyIndexDic[_I._strings[_d.getUint16()]];if(null==_v)throw new Error("AnimationClipParser01:unknown property name.");var _w=_v<4,_x=!_w||_w&&""===_r[0];(_a._cacheProperty=_x)?_o++:_p++,_a.propertyNameID=_v;var _y=_f[_d.getUint8()];_a.keyFrameWidth=_y/4;var _z=_a.keyFrames=[],_A=_z.length=_d.getUint16(),_B=null,_C=NaN;for(_c=0;_c<_A;_c++){var _D=_z[_c]=new _P;_C=_D.startTime=_h[_d.getUint16()];var _E=_d.pos;_D.inTangent=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_E=_d.pos,_D.outTangent=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_E=_d.pos,_D.data=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_B&&(_B.next=_D,_B.duration=_C-_B.startTime),_B=_D}_D.next=null,_D.duration=_k-_C}var _F=_j._nodeToCachePropertyMap=new Int32Array(_l),_G=_j._cachePropertyMap=new Int32Array(_o),_H=_j._unCachePropertyMap=new Int32Array(_p);for(_o=_p=0,_b=0;_b<_l;_b++)(_a=_m[_b])._cacheProperty?(_F[_b]=_o,_G[_o++]=_b):_H[_p++]=_b},_I._animationClip=null,_I._reader=null,_I._strings=[],_l(_I,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])})(),function(){function _M(){}_n(_M,"laya.d3.animation.AnimationClipParser02"),_M.READ_DATA=function(){_M._DATA.offset=_M._reader.getUint32(),_M._DATA.size=_M._reader.getUint32()},_M.READ_BLOCK=function(){for(var _a=_M._BLOCK.count=_M._reader.getUint16(),_b=_M._BLOCK.blockStarts=[],_c=_M._BLOCK.blockLengths=[],_d=0;_d<_a;_d++)_b.push(_M._reader.getUint32()),_c.push(_M._reader.getUint32())},_M.READ_STRINGS=function(){var _a=_M._reader.getUint32(),_b=_M._reader.getUint16(),_c=_M._reader.pos;_M._reader.pos=_a+_M._DATA.offset;for(var _d=0;_d<_b;_d++)_M._strings[_d]=_M._reader.readUTFString();_M._reader.pos=_c},_M.parse=function(_a,_b){_M._animationClip=_a;(_M._reader=_b).__getBuffer();_M.READ_DATA(),_M.READ_BLOCK(),_M.READ_STRINGS();for(var _c=0,_d=_M._BLOCK.count;_c<_d;_c++){var _e=_b.getUint16(),_f=_M._strings[_e],_g=_M["READ_"+_f];if(null==_g)throw new Error("model file err,no this function:"+_e+" "+_f);_g.call()}},_M.READ_ANIMATIONS=function(){var _a,_b=0,_c=0,_d=_M._reader,_e=_d.__getBuffer(),_f=[],_g=_d.getUint8();for(_f.length=_g,_b=0;_b<_g;_b++)_f[_b]=_d.getUint16();var _h=[],_i=_d.getUint16();for(_h.length=_i,_b=0;_b<_i;_b++)_h[_b]=_d.getFloat32();var _j=_M._animationClip;_j.name=_M._strings[_d.getUint16()];var _k=_j._duration=_d.getFloat32();_j.islooping=!!_d.getByte(),_j._frameRate=_d.getInt16();var _l=_d.getInt16(),_m=_j._nodes=new Array;_m.length=_l,(_j._publicClipDatas=[]).length=_l;var _n=_j._nodesMap={},_o=0,_p=0;for(_b=0;_b<_l;_b++){_a=_m[_b]=new _Q;var _q=_d.getUint16(),_r=_a.path=[];for(_r.length=_q,_c=0;_c<_q;_c++)_r[_c]=_M._strings[_d.getUint16()];var _s=_r.join("/"),_t=_n[_s];_t||(_n[_s]=_t=[]),_t.push(_a);var _u=_d.getInt16();-1!==_u&&(_a.componentType=_M._strings[_u]);var _v=_O._propertyIndexDic[_M._strings[_d.getUint16()]];if(null==_v)throw new Error("AnimationClipParser02:unknown property name.");var _w=_v<4,_x=!_w||_w&&""===_r[0];(_a._cacheProperty=_x)?_o++:_p++,_a.propertyNameID=_v;var _y=_f[_d.getUint8()];_a.keyFrameWidth=_y/4;var _z=_a.keyFrames=[],_A=_z.length=_d.getUint16(),_B=null,_C=NaN;for(_c=0;_c<_A;_c++){var _D=_z[_c]=new _P;_C=_D.startTime=_h[_d.getUint16()];var _E=_d.pos;_D.inTangent=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_E=_d.pos,_D.outTangent=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_E=_d.pos,_D.data=new Float32Array(_e.slice(_E,_E+_y)),_d.pos+=_y,_B&&(_B.next=_D,_B.duration=_C-_B.startTime),_B=_D}_D.next=null,_D.duration=_k-_C}var _F=_d.getUint16();for(_b=0;_b<_F;_b++){var _G,_H=new _N;_H.time=_d.getFloat32(),_H.eventName=_M._strings[_d.getUint16()];var _I=_d.getUint16();for(0<_I&&(_H.params=_G=[]),_c=0;_c<_I;_c++){switch(_d.getByte()){case 0:_G.push(!!_d.getByte());break;case 1:_G.push(_d.getInt32());break;case 2:_G.push(_d.getFloat32());break;case 3:_G.push(_M._strings[_d.getUint16()]);break;default:throw new Error("unknown type.")}}_j.addEvent(_H)}var _J=_j._nodeToCachePropertyMap=new Int32Array(_l),_K=_j._cachePropertyMap=new Int32Array(_o),_L=_j._unCachePropertyMap=new Int32Array(_p);for(_o=_p=0,_b=0;_b<_l;_b++)(_a=_m[_b])._cacheProperty?(_J[_b]=_o,_K[_o++]=_b):_L[_p++]=_b},_M._animationClip=null,_M._reader=null,_M._strings=[],_l(_M,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}])}();var _N=function(){function _a(){this.time=NaN,this.eventName=null,this.params=null}return _n(_a,"laya.d3.animation.AnimationEvent"),_a}(),_O=function(){function _d(){this._childs=[],this.transform=new _sb(this)}_n(_d,"laya.d3.animation.AnimationNode");var _a=_d.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.addChild=function(_a){_a._parent=this,_a.transform.setParent(this.transform),this._childs.push(_a)},_a.removeChild=function(_a){var _b=this._childs.indexOf(_a);-1!==_b&&this._childs.splice(_b,1)},_a.getChildByName=function(_a){for(var _b=0,_c=this._childs.length;_b<_c;_b++){var _d=this._childs[_b];if(_d.name===_a)return _d}return null},_a.getChildByIndex=function(_a){return this._childs[_a]},_a.getChildCount=function(){return this._childs.length},_a.cloneTo=function(_a){var _b=_a;_b.name=this.name;for(var _c=0,_d=this._childs.length;_c<_d;_c++){var _e=this._childs[_c],_f=_e.clone();_b.addChild(_f);var _g=_e.transform,_h=_f.transform;_h.setLocalPosition(_g.getLocalPosition()),_h.setLocalRotation(_g.getLocalRotation()),_h.setLocalScale(_g.getLocalScale()),_h._localRotationEuler=_g._localRotationEuler,_h._setWorldMatrixIgnoreUpdate(_g.getWorldMatrix())}},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_d.__init__=function(){_d.registerAnimationNodeProperty("localPosition",_d._getLocalPosition,_d._setLocalPosition),_d.registerAnimationNodeProperty("localRotation",_d._getLocalRotation,_d._setLocalRotation),_d.registerAnimationNodeProperty("localScale",_d._getLocalScale,_d._setLocalScale),_d.registerAnimationNodeProperty("localRotationEuler",_d._getLocalRotationEuler,_d._setLocalRotationEuler),_d.registerAnimationNodeProperty("particleRender.sharedMaterial.tintColor",_d._getParticleRenderSharedMaterialTintColor,_d._setParticleRenderSharedMaterialTintColor),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.tilingOffset",_d._getMeshRenderSharedMaterialTilingOffset,_d._setMeshRenderSharedMaterialTilingOffset),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedoColor",_d._getMeshRenderSharedMaterialAlbedo,_d._setMeshRenderSharedMaterialAlbedo),_d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.tilingOffset",_d._getSkinnedMeshRenderSharedMaterialTilingOffset,_d._setSkinnedMeshRenderSharedMaterialTilingOffset),_d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedoColor",_d._getSkinnedMeshRenderSharedMaterialAlbedo,_d._setSkinnedMeshRenderSharedMaterialAlbedo),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.albedo",_d._getMeshRenderSharedMaterialAlbedo,_d._setMeshRenderSharedMaterialAlbedo),_d.registerAnimationNodeProperty("skinnedMeshRender.sharedMaterial.albedo",_d._getSkinnedMeshRenderSharedMaterialAlbedo,_d._setSkinnedMeshRenderSharedMaterialAlbedo),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.intensity",_d._getMeshRenderSharedMaterialIntensity,_d._setMeshRenderSharedMaterialIntensity),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.alpha",_d._getMeshRenderSharedMaterialAlpha,_d._setMeshRenderSharedMaterialAlpha),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.alphaColor",_d._getMeshRenderSharedMaterialAlphaColor,_d._setMeshRenderSharedMaterialAlphaColor),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseColor",_d._getMeshRenderSharedMaterialBaseColor,_d._setMeshRenderSharedMaterialBaseColor),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolve",_d._getMeshRenderSharedMaterialDissolve,_d._setMeshRenderSharedMaterialDissolve),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveSpeed",_d._getMeshRenderSharedMaterialDissolveSpeed,_d._setMeshRenderSharedMaterialDissolveSpeed),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.mMultiplier",_d._getMeshRenderSharedMaterialMMultiplier,_d._setMeshRenderSharedMaterialMMultiplier),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedX",_d._getMeshRenderSharedMaterialBaseScrollSpeedX,_d._setMeshRenderSharedMaterialBaseScrollSpeedX),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.baseScrollSpeedY",_d._getMeshRenderSharedMaterialBaseScrollSpeedY,_d._setMeshRenderSharedMaterialBaseScrollSpeedY),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedX",_d._getMeshRenderSharedMaterialSecondScrollSpeedX,_d._setMeshRenderSharedMaterialSecondScrollSpeedX),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.secondScrollSpeedY",_d._getMeshRenderSharedMaterialSecondScrollSpeedY,_d._setMeshRenderSharedMaterialSecondScrollSpeedY),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.detailTilingOffset",_d._getMeshRenderSharedMaterialDetailTilingOffset,_d._setMeshRenderSharedMaterialDetailTilingOffset),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.dissolveTilingOffset",_d._getMeshRenderSharedMaterialDissolveTilingOffset,_d._setMeshRenderSharedMaterialDissolveTilingOffset),_d.registerAnimationNodeProperty("meshRender.sharedMaterial.maskTilingOffset",_d._getMeshRenderSharedMaterialMaskTilingOffset,_d._setMeshRenderSharedMaterialMaskTilingOffset)},_d.registerAnimationNodeProperty=function(_a,_b,_c){if(_d._propertyIndexDic[_a])throw new Error("AnimationNode: this propertyName has registered.");_d._propertyIndexDic[_a]=_d._propertyIDCounter,_d._propertyGetFuncs[_d._propertyIDCounter]=_b,_d._propertySetFuncs[_d._propertyIDCounter]=_c,_d._propertyIDCounter++},_d._getLocalPosition=function(_a,_b){return _a?_a.transform.getLocalPosition():_b._transform.localPosition.elements},_d._setLocalPosition=function(_a,_b,_c){if(_a)_a.transform.setLocalPosition(_c);else{var _d=_b._transform,_e=_d.localPosition;_e.elements=_c,_d.localPosition=_e}},_d._getLocalRotation=function(_a,_b){return _a?_a.transform.getLocalRotation():_b._transform.localRotation.elements},_d._setLocalRotation=function(_a,_b,_c){if(_a)_a.transform.setLocalRotation(_c);else{var _d=_b._transform,_e=_d.localRotation;_e.elements=_c,_d.localRotation=_e}},_d._getLocalScale=function(_a,_b){return _a?_a.transform.getLocalScale():_b._transform.localScale.elements},_d._setLocalScale=function(_a,_b,_c){if(_a)_a.transform.setLocalScale(_c);else{var _d=_b._transform,_e=_d.localScale;_e.elements=_c,_d.localScale=_e}},_d._getLocalRotationEuler=function(_a,_b){return _a?_a.transform.getLocalRotationEuler():_b._transform.localRotationEuler.elements},_d._setLocalRotationEuler=function(_a,_b,_c){if(_a)_a.transform.setLocalRotationEuler(_c);else{var _d=_b._transform,_e=_d.localRotationEuler;_e.elements=_c,_d.localRotationEuler=_e}},_d._getMeshRenderSharedMaterialTilingOffset=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.tilingOffset.elements:null}return _b.meshRender.sharedMaterial.tilingOffset.elements},_d._setMeshRenderSharedMaterialTilingOffset=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).tilingOffset).elements=_c,_d.tilingOffset=_e)}else(_e=(_d=_b.meshRender.material).tilingOffset).elements=_c,_d.tilingOffset=_e},_d._getMeshRenderSharedMaterialAlbedo=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.albedoColor.elements:null}return _b.meshRender.sharedMaterial.albedoColor.elements},_d._setMeshRenderSharedMaterialAlbedo=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).albedoColor).elements=_c,_d.albedoColor=_e)}else(_e=(_d=_b.meshRender.material).albedoColor).elements=_c,_d.albedoColor=_e},_d._getSkinnedMeshRenderSharedMaterialTilingOffset=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.skinnedMeshRender.sharedMaterial.tilingOffset.elements:null}return _b.skinnedMeshRender.sharedMaterial.tilingOffset.elements},_d._setSkinnedMeshRenderSharedMaterialTilingOffset=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.skinnedMeshRender.material).tilingOffset).elements=_c,_d.tilingOffset=_e)}else(_e=(_d=_b.skinnedMeshRender.material).tilingOffset).elements=_c,_d.tilingOffset=_e},_d._getSkinnedMeshRenderSharedMaterialAlbedo=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.skinnedMeshRender.sharedMaterial.albedoColor.elements:null}return _b.skinnedMeshRender.sharedMaterial.albedoColor.elements},_d._setSkinnedMeshRenderSharedMaterialAlbedo=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.skinnedMeshRender.material).albedoColor).elements=_c,_d.albedoColor=_e)}else(_e=(_d=_b.skinnedMeshRender.material).albedoColor).elements=_c,_d.albedoColor=_e},_d._getParticleRenderSharedMaterialTintColor=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.particleRender.sharedMaterial.tintColor.elements:null}return _b.particleRender.sharedMaterial.tintColor.elements},_d._setParticleRenderSharedMaterialTintColor=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.particleRender.material).tintColor).elements=_c,_d.tintColor=_e)}else(_e=(_d=_b.particleRender.material).tintColor).elements=_c,_d.tintColor=_e},_d._getMeshRenderSharedMaterialAlphaColor=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.alphaColor.elements:null}return _b.meshRender.sharedMaterial.alphaColor.elements},_d._setMeshRenderSharedMaterialAlphaColor=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).alphaColor).elements=_c,_d.alphaColor=_e)}else(_e=(_d=_b.meshRender.material).alphaColor).elements=_c,_d.alphaColor=_e},_d._getMeshRenderSharedMaterialBaseColor=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.baseColor.elements:null}return _b.meshRender.sharedMaterial.baseColor.elements},_d._setMeshRenderSharedMaterialBaseColor=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).baseColor).elements=_c,_d.baseColor=_e)}else(_e=(_d=_b.meshRender.material).baseColor).elements=_c,_d.baseColor=_e},_d._getMeshRenderSharedMaterialDissolve=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.dissolve:0}return _b.meshRender.sharedMaterial.dissolve},_d._setMeshRenderSharedMaterialDissolve=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.dissolve=_c[0])}else _b.meshRender.material.dissolve=_c[0]},_d._getMeshRenderSharedMaterialDissolveSpeed=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.dissolveSpeed:0}return _b.meshRender.sharedMaterial.dissolveSpeed},_d._setMeshRenderSharedMaterialDissolveSpeed=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.dissolveSpeed=_c[0])}else _b.meshRender.material.dissolveSpeed=_c[0]},_d._getMeshRenderSharedMaterialMMultiplier=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.mMultiplier:0}return _b.meshRender.sharedMaterial.mMultiplier},_d._setMeshRenderSharedMaterialMMultiplier=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.mMultiplier=_c[0])}else _b.meshRender.material.mMultiplier=_c[0]},_d._getMeshRenderSharedMaterialBaseScrollSpeedX=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.baseScrollSpeedX:0}return _b.meshRender.sharedMaterial.baseScrollSpeedX},_d._setMeshRenderSharedMaterialBaseScrollSpeedX=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.baseScrollSpeedX=_c[0])}else _b.meshRender.material.baseScrollSpeedX=_c[0]},_d._getMeshRenderSharedMaterialBaseScrollSpeedY=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.baseScrollSpeedY:0}return _b.meshRender.sharedMaterial.baseScrollSpeedY},_d._setMeshRenderSharedMaterialBaseScrollSpeedY=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.baseScrollSpeedY=_c[0])}else _b.meshRender.material.baseScrollSpeedY=_c[0]},_d._getMeshRenderSharedMaterialSecondScrollSpeedX=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.secondScrollSpeedX:0}return _b.meshRender.sharedMaterial.secondScrollSpeedX},_d._setMeshRenderSharedMaterialSecondScrollSpeedX=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.secondScrollSpeedX=_c[0])}else _b.meshRender.material.secondScrollSpeedX=_c[0]},_d._getMeshRenderSharedMaterialSecondScrollSpeedY=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.secondScrollSpeedY:0}return _b.meshRender.sharedMaterial.secondScrollSpeedY},_d._setMeshRenderSharedMaterialSecondScrollSpeedY=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.secondScrollSpeedY=_c[0])}else _b.meshRender.material.secondScrollSpeedY=_c[0]},_d._getMeshRenderSharedMaterialAlpha=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.alpha:0}return _b.meshRender.sharedMaterial.alpha},_d._setMeshRenderSharedMaterialAlpha=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.alpha=_c[0])}else _b.meshRender.material.alpha=_c[0]},_d._getMeshRenderSharedMaterialIntensity=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.intensity:0}return _b.meshRender.sharedMaterial.intensity},_d._setMeshRenderSharedMaterialIntensity=function(_a,_b,_c){if(_a){var _d=_a.transform._entity;_d&&(_d.owner.meshRender.material.intensity=_c[0])}else _b.meshRender.material.intensity=_c[0]},_d._getMeshRenderSharedMaterialDetailTilingOffset=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.detailTilingOffset.elements:null}return _b.meshRender.sharedMaterial.detailTilingOffset.elements},_d._setMeshRenderSharedMaterialDetailTilingOffset=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).detailTilingOffset).elements=_c,_d.detailTilingOffset=_e)}else(_e=(_d=_b.meshRender.material).detailTilingOffset).elements=_c,_d.detailTilingOffset=_e},_d._getMeshRenderSharedMaterialDissolveTilingOffset=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.dissolveTilingOffset.elements:null}return _b.meshRender.sharedMaterial.dissolveTilingOffset.elements},_d._setMeshRenderSharedMaterialDissolveTilingOffset=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).dissolveTilingOffset).elements=_c,_d.dissolveTilingOffset=_e)}else(_e=(_d=_b.meshRender.material).dissolveTilingOffset).elements=_c,_d.dissolveTilingOffset=_e},_d._getMeshRenderSharedMaterialMaskTilingOffset=function(_a,_b){if(_a){var _c=_a.transform._entity;return _c?_c.owner.meshRender.sharedMaterial.maskTilingOffset.elements:null}return _b.meshRender.sharedMaterial.maskTilingOffset.elements},_d._setMeshRenderSharedMaterialMaskTilingOffset=function(_a,_b,_c){var _d,_e;if(_a){var _f=_a.transform._entity;_f&&((_e=(_d=_f.owner.meshRender.material).maskTilingOffset).elements=_c,_d.maskTilingOffset=_e)}else(_e=(_d=_b.meshRender.material).maskTilingOffset).elements=_c,_d.maskTilingOffset=_e},_d._propertyIDCounter=0,_d._propertyIndexDic={},_d._propertySetFuncs=[],_d._propertyGetFuncs=[],_d}(),_P=function(){function _a(){this.startTime=NaN,this.inTangent=null,this.outTangent=null,this.data=null,this.duration=NaN,this.next=null}return _n(_a,"laya.d3.animation.Keyframe"),_a}(),_Q=function(){function _a(){this._cacheProperty=!1,this.path=null,this.componentType=null,this.propertyNameID=0,this.keyFrameWidth=0,this.defaultData=null,this.keyFrames=null}return _n(_a,"laya.d3.animation.KeyframeNode"),_a}(),_G=(function(){function _a(){this._tempVector30=new _gb,this._tempVector31=new _gb,this._tempVector32=new _gb,this._a=new _gb,this._b=new _gb,this._c=new _gb,this._d=new _gb}_n(_a,"laya.d3.core.glitter.SplineCurvePositionVelocity");var _b=_a.prototype;_b.Init=function(_a,_b,_c,_d){_a.cloneTo(this._d),_b.cloneTo(this._c),_gb.scale(_a,2,this._a),_gb.scale(_c,2,this._tempVector30),_gb.subtract(this._a,this._tempVector30,this._a),_gb.add(this._a,_b,this._a),_gb.add(this._a,_d,this._a),_gb.scale(_c,3,this._b),_gb.scale(_a,3,this._tempVector30),_gb.subtract(this._b,this._tempVector30,this._b),_gb.subtract(this._b,_d,this._b),_gb.scale(_b,2,this._tempVector30),_gb.subtract(this._b,this._tempVector30,this._b)},_b.Slerp=function(_a,_b){_gb.scale(this._a,_a*_a*_a,this._tempVector30),_gb.scale(this._b,_a*_a,this._tempVector31),_gb.scale(this._c,_a,this._tempVector32),_gb.add(this._tempVector30,this._tempVector31,_b),_gb.add(_b,this._tempVector32,_b),_gb.add(_b,this._d,_b)}}(),function(){function _K(_a,_b,_c,_d){this._datas=null,this._w=0,this._h=0,this._minHeight=NaN,this._maxHeight=NaN,this._datas=[],this._w=_a,this._h=_b,this._minHeight=_c,this._maxHeight=_d}_n(_K,"laya.d3.core.HeightMap");var _a=_K.prototype;_a._inBounds=function(_a,_b){return 0<=_a&&_a<this._h&&0<=_b&&_b<this._w},_a.getHeight=function(_a,_b){return this._inBounds(_a,_b)?this._datas[_a][_b]:NaN},_o(0,_a,"width",function(){return this._w}),_o(0,_a,"height",function(){return this._h}),_o(0,_a,"maxHeight",function(){return this._maxHeight}),_o(0,_a,"minHeight",function(){return this._minHeight}),_K.creatFromMesh=function(_a,_b,_c,_d){for(var _e=[],_f=[],_g=_a.getSubMeshCount(),_h=0;_h<_g;_h++){for(var _i=_a.getSubMesh(_h),_j=_i._getVertexBuffer(),_k=_j.getData(),_l=[],_m=0;_m<_k.length;_m+=_j.vertexDeclaration.vertexStride/4){var _n=new _gb(_k[_m+0],_k[_m+1],_k[_m+2]);_l.push(_n)}_e.push(_l);var _o=_i._getIndexBuffer();_f.push(_o.getData())}var _p=_a.boundingBox,_q=_p.min.x,_r=_p.min.z,_s=_p.max.x,_t=_p.max.z,_u=_p.min.y,_v=_p.max.y,_w=_s-_q,_x=_t-_r,_y=_d.elements[0]=_w/(_b-1),_z=_d.elements[1]=_x/(_c-1),_A=new _K(_b,_c,_u,_v),_B=_K._tempRay,_C=_B.direction.elements;_C[0]=0,_C[1]=-1,_C[2]=0;var _D=_v+.1;_B.origin.elements[1]=_D;for(var _E=0;_E<_c;_E++){var _F=_r+_E*_z;_A._datas[_E]=[];for(var _G=0;_G<_b;_G++){var _H=_q+_G*_y,_I=_B.origin.elements;_I[0]=_H,_I[2]=_F;var _J=_K._getPosition(_B,_e,_f);_A._datas[_E][_G]=_J===Number.MAX_VALUE?NaN:_D-_J}}return _A},_K.createFromImage=function(_a,_b,_c){for(var _d=_a.width,_e=_a.height,_f=new _K(_d,_e,_b,_c),_g=(_c-_b)/254,_h=_a.getPixels(),_i=0,_j=0;_j<_e;_j++)for(var _k=_f._datas[_j]=[],_l=0;_l<_d;_l++){var _m=_h[_i++],_n=_h[_i++],_o=_h[_i++],_p=_h[_i++];_k[_l]=255==_m&&255==_n&&255==_o&&255==_p?NaN:(_m+_n+_o)/3*_g+_b}return _f},_K._getPosition=function(_a,_b,_c){for(var _d=Number.MAX_VALUE,_e=0;_e<_b.length;_e++)for(var _f=_b[_e],_g=_c[_e],_h=0;_h<_g.length;_h+=3){var _i=_f[_g[_h+0]],_j=_f[_g[_h+1]],_k=_f[_g[_h+2]],_l=_ob.rayIntersectsTriangle(_a,_i,_j,_k);!isNaN(_l)&&_l<_d&&(_d=_l)}return _d},_l(_K,["_tempRay",function(){return this._tempRay=new _eb(new _gb,new _gb)}])}(),function(){function _e(){this._visible=!0,this._nonRigidbodyOffset=0,this._colliders=[]}_n(_e,"laya.d3.core.Layer");var _a=_e.prototype;return _a._binarySearchIndex=function(){for(var _a=0,_b=_e._collsionTestList.length-1,_c=0;_a<=_b;){_c=Math.floor((_a+_b)/2);var _d=_e._collsionTestList[_c];if(_d==this._number)return _c;_d>this._number?_b=_c-1:_a=_c+1}return _a},_a._addCollider=function(_a){0===this._colliders.length&&_e._collsionTestList.splice(this._binarySearchIndex(),0,this._number),_a._isRigidbody?(this._colliders.unshift(_a),this._nonRigidbodyOffset++):this._colliders.push(_a)},_a._removeCollider=function(_a){var _b=this._colliders.indexOf(_a);_b<this._nonRigidbodyOffset&&this._nonRigidbodyOffset--,this._colliders.splice(_b,1),0===this._colliders.length&&_e._collsionTestList.splice(_e._collsionTestList.indexOf(this._number),1)},_o(0,_a,"number",function(){return this._number}),_o(0,_a,"visible",function(){return this._visible},function(_a){this._visible=_a,_e._visibleLayers=_a?_e._visibleLayers|this.mask:_e._visibleLayers&~this.mask}),_o(0,_a,"mask",function(){return this._mask}),_o(1,_e,"visibleLayers",function(){return _e._visibleLayers},function(_a){_e._visibleLayers=_a;for(var _b=0,_c=_e._layerList.length;_b<_c;_b++){var _d=_e._layerList[_b];_d._visible=0!=(_d._mask&_e._visibleLayers)}}),_e.__init__=function(){_e._layerList.length=31;for(var _a=0;_a<31;_a++){var _b=new _e;_e._layerList[_a]=_b,0===_a?(_b.name="Default Layer",_b.visible=!0):(_b.name="Layer-"+_a,_b.visible=!1),_b._number=_a,_b._mask=Math.pow(2,_a)}_e.currentCreationLayer=_e._layerList[0]},_e.getLayerByNumber=function(_a){if(_a<0||30<_a)throw new Error("无法返回指定Layer，该number超出范围！");return _e._layerList[_a]},_e.getLayerByName=function(_a){for(var _b=0;_b<31;_b++)if(_e._layerList[_b].name===_a)return _e._layerList[_b];throw new Error("无法返回指定Layer,该name不存在")},_e.isVisible=function(_a){return 0!=(_a&_e._currentCameraCullingMask&_e._visibleLayers)},_e._layerList=[],_e._visibleLayers=2147483647,_e._collsionTestList=[],_e._currentCameraCullingMask=2147483647,_e.maxCount=31,_e.currentCreationLayer=null,_e}()),_H=(function(){function _a(_a,_b,_c){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=_a,this._minCount=_b,this._maxCount=_c}_n(_a,"laya.d3.core.particleShuriKen.module.Burst");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.cloneTo=function(_a){var _b=_a;_b._time=this._time,_b._minCount=this._minCount,_b._maxCount=this._maxCount},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"time",function(){return this._time}),_o(0,_b,"minCount",function(){return this._minCount}),_o(0,_b,"maxCount",function(){return this._maxCount})}(),function(){function _a(_a){this._color=null,this.enbale=!1,this._color=_a}_n(_a,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var _b=_a.prototype;_b.cloneTo=function(_a){var _b=_a;this._color.cloneTo(_b._color),_b.enbale=this.enbale},_b.clone=function(){var _a;switch(this._color.type){case 0:_a=_J.createByConstant(this._color.constant.clone());break;case 1:_a=_J.createByGradient(this._color.gradient.clone());break;case 2:_a=_J.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:_a=_J.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var _b=new this.constructor(_a);return _b.enbale=this.enbale,_b},_o(0,_b,"color",function(){return this._color})}(),function(){function _a(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}_n(_a,"laya.d3.core.particleShuriKen.module.Emission");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0,"laya.resource.IDestroy":!0}),_b._destroy=function(){this._bursts=null,this._destroyed=!0},_b.getBurstsCount=function(){return this._bursts.length},_b.getBurstByIndex=function(_a){return this._bursts[_a]},_b.addBurst=function(_a){var _b=this._bursts.length;if(0<_b)for(var _c=0;_c<_b;_c++)this._bursts[_c].time>_a.time&&this._bursts.splice(_c,0,_a);this._bursts.push(_a)},_b.removeBurst=function(_a){var _b=this._bursts.indexOf(_a);-1!==_b&&this._bursts.splice(_b,1)},_b.removeBurstByIndex=function(_a){this._bursts.splice(_a,1)},_b.clearBurst=function(){this._bursts.length=0},_b.cloneTo=function(_a){var _b=_a,_c=_b._bursts;_c.length=this._bursts.length;for(var _d=0,_e=this._bursts.length;_d<_e;_d++){var _f=_c[_d];_f?this._bursts[_d].cloneTo(_f):_c[_d]=this._bursts[_d].clone()}_b._emissionRate=this._emissionRate,_b.enbale=this.enbale},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"destroyed",function(){return this._destroyed}),_o(0,_b,"emissionRate",function(){return this._emissionRate},function(_a){if(_a<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=_a})}(),function(){function _d(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}_n(_d,"laya.d3.core.particleShuriKen.module.FrameOverTime");var _a=_d.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,_b._constant=this._constant,this._overTime.cloneTo(_b._overTime),_b._constantMin=this._constantMin,_b._constantMax=this._constantMax,this._overTimeMin.cloneTo(_b._overTimeMin),this._overTimeMax.cloneTo(_b._overTimeMax)},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"frameOverTimeData",function(){return this._overTime}),_o(0,_a,"constant",function(){return this._constant}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"frameOverTimeDataMin",function(){return this._overTimeMin}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"frameOverTimeDataMax",function(){return this._overTimeMax}),_o(0,_a,"constantMax",function(){return this._constantMax}),_d.createByConstant=function(_a){var _b=new _d;return _b._type=0,_b._constant=_a,_b},_d.createByOverTime=function(_a){var _b=new _d;return _b._type=1,_b._overTime=_a,_b},_d.createByRandomTwoConstant=function(_a,_b){var _c=new _d;return _c._type=2,_c._constantMin=_a,_c._constantMax=_b,_c},_d.createByRandomTwoOverTime=function(_a,_b){var _c=new _d;return _c._type=3,_c._overTimeMin=_a,_c._overTimeMax=_b,_c},_d}()),_I=function(){function _j(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}_n(_j,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var _a=_j.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,_b._separateAxes=this._separateAxes,_b._constant=this._constant,this._constantSeparate.cloneTo(_b._constantSeparate),this._gradient.cloneTo(_b._gradient),this._gradientX.cloneTo(_b._gradientX),this._gradientY.cloneTo(_b._gradientY),this._gradientZ.cloneTo(_b._gradientZ),_b._constantMin=this._constantMin,_b._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(_b._constantMinSeparate),this._constantMaxSeparate.cloneTo(_b._constantMaxSeparate),this._gradientMin.cloneTo(_b._gradientMin),this._gradientMax.cloneTo(_b._gradientMax),this._gradientXMin.cloneTo(_b._gradientXMin),this._gradientXMax.cloneTo(_b._gradientXMax),this._gradientYMin.cloneTo(_b._gradientYMin),this._gradientYMax.cloneTo(_b._gradientYMax),this._gradientZMin.cloneTo(_b._gradientZMin),this._gradientZMax.cloneTo(_b._gradientZMax)},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"gradientZ",function(){return this._gradientZ}),_o(0,_a,"constant",function(){return this._constant}),_o(0,_a,"gradient",function(){return this._gradient}),_o(0,_a,"separateAxes",function(){return this._separateAxes}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"constantSeparate",function(){return this._constantSeparate}),_o(0,_a,"gradientX",function(){return this._gradientX}),_o(0,_a,"gradientY",function(){return this._gradientY}),_o(0,_a,"gradientW",function(){return this._gradientW}),_o(0,_a,"gradientMin",function(){return this._gradientMin}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"gradientMax",function(){return this._gradientMax}),_o(0,_a,"constantMax",function(){return this._constantMax}),_o(0,_a,"gradientWMin",function(){return this._gradientWMin}),_o(0,_a,"constantMinSeparate",function(){return this._constantMinSeparate}),_o(0,_a,"constantMaxSeparate",function(){return this._constantMaxSeparate}),_o(0,_a,"gradientXMin",function(){return this._gradientXMin}),_o(0,_a,"gradientXMax",function(){return this._gradientXMax}),_o(0,_a,"gradientWMax",function(){return this._gradientWMax}),_o(0,_a,"gradientYMin",function(){return this._gradientYMin}),_o(0,_a,"gradientYMax",function(){return this._gradientYMax}),_o(0,_a,"gradientZMin",function(){return this._gradientZMin}),_o(0,_a,"gradientZMax",function(){return this._gradientZMax}),_j.createByConstant=function(_a){var _b=new _j;return _b._type=0,_b._separateAxes=!1,_b._constant=_a,_b},_j.createByConstantSeparate=function(_a){var _b=new _j;return _b._type=0,_b._separateAxes=!0,_b._constantSeparate=_a,_b},_j.createByGradient=function(_a){var _b=new _j;return _b._type=1,_b._separateAxes=!1,_b._gradient=_a,_b},_j.createByGradientSeparate=function(_a,_b,_c,_d){var _e=new _j;return _e._type=1,_e._separateAxes=!0,_e._gradientX=_a,_e._gradientY=_b,_e._gradientZ=_c,_e._gradientW=_d,_e},_j.createByRandomTwoConstant=function(_a,_b){var _c=new _j;return _c._type=2,_c._separateAxes=!1,_c._constantMin=_a,_c._constantMax=_b,_c},_j.createByRandomTwoConstantSeparate=function(_a,_b){var _c=new _j;return _c._type=2,_c._separateAxes=!0,_c._constantMinSeparate=_a,_c._constantMaxSeparate=_b,_c},_j.createByRandomTwoGradient=function(_a,_b){var _c=new _j;return _c._type=3,_c._separateAxes=!1,_c._gradientMin=_a,_c._gradientMax=_b,_c},_j.createByRandomTwoGradientSeparate=function(_a,_b,_c,_d,_e,_f,_g,_h){var _i=new _j;return _i._type=3,_i._separateAxes=!0,_i._gradientXMin=_a,_i._gradientXMax=_b,_i._gradientYMin=_c,_i._gradientYMax=_d,_i._gradientZMin=_e,_i._gradientZMax=_f,_i._gradientWMin=_g,_i._gradientWMax=_h,_i},_j}(),_J=function(){function _d(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}_n(_d,"laya.d3.core.particleShuriKen.module.GradientColor");var _a=_d.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,this._constant.cloneTo(_b._constant),this._constantMin.cloneTo(_b._constantMin),this._constantMax.cloneTo(_b._constantMax),this._gradient.cloneTo(_b._gradient),this._gradientMin.cloneTo(_b._gradientMin),this._gradientMax.cloneTo(_b._gradientMax)},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"gradient",function(){return this._gradient}),_o(0,_a,"constant",function(){return this._constant}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"gradientMin",function(){return this._gradientMin}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"gradientMax",function(){return this._gradientMax}),_o(0,_a,"constantMax",function(){return this._constantMax}),_d.createByConstant=function(_a){var _b=new _d;return _b._type=0,_b._constant=_a,_b},_d.createByGradient=function(_a){var _b=new _d;return _b._type=1,_b._gradient=_a,_b},_d.createByRandomTwoConstant=function(_a,_b){var _c=new _d;return _c._type=2,_c._constantMin=_a,_c._constantMax=_b,_c},_d.createByRandomTwoGradient=function(_a,_b){var _c=new _d;return _c._type=3,_c._gradientMin=_a,_c._gradientMax=_b,_c},_d}(),_K=(function(){function _a(){this._alphaCurrentLength=0,this._rgbCurrentLength=0,this._alphaElements=null,this._rgbElements=null,this._alphaElements=new Float32Array(8),this._rgbElements=new Float32Array(16)}_n(_a,"laya.d3.core.particleShuriKen.module.GradientDataColor");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.addAlpha=function(_a,_b){this._alphaCurrentLength<8?(6===this._alphaCurrentLength&&1!==_a&&(_a=1,DEBUG),this._alphaElements[this._alphaCurrentLength++]=_a,this._alphaElements[this._alphaCurrentLength++]=_b):DEBUG},_b.addRGB=function(_a,_b){this._rgbCurrentLength<16?(12===this._rgbCurrentLength&&1!==_a&&(_a=1,DEBUG),this._rgbElements[this._rgbCurrentLength++]=_a,this._rgbElements[this._rgbCurrentLength++]=_b.x,this._rgbElements[this._rgbCurrentLength++]=_b.y,this._rgbElements[this._rgbCurrentLength++]=_b.z):DEBUG},_b.cloneTo=function(_a){var _b=_a,_c=0,_d=0;_b._alphaCurrentLength=this._alphaCurrentLength;var _e=_b._alphaElements;for(_e.length=this._alphaElements.length,_c=0,_d=this._alphaElements.length;_c<_d;_c++)_e[_c]=this._alphaElements[_c];_b._rgbCurrentLength=this._rgbCurrentLength;var _f=_b._rgbElements;for(_f.length=this._rgbElements.length,_c=0,_d=this._rgbElements.length;_c<_d;_c++)_f[_c]=this._rgbElements[_c]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"alphaGradientCount",function(){return this._alphaCurrentLength/2}),_o(0,_b,"rgbGradientCount",function(){return this._rgbCurrentLength/4})}(),function(){function _a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}_n(_a,"laya.d3.core.particleShuriKen.module.GradientDataInt");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.add=function(_a,_b){this._currentLength<8?(6===this._currentLength&&1!==_a&&(_a=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=_a,this._elements[this._currentLength++]=_b):console.log("Warning:data count must lessEqual than 4")},_b.cloneTo=function(_a){var _b=_a;_b._currentLength=this._currentLength;var _c=_b._elements;_c.length=this._elements.length;for(var _d=0,_e=this._elements.length;_d<_e;_d++)_c[_d]=this._elements[_d]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"gradientCount",function(){return this._currentLength/2})}(),function(){function _a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}_n(_a,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.add=function(_a,_b){this._currentLength<8?(6===this._currentLength&&1!==_a&&(_a=1,DEBUG),this._elements[this._currentLength++]=_a,this._elements[this._currentLength++]=_b):DEBUG},_b.getKeyByIndex=function(_a){return this._elements[2*_a]},_b.getValueByIndex=function(_a){return this._elements[2*_a+1]},_b.getAverageValue=function(){for(var _a=0,_b=this._currentLength-2;_a<_b;_a+=2){this._elements[_a+1];this._elements[_a+3],this._elements[_a+2]-this._elements[_a]}return 0},_b.cloneTo=function(_a){var _b=_a;_b._currentLength=this._currentLength;var _c=_b._elements;_c.length=this._elements.length;for(var _d=0,_e=this._elements.length;_d<_e;_d++)_c[_d]=this._elements[_d]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"gradientCount",function(){return this._currentLength/2})}(),function(){function _a(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(12)}_n(_a,"laya.d3.core.particleShuriKen.module.GradientDataVector2");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.add=function(_a,_b){this._currentLength<8?(6===this._currentLength&&1!==_a&&(_a=1,DEBUG&&console.log("GradientDataVector2 warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=_a,this._elements[this._currentLength++]=_b.x,this._elements[this._currentLength++]=_b.y):DEBUG&&console.log("GradientDataVector2 warning:data count must lessEqual than 4")},_b.cloneTo=function(_a){var _b=_a;_b._currentLength=this._currentLength;var _c=_b._elements;_c.length=this._elements.length;for(var _d=0,_e=this._elements.length;_d<_e;_d++)_c[_d]=this._elements[_d]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"gradientCount",function(){return this._currentLength/3})}(),function(){function _h(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}_n(_h,"laya.d3.core.particleShuriKen.module.GradientSize");var _a=_h.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.getMaxSizeInGradient=function(){var _a=0,_b=0,_c=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(_a=0,_b=this._gradientX.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientX.getValueByIndex(_a));for(_a=0,_b=this._gradientY.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientY.getValueByIndex(_a))}else for(_a=0,_b=this._gradient.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradient.getValueByIndex(_a));break;case 1:_c=this._separateAxes?(_c=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),_c=Math.max(_c,this._constantMinSeparate.y),Math.max(_c,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(_a=0,_b=this._gradientXMin.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientXMin.getValueByIndex(_a));for(_a=0,_b=this._gradientXMax.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientXMax.getValueByIndex(_a));for(_a=0,_b=this._gradientYMin.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientYMin.getValueByIndex(_a));for(_a=0,_b=this._gradientZMax.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientZMax.getValueByIndex(_a))}else{for(_a=0,_b=this._gradientMin.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientMin.getValueByIndex(_a));for(_a=0,_b=this._gradientMax.gradientCount;_a<_b;_a++)_c=Math.max(_c,this._gradientMax.getValueByIndex(_a))}}return _c},_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,_b._separateAxes=this._separateAxes,this._gradient.cloneTo(_b._gradient),this._gradientX.cloneTo(_b._gradientX),this._gradientY.cloneTo(_b._gradientY),this._gradientZ.cloneTo(_b._gradientZ),_b._constantMin=this._constantMin,_b._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(_b._constantMinSeparate),this._constantMaxSeparate.cloneTo(_b._constantMaxSeparate),this._gradientMin.cloneTo(_b._gradientMin),this._gradientMax.cloneTo(_b._gradientMax),this._gradientXMin.cloneTo(_b._gradientXMin),this._gradientXMax.cloneTo(_b._gradientXMax),this._gradientYMin.cloneTo(_b._gradientYMin),this._gradientYMax.cloneTo(_b._gradientYMax),this._gradientZMin.cloneTo(_b._gradientZMin),this._gradientZMax.cloneTo(_b._gradientZMax)},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"gradientZ",function(){return this._gradientZ}),_o(0,_a,"gradient",function(){return this._gradient}),_o(0,_a,"separateAxes",function(){return this._separateAxes}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"gradientMin",function(){return this._gradientMin}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"gradientX",function(){return this._gradientX}),_o(0,_a,"gradientY",function(){return this._gradientY}),_o(0,_a,"gradientMax",function(){return this._gradientMax}),_o(0,_a,"constantMax",function(){return this._constantMax}),_o(0,_a,"constantMinSeparate",function(){return this._constantMinSeparate}),_o(0,_a,"constantMaxSeparate",function(){return this._constantMaxSeparate}),_o(0,_a,"gradientXMin",function(){return this._gradientXMin}),_o(0,_a,"gradientXMax",function(){return this._gradientXMax}),_o(0,_a,"gradientYMin",function(){return this._gradientYMin}),_o(0,_a,"gradientYMax",function(){return this._gradientYMax}),_o(0,_a,"gradientZMin",function(){return this._gradientZMin}),_o(0,_a,"gradientZMax",function(){return this._gradientZMax}),_h.createByGradient=function(_a){var _b=new _h;return _b._type=0,_b._separateAxes=!1,_b._gradient=_a,_b},_h.createByGradientSeparate=function(_a,_b,_c){var _d=new _h;return _d._type=0,_d._separateAxes=!0,_d._gradientX=_a,_d._gradientY=_b,_d._gradientZ=_c,_d},_h.createByRandomTwoConstant=function(_a,_b){var _c=new _h;return _c._type=1,_c._separateAxes=!1,_c._constantMin=_a,_c._constantMax=_b,_c},_h.createByRandomTwoConstantSeparate=function(_a,_b){var _c=new _h;return _c._type=1,_c._separateAxes=!0,_c._constantMinSeparate=_a,_c._constantMaxSeparate=_b,_c},_h.createByRandomTwoGradient=function(_a,_b){var _c=new _h;return _c._type=2,_c._separateAxes=!1,_c._gradientMin=_a,_c._gradientMax=_b,_c},_h.createByRandomTwoGradientSeparate=function(_a,_b,_c,_d,_e,_f){var _g=new _h;return _g._type=2,_g._separateAxes=!0,_g._gradientXMin=_a,_g._gradientXMax=_b,_g._gradientYMin=_c,_g._gradientYMax=_d,_g._gradientZMin=_e,_g._gradientZMax=_f,_g},_h}()),_L=function(){function _h(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}_n(_h,"laya.d3.core.particleShuriKen.module.GradientVelocity");var _a=_h.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,this._constant.cloneTo(_b._constant),this._gradientX.cloneTo(_b._gradientX),this._gradientY.cloneTo(_b._gradientY),this._gradientZ.cloneTo(_b._gradientZ),this._constantMin.cloneTo(_b._constantMin),this._constantMax.cloneTo(_b._constantMax),this._gradientXMin.cloneTo(_b._gradientXMin),this._gradientXMax.cloneTo(_b._gradientXMax),this._gradientYMin.cloneTo(_b._gradientYMin),this._gradientYMax.cloneTo(_b._gradientYMax),this._gradientZMin.cloneTo(_b._gradientZMin),this._gradientZMax.cloneTo(_b._gradientZMax)},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"gradientZ",function(){return this._gradientZ}),_o(0,_a,"constant",function(){return this._constant}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"gradientXMax",function(){return this._gradientXMax}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"gradientX",function(){return this._gradientX}),_o(0,_a,"gradientY",function(){return this._gradientY}),_o(0,_a,"gradientXMin",function(){return this._gradientXMin}),_o(0,_a,"constantMax",function(){return this._constantMax}),_o(0,_a,"gradientYMin",function(){return this._gradientYMin}),_o(0,_a,"gradientYMax",function(){return this._gradientYMax}),_o(0,_a,"gradientZMin",function(){return this._gradientZMin}),_o(0,_a,"gradientZMax",function(){return this._gradientZMax}),_h.createByConstant=function(_a){var _b=new _h;return _b._type=0,_b._constant=_a,_b},_h.createByGradient=function(_a,_b,_c){var _d=new _h;return _d._type=1,_d._gradientX=_a,_d._gradientY=_b,_d._gradientZ=_c,_d},_h.createByRandomTwoConstant=function(_a,_b){var _c=new _h;return _c._type=2,_c._constantMin=_a,_c._constantMax=_b,_c},_h.createByRandomTwoGradient=function(_a,_b,_c,_d,_e,_f){var _g=new _h;return _g._type=3,_g._gradientXMin=_a,_g._gradientXMax=_b,_g._gradientYMin=_c,_g._gradientYMax=_d,_g._gradientZMin=_e,_g._gradientZMax=_f,_g},_h}(),_M=(function(){function _a(_a){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=_a}_n(_a,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.cloneTo=function(_a){var _b=_a;this._angularVelocity.cloneTo(_b._angularVelocity),_b.enbale=this.enbale},_b.clone=function(){var _a;switch(this._angularVelocity.type){case 0:_a=this._angularVelocity.separateAxes?_I.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):_I.createByConstant(this._angularVelocity.constant);break;case 1:_a=this._angularVelocity.separateAxes?_I.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone(),this._angularVelocity.gradientW.clone()):_I.createByGradient(this._angularVelocity.gradient.clone());break;case 2:_a=this._angularVelocity.separateAxes?_I.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):_I.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:_a=this._angularVelocity.separateAxes?_I.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):_I.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var _b=new this.constructor(_a);return _b.enbale=this.enbale,_b},_o(0,_b,"angularVelocity",function(){return this._angularVelocity})}(),function(){function _a(){this.enable=!1,this.randomDirection=!1}_n(_a,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.IClone":!0}),_b._getShapeBoundBox=function(_a){throw new Error("BaseShape: must override it.")},_b._getSpeedBoundBox=function(_a){throw new Error("BaseShape: must override it.")},_b.generatePositionAndDirection=function(_a,_b,_c,_d){throw new Error("BaseShape: must override it.")},_b._calculateProceduralBounds=function(_a,_b,_c){this._getShapeBoundBox(_a);var _d=_a.min,_e=_a.max;_gb.multiply(_d,_b,_d),_gb.multiply(_e,_b,_e);var _f=new _Xa(new _gb,new _gb);this.randomDirection?(_f.min=new _gb(-1,-1,-1),_f.max=new _gb(1,1,1)):this._getSpeedBoundBox(_f);var _g=new _Xa(new _gb,new _gb),_h=_g.min,_i=_g.max;_gb.scale(_f.min,_c.y,_h),_gb.scale(_f.max,_c.y,_i),_gb.add(_a.min,_h,_h),_gb.add(_a.max,_i,_i),_gb.min(_a.min,_h,_a.min),_gb.max(_a.max,_h,_a.max);var _j=new _Xa(new _gb,new _gb),_k=_j.min,_l=_j.max;_gb.scale(_f.min,_c.x,_k),_gb.scale(_f.max,_c.x,_l),_gb.min(_j.min,_l,_h),_gb.max(_j.min,_l,_i),_gb.min(_a.min,_h,_a.min),_gb.max(_a.max,_h,_a.max)},_b.cloneTo=function(_a){_a.enable=this.enable},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_a}()),_R=function(){function _f(){}return _n(_f,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),_f._randomPointUnitArcCircle=function(_a,_b,_c){var _d=_b.elements,_e=NaN;_e=_c?_c.getFloat()*_a:Math.random()*_a,_d[0]=Math.cos(_e),_d[1]=Math.sin(_e)},_f._randomPointInsideUnitArcCircle=function(_a,_b,_c){var _d=_b.elements;_f._randomPointUnitArcCircle(_a,_b,_c);var _e=NaN;_e=_c?Math.pow(_c.getFloat(),.5):Math.pow(Math.random(),.5),_d[0]=_d[0]*_e,_d[1]=_d[1]*_e},_f._randomPointUnitCircle=function(_a,_b){var _c=_a.elements,_d=NaN;_d=_b?_b.getFloat()*Math.PI*2:Math.random()*Math.PI*2,_c[0]=Math.cos(_d),_c[1]=Math.sin(_d)},_f._randomPointInsideUnitCircle=function(_a,_b){var _c=_a.elements;_f._randomPointUnitCircle(_a);var _d=NaN;_d=_b?Math.pow(_b.getFloat(),.5):Math.pow(Math.random(),.5),_c[0]=_c[0]*_d,_c[1]=_c[1]*_d},_f._randomPointUnitSphere=function(_a,_b){var _c=_a.elements,_d=NaN,_e=NaN;_e=_b?(_d=_c[2]=2*_b.getFloat()-1,_b.getFloat()*Math.PI*2):(_d=_c[2]=2*Math.random()-1,Math.random()*Math.PI*2);var _f=Math.sqrt(1-_d*_d);_c[0]=_f*Math.cos(_e),_c[1]=_f*Math.sin(_e)},_f._randomPointInsideUnitSphere=function(_a,_b){var _c=_a.elements;_f._randomPointUnitSphere(_a);var _d=NaN;_d=_b?Math.pow(_b.getFloat(),1/3):Math.pow(Math.random(),1/3),_c[0]=_c[0]*_d,_c[1]=_c[1]*_d,_c[2]=_c[2]*_d},_f._randomPointInsideHalfUnitBox=function(_a,_b){var _c=_a.elements;_b?(_c[0]=_b.getFloat()-.5,_c[1]=_b.getFloat()-.5,_c[2]=_b.getFloat()-.5):(_c[0]=Math.random()-.5,_c[1]=Math.random()-.5,_c[2]=Math.random()-.5)},_f}(),_S=(function(){function _a(_a){this._size=null,this.enbale=!1,this._size=_a}_n(_a,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.cloneTo=function(_a){var _b=_a;this._size.cloneTo(_b._size),_b.enbale=this.enbale},_b.clone=function(){var _a;switch(this._size.type){case 0:_a=this._size.separateAxes?_K.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):_K.createByGradient(this._size.gradient.clone());break;case 1:_a=this._size.separateAxes?_K.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):_K.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:_a=this._size.separateAxes?_K.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):_K.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var _b=new this.constructor(_a);return _b.enbale=this.enbale,_b},_o(0,_b,"size",function(){return this._size})}(),function(){function _d(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}_n(_d,"laya.d3.core.particleShuriKen.module.StartFrame");var _a=_d.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.cloneTo=function(_a){var _b=_a;_b._type=this._type,_b._constant=this._constant,_b._constantMin=this._constantMin,_b._constantMax=this._constantMax},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_a,"constant",function(){return this._constant}),_o(0,_a,"type",function(){return this._type}),_o(0,_a,"constantMin",function(){return this._constantMin}),_o(0,_a,"constantMax",function(){return this._constantMax}),_d.createByConstant=function(_a){var _b=new _d;return _b._type=0,_b._constant=_a,_b},_d.createByRandomTwoConstant=function(_a,_b){var _c=new _d;return _c._type=1,_c._constantMin=_a,_c._constantMax=_b,_c},_d}()),_T=(function(){function _a(_a,_b){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new _fb(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=_a,this._startFrame=_b}_n(_a,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.cloneTo=function(_a){var _b=_a;this.tiles.cloneTo(_b.tiles),_b.type=this.type,_b.randomRow=this.randomRow,this._frame.cloneTo(_b._frame),this._startFrame.cloneTo(_b._startFrame),_b.cycles=this.cycles,_b.enableUVChannels=this.enableUVChannels,_b.enable=this.enable},_b.clone=function(){var _a,_b;switch(this._frame.type){case 0:_a=_H.createByConstant(this._frame.constant);break;case 1:_a=_H.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:_a=_H.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:_a=_H.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:_b=_S.createByConstant(this._startFrame.constant);break;case 1:_b=_S.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var _c=new this.constructor(_a,_b);return this.tiles.cloneTo(_c.tiles),_c.type=this.type,_c.randomRow=this.randomRow,_c.cycles=this.cycles,_c.enableUVChannels=this.enableUVChannels,_c.enable=this.enable,_c},_o(0,_b,"frame",function(){return this._frame}),_o(0,_b,"startFrame",function(){return this._startFrame})}(),function(){function _a(_a){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=_a}_n(_a,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var _b=_a.prototype;_v.imps(_b,{"laya.d3.core.IClone":!0}),_b.cloneTo=function(_a){var _b=_a;this._velocity.cloneTo(_b._velocity),_b.enbale=this.enbale,_b.space=this.space},_b.clone=function(){var _a;switch(this._velocity.type){case 0:_a=_L.createByConstant(this._velocity.constant.clone());break;case 1:_a=_L.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:_a=_L.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:_a=_L.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var _b=new this.constructor(_a);return _b.enbale=this.enbale,_b.space=this.space,_b},_o(0,_b,"velocity",function(){return this._velocity})}(),function(){function _a(){this._tempInt0=0,this._tempInt1=0,this._tempUint0=0,this._tempUint1=0,this._tempUint2=0,this._tempUint3=0,this._tempUint4=0,this._tempUint5=0,this._tempUint6=0,this._tempUint7=0,this._tempNumver0=NaN,this._tempNumver1=NaN,this._tempNumver2=NaN,this._tempNumver3=NaN,this._floatSizePerVer=7,this._defaultBufferSize=600*this._floatSizePerVer,this._vb=null,this._posInVBData=0,this._ib=null,this._posInIBData=0,this._primitiveType=NaN,this._hasBegun=!1,this._numVertsPerPrimitive=0,this._camera=null,this._sharderNameID=0,this._shader=null,this._shaderCompile=null,this._vbData=new Float32Array(this._defaultBufferSize),this._ibData=new Uint16Array(this._defaultBufferSize),this._spriteShaderValue=new _mb,this._vb=_Mb.create(_a._vertexDeclaration,this._defaultBufferSize/this._floatSizePerVer,35048),this._ib=_Lb.create("ushort",this._defaultBufferSize,35048),this._sharderNameID=_Jb.nameKey.getID("LINE"),this._shaderCompile=_yb._preCompileShader[this._sharderNameID]}_n(_a,"laya.d3.core.PhasorSpriter3D");var _b=_a.prototype;return _b.line=function(_a,_b,_c,_d){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+2*this._floatSizePerVer>this._vbData.length||this._posInIBData+2>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(_a.x,_a.y,_a.z,_b.x,_b.y,_b.z,_b.w),this.addVertex(_c.x,_c.y,_c.z,_d.x,_d.y,_d.z,_d.w),this.addIndexes(this._tempUint0,this._tempUint0+1),this},_b.circle=function(_a,_b,_c,_d,_e,_f){for(this._hasBegun&&1===this._primitiveType||this.drawLinesException(),this._tempUint0=2*_b,(this._posInVBData+this._tempUint0*this._floatSizePerVer>this._vbData.length||this._posInIBData+2*this._tempUint0>this._ibData.length)&&this.flush(),this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=0,this._tempInt0=0;this._tempNumver0<6.2832;this._tempNumver0=this._tempNumver0+3.1416/_b,this._tempInt0++)this.addVertex(Math.sin(this._tempNumver0)*_a,Math.cos(this._tempNumver0)*_a,0,_c,_d,_e,_f),0===this._tempInt0?this.addIndexes(this._tempUint1):this._tempInt0===this._tempUint0-1?(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2,this._tempUint1)):(this._tempUint2=this._tempUint1+this._tempInt0,this.addIndexes(this._tempUint2,this._tempUint2));return this},_b.plane=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+4*this._floatSizePerVer>this._vbData.length||this._posInIBData+6>this._ibData.length)&&this.flush(),this._tempNumver0=_d/2,this._tempNumver1=_e/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(_a-this._tempNumver0,_b+this._tempNumver1,_c,_f,_g,_h,_i),this.addVertex(_a+this._tempNumver0,_b+this._tempNumver1,_c,_f,_g,_h,_i),this.addVertex(_a-this._tempNumver0,_b-this._tempNumver1,_c,_f,_g,_h,_i),this.addVertex(_a+this._tempNumver0,_b-this._tempNumver1,_c,_f,_g,_h,_i),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint0+3),this},_b.box=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+36>this._ibData.length)&&this.flush(),this._tempNumver0=_d/2,this._tempNumver1=_e/2,this._tempNumver2=_f/2,this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(_a-this._tempNumver0,_b+this._tempNumver1,_c+this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a+this._tempNumver0,_b+this._tempNumver1,_c+this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a-this._tempNumver0,_b-this._tempNumver1,_c+this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a+this._tempNumver0,_b-this._tempNumver1,_c+this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a+this._tempNumver0,_b+this._tempNumver1,_c-this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a-this._tempNumver0,_b+this._tempNumver1,_c-this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a+this._tempNumver0,_b-this._tempNumver1,_c-this._tempNumver2,_g,_h,_i,_j),this.addVertex(_a-this._tempNumver0,_b-this._tempNumver1,_c-this._tempNumver2,_g,_h,_i,_j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint2,this._tempUint2,this._tempUint1,this._tempUint3,this._tempUint4,this._tempUint5,this._tempUint6,this._tempUint6,this._tempUint5,this._tempUint7,this._tempUint5,this._tempUint0,this._tempUint7,this._tempUint7,this._tempUint0,this._tempUint2,this._tempUint1,this._tempUint4,this._tempUint3,this._tempUint3,this._tempUint4,this._tempUint6,this._tempUint5,this._tempUint4,this._tempUint0,this._tempUint0,this._tempUint4,this._tempUint1,this._tempUint2,this._tempUint3,this._tempUint7,this._tempUint7,this._tempUint3,this._tempUint6),this},_b.cone=function(_a,_b,_c,_d,_e,_f,_g){for(this._hasBegun&&4===this._primitiveType||this.drawTrianglesException(),(this._posInVBData+(2*_c+2)*this._floatSizePerVer>this._vbData.length||this._posInIBData+6*_c>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData,this._tempUint1=this._posInVBData/this._floatSizePerVer,this._tempNumver0=2*Math.PI/_c,this.addVertexIndex(0,_b,0,_d,_e,_f,_g,this._tempUint0),this.addVertexIndex(0,0,0,_d,_e,_f,_g,this._tempUint0+this._floatSizePerVer),this._tempInt0=2,this._tempNumver1=0,this._tempInt1=0;this._tempInt1<_c;this._tempInt1++)this._tempNumver2=Math.cos(this._tempNumver1),this._tempNumver3=Math.sin(this._tempNumver1),this.addVertexIndex(_a*this._tempNumver2,0,_a*this._tempNumver3,_d,_e,_f,_g,this._tempUint0+this._tempInt0*this._floatSizePerVer),this.addIndexes(this._tempUint1,this._tempUint1+this._tempInt0),this._tempInt1==_c-1?this.addIndexes(this._tempUint1+2):this.addIndexes(this._tempUint1+this._tempInt0+1),this.addVertexIndex(_a*this._tempNumver2,0,_a*this._tempNumver3,_d,_e,_f,_g,this._tempUint0+(this._tempInt0+_c)*this._floatSizePerVer),this.addIndexes(this._tempUint1+1),this._tempInt1==_c-1?this.addIndexes(this._tempUint1+_c+2):this.addIndexes(this._tempUint1+this._tempInt0+_c+1),this.addIndexes(this._tempUint1+this._tempInt0+_c),this._tempInt0++,this._tempNumver1+=this._tempNumver0;return this},_b.boundingBoxLine=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return this._hasBegun&&1===this._primitiveType||this.drawLinesException(),(this._posInVBData+8*this._floatSizePerVer>this._vbData.length||this._posInIBData+48>this._ibData.length)&&this.flush(),this._tempUint0=this._posInVBData/this._floatSizePerVer,this.addVertex(_a,_e,_f,_g,_h,_i,_j),this.addVertex(_d,_e,_f,_g,_h,_i,_j),this.addVertex(_a,_b,_f,_g,_h,_i,_j),this.addVertex(_d,_b,_f,_g,_h,_i,_j),this.addVertex(_d,_e,_c,_g,_h,_i,_j),this.addVertex(_a,_e,_c,_g,_h,_i,_j),this.addVertex(_d,_b,_c,_g,_h,_i,_j),this.addVertex(_a,_b,_c,_g,_h,_i,_j),this._tempUint1=this._tempUint0+1,this._tempUint2=this._tempUint0+2,this._tempUint3=this._tempUint0+3,this._tempUint4=this._tempUint0+4,this._tempUint5=this._tempUint0+5,this._tempUint6=this._tempUint0+6,this._tempUint7=this._tempUint0+7,this.addIndexes(this._tempUint0,this._tempUint1,this._tempUint1,this._tempUint3,this._tempUint3,this._tempUint2,this._tempUint2,this._tempUint0,this._tempUint4,this._tempUint5,this._tempUint5,this._tempUint7,this._tempUint7,this._tempUint6,this._tempUint6,this._tempUint4,this._tempUint5,this._tempUint0,this._tempUint0,this._tempUint2,this._tempUint2,this._tempUint7,this._tempUint7,this._tempUint5,this._tempUint1,this._tempUint4,this._tempUint4,this._tempUint6,this._tempUint6,this._tempUint3,this._tempUint3,this._tempUint1,this._tempUint5,this._tempUint4,this._tempUint4,this._tempUint1,this._tempUint1,this._tempUint0,this._tempUint0,this._tempUint5,this._tempUint2,this._tempUint3,this._tempUint3,this._tempUint6,this._tempUint6,this._tempUint7,this._tempUint7,this._tempUint2),this},_b.addVertex=function(_a,_b,_c,_d,_e,_f,_g){return this._hasBegun||this.addVertexIndexException(),this._vbData[this._posInVBData]=_a,this._vbData[this._posInVBData+1]=_b,this._vbData[this._posInVBData+2]=_c,this._vbData[this._posInVBData+3]=_d,this._vbData[this._posInVBData+4]=_e,this._vbData[this._posInVBData+5]=_f,this._vbData[this._posInVBData+6]=_g,this._posInVBData+=this._floatSizePerVer,this},_b.addVertexIndex=function(_a,_b,_c,_d,_e,_f,_g,_h){return this._hasBegun||this.addVertexIndexException(),this._vbData[_h]=_a,this._vbData[_h+1]=_b,this._vbData[_h+2]=_c,this._vbData[_h+3]=_d,this._vbData[_h+4]=_e,this._vbData[_h+5]=_f,this._vbData[_h+6]=_g,(_h+=this._floatSizePerVer)>this._posInVBData&&(this._posInVBData=_h),this},_b.addIndexes=function(_a){var _b=arguments;this._hasBegun||this.addVertexIndexException();for(var _c=0;_c<_b.length;_c++)this._ibData[this._posInIBData]=_b[_c],this._posInIBData++;return this},_b.begin=function(_a,_b){return this._hasBegun&&this.beginException0(),1!==_a&&4!==_a&&this.beginException1(),this._primitiveType=_a,this._camera=_b,this._hasBegun=!0,this},_b.end=function(){return this._hasBegun||this.endException(),this.flush(),this._hasBegun=!1,this},_b.flush=function(){0!==this._posInVBData&&(this._ib.setData(this._ibData),this._vb.setData(this._vbData),this._vb._bind(),this._ib._bind(),this._shader=this._shaderCompile.withCompile(0,0,0),this._shader.bind(),this._shader.uploadAttributes(_a._vertexDeclaration.shaderValues.data,null),this._spriteShaderValue.setValue(1,this._camera.projectionViewMatrix.elements),this._shader.uploadSpriteUniforms(this._spriteShaderValue.data),_y.drawCall++,_D.mainContext.drawElements(this._primitiveType,this._posInIBData,5123,0),this._posInIBData=0,this._posInVBData=0)},_b.addVertexIndexException=function(){throw new Error("请先调用begin()函数")},_b.beginException0=function(){throw new Error("调用begin()前请确保已成功调用end()！")},_b.beginException1=function(){throw new Error("只支持“LINES”和“TRIANGLES”两种基元！")},_b.endException=function(){throw new Error("调用end()前请确保已成功调用begin()！")},_b.drawLinesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“LINES”基元！")},_b.drawTrianglesException=function(){throw new Error("您必须确保在此之前已调用begin()且使用“TRIANGLES”基元！")},_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(28,[new _ga(0,"vector3",0),new _ga(12,"vector4",1)])}]),_a}()),_U=function(){function _a(){this._id=0,this._type=0,this._mainSortID=0,this._render=null,this._sprite3D=null,this._material=null,this._renderObj=null,this._staticBatch=null,this._tempBatchIndexStart=0,this._tempBatchIndexEnd=0,this._canDynamicBatch=!1,this._shaderValue=null,this._onPreRenderFunction=null,this._id=++_a._uniqueIDCounter,this._canDynamicBatch=!0,this._shaderValue=new _mb}_n(_a,"laya.d3.core.render.RenderElement");var _b=_a.prototype;return _b.getDynamicBatchBakedVertexs=function(_a){for(var _b=this._renderObj._getVertexBuffer(_a),_c=_b.getData().slice(),_d=_b.vertexDeclaration,_e=_d.getVertexElementByUsage(0).offset/4,_f=_d.getVertexElementByUsage(3).offset/4,_g=this._sprite3D.transform,_h=_g.worldMatrix,_i=_g.rotation,_j=_d.vertexStride/4,_k=0,_l=_c.length;_k<_l;_k+=_j){var _m=_k+_e,_n=_k+_f;_qb.transformVector3ArrayToVector3ArrayCoordinate(_c,_m,_h,_c,_m),_qb.transformVector3ArrayByQuat(_c,_n,_i,_c,_n)}return _c},_b.getBakedIndices=function(){return this._renderObj._getIndexBuffer().getData()},_b._destroy=function(){this._staticBatch&&this._staticBatch._manager._garbageCollection(this)},_o(0,_b,"id",function(){return this._id}),_o(0,_b,"renderObj",function(){return this._renderObj},function(_a){this._renderObj!==_a&&(this._renderObj=_a)}),_a._uniqueIDCounter=0,_a}(),_V=function(){function _b(_a){this._id=0,this._needSort=!1,this._renderElements=null,this._renderableRenderObjects=null,this._dynamicBatchCombineRenderElements=null,this._finalElements=null,this._scene=null,this._id=++_b._uniqueIDCounter,this._needSort=!1,this._scene=_a,this._renderElements=[],this._renderableRenderObjects=[],this._dynamicBatchCombineRenderElements=[],this._errorRecord={}}_n(_b,"laya.d3.core.render.RenderQueue");var _a=_b.prototype;return _a._sortOpaqueFunc=function(_a,_b){if(_a._render&&_b._render){var _c=_a._material.renderQueue-_b._material.renderQueue;return 0==_c?_a._render._distanceForSort-_b._render._distanceForSort:_c}return 0},_a._sortAlphaFunc=function(_a,_b){if(_a._render&&_b._render){var _c=_a._material.renderQueue-_b._material.renderQueue;return 0==_c?_b._render._distanceForSort-_a._render._distanceForSort:_c}return 0},_a._begainRenderElement=function(_a,_b,_c){return!!_b._beforeRender(_a)},_a._sortAlpha=function(_a){_b._cameraPosition=_a,this._finalElements.sort(this._sortAlphaFunc)},_a._sortOpaque=function(_a){_b._cameraPosition=_a,this._finalElements.sort(this._sortOpaqueFunc)},_a._preRender=function(_a){this._finalElements=this._renderElements.concat(this._dynamicBatchCombineRenderElements)},_a._render=function(_a,_b){for(var _c,_d,_e,_f,_g,_h,_i=_y.loopCount,_j=this._scene,_k=_a.camera,_l=(_k.id,!1),_m=0,_n=this._finalElements.length;_m<_n;_m++){var _o,_p,_q,_r=this._finalElements[_m];if(null!=_r._onPreRenderFunction&&_r._onPreRenderFunction.call(_r._sprite3D,_a),0===_r._type){if(_a.owner=_q=_r._sprite3D,_a.renderElement=_r,_q._preRenderUpdateComponents(_a),_o=_r.renderObj,_p=_r._material,this._begainRenderElement(_a,_o,_p)){if(_c=_o._getVertexBuffers(),!(_e=(_d=_o._getVertexBuffer(0)).vertexDeclaration)){if(!this._errorRecord[_d.id]){this._errorRecord[_d.id]=1;var _s="vertexBuffer:"+("("+_d._destroyed+","+_d._released+","+_d._referenceCount+","+_d._buffer+")")+", material:"+(_p?_p.__className+"("+_p._destroyed+","+_p._released+")":"null")+", owner:"+(_q?_q.__className+"("+_q._destroyed+","+_q._activeInHierarchy+","+_q._displayedInStage+")":"null")+", renderObj:"+(_o?_o.__className+"("+_o._destroyed+","+_o._released+","+_o._referenceCount+")":"")+", parent:, url:"+(_q?_q.url:"")+", disposeStack:"+_d.disposeStack;_v.recordError("报错：unknown vertexDeclaration  "+_s)}continue}if(_l=(_f=_a._shader=_p._getShader(_j._shaderDefineValue,_e.shaderDefineValue,_q._shaderDefineValue)).bind()||_i!==_f._uploadLoopCount,_c){if(_f._uploadVertexBuffer!==_c||_l){for(var _t=0;_t<_c.length;_t++){var _u=_c[_t];_f.uploadAttributesX(_u.vertexDeclaration.shaderValues.data,_u)}_f._uploadVertexBuffer=_c}}else(_f._uploadVertexBuffer!==_d||_l)&&(_f.uploadAttributes(_e.shaderValues.data,null),_f._uploadVertexBuffer=_d);(_f._uploadScene!==_j||_l)&&(_f.uploadSceneUniforms(_j._shaderValues.data),_f._uploadScene=_j),(_k!==_f._uploadCamera||_f._uploadSprite3D!==_q||_l)&&(_f.uploadSpriteUniforms(_q._shaderValues.data),_f._uploadSprite3D=_q),(_k!==_f._uploadCamera||_l)&&(_f.uploadCameraUniforms(_k._shaderValues.data),_f._uploadCamera=_k),(_f._uploadMaterial!==_p||_l)&&(_p._upload(),_f._uploadMaterial=_p),_g!==_p?(_p._setRenderStateBlendDepth(),_p._setRenderStateFrontFace(_b,_q.transform),_g=_p,_h=_q):_h!==_q&&(_p._setRenderStateFrontFace(_b,_q.transform),_h=_q),_o._render(_a),_f._uploadLoopCount=_i}_q._postRenderUpdateComponents(_a)}else if(2===_r._type){_r.renderObj;_a.owner=_q=_r._sprite3D,_a.renderElement=_r,_a._batchIndexStart=_r._tempBatchIndexStart,_a._batchIndexEnd=_r._tempBatchIndexEnd,_o=_r.renderObj,_p=_r._material,this._begainRenderElement(_a,_o,_p)&&(_e=(_d=_o._getVertexBuffer(0)).vertexDeclaration,_l=(_f=_a._shader=_p._getShader(_j._shaderDefineValue,_e.shaderDefineValue,_q._shaderDefineValue)).bind()||_i!==_f._uploadLoopCount,(_f._uploadVertexBuffer!==_d||_l)&&(_f.uploadAttributes(_e.shaderValues.data,null),_f._uploadVertexBuffer=_d),(_f._uploadScene!==_j||_l)&&(_f.uploadSceneUniforms(_j._shaderValues.data),_f._uploadScene=_j),(_k!==_f._uploadCamera||_f._uploadSprite3D!==_q||_l)&&(_f.uploadSpriteUniforms(_q._shaderValues.data),_f._uploadSprite3D=_q),(_k!==_f._uploadCamera||_l)&&(_f.uploadCameraUniforms(_k._shaderValues.data),_f._uploadCamera=_k),(_f._uploadMaterial!==_p||_l)&&(_p._upload(),_f._uploadMaterial=_p),_g!==_p?(_p._setRenderStateBlendDepth(),_p._setRenderStateFrontFace(_b,_q.transform),_g=_p,_h=_q):_h!==_q&&(_p._setRenderStateFrontFace(_b,_q.transform),_h=_q),_o._render(_a),_f._uploadLoopCount=_i)}}},_a._renderShadow=function(_a,_b){for(var _c,_d,_e,_f,_g,_h=_y.loopCount,_i=this._scene,_j=_a.camera,_k=!1,_l=0,_m=this._finalElements.length;_l<_m;_l++){var _n,_o,_p,_q=this._finalElements[_l];0===_q._type&&(_a.owner=_p=_q._sprite3D,_b||_p._projectionViewWorldUpdateCamera===_j&&_p._projectionViewWorldUpdateLoopCount===_y.loopCount||(_p._render._renderUpdate(_a._projectionViewMatrix),_p._projectionViewWorldUpdateLoopCount=_y.loopCount,_p._projectionViewWorldUpdateCamera=_j),_a.renderElement=_q,_p._preRenderUpdateComponents(_a),_n=_q.renderObj,_o=_q._material,this._begainRenderElement(_a,_n,null)&&(_d=(_c=_n._getVertexBuffer(0)).vertexDeclaration,_k=(_e=_a._shader=_o._getShader(_i._shaderDefineValue,_d.shaderDefineValue,_p._shaderDefineValue)).bind()||_h!==_e._uploadLoopCount,(_e._uploadVertexBuffer!==_c||_k)&&(_e.uploadAttributes(_d.shaderValues.data,null),_e._uploadVertexBuffer=_c),(_j!==_e._uploadCamera||_e._uploadSprite3D!==_p||_k)&&(_e.uploadSpriteUniforms(_p._shaderValues.data),_e._uploadSprite3D=_p),(_j!==_e._uploadCamera||_k)&&(_e.uploadCameraUniforms(_j._shaderValues.data),_e._uploadCamera=_j),(_e._uploadMaterial!==_o||_k)&&(_o._upload(),_e._uploadMaterial=_o),_e._uploadRenderElement,_f!==_o?(_o._setRenderStateFrontFace(!1,_p.transform),_f=_o,_g=_p):_g!==_p&&(_o._setRenderStateFrontFace(!1,_p.transform),_g=_p),_n._render(_a),_e._uploadLoopCount=_h),_p._postRenderUpdateComponents(_a))}},_a._clearRenderElements=function(){this._dynamicBatchCombineRenderElements.length=0,this._renderElements.length=0,this._needSort=!0},_a._addRenderElement=function(_a){this._renderElements.push(_a),this._needSort=!0},_a._addDynamicBatchElement=function(_a){this._dynamicBatchCombineRenderElements.push(_a)},_o(0,_a,"id",function(){return this._id}),_b._uniqueIDCounter=0,_b._cameraPosition=null,_b}(),_W=function(){function _a(){this._staticBatch=null,this._batchIndexStart=0,this._batchIndexEnd=0,this._viewMatrix=null,this._projectionMatrix=null,this._projectionViewMatrix=null,this._viewport=null,this._shader=null,this.elapsedTime=NaN,this.scene=null,this.owner=null,this.renderElement=null,this.camera=null}return _n(_a,"laya.d3.core.render.RenderState"),_a.clientWidth=0,_a.clientHeight=0,_a}(),_X=function(){function _g(_a,_b){this._exactBox=null,this._relaxBox=null,this._scene=null,this._parent=null,this._currentDepth=0,this._boundingSphere=new _Za(new _gb,0),this._corners=[new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb],this._boundingBoxCenter=new _gb,this._children=_d(8),this._objects=[],this._tempBoundBoxCorners=[new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb],this._scene=_a,this._currentDepth=_b}_n(_g,"laya.d3.core.scene.OctreeNode");var _a=_g.prototype;return _v.imps(_a,{"laya.d3.core.scene.ITreeNode":!0}),_a.init=function(_a,_b){var _c=new _gb,_d=new _gb;_gb.scale(_b,-.5,_c),_gb.scale(_b,.5,_d),_gb.add(_c,_a,_c),_gb.add(_d,_a,_d),this.exactBox=new _Xa(_c,_d),this.relaxBox=new _Xa(_c,_d)},_a.addTreeNode=function(_a){1===Collision.boxContainsBox(this._relaxBox,_a.boundingBox)?this.addNodeDown(_a,0):this.addObject(_a)},_a.addChild=function(_a){var _b=this._children[_a];if(null==_b){_b=new _g(this._scene,this._currentDepth+1),(this._children[_a]=_b)._parent=this,_gb.subtract(this._exactBox.max,this._exactBox.min,_g.tempSize),_gb.multiply(_g.tempSize,_g._octreeSplit[_a],_g.tempCenter),_gb.add(this._exactBox.min,_g.tempCenter,_g.tempCenter),_gb.scale(_g.tempSize,.25,_g.tempSize);var _c=new _gb,_d=new _gb;_gb.subtract(_g.tempCenter,_g.tempSize,_c),_gb.add(_g.tempCenter,_g.tempSize,_d),_b.exactBox=new _Xa(_c,_d),_gb.scale(_g.tempSize,_g.relax,_g.tempSize);var _e=new _gb,_f=new _gb;_gb.subtract(_g.tempCenter,_g.tempSize,_e),_gb.add(_g.tempCenter,_g.tempSize,_f),_b.relaxBox=new _Xa(_e,_f)}return _b},_a.addObject=function(_a){(_a._treeNode=this)._objects.push(_a)},_a.removeObject=function(_a){if(_a._treeNode!=this)return console.log("OctreeNode::removeObject error"),!1;var _b=this._objects.indexOf(_a);return-1!==_b&&(this._objects.splice(_b,1),!0)},_a.clearObject=function(){this._objects.length=0},_a.addNodeUp=function(_a,_b){this._parent&&1!==Collision.boxContainsBox(this._exactBox,_a.boundingBox)?this._parent.addNodeUp(_a,_b-1):this.addNodeDown(_a,_b)},_a.addNodeDown=function(_a,_b){if(_b<this._scene.treeLevel){var _c=this.inChildIndex(_a.boundingBoxCenter),_d=this.addChild(_c);1===Collision.boxContainsBox(_d._relaxBox,_a.boundingBox)?_d.addNodeDown(_a,++_b):this.addObject(_a)}else this.addObject(_a)},_a.inChildIndex=function(_a){return 4*(_a.z<this._boundingBoxCenter.z?0:1)+2*(_a.y<this._boundingBoxCenter.y?0:1)+(_a.x<this._boundingBoxCenter.x?0:1)},_a.updateObject=function(_a){1===Collision.boxContainsBox(this._relaxBox,_a.boundingBox)?(this.removeObject(_a),_a._treeNode=null,this.addNodeDown(_a,this._currentDepth)):this._parent&&(this.removeObject(_a),_a._treeNode=null,this._parent.addNodeUp(_a,this._currentDepth-1))},_a.cullingObjects=function(_a,_b,_c,_d,_e){var _f,_g=0,_h=0,_i=0,_j=this._scene._dynamicBatchManager;for(_g=0,_f=this._objects.length;_g<_f;_g++){var _k=this._objects[_g];if(_G.isVisible(_k._owner.layer.mask)&&_k.enable){if(_b&&(_y.treeSpriteCollision+=1,0===_a.containsBoundSphere(_k.boundingSphere)))continue;_k._renderUpdate(_e),_k._distanceForSort=_gb.distance(_k.boundingSphere.center,_d)+_k.sortingFudge;var _l=_k._renderElements;for(_h=0,_i=_l.length;_h<_i;_h++){var _m=_l[_h],_n=_m._staticBatch;if(_n&&_n._material===_m._material)_n._addBatchRenderElement(_m);else{var _o=_m.renderObj;_o.triangleCount<10&&1===_o._vertexBufferCount&&_o._getIndexBuffer()&&_m._material.renderQueue<2&&_m._canDynamicBatch&&!_k._owner.isStatic?_j._addPrepareRenderElement(_m):this._scene.getRenderQueue(_m._material.renderQueue)._addRenderElement(_m)}}}}for(_g=0;_g<8;_g++){var _p=this._children[_g];if(null!=_p){var _q=_b;if(_b){var _r=_a.containsBoundBox(_p._relaxBox);if(_y.treeNodeCollision+=1,0===_r)continue;_q=2===_r}_p.cullingObjects(_a,_q,_c,_d,_e)}}},_a.cullingShadowObjects=function(_a,_b,_c,_d,_e){var _f,_g=0,_h=0,_i=0;this._scene._dynamicBatchManager;for(_g=0,_f=this._objects.length;_g<_f;_g++){var _j=this._objects[_g];if(_j.castShadow&&_G.isVisible(_j._owner.layer.mask)&&_j.enable){if(_c&&0===_a[0].containsBoundSphere(_j.boundingSphere))continue;for(var _k=1,_l=_a.length;_k<_l;_k++){var _m=_b[_k-1];if(0!==_a[_k].containsBoundSphere(_j.boundingSphere)){var _n=_j._renderElements;for(_h=0,_i=_n.length;_h<_i;_h++)_m._addRenderElement(_n[_h])}}}}for(_g=0;_g<8;_g++){var _o=this._children[_g];if(null!=_o){var _p=_c;if(_c){var _q=_a[0].containsBoundBox(_o._relaxBox);if(0===_q)continue;_p=2===_q}_o.cullingShadowObjects(_a,_b,_p,_d,_e)}}},_a.cullingShadowObjectsOnePSSM=function(_a,_b,_c,_d,_e,_f){var _g,_h=_b[0],_i=0,_j=0,_k=0;for(_i=0,_g=this._objects.length;_i<_g;_i++){var _l=this._objects[_i];if(_l.castShadow&&_G.isVisible(_l._owner.layer.mask)&&_l.enable){if(_d&&0===_a.containsBoundSphere(_l.boundingSphere))continue;_l._renderUpdate(_c);var _m=_l._renderElements;for(_j=0,_k=_m.length;_j<_k;_j++)_h._addRenderElement(_m[_j])}}for(_i=0;_i<8;_i++){var _n=this._children[_i];if(null!=_n){var _o=_d;if(_d){var _p=_a.containsBoundBox(_n._relaxBox);if(0===_p)continue;_o=2===_p}_n.cullingShadowObjectsOnePSSM(_a,_b,_c,_o,_e,_f)}}},_a.renderBoudingBox=function(_a){this._renderBoudingBox(_a);for(var _b=0;_b<8;++_b){var _c=this._children[_b];_c&&_c.renderBoudingBox(_a)}},_a.buildAllChild=function(_a){if(_a<this._scene.treeLevel)for(var _b=0;_b<8;_b++){this.addChild(_b).buildAllChild(_a+1)}},_a._renderBoudingBox=function(_a){},_o(0,_a,"exactBox",function(){return this._exactBox},function(_a){this._exactBox=_a,_gb.add(_a.min,_a.max,this._boundingBoxCenter),_gb.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter)}),_o(0,_a,"relaxBox",function(){return this._relaxBox},function(_a){(this._relaxBox=_a).getCorners(this._corners),_Za.createfromPoints(this._corners,this._boundingSphere)}),_g.debugMode=!1,_g.relax=1.15,_g.CHILDNUM=8,_l(_g,["tempVector0",function(){return this.tempVector0=new _gb},"tempSize",function(){return this.tempSize=new _gb},"tempCenter",function(){return this.tempCenter=new _gb},"_octreeSplit",function(){return this._octreeSplit=[new _gb(.25,.25,.25),new _gb(.75,.25,.25),new _gb(.25,.75,.25),new _gb(.75,.75,.25),new _gb(.25,.25,.75),new _gb(.75,.25,.75),new _gb(.25,.75,.75),new _gb(.75,.75,.75)]}]),_g}(),_Y=(function(){function _a(){}_n(_a,"laya.d3.core.scene.SceneManager")}(),function(){function _a(_a,_b,_c,_d){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,void 0===_a&&(_a=1),void 0===_b&&(_b=1),void 0===_c&&(_c=1),void 0===_d&&(_d=1),this._r=_a,this._g=_b,this._b=_c,this._a=_d}return _n(_a,"laya.d3.core.trail.module.Color",null,"Color$1"),_a.prototype.cloneTo=function(_a){_a._r=this._r,_a._g=this._g,_a._b=this._b,_a._a=this._a},_l(_a,["RED",function(){return this.RED=new _a(1,0,0,1)},"GREEN",function(){return this.GREEN=new _a(0,1,0,1)},"BLUE",function(){return this.BLUE=new _a(0,0,1,1)},"CYAN",function(){return this.CYAN=new _a(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new _a(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new _a(1,0,1,1)},"GRAY",function(){return this.GRAY=new _a(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new _a(1,1,1,1)},"BLACK",function(){return this.BLACK=new _a(0,0,0,1)}]),_a}()),_Z=(function(){function _a(){this._mode=0,this._colorKeys=null,this._alphaKeys=null,this.index=0,this._colorKeyData=new Float32Array(40),this._alphaKeyData=new Float32Array(20),this._colorKeys=[],this._alphaKeys=[]}_n(_a,"laya.d3.core.trail.module.Gradient");var _b=_a.prototype;_b.setKeys=function(_a,_b){var _c,_d;this._colorKeys=_a;for(var _e=this.index=0;_e<_a.length;_e++){var _f=(_c=_a[_e]).color;this._colorKeyData[this.index++]=_f._r,this._colorKeyData[this.index++]=_f._g,this._colorKeyData[this.index++]=_f._b,this._colorKeyData[this.index++]=_c.time}this._alphaKeys=_b;for(var _g=this.index=0;_g<_b.length;_g++)_d=_b[_g],this._alphaKeyData[this.index++]=_d.alpha,this._alphaKeyData[this.index++]=_d.time},_b.cloneTo=function(_a){var _b=0,_c=0,_d=this.colorKeys,_e=[];for(_b=0,_c=_d.length;_b<_c;_b++){var _f=new _$;_d[_b].cloneTo(_f),_e.push(_f)}var _g=this.alphaKeys,_h=[];for(_b=0,_c=_g.length;_b<_c;_b++){var _i=new _Z;_g[_b].cloneTo(_i),_h.push(_i)}_a.setKeys(_e,_h)},_o(0,_b,"mode",function(){return this._mode},function(_a){this._mode=_a}),_o(0,_b,"colorKeys",function(){return this._colorKeys},function(_a){this._colorKeys=_a;for(var _b=this.index=0;_b<_a.length;_b++){var _c=_a[_b],_d=_c.color;this._colorKeyData[this.index++]=_d._r,this._colorKeyData[this.index++]=_d._g,this._colorKeyData[this.index++]=_d._b,this._colorKeyData[this.index++]=_c.time}}),_o(0,_b,"alphaKeys",function(){return this._alphaKeys},function(_a){this._alphaKeys=_a;for(var _b=this.index=0;_b<_a.length;_b++){var _c=_a[_b];this._alphaKeyData[this.index++]=_c.alpha,this._alphaKeyData[this.index++]=_c.time}})}(),function(){function _a(_a,_b){this._alpha=NaN,this._time=NaN,void 0===_a&&(_a=0),void 0===_b&&(_b=0),this._alpha=_a,this._time=_b}_n(_a,"laya.d3.core.trail.module.GradientAlphaKey");var _b=_a.prototype;return _b.cloneTo=function(_a){_a.alpha=this.alpha,_a.time=this.time},_o(0,_b,"alpha",function(){return this._alpha},function(_a){this._alpha=_a}),_o(0,_b,"time",function(){return this._time},function(_a){this._time=_a}),_a}()),_$=function(){function _a(_a,_b){this._color=null,this._time=NaN,void 0===_b&&(_b=0),this._color=_a||new _Y,this._time=_b}_n(_a,"laya.d3.core.trail.module.GradientColorKey");var _b=_a.prototype;return _b.cloneTo=function(_a){this.color.cloneTo(_a.color),_a.time=this.time},_o(0,_b,"color",function(){return this._color},function(_a){this._color=_a}),_o(0,_b,"time",function(){return this._time},function(_a){this._time=_a}),_a}(),__=(function(){function _a(){}_n(_a,"laya.d3.core.trail.module.GradientMode"),_a.Blend=0,_a.Fixed=1}(),function(){function _a(){}_n(_a,"laya.d3.core.trail.module.TextureMode"),_a.Stretch=0,_a.Tile=1}(),function(){function _a(){this.time=NaN,this.inTangent=NaN,this.outTangent=NaN,this.value=NaN}_n(_a,"laya.d3.core.trail.module.TrailKeyFrame"),_a.prototype.cloneTo=function(_a){_a.time=this.time,_a.inTangent=this.inTangent,_a.outTangent=this.outTangent,_a.value=this.value}}(),function(){function _b(_a){this._id=0,this._owner=null,this._camera=null,this._vertexBuffers=null,this._verticesCount=0,this._virtualVerticesCount=0,this._maxVerticesCount=256,this._vertices1=null,this._vertexBuffer1=null,this._floatCountPerVertices1=8,this._verticesIndex1=0,this._everyAddVerticeCount1=0,this._delLength=0,this._vertices2=null,this._vertexBuffer2=null,this._floatCountPerVertices2=1,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._pointe=null,this._pointAtoBVector3e=null,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._curtime=NaN,this._curDisappearIndex=0,this._lastPosition=new _gb,this._curPosition=new _gb,this._delVector3=new _gb,this._lastFixedVertexPosition=new _gb,this._pointAtoBVector3=new _gb,this._pointA=new _gb,this._pointB=new _gb,this._owner=_a,this._id=_b.renderElementCount++,0==this._id?_a._owner.transform.position.cloneTo(this._lastPosition):_a._curSubTrailFinishPosition.cloneTo(this._lastPosition),this._everyGroupVertexBirthTime=[],this._VerticesToTailLength=new Float32Array(this._maxVerticesCount),this._everyVertexToPreVertexDistance=new Float32Array(this._maxVerticesCount),this._vertices1=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices1),this._vertices2=new Float32Array(this._maxVerticesCount*this._floatCountPerVertices2),this._vertexBuffer1=new _Mb(__.vertexDeclaration1,this._maxVerticesCount,35044,!0),this._vertexBuffer2=new _Mb(__.vertexDeclaration2,this._maxVerticesCount,35044,!0),this._vertexBuffers=[],this._vertexBuffers.push(this._vertexBuffer1),this._vertexBuffers.push(this._vertexBuffer2)}_n(_b,"laya.d3.core.trail.TrailRenderElement");var _a=_b.prototype;_v.imps(_a,{"laya.d3.core.render.IRenderable":!0}),_a._updateTrail=function(){this._everyAddVerticeCount1=0,this._isStart||this._addTrailByFirstPosition(this._lastPosition,this._curPosition),this._addTrailByNextPosition(this._curPosition),this._vertexBuffer1.setData(this._vertices1,this._verticesIndex1,this._verticesIndex1,this._everyAddVerticeCount1),this._verticesIndex1+=this._everyAddVerticeCount1,this._curPosition.cloneTo(this._lastPosition),2==this._virtualVerticesCount&&(this._verticesIndex1-=2*this._floatCountPerVertices1)},_a._addTrailByFirstPosition=function(_a,_b){_gb.subtract(_b,_a,this._delVector3),_gb.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),_gb.normalize(this._pointAtoBVector3,this._pointAtoBVector3),_gb.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._updateVerticesByPosition(_a),_a.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._curtime=this._owner._hasLifeSubTrail?this._owner._curSubTrailFinishCurTime:this._owner._curtime,this._everyGroupVertexBirthTime.push(this._curtime),this._isStart=!0,this._owner._hasLifeSubTrail=!0},_a._addTrailByNextPosition=function(_a){_gb.subtract(_a,this._lastFixedVertexPosition,this._delVector3),_gb.cross(this._delVector3,this._camera.forward,this._pointAtoBVector3),_gb.normalize(this._pointAtoBVector3,this._pointAtoBVector3),_gb.scale(this._pointAtoBVector3,this._owner.widthMultiplier/2,this._pointAtoBVector3),this._delLength=_gb.scalarLength(this._delVector3),this._delLength-this._owner.minVertexDistance>=_$a.zeroTolerance?(this._owner._trailTotalLength+=this._delLength,this._owner._trailSupplementLength=0,this._updateVerticesByPosition(_a),_a.cloneTo(this._lastFixedVertexPosition),this._verticesCount+=2,this._virtualVerticesCount=0,this._everyGroupVertexBirthTime.push(this._owner._curtime),this._verticesCount==this._maxVerticesCount&&this._onTrailRenderElementFinish()):(this._owner._trailSupplementLength=this._delLength,this._updateVerticesByPosition(_a),this._virtualVerticesCount=2)},_a._updateVerticesByPosition=function(_a){this._pointe=_a.elements,this._pointAtoBVector3e=this._pointAtoBVector3.elements,this._curtime=this._owner._curtime,this._owner._hasLifeSubTrail&&0==this._isStart&&(this._pointe=this._owner._curSubTrailFinishPosition.elements,this._pointAtoBVector3e=this._owner._curSubTrailFinishDirection.elements,this._curtime=this._owner._curSubTrailFinishCurTime),this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=-this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=1,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointe[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[0],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[1],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._pointAtoBVector3e[2],this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=this._curtime,this._vertices1[this._verticesIndex1+this._everyAddVerticeCount1++]=0,this._VerticesToTailLength[this._verticesCount/2]=this._owner._trailTotalLength+this._owner._trailSupplementLength,0==this._owner._trailSupplementLength?this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._delLength:this._everyVertexToPreVertexDistance[this._verticesCount/2]=this._isStart?this._owner._trailSupplementLength:0},_a._updateVertexBuffer2=function(){var _a,_b=0,_c=0,_d=0;for(_d=0,_a=(this._verticesCount+this._virtualVerticesCount)/2;_d<_a;_d++)_c=0==this._owner.textureMode?(this._VerticesToTailLength[_d]-this._owner._trailDeadLength)/(this._owner._trailTotalLength+this._owner._trailSupplementLength-this._owner._trailDeadLength):this._owner._trailTotalLength+this._owner._trailSupplementLength-this._VerticesToTailLength[_d],this._vertices2[_b++]=1-_c,this._vertices2[_b++]=1-_c;this._vertexBuffer2.setData(this._vertices2,0,0,this._verticesCount+this._virtualVerticesCount)},_a._onTrailRenderElementFinish=function(){this._lastFixedVertexPosition.cloneTo(this._owner._curSubTrailFinishPosition),this._pointAtoBVector3.cloneTo(this._owner._curSubTrailFinishDirection),this._owner._curSubTrailFinishCurTime=this._owner._curtime,this._isFinish=!0},_a._updateDisappear=function(){var _a,_b=0;for(_b=this._curDisappearIndex,_a=(this._verticesCount+this._virtualVerticesCount)/2;_b<_a;_b++)this._owner._curtime-this._everyGroupVertexBirthTime[_b]>=this._owner.time+_$a.zeroTolerance&&(this._curDisappearIndex++,this._owner._trailDeadLength+=this._everyVertexToPreVertexDistance[this._curDisappearIndex],this._curDisappearIndex>=(this._verticesCount+this._virtualVerticesCount)/2&&(this._isDead=!0))},_a._beforeRender=function(_a){return this._camera=_a.camera,null!=this._camera&&(this._owner._owner.transform.position.cloneTo(this._curPosition),!this._isDead&&(this._verticesCount<this._maxVerticesCount?(this._owner._isStart||(this._owner._owner.transform.position.cloneTo(this._lastPosition),this._owner._isStart=!0),_gb.equals(this._lastPosition,this._curPosition)||this._updateTrail()):this._isFinish&&(this._isFinish=!1,this._owner._curSubTrailFinished=!0),0<this._verticesCount)&&(this._updateVertexBuffer2(),this._updateDisappear(),!0))},_a._render=function(_a){this._isDead||(_D.mainContext.drawArrays(5,2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),console.log(2*this._curDisappearIndex,this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex),_y.drawCall++,_y.trianglesFaces+=this._verticesCount+this._virtualVerticesCount-2*this._curDisappearIndex-2)},_a._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),0===_a?this._vertexBuffer1:1===_a?this._vertexBuffer2:null},_a._getVertexBuffers=function(){return this._vertexBuffers},_a._getIndexBuffer=function(){return null},_a.reActivate=function(){this._id=laya.d3.core.trail.TrailRenderElement.renderElementCount++,this._isStart=!1,this._isFinish=!1,this._isDead=!1,this._verticesCount=0,this._virtualVerticesCount=0,this._verticesIndex1=0,this._delLength=0,this._curDisappearIndex=0,this._everyGroupVertexBirthTime=[],this._owner._curSubTrailFinishPosition.cloneTo(this._lastPosition)},_a._destroy=function(){this._vertexBuffer1.dispose(),this._vertexBuffer2.dispose(),this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._vertexBuffers=null,this._everyGroupVertexBirthTime=null,this._VerticesToTailLength=null,this._everyVertexToPreVertexDistance=null,this._lastPosition=null,this._curPosition=null,this._delVector3=null,this._lastFixedVertexPosition=null,this._pointAtoBVector3=null,this._pointe=null,this._pointAtoBVector3e=null,this._pointA=null,this._pointB=null},_o(0,_a,"_vertexBufferCount",function(){return this._vertexBuffers.length}),_o(0,_a,"triangleCount",function(){return 0}),_b.renderElementCount=0}(),function(){function _a(){}_n(_a,"laya.d3.core.trail.VertexTrail");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration1}),_o(1,_a,"vertexDeclaration1",function(){return _a._vertexDeclaration1}),_o(1,_a,"vertexDeclaration2",function(){return _a._vertexDeclaration2}),_l(_a,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new _fa(32,[new _ga(0,"vector3",0),new _ga(12,"vector3",41),new _ga(24,"single",33),new _ga(28,"single",40)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new _fa(4,[new _ga(0,"single",38)])}]),_a}()),_aa=function(){function _u(_a){this._vertexDeclaration=null,this._vertexDatas=null,this._indexDatas=null,this._vertexBuffer=null,this._indexBuffer=null,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=null,this._materials=null,this._materialToRenderElementsOffsets=null,this._merageElements=null,this._combineRenderElementPool=null,this._combineRenderElementPoolIndex=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._combineRenderElements=[],this._materialToRenderElementsOffsets=[],this._materials=[],this._merageElements=[],this._combineRenderElementPool=[],this._combineRenderElementPoolIndex=0,this._vertexDeclaration=_a}_n(_u,"laya.d3.graphics.DynamicBatch");var _a=_u.prototype;return _v.imps(_a,{"laya.d3.core.render.IRenderable":!0}),_a._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),0===_a?this._vertexBuffer:null},_a._getIndexBuffer=function(){return this._indexBuffer},_a._getCombineRenderElementFromPool=function(_a,_b,_c){var _d=this._combineRenderElementPool[this._combineRenderElementPoolIndex++];return _d||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=_d=new _U,_d._sprite3D=new _Vb),_d._sprite3D._render._renderUpdate(_c),_d},_a._getRenderElement=function(_a,_b,_c){this._vertexDatas||(this._vertexDatas=new Float32Array(this._vertexDeclaration.vertexStride/4*_u.maxVertexCount),this._indexDatas=new Uint16Array(_u.maxIndexCount),this._vertexBuffer=_Mb.create(this._vertexDeclaration,_u.maxVertexCount,35048),this._indexBuffer=_Lb.create("ushort",_u.maxIndexCount,35048));for(var _d=this._merageElements.length=0,_e=0,_f=0,_g=this._combineRenderElements.length;_f<_g;_f++){var _h=this._combineRenderElements[_f],_i=_h.getDynamicBatchBakedVertexs(0),_j=_h.getBakedIndices(),_k=_h._sprite3D.transform._isFrontFaceInvert,_l=_d/(this._vertexDeclaration.vertexStride/4),_m=_e,_n=_m+_j.length;_h._tempBatchIndexStart=_m,_h._tempBatchIndexEnd=_n,this._indexDatas.set(_j,_e);var _o=0;if(_k)for(_o=_m;_o<_n;_o+=3){this._indexDatas[_o]=_l+this._indexDatas[_o];var _p=this._indexDatas[_o+1],_q=this._indexDatas[_o+2];this._indexDatas[_o+1]=_l+_q,this._indexDatas[_o+2]=_l+_p}else for(_o=_m;_o<_n;_o+=3)this._indexDatas[_o]=_l+this._indexDatas[_o],this._indexDatas[_o+1]=_l+this._indexDatas[_o+1],this._indexDatas[_o+2]=_l+this._indexDatas[_o+2];_e+=_j.length,this._vertexDatas.set(_i,_d),_d+=_i.length}for(this._vertexBuffer.setData(this._vertexDatas),this._indexBuffer.setData(this._indexDatas),_f=this._combineRenderElementPoolIndex=0,_g=this._materials.length;_f<_g;_f++){var _r=this._getCombineRenderElementFromPool(_a,_b,_c);_r._type=2,_r._staticBatch=null;var _s=(_r.renderObj=this)._combineRenderElements[this._materialToRenderElementsOffsets[_f]]._tempBatchIndexStart,_t=_f+1===this._materialToRenderElementsOffsets.length?_e:this._combineRenderElements[this._materialToRenderElementsOffsets[_f+1]]._tempBatchIndexStart;_r._tempBatchIndexStart=_s,_r._tempBatchIndexEnd=_t,_r._material=this._materials[_f],this._merageElements.push(_r)}},_a._addCombineRenderObjTest=function(_a){var _b=_a.renderObj,_c=this._currentCombineIndexCount+_b._getIndexBuffer().indexCount,_d=this._currentCombineVertexCount+_b._getVertexBuffer().vertexCount;return!(_u.maxVertexCount<_d||_u.maxIndexCount<_c)},_a._addCombineRenderObj=function(_a){var _b=_a.renderObj;this._combineRenderElements.push(_a),this._currentCombineIndexCount=this._currentCombineIndexCount+_b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+_b._getVertexBuffer().vertexCount},_a._addCombineMaterial=function(_a){this._materials.push(_a)},_a._addMaterialToRenderElementOffset=function(_a){this._materialToRenderElementsOffsets.push(_a)},_a._clearRenderElements=function(){this._combineRenderElements.length=0,this._materials.length=0,this._materialToRenderElementsOffsets.length=0,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0},_a._addToRenderQueue=function(_a,_b,_c,_d){this._getRenderElement(_b,_c,_d);for(var _e=0,_f=this._materials.length;_e<_f;_e++)_a.getRenderQueue(this._materials[_e].renderQueue)._addDynamicBatchElement(this._merageElements[_e])},_a._beforeRender=function(_a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},_a._render=function(_a){var _b=_a._batchIndexEnd-_a._batchIndexStart;_D.mainContext.drawElements(4,_b,5123,2*_a._batchIndexStart),_y.drawCall++,_y.trianglesFaces+=_b/3},_a._getVertexBuffers=function(){return null},_o(0,_a,"_vertexBufferCount",function(){return 1}),_o(0,_a,"triangleCount",function(){return this._indexBuffer.indexCount/3}),_o(0,_a,"combineRenderElementsCount",function(){return this._combineRenderElements.length}),_u.maxVertexCount=2e4,_u.maxIndexCount=4e4,_u.maxCombineTriangleCount=10,_u}(),_ba=function(){function _u(){this._dynamicBatches=null,this._prepareDynamicBatchCombineElements=null,this._dynamicBatches={},this._prepareDynamicBatchCombineElements=[]}_n(_u,"laya.d3.graphics.DynamicBatchManager");var _a=_u.prototype;return _a.getDynamicBatch=function(_a,_b){var _c,_d=_a.id.toString()+_b;return this._dynamicBatches[_d]?_c=this._dynamicBatches[_d]:this._dynamicBatches[_d]=_c=new _aa(_a),_c},_a._garbageCollection=function(){for(var _a in this._dynamicBatches)0===this._dynamicBatches[_a].combineRenderElementsCount&&delete this._dynamicBatches[_a]},_a._addPrepareRenderElement=function(_a){this._prepareDynamicBatchCombineElements.push(_a)},_a._finishCombineDynamicBatch=function(_a){var _b,_c,_d;this._prepareDynamicBatchCombineElements.sort(_u._sortPrepareDynamicBatch);for(var _e,_f,_g,_h,_i,_j=-1,_k=!0,_l=0,_m=-1,_n=0,_o=this._prepareDynamicBatchCombineElements.length;_n<_o;_n++){var _p=(_f=this._prepareDynamicBatchCombineElements[_n]).renderObj._getVertexBuffer(0).vertexDeclaration,_q=_c!==_p;_q&&(_l=0,_c=_p);var _r=_l!==_j;if(_r&&(_j=_l),(_q||_r)&&(_g=this.getDynamicBatch(_p,_l),_b=null),_k)if(_g._addCombineRenderObjTest(_f)){if(_b!==(_e=_f._material))_h&&(_a.getRenderQueue(_i._material.renderQueue)._addRenderElement(_i),_i=_h=null,_m=-1),_h=_e,_m=_g.combineRenderElementsCount,_i=_f,_b=_e;else if(_h){var _s=_i.renderObj,_t=_f.renderObj;_s._getVertexBuffer().vertexCount+_t._getVertexBuffer().vertexCount>_aa.maxVertexCount||_s._getIndexBuffer().indexCount+_t._getIndexBuffer().indexCount>_aa.maxIndexCount?(_a.getRenderQueue(_i._material.renderQueue)._addRenderElement(_i),_h=_e,_m=_g.combineRenderElementsCount,_i=_f):(_g._addCombineMaterial(_h),_g._addMaterialToRenderElementOffset(_m),_g._addCombineRenderObj(_i),_i=_h=null,_m=-1,_g._addCombineRenderObj(_f))}else _g._addCombineRenderObj(_f);_k=!0}else _h&&(_a.getRenderQueue(_i._material.renderQueue)._addRenderElement(_i),_i=_h=null,_m=-1),_l++,_k=!1;else _d=this._prepareDynamicBatchCombineElements[_n-1],_g._addMaterialToRenderElementOffset(_g.combineRenderElementsCount),_b=_d._material,_g._addCombineMaterial(_b),_g._addCombineRenderObj(_d),_k=!0,_b!==(_e=_f._material)?(_h=_e,_m=_g.combineRenderElementsCount,_i=_f):_g._addCombineRenderObj(_f),_b=_e}_h&&(_a.getRenderQueue(_i._material.renderQueue)._addRenderElement(_i),_i=_h=null,_m=-1),this._prepareDynamicBatchCombineElements.length=0},_a._clearRenderElements=function(){for(var _a in this._dynamicBatches)this._dynamicBatches[_a]._clearRenderElements()},_a._addToRenderQueue=function(_a,_b,_c,_d){for(var _e in this._dynamicBatches){var _f=this._dynamicBatches[_e];0<_f.combineRenderElementsCount&&_f._addToRenderQueue(_a,_b,_c,_d)}},_a.dispose=function(){this._dynamicBatches=null},_u._sortPrepareDynamicBatch=function(_a,_b){return _a._mainSortID-_b._mainSortID},_u}(),_ca=function(){function _a(){}return _n(_a,"laya.d3.graphics.FrustumCulling"),_a.renderShadowObjectCulling=function(_a,_b,_c,_d,_e){var _f=0,_g=0,_h=0,_i=0;for(_f=0,_h=_c.length;_f<_h;_f++){var _j=_c[_f];_j&&_j._clearRenderElements()}var _k,_l,_m,_n=_a._cullingRenders;if(1<_e){for(_f=0,_h=_a._cullingRendersLength;_f<_h;_f++)if((_k=_n[_f]).castShadow&&_G.isVisible(_k._owner.layer.mask)&&_k.enable)for(var _o=1,_p=_b.length;_o<_p;_o++)if(_l=_c[_o-1],0!==_b[_o].containsBoundSphere(_k.boundingSphere))for(_g=0,_i=(_m=_k._renderElements).length;_g<_i;_g++)_l._addRenderElement(_m[_g])}else for(_f=0,_h=_a._cullingRendersLength;_f<_h;_f++)if((_k=_n[_f]).castShadow&&_G.isVisible(_k._owner.layer.mask)&&_k.enable&&0!==_b[0].containsBoundSphere(_k.boundingSphere))for(_k._renderUpdate(_d),_l=_c[0],_g=0,_i=(_m=_k._renderElements).length;_g<_i;_g++)_l._addRenderElement(_m[_g])},_a.renderShadowObjectCullingOctree=function(_a,_b,_c,_d,_e){for(var _f=0,_g=_c.length;_f<_g;_f++){var _h=_c[_f];_h&&_h._clearRenderElements()}1<_e?_a.treeRoot.cullingShadowObjects(_b,_c,!0,0,_a):_a.treeRoot.cullingShadowObjectsOnePSSM(_b[0],_c,_d,!0,0,_a)},_a.renderObjectCulling=function(_a,_b,_c,_d,_e,_f){var _g=0,_h=0,_i=0,_j=0,_k=_b._quenes,_l=_b._dynamicBatchManager,_m=_b._cullingRenders;for(_g=0,_h=_k.length;_g<_h;_g++){var _n=_k[_g];_n&&_n._clearRenderElements()}var _o=_da._staticBatchManagers;for(_g=0,_h=_o.length;_g<_h;_g++)_o[_g]._clearRenderElements();_l._clearRenderElements();var _p=_c.transform.position;for(_g=0,_h=_b._cullingRendersLength;_g<_h;_g++){var _q=_m[_g];if(_G.isVisible(_q._owner.layer.mask)&&_q.enable&&0!==_a.containsBoundSphere(_q.boundingSphere)&&_q._renderUpdate(_f)){_q._distanceForSort=_gb.distance(_q.boundingSphere.center,_p)+_q.sortingFudge;var _r=_q._renderElements;for(_i=0,_j=_r.length;_i<_j;_i++){var _s=_r[_i],_t=_s._staticBatch;if(_t&&_t._material===_s._material)_t._addBatchRenderElement(_s);else{var _u=_s.renderObj;_u.triangleCount<10&&1===_u._vertexBufferCount&&_u._getIndexBuffer()&&_s._material.renderQueue<2&&_s._canDynamicBatch&&!_q._owner.isStatic?_l._addPrepareRenderElement(_s):_b.getRenderQueue(_s._material.renderQueue)._addRenderElement(_s)}}}}for(_g=0,_h=_o.length;_g<_h;_g++)_o[_g]._addToRenderQueue(_b,_d,_e,_f);_l._finishCombineDynamicBatch(_b),_l._addToRenderQueue(_b,_d,_e,_f)},_a.renderObjectCullingOctree=function(_a,_b,_c,_d,_e,_f){var _g=0,_h=0,_i=_b._quenes,_j=_b._dynamicBatchManager;for(_g=0,_h=_i.length;_g<_h;_g++){var _k=_i[_g];_k&&_k._clearRenderElements()}var _l=_da._staticBatchManagers;for(_g=0,_h=_l.length;_g<_h;_g++)_l[_g]._clearRenderElements();for(_j._clearRenderElements(),_b._cullingRenders.length=0,_b.treeRoot.cullingObjects(_a,!0,0,_c.transform.position,_f),_g=0,_h=_l.length;_g<_h;_g++)_l[_g]._addToRenderQueue(_b,_d,_e,_f);_j._finishCombineDynamicBatch(_b),_j._addToRenderQueue(_b,_d,_e,_f)},_a.renderObjectCullingNoBoundFrustum=function(_a,_b,_c,_d,_e){var _f=0,_g=0,_h=0,_i=0,_j=_a._quenes,_k=_a._dynamicBatchManager,_l=_a._cullingRenders;for(_f=0,_g=_j.length;_f<_g;_f++){var _m=_j[_f];_m&&_m._clearRenderElements()}var _n=_da._staticBatchManagers;for(_f=0,_g=_n.length;_f<_g;_f++)_n[_f]._clearRenderElements();_k._clearRenderElements();var _o=_b.transform.position;for(_f=0,_g=_a._cullingRendersLength;_f<_g;_f++){var _p=_l[_f];if(_G.isVisible(_p._owner.layer.mask)&&_p.enable){_p._renderUpdate(_e),_p._distanceForSort=_gb.distance(_p.boundingSphere.center,_o)+_p.sortingFudge;var _q=_p._renderElements;for(_h=0,_i=_q.length;_h<_i;_h++){var _r=_q[_h],_s=_r._staticBatch;if(_s&&_s._material===_r._material)_s._addBatchRenderElement(_r);else{var _t=_r.renderObj;_t.triangleCount<10&&1===_t._vertexBufferCount&&_t._getIndexBuffer()&&_r._material.renderQueue<2&&_r._canDynamicBatch&&!_p._owner.isStatic?_k._addPrepareRenderElement(_r):_a.getRenderQueue(_r._material.renderQueue)._addRenderElement(_r)}}}}for(_f=0,_g=_n.length;_f<_g;_f++)_n[_f]._addToRenderQueue(_a,_c,_d,_e);_k._finishCombineDynamicBatch(_a),_k._addToRenderQueue(_a,_c,_d,_e)},_a}(),_da=function(){function _f(){this._initBatchRenderElements=null,this._staticBatches=null,this._initBatchRenderElements=[],this._staticBatches={}}_n(_f,"laya.d3.graphics.StaticBatchManager");var _a=_f.prototype;return _a._finishInit=function(){for(var _a in this._staticBatches)this._staticBatches[_a]._finishInit();this._initBatchRenderElements.length=0},_a._initStaticBatchs=function(_a){throw new Error("StaticBatchManager:must override this function.")},_a._addInitBatchSprite=function(_a){for(var _b=_a._render._renderElements,_c=0,_d=_b.length;_c<_d;_c++)this._initBatchRenderElements.push(_b[_c])},_a._clearRenderElements=function(){for(var _a in this._staticBatches)this._staticBatches[_a]._clearRenderElements()},_a._garbageCollection=function(_a){var _b=_a._staticBatch,_c=_b._initBatchRenderElements,_d=_c.indexOf(_a);_c.splice(_d,1),0===_c.length&&(_b.dispose(),delete this._staticBatches[_b._key])},_a._addToRenderQueue=function(_a,_b,_c,_d){for(var _e in this._staticBatches){var _f=this._staticBatches[_e];0<_f._batchRenderElements.length&&_f._updateToRenderQueue(_a,_d)}},_a.dispose=function(){this._staticBatches=null},_f._addToStaticBatchQueue=function(_a){_a instanceof laya.d3.core.RenderableSprite3D&&_a._addToInitStaticBatchManager();for(var _b=0,_c=_a.numChildren;_b<_c;_b++)_f._addToStaticBatchQueue(_a._childs[_b])},_f.combine=function(_a,_b){var _c,_d=0,_e=0;if(_b)for(_d=0,_e=_b.length;_d<_e;_d++){_b[_d]._addToInitStaticBatchManager()}else _a&&_f._addToStaticBatchQueue(_a);for(_d=0,_e=_f._staticBatchManagers.length;_d<_e;_d++)(_c=_f._staticBatchManagers[_d])._initStaticBatchs(_a),_c._finishInit()},_f._staticBatchManagers=[],_f}(),_ea=function(){function _a(_a,_b,_c){this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=null,this._initBatchRenderElements=null,this._batchRenderElements=null,this._material=null,this._rootOwner=null,this._key=null,this._manager=null,this._key=_a,this._manager=_b,this._combineRenderElementPoolIndex=0,this._combineRenderElementPool=[],this._initBatchRenderElements=[],this._batchRenderElements=[],this._rootOwner=_c}_n(_a,"laya.d3.graphics.StaticBatch");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),_b._binarySearch=function(_a){for(var _b=0,_c=this._batchRenderElements.length-1,_d=0;_b<=_c;)_d=Math.floor((_b+_c)/2),this._compareBatchRenderElement(this._batchRenderElements[_d],_a)?_c=_d-1:_b=_d+1;return _b},_b._compareBatchRenderElement=function(_a,_b){throw new Error("StaticBatch:must override this function.")},_b._getVertexDecLightMap=function(_a){return _a===_La.vertexDeclaration?_Ga.vertexDeclaration:_a===_Ka.vertexDeclaration?_Fa.vertexDeclaration:_a===_za.vertexDeclaration?_ua.vertexDeclaration:_a===_Pa.vertexDeclaration?null:_a===_pa.vertexDeclaration?_qa.vertexDeclaration:_a===_Na.vertexDeclaration?_Ia.vertexDeclaration:_a===_Da.vertexDeclaration?_Ea.vertexDeclaration:_a===_Ma.vertexDeclaration?_Ha.vertexDeclaration:_a===_Ka.vertexDeclaration?_Fa.vertexDeclaration:_a===_Aa.vertexDeclaration?_va.vertexDeclaration:_a===_Pa.vertexDeclaration?null:_a===_pa.vertexDeclaration?_qa.vertexDeclaration:_a===_Oa.vertexDeclaration?_Ja.vertexDeclaration:_a===_Da.vertexDeclaration?_Ea.vertexDeclaration:_a},_b._getCombineRenderElementFromPool=function(){throw new Error("StaticBatch:must override this function.")},_b._addBatchRenderElement=function(_a){this._batchRenderElements.splice(this._binarySearch(_a),0,_a)},_b._updateToRenderQueue=function(_a,_b){this._combineRenderElementPoolIndex=0,this._getRenderElement(_a.getRenderQueue(this._material.renderQueue)._renderElements,_a,_b)},_b._getRenderElement=function(_a,_b,_c){throw new Error("StaticBatch:must override this function.")},_b._finishInit=function(){throw new Error("StaticBatch:must override this function.")},_b._clearRenderElements=function(){this._batchRenderElements.length=0},_b.dispose=function(){},_b._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),null},_b._getIndexBuffer=function(){return null},_b._beforeRender=function(_a){return!0},_b._render=function(_a){},_b._getVertexBuffers=function(){return null},_o(0,_b,"_vertexBufferCount",function(){return 1}),_o(0,_b,"triangleCount",function(){return 0}),_a.combine=function(_a){console.log("StaticBatch: discard property,please use StaticBatchManager.combine() function instead."),_da.combine(_a)},_a.maxBatchVertexCount=65535,_a}(),_fa=function(){function _g(_a,_b){if(this._id=0,this._shaderValues=null,this._shaderDefineValue=0,this._vertexStride=0,this._vertexElements=null,this._vertexElementsDic=null,this._id=++_g._uniqueIDCounter,this._id>_g.maxVertexDeclaration)throw new Error("VertexDeclaration: VertexDeclaration count should not large than ",_g.maxVertexDeclaration);this._shaderValues=new _mb,this._vertexElementsDic={},this._vertexStride=_a,this._vertexElements=_b;for(var _c=0;_c<_b.length;_c++){var _d=_b[_c],_e=_d.elementUsage;this._vertexElementsDic[_e]=_d;var _f=[_g._getTypeSize(_d.elementFormat)/4,5126,!1,this._vertexStride,_d.offset];switch(this._shaderValues.setValue(_e,_f),_e){case 1:this._addShaderDefine(_yb.SHADERDEFINE_COLOR);break;case 2:this._addShaderDefine(_yb.SHADERDEFINE_UV0);break;case 15:this._addShaderDefine(_yb.SHADERDEFINE_UV1)}}}_n(_g,"laya.d3.graphics.VertexDeclaration");var _a=_g.prototype;return _a._addShaderDefine=function(_a){this._shaderDefineValue|=_a},_a._removeShaderDefine=function(_a){this._shaderDefineValue&=~_a},_a.getVertexElements=function(){return this._vertexElements.slice()},_a.getVertexElementByUsage=function(_a){return this._vertexElementsDic[_a]},_a.unBinding=function(){},_o(0,_a,"shaderDefineValue",function(){return this._shaderDefineValue}),_o(0,_a,"id",function(){return this._id}),_o(0,_a,"vertexStride",function(){return this._vertexStride}),_o(0,_a,"shaderValues",function(){return this._shaderValues}),_g._getTypeSize=function(_a){switch(_a){case"single":return 4;case"vector2":return 8;case"vector3":return 12;case"vector4":return 16;case"color":case"byte4":case"short2":return 4;case"short4":return 8;case"normalizedshort2":return 4;case"normalizedshort4":return 8;case"halfvector2":return 4;case"halfvector4":return 8}return 0},_g.getVertexStride=function(_a){for(var _b=0,_c=0;_c<_a.Length;_c++){var _d=_a[_c],_e=_d.offset+_g._getTypeSize(_d.elementFormat);_b<_e&&(_b=_e)}return _b},_g._maxVertexDeclarationBit=1e3,_g._uniqueIDCounter=1,_l(_g,["maxVertexDeclaration",function(){return this.maxVertexDeclaration=2147483647-1e3*Math.floor(2147483.647)}]),_g}(),_ga=function(){function _a(_a,_b,_c){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=_a,this.elementFormat=_b,this.elementUsage=_c}return _n(_a,"laya.d3.graphics.VertexElement"),_a}(),_ha=(function(){function _a(){}_n(_a,"laya.d3.graphics.VertexElementFormat"),_a.Single="single",_a.Vector2="vector2",_a.Vector3="vector3",_a.Vector4="vector4",_a.Color="color",_a.Byte4="byte4",_a.Short2="short2",_a.Short4="short4",_a.NormalizedShort2="normalizedshort2",_a.NormalizedShort4="normalizedshort4",_a.HalfVector2="halfvector2",_a.HalfVector4="halfvector4"}(),function(){function _a(){}_n(_a,"laya.d3.graphics.VertexElementUsage"),_a.POSITION0=0,_a.COLOR0=1,_a.TEXTURECOORDINATE0=2,_a.NORMAL0=3,_a.BINORMAL0=4,_a.TANGENT0=5,_a.BLENDINDICES0=6,_a.BLENDWEIGHT0=7,_a.DEPTH0=8,_a.FOG0=9,_a.POINTSIZE0=10,_a.SAMPLE0=11,_a.TESSELLATEFACTOR0=12,_a.COLOR1=13,_a.NEXTTEXTURECOORDINATE0=14,_a.TEXTURECOORDINATE1=15,_a.NEXTTEXTURECOORDINATE1=16,_a.CORNERTEXTURECOORDINATE0=17,_a.VELOCITY0=18,_a.STARTCOLOR0=19,_a.STARTSIZE=20,_a.AGEADDSCALE0=21,_a.STARTROTATION=22,_a.ENDCOLOR0=23,_a.STARTLIFETIME=24,_a.TIME0=33,_a.SHAPEPOSITIONSTARTLIFETIME=30,_a.DIRECTIONTIME=32,_a.SIZEROTATION0=27,_a.RADIUS0=28,_a.RADIAN0=29,_a.STARTSPEED=31,_a.RANDOM0=34,_a.RANDOM1=35,_a.SIMULATIONWORLDPOSTION=36,_a.SIMULATIONWORLDROTATION=37,_a.TEXTURECOORDINATE0X=38,_a.TEXTURECOORDINATE0X1=39,_a.TEXTURECOORDINATE0Y=40,_a.OFFSETVECTOR=41}(),function(){function _a(_a,_b,_c){this._position=null,this._textureCoordinate0=null,this._time=NaN,this._position=_a,this._textureCoordinate0=_b,this._time=_c}_n(_a,"laya.d3.graphics.VertexGlitter");var _b=_a.prototype;_v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate0}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"time",function(){return this._time}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(24,[new _ga(0,"vector3",0),new _ga(12,"vector2",2),new _ga(20,"single",33)])}])}(),function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){this._cornerTextureCoordinate=null,this._position=null,this._velocity=null,this._startColor=null,this._endColor=null,this._sizeRotation=null,this._radius=null,this._radian=null,this._ageAddScale=NaN,this._time=NaN,this._cornerTextureCoordinate=_a,this._position=_b,this._velocity=_c,this._startColor=_d,this._endColor=_e,this._sizeRotation=_f,this._radius=_g,this._radian=_h,this._ageAddScale=_i,this._time=_j}_n(_a,"laya.d3.graphics.VertexParticle");var _b=_a.prototype;_v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"endColor",function(){return this._endColor}),_o(0,_b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_o(0,_b,"sizeRotation",function(){return this._sizeRotation}),_o(0,_b,"velocity",function(){return this._velocity}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"startColor",function(){return this._startColor}),_o(0,_b,"radius",function(){return this._radius}),_o(0,_b,"radian",function(){return this._radian}),_o(0,_b,"ageAddScale",function(){return this._ageAddScale}),_o(0,_b,"time",function(){return this._time}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(116,[new _ga(0,"vector4",17),new _ga(16,"vector3",0),new _ga(28,"vector3",18),new _ga(40,"vector4",19),new _ga(56,"vector4",23),new _ga(72,"vector3",27),new _ga(84,"vector2",28),new _ga(92,"vector4",29),new _ga(108,"single",24),new _ga(112,"single",33)])}])}(),function(){function _a(_a){this._position=null,this._position=_a}_n(_a,"laya.d3.graphics.VertexPosition");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(12,[new _ga(0,"vector3",0)])}]),_a}()),_ia=function(){function _a(_a,_b){this._position=null,this._normal=null,this._position=_a,this._normal=_b}_n(_a,"laya.d3.graphics.VertexPositionNormal");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(24,[new _ga(0,"vector3",0),new _ga(12,"vector3",3)])}]),_a}(),_ja=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._color=null,this._position=_a,this._normal=_b,this._color=_c}_n(_a,"laya.d3.graphics.VertexPositionNormalColor");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(40,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1)])}]),_a}(),_ka=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._position=_a,this._normal=_b,this._color=_c,this._blendIndex=_d,this._blendWeight=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalColorSkin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(72,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector4",7),new _ga(56,"vector4",6)])}]),_a}(),_la=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._tangent=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalColorSkinSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(88,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector4",7),new _ga(56,"vector4",6),new _ga(72,"vector4",5)])}]),_a}(),_ma=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._color=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._tangent=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalColorSkinTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(84,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector4",7),new _ga(56,"vector4",6),new _ga(72,"vector3",5)])}]),_a}(),_na=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._tangent=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalColorSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(56,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector4",5)])}]),_a}(),_oa=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._color=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._tangent=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(52,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector3",5)])}]),_a}(),_pa=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(48,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2)])}]),_a}(),_qa=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(56,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15)])}]),_a}(),_ra=function(){function _a(_a,_b,_c,_d,_e,_f,_g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._blendIndex=_f,this._blendWeight=_g}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Skin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(88,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15),new _ga(56,"vector4",7),new _ga(72,"vector4",6)])}]),_a}(),_sa=function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._tangent=_f,this._blendIndex=_g,this._blendWeight=_h}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(104,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15),new _ga(56,"vector4",7),new _ga(72,"vector4",6),new _ga(88,"vector4",5)])}]),_a}(),_ta=function(){function _a(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1SkinTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_b.VertexPositionNormalColorTexture0SkinTangent=function(_a,_b,_c,_d,_e,_f,_g,_h){this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._tangent=_f,this._blendIndex=_g,this._blendWeight=_h},_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(100,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15),new _ga(56,"vector4",7),new _ga(72,"vector4",6),new _ga(88,"vector3",5)])}]),_a}(),_ua=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._tangent=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1STangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(72,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15),new _ga(56,"vector4",5)])}]),_a}(),_va=function(){function _a(){this._position=null,this._normal=null,this._color=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTexture0Texture1Tangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_b.VertexPositionNormalColorTexture0Tangent=function(_a,_b,_c,_d,_e,_f){this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._tangent=_f},_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(68,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector2",15),new _ga(56,"vector3",5)])}]),_a}(),_wa=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTextureSkin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(80,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector4",7),new _ga(64,"vector4",6)])}]),_a}(),_xa=function(){function _a(_a,_b,_c,_d,_e,_f,_g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d,this._tangent=_e,this._blendIndex=_f,this._blendWeight=_g}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTextureSkinSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(96,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector4",7),new _ga(64,"vector4",6),new _ga(80,"vector4",5)])}]),_a}(),_ya=function(){function _a(_a,_b,_c,_d,_e,_f,_g){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d,this._tangent=_e,this._blendIndex=_f,this._blendWeight=_g}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTextureSkinTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(92,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector4",7),new _ga(64,"vector4",6),new _ga(80,"vector3",5)])}]),_a}(),_za=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d,this._tangent=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTextureSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(64,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector4",5)])}]),_a}(),_Aa=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._color=null,this._textureCoordinate=null,this._tangent=null,this._position=_a,this._normal=_b,this._color=_c,this._textureCoordinate=_d,this._tangent=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalColorTextureTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"color",function(){return this._color}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(60,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",1),new _ga(40,"vector2",2),new _ga(48,"vector3",5)])}]),_a}(),_Ba=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._tangent=null,this._position=_a,this._normal=_b,this._tangent=_c}_n(_a,"laya.d3.graphics.VertexPositionNormalSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(40,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector4",5)])}]),_a}(),_Ca=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._tangent=null,this._position=_a,this._normal=_b,this._tangent=_c}_n(_a,"laya.d3.graphics.VertexPositionNormalTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(36,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector3",5)])}]),_a}(),_Da=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(32,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2)])}]),_a}(),_Ea=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(40,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15)])}]),_a}(),_Fa=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Skin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(72,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15),new _ga(40,"vector4",7),new _ga(56,"vector4",6)])}]),_a}(),_Ga=function(){function _a(_a,_b,_c,_d,_e,_f,_g){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d,this._tangent=_e,this._blendIndex=_f,this._blendWeight=_g}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(88,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15),new _ga(40,"vector4",7),new _ga(56,"vector4",6),new _ga(72,"vector4",5)])}]),_a}(),_Ha=function(){function _a(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1SkinTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_b.VertexPositionNormalTexture0SkinTangent=function(_a,_b,_c,_d,_e,_f,_g){this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d,this._tangent=_e,this._blendIndex=_f,this._blendWeight=_g},_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(84,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15),new _ga(40,"vector4",7),new _ga(56,"vector4",6),new _ga(72,"vector3",5)])}]),_a}(),_Ia=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d,this._tangent=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1STangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(56,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15),new _ga(40,"vector4",5)])}]),_a}(),_Ja=function(){function _a(){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._tangent=null}_n(_a,"laya.d3.graphics.VertexPositionNormalTexture0Texture1Tangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_b.VertexPositionNormalTexture0Tangent=function(_a,_b,_c,_d,_e){this._position=_a,this._normal=_b,this._textureCoordinate0=_c,this._textureCoordinate1=_d,this._tangent=_e},_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(52,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15),new _ga(40,"vector3",5)])}]),_a}(),_Ka=function(){function _a(_a,_b,_c,_d,_e){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c,this._blendIndex=_d,this._blendWeight=_e}_n(_a,"laya.d3.graphics.VertexPositionNormalTextureSkin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(64,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector4",7),new _ga(48,"vector4",6)])}]),_a}(),_La=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c,this._tangent=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalTextureSkinSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(80,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector4",7),new _ga(48,"vector4",6),new _ga(64,"vector4",5)])}]),_a}(),_Ma=function(){function _a(_a,_b,_c,_d,_e,_f){this._position=null,this._normal=null,this._textureCoordinate=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c,this._tangent=_d,this._blendIndex=_e,this._blendWeight=_f}_n(_a,"laya.d3.graphics.VertexPositionNormalTextureSkinTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(76,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector4",7),new _ga(48,"vector4",6),new _ga(64,"vector3",5)])}]),_a}(),_Na=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c,this._tangent=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalTextureSTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(48,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector4",5)])}]),_a}(),_Oa=function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._textureCoordinate=null,this._tangent=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c,this._tangent=_d}_n(_a,"laya.d3.graphics.VertexPositionNormalTextureTangent");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(44,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector3",5)])}]),_a}(),_Pa=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c}_n(_a,"laya.d3.graphics.VertexPositionNTBTexture");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(56,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector3",5),new _ga(36,"vector3",4),new _ga(48,"vector2",2)])}]),_a}(),_Qa=function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h){this._position=null,this._normal=null,this._textureCoordinate0=null,this._textureCoordinate1=null,this._blendIndex=null,this._blendWeight=null,this._tangent=null,this.binormal=null,this._position=_a,this._normal=_b,this._textureCoordinate0=_d,this._textureCoordinate1=_e,this._tangent=_f,_c=_c,this._blendIndex=_g,this._blendWeight=_h}_n(_a,"laya.d3.graphics.VertexPositionNTBTexture0Texture1Skin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"tangent",function(){return this._tangent}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(0,_b,"textureCoordinate1",function(){return this._textureCoordinate1}),_o(0,_b,"blendIndex",function(){return this._blendIndex}),_o(0,_b,"blendWeight",function(){return this._blendWeight}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(96,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector3",5),new _ga(36,"vector3",4),new _ga(48,"vector2",2),new _ga(56,"vector2",15),new _ga(64,"vector4",7),new _ga(80,"vector4",6)])}]),_a}(),_Ra=function(){function _a(_a,_b,_c){this._position=null,this._normal=null,this._textureCoordinate=null,this._position=_a,this._normal=_b,this._textureCoordinate=_c}_n(_a,"laya.d3.graphics.VertexPositionNTBTextureSkin");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"textureCoordinate",function(){return this._textureCoordinate}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(88,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector3",5),new _ga(36,"vector3",4),new _ga(48,"vector2",2),new _ga(56,"vector4",7),new _ga(72,"vector4",6)])}]),_a}(),_Sa=(function(){function _a(_a,_b,_c,_d){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=_a,this._normal=_b,this._textureCoord0=_c,this._textureCoord1=_d}_n(_a,"laya.d3.graphics.VertexPositionTerrain");var _b=_a.prototype;_v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"normal",function(){return this._normal}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoord0",function(){return this._textureCoord0}),_o(0,_b,"textureCoord1",function(){return this._textureCoord1}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(40,[new _ga(0,"vector3",0),new _ga(12,"vector3",3),new _ga(24,"vector2",2),new _ga(32,"vector2",15)])}])}(),function(){function _a(_a,_b){this._position=null,this._textureCoordinate0=null,this._position=_a,this._textureCoordinate0=_b}_n(_a,"laya.d3.graphics.VertexPositionTexture0");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"position",function(){return this._position}),_o(0,_b,"textureCoordinate0",function(){return this._textureCoordinate0}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(20,[new _ga(0,"vector3",0),new _ga(12,"vector2",2)])}]),_a}()),_Ta=(function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=_a,this._positionStartLifeTime=_b,this._velocity=_c,this._startColor=_d,this._startSize=_e,this._startRotation0=_f,this._startRotation1=_g,this._startRotation2=_h,this._startLifeTime=_i,this._time=_j,this._startSpeed=_k,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_n}_n(_a,"laya.d3.graphics.VertexShurikenParticleBillboard");var _b=_a.prototype;_v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_o(0,_b,"random1",function(){return this._randoms1}),_o(0,_b,"startRotation2",function(){return this._startRotation2}),_o(0,_b,"positionStartLifeTime",function(){return this._positionStartLifeTime}),_o(0,_b,"velocity",function(){return this._velocity}),_o(0,_b,"random0",function(){return this._randoms0}),_o(0,_b,"startSize",function(){return this._startSize}),_o(0,_b,"startColor",function(){return this._startColor}),_o(0,_b,"startRotation0",function(){return this._startRotation0}),_o(0,_b,"startRotation1",function(){return this._startRotation1}),_o(0,_b,"startLifeTime",function(){return this._startLifeTime}),_o(0,_b,"time",function(){return this._time}),_o(0,_b,"startSpeed",function(){return this._startSpeed}),_o(0,_b,"simulationWorldPostion",function(){return this._simulationWorldPostion}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(152,[new _ga(0,"vector4",17),new _ga(16,"vector4",30),new _ga(32,"vector4",32),new _ga(48,"vector4",19),new _ga(64,"vector3",20),new _ga(76,"vector3",22),new _ga(88,"single",31),new _ga(92,"vector4",34),new _ga(108,"vector4",35),new _ga(124,"vector3",36),new _ga(136,"vector4",37)])}])}(),function(){function _a(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,this._cornerTextureCoordinate=_a,this._positionStartLifeTime=_b,this._velocity=_c,this._startColor=_d,this._startSize=_e,this._startRotation0=_f,this._startRotation1=_g,this._startRotation2=_h,this._startLifeTime=_i,this._time=_j,this._startSpeed=_k,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=_n}_n(_a,"laya.d3.graphics.VertexShurikenParticleMesh");var _b=_a.prototype;_v.imps(_b,{"laya.d3.graphics.IVertex":!0}),_o(0,_b,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),_o(0,_b,"velocity",function(){return this._velocity}),_o(0,_b,"position",function(){return this._positionStartLifeTime}),_o(0,_b,"random0",function(){return this._randoms0}),_o(0,_b,"startSize",function(){return this._startSize}),_o(0,_b,"startColor",function(){return this._startColor}),_o(0,_b,"startRotation0",function(){return this._startRotation0}),_o(0,_b,"startRotation1",function(){return this._startRotation1}),_o(0,_b,"random1",function(){return this._randoms1}),_o(0,_b,"startRotation2",function(){return this._startRotation2}),_o(0,_b,"startLifeTime",function(){return this._startLifeTime}),_o(0,_b,"time",function(){return this._time}),_o(0,_b,"startSpeed",function(){return this._startSpeed}),_o(0,_b,"simulationWorldPostion",function(){return this._simulationWorldPostion}),_o(0,_b,"vertexDeclaration",function(){return _a._vertexDeclaration}),_o(1,_a,"vertexDeclaration",function(){return _a._vertexDeclaration}),_l(_a,["_vertexDeclaration",function(){return this._vertexDeclaration=new _fa(172,[new _ga(0,"vector3",0),new _ga(12,"vector4",1),new _ga(28,"vector2",2),new _ga(36,"vector4",30),new _ga(52,"vector4",32),new _ga(68,"vector4",19),new _ga(84,"vector3",20),new _ga(96,"vector3",22),new _ga(108,"single",31),new _ga(112,"vector4",34),new _ga(128,"vector4",35),new _ga(144,"vector3",36),new _ga(156,"vector4",37)])}])}(),function(){function _t(_a,_b,_c,_d,_e,_f){this._version=null,this._strings=["BLOCK","DATA","STRINGS"],this._materials=null,this._subMeshes=null,this._materialMap=null,this._readData=null,this._mesh=null,this._BLOCK={count:0},this._DATA={offset:0,size:0},this._STRINGS={offset:0,size:0},this._shaderAttributes=null,this._mesh=_c,this._materials=_d,this._subMeshes=_e,this._materialMap=_f,this._version=_b,this._onLoaded(_a)}_n(_t,"laya.d3.loaders.LoadModelV01");var _a=_t.prototype;return _a._onLoaded=function(_a){this._readData=_a,this.READ_BLOCK();for(var _b=0;_b<this._BLOCK.count;_b++){var _c=this._readData.getUint16(),_d=this._strings[_c],_e=this["READ_"+_d];if(null==_e)throw new Error("model file err,no this function:"+_c+" "+_d);if(!_e.call(this))break}return this._mesh},_a.onError=function(){},_a._readString=function(){return this._strings[this._readData.getUint16()]},_a.READ_BLOCK=function(){this._readData.getUint16();return this._BLOCK.count=this._readData.getUint16(),!0},_a.READ_DATA=function(){return this._DATA.offset=this._readData.getUint32(),this._DATA.size=this._readData.getUint32(),!0},_a.READ_STRINGS=function(){this._STRINGS.offset=this._readData.getUint16(),this._STRINGS.size=this._readData.getUint16();var _a=this._readData.pos;this._readData.pos=this._STRINGS.offset+this._DATA.offset;for(var _b=0;_b<this._STRINGS.size;_b++)this._strings[_b]=this._readData.readUTFString();return this._readData.pos=_a,!0},_a.READ_MATERIAL=function(){var _a=this._readData.getUint16(),_b=(this._readString(),this._readString());return this._materials[_a]="null"!==_b?_r.getRes(this._materialMap[_b]):new _Cb,!0},_a.READ_MESH=function(){this._readString();switch(this._version){case"LAYAMODEL:01":console.log("Warning: The (.lm) file is converted by old fbxTools,please reConverted it use  lastest fbxTools version,later we will remove the  support of old version (.lm) support.");break;case"LAYASKINANI:01":case"LAYAMODEL:02":var _a,_b=this._readData.__getBuffer(),_c=0,_d=this._readData.getUint32(),_e=this._readData.getUint32(),_f=(new Float32Array(_b.slice(_d+this._DATA.offset,_d+this._DATA.offset+_e)),this._readData.getUint32()),_g=this._readData.getUint32(),_h=new Float32Array(_b.slice(_f+this._DATA.offset,_f+this._DATA.offset+_g));for(this.mesh._inverseBindPoses=[],_c=0,_a=_h.length;_c<_a;_c+=16){var _i=new _ab(_h[_c+0],_h[_c+1],_h[_c+2],_h[_c+3],_h[_c+4],_h[_c+5],_h[_c+6],_h[_c+7],_h[_c+8],_h[_c+9],_h[_c+10],_h[_c+11],_h[_c+12],_h[_c+13],_h[_c+14],_h[_c+15]);this.mesh._inverseBindPoses.push(_i)}break;default:throw new Error("LoadModel:unknown version.")}return!0},_a.READ_SUBMESH=function(){this._readString(),this._readData.getUint8();var _a=this._readString();this._shaderAttributes=_a.match(_t._attrReg);var _b=this._readData.getUint32(),_c=this._readData.getUint32(),_d=(this._readData.getUint32(),this._readData.getUint32(),this._readData.getUint32()),_e=this._readData.getUint32(),_f=this._readData.getUint32(),_g=this._readData.getUint32(),_h=this._readData.__getBuffer(),_i=new _jb(this._mesh),_j=this._getVertexDeclaration(),_k=_Mb.create(_j,_e/_j.vertexStride,35044,!0),_l=_d+this._DATA.offset,_m=_h.slice(_l,_l+_e);_k.setData(new Float32Array(_m));for(var _n=(_i._vertexBuffer=_k).vertexDeclaration.getVertexElements(),_o=0;_o<_n.length;_o++)_i._bufferUsage[_n[_o].elementUsage]=_k;var _p=_Lb.create("ushort",_c/2,35044,!0),_q=_b+this._DATA.offset,_r=_h.slice(_q,_q+_c);_p.setData(new Uint16Array(_r)),_i._indexBuffer=_p;var _s=_h.slice(_f+this._DATA.offset,_f+this._DATA.offset+_g);return _i._boneIndicesList[0]=new Uint8Array(_s),this._subMeshes.push(_i),!0},_a.READ_DATAAREA=function(){return!1},_a._getVertexDeclaration=function(){for(var _a,_b=!1,_c=!1,_d=!1,_e=!1,_f=!1,_g=!1,_h=!1,_i=!1,_j=!1,_k=0;_k<this._shaderAttributes.length;_k+=8)switch(this._shaderAttributes[_k]){case"POSITION":_b=!0;break;case"NORMAL":_c=!0;break;case"COLOR":_d=!0;break;case"UV":_e=!0;break;case"UV1":_f=!0;break;case"BLENDWEIGHT":_h=!0;break;case"BLENDINDICES":_i=!0;break;case"TANGENT":_g=!0;break;case"BINORMAL":_j=!0}return _b&&_c&&_d&&_e&&_f&&_h&&_i&&_g?_a=_ta.vertexDeclaration:_b&&_c&&_d&&_e&&_f&&_h&&_i?_a=_ra.vertexDeclaration:_b&&_c&&_e&&_f&&_h&&_i&&_g?_a=_Ha.vertexDeclaration:_b&&_c&&_e&&_f&&_h&&_i?_a=_Fa.vertexDeclaration:_b&&_c&&_d&&_e&&_h&&_i&&_g?_a=_ya.vertexDeclaration:_b&&_c&&_d&&_e&&_h&&_i?_a=_wa.vertexDeclaration:_b&&_c&&_g&&_j&&_e&&_h&&_i?_a=_Ra.vertexDeclaration:_b&&_c&&_e&&_h&&_i&&_g?_a=_Ma.vertexDeclaration:_b&&_c&&_e&&_h&&_i?_a=_Ka.vertexDeclaration:_b&&_c&&_d&&_h&&_i&&_g?_a=_ma.vertexDeclaration:_b&&_c&&_d&&_h&&_i?_a=_ka.vertexDeclaration:_b&&_c&&_d&&_e&&_f&&_g?_a=_va.vertexDeclaration:_b&&_c&&_d&&_e&&_f?_a=_qa.vertexDeclaration:_b&&_c&&_e&&_f&&_g?_a=_Ja.vertexDeclaration:_b&&_c&&_e&&_f?_a=_Ea.vertexDeclaration:_b&&_c&&_d&&_e&&_g?_a=_Aa.vertexDeclaration:_b&&_c&&_e&&_g&&_j?_a=_Pa.vertexDeclaration:_b&&_c&&_d&&_e?_a=_pa.vertexDeclaration:_b&&_c&&_e&&_g?_a=_Oa.vertexDeclaration:_b&&_c&&_e?_a=_Da.vertexDeclaration:_b&&_c&&_d&&_g?_a=_oa.vertexDeclaration:_b&&_c&&_d&&(_a=_ja.vertexDeclaration),_a},_o(0,_a,"mesh",function(){return this._mesh}),_t._attrReg=new RegExp("(\\w+)|([:,;])","g"),_t}()),_Ua=function(){function _x(){}return _n(_x,"laya.d3.loaders.LoadModelV02"),_x.parse=function(_a,_b,_c,_d,_e,_f){_x._mesh=_c,_x._materials=_d,_x._subMeshes=_e,_x._materialMap=_f,_x._version=_b,_x._readData=_a,_x.READ_DATA(),_x.READ_BLOCK(),_x.READ_STRINGS();for(var _g=0,_h=_x._BLOCK.count;_g<_h;_g++){_x._readData.pos=_x._BLOCK.blockStarts[_g];var _i=_x._readData.getUint16(),_j=_x._strings[_i],_k=_x["READ_"+_j];if(null==_k)throw new Error("model file err,no this function:"+_i+" "+_j);_k.call()}_x._strings.length=0,_x._readData=null,_x._version=null,_x._mesh=null,_x._materials=null,_x._subMeshes=null,_x._materialMap=null},_x._readString=function(){return _x._strings[_x._readData.getUint16()]},_x.READ_DATA=function(){_x._DATA.offset=_x._readData.getUint32(),_x._DATA.size=_x._readData.getUint32()},_x.READ_BLOCK=function(){for(var _a=_x._BLOCK.count=_x._readData.getUint16(),_b=_x._BLOCK.blockStarts=[],_c=_x._BLOCK.blockLengths=[],_d=0;_d<_a;_d++)_b.push(_x._readData.getUint32()),_c.push(_x._readData.getUint32())},_x.READ_STRINGS=function(){var _a=_x._readData.getUint32(),_b=_x._readData.getUint16(),_c=_x._readData.pos;_x._readData.pos=_a+_x._DATA.offset;for(var _d=0;_d<_b;_d++)_x._strings[_d]=_x._readData.readUTFString();_x._readData.pos=_c},_x.READ_MATERIAL=function(){_x._readString(),_x._readString();var _a=_x._readString();return""!==_a&&_x._materials.push(_r.getRes(_x._materialMap[_a])),!0},_x.READ_MESH=function(){_x._readString();var _a,_b=_x._readData.__getBuffer(),_c=0,_d=_x._readData.getInt16(),_e=_x._DATA.offset;for(_c=0;_c<_d;_c++){var _f=_e+_x._readData.getUint32(),_g=_x._readData.getUint32(),_h=new Float32Array(_b.slice(_f,_f+_g)),_i=_x._readString().match(_x._attrReg),_j=_x._getVertexDeclaration(_i),_k=_Mb.create(_j,4*_h.length/_j.vertexStride,35044,!0);_k.setData(_h),_x._mesh._vertexBuffers.push(_k)}var _l=_e+_x._readData.getUint32(),_m=_x._readData.getUint32(),_n=new Uint16Array(_b.slice(_l,_l+_m)),_o=_Lb.create("ushort",_m/2,35044,!0);_o.setData(_n),_x._mesh._indexBuffer=_o;var _p=_x._mesh._boneNames=[],_q=_x._readData.getUint16();for(_p.length=_q,_c=0;_c<_q;_c++)_p[_c]=_x._strings[_x._readData.getUint16()];var _r=_x._readData.getUint32(),_s=_x._readData.getUint32(),_t=(new Float32Array(_b.slice(_e+_r,_e+_r+_s)),_x._readData.getUint32()),_u=_x._readData.getUint32(),_v=new Float32Array(_b.slice(_e+_t,_e+_t+_u));for(_x._mesh._inverseBindPoses=[],_c=0,_a=_v.length;_c<_a;_c+=16){var _w=new _ab(_v[_c+0],_v[_c+1],_v[_c+2],_v[_c+3],_v[_c+4],_v[_c+5],_v[_c+6],_v[_c+7],_v[_c+8],_v[_c+9],_v[_c+10],_v[_c+11],_v[_c+12],_v[_c+13],_v[_c+14],_v[_c+15]);_x._mesh._inverseBindPoses.push(_w)}return _x._mesh._skinnedDatas=new Float32Array(16*_v.length),!0},_x.READ_SUBMESH=function(){var _a=_x._readData.__getBuffer(),_b=new _jb(_x._mesh),_c=_x._readData.getInt16(),_d=_x._readData.getUint32(),_e=_x._readData.getUint32();_b._vertexBuffer=_x._mesh._vertexBuffers[_c],_b._vertexStart=_d,_b._vertexCount=_e;var _f=_x._readData.getUint32(),_g=_x._readData.getUint32(),_h=_x._mesh._indexBuffer;_b._indexBuffer=_h,_b._indexStart=_f,_b._indexCount=_g,_b._indices=new Uint16Array(_h.getData().buffer,2*_f,_g);var _i=_x._DATA.offset,_j=_b._subIndexBufferStart,_k=_b._subIndexBufferCount,_l=_b._boneIndicesList,_m=_x._readData.getUint16();_j.length=_m,_k.length=_m,_l.length=_m;for(var _n=0;_n<_m;_n++){_j[_n]=_x._readData.getUint32(),_k[_n]=_x._readData.getUint32();var _o=_x._readData.getUint32(),_p=_x._readData.getUint32();_b._boneIndicesList[_n]=new Uint8Array(_a.slice(_i+_o,_i+_o+_p))}return _x._subMeshes.push(_b),!0},_x._getVertexDeclaration=function(_a){for(var _b,_c=!1,_d=!1,_e=!1,_f=!1,_g=!1,_h=!1,_i=!1,_j=!1,_k=!1,_l=0;_l<_a.length;_l++)switch(_a[_l]){case"POSITION":_c=!0;break;case"NORMAL":_d=!0;break;case"COLOR":_e=!0;break;case"UV":_f=!0;break;case"UV1":_g=!0;break;case"BLENDWEIGHT":_i=!0;break;case"BLENDINDICES":_j=!0;break;case"TANGENT":_h=!0;break;case"BINORMAL":_k=!0}return _c&&_d&&_e&&_f&&_g&&_i&&_j&&_h?_b=_ta.vertexDeclaration:_c&&_d&&_e&&_f&&_g&&_i&&_j?_b=_ra.vertexDeclaration:_c&&_d&&_f&&_g&&_i&&_j&&_h?_b=_Ha.vertexDeclaration:_c&&_d&&_f&&_g&&_i&&_j?_b=_Fa.vertexDeclaration:_c&&_d&&_e&&_f&&_i&&_j&&_h?_b=_ya.vertexDeclaration:_c&&_d&&_e&&_f&&_i&&_j?_b=_wa.vertexDeclaration:_c&&_d&&_f&&_i&&_j&&_h?_b=_Ma.vertexDeclaration:_c&&_d&&_f&&_i&&_j?_b=_Ka.vertexDeclaration:_c&&_d&&_e&&_i&&_j&&_h?_b=_ma.vertexDeclaration:_c&&_d&&_e&&_i&&_j?_b=_ka.vertexDeclaration:_c&&_d&&_e&&_f&&_g&&_h?_b=_va.vertexDeclaration:_c&&_d&&_e&&_f&&_g?_b=_qa.vertexDeclaration:_c&&_d&&_f&&_g&&_h?_b=_Ja.vertexDeclaration:_c&&_d&&_f&&_g?_b=_Ea.vertexDeclaration:_c&&_d&&_e&&_f&&_h?_b=_Aa.vertexDeclaration:_c&&_d&&_f&&_h&&_k?_b=_Pa.vertexDeclaration:_c&&_d&&_e&&_f?_b=_pa.vertexDeclaration:_c&&_d&&_f&&_h?_b=_Oa.vertexDeclaration:_c&&_d&&_f?_b=_Da.vertexDeclaration:_c&&_d&&_e&&_h?_b=_oa.vertexDeclaration:_c&&_d&&_e&&(_b=_ja.vertexDeclaration),_b},_x._attrReg=new RegExp("(\\w+)|([:,;])","g"),_x._strings=[],_x._readData=null,_x._version=null,_x._mesh=null,_x._materials=null,_x._subMeshes=null,_x._materialMap=null,_l(_x,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),_x}(),_Va=function(){function _w(){}return _n(_w,"laya.d3.loaders.LoadModelV03"),_w.parse=function(_a,_b,_c,_d,_e){_w._mesh=_c,_w._subMeshes=_d,_w._materialMap=_e,_w._version=_b,_w._readData=_a,_w.READ_DATA(),_w.READ_BLOCK(),_w.READ_STRINGS();for(var _f=0,_g=_w._BLOCK.count;_f<_g;_f++){_w._readData.pos=_w._BLOCK.blockStarts[_f];var _h=_w._readData.getUint16(),_i=_w._strings[_h],_j=_w["READ_"+_i];if(null==_j)throw new Error("model file err,no this function:"+_h+" "+_i);_j.call()}_w._strings.length=0,_w._readData=null,_w._version=null,_w._mesh=null,_w._subMeshes=null,_w._materialMap=null},_w._readString=function(){return _w._strings[_w._readData.getUint16()]},_w.READ_DATA=function(){_w._DATA.offset=_w._readData.getUint32(),_w._DATA.size=_w._readData.getUint32()},_w.READ_BLOCK=function(){for(var _a=_w._BLOCK.count=_w._readData.getUint16(),_b=_w._BLOCK.blockStarts=[],_c=_w._BLOCK.blockLengths=[],_d=0;_d<_a;_d++)_b.push(_w._readData.getUint32()),_c.push(_w._readData.getUint32())},_w.READ_STRINGS=function(){var _a=_w._readData.getUint32(),_b=_w._readData.getUint16(),_c=_w._readData.pos;_w._readData.pos=_a+_w._DATA.offset;for(var _d=0;_d<_b;_d++)_w._strings[_d]=_w._readData.readUTFString();_w._readData.pos=_c},_w.READ_MESH=function(){var _a,_b=_w._readString(),_c=_w._readData.__getBuffer(),_d=0,_e=_w._readData.getInt16(),_f=_w._DATA.offset;for(_d=0;_d<_e;_d++){var _g,_h=_f+_w._readData.getUint32(),_i=_w._readData.getUint32(),_j=new Float32Array(_c.slice(_h,_h+_i)),_k=_w._readString();switch(_w._version){case"LAYAMODEL:03":_g=_w._vertexDeclarationMap_Discard[_k];break;case"LAYAMODEL:0301":_g=_w._vertexDeclarationMap[_k];break;default:throw new Error("LoadModelV03: unknown version.")}if(!_g)throw new Error("LoadModelV03: unknown vertexDeclaration.  version="+_w._version+"  bufferAttribute="+_k+"  name="+_b+"  url="+(_w._mesh?_w._mesh.url:"null"));var _l=_Mb.create(_g,4*_j.length/_g.vertexStride,35044,!0,_w._mesh._url+"_"+_d);_l.setData(_j),_w._mesh._vertexBuffers.push(_l)}var _m=_f+_w._readData.getUint32(),_n=_w._readData.getUint32(),_o=new Uint16Array(_c.slice(_m,_m+_n)),_p=_Lb.create("ushort",_n/2,35044,!0,_w._mesh._url);_p.setData(_o),_w._mesh._indexBuffer=_p;var _q=_w._mesh._boneNames=[],_r=_w._readData.getUint16();for(_q.length=_r,_d=0;_d<_r;_d++)_q[_d]=_w._strings[_w._readData.getUint16()];_w._readData.pos+=8;var _s=_w._readData.getUint32(),_t=_w._readData.getUint32(),_u=new Float32Array(_c.slice(_f+_s,_f+_s+_t));for(_w._mesh._inverseBindPoses=[],_d=0,_a=_u.length;_d<_a;_d+=16){var _v=new _ab(_u[_d+0],_u[_d+1],_u[_d+2],_u[_d+3],_u[_d+4],_u[_d+5],_u[_d+6],_u[_d+7],_u[_d+8],_u[_d+9],_u[_d+10],_u[_d+11],_u[_d+12],_u[_d+13],_u[_d+14],_u[_d+15]);_w._mesh._inverseBindPoses.push(_v)}return _w._mesh._skinnedDatas=new Float32Array(16*_u.length),!0},_w.READ_SUBMESH=function(){var _a=_w._readData.__getBuffer(),_b=new _jb(_w._mesh),_c=_w._readData.getInt16(),_d=_w._readData.getUint32(),_e=_w._readData.getUint32();_b._vertexBuffer=_w._mesh._vertexBuffers[_c],_b._vertexStart=_d,_b._vertexCount=_e;var _f=_w._readData.getUint32(),_g=_w._readData.getUint32(),_h=_w._mesh._indexBuffer;_b._indexBuffer=_h,_b._indexStart=_f,_b._indexCount=_g,_b._indices=new Uint16Array(_h.getData().buffer,2*_f,_g);var _i=_w._DATA.offset,_j=_b._subIndexBufferStart,_k=_b._subIndexBufferCount,_l=_b._boneIndicesList,_m=_w._readData.getUint16();_j.length=_m,_k.length=_m,_l.length=_m;for(var _n=0;_n<_m;_n++){_j[_n]=_w._readData.getUint32(),_k[_n]=_w._readData.getUint32();var _o=_w._readData.getUint32(),_p=_w._readData.getUint32();_l[_n]=new Uint8Array(_a.slice(_i+_o,_i+_o+_p))}return _w._subMeshes.push(_b),!0},_w._strings=[],_w._readData=null,_w._version=null,_w._mesh=null,_w._subMeshes=null,_w._materialMap=null,_l(_w,["_vertexDeclarationMap_Discard",function(){return this._vertexDeclarationMap_Discard={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":_ta.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":_ra.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":_Qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":_Ha.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":_Fa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":_ya.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":_wa.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":_Ma.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":_Ka.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":_ma.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":_ka.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":_va.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":_qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":_Ja.vertexDeclaration,"POSITION,NORMAL,UV,UV1":_Ea.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":_Aa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":_Pa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":_pa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":_Oa.vertexDeclaration,"POSITION,NORMAL,UV":_Da.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":_oa.vertexDeclaration,"POSITION,NORMAL,COLOR":_ja.vertexDeclaration,"POSITION,NORMAL,TANGENT":_Ca.vertexDeclaration,"POSITION,NORMAL":_ia.vertexDeclaration,"POSITION,UV":_Sa.vertexDeclaration,POSITION:_ha.vertexDeclaration}},"_vertexDeclarationMap",function(){return this._vertexDeclarationMap={"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":_sa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,BLENDWEIGHT,BLENDINDICES":_ra.vertexDeclaration,"POSITION,NORMAL,TANGENT,BINORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,":_Qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES,TANGENT":_Ga.vertexDeclaration,"POSITION,NORMAL,UV,UV1,BLENDWEIGHT,BLENDINDICES":_Fa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":_xa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,BLENDWEIGHT,BLENDINDICES":_wa.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES,TANGENT":_La.vertexDeclaration,"POSITION,NORMAL,UV,BLENDWEIGHT,BLENDINDICES":_Ka.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES,TANGENT":_la.vertexDeclaration,"POSITION,NORMAL,COLOR,BLENDWEIGHT,BLENDINDICES":_ka.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1,TANGENT":_ua.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,UV1":_qa.vertexDeclaration,"POSITION,NORMAL,UV,UV1,TANGENT":_Ia.vertexDeclaration,"POSITION,NORMAL,UV,UV1":_Ea.vertexDeclaration,"POSITION,NORMAL,COLOR,UV,TANGENT":_za.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT,BINORMAL":_Pa.vertexDeclaration,"POSITION,NORMAL,COLOR,UV":_pa.vertexDeclaration,"POSITION,NORMAL,UV,TANGENT":_Na.vertexDeclaration,"POSITION,NORMAL,UV":_Da.vertexDeclaration,"POSITION,NORMAL,COLOR,TANGENT":_na.vertexDeclaration,"POSITION,NORMAL,COLOR":_ja.vertexDeclaration,"POSITION,NORMAL,TANGENT":_Ba.vertexDeclaration,"POSITION,NORMAL":_ia.vertexDeclaration,"POSITION,UV":_Sa.vertexDeclaration,POSITION:_ha.vertexDeclaration}},"_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),_w}(),_Wa=function(){function _h(){}return _n(_h,"laya.d3.loaders.MeshReader"),_h.read=function(_a,_b,_c,_d,_e){var _f=new _w(_a);_f.pos=0;var _g=_f.readUTFString();switch(_g){case"LAYAMODEL:01":case"LAYASKINANI:01":_h._readVersion01(_f,_g,_b,_c,_d,_e);break;case"LAYAMODEL:02":_Ua.parse(_f,_g,_b,_c,_d,_e);break;case"LAYAMODEL:03":case"LAYAMODEL:0301":_Va.parse(_f,_g,_b,_d,_e);break;default:throw new Error("MeshReader: unknown mesh version.")}_b._setSubMeshes(_d)},_h._readVersion01=function(_a,_b,_c,_d,_e,_f){new _Ta(_a,_b,_c,_d,_e,_f)},_h}(),_Xa=function(){function _a(_a,_b){this.min=null,this.max=null,this.min=_a,this.max=_b}_n(_a,"laya.d3.math.BoundBox");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.IClone":!0}),_b.getCorners=function(_a){_a.length=8;var _b=this.min.elements,_c=this.max.elements,_d=_b[0],_e=_b[1],_f=_b[2],_g=_c[0],_h=_c[1],_i=_c[2];_a[0]=new _gb(_d,_h,_i),_a[1]=new _gb(_g,_h,_i),_a[2]=new _gb(_g,_e,_i),_a[3]=new _gb(_d,_e,_i),_a[4]=new _gb(_d,_h,_f),_a[5]=new _gb(_g,_h,_f),_a[6]=new _gb(_g,_e,_f),_a[7]=new _gb(_d,_e,_f)},_b.toDefault=function(){this.min.toDefault(),this.max.toDefault()},_b.cloneTo=function(_a){var _b=_a;this.min.cloneTo(_b.min),this.max.cloneTo(_b.max)},_b.clone=function(){var _a=new this.constructor(new _gb,new _gb);return this.cloneTo(_a),_a},_a.createfromPoints=function(_a,_b){if(null==_a)throw new Error("points");var _c=_b.min,_d=_b.max,_e=_c.elements;_e[0]=Number.MAX_VALUE,_e[1]=Number.MAX_VALUE,_e[2]=Number.MAX_VALUE;var _f=_d.elements;_f[0]=-Number.MAX_VALUE,_f[1]=-Number.MAX_VALUE,_f[2]=-Number.MAX_VALUE;for(var _g=0,_h=_a.length;_g<_h;++_g)_gb.min(_c,_a[_g],_c),_gb.max(_d,_a[_g],_d)},_a.merge=function(_a,_b,_c){_gb.min(_a.min,_b.min,_c.min),_gb.max(_a.max,_b.max,_c.max)},_a}(),_Ya=function(){function _j(_a){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=_a,this._near=new _bb(new _gb),this._far=new _bb(new _gb),this._left=new _bb(new _gb),this._right=new _bb(new _gb),this._top=new _bb(new _gb),this._bottom=new _bb(new _gb),_j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}_n(_j,"laya.d3.math.BoundFrustum");var _a=_j.prototype;return _a.equalsBoundFrustum=function(_a){return this._matrix.equalsOtherMatrix(_a.matrix)},_a.equalsObj=function(_a){if(_a instanceof laya.d3.math.BoundFrustum){var _b=_a;return this.equalsBoundFrustum(_b)}return!1},_a.getPlane=function(_a){switch(_a){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},_a.getCorners=function(_a){_j._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(_a[0]),_j._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(_a[1]),_j._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(_a[2]),_j._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(_a[3]),_j._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(_a[4]),_j._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(_a[5]),_j._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(_a[6]),_j._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(_a[7])},_a.containsPoint=function(_a){for(var _b=_bb.PlaneIntersectionType_Front,_c=_bb.PlaneIntersectionType_Front,_d=0;_d<6;_d++){switch(_d){case 0:_c=Collision.intersectsPlaneAndPoint(this._near,_a);break;case 1:_c=Collision.intersectsPlaneAndPoint(this._far,_a);break;case 2:_c=Collision.intersectsPlaneAndPoint(this._left,_a);break;case 3:_c=Collision.intersectsPlaneAndPoint(this._right,_a);break;case 4:_c=Collision.intersectsPlaneAndPoint(this._top,_a);break;case 5:_c=Collision.intersectsPlaneAndPoint(this._bottom,_a)}switch(_c){case _bb.PlaneIntersectionType_Back:return 0;case _bb.PlaneIntersectionType_Intersecting:_b=_bb.PlaneIntersectionType_Intersecting}}switch(_b){case _bb.PlaneIntersectionType_Intersecting:return 2;default:return 1}},_a.containsBoundBox=function(_a){for(var _b,_c=_j._tempV30,_d=_j._tempV31,_e=1,_f=0;_f<6;_f++){if(_b=this.getPlane(_f),this._getBoxToPlanePVertexNVertex(_a,_b.normal,_c,_d),Collision.intersectsPlaneAndPoint(_b,_c)===_bb.PlaneIntersectionType_Back)return 0;Collision.intersectsPlaneAndPoint(_b,_d)===_bb.PlaneIntersectionType_Back&&(_e=2)}return _e},_a.containsBoundSphere=function(_a){for(var _b=_bb.PlaneIntersectionType_Front,_c=_bb.PlaneIntersectionType_Front,_d=0;_d<6;_d++){switch(_d){case 0:_c=Collision.intersectsPlaneAndSphere(this._near,_a);break;case 1:_c=Collision.intersectsPlaneAndSphere(this._far,_a);break;case 2:_c=Collision.intersectsPlaneAndSphere(this._left,_a);break;case 3:_c=Collision.intersectsPlaneAndSphere(this._right,_a);break;case 4:_c=Collision.intersectsPlaneAndSphere(this._top,_a);break;case 5:_c=Collision.intersectsPlaneAndSphere(this._bottom,_a)}switch(_c){case _bb.PlaneIntersectionType_Back:return 0;case _bb.PlaneIntersectionType_Intersecting:_b=_bb.PlaneIntersectionType_Intersecting}}switch(_b){case _bb.PlaneIntersectionType_Intersecting:return 2;default:return 1}},_a._getBoxToPlanePVertexNVertex=function(_a,_b,_c,_d){var _e=_a.min,_f=_e.elements,_g=_a.max,_h=_g.elements,_i=_b.elements,_j=_i[0],_k=_i[1],_l=_i[2];_e.cloneTo(_c);var _m=_c.elements;0<=_j&&(_m[0]=_h[0]),0<=_k&&(_m[1]=_h[1]),0<=_l&&(_m[2]=_h[2]),_g.cloneTo(_d);var _n=_d.elements;0<=_j&&(_n[0]=_f[0]),0<=_k&&(_n[1]=_f[1]),0<=_l&&(_n[2]=_f[2])},_o(0,_a,"top",function(){return this._top}),_o(0,_a,"matrix",function(){return this._matrix},function(_a){this._matrix=_a,_j._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),_o(0,_a,"near",function(){return this._near}),_o(0,_a,"far",function(){return this._far}),_o(0,_a,"left",function(){return this._left}),_o(0,_a,"right",function(){return this._right}),_o(0,_a,"bottom",function(){return this._bottom}),_j._getPlanesFromMatrix=function(_a,_b,_c,_d,_e,_f,_g){var _h=_a.elements,_i=_h[0],_j=_h[1],_k=_h[2],_l=_h[3],_m=_h[4],_n=_h[5],_o=_h[6],_p=_h[7],_q=_h[8],_r=_h[9],_s=_h[10],_t=_h[11],_u=_h[12],_v=_h[13],_w=_h[14],_x=_h[15],_y=_b.normal.elements;_y[0]=_l+_k,_y[1]=_p+_o,_y[2]=_t+_s,_b.distance=_x+_w,_b.normalize();var _z=_c.normal.elements;_z[0]=_l-_k,_z[1]=_p-_o,_z[2]=_t-_s,_c.distance=_x-_w,_c.normalize();var _A=_d.normal.elements;_A[0]=_l+_i,_A[1]=_p+_m,_A[2]=_t+_q,_d.distance=_x+_u,_d.normalize();var _B=_e.normal.elements;_B[0]=_l-_i,_B[1]=_p-_m,_B[2]=_t-_q,_e.distance=_x-_u,_e.normalize();var _C=_f.normal.elements;_C[0]=_l-_j,_C[1]=_p-_n,_C[2]=_t-_r,_f.distance=_x-_v,_f.normalize();var _D=_g.normal.elements;_D[0]=_l+_j,_D[1]=_p+_n,_D[2]=_t+_r,_g.distance=_x+_v,_g.normalize()},_j._get3PlaneInterPoint=function(_a,_b,_c){var _d=_a.normal,_e=_b.normal,_f=_c.normal;_gb.cross(_e,_f,_j._tempV30),_gb.cross(_f,_d,_j._tempV31),_gb.cross(_d,_e,_j._tempV32);var _g=_gb.dot(_d,_j._tempV30),_h=_gb.dot(_e,_j._tempV31),_i=_gb.dot(_f,_j._tempV32);return _gb.scale(_j._tempV30,-_a.distance/_g,_j._tempV33),_gb.scale(_j._tempV31,-_b.distance/_h,_j._tempV34),_gb.scale(_j._tempV32,-_c.distance/_i,_j._tempV35),_gb.add(_j._tempV33,_j._tempV34,_j._tempV36),_gb.add(_j._tempV35,_j._tempV36,_j._tempV37),_j._tempV37},_l(_j,["_tempV30",function(){return this._tempV30=new _gb},"_tempV31",function(){return this._tempV31=new _gb},"_tempV32",function(){return this._tempV32=new _gb},"_tempV33",function(){return this._tempV33=new _gb},"_tempV34",function(){return this._tempV34=new _gb},"_tempV35",function(){return this._tempV35=new _gb},"_tempV36",function(){return this._tempV36=new _gb},"_tempV37",function(){return this._tempV37=new _gb}]),_j}(),_Za=function(){function _k(_a,_b){this.center=null,this.radius=NaN,this.center=_a,this.radius=_b}_n(_k,"laya.d3.math.BoundSphere");var _a=_k.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.toDefault=function(){this.center.toDefault(),this.radius=0},_a.intersectsRayDistance=function(_a){return Collision.intersectsRayAndSphereRD(_a,this)},_a.intersectsRayPoint=function(_a,_b){return Collision.intersectsRayAndSphereRP(_a,this,_b)},_a.cloneTo=function(_a){var _b=_a;this.center.cloneTo(_b.center),_b.radius=this.radius},_a.clone=function(){var _a=new this.constructor(new _gb,new _gb);return this.cloneTo(_a),_a},_k.createFromSubPoints=function(_a,_b,_c,_d){if(null==_a)throw new Error("points");if(_b<0||_b>=_a.length)throw new Error("start"+_b+"Must be in the range [0, "+(_a.length-1)+"]");if(_c<0||_b+_c>_a.length)throw new Error("count"+_c+"Must be in the range <= "+_a.length+"}");var _e=_b+_c,_f=_k._tempVector3;_f.elements[0]=0,_f.elements[1]=0,_f.elements[2]=0;for(var _g=_b;_g<_e;++_g)_gb.add(_a[_g],_f,_f);var _h=_d.center;_gb.scale(_f,1/_c,_h);var _i=0;for(_g=_b;_g<_e;++_g){var _j=_gb.distanceSquared(_h,_a[_g]);_i<_j&&(_i=_j)}_d.radius=Math.sqrt(_i)},_k.createfromPoints=function(_a,_b){if(null==_a)throw new Error("points");_k.createFromSubPoints(_a,0,_a.length,_b)},_l(_k,["_tempVector3",function(){return this._tempVector3=new _gb}]),_k}(),_$a=(function(){function _a(){}_n(_a,"laya.d3.math.ContainmentType"),_a.Disjoint=0,_a.Contains=1,_a.Intersects=2}(),function(){function _c(){}return _n(_c,"laya.d3.math.MathUtils3D"),_c.isZero=function(_a){return Math.abs(_a)<_c.zeroTolerance},_c.nearEqual=function(_a,_b){return!!_c.isZero(_a-_b)},_c.fastInvSqrt=function(_a){return _c.isZero(_a)?_a:1/Math.sqrt(_a)},_l(_c,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),_c}()),__a=function(){function _i(){var _a=this.elements=new Float32Array(9);_a[0]=1,_a[1]=0,_a[2]=0,_a[3]=0,_a[4]=1,_a[5]=0,_a[6]=0,_a[7]=0,_a[8]=1}_n(_i,"laya.d3.math.Matrix3x3");var _a=_i.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.determinant=function(){var _a=this.elements,_b=_a[0],_c=_a[1],_d=_a[2],_e=_a[3],_f=_a[4],_g=_a[5],_h=_a[6],_i=_a[7],_j=_a[8];return _b*(_j*_f-_g*_i)+_c*(-_j*_e+_g*_h)+_d*(_i*_e-_f*_h)},_a.translate=function(_a,_b){var _c=_b.elements,_d=this.elements,_e=_a.elements,_f=_d[0],_g=_d[1],_h=_d[2],_i=_d[3],_j=_d[4],_k=_d[5],_l=_d[6],_m=_d[7],_n=_d[8],_o=_e[0],_p=_e[1];_c[0]=_f,_c[1]=_g,_c[2]=_h,_c[3]=_i,_c[4]=_j,_c[5]=_k,_c[6]=_o*_f+_p*_i+_l,_c[7]=_o*_g+_p*_j+_m,_c[8]=_o*_h+_p*_k+_n},_a.rotate=function(_a,_b){var _c=_b.elements,_d=this.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=_d[4],_j=_d[5],_k=_d[6],_l=_d[7],_m=_d[8],_n=Math.sin(_a),_o=Math.cos(_a);_c[0]=_o*_e+_n*_h,_c[1]=_o*_f+_n*_i,_c[2]=_o*_g+_n*_j,_c[3]=_o*_h-_n*_e,_c[4]=_o*_i-_n*_f,_c[5]=_o*_j-_n*_g,_c[6]=_k,_c[7]=_l,_c[8]=_m},_a.scale=function(_a,_b){var _c=_b.elements,_d=this.elements,_e=_a.elements,_f=_e[0],_g=_e[1];_c[0]=_f*_d[0],_c[1]=_f*_d[1],_c[2]=_f*_d[2],_c[3]=_g*_d[3],_c[4]=_g*_d[4],_c[5]=_g*_d[5],_c[6]=_d[6],_c[7]=_d[7],_c[8]=_d[8]},_a.invert=function(_a){var _b=_a.elements,_c=this.elements,_d=_c[0],_e=_c[1],_f=_c[2],_g=_c[3],_h=_c[4],_i=_c[5],_j=_c[6],_k=_c[7],_l=_c[8],_m=_l*_h-_i*_k,_n=-_l*_g+_i*_j,_o=_k*_g-_h*_j,_p=_d*_m+_e*_n+_f*_o;_p||(_a=null),_p=1/_p,_b[0]=_m*_p,_b[1]=(-_l*_e+_f*_k)*_p,_b[2]=(_i*_e-_f*_h)*_p,_b[3]=_n*_p,_b[4]=(_l*_d-_f*_j)*_p,_b[5]=(-_i*_d+_f*_g)*_p,_b[6]=_o*_p,_b[7]=(-_k*_d+_e*_j)*_p,_b[8]=(_h*_d-_e*_g)*_p},_a.transpose=function(_a){var _b=_a.elements,_c=this.elements;if(_a===this){var _d=_c[1],_e=_c[2],_f=_c[5];_b[1]=_c[3],_b[2]=_c[6],_b[3]=_d,_b[5]=_c[7],_b[6]=_e,_b[7]=_f}else _b[0]=_c[0],_b[1]=_c[3],_b[2]=_c[6],_b[3]=_c[1],_b[4]=_c[4],_b[5]=_c[7],_b[6]=_c[2],_b[7]=_c[5],_b[8]=_c[8]},_a.identity=function(){var _a=this.elements;_a[0]=1,_a[1]=0,_a[2]=0,_a[3]=0,_a[4]=1,_a[5]=0,_a[6]=0,_a[7]=0,_a[8]=1},_a.cloneTo=function(_a){var _b,_c,_d;if((_c=this.elements)!==(_d=_a.elements))for(_b=0;_b<9;++_b)_d[_b]=_c[_b]},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_i.createFromTranslation=function(_a,_b){_b.elements;var _c=_a.elements;_b[0]=1,_b[1]=0,_b[2]=0,_b[3]=0,_b[4]=1,_b[5]=0,_b[6]=_c[0],_b[7]=_c[1],_b[8]=1},_i.createFromRotation=function(_a,_b){var _c=_b.elements,_d=Math.sin(_a),_e=Math.cos(_a);_c[0]=_e,_c[1]=_d,_c[2]=0,_c[3]=-_d,_c[4]=_e,_c[5]=0,_c[6]=0,_c[7]=0,_c[8]=1},_i.createFromScaling=function(_a,_b){var _c=_b.elements,_d=_a.elements;_c[0]=_d[0],_c[1]=0,_c[2]=0,_c[3]=0,_c[4]=_d[1],_c[5]=0,_c[6]=0,_c[7]=0,_c[8]=1},_i.createFromMatrix4x4=function(_a,_b){_b[0]=_a[0],_b[1]=_a[1],_b[2]=_a[2],_b[3]=_a[4],_b[4]=_a[5],_b[5]=_a[6],_b[6]=_a[8],_b[7]=_a[9],_b[8]=_a[10]},_i.multiply=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements,_g=_e[0],_h=_e[1],_i=_e[2],_j=_e[3],_k=_e[4],_l=_e[5],_m=_e[6],_n=_e[7],_o=_e[8],_p=_f[0],_q=_f[1],_r=_f[2],_s=_f[3],_t=_f[4],_u=_f[5],_v=_f[6],_w=_f[7],_x=_f[8];_d[0]=_p*_g+_q*_j+_r*_m,_d[1]=_p*_h+_q*_k+_r*_n,_d[2]=_p*_i+_q*_l+_r*_o,_d[3]=_s*_g+_t*_j+_u*_m,_d[4]=_s*_h+_t*_k+_u*_n,_d[5]=_s*_i+_t*_l+_u*_o,_d[6]=_v*_g+_w*_j+_x*_m,_d[7]=_v*_h+_w*_k+_x*_n,_d[8]=_v*_i+_w*_l+_x*_o},_i.lookAt=function(_a,_b,_c,_d){_gb.subtract(_a,_b,_i._tempV30),_gb.normalize(_i._tempV30,_i._tempV30),_gb.cross(_c,_i._tempV30,_i._tempV31),_gb.normalize(_i._tempV31,_i._tempV31),_gb.cross(_i._tempV30,_i._tempV31,_i._tempV32);var _e=_i._tempV30.elements,_f=_i._tempV31.elements,_g=_i._tempV32.elements,_h=_d.elements;_h[0]=_f[0],_h[3]=_f[1],_h[6]=_f[2],_h[1]=_g[0],_h[4]=_g[1],_h[7]=_g[2],_h[2]=_e[0],_h[5]=_e[1],_h[8]=_e[2]},_i.DEFAULT=new _i,_l(_i,["_tempV30",function(){return this._tempV30=new _gb},"_tempV31",function(){return this._tempV31=new _gb},"_tempV32",function(){return this._tempV32=new _gb}]),_i}(),_ab=function(){function _z(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p){void 0===_a&&(_a=1),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_f&&(_f=1),void 0===_g&&(_g=0),void 0===_h&&(_h=0),void 0===_i&&(_i=0),void 0===_j&&(_j=0),void 0===_k&&(_k=1),void 0===_l&&(_l=0),void 0===_m&&(_m=0),void 0===_n&&(_n=0),void 0===_o&&(_o=0),void 0===_p&&(_p=1);var _q=this.elements=new Float32Array(16);_q[0]=_a,_q[1]=_b,_q[2]=_c,_q[3]=_d,_q[4]=_e,_q[5]=_f,_q[6]=_g,_q[7]=_h,_q[8]=_i,_q[9]=_j,_q[10]=_k,_q[11]=_l,_q[12]=_m,_q[13]=_n,_q[14]=_o,_q[15]=_p}_n(_z,"laya.d3.math.Matrix4x4");var _a=_z.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.getElementByRowColumn=function(_a,_b){if(_a<0||3<_a)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(_b<0||3<_b)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*_a+_b]},_a.setElementByRowColumn=function(_a,_b,_c){if(_a<0||3<_a)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(_b<0||3<_b)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*_a+_b]=_c},_a.equalsOtherMatrix=function(_a){var _b=this.elements,_c=_a.elements;return _$a.nearEqual(_b[0],_c[0])&&_$a.nearEqual(_b[1],_c[1])&&_$a.nearEqual(_b[2],_c[2])&&_$a.nearEqual(_b[3],_c[3])&&_$a.nearEqual(_b[4],_c[4])&&_$a.nearEqual(_b[5],_c[5])&&_$a.nearEqual(_b[6],_c[6])&&_$a.nearEqual(_b[7],_c[7])&&_$a.nearEqual(_b[8],_c[8])&&_$a.nearEqual(_b[9],_c[9])&&_$a.nearEqual(_b[10],_c[10])&&_$a.nearEqual(_b[11],_c[11])&&_$a.nearEqual(_b[12],_c[12])&&_$a.nearEqual(_b[13],_c[13])&&_$a.nearEqual(_b[14],_c[14])&&_$a.nearEqual(_b[15],_c[15])},_a.decomposeTransRotScale=function(_a,_b,_c){var _d=_z._tempMatrix4x4;return this.decomposeTransRotMatScale(_a,_d,_c)?(_cb.createFromMatrix4x4(_d,_b),!0):(_b.identity(),!1)},_a.decomposeTransRotMatScale=function(_a,_b,_c){var _d=this.elements,_e=_a.elements,_f=_b.elements,_g=_c.elements;_e[0]=_d[12],_e[1]=_d[13],_e[2]=_d[14];var _h=_d[0],_i=_d[1],_j=_d[2],_k=_d[4],_l=_d[5],_m=_d[6],_n=_d[8],_o=_d[9],_p=_d[10],_q=_g[0]=Math.sqrt(_h*_h+_i*_i+_j*_j),_r=_g[1]=Math.sqrt(_k*_k+_l*_l+_m*_m),_s=_g[2]=Math.sqrt(_n*_n+_o*_o+_p*_p);if(_$a.isZero(_q)||_$a.isZero(_r)||_$a.isZero(_s))return _f[1]=_f[2]=_f[3]=_f[4]=_f[6]=_f[7]=_f[8]=_f[9]=_f[11]=_f[12]=_f[13]=_f[14]=0,_f[0]=_f[5]=_f[10]=_f[15]=1,!1;var _t=_z._tempVector0,_u=_t.elements;_u[0]=_n/_s,_u[1]=_o/_s,_u[2]=_p/_s;var _v=_z._tempVector1,_w=_v.elements;_w[0]=_h/_q,_w[1]=_i/_q,_w[2]=_j/_q;var _x=_z._tempVector2;_gb.cross(_t,_v,_x);var _y=_z._tempVector1;return _gb.cross(_x,_t,_y),_f[3]=_f[7]=_f[11]=_f[12]=_f[13]=_f[14]=0,_f[15]=1,_f[0]=_y.x,_f[1]=_y.y,_f[2]=_y.z,_f[4]=_x.x,_f[5]=_x.y,_f[6]=_x.z,_f[8]=_t.x,_f[9]=_t.y,_f[10]=_t.z,_f[0]*_h+_f[1]*_i+_f[2]*_j<0&&(_g[0]=-_q),_f[4]*_k+_f[5]*_l+_f[6]*_m<0&&(_g[1]=-_r),_f[8]*_n+_f[9]*_o+_f[10]*_p<0&&(_g[2]=-_s),!0},_a.decomposeYawPitchRoll=function(_a){var _b=_a.elements,_c=Math.asin(-this.elements[9]);_b[1]=_c,Math.cos(_c)>_$a.zeroTolerance?(_b[2]=Math.atan2(this.elements[1],this.elements[5]),_b[0]=Math.atan2(this.elements[8],this.elements[10])):(_b[2]=Math.atan2(-this.elements[4],this.elements[0]),_b[0]=0)},_a.normalize=function(){var _a=this.elements,_b=_a[0],_c=_a[1],_d=_a[2],_e=Math.sqrt(_b*_b+_c*_c+_d*_d);if(!_e)return _a[0]=0,_a[1]=0,void(_a[2]=0);1!=_e&&(_e=1/_e,_a[0]=_b*_e,_a[1]=_c*_e,_a[2]=_d*_e)},_a.transpose=function(){var _a,_b;return _b=(_a=this.elements)[1],_a[1]=_a[4],_a[4]=_b,_b=_a[2],_a[2]=_a[8],_a[8]=_b,_b=_a[3],_a[3]=_a[12],_a[12]=_b,_b=_a[6],_a[6]=_a[9],_a[9]=_b,_b=_a[7],_a[7]=_a[13],_a[13]=_b,_b=_a[11],_a[11]=_a[14],_a[14]=_b,this},_a.invert=function(_a){var _b=this.elements,_c=_a.elements,_d=_b[0],_e=_b[1],_f=_b[2],_g=_b[3],_h=_b[4],_i=_b[5],_j=_b[6],_k=_b[7],_l=_b[8],_m=_b[9],_n=_b[10],_o=_b[11],_p=_b[12],_q=_b[13],_r=_b[14],_s=_b[15],_t=_d*_i-_e*_h,_u=_d*_j-_f*_h,_v=_d*_k-_g*_h,_w=_e*_j-_f*_i,_x=_e*_k-_g*_i,_y=_f*_k-_g*_j,_z=_l*_q-_m*_p,_A=_l*_r-_n*_p,_B=_l*_s-_o*_p,_C=_m*_r-_n*_q,_D=_m*_s-_o*_q,_E=_n*_s-_o*_r,_F=_t*_E-_u*_D+_v*_C+_w*_B-_x*_A+_y*_z;0!==Math.abs(_F)&&(_F=1/_F,_c[0]=(_i*_E-_j*_D+_k*_C)*_F,_c[1]=(_f*_D-_e*_E-_g*_C)*_F,_c[2]=(_q*_y-_r*_x+_s*_w)*_F,_c[3]=(_n*_x-_m*_y-_o*_w)*_F,_c[4]=(_j*_B-_h*_E-_k*_A)*_F,_c[5]=(_d*_E-_f*_B+_g*_A)*_F,_c[6]=(_r*_v-_p*_y-_s*_u)*_F,_c[7]=(_l*_y-_n*_v+_o*_u)*_F,_c[8]=(_h*_D-_i*_B+_k*_z)*_F,_c[9]=(_e*_B-_d*_D-_g*_z)*_F,_c[10]=(_p*_x-_q*_v+_s*_t)*_F,_c[11]=(_m*_v-_l*_x-_o*_t)*_F,_c[12]=(_i*_A-_h*_C-_j*_z)*_F,_c[13]=(_d*_C-_e*_A+_f*_z)*_F,_c[14]=(_q*_u-_p*_w-_r*_t)*_F,_c[15]=(_l*_w-_m*_u+_n*_t)*_F)},_a.identity=function(){var _a=this.elements;_a[1]=_a[2]=_a[3]=_a[4]=_a[6]=_a[7]=_a[8]=_a[9]=_a[11]=_a[12]=_a[13]=_a[14]=0,_a[0]=_a[5]=_a[10]=_a[15]=1},_a.cloneTo=function(_a){var _b,_c,_d;if((_c=this.elements)!==(_d=_a.elements))for(_b=0;_b<16;++_b)_d[_b]=_c[_b]},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_a.getTranslationVector=function(_a){var _b=this.elements,_c=_a.elements;_c[0]=_b[12],_c[1]=_b[13],_c[2]=_b[14]},_a.setTranslationVector=function(_a){var _b=this.elements,_c=_a.elements;_b[12]=_c[0],_b[13]=_c[1],_b[14]=_c[2]},_a.getForward=function(_a){var _b=this.elements,_c=_a.elements;_c[0]=-_b[8],_c[1]=-_b[9],_c[2]=-_b[10]},_a.setForward=function(_a){var _b=this.elements,_c=_a.elements;_b[8]=-_c[0],_b[9]=-_c[1],_b[10]=-_c[2]},_z.createRotationX=function(_a,_b){var _c=_b.elements,_d=Math.sin(_a),_e=Math.cos(_a);_c[1]=_c[2]=_c[3]=_c[4]=_c[7]=_c[8]=_c[11]=_c[12]=_c[13]=_c[14]=0,_c[0]=_c[15]=1,_c[5]=_c[10]=_e,_c[6]=_d,_c[9]=-_d},_z.createRotationY=function(_a,_b){var _c=_b.elements,_d=Math.sin(_a),_e=Math.cos(_a);_c[1]=_c[3]=_c[4]=_c[6]=_c[7]=_c[9]=_c[11]=_c[12]=_c[13]=_c[14]=0,_c[5]=_c[15]=1,_c[0]=_c[10]=_e,_c[2]=-_d,_c[8]=_d},_z.createRotationZ=function(_a,_b){var _c=_b.elements,_d=Math.sin(_a),_e=Math.cos(_a);_c[2]=_c[3]=_c[6]=_c[7]=_c[8]=_c[9]=_c[11]=_c[12]=_c[13]=_c[14]=0,_c[10]=_c[15]=1,_c[0]=_c[5]=_e,_c[1]=_d,_c[4]=-_d},_z.createRotationYawPitchRoll=function(_a,_b,_c,_d){_cb.createFromYawPitchRoll(_a,_b,_c,_z._tempQuaternion),_z.createRotationQuaternion(_z._tempQuaternion,_d)},_z.createRotationAxis=function(_a,_b,_c){var _d=_a.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=Math.cos(_b),_i=Math.sin(_b),_j=_e*_e,_k=_f*_f,_l=_g*_g,_m=_e*_f,_n=_e*_g,_o=_f*_g,_p=_c.elements;_p[3]=_p[7]=_p[11]=_p[12]=_p[13]=_p[14]=0,_p[15]=1,_p[0]=_j+_h*(1-_j),_p[1]=_m-_h*_m+_i*_g,_p[2]=_n-_h*_n-_i*_f,_p[4]=_m-_h*_m-_i*_g,_p[5]=_k+_h*(1-_k),_p[6]=_o-_h*_o+_i*_e,_p[8]=_n-_h*_n+_i*_f,_p[9]=_o-_h*_o-_i*_e,_p[10]=_l+_h*(1-_l)},_z.createRotationQuaternion=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0],_f=_c[1],_g=_c[2],_h=_c[3],_i=_e*_e,_j=_f*_f,_k=_g*_g,_l=_e*_f,_m=_g*_h,_n=_g*_e,_o=_f*_h,_p=_f*_g,_q=_e*_h;_d[3]=_d[7]=_d[11]=_d[12]=_d[13]=_d[14]=0,_d[15]=1,_d[0]=1-2*(_j+_k),_d[1]=2*(_l+_m),_d[2]=2*(_n-_o),_d[4]=2*(_l-_m),_d[5]=1-2*(_k+_i),_d[6]=2*(_p+_q),_d[8]=2*(_n+_o),_d[9]=2*(_p-_q),_d[10]=1-2*(_j+_i)},_z.createTranslate=function(_a,_b){var _c=_a.elements,_d=_b.elements;_d[4]=_d[8]=_d[1]=_d[9]=_d[2]=_d[6]=_d[3]=_d[7]=_d[11]=0,_d[0]=_d[5]=_d[10]=_d[15]=1,_d[12]=_c[0],_d[13]=_c[1],_d[14]=_c[2]},_z.createScaling=function(_a,_b){var _c=_a.elements,_d=_b.elements;_d[0]=_c[0],_d[5]=_c[1],_d[10]=_c[2],_d[1]=_d[4]=_d[8]=_d[12]=_d[9]=_d[13]=_d[2]=_d[6]=_d[14]=_d[3]=_d[7]=_d[11]=0,_d[15]=1},_z.multiply=function(_a,_b,_c){var _d,_e,_f,_g,_h,_i,_j,_k;for(_e=_c.elements,_f=_a.elements,_e===(_g=_b.elements)&&(_g=_g.slice()),_d=0;_d<4;_d++)_h=_f[_d],_i=_f[_d+4],_j=_f[_d+8],_k=_f[_d+12],_e[_d]=_h*_g[0]+_i*_g[1]+_j*_g[2]+_k*_g[3],_e[_d+4]=_h*_g[4]+_i*_g[5]+_j*_g[6]+_k*_g[7],_e[_d+8]=_h*_g[8]+_i*_g[9]+_j*_g[10]+_k*_g[11],_e[_d+12]=_h*_g[12]+_i*_g[13]+_j*_g[14]+_k*_g[15]},_z.createFromQuaternion=function(_a,_b){var _c=_b.elements,_d=_a.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=_e+_e,_j=_f+_f,_k=_g+_g,_l=_e*_i,_m=_f*_i,_n=_f*_j,_o=_g*_i,_p=_g*_j,_q=_g*_k,_r=_h*_i,_s=_h*_j,_t=_h*_k;_c[0]=1-_n-_q,_c[1]=_m+_t,_c[2]=_o-_s,_c[3]=0,_c[4]=_m-_t,_c[5]=1-_l-_q,_c[6]=_p+_r,_c[7]=0,_c[8]=_o+_s,_c[9]=_p-_r,_c[10]=1-_l-_n,_c[11]=0,_c[12]=0,_c[13]=0,_c[14]=0,_c[15]=1},_z.createAffineTransformation=function(_a,_b,_c,_d){var _e=_a.elements,_f=_b.elements,_g=_c.elements,_h=_d.elements,_i=_f[0],_j=_f[1],_k=_f[2],_l=_f[3],_m=_i+_i,_n=_j+_j,_o=_k+_k,_p=_i*_m,_q=_i*_n,_r=_i*_o,_s=_j*_n,_t=_j*_o,_u=_k*_o,_v=_l*_m,_w=_l*_n,_x=_l*_o,_y=_g[0],_z=_g[1],_A=_g[2];_h[0]=(1-(_s+_u))*_y,_h[1]=(_q+_x)*_y,_h[2]=(_r-_w)*_y,_h[3]=0,_h[4]=(_q-_x)*_z,_h[5]=(1-(_p+_u))*_z,_h[6]=(_t+_v)*_z,_h[7]=0,_h[8]=(_r+_w)*_A,_h[9]=(_t-_v)*_A,_h[10]=(1-(_p+_s))*_A,_h[11]=0,_h[12]=_e[0],_h[13]=_e[1],_h[14]=_e[2],_h[15]=1},_z.createLookAt=function(_a,_b,_c,_d){var _e=_d.elements,_f=_z._tempVector0,_g=_z._tempVector1,_h=_z._tempVector2;_gb.subtract(_a,_b,_h),_gb.normalize(_h,_h),_gb.cross(_c,_h,_f),_gb.normalize(_f,_f),_gb.cross(_h,_f,_g),_d.identity(),_e[0]=_f.x,_e[4]=_f.y,_e[8]=_f.z,_e[1]=_g.x,_e[5]=_g.y,_e[9]=_g.z,_e[2]=_h.x,_e[6]=_h.y,_e[10]=_h.z,_e[12]=-_gb.dot(_f,_a),_e[13]=-_gb.dot(_g,_a),_e[14]=-_gb.dot(_h,_a)},_z.createPerspective=function(_a,_b,_c,_d,_e){var _f=_e.elements,_g=1/Math.tan(_a/2),_h=1/(_c-_d);_f[0]=_g/_b,_f[5]=_g,_f[10]=(_d+_c)*_h,_f[11]=-1,_f[14]=2*_d*_c*_h,_f[1]=_f[2]=_f[3]=_f[4]=_f[6]=_f[7]=_f[8]=_f[9]=_f[12]=_f[13]=_f[15]=0},_z.createOrthoOffCenterRH=function(_a,_b,_c,_d,_e,_f,_g){var _h=_g.elements,_i=1/(_a-_b),_j=1/(_c-_d),_k=1/(_e-_f);_h[1]=_h[2]=_h[3]=_h[4]=_h[6]=_h[7]=_h[8]=_h[9]=_h[11]=0,_h[15]=1,_h[0]=-2*_i,_h[5]=-2*_j,_h[10]=2*_k,_h[12]=(_a+_b)*_i,_h[13]=(_d+_c)*_j,_h[14]=(_f+_e)*_k},_z.translation=function(_a,_b){var _c=_a.elements,_d=_b.elements;_d[0]=_d[5]=_d[10]=_d[15]=1,_d[12]=_c[0],_d[13]=_c[1],_d[14]=_c[2]},_l(_z,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new _z},"_tempVector0",function(){return this._tempVector0=new _gb},"_tempVector1",function(){return this._tempVector1=new _gb},"_tempVector2",function(){return this._tempVector2=new _gb},"_tempQuaternion",function(){return this._tempQuaternion=new _cb},"DEFAULT",function(){return this.DEFAULT=new _z},"ZERO",function(){return this.ZERO=new _z(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),_z}(),_bb=(function(){function _t(_a,_b){this.extents=null,this.transformation=null,this.extents=_a,this.transformation=_b}_n(_t,"laya.d3.math.OrientedBoundBox");var _a=_t.prototype;_a.getCorners=function(_a){var _b=_t._tempV30.elements,_c=_t._tempV31.elements,_d=_t._tempV32.elements,_e=this.extents.elements;_b[0]=_e[0],_b[1]=_b[2]=0,_c[1]=_e[1],_c[0]=_c[2]=0,_d[2]=_e[2],_d[0]=_d[1]=0,_gb.TransformNormal(_t._tempV30,this.transformation,_t._tempV30),_gb.TransformNormal(_t._tempV31,this.transformation,_t._tempV31),_gb.TransformNormal(_t._tempV32,this.transformation,_t._tempV32);var _f=_t._tempV33;this.transformation.getTranslationVector(_f),_a.length=8,_gb.add(_f,_t._tempV30,_t._tempV34),_gb.add(_t._tempV34,_t._tempV31,_t._tempV34),_gb.add(_t._tempV34,_t._tempV32,_a[0]),_gb.add(_f,_t._tempV30,_t._tempV34),_gb.add(_t._tempV34,_t._tempV31,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV32,_a[1]),_gb.subtract(_f,_t._tempV30,_t._tempV34),_gb.add(_t._tempV34,_t._tempV31,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV32,_a[2]),_gb.subtract(_f,_t._tempV30,_t._tempV34),_gb.add(_t._tempV34,_t._tempV31,_t._tempV34),_gb.add(_t._tempV34,_t._tempV32,_a[3]),_gb.add(_f,_t._tempV30,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV31,_t._tempV34),_gb.add(_t._tempV34,_t._tempV32,_a[4]),_gb.add(_f,_t._tempV30,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV31,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV32,_a[5]),_gb.subtract(_f,_t._tempV30,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV31,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV32,_a[6]),_gb.subtract(_f,_t._tempV30,_t._tempV34),_gb.subtract(_t._tempV34,_t._tempV31,_t._tempV34),_gb.add(_t._tempV34,_t._tempV32,_a[7])},_a.transform=function(_a){_ab.multiply(this.transformation,_a,this.transformation)},_a.scale=function(_a){_gb.multiply(this.extents,_a,this.extents)},_a.translate=function(_a){this.transformation.getTranslationVector(_t._tempV30),_gb.add(_t._tempV30,_a,_t._tempV31),this.transformation.setTranslationVector(_t._tempV31)},_a.Size=function(_a){_gb.scale(this.extents,2,_a)},_a.getSize=function(_a){var _b=this.extents.elements;_t._tempV30.x=_b[0],_t._tempV31.y=_b[1],_t._tempV32.z=_b[2],_gb.TransformNormal(_t._tempV30,this.transformation,_t._tempV30),_gb.TransformNormal(_t._tempV31,this.transformation,_t._tempV31),_gb.TransformNormal(_t._tempV31,this.transformation,_t._tempV32);var _c=_a.elements;_c[0]=_gb.scalarLength(_t._tempV30),_c[1]=_gb.scalarLength(_t._tempV31),_c[2]=_gb.scalarLength(_t._tempV32)},_a.getSizeSquared=function(_a){var _b=this.extents.elements;_t._tempV30.x=_b[0],_t._tempV31.y=_b[1],_t._tempV32.z=_b[2],_gb.TransformNormal(_t._tempV30,this.transformation,_t._tempV30),_gb.TransformNormal(_t._tempV31,this.transformation,_t._tempV31),_gb.TransformNormal(_t._tempV31,this.transformation,_t._tempV32);var _c=_a.elements;_c[0]=_gb.scalarLengthSquared(_t._tempV30),_c[1]=_gb.scalarLengthSquared(_t._tempV31),_c[2]=_gb.scalarLengthSquared(_t._tempV32)},_a.getCenter=function(_a){this.transformation.getTranslationVector(_a)},_a.containsPoint=function(_a){var _b=this.extents.elements,_c=_b[0],_d=_b[1],_e=_b[2];this.transformation.invert(_t._tempM0),_gb.transformCoordinate(_a,_t._tempM0,_t._tempV30);var _f=_t._tempV30.elements,_g=Math.abs(_f[0]),_h=Math.abs(_f[1]),_i=Math.abs(_f[2]);return _$a.nearEqual(_g,_c)&&_$a.nearEqual(_h,_d)&&_$a.nearEqual(_i,_e)?2:_g<_c&&_h<_d&&_i<_e?1:0},_a.containsPoints=function(_a){var _b=this.extents.elements,_c=_b[0],_d=_b[1],_e=_b[2];this.transformation.invert(_t._tempM0);for(var _f=!0,_g=!1,_h=0;_h<_a.length;_h++){_gb.transformCoordinate(_a[_h],_t._tempM0,_t._tempV30);var _i=_t._tempV30.elements,_j=Math.abs(_i[0]),_k=Math.abs(_i[1]),_l=Math.abs(_i[2]);_$a.nearEqual(_j,_c)&&_$a.nearEqual(_k,_d)&&_$a.nearEqual(_l,_e)&&(_g=!0),_j<_c&&_k<_d&&_l<_e?_g=!0:_f=!1}return _f?1:_g?2:0},_a.containsSphere=function(_a,_b){void 0===_b&&(_b=!1);var _c=this.extents.elements,_d=_c[0],_e=_c[1],_f=_c[2],_g=_a.radius;this.transformation.invert(_t._tempM0),_gb.transformCoordinate(_a.center,_t._tempM0,_t._tempV30);var _h=NaN;if(_h=_b?_g:(_gb.scale(_gb.UnitX,_g,_t._tempV31),_gb.TransformNormal(_t._tempV31,_t._tempM0,_t._tempV31),_gb.scalarLength(_t._tempV31)),_gb.scale(this.extents,-1,_t._tempV32),_gb.Clamp(_t._tempV30,_t._tempV32,this.extents,_t._tempV33),_h*_h<_gb.distanceSquared(_t._tempV30,_t._tempV33))return 0;var _i=_t._tempV30.elements,_j=_i[0],_k=_i[1],_l=_i[2],_m=_t._tempV32.elements,_n=_m[0],_o=_m[1],_p=_m[2];return _n+_h<=_j&&_j<=_d-_h&&_h<_d-_n&&_o+_h<=_k&&_k<=_e-_h&&_h<_e-_o&&_p+_h<=_l&&_l<=_f-_h&&_h<_f-_p?1:2},_a.containsOrientedBoundBox=function(_a){var _b=0,_c=0;_a.getCorners(_t._corners);var _d=this.containsPoints(_t._corners);if(0!=_d)return _d;var _e=this.extents.elements;_a.extents.cloneTo(_t._tempV35);var _f=_t._tempV35.elements;_t._getRows(this.transformation,_t._rows1),_t._getRows(_a.transformation,_t._rows2);var _g=NaN;for(_b=0;_b<4;_b++)for(_c=0;_c<4;_c++)3==_b||3==_c?(_t._tempM0.setElementByRowColumn(_b,_c,0),_t._tempM1.setElementByRowColumn(_b,_c,0)):(_g=_gb.dot(_t._rows1[_b],_t._rows2[_c]),_t._tempM0.setElementByRowColumn(_b,_c,_g),_t._tempM1.setElementByRowColumn(_b,_c,Math.abs(_g)));_a.getCenter(_t._tempV34),this.getCenter(_t._tempV36),_gb.subtract(_t._tempV34,_t._tempV36,_t._tempV30);var _h=_t._tempV31.elements;_h[0]=_gb.dot(_t._tempV30,_t._rows1[0]),_h[1]=_gb.dot(_t._tempV30,_t._rows1[1]),_h[2]=_gb.dot(_t._tempV30,_t._rows1[2]);var _i=_t._tempV32.elements,_j=_t._tempV33.elements;for(_b=0;_b<3;_b++)if(_i[0]=_t._tempM1.getElementByRowColumn(_b,0),_i[1]=_t._tempM1.getElementByRowColumn(_b,1),_i[2]=_t._tempM1.getElementByRowColumn(_b,2),_e[_b]+_gb.dot(_t._tempV35,_t._tempV32)<Math.abs(_h[_b]))return 0;for(_c=0;_c<3;_c++)if(_i[0]=_t._tempM1.getElementByRowColumn(0,_c),_i[1]=_t._tempM1.getElementByRowColumn(1,_c),_i[2]=_t._tempM1.getElementByRowColumn(2,_c),_j[0]=_t._tempM0.getElementByRowColumn(0,_c),_j[1]=_t._tempM0.getElementByRowColumn(1,_c),_j[2]=_t._tempM0.getElementByRowColumn(2,_c),_gb.dot(this.extents,_t._tempV32)+_f[_c]<Math.abs(_gb.dot(_t._tempV31,_t._tempV33)))return 0;for(_b=0;_b<3;_b++)for(_c=0;_c<3;_c++){var _k=(_b+1)%3,_l=(_b+2)%3,_m=(_c+1)%3,_n=(_c+2)%3;if(_e[_k]*_t._tempM1.getElementByRowColumn(_l,_c)+_e[_l]*_t._tempM1.getElementByRowColumn(_k,_c)+(_f[_m]*_t._tempM1.getElementByRowColumn(_b,_n)+_f[_n]*_t._tempM1.getElementByRowColumn(_b,_m))<Math.abs(_h[_l]*_t._tempM0.getElementByRowColumn(_k,_c)-_h[_k]*_t._tempM0.getElementByRowColumn(_l,_c)))return 0}return 2},_a.containsLine=function(_a,_b){_t._corners[0]=_a,_t._corners[1]=_b;var _c=this.containsPoints(_t._corners);if(0!=_c)return _c;var _d=this.extents.elements,_e=_d[0],_f=_d[1],_g=_d[2];this.transformation.invert(_t._tempM0),_gb.transformCoordinate(_a,_t._tempM0,_t._tempV30),_gb.transformCoordinate(_b,_t._tempM0,_t._tempV31),_gb.add(_t._tempV30,_t._tempV31,_t._tempV32),_gb.scale(_t._tempV32,.5,_t._tempV32),_gb.subtract(_t._tempV30,_t._tempV32,_t._tempV33);var _h=_t._tempV33.elements,_i=_h[0],_j=_h[1],_k=_h[2],_l=_t._tempV34.elements,_m=_l[0]=Math.abs(_h[0]),_n=_l[1]=Math.abs(_h[1]),_o=_l[2]=Math.abs(_h[2]),_p=_t._tempV32.elements,_q=_p[0],_r=_p[1],_s=_p[2];return Math.abs(_q)>_e+_m?0:Math.abs(_r)>_f+_n?0:Math.abs(_s)>_g+_o?0:Math.abs(_r*_k-_s*_j)>_f*_o+_g*_n?0:Math.abs(_q*_k-_s*_i)>_e*_o+_g*_m?0:Math.abs(_q*_j-_r*_i)>_e*_n+_f*_m?0:2},_a.containsBoundBox=function(_a){var _b=0,_c=0,_d=_a.min,_e=_a.max;_a.getCorners(_t._corners);var _f=this.containsPoints(_t._corners);if(0!=_f)return _f;_gb.subtract(_e,_d,_t._tempV30),_gb.scale(_t._tempV30,.5,_t._tempV30),_gb.add(_d,_t._tempV30,_t._tempV30),_gb.subtract(_e,_t._tempV30,_t._tempV31);var _g=this.extents.elements,_h=_t._tempV31.elements;_t._getRows(this.transformation,_t._rows1),this.transformation.invert(_t._tempM0);for(_b=0;_b<3;_b++)for(_c=0;_c<3;_c++)_t._tempM1.setElementByRowColumn(_b,_c,Math.abs(_t._tempM0.getElementByRowColumn(_b,_c)));this.getCenter(_t._tempV35),_gb.subtract(_t._tempV30,_t._tempV35,_t._tempV32);var _i=_t._tempV31.elements;_i[0]=_gb.dot(_t._tempV32,_t._rows1[0]),_i[1]=_gb.dot(_t._tempV32,_t._rows1[1]),_i[2]=_gb.dot(_t._tempV32,_t._rows1[2]);var _j=_t._tempV33.elements,_k=_t._tempV34.elements;for(_b=0;_b<3;_b++)if(_j[0]=_t._tempM1.getElementByRowColumn(_b,0),_j[1]=_t._tempM1.getElementByRowColumn(_b,1),_j[2]=_t._tempM1.getElementByRowColumn(_b,2),_g[_b]+_gb.dot(_t._tempV31,_t._tempV33)<Math.abs(_i[_b]))return 0;for(_c=0;_c<3;_c++)if(_j[0]=_t._tempM1.getElementByRowColumn(0,_c),_j[1]=_t._tempM1.getElementByRowColumn(1,_c),_j[2]=_t._tempM1.getElementByRowColumn(2,_c),_k[0]=_t._tempM0.getElementByRowColumn(0,_c),_k[1]=_t._tempM0.getElementByRowColumn(1,_c),_k[2]=_t._tempM0.getElementByRowColumn(2,_c),_gb.dot(this.extents,_t._tempV33)+_h[_c]<Math.abs(_gb.dot(_t._tempV31,_t._tempV34)))return 0;for(_b=0;_b<3;_b++)for(_c=0;_c<3;_c++){var _l=(_b+1)%3,_m=(_b+2)%3,_n=(_c+1)%3,_o=(_c+2)%3;if(_g[_l]*_t._tempM1.getElementByRowColumn(_m,_c)+_g[_m]*_t._tempM1.getElementByRowColumn(_l,_c)+(_h[_n]*_t._tempM1.getElementByRowColumn(_b,_o)+_h[_o]*_t._tempM1.getElementByRowColumn(_b,_n))<Math.abs(_i[_m]*_t._tempM0.getElementByRowColumn(_l,_c)-_i[_l]*_t._tempM0.getElementByRowColumn(_m,_c)))return 0}return 2},_a.intersectsRay=function(_a,_b){_gb.scale(this.extents,-1,_t._tempV30),this.transformation.invert(_t._tempM0),_gb.TransformNormal(_a.direction,_t._tempM0,_t._ray.direction),_gb.transformCoordinate(_a.origin,_t._tempM0,_t._ray.origin),_t._boxBound1.min=_t._tempV30,_t._boxBound1.max=this.extents;var _c=Collision.intersectsRayAndBoxRP(_t._ray,_t._boxBound1,_b);return-1!==_c&&_gb.transformCoordinate(_b,this.transformation,_b),_c},_a._getLocalCorners=function(_a){_a.length=8;var _b=this.extents.elements;_t._tempV30.x=_b[0],_t._tempV31.y=_b[1],_t._tempV32.z=_b[2],_gb.add(_t._tempV30,_t._tempV31,_t._tempV33),_gb.add(_t._tempV33,_t._tempV32,_a[0]),_gb.add(_t._tempV30,_t._tempV31,_t._tempV33),_gb.subtract(_t._tempV33,_t._tempV32,_a[1]),_gb.subtract(_t._tempV31,_t._tempV30,_t._tempV33),_gb.subtract(_t._tempV33,_t._tempV30,_a[2]),_gb.subtract(_t._tempV31,_t._tempV30,_t._tempV33),_gb.add(_t._tempV33,_t._tempV32,_a[3]),_gb.subtract(_t._tempV30,_t._tempV31,_t._tempV33),_gb.add(_t._tempV33,_t._tempV32,_a[4]),_gb.subtract(_t._tempV30,_t._tempV31,_t._tempV33),_gb.subtract(_t._tempV33,_t._tempV32,_a[5]),_gb.scale(_a[0],-1,_a[6]),_gb.subtract(_t._tempV32,_t._tempV30,_t._tempV33),_gb.subtract(_t._tempV33,_t._tempV31,_a[7])},_a.equals=function(_a){return this.extents==_a.extents&&this.transformation==_a.transformation},_a.cloneTo=function(_a){var _b=_a;this.extents.cloneTo(_b.extents),this.transformation.cloneTo(_b.transformation)},_t.createByBoundBox=function(_a,_b){var _c=_a.min,_d=_a.max;_gb.subtract(_d,_c,_t._tempV30),_gb.scale(_t._tempV30,.5,_t._tempV30),_gb.add(_c,_t._tempV30,_t._tempV31),_gb.subtract(_d,_t._tempV31,_t._tempV32),_ab.translation(_t._tempV31,_t._tempM0);var _e=_t._tempV32.clone(),_f=_t._tempM0.clone();_b.extents=_e,_b.transformation=_f},_t.createByMinAndMaxVertex=function(_a,_b){return _gb.subtract(_b,_a,_t._tempV30),_gb.scale(_t._tempV30,.5,_t._tempV30),_gb.add(_a,_t._tempV30,_t._tempV31),_gb.subtract(_b,_t._tempV31,_t._tempV32),_ab.translation(_t._tempV31,_t._tempM0),new _t(_t._tempV32,_t._tempM0)},_t._getRows=function(_a,_b){_b.length=3;var _c=_a.elements,_d=_b[0].elements;_d[0]=_c[0],_d[1]=_c[1],_d[2]=_c[2];var _e=_b[1].elements;_e[0]=_c[4],_e[1]=_c[5],_e[2]=_c[6];var _f=_b[2].elements;_f[0]=_c[8],_f[1]=_c[9],_f[2]=_c[10]},_t.getObbtoObbMatrix4x4=function(_a,_b,_c,_d){var _e=_a.transformation,_f=_b.transformation;if(_c){_t._getRows(_e,_t._rows1),_t._getRows(_f,_t._rows2);for(var _g=0;_g<3;_g++)for(var _h=0;_h<3;_h++)_d.setElementByRowColumn(_g,_h,_gb.dot(_t._rows2[_g],_t._rows1[_h]));_b.getCenter(_t._tempV30),_a.getCenter(_t._tempV31),_gb.subtract(_t._tempV30,_t._tempV31,_t._tempV32);var _i=_d.elements;_i[12]=_gb.dot(_t._tempV32,_t._rows1[0]),_i[13]=_gb.dot(_t._tempV32,_t._rows1[1]),_i[14]=_gb.dot(_t._tempV32,_t._rows1[2]),_i[15]=1}else _e.invert(_t._tempM0),_ab.multiply(_f,_t._tempM0,_d)},_t.merge=function(_a,_b,_c){var _d=_a.extents,_e=_a.transformation;_t.getObbtoObbMatrix4x4(_a,_b,_c,_t._tempM0),_b._getLocalCorners(_t._corners),_gb.transformCoordinate(_t._corners[0],_t._tempM0,_t._corners[0]),_gb.transformCoordinate(_t._corners[1],_t._tempM0,_t._corners[1]),_gb.transformCoordinate(_t._corners[2],_t._tempM0,_t._corners[2]),_gb.transformCoordinate(_t._corners[3],_t._tempM0,_t._corners[3]),_gb.transformCoordinate(_t._corners[4],_t._tempM0,_t._corners[4]),_gb.transformCoordinate(_t._corners[5],_t._tempM0,_t._corners[5]),_gb.transformCoordinate(_t._corners[6],_t._tempM0,_t._corners[6]),_gb.transformCoordinate(_t._corners[7],_t._tempM0,_t._corners[7]),_gb.scale(_d,-1,_t._boxBound1.min),_d.cloneTo(_t._boxBound1.max),_Xa.createfromPoints(_t._corners,_t._boxBound2),_Xa.merge(_t._boxBound2,_t._boxBound1,_t._boxBound3);var _f=_t._boxBound3.min,_g=_t._boxBound3.max;_gb.subtract(_g,_f,_t._tempV30),_gb.scale(_t._tempV30,.5,_t._tempV30),_gb.add(_f,_t._tempV30,_t._tempV32),_gb.subtract(_g,_t._tempV32,_d),_gb.transformCoordinate(_t._tempV32,_e,_t._tempV33)},_l(_t,["_tempV30",function(){return this._tempV30=new _gb},"_tempV31",function(){return this._tempV31=new _gb},"_tempV32",function(){return this._tempV32=new _gb},"_tempV33",function(){return this._tempV33=new _gb},"_tempV34",function(){return this._tempV34=new _gb},"_tempV35",function(){return this._tempV35=new _gb},"_tempV36",function(){return this._tempV36=new _gb},"_tempM0",function(){return this._tempM0=new _ab},"_tempM1",function(){return this._tempM1=new _ab},"_corners",function(){return this._corners=[new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb]},"_rows1",function(){return this._rows1=[new _gb,new _gb,new _gb]},"_rows2",function(){return this._rows2=[new _gb,new _gb,new _gb]},"_ray",function(){return this._ray=new _eb(new _gb,new _gb)},"_boxBound1",function(){return this._boxBound1=new _Xa(new _gb,new _gb)},"_boxBound2",function(){return this._boxBound2=new _Xa(new _gb,new _gb)},"_boxBound3",function(){return this._boxBound3=new _Xa(new _gb,new _gb)}])}(),function(){function _v(_a,_b){this.normal=null,this.distance=NaN,void 0===_b&&(_b=0),this.normal=_a,this.distance=_b}return _n(_v,"laya.d3.math.Plane"),_v.prototype.normalize=function(){var _a=this.normal.elements,_b=_a[0],_c=_a[1],_d=_a[2],_e=1/Math.sqrt(_b*_b+_c*_c+_d*_d);_a[0]=_b*_e,_a[1]=_c*_e,_a[2]=_d*_e,this.distance*=_e},_v.createPlaneBy3P=function(_a,_b,_c){var _d=_a.elements,_e=_b.elements,_f=_c.elements,_g=_e[0]-_d[0],_h=_e[1]-_d[1],_i=_e[2]-_d[2],_j=_f[0]-_d[0],_k=_f[1]-_d[1],_l=_f[2]-_d[2],_m=_h*_l-_i*_k,_n=_i*_j-_g*_l,_o=_g*_k-_h*_j,_p=1/Math.sqrt(_m*_m+_n*_n+_o*_o),_q=_m*_p,_r=_n*_p,_s=_o*_p,_t=_v._TEMPVec3.elements;_t[0]=_q,_t[1]=_r,_t[2]=_s;var _u=-(_q*_d[0]+_r*_d[1]+_s*_d[2]);return new _v(_v._TEMPVec3,_u)},_v.PlaneIntersectionType_Back=0,_v.PlaneIntersectionType_Front=1,_v.PlaneIntersectionType_Intersecting=2,_l(_v,["_TEMPVec3",function(){return this._TEMPVec3=new _gb}]),_v}()),_cb=function(){function _e(_a,_b,_c,_d){this.elements=new Float32Array(4),void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=1),this.elements[0]=_a,this.elements[1]=_b,this.elements[2]=_c,this.elements[3]=_d}_n(_e,"laya.d3.math.Quaternion");var _a=_e.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.scaling=function(_a,_b){var _c=_b.elements,_d=this.elements;_c[0]=_d[0]*_a,_c[1]=_d[1]*_a,_c[2]=_d[2]*_a,_c[3]=_d[3]*_a},_a.normalize=function(_a){var _b=_a.elements,_c=this.elements,_d=_c[0],_e=_c[1],_f=_c[2],_g=_c[3],_h=_d*_d+_e*_e+_f*_f+_g*_g;0<_h&&(_h=1/Math.sqrt(_h),_b[0]=_d*_h,_b[1]=_e*_h,_b[2]=_f*_h,_b[3]=_g*_h)},_a.length=function(){var _a=this.elements,_b=_a[0],_c=_a[1],_d=_a[2],_e=_a[3];return Math.sqrt(_b*_b+_c*_c+_d*_d+_e*_e)},_a.rotateX=function(_a,_b){var _c=_b.elements,_d=this.elements;_a*=.5;var _e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=Math.sin(_a),_j=Math.cos(_a);_c[0]=_e*_j+_h*_i,_c[1]=_f*_j+_g*_i,_c[2]=_g*_j-_f*_i,_c[3]=_h*_j-_e*_i},_a.rotateY=function(_a,_b){var _c=_b.elements,_d=this.elements;_a*=.5;var _e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=Math.sin(_a),_j=Math.cos(_a);_c[0]=_e*_j-_g*_i,_c[1]=_f*_j+_h*_i,_c[2]=_g*_j+_e*_i,_c[3]=_h*_j-_f*_i},_a.rotateZ=function(_a,_b){var _c=_b.elements,_d=this.elements;_a*=.5;var _e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=Math.sin(_a),_j=Math.cos(_a);_c[0]=_e*_j+_f*_i,_c[1]=_f*_j-_e*_i,_c[2]=_g*_j+_h*_i,_c[3]=_h*_j-_g*_i},_a.getYawPitchRoll=function(_a){_gb.transformQuat(_gb.ForwardRH,this,_e.TEMPVector31),_gb.transformQuat(_gb.Up,this,_e.TEMPVector32);var _b=_e.TEMPVector32.elements;_e.angleTo(_gb.ZERO,_e.TEMPVector31,_e.TEMPVector33);var _c=_e.TEMPVector33.elements;_c[0]==Math.PI/2?(_c[1]=_e.arcTanAngle(_b[2],_b[0]),_c[2]=0):_c[0]==-Math.PI/2?(_c[1]=_e.arcTanAngle(-_b[2],-_b[0]),_c[2]=0):(_ab.createRotationY(-_c[1],_e.TEMPMatrix0),_ab.createRotationX(-_c[0],_e.TEMPMatrix1),_gb.transformCoordinate(_e.TEMPVector32,_e.TEMPMatrix0,_e.TEMPVector32),_gb.transformCoordinate(_e.TEMPVector32,_e.TEMPMatrix1,_e.TEMPVector32),_c[2]=_e.arcTanAngle(_b[1],-_b[0])),_c[1]<=-Math.PI&&(_c[1]=Math.PI),_c[2]<=-Math.PI&&(_c[2]=Math.PI),_c[1]>=Math.PI&&_c[2]>=Math.PI&&(_c[1]=0,_c[2]=0,_c[0]=Math.PI-_c[0]);var _d=_a.elements;_d[0]=_c[1],_d[1]=_c[0],_d[2]=_c[2]},_a.invert=function(_a){var _b=_a.elements,_c=this.elements,_d=_c[0],_e=_c[1],_f=_c[2],_g=_c[3],_h=_d*_d+_e*_e+_f*_f+_g*_g,_i=_h?1/_h:0;_b[0]=-_d*_i,_b[1]=-_e*_i,_b[2]=-_f*_i,_b[3]=_g*_i},_a.identity=function(){var _a=this.elements;_a[0]=0,_a[1]=0,_a[2]=0,_a[3]=1},_a.fromArray=function(_a,_b){void 0===_b&&(_b=0),this.elements[0]=_a[_b+0],this.elements[1]=_a[_b+1],this.elements[2]=_a[_b+2],this.elements[3]=_a[_b+3]},_a.cloneTo=function(_a){var _b,_c,_d;if((_c=this.elements)!==(_d=_a.elements))for(_b=0;_b<4;++_b)_d[_b]=_c[_b]},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_a.equals=function(_a){var _b=this.elements,_c=_a.elements;return _$a.nearEqual(_b[0],_c[0])&&_$a.nearEqual(_b[1],_c[1])&&_$a.nearEqual(_b[2],_c[2])&&_$a.nearEqual(_b[3],_c[3])},_a.lengthSquared=function(){var _a=this.elements[0],_b=this.elements[1],_c=this.elements[2],_d=this.elements[3];return _a*_a+_b*_b+_c*_c+_d*_d},_o(0,_a,"x",function(){return this.elements[0]}),_o(0,_a,"y",function(){return this.elements[1]}),_o(0,_a,"z",function(){return this.elements[2]}),_o(0,_a,"w",function(){return this.elements[3]}),_e.createFromYawPitchRoll=function(_a,_b,_c,_d){var _e=.5*_c,_f=.5*_b,_g=.5*_a,_h=Math.sin(_e),_i=Math.cos(_e),_j=Math.sin(_f),_k=Math.cos(_f),_l=Math.sin(_g),_m=Math.cos(_g),_n=_d.elements;_n[0]=_m*_j*_i+_l*_k*_h,_n[1]=_l*_k*_i-_m*_j*_h,_n[2]=_m*_k*_h-_l*_j*_i,_n[3]=_m*_k*_i+_l*_j*_h},_e.multiply=function(_a,_b,_c){var _d=_a.elements,_e=_b.elements,_f=_c.elements,_g=_d[0],_h=_d[1],_i=_d[2],_j=_d[3],_k=_e[0],_l=_e[1],_m=_e[2],_n=_e[3],_o=_h*_m-_i*_l,_p=_i*_k-_g*_m,_q=_g*_l-_h*_k,_r=_g*_k+_h*_l+_i*_m;_f[0]=_g*_n+_k*_j+_o,_f[1]=_h*_n+_l*_j+_p,_f[2]=_i*_n+_m*_j+_q,_f[3]=_j*_n-_r},_e.arcTanAngle=function(_a,_b){return 0==_a?1==_b?Math.PI/2:-Math.PI/2:0<_a?Math.atan(_b/_a):_a<0?0<_b?Math.atan(_b/_a)+Math.PI:Math.atan(_b/_a)-Math.PI:0},_e.angleTo=function(_a,_b,_c){_gb.subtract(_b,_a,_e.TEMPVector30),_gb.normalize(_e.TEMPVector30,_e.TEMPVector30),_c.elements[0]=Math.asin(_e.TEMPVector30.y),_c.elements[1]=_e.arcTanAngle(-_e.TEMPVector30.z,-_e.TEMPVector30.x)},_e.createFromAxisAngle=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements;_b*=.5;var _f=Math.sin(_b);_d[0]=_f*_e[0],_d[1]=_f*_e[1],_d[2]=_f*_e[2],_d[3]=Math.cos(_b)},_e.createFromMatrix3x3=function(_a,_b){var _c,_d=_b.elements,_e=_a.elements,_f=_e[0]+_e[4]+_e[8];if(0<_f)_c=Math.sqrt(_f+1),_d[3]=.5*_c,_c=.5/_c,_d[0]=(_e[5]-_e[7])*_c,_d[1]=(_e[6]-_e[2])*_c,_d[2]=(_e[1]-_e[3])*_c;else{var _g=0;_e[4]>_e[0]&&(_g=1),_e[8]>_e[3*_g+_g]&&(_g=2);var _h=(_g+1)%3,_i=(_g+2)%3;_c=Math.sqrt(_e[3*_g+_g]-_e[3*_h+_h]-_e[3*_i+_i]+1),_d[_g]=.5*_c,_c=.5/_c,_d[3]=(_e[3*_h+_i]-_e[3*_i+_h])*_c,_d[_h]=(_e[3*_h+_g]+_e[3*_g+_h])*_c,_d[_i]=(_e[3*_i+_g]+_e[3*_g+_i])*_c}},_e.createFromMatrix4x4=function(_a,_b){var _c,_d,_e=_a.elements,_f=_b.elements,_g=_e[0]+_e[5]+_e[10];0<_g?(_c=Math.sqrt(_g+1),_f[3]=.5*_c,_c=.5/_c,_f[0]=(_e[6]-_e[9])*_c,_f[1]=(_e[8]-_e[2])*_c,_f[2]=(_e[1]-_e[4])*_c):_e[0]>=_e[5]&&_e[0]>=_e[10]?(_d=.5/(_c=Math.sqrt(1+_e[0]-_e[5]-_e[10])),_f[0]=.5*_c,_f[1]=(_e[1]+_e[4])*_d,_f[2]=(_e[2]+_e[8])*_d,_f[3]=(_e[6]-_e[9])*_d):_e[5]>_e[10]?(_d=.5/(_c=Math.sqrt(1+_e[5]-_e[0]-_e[10])),_f[0]=(_e[4]+_e[1])*_d,_f[1]=.5*_c,_f[2]=(_e[9]+_e[6])*_d,_f[3]=(_e[8]-_e[2])*_d):(_d=.5/(_c=Math.sqrt(1+_e[10]-_e[0]-_e[5])),_f[0]=(_e[8]+_e[2])*_d,_f[1]=(_e[9]+_e[6])*_d,_f[2]=.5*_c,_f[3]=(_e[1]-_e[4])*_d)},_e.slerp=function(_a,_b,_c,_d){var _e,_f,_g,_h,_i,_j=_a.elements,_k=_b.elements,_l=_d.elements,_m=_j[0],_n=_j[1],_o=_j[2],_p=_j[3],_q=_k[0],_r=_k[1],_s=_k[2],_t=_k[3];return(_f=_m*_q+_n*_r+_o*_s+_p*_t)<0&&(_f=-_f,_q=-_q,_r=-_r,_s=-_s,_t=-_t),_i=1e-6<1-_f?(_e=Math.acos(_f),_g=Math.sin(_e),_h=Math.sin((1-_c)*_e)/_g,Math.sin(_c*_e)/_g):(_h=1-_c,_c),_l[0]=_h*_m+_i*_q,_l[1]=_h*_n+_i*_r,_l[2]=_h*_o+_i*_s,_l[3]=_h*_p+_i*_t,_l},_e.lerp=function(_a,_b,_c,_d){var _e=_d.elements,_f=_a.elements,_g=_b.elements,_h=_f[0],_i=_f[1],_j=_f[2],_k=_f[3];_e[0]=_h+_c*(_g[0]-_h),_e[1]=_i+_c*(_g[1]-_i),_e[2]=_j+_c*(_g[2]-_j),_e[3]=_k+_c*(_g[3]-_k)},_e.add=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]+_f[0],_d[1]=_e[1]+_f[1],_d[2]=_e[2]+_f[2],_d[3]=_e[3]+_f[3]},_e.dot=function(_a,_b){var _c=_a.elements,_d=_b.elements;return _c[0]*_d[0]+_c[1]*_d[1]+_c[2]*_d[2]+_c[3]*_d[3]},_e.rotationLookAt=function(_a,_b,_c){_e.lookAt(_gb.ZERO,_a,_b,_c)},_e.lookAt=function(_a,_b,_c,_d){__a.lookAt(_a,_b,_c,_e._tempMatrix3x3),_e.rotationMatrix(_e._tempMatrix3x3,_d)},_e.invert=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_a.lengthSquared();_$a.isZero(_e)||(_e=1/_e,_d[0]=-_c[0]*_e,_d[1]=-_c[1]*_e,_d[2]=-_c[2]*_e,_d[3]=_c[3]*_e)},_e.rotationMatrix=function(_a,_b){var _c=_a.elements,_d=_c[0],_e=_c[1],_f=_c[2],_g=_c[3],_h=_c[4],_i=_c[5],_j=_c[6],_k=_c[7],_l=_c[8],_m=_b.elements,_n=NaN,_o=NaN,_p=_d+_h+_l;0<_p?(_n=Math.sqrt(_p+1),_m[3]=.5*_n,_n=.5/_n,_m[0]=(_i-_k)*_n,_m[1]=(_j-_f)*_n,_m[2]=(_e-_g)*_n):_h<=_d&&_l<=_d?(_o=.5/(_n=Math.sqrt(1+_d-_h-_l)),_m[0]=.5*_n,_m[1]=(_e+_g)*_o,_m[2]=(_f+_j)*_o,_m[3]=(_i-_k)*_o):_l<_h?(_o=.5/(_n=Math.sqrt(1+_h-_d-_l)),_m[0]=(_g+_e)*_o,_m[1]=.5*_n,_m[2]=(_k+_i)*_o,_m[3]=(_j-_f)*_o):(_o=.5/(_n=Math.sqrt(1+_l-_d-_h)),_m[0]=(_j+_f)*_o,_m[1]=(_k+_i)*_o,_m[2]=.5*_n,_m[3]=(_e-_g)*_o)},_e.DEFAULT=new _e,_l(_e,["TEMPVector30",function(){return this.TEMPVector30=new _gb},"TEMPVector31",function(){return this.TEMPVector31=new _gb},"TEMPVector32",function(){return this.TEMPVector32=new _gb},"TEMPVector33",function(){return this.TEMPVector33=new _gb},"TEMPMatrix0",function(){return this.TEMPMatrix0=new _ab},"TEMPMatrix1",function(){return this.TEMPMatrix1=new _ab},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new __a},"NAN",function(){return this.NAN=new _e(NaN,NaN,NaN,NaN)}]),_e}(),_db=function(){function _a(_a){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=_a,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}_n(_a,"laya.d3.math.Rand");var _b=_a.prototype;return _b.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},_b.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},_b.getSignedFloat=function(){return 2*this.getFloat()-1},_o(0,_b,"seed",function(){return this.seeds[0]},function(_a){this.seeds[0]=_a,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),_a.getFloatFromInt=function(_a){return 1/8388607*(8388607&_a)},_a.getByteFromInt=function(_a){return(8388607&_a)>>>15},_a}(),_eb=(function(){function _e(_a){if(this._state0U=NaN,this._state0L=NaN,this._state1U=NaN,this._state1L=NaN,!(_a instanceof Array)||4!==_a.length)throw new Error("Rand:Seed must be an array with 4 numbers");this._state0U=0|_a[0],this._state0L=0|_a[1],this._state1U=0|_a[2],this._state1L=0|_a[3]}_n(_e,"laya.d3.math.RandX");var _a=_e.prototype;_a.randomint=function(){var _a=this._state0U,_b=this._state0L,_c=this._state1U,_d=this._state1L,_e=(_d>>>0)+(_b>>>0),_f=_c+_a+(_e/2>>>31)>>>0,_g=_e>>>0,_h=0,_i=0;_h=(_a^=_h=_a<<23|(-512&_b)>>>9)^(this._state0U=_c),_i=(_b^=_i=_b<<23)^(this._state0L=_d);_h^=_a>>>18,_i^=_b>>>18|(262143&_a)<<14;return _h^=_c>>>5,_i^=_d>>>5|(31&_c)<<27,this._state1U=_h,this._state1L=_i,[_f,_g]},_a.random=function(){var _a=this.randomint(),_b=_a[0],_c=1023<<20|_b>>>12,_d=0|(_a[1]>>>12|(4095&_b)<<20);return _e._CONVERTION_BUFFER.setUint32(0,_c,!1),_e._CONVERTION_BUFFER.setUint32(4,_d,!1),_db._CONVERTION_BUFFER.getFloat64(0,!1)-1},_l(_e,["_CONVERTION_BUFFER",function(){return this._CONVERTION_BUFFER=new DataView(new ArrayBuffer(8))},"defaultRand",function(){return this.defaultRand=new _db([0,Date.now()/65536,0,Date.now()%65536])}])}(),function(){function _a(_a,_b){this.origin=null,this.direction=null,this.origin=_a,this.direction=_b}return _n(_a,"laya.d3.math.Ray"),_a}()),_fb=function(){function _a(_a,_b){this.elements=new Float32Array(2),void 0===_a&&(_a=0),void 0===_b&&(_b=0);var _c=this.elements;_c[0]=_a,_c[1]=_b}_n(_a,"laya.d3.math.Vector2");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.IClone":!0}),_b.fromArray=function(_a,_b){void 0===_b&&(_b=0),this.elements[0]=_a[_b+0],this.elements[1]=_a[_b+1]},_b.cloneTo=function(_a){var _b=_a.elements,_c=this.elements;_b[0]=_c[0],_b[1]=_c[1]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"x",function(){return this.elements[0]},function(_a){this.elements[0]=_a}),_o(0,_b,"y",function(){return this.elements[1]},function(_a){this.elements[1]=_a}),_a.scale=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements;_d[0]=_e[0]*_b,_d[1]=_e[1]*_b},_l(_a,["ZERO",function(){return this.ZERO=new _a(0,0)},"ONE",function(){return this.ONE=new _a(1,1)}]),_a}(),_gb=function(){function _k(_a,_b,_c){this.elements=new Float32Array(3),void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0);var _d=this.elements;_d[0]=_a,_d[1]=_b,_d[2]=_c}_n(_k,"laya.d3.math.Vector3");var _a=_k.prototype;return _v.imps(_a,{"laya.d3.core.IClone":!0}),_a.fromArray=function(_a,_b){void 0===_b&&(_b=0),this.elements[0]=_a[_b+0],this.elements[1]=_a[_b+1],this.elements[2]=_a[_b+2]},_a.cloneTo=function(_a){var _b=_a.elements,_c=this.elements;_b[0]=_c[0],_b[1]=_c[1],_b[2]=_c[2]},_a.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_a.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},_a.reset=function(_a,_b,_c){this.elements[0]=_a,this.elements[1]=_b,this.elements[2]=_c},_o(0,_a,"x",function(){return this.elements[0]},function(_a){this.elements[0]=_a}),_o(0,_a,"y",function(){return this.elements[1]},function(_a){this.elements[1]=_a}),_o(0,_a,"z",function(){return this.elements[2]},function(_a){this.elements[2]=_a}),_k.distanceSquared=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0]-_d[0],_f=_c[1]-_d[1],_g=_c[2]-_d[2];return _e*_e+_f*_f+_g*_g},_k.distance=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0]-_d[0],_f=_c[1]-_d[1],_g=_c[2]-_d[2];return Math.sqrt(_e*_e+_f*_f+_g*_g)},_k.min=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=Math.min(_e[0],_f[0]),_d[1]=Math.min(_e[1],_f[1]),_d[2]=Math.min(_e[2],_f[2])},_k.max=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=Math.max(_e[0],_f[0]),_d[1]=Math.max(_e[1],_f[1]),_d[2]=Math.max(_e[2],_f[2])},_k.transformQuat=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements,_g=_e[0],_h=_e[1],_i=_e[2],_j=_f[0],_k=_f[1],_l=_f[2],_m=_f[3],_n=_m*_g+_k*_i-_l*_h,_o=_m*_h+_l*_g-_j*_i,_p=_m*_i+_j*_h-_k*_g,_q=-_j*_g-_k*_h-_l*_i;_d[0]=_n*_m+_q*-_j+_o*-_l-_p*-_k,_d[1]=_o*_m+_q*-_k+_p*-_j-_n*-_l,_d[2]=_p*_m+_q*-_l+_n*-_k-_o*-_j},_k.scalarLength=function(_a){var _b=_a.elements,_c=_b[0],_d=_b[1],_e=_b[2];return Math.sqrt(_c*_c+_d*_d+_e*_e)},_k.scalarLengthSquared=function(_a){var _b=_a.elements,_c=_b[0],_d=_b[1],_e=_b[2];return _c*_c+_d*_d+_e*_e},_k.normalize=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0],_f=_c[1],_g=_c[2],_h=_e*_e+_f*_f+_g*_g;0<_h&&(_h=1/Math.sqrt(_h),_d[0]=_c[0]*_h,_d[1]=_c[1]*_h,_d[2]=_c[2]*_h)},_k.multiply=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]*_f[0],_d[1]=_e[1]*_f[1],_d[2]=_e[2]*_f[2]},_k.scale=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements;_d[0]=_e[0]*_b,_d[1]=_e[1]*_b,_d[2]=_e[2]*_b},_k.lerp=function(_a,_b,_c,_d){var _e=_d.elements,_f=_a.elements,_g=_b.elements,_h=_f[0],_i=_f[1],_j=_f[2];_e[0]=_h+_c*(_g[0]-_h),_e[1]=_i+_c*(_g[1]-_i),_e[2]=_j+_c*(_g[2]-_j)},_k.transformV3ToV3=function(_a,_b,_c){var _d=_k._tempVector4;_k.transformV3ToV4(_a,_b,_d);var _e=_d.elements,_f=_c.elements;_f[0]=_e[0],_f[1]=_e[1],_f[2]=_e[2]},_k.transformV3ToV4=function(_a,_b,_c){var _d=_a.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=_b.elements,_i=_c.elements;_i[0]=_e*_h[0]+_f*_h[4]+_g*_h[8]+_h[12],_i[1]=_e*_h[1]+_f*_h[5]+_g*_h[9]+_h[13],_i[2]=_e*_h[2]+_f*_h[6]+_g*_h[10]+_h[14],_i[3]=_e*_h[3]+_f*_h[7]+_g*_h[11]+_h[15]},_k.TransformNormal=function(_a,_b,_c){var _d=_a.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=_b.elements,_i=_c.elements;_i[0]=_e*_h[0]+_f*_h[4]+_g*_h[8],_i[1]=_e*_h[1]+_f*_h[5]+_g*_h[9],_i[2]=_e*_h[2]+_f*_h[6]+_g*_h[10]},_k.transformCoordinate=function(_a,_b,_c){var _d=_k._tempVector4.elements,_e=_a.elements,_f=_e[0],_g=_e[1],_h=_e[2],_i=_b.elements;_d[0]=_f*_i[0]+_g*_i[4]+_h*_i[8]+_i[12],_d[1]=_f*_i[1]+_g*_i[5]+_h*_i[9]+_i[13],_d[2]=_f*_i[2]+_g*_i[6]+_h*_i[10]+_i[14],_d[3]=1/(_f*_i[3]+_g*_i[7]+_h*_i[11]+_i[15]);var _j=_c.elements;_j[0]=_d[0]*_d[3],_j[1]=_d[1]*_d[3],_j[2]=_d[2]*_d[3]},_k.Clamp=function(_a,_b,_c,_d){var _e=_a.elements,_f=_e[0],_g=_e[1],_h=_e[2],_i=_b.elements,_j=_i[0],_k=_i[1],_l=_i[2],_m=_c.elements,_n=_m[0],_o=_m[1],_p=_m[2],_q=_d.elements;_f=(_f=_n<_f?_n:_f)<_j?_j:_f,_g=(_g=_o<_g?_o:_g)<_k?_k:_g,_h=(_h=_p<_h?_p:_h)<_l?_l:_h,_q[0]=_f,_q[1]=_g,_q[2]=_h},_k.add=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]+_f[0],_d[1]=_e[1]+_f[1],_d[2]=_e[2]+_f[2]},_k.subtract=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]-_f[0],_d[1]=_e[1]-_f[1],_d[2]=_e[2]-_f[2]},_k.cross=function(_a,_b,_c){var _d=_a.elements,_e=_b.elements,_f=_c.elements,_g=_d[0],_h=_d[1],_i=_d[2],_j=_e[0],_k=_e[1],_l=_e[2];_f[0]=_h*_l-_i*_k,_f[1]=_i*_j-_g*_l,_f[2]=_g*_k-_h*_j},_k.dot=function(_a,_b){var _c=_a.elements,_d=_b.elements;return _c[0]*_d[0]+_c[1]*_d[1]+_c[2]*_d[2]},_k.equals=function(_a,_b){var _c=_a.elements,_d=_b.elements;return _$a.nearEqual(Math.abs(_c[0]),Math.abs(_d[0]))&&_$a.nearEqual(Math.abs(_c[1]),Math.abs(_d[1]))&&_$a.nearEqual(Math.abs(_c[2]),Math.abs(_d[2]))},_k.ZERO=new _k(0,0,0),_k.ONE=new _k(1,1,1),_k.NegativeUnitX=new _k(-1,0,0),_k.UnitX=new _k(1,0,0),_k.UnitY=new _k(0,1,0),_k.UnitZ=new _k(0,0,1),_k.ForwardRH=new _k(0,0,-1),_k.ForwardLH=new _k(0,0,1),_k.Up=new _k(0,1,0),_k.NAN=new _k(NaN,NaN,NaN),_l(_k,["_tempVector4",function(){return this._tempVector4=new _hb}]),_k}(),_hb=function(){function _a(_a,_b,_c,_d){this.elements=new Float32Array(4),void 0===_a&&(_a=0),void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=0);var _e=this.elements;_e[0]=_a,_e[1]=_b,_e[2]=_c,_e[3]=_d}_n(_a,"laya.d3.math.Vector4");var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.IClone":!0}),_b.fromArray=function(_a,_b){void 0===_b&&(_b=0),this.elements[0]=_a[_b+0],this.elements[1]=_a[_b+1],this.elements[2]=_a[_b+2],this.elements[3]=_a[_b+3]},_b.cloneTo=function(_a){var _b=_a.elements,_c=this.elements;_b[0]=_c[0],_b[1]=_c[1],_b[2]=_c[2],_b[3]=_c[3]},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_b.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},_b.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},_o(0,_b,"x",function(){return this.elements[0]},function(_a){this.elements[0]=_a}),_o(0,_b,"y",function(){return this.elements[1]},function(_a){this.elements[1]=_a}),_o(0,_b,"z",function(){return this.elements[2]},function(_a){this.elements[2]=_a}),_o(0,_b,"w",function(){return this.elements[3]},function(_a){this.elements[3]=_a}),_a.lerp=function(_a,_b,_c,_d){var _e=_d.elements,_f=_a.elements,_g=_b.elements,_h=_f[0],_i=_f[1],_j=_f[2],_k=_f[3];_e[0]=_h+_c*(_g[0]-_h),_e[1]=_i+_c*(_g[1]-_i),_e[2]=_j+_c*(_g[2]-_j),_e[3]=_k+_c*(_g[3]-_k)},_a.transformByM4x4=function(_a,_b,_c){var _d=_a.elements,_e=_d[0],_f=_d[1],_g=_d[2],_h=_d[3],_i=_b.elements,_j=_c.elements;_j[0]=_e*_i[0]+_f*_i[4]+_g*_i[8]+_h*_i[12],_j[1]=_e*_i[1]+_f*_i[5]+_g*_i[9]+_h*_i[13],_j[2]=_e*_i[2]+_f*_i[6]+_g*_i[10]+_h*_i[14],_j[3]=_e*_i[3]+_f*_i[7]+_g*_i[11]+_h*_i[15]},_a.equals=function(_a,_b){var _c=_a.elements,_d=_b.elements;return _$a.nearEqual(Math.abs(_c[0]),Math.abs(_d[0]))&&_$a.nearEqual(Math.abs(_c[1]),Math.abs(_d[1]))&&_$a.nearEqual(Math.abs(_c[2]),Math.abs(_d[2]))&&_$a.nearEqual(Math.abs(_c[3]),Math.abs(_d[3]))},_a.normalize=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_a.length();0<_e&&(_d[0]=_c[0]*_e,_d[1]=_c[1]*_e,_d[2]=_c[2]*_e,_d[3]=_c[3]*_e)},_a.add=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]+_f[0],_d[1]=_e[1]+_f[1],_d[2]=_e[2]+_f[2],_d[3]=_e[3]+_f[3]},_a.subtract=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]-_f[0],_d[1]=_e[1]-_f[1],_d[2]=_e[2]-_f[2],_d[3]=_e[3]-_f[3]},_a.multiply=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=_e[0]*_f[0],_d[1]=_e[1]*_f[1],_d[2]=_e[2]*_f[2],_d[3]=_e[3]*_f[3]},_a.scale=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements;_d[0]=_e[0]*_b,_d[1]=_e[1]*_b,_d[2]=_e[2]*_b,_d[3]=_e[3]*_b},_a.Clamp=function(_a,_b,_c,_d){var _e=_a.elements,_f=_e[0],_g=_e[1],_h=_e[2],_i=_e[3],_j=_b.elements,_k=_j[0],_l=_j[1],_m=_j[2],_n=_j[3],_o=_c.elements,_p=_o[0],_q=_o[1],_r=_o[2],_s=_o[3],_t=_d.elements;_f=(_f=_p<_f?_p:_f)<_k?_k:_f,_g=(_g=_q<_g?_q:_g)<_l?_l:_g,_h=(_h=_r<_h?_r:_h)<_m?_m:_h,_i=(_i=_s<_i?_s:_i)<_n?_n:_i,_t[0]=_f,_t[1]=_g,_t[2]=_h,_t[3]=_i},_a.distanceSquared=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0]-_d[0],_f=_c[1]-_d[1],_g=_c[2]-_d[2],_h=_c[3]-_d[3];return _e*_e+_f*_f+_g*_g+_h*_h},_a.distance=function(_a,_b){var _c=_a.elements,_d=_b.elements,_e=_c[0]-_d[0],_f=_c[1]-_d[1],_g=_c[2]-_d[2],_h=_c[3]-_d[3];return Math.sqrt(_e*_e+_f*_f+_g*_g+_h*_h)},_a.dot=function(_a,_b){var _c=_a.elements,_d=_b.elements;return _c[0]*_d[0]+_c[1]*_d[1]+_c[2]*_d[2]+_c[3]*_d[3]},_a.min=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=Math.min(_e[0],_f[0]),_d[1]=Math.min(_e[1],_f[1]),_d[2]=Math.min(_e[2],_f[2]),_d[3]=Math.min(_e[3],_f[3])},_a.max=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b.elements;_d[0]=Math.max(_e[0],_f[0]),_d[1]=Math.max(_e[1],_f[1]),_d[2]=Math.max(_e[2],_f[2]),_d[3]=Math.max(_e[3],_f[3])},_l(_a,["ZERO",function(){return this.ZERO=new _a},"ONE",function(){return this.ONE=new _a(1,1,1,1)},"UnitX",function(){return this.UnitX=new _a(1,0,0,0)},"UnitY",function(){return this.UnitY=new _a(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new _a(0,0,1,0)},"UnitW",function(){return this.UnitW=new _a(0,0,0,1)}]),_a}(),_ib=function(){function _f(_a,_b,_c,_d){this.minDepth=0,this.maxDepth=1,this.x=_a,this.y=_b,this.width=_c,this.height=_d}_n(_f,"laya.d3.math.Viewport");var _a=_f.prototype;return _a.project=function(_a,_b,_c){_gb.transformV3ToV3(_a,_b,_c);var _d=_a.elements,_e=_b.elements,_f=_c.elements,_g=_d[0]*_e[3]+_d[1]*_e[7]+_d[2]*_e[11]+_e[15];1!==_g&&(_f[0]=_f[0]/_g,_f[1]=_f[1]/_g,_f[2]=_f[2]/_g),_f[0]=.5*(_f[0]+1)*this.width+this.x,_f[1]=.5*(1-_f[1])*this.height+this.y,_f[2]=_f[2]*(this.maxDepth-this.minDepth)+this.minDepth},_a.unprojectFromMat=function(_a,_b,_c){var _d=_a.elements,_e=_b.elements,_f=_c.elements;_f[0]=(_d[0]-this.x)/this.width*2-1,_f[1]=-((_d[1]-this.y)/this.height*2-1);var _g=(this.maxDepth-this.minDepth)/2;_f[2]=(_d[2]-this.minDepth-_g)/_g;var _h=_f[0]*_e[3]+_f[1]*_e[7]+_f[2]*_e[11]+_e[15];_gb.transformV3ToV3(_c,_b,_c),1!==_h&&(_f[0]=_f[0]/_h,_f[1]=_f[1]/_h,_f[2]=_f[2]/_h)},_a.unprojectFromWVP=function(_a,_b,_c,_d,_e){_ab.multiply(_b,_c,_f._tempMatrix4x4),_d&&_ab.multiply(_f._tempMatrix4x4,_d,_f._tempMatrix4x4),_f._tempMatrix4x4.invert(_f._tempMatrix4x4),this.unprojectFromMat(_a,_f._tempMatrix4x4,_e)},_l(_f,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new _ab}]),_f}(),_jb=function(){function _C(_a){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._indexInMesh=0,this._vertexBuffer=null,this._vertexStart=0,this._vertexCount=0,this._indexBuffer=null,this._indexStart=0,this._indexCount=0,this._indices=null,this._bufferUsage={},this._mesh=_a,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}_n(_C,"laya.d3.resource.models.SubMesh");var _a=_C.prototype;return _v.imps(_a,{"laya.d3.core.render.IRenderable":!0,"laya.resource.IDispose":!0}),_a._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),0===_a?this._vertexBuffer:null},_a._getIndexBuffer=function(){return this._indexBuffer},_a._getStaticBatchBakedVertexs=function(_a,_b){var _c,_d,_e=this._vertexBuffer,_f=_e.vertexDeclaration,_g=_f.getVertexElementByUsage(0).offset/4,_h=_f.getVertexElementByUsage(3).offset/4,_i=_b.meshRender.lightmapScaleOffset,_j=0,_k=0,_l=0,_m=0,_n=0,_o=0;if(_i)if(_d=_f.getVertexElementByUsage(15))_l=_f.vertexStride/4,_c=0<this._vertexCount?_e.getData().slice(this._vertexStart*_l,(this._vertexStart+this._vertexCount)*_l):_e.getData().slice(),_m=_d.offset/4;else{_l=(_o=_f.vertexStride/4)+2,_c=this._vertexCount?new Float32Array(this._vertexCount*(_e.vertexDeclaration.vertexStride/4+2)):new Float32Array(_e.vertexCount*(_e.vertexDeclaration.vertexStride/4+2)),_m=(_n=_f.getVertexElementByUsage(2).offset/4)+2;var _p=_e.getData();for(_j=0,_k=_p.length/_o;_j<_k;_j++){var _q=0;_q=0<this._vertexCount?(this._vertexStart+_j)*_o:_j*_o;var _r=_j*_l,_s=0;for(_s=0;_s<_m;_s++)_c[_r+_s]=_p[_q+_s];for(_s=_m;_s<_o;_s++)_c[_r+_s+2]=_p[_q+_s]}}else _l=_f.vertexStride/4,_c=this._vertexCount?_e.getData().slice(this._vertexStart*_l,(this._vertexStart+this._vertexCount)*_l):_e.getData().slice();if(_a){var _t=_a.worldMatrix,_u=_C._tempMatrix4x40;_t.invert(_u);var _v=_C._tempMatrix4x41,_w=_b.transform.worldMatrix;_ab.multiply(_u,_w,_v)}else _v=_b.transform.worldMatrix;var _x=_C._tempQuaternion0;for(_v.decomposeTransRotScale(_C._tempVector30,_x,_C._tempVector31),_j=0,_k=_c.length/_l;_j<_k;_j++){var _y=_j*_l+_g,_z=_j*_l+_h;if(_qb.transformVector3ArrayToVector3ArrayCoordinate(_c,_y,_v,_c,_y),_qb.transformVector3ArrayByQuat(_c,_z,_x,_c,_z),_i){var _A=_j*_l+_m;if(_d)_qb.transformLightingMapTexcoordByUV1Array(_c,_A,_i,_c,_A);else{var _B=_j*_o+_n;_qb.transformLightingMapTexcoordByUV0Array(_p,_B,_i,_c,_A)}}}return _c},_a._getVertexBuffers=function(){return null},_a._beforeRender=function(_a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},_a._render=function(_a){var _b,_c=0,_d=_a.renderElement;if(1<this._indexCount){var _e=this._boneIndicesList.length;if(1<_e){for(var _f=0;_f<_e;_f++)(_b=_d._skinAnimationDatas||this._skinAnimationDatas)&&(_d._shaderValue.setValue(0,_b[_f]),_a._shader.uploadRenderElementUniforms(_d._shaderValue.data)),_D.mainContext.drawElements(4,this._subIndexBufferCount[_f],5123,2*this._subIndexBufferStart[_f]);_y.drawCall+=_e}else(_b=_d._skinAnimationDatas||this._skinAnimationDatas)&&(_d._shaderValue.setValue(0,_b[0]),_a._shader.uploadRenderElementUniforms(_d._shaderValue.data)),_D.mainContext.drawElements(4,this._indexCount,5123,2*this._indexStart),_y.drawCall++;_c=this._indexCount}else _c=this._indexBuffer.indexCount,(_b=_d._skinAnimationDatas||this._skinAnimationDatas)&&(_d._shaderValue.setValue(0,_b[0]),_a._shader.uploadRenderElementUniforms(_d._shaderValue.data)),_D.mainContext.drawElements(4,_c,5123,0),_y.drawCall++;_y.trianglesFaces+=_c/3},_a.getIndices=function(){return 0<this._indexCount?this._indices:this._indexBuffer.getData()},_a.dispose=function(){this._indexBuffer.destroy(),this._vertexBuffer.destroy(),this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._bufferUsage=null,this._vertexBuffer=null,this._indexBuffer=null},_o(0,_a,"_vertexBufferCount",function(){return 1}),_o(0,_a,"triangleCount",function(){return this._indexBuffer.indexCount/3}),_l(_C,["_tempVector30",function(){return this._tempVector30=new _gb},"_tempVector31",function(){return this._tempVector31=new _gb},"_tempQuaternion0",function(){return this._tempQuaternion0=new _cb},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new _ab},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new _ab}]),_C}(),_kb=function(){function _a(_a){this.defineCounter=0,this.defines=null,_a?(this.defineCounter=_a.defineCounter,this.defines=_a.defines.slice()):(this.defineCounter=0,this.defines=[])}return _n(_a,"laya.d3.shader.ShaderDefines",null,"ShaderDefines$1"),_a.prototype.registerDefine=function(_a){var _b=Math.pow(2,this.defineCounter++);return this.defines[_b]=_a,_b},_a}(),_lb=function(){function _a(){}return _n(_a,"laya.d3.shader.ShaderInit3D"),_a.__init__=function(){var _a,_b;_yb._globalRegDefine("HIGHPRECISION",_yb.SHADERDEFINE_HIGHPRECISION),_yb._globalRegDefine("FOG",_yb.SHADERDEFINE_FOG),_yb._globalRegDefine("DIRECTIONLIGHT",_yb.SHADERDEFINE_DIRECTIONLIGHT),_yb._globalRegDefine("POINTLIGHT",_yb.SHADERDEFINE_POINTLIGHT),_yb._globalRegDefine("SPOTLIGHT",_yb.SHADERDEFINE_SPOTLIGHT),_yb._globalRegDefine("UV",_yb.SHADERDEFINE_UV0),_yb._globalRegDefine("COLOR",_yb.SHADERDEFINE_COLOR),_yb._globalRegDefine("UV1",_yb.SHADERDEFINE_UV1),_yb._globalRegDefine("CASTSHADOW",_nb.SHADERDEFINE_CAST_SHADOW),_yb._globalRegDefine("SHADOWMAP_PSSM1",_nb.SHADERDEFINE_SHADOW_PSSM1),_yb._globalRegDefine("SHADOWMAP_PSSM2",_nb.SHADERDEFINE_SHADOW_PSSM2),_yb._globalRegDefine("SHADOWMAP_PSSM3",_nb.SHADERDEFINE_SHADOW_PSSM3),_yb._globalRegDefine("SHADOWMAP_PCF_NO",_nb.SHADERDEFINE_SHADOW_PCF_NO),_yb._globalRegDefine("SHADOWMAP_PCF1",_nb.SHADERDEFINE_SHADOW_PCF1),_yb._globalRegDefine("SHADOWMAP_PCF2",_nb.SHADERDEFINE_SHADOW_PCF2),_yb._globalRegDefine("SHADOWMAP_PCF3",_nb.SHADERDEFINE_SHADOW_PCF3),_yb._globalRegDefine("DEPTHFOG",_yb.SAHDERDEFINE_DEPTHFOG),_Jb.addInclude("LightHelper.glsl","\nstruct DirectionLight\n{\n vec3 Direction;\n vec3 Diffuse;\n};\n\nstruct PointLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n float Range;\n};\n\nstruct SpotLight\n{\n vec3 Diffuse;\n vec3 Attenuation;\n vec3 Position;\n vec3 Direction;\n float Spot;\n float Range;\n};\n\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent)\n{\n\tvec3 normalT = 2.0*normalMapSample - 1.0;\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent- dot(tangent, N)*N);\n\tvec3 B = cross(T, N);\n\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\n\nvoid  computeDirectionLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in DirectionLight dirLight,in vec3 ambinentColor,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);//不初始化在IOS中闪烁，PC中不会闪烁\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec=-normalize(dirLight.Direction);\n\t\n\tamb=matAmb*ambinentColor;\n\t\n\tfloat  diffuseFactor=dot(lightVec, normal);\n\t\n\tif(diffuseFactor>0.0)\n\t{\n\t   vec3 v = reflect(-lightVec, normal);\n\t   float specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t   \n\t   dif = diffuseFactor * matDif * dirLight.Diffuse;\n\t   spec = specFactor * matSpe.rgb;\n\t}\n\t\n}\n\nvoid computePointLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in PointLight poiLight,in vec3 ambinentColor, in vec3 pos,in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tdif=vec3(0.0);\n\tamb=vec3(0.0);\n\tspec=vec3(0.0);\n\tvec3 lightVec = poiLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > poiLight.Range )\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif( diffuseFactor > 0.0 )\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * poiLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\n\tfloat attenuate = 1.0 / dot(poiLight.Attenuation, vec3(1.0, d, d*d));\n\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\nvoid ComputeSpotLight(in vec3 matDif,in vec3 matAmb,in vec4 matSpe,in SpotLight spoLight,in vec3 ambinentColor,in vec3 pos, in vec3 normal,in vec3 toEye,out vec3 dif,out vec3 amb,out vec3 spec)\n{\n\tamb = vec3(0.0);\n\tdif =vec3(0.0);\n\tspec= vec3(0.0);\n\tvec3 lightVec = spoLight.Position - pos;\n\t\t\n\tfloat d = length(lightVec);\n\t\n\tif( d > spoLight.Range)\n\t\treturn;\n\t\t\n\tlightVec /= d; \n\t\n\tamb = matAmb*ambinentColor;\t\n\n\tfloat diffuseFactor = dot(lightVec, normal);\n\n\tif(diffuseFactor > 0.0)\n\t{\n\t\tvec3 v= reflect(-lightVec, normal);\n\t\tfloat specFactor = pow(max(dot(v, toEye), 0.0), matSpe.w);\n\t\t\t\t\t\n\t\tdif = diffuseFactor * matDif * spoLight.Diffuse;\n\t\tspec = specFactor * matSpe.rgb;\n\t}\n\t\n\tfloat spot = pow(max(dot(-lightVec, normalize(spoLight.Direction)), 0.0), spoLight.Spot);\n\n\tfloat attenuate = spot/dot(spoLight.Attenuation, vec3(1.0, d, d*d));\n\n\tamb *= spot;\n\tdif *= attenuate;\n\tspec*= attenuate;\n}\n\n"),_Jb.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),_a={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:15,a_TexcoordNext0:14,a_BoneWeights:7,a_BoneIndices:6,a_Tangent0:5},_b={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AmbientTexture:[5,1],u_ReflectTexture:[6,1],u_AlphaTestValue:[0,1],u_Albedo:[7,1],u_UVMatrix:[13,1],u_UVAge:[14,1],u_UVAniAge:[8,1],u_MaterialDiffuse:[10,1],u_MaterialAmbient:[9,1],u_MaterialSpecular:[11,1],u_MaterialReflect:[12,1],u_TilingOffset:[15,1],u_WorldMat:[0,2],u_MvpMatrix:[1,2],u_LightmapScaleOffset:[2,2],u_LightMap:[3,2],u_CameraPos:[0,3],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Direction":[3,4],"u_DirectionLight.Diffuse":[4,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Attenuation":[7,4],"u_PointLight.Diffuse":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Attenuation":[13,4],"u_SpotLight.Diffuse":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4]};var _c=_Jb.nameKey.add("SIMPLE");shaderCompile=_yb.add(_c,"attribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\nattribute vec2 a_Texcoord0;\nvarying vec2 v_Texcoord0;\n  #ifdef UVTRANSFORM \n  uniform mat4 u_UVMatrix;\n  #endif\n#endif\n\n#if defined(AMBIENTMAP)||(defined(LIGHTMAP)&&defined(UV1))\nattribute vec2 a_Texcoord1;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec4 u_LightmapScaleOffset;\nvarying vec2 v_LightMapUV;\n#endif\n\n\n#ifdef COLOR\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\nattribute vec4 a_BoneIndices;\nattribute vec4 a_BoneWeights;\nconst int c_MaxBoneCount = 24;\nuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nattribute vec3 a_Normal;\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP))&&defined(NORMALMAP)\nattribute vec3 a_Tangent0;\nvarying vec3 v_Tangent0;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\nuniform mat4 u_WorldMat;\nvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n \n//TODO没考虑UV动画呢\n#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\tv_Texcoord0=a_Texcoord0;\n#endif\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n#ifdef BONE\n\tmat4 skinTransform=mat4(0.0);\n\tskinTransform += u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\tvec4 position=skinTransform*a_Position;\n\tgl_Position = u_MvpMatrix * position;\n#else\n\tgl_Position = u_MvpMatrix * a_Position;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tmat3 worldMat;\n\t#ifdef BONE\n\t\tworldMat=mat3(u_WorldMat*skinTransform);\n\t#else\n\t\tworldMat=mat3(u_WorldMat);\n\t#endif  \n\tv_Normal=worldMat*a_Normal;\n\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tv_Tangent0=worldMat*a_Tangent0;\n\t#endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t#ifdef BONE\n\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t#else\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\n\tv_Texcoord0=a_Texcoord0;\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=(vec2(v_Texcoord0.x,v_Texcoord0.y-1.0)*u_TilingOffset.xy)+u_TilingOffset.zw;\n\t\tv_Texcoord0=vec2(v_Texcoord0.x,v_Texcoord0.y+1.0);\n\t#endif\n\t#ifdef UVTRANSFORM\n\t\tv_Texcoord0=(u_UVMatrix*vec4(v_Texcoord0,0.0,1.0)).xy;\n\t#endif\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\n\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x*u_LightmapScaleOffset.x+u_LightmapScaleOffset.z,1.0+a_Texcoord1.y*u_LightmapScaleOffset.y+u_LightmapScaleOffset.w);\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,a_Texcoord0.y-1.0)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t#else\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t#else\n\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t#endif \n\t#endif \n#endif\n\n#ifdef COLOR\n\tv_Color=a_Color;\n#endif\n\n#ifdef RECEIVESHADOW\n\tv_posViewZ = gl_Position.w;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t#endif\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\n\tmain_castShadow();\n#else\n\tmain_normal();\n#endif\n}",'#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#include "LightHelper.glsl";\n\nuniform vec4 u_Albedo;\n\n#ifdef ALPHATEST\nuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\nuniform sampler2D u_DiffuseTexture;\n#endif\n\n#ifdef REFLECTMAP\nuniform samplerCube u_ReflectTexture;\nuniform vec3 u_MaterialReflect;\n#endif\n\n#if   defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(COLOR)&&defined(SPECULARMAP)||defined(NORMALMAP)))\nvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(AMBIENTMAP)||defined(LIGHTMAP)\nvarying vec2 v_LightMapUV;\n#endif\n#ifdef AMBIENTMAP\nuniform sampler2D u_AmbientTexture;\n#endif\n#ifdef LIGHTMAP\nuniform sampler2D u_LightMap;\n#endif\n\n#ifdef COLOR\nvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\nuniform vec3 u_MaterialDiffuse;\nuniform vec4 u_MaterialSpecular;\n  #if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP) \n  uniform sampler2D u_SpecularTexture;\n  #endif\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(AMBIENTMAP)||defined(LIGHTMAP)\nuniform vec3 u_MaterialAmbient;\n#endif\n\n#if defined(FOG)||defined(DEPTHFOG)\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\nvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\nuniform sampler2D u_NormalTexture;\nvarying vec3 v_Tangent0;\n#endif\n\n#ifdef DIRECTIONLIGHT\nuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\nuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\nuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)||(defined(RECEIVESHADOW)&&(defined(SHADOWMAP_PSM2)||defined(SHADOWMAP_PSM3)))\nuniform vec3 u_CameraPos;\n#endif\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(DEPTHFOG)||defined(REFLECTMAP)\nvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\n\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n#if defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n#endif \n  \n#if defined(COLOR)&&!defined(DIFFUSEMAP)\n\tgl_FragColor=v_Color;\n#endif \n  \n#if defined(DIFFUSEMAP)&&defined(COLOR)\n\tvec4 texColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\tgl_FragColor=texColor*v_Color;\n#endif\n  \n#if !defined(DIFFUSEMAP)&&!defined(COLOR)\n\tgl_FragColor=vec4(1.0,1.0,1.0,1.0);\n#endif \n    \n#ifdef ALPHATEST\n\tif(gl_FragColor.a-u_AlphaTestValue<0.0)\n\t\tdiscard;\n#endif\n  \n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\tvec3 normal;\n    #if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent0));\n\t#else\n\t\tnormal = normalize(v_Normal);\n    #endif\n#endif\n\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvec3 diffuse = vec3(0.0);\n\tvec3 ambient = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 dif, amb, spe;\n#endif\n  \n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||defined(REFLECTMAP)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\t\n#ifdef DIRECTIONLIGHT\n\tcomputeDirectionLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_DirectionLight,u_AmbientColor,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tcomputePointLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_PointLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tComputeSpotLight(u_MaterialDiffuse,u_MaterialAmbient,u_MaterialSpecular,u_SpotLight,u_AmbientColor,v_PositionWorld,normal,toEye, dif, amb, spe);\n\tdiffuse+=dif;\n\tambient+=amb;\n\tspecular+=spe;\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n#endif\n\n#ifdef AMBIENTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_AmbientTexture, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\n#ifdef LIGHTMAP\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t#else\n\t\t#if defined(RECEIVESHADOW)\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb * shadowValue);\n\t\t#else\n\t\t\tgl_FragColor.rgb=gl_FragColor.rgb*(u_MaterialAmbient+texture2D(u_LightMap, v_LightMapUV).rgb); \n\t\t#endif\n\t#endif\n#endif\n\ngl_FragColor=gl_FragColor*u_Albedo;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#if (defined(DIFFUSEMAP)||defined(COLOR))&&defined(SPECULARMAP)\n\t\tspecular =specular*texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n    #endif\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse*shadowValue) + specular*shadowValue,gl_FragColor.a);\n\t#else\n\t\tgl_FragColor =vec4( gl_FragColor.rgb*(ambient + diffuse) + specular,gl_FragColor.a);\n\t#endif\n#endif\n  \n#ifdef REFLECTMAP\n\tvec3 incident = -toEye;\n\tvec3 reflectionVector = reflect(incident,normal);\n\tvec3 reflectionColor  = textureCube(u_ReflectTexture,reflectionVector).rgb;\n\tgl_FragColor.rgb += u_MaterialReflect*reflectionColor;\n#endif\n  \n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\t#ifdef ADDTIVEFOG\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t#else\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n#endif\n#ifdef DEPTHFOG\n\tfloat lerpFact = (-v_PositionWorld.y-u_FogStart)/u_FogRange;\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\nvoid main()\n{\n#ifdef CASTSHADOW\t\t\n\tmain_castShadow();\n#else\n  main_normal();\n#endif  \n}\n\n',_a,_b),_Kb.SHADERDEFINE_DIFFUSEMAP=shaderCompile.registerMaterialDefine("DIFFUSEMAP"),_Kb.SHADERDEFINE_NORMALMAP=shaderCompile.registerMaterialDefine("NORMALMAP"),_Kb.SHADERDEFINE_SPECULARMAP=shaderCompile.registerMaterialDefine("SPECULARMAP"),_Kb.SHADERDEFINE_EMISSIVEMAP=shaderCompile.registerMaterialDefine("EMISSIVEMAP"),_Kb.SHADERDEFINE_AMBIENTMAP=shaderCompile.registerMaterialDefine("AMBIENTMAP"),_Kb.SHADERDEFINE_REFLECTMAP=shaderCompile.registerMaterialDefine("REFLECTMAP"),_Kb.SHADERDEFINE_UVTRANSFORM=shaderCompile.registerMaterialDefine("UVTRANSFORM"),_Kb.SHADERDEFINE_TILINGOFFSET=shaderCompile.registerMaterialDefine("TILINGOFFSET"),_Kb.SHADERDEFINE_ADDTIVEFOG=shaderCompile.registerMaterialDefine("ADDTIVEFOG")},_a}(),_mb=function(){function _a(){this._data=null,this._data=[]}_n(_a,"laya.d3.shader.ValusArray");var _b=_a.prototype;return _b.setValue=function(_a,_b){this._data[_a]=_b},_o(0,_b,"data",function(){return this._data}),_a}(),_nb=function(){function _a(){}return _a.SHADERDEFINE_RECEIVE_SHADOW=1,_a.SHADERDEFINE_CAST_SHADOW=512,_a.SHADERDEFINE_SHADOW_PSSM1=1024,_a.SHADERDEFINE_SHADOW_PSSM2=2048,_a.SHADERDEFINE_SHADOW_PSSM3=4096,_a.SHADERDEFINE_SHADOW_PCF_NO=8192,_a.SHADERDEFINE_SHADOW_PCF1=16384,_a.SHADERDEFINE_SHADOW_PCF2=32768,_a.SHADERDEFINE_SHADOW_PCF3=65536,_a.MAX_PSSM_COUNT=3,_a}(),_ob=function(){function _V(){}return _n(_V,"laya.d3.utils.Picker"),_V.calculateCursorRay=function(_a,_b,_c,_d,_e,_f){var _g=_a.elements[0],_h=_a.elements[1],_i=_V._tempVector30,_j=_i.elements;_j[0]=_g,_j[1]=_h,_j[2]=_b.minDepth;var _k=_V._tempVector31,_l=_k.elements;_l[0]=_g,_l[1]=_h,_l[2]=_b.maxDepth;var _m=_f.origin,_n=_V._tempVector32;_b.unprojectFromWVP(_i,_c,_d,_e,_m),_b.unprojectFromWVP(_k,_c,_d,_e,_n);var _o=_f.direction.elements;_o[0]=_n.x-_m.x,_o[1]=_n.y-_m.y,_o[2]=_n.z-_m.z,_gb.normalize(_f.direction,_f.direction)},_V.rayIntersectsPositionsAndIndices=function(_a,_b,_c,_d,_e){for(var _f=_c.vertexStride/4,_g=_c.getVertexElementByUsage(0).offset/4,_h=Number.MAX_VALUE,_i=-1,_j=-1,_k=-1,_l=0;_l<_d.length;_l+=3){var _m=_V._tempVector35,_n=_m.elements,_o=_d[_l]*_f,_p=_o+_g;_n[0]=_b[_p],_n[1]=_b[1+_p],_n[2]=_b[2+_p];var _q=_V._tempVector36,_r=_q.elements,_s=_d[_l+1]*_f,_t=_s+_g;_r[0]=_b[_t],_r[1]=_b[1+_t],_r[2]=_b[2+_t];var _u=_V._tempVector37,_v=_u.elements,_w=_d[_l+2]*_f,_x=_w+_g;_v[0]=_b[_x],_v[1]=_b[1+_x],_v[2]=_b[2+_x];var _y=laya.d3.utils.Picker.rayIntersectsTriangle(_a,_m,_q,_u);!isNaN(_y)&&_y<_h&&(_h=_y,_i=_o,_j=_s,_k=_w)}if(_h===Number.MAX_VALUE)return _e.position.toDefault(),_e.distance=Number.MAX_VALUE,_e.trianglePositions[0].toDefault(),_e.trianglePositions[1].toDefault(),_e.trianglePositions[2].toDefault(),_e.triangleNormals[0].toDefault(),_e.triangleNormals[1].toDefault(),_e.triangleNormals[2].toDefault(),!1;_e.distance=_h,_gb.scale(_a.direction,_h,_e.position),_gb.add(_a.origin,_e.position,_e.position);var _z=_e.trianglePositions,_A=_z[0],_B=_z[1],_C=_z[2],_D=_A.elements,_E=_B.elements,_F=_C.elements,_G=_i+_g;_D[0]=_b[_G],_D[1]=_b[_G+1],_D[2]=_b[_G+2];var _H=_j+_g;_E[0]=_b[_H],_E[1]=_b[_H+1],_E[2]=_b[_H+2];var _I=_k+_g;_F[0]=_b[_I],_F[1]=_b[_I+1],_F[2]=_b[_I+2];var _J=_c.getVertexElementByUsage(3);if(_J){var _K=_J.offset/4,_L=_e.triangleNormals,_M=_L[0],_N=_L[1],_O=_L[2],_P=_M.elements,_Q=_N.elements,_R=_O.elements,_S=_i+_K;_P[0]=_b[_S],_P[1]=_b[_S+1],_P[2]=_b[_S+2];var _T=_j+_K;_Q[0]=_b[_T],_Q[1]=_b[_T+1],_Q[2]=_b[_T+2];var _U=_k+_K;_R[0]=_b[_U],_R[1]=_b[_U+1],_R[2]=_b[_U+2]}return!0},_V.rayIntersectsTriangle=function(_a,_b,_c,_d){var _e=_V._tempVector30,_f=_V._tempVector31;_gb.subtract(_c,_b,_e),_gb.subtract(_d,_b,_f);var _g,_h=_V._tempVector32;if(_gb.cross(_a.direction,_f,_h),(_g=_gb.dot(_e,_h))>-Number.MIN_VALUE&&_g<Number.MIN_VALUE)return Number.NaN;var _i,_j=1/_g,_k=_V._tempVector33;if(_gb.subtract(_a.origin,_b,_k),_i=_gb.dot(_k,_h),(_i*=_j)<0||1<_i)return Number.NaN;var _l,_m,_n=_V._tempVector34;return _gb.cross(_k,_e,_n),_l=_gb.dot(_a.direction,_n),(_l*=_j)<0||1<_i+_l?Number.NaN:(_m=_gb.dot(_f,_n),(_m*=_j)<0?Number.NaN:_m)},_l(_V,["_tempVector30",function(){return this._tempVector30=new _gb},"_tempVector31",function(){return this._tempVector31=new _gb},"_tempVector32",function(){return this._tempVector32=new _gb},"_tempVector33",function(){return this._tempVector33=new _gb},"_tempVector34",function(){return this._tempVector34=new _gb},"_tempVector35",function(){return this._tempVector35=new _gb},"_tempVector36",function(){return this._tempVector36=new _gb},"_tempVector37",function(){return this._tempVector37=new _gb}]),_V}(),_pb=(function(){function _a(){this.distance=NaN,this.trianglePositions=null,this.triangleNormals=null,this.position=null,this.sprite3D=null,this.distance=-1,this.trianglePositions=[new _gb,new _gb,new _gb],this.trianglePositions.length=3,this.triangleNormals=[new _gb,new _gb,new _gb],this.triangleNormals.length=3,this.position=new _gb}_n(_a,"laya.d3.utils.RaycastHit"),_a.prototype.cloneTo=function(_a){_a.distance=this.distance,this.trianglePositions[0].cloneTo(_a.trianglePositions[0]),this.trianglePositions[1].cloneTo(_a.trianglePositions[1]),this.trianglePositions[2].cloneTo(_a.trianglePositions[2]),this.triangleNormals[0].cloneTo(_a.triangleNormals[0]),this.triangleNormals[1].cloneTo(_a.triangleNormals[1]),this.triangleNormals[2].cloneTo(_a.triangleNormals[2]),this.position.cloneTo(_a.position),_a.sprite3D=this.sprite3D}}(),function(){function _a(_a,_b){this._width=0,this._height=0,this._width=_a,this._height=_b}_n(_a,"laya.d3.utils.Size");var _b=_a.prototype;return _o(0,_b,"width",function(){return-1===this._width?_W.clientWidth:this._width}),_o(0,_b,"height",function(){return-1===this._height?_W.clientHeight:this._height}),_o(1,_a,"fullScreen",function(){return new _a(-1,-1)}),_a}()),_qb=function(){function _G(){}return _n(_G,"laya.d3.utils.Utils3D"),_G._rotationTransformScaleSkinAnimation=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l){var _m,_n,_o,_p,_q,_r=_G._tempArray16_0,_s=_G._tempArray16_1,_t=_G._tempArray16_2,_u=_d+_d,_v=_e+_e,_w=_f+_f,_x=_d*_u,_y=_e*_u,_z=_e*_v,_A=_f*_u,_B=_f*_v,_C=_f*_w,_D=_g*_u,_E=_g*_v,_F=_g*_w;for(_r[15]=1,_r[0]=1-_z-_C,_r[1]=_y+_F,_r[2]=_A-_E,_r[4]=_y-_F,_r[5]=1-_x-_C,_r[6]=_B+_D,_r[8]=_A+_E,_r[9]=_B-_D,_r[10]=1-_x-_z,_s[15]=1,_s[0]=_h,_s[5]=_i,_s[10]=_j,_m=0;_m<4;_m++)_n=_r[_m],_o=_r[_m+4],_p=_r[_m+8],_q=_r[_m+12],_t[_m]=_n,_t[_m+4]=_o,_t[_m+8]=_p,_t[_m+12]=_n*_a+_o*_b+_p*_c+_q;for(_m=0;_m<4;_m++)_n=_t[_m],_o=_t[_m+4],_p=_t[_m+8],_q=_t[_m+12],_k[_m+_l]=_n*_s[0]+_o*_s[1]+_p*_s[2]+_q*_s[3],_k[_m+_l+4]=_n*_s[4]+_o*_s[5]+_p*_s[6]+_q*_s[7],_k[_m+_l+8]=_n*_s[8]+_o*_s[9]+_p*_s[10]+_q*_s[11],_k[_m+_l+12]=_n*_s[12]+_o*_s[13]+_p*_s[14]+_q*_s[15]},_G._createNodeByJson=function(_a,_b,_c,_d){if(!_c)switch(_b.type){case"Sprite3D":_c=new _Ib;break;case"MeshSprite3D":_c=new _Vb;break;case"SkinnedMeshSprite3D":_c=new SkinnedMeshSprite3D;break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":_c=new ShuriKenParticle3D;break;case"TrailSprite3D":_c=new TrailSprite3D;break;case"Terrain":_c=new Terrain;break;case"Camera":_c=new _Ub;break;case"DirectionLight":_c=new DirectionLight;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var _e=_b.props;if(_e)for(var _f in _e)_c[_f]=_e[_f];var _g=_b.customProps;_g&&(_c instanceof laya.d3.core.Sprite3D?(_c._parseBaseCustomProps(_g),_c._parseCustomProps(_a,_d,_g,_b),_c._parseCustomComponent(_a,_d,_b.components)):_c._parseCustomProps(_a,_d,_g,_b));var _h=_b.child;if(_h)for(var _i=0,_j=_h.length;_i<_j;_i++){var _k=_G._createNodeByJson(_a,_h[_i],null,_d);_c.addChild(_k)}return _c},_G._computeBoneAndAnimationDatasByBindPoseMatrxix=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i=0,_j=0,_k=_a.length;for(_g=0;_g<_k;_i+=_a[_g].keyframeWidth,_j+=16,_g++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(_b[_i+0],_b[_i+1],_b[_i+2],_b[_i+3],_b[_i+4],_b[_i+5],_b[_i+6],_b[_i+7],_b[_i+8],_b[_i+9],_d,_j),0!=_g&&(_h=16*_a[_g].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(_d,_h,_d,_j,_d,_j));var _l=_c.length;for(_g=0;_g<_l;_g++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(_d,16*_f[_g],_c[_g],_e,16*_g)},_G._computeAnimationDatasByArrayAndMatrixFast=function(_a,_b,_c,_d){for(var _e=0,_f=_a.length;_e<_f;_e++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(_b,16*_d[_e],_a[_e],_c,16*_e)},_G._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(_a,_b,_c,_d,_e){var _f,_g,_h=0,_i=0,_j=_a.length;for(_f=0;_f<_j;_h+=_a[_f].keyframeWidth,_i+=16,_f++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(_b[_h+7],_b[_h+8],_b[_h+9],_b[_h+3],_b[_h+4],_b[_h+5],_b[_h+6],_b[_h+0],_b[_h+1],_b[_h+2],_d,_i),0!=_f&&(_g=16*_a[_f].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(_d,_g,_d,_i,_d,_i));var _k=_c.length;for(_f=0;_f<_k;_f++){var _l=16*_f;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(_d,_l,_c[_f],_e,_l)}},_G._computeAnimationDatasByArrayAndMatrixFastOld=function(_a,_b,_c){for(var _d=_a.length,_e=0;_e<_d;_e++){var _f=16*_e;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(_b,_f,_a[_e],_c,_f)}},_G._computeRootAnimationData=function(_a,_b,_c){for(var _d=0,_e=0,_f=0,_g=_a.length;_d<_g;_e+=_a[_d].keyframeWidth,_f+=16,_d++)laya.d3.utils.Utils3D.createAffineTransformationArray(_b[_e+0],_b[_e+1],_b[_e+2],_b[_e+3],_b[_e+4],_b[_e+5],_b[_e+6],_b[_e+7],_b[_e+8],_b[_e+9],_c,_f)},_G.transformVector3ArrayByQuat=function(_a,_b,_c,_d,_e){var _f=_c.elements,_g=_a[_b],_h=_a[_b+1],_i=_a[_b+2],_j=_f[0],_k=_f[1],_l=_f[2],_m=_f[3],_n=_m*_g+_k*_i-_l*_h,_o=_m*_h+_l*_g-_j*_i,_p=_m*_i+_j*_h-_k*_g,_q=-_j*_g-_k*_h-_l*_i;_d[_e]=_n*_m+_q*-_j+_o*-_l-_p*-_k,_d[_e+1]=_o*_m+_q*-_k+_p*-_j-_n*-_l,_d[_e+2]=_p*_m+_q*-_l+_n*-_k-_o*-_j},_G.mulMatrixByArray=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i,_j,_k;if(_e===_c){for(_c=_G._tempArray16_3,_g=0;_g<16;++_g)_c[_g]=_e[_f+_g];_d=0}for(_g=0;_g<4;_g++)_h=_a[_b+_g],_i=_a[_b+_g+4],_j=_a[_b+_g+8],_k=_a[_b+_g+12],_e[_f+_g]=_h*_c[_d+0]+_i*_c[_d+1]+_j*_c[_d+2]+_k*_c[_d+3],_e[_f+_g+4]=_h*_c[_d+4]+_i*_c[_d+5]+_j*_c[_d+6]+_k*_c[_d+7],_e[_f+_g+8]=_h*_c[_d+8]+_i*_c[_d+9]+_j*_c[_d+10]+_k*_c[_d+11],_e[_f+_g+12]=_h*_c[_d+12]+_i*_c[_d+13]+_j*_c[_d+14]+_k*_c[_d+15]},_G.mulMatrixByArrayFast=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i,_j,_k;for(_g=0;_g<4;_g++)_h=_a[_b+_g],_i=_a[_b+_g+4],_j=_a[_b+_g+8],_k=_a[_b+_g+12],_e[_f+_g]=_h*_c[_d+0]+_i*_c[_d+1]+_j*_c[_d+2]+_k*_c[_d+3],_e[_f+_g+4]=_h*_c[_d+4]+_i*_c[_d+5]+_j*_c[_d+6]+_k*_c[_d+7],_e[_f+_g+8]=_h*_c[_d+8]+_i*_c[_d+9]+_j*_c[_d+10]+_k*_c[_d+11],_e[_f+_g+12]=_h*_c[_d+12]+_i*_c[_d+13]+_j*_c[_d+14]+_k*_c[_d+15]},_G.mulMatrixByArrayAndMatrixFast=function(_a,_b,_c,_d,_e){var _f,_g,_h,_i,_j,_k=_c.elements,_l=_k[0],_m=_k[1],_n=_k[2],_o=_k[3],_p=_k[4],_q=_k[5],_r=_k[6],_s=_k[7],_t=_k[8],_u=_k[9],_v=_k[10],_w=_k[11],_x=_k[12],_y=_k[13],_z=_k[14],_A=_k[15],_B=_b,_C=_b+4,_D=_b+8,_E=_b+12,_F=_e,_G=_e+4,_H=_e+8,_I=_e+12;for(_f=0;_f<4;_f++)_g=_a[_B+_f],_h=_a[_C+_f],_i=_a[_D+_f],_j=_a[_E+_f],_d[_F+_f]=_g*_l+_h*_m+_i*_n+_j*_o,_d[_G+_f]=_g*_p+_h*_q+_i*_r+_j*_s,_d[_H+_f]=_g*_t+_h*_u+_i*_v+_j*_w,_d[_I+_f]=_g*_x+_h*_y+_i*_z+_j*_A},_G.createAffineTransformationArray=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l){var _m=_d+_d,_n=_e+_e,_o=_f+_f,_p=_d*_m,_q=_d*_n,_r=_d*_o,_s=_e*_n,_t=_e*_o,_u=_f*_o,_v=_g*_m,_w=_g*_n,_x=_g*_o;_k[_l+0]=(1-(_s+_u))*_h,_k[_l+1]=(_q+_x)*_h,_k[_l+2]=(_r-_w)*_h,_k[_l+3]=0,_k[_l+4]=(_q-_x)*_i,_k[_l+5]=(1-(_p+_u))*_i,_k[_l+6]=(_t+_v)*_i,_k[_l+7]=0,_k[_l+8]=(_r+_w)*_j,_k[_l+9]=(_t-_v)*_j,_k[_l+10]=(1-(_p+_s))*_j,_k[_l+11]=0,_k[_l+12]=_a,_k[_l+13]=_b,_k[_l+14]=_c,_k[_l+15]=1},_G.transformVector3ArrayToVector3ArrayCoordinate=function(_a,_b,_c,_d,_e){var _f=_G._tempArray4_0,_g=_a[_b+0],_h=_a[_b+1],_i=_a[_b+2],_j=_c.elements;_f[0]=_g*_j[0]+_h*_j[4]+_i*_j[8]+_j[12],_f[1]=_g*_j[1]+_h*_j[5]+_i*_j[9]+_j[13],_f[2]=_g*_j[2]+_h*_j[6]+_i*_j[10]+_j[14],_f[3]=1/(_g*_j[3]+_h*_j[7]+_i*_j[11]+_j[15]),_d[_e+0]=_f[0]*_f[3],_d[_e+1]=_f[1]*_f[3],_d[_e+2]=_f[2]*_f[3]},_G.transformLightingMapTexcoordByUV0Array=function(_a,_b,_c,_d,_e){var _f=_c.elements;_d[_e+0]=_a[_b+0]*_f[0]+_f[2],_d[_e+1]=(_a[_b+1]-1)*_f[1]+_f[3]},_G.transformLightingMapTexcoordByUV1Array=function(_a,_b,_c,_d,_e){var _f=_c.elements;_d[_e+0]=_a[_b+0]*_f[0]+_f[2],_d[_e+1]=1+_a[_b+1]*_f[1]+_f[3]},_G.getURLVerion=function(_a){var _b=_a.indexOf("?");return 0<=_b?_a.substr(_b):null},_G._quaternionCreateFromYawPitchRollArray=function(_a,_b,_c,_d){var _e=.5*_c,_f=.5*_b,_g=.5*_a,_h=Math.sin(_e),_i=Math.cos(_e),_j=Math.sin(_f),_k=Math.cos(_f),_l=Math.sin(_g),_m=Math.cos(_g);_d[0]=_m*_j*_i+_l*_k*_h,_d[1]=_l*_k*_i-_m*_j*_h,_d[2]=_m*_k*_h-_l*_j*_i,_d[3]=_m*_k*_i+_l*_j*_h},_G._createAffineTransformationArray=function(_a,_b,_c,_d){var _e=_b[0],_f=_b[1],_g=_b[2],_h=_b[3],_i=_e+_e,_j=_f+_f,_k=_g+_g,_l=_e*_i,_m=_e*_j,_n=_e*_k,_o=_f*_j,_p=_f*_k,_q=_g*_k,_r=_h*_i,_s=_h*_j,_t=_h*_k,_u=_c[0],_v=_c[1],_w=_c[2];_d[0]=(1-(_o+_q))*_u,_d[1]=(_m+_t)*_u,_d[2]=(_n-_s)*_u,_d[3]=0,_d[4]=(_m-_t)*_v,_d[5]=(1-(_l+_q))*_v,_d[6]=(_p+_r)*_v,_d[7]=0,_d[8]=(_n+_s)*_w,_d[9]=(_p-_r)*_w,_d[10]=(1-(_l+_o))*_w,_d[11]=0,_d[12]=_a[0],_d[13]=_a[1],_d[14]=_a[2],_d[15]=1},_G._mulMatrixArray=function(_a,_b,_c,_d){var _e,_f,_g,_h,_i,_j=_b.elements,_k=_j[0],_l=_j[1],_m=_j[2],_n=_j[3],_o=_j[4],_p=_j[5],_q=_j[6],_r=_j[7],_s=_j[8],_t=_j[9],_u=_j[10],_v=_j[11],_w=_j[12],_x=_j[13],_y=_j[14],_z=_j[15],_A=_d,_B=_d+4,_C=_d+8,_D=_d+12;for(_e=0;_e<4;_e++)_f=_a[_e],_g=_a[_e+4],_h=_a[_e+8],_i=_a[_e+12],_c[_A+_e]=_f*_k+_g*_l+_h*_m+_i*_n,_c[_B+_e]=_f*_o+_g*_p+_h*_q+_i*_r,_c[_C+_e]=_f*_s+_g*_t+_h*_u+_i*_v,_c[_D+_e]=_f*_w+_g*_x+_h*_y+_i*_z},_G.getYawPitchRoll=function(_a,_b){_G.transformQuat(_gb.ForwardRH,_a,_cb.TEMPVector31),_G.transformQuat(_gb.Up,_a,_cb.TEMPVector32);var _c=_cb.TEMPVector32.elements;_G.angleTo(_gb.ZERO,_cb.TEMPVector31,_cb.TEMPVector33);var _d=_cb.TEMPVector33.elements;_d[0]==Math.PI/2?(_d[1]=_G.arcTanAngle(_c[2],_c[0]),_d[2]=0):_d[0]==-Math.PI/2?(_d[1]=_G.arcTanAngle(-_c[2],-_c[0]),_d[2]=0):(_ab.createRotationY(-_d[1],_cb.TEMPMatrix0),_ab.createRotationX(-_d[0],_cb.TEMPMatrix1),_gb.transformCoordinate(_cb.TEMPVector32,_cb.TEMPMatrix0,_cb.TEMPVector32),_gb.transformCoordinate(_cb.TEMPVector32,_cb.TEMPMatrix1,_cb.TEMPVector32),_d[2]=_G.arcTanAngle(_c[1],-_c[0])),_d[1]<=-Math.PI&&(_d[1]=Math.PI),_d[2]<=-Math.PI&&(_d[2]=Math.PI),_d[1]>=Math.PI&&_d[2]>=Math.PI&&(_d[1]=0,_d[2]=0,_d[0]=Math.PI-_d[0]),_b[0]=_d[1],_b[1]=_d[0],_b[2]=_d[2]},_G.arcTanAngle=function(_a,_b){return 0==_a?1==_b?Math.PI/2:-Math.PI/2:0<_a?Math.atan(_b/_a):_a<0?0<_b?Math.atan(_b/_a)+Math.PI:Math.atan(_b/_a)-Math.PI:0},_G.angleTo=function(_a,_b,_c){_gb.subtract(_b,_a,_cb.TEMPVector30),_gb.normalize(_cb.TEMPVector30,_cb.TEMPVector30),_c.elements[0]=Math.asin(_cb.TEMPVector30.y),_c.elements[1]=_G.arcTanAngle(-_cb.TEMPVector30.z,-_cb.TEMPVector30.x)},_G.transformQuat=function(_a,_b,_c){var _d=_c.elements,_e=_a.elements,_f=_b,_g=_e[0],_h=_e[1],_i=_e[2],_j=_f[0],_k=_f[1],_l=_f[2],_m=_f[3],_n=_m*_g+_k*_i-_l*_h,_o=_m*_h+_l*_g-_j*_i,_p=_m*_i+_j*_h-_k*_g,_q=-_j*_g-_k*_h-_l*_i;_d[0]=_n*_m+_q*-_j+_o*-_l-_p*-_k,_d[1]=_o*_m+_q*-_k+_p*-_j-_n*-_l,_d[2]=_p*_m+_q*-_l+_n*-_k-_o*-_j},_G.quaterionNormalize=function(_a,_b){var _c=_a[0],_d=_a[1],_e=_a[2],_f=_a[3],_g=_c*_c+_d*_d+_e*_e+_f*_f;0<_g&&(_g=1/Math.sqrt(_g),_b[0]=_c*_g,_b[1]=_d*_g,_b[2]=_e*_g,_b[3]=_f*_g)},_G.matrix4x4MultiplyFFF=function(_a,_b,_c){var _d,_e,_f,_g,_h;if(_c===_b)for(_b=new Float32Array(16),_d=0;_d<16;++_d)_b[_d]=_c[_d];for(_d=0;_d<4;_d++)_e=_a[_d],_f=_a[_d+4],_g=_a[_d+8],_h=_a[_d+12],_c[_d]=_e*_b[0]+_f*_b[1]+_g*_b[2]+_h*_b[3],_c[_d+4]=_e*_b[4]+_f*_b[5]+_g*_b[6]+_h*_b[7],_c[_d+8]=_e*_b[8]+_f*_b[9]+_g*_b[10]+_h*_b[11],_c[_d+12]=_e*_b[12]+_f*_b[13]+_g*_b[14]+_h*_b[15]},_G.matrix4x4MultiplyMFM=function(_a,_b,_c){_G.matrix4x4MultiplyFFF(_a.elements,_b,_c.elements)},_l(_G,["_typeToFunO",function(){return this._typeToFunO={INT16:"writeInt16",SHORT:"writeInt16",UINT16:"writeUint16",UINT32:"writeUint32",FLOAT32:"writeFloat32",INT:"writeInt32",UINT:"writeUint32",BYTE:"writeByte",STRING:"writeUTFString"}},"_tempVector3_0",function(){return this._tempVector3_0=new _gb},"_tempVector3_1",function(){return this._tempVector3_1=new _gb},"_tempVector3_2",function(){return this._tempVector3_2=new _gb},"_tempVector3_3",function(){return this._tempVector3_3=new _gb},"_tempVector3_4",function(){return this._tempVector3_4=new _gb},"_tempVector3_5",function(){return this._tempVector3_5=new _gb},"_tempVector3_6",function(){return this._tempVector3_6=new _gb},"_tempArray4_0",function(){return this._tempArray4_0=new Float32Array(4)},"_tempArray16_0",function(){return this._tempArray16_0=new Float32Array(16)},"_tempArray16_1",function(){return this._tempArray16_1=new Float32Array(16)},"_tempArray16_2",function(){return this._tempArray16_2=new Float32Array(16)},"_tempArray16_3",function(){return this._tempArray16_3=new Float32Array(16)}]),_G}(),_rb=function(){function _E(){}return _n(_E,"Laya3D"),_E._cancelLoadByUrl=function(_a){_v.loader.cancelLoadByUrl(_a),_E._innerFirstLevelLoaderManager.cancelLoadByUrl(_a),_E._innerSecondLevelLoaderManager.cancelLoadByUrl(_a),_E._innerThirdLevelLoaderManager.cancelLoadByUrl(_a),_E._innerFourthLevelLoaderManager.cancelLoadByUrl(_a)},_E._changeWebGLSize=function(_a,_b){_D.onStageResize(_a,_b),_W.clientWidth=_a,_W.clientHeight=_b},_E.__init__=function(){var _a=_b.createMap;_a.lh=[_Ib,"SPRITE3DHIERARCHY"],_a.ls=[_Hb,"SPRITE3DHIERARCHY"],_a.lm=[_Pb,"MESH"],_a.lmat=[_Kb,"MATERIAL"],_a.jpg=[_Rb,"nativeimage"],_a.jpeg=[_Rb,"nativeimage"],_a.png=[_Rb,"nativeimage"],_a.pkm=[_Rb,"arraybuffer"],_a.raw=[_Nb,"arraybuffer"],_a.mipmaps=[_Nb,"arraybuffer"],_r.parserMap.SPRITE3DHIERARCHY=_E._loadHierarchy,_r.parserMap.MESH=_E._loadMesh,_r.parserMap.MATERIAL=_E._loadMaterial,_r.parserMap.TEXTURECUBE=_E._loadTextureCube,_r.parserMap.TERRAIN=_E._loadTerrain,_E._innerFirstLevelLoaderManager.on("error",null,_E._eventLoadManagerError),_E._innerSecondLevelLoaderManager.on("error",null,_E._eventLoadManagerError),_E._innerThirdLevelLoaderManager.on("error",null,_E._eventLoadManagerError),_E._innerFourthLevelLoaderManager.on("error",null,_E._eventLoadManagerError)},_E.READ_BLOCK=function(){return _E._readData.pos+=4,!0},_E.READ_DATA=function(){return _E._DATA.offset=_E._readData.getUint32(),_E._DATA.size=_E._readData.getUint32(),!0},_E.READ_STRINGS=function(){var _a=[],_b={offset:0,size:0};_b.offset=_E._readData.getUint16(),_b.size=_E._readData.getUint16();_E._readData.pos;_E._readData.pos=_b.offset+_E._DATA.offset;for(var _c=0;_c<_b.size;_c++){var _d=_E._readData.readUTFString();-1===_d.lastIndexOf(".lmat")&&-1===_d.lastIndexOf(".lpbr")||_a.push(_d)}return _a},_E.formatRelativePath=function(_a,_b){var _c;if("."===_b.charAt(0)){for(var _d=(_a+_b).split("/"),_e=0,_f=_d.length;_e<_f;_e++)if(".."==_d[_e]){var _g=_e-1;0<_g&&".."!==_d[_g]&&(_d.splice(_g,2),_e-=2)}_c=_d.join("/")}else _c=_a+_b;return null!=_C.customFormat&&(_c=_C.customFormat(_c,null)),_c},_E._eventLoadManagerError=function(_a){_v.loader.event("error",_a)},_E._addHierarchyInnerUrls=function(_a,_b,_c,_d,_e,_f){var _g=_E.formatRelativePath(_d,_e);_c&&(_g+=_c),_a.push({url:_g,clas:_f}),_b[_e]=_g},_E._getSprite3DHierarchyInnerUrls=function(_a,_b,_c,_d,_e,_f,_g){var _h,_i=0,_j=0;switch(_a.type){case"Scene":var _k=_a.customProps.lightmaps;for(_i=0,_j=_k.length;_i<_j;_i++){var _l=_k[_i].replace(".exr",".png");_E._addHierarchyInnerUrls(_d,_e,_f,_g,_l,_Rb)}break;case"MeshSprite3D":case"TrailSprite3D":case"LineSprite3D":case"SkinnedMeshSprite3D":var _m;if(_a.instanceParams)(_m=_a.instanceParams.loadPath)&&_E._addHierarchyInnerUrls(_b,_e,_f,_g,_m,_Pb);else{(_m=(_h=_a.customProps).meshPath)&&_E._addHierarchyInnerUrls(_b,_e,_f,_g,_m,_Pb);var _n=_h.materials;if(_n)for(_i=0,_j=_n.length;_i<_j;_i++){for(var _o=_n[_i],_p=_o.type.split("."),_q=_F.window,_r=0,_s=_p.length;_r<_s;++_r){_q=_q[this.clasPaths[_r]]}if("function"!=typeof _q)throw"_getSprite3DHierarchyInnerUrls 错误: "+_o.type+" 不是类";_E._addHierarchyInnerUrls(_c,_e,_f,_g,_o.path,_q)}}break;case"ShuriKenParticle3D":case"MyShuriKenParticle3D":var _t=(_h=_a.customProps).meshPath;_t&&_E._addHierarchyInnerUrls(_b,_e,_f,_g,_t,_Pb);var _u=_h.material;if(_u){_p=_u.type.split("."),_q=_F.window;for(_r=0,_s=_p.length;_r<_s;++_r){_q=_q[this.clasPaths[_r]]}_E._addHierarchyInnerUrls(_c,_e,_f,_g,_u.path,_q)}else{var _v=_h.materialPath;if(_v)_E._addHierarchyInnerUrls(_c,_e,_f,_g,_v,ShurikenParticleMaterial);else{var _w=_h.texturePath;_w&&_E._addHierarchyInnerUrls(_d,_e,_f,_g,_w,_Rb)}}break;case"Terrain":_E._addHierarchyInnerUrls(_d,_e,_f,_g,_a.customProps.dataPath,TerrainRes)}var _x=_a.components;for(var _y in _x){var _z=_x[_y];switch(_y){case"Animator":var _A=_z.avatarPath;if(_A)_E._addHierarchyInnerUrls(_d,_e,_f,_g,_A,Avatar);else{var _B=_z.avatar;_B&&_E._addHierarchyInnerUrls(_d,_e,_f,_g,_B.path,Avatar)}var _C=_z.clipPaths;for(_i=0,_j=_C.length;_i<_j;_i++)_E._addHierarchyInnerUrls(_d,_e,_f,_g,_C[_i],AnimationClip)}}var _D=_a.child;for(_i=0,_j=_D.length;_i<_j;_i++)_E._getSprite3DHierarchyInnerUrls(_D[_i],_b,_c,_d,_e,_f,_g)},_E._loadHierarchy=function(_a){_a.on("loaded",null,_E._onHierarchylhLoaded,[_a,_a._class._getGroup()]),_a.load(_a.url,"json",!1,null,!0)},_E._onHierarchylhLoaded=function(_a,_b,_c){if(_a._class.destroyed)_a.endLoad();else{var _d=_a.url,_e=_qb.getURLVerion(_d),_f=_C.getPath(_d),_g=[],_h=[],_i=[],_j={};_E._getSprite3DHierarchyInnerUrls(_c,_g,_h,_i,_j,_e,_f);var _k=_g.length+_h.length+_i.length,_l=_k+1,_m=1/_l;if(_E._onProcessChange(_a,0,_m,1),0<_i.length){var _n=_k/_l,_o=_B.create(null,_E._onProcessChange,[_a,_m,_n],!1);_E._innerFourthLevelLoaderManager.create(_i,_B.create(null,_E._onHierarchyInnerForthLevResouLoaded,[_a,_b,_o,_c,_j,_g,_h,_m+_n*_i.length,_n]),_o,null,null,1,!0,_b)}else _E._onHierarchyInnerForthLevResouLoaded(_a,_b,null,_c,_j,_g,_h,_m,_n)}},_E._onHierarchyInnerForthLevResouLoaded=function(_a,_b,_c,_d,_e,_f,_g,_h,_i){if(_a._class.destroyed)_a.endLoad();else if(_c&&_c.recover(),0<_g.length){var _j=_B.create(null,_E._onProcessChange,[_a,_h,_i],!1);_E._innerSecondLevelLoaderManager.create(_g,_B.create(null,_E._onHierarchyInnerSecondLevResouLoaded,[_a,_b,_j,_d,_e,_f,_h+_i*_g.length,_i]),_c,null,null,1,!0,_b)}else _E._onHierarchyInnerSecondLevResouLoaded(_a,_b,null,_d,_e,_f,_h,_i)},_E._onHierarchyInnerSecondLevResouLoaded=function(_a,_b,_c,_d,_e,_f,_g,_h){if(_a._class.destroyed)_a.endLoad();else if(_c&&_c.recover(),0<_f.length){var _i=_B.create(null,_E._onProcessChange,[_a,_g,_h],!1);_E._innerFirstLevelLoaderManager.create(_f,_B.create(null,_E._onHierarchyInnerFirstLevResouLoaded,[_a,_i,_d,_e]),_c,null,null,1,!0,_b)}else _E._onHierarchyInnerFirstLevResouLoaded(_a,null,_d,_e)},_E._onHierarchyInnerFirstLevResouLoaded=function(_a,_b,_c,_d){_b&&_b.recover(),_a.endLoad([_c,_d])},_E._loadTerrain=function(_a){_a.on("loaded",null,_E._onTerrainLtLoaded,[_a,_a._class._getGroup()]),_a.load(_a.url,"json",!1,null,!0)},_E._onTerrainLtLoaded=function(_a,_b,_c){if(_a._class.destroyed)_a.endLoad();else{var _d,_e,_f=_a.url,_g=_qb.getURLVerion(_f),_h=_C.getPath(_f),_i=[],_j={},_k=0,_l=0,_m=_c.heightData;_d=_m.url,_e=_E.formatRelativePath(_h,_d),_g&&(_e+=_g),_d=_j[_d]=_e;var _n=_c.detailTexture;for(_k=0,_l=_n.length;_k<_l;_k++)_i.push({url:_n[_k].diffuse});var _o=_c.normalMap;for(_k=0,_l=_o.length;_k<_l;_k++)_i.push({url:_o[_k]});var _p=_c.alphaMap;for(_k=0,_l=_p.length;_k<_l;_k++)_i.push({url:_p[_k],params:[!1,!1,6408,!0]});for(_k=0,_l=_i.length;_k<_l;_k++){var _q=_i[_k].url;_e=_E.formatRelativePath(_h,_q),_g&&(_e+=_g),_i[_k].url=_e,_j[_q]=_e}var _r=_i.length,_s=_r+2,_t=1/_s;_E._onProcessChange(_a,0,_t,1);var _u={heightMapLoaded:!1,texturesLoaded:!1},_v=_B.create(null,_E._onProcessChange,[_a,_t,_t],!1);_E._innerFourthLevelLoaderManager.create(_d,_B.create(null,_E._onTerrainHeightMapLoaded,[_a,_v,_c,_j,_u]),_v,null,[_m.numX,_m.numZ,_m.bitType,_m.value],1,!0,_b);var _w=_B.create(null,_E._onProcessChange,[_a,2*_t,_r/_s],!1);_E._innerFourthLevelLoaderManager.create(_i,_B.create(null,_E._onTerrainTexturesLoaded,[_a,_w,_c,_j,_u]),_w,null,null,1,!0,_b)}},_E._onTerrainHeightMapLoaded=function(_a,_b,_c,_d,_e){_e.heightMapLoaded=!0,_e.texturesLoaded&&(_a.endLoad([_c,_d]),_b.recover())},_E._onTerrainTexturesLoaded=function(_a,_b,_c,_d,_e){_e.texturesLoaded=!0,_e.heightMapLoaded&&(_a.endLoad([_c,_d]),_b.recover())},_E._loadMesh=function(_a){_a.on("loaded",null,_E._onMeshLmLoaded,[_a,_a._class._getGroup()]),_a.load(_a.url,"arraybuffer",!1,null,!0)},_E._onMeshLmLoaded=function(_a,_b,_c){if(_a._class.destroyed)_a.endLoad();else{var _d,_e,_f,_g=_a.url,_h=_qb.getURLVerion(_g),_i=_C.getPath(_g),_j={},_k=0,_l=0;switch((_E._readData=new _w(_c)).pos=0,_E._readData.readUTFString()){case"LAYAMODEL:02":case"LAYAMODEL:03":case"LAYAMODEL:0301":var _m=_E._readData.getUint32();_E._readData.pos=_E._readData.pos+4,_l=_E._readData.getUint16(),_E._readData.pos=_E._readData.pos+8*_l;var _n=_E._readData.getUint32();for(_l=_E._readData.getUint16(),_E._readData.pos=_m+_n,_d=[],_k=0;_k<_l;_k++){var _o=_E._readData.readUTFString();-1!==_o.lastIndexOf(".lmat")&&_d.push(_o)}break;default:for(_E.READ_BLOCK(),_k=0;_k<2;_k++){var _p=_E._readData.getUint16(),_q=_E._strings[_p],_r=_E["READ_"+_q];if(null==_r)throw new Error("model file err,no this function:"+_p+" "+_q);1===_k?_d=_r.call():_r.call()}}for(_k=0,_f=_d.length;_k<_f;_k++){var _s=_d[_k];_e=_E.formatRelativePath(_i,_s),_h&&(_e+=_h),_d[_k]=_e,_j[_s]=_e}if(0<_d.length){_E._onProcessChange(_a,0,.5,1);var _t=_B.create(null,_E._onProcessChange,[_a,.5,.5],!1);_E._innerSecondLevelLoaderManager.create(_d,_B.create(null,_E._onMeshMateialLoaded,[_a,_t,_c,_j]),_t,null,null,1,!0,_b)}else _a.endLoad([_c,_j])}},_E._onMeshMateialLoaded=function(_a,_b,_c,_d){_a.endLoad([_c,_d]),_b.recover()},_E._getMaterialTexturePath=function(_a,_b,_c){var _d=_a.length-4;return _a.indexOf(".dds")!=_d&&_a.indexOf(".tga")!=_d&&_a.indexOf(".exr")!=_d&&_a.indexOf(".DDS")!=_d&&_a.indexOf(".TGA")!=_d&&_a.indexOf(".EXR")!=_d||(_a=_a.substr(0,_d)+".png"),_a=_E.formatRelativePath(_c,_a),_b&&(_a+=_b),_a},_E._loadMaterial=function(_a){_a.on("loaded",null,_E._onMaterilLmatLoaded,[_a,_a._class._getGroup()]),_a.load(_a.url,"json",!1,null,!0)},_E._onMaterilLmatLoaded=function(_a,_b,_c){if(_a._class.destroyed)_a.endLoad();else{var _d,_e=_a.url,_f=_qb.getURLVerion(_e),_g=_C.getPath(_e),_h=[],_i={},_j=_c.customProps,_k=_c.version;if(_k)switch(_k){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":for(var _l=_c.props.textures,_m=0,_n=_l.length;_m<_n;_m++){var _o=_l[_m],_p=_o.path;if(_p){var _q=_p.length-4;_p.indexOf(".exr")!=_q&&_p.indexOf(".EXR")!=_q||(_p=_p.substr(0,_q)+".png"),_d=_E.formatRelativePath(_g,_p),_f&&(_d+=_f),_h.push({url:_d,params:_o.params}),_i[_p]=_d}}break;default:throw new Error("Laya3D:unkonwn version.")}else{var _r=_j.diffuseTexture.texture2D;if(_r&&(_d=_E._getMaterialTexturePath(_r,_f,_g),_h.push(_d),_i[_r]=_d),_j.normalTexture){var _s=_j.normalTexture.texture2D;_s&&(_d=_E._getMaterialTexturePath(_s,_f,_g),_h.push(_d),_i[_s]=_d)}if(_j.specularTexture){var _t=_j.specularTexture.texture2D;_t&&(_d=_E._getMaterialTexturePath(_t,_f,_g),_h.push(_d),_i[_t]=_d)}if(_j.emissiveTexture){var _u=_j.emissiveTexture.texture2D;_u&&(_d=_E._getMaterialTexturePath(_u,_f,_g),_h.push(_d),_i[_u]=_d)}if(_j.ambientTexture){var _v=_j.ambientTexture.texture2D;_v&&(_d=_E._getMaterialTexturePath(_v,_f,_g),_h.push(_d),_i[_v]=_d)}if(_j.reflectTexture){var _w=_j.reflectTexture.texture2D;_w&&(_d=_E._getMaterialTexturePath(_w,_f,_g),_h.push(_d),_i[_w]=_d)}}var _x=_h.length,_y=_x+1,_z=1/_y;if(_E._onProcessChange(_a,0,_z,1),0<_x){var _A=_B.create(null,_E._onProcessChange,[_a,_z,_x/_y],!1);_E._innerFourthLevelLoaderManager.create(_h,_B.create(null,_E._onMateialTexturesLoaded,[_a,_A,_c,_i]),_A,_Rb,null,1,!0,_b)}else _E._onMateialTexturesLoaded(_a,null,_c,null)}},_E._onMateialTexturesLoaded=function(_a,_b,_c,_d){_a.endLoad([_c,_d]),_b&&_b.recover()},_E._loadTextureCube=function(_a){_a.on("loaded",null,_E._onTextureCubeLtcLoaded,[_a]),_a.load(_a.url,"json",!1,null,!0)},_E._onTextureCubeLtcLoaded=function(_a,_b){if(_a._class.destroyed)_a.endLoad();else{var _c=_C.getPath(_a.url),_d=[_E.formatRelativePath(_c,_b.px),_E.formatRelativePath(_c,_b.nx),_E.formatRelativePath(_c,_b.py),_E.formatRelativePath(_c,_b.ny),_E.formatRelativePath(_c,_b.pz),_E.formatRelativePath(_c,_b.nz)];_E._onProcessChange(_a,0,1/7,1);var _e=_B.create(null,_E._onProcessChange,[_a,1/7,6/7],!1);_E._innerFourthLevelLoaderManager.load(_d,_B.create(null,_E._onTextureCubeImagesLoaded,[_a,_d,_e]),_e,"nativeimage")}},_E._onTextureCubeImagesLoaded=function(_a,_b,_c){var _d=[];_d.length=6;for(var _e=0;_e<6;_e++){var _f=_b[_e];_d[_e]=_r.getRes(_f),_r.clearRes(_f)}_a.endLoad(_d),_c.recover()},_E._onProcessChange=function(_a,_b,_c,_d){(_d=_b+_d*_c)<1&&_a.event("progress",_d)},_E.init=function(_a,_b,_c,_d,_e,_f){if(void 0===_c&&(_c=!1),void 0===_d&&(_d=!1),void 0===_e&&(_e=!0),void 0===_f&&(_f=!0),_s.update3DLoop=function(){},_s.cancelLoadByUrl=function(_a){_E._cancelLoadByUrl(_a)},_i.isAntialias=_c,_i.isAlpha=_d,_i.premultipliedAlpha=_e,_i.isStencil=_f,!_D.enable())throw new Error("Laya3D启动失败！\n模拟器：请尝试使用《雷电模拟器》最新版本！\n浏览器：请尝试关闭浏览器，确保浏览器进程全部结束后再进游戏！");_s.changeWebGLSize=_E._changeWebGLSize,_p.is3DMode=!0,_v.init(_a,_b),_G.__init__(),_lb.__init__(),_Vb.__init__(),_O.__init__(),_E.__init__(),_g.maxTextureCount=2,(_E.debugMode||_X.debugMode)&&(_E._debugPhasorSprite=new _T)},_E.HIERARCHY="SPRITE3DHIERARCHY",_E.MESH="MESH",_E.MATERIAL="MATERIAL",_E.PBRMATERIAL="PBRMTL",_E.TEXTURECUBE="TEXTURECUBE",_E.TERRAIN="TERRAIN",_E._readData=null,_E._debugPhasorSprite=null,_E.debugMode=!1,_l(_E,["_DATA",function(){return this._DATA={offset:0,size:0}},"_strings",function(){return this._strings=["BLOCK","DATA","STRINGS"]},"_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new _b},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new _b},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new _b},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new _b}]),_E}(),_sb=function(_a){function _e(_a){_e.__super.call(this),this._owner=_a,this._childs=[],this._localMatrix=new Float32Array(16),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}_n(_e,"laya.d3.animation.AnimationTransform3D",_f);var _b=_e.prototype;return _b._getlocalMatrix=function(){return this._localUpdate&&(_qb._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},_b._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0;for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldTransform()}},_b._setWorldMatrixAndUpdate=function(_a){if(this._worldMatrix=_a,null==this._parent)throw new Error("don't need to set worldMatrix to root Node.");if(null==this._parent._parent)for(var _b=this._getlocalMatrix(),_c=0;_c<16;++_c)this._worldMatrix[_c]=_b[_c];else _qb.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);this._worldUpdate=!1},_b._setWorldMatrixNoUpdate=function(_a){this._worldMatrix=_a},_b._setWorldMatrixIgnoreUpdate=function(_a){this._worldMatrix=_a,this._worldUpdate=!1},_b.getLocalPosition=function(){return this._localPosition},_b.setLocalPosition=function(_a){if(this._parent)this._localPosition=_a,this._localUpdate=!0,this._onWorldTransform();else{var _b=this._entity.owner._transform,_c=this._entity.localPosition,_d=_c.elements;_d[0]=_a[0],_d[1]=_a[1],_d[2]=_a[2],_b.localPosition=_c}},_b.getLocalRotation=function(){if(this._localQuaternionUpdate){var _a=this._localRotationEuler;_qb._quaternionCreateFromYawPitchRollArray(_a[1]/_e._angleToRandin,_a[0]/_e._angleToRandin,_a[2]/_e._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},_b.setLocalRotation=function(_a){if(this._parent)this._localRotation=_a,_qb.quaterionNormalize(this._localRotation,this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var _b=this._entity.owner._transform,_c=this._entity.localRotation,_d=_c.elements;_d[0]=_a[0],_d[1]=_a[1],_d[2]=_a[2],_d[3]=_a[3],_b.localRotation=_c}},_b.getLocalScale=function(){return this._localScale},_b.setLocalScale=function(_a){if(this._parent)this._localScale=_a,this._localUpdate=!0,this._onWorldTransform();else{var _b=this._entity.owner._transform,_c=this._entity.localScale,_d=_c.elements;_d[0]=_a[0],_d[1]=_a[1],_d[2]=_a[2],_b.localScale=_c}},_b.getLocalRotationEuler=function(){if(this._locaEulerlUpdate){_qb.getYawPitchRoll(this._localRotation,_e._tempVector3);var _a=_e._tempVector3,_b=this._localRotationEuler;_b[0]=_a[1]*_e._angleToRandin,_b[1]=_a[0]*_e._angleToRandin,_b[2]=_a[2]*_e._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},_b.setLocalRotationEuler=function(_a){if(this._parent)_qb._quaternionCreateFromYawPitchRollArray(_a[1]/_e._angleToRandin,_a[0]/_e._angleToRandin,_a[2]/_e._angleToRandin,this._localRotation),this._localRotationEuler=_a,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform();else{var _b=this._entity.owner._transform,_c=this._entity.localRotationEuler,_d=_c.elements;_d[0]=_a[0],_d[1]=_a[1],_d[2]=_a[2],_b.localRotationEuler=_c}},_b.getWorldMatrix=function(){if(this._worldUpdate){if(null!=this._parent._parent)_qb.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else for(var _a=this._getlocalMatrix(),_b=0;_b<16;++_b)this._worldMatrix[_b]=_a[_b];this._worldUpdate=!1}return this._worldMatrix},_b.setParent=function(_a){if(this._parent!==_a){if(this._parent){var _b=this._parent._childs,_c=_b.indexOf(this);_b.splice(_c,1)}_a&&(_a._childs.push(this),_a&&this._onWorldTransform()),this._parent=_a}},_l(_e,["_tempVector3",function(){return this._tempVector3=new Float32Array(3)},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),_e}(),_tb=function(_a){function _b(){this._destroyed=!1,this._id=0,this._enable=!1,this._owner=null,this.started=!1,_b.__super.call(this),this._destroyed=!1,this._id=_b._uniqueIDCounter,_b._uniqueIDCounter++}_n(_b,"laya.d3.component.Component3D",_f);var _c=_b.prototype;return _v.imps(_c,{"laya.d3.core.render.IUpdate":!0,"laya.resource.IDestroy":!0}),_c._initialize=function(_a){this._owner=_a,this._enable=!0,this.started=!1,this._load(_a)},_c._destroy=function(){this._unload(this._owner),this._owner=null,this._destroyed=!0},_c._load=function(_a){},_c._start=function(_a){},_c._update=function(_a){},_c._lateUpdate=function(_a){},_c._preRenderUpdate=function(_a){},_c._postRenderUpdate=function(_a){},_c._unload=function(_a){this.offAll()},_c._cloneTo=function(_a){},_o(0,_c,"id",function(){return this._id}),_o(0,_c,"destroyed",function(){return this._destroyed}),_o(0,_c,"owner",function(){return this._owner}),_o(0,_c,"enable",function(){return this._enable},function(_a){this._enable!==_a&&(this._enable=_a,this.event("enablechanged",this._enable))}),_o(0,_c,"isSingleton",function(){return _b._isSingleton}),_b._isSingleton=!0,_b._uniqueIDCounter=1,_b}(),_ub=function(_a){function _b(){this._destroyed=!1,_b.__super.call(this),this._destroyed=!1}_n(_b,"laya.d3.core.GeometryFilter",_f);var _c=_b.prototype;return _v.imps(_c,{"laya.resource.IDestroy":!0}),_c._destroy=function(){this.offAll(),this._destroyed=!0},_o(0,_c,"_isAsyncLoaded",function(){return!0}),_o(0,_c,"_originalBoundingBoxCorners",function(){throw new Error("BaseRender: must override it.")}),_o(0,_c,"_originalBoundingSphere",function(){throw new Error("BaseRender: must override it.")}),_o(0,_c,"_originalBoundingBox",function(){throw new Error("BaseRender: must override it.")}),_o(0,_c,"destroyed",function(){return this._destroyed}),_b}(),_vb=function(_a){function _d(_a){_d.__super.call(this),this._id=++_d._uniqueIDCounter,this._indexInSceneFrustumCullingObjects=-1,this._boundingBox=new _Xa(new _gb,new _gb),this._boundingBoxCenter=new _gb,this._boundingSphere=new _Za(new _gb,0),this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0,this._materials=[],this._renderElements=[],this._isPartOfStaticBatch=!1,this._destroyed=!1,this._owner=_a,this._enable=!0,this._materialsInstance=[],this.lightmapIndex=-1,this.castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,this._owner.transform.on("worldmatrixneedchanged",this,this._onWorldMatNeedChange)}_n(_d,"laya.d3.core.render.BaseRender",_f);var _b=_d.prototype;return _v.imps(_b,{"laya.resource.IDestroy":!0}),_b._changeMaterialReference=function(_a,_b){_a&&_a._removeReference(),_b._addReference()},_b._getInstanceMaterial=function(_a,_b){var _c=new _a.constructor;return _a.cloneTo(_c),_c.name=_c.name+"(Instance)",this._materialsInstance[_b]=!0,this._changeMaterialReference(this._materials[_b],_c),this._materials[_b]=_c},_b._setShaderValuelightMap=function(_a){this._setShaderValueTexture(3,_a)},_b._onWorldMatNeedChange=function(){this._boundingSphereNeedChange=!0,this._boundingBoxNeedChange=!0,this._boundingBoxCenterNeedChange=!0,this._octreeNodeNeedChange=!0},_b._renderRenderableBoundBox=function(){var _a=_rb._debugPhasorSprite,_b=this.boundingBox,_c=_d._tempBoundBoxCorners;_b.getCorners(_c),_a.line(_c[0],_d._greenColor,_c[1],_d._greenColor),_a.line(_c[2],_d._greenColor,_c[3],_d._greenColor),_a.line(_c[4],_d._greenColor,_c[5],_d._greenColor),_a.line(_c[6],_d._greenColor,_c[7],_d._greenColor),_a.line(_c[0],_d._greenColor,_c[3],_d._greenColor),_a.line(_c[1],_d._greenColor,_c[2],_d._greenColor),_a.line(_c[2],_d._greenColor,_c[6],_d._greenColor),_a.line(_c[3],_d._greenColor,_c[7],_d._greenColor),_a.line(_c[0],_d._greenColor,_c[4],_d._greenColor),_a.line(_c[1],_d._greenColor,_c[5],_d._greenColor),_a.line(_c[4],_d._greenColor,_c[7],_d._greenColor),_a.line(_c[5],_d._greenColor,_c[6],_d._greenColor)},_b._calculateBoundingSphere=function(){throw"BaseRender: must override it."},_b._calculateBoundingBox=function(){throw"BaseRender: must override it."},_b._setShaderValueTexture=function(_a,_b){this._owner._shaderValues.setValue(_a,_b)},_b._setShaderValueMatrix4x4=function(_a,_b){this._owner._shaderValues.setValue(_a,_b?_b.elements:null)},_b._setShaderValueColor=function(_a,_b){this._owner._shaderValues.setValue(_a,_b?_b.elements:null)},_b._setShaderValueBuffer=function(_a,_b){this._owner._shaderValues.setValue(_a,_b)},_b._setShaderValueInt=function(_a,_b){this._owner._shaderValues.setValue(_a,_b)},_b._setShaderValueBool=function(_a,_b){this._owner._shaderValues.setValue(_a,_b)},_b._setShaderValueNumber=function(_a,_b){this._owner._shaderValues.setValue(_a,_b)},_b._setShaderValueVector2=function(_a,_b){this._owner._shaderValues.setValue(_a,_b?_b.elements:null)},_b._addShaderDefine=function(_a){this._owner._shaderDefineValue|=_a},_b._removeShaderDefine=function(_a){this._owner._shaderDefineValue&=~_a},_b._renderUpdate=function(_a){return!0},_b._applyLightMapParams=function(){if(0<=this._lightmapIndex){var _a=this._owner.scene;if(_a){var _b=_a.getlightmaps()[this._lightmapIndex];_b?(this._addShaderDefine(_Tb.SAHDERDEFINE_LIGHTMAP),_b.loaded?this._setShaderValuelightMap(_b):_b.once("loaded",this,this._setShaderValuelightMap)):this._removeShaderDefine(_Tb.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_Tb.SAHDERDEFINE_LIGHTMAP)}else this._removeShaderDefine(_Tb.SAHDERDEFINE_LIGHTMAP)},_b._updateOctreeNode=function(){var _a=this._treeNode;_a&&this._octreeNodeNeedChange&&(_a.updateObject(this),this._octreeNodeNeedChange=!1)},_b._destroy=function(){this.offAll();var _a=0,_b=0;for(_a=0,_b=this._renderElements.length;_a<_b;_a++)this._renderElements[_a]._destroy();for(_a=0,_b=this._materials.length;_a<_b;_a++)this._materials[_a]._removeReference();this._renderElements=null,this._owner=null,this._materials=null,this._boundingBox=null,this._boundingBoxCenter=null,this._boundingSphere=null,this._lightmapScaleOffset=null,this._destroyed=!0},_o(0,_b,"boundingSphere",function(){return this._boundingSphereNeedChange&&(this._calculateBoundingSphere(),this._boundingSphereNeedChange=!1),this._boundingSphere}),_o(0,_b,"id",function(){return this._id}),_o(0,_b,"material",function(){var _a=this._materials[0];if(_a&&!this._materialsInstance[0]){var _b=this._getInstanceMaterial(_a,0);this.event("materialchanged",[this,0,_b])}return this._materials[0]},function(_a){this.sharedMaterial=_a}),_o(0,_b,"sharedMaterial",function(){return this._materials[0]},function(_a){var _b=this._materials[0];_b!==_a&&(this._materials[0]=_a,this._materialsInstance[0]=!1,this._changeMaterialReference(_b,_a),this.event("materialchanged",[this,0,_a]))}),_o(0,_b,"lightmapIndex",function(){return this._lightmapIndex},function(_a){this._lightmapIndex=_a,this._applyLightMapParams()}),_o(0,_b,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(_a){this._lightmapScaleOffset=_a,this._setShaderValueColor(2,_a),this._addShaderDefine(_Tb.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),_o(0,_b,"enable",function(){return this._enable},function(_a){this._enable=_a,this.event("enablechanged",[this,_a])}),_o(0,_b,"materials",function(){for(var _a=0,_b=this._materials.length;_a<_b;_a++)if(!this._materialsInstance[_a]){var _c=this._getInstanceMaterial(this._materials[_a],_a);this.event("materialchanged",[this,_a,_c])}return this._materials.slice()},function(_a){this.sharedMaterials=_a}),_o(0,_b,"sharedMaterials",function(){return this._materials.slice()},function(_a){if(!_a)throw new Error("MeshRender: shadredMaterials value can't be null.");var _b=_a.length;this._materialsInstance.length=_b;for(var _c=0;_c<_b;_c++){var _d=this._materials[_c];_d!==_a[_c]&&(this._materialsInstance[_c]=!1,this._changeMaterialReference(_d,_a[_c]),this.event("materialchanged",[this,_c,_a[_c]]))}this._materials=_a}),_o(0,_b,"boundingBox",function(){return this._boundingBoxNeedChange&&(this._calculateBoundingBox(),this._boundingBoxNeedChange=!1),this._boundingBox}),_o(0,_b,"boundingBoxCenter",function(){if(this._boundingBoxCenterNeedChange){var _a=this.boundingBox;_gb.add(_a.min,_a.max,this._boundingBoxCenter),_gb.scale(this._boundingBoxCenter,.5,this._boundingBoxCenter),this._boundingBoxCenterNeedChange=!1}return this._boundingBoxCenter}),_o(0,_b,"receiveShadow",function(){return this._receiveShadow},function(_a){this._receiveShadow!==_a&&((this._receiveShadow=_a)?this._addShaderDefine(_nb.SHADERDEFINE_RECEIVE_SHADOW):this._removeShaderDefine(_nb.SHADERDEFINE_RECEIVE_SHADOW))}),_o(0,_b,"destroyed",function(){return this._destroyed}),_d._uniqueIDCounter=0,_l(_d,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb,new _gb]},"_greenColor",function(){return this._greenColor=new _hb(0,1,0,1)}]),_d}(),_wb=function(_a){function _h(_a){this._owner=null,this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0,this._positionUpdate=!0,this._rotationUpdate=!0,this._scaleUpdate=!0,this._parent=null,this._childs=null,this._dummy=null,this.pivot=null,_h.__super.call(this),this._localPosition=new _gb,this._localRotation=new _cb(0,0,0,1),this._localScale=new _gb(1,1,1),this._localRotationEuler=new _gb,this._localMatrix=new _ab,this._position=new _gb,this._rotation=new _cb(0,0,0,1),this._scale=new _gb(1,1,1),this._worldMatrix=new _ab,this._forward=new _gb,this._up=new _gb,this._right=new _gb,this._owner=_a,this._childs=[]}_n(_h,"laya.d3.core.Transform3D",_f);var _b=_h.prototype;return _b._updateLocalMatrix=function(){if(!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z)_ab.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix);else{var _a=_h._tempVector30;_gb.multiply(this.pivot,this._localScale,_a);var _b=_h._tempVector31;_gb.subtract(_a,this.pivot,_b);var _c=_h._tempVector32,_d=this.localRotation;_gb.transformQuat(_a,_d,_c),_gb.subtract(_c,_a,_c);var _e=_h._tempVector33;_gb.subtract(this._localPosition,_b,_e),_gb.subtract(_e,_c,_e),_ab.createAffineTransformation(_e,_d,this._localScale,this._localMatrix)}},_b._onWorldPositionRotationTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._rotationUpdate){this._worldUpdate=this._positionUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldPositionRotationTransform()}},_b._onWorldPositionScaleTransform=function(){if(!this._worldUpdate||!this._positionUpdate||!this._scaleUpdate){this._worldUpdate=this._positionUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldPositionScaleTransform()}},_b._onWorldPositionTransform=function(){if(!this._worldUpdate||!this._positionUpdate){this._worldUpdate=this._positionUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldPositionTransform()}},_b._onWorldRotationTransform=function(){if(!this._worldUpdate||!this._rotationUpdate){this._worldUpdate=this._rotationUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldPositionRotationTransform()}},_b._onWorldScaleTransform=function(){if(!this._worldUpdate||!this._scaleUpdate){this._worldUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldPositionScaleTransform()}},_b._onWorldTransform=function(){if(!(this._worldUpdate&&this._positionUpdate&&this._rotationUpdate&&this._scaleUpdate)){this._worldUpdate=this._positionUpdate=this._rotationUpdate=this._scaleUpdate=!0,this.event("worldmatrixneedchanged");for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._onWorldTransform()}},_b.translate=function(_a,_b){void 0===_b&&(_b=!0),_b?(_ab.createFromQuaternion(this.localRotation,_h._tempMatrix0),_gb.transformCoordinate(_a,_h._tempMatrix0,_h._tempVector30),_gb.add(this.localPosition,_h._tempVector30,this._localPosition),this.localPosition=this._localPosition):(_gb.add(this.position,_a,this._position),this.position=this._position)},_b.rotate=function(_a,_b,_c){var _d;void 0===_b&&(_b=!0),void 0===_c&&(_c=!0),_d=_c?_a:(_gb.scale(_a,Math.PI/180,_h._tempVector30),_h._tempVector30),_cb.createFromYawPitchRoll(_d.y,_d.x,_d.z,_h._tempQuaternion0),_b?(_cb.multiply(this._localRotation,_h._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(_cb.multiply(_h._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},_b.lookAt=function(_a,_b,_c){void 0===_c&&(_c=!1);var _d,_e=_a.elements;if(_c){if(_d=this._localPosition.elements,Math.abs(_d[0]-_e[0])<_$a.zeroTolerance&&Math.abs(_d[1]-_e[1])<_$a.zeroTolerance&&Math.abs(_d[2]-_e[2])<_$a.zeroTolerance)return;_cb.lookAt(this._localPosition,_a,_b,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var _f=this.position;if(_d=_f.elements,Math.abs(_d[0]-_e[0])<_$a.zeroTolerance&&Math.abs(_d[1]-_e[1])<_$a.zeroTolerance&&Math.abs(_d[2]-_e[2])<_$a.zeroTolerance)return;_cb.lookAt(_f,_a,_b,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},_o(0,_b,"_isFrontFaceInvert",function(){var _a=this.scale,_b=_a.x<0;return _a.y<0&&(_b=!_b),_a.z<0&&(_b=!_b),_b}),_o(0,_b,"owner",function(){return this._owner}),_o(0,_b,"localRotation",function(){if(this._localQuaternionUpdate){var _a=this._localRotationEuler.elements;_cb.createFromYawPitchRoll(_a[1]/_h._angleToRandin,_a[0]/_h._angleToRandin,_a[2]/_h._angleToRandin,this._localRotation)}return this._localRotation},function(_a){this._localRotation=_a,this._localRotation.normalize(this._localRotation),this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),_o(0,_b,"worldMatrix",function(){return this._worldUpdate&&(null!=this._parent?_ab.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._worldUpdate=!1),this._worldMatrix},function(_a){null===this._parent?_a.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),_ab.multiply(this._localMatrix,_a,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix=_a,this._worldUpdate=!1}),_o(0,_b,"worldNeedUpdate",function(){return this._worldUpdate}),_o(0,_b,"localMatrix",function(){return this._localUpdate&&(this._updateLocalMatrix(),this._localUpdate=!1),this._localMatrix},function(_a){this._localMatrix=_a,this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._localUpdate=!1,this._onWorldTransform()}),_o(0,_b,"dummy",function(){return this._dummy},function(_a){this._dummy!==_a&&(this._dummy&&(this._dummy._entity=null),_a&&(_a._entity=this),this._dummy=_a)}),_o(0,_b,"localPosition",function(){return this._localPosition},function(_a){this._localPosition=_a,this._localUpdate=!0,this._onWorldPositionTransform()}),_o(0,_b,"position",function(){if(this._positionUpdate){if(null!=this._parent){var _a=this._parent.position;_gb.multiply(this._localPosition,this._parent.scale,_h._tempVector30),_gb.transformQuat(_h._tempVector30,this._parent.rotation,_h._tempVector30),_gb.add(_a,_h._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._positionUpdate=!1}return this._position},function(_a){if(null!=this._parent){_gb.subtract(_a,this._parent.position,this._localPosition);var _b=this._parent.scale.elements,_c=_b[0],_d=_b[1],_e=_b[2];if(1!==_c||1!==_d||1!==_e){var _f=_h._tempVector30,_g=_f.elements;_g[0]=1/_c,_g[1]=1/_d,_g[2]=1/_e,_gb.multiply(this._localPosition,_f,this._localPosition)}this._parent.rotation.invert(_h._tempQuaternion0),_gb.transformQuat(this._localPosition,_h._tempQuaternion0,this._localPosition)}else _a.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position=_a,this._positionUpdate=!1}),_o(0,_b,"localScale",function(){return this._localScale},function(_a){this._localScale=_a,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldScaleTransform():this._onWorldPositionScaleTransform()}),_o(0,_b,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(_h._tempVector30);var _a=_h._tempVector30.elements,_b=this._localRotationEuler.elements;_b[0]=_a[1]*_h._angleToRandin,_b[1]=_a[0]*_h._angleToRandin,_b[2]=_a[2]*_h._angleToRandin}return this._localRotationEuler},function(_a){this._localRotationEuler=_a,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,!this.pivot||0===this.pivot.x&&0===this.pivot.y&&0===this.pivot.z?this._onWorldRotationTransform():this._onWorldPositionRotationTransform()}),_o(0,_b,"rotation",function(){return this._rotationUpdate&&(null!=this._parent?_cb.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._rotationUpdate=!1),this._rotation},function(_a){null!=this._parent?(this._parent.rotation.invert(_h._tempQuaternion0),_cb.multiply(_a,_h._tempQuaternion0,this._localRotation)):_a.cloneTo(this._localRotation),this.localRotation=this._localRotation,this._rotation=_a,this._rotationUpdate=!1}),_o(0,_b,"scale",function(){return this._scaleUpdate&&(null!==this._parent?_gb.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._scaleUpdate=!1),this._scale},function(_a){if(null!==this._parent){var _b=this._parent.scale.elements,_c=_h._tempVector30.elements;_c[0]=1/_b[0],_c[1]=1/_b[1],_c[2]=1/_b[2],_gb.multiply(_a,_h._tempVector30,this._localScale)}else _a.cloneTo(this._localScale);this.localScale=this._localScale,this._scale=_a,this._scaleUpdate=!1}),_o(0,_b,"rotationEuler",null,function(_a){_cb.createFromYawPitchRoll(_a.y,_a.x,_a.z,this._rotation),this.rotation=this._rotation}),_o(0,_b,"forward",function(){var _a=this.worldMatrix.elements;return this._forward.elements[0]=-_a[8],this._forward.elements[1]=-_a[9],this._forward.elements[2]=-_a[10],this._forward}),_o(0,_b,"up",function(){var _a=this.worldMatrix.elements;return this._up.elements[0]=_a[4],this._up.elements[1]=_a[5],this._up.elements[2]=_a[6],this._up}),_o(0,_b,"right",function(){var _a=this.worldMatrix.elements;return this._right.elements[0]=_a[0],this._right.elements[1]=_a[1],this._right.elements[2]=_a[2],this._right}),_o(0,_b,"parent",function(){return this._parent},function(_a){if(this._parent!==_a){if(this._parent){var _b=this._parent._childs,_c=_b.indexOf(this);_b.splice(_c,1)}_a&&(_a._childs.push(this),_a&&this._onWorldTransform()),this._parent=_a}}),_l(_h,["_tempVector30",function(){return this._tempVector30=new _gb},"_tempVector31",function(){return this._tempVector31=new _gb},"_tempVector32",function(){return this._tempVector32=new _gb},"_tempVector33",function(){return this._tempVector33=new _gb},"_tempQuaternion0",function(){return this._tempQuaternion0=new _cb},"_tempMatrix0",function(){return this._tempMatrix0=new _ab},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),_h}(),_xb=(function(_a){function _b(){this._rotation=0,this._matNeedUpdte=!1,_b.__super.call(this),this._matrix=new _ab,this._offset=new _fb,this._tiling=new _fb(1,1)}_n(_b,"laya.d3.core.TransformUV",_f);var _c=_b.prototype;_v.imps(_c,{"laya.d3.core.IClone":!0}),_c._updateMatrix=function(){_b._tempOffsetV3.elements[0]=this._offset.x,_b._tempOffsetV3.elements[1]=this._offset.y,_cb.createFromYawPitchRoll(0,0,this._rotation,_b._tempRotationQua),_b._tempTitlingV3.elements[0]=this._tiling.x,_b._tempTitlingV3.elements[1]=this._tiling.y,_ab.createAffineTransformation(_b._tempOffsetV3,_b._tempRotationQua,_b._tempTitlingV3,this._matrix)},_c.cloneTo=function(_a){_a._matrix=this._matrix.clone(),_a._offset=this._offset.clone(),_a._rotation=this._rotation,_a._tiling=this._tiling.clone()},_c.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_c,"matrix",function(){return this._matNeedUpdte&&(this._updateMatrix(),this._matNeedUpdte=!1),this._matrix}),_o(0,_c,"tiling",function(){return this._tiling},function(_a){this._tiling=_a,this._matNeedUpdte=!0}),_o(0,_c,"offset",function(){return this._offset},function(_a){this._offset=_a,this._matNeedUpdte=!0}),_o(0,_c,"rotation",function(){return this._rotation},function(_a){this._rotation=_a,this._matNeedUpdte=!0}),_l(_b,["_tempOffsetV3",function(){return this._tempOffsetV3=new _gb(0,0,0)},"_tempRotationQua",function(){return this._tempRotationQua=new _cb},"_tempTitlingV3",function(){return this._tempTitlingV3=new _gb(1,1,1)}])}(),function(_c){function _a(){this.x=NaN,this.y=NaN,this.z=NaN,_a.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}_n(_a,"laya.d3.core.particleShuriKen.module.shape.BoxShape",_c);var _b=_a.prototype;_b._getShapeBoundBox=function(_a){var _b=_a.min.elements;_b[0]=.5*-this.x,_b[1]=.5*-this.y,_b[2]=.5*-this.z;var _c=_a.max.elements;_c[0]=.5*this.x,_c[1]=.5*this.y,_c[2]=.5*this.z},_b._getSpeedBoundBox=function(_a){var _b=_a.min.elements;_b[0]=0,_b[1]=0,_b[2]=0;var _c=_a.max.elements;_c[0]=0,_c[1]=1,_c[2]=0},_b.generatePositionAndDirection=function(_a,_b,_c,_d){var _e=_a.elements,_f=_b.elements;_c?(_c.seed=_d[16],_R._randomPointInsideHalfUnitBox(_a,_c),_d[16]=_c.seed):_R._randomPointInsideHalfUnitBox(_a),_e[0]=this.x*_e[0],_e[1]=this.y*_e[1],_e[2]=this.z*_e[2],this.randomDirection?_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b):(_f[0]=0,_f[1]=0,_f[2]=1)},_b.cloneTo=function(_a){_c.prototype.cloneTo.call(this,_a);var _b=_a;_b.x=this.x,_b.y=this.y,_b.z=this.z,_b.randomDirection=this.randomDirection}}(_M),function(_c){function _g(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,_g.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}_n(_g,"laya.d3.core.particleShuriKen.module.shape.CircleShape",_c);var _a=_g.prototype;_a._getShapeBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[2]=-this.radius,_b[1]=0;var _c=_a.max.elements;_c[0]=_c[2]=this.radius,_c[1]=0},_a._getSpeedBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[1]=-1,_b[2]=0;var _c=_a.max.elements;_c[0]=_c[1]=1,_c[2]=0},_a.generatePositionAndDirection=function(_a,_b,_c,_d){var _e=_a.elements,_f=_g._tempPositionPoint.elements;_c?(_c.seed=_d[16],this.emitFromEdge?_R._randomPointUnitArcCircle(this.arc,_g._tempPositionPoint,_c):_R._randomPointInsideUnitArcCircle(this.arc,_g._tempPositionPoint,_c),_d[16]=_c.seed):this.emitFromEdge?_R._randomPointUnitArcCircle(this.arc,_g._tempPositionPoint):_R._randomPointInsideUnitArcCircle(this.arc,_g._tempPositionPoint),_e[0]=-_f[0],_e[1]=_f[1],_e[2]=0,_gb.scale(_a,this.radius,_a),this.randomDirection?_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b):_a.cloneTo(_b)},_a.cloneTo=function(_a){_c.prototype.cloneTo.call(this,_a);var _b=_a;_b.radius=this.radius,_b.arc=this.arc,_b.emitFromEdge=this.emitFromEdge,_b.randomDirection=this.randomDirection},_l(_g,["_tempPositionPoint",function(){return this._tempPositionPoint=new _fb}])}(_M),function(_c){function _m(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,_m.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}_n(_m,"laya.d3.core.particleShuriKen.module.shape.ConeShape",_c);var _a=_m.prototype;_a._getShapeBoundBox=function(_a){var _b=this.radius+this.length*Math.sin(this.angle),_c=this.length*Math.cos(this.angle),_d=_a.min.elements;_d[0]=_d[1]=-_b,_d[2]=0;var _e=_a.max.elements;_e[0]=_e[1]=_b,_e[2]=_c},_a._getSpeedBoundBox=function(_a){var _b=Math.sin(this.angle),_c=_a.min.elements;_c[0]=_c[1]=-_b,_c[2]=0;var _d=_a.max.elements;_d[0]=_c[1]=_b,_d[2]=1},_a.generatePositionAndDirection=function(_a,_b,_c,_d){var _e,_f=_a.elements,_g=_b.elements,_h=_m._tempPositionPoint.elements,_i=NaN,_j=NaN,_k=Math.cos(this.angle),_l=Math.sin(this.angle);switch(this.emitType){case 0:_c?(_c.seed=_d[16],_R._randomPointInsideUnitCircle(_m._tempPositionPoint,_c),_d[16]=_c.seed):_R._randomPointInsideUnitCircle(_m._tempPositionPoint),_i=_h[0],_j=_h[1],_f[0]=_i*this.radius,_f[1]=_j*this.radius,_f[2]=0,this.randomDirection?(_c?(_c.seed=_d[17],_R._randomPointInsideUnitCircle(_m._tempDirectionPoint,_c),_d[17]=_c.seed):_R._randomPointInsideUnitCircle(_m._tempDirectionPoint),_e=_m._tempDirectionPoint.elements,_g[0]=_e[0]*_l,_g[1]=_e[1]*_l):(_g[0]=_i*_l,_g[1]=_j*_l),_g[2]=_k;break;case 1:_c?(_c.seed=_d[16],_R._randomPointUnitCircle(_m._tempPositionPoint,_c),_d[16]=_c.seed):_R._randomPointUnitCircle(_m._tempPositionPoint),_i=_h[0],_j=_h[1],_f[0]=_i*this.radius,_f[1]=_j*this.radius,_f[2]=0,this.randomDirection?(_c?(_c.seed=_d[17],_R._randomPointInsideUnitCircle(_m._tempDirectionPoint,_c),_d[17]=_c.seed):_R._randomPointInsideUnitCircle(_m._tempDirectionPoint),_e=_m._tempDirectionPoint.elements,_g[0]=_e[0]*_l,_g[1]=_e[1]*_l):(_g[0]=_i*_l,_g[1]=_j*_l),_g[2]=_k;break;case 2:_c?(_c.seed=_d[16],_R._randomPointInsideUnitCircle(_m._tempPositionPoint,_c)):_R._randomPointInsideUnitCircle(_m._tempPositionPoint),_i=_h[0],_j=_h[1],_f[0]=_i*this.radius,_f[1]=_j*this.radius,_g[_f[2]=0]=_i*_l,_g[1]=_j*_l,_g[2]=_k,_gb.normalize(_b,_b),_c?(_gb.scale(_b,this.length*_c.getFloat(),_b),_d[16]=_c.seed):_gb.scale(_b,this.length*Math.random(),_b),_gb.add(_a,_b,_a),this.randomDirection&&(_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b));break;case 3:_c?(_c.seed=_d[16],_R._randomPointUnitCircle(_m._tempPositionPoint,_c)):_R._randomPointUnitCircle(_m._tempPositionPoint),_i=_h[0],_j=_h[1],_f[0]=_i*this.radius,_f[1]=_j*this.radius,_g[_f[2]=0]=_i*_l,_g[1]=_j*_l,_g[2]=_k,_gb.normalize(_b,_b),_c?(_gb.scale(_b,this.length*_c.getFloat(),_b),_d[16]=_c.seed):_gb.scale(_b,this.length*Math.random(),_b),_gb.add(_a,_b,_a),this.randomDirection&&(_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b));break;default:throw new Error("ConeShape:emitType is invalid.")}},_a.cloneTo=function(_a){_c.prototype.cloneTo.call(this,_a);var _b=_a;_b.angle=this.angle,_b.radius=this.radius,_b.length=this.length,_b.emitType=this.emitType,_b.randomDirection=this.randomDirection},_l(_m,["_tempPositionPoint",function(){return this._tempPositionPoint=new _fb},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new _fb}])}(_M),function(_c){function _a(){this.radius=NaN,this.emitFromShell=!1,_a.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}_n(_a,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",_c);var _b=_a.prototype;_b._getShapeBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[1]=_b[2]=-this.radius;var _c=_a.max.elements;_c[0]=_c[1]=this.radius,_c[2]=0},_b._getSpeedBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[1]=-1,_b[2]=0;var _c=_a.max.elements;_c[0]=_c[1]=_c[2]=1},_b.generatePositionAndDirection=function(_a,_b,_c,_d){var _e=_a.elements;_c?(_c.seed=_d[16],this.emitFromShell?_R._randomPointUnitSphere(_a,_c):_R._randomPointInsideUnitSphere(_a,_c),_d[16]=_c.seed):this.emitFromShell?_R._randomPointUnitSphere(_a):_R._randomPointInsideUnitSphere(_a),_gb.scale(_a,this.radius,_a);var _f=_e[2];_f<0&&(_e[2]=-1*_f),this.randomDirection?_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b):_a.cloneTo(_b)},_b.cloneTo=function(_a){_c.prototype.cloneTo.call(this,_a);var _b=_a;_b.radius=this.radius,_b.emitFromShell=this.emitFromShell,_b.randomDirection=this.randomDirection}}(_M),function(_c){function _a(){this.radius=NaN,this.emitFromShell=!1,_a.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}_n(_a,"laya.d3.core.particleShuriKen.module.shape.SphereShape",_c);var _b=_a.prototype;_b._getShapeBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[1]=_b[2]=-this.radius;var _c=_a.max.elements;_c[0]=_c[1]=_c[2]=this.radius},_b._getSpeedBoundBox=function(_a){var _b=_a.min.elements;_b[0]=_b[1]=_b[2]=-1;var _c=_a.max.elements;_c[0]=_c[1]=_c[2]=1},_b.generatePositionAndDirection=function(_a,_b,_c,_d){_c?(_c.seed=_d[16],this.emitFromShell?_R._randomPointUnitSphere(_a,_c):_R._randomPointInsideUnitSphere(_a,_c),_d[16]=_c.seed):this.emitFromShell?_R._randomPointUnitSphere(_a):_R._randomPointInsideUnitSphere(_a),_gb.scale(_a,this.radius,_a),this.randomDirection?_c?(_c.seed=_d[17],_R._randomPointUnitSphere(_b,_c),_d[17]=_c.seed):_R._randomPointUnitSphere(_b):_a.cloneTo(_b)},_b.cloneTo=function(_a){_c.prototype.cloneTo.call(this,_a);var _b=_a;_b.radius=this.radius,_b.emitFromShell=this.emitFromShell,_b.randomDirection=this.randomDirection}}(_M),function(_a){function _b(){this._batchIndexStart=0,this._batchIndexEnd=0,this._skinAnimationDatas=null,_b.__super.call(this)}return _n(_b,"laya.d3.core.render.SubMeshRenderElement",_U),_b}()),_yb=function(_a){function _q(_a,_b,_c,_d,_e,_f){this._name=NaN,this._attributeMap=null,this._renderElementUniformMap=null,this._materialUniformMap=null,this._spriteUniformMap=null,this._cameraUniformMap=null,this._sceneUniformMap=null,this.sharders=null,this._spriteDefineCounter=3,this._spriteInt2name=[],this._spriteName2Int={},this._materialDefineCounter=1,this._materialInt2name=[],this._materialName2Int={},this._conchShader=null,this._name=_a,this._renderElementUniformMap={},this._materialUniformMap={},this._spriteUniformMap={},this._cameraUniformMap={},this._sceneUniformMap={},this.sharders=[],this._spriteInt2name[_nb.SHADERDEFINE_RECEIVE_SHADOW]="RECEIVESHADOW",this._spriteInt2name[_Tb.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV]="SCALEOFFSETLIGHTINGMAPUV",this._spriteInt2name[_Tb.SAHDERDEFINE_LIGHTMAP]="LIGHTMAP",this._spriteInt2name[0]="BONE",this._materialInt2name[_Cb.SHADERDEFINE_ALPHATEST]="ALPHATEST";_q.__super.call(this,_a,_b,_c,null,{}),this._attributeMap=_d;var _g;for(_g in _e){var _h=_e[_g];switch(_h[1]){case 0:this._renderElementUniformMap[_g]=_h[0];break;case 1:this._materialUniformMap[_g]=_h[0];break;case 2:this._spriteUniformMap[_g]=_h[0];break;case 3:this._cameraUniformMap[_g]=_h[0];break;case 4:this._sceneUniformMap[_g]=_h[0];break;default:throw new Error("ShaderCompile3D: period is unkonw.")}}}_n(_q,"laya.d3.shader.ShaderCompile3D",_t);var _b=_q.prototype;return _b._definesToNameDic=function(_a,_b){for(var _c={},_d=1,_e=0;_e<32&&!(_a<(_d=1<<_e));_e++)if(_a&_d){var _f=_b[_d];_f&&(_c[_f]="")}return _c},_b.withCompile=function(_a,_b,_c,_d){var _e,_f,_g;if(_f=this.sharders[_a])if(_g=_f[_b]){if(_e=_g[_c])return _e}else _g=_f[_b]=[];else _g=(_f=this.sharders[_a]=[])[_b]=[];var _h,_i=this._definesToNameDic(_a,_q._globalInt2name),_j=this._definesToNameDic(_b,this._spriteInt2name),_k=this._definesToNameDic(_c,this._materialInt2name),_l={},_m="";if(_i)for(_h in _i)_m+="#define "+_h+"\n",_l[_h]=!0;if(_j)for(_h in _j)_m+="#define "+_h+"\n",_l[_h]=!0;if(_k)for(_h in _k)_m+="#define "+_h+"\n",_l[_h]=!0;var _n=_Jb.nameKey.getName(this._name)+" compile ("+_a+","+_b+","+_c+")",_o=this._VS.toscript(_l,[]),_p=this._PS.toscript(_l,[]);_F.now();if(_e=_Jb.create(_m+_o.join("\n"),_m+_p.join("\n"),this._attributeMap,this._sceneUniformMap,this._cameraUniformMap,this._spriteUniformMap,this._materialUniformMap,this._renderElementUniformMap,_d,_n),_g[_c]=_e,laya.d3.shader.ShaderCompile3D.debugMode)_F.now();return _e},_b.precompileShaderWithShaderDefine=function(_a,_b,_c){this.withCompile(_a,_b,_c,!0)},_b.addMaterialDefines=function(_a){var _b=_a.defines;for(var _c in _b){var _d=_b[_c],_e=parseInt(_c);this._materialInt2name[_e]=_d,this._materialName2Int[_d]=_e}},_b.addSpriteDefines=function(_a){var _b=_a.defines;for(var _c in _b){var _d=_b[_c],_e=parseInt(_c);this._spriteInt2name[_e]=_d,this._spriteName2Int[_d]=_e}},_b.getMaterialDefineByName=function(_a){return this._materialName2Int[_a]},_b.registerMaterialDefine=function(_a){var _b=Math.pow(2,this._materialDefineCounter++);return this._materialInt2name[_b]=_a,this._materialName2Int[_a]=_b},_b.registerSpriteDefine=function(_a){var _b=Math.pow(2,this._spriteDefineCounter++);return this._spriteInt2name[_b]=_a,this._spriteName2Int[_a]=_b},_q._globalRegDefine=function(_a,_b){_q._globalInt2name[_b]=_a},_q.add=function(_a,_b,_c,_d,_e){return laya.d3.shader.ShaderCompile3D._preCompileShader[_a]=new _q(_a,_b,_c,_d,_e,_t.includes)},_q.get=function(_a){return laya.d3.shader.ShaderCompile3D._preCompileShader[_Jb.nameKey.getID(_a)]},_q._preCompileShader={},_q._globalInt2name=[],_q.debugMode=!1,_q.SHADERDEFINE_HIGHPRECISION=1,_q.SHADERDEFINE_FOG=4,_q.SHADERDEFINE_DIRECTIONLIGHT=8,_q.SHADERDEFINE_POINTLIGHT=16,_q.SHADERDEFINE_SPOTLIGHT=32,_q.SHADERDEFINE_UV0=64,_q.SHADERDEFINE_COLOR=128,_q.SHADERDEFINE_UV1=256,_q.SAHDERDEFINE_DEPTHFOG=131072,_q}(),_zb=function(_a){function _o(){_o.__super.call(this)}_n(_o,"laya.d3.graphics.MeshSprite3DStaticBatchManager",_da);var _b=_o.prototype;return _b._getStaticBatch=function(_a,_b,_c,_d){var _e,_f;return _f=_a?_a.id.toString()+_c.id.toString()+_b.id.toString()+_d.toString():_c.id.toString()+_b.id.toString()+_d.toString(),this._staticBatches[_f]?_e=this._staticBatches[_f]:this._staticBatches[_f]=_e=new _Ab(_f,this,_a,_b,_c),_e},_b._initStaticBatchs=function(_a){var _b,_c;this._initBatchRenderElements.sort(_o._sortPrepareStaticBatch);for(var _d,_e=!1,_f=0,_g=0,_h=this._initBatchRenderElements.length;_g<_h;_g++){var _i,_j=this._initBatchRenderElements[_g],_k=_j.renderObj._getVertexBuffer(0);_j._sprite3D;if(_c===_k.vertexDeclaration&&_b===_j._material)if(_e)_d._addCombineBatchRenderObjTest(_j)?(_i=_j._staticBatch)!==_d&&(_i&&_i._deleteCombineBatchRenderObj(_j),_d._addCombineBatchRenderObj(_j)):(_e=!1,_f++);else{var _l=this._initBatchRenderElements[_g-1],_m=_l.renderObj,_n=_j.renderObj;_e=!(65535<_m._getVertexBuffer().vertexCount+_n._getVertexBuffer().vertexCount)&&(_d=this._getStaticBatch(_a,_c,_b,_f),(_i=_l._staticBatch)!==_d&&(_i&&_i._deleteCombineBatchRenderObj(_l),_d._addCombineBatchRenderObj(_l)),(_i=_j._staticBatch)!==_d&&(_i&&_i._deleteCombineBatchRenderObj(_j),_d._addCombineBatchRenderObj(_j)),!0)}else _e=!1,_f=0;_b=_j._material,_c=_k.vertexDeclaration}},_o._sortPrepareStaticBatch=function(_a,_b){var _c=_a._render,_d=_b._render,_e=_c.lightmapIndex-_d.lightmapIndex;if(0!=_e)return _e;var _f=_c.receiveShadow-_d.receiveShadow;if(0!=_f)return _f;var _g=_a._mainSortID-_b._mainSortID;return 0==_g?_a.renderObj.triangleCount-_b.renderObj.triangleCount:_g},_o}(),_Ab=function(_a){function _f(_a,_b,_c,_d,_e){this._batchOwnerIndices=null,this._batchOwners=null,this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=null,this._vertexBuffer=null,this._indexBuffer=null,_f.__super.call(this,_a,_b,_c),this._batchOwnerIndices=[],this._batchOwners=[],this._needFinishCombine=!1,this._currentCombineVertexCount=0,this._currentCombineIndexCount=0,this._vertexDeclaration=_d,this._material=_e}_n(_f,"laya.d3.graphics.SubMeshStaticBatch",_ea);var _b=_f.prototype;return _b._compareBatchRenderElement=function(_a,_b){return _a._batchIndexStart>_b._batchIndexStart},_b._addCombineBatchRenderObjTest=function(_a){var _b=_a.renderObj._vertexCount;return!(65535<(0<_b?this._currentCombineVertexCount+_b:this._currentCombineVertexCount+_a.renderObj._getVertexBuffer().vertexCount))},_b._addCombineBatchRenderObj=function(_a){var _b=_a.renderObj,_c=_b._vertexCount;this._initBatchRenderElements.push(_a),_a._staticBatch=this,0<_c?(this._currentCombineIndexCount+=_b._indexCount,this._currentCombineVertexCount+=_c):(this._currentCombineIndexCount=this._currentCombineIndexCount+_b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount+_b._getVertexBuffer().vertexCount),this._needFinishCombine=!0},_b._deleteCombineBatchRenderObj=function(_a){var _b=_a.renderObj,_c=this._initBatchRenderElements.indexOf(_a);if(-1!==_c){this._initBatchRenderElements.splice(_c,1),_a._staticBatch=null;var _d=_b._vertexCount;0<_d?(this._currentCombineIndexCount=this._currentCombineIndexCount-_b._indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-_d):(this._currentCombineIndexCount=this._currentCombineIndexCount-_b._getIndexBuffer().indexCount,this._currentCombineVertexCount=this._currentCombineVertexCount-_b._getVertexBuffer().vertexCount),this._needFinishCombine=!0}},_b._finishInit=function(){if(this._needFinishCombine){var _a=0,_b=0;0<=this._initBatchRenderElements[0]._sprite3D._render.lightmapIndex?this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration):this._material instanceof laya.d3.core.material.StandardMaterial&&this._material.ambientTexture&&(this._vertexDeclaration=this._getVertexDecLightMap(this._vertexDeclaration));var _c=new Float32Array(this._vertexDeclaration.vertexStride/4*this._currentCombineVertexCount),_d=new Uint16Array(this._currentCombineIndexCount);this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy()),this._vertexBuffer=_Mb.create(this._vertexDeclaration,this._currentCombineVertexCount,35044),this._indexBuffer=_Lb.create("ushort",this._currentCombineIndexCount,35044);for(var _e=0,_f=this._initBatchRenderElements.length;_e<_f;_e++){var _g=this._initBatchRenderElements[_e],_h=_g.renderObj,_i=_h._getStaticBatchBakedVertexs(this._rootOwner?this._rootOwner._transform:null,_g._sprite3D),_j=_h.getIndices(),_k=_g._sprite3D.transform._isFrontFaceInvert,_l=_a/(this._vertexDeclaration.vertexStride/4)-_h._vertexStart,_m=_b,_n=_m+_j.length;_g._batchIndexStart=_m,_g._batchIndexEnd=_n,_d.set(_j,_b);var _o=0;if(_k)for(_o=_m;_o<_n;_o+=3){_d[_o]=_l+_d[_o];var _p=_d[_o+1],_q=_d[_o+2];_d[_o+1]=_l+_q,_d[_o+2]=_l+_p}else for(_o=_m;_o<_n;_o+=3)_d[_o]=_l+_d[_o],_d[_o+1]=_l+_d[_o+1],_d[_o+2]=_l+_d[_o+2];_b+=_j.length,_c.set(_i,_a),_a+=_i.length}this._vertexBuffer.setData(_c),this._indexBuffer.setData(_d),this._needFinishCombine=!1}},_b._getCombineRenderElementFromPool=function(){return this._combineRenderElementPool[this._combineRenderElementPoolIndex++]||(this._combineRenderElementPool[this._combineRenderElementPoolIndex-1]=new _xb)},_b._getRenderElement=function(_a,_b,_c){for(var _d,_e,_f=this._batchRenderElements.length,_g=!0,_h=0;_h<_f;_h++){var _i,_j,_k=(_e=this._batchRenderElements[_h])._sprite3D._render;if(0!==_h&&(_g=(_i=(_d=this._batchRenderElements[_h-1])._sprite3D._render).lightmapIndex!==_k.lightmapIndex||_i.receiveShadow!==_k.receiveShadow||_d._batchIndexEnd!==_e._batchIndexStart),_g){(_j=this._getCombineRenderElementFromPool()).renderObj=this,_j._material=this._material,_j._batchIndexStart=_e._batchIndexStart,_j._batchIndexEnd=_e._batchIndexEnd;var _l=_k.lightmapIndex,_m=_l+1,_n=this._batchOwnerIndices[_m];_n||(_n=this._batchOwnerIndices[_m]=[]);var _o,_p=_n[_e._render.receiveShadow?1:0];void 0===_p?(_n[_k.receiveShadow?1:0]=this._batchOwners.length,(_o=new _Vb(null,"StaticBatchMeshSprite3D"))._scene=_b,_o._transform=this._rootOwner?this._rootOwner._transform:null,_o._render.lightmapIndex=_l,_o._render.receiveShadow=_e._render.receiveShadow,this._batchOwners.push(_o)):_o=this._batchOwners[_p],_o._render._renderUpdate(_c),_j._sprite3D=_o,_a.push(_j)}else _j._batchIndexEnd=_e._batchIndexEnd}},_b._beforeRender=function(_a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},_b._render=function(_a){var _b=_a.renderElement,_c=_b._batchIndexStart,_d=_b._batchIndexEnd-_c;_D.mainContext.drawElements(4,_d,5123,2*_c),_y.drawCall++,_y.trianglesFaces+=_d/3},_b.dispose=function(){this._batchOwnerIndices=null,this._batchOwners=null,this._vertexDeclaration=null,this._vertexBuffer.destroy(),this._indexBuffer.destroy()},_b._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),this._vertexBuffer},_f}(),_Bb=function(_a){function _b(){this._componentsMap=null,this._typeComponentsIndices=null,this._components=null,this._scripts=null,_b.__super.call(this),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[],this._scripts=[]}_n(_b,"laya.d3.core.ComponentNode",_j);var _c=_b.prototype;return _c.addComponent=function(_a){var _b,_c=this._componentsMap.indexOf(_a);if(-1===_c)_b=[],this._componentsMap.push(_a),this._typeComponentsIndices.push(_b);else if(_b=this._typeComponentsIndices[_c],this._components[_b[0]].isSingleton)throw new Error("无法单实例创建"+_a+"组件，"+_a+"组件已存在！");var _d=_e.getInstance(_a);return _b.push(this._components.length),this._components.push(_d),_d instanceof laya.d3.component.Script&&this._scripts.push(_d),_d._initialize(this),_d},_c._removeComponent=function(_a,_b){var _c=this._typeComponentsIndices[_a],_d=_c[_b],_e=this._components[_d];this._components.splice(_d,1),_e instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(_e),1),_c.splice(_b,1),0===_c.length&&(this._typeComponentsIndices.splice(_a,1),this._componentsMap.splice(_a,1));for(var _f=0,_g=this._componentsMap.length;_f<_g;_f++)for(var _h=(_c=this._typeComponentsIndices[_f]).length-1;0<=_h;_h--){var _i=_c[_h];if(!(_d<_i))break;_c[_h]=--_i}_e._destroy()},_c.getComponentByType=function(_a,_b){void 0===_b&&(_b=0);var _c=this._componentsMap.indexOf(_a);return-1===_c?null:this._components[this._typeComponentsIndices[_c][_b]]},_c.getComponentsByType=function(_a,_b){var _c=this._componentsMap.indexOf(_a);if(-1!==_c){var _d=this._typeComponentsIndices[_c],_e=_d.length;_b.length=_e;for(var _f=0;_f<_e;_f++)_b[_f]=this._components[_d[_f]]}else _b.length=0},_c.getComponentByIndex=function(_a){return this._components[_a]},_c.removeComponentByType=function(_a,_b){void 0===_b&&(_b=0);var _c=this._componentsMap.indexOf(_a);-1!==_c&&this._removeComponent(_c,_b)},_c.removeComponentsByType=function(_a){var _b=this._componentsMap.indexOf(_a);if(-1!==_b)for(var _c=this._typeComponentsIndices[_b],_d=0,_e=_c.length;_d<_e;_c.length<_e?_e--:_d++)this._removeComponent(_b,_d)},_c.removeAllComponent=function(){for(var _a=0,_b=this._componentsMap.length;_a<_b;this._componentsMap.length<_b?_b--:_a++)this.removeComponentsByType(this._componentsMap[_a])},_c._updateComponents=function(_a){for(var _b=0,_c=this._components.length;_b<_c;_b++){var _d=this._components[_b];!_d.started&&(_d._start(_a),_d.started=!0),_d.enable&&_d._update(_a)}},_c._lateUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._lateUpdate(_a)}},_c._preRenderUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._preRenderUpdate(_a)}},_c._postRenderUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._postRenderUpdate(_a)}},_b}(),_Cb=function(_d){function _a(){_a.__super.call(this),this._shaderDefineValue=0,this._disablePublicShaderDefine=0,this._shaderValues=new _mb,this._values=[],this.renderQueue=2e3,this._alphaTest=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new _hb(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=513,this.depthWrite=!0}_n(_a,"laya.d3.core.material.BaseMaterial",_d);var _b=_a.prototype;return _v.imps(_b,{"laya.d3.core.IClone":!0}),_b._addShaderDefine=function(_a){this._shaderDefineValue|=_a},_b._removeShaderDefine=function(_a){this._shaderDefineValue&=~_a},_b._addDisablePublicShaderDefine=function(_a){this._disablePublicShaderDefine|=_a},_b._removeDisablePublicShaderDefine=function(_a){this._disablePublicShaderDefine&=~_a},_b._setBuffer=function(_a,_b){this._shaderValues.setValue(_a,_b),this._values[_a]=_b},_b._getBuffer=function(_a){return this._values[_a]},_b._setMatrix4x4=function(_a,_b){this._shaderValues.setValue(_a,_b?_b.elements:null),this._values[_a]=_b},_b._getMatrix4x4=function(_a){return this._values[_a]},_b._setInt=function(_a,_b){this._shaderValues.setValue(_a,_b),this._values[_a]=_b},_b._getInt=function(_a){return this._values[_a]},_b._setNumber=function(_a,_b){this._shaderValues.setValue(_a,_b),this._values[_a]=_b},_b._getNumber=function(_a){return this._values[_a]},_b._setBool=function(_a,_b){this._shaderValues.setValue(_a,_b),this._values[_a]=_b},_b._getBool=function(_a){return this._values[_a]},_b._setVector2=function(_a,_b){this._shaderValues.setValue(_a,_b?_b.elements:null),this._values[_a]=_b},_b._getVector2=function(_a){return this._values[_a]},_b._setColor=function(_a,_b){this._shaderValues.setValue(_a,_b?_b.elements:null),this._values[_a]=_b},_b._getColor=function(_a){return this._values[_a]},_b._setTexture=function(_a,_b){var _c=this._values[_a];this._values[_a]=_b,this._shaderValues.setValue(_a,_b),0<this.referenceCount&&(_c&&_c._removeReference(),_b&&_b._addReference())},_b._getTexture=function(_a){return this._values[_a]},_b._upload=function(){this._shader.uploadMaterialUniforms(this._shaderValues.data)},_b._getShader=function(_a,_b,_c){var _d=(_a|_b)&~this._disablePublicShaderDefine;return this._shader=this._shaderCompile.withCompile(_d,_c,this._shaderDefineValue),this._shader},_b._setRenderStateBlendDepth=function(){var _a=_D.mainContext;switch(_E.setDepthMask(_a,this.depthWrite),0===this.depthTest?_E.setDepthTest(_a,!1):(_E.setDepthTest(_a,!0),_E.setDepthFunc(_a,this.depthTest)),this.blend){case 0:_E.setBlend(_a,!1);break;case 1:_E.setBlend(_a,!0),_E.setBlendFunc(_a,this.srcBlend,this.dstBlend);break;case 2:_E.setBlend(_a,!0)}},_b._setRenderStateFrontFace=function(_a,_b){var _c=_D.mainContext,_d=0;switch(this.cull){case 0:_E.setCullFace(_c,!1);break;case 1:_E.setCullFace(_c,!0),_d=_a?_b&&_b._isFrontFaceInvert?2305:2304:_b&&_b._isFrontFaceInvert?2304:2305,_E.setFrontFace(_c,_d);break;case 2:_E.setCullFace(_c,!0),_d=_a?_b&&_b._isFrontFaceInvert?2304:2305:_b&&_b._isFrontFaceInvert?2305:2304,_E.setFrontFace(_c,_d)}},_b.onAsynLoaded=function(_a,_b,_c){var _d=_b[0],_e=_b[1];switch(_d.version){case"LAYAMATERIAL:01":var _f=0,_g=0,_h=_d.props;for(var _i in _h)switch(_i){case"vectors":var _j=_h[_i];for(_f=0,_g=_j.length;_f<_g;_f++){var _k=_j[_f],_l=_k.value;switch(_l.length){case 2:this[_k.name]=new _fb(_l[0],_l[1]);break;case 3:this[_k.name]=new _gb(_l[0],_l[1],_l[2]);break;case 4:this[_k.name]=new _hb(_l[0],_l[1],_l[2],_l[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var _m=_h[_i];for(_f=0,_g=_m.length;_f<_g;_f++){var _n=_m[_f],_o=_n.path;_o&&(this[_n.name]=_r.getRes(_e[_o]))}break;case"defines":var _p=_h[_i];for(_f=0,_g=_p.length;_f<_g;_f++){var _q=this._shaderCompile.getMaterialDefineByName(_p[_f]);this._addShaderDefine(_q)}break;case"cull":case"blend":case"srcBlend":case"dstBlend":case"depthWrite":this[_i]=_h[_i];break;case"renderQueue":switch(_h[_i]){case 1:this.renderQueue=2e3;break;case 2:this.renderQueue=3e3}break;default:this[_i]=_h[_i]}break;case"LAYAMATERIAL:02":for(_i in _h=_d.props)switch(_i){case"vectors":for(_f=0,_g=(_j=_h[_i]).length;_f<_g;_f++)switch((_l=(_k=_j[_f]).value).length){case 2:this[_k.name]=new _fb(_l[0],_l[1]);break;case 3:this[_k.name]=new _gb(_l[0],_l[1],_l[2]);break;case 4:this[_k.name]=new _hb(_l[0],_l[1],_l[2],_l[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}break;case"textures":for(_f=0,_g=(_m=_h[_i]).length;_f<_g;_f++)(_o=(_n=_m[_f]).path)&&(this[_n.name]=_r.getRes(_e[_o]));break;case"defines":for(_f=0,_g=(_p=_h[_i]).length;_f<_g;_f++)_q=this._shaderCompile.getMaterialDefineByName(_p[_f]),this._addShaderDefine(_q);break;default:this[_i]=_h[_i]}break;default:throw new Error("BaseMaterial:unkonwn version.")}this._endLoaded()},_b._addReference=function(){_d.prototype._addReference.call(this);for(var _a=0,_b=this._values.length;_a<_b;_a++){var _c=this._values[_a];_c&&_c instanceof laya.d3.resource.BaseTexture&&_c._addReference()}},_b._removeReference=function(){_d.prototype._removeReference.call(this);for(var _a=0,_b=this._values.length;_a<_b;_a++){var _c=this._values[_a];_c&&_c instanceof laya.d3.resource.BaseTexture&&_c._removeReference()}},_b.disposeResource=function(){this.blendConstColor=null,this._shader=null,this._shaderValues=null,this._values=null},_b.setShaderName=function(_a){var _b=_Jb.nameKey.getID(_a);if(-1===_b)throw new Error("BaseMaterial: unknown shader name.");this._shaderCompile=_yb._preCompileShader[_b]},_b.cloneTo=function(_a){var _b=_a;_b.name=this.name,_b.cull=this.cull,_b.blend=this.blend,_b.srcBlend=this.srcBlend,_b.dstBlend=this.dstBlend,_b.srcBlendRGB=this.srcBlendRGB,_b.dstBlendRGB=this.dstBlendRGB,_b.srcBlendAlpha=this.srcBlendAlpha,_b.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(_b.blendConstColor),_b.blendEquation=this.blendEquation,_b.blendEquationRGB=this.blendEquationRGB,_b.blendEquationAlpha=this.blendEquationAlpha,_b.depthTest=this.depthTest,_b.depthWrite=this.depthWrite,_b.renderQueue=this.renderQueue,_b._shader=this._shader,_b._disablePublicShaderDefine=this._disablePublicShaderDefine,_b._shaderDefineValue=this._shaderDefineValue;var _c,_d=0,_e=_b._shaderValues;_b._shaderValues.data.length=this._shaderValues.data.length;var _f=this._values.length,_g=_b._values;for(_d=0,_c=_g.length=_f;_d<_c;_d++){var _h=this._values[_d];if(_h)if("number"==typeof _h)_g[_d]=_h,_e.data[_d]=_h;else if("number"==typeof _h&&Math.floor(_h)==_h)_g[_d]=_h,_e.data[_d]=_h;else if("boolean"==typeof _h)_g[_d]=_h,_e.data[_d]=_h;else if(_h instanceof laya.d3.math.Vector2){var _i=_g[_d]||(_g[_d]=new _fb);_h.cloneTo(_i),_e.data[_d]=_i.elements}else if(_h instanceof laya.d3.math.Vector3){var _j=_g[_d]||(_g[_d]=new _gb);_h.cloneTo(_j),_e.data[_d]=_j.elements}else if(_h instanceof laya.d3.math.Vector4){var _k=_g[_d]||(_g[_d]=new _hb);_h.cloneTo(_k),_e.data[_d]=_k.elements}else if(_h instanceof laya.d3.math.Matrix4x4){var _l=_g[_d]||(_g[_d]=new _ab);_h.cloneTo(_l),_e.data[_d]=_l.elements}else _h instanceof laya.d3.resource.BaseTexture&&(_g[_d]=_h,_e.data[_d]=_h)}},_b.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_o(0,_b,"alphaTestValue",function(){return this._getNumber(0)},function(_a){this._setNumber(0,_a)}),_o(0,_b,"alphaTest",function(){return this._alphaTest},function(_a){(this._alphaTest=_a)?this._addShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._removeShaderDefine(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),_a.__init__=function(){_a.SHADERDEFINE_ALPHATEST=_a.shaderDefines.registerDefine("ALPHATEST")},_a.RENDERQUEUE_OPAQUE=2e3,_a.RENDERQUEUE_ALPHATEST=2450,_a.RENDERQUEUE_TRANSPARENT=3e3,_a.CULL_NONE=0,_a.CULL_FRONT=1,_a.CULL_BACK=2,_a.BLEND_DISABLE=0,_a.BLEND_ENABLE_ALL=1,_a.BLEND_ENABLE_SEPERATE=2,_a.BLENDPARAM_ZERO=0,_a.BLENDPARAM_ONE=1,_a.BLENDPARAM_SRC_COLOR=768,_a.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,_a.BLENDPARAM_DST_COLOR=774,_a.BLENDPARAM_ONE_MINUS_DST_COLOR=775,_a.BLENDPARAM_SRC_ALPHA=770,_a.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,_a.BLENDPARAM_DST_ALPHA=772,_a.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,_a.BLENDPARAM_SRC_ALPHA_SATURATE=776,_a.BLENDEQUATION_ADD=0,_a.BLENDEQUATION_SUBTRACT=1,_a.BLENDEQUATION_REVERSE_SUBTRACT=2,_a.DEPTHTEST_OFF=0,_a.DEPTHTEST_NEVER=512,_a.DEPTHTEST_LESS=513,_a.DEPTHTEST_EQUAL=514,_a.DEPTHTEST_LEQUAL=515,_a.DEPTHTEST_GREATER=516,_a.DEPTHTEST_NOTEQUAL=517,_a.DEPTHTEST_GEQUAL=518,_a.DEPTHTEST_ALWAYS=519,_a.SHADERDEFINE_ALPHATEST=1,_a.ALPHATESTVALUE=0,_l(_a,["shaderDefines",function(){return this.shaderDefines=new _kb}]),_a}(_q),_Db=function(_a){function _b(){this._type=0,this._width=0,this._height=0,this._size=null,this._repeat=!1,this._mipmap=!1,this._minFifter=0,this._magFifter=0,this._format=0,this._source=null,this._conchTexture=null,this._wrapModeU=0,this._wrapModeV=0,_b.__super.call(this),this._repeat=!0,this.mipmap=!0,this.minFifter=-1,this.magFifter=-1}_n(_b,"laya.d3.resource.BaseTexture",_q);var _c=_b.prototype;return _o(0,_c,"width",function(){return this._width}),_o(0,_c,"repeat",function(){return this._repeat},function(_a){if(this._repeat!==_a&&(this._repeat=_a,this._source)){var _b=_D.mainContext;_E.bindTexture(_b,this._type,this._source),_u.isPOT(this._width,this._height)&&this._repeat?(_b.texParameteri(this._type,10242,10497),_b.texParameteri(this._type,10243,10497)):(_b.texParameteri(this._type,10242,33071),_b.texParameteri(this._type,10243,33071))}}),_o(0,_c,"height",function(){return this._height}),_o(0,_c,"magFifter",function(){return this._magFifter},function(_a){(this._magFifter=_a)!=this._magFifter&&this._conchTexture&&this._conchTexture.setMaxFifter(_a)}),_o(0,_c,"wrapModeV",function(){return this._wrapModeV}),_o(0,_c,"size",function(){return this._size}),_o(0,_c,"wrapModeU",function(){return this._wrapModeU}),_o(0,_c,"mipmap",function(){return this._mipmap},function(_a){this._mipmap=_a,this._mipmap!=_a&&this._conchTexture&&this._conchTexture.setMipMap(_a)}),_o(0,_c,"minFifter",function(){return this._minFifter},function(_a){this._minFifter=_a,this._minFifter!=_a&&this._conchTexture&&this._conchTexture.setMinFifter(_a)}),_o(0,_c,"format",function(){return this._format}),_o(0,_c,"source",function(){return this.activeResource(),this._source}),_o(0,_c,"defaulteTexture",function(){return _Qb.grayTexture}),_b.WARPMODE_REPEAT=0,_b.WARPMODE_CLAMP=1,_b}(),_Eb=function(_a){function _b(){this._subMeshCount=0,this._boundingBox=null,this._boundingSphere=null,this._boundingBoxCorners=null,this._positions=null,_b.__super.call(this),this._boundingBoxCorners=_d(8,null)}_n(_b,"laya.d3.resource.models.BaseMesh",_q);var _c=_b.prototype;return _c._getPositions=function(){throw new Error("未Override,请重载该属性！")},_c._generateBoundingObject=function(){this._boundingSphere=new _Za(new _gb,0),_Za.createfromPoints(this._positions,this._boundingSphere),this._boundingBox=new _Xa(new _gb,new _gb),_Xa.createfromPoints(this._positions,this._boundingBox),this._boundingBox.getCorners(this._boundingBoxCorners)},_c.getRenderElementsCount=function(){throw new Error("未Override,请重载该属性！")},_c.getRenderElement=function(_a){throw new Error("未Override,请重载该属性！")},_o(0,_c,"subMeshCount",function(){return this._subMeshCount}),_o(0,_c,"boundingBox",function(){return this._boundingBox}),_o(0,_c,"boundingBoxCorners",function(){return this._boundingBoxCorners}),_o(0,_c,"boundingSphere",function(){return this._boundingSphere}),_b}(),_Fb=(function(_a){function _b(){_b.__super.call(this)}_n(_b,"laya.d3.component.Script",_tb);var _c=_b.prototype;_c.onTriggerEnter=function(_a){},_c.onTriggerExit=function(_a){},_c.onTriggerStay=function(_a){},_o(0,_c,"isSingleton",function(){return _b._isSingleton}),_b._isSingleton=!1}(),function(_a){function _b(_a){this._owner=null,this._sharedMesh=null,_b.__super.call(this),this._owner=_a}_n(_b,"laya.d3.core.MeshFilter",_a);var _c=_b.prototype;return _c._sharedMeshLoaded=function(){this.event("loaded")},_c._destroy=function(){_a.prototype._destroy.call(this),this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},_o(0,_c,"sharedMesh",function(){return this._sharedMesh},function(_a){var _b=this._sharedMesh;_b&&_b._removeReference(),(this._sharedMesh=_a)._addReference(),this.event("meshchanged",[this,_b,_a]),_a.loaded||this._sharedMesh.once("loaded",this,this._sharedMeshLoaded)}),_o(0,_c,"_isAsyncLoaded",function(){return this._sharedMesh.loaded}),_o(0,_c,"_originalBoundingBoxCorners",function(){return this._sharedMesh.boundingBoxCorners}),_o(0,_c,"_originalBoundingSphere",function(){return this._sharedMesh.boundingSphere}),_o(0,_c,"_originalBoundingBox",function(){return this._sharedMesh.boundingBox}),_b}(_ub)),_Gb=function(_a){function _b(_a){_b.__super.call(this,_a),_a.meshFilter.on("meshchanged",this,this._onMeshChanged)}_n(_b,"laya.d3.core.MeshRender",_vb);var _c=_b.prototype;return _c._onMeshChanged=function(_a,_b,_c){_c.loaded?this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0:_c.once("loaded",this,this._onMeshLoaed)},_c._onMeshLoaed=function(_a,_b){this._boundingSphereNeedChange=this._boundingBoxNeedChange=this._boundingBoxCenterNeedChange=this._octreeNodeNeedChange=!0},_c._calculateBoundingSphereByInitSphere=function(_a){var _b=NaN,_c=this._owner.transform,_d=_c.scale.elements,_e=Math.abs(_d[0]),_f=Math.abs(_d[1]),_g=Math.abs(_d[2]);_b=_f<=_e&&_g<=_e?_e:_g<=_f?_f:_g,_gb.transformCoordinate(_a.center,_c.worldMatrix,this._boundingSphere.center),this._boundingSphere.radius=_a.radius*_b},_c._calculateBoundBoxByInitCorners=function(_a){for(var _b=this._owner.transform.worldMatrix,_c=0;_c<8;_c++)_gb.transformCoordinate(_a[_c],_b,_vb._tempBoundBoxCorners[_c]);_Xa.createfromPoints(_vb._tempBoundBoxCorners,this._boundingBox)},_c._calculateBoundingSphere=function(){var _a=this._owner.meshFilter.sharedMesh;null==_a||null==_a.boundingSphere?this._boundingSphere.toDefault():this._calculateBoundingSphereByInitSphere(_a.boundingSphere)},_c._calculateBoundingBox=function(){var _a=this._owner.meshFilter.sharedMesh;null==_a||null==_a.boundingBox?this._boundingBox.toDefault():this._calculateBoundBoxByInitCorners(_a.boundingBoxCorners)},_c._renderUpdate=function(_a){var _b=this._owner.transform;if(_b){this._setShaderValueMatrix4x4(0,_b.worldMatrix);var _c=this._owner.getProjectionViewWorldMatrix(_a);this._setShaderValueMatrix4x4(1,_c)}else this._setShaderValueMatrix4x4(0,_ab.DEFAULT),this._setShaderValueMatrix4x4(1,_a);return _rb.debugMode&&this._renderRenderableBoundBox(),!0},_b}(),_Hb=function(_b){function _d(){this._time=0,this._enableLightCount=3,this._customRenderQueneIndex=11,this.enableLight=!0,_d.__super.call(this),this._renderState=new _W,this._lights=[],this._quenes=[],this._cameraPool=[],this._renderableSprite3Ds=[],this.__loaded=!0,this._lightmaps=[],this._shaderValues=new _mb,this.parallelSplitShadowMaps=[],this._dynamicBatchManager=new _ba,this._cullingRenders=[],this._cullingRendersLength=0,this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new _gb(.7,.7,.7),this.ambientColor=new _gb(.212,.227,.259),_D.shaderHighPrecision&&this.addShaderDefine(_yb.SHADERDEFINE_HIGHPRECISION),this.on("display",this,this._display),this.on("undisplay",this,this._unDisplay),this._componentsMap=[],this._typeComponentsIndices=[],this._components=[]}_n(_d,"laya.d3.core.scene.Scene",_b);var _a=_d.prototype;return _v.imps(_a,{"laya.webgl.submit.ISubmit":!0,"laya.resource.ICreateResource":!0}),_a._setUrl=function(_a){this._url=_a},_a._getGroup=function(){return this._group},_a._setGroup=function(_a){this._group=_a},_a._display=function(){_v.stage._scenes.push(this),_v.stage._scenes.sort(_d._sortScenes);for(var _a=0,_b=this._childs.length;_a<_b;_a++){var _c=this._childs[_a];_c.active&&_c._activeHierarchy()}},_a._unDisplay=function(){var _a=_v.stage._scenes;_a.splice(_a.indexOf(this),1);for(var _b=0,_c=this._childs.length;_b<_c;_b++){var _d=this._childs[_b];_d.active&&_d._inActiveHierarchy()}},_a._addChild3D=function(_a){_a.transform._onWorldTransform(),_a._setBelongScene(this),this.displayedInStage&&_a.active&&_a._activeHierarchy()},_a._removeChild3D=function(_a){_a.transform.parent=null,this.displayedInStage&&_a.active&&_a._inActiveHierarchy(),_a._setUnBelongScene()},_a.initOctree=function(_a,_b,_c,_d,_e){void 0===_e&&(_e=6),this.treeSize=new _gb(_a,_b,_c),this.treeLevel=_e,this.treeRoot=new _X(this,0),this.treeRoot.init(_d,this.treeSize)},_a._prepareUpdateToRenderState=function(_a,_b){_b.elapsedTime=this._lastCurrentTime?this.timer.currTimer-this._lastCurrentTime:0,this._lastCurrentTime=this.timer.currTimer,_b.scene=this},_a._prepareSceneToRender=function(_a){var _b=this._lights.length;if(0<_b)for(var _c=0,_d=0;_d<_b&&!(this._lights[_d]._prepareToScene(_a)&&++_c>=this._enableLightCount);_d++);},_a._updateChilds=function(_a){for(var _b=0,_c=this._childs.length;_b<_c;++_b)this._childs[_b]._update(_a)},_a._preRenderScene=function(_a,_b,_c){var _d,_e=_b._viewMatrix,_f=_b._projectionMatrix,_g=_b._projectionViewMatrix,_h=0,_i=_b.camera;for(_i.useOcclusionCulling?this.treeRoot?_ca.renderObjectCullingOctree(_c,this,_i,_e,_f,_g):_ca.renderObjectCulling(_c,this,_i,_e,_f,_g):_ca.renderObjectCullingNoBoundFrustum(this,_i,_e,_f,_g),_h=0,_d=this._quenes.length;_h<_d;_h++)this._quenes[_h]&&this._quenes[_h]._preRender(_b)},_a._clear=function(_a,_b){var _c=_b._viewport,_d=_b.camera,_e=_c.x,_f=_d.renderTargetSize.height-_c.y-_c.height,_g=_c.width,_h=_c.height;_a.viewport(_e,_f,_g,_h);var _i=256,_j=_d.renderTarget;switch(_d.clearFlag){case 0:var _k=_d.clearColor;if(_k){_a.enable(3089),_a.scissor(_e,_f,_g,_h);var _l=_k.elements;_a.clearColor(_l[0],_l[1],_l[2],_l[3]),_i|=16384}if(_j)switch(_k||(_i=16384),_j.depthStencilFormat){case 33189:_i|=256;break;case 36168:_i|=1024;break;case 34041:_i|=256,_i|=1024}_a.clear(_i),_k&&_a.disable(3089);break;case 1:case 2:if(_j)switch(_i=16384,_j.depthStencilFormat){case 33189:_i|=256;break;case 36168:_i|=1024;break;case 34041:_i|=256,_i|=1024}_a.clear(_i);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},_a._renderScene=function(_a,_b){var _c,_d,_e=_b.camera,_f=0;for(_f=0;_f<2;_f++)(_d=this._quenes[_f])&&(_e.renderTarget?_d._render(_b,!0):_d._render(_b,!1));if(1===_e.clearFlag){var _g=_e.sky;_g&&(_E.setCullFace(_a,!1),_E.setDepthFunc(_a,515),_E.setDepthMask(_a,!1),_g._render(_b),_E.setDepthFunc(_a,513),_E.setDepthMask(_a,!0))}for(_f=2,_c=this._quenes.length;_f<_c;_f++)(_d=this._quenes[_f])&&(_d._sortAlpha(_b.camera.transform.position),_e.renderTarget?_d._render(_b,!0):_d._render(_b,!1))},_a._set3DRenderConfig=function(_a){_a.disable(3042),_E._blend=!1,_a.blendFunc(770,771),_E._sFactor=770,_E._dFactor=771,_a.disable(2929),_E._depthTest=!1,_a.enable(2884),_E._cullFace=!0,_a.depthMask(1),_E._depthMask=!0,_a.frontFace(2304),_E._frontFace=2304},_a._set2DRenderConfig=function(_a){_E.setBlend(_a,!0),_E.setBlendFunc(_a,1,771),_E.setDepthTest(_a,!1),_E.setCullFace(_a,!1),_E.setDepthMask(_a,!0),_E.setFrontFace(_a,2305),_a.viewport(0,0,_k.width,_k.height)},_a._parseCustomProps=function(_a,_b,_c,_d){var _e=_d.customProps.lightmaps,_f=_e.length,_g=this._lightmaps;_g.length=_f;for(var _h=0;_h<_f;_h++)_g[_h]=_r.getRes(_b[_e[_h].replace(".exr",".png")]);this.setlightmaps(_g);var _i=_d.customProps.ambientColor;_i&&(this.ambientColor=new _gb(_i[0],_i[1],_i[2]));var _j=_d.customProps.fogColor;_j&&(this.fogColor=new _gb(_j[0],_j[1],_j[2]))},_a._addLight=function(_a){this._lights.indexOf(_a)<0&&this._lights.push(_a)},_a._removeLight=function(_a){var _b=this._lights.indexOf(_a);0<=_b&&this._lights.splice(_b,1)},_a._updateScene=function(){var _a=this._renderState;this._prepareUpdateToRenderState(_D.mainContext,_a),this._updateComponents(_a),this._updateChilds(_a),this._lateUpdateComponents(_a),this._time+=_a.elapsedTime/1e3,this._shaderValues.setValue(22,this._time)},_a._updateSceneConch=function(){var _a=this._renderState;this._prepareUpdateToRenderState(_D.mainContext,_a),this._updateComponents(_a),this._lateUpdateComponents(_a),this._prepareSceneToRender(_a);for(var _b=0,_c=this._cameraPool.length;_b<_c;_b++){var _d=this._cameraPool[_b];(_a.camera=_d)._prepareCameraToRender()}},_a._preRenderShadow=function(_a,_b,_c,_d,_e){this.treeRoot?_ca.renderShadowObjectCullingOctree(this,_b,_c,_d,_e):_ca.renderShadowObjectCulling(this,_b,_c,_d,_e);for(var _f=0,_g=_c.length;_f<_g;_f++)_c[_f]&&_c[_f]._preRender(_a)},_a._renderShadowMap=function(_a,_b,_c){var _d=this.parallelSplitShadowMaps[0];_d._calcAllLightCameraInfo(_c);var _e,_f,_g,_h=_d.PSSMNum;if(this._preRenderShadow(_b,_d._lightCulling,_d._shadowQuenes,_d._lightVPMatrix[0],_h),this.addShaderDefine(_nb.SHADERDEFINE_CAST_SHADOW),1<_h)for(var _i=0;_i<_h;_i++)_e=_d.getRenderTarget(_i+1),_d.beginRenderTarget(_i+1),_a.clearColor(1,1,1,1),_a.clear(16640),_a.viewport(0,0,_e.width,_e.height),_b.camera=_g=_d.getLightCamera(_i),_g._prepareCameraToRender(),_g._prepareCameraViewProject(_g.viewMatrix,_g.projectionMatrix),_b._projectionViewMatrix=_d._lightVPMatrix[_i+1],(_f=_d._shadowQuenes[_i])._preRender(_b),_f._renderShadow(_b,!1),_d.endRenderTarget(_i+1);else _e=_d.getRenderTarget(1),_d.beginRenderTarget(1),_a.clearColor(1,1,1,1),_a.clear(16640),_a.viewport(0,0,_e.width,_e.height),_b.camera=_g=_d.getLightCamera(0),_g._prepareCameraToRender(),_g._prepareCameraViewProject(_g.viewMatrix,_g.projectionMatrix),_b._projectionViewMatrix=_d._lightVPMatrix[0],(_f=_d._shadowQuenes[0])._preRender(_b),_f._renderShadow(_b,!0),_d.endRenderTarget(1);this.removeShaderDefine(_nb.SHADERDEFINE_CAST_SHADOW)},_a.addTreeNode=function(_a){this.treeRoot.addTreeNode(_a)},_a.removeTreeNode=function(_a){this.treeSize&&_a._treeNode&&_a._treeNode.removeObject(_a)},_a.setlightmaps=function(_a){this._lightmaps=_a;for(var _b=0,_c=this._renderableSprite3Ds.length;_b<_c;_b++)this._renderableSprite3Ds[_b]._render._applyLightMapParams()},_a.getlightmaps=function(){return this._lightmaps},_a.addChildAt=function(_a,_b){if(!(_a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.  className="+(_a&&_a.__className));if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),0<=_b&&_b<=this._childs.length){if(_a._parent===this){var _c=this.getChildIndex(_a);this._childs.splice(_c,1),this._childs.splice(_b,0,_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,_b)),this._childChanged()}else _a.parent&&_a.parent.removeChild(_a),this._childs===_j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(_b,0,_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,_b),(_a.parent=this)._addChild3D(_a);return _a}throw new Error("appendChildAt:The index is out of bounds")},_a.addChild=function(_a){if(!(_a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),_a._parent===this){var _b=this.getChildIndex(_a);_b!==this._childs.length-1&&(this._childs.splice(_b,1),this._childs.push(_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,this._childs.length-1)),this._childChanged())}else _a.parent&&_a.parent.removeChild(_a),this._childs===_j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,this._childs.length-1),(_a.parent=this)._childChanged(),this._addChild3D(_a);return _a},_a.removeChildAt=function(_a){var _b=this.getChildAt(_a);return _b&&(this._removeChild3D(_b),this._childs.splice(_a,1),this.conchModel&&this.conchModel.removeChild(_b.conchModel),_b.parent=null),_b},_a.removeChildren=function(_a,_b){if(void 0===_a&&(_a=0),void 0===_b&&(_b=2147483647),this._childs&&0<this._childs.length){var _c=this._childs;if(0===_a&&_f<=_b){var _d=_c;this._childs=_j.ARRAY_EMPTY}else _d=_c.splice(_a,_b-_a);for(var _e=0,_f=_d.length;_e<_f;_e++)this._removeChild3D(_d[_e]),_d[_e].parent=null,this.conchModel&&this.conchModel.removeChild(_d[_e].conchModel)}return this},_a.addFrustumCullingObject=function(_a){this.treeRoot?this.addTreeNode(_a):(this._cullingRendersLength===this._cullingRenders.length?this._cullingRenders.push(_a):this._cullingRenders[this._cullingRendersLength]=_a,_a._indexInSceneFrustumCullingObjects=this._cullingRendersLength++)},_a.removeFrustumCullingObject=function(_a){if(this.treeRoot)this.removeTreeNode(_a);else{this._cullingRendersLength--;var _b=_a._indexInSceneFrustumCullingObjects;if(_b!==this._cullingRendersLength){var _c=this._cullingRenders[this._cullingRendersLength];(this._cullingRenders[_b]=_c)._indexInSceneFrustumCullingObjects=_b,_a._indexInSceneFrustumCullingObjects=-1}}},_a.getRenderQueue=function(_a){return _a<3e3?this._quenes[1]||(this._quenes[1]=new _V(this)):this._quenes[2]||(this._quenes[2]=new _V(this))},_a.addRenderQuene=function(){this._quenes[this._customRenderQueneIndex++]=new _V(this)},_a.addShaderDefine=function(_a){this._shaderDefineValue|=_a},_a.removeShaderDefine=function(_a){this._shaderDefineValue&=~_a},_a.addScript=function(_a){return this._addComponent(_a)},_a.getScriptByType=function(_a,_b){return void 0===_b&&(_b=0),this._getComponentByType(_a,_b)},_a.getScriptsByType=function(_a,_b){this._getComponentsByType(_a,_b)},_a.getScriptByIndex=function(_a){return this._getComponentByIndex(_a)},_a.removeScriptByType=function(_a,_b){void 0===_b&&(_b=0),this._removeComponentByType(_a,_b)},_a.removeScriptsByType=function(_a){this._removeComponentByType(_a)},_a.removeAllScript=function(){this._removeAllComponent()},_a.render=function(_a,_b,_c){(_p._context.ctx._renderKey=0)<this._childs.length&&_a.addRenderObject(this)},_a.renderSubmit=function(){var _a=_D.mainContext,_b=this._renderState;this._set3DRenderConfig(_a),this._prepareSceneToRender(this._renderState);var _c,_d=0,_e=0;if(_rb.debugMode||_X.debugMode)for(_d=0,_e=this._cameraPool.length;_d<_e;_d++)_c=this._cameraPool[_d],_rb._debugPhasorSprite.begin(1,_c),_c.activeInHierarchy&&_c._renderCamera(_a,_b,this),_rb._debugPhasorSprite.end();else for(_d=0,_e=this._cameraPool.length;_d<_e;_d++)(_c=this._cameraPool[_d]).activeInHierarchy&&_c._renderCamera(_a,_b,this);return this._set2DRenderConfig(_a),1},_a.onAsynLoaded=function(_a,_b,_c){var _d=_b[0];if("Scene"!==_d.type)throw new Error("Scene: the .lh file root type must be Scene,please use other function to  load  this file.");var _e=_b[1];_qb._createNodeByJson(this,_d,this,_e),this.event("hierarchyloaded",[this]),this.__loaded=!0},_a.destroy=function(_a){void 0===_a&&(_a=!0),this.destroyed||(_b.prototype.destroy.call(this,_a),this._renderState=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._cullingRenders=null,this._dynamicBatchManager=null,this._quenes=null,this._cameraPool=null,this._renderableSprite3Ds=null,this.treeRoot=null,this.treeSize=null,this.parallelSplitShadowMaps=null,this._typeComponentsIndices=null,this._components=null,_r.clearRes(this.url),this.loaded||_rb._cancelLoadByUrl(this.url))},_a.getRenderType=function(){return 0},_a.releaseRender=function(){},_a._addComponent=function(_a){var _b,_c=this._componentsMap.indexOf(_a);if(-1===_c)_b=[],this._componentsMap.push(_a),this._typeComponentsIndices.push(_b);else if(_b=this._typeComponentsIndices[_c],this._components[_b[0]].isSingleton)throw new Error("无法单实例创建"+_a+"组件，"+_a+"组件已存在！");var _d=_e.getInstance(_a);_b.push(this._components.length),this._components.push(_d);return _d._initialize(this),_d},_a._removeComponent=function(_a,_b){var _c=this._typeComponentsIndices[_a],_d=_c[_b],_e=this._components[_d];this._components.splice(_d,1),_c.splice(_b,1),0===_c.length&&(this._typeComponentsIndices.splice(_a,1),this._componentsMap.splice(_a,1));for(var _f=0,_g=this._componentsMap.length;_f<_g;_f++)for(var _h=(_c=this._typeComponentsIndices[_f]).length-1;0<=_h;_h--){var _i=_c[_h];if(!(_d<_i))break;_c[_h]=--_i}_e._destroy()},_a._getComponentByType=function(_a,_b){void 0===_b&&(_b=0);var _c=this._componentsMap.indexOf(_a);return-1===_c?null:this._components[this._typeComponentsIndices[_c][_b]]},_a._getComponentsByType=function(_a,_b){var _c=this._componentsMap.indexOf(_a);if(-1!==_c){var _d=this._typeComponentsIndices[_c],_e=_d.length;_b.length=_e;for(var _f=0;_f<_e;_f++)_b[_f]=this._components[_d[_f]]}else _b.length=0},_a._getComponentByIndex=function(_a){return this._components[_a]},_a._removeComponentByType=function(_a,_b){void 0===_b&&(_b=0);var _c=this._componentsMap.indexOf(_a);-1!==_c&&this._removeComponent(_c,_b)},_a._removeComponentsByType=function(_a){var _b=this._componentsMap.indexOf(_a);if(-1!==_b)for(var _c=this._typeComponentsIndices[_b],_d=0,_e=_c.length;_d<_e;_c.length<_e?_e--:_d++)this._removeComponent(_b,_d)},_a._removeAllComponent=function(){for(var _a=0,_b=this._componentsMap.length;_a<_b;this._componentsMap.length<_b?_b--:_a++)this._removeComponentsByType(this._componentsMap[_a])},_a._updateComponents=function(_a){for(var _b=0,_c=this._components.length;_b<_c;_b++){var _d=this._components[_b];!_d.started&&(_d._start(_a),_d.started=!0),_d.enable&&_d._update(_a)}},_a._lateUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._lateUpdate(_a)}},_a._preRenderUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._preRenderUpdate(_a)}},_a._postRenderUpdateComponents=function(_a){for(var _b=0;_b<this._components.length;_b++){var _c=this._components[_b];!_c.started&&(_c._start(_a),_c.started=!0),_c.enable&&_c._postRenderUpdate(_a)}},_o(0,_a,"_loaded",null,function(_a){this.__loaded=_a}),_o(0,_a,"fogColor",function(){return this._fogColor},function(_a){this._fogColor=_a,this._shaderValues.setValue(0,_a.elements)}),_o(0,_a,"enableFog",function(){return this._enableFog},function(_a){this._enableFog!==_a&&((this._enableFog=_a)?(this.addShaderDefine(_yb.SHADERDEFINE_FOG),this.removeShaderDefine(_yb.SAHDERDEFINE_DEPTHFOG)):this.removeShaderDefine(_yb.SHADERDEFINE_FOG))}),_o(0,_a,"url",function(){return this._url}),_o(0,_a,"loaded",function(){return this.__loaded}),_o(0,_a,"enableDepthFog",function(){return this._enableDepthFog},function(_a){this._enableDepthFog!=_a&&((this._enableDepthFog=_a)?(this.addShaderDefine(_yb.SAHDERDEFINE_DEPTHFOG),this.removeShaderDefine(_yb.SHADERDEFINE_FOG)):this.removeShaderDefine(_yb.SAHDERDEFINE_DEPTHFOG))}),_o(0,_a,"fogStart",function(){return this._fogStart},function(_a){this._fogStart=_a,this._shaderValues.setValue(1,_a)}),_o(0,_a,"fogRange",function(){return this._fogRange},function(_a){this._fogRange=_a,this._shaderValues.setValue(2,_a)}),_o(0,_a,"ambientColor",function(){return this._ambientColor},function(_a){this._ambientColor=_a,this._shaderValues.setValue(21,_a.elements)}),_o(0,_a,"scene",function(){return this}),_o(0,_a,"renderableSprite3Ds",function(){return this._renderableSprite3Ds.slice()}),_d._sortScenes=function(_a,_b){if(_a.parent!==_v.stage||_b.parent!==_v.stage)return _a.parent!==_v.stage&&_b.parent!==_v.stage?_d._sortScenes(_a.parent,_b.parent):_a.parent===_v.stage?-1:1;var _c=_v.stage._childs;return _c.indexOf(_a)-_c.indexOf(_b)},_d.load=function(_a){return _v.loader.create(_a,null,null,_d)},_d.FOGCOLOR=0,_d.FOGSTART=1,_d.FOGRANGE=2,_d.LIGHTDIRECTION=3,_d.LIGHTDIRCOLOR=4,_d.POINTLIGHTPOS=5,_d.POINTLIGHTRANGE=6,_d.POINTLIGHTATTENUATION=7,_d.POINTLIGHTCOLOR=8,_d.SPOTLIGHTPOS=9,_d.SPOTLIGHTDIRECTION=10,_d.SPOTLIGHTSPOT=11,_d.SPOTLIGHTRANGE=12,_d.SPOTLIGHTATTENUATION=13,_d.SPOTLIGHTCOLOR=14,_d.SHADOWDISTANCE=15,_d.SHADOWLIGHTVIEWPROJECT=16,_d.SHADOWMAPPCFOFFSET=17,_d.SHADOWMAPTEXTURE1=18,_d.SHADOWMAPTEXTURE2=19,_d.SHADOWMAPTEXTURE3=20,_d.AMBIENTCOLOR=21,_d.TIME=22,_d}(_x),_Ib=function(_a){function _b(_a){_b.__super.call(this),this.__loaded=!0,this._projectionViewWorldUpdateLoopCount=-1,this._activeInHierarchy=!1,this._projectionViewWorldMatrix=new _ab,this._shaderValues=new _mb,this._colliders=[],this._id=++_b._uniqueIDCounter,this._transform=new _wb(this),this.name=_a||"Sprite3D-"+_b._nameNumberCounter++,this.layer=_G.currentCreationLayer,this.active=!0}_n(_b,"laya.d3.core.Sprite3D",_Bb);var _c=_b.prototype;return _v.imps(_c,{"laya.d3.core.render.IUpdate":!0,"laya.resource.ICreateResource":!0,"laya.d3.core.IClone":!0}),_c._setUrl=function(_a){this._url=_a},_c._getGroup=function(){return this._group},_c._setGroup=function(_a){this._group=_a},_c._addChild3D=function(_a){_a.transform.parent=this.transform,this._hierarchyAnimator&&(!_a._hierarchyAnimator&&_a._setHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(_a,!0,[_a.name])),this._scene&&(_a._setBelongScene(this._scene),this._activeInHierarchy&&_a._active&&_a._activeHierarchy())},_c._removeChild3D=function(_a){_a.transform.parent=null,this._scene&&(this._activeInHierarchy&&_a._active&&_a._inActiveHierarchy(),_a._setUnBelongScene()),this._hierarchyAnimator&&(_a._hierarchyAnimator==this._hierarchyAnimator&&_a._clearHierarchyAnimator(this._hierarchyAnimator,null),this._getAnimatorToLinkSprite3D(_a,!1,[_a.name]))},_c._parseBaseCustomProps=function(_a){var _b=this.transform.localPosition;_a.translate?(_b.fromArray(_a.translate),_b.x*=100,_b.y*=100,_b.z*=100):_b.elements.fill(0),this.transform.localPosition=_b;var _c=this.transform.localRotation;_a.rotation?_c.fromArray(_a.rotation):_c.fromArray([0,0,0,-1]),this.transform.localRotation=_c;var _d=this.transform.localScale;_a.scale?_d.fromArray(_a.scale):_d.elements.fill(1),this.transform.localScale=_d;var _e=_a.layer;null!=_e&&(this.layer=_G.getLayerByNumber(_e))},_c._parseCustomComponent=function(_a,_b,_c){for(var _d in _c){var _e=_c[_d];switch(_d){case"Animator":var _f=this.addComponent(Animator);if(_e.avatarPath)_f.avatar=_r.getRes(_b[_e.avatarPath]);else{var _g=_e.avatar;if(_g){_f.avatar=_r.getRes(_b[_g.path]);var _h=_g.linkSprites;_h&&_a.once("hierarchyloaded",this,this._onRootNodeHierarchyLoaded,[_f,_h])}}for(var _i=_e.clipPaths,_j=_i.length,_k=0;_k<_j;_k++)_f.addClip(_r.getRes(_b[_i[_k]]));_f.clip=_r.getRes(_b[_i[0]]);var _l=_e.playOnWake;void 0!==_l&&(_f.playOnWake=_l);break;case"Rigidbody":this.addComponent(Rigidbody);break;case"SphereCollider":var _m=this.addComponent(SphereCollider);_m.isTrigger=_e.isTrigger;var _n=_m.center;_n.fromArray(_e.center),_m.center=_n,_m.radius=_e.radius;break;case"BoxCollider":var _o=this.addComponent(BoxCollider);_o.isTrigger=_e.isTrigger,_o.center.fromArray(_e.center);var _p=_o.size;_p.fromArray(_e.size),_o.size=_p;break;case"MeshCollider":this.addComponent(MeshCollider)}}},_c._onRootNodeHierarchyLoaded=function(_a,_b){for(var _c in _b){for(var _d=this,_e=_b[_c],_f=0,_g=_e.length;_f<_g;_f++){var _h=_e[_f];if(""===_h)break;if(!(_d=_d.getChildByName(_h)))break}_d&&_a.linkSprite3DToAvatarNode(_c,_d)}},_c._setHierarchyAnimator=function(_a,_b){this._changeHierarchyAnimator(_a);for(var _c=0,_d=this._childs.length;_c<_d;_c++){var _e=this._childs[_c];_e._hierarchyAnimator==_b&&_e._setHierarchyAnimator(_a,_b)}},_c._clearHierarchyAnimator=function(_a,_b){this._changeHierarchyAnimator(_b);for(var _c=0,_d=this._childs.length;_c<_d;_c++){var _e=this._childs[_c];_e._hierarchyAnimator==_a&&_e._clearHierarchyAnimator(_a,_b)}},_c._getAnimatorToLinkSprite3D=function(_a,_b,_c){var _d=this.getComponentByType(Animator);if(_d&&(_d.avatar?_d.avatar._version||_a._setAnimatorToLinkAvatar(_d,_b):_a._setAnimatorToLinkSprite3DNoAvatar(_d,_b,_c)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){_c.unshift(this._parent.name);var _e=this._parent;_e._hierarchyAnimator&&_e._getAnimatorToLinkSprite3D(_a,_b,_c)}},_c._setAnimatorToLinkSprite3DNoAvatar=function(_a,_b,_c){var _d=0,_e=0;for(_d=0,_e=_a.getClipCount();_d<_e;_d++)_a._handleSpriteOwnersBySprite(_d,_b,_c,this);for(_d=0,_e=this._childs.length;_d<_e;_d++){var _f=this._childs[_d],_g=_c.length;_c.push(_f.name),_f._setAnimatorToLinkSprite3DNoAvatar(_a,_b,_c),_c.splice(_g,1)}},_c._changeHierarchyAnimator=function(_a){this._hierarchyAnimator=_a},_c._isLinkSpriteToAnimationNode=function(_a,_b,_c){var _d=_a._avatarNodes.indexOf(_b),_e=_a._cacheSpriteToNodesMap;if(_c)this._transform.dummy=_b.transform,_a._cacheNodesToSpriteMap[_d]=_e.length,_e.push(_d);else{this._transform.dummy=null;var _f=_a._cacheNodesToSpriteMap[_d];_a._cacheNodesToSpriteMap[_d]=null,_e.splice(_f,1)}},_c._setBelongScene=function(_a){this._scene=_a;for(var _b=0,_c=this._childs.length;_b<_c;_b++)this._childs[_b]._setBelongScene(_a)},_c._setUnBelongScene=function(){this._scene=null;for(var _a=0,_b=this._childs.length;_a<_b;_a++)this._childs[_a]._setUnBelongScene()},_c._activeHierarchy=function(){var _a=0,_b=0;for(this._activeInHierarchy=!0,this._addSelfRenderObjects(),_a=0,_b=this._colliders.length;_a<_b;_a++)this._layer._addCollider(this._colliders[_a]);for(this.event("activeinhierarchychanged",!0),_a=0,_b=this._childs.length;_a<_b;_a++){var _c=this._childs[_a];_c._active&&_c._activeHierarchy()}},_c._inActiveHierarchy=function(){var _a=0,_b=0;for(this._activeInHierarchy=!1,this._clearSelfRenderObjects(),_a=0,_b=this._colliders.length;_a<_b;_a++){var _c=this._colliders[_a];_c._clearCollsionMap(),this._layer._removeCollider(_c)}for(this.event("activeinhierarchychanged",!1),_a=0,_b=this._childs.length;_a<_b;_a++){var _d=this._childs[_a];_d._active&&_d._inActiveHierarchy()}},_c.addComponent=function(_a){var _b,_c=this._componentsMap.indexOf(_a);if(-1===_c)_b=[],this._componentsMap.push(_a),this._typeComponentsIndices.push(_b);else if(_b=this._typeComponentsIndices[_c],this._components[_b[0]].isSingleton)throw new Error("无法单实例创建"+_a+"组件，"+_a+"组件已存在！");var _d=_e.getInstance(_a);return _b.push(this._components.length),this._components.push(_d),_d instanceof laya.d3.component.Script&&this._scripts.push(_d),_d._initialize(this),_d},_c._removeComponent=function(_a,_b){var _c,_d=0,_e=this._typeComponentsIndices[_a],_f=_e[_b],_g=this._components[_f];for(_g instanceof laya.d3.component.Script&&this._scripts.splice(this._scripts.indexOf(_g),1),_e.splice(_b,1),0===_e.length&&(this._typeComponentsIndices.splice(_a,1),this._componentsMap.splice(_a,1)),_d=0,_c=this._componentsMap.length;_d<_c;_d++)for(var _h=(_e=this._typeComponentsIndices[_d]).length-1;0<=_h;_h--){var _i=_e[_h];if(!(_f<_i))break;_e[_h]=--_i}_g._destroy()},_c._clearSelfRenderObjects=function(){},_c._addSelfRenderObjects=function(){},_c._parseCustomProps=function(_a,_b,_c,_d){},_c._updateChilds=function(_a){var _b=this._childs.length;if(0!==_b)for(var _c=0;_c<_b;++_c)this._childs[_c]._update(_a)},_c._getSortID=function(_a,_b){return 1e3*_b.id+_a._getVertexBuffer().vertexDeclaration.id},_c._update=function(_a){(_a.owner=this)._activeInHierarchy&&(this._updateComponents(_a),this._lateUpdateComponents(_a),_y.spriteCount++,this._childs.length&&this._updateChilds(_a))},_c.getProjectionViewWorldMatrix=function(_a){return _ab.multiply(_a,this.transform.worldMatrix,this._projectionViewWorldMatrix),this._projectionViewWorldMatrix},_c.loadHierarchy=function(_a){this.addChild(laya.d3.core.Sprite3D.load(_a))},_c.addChildAt=function(_a,_b){if(!(_a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),0<=_b&&_b<=this._childs.length){if(_a._parent===this){var _c=this.getChildIndex(_a);this._childs.splice(_c,1),this._childs.splice(_b,0,_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,_b)),this._childChanged()}else _a.parent&&_a.parent.removeChild(_a),this._childs===_j.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(_b,0,_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,_b),(_a.parent=this)._addChild3D(_a);return _a}throw new Error("appendChildAt:The index is out of bounds")},_c.addChild=function(_a){if(!(_a instanceof laya.d3.core.Sprite3D))throw new Error("Sprite3D:Node type must Sprite3D.");if(!_a||this.destroyed||_a===this)return _a;if(_a.zOrder&&this._set$P("hasZorder",!0),_a._parent===this){var _b=this.getChildIndex(_a);_b!==this._childs.length-1&&(this._childs.splice(_b,1),this._childs.push(_a),this.conchModel&&(this.conchModel.removeChild(_a.conchModel),this.conchModel.addChildAt(_a.conchModel,this._childs.length-1)),this._childChanged())}else _a.parent&&_a.parent.removeChild(_a),this._childs===_j.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(_a),this.conchModel&&this.conchModel.addChildAt(_a.conchModel,this._childs.length-1),(_a.parent=this)._childChanged(),this._addChild3D(_a);return _a},_c.removeChildAt=function(_a){var _b=this.getChildAt(_a);return _b&&(this._removeChild3D(_b),this._childs.splice(_a,1),this.conchModel&&this.conchModel.removeChild(_b.conchModel),_b.parent=null),_b},_c.removeChildren=function(_a,_b){if(void 0===_a&&(_a=0),void 0===_b&&(_b=2147483647),this._childs&&0<this._childs.length){var _c=this._childs;if(0===_a&&_f<=_b){var _d=_c;this._childs=_j.ARRAY_EMPTY}else _d=_c.splice(_a,_b-_a);for(var _e=0,_f=_d.length;_e<_f;_e++)this._removeChild3D(_d[_e]),_d[_e].parent=null,this.conchModel&&this.conchModel.removeChild(_d[_e].conchModel)}return this},_c.onAsynLoaded=function(_a,_b,_c){var _d=_b[0];if("Sprite3D"!==_d.type)throw new Error("Sprite3D: The .lh file root type must be Sprite3D,please use other function to  load  this file.");var _e=_b[1];_qb._createNodeByJson(this,_d,this,_e),this.event("hierarchyloaded",[this]),this.__loaded=!0},_c.cloneTo=function(_a){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var _b=_a;_b.name=this.name,_b._destroyed=this._destroyed,_b.timer=this.timer,_b._$P=this._$P,_b.active=this._active;var _c=_b.transform.localPosition;this.transform.localPosition.cloneTo(_c),_b.transform.localPosition=_c;var _d=_b.transform.localRotation;this.transform.localRotation.cloneTo(_d),_b.transform.localRotation=_d;var _e=_b.transform.localScale;this.transform.localScale.cloneTo(_e),_b.transform.localScale=_e,_b.isStatic=this.isStatic;var _f=0,_g=0;for(_f=0,_g=this._componentsMap.length;_f<_g;_f++){var _h=_b.addComponent(this._componentsMap[_f]);this._components[_f]._cloneTo(_h)}for(_f=0,_g=this._childs.length;_f<_g;_f++)_b.addChild(this._childs[_f].clone());var _i=_b.getComponentByType(Animator);if(_i){var _j=_i._linkSpritesData;if(_j)for(var _k in _j){for(var _l=_j[_k],_m=_b,_n=0,_o=_l.length;_n<_o&&(_m=_m.getChildByName(_l[_n]));_n++);if(_m){var _p=_i._avatarNodeMap[_k];_m._isLinkSpriteToAnimationNode(_i,_p,!0)}}}},_c.clone=function(){var _a=new this.constructor;return this.cloneTo(_a),_a},_c.destroy=function(_a){if(void 0===_a&&(_a=!0),!this.destroyed){laya.display.Node.prototype.destroy.call(this,_a);var _b,_c=0;for(_c=0,_b=this._components.length;_c<_b;_c++)this._components[_c]._destroy();this._components=null,this._componentsMap=null,this._typeComponentsIndices=null,this._transform=null,this._colliders=null,_r.clearRes(this.url),this.loaded||_rb._cancelLoadByUrl(this.url)}},_c._handleSpriteToAvatar=function(_a,_b){_a._avatarNodes;var _c=_a._avatarNodeMap[this.name];_c&&_c.name===this.name&&!this._transform.dummy&&this._isLinkSpriteToAnimationNode(_a,_c,_b)},_c._setAnimatorToLinkAvatar=function(_a,_b){this._handleSpriteToAvatar(_a,_b);for(var _c=0,_d=this._childs.length;_c<_d;_c++){this._childs[_c]._setAnimatorToLinkAvatar(_a,_b)}},_o(0,_c,"activeInHierarchy",function(){return this._activeInHierarchy}),_o(0,_c,"_loaded",null,function(_a){this.__loaded=_a}),_o(0,_c,"active",function(){return this._active},function(_a){this._active!==_a&&(this._active=_a,this._parent&&(this._parent===this._scene&&this._parent.displayedInStage||this._parent._activeInHierarchy)&&(_a?this._activeHierarchy():this._inActiveHierarchy()))}),_o(0,_c,"componentsCount",function(){return this._components.length}),_o(0,_c,"loaded",function(){return this.__loaded}),_o(0,_c,"id",function(){return this._id}),_o(0,_c,"url",function(){return this._url}),_o(0,_c,"layer",function(){return this._layer},function(_a){if(this._layer!==_a){if(!_a)throw new Error("Layer value can be null.");if(this._activeInHierarchy){var _b=0,_c=this._colliders.length;if(this._layer)for(_b=0;_b<_c;_b++)this._layer._removeCollider(this._colliders[_b]);for(_b=0;_b<_c;_b++)_a._addCollider(this._colliders[_b])}this._layer=_a,this.event("layerchanged",_a)}}),_o(0,_c,"scene",function(){return this._scene}),_o(0,_c,"transform",function(){return this._transform}),_b.instantiate=function(_a,_b,_c,_d,_e){void 0===_c&&(_c=!0);var _f=_a.clone();_b&&_b.addChild(_f);var _g=_f.transform;if(_c){var _h=_g.worldMatrix;_a.transform.worldMatrix.cloneTo(_h),_g.worldMatrix=_h}else _d&&(_g.position=_d),_e&&(_g.rotation=_e);return _f},_b.load=function(_a){return _v.loader.create(_a,null,null,_b)},_b.WORLDMATRIX=0,_b.MVPMATRIX=1,_b._uniqueIDCounter=0,_b._nameNumberCounter=0,_b}(),_Jb=function(_a){function _k(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){if(this._curActTexIndex=0,this._program=null,this._attributeParams=null,this._uniformParams=null,this._attributeParamsMap=[],this._sceneUniformParamsMap=[],this._cameraUniformParamsMap=[],this._spriteUniformParamsMap=[],this._materialUniformParamsMap=[],this._renderElementUniformParamsMap=[],_k.__super.call(this),!_a||!_b)throw"Shader Error";this._id=++_k._count,this._vs=_a,this._ps=_b,this._attributeMap=_c,this._sceneUniformMap=_d,this._cameraUniformMap=_e,this._spriteUniformMap=_f,this._materialUniformMap=_g,this._renderElementUniformMap=_h,this._precompile=_i,this._define=_j,this._precompile&&_k.extCompileObj&&_k.extCompileFunc?_k.extCompileFunc.call(_k.extCompileObj,_a,_b,_j):this.recreateResource()}_n(_k,"laya.d3.shader.Shader3D",_c);var _b=_k.prototype;return _b.recreateResource=function(){_F.now();this._compile(),this.completeCreate(),this.memorySize=0},_b.disposeResource=function(){_D.mainContext.deleteShader(this._vshader),_D.mainContext.deleteShader(this._pshader),_D.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._attributeParams=null,this._uniformParams=null,this.memorySize=0,this._curActTexIndex=0},_b._compile=function(){if(!_D.mainContext.isContextLost()&&this._vs&&this._ps&&!this._attributeParams&&!this._uniformParams){this._reCompile=!0,this._attributeParams=[],this._uniformParams=[];var _a=[this._vs,this._ps],_b=_D.mainContext;if(this._program=_b.createProgram(),this._vshader=_k._createShader(_b,_a[0],35633),this._pshader=_k._createShader(_b,_a[1],35632),_b.attachShader(this._program,this._vshader),_b.attachShader(this._program,this._pshader),_b.linkProgram(this._program),!_p.isConchApp&&_yb.debugMode&&!_b.getProgramParameter(this._program,35714))throw _b.getProgramInfoLog(this._program);var _c,_d=0,_e=0,_f=0;for(_f=_p.isConchApp?_b.getProgramParameterEx(this._vs,this._ps,"",35721):_b.getProgramParameter(this._program,35721),_d=0;_d<_f;_d++){var _g=null;_c={vartype:"attribute",ivartype:0,attrib:_g=_p.isConchApp?_b.getActiveAttribEx(this._vs,this._ps,"",_d):_b.getActiveAttrib(this._program,_d),location:_b.getAttribLocation(this._program,_g.name),name:_g.name,type:_g.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._attributeParams.push(_c)}var _h=0;for(_h=_p.isConchApp?_b.getProgramParameterEx(this._vs,this._ps,"",35718):_b.getProgramParameter(this._program,35718),_d=0;_d<_h;_d++){var _i=null;_i=_p.isConchApp?_b.getActiveUniformEx(this._vs,this._ps,"",_d):_b.getActiveUniform(this._program,_d),0<(_c={vartype:"uniform",ivartype:1,attrib:_g,location:_b.getUniformLocation(this._program,_i.name),name:_i.name,type:_i.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(_c.name=_c.name.substr(0,_c.name.length-3),_c.isArray=!0,_c.location=_b.getUniformLocation(this._program,_c.name)),this._uniformParams.push(_c)}for(_d=0,_e=this._attributeParams.length;_d<_e;_d++)(_c=this._attributeParams[_d]).indexOfParams=_d,_c.index=1,_c.value=[_c.location,null],_c.codename=_c.name,_c.name=null!=this._attributeMap[_c.codename]?this._attributeMap[_c.codename]:_c.codename,this._attributeParamsMap.push(_c.name),this._attributeParamsMap.push(_c),_c._this=this,_c.uploadedValue=[],_c.fun=this._attribute;for(_d=0,_e=this._uniformParams.length;_d<_e;_d++)switch((_c=this._uniformParams[_d]).indexOfParams=_d,_c.index=1,_c.value=[_c.location,null],_c.codename=_c.name,null!=this._sceneUniformMap[_c.codename]?(_c.name=this._sceneUniformMap[_c.codename],this._sceneUniformParamsMap.push(_c.name),this._sceneUniformParamsMap.push(_c)):null!=this._cameraUniformMap[_c.codename]?(_c.name=this._cameraUniformMap[_c.codename],this._cameraUniformParamsMap.push(_c.name),this._cameraUniformParamsMap.push(_c)):null!=this._spriteUniformMap[_c.codename]?(_c.name=this._spriteUniformMap[_c.codename],this._spriteUniformParamsMap.push(_c.name),this._spriteUniformParamsMap.push(_c)):null!=this._materialUniformMap[_c.codename]?(_c.name=this._materialUniformMap[_c.codename],this._materialUniformParamsMap.push(_c.name),this._materialUniformParamsMap.push(_c)):null!=this._renderElementUniformMap[_c.codename]?(_c.name=this._renderElementUniformMap[_c.codename],this._renderElementUniformParamsMap.push(_c.name),this._renderElementUniformParamsMap.push(_c)):console.log("Shader:can't find uinform name:"+_c.codename+" in shader file."),_c._this=this,_c.uploadedValue=[],_c.type){case 5124:_c.fun=_c.isArray?this._uniform1iv:this._uniform1i;break;case 5126:_c.fun=_c.isArray?this._uniform1fv:this._uniform1f;break;case 35664:_c.fun=_c.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:_c.fun=_c.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:_c.fun=_c.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:_c.fun=this._uniform_sampler2D;break;case 35680:_c.fun=this._uniform_samplerCube;break;case 35676:_c.fun=this._uniformMatrix4fv;break;case 35670:_c.fun=this._uniform1i;break;case 35674:_c.fun=this._uinformMatrix2fv;break;case 35675:_c.fun=this._uinformMatrix3fv;break;default:throw new Error("compile shader err!")}}},_b._attribute=function(_a,_b){var _c=_D.mainContext,_d=_h._enableAtributes,_e=_a.location;return _d[_e]||_c.enableVertexAttribArray(_e),_c.vertexAttribPointer(_e,_b[0],_b[1],_b[2],_b[3],_b[4]),_d[_e]=_h._bindVertexBuffer,1},_b._uniform1f=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b?(_D.mainContext.uniform1f(_a.location,_c[0]=_b),1):0},_b._uniform1fv=function(_a,_b){if(_b.length<4){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_D.mainContext.uniform1fv(_a.location,_b),_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3],1):0}return _D.mainContext.uniform1fv(_a.location,_b),1},_b._uniform_vec2=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]?(_D.mainContext.uniform2f(_a.location,_c[0]=_b[0],_c[1]=_b[1]),1):0},_b._uniform_vec2v=function(_a,_b){if(_b.length<2){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_D.mainContext.uniform2fv(_a.location,_b),_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3],1):0}return _D.mainContext.uniform2fv(_a.location,_b),1},_b._uniform_vec3=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]?(_D.mainContext.uniform3f(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2]),1):0},_b._uniform_vec3v=function(_a,_b){return _D.mainContext.uniform3fv(_a.location,_b),1},_b._uniform_vec4=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_D.mainContext.uniform4f(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3]),1):0},_b._uniform_vec4v=function(_a,_b){return _D.mainContext.uniform4fv(_a.location,_b),1},_b._uniformMatrix2fv=function(_a,_b){return _D.mainContext.uniformMatrix2fv(_a.location,!1,_b),1},_b._uniformMatrix3fv=function(_a,_b){return _D.mainContext.uniformMatrix3fv(_a.location,!1,_b),1},_b._uniformMatrix4fv=function(_a,_b){return _D.mainContext.uniformMatrix4fv(_a.location,!1,_b),1},_b._uinformMatrix2fv=function(_a,_b){return _D.mainContext.uniformMatrix2fv(_a.location,!1,_b),1},_b._uinformMatrix3fv=function(_a,_b){return _D.mainContext.uniformMatrix3fv(_a.location,!1,_b),1},_b._uniform1i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b?(_D.mainContext.uniform1i(_a.location,_c[0]=_b),1):0},_b._uniform1iv=function(_a,_b){return _D.mainContext.uniform1iv(_a.location,_b),1},_b._uniform_ivec2=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]?(_D.mainContext.uniform2i(_a.location,_c[0]=_b[0],_c[1]=_b[1]),1):0},_b._uniform_ivec2v=function(_a,_b){return _D.mainContext.uniform2iv(_a.location,_b),1},_b._uniform_vec3i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]?(_D.mainContext.uniform3i(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2]),1):0},_b._uniform_vec3vi=function(_a,_b){return _D.mainContext.uniform3iv(_a.location,_b),1},_b._uniform_vec4i=function(_a,_b){var _c=_a.uploadedValue;return _c[0]!==_b[0]||_c[1]!==_b[1]||_c[2]!==_b[2]||_c[3]!==_b[3]?(_D.mainContext.uniform4i(_a.location,_c[0]=_b[0],_c[1]=_b[1],_c[2]=_b[2],_c[3]=_b[3]),1):0},_b._uniform_vec4vi=function(_a,_b){return _D.mainContext.uniform4iv(_a.location,_b),1},_b._uniform_sampler2D=function(_a,_b){var _c=_b.source||_b.defaulteTexture.source,_d=_D.mainContext,_e=_a.uploadedValue;if(null!=_e[0])return _d.activeTexture(_k._TEXTURES[_e[0]]),_c&&_E.bindTexture(_d,3553,_c),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return _e[0]=this._curActTexIndex,_d.uniform1i(_a.location,this._curActTexIndex),_d.activeTexture(_k._TEXTURES[this._curActTexIndex]),_c&&_E.bindTexture(_d,3553,_c),this._curActTexIndex++,1},_b._uniform_samplerCube=function(_a,_b){var _c=_b.source||_b.defaulteTexture.source,_d=_D.mainContext,_e=_a.uploadedValue;if(null!=_e[0])return _d.activeTexture(_k._TEXTURES[_e[0]]),_c?_E.bindTexture(_d,34067,_c):_E.bindTexture(_d,34067,SolidColorTextureCube.grayTexture.source),0;if(7<this._curActTexIndex)throw new Error("Shader3D: shader support textures max count is 8,can't large than it.");return _e[0]=this._curActTexIndex,_d.uniform1i(_a.location,this._curActTexIndex),_d.activeTexture(_k._TEXTURES[this._curActTexIndex]),_c?_E.bindTexture(_d,34067,_c):_E.bindTexture(_d,34067,SolidColorTextureCube.grayTexture.source),this._curActTexIndex++,1},_b._noSetValue=function(_a){console.log("no....:"+_a.name)},_b.bind=function(){return _c.activeShader=this,(_c.bindShader=this).activeResource(),_E.UseProgram(this._program)},_b.uploadAttributes=function(_a,_b){for(var _c,_d,_e=0,_f=0,_g=this._attributeParamsMap.length;_f<_g;_f+=2)_d=this._attributeParamsMap[_f+1],null!=(_c=_a[this._attributeParamsMap[_f]])&&(_b&&_b[_d.name]&&_b[_d.name].bind(),_e+=_d.fun.call(this,_d,_c));_y.shaderCall+=_e},_b.uploadAttributesX=function(_a,_b){for(var _c,_d,_e=0,_f=0,_g=this._attributeParamsMap.length;_f<_g;_f+=2)_d=this._attributeParamsMap[_f+1],null!=(_c=_a[this._attributeParamsMap[_f]])&&(_b._bind(),_e+=_d.fun.call(this,_d,_c));_y.shaderCall+=_e},_b.uploadSceneUniforms=function(_a){for(var _b,_c,_d=0,_e=0,_f=this._sceneUniformParamsMap.length;_e<_f;_e+=2)_c=this._sceneUniformParamsMap[_e+1],null!=(_b=_a[this._sceneUniformParamsMap[_e]])&&(_d+=_c.fun.call(this,_c,_b));_y.shaderCall+=_d},_b.uploadCameraUniforms=function(_a){for(var _b,_c,_d=0,_e=0,_f=this._cameraUniformParamsMap.length;_e<_f;_e+=2)_c=this._cameraUniformParamsMap[_e+1],null!=(_b=_a[this._cameraUniformParamsMap[_e]])&&(_d+=_c.fun.call(this,_c,_b));_y.shaderCall+=_d},_b.uploadSpriteUniforms=function(_a){for(var _b,_c,_d=0,_e=0,_f=this._spriteUniformParamsMap.length;_e<_f;_e+=2)_c=this._spriteUniformParamsMap[_e+1],null!=(_b=_a[this._spriteUniformParamsMap[_e]])&&(_d+=_c.fun.call(this,_c,_b));_y.shaderCall+=_d},_b.uploadMaterialUniforms=function(_a){for(var _b,_c,_d=0,_e=0,_f=this._materialUniformParamsMap.length;_e<_f;_e+=2)_c=this._materialUniformParamsMap[_e+1],null!=(_b=_a[this._materialUniformParamsMap[_e]])&&(_d+=_c.fun.call(this,_c,_b));_y.shaderCall+=_d},_b.uploadRenderElementUniforms=function(_a){for(var _b,_c,_d=0,_e=0,_f=this._renderElementUniformParamsMap.length;_e<_f;_e+=2)_c=this._renderElementUniformParamsMap[_e+1],null!=(_b=_a[this._renderElementUniformParamsMap[_e]])&&(_d+=_c.fun.call(this,_c,_b));_y.shaderCall+=_d},_k.create=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return new _k(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j)},_k.addInclude=function(_a,_b){_t.addInclude(_a,_b)},_k._createShader=function(_a,_b,_c){var _d=_a.createShader(_c);if(_a.shaderSource(_d,_b),_a.compileShader(_d),_yb.debugMode&&!_a.getShaderParameter(_d,35713))throw _a.getShaderInfoLog(_d);return _d},_k.PERIOD_RENDERELEMENT=0,_k.PERIOD_MATERIAL=1,_k.PERIOD_SPRITE=2,_k.PERIOD_CAMERA=3,_k.PERIOD_SCENE=4,_k._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,33991],_k._count=0,_k._preCompile=!1,_k.extCompileFunc=null,_k.extCompileObj=null,_l(_k,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new _z}]),_k}(),_Kb=function(_h){function _i(){this._transformUV=null,_i.__super.call(this),this.setShaderName("SIMPLE"),this._setColor(9,new _gb(.6,.6,.6)),this._setColor(10,new _gb(1,1,1)),this._setColor(11,new _hb(1,1,1,8)),this._setColor(12,new _gb(1,1,1)),this._setColor(7,new _hb(1,1,1,1)),this._setNumber(0,.5),this._setColor(15,new _hb(1,1,0,0)),this.renderMode=1}_n(_i,"laya.d3.core.material.StandardMaterial",_h);var _a=_i.prototype;return _a.disableLight=function(){this._addDisablePublicShaderDefine(_yb.SHADERDEFINE_POINTLIGHT|_yb.SHADERDEFINE_SPOTLIGHT|_yb.SHADERDEFINE_DIRECTIONLIGHT)},_a.disableFog=function(){this._addDisablePublicShaderDefine(_yb.SHADERDEFINE_FOG)},_a.onAsynLoaded=function(_a,_b,_c){var _d=_b[0];if(_d.version)_h.prototype.onAsynLoaded.call(this,_a,_b,_c);else{var _e=_b[1],_f=_d.props;for(var _g in _f)this[_g]=_f[_g];_i._parseStandardMaterial(_e,this,_d),this._endLoaded()}},_a.cloneTo=function(_a){_h.prototype.cloneTo.call(this,_a);var _b=_a;this._transformUV&&(_b._transformUV=this._transformUV.clone())},_o(0,_a,"ambientColor",function(){return this._getColor(9)},function(_a){this._setColor(9,_a)}),_o(0,_a,"ambientTexture",function(){return this._getTexture(5)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_AMBIENTMAP),this._setTexture(5,_a)}),_o(0,_a,"renderMode",null,function(_a){switch(_a){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 2:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 3:this.depthWrite=!0,this.cull=2,this.blend=0,this.renderQueue=2e3,this.alphaTest=!0,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 4:this.renderQueue=2e3,this.depthWrite=!0,this.cull=0,this.blend=0,this.alphaTest=!0,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 13:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 14:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 15:this.renderQueue=3e3,this.depthWrite=!0,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 16:this.renderQueue=3e3,this.depthWrite=!0,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 5:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 6:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 7:this.renderQueue=3e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 8:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 9:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 10:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=771,this.alphaTest=!1,this._removeShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 11:this.renderQueue=3e3,this.depthTest=513,this.cull=2,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;case 12:this.renderQueue=3e3,this.depthTest=513,this.cull=0,this.blend=1,this.srcBlend=770,this.dstBlend=1,this.alphaTest=!1,this._addShaderDefine(_i.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("Material:renderMode value error.")}this._conchMaterial&&this._conchMaterial.setRenderMode(_a)}),_o(0,_a,"reflectColor",function(){return this._getColor(12)},function(_a){this._setColor(12,_a)}),_o(0,_a,"tilingOffset",function(){return this._getColor(15)},function(_a){if(_a){var _b=_a.elements;1!=_b[0]||1!=_b[1]||0!=_b[2]||0!=_b[3]?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET)}else this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_TILINGOFFSET);this._setColor(15,_a)}),_o(0,_a,"albedo",function(){return this._getColor(7)},function(_a){this._setColor(7,_a)}),_o(0,_a,"diffuseColor",function(){return this._getColor(10)},function(_a){this._setColor(10,_a)}),_o(0,_a,"albedoColor",function(){return this._getColor(7)},function(_a){this._setColor(7,_a)}),_o(0,_a,"specularColor",function(){return this._getColor(11)},function(_a){this._setColor(11,_a)}),_o(0,_a,"diffuseTexture",function(){return this._getTexture(1)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_DIFFUSEMAP),this._setTexture(1,_a)}),_o(0,_a,"normalTexture",function(){return this._getTexture(2)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_NORMALMAP),this._setTexture(2,_a)}),_o(0,_a,"specularTexture",function(){return this._getTexture(3)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_SPECULARMAP),this._setTexture(3,_a)}),_o(0,_a,"emissiveTexture",function(){return this._getTexture(4)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_EMISSIVEMAP),this._setTexture(4,_a)}),_o(0,_a,"reflectTexture",function(){return this._getTexture(6)},function(_a){_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_REFLECTMAP),this._setTexture(6,_a)}),_o(0,_a,"transformUV",function(){return this._transformUV},function(_a){this._transformUV=_a,this._setMatrix4x4(13,_a.matrix),_a?this._addShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM):this._removeShaderDefine(laya.d3.core.material.StandardMaterial.SHADERDEFINE_UVTRANSFORM),this._conchMaterial&&this._conchMaterial.setShaderValue(13,_a.matrix.elements,0)}),_i.__init__=function(){_i.SHADERDEFINE_DIFFUSEMAP=_i.shaderDefines.registerDefine("DIFFUSEMAP"),_i.SHADERDEFINE_NORMALMAP=_i.shaderDefines.registerDefine("NORMALMAP"),_i.SHADERDEFINE_SPECULARMAP=_i.shaderDefines.registerDefine("SPECULARMAP"),_i.SHADERDEFINE_EMISSIVEMAP=_i.shaderDefines.registerDefine("EMISSIVEMAP"),_i.SHADERDEFINE_AMBIENTMAP=_i.shaderDefines.registerDefine("AMBIENTMAP"),_i.SHADERDEFINE_REFLECTMAP=_i.shaderDefines.registerDefine("REFLECTMAP"),_i.SHADERDEFINE_UVTRANSFORM=_i.shaderDefines.registerDefine("UVTRANSFORM"),_i.SHADERDEFINE_TILINGOFFSET=_i.shaderDefines.registerDefine("TILINGOFFSET"),_i.SHADERDEFINE_ADDTIVEFOG=_i.shaderDefines.registerDefine("ADDTIVEFOG")},_i.load=function(_a){return _v.loader.create(_a,null,null,_i)},_i._parseStandardMaterial=function(_a,_b,_c){var _d=_c.customProps,_e=_d.ambientColor;_b.ambientColor=new _gb(_e[0],_e[1],_e[2]);var _f=_d.diffuseColor;_b.diffuseColor=new _gb(_f[0],_f[1],_f[2]);var _g=_d.specularColor;_b.specularColor=new _hb(_g[0],_g[1],_g[2],_g[3]);var _h=_d.reflectColor;_b.reflectColor=new _gb(_h[0],_h[1],_h[2]);var _i=_d.albedoColor;_i&&(_b.albedo=new _hb(_i[0],_i[1],_i[2],_i[3]));var _j=_d.diffuseTexture.texture2D;_j&&(_b.diffuseTexture=_r.getRes(_a[_j]));var _k=_d.normalTexture.texture2D;_k&&(_b.normalTexture=_r.getRes(_a[_k]));var _l=_d.specularTexture.texture2D;_l&&(_b.specularTexture=_r.getRes(_a[_l]));var _m=_d.emissiveTexture.texture2D;_m&&(_b.emissiveTexture=_r.getRes(_a[_m]));var _n=_d.ambientTexture.texture2D;_n&&(_b.ambientTexture=_r.getRes(_a[_n]));var _o=_d.reflectTexture.texture2D;_o&&(_b.reflectTexture=_r.getRes(_a[_o]))},_i.RENDERMODE_OPAQUE=1,_i.RENDERMODE_OPAQUEDOUBLEFACE=2,_i.RENDERMODE_CUTOUT=3,_i.RENDERMODE_CUTOUTDOUBLEFACE=4,_i.RENDERMODE_TRANSPARENT=13,_i.RENDERMODE_TRANSPARENTDOUBLEFACE=14,_i.RENDERMODE_ADDTIVE=15,_i.RENDERMODE_ADDTIVEDOUBLEFACE=16,_i.RENDERMODE_DEPTHREAD_TRANSPARENT=5,_i.RENDERMODE_DEPTHREAD_TRANSPARENTDOUBLEFACE=6,_i.RENDERMODE_DEPTHREAD_ADDTIVE=7,_i.RENDERMODE_DEPTHREAD_ADDTIVEDOUBLEFACE=8,_i.RENDERMODE_NONDEPTH_TRANSPARENT=9,_i.RENDERMODE_NONDEPTH_TRANSPARENTDOUBLEFACE=10,_i.RENDERMODE_NONDEPTH_ADDTIVE=11,_i.RENDERMODE_NONDEPTH_ADDTIVEDOUBLEFACE=12,_i.SHADERDEFINE_DIFFUSEMAP=0,_i.SHADERDEFINE_NORMALMAP=0,_i.SHADERDEFINE_SPECULARMAP=0,_i.SHADERDEFINE_EMISSIVEMAP=0,_i.SHADERDEFINE_AMBIENTMAP=0,_i.SHADERDEFINE_REFLECTMAP=0,_i.SHADERDEFINE_UVTRANSFORM=0,_i.SHADERDEFINE_TILINGOFFSET=0,_i.SHADERDEFINE_ADDTIVEFOG=0,_i.DIFFUSETEXTURE=1,_i.NORMALTEXTURE=2,_i.SPECULARTEXTURE=3,_i.EMISSIVETEXTURE=4,_i.AMBIENTTEXTURE=5,_i.REFLECTTEXTURE=6,_i.ALBEDO=7,_i.UVANIAGE=8,_i.MATERIALAMBIENT=9,_i.MATERIALDIFFUSE=10,_i.MATERIALSPECULAR=11,_i.MATERIALREFLECT=12,_i.UVMATRIX=13,_i.UVAGE=14,_i.TILINGOFFSET=15,_l(_i,["defaultMaterial",function(){var _a=new _i;return _a.lock=!0,this.defaultMaterial=_a},"shaderDefines",function(){return this.shaderDefines=new _kb(_Cb.shaderDefines)}]),_i}(_Cb),_Lb=function(_a){function _g(_a,_b,_c,_d,_e){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===_c&&(_c=35044),void 0===_d&&(_d=!1),_g.__super.call(this),this._indexType=_a,this._indexCount=_b,this._bufferUsage=_c,this._bufferType=34963,this._canRead=_d;var _f;if("ushort"==_a)this._indexTypeByteCount=2;else{if("ubyte"!=_a)throw new Error("unidentification index type.");this._indexTypeByteCount=1}_f=this._indexTypeByteCount*_b,this._byteLength=_f,this._bind(),_h._gl.bufferData(this._bufferType,_f,this._bufferUsage),this.uri=_e,_d?("ushort"==_a?this._buffer=new Uint16Array(_b):"ubyte"==_a&&(this._buffer=new Uint8Array(_b)),this.memorySize=2*_f):this.memorySize=_f}_n(_g,"laya.d3.graphics.IndexBuffer3D",_a);var _b=_g.prototype;return _b.setData=function(_a,_b,_c,_d){void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=4294967295);var _e=0;if("ushort"==this._indexType?(_e=2,0===_c&&4294967295===_d||(_a=new Uint16Array(_a.buffer,_c*_e,_d))):"ubyte"==this._indexType&&(_e=1,0===_c&&4294967295===_d||(_a=new Uint8Array(_a.buffer,_c*_e,_d))),this._bind(),_h._gl.bufferSubData(this._bufferType,_b*_e,_a),this._canRead)if(0!==_b||0!==_c||4294967295!==_d){var _f=this._buffer.length-_b;_f<_d&&(_d=_f);for(var _g=0;_g<_d;_g++)this._buffer[_b+_g]=_a[_g]}else this._buffer=_a},_b.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},_b.disposeResource=function(){_a.prototype.disposeResource.call(this),this._buffer=null,this.memorySize=0},_o(0,_b,"indexType",function(){return this._indexType}),_o(0,_b,"indexTypeByteCount",function(){return this._indexTypeByteCount}),_o(0,_b,"indexCount",function(){return this._indexCount}),_o(0,_b,"canRead",function(){return this._canRead}),_g.INDEXTYPE_UBYTE="ubyte",_g.INDEXTYPE_USHORT="ushort",_g.create=function(_a,_b,_c,_d,_e){return void 0===_c&&(_c=35044),void 0===_d&&(_d=!1),new _g(_a,_b,_c,_d,_e)},_g}(_h),_Mb=function(_f){function _g(_a,_b,_c,_d,_e){this._vertexDeclaration=null,this._vertexCount=0,this._canRead=!1,void 0===_d&&(_d=!1),_g.__super.call(this),this._vertexDeclaration=_a,this._vertexCount=_b,this._bufferUsage=_c,this._bufferType=34962,this._canRead=_d,this.uri=_e,this.memorySize=this._byteLength=this._vertexDeclaration.vertexStride*_b,this._bind(),_h._gl.bufferData(this._bufferType,this._byteLength,this._bufferUsage),_d&&(this._buffer=new Float32Array(this._byteLength/4))}_n(_g,"laya.d3.graphics.VertexBuffer3D",_f);var _a=_g.prototype;return _a.bindWithIndexBuffer=function(_a){_a&&_a._bind(),this._bind()},_a.setData=function(_a,_b,_c,_d){if(void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=4294967295),0===_c&&4294967295===_d||(_a=new Float32Array(_a.buffer,4*_c,_d)),this._bind(),_h._gl.bufferSubData(this._bufferType,4*_b,_a),this._canRead)if(0!==_b||0!==_c||4294967295!==_d){var _e=this._buffer.length-_b;_e<_d&&(_d=_e);for(var _f=0;_f<_d;_f++)this._buffer[_b+_f]=_a[_f]}else this._buffer=_a},_a.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},_a.disposeResource=function(){for(var _a=_D.mainContext,_b=this._vertexDeclaration.getVertexElements(),_c=_h._enableAtributes,_d=0,_e=_b.length;_d<_e;_d++)_c[_d]===this._glBuffer&&(_a.disableVertexAttribArray(_d),_c[_d]=null);_f.prototype.disposeResource.call(this),this._buffer=null,this._vertexDeclaration=null,this.memorySize=0},_o(0,_a,"vertexDeclaration",function(){return this._vertexDeclaration}),_o(0,_a,"vertexCount",function(){return this._vertexCount}),_o(0,_a,"canRead",function(){return this._canRead}),_g.create=function(_a,_b,_c,_d,_e){return void 0===_c&&(_c=35044),void 0===_d&&(_d=!1),new _g(_a,_b,_c,_d,_e)},_g}(_h),_Nb=function(_a){function _t(){this.simLodInfo=null,this._src=null,this._buffer=null,this._image=null,this._mipmaps=null,this._recreateLock=!1,this._needReleaseAgain=!1,_t.__super.call(this),this._type=3553}_n(_t,"laya.d3.resource.DataTexture2D",_Db);var _b=_t.prototype;return _b.genDebugMipmaps=function(){var _a=[];return _a.push(new Uint8Array(new Uint32Array(131072).fill(4278190335).buffer)),_a.push(new Uint8Array(new Uint32Array(32768).fill(4278223103).buffer)),_a.push(new Uint8Array(new Uint32Array(8192).fill(4278255615).buffer)),_a.push(new Uint8Array(new Uint32Array(2048).fill(4278255360).buffer)),_a.push(new Uint8Array(new Uint32Array(512).fill(4286595072).buffer)),_a.push(new Uint8Array(new Uint32Array(128).fill(4294901760).buffer)),_a.push(new Uint8Array(new Uint32Array(32).fill(4294901888).buffer)),_a.push(new Uint8Array(new Uint32Array(8).fill(0).buffer)),_a.push(new Uint8Array(new Uint32Array(2).fill(4286611584).buffer)),_a.push(new Uint8Array(new Uint32Array(1).fill(4294967295).buffer)),_a},_b._onTextureLoaded=function(_a){},_b._createWebGlTexture=function(){if(!this._buffer&&!this._image&&!this._mipmaps)throw"create GLTextur err:no data";var _a=_D.mainContext,_b=this._source=_a.createTexture(),_c=this._width,_d=this._height,_e=_E.curBindTexTarget,_f=_E.curBindTexValue,_g=!1;if(_E.bindTexture(_a,this._type,_b),this._mipmaps){if(laya.d3.resource.DataTexture2D.lodasatlas){var _h=0;_a.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null);for(var _i=0;_i<this._mipmaps.length;_i++){if(this._mipmaps[_i].byteLength!=_j*_k*4)throw"mipmap size error  level:"+_i;_a.texSubImage2D(this._type,0,_t.simLodRect[_h++],_t.simLodRect[_h++],_t.simLodRect[_h++],_t.simLodRect[_h++],6408,5121,new Uint8Array(this._mipmaps[_i]))}this.minFifter=9729,this.magFifter=9729}else{var _j=this._width,_k=this._height;for(_h=0,_a.texImage2D(this._type,0,6408,this._width,this._height,0,6408,5121,null),_i=0;_i<this._mipmaps.length;_i++){if(this._mipmaps[_i].byteLength!=_j*_k*4)throw"mipmap size error  level:"+_i;_a.texImage2D(this._type,_i,6408,_j,_k,0,6408,5121,new Uint8Array(this._mipmaps[_i])),(_j/=2)<1&&(_j=1),(_k/=2)<1&&(_k=1),this.minFifter=9987,this.magFifter=9729}}this.mipmap=!1}else if(this._image)6407==this._format&&_a.pixelStorei(_a.UNPACK_ALIGNMENT,1),_a.texImage2D(this._type,0,this._format,this._format,5121,this._image);else if(this._buffer){var _l=0,_m=!1,_n=!1;this._buffer.byteLength==4*_c*_d?(_l=6408,_m=!0):this._buffer.byteLength==3*_c*_d?(_l=6407,_n=!0):_l=this._format,_m||_n?(this._buffer instanceof Uint8Array||(this._buffer=new Uint8Array(this._buffer)),_n&&_a.pixelStorei(_a.UNPACK_ALIGNMENT,1),_a.texImage2D(this._type,0,_l,_c,_d,0,_l,5121,this._buffer)):_a&&_l==_a.ALPHA?(_a.texImage2D(3553,0,_l,_c,_d,0,_l,_a.UNSIGNED_BYTE,this._buffer),_g=!0):0!=_l&&(_a.compressedTexImage2D(3553,0,_l,_c,_d,0,this._buffer),_g=!0)}var _o=this._minFifter,_p=this._magFifter,_q=0==this._wrapModeU?10497:33071,_r=0==this._wrapModeV?10497:33071,_s=_u.isPOT(_c,_d);_s?(this._mipmap||this._mipmaps?-1!==_o||(_o=9987):-1!==_o||(_o=9729),-1!==_p||(_p=9729),_a.texParameteri(this._type,10241,_o),_a.texParameteri(this._type,10240,_p),_a.texParameteri(this._type,10242,_q),_a.texParameteri(this._type,10243,_r),this._mipmap&&_a.generateMipmap(this._type)):(-1!==_o||(_o=9729),-1!==_p||(_p=9729),_a.texParameteri(this._type,10241,_o),_a.texParameteri(this._type,10240,_p),_a.texParameteri(this._type,10242,33071),_a.texParameteri(this._type,10243,33071)),_e&&_f&&_E.bindTexture(_a,_e,_f),this.memorySize=_g?this._buffer.length:_s?_c*_d*4*(1+1/3):_c*_d*4,this.src&&0<this.src.length&&(this._buffer=null,this._image=null),this._recreateLock=!1},_b.recreateResource=function(){if(this._buffer||this._image||null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,this._buffer||this._image||this._mipmaps){if(this._recreateLock)return;this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0}},_b.onAsynLoaded=function(_a,_b,_c){var _d;_c&&(_d=_c[0].call(this,_b)),_d&&(this._width=_d.width,this._height=_d.height,this._buffer=_d.data),this._src=_a,this._size=new _pb(this._width,this._height),this._conchTexture?alert("怎么给runtime传递datatexture数据"):this.activeResource(),this._endLoaded()},_b.getPixels=function(){return new Uint8Array(this._buffer)},_b.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(_D.mainContext.deleteTexture(this._source),this._source=null,this._buffer=null,this._image=null,this.memorySize=0)},_o(0,_b,"src",function(){return this._src}),_t.create=function(_a,_b,_c,_d,_e,_f,_g){if(void 0===_d&&(_d=9729),void 0===_e&&(_e=9729),void 0===_f&&(_f=!0),!_a||_a.byteLength<_b*_c*4)throw"DataTexture2D create error";var _h=new _t;return _h.uri=_g,_h._buffer=_a,_h._width=_b,_h._height=_c,_h._mipmap=_f,_h._magFifter=_d,_h._minFifter=_e,_h._size=new _pb(_h._width,_h._height),_h._conchTexture?alert("怎么给runtime传递datatexture数据"):_h.activeResource(),_h},_t.load=function(_a,_b,_c,_d,_e){if(void 0===_b&&(_b=0),void 0===_c&&(_c=0),void 0===_d&&(_d=9729),void 0===_e&&(_e=9729),"mipmaps"===_A.getFileExtension(_a)){var _f=_v.loader.create(_a,null,null,_t,[function(_a){this._mipmaps=[];var _b=new Uint32Array(_a);this._width=_b[0];var _c=512;if(laya.d3.resource.DataTexture2D.lodasatlas&&(this._width*=2,_c=1024),this._width!=_c)throw"现在只支持512x256的环境贴图。当前的是"+_b[0];this._height=_b[1];for(var _d=laya.d3.resource.DataTexture2D.lodasatlas?this._width/2:this._width,_e=this._height,_f=8;;){var _g=_d*_e*4;if(_f+_g>_a.byteLength)throw"load mipmaps data size error ";var _h=new Uint8Array(_a,_f,_g);if(this._mipmaps.push(_h),_f+=_g,1==_d&&1==_e)break;(_d/=2)<1&&(_d=1),(_e/=2)<1&&(_e=1)}return null}]);if(laya.d3.resource.DataTexture2D.lodasatlas){_f.simLodInfo=new Float32Array(40);for(var _g=0;_g<_f.simLodInfo.length;)_f.simLodInfo[_g]=(_t.simLodRect[_g]+.5)/1024,_g++,_f.simLodInfo[_g]=(_t.simLodRect[_g]+.5)/256,_g++,_f.simLodInfo[_g]=Math.max(_t.simLodRect[_g]-1,.1)/1024,_g++,_f.simLodInfo[_g]=Math.max(_t.simLodRect[_g]-1.5,.1)/256,_g++}return _f}if("number"==typeof _b)return _v.loader.create(_a,null,null,_t,[function(_a){return this._width=_b,this._height=_c,this._buffer=_a,null}]);if("function"==typeof _b)return _v.loader.create(_a,null,null,_t,[_b]);throw new Error("unknown params.")},_t.lodasatlas=!1,_l(_t,["simLodRect",function(){return this.simLodRect=new Uint32Array([0,0,512,256,512,0,256,128,768,0,128,64,896,0,64,32,960,0,32,16,992,0,16,8,1008,0,8,4,1016,0,4,2,1020,0,2,1,1022,0,1,1])}]),_t}(),_Ob=function(_a){function _b(){this._numberVertices=0,this._numberIndices=0,this._vertexBuffer=null,this._indexBuffer=null,_b.__super.call(this)}_n(_b,"laya.d3.resource.models.PrimitiveMesh",_Eb);var _c=_b.prototype;return _v.imps(_c,{"laya.d3.core.render.IRenderable":!0}),_c._getVertexBuffer=function(_a){return void 0===_a&&(_a=0),0===_a?this._vertexBuffer:null},_c._getVertexBuffers=function(){return null},_c._getIndexBuffer=function(){return this._indexBuffer},_c._getPositions=function(){var _a,_b=[],_c=this._vertexBuffer.vertexDeclaration.getVertexElements(),_d=0;for(_d=0;_d<_c.length;_d++){var _e=_c[_d];if("vector3"===_e.elementFormat&&0===_e.elementUsage){_a=_e;break}}var _f=this._vertexBuffer.getData();for(_d=0;_d<_f.length;_d+=this._vertexBuffer.vertexDeclaration.vertexStride/4){var _g=_d+_a.offset/4,_h=new _gb(_f[_g+0],_f[_g+1],_f[_g+2]);_b.push(_h)}return _b},_c.getRenderElement=function(_a){return this},_c.getRenderElementsCount=function(){return 1},_c.disposeResource=function(){this._vertexBuffer&&(this._vertexBuffer._removeReference(),this._vertexBuffer=null),this._indexBuffer&&(this._indexBuffer._removeReference(),this._indexBuffer=null),this.memorySize=0},_c._beforeRender=function(_a){return this._vertexBuffer._bind(),this._indexBuffer._bind(),!0},_c._render=function(_a){_D.mainContext.drawElements(4,this._numberIndices,5123,0),_y.drawCall++,_y.trianglesFaces+=this._numberIndices/3},_o(0,_c,"_vertexBufferCount",function(){return 1}),_o(0,_c,"triangleCount",function(){return this._indexBuffer.indexCount/3}),_b}(),_Pb=function(_a){function _b(){this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._skinnedDatas=null,_b.__super.call(this),this._subMeshes=[],this._materials=[],this._vertexBuffers=[]}_n(_b,"laya.d3.resource.models.Mesh",_Eb);var _c=_b.prototype;return _c._getPositions=function(){var _a,_b,_c,_d,_e,_f=[],_g=0,_h=0,_i=0;if(0!==this._vertexBuffers.length){var _j=this._vertexBuffers.length;for(_g=0;_g<_j;_g++){for(_c=(_a=this._vertexBuffers[_g]).vertexDeclaration.getVertexElements(),_h=0;_h<_c.length;_h++)if("vector3"===(_d=_c[_h]).elementFormat&&0===_d.elementUsage){_b=_d;break}for(_e=_a.getData(),_h=0;_h<_e.length;_h+=_a.vertexDeclaration.vertexStride/4)_i=_h+_b.offset/4,_f.push(new _gb(_e[_i+0],_e[_i+1],_e[_i+2]))}}else{var _k=this._subMeshes.length;for(_g=0;_g<_k;_g++){for(_c=(_a=this._subMeshes[_g]._getVertexBuffer()).vertexDeclaration.getVertexElements(),_h=0;_h<_c.length;_h++)if("vector3"===(_d=_c[_h]).elementFormat&&0===_d.elementUsage){_b=_d;break}for(_e=_a.getData(),_h=0;_h<_e.length;_h+=_a.vertexDeclaration.vertexStride/4)_i=_h+_b.offset/4,_f.push(new _gb(_e[_i+0],_e[_i+1],_e[_i+2]))}}return _f},_c._setSubMeshes=function(_a){this._subMeshes=_a,this._subMeshCount=_a.length;for(var _b=0;_b<this._subMeshCount;_b++)_a[_b]._indexInMesh=_b;this._positions=this._getPositions(),this._generateBoundingObject()},_c.onAsynLoaded=function(_a,_b,_c){var _d=_b[0],_e=_b[1];_Wa.read(_d,this,this._materials,this._subMeshes,_e),this.completeCreate(),this._endLoaded()},_c.getSubMesh=function(_a){return this._subMeshes[_a]},_c.getSubMeshCount=function(){return this._subMeshes.length},_c.getRenderElementsCount=function(){return this._subMeshes.length},_c.getRenderElement=function(_a){return this._subMeshes[_a]},_c.disposeResource=function(){for(var _a=0;_a<this._subMeshes.length;_a++)this._subMeshes[_a].dispose();this._materials=null,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},_o(0,_c,"materials",function(){return this._materials.slice()}),_o(0,_c,"InverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),_b.load=function(_a){return _v.loader.create(_a,null,null,_b)},_b}(),_Qb=(function(_a){function _j(_a,_b,_c,_d,_e,_f,_g,_h,_i){this._alreadyResolved=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._frameBuffer=null,this._depthStencilBuffer=null,void 0===_c&&(_c=6408),void 0===_d&&(_d=5121),void 0===_e&&(_e=33189),void 0===_f&&(_f=!1),void 0===_g&&(_g=!1),void 0===_h&&(_h=-1),void 0===_i&&(_i=-1),_j.__super.call(this),this._type=3553,this._width=_a,this._height=_b,this._size=new _pb(_a,_b),this._surfaceFormat=_c,this._surfaceType=_d,this._depthStencilFormat=_e,_p.isConchWebGL&&34041===this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipmap=_f,this._repeat=_g,this._minFifter=_h,this._magFifter=_i,this.activeResource(),this._alreadyResolved=!0}_n(_j,"laya.d3.resource.RenderTexture",_Db);var _b=_j.prototype;_b.recreateResource=function(){var _a=_D.mainContext;this._frameBuffer=_a.createFramebuffer(),this._source=_a.createTexture();var _b=_E.curBindTexTarget,_c=_E.curBindTexValue;_E.bindTexture(_a,this._type,this._source),_a.texImage2D(this._type,0,6408,this._width,this._height,0,this._surfaceFormat,this._surfaceType,null);var _d=this._minFifter,_e=this._magFifter,_f=this._repeat?10497:33071;if(_u.isPOT(this._width,this._height)?(this._mipmap?-1!==_d||(_d=9987):-1!==_d||(_d=9729),-1!==_e||(_e=9729),_a.texParameteri(this._type,10241,_d),_a.texParameteri(this._type,10240,_e),_a.texParameteri(this._type,10242,_f),_a.texParameteri(this._type,10243,_f),this._mipmap&&_a.generateMipmap(this._type)):(-1!==_d||(_d=9729),-1!==_e||(_e=9729),_a.texParameteri(this._type,10241,_d),_a.texParameteri(this._type,10240,_e),_a.texParameteri(this._type,10242,33071),_a.texParameteri(this._type,10243,33071)),_b&&_c&&_E.bindTexture(_a,_b,_c),_a.bindFramebuffer(36160,this._frameBuffer),this._depthStencilFormat)switch(this._depthStencilBuffer=_a.createRenderbuffer(),_a.bindRenderbuffer(36161,this._depthStencilBuffer),_a.renderbufferStorage(36161,this._depthStencilFormat,this._width,this._height),_a.bindRenderbuffer(36161,null),this._depthStencilFormat){case 33189:_a.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:_a.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:_a.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}_a.framebufferTexture2D(36160,36064,3553,this._source,0),_a.bindFramebuffer(36160,null),this.memorySize=this._width*this._height*4,this.completeCreate()},_b.start=function(){_D.mainContext.bindFramebuffer(36160,this.frameBuffer),(_j._currentRenderTarget=this)._alreadyResolved=!1},_b.end=function(){_D.mainContext.bindFramebuffer(36160,null),_j._currentRenderTarget=null,this._alreadyResolved=!0},_b.getData=function(_a,_b,_c,_d){var _e=_D.mainContext;if(_e.bindFramebuffer(36160,this._frameBuffer),!(36053===_e.checkFramebufferStatus(36160)))return _e.bindFramebuffer(36160,null),null;var _f=new Uint8Array(this._width*this._height*4);return _e.readPixels(_a,_b,_c,_d,this._surfaceFormat,this._surfaceType,_f),_e.bindFramebuffer(36160,null),_f},_b.disposeResource=function(){if(this._frameBuffer){var _a=_D.mainContext;_a.deleteTexture(this._source),_a.deleteFramebuffer(this._frameBuffer),_a.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0}},_o(0,_b,"surfaceFormat",function(){return this._surfaceFormat}),_o(0,_b,"surfaceType",function(){return this._surfaceType}),_o(0,_b,"depthStencilFormat",function(){return this._depthStencilFormat}),_o(0,_b,"source",function(){return this._alreadyResolved?_v.superGet(_Db,this,"source"):null}),_o(0,_b,"depthStencilBuffer",function(){return this._depthStencilBuffer}),_o(0,_b,"frameBuffer",function(){return this._frameBuffer}),_j._currentRenderTarget=null}(),function(_a){function _b(_a){this._color=null,this._pixels=null,_b.__super.call(this),this._type=3553,this._width=1,this._height=1,this._size=new _pb(this.width,this.height),this._color=_a,this._pixels=new Uint8Array([255*_a.x,255*_a.y,255*_a.z,255*_a.w]),this.uri="SolidColorTexture2D_"+this.id}_n(_b,"laya.d3.resource.SolidColorTexture2D",_Db);var _c=_b.prototype;return _c._createWebGlTexture=function(){var _a=_D.mainContext,_b=this._source=_a.createTexture(),_c=this._width,_d=this._height,_e=_E.curBindTexTarget,_f=_E.curBindTexValue;_E.bindTexture(_a,this._type,_b),_a.texImage2D(this._type,0,6408,_c,_d,0,6408,5121,this._pixels);var _g=this._minFifter,_h=this._magFifter,_i=this._repeat?10497:33071,_j=_u.isPOT(_c,_d);_j?(this._mipmap?-1!==_g||(_g=9987):-1!==_g||(_g=9729),-1!==_h||(_h=9729),_a.texParameteri(this._type,10241,_g),_a.texParameteri(this._type,10240,_h),_a.texParameteri(this._type,10242,_i),_a.texParameteri(this._type,10243,_i),this._mipmap&&_a.generateMipmap(this._type)):(-1!==_g||(_g=9729),-1!==_h||(_h=9729),_a.texParameteri(this._type,10241,_g),_a.texParameteri(this._type,10240,_h),_a.texParameteri(this._type,10242,33071),_a.texParameteri(this._type,10243,33071)),_e&&_f&&_E.bindTexture(_a,_e,_f),this.memorySize=_j?_c*_d*4*(1+1/3):_c*_d*4},_c.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},_c.disposeResource=function(){this._source&&(_D.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},_l(_b,["magentaTexture",function(){var _a=new _b(new _hb(1,0,1,1));return _a.lock=!0,this.magentaTexture=_a},"grayTexture",function(){var _a=new _b(new _hb(.5,.5,.5,1));return _a.lock=!0,this.grayTexture=_a}]),_b}()),_Rb=function(_a){function _e(_a,_b,_c,_d){this._canRead=!1,this._image=null,this._pixels=null,void 0===_a&&(_a=!1),void 0===_b&&(_b=!0),void 0===_c&&(_c=6408),void 0===_d&&(_d=!0),_e.__super.call(this),this._type=3553,this._repeat=_b,this._canRead=_a,this._format=_c,this._mipmap=_d}_n(_e,"laya.d3.resource.Texture2D",_Db);var _b=_e.prototype;return _b._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var _a=_D.mainContext,_b=this._source=_a.createTexture(),_c=this._width,_d=this._height,_e=_E.curBindTexTarget,_f=_E.curBindTexValue;switch(_E.bindTexture(_a,this._type,_b),this._format){case 6407:case 6408:this._canRead?_a.texImage2D(this._type,0,this._format,_c,_d,0,this._format,5121,this._pixels):this._image instanceof laya.webgl.resource.WebGLImage?_a.texImage2D(this._type,0,this._image._format,_c,_d,0,this._image._format,5121,this._image.atlasSource):_a.texImage2D(this._type,0,this._format,this._format,5121,this._image);break;case _D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:_a.compressedTexImage2D(this._type,0,this._format,this._width,this._height,0,this._image);break;default:console.error("收到其他的纹理类型：",this._format)}var _g=this._minFifter,_h=this._magFifter,_i=this._repeat?10497:33071,_j=0==this._wrapModeU?10497:33071,_k=0==this._wrapModeV?10497:33071,_l=_u.isPOT(_c,_d);_l?(this._mipmap?-1!==_g||(_g=9987):-1!==_g||(_g=9729),-1!==_h||(_h=9729),_a.texParameteri(this._type,10241,_g),_a.texParameteri(this._type,10240,_h),_a.texParameteri(this._type,10242,_i),_a.texParameteri(this._type,10243,_i),_a.texParameteri(this._type,10242,_j),_a.texParameteri(this._type,10243,_k),this._mipmap&&_a.generateMipmap(this._type)):(-1!==_g||(_g=9729),-1!==_h||(_h=9729),_a.texParameteri(this._type,10241,_g),_a.texParameteri(this._type,10240,_h),_a.texParameteri(this._type,10242,33071),_a.texParameteri(this._type,10243,33071)),_e&&_f&&_E.bindTexture(_a,_e,_f),this._image.onload=null,this._image=null,this.memorySize=_l?_c*_d*4*(1+1/3):_c*_d*4},_b.recreateResource=function(){this._createWebGlTexture(),this.completeCreate()},_b.onAsynLoaded=function(_a,_b,_c){if(_c){var _d=_c[0];void 0!==_d&&(this._canRead=_d);var _e=_c[1];void 0!==_e&&(this._repeat=_e);var _f=_c[2];void 0!==_f&&(this._format=_f);var _g=_c[3];void 0!==_g&&(this._mipmap=_g);var _h=_c.wrapModeU;void 0!==_h&&(this._wrapModeU=_h);var _i=_c.wrapModeV;void 0!==_i&&(this._wrapModeV=_i)}switch(this._format){case 6407:case 6408:var _j=(this._image=_b).width,_k=_b.height;this._width=_j,this._height=_k,this._size=new _pb(_j,_k),this._canRead&&(_p.isConchApp?_b instanceof _m.HTMLElement&&(this._pixels=new Uint8Array(_b.getImageData(0,0,_j,_k))):(_F.canvas.size(_j,_k),_F.canvas.clear(),_F.context.drawImage(_b,0,0,_j,_k),this._pixels=new Uint8Array(_F.context.getImageData(0,0,_j,_k).data.buffer)));break;case _D.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:var _l=new _w(_b);_l.readUTFBytes(4),_l.readUTFBytes(2),_l.getInt16();_l.endian="bigEndian",this._width=_l.getInt16(),this._height=_l.getInt16(),this._size=new _pb(this._width,this._height);_l.getInt16(),_l.getInt16();this._image=new Uint8Array(_b,_l.pos)}this.recreateResource(),this._endLoaded()},_b.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},_b.disposeResource=function(){this._source&&(_D.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},_o(0,_b,"_src",function(){return this.url}),_o(0,_b,"src",function(){return this.url}),_e.load=function(_a){return _v.loader.create(_a,null,null,_e)},_e}(),_Sb=function(_b){function _c(_a,_b){_c.__super.call(this),void 0===_a&&(_a=.3),void 0===_b&&(_b=1e3),this._tempVector3=new _gb,this._position=new _gb,this._up=new _gb,this._forward=new _gb,this._right=new _gb,this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._viewportExpressedInClipSpace=!0,this._renderTargetSize=_pb.fullScreen,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=_a,this._farPlane=_b,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),_v.stage.on("resize",this,this._onScreenSizeChanged)}_n(_c,"laya.d3.core.BaseCamera",_b);var _a=_c.prototype;return _a._sortCamerasByRenderingOrder=function(){if(this._displayedInStage)for(var _a=this.scene._cameraPool,_b=_a.length-1,_c=0;_c<_b;_c++)if(_a[_c].renderingOrder>_a[_b].renderingOrder){var _d=_a[_c];_a[_c]=_a[_b],_a[_b]=_d}},_a._calculateProjectionMatrix=function(){},_a._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},_a._prepareCameraToRender=function(){_G._currentCameraCullingMask=this.cullingMask;var _a=this._shaderValues;_a.setValue(0,this.transform.position.elements),_a.setValue(5,this.forward.elements),_a.setValue(6,this.up.elements)},_a._prepareCameraViewProject=function(_a,_b){var _c=this._shaderValues;_c.setValue(1,_a.elements),_c.setValue(2,_b.elements)},_a._renderCamera=function(_a,_b,_c){},_a.addLayer=function(_a){29!==_a.number&&30!=_a.number&&(this.cullingMask=this.cullingMask|_a.mask)},_a.removeLayer=function(_a){29!==_a.number&&30!=_a.number&&(this.cullingMask=this.cullingMask&~_a.mask)},_a.addAllLayers=function(){this.cullingMask=2147483647},_a.removeAllLayers=function(){this.cullingMask=0|_G.getLayerByNumber(29).mask|_G.getLayerByNumber(30).mask},_a.ResetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},_a.moveForward=function(_a){this._tempVector3.elements[0]=this._tempVector3.elements[1]=0,this._tempVector3.elements[2]=_a,this.transform.translate(this._tempVector3)},_a.moveRight=function(_a){this._tempVector3.elements[1]=this._tempVector3.elements[2]=0,this._tempVector3.elements[0]=_a,this.transform.translate(this._tempVector3)},_a.moveVertical=function(_a){this._tempVector3.elements[0]=this._tempVector3.elements[2]=0,this._tempVector3.elements[1]=_a,this.transform.translate(this._tempVector3,!1)},_a._addSelfRenderObjects=function(){var _a=this.scene._cameraPool,_b=_a.length;if(0<_b){for(var _c=_b-1;0<=_c;_c--)if(this.renderingOrder<=_a[_c].renderingOrder){_a.splice(_c+1,0,this);break}}else _a.push(this),this.scene.conchModel&&this.scene.conchModel.setCurrentCamera(this.conchModel)},_a._clearSelfRenderObjects=function(){var _a=this.scene._cameraPool;_a.splice(_a.indexOf(this),1)},_a.destroy=function(_a){void 0===_a&&(_a=!0),this._sky&&this._sky.destroy(),this.renderTarget=null,_v.stage.off("resize",this,this._onScreenSizeChanged),_b.prototype.destroy.call(this,_a)},_o(0,_a,"sky",function(){return this._sky},function(_a){(this._sky=_a)._ownerCamera=this}),_o(0,_a,"forward",function(){var _a=this.transform.worldMatrix.elements,_b=this._forward.elements;return _b[0]=-_a[8],_b[1]=-_a[9],_b[2]=-_a[10],this._forward}),_o(0,_a,"position",function(){var _a=this.transform.worldMatrix.elements,_b=this._position.elements;return _b[0]=_a[12],_b[1]=_a[13],_b[2]=_a[14],this._position}),_o(0,_a,"renderTarget",function(){return this._renderTarget},function(_a){null!=(this._renderTarget=_a)&&(this._renderTargetSize=_a.size)}),_o(0,_a,"up",function(){var _a=this.transform.worldMatrix.elements,_b=this._up.elements;return _b[0]=_a[4],_b[1]=_a[5],_b[2]=_a[6],this._up}),_o(0,_a,"right",function(){var _a=this.transform.worldMatrix.elements,_b=this._right.elements;return _b[0]=_a[0],_b[1]=_a[1],_b[2]=_a[2],this._right}),_o(0,_a,"renderTargetSize",function(){return this._renderTargetSize},function(_a){null!=this.renderTarget&&this._renderTargetSize,this._renderTargetSize=_a,this._calculateProjectionMatrix()}),_o(0,_a,"fieldOfView",function(){return this._fieldOfView},function(_a){this._fieldOfView=_a,this._calculateProjectionMatrix()}),_o(0,_a,"nearPlane",function(){return this._nearPlane},function(_a){this._nearPlane=_a,this._calculateProjectionMatrix()}),_o(0,_a,"farPlane",function(){return this._farPlane},function(_a){this._farPlane=_a,this._calculateProjectionMatrix()}),_o(0,_a,"orthographic",function(){return this._orthographic},function(_a){this._orthographic=_a,this._calculateProjectionMatrix()}),_o(0,_a,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(_a){this._orthographicVerticalSize=_a,this._calculateProjectionMatrix()}),_o(0,_a,"renderingOrder",function(){return this._renderingOrder},function(_a){this._renderingOrder=_a,this._sortCamerasByRenderingOrder()}),_c.CAMERAPOS=0,_c.VIEWMATRIX=1,_c.PROJECTMATRIX=2,_c.VPMATRIX=3,_c.VPMATRIX_NO_TRANSLATE=4,_c.CAMERADIRECTION=5,_c.CAMERAUP=6,_c.ENVIRONMENTDIFFUSE=7,_c.ENVIRONMENTSPECULAR=8,_c.SIMLODINFO=9,_c.DIFFUSEIRRADMATR=10,_c.DIFFUSEIRRADMATG=11,_c.DIFFUSEIRRADMATB=12,_c.HDREXPOSURE=13,_c.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",_c.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",_c.CLEARFLAG_SOLIDCOLOR=0,_c.CLEARFLAG_SKY=1,_c.CLEARFLAG_DEPTHONLY=2,_c.CLEARFLAG_NONE=3,_l(_c,["_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new _ab(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new _ab},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new _ab}]),_c}(_Ib),_Tb=function(_c){function _b(_a){this._render=null,this._geometryFilter=null,_b.__super.call(this,_a)}_n(_b,"laya.d3.core.RenderableSprite3D",_c);var _a=_b.prototype;return _a._addToInitStaticBatchManager=function(){},_a._setBelongScene=function(_a){_c.prototype._setBelongScene.call(this,_a),_a._renderableSprite3Ds.push(this),this._render._applyLightMapParams()},_a._setUnBelongScene=function(){var _a=this._scene._renderableSprite3Ds,_b=_a.indexOf(this);_a.splice(_b,1),this._render._removeShaderDefine(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),_c.prototype._setUnBelongScene.call(this)},_a._update=function(_a){(_a.owner=this)._activeInHierarchy&&(this._updateComponents(_a),this._render._updateOctreeNode(),this._lateUpdateComponents(_a),_y.spriteCount++,this._childs.length&&this._updateChilds(_a))},_a.destroy=function(_a){void 0===_a&&(_a=!0),_c.prototype.destroy.call(this,_a),this._render._destroy(),this._render=null},_b.__init__=function(){_b.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=_b.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),_b.SAHDERDEFINE_LIGHTMAP=_b.shaderDefines.registerDefine("LIGHTMAP")},_b.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=2,_b.SAHDERDEFINE_LIGHTMAP=4,_b.LIGHTMAPSCALEOFFSET=2,_b.LIGHTMAP=3,_l(_b,["shaderDefines",function(){return this.shaderDefines=new _kb}]),_b}(_Ib),_Ub=(function(_a){function _d(_a,_b,_c){this._long=NaN,this._width=NaN,this._height=NaN,void 0===_a&&(_a=1),void 0===_b&&(_b=1),void 0===_c&&(_c=1),_d.__super.call(this),this._long=_a,this._width=_b,this._height=_c,this.activeResource(),this._positions=this._getPositions(),this._generateBoundingObject()}_n(_d,"laya.d3.resource.models.BoxMesh",_Ob);var _b=_d.prototype;_b.recreateResource=function(){this.disposeResource(),this._numberVertices=24,this._numberIndices=36;var _a=_Da.vertexDeclaration,_b=(_a.vertexStride,this._long/2),_c=this._height/2,_d=this._width/2,_e=new Float32Array([-_b,_c,-_d,0,1,0,0,0,_b,_c,-_d,0,1,0,1,0,_b,_c,_d,0,1,0,1,1,-_b,_c,_d,0,1,0,0,1,-_b,-_c,-_d,0,-1,0,0,1,_b,-_c,-_d,0,-1,0,1,1,_b,-_c,_d,0,-1,0,1,0,-_b,-_c,_d,0,-1,0,0,0,-_b,_c,-_d,-1,0,0,0,0,-_b,_c,_d,-1,0,0,1,0,-_b,-_c,_d,-1,0,0,1,1,-_b,-_c,-_d,-1,0,0,0,1,_b,_c,-_d,1,0,0,1,0,_b,_c,_d,1,0,0,0,0,_b,-_c,_d,1,0,0,0,1,_b,-_c,-_d,1,0,0,1,1,-_b,_c,_d,0,0,1,0,0,_b,_c,_d,0,0,1,1,0,_b,-_c,_d,0,0,1,1,1,-_b,-_c,_d,0,0,1,0,1,-_b,_c,-_d,0,0,-1,1,0,_b,_c,-_d,0,0,-1,0,0,_b,-_c,-_d,0,0,-1,0,1,-_b,-_c,-_d,0,0,-1,1,1]),_f=new Uint16Array([0,1,2,2,3,0,4,7,6,6,5,4,8,9,10,10,11,8,12,15,14,14,13,12,16,17,18,18,19,16,20,23,22,22,21,20]);this._vertexBuffer=new _Mb(_a,this._numberVertices,35044,!0),this._indexBuffer=new _Lb("ushort",this._numberIndices,35044,!0),this._vertexBuffer._addReference(),this._indexBuffer._addReference(),this._vertexBuffer.setData(_e),this._indexBuffer.setData(_f),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.completeCreate()},_o(0,_b,"long",function(){return this._long},function(_a){this._long!==_a&&(this._long=_a,this.releaseResource(),this.activeResource())}),_o(0,_b,"width",function(){return this._width},function(_a){this._width!==_a&&(this._width=_a,this.releaseResource(),this.activeResource())}),_o(0,_b,"height",function(){return this._height},function(_a){this._height!==_a&&(this._height=_a,this.releaseResource(),this.activeResource())})}(),function(_a){function _g(_a,_b,_c){void 0===_a&&(_a=0),void 0===_b&&(_b=.3),void 0===_c&&(_c=1e3),this._viewMatrix=new _ab,this._projectionMatrix=new _ab,this._projectionViewMatrix=new _ab,this._viewport=new _ib(0,0,0,0),this._normalizedViewport=new _ib(0,0,1,1),this._aspectRatio=_a,this._boundFrustumUpdate=!0,this._boundFrustum=new _Ya(_ab.DEFAULT),_g.__super.call(this,_b,_c),this.transform.on("worldmatrixneedchanged",this,this._onWorldMatrixChanged)}_n(_g,"laya.d3.core.Camera",_Sb);var _b=_g.prototype;return _b._onWorldMatrixChanged=function(){this._boundFrustumUpdate=!0},_b._parseCustomProps=function(_a,_b,_c,_d){var _e=_c.clearColor;this.clearColor=new _hb(_e[0],_e[1],_e[2],_e[3]);var _f=_c.viewport;this.normalizedViewport=new _ib(_f[0],_f[1],_f[2],_f[3])},_b._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var _a=this.orthographicVerticalSize*this.aspectRatio*.5,_b=.5*this.orthographicVerticalSize;_ab.createOrthoOffCenterRH(-_a,_a,-_b,_b,this.nearPlane,this.farPlane,this._projectionMatrix)}else _ab.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix);this._boundFrustumUpdate=!0},_b._update=function(_a){this.conchModel&&(this.conchModel.setViewMatrix(this.viewMatrix.elements),this.conchModel.setProjectMatrix(this.projectionMatrix.elements)),laya.d3.core.Sprite3D.prototype._update.call(this,_a)},_b._renderCamera=function(_a,_b,_c){var _d,_e;_c.parallelSplitShadowMaps[0]&&_c._renderShadowMap(_a,_b,this),(_b.camera=this)._prepareCameraToRender(),_c._preRenderUpdateComponents(_b),_d=_b._viewMatrix=this.viewMatrix;var _f=this._renderTarget;_f?(_f.start(),_ab.multiply(_Sb._invertYScaleMatrix,this._projectionMatrix,_Sb._invertYProjectionMatrix),_ab.multiply(_Sb._invertYScaleMatrix,this.projectionViewMatrix,_Sb._invertYProjectionViewMatrix),_e=_b._projectionMatrix=_Sb._invertYProjectionMatrix,_b._projectionViewMatrix=_Sb._invertYProjectionViewMatrix):(_e=_b._projectionMatrix=this._projectionMatrix,_b._projectionViewMatrix=this.projectionViewMatrix),this._prepareCameraViewProject(_d,_e),_b._viewport=this.viewport,_c._preRenderScene(_a,_b,this.boundFrustum),_c._clear(_a,_b),_c._renderScene(_a,_b),_c._postRenderUpdateComponents(_b),_f&&_f.end()},_b.viewportPointToRay=function(_a,_b){_ob.calculateCursorRay(_a,this.viewport,this._projectionMatrix,this.viewMatrix,null,_b)},_b.normalizedViewportPointToRay=function(_a,_b){var _c=_g._tempVector20,_d=this.viewport,_e=_a.elements,_f=_c.elements;_f[0]=_e[0]*_d.width,_f[1]=_e[1]*_d.height,_ob.calculateCursorRay(_c,this.viewport,this._projectionMatrix,this.viewMatrix,null,_b)},_b.worldToViewportPoint=function(_a,_b){_ab.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(_a,this._projectionViewMatrix,_b);var _c=_b.elements;_c[0]=_c[0]/_v.stage.clientScaleX,_c[1]=_c[1]/_v.stage.clientScaleY},_b.worldToNormalizedViewportPoint=function(_a,_b){_ab.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(_a,this._projectionViewMatrix,_b);var _c=_b.elements;_c[0]=_c[0]/_v.stage.clientScaleX,_c[1]=_c[1]/_v.stage.clientScaleY},_b.convertScreenCoordToOrthographicCoord=function(_a,_b){if(this._orthographic){var _c=_W.clientWidth,_d=_W.clientHeight,_e=this.orthographicVerticalSize*this.aspectRatio/_c,_f=this.orthographicVerticalSize/_d,_g=_a.elements,_h=_b.elements;return _h[0]=(-_c/2+_g[0])*_e,_h[1]=(_d/2-_g[1])*_f,_h[2]=(this.nearPlane-this.farPlane)*(_g[2]+1)/2-this.nearPlane,_gb.transformCoordinate(_b,this.transform.worldMatrix,_b),!0}return!1},_o(0,_b,"projectionViewMatrix",function(){return _ab.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),_o(0,_b,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var _a=this.viewport;return _a.width/_a.height},function(_a){if(_a<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=_a,this._calculateProjectionMatrix()}),_o(0,_b,"boundFrustum",function(){return this._boundFrustumUpdate&&(this._boundFrustum.matrix=this.projectionViewMatrix),this._boundFrustum}),_o(0,_b,"needViewport",function(){var _a=this.normalizedViewport;return 0===_a.x&&0===_a.y&&1===_a.width&&1===_a.height}),_o(0,_b,"viewport",function(){if(this._viewportExpressedInClipSpace){var _a=this._normalizedViewport,_b=this.renderTargetSize,_c=_b.width,_d=_b.height;this._viewport.x=_a.x*_c,this._viewport.y=_a.y*_d,this._viewport.width=_a.width*_c,this._viewport.height=_a.height*_d}return this._viewport},function(_a){if(null!=this.renderTarget&&(_a.x<0||_a.y<0||0==_a.width||0==_a.height))throw new Error("Camera: viewport size invalid.","value");this._viewportExpressedInClipSpace=!1,this._viewport=_a,this._calculateProjectionMatrix()}),_o(0,_b,"normalizedViewport",function(){if(!this._viewportExpressedInClipSpace){var _a=this._viewport,_b=this.renderTargetSize,_c=_b.width,_d=_b.height;this._normalizedViewport.x=_a.x/_c,this._normalizedViewport.y=_a.y/_d,this._normalizedViewport.width=_a.width/_c,this._normalizedViewport.height=_a.height/_d}return this._normalizedViewport},function(_a){_a.x<0&&(_a.x=0,console.warn("Camera: viewport.x must large than 0.0.")),_a.y<0&&(_a.y=0,console.warn("Camera: viewport.y must large than 0.0.")),1<_a.x+_a.width&&(_a.width=1-_a.x,console.warn("Camera: viewport.width + viewport.x must less than 1.0.")),1<_a.y+_a.height&&(_a.height=1-_a.y,console.warn("Camera: viewport.height + viewport.y must less than 1.0.")),this._viewportExpressedInClipSpace=!0,this._normalizedViewport=_a,this._calculateProjectionMatrix()}),_o(0,_b,"projectionMatrix",function(){return this._projectionMatrix},function(_a){this._projectionMatrix=_a,this._useUserProjectionMatrix=!0}),_o(0,_b,"viewMatrix",function(){return this.transform.worldMatrix.invert(this._viewMatrix),this._viewMatrix}),_l(_g,["_tempVector20",function(){return this._tempVector20=new _fb}]),_g}()),_Vb=function(_c){function _d(_a,_b){_d.__super.call(this,_b),this._geometryFilter=new _Fb(this),this._render=new _Gb(this),this._geometryFilter.on("meshchanged",this,this._onMeshChanged),this._render.on("materialchanged",this,this._onMaterialChanged),_a&&(this._geometryFilter.sharedMesh=_a)instanceof laya.d3.resource.models.Mesh&&(_a.loaded?this._render.sharedMaterials=_a.materials:_a.once("loaded",this,this._applyMeshMaterials))}_n(_d,"laya.d3.core.MeshSprite3D",_c);var _a=_d.prototype;return _a._changeRenderObjectByMesh=function(_a){var _b=this._render._renderElements,_c=_b[_a];_c||(_c=_b[_a]=new _xb),_c._render=this._render;var _d=this._render.sharedMaterials[_a];_d||(_d=_Kb.defaultMaterial);var _e=this._geometryFilter.sharedMesh.getRenderElement(_a);return _c._mainSortID=this._getSortID(_e,_d),_c._sprite3D=this,_c.renderObj=_e,_c._material=_d,_c},_a._changeRenderObjectByMaterial=function(_a,_b){var _c=this._render._renderElements[_a];_b||(_b=_Kb.defaultMaterial);var _d=this._geometryFilter.sharedMesh.getRenderElement(_a);return _c._mainSortID=this._getSortID(_d,_b),_c._sprite3D=this,_c.renderObj=_d,_c._material=_b,_c},_a._changeRenderObjectsByMesh=function(){var _a=this._geometryFilter.sharedMesh.getRenderElementsCount();this._render._renderElements.length=_a;for(var _b=0;_b<_a;_b++)this._changeRenderObjectByMesh(_b)},_a._onMeshChanged=function(_a){var _b=_a.sharedMesh;_b.loaded?this._changeRenderObjectsByMesh():_b.once("loaded",this,this._onMeshLoaded)},_a._onMeshLoaded=function(_a){_a===this.meshFilter.sharedMesh&&this._changeRenderObjectsByMesh()},_a._onMaterialChanged=function(_a,_b,_c){_b<this._render._renderElements.length&&this._changeRenderObjectByMaterial(_b,_c)},_a._clearSelfRenderObjects=function(){this.scene.removeFrustumCullingObject(this._render)},_a._addSelfRenderObjects=function(){this.scene.addFrustumCullingObject(this._render)},_a._parseCustomProps=function(_a,_b,_c,_d){var _e=this.meshRender,_f=_c.lightmapIndex;null!=_f&&(_e.lightmapIndex=_f);var _g,_h,_i=_c.lightmapScaleOffset;if(_i&&(_e.lightmapScaleOffset=new _hb(_i[0],_i[1],_i[2],_i[3])),_d.instanceParams)(_g=_d.instanceParams.loadPath)&&(_h=_r.getRes(_b[_g]),(this.meshFilter.sharedMesh=_h).loaded?_e.sharedMaterials=_h.materials:_h.once("loaded",this,this._applyMeshMaterials));else{(_g=_c.meshPath)&&(_h=_r.getRes(_b[_g]),this.meshFilter.sharedMesh=_h);var _j=_c.materials;if(_j){var _k=_e.sharedMaterials,_l=_j.length;_k.length=_l;for(var _m=0;_m<_l;_m++)_k[_m]=_r.getRes(_b[_j[_m].path]);_e.sharedMaterials=_k}}},_a._applyMeshMaterials=function(_a){for(var _b=this._render.sharedMaterials,_c=_a.materials,_d=0,_e=_c.length;_d<_e;_d++)_b[_d]||(_b[_d]=_c[_d]);this._render.sharedMaterials=_b},_a._addToInitStaticBatchManager=function(){_d._staticBatchManager._addInitBatchSprite(this)},_a.cloneTo=function(_a){var _b=_a;_b._geometryFilter.sharedMesh=this._geometryFilter.sharedMesh;var _c=this._render,_d=_b._render;_d.enable=_c.enable,_d.sharedMaterials=_c.sharedMaterials,_d.castShadow=_c.castShadow;var _e=_c.lightmapScaleOffset;_e&&(_d.lightmapScaleOffset=_e.clone()),_d.lightmapIndex=_c.lightmapIndex,_d.receiveShadow=_c.receiveShadow,_d.sortingFudge=_c.sortingFudge,laya.d3.core.Sprite3D.prototype.cloneTo.call(this,_a)},_a.destroy=function(_a){if(void 0===_a&&(_a=!0),!this.destroyed){var _b=this.meshFilter.sharedMesh;null!=_b&&(_b.loaded||_b.off("loaded",this,this._applyMeshMaterials)),_c.prototype.destroy.call(this,_a),this._geometryFilter._destroy()}},_o(0,_a,"meshFilter",function(){return this._geometryFilter}),_o(0,_a,"meshRender",function(){return this._render}),_d.__init__=function(){_da._staticBatchManagers.push(_d._staticBatchManager)},_d.load=function(_a){return _v.loader.create(_a,null,null,_d)},_l(_d,["_staticBatchManager",function(){return this._staticBatchManager=new _zb}]),_d}(_Tb)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(_a,_b,_ea){_ea.un,_ea.uns;var _c=_ea.static,_d=_ea.class,_f=_ea.getset,_p=_ea.__newvec,_h=laya.maths.Bezier,_l=laya.utils.Browser,_Da=laya.utils.Byte,_e=(laya.events.Event,laya.events.EventDispatcher),_g=laya.display.Graphics,_i=(laya.resource.HTMLCanvas,laya.utils.Handler),_j=laya.net.Loader,_m=laya.maths.MathUtil,_Ea=laya.maths.Matrix,_q=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle,laya.renders.Render),_k=(laya.renders.RenderContext,laya.resource.Resource),_n=laya.utils.RunDriver,_fa=laya.display.Sprite,_o=laya.utils.Stat,_Fa=laya.resource.Texture,_r=(laya.net.URL,laya.utils.Utils),_E=function(){function _a(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return _d(_a,"laya.ani.AnimationContent"),_a}(),_F=function(){function _a(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return _d(_a,"laya.ani.AnimationNodeContent"),_a}(),_t=function(){function _a(){}return _d(_a,"laya.ani.AnimationParser01"),_a.parse=function(_a,_b){var _c=_b.__getBuffer(),_d=0,_e=0,_f=0,_g=0,_h=0,_i=0,_j=0,_k=_b.readUTFString();_a._aniClassName=_k;var _l,_m=_b.readUTFString().split("\n"),_n=_b.getUint8(),_o=_b.getUint32(),_p=_b.getUint32();0<_o&&(_l=_c.slice(_o,_p));var _q=new _Da(_l);for(0<_p&&(_a._publicExtData=_c.slice(_p,_c.byteLength)),_a._useParent=!!_b.getUint8(),_a._anis.length=_n,_d=0;_d<_n;_d++){var _r=_a._anis[_d]=new _E;_r.nodes=new Array;var _s=_r.name=_m[_b.getUint16()];_a._aniMap[_s]=_d,_r.bone3DMap={},_r.playTime=_b.getFloat32(),_r.playTime<=0&&console.error("播放时间不能为0  url="+_a.url+" name="+_r.name);var _t=_r.nodes.length=_b.getUint8();for(_e=_r.totalKeyframeDatasLength=0;_e<_t;_e++){var _u=_r.nodes[_e]=new _F;_u.childs=[];var _v=_b.getInt16();0<=_v&&(_u.name=_m[_v],_r.bone3DMap[_u.name]=_e),_u.keyFrame=new Array,_u.parentIndex=_b.getInt16(),-1==_u.parentIndex?_u.parent=null:_u.parent=_r.nodes[_u.parentIndex],_u.lerpType=_b.getUint8();var _w=_b.getUint32();_q.pos=_w;var _x=_u.keyframeWidth=_q.getUint16();if(_r.totalKeyframeDatasLength+=_x,0===_u.lerpType||1===_u.lerpType)for(_u.interpolationMethod=[],_u.interpolationMethod.length=_x,_f=0;_f<_x;_f++)_u.interpolationMethod[_f]=_I.interpolation[_q.getUint8()];null!=_u.parent&&_u.parent.childs.push(_u);var _y=_b.getUint16();0<_y&&(_u.extenData=_c.slice(_b.pos,_b.pos+_y),_b.pos+=_y);var _z,_A=_b.getUint16(),_B=0;for(_f=0,_g=_u.keyFrame.length=_A;_f<_g;_f++){if((_z=_u.keyFrame[_f]=new _G).duration=_b.getFloat32(),_z.startTime=_B,2===_u.lerpType){_z.interpolationData=[];var _C,_D=_b.getUint8();switch(_C=_b.getFloat32()){case 254:for(_z.interpolationData.length=_x,_j=0;_j<_x;_j++)_z.interpolationData[_j]=0;break;case 255:for(_z.interpolationData.length=_x,_j=0;_j<_x;_j++)_z.interpolationData[_j]=5;break;default:for(_z.interpolationData.push(_C),_i=1;_i<_D;_i++)_z.interpolationData.push(_b.getFloat32())}}for(_z.data=new Float32Array(_x),_h=0;_h<_x;_h++)_z.data[_h]=_b.getFloat32(),-1e-8<_z.data[_h]&&_z.data[_h]<1e-8&&(_z.data[_h]=0);_B+=_z.duration}_z.startTime=_r.playTime,_u.playTime=_r.playTime,_a._calculateKeyFrame(_u,_A,_x)}}},_a}(),_u=function(){function _v(){}return _d(_v,"laya.ani.AnimationParser02"),_v.READ_DATA=function(){_v._DATA.offset=_v._reader.getUint32(),_v._DATA.size=_v._reader.getUint32()},_v.READ_BLOCK=function(){for(var _a=_v._BLOCK.count=_v._reader.getUint16(),_b=_v._BLOCK.blockStarts=[],_c=_v._BLOCK.blockLengths=[],_d=0;_d<_a;_d++)_b.push(_v._reader.getUint32()),_c.push(_v._reader.getUint32())},_v.READ_STRINGS=function(){var _a=_v._reader.getUint32(),_b=_v._reader.getUint16(),_c=_v._reader.pos;_v._reader.pos=_a+_v._DATA.offset;for(var _d=0;_d<_b;_d++)_v._strings[_d]=_v._reader.readUTFString();_v._reader.pos=_c},_v.parse=function(_a,_b){_v._templet=_a;(_v._reader=_b).__getBuffer();_v.READ_DATA(),_v.READ_BLOCK(),_v.READ_STRINGS();for(var _c=0,_d=_v._BLOCK.count;_c<_d;_c++){var _e=_b.getUint16(),_f=_v._strings[_e],_g=_v["READ_"+_f];if(null==_g)throw new Error("model file err,no this function:"+_e+" "+_f);_g.call()}},_v.READ_ANIMATIONS=function(){var _a=_v._reader,_b=_a.__getBuffer(),_c=0,_d=0,_e=0,_f=0,_g=_a.getUint16(),_h=[];for(_h.length=_g,_c=0;_c<_g;_c++)_h[_c]=_I.interpolation[_a.getByte()];var _i=_a.getUint8();for(_v._templet._anis.length=_i,_c=0;_c<_i;_c++){var _j=_v._templet._anis[_c]={};_j.nodes=new Array;var _k=_j.name=_v._strings[_a.getUint16()];_v._templet._aniMap[_k]=_c,_j.bone3DMap={},_j.playTime=_a.getFloat32();var _l=_j.nodes.length=_a.getInt16();for(_d=_j.totalKeyframeDatasLength=0;_d<_l;_d++){var _m=_j.nodes[_d]={};_m.keyframeWidth=_g,_m.childs=[];var _n=_a.getUint16();0<=_n&&(_m.name=_v._strings[_n],_j.bone3DMap[_m.name]=_d),_m.keyFrame=new Array,_m.parentIndex=_a.getInt16(),-1==_m.parentIndex?_m.parent=null:_m.parent=_j.nodes[_m.parentIndex],_j.totalKeyframeDatasLength+=_g,_m.interpolationMethod=_h,null!=_m.parent&&_m.parent.childs.push(_m);var _o=_a.getUint16(),_p=null,_q=null;for(_e=0,_f=_m.keyFrame.length=_o;_e<_f;_e++){(_p=_m.keyFrame[_e]={}).startTime=_a.getFloat32(),_q&&(_q.duration=_p.startTime-_q.startTime);var _r=_v._DATA.offset,_s=_a.getUint32(),_t=4*_g,_u=_b.slice(_r+_s,_r+_s+_t);_p.data=new Float32Array(_u),_q=_p}_p.duration=0,_m.playTime=_j.playTime,_v._templet._calculateKeyFrame(_m,_o,_g)}}},_v._templet=null,_v._reader=null,_v._strings=[],_c(_v,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),_v}(),_Ga=(function(){function _a(){}_d(_a,"laya.ani.AnimationState"),_a.stopped=0,_a.paused=1,_a.playing=2}(),function(){function _e(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new _Ta,this.resultMatrix=new _Ea,this._children=[]}_d(_e,"laya.ani.bone.Bone");var _a=_e.prototype;return _a.setTempMatrix=function(_a){this._tempMatrix=_a;var _b,_c=0;for(_c=0,_b=this._children.length;_c<_b;_c++)this._children[_c].setTempMatrix(this._tempMatrix)},_a.update=function(_a){var _b;if(this.rotation=this.transform.skX,_a)_b=this.resultTransform.getMatrix(),_Ea.mul(_b,_a,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)_b=this.resultTransform.getMatrix(),_Ea.mul(_b,this.parentBone.resultMatrix,this.resultMatrix);else{var _c=this.parentBone,_d=NaN,_e=NaN,_f=NaN,_g=this.parentBone.resultMatrix;_b=this.resultTransform.getMatrix();var _h=_g.a*_b.tx+_g.c*_b.ty+_g.tx,_i=_g.b*_b.tx+_g.d*_b.ty+_g.ty,_j=new _Ea;this.inheritRotation?(_d=Math.atan2(_c.resultMatrix.b,_c.resultMatrix.a),_e=Math.cos(_d),_f=Math.sin(_d),_j.setTo(_e,_f,-_f,_e,0,0),_Ea.mul(this._tempMatrix,_j,_Ea.TEMP),_Ea.TEMP.copyTo(_j),_b=this.resultTransform.getMatrix(),_Ea.mul(_b,_j,this.resultMatrix),this.resultTransform.scX*this.resultTransform.scY<0&&this.resultMatrix.rotate(.5*Math.PI)):(this.inheritScale,_b=this.resultTransform.getMatrix(),_Ea.TEMP.identity(),_Ea.TEMP.d=this.d,_Ea.mul(_b,_Ea.TEMP,this.resultMatrix)),this.resultMatrix.tx=_h,this.resultMatrix.ty=_i}else(_b=this.resultTransform.getMatrix()).copyTo(this.resultMatrix);var _k,_l=0;for(_l=0,_k=this._children.length;_l<_k;_l++)this._children[_l].update()},_a.updateChild=function(){var _a,_b=0;for(_b=0,_a=this._children.length;_b<_a;_b++)this._children[_b].update()},_a.setRotation=function(_a){this._sprite&&(this._sprite.rotation=180*_a/Math.PI)},_a.updateDraw=function(_a,_b){_e.ShowBones&&!_e.ShowBones[this.name]||(this._sprite||(this._sprite=new _fa,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),_ea.stage.addChild(this._sprite)),this._sprite.x=_a+this.resultMatrix.tx,this._sprite.y=_b+this.resultMatrix.ty);var _c,_d=0;for(_d=0,_c=this._children.length;_d<_c;_d++)this._children[_d].updateDraw(_a,_b)},_a.addChild=function(_a){this._children.push(_a),_a.parentBone=this},_a.findBone=function(_a){if(this.name==_a)return this;var _b,_c,_d=0;for(_d=0,_b=this._children.length;_d<_b;_d++)if(_c=this._children[_d].findBone(_a))return _c;return null},_a.localToWorld=function(_a){var _b=_a[0],_c=_a[1];_a[0]=_b*this.resultMatrix.a+_c*this.resultMatrix.c+this.resultMatrix.tx,_a[1]=_b*this.resultMatrix.b+_c*this.resultMatrix.d+this.resultMatrix.ty},_e.ShowBones={},_e}()),_Ha=function(){function _p(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}_d(_p,"laya.ani.bone.BoneSlot");var _a=_p.prototype;return _a.showSlotData=function(_a,_b){void 0===_b&&(_b=!0),this.currSlotData=_a,_b&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},_a.showDisplayByName=function(_a){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(_a))},_a.replaceDisplayByName=function(_a,_b){if(this.currSlotData){var _c;_c=this.currSlotData.getDisplayByName(_a);var _d;_d=this.currSlotData.getDisplayByName(_b),this.replaceDisplayByIndex(_c,_d)}},_a.replaceDisplayByIndex=function(_a,_b){this.currSlotData&&(this._replaceDic[_a]=_b,this.displayIndex==_a&&this.showDisplayByIndex(_a))},_a.showDisplayByIndex=function(_a){if(null!=this._replaceDic[_a]&&(_a=this._replaceDic[_a]),this.currSlotData&&-1<_a&&_a<this.currSlotData.displayArr.length){if(this.displayIndex=_a,this.currDisplayData=this.currSlotData.displayArr[_a],this.currDisplayData){var _b=this.currDisplayData.name;this.currTexture=this.templet.getTexture(_b),this.currTexture&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(!_q.isConchApp||_q.isConchApp&&"0.9.15"<_fa.RUNTIMEVERION)&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},_a.replaceSkin=function(_a){this._diyTexture=_a,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},_a.setParentMatrix=function(_a){this._parentMatrix=_a},_a.draw=function(_a,_b,_c,_d){if(void 0===_c&&(_c=!1),void 0===_d&&(_d=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var _e,_f=this.currTexture;switch(this._diyTexture&&(_f=this._diyTexture),this.currDisplayData.type){case 0:if(_a){var _g=this.getDisplayMatrix();if(this._parentMatrix){var _h=!1;if(_g){var _i;if(_Ea.mul(_g,this._parentMatrix,_Ea.TEMP),_i=_c?(null==this._resultMatrix&&(this._resultMatrix=new _Ea),this._resultMatrix):new _Ea,!_q.isWebGL&&this.currDisplayData.uvs||_q.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var _j=_p._tempMatrix;_j.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(_j.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(_h=!0,_j.rotate(-Math.PI/2)),_Ea.mul(_j,_Ea.TEMP,_i)}else _Ea.TEMP.copyTo(_i);_h?_a.drawTexture(_f,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,_i):_a.drawTexture(_f,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,_i)}}}break;case 1:if(null==(_e=_c?(null==this._skinSprite&&(this._skinSprite=_p.createSkinMesh()),this._skinSprite):_p.createSkinMesh()))return;var _k;if(null==this.currDisplayData.bones){var _l,_m=this.currDisplayData.weights;this.deformData&&(_m=this.deformData),_l=this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=_x.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=_x.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs,this._mVerticleArr=_m;this.currDisplayData.triangles.length;_k=this.currDisplayData.triangles,_e.init2(_f,null,_k,this._mVerticleArr,_l);var _n,_o=this.getDisplayMatrix();if(this._parentMatrix)if(_o)_Ea.mul(_o,this._parentMatrix,_Ea.TEMP),_n=_c?(null==this._resultMatrix&&(this._resultMatrix=new _Ea),this._resultMatrix):new _Ea,_Ea.TEMP.copyTo(_n),_e.transform=_n}else this.skinMesh(_b,_e,_d);_a.drawSkin(_e);break;case 2:if(null==(_e=_c?(null==this._skinSprite&&(this._skinSprite=_p.createSkinMesh()),this._skinSprite):_p.createSkinMesh()))return;this.skinMesh(_b,_e,_d),_a.drawSkin(_e)}}},_a.skinMesh=function(_a,_b,_c){var _d,_e=this.currTexture,_f=this.currDisplayData.bones;_d=this._diyTexture?(_e=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=_x.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=_x.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),this._curDiyUV):this.currDisplayData.uvs;var _g,_h,_i=this.currDisplayData.weights,_j=this.currDisplayData.triangles,_k=0,_l=0,_m=0,_n=NaN,_o=NaN,_p=0,_q=0,_r=[],_s=0,_t=0;if(this.deformData&&0<this.deformData.length){var _u=0;for(_s=0,_t=_f.length;_s<_t;){for(_m=_f[_s++]+_s,_l=_k=0;_s<_m;_s++)_h=_a[_f[_s]],_n=_i[_p]+this.deformData[_u++],_o=_i[_p+1]+this.deformData[_u++],_q=_i[_p+2],_k+=(_n*_h.a+_o*_h.c+_h.tx)*_q,_l+=(_n*_h.b+_o*_h.d+_h.ty)*_q,_p+=3;_r.push(_k,_l)}}else for(_s=0,_t=_f.length;_s<_t;){for(_m=_f[_s++]+_s,_l=_k=0;_s<_m;_s++)_h=_a[_f[_s]],_n=_i[_p],_o=_i[_p+1],_q=_i[_p+2],_k+=(_n*_h.a+_o*_h.c+_h.tx)*_q,_l+=(_n*_h.b+_o*_h.d+_h.ty)*_q,_p+=3;_r.push(_k,_l)}this._mVerticleArr=_r,_g=_j,_b.init2(_e,null,_g,this._mVerticleArr,_d)},_a.drawBonePoint=function(_a){_a&&this._parentMatrix&&_a.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},_a.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},_a.getMatrix=function(){return this._resultMatrix},_a.copy=function(){var _a=new _p;return _a.type="copy",_a.name=this.name,_a.attachmentName=this.attachmentName,_a.srcDisplayIndex=this.srcDisplayIndex,_a.parent=this.parent,_a.displayIndex=this.displayIndex,_a.templet=this.templet,_a.currSlotData=this.currSlotData,_a.currTexture=this.currTexture,_a.currDisplayData=this.currDisplayData,_a},_p.createSkinMesh=function(){return _q.isWebGL||_q.isConchApp?_n.skinAniSprite():(_q.isWebGL,null)},_c(_p,["_tempMatrix",function(){return this._tempMatrix=new _Ea}]),_p}(),_Ia=function(){function _a(){this.skinName=null,this.deformSlotDataList=[]}return _d(_a,"laya.ani.bone.DeformAniData"),_a}(),_Ja=function(){function _a(){this.deformSlotDisplayList=[]}return _d(_a,"laya.ani.bone.DeformSlotData"),_a}(),_Ka=function(){function _a(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}_d(_a,"laya.ani.bone.DeformSlotDisplayData");var _b=_a.prototype;return _b.binarySearch1=function(_a,_b){var _c=0,_d=_a.length-2;if(0==_d)return 1;for(var _e=_d>>>1;;){if(_a[Math.floor(_e+1)]<=_b?_c=_e+1:_d=_e,_c==_d)return _c+1;_e=_c+_d>>>1}return 0},_b.apply=function(_a,_b,_c){if(void 0===_c&&(_c=1),_a+=.05,!(this.timeList.length<=0)){var _d=0;if(!(_a<this.timeList[0])){var _e=this.vectices[0].length,_f=[],_g=this.binarySearch1(this.timeList,_a);if(this.frameIndex=_g,_a>=this.timeList[this.timeList.length-1]){var _h=this.vectices[this.vectices.length-1];if(_c<1)for(_d=0;_d<_e;_d++)_f[_d]+=(_h[_d]-_f[_d])*_c;else for(_d=0;_d<_e;_d++)_f[_d]=_h[_d];this.deformData=_f}else{this.tweenKeyList[this.frameIndex];var _i=this.vectices[this.frameIndex-1],_j=this.vectices[this.frameIndex],_k=this.timeList[this.frameIndex-1],_l=this.timeList[this.frameIndex];_c=this.tweenKeyList[_g-1]?(_a-_k)/(_l-_k):0;var _m=NaN;for(_d=0;_d<_e;_d++)_m=_i[_d],_f[_d]=_m+(_j[_d]-_m)*_c;this.deformData=_f}}}},_a}(),_La=function(){function _a(){this.time=NaN,this.drawOrder=[]}return _d(_a,"laya.ani.bone.DrawOrderData"),_a}(),_Ma=function(){function _a(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return _d(_a,"laya.ani.bone.EventData"),_a}(),_s=function(){function _da(_a,_b){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=_a,this._targetBone=_b[_a.targetBoneIndex],this.isSpine=_a.isSpine,null==this._bones&&(this._bones=[]);for(var _c=this._bones.length=0,_d=_a.boneIndexs.length;_c<_d;_c++)this._bones.push(_b[_a.boneIndexs[_c]]);this.name=_a.name,this.mix=_a.mix,this.bendDirection=_a.bendDirection}_d(_da,"laya.ani.bone.IkConstraint");var _a=_da.prototype;return _a.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},_a._applyIk1=function(_a,_b,_c,_d){var _e=_a.parentBone,_f=1/(_e.resultMatrix.a*_e.resultMatrix.d-_e.resultMatrix.b*_e.resultMatrix.c),_g=_b-_e.resultMatrix.tx,_h=_c-_e.resultMatrix.ty,_i=(_g*_e.resultMatrix.d-_h*_e.resultMatrix.c)*_f-_a.transform.x,_j=(_h*_e.resultMatrix.a-_g*_e.resultMatrix.b)*_f-_a.transform.y,_k=Math.atan2(_j,_i)*_da.radDeg-0-_a.transform.skX;_a.transform.scX<0&&(_k+=180),180<_k?_k-=360:_k<-180&&(_k+=360),_a.transform.skX=_a.transform.skY=_a.transform.skX+_k*_d,_a.update()},_a.updatePos=function(_a,_b){this._sp&&this._sp.pos(_a,_b)},_a._applyIk2=function(_a,_b,_c,_d,_e,_f){if(0!=_f){var _g=_a.resultTransform.x,_h=_a.resultTransform.y,_i=_a.transform.scX,_j=_a.transform.scY,_k=_b.transform.scX,_l=0,_m=0,_n=0;_n=_i<0?(_i=-_i,_l=180,-1):(_l=0,1),_j<0&&(_j=-_j,_n=-_n),_m=_k<0?(_k=-_k,180):0;var _o=_b.resultTransform.x,_p=NaN,_q=NaN,_r=NaN,_s=_a.resultMatrix.a,_t=_a.resultMatrix.c,_u=_a.resultMatrix.b,_v=_a.resultMatrix.d,_w=Math.abs(_i-_j)<=1e-4;_r=_w?(_q=_s*_o+_t*(_p=_b.resultTransform.y)+_a.resultMatrix.tx,_u*_o+_v*_p+_a.resultMatrix.ty):(_p=0,_q=_s*_o+_a.resultMatrix.tx,_u*_o+_a.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new _fa,_ea.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(_c,_d,15,"#ffff00"),this._sp.graphics.drawCircle(_q,_r,15,"#ff00ff")),_a.setRotation(Math.atan2(_r-_a.resultMatrix.ty,_q-_a.resultMatrix.tx));var _x=_a.parentBone;_s=_x.resultMatrix.a,_t=_x.resultMatrix.c,_u=_x.resultMatrix.b;var _y=1/(_s*(_v=_x.resultMatrix.d)-_t*_u),_z=_c-_x.resultMatrix.tx,_A=_d-_x.resultMatrix.ty,_B=(_z*_v-_A*_t)*_y-_g,_C=(_A*_s-_z*_u)*_y-_h,_D=((_z=_q-_x.resultMatrix.tx)*_v-(_A=_r-_x.resultMatrix.ty)*_t)*_y-_g,_E=(_A*_s-_z*_u)*_y-_h,_F=Math.sqrt(_D*_D+_E*_E),_G=_b.length*_k,_H=NaN,_I=NaN;if(_w){var _J=(_B*_B+_C*_C-_F*_F-(_G*=_i)*_G)/(2*_F*_G);_J<-1?_J=-1:1<_J&&(_J=1),_I=Math.acos(_J)*_e,_s=_F+_G*_J,_t=_G*Math.sin(_I),_H=Math.atan2(_C*_s-_B*_t,_B*_s+_C*_t)}else{var _K=(_s=_i*_G)*_s,_L=(_t=_j*_G)*_t,_M=_B*_B+_C*_C,_N=Math.atan2(_C,_B),_O=-2*_L*_F,_P=_L-_K;if(0<(_v=_O*_O-4*_P*(_u=_L*_F*_F+_K*_M-_K*_L))){var _Q=Math.sqrt(_v);_O<0&&(_Q=-_Q);var _R=(_Q=-(_O+_Q)/2)/_P,_S=_u/_Q,_T=Math.abs(_R)<Math.abs(_S)?_R:_S;_T*_T<=_M&&(_A=Math.sqrt(_M-_T*_T)*_e,_H=_N-Math.atan2(_A,_T),_I=Math.atan2(_A/_j,(_T-_F)/_i))}var _U=0,_V=Number.MAX_VALUE,_W=0,_X=0,_Y=0,_Z=0,_$=0,__=0;_Z<(_v=(_z=_F+_s)*_z)&&(_Y=0,_Z=_v,_$=_z),(_v=(_z=_F-_s)*_z)<_V&&(_U=Math.PI,_V=_v,_W=_z);var _aa=Math.acos(-_s*_F/(_K-_L));(_v=(_z=_s*Math.cos(_aa)+_F)*_z+(_A=_t*Math.sin(_aa))*_A)<_V&&(_U=_aa,_V=_v,_W=_z,_X=_A),_Z<_v&&(_Y=_aa,_Z=_v,_$=_z,__=_A),_I=_M<=(_V+_Z)/2?(_H=_N-Math.atan2(_X*_e,_W),_U*_e):(_H=_N-Math.atan2(__*_e,_$),_Y*_e)}var _ba=Math.atan2(_p,_o)*_n,_ca=_a.resultTransform.skX;180<(_H=(_H-_ba)*_da.radDeg+_l-_ca)?_H-=360:_H<-180&&(_H+=360),_a.resultTransform.x=_g,_a.resultTransform.y=_h,_a.resultTransform.skX=_a.resultTransform.skY=_ca+_H*_f,_ca=_b.resultTransform.skX,180<(_I=((_I+_ba)*_da.radDeg-0)*_n+_m-(_ca%=360))?_I-=360:_I<-180&&(_I+=360),_b.resultTransform.x=_o,_b.resultTransform.y=_p,_b.resultTransform.skX=_b.resultTransform.skY=_b.resultTransform.skY+_I*_f,_a.update()}},_a._applyIk3=function(_a,_b,_c,_d,_e,_f){if(0!=_f){var _g,_h,_i=_b.resultMatrix.a*_b.length,_j=_b.resultMatrix.b*_b.length,_k=_i*_i+_j*_j,_l=Math.sqrt(_k),_m=_a.resultMatrix.tx,_n=_a.resultMatrix.ty,_o=_b.resultMatrix.tx,_p=_b.resultMatrix.ty,_q=_o-_m,_r=_p-_n,_s=_q*_q+_r*_r,_t=Math.sqrt(_s),_u=(_q=_c-_a.resultMatrix.tx)*_q+(_r=_d-_a.resultMatrix.ty)*_r,_v=Math.sqrt(_u);if(_l+_t<=_v||_v+_l<=_t||_v+_t<=_l){var _w=NaN;_o=_m+(_w=_l+_t<=_v?1:-1)*(_c-_m)*_t/_v,_p=_n+_w*(_d-_n)*_t/_v}else{var _x=(_s-_k+_u)/(2*_u),_y=Math.sqrt(_s-_x*_x*_u)/_v,_z=_m+_q*_x,_A=_n+_r*_x,_B=-_r*_y,_C=_q*_y;_p=0<_e?(_o=_z-_B,_A-_C):(_o=_z+_B,_A+_C)}_g=_o,_h=_p,this.isDebug&&(this._sp||(this._sp=new _fa,_ea.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(_m,_n,15,"#ff00ff"),this._sp.graphics.drawCircle(_c,_d,15,"#ffff00"),this._sp.graphics.drawCircle(_g,_h,15,"#ff00ff"));var _D,_E;_D=Math.atan2(_h-_a.resultMatrix.ty,_g-_a.resultMatrix.tx),_a.setRotation(_D),(_E=_da._tempMatrix).identity(),_E.rotate(_D),_E.scale(_a.resultMatrix.getScaleX(),_a.resultMatrix.getScaleY()),_E.translate(_a.resultMatrix.tx,_a.resultMatrix.ty),_E.copyTo(_a.resultMatrix),_a.updateChild();var _F,_G;_F=Math.atan2(_d-_h,_c-_g),_b.setRotation(_F),(_G=_da._tempMatrix).identity(),_G.rotate(_F),_G.scale(_b.resultMatrix.getScaleX(),_b.resultMatrix.getScaleY()),_G.translate(_g,_h),_E.copyTo(_b.resultMatrix),_b.updateChild()}},_c(_da,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new _Ea}]),_da}(),_Na=function(){function _a(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return _d(_a,"laya.ani.bone.IkConstraintData"),_a}(),_v=function(){function _G(_a,_b){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=_a,this.position=_a.position,this.spacing=_a.spacing,this.rotateMix=_a.rotateMix,this.translateMix=_a.translateMix,this.bones=[];for(var _c=this.data.bones,_d=0,_e=_c.length;_d<_e;_d++)this.bones.push(_b[_c[_d]])}_d(_G,"laya.ani.bone.PathConstraint");var _a=_G.prototype;return _a.apply=function(_a,_b){if(this.target){var _c=this.translateMix,_d=this.translateMix,_e=0<_d,_f=this.data.spacingMode,_g="length"==_f,_h=this.data.rotateMode,_i="tangent"==_h,_j="chainScale"==_h,_k=[],_l=this.bones.length,_m=_i?_l:_l+1,_n=[];(this._spaces=_n)[0]=this.position;var _o=this.spacing;if(_j||_g)for(var _p=0,_q=_m-1;_p<_q;){var _r=this.bones[_p],_s=_r.length,_t=_s*_r.resultMatrix.a,_u=_s*_r.resultMatrix.b;_s=Math.sqrt(_t*_t+_u*_u),_j&&(_k[_p]=_s),_n[++_p]=_g?Math.max(0,_s+_o):_o}else for(_p=1;_p<_m;_p++)_n[_p]=_o;var _v=this.computeWorldPositions(this.target,_a,_b,_m,_i,"percent"==this.data.positionMode,"percent"==_f);if(this._debugKey){for(_p=0;_p<_v.length;_p++)_b.drawCircle(_v[_p++],_v[_p++],5,"#00ff00");var _w=[];for(_p=0;_p<_v.length;_p++)_w.push(_v[_p++],_v[_p++]);_b.drawLines(0,0,_w,"#ff0000")}var _x=_v[0],_y=_v[1],_z=this.data.offsetRotation,_A="chain"==_h&&0==_z,_B=NaN;for(_p=0,_B=3;_p<_l;_p++,_B+=3){(_r=this.bones[_p]).resultMatrix.tx+=(_x-_r.resultMatrix.tx)*_c,_r.resultMatrix.ty+=(_y-_r.resultMatrix.ty)*_c;var _C=(_t=_v[_B])-_x,_D=(_u=_v[_B+1])-_y;if(_j&&0!=(_s=_k[_p])){var _E=(Math.sqrt(_C*_C+_D*_D)/_s-1)*_d+1;_r.resultMatrix.a*=_E,_r.resultMatrix.c*=_E}if(_x=_t,_y=_u,_e){var _F=_r.resultMatrix.a,_G=_r.resultMatrix.c,_H=_r.resultMatrix.b,_I=_r.resultMatrix.d,_J=NaN,_K=NaN,_L=NaN;_J=_i?_v[_B-1]:0==_n[_p+1]?_v[_B+2]:Math.atan2(_D,_C),_J-=Math.atan2(_H,_F)-_z/180*Math.PI,_A&&(_K=Math.cos(_J),_L=Math.sin(_J),_x+=((_s=_r.length)*(_K*_F-_L*_H)-_C)*_d,_y+=(_s*(_L*_F+_K*_H)-_D)*_d),_J>Math.PI?_J-=2*Math.PI:_J<-Math.PI&&(_J+=2*Math.PI),_J*=_d,_K=Math.cos(_J),_L=Math.sin(_J),_r.resultMatrix.a=_K*_F-_L*_H,_r.resultMatrix.c=_K*_G-_L*_I,_r.resultMatrix.b=_L*_F+_K*_H,_r.resultMatrix.d=_L*_G+_K*_I}}}},_a.computeWorldVertices2=function(_a,_b,_c,_d,_e,_f){var _g,_h,_i=_a.currDisplayData.bones,_j=_a.currDisplayData.weights,_k=_a.currDisplayData.triangles,_l=0,_m=0,_n=0,_o=0,_p=0,_q=0,_r=0,_s=0,_t=0,_u=0,_v=0;if(null!=_i){for(_l=0;_l<_c;_l+=2)_m+=(_o=_i[_m])+1,_n+=_o;var _w=_b;for(_p=_f,_q=3*_n;_p<_d;_p+=2){for(_s=_r=0,_o=_i[_m++],_o+=_m;_m<_o;_m++,_q+=3){_g=_w[_i[_m]].resultMatrix,_t=_j[_q],_u=_j[_q+1];var _x=_j[_q+2];_r+=(_t*_g.a+_u*_g.c+_g.tx)*_x,_s+=(_t*_g.b+_u*_g.d+_g.ty)*_x}_e[_p]=_r,_e[_p+1]=_s}}else{var _y,_z;if(_k||(_k=_j),_a.deformData&&(_k=_a.deformData),_y=_a.parent,_b)for(_v=_b.length,_l=0;_l<_v;_l++)if(_b[_l].name==_y){_h=_b[_l];break}_h&&(_z=_h.resultMatrix),_z||(_z=_G._tempMt);var _A=_z.tx,_B=_z.ty,_C=_z.a,_D=_z.b,_E=_z.c,_F=_z.d;for(_h&&(_F*=_h.d),_m=_c,_p=_f;_p<_d;_m+=2,_p+=2)_t=_k[_m],_u=_k[_m+1],_e[_p]=_t*_C+_u*_D+_A,_e[_p+1]=-(_t*_E+_u*_F+_B)}},_a.computeWorldPositions=function(_a,_b,_c,_d,_e,_f,_g){_a.currDisplayData.bones,_a.currDisplayData.weights,_a.currDisplayData.triangles;var _h=[],_i=0,_j=_a.currDisplayData.verLen,_k=this.position,_l=this._spaces,_m=[],_n=[],_o=_j/6,_p=-1,_q=NaN,_r=0,_s=0,_t=NaN,_u=NaN,_v=NaN,_w=NaN;if(_o--,_j-=4,this.computeWorldVertices2(_a,_b,2,_j,_h,0),this._debugKey)for(_i=0;_i<_h.length;)_c.drawCircle(_h[_i++],_h[_i++],10,"#ff0000");_m=_h,this._curves.length=_o;var _x=this._curves,_y=_m[_q=0],_z=_m[1],_A=0,_B=0,_C=0,_D=0,_E=0,_F=0,_G=NaN,_H=NaN,_I=NaN,_J=NaN,_K=NaN,_L=NaN,_M=NaN,_N=NaN,_O=0;for(_i=0,_O=2;_i<_o;_i++,_O+=6)_A=_m[_O],_B=_m[_O+1],_C=_m[_O+2],_D=_m[_O+3],_K=2*(_G=.1875*(_y-2*_A+_C))+(_I=.09375*(3*(_A-_C)-_y+(_E=_m[_O+4]))),_L=2*(_H=.1875*(_z-2*_B+_D))+(_J=.09375*(3*(_B-_D)-_z+(_F=_m[_O+5]))),_M=.75*(_A-_y)+_G+.16666667*_I,_N=.75*(_B-_z)+_H+.16666667*_J,_q+=Math.sqrt(_M*_M+_N*_N),_M+=_K,_N+=_L,_K+=_I,_L+=_J,_q+=Math.sqrt(_M*_M+_N*_N),_M+=_K,_N+=_L,_q+=Math.sqrt(_M*_M+_N*_N),_M+=_K+_I,_N+=_L+_J,_q+=Math.sqrt(_M*_M+_N*_N),_x[_i]=_q,_y=_E,_z=_F;if(_f&&(_k*=_q),_g)for(_i=0;_i<_d;_i++)_l[_i]*=_q;var _P=this._segments,_Q=0,_R=0;for(_R=_s=_r=_i=0;_i<_d;_i++,_r+=3)if((_t=_k+=_u=_l[_i])<0)this.addBeforePosition(_t,_m,0,_n,_r);else if(_q<_t)this.addAfterPosition(_t-_q,_m,_j-4,_n,_r);else{for(;;_s++)if(!((_w=_x[_s])<_t)){0==_s?_t/=_w:_t=(_t-(_v=_x[_s-1]))/(_w-_v);break}if(_s!=_p){var _S=6*(_p=_s);for(_y=_m[_S],_z=_m[_S+1],_A=_m[_S+2],_B=_m[_S+3],_C=_m[_S+4],_D=_m[_S+5],_K=2*(_G=.03*(_y-2*_A+_C))+(_I=.006*(3*(_A-_C)-_y+(_E=_m[_S+6]))),_L=2*(_H=.03*(_z-2*_B+_D))+(_J=.006*(3*(_B-_D)-_z+(_F=_m[_S+7]))),_M=.3*(_A-_y)+_G+.16666667*_I,_N=.3*(_B-_z)+_H+.16666667*_J,_Q=Math.sqrt(_M*_M+_N*_N),_P[0]=_Q,_S=1;_S<8;_S++)_M+=_K,_N+=_L,_K+=_I,_L+=_J,_Q+=Math.sqrt(_M*_M+_N*_N),_P[_S]=_Q;_M+=_K,_N+=_L,_Q+=Math.sqrt(_M*_M+_N*_N),_P[8]=_Q,_M+=_K+_I,_N+=_L+_J,_Q+=Math.sqrt(_M*_M+_N*_N),_P[9]=_Q,_R=0}for(_t*=_Q;;_R++)if(!((_w=_P[_R])<_t)){0==_R?_t/=_w:_t=_R+(_t-(_v=_P[_R-1]))/(_w-_v);break}this.addCurvePosition(.1*_t,_y,_z,_A,_B,_C,_D,_E,_F,_n,_r,_e||0<_i&&0==_u)}return _n},_a.addBeforePosition=function(_a,_b,_c,_d,_e){var _f=_b[_c],_g=_b[_c+1],_h=_b[_c+2]-_f,_i=_b[_c+3]-_g,_j=Math.atan2(_i,_h);_d[_e]=_f+_a*Math.cos(_j),_d[_e+1]=_g+_a*Math.sin(_j),_d[_e+2]=_j},_a.addAfterPosition=function(_a,_b,_c,_d,_e){var _f=_b[_c+2],_g=_b[_c+3],_h=_f-_b[_c],_i=_g-_b[_c+1],_j=Math.atan2(_i,_h);_d[_e]=_f+_a*Math.cos(_j),_d[_e+1]=_g+_a*Math.sin(_j),_d[_e+2]=_j},_a.addCurvePosition=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l){0==_a&&(_a=1e-4);var _m=_a*_a,_n=_m*_a,_o=1-_a,_p=_o*_o,_q=_p*_o,_r=_o*_a,_s=3*_r,_t=_o*_s,_u=_s*_a,_v=_b*_q+_d*_t+_f*_u+_h*_n,_w=_c*_q+_e*_t+_g*_u+_i*_n;_j[_k]=_v,_j[_k+1]=_w,_j[_k+2]=_l?Math.atan2(_w-(_c*_p+_e*_r*2+_g*_m),_v-(_b*_p+_d*_r*2+_f*_m)):0},_G.NONE=-1,_G.BEFORE=-2,_G.AFTER=-3,_c(_G,["_tempMt",function(){return this._tempMt=new _Ea}]),_G}(),_Oa=function(){function _a(){this.name=null,this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return _d(_a,"laya.ani.bone.PathConstraintData"),_a}(),_Pa=function(){function _a(){this.name=null,this.slotArr=[]}return _d(_a,"laya.ani.bone.SkinData"),_a}(),_Qa=function(){function _a(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}_d(_a,"laya.ani.bone.SkinSlotDisplayData");var _b=_a.prototype;return _b.createTexture=function(_a){return this.texture||(this.texture=new _Fa(_a.bitmap,this.uvs),_a.bitmap.alphaTexture&&(this.texture.alphaTexture=new _Fa(_a.bitmap.alphaTexture,this.uvs)),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=_a.height,this.texture.height=_a.width,this.texture.offsetX=-_a.offsetX,this.texture.offsetY=-_a.offsetY,this.texture.sourceWidth=_a.sourceHeight,this.texture.sourceHeight=_a.sourceWidth):(this.texture.width=_a.width,this.texture.height=_a.height,this.texture.offsetX=-_a.offsetX,this.texture.offsetY=-_a.offsetY,this.texture.sourceWidth=_a.sourceWidth,this.texture.sourceHeight=_a.sourceHeight),_q.isWebGL||this.uvs[1]>this.uvs[5]&&(this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY)),this.texture},_b.destory=function(){this.texture&&this.texture.destroy()},_a}(),_Ra=function(){function _a(){this.name=null,this.displayArr=[]}return _d(_a,"laya.ani.bone.SlotData"),_a.prototype.getDisplayByName=function(_a){for(var _b=0,_c=this.displayArr.length;_b<_c;_b++)if(this.displayArr[_b].attachmentName==_a)return _b;return-1},_a}(),_w=function(){function _a(_a,_b){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=_p(2,0),this._data=_a,null==this._bones&&(this._bones=[]),this.target=_b[_a.targetIndex];var _c,_d=0;for(_d=0,_c=_a.boneIndexs.length;_d<_c;_d++)this._bones.push(_b[_a.boneIndexs[_d]]);this.rotateMix=_a.rotateMix,this.translateMix=_a.translateMix,this.scaleMix=_a.scaleMix,this.shearMix=_a.shearMix}return _d(_a,"laya.ani.bone.TfConstraint"),_a.prototype.apply=function(){for(var _a,_b=this.target.resultMatrix.a,_c=this.target.resultMatrix.b,_d=this.target.resultMatrix.c,_e=this.target.resultMatrix.d,_f=0,_g=this._bones.length;_f<_g;_f++){if(_a=this._bones[_f],0<this.rotateMix){var _h=_a.resultMatrix.a,_i=_a.resultMatrix.b,_j=_a.resultMatrix.c,_k=_a.resultMatrix.d,_l=Math.atan2(_d,_b)-Math.atan2(_j,_h)+this._data.offsetRotation*Math.PI/180;_l>Math.PI?_l-=2*Math.PI:_l<-Math.PI&&(_l+=2*Math.PI),_l*=this.rotateMix;var _m=Math.cos(_l),_n=Math.sin(_l);_a.resultMatrix.a=_m*_h-_n*_j,_a.resultMatrix.b=_m*_i-_n*_k,_a.resultMatrix.c=_n*_h+_m*_j,_a.resultMatrix.d=_n*_i+_m*_k}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),_a.resultMatrix.tx+=(this._temp[0]-_a.resultMatrix.tx)*this.translateMix,_a.resultMatrix.ty+=(this._temp[1]-_a.resultMatrix.ty)*this.translateMix,_a.updateChild()),0<this.scaleMix){var _o=Math.sqrt(_a.resultMatrix.a*_a.resultMatrix.a+_a.resultMatrix.c*_a.resultMatrix.c),_p=Math.sqrt(_b*_b+_d*_d),_q=1e-5<_o?(_o+(_p-_o+this._data.offsetScaleX)*this.scaleMix)/_o:0;_a.resultMatrix.a*=_q,_a.resultMatrix.c*=_q,_o=Math.sqrt(_a.resultMatrix.b*_a.resultMatrix.b+_a.resultMatrix.d*_a.resultMatrix.d),_p=Math.sqrt(_c*_c+_e*_e),_q=1e-5<_o?(_o+(_p-_o+this._data.offsetScaleY)*this.scaleMix)/_o:0,_a.resultMatrix.b*=_q,_a.resultMatrix.d*=_q}if(0<this.shearMix){_i=_a.resultMatrix.b,_k=_a.resultMatrix.d;var _r=Math.atan2(_k,_i);(_l=Math.atan2(_e,_c)-Math.atan2(_d,_b)-(_r-Math.atan2(_a.resultMatrix.c,_a.resultMatrix.a)))>Math.PI?_l-=2*Math.PI:_l<-Math.PI&&(_l+=2*Math.PI),_l=_r+(_l+this._data.offsetShearY*Math.PI/180)*this.shearMix,_q=Math.sqrt(_i*_i+_k*_k),_a.resultMatrix.b=Math.cos(_l)*_q,_a.resultMatrix.d=Math.sin(_l)*_q}}},_a}(),_Sa=function(){function _a(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return _d(_a,"laya.ani.bone.TfConstraintData"),_a}(),_Ta=function(){function _a(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}_d(_a,"laya.ani.bone.Transform");var _b=_a.prototype;return _b.initData=function(_a){null!=_a.x&&(this.x=_a.x),null!=_a.y&&(this.y=_a.y),null!=_a.skX&&(this.skX=_a.skX),null!=_a.skY&&(this.skY=_a.skY),null!=_a.scX&&(this.scX=_a.scX),null!=_a.scY&&(this.scY=_a.scY)},_b.getMatrix=function(){var _a;return(_a=this.mMatrix?this.mMatrix:this.mMatrix=new _Ea).identity(),_a.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(_a,this.skewX*Math.PI/180,this.skewY*Math.PI/180),_a.rotate(this.skX*Math.PI/180),_a.translate(this.x,this.y),_a},_b.skew=function(_a,_b,_c){var _d=Math.sin(_c),_e=Math.cos(_c),_f=Math.sin(_b),_g=Math.cos(_b);return _a.setTo(_a.a*_g-_a.b*_d,_a.a*_f+_a.b*_e,_a.c*_g-_a.d*_d,_a.c*_f+_a.d*_e,_a.tx*_g-_a.ty*_d,_a.tx*_f+_a.ty*_e),_a},_a}(),_x=function(){function _a(){}return _d(_a,"laya.ani.bone.UVTools"),_a.getRelativeUV=function(_a,_b,_c){var _d=_a[0],_e=_a[2]-_a[0],_f=_a[1],_g=_a[5]-_a[1];_c||(_c=[]),_c.length=_b.length;var _h,_i=0;_h=_c.length;var _j=1/_e,_k=1/_g;for(_i=0;_i<_h;_i+=2)_c[_i]=(_b[_i]-_d)*_j,_c[_i+1]=(_b[_i+1]-_f)*_k;return _c},_a.getAbsoluteUV=function(_a,_b,_c){if(0==_a[0]&&0==_a[1]&&1==_a[4]&&1==_a[5])return _c?(_r.copyArray(_c,_b),_c):_b;var _d=_a[0],_e=_a[2]-_a[0],_f=_a[1],_g=_a[5]-_a[1];_c||(_c=[]),_c.length=_b.length;var _h,_i=0;for(_h=_c.length,_i=0;_i<_h;_i+=2)_c[_i]=_b[_i]*_e+_d,_c[_i+1]=_b[_i+1]*_g+_f;return _c},_a}(),_G=function(){function _a(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.nextData=null}return _d(_a,"laya.ani.KeyFramesContent"),_a}(),_y=function(){function _k(){}return _d(_k,"laya.ani.math.BezierLerp"),_k.getBezierRate=function(_a,_b,_c,_d,_e){var _f=_k._getBezierParamKey(_b,_c,_d,_e),_g=100*_f+_a;if(_k._bezierResultCache[_g])return _k._bezierResultCache[_g];var _h,_i=_k._getBezierPoints(_b,_c,_d,_e,_f),_j=0;for(_h=_i.length,_j=0;_j<_h;_j+=2)if(_a<=_i[_j])return _k._bezierResultCache[_g]=_i[_j+1],_i[_j+1];return _k._bezierResultCache[_g]=1},_k._getBezierParamKey=function(_a,_b,_c,_d){return 100*(100*(100*(100*_a+_b)+_c)+_d)},_k._getBezierPoints=function(_a,_b,_c,_d,_e){return _k._bezierPointsCache[_e]?_k._bezierPointsCache[_e]:(_f=[0,0,_a,_b,_c,_d,1,1],_g=(new _h).getBezierPoints(_f,100,3),_k._bezierPointsCache[_e]=_g);var _f,_g},_k._bezierResultCache={},_k._bezierPointsCache={},_k}(),_z=function(_a){function _b(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,_b.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}_d(_b,"laya.ani.AnimationPlayer",_e);var _c=_b.prototype;return _ea.imps(_c,{"laya.resource.IDestroy":!0}),_c._onTempletLoadedComputeFullKeyframeIndices=function(_a,_b,_c){this._templet===_c&&this._cachePlayRate===_a&&this._cacheFrameRate===_b&&this._computeFullKeyframeIndices()},_c._computeFullKeyframeIndices=function(){for(var _a=this._fullFrames=[],_b=this._templet,_c=this._cacheFrameRateInterval*this._cachePlayRate,_d=0,_e=_b.getAnimationCount();_d<_e;_d++){for(var _f=[],_g=0,_h=_b.getAnimation(_d).nodes.length;_g<_h;_g++){for(var _i=_b.getAnimation(_d).nodes[_g],_j=Math.floor(_i.playTime/_c+.01),_k=new Uint16Array(_j+1),_l=-1,_m=0,_n=_i.keyFrame.length;_m<_n;_m++){var _o=_i.keyFrame[_m],_p=_o.startTime,_q=_p+_o.duration+_c;do{for(var _r=Math.floor(_p/_c+.5),_s=_l+1;_s<_r;_s++)_k[_s]=_m;_k[_l=_r]=_m,_p+=_c}while(_p<=_q)}_f.push(_k)}_a.push(_f)}},_c._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},_c._calculatePlayDuration=function(){if(0!==this.state){var _a=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=_a),this._playEnd>_a&&(this._playEnd=_a),this._playDuration=this._playEnd-this._playStart}},_c._setPlayParams=function(_a,_b){this._currentTime=_a,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/_b+.01),0),this._currentFrameTime=this._currentKeyframeIndex*_b},_c._setPlayParamsWhenStop=function(_a,_b){this._currentTime=_a,this._currentKeyframeIndex=Math.max(Math.floor(_a/_b+.01),0),this._currentFrameTime=this._currentKeyframeIndex*_b,this._currentAnimationClipIndex=-1},_c._update=function(_a){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var _b=this._cacheFrameRateInterval*this._cachePlayRate,_c=0;this._startUpdateLoopCount!==_o.loopCount&&(_c=_a*this.playbackRate,this._elapsedPlaybackTime+=_c);var _d=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=_d)return this._setPlayParamsWhenStop(_d,_b),void this.event("stopped");if(_c+=this._currentTime,0<_d)if(_d<=_c)do{if(_c-=_d,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(_d,_b),this._stopWhenCircleFinish=!1,void this.event("stopped");_c<_d&&(this._setPlayParams(_c,_b),this.event("complete"))}while(_d<=_c);else this._setPlayParams(_c,_b);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(_d,_b),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},_c._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},_c.play=function(_a,_b,_c,_d,_e){if(void 0===_a&&(_a=0),void 0===_b&&(_b=1),void 0===_c&&(_c=2147483647),void 0===_d&&(_d=0),void 0===_e&&(_e=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(_c<0||_d<0||_e<0)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==_e&&_e<_d)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=_b,this._overallDuration=_c,this._playStart=_d,this._playEnd=_e,this._paused=!1,this._currentAnimationClipIndex=_a,this._currentKeyframeIndex=0,this._startUpdateLoopCount=_o.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},_c.playByFrame=function(_a,_b,_c,_d,_e,_f){void 0===_a&&(_a=0),void 0===_b&&(_b=1),void 0===_c&&(_c=2147483647),void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_f&&(_f=30);var _g=1e3/_f;this.play(_a,_b,_c,_d*_g,_e*_g)},_c.stop=function(_a){void 0===_a&&(_a=!0),_a?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},_f(0,_c,"playEnd",function(){return this._playEnd}),_f(0,_c,"templet",function(){return this._templet},function(_a){0===!this.state&&this.stop(!0),this._templet!==_a&&((this._templet=_a).loaded?this._computeFullKeyframeIndices():_a.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),_f(0,_c,"playStart",function(){return this._playStart}),_f(0,_c,"playDuration",function(){return this._playDuration}),_f(0,_c,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),_f(0,_c,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),_f(0,_c,"overallDuration",function(){return this._overallDuration}),_f(0,_c,"currentFrameTime",function(){return this._currentFrameTime}),_f(0,_c,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),_f(0,_c,"currentPlayTime",function(){return this._currentTime+this._playStart}),_f(0,_c,"cachePlayRate",function(){return this._cachePlayRate},function(_a){this._cachePlayRate!==_a&&(this._cachePlayRate=_a,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[_a,this._cacheFrameRate])))}),_f(0,_c,"cacheFrameRate",function(){return this._cacheFrameRate},function(_a){this._cacheFrameRate!==_a&&(this._cacheFrameRate=_a,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,_a])))}),_f(0,_c,"currentTime",null,function(_a){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(_a<this._playStart||_a>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=_o.loopCount;var _b=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=_a,this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/_b),0),this._currentFrameTime=this._currentKeyframeIndex*_b}}),_f(0,_c,"paused",function(){return this._paused},function(_a){(this._paused=_a)&&this.event("paused")}),_f(0,_c,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),_f(0,_c,"destroyed",function(){return this._destroyed}),_b}(),_H=function(_a){function _b(){_b.__super.call(this),_q.isConchNode&&(this.drawSkin=function(_a){_a.transform||(_a.transform=_Ea.EMPTY),this._addCmd([_a]),this.setSkinMesh&&this.setSkinMesh(_a._ps,_a.mVBData,_a.mEleNum,0,_a.mTexture,_a.transform)})}return _d(_b,"laya.ani.GraphicsAni",_g),_b.prototype.drawSkin=function(_a){var _b=[_a];this._saveToCmd(_q._context._drawSkin,_b)},_b.create=function(){return _b._caches.pop()||new _b},_b.recycle=function(_a){_a.clear(),_b._caches.push(_a)},_b._caches=[],_b}(),_I=function(_a){function _s(){this._aniMap={},this.unfixedLastAniIndex=-1,_s.__super.call(this),this._anis=new Array}_d(_s,"laya.ani.AnimationTemplet",_k);var _b=_s.prototype;return _b.parse=function(_a){var _b=new _Da(_a);this._aniVersion=_b.readUTFString(),_t.parse(this,_b)},_b._calculateKeyFrame=function(_a,_b,_c){var _d=_a.keyFrame;_d[_b]=_d[0];for(var _e=0;_e<_b;_e++){var _f=_d[_e];_f.nextData=0===_f.duration?_f.data:_d[_e+1].data}_d.length--},_b.onAsynLoaded=function(_a,_b,_c){var _d=new _Da(_b);switch(this._aniVersion=_d.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":_u.parse(this,_d);break;default:_t.parse(this,_d)}this._endLoaded()},_b.disposeResource=function(){this._aniVersion=null,this._anis=null,this._aniMap=null,this._publicExtData=null,this.unfixedCurrentFrameIndexes=null,this.unfixedCurrentTimes=null,this.unfixedKeyframes=null,this._aniClassName=null,this._animationDatasCache=null},_b.getAnimationCount=function(){return this._anis.length},_b.getAnimation=function(_a){return this._anis[_a]},_b.getAniDuration=function(_a){return this._anis[_a].playTime},_b.getNodes=function(_a){return this._anis[_a].nodes},_b.getNodeIndexWithName=function(_a,_b){return this._anis[_a].bone3DMap[_b]},_b.getNodeCount=function(_a){return this._anis[_a].nodes.length},_b.getTotalkeyframesLength=function(_a){return this._anis[_a].totalKeyframeDatasLength},_b.getPublicExtData=function(){return this._publicExtData},_b.getAnimationDataWithCache=function(_a,_b,_c,_d){var _e=_b[_c];if(_e){var _f=_e[_a];return _f?_f[_d]:null}return null},_b.setAnimationDataWithCache=function(_a,_b,_c,_d,_e){var _f=_b[_c]||(_b[_c]={});(_f[_a]||(_f[_a]=[]))[_d]=_e},_b.getOriginalData=function(_a,_b,_c,_d,_e){for(var _f=this._anis[_a].nodes,_g=0,_h=0,_i=_f.length,_j=0;_h<_i;_h++){var _k,_l=_f[_h];_k=_l.keyFrame[_c[_h][_d]],_l.dataOffset=_j;var _m=_e-_k.startTime,_n=_l.lerpType;if(_n)switch(_n){case 0:case 1:for(_g=0;_g<_l.keyframeWidth;)_g+=_l.interpolationMethod[_g](_l,_g,_b,_j+_g,_k.data,_m,null,_k.duration,_k.nextData);break;case 2:var _o=_k.interpolationData,_p=_o.length,_q=0;for(_g=0;_g<_p;){var _r=_o[_g];switch(_r){case 6:case 7:_g+=_s.interpolation[_r](_l,_q,_b,_j+_q,_k.data,_m,null,_k.duration,_k.nextData,_o,_g+1);break;default:_g+=_s.interpolation[_r](_l,_q,_b,_j+_q,_k.data,_m,null,_k.duration,_k.nextData)}_q++}}else for(_g=0;_g<_l.keyframeWidth;)_g+=_l.interpolationMethod[_g](_l,_g,_b,_j+_g,_k.data,_m,null,_k.duration,_k.nextData);_j+=_l.keyframeWidth}},_b.getNodesCurrentFrameIndex=function(_a,_b){var _c=this._anis[_a].nodes;_a!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(_c.length),this.unfixedCurrentTimes=new Float32Array(_c.length),this.unfixedLastAniIndex=_a);for(var _d=0,_e=_c.length;_d<_e;_d++){var _f=_c[_d];for(_b<this.unfixedCurrentTimes[_d]&&(this.unfixedCurrentFrameIndexes[_d]=0),this.unfixedCurrentTimes[_d]=_b;this.unfixedCurrentFrameIndexes[_d]<_f.keyFrame.length&&!(_f.keyFrame[this.unfixedCurrentFrameIndexes[_d]].startTime>this.unfixedCurrentTimes[_d]);)this.unfixedCurrentFrameIndexes[_d]++;this.unfixedCurrentFrameIndexes[_d]--}return this.unfixedCurrentFrameIndexes},_b.getOriginalDataUnfixedRate=function(_a,_b,_c){var _d=this._anis[_a].nodes;_a!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(_d.length),this.unfixedCurrentTimes=new Float32Array(_d.length),this.unfixedKeyframes=_p(_d.length),this.unfixedLastAniIndex=_a);for(var _e=0,_f=0,_g=_d.length,_h=0;_f<_g;_f++){var _i=_d[_f];for(_c<this.unfixedCurrentTimes[_f]&&(this.unfixedCurrentFrameIndexes[_f]=0),this.unfixedCurrentTimes[_f]=_c;this.unfixedCurrentFrameIndexes[_f]<_i.keyFrame.length&&!(_i.keyFrame[this.unfixedCurrentFrameIndexes[_f]].startTime>this.unfixedCurrentTimes[_f]);)this.unfixedKeyframes[_f]=_i.keyFrame[this.unfixedCurrentFrameIndexes[_f]],this.unfixedCurrentFrameIndexes[_f]++;var _j=this.unfixedKeyframes[_f];_i.dataOffset=_h;var _k=_c-_j.startTime;if(_i.lerpType)switch(_i.lerpType){case 0:case 1:for(_e=0;_e<_i.keyframeWidth;)_e+=_i.interpolationMethod[_e](_i,_e,_b,_h+_e,_j.data,_k,null,_j.duration,_j.nextData);break;case 2:var _l=_j.interpolationData,_m=_l.length,_n=0;for(_e=0;_e<_m;){var _o=_l[_e];switch(_o){case 6:case 7:_e+=_s.interpolation[_o](_i,_n,_b,_h+_n,_j.data,_k,null,_j.duration,_j.nextData,_l,_e+1);break;default:_e+=_s.interpolation[_o](_i,_n,_b,_h+_n,_j.data,_k,null,_j.duration,_j.nextData)}_n++}}else for(_e=0;_e<_i.keyframeWidth;)_e+=_i.interpolationMethod[_e](_i,_e,_b,_h+_e,_j.data,_k,null,_j.duration,_j.nextData);_h+=_i.keyframeWidth}},_s._LinearInterpolation_0=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){var _k=0===_h?0:_f/_h;return _c[_d]=(1-_k)*_e[_b]+_k*_i[_b],1},_s._QuaternionInterpolation_1=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){var _k=0===_h?0:_f/_h;return _m.slerpQuaternionArray(_e,_b,_i,_b,_k,_c,_d),4},_s._AngleInterpolation_2=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return 0},_s._RadiansInterpolation_3=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return 0},_s._Matrix4x4Interpolation_4=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){for(var _k=0;_k<16;_k++,_b++)_c[_d+_k]=_e[_b]+_f*_g[_b];return 16},_s._NoInterpolation_5=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j){return _c[_d]=_e[_b],1},_s._BezierInterpolation_6=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k){return void 0===_k&&(_k=0),_c[_d]=_e[_b]+(_i[_b]-_e[_b])*_y.getBezierRate(_f/_h,_j[_k],_j[_k+1],_j[_k+2],_j[_k+3]),5},_s._BezierInterpolation_7=function(_a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k){return void 0===_k&&(_k=0),_c[_d]=_j[_k+4]+_j[_k+5]*_y.getBezierRate((.001*_f+_j[_k+6])/_j[_k+7],_j[_k],_j[_k+1],_j[_k+2],_j[_k+3]),9},_s.load=function(_a){return _ea.loader.create(_a,null,null,_s)},_s.interpolation=[_s._LinearInterpolation_0,_s._QuaternionInterpolation_1,_s._AngleInterpolation_2,_s._RadiansInterpolation_3,_s._Matrix4x4Interpolation_4,_s._NoInterpolation_5,_s._BezierInterpolation_6,_s._BezierInterpolation_7],_s}(),_A=function(_b){function _c(_a,_b){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,_c.__super.call(this),void 0===_b&&(_b=0),_a&&this.init(_a,_b)}_d(_c,"laya.ani.bone.Skeleton",_b);var _a=_c.prototype;return _a.init=function(_a,_b){void 0===_b&&(_b=0);var _c,_d,_e,_f=0,_g=0;if(1==_b)for(this._graphicsCache=[],_f=0,_g=_a.getAnimationCount();_f<_g;_f++)this._graphicsCache.push([]);if(this._yReverseMatrix=_a.yReverseMatrix,this._aniMode=_b,this._templet=_a,this._player=new _z,this._player.cacheFrameRate=_a.rate,this._player.templet=_a,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=_a.mBoneArr,this._rootBone=_a.mRootBone,this._aniSectionDic=_a.aniSectionDic,0<_a.ikArr.length)for(this._ikArr=[],_f=0,_g=_a.ikArr.length;_f<_g;_f++)this._ikArr.push(new _s(_a.ikArr[_f],this._boneList));if(0<_a.pathArr.length)for(null==this._pathDic&&(this._pathDic={}),_f=0,_g=_a.pathArr.length;_f<_g;_f++)_c=_a.pathArr[_f],_d=new _v(_c,this._boneList),(_e=this._boneSlotDic[_c.name])&&((_d=new _v(_c,this._boneList)).target=_e),this._pathDic[_c.name]=_d;if(0<_a.tfArr.length)for(this._tfArr=[],_f=0,_g=_a.tfArr.length;_f<_g;_f++)this._tfArr.push(new _w(_a.tfArr[_f],this._boneList));if(0<_a.skinDataArray.length){var _h=this._templet.skinDataArray[this._skinIndex];this._skinName=_h.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},_a.load=function(_a,_b,_c){},_a._onLoaded=function(){},_a._parseComplete=function(){var _a=_B.TEMPLET_DICTIONARY[this._aniPath];_a&&(this.init(_a,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},_a._parseFail=function(){console.error("[Error]:"+this._aniPath+"解析失败")},_a._onPlay=function(){this.event("played")},_a._onStop=function(){var _a,_b=this._templet.eventAniArr[this._aniClipIndex];if(_b&&this._eventIndex<_b.length)for(;this._eventIndex<_b.length;this._eventIndex++)(_a=_b[this._eventIndex]).time>=this._player.playStart&&_a.time<=this._player.playEnd&&this.event("label",_a);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},_a._onPause=function(){this.event("paused")},_a._parseSrcBoneMatrix=function(){var _a=0,_b=0;for(_b=this._templet.srcBoneMatrixArr.length,_a=0;_a<_b;_a++)this._boneMatrixArray.push(new _Ea);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var _c,_d,_e=this._templet.boneSlotArray;for(_a=0,_b=_e.length;_a<_b;_a++)_c=_e[_a],null==(_d=this._bindBoneBoneSlotDic[_c.parent])&&(this._bindBoneBoneSlotDic[_c.parent]=_d=[]),this._boneSlotDic[_c.name]=_c=_c.copy(),_d.push(_c),this._boneSlotArray.push(_c)}},_a._emitMissedEvents=function(_a,_b,_c){void 0===_c&&(_c=0);var _d=this._templet.eventAniArr[this._player.currentAnimationClipIndex];if(_d){var _e,_f,_g=0;for(_e=_d.length,_g=_c;_g<_e;_g++)(_f=_d[_g]).time>=this._player.playStart&&_f.time<=this._player.playEnd&&this.event("label",_f)}},_a._update=function(_a){if(void 0===_a&&(_a=!0),!(this._pause||_a&&this._indexControl)){var _b=this.timer.currTimer,_c=this._player.currentKeyframeIndex,_d=_b-this._lastTime;if(_a?this._player._update(_d):_c=-1,this._lastTime=_b,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||0<_d&&this._clipIndex==_c&&this._lastUpdateAniClipIndex==this._aniClipIndex))){var _e;this._lastUpdateAniClipIndex=this._aniClipIndex,_c>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var _f,_g=this._templet.eventAniArr[this._aniClipIndex];if(_g&&this._eventIndex<_g.length&&((_e=_g[this._eventIndex]).time>=this._player.playStart&&_e.time<=this._player.playEnd?this._player.currentPlayTime>=_e.time&&(this.event("label",_e),this._eventIndex++):this._eventIndex++),0==this._aniMode){if(_f=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=_f&&(this.graphics=_f));var _h=0,_i=0;for(_i=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,_i-1)&&0<_i;)_i--;if(_i<this._clipIndex)for(_h=_i;_h<this._clipIndex;_h++)this._createGraphics(_h)}else if(1==this._aniMode){if(_f=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=_f&&(this.graphics=_f));for(_i=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,_i-1)&&0<_i;)_i--;if(_i<this._clipIndex)for(_h=_i;_h<this._clipIndex;_h++)this._createGraphics(_h)}this._createGraphics()}}},_a._createGraphics=function(_a){void 0===_a&&(_a=-1),-1==_a&&(_a=this._clipIndex);var _b,_c,_d=_a*this._player.cacheFrameRateInterval,_e=this._templet.drawOrderAniArr[this._aniClipIndex];if(_e&&0<_e.length)for(this._drawOrderIndex=0,_b=_e[this._drawOrderIndex];_d>=_b.time&&(this._drawOrder=_b.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=_e.length));)_b=_e[this._drawOrderIndex];0==this._aniMode||1==this._aniMode?this.graphics=_H.create():this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=_H.create(),_c=this.graphics;var _f=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],_a,_d);var _g,_h,_i,_j,_k=this._aniSectionDic[this._aniClipIndex],_l=0,_m=0,_n=0,_o=0,_p=0,_q=this._templet.srcBoneMatrixArr.length;for(_p=_k[_m=0];_m<_q;_m++)_j=this._boneList[_m],_i=this._templet.srcBoneMatrixArr[_m],_j.resultTransform.scX=_i.scX*this._curOriginalData[_l++],_j.resultTransform.skX=_i.skX+this._curOriginalData[_l++],_j.resultTransform.skY=_i.skY+this._curOriginalData[_l++],_j.resultTransform.scY=_i.scY*this._curOriginalData[_l++],_j.resultTransform.x=_i.x+this._curOriginalData[_l++],_j.resultTransform.y=_i.y+this._curOriginalData[_l++],8===this._templet.tMatrixDataLen&&(_j.resultTransform.skewX=_i.skewX+this._curOriginalData[_l++],_j.resultTransform.skewY=_i.skewY+this._curOriginalData[_l++]);var _r,_s={},_t={};for(_p+=_k[1];_m<_p;_m++)_s[(_r=_f[_m]).name]=this._curOriginalData[_l++],_t[_r.name]=this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++];var _u,_v,_w={},_x={};for(_p+=_k[2];_m<_p;_m++)_w[(_r=_f[_m]).name]=this._curOriginalData[_l++],_x[_r.name]=this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++],this._curOriginalData[_l++];if(this._pathDic)for(_p+=_k[3];_m<_p;_m++){if(_r=_f[_m],_u=this._pathDic[_r.name])switch(new _Da(_r.extenData).getByte()){case 1:_u.position=this._curOriginalData[_l++];break;case 2:_u.spacing=this._curOriginalData[_l++];break;case 3:_u.rotateMix=this._curOriginalData[_l++],_u.translateMix=this._curOriginalData[_l++]}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(_Ea.TEMP.identity()),this._ikArr)for(_m=0,_p=this._ikArr.length;_m<_p;_m++)_v=this._ikArr[_m],_w.hasOwnProperty(_v.name)&&(_v.bendDirection=_w[_v.name]),_x.hasOwnProperty(_v.name)&&(_v.mix=_x[_v.name]),_v.apply();if(this._pathDic)for(var _y in this._pathDic)(_u=this._pathDic[_y]).apply(this._boneList,_c);if(this._tfArr)for(_m=0,_o=this._tfArr.length;_m<_o;_m++)this._tfArr[_m].apply();for(_m=0,_o=this._boneList.length;_m<_o;_m++)if(_j=this._boneList[_m],_h=this._bindBoneBoneSlotDic[_j.name],_j.resultMatrix.copyTo(this._boneMatrixArray[_m]),_h)for(_n=0,_p=_h.length;_n<_p;_n++)(_g=_h[_n])&&_g.setParentMatrix(_j.resultMatrix);var _z,_A,_B,_C,_D={},_E=this._templet.deformAniArr;if(_E&&0<_E.length){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,_m=0,_p=this._boneSlotArray.length;_m<_p;_m++)(_g=this._boneSlotArray[_m]).deformData=null;var _F,_G=_E[this._aniClipIndex];for(_F in _z=_G.default,this._setDeform(_z,_D,this._boneSlotArray,_d),_G)"default"!=_F&&_F!=this._skinName&&(_z=_G[_F],this._setDeform(_z,_D,this._boneSlotArray,_d));_z=_G[this._skinName],this._setDeform(_z,_D,this._boneSlotArray,_d)}if(this._drawOrder)for(_m=0,_p=this._drawOrder.length;_m<_p;_m++)_A=_s[(_g=this._boneSlotArray[this._drawOrder[_m]]).name],_B=_t[_g.name],isNaN(_B)||(_c.save(),_c.alpha(_B)),isNaN(_A)||-2==_A||(this._templet.attachmentNames?_g.showDisplayByName(this._templet.attachmentNames[_A]):_g.showDisplayByIndex(_A)),_D[this._drawOrder[_m]]?(_C=_D[this._drawOrder[_m]],_g.currDisplayData&&_C[_g.currDisplayData.attachmentName]?_g.deformData=_C[_g.currDisplayData.attachmentName]:_g.deformData=null):_g.deformData=null,isNaN(_B)?_g.draw(_c,this._boneMatrixArray,2==this._aniMode):_g.draw(_c,this._boneMatrixArray,2==this._aniMode,_B),isNaN(_B)||_c.restore();else for(_m=0,_p=this._boneSlotArray.length;_m<_p;_m++)_A=_s[(_g=this._boneSlotArray[_m]).name],_B=_t[_g.name],isNaN(_B)||(_c.save(),_c.alpha(_B)),isNaN(_A)||-2==_A||(this._templet.attachmentNames?_g.showDisplayByName(this._templet.attachmentNames[_A]):_g.showDisplayByIndex(_A)),_D[_m]?(_C=_D[_m],_g.currDisplayData&&_C[_g.currDisplayData.attachmentName]?_g.deformData=_C[_g.currDisplayData.attachmentName]:_g.deformData=null):_g.deformData=null,isNaN(_B)?_g.draw(_c,this._boneMatrixArray,2==this._aniMode):_g.draw(_c,this._boneMatrixArray,2==this._aniMode,_B),isNaN(_B)||_c.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,_a,_c):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,_a,_c)},_a._setDeform=function(_a,_b,_c,_d){if(_a){var _e,_f,_g,_h=0,_i=0,_j=0;if(_a)for(_h=0,_i=_a.deformSlotDataList.length;_h<_i;_h++)for(_e=_a.deformSlotDataList[_h],_j=0;_j<_e.deformSlotDisplayList.length;_j++)_g=_c[(_f=_e.deformSlotDisplayList[_j]).slotIndex],_f.apply(_d,_g),_b[_f.slotIndex]||(_b[_f.slotIndex]={}),_b[_f.slotIndex][_f.attachment]=_f.deformData}},_a.getAnimNum=function(){return this._templet.getAnimationCount()},_a.getAniNameByIndex=function(_a){return this._templet.getAniNameByIndex(_a)},_a.getSlotByName=function(_a){return this._boneSlotDic[_a]},_a.showSkinByName=function(_a,_b){void 0===_b&&(_b=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(_a),_b)},_a.showSkinByIndex=function(_a,_b){void 0===_b&&(_b=!0);for(var _c=0;_c<this._boneSlotArray.length;_c++)this._boneSlotArray[_c].showSlotData(null,_b);if(this._templet.showSkinByIndex(this._boneSlotDic,_a,_b)){var _d=this._templet.skinDataArray[_a];this._skinIndex=_a,this._skinName=_d.name}this._clearCache()},_a.showSlotSkinByIndex=function(_a,_b){if(0!=this._aniMode){var _c=this.getSlotByName(_a);_c&&_c.showDisplayByIndex(_b),this._clearCache()}},_a.showSlotSkinByName=function(_a,_b){if(0!=this._aniMode){var _c=this.getSlotByName(_a);_c&&_c.showDisplayByName(_b),this._clearCache()}},_a.replaceSlotSkinName=function(_a,_b,_c){if(0!=this._aniMode){var _d=this.getSlotByName(_a);_d&&_d.replaceDisplayByName(_b,_c),this._clearCache()}},_a.replaceSlotSkinByIndex=function(_a,_b,_c){if(0!=this._aniMode){var _d=this.getSlotByName(_a);_d&&_d.replaceDisplayByIndex(_b,_c),this._clearCache()}},_a.setSlotSkin=function(_a,_b){if(0!=this._aniMode){var _c=this.getSlotByName(_a);_c&&_c.replaceSkin(_b),this._clearCache()}},_a._clearCache=function(){if(1==this._aniMode)for(var _a=0,_b=this._graphicsCache.length;_a<_b;_a++){for(var _c=0,_d=this._graphicsCache[_a].length;_c<_d;_c++){var _e=this._graphicsCache[_a][_c];_e!=this.graphics&&_H.recycle(_e)}this._graphicsCache[_a].length=0}},_a.play=function(_a,_b,_c,_d,_e,_f){void 0===_c&&(_c=!0),void 0===_d&&(_d=0),void 0===_e&&(_e=0),void 0===_f&&(_f=!0),this._indexControl=!1;var _g=-1,_h=NaN;if(_h=_b?2147483647:0,"string"==typeof _a)for(var _i=0,_j=this._templet.getAnimationCount();_i<_j;_i++){var _k=this._templet.getAnimation(_i);if(_k&&_a==_k.name){_g=_i;break}}else _g=_a;-1<_g&&_g<this.getAnimNum()&&(this._aniClipIndex=_g,(_c||this._pause||this._currAniIndex!=_g)&&(this._currAniIndex=_g,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(_g)),this._drawOrder=null,this._eventIndex=0,this._player.play(_g,this._player.playbackRate,_h,_d,_e),_f&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=_l.now(),this.timer.frameLoop(1,this,this._update,null,!0)),this._update()))},_a.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),this.timer.clear(this,this._update))},_a.playbackRate=function(_a){this._player&&(this._player.playbackRate=_a)},_a.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),this.timer.clear(this,this._update))},_a.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=_l.now(),this.timer.frameLoop(1,this,this._update,null,!0))},_a._getGrahicsDataWithCache=function(_a,_b){return this._graphicsCache[_a][_b]},_a._setGrahicsDataWithCache=function(_a,_b,_c){this._graphicsCache[_a][_b]=_c},_a.destroy=function(_a){void 0===_a&&(_a=!0),_b.prototype.destroy.call(this,_a),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,this.timer.clear(this,this._update)},_f(0,_a,"url",function(){return this._aniPath},function(_a){this.load(_a)}),_f(0,_a,"index",function(){return this._index},function(_a){this.player&&(this._index=_a,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),_f(0,_a,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),_f(0,_a,"templet",function(){return this._templet}),_f(0,_a,"player",function(){return this._player}),_c.useSimpleMeshInCanvas=!1,_c}(_fa),_B=function(_b){function _e(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.isParserComplete=!1,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,_e.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}_d(_e,"laya.ani.bone.Templet",_b);var _a=_e.prototype;return _a.getLoadList=function(){return this._loadList},_a.loadAni=function(_a){this._skBufferUrl=_a,_ea.loader.load(_a,_i.create(this,this.onComplete),null,"arraybuffer")},_a.onComplete=function(_a){if(this._isDestroyed)this.destroy();else{var _b=_j.getRes(this._skBufferUrl);_b?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",this.parseData(null,_b)):this.event("error","load failed:"+this._skBufferUrl)}},_a.parseData=function(_a,_b,_c){void 0===_c&&(_c=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=_a,this._mainTexture&&_q.isWebGL&&_a.bitmap&&(_a.bitmap.enableMerageInAtlas=!1),this._rate=_c,this.parse(_b)},_a.buildArmature=function(_a){return void 0===_a&&(_a=0),new _A(this,_a)},_a.parse=function(_a){_b.prototype.parse.call(this,_a),this._endLoaded(),this._aniVersion!=_e.LAYA_ANIMATION_VISION&&(console.error("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+_e.LAYA_ANIMATION_VISION),this._loaded=!1),this.loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},_a._parseTexturePath=function(){if(this._isDestroyed)this.destroy();else{var _a=0;this._loadList=[];var _b,_c=new _Da(this.getPublicExtData()),_d=0,_e=0,_f=0,_g=_c.getInt32(),_h=_c.readUTFString(),_i=_h.split("\n");for(_a=0;_a<_g;_a++)_b=this._path+_i[2*_a],_h=_i[2*_a+1],_c.getFloat32(),_c.getFloat32(),_d=_c.getFloat32(),_e=_c.getFloat32(),_f=_c.getFloat32(),isNaN(_f)?0:_f,_f=_c.getFloat32(),isNaN(_f)?0:_f,_f=_c.getFloat32(),isNaN(_f)?_d:_f,_f=_c.getFloat32(),isNaN(_f)?_e:_f,-1==this._loadList.indexOf(_b)&&this._loadList.push(_b);this.event("inited",this)}},_a._textureComplete=function(){for(var _a,_b,_c=0,_d=this._loadList.length;_c<_d;_c++)_b=this._loadList[_c],_a=this._textureDic[_b]=_j.getRes(_b),_q.isWebGL&&_a&&_a.bitmap&&(_a.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},_a._parsePublicExtData=function(){var _a=0,_b=0,_c=0,_d=0,_e=0;for(_a=0,_e=this.getAnimationCount();_a<_e;_a++)this._graphicsCache.push([]);var _f;_f="Dragon"!=this._aniClassName;var _g,_h,_i=new _Da(this.getPublicExtData()),_j=0,_k=0,_l=0,_m=0,_n=0,_o=0,_p=0,_q=0,_r=0,_s=_i.getInt32(),_t=_i.readUTFString(),_u=_t.split("\n");for(_a=0;_a<_s;_a++){if(_g=this._mainTexture,_h=this._path+_u[2*_a],_t=_u[2*_a+1],null==this._mainTexture&&(_g=this._textureDic[_h]),!_g)return this.event("error",this),void(this.isParseFail=!0);_j=_i.getFloat32(),_k=_i.getFloat32(),_l=_i.getFloat32(),_m=_i.getFloat32(),_r=_i.getFloat32(),_n=isNaN(_r)?0:_r,_r=_i.getFloat32(),_o=isNaN(_r)?0:_r,_r=_i.getFloat32(),_p=isNaN(_r)?_l:_r,_r=_i.getFloat32(),_q=isNaN(_r)?_m:_r,this.subTextureDic[_t]=_Fa.create(_g,_j,_k,_l,_m,-_n,-_o,_p,_q),_g.alphaTexture&&(this.subTextureDic[_t].alphaTexture=_Fa.create(_g.alphaTexture,_j,_k,_l,_m,-_n,-_o,_p,_q))}this._mainTexture=_g;var _v,_w,_x,_y,_z,_A=_i.getUint16();for(_a=0;_a<_A;_a++)(_v=[]).push(_i.getUint16()),_v.push(_i.getUint16()),_v.push(_i.getUint16()),_v.push(_i.getUint16()),this.aniSectionDic[_a]=_v;var _B,_C=_i.getInt16(),_D={};for(_a=0;_a<_C;_a++)_w=new _Ga,0==_a?_B=_w:_w.root=_B,_w.d=_f?-1:1,_y=_i.readUTFString(),_z=_i.readUTFString(),_w.length=_i.getFloat32(),1==_i.getByte()&&(_w.inheritRotation=!1),1==_i.getByte()&&(_w.inheritScale=!1),_w.name=_y,_z&&((_x=_D[_z])?_x.addChild(_w):this.mRootBone=_w),_D[_y]=_w,this.mBoneArr.push(_w);this.tMatrixDataLen=_i.getUint16();var _E,_F,_G=_i.getUint16(),_H=Math.floor(_G/this.tMatrixDataLen),_I=this.srcBoneMatrixArr;for(_a=0;_a<_H;_a++)(_E=new _Ta).scX=_i.getFloat32(),_E.skX=_i.getFloat32(),_E.skY=_i.getFloat32(),_E.scY=_i.getFloat32(),_E.x=_i.getFloat32(),_E.y=_i.getFloat32(),8===this.tMatrixDataLen&&(_E.skewX=_i.getFloat32(),_E.skewY=_i.getFloat32()),_I.push(_E),(_w=this.mBoneArr[_a]).transform=_E;var _J,_K=_i.getUint16(),_L=0;for(_a=0;_a<_K;_a++){for(_F=new _Na,_L=_i.getUint16(),_b=0;_b<_L;_b++)_F.boneNames.push(_i.readUTFString()),_F.boneIndexs.push(_i.getInt16());_F.name=_i.readUTFString(),_F.targetBoneName=_i.readUTFString(),_F.targetBoneIndex=_i.getInt16(),_F.bendDirection=_i.getFloat32(),_F.mix=_i.getFloat32(),_F.isSpine=_f,this.ikArr.push(_F)}var _M,_N=_i.getUint16(),_O=0;for(_a=0;_a<_N;_a++){for(_J=new _Sa,_O=_i.getUint16(),_b=0;_b<_O;_b++)_J.boneIndexs.push(_i.getInt16());_J.name=_i.getUTFString(),_J.targetIndex=_i.getInt16(),_J.rotateMix=_i.getFloat32(),_J.translateMix=_i.getFloat32(),_J.scaleMix=_i.getFloat32(),_J.shearMix=_i.getFloat32(),_J.offsetRotation=_i.getFloat32(),_J.offsetX=_i.getFloat32(),_J.offsetY=_i.getFloat32(),_J.offsetScaleX=_i.getFloat32(),_J.offsetScaleY=_i.getFloat32(),_J.offsetShearY=_i.getFloat32(),this.tfArr.push(_J)}var _P=_i.getUint16(),_Q=0;for(_a=0;_a<_P;_a++){for((_M=new _Oa).name=_i.readUTFString(),_Q=_i.getUint16(),_b=0;_b<_Q;_b++)_M.bones.push(_i.getInt16());_M.target=_i.readUTFString(),_M.positionMode=_i.readUTFString(),_M.spacingMode=_i.readUTFString(),_M.rotateMode=_i.readUTFString(),_M.offsetRotation=_i.getFloat32(),_M.position=_i.getFloat32(),_M.spacing=_i.getFloat32(),_M.rotateMix=_i.getFloat32(),_M.translateMix=_i.getFloat32(),this.pathArr.push(_M)}var _R,_S,_T,_U,_V,_W=0,_X=0,_Y=0,_Z=NaN,_$=0,__=_i.getInt16();for(_a=0;_a<__;_a++){var _aa=_i.getUint8(),_ba={};this.deformAniArr.push(_ba);for(var _ca=0;_ca<_aa;_ca++)for((_R=new _Ia).skinName=_i.getUTFString(),_ba[_R.skinName]=_R,_W=_i.getInt16(),_b=0;_b<_W;_b++)for(_S=new _Ja,_R.deformSlotDataList.push(_S),_X=_i.getInt16(),_c=0;_c<_X;_c++)for(_T=new _Ka,_S.deformSlotDisplayList.push(_T),_T.slotIndex=_i.getInt16(),_T.attachment=_i.getUTFString(),_Y=_i.getInt16(),_d=0;_d<_Y;_d++)for(1==_i.getByte()?_T.tweenKeyList.push(!0):_T.tweenKeyList.push(!1),_Z=_i.getFloat32(),_T.timeList.push(_Z),_U=[],_T.vectices.push(_U),_$=_i.getInt16(),_e=0;_e<_$;_e++)_U.push(_i.getFloat32())}var _da,_ea,_fa=_i.getInt16(),_ga=0,_ha=0;for(_a=0;_a<_fa;_a++){for(_ga=_i.getInt16(),_V=[],_b=0;_b<_ga;_b++){for((_da=new _La).time=_i.getFloat32(),_ha=_i.getInt16(),_c=0;_c<_ha;_c++)_da.drawOrder.push(_i.getInt16());_V.push(_da)}this.drawOrderAniArr.push(_V)}var _ia,_ja=_i.getInt16(),_ka=0;for(_a=0;_a<_ja;_a++){for(_ka=_i.getInt16(),_ea=[],_b=0;_b<_ka;_b++)(_ia=new _Ma).name=_i.getUTFString(),_ia.intValue=_i.getInt32(),_ia.floatValue=_i.getFloat32(),_ia.stringValue=_i.getUTFString(),_ia.time=_i.getFloat32(),_ea.push(_ia);this.eventAniArr.push(_ea)}var _la=_i.getInt16();if(0<_la)for(this.attachmentNames=[],_a=0;_a<_la;_a++)this.attachmentNames.push(_i.getUTFString());var _ma,_na,_oa=_i.getInt16();for(_a=0;_a<_oa;_a++)(_ma=new _Ha).name=_i.readUTFString(),_ma.parent=_i.readUTFString(),_ma.attachmentName=_i.readUTFString(),_ma.srcDisplayIndex=_ma.displayIndex=_i.getInt16(),(_ma.templet=this).boneSlotDic[_ma.name]=_ma,null==(_na=this.bindBoneBoneSlotDic[_ma.parent])&&(this.bindBoneBoneSlotDic[_ma.parent]=_na=[]),_na.push(_ma),this.boneSlotArray.push(_ma);var _pa,_qa,_ra,_sa=_i.readUTFString().split("\n"),_ta=0,_ua=_i.getUint8(),_va=0,_wa=0,_xa=0,_ya=0,_za=0,_Aa=0,_Ba=0;for(_a=0;_a<_ua;_a++){for((_pa=new _Pa).name=_sa[_ta++],_va=_i.getUint8(),_b=0;_b<_va;_b++){for((_qa=new _Ra).name=_sa[_ta++],_ma=this.boneSlotDic[_qa.name],_wa=_i.getUint8(),_c=0;_c<_wa;_c++){if(_ra=new _Qa,this.skinSlotDisplayDataArr.push(_ra),_ra.name=_sa[_ta++],_ra.attachmentName=_sa[_ta++],_ra.transform=new _Ta,_ra.transform.scX=_i.getFloat32(),_ra.transform.skX=_i.getFloat32(),_ra.transform.skY=_i.getFloat32(),_ra.transform.scY=_i.getFloat32(),_ra.transform.x=_i.getFloat32(),_ra.transform.y=_i.getFloat32(),_qa.displayArr.push(_ra),_ra.width=_i.getFloat32(),_ra.height=_i.getFloat32(),_ra.type=_i.getUint8(),_ra.verLen=_i.getUint16(),0<(_C=_i.getUint16()))for(_ra.bones=[],_d=0;_d<_C;_d++){var _Ca=_i.getUint16();_ra.bones.push(_Ca)}if(0<(_xa=_i.getUint16()))for(_ra.uvs=[],_d=0;_d<_xa;_d++)_ra.uvs.push(_i.getFloat32());if(0<(_ya=_i.getUint16()))for(_ra.weights=[],_d=0;_d<_ya;_d++)_ra.weights.push(_i.getFloat32());if(0<(_za=_i.getUint16()))for(_ra.triangles=[],_d=0;_d<_za;_d++)_ra.triangles.push(_i.getUint16());if(0<(_Aa=_i.getUint16()))for(_ra.vertices=[],_d=0;_d<_Aa;_d++)_ra.vertices.push(_i.getFloat32());if(0<(_Ba=_i.getUint16()))for(_ra.lengths=[],_d=0;_d<_Ba;_d++)_ra.lengths.push(_i.getFloat32())}_pa.slotArr.push(_qa)}this.skinDic[_pa.name]=_pa,this.skinDataArray.push(_pa)}1==_i.getUint8()?(this.yReverseMatrix=new _Ea(1,0,0,-1,0,0),_B&&_B.setTempMatrix(this.yReverseMatrix)):_B&&_B.setTempMatrix(new _Ea),this.showSkinByIndex(this.boneSlotDic,0),this.isParserComplete=!0,this.event("complete",this)},_a.getTexture=function(_a){var _b=this.subTextureDic[_a];return _b||(_b=this.subTextureDic[_a.substr(0,_a.length-1)]),null==_b?this._mainTexture:_b},_a.showSkinByIndex=function(_a,_b,_c){if(void 0===_c&&(_c=!0),_b<0&&_b>=this.skinDataArray.length)return!1;var _d,_e,_f=0,_g=0,_h=this.skinDataArray[_b];if(_h){for(_f=0,_g=_h.slotArr.length;_f<_g;_f++)(_e=_h.slotArr[_f])&&(_d=_a[_e.name])&&(_d.showSlotData(_e,_c),_c&&"undefined"!=_d.attachmentName&&"null"!=_d.attachmentName?_d.showDisplayByName(_d.attachmentName):_d.showDisplayByIndex(_d.displayIndex));return!0}return!1},_a.getSkinIndexByName=function(_a){for(var _b=0,_c=this.skinDataArray.length;_b<_c;_b++)if(this.skinDataArray[_b].name==_a)return _b;return-1},_a.getGrahicsDataWithCache=function(_a,_b){return this._graphicsCache[_a][_b]},_a.setGrahicsDataWithCache=function(_a,_b,_c){this._graphicsCache[_a][_b]=_c},_a.destroy=function(){var _a;for(var _b in this._isDestroyed=!0,this.subTextureDic)(_a=this.subTextureDic[_b])&&_a.destroy();for(_b in this._textureDic)(_a=this._textureDic[_b])&&_a.destroy();for(var _c=0,_d=this.skinSlotDisplayDataArr.length;_c<_d;_c++)this.skinSlotDisplayDataArr[_c].destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete _e.TEMPLET_DICTIONARY[this.url],laya.resource.Resource.prototype.destroy.call(this)},_a.getAniNameByIndex=function(_a){var _b=this.getAnimation(_a);return _b?_b.name:null},_f(0,_a,"rate",function(){return this._rate},function(_a){this._rate=_a}),_e.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",_e.TEMPLET_DICTIONARY=null,_e}(_I)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(_a,_b){"use strict";for(var _c in Object.defineProperty(_b,"__esModule",{value:!0}),Laya){var _d=Laya[_c];_d&&_d.__isclass&&(_b[_c]=_d)}}),function(undefined){"use strict";var _Tyd,_Uyd,_Vyd,_Xyd;_Tyd={1:[function(_a,_b,_c){_b.exports=function(_a,_b){var _c=new Array(arguments.length-1),_f=0,_d=2,_g=!0;for(;_d<arguments.length;)_c[_f++]=arguments[_d++];return new Promise(function(_d,_e){_c[_f]=function(_a){if(_g)if(_g=!1,_a)_e(_a);else{for(var _b=new Array(arguments.length-1),_c=0;_c<_b.length;)_b[_c++]=arguments[_c];_d.apply(null,_b)}};try{_a.apply(_b||null,_c)}catch(_a){_g&&(_g=!1,_e(_a))}})}},{}],2:[function(_a,_b,_c){var _d=_c;_d.length=function(_a){var _b=_a.length;if(!_b)return 0;for(var _c=0;1<--_b%4&&"="===_a.charAt(_b);)++_c;return Math.ceil(3*_a.length)/4-_c};for(var _j=new Array(64),_i=new Array(123),_e=0;_e<64;)_i[_j[_e]=_e<26?_e+65:_e<52?_e+71:_e<62?_e-4:_e-59|43]=_e++;_d.encode=function(_a,_b,_c){for(var _d,_e=null,_f=[],_g=0,_h=0;_b<_c;){var _i=_a[_b++];switch(_h){case 0:_f[_g++]=_j[_i>>2],_d=(3&_i)<<4,_h=1;break;case 1:_f[_g++]=_j[_d|_i>>4],_d=(15&_i)<<2,_h=2;break;case 2:_f[_g++]=_j[_d|_i>>6],_f[_g++]=_j[63&_i],_h=0}8191<_g&&((_e||(_e=[])).push(String.fromCharCode.apply(String,_f)),_g=0)}return _h&&(_f[_g++]=_j[_d],_f[_g++]=61,1===_h&&(_f[_g++]=61)),_e?(_g&&_e.push(String.fromCharCode.apply(String,_f.slice(0,_g))),_e.join("")):String.fromCharCode.apply(String,_f.slice(0,_g))};var _k="invalid encoding";_d.decode=function(_a,_b,_c){for(var _d,_e=_c,_f=0,_g=0;_g<_a.length;){var _h=_a.charCodeAt(_g++);if(61===_h&&1<_f)break;if((_h=_i[_h])===undefined)throw Error(_k);switch(_f){case 0:_d=_h,_f=1;break;case 1:_b[_c++]=_d<<2|(48&_h)>>4,_d=_h,_f=2;break;case 2:_b[_c++]=(15&_d)<<4|(60&_h)>>2,_d=_h,_f=3;break;case 3:_b[_c++]=(3&_d)<<6|_h,_f=0}}if(1===_f)throw Error(_k);return _c-_e},_d.test=function(_a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(_a)}},{}],3:[function(_a,_b,_c){function _l(_b,_c){"string"==typeof _b&&(_c=_b,_b=undefined);var _i=[];function _j(_a){if("string"!=typeof _a){var _b=_k();if(_l.verbose&&console.log("codegen: "+_b),_b="return "+_b,_a){for(var _c=Object.keys(_a),_d=new Array(_c.length+1),_e=new Array(_c.length),_f=0;_f<_c.length;)_d[_f]=_c[_f],_e[_f]=_a[_c[_f++]];return _d[_f]=_b,Function.apply(null,_d).apply(null,_e)}return Function(_b)()}for(var _g=new Array(arguments.length-1),_h=0;_h<_g.length;)_g[_h]=arguments[++_h];if(_h=0,_a=_a.replace(/%([%dfijs])/g,function(_a,_b){var _c=_g[_h++];switch(_b){case"d":case"f":return String(Number(_c));case"i":return String(Math.floor(_c));case"j":return JSON.stringify(_c);case"s":return String(_c)}return"%"}),_h!==_g.length)throw Error("parameter count mismatch");return _i.push(_a),_j}function _k(_a){return"function "+(_a||_c||"")+"("+(_b&&_b.join(",")||"")+"){\n  "+_i.join("\n  ")+"\n}"}return _j.toString=_k,_j}(_b.exports=_l).verbose=!1},{}],4:[function(_a,_b,_c){function _d(){this._listeners={}}(_b.exports=_d).prototype.on=function(_a,_b,_c){return(this._listeners[_a]||(this._listeners[_a]=[])).push({fn:_b,ctx:_c||this}),this},_d.prototype.off=function(_a,_b){if(_a===undefined)this._listeners={};else if(_b===undefined)this._listeners[_a]=[];else for(var _c=this._listeners[_a],_d=0;_d<_c.length;)_c[_d].fn===_b?_c.splice(_d,1):++_d;return this},_d.prototype.emit=function(_a){var _b=this._listeners[_a];if(_b){for(var _c=[],_d=1;_d<arguments.length;)_c.push(arguments[_d++]);for(_d=0;_d<_b.length;)_b[_d].fn.apply(_b[_d++].ctx,_c)}return this}},{}],5:[function(_a,_b,_c){_b.exports=_h;var _f=_a(1),_g=_a(7)("fs");function _h(_c,_d,_e){return"function"==typeof _d?(_e=_d,_d={}):_d||(_d={}),_e?!_d.xhr&&_g&&_g.readFile?_g.readFile(_c,function(_a,_b){return _a&&"undefined"!=typeof XMLHttpRequest?_h.xhr(_c,_d,_e):_a?_e(_a):_e(null,_d.binary?_b:_b.toString("utf8"))}):_h.xhr(_c,_d,_e):_f(_h,this,_c,_d)}_h.xhr=function(_a,_c,_d){var _e=new XMLHttpRequest;_e.onreadystatechange=function(){if(4!==_e.readyState)return undefined;if(0!==_e.status&&200!==_e.status)return _d(Error("status "+_e.status));if(_c.binary){var _a=_e.response;if(!_a){_a=[];for(var _b=0;_b<_e.responseText.length;++_b)_a.push(255&_e.responseText.charCodeAt(_b))}return _d(null,"undefined"!=typeof Uint8Array?new Uint8Array(_a):_a)}return _d(null,_e.responseText)},_c.binary&&("overrideMimeType"in _e&&_e.overrideMimeType("text/plain; charset=x-user-defined"),_e.responseType="arraybuffer"),_e.open("GET",_a),_e.send()}},{1:1,7:7}],6:[function(_a,_b,_c){function _d(_h){return"undefined"!=typeof Float32Array?function(){var _d=new Float32Array([-0]),_e=new Uint8Array(_d.buffer),_a=128===_e[3];function _b(_a,_b,_c){_d[0]=_a,_b[_c]=_e[0],_b[_c+1]=_e[1],_b[_c+2]=_e[2],_b[_c+3]=_e[3]}function _c(_a,_b,_c){_d[0]=_a,_b[_c]=_e[3],_b[_c+1]=_e[2],_b[_c+2]=_e[1],_b[_c+3]=_e[0]}function _f(_a,_b){return _e[0]=_a[_b],_e[1]=_a[_b+1],_e[2]=_a[_b+2],_e[3]=_a[_b+3],_d[0]}function _g(_a,_b){return _e[3]=_a[_b],_e[2]=_a[_b+1],_e[1]=_a[_b+2],_e[0]=_a[_b+3],_d[0]}_h.writeFloatLE=_a?_b:_c,_h.writeFloatBE=_a?_c:_b,_h.readFloatLE=_a?_f:_g,_h.readFloatBE=_a?_g:_f}():function(){function _a(_a,_b,_c,_d){var _e=_b<0?1:0;if(_e&&(_b=-_b),0===_b)_a(0<1/_b?0:2147483648,_c,_d);else if(isNaN(_b))_a(2143289344,_c,_d);else if(34028234663852886e22<_b)_a((_e<<31|2139095040)>>>0,_c,_d);else if(_b<11754943508222875e-54)_a((_e<<31|Math.round(_b/1401298464324817e-60))>>>0,_c,_d);else{var _f=Math.floor(Math.log(_b)/Math.LN2);_a((_e<<31|_f+127<<23|8388607&Math.round(_b*Math.pow(2,-_f)*8388608))>>>0,_c,_d)}}function _b(_a,_b,_c){var _d=_a(_b,_c),_e=2*(_d>>31)+1,_f=_d>>>23&255,_g=8388607&_d;return 255==_f?_g?NaN:1/0*_e:0==_f?1401298464324817e-60*_e*_g:_e*Math.pow(2,_f-150)*(8388608+_g)}_h.writeFloatLE=_a.bind(null,_e),_h.writeFloatBE=_a.bind(null,_f),_h.readFloatLE=_b.bind(null,_g),_h.readFloatBE=_b.bind(null,_i)}(),"undefined"!=typeof Float64Array?function(){var _d=new Float64Array([-0]),_e=new Uint8Array(_d.buffer),_a=128===_e[7];function _b(_a,_b,_c){_d[0]=_a,_b[_c]=_e[0],_b[_c+1]=_e[1],_b[_c+2]=_e[2],_b[_c+3]=_e[3],_b[_c+4]=_e[4],_b[_c+5]=_e[5],_b[_c+6]=_e[6],_b[_c+7]=_e[7]}function _c(_a,_b,_c){_d[0]=_a,_b[_c]=_e[7],_b[_c+1]=_e[6],_b[_c+2]=_e[5],_b[_c+3]=_e[4],_b[_c+4]=_e[3],_b[_c+5]=_e[2],_b[_c+6]=_e[1],_b[_c+7]=_e[0]}function _f(_a,_b){return _e[0]=_a[_b],_e[1]=_a[_b+1],_e[2]=_a[_b+2],_e[3]=_a[_b+3],_e[4]=_a[_b+4],_e[5]=_a[_b+5],_e[6]=_a[_b+6],_e[7]=_a[_b+7],_d[0]}function _g(_a,_b){return _e[7]=_a[_b],_e[6]=_a[_b+1],_e[5]=_a[_b+2],_e[4]=_a[_b+3],_e[3]=_a[_b+4],_e[2]=_a[_b+5],_e[1]=_a[_b+6],_e[0]=_a[_b+7],_d[0]}_h.writeDoubleLE=_a?_b:_c,_h.writeDoubleBE=_a?_c:_b,_h.readDoubleLE=_a?_f:_g,_h.readDoubleBE=_a?_g:_f}():function(){function _a(_a,_b,_c,_d,_e,_f){var _g=_d<0?1:0;if(_g&&(_d=-_d),0===_d)_a(0,_e,_f+_b),_a(0<1/_d?0:2147483648,_e,_f+_c);else if(isNaN(_d))_a(0,_e,_f+_b),_a(2146959360,_e,_f+_c);else if(17976931348623157e292<_d)_a(0,_e,_f+_b),_a((_g<<31|2146435072)>>>0,_e,_f+_c);else{var _h;if(_d<22250738585072014e-324)_a((_h=_d/5e-324)>>>0,_e,_f+_b),_a((_g<<31|_h/4294967296)>>>0,_e,_f+_c);else{var _i=Math.floor(Math.log(_d)/Math.LN2);1024===_i&&(_i=1023),_a(4503599627370496*(_h=_d*Math.pow(2,-_i))>>>0,_e,_f+_b),_a((_g<<31|_i+1023<<20|1048576*_h&1048575)>>>0,_e,_f+_c)}}}function _b(_a,_b,_c,_d,_e){var _f=_a(_d,_e+_b),_g=_a(_d,_e+_c),_h=2*(_g>>31)+1,_i=_g>>>20&2047,_j=4294967296*(1048575&_g)+_f;return 2047==_i?_j?NaN:1/0*_h:0==_i?5e-324*_h*_j:_h*Math.pow(2,_i-1075)*(_j+4503599627370496)}_h.writeDoubleLE=_a.bind(null,_e,0,4),_h.writeDoubleBE=_a.bind(null,_f,4,0),_h.readDoubleLE=_b.bind(null,_g,0,4),_h.readDoubleBE=_b.bind(null,_i,4,0)}(),_h}function _e(_a,_b,_c){_b[_c]=255&_a,_b[_c+1]=_a>>>8&255,_b[_c+2]=_a>>>16&255,_b[_c+3]=_a>>>24}function _f(_a,_b,_c){_b[_c]=_a>>>24,_b[_c+1]=_a>>>16&255,_b[_c+2]=_a>>>8&255,_b[_c+3]=255&_a}function _g(_a,_b){return(_a[_b]|_a[_b+1]<<8|_a[_b+2]<<16|_a[_b+3]<<24)>>>0}function _i(_a,_b){return(_a[_b]<<24|_a[_b+1]<<16|_a[_b+2]<<8|_a[_b+3])>>>0}_b.exports=_d(_d)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(_a){}return null}module.exports=inquire},{}],8:[function(_a,_b,_c){var _d=_c,_f=_d.isAbsolute=function(_a){return/^(?:\/|\w+:)/.test(_a)},_e=_d.normalize=function(_a){var _b=(_a=_a.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),_c=_f(_a),_d="";_c&&(_d=_b.shift()+"/");for(var _e=0;_e<_b.length;)".."===_b[_e]?0<_e&&".."!==_b[_e-1]?_b.splice(--_e,2):_c?_b.splice(_e,1):++_e:"."===_b[_e]?_b.splice(_e,1):++_e;return _d+_b.join("/")};_d.resolve=function(_a,_b,_c){return _c||(_b=_e(_b)),_f(_b)?_b:(_c||(_a=_e(_a)),(_a=_a.replace(/(?:\/|^)[^/]+$/,"")).length?_e(_a+"/"+_b):_b)}},{}],9:[function(_a,_b,_c){_b.exports=function(_c,_d,_a){var _e=_a||8192,_f=_e>>>1,_g=null,_h=_e;return function(_a){if(_a<1||_f<_a)return _c(_a);_e<_h+_a&&(_g=_c(_e),_h=0);var _b=_d.call(_g,_h,_h+=_a);return 7&_h&&(_h=1+(7|_h)),_b}}},{}],10:[function(_a,_b,_c){var _d=_c;_d.length=function(_a){for(var _b=0,_c=0,_d=0;_d<_a.length;++_d)(_c=_a.charCodeAt(_d))<128?_b+=1:_c<2048?_b+=2:55296==(64512&_c)&&56320==(64512&_a.charCodeAt(_d+1))?(++_d,_b+=4):_b+=3;return _b},_d.read=function(_a,_b,_c){if(_c-_b<1)return"";for(var _d,_e=null,_f=[],_g=0;_b<_c;)(_d=_a[_b++])<128?_f[_g++]=_d:191<_d&&_d<224?_f[_g++]=(31&_d)<<6|63&_a[_b++]:239<_d&&_d<365?(_d=((7&_d)<<18|(63&_a[_b++])<<12|(63&_a[_b++])<<6|63&_a[_b++])-65536,_f[_g++]=55296+(_d>>10),_f[_g++]=56320+(1023&_d)):_f[_g++]=(15&_d)<<12|(63&_a[_b++])<<6|63&_a[_b++],8191<_g&&((_e||(_e=[])).push(String.fromCharCode.apply(String,_f)),_g=0);return _e?(_g&&_e.push(String.fromCharCode.apply(String,_f.slice(0,_g))),_e.join("")):String.fromCharCode.apply(String,_f.slice(0,_g))},_d.write=function(_a,_b,_c){for(var _d,_e,_f=_c,_g=0;_g<_a.length;++_g)(_d=_a.charCodeAt(_g))<128?_b[_c++]=_d:(_d<2048?_b[_c++]=_d>>6|192:(55296==(64512&_d)&&56320==(64512&(_e=_a.charCodeAt(_g+1)))?(_d=65536+((1023&_d)<<10)+(1023&_e),++_g,_b[_c++]=_d>>18|240,_b[_c++]=_d>>12&63|128):_b[_c++]=_d>>12|224,_b[_c++]=_d>>6&63|128),_b[_c++]=63&_d|128);return _c-_f}},{}],11:[function(_a,_b,_c){_b.exports=_f;var _d,_e=/\/|\./;function _f(_a,_b){_e.test(_a)||(_a="google/protobuf/"+_a+".proto",_b={nested:{google:{nested:{protobuf:{nested:_b}}}}}),_f[_a]=_b}_f("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),_f("duration",{Duration:_d={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),_f("timestamp",{Timestamp:_d}),_f("empty",{Empty:{fields:{}}}),_f("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),_f("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),_f("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),_f.get=function(_a){return _f[_a]||null}},{}],12:[function(_a,_b,_c){var _d=_c,_m=_a(15),_n=_a(37);function _g(_a,_b,_c,_d){if(_b.resolvedType)if(_b.resolvedType instanceof _m){_a("switch(d%s){",_d);for(var _e=_b.resolvedType.values,_f=Object.keys(_e),_g=0;_g<_f.length;++_g)_b.repeated&&_e[_f[_g]]===_b.typeDefault&&_a("default:"),_a("case%j:",_f[_g])("case %i:",_e[_f[_g]])("m%s=%j",_d,_e[_f[_g]])("break");_a("}")}else _a('if(typeof d%s!=="object")',_d)("throw TypeError(%j)",_b.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",_d,_c,_d);else{var _h=!1;switch(_b.type){case"double":case"float":_a("m%s=Number(d%s)",_d,_d);break;case"uint32":case"fixed32":_a("m%s=d%s>>>0",_d,_d);break;case"int32":case"sint32":case"sfixed32":_a("m%s=d%s|0",_d,_d);break;case"uint64":_h=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":_a("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",_d,_d,_h)('else if(typeof d%s==="string")',_d)("m%s=parseInt(d%s,10)",_d,_d)('else if(typeof d%s==="number")',_d)("m%s=d%s",_d,_d)('else if(typeof d%s==="object")',_d)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",_d,_d,_d,_h?"true":"");break;case"bytes":_a('if(typeof d%s==="string")',_d)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",_d,_d,_d)("else if(d%s.length)",_d)("m%s=d%s",_d,_d);break;case"string":_a("m%s=String(d%s)",_d,_d);break;case"bool":_a("m%s=Boolean(d%s)",_d,_d)}}return _a}function _o(_a,_b,_c,_d){if(_b.resolvedType)_b.resolvedType instanceof _m?_a("d%s=o.enums===String?types[%i].values[m%s]:m%s",_d,_c,_d,_d):_a("d%s=types[%i].toObject(m%s,o)",_d,_c,_d);else{var _e=!1;switch(_b.type){case"double":case"float":_a("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",_d,_d,_d,_d);break;case"uint64":_e=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":_a('if(typeof m%s==="number")',_d)("d%s=o.longs===String?String(m%s):m%s",_d,_d,_d)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",_d,_d,_d,_d,_e?"true":"",_d);break;case"bytes":_a("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",_d,_d,_d,_d,_d);break;default:_a("d%s=m%s",_d,_d)}}return _a}_d.fromObject=function(_a){var _b=_a.fieldsArray,_c=_n.codegen(["d"],_a.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!_b.length)return _c("return new this.ctor");_c("var m=new this.ctor");for(var _d=0;_d<_b.length;++_d){var _e=_b[_d].resolve(),_f=_n.safeProp(_e.name);_e.map?(_c("if(d%s){",_f)('if(typeof d%s!=="object")',_f)("throw TypeError(%j)",_e.fullName+": object expected")("m%s={}",_f)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",_f),_g(_c,_e,_d,_f+"[ks[i]]")("}")("}")):_e.repeated?(_c("if(d%s){",_f)("if(!Array.isArray(d%s))",_f)("throw TypeError(%j)",_e.fullName+": array expected")("m%s=[]",_f)("for(var i=0;i<d%s.length;++i){",_f),_g(_c,_e,_d,_f+"[i]")("}")("}")):(_e.resolvedType instanceof _m||_c("if(d%s!=null){",_f),_g(_c,_e,_d,_f),_e.resolvedType instanceof _m||_c("}"))}return _c("return m")},_d.toObject=function(_a){var _b=_a.fieldsArray.slice().sort(_n.compareFieldsById);if(!_b.length)return _n.codegen()("return {}");for(var _c=_n.codegen(["m","o"],_a.name+"$toObject")("if(!o)")("o={}")("var d={}"),_d=[],_e=[],_f=[],_g=0;_g<_b.length;++_g)_b[_g].partOf||(_b[_g].resolve().repeated?_d:_b[_g].map?_e:_f).push(_b[_g]);if(_d.length){for(_c("if(o.arrays||o.defaults){"),_g=0;_g<_d.length;++_g)_c("d%s=[]",_n.safeProp(_d[_g].name));_c("}")}if(_e.length){for(_c("if(o.objects||o.defaults){"),_g=0;_g<_e.length;++_g)_c("d%s={}",_n.safeProp(_e[_g].name));_c("}")}if(_f.length){for(_c("if(o.defaults){"),_g=0;_g<_f.length;++_g){var _h=_f[_g],_i=_n.safeProp(_h.name);if(_h.resolvedType instanceof _m)_c("d%s=o.enums===String?%j:%j",_i,_h.resolvedType.valuesById[_h.typeDefault],_h.typeDefault);else if(_h.long)_c("if(util.Long){")("var n=new util.Long(%i,%i,%j)",_h.typeDefault.low,_h.typeDefault.high,_h.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",_i)("}else")("d%s=o.longs===String?%j:%i",_i,_h.typeDefault.toString(),_h.typeDefault.toNumber());else if(_h.bytes){var _j="["+Array.prototype.slice.call(_h.typeDefault).join(",")+"]";_c("if(o.bytes===String)d%s=%j",_i,String.fromCharCode.apply(String,_h.typeDefault))("else{")("d%s=%s",_i,_j)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",_i,_i)("}")}else _c("d%s=%j",_i,_h.typeDefault)}_c("}")}var _k=!1;for(_g=0;_g<_b.length;++_g){_h=_b[_g];var _l=_a._fieldsArray.indexOf(_h);_i=_n.safeProp(_h.name);_h.map?(_k||(_k=!0,_c("var ks2")),_c("if(m%s&&(ks2=Object.keys(m%s)).length){",_i,_i)("d%s={}",_i)("for(var j=0;j<ks2.length;++j){"),_o(_c,_h,_l,_i+"[ks2[j]]")("}")):_h.repeated?(_c("if(m%s&&m%s.length){",_i,_i)("d%s=[]",_i)("for(var j=0;j<m%s.length;++j){",_i),_o(_c,_h,_l,_i+"[j]")("}")):(_c("if(m%s!=null&&m.hasOwnProperty(%j)){",_i,_h.name),_o(_c,_h,_l,_i),_h.partOf&&_c("if(o.oneofs)")("d%s=%j",_n.safeProp(_h.partOf.name),_h.name)),_c("}")}return _c("return d")}},{15:15,37:37}],13:[function(_a,_b,_c){_b.exports=function(_a){var _b=_j.codegen(["r","l"],_a.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(_a.fieldsArray.filter(function(_a){return _a.map}).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");_a.group&&_b("if((t&7)===4)")("break");_b("switch(t>>>3){");for(var _c=0;_c<_a.fieldsArray.length;++_c){var _d=_a._fieldsArray[_c].resolve(),_e=_d.resolvedType instanceof _h?"int32":_d.type,_f="m"+_j.safeProp(_d.name);_b("case %i:",_d.id),_d.map?(_b("r.skip().pos++")("if(%s===util.emptyObject)",_f)("%s={}",_f)("k=r.%s()",_d.keyType)("r.pos++"),_i.long[_d.keyType]!==undefined?_i.basic[_e]===undefined?_b('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',_f,_c):_b('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',_f,_e):_i.basic[_e]===undefined?_b("%s[k]=types[%i].decode(r,r.uint32())",_f,_c):_b("%s[k]=r.%s()",_f,_e)):_d.repeated?(_b("if(!(%s&&%s.length))",_f,_f)("%s=[]",_f),_i.packed[_e]!==undefined&&_b("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",_f,_e)("}else"),_i.basic[_e]===undefined?_b(_d.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",_f,_c):_b("%s.push(r.%s())",_f,_e)):_i.basic[_e]===undefined?_b(_d.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",_f,_c):_b("%s=r.%s()",_f,_e),_b("break")}for(_b("default:")("r.skipType(t&7)")("break")("}")("}"),_c=0;_c<_a._fieldsArray.length;++_c){var _g=_a._fieldsArray[_c];_g.required&&_b("if(!m.hasOwnProperty(%j))",_g.name)("throw util.ProtocolError(%j,{instance:m})","missing required '"+_g.name+"'")}return _b("return m")};var _h=_a(15),_i=_a(36),_j=_a(37)},{15:15,36:36,37:37}],14:[function(_a,_b,_c){_b.exports=function(_a){for(var _b,_c=_l.codegen(["m","w"],_a.name+"$encode")("if(!w)")("w=Writer.create()"),_d=_a.fieldsArray.slice().sort(_l.compareFieldsById),_e=0;_e<_d.length;++_e){var _f=_d[_e].resolve(),_g=_a._fieldsArray.indexOf(_f),_h=_f.resolvedType instanceof _j?"int32":_f.type,_i=_k.basic[_h];_b="m"+_l.safeProp(_f.name),_f.map?(_c("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",_b,_f.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",_b)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(_f.id<<3|2)>>>0,8|_k.mapKey[_f.keyType],_f.keyType),_i===undefined?_c("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",_g,_b):_c(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|_i,_h,_b),_c("}")("}")):_f.repeated?(_c("if(%s!=null&&%s.length){",_b,_b),_f.packed&&_k.packed[_h]!==undefined?_c("w.uint32(%i).fork()",(_f.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",_b)("w.%s(%s[i])",_h,_b)("w.ldelim()"):(_c("for(var i=0;i<%s.length;++i)",_b),_i===undefined?_m(_c,_f,_g,_b+"[i]"):_c("w.uint32(%i).%s(%s[i])",(_f.id<<3|_i)>>>0,_h,_b)),_c("}")):(_f.optional&&_c("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",_b,_f.name),_i===undefined?_m(_c,_f,_g,_b):_c("w.uint32(%i).%s(%s)",(_f.id<<3|_i)>>>0,_h,_b))}return _c("return w")};var _j=_a(15),_k=_a(36),_l=_a(37);function _m(_a,_b,_c,_d){return _b.resolvedType.group?_a("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",_c,_d,(_b.id<<3|3)>>>0,(_b.id<<3|4)>>>0):_a("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",_c,_d,(_b.id<<3|2)>>>0)}},{15:15,36:36,37:37}],15:[function(_a,_b,_c){_b.exports=_f;var _h=_a(24);((_f.prototype=Object.create(_h.prototype)).constructor=_f).className="Enum";var _d=_a(23),_e=_a(37);function _f(_a,_b,_c,_d,_e){if(_h.call(this,_a,_c),_b&&"object"!=typeof _b)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=_d,this.comments=_e||{},this.reserved=undefined,_b)for(var _f=Object.keys(_b),_g=0;_g<_f.length;++_g)"number"==typeof _b[_f[_g]]&&(this.valuesById[this.values[_f[_g]]=_b[_f[_g]]]=_f[_g])}_f.fromJSON=function(_a,_b){var _c=new _f(_a,_b.values,_b.options,_b.comment,_b.comments);return _c.reserved=_b.reserved,_c},_f.prototype.toJSON=function(_a){var _b=!!_a&&Boolean(_a.keepComments);return _e.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"comment",_b?this.comment:undefined,"comments",_b?this.comments:undefined])},_f.prototype.add=function(_a,_b,_c){if(!_e.isString(_a))throw TypeError("name must be a string");if(!_e.isInteger(_b))throw TypeError("id must be an integer");if(this.values[_a]!==undefined)throw Error("duplicate name '"+_a+"' in "+this);if(this.isReservedId(_b))throw Error("id "+_b+" is reserved in "+this);if(this.isReservedName(_a))throw Error("name '"+_a+"' is reserved in "+this);if(this.valuesById[_b]!==undefined){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+_b+" in "+this);this.values[_a]=_b}else this.valuesById[this.values[_a]=_b]=_a;return this.comments[_a]=_c||null,this},_f.prototype.remove=function(_a){if(!_e.isString(_a))throw TypeError("name must be a string");var _b=this.values[_a];if(null==_b)throw Error("name '"+_a+"' does not exist in "+this);return delete this.valuesById[_b],delete this.values[_a],delete this.comments[_a],this},_f.prototype.isReservedId=function(_a){return _d.isReservedId(this.reserved,_a)},_f.prototype.isReservedName=function(_a){return _d.isReservedName(this.reserved,_a)}},{23:23,24:24,37:37}],16:[function(_a,_b,_c){_b.exports=_g;var _h=_a(24);((_g.prototype=Object.create(_h.prototype)).constructor=_g).className="Field";var _d,_e=_a(15),_i=_a(36),_j=_a(37),_k=/^required|optional|repeated$/;function _g(_a,_b,_c,_d,_e,_f,_g){if(_j.isObject(_d)?(_g=_e,_f=_d,_d=_e=undefined):_j.isObject(_e)&&(_g=_f,_f=_e,_e=undefined),_h.call(this,_a,_f),!_j.isInteger(_b)||_b<0)throw TypeError("id must be a non-negative integer");if(!_j.isString(_c))throw TypeError("type must be a string");if(_d!==undefined&&!_k.test(_d=_d.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(_e!==undefined&&!_j.isString(_e))throw TypeError("extend must be a string");this.rule=_d&&"optional"!==_d?_d:undefined,this.type=_c,this.id=_b,this.extend=_e||undefined,this.required="required"===_d,this.optional=!this.required,this.repeated="repeated"===_d,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!_j.Long&&_i.long[_c]!==undefined,this.bytes="bytes"===_c,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=_g}_g.fromJSON=function(_a,_b){return new _g(_a,_b.id,_b.type,_b.rule,_b.extend,_b.options,_b.comment)},Object.defineProperty(_g.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),_g.prototype.setOption=function(_a,_b,_c){return"packed"===_a&&(this._packed=null),_h.prototype.setOption.call(this,_a,_b,_c)},_g.prototype.toJSON=function(_a){var _b=!!_a&&Boolean(_a.keepComments);return _j.toObject(["rule","optional"!==this.rule&&this.rule||undefined,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",_b?this.comment:undefined])},_g.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=_i.defaults[this.type])===undefined&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof _d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof _e&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(this.options.packed===undefined||!this.resolvedType||this.resolvedType instanceof _e)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined)),this.long)this.typeDefault=_j.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var _a;_j.base64.test(this.typeDefault)?_j.base64.decode(this.typeDefault,_a=_j.newBuffer(_j.base64.length(this.typeDefault)),0):_j.utf8.write(this.typeDefault,_a=_j.newBuffer(_j.utf8.length(this.typeDefault)),0),this.typeDefault=_a}return this.map?this.defaultValue=_j.emptyObject:this.repeated?this.defaultValue=_j.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof _d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),_h.prototype.resolve.call(this)},_g.d=function(_c,_d,_e,_f){return"function"==typeof _d?_d=_j.decorateType(_d).name:_d&&"object"==typeof _d&&(_d=_j.decorateEnum(_d).name),function(_a,_b){_j.decorateType(_a.constructor).add(new _g(_b,_c,_d,_e,{default:_f}))}},_g._configure=function(_a){_d=_a}},{15:15,24:24,36:36,37:37}],17:[function(_a,_b,_c){var _d=_b.exports=_a(18);_d.build="light",_d.load=function(_a,_b,_c){return"function"==typeof _b?(_c=_b,_b=new _d.Root):_b||(_b=new _d.Root),_b.load(_a,_c)},_d.loadSync=function(_a,_b){return _b||(_b=new _d.Root),_b.loadSync(_a)},_d.encoder=_a(14),_d.decoder=_a(13),_d.verifier=_a(40),_d.converter=_a(12),_d.ReflectionObject=_a(24),_d.Namespace=_a(23),_d.Root=_a(29),_d.Enum=_a(15),_d.Type=_a(35),_d.Field=_a(16),_d.OneOf=_a(25),_d.MapField=_a(20),_d.Service=_a(33),_d.Method=_a(22),_d.Message=_a(21),_d.wrappers=_a(41),_d.types=_a(36),_d.util=_a(37),_d.ReflectionObject._configure(_d.Root),_d.Namespace._configure(_d.Type,_d.Service,_d.Enum),_d.Root._configure(_d.Type),_d.Field._configure(_d.Type)},{12:12,13:13,14:14,15:15,16:16,18:18,20:20,21:21,22:22,23:23,24:24,25:25,29:29,33:33,35:35,36:36,37:37,40:40,41:41}],18:[function(_a,_b,_c){var _d=_c;function _e(){_d.util._configure(),_d.Writer._configure(_d.BufferWriter),_d.Reader._configure(_d.BufferReader)}_d.build="minimal",_d.Writer=_a(42),_d.BufferWriter=_a(43),_d.Reader=_a(27),_d.BufferReader=_a(28),_d.util=_a(39),_d.rpc=_a(31),_d.roots=_a(30),(_d.configure=_e)()},{27:27,28:28,30:30,31:31,39:39,42:42,43:43}],19:[function(_a,_b,_c){var _d=_b.exports=_a(17);_d.build="full",_d.tokenize=_a(34),_d.parse=_a(26),_d.common=_a(11),_d.Root._configure(_d.Type,_d.parse,_d.common)},{11:11,17:17,26:26,34:34}],20:[function(_a,_b,_c){_b.exports=_f;var _g=_a(16);((_f.prototype=Object.create(_g.prototype)).constructor=_f).className="MapField";var _d=_a(36),_h=_a(37);function _f(_a,_b,_c,_d,_e,_f){if(_g.call(this,_a,_b,_d,undefined,undefined,_e,_f),!_h.isString(_c))throw TypeError("keyType must be a string");this.keyType=_c,this.resolvedKeyType=null,this.map=!0}_f.fromJSON=function(_a,_b){return new _f(_a,_b.id,_b.keyType,_b.type,_b.options,_b.comment)},_f.prototype.toJSON=function(_a){var _b=!!_a&&Boolean(_a.keepComments);return _h.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",_b?this.comment:undefined])},_f.prototype.resolve=function(){if(this.resolved)return this;if(_d.mapKey[this.keyType]===undefined)throw Error("invalid key type: "+this.keyType);return _g.prototype.resolve.call(this)},_f.d=function(_c,_d,_e){return"function"==typeof _e?_e=_h.decorateType(_e).name:_e&&"object"==typeof _e&&(_e=_h.decorateEnum(_e).name),function(_a,_b){_h.decorateType(_a.constructor).add(new _f(_b,_c,_d,_e))}}},{16:16,36:36,37:37}],21:[function(_a,_b,_c){_b.exports=_e;var _d=_a(39);function _e(_a){if(_a)for(var _b=Object.keys(_a),_c=0;_c<_b.length;++_c)this[_b[_c]]=_a[_b[_c]]}_e.create=function(_a){return this.$type.create(_a)},_e.encode=function(_a,_b){return this.$type.encode(_a,_b)},_e.encodeDelimited=function(_a,_b){return this.$type.encodeDelimited(_a,_b)},_e.decode=function(_a){return this.$type.decode(_a)},_e.decodeDelimited=function(_a){return this.$type.decodeDelimited(_a)},_e.verify=function(_a){return this.$type.verify(_a)},_e.fromObject=function(_a){return this.$type.fromObject(_a)},_e.toObject=function(_a,_b){return this.$type.toObject(_a,_b)},_e.prototype.toJSON=function(){return this.$type.toObject(this,_d.toJSONOptions)}},{39:39}],22:[function(_a,_b,_c){_b.exports=_d;var _i=_a(24);((_d.prototype=Object.create(_i.prototype)).constructor=_d).className="Method";var _j=_a(37);function _d(_a,_b,_c,_d,_e,_f,_g,_h){if(_j.isObject(_e)?(_g=_e,_e=_f=undefined):_j.isObject(_f)&&(_g=_f,_f=undefined),_b!==undefined&&!_j.isString(_b))throw TypeError("type must be a string");if(!_j.isString(_c))throw TypeError("requestType must be a string");if(!_j.isString(_d))throw TypeError("responseType must be a string");_i.call(this,_a,_g),this.type=_b||"rpc",this.requestType=_c,this.requestStream=!!_e||undefined,this.responseType=_d,this.responseStream=!!_f||undefined,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=_h}_d.fromJSON=function(_a,_b){return new _d(_a,_b.type,_b.requestType,_b.responseType,_b.requestStream,_b.responseStream,_b.options,_b.comment)},_d.prototype.toJSON=function(_a){var _b=!!_a&&Boolean(_a.keepComments);return _j.toObject(["type","rpc"!==this.type&&this.type||undefined,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",_b?this.comment:undefined])},_d.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),_i.prototype.resolve.call(this))}},{24:24,37:37}],23:[function(_a,_b,_c){_b.exports=_k;var _d=_a(24);((_k.prototype=Object.create(_d.prototype)).constructor=_k).className="Namespace";var _e,_f,_g,_h=_a(16),_i=_a(37);function _j(_a,_b){if(!_a||!_a.length)return undefined;for(var _c={},_d=0;_d<_a.length;++_d)_c[_a[_d].name]=_a[_d].toJSON(_b);return _c}function _k(_a,_b){_d.call(this,_a,_b),this.nested=undefined,this._nestedArray=null}function _l(_a){return _a._nestedArray=null,_a}_k.fromJSON=function(_a,_b){return new _k(_a,_b.options).addJSON(_b.nested)},_k.arrayToJSON=_j,_k.isReservedId=function(_a,_b){if(_a)for(var _c=0;_c<_a.length;++_c)if("string"!=typeof _a[_c]&&_a[_c][0]<=_b&&_a[_c][1]>_b)return!0;return!1},_k.isReservedName=function(_a,_b){if(_a)for(var _c=0;_c<_a.length;++_c)if(_a[_c]===_b)return!0;return!1},Object.defineProperty(_k.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=_i.toArray(this.nested))}}),_k.prototype.toJSON=function(_a){return _i.toObject(["options",this.options,"nested",_j(this.nestedArray,_a)])},_k.prototype.addJSON=function(_a){if(_a)for(var _b,_c=Object.keys(_a),_d=0;_d<_c.length;++_d)_b=_a[_c[_d]],this.add((_b.fields!==undefined?_e.fromJSON:_b.values!==undefined?_g.fromJSON:_b.methods!==undefined?_f.fromJSON:_b.id!==undefined?_h.fromJSON:_k.fromJSON)(_c[_d],_b));return this},_k.prototype.get=function(_a){return this.nested&&this.nested[_a]||null},_k.prototype.getEnum=function(_a){if(this.nested&&this.nested[_a]instanceof _g)return this.nested[_a].values;throw Error("no such enum: "+_a)},_k.prototype.add=function(_a){if(!(_a instanceof _h&&_a.extend!==undefined||_a instanceof _e||_a instanceof _g||_a instanceof _f||_a instanceof _k))throw TypeError("object must be a valid nested object");if(this.nested){var _b=this.get(_a.name);if(_b){if(!(_b instanceof _k&&_a instanceof _k)||_b instanceof _e||_b instanceof _f)throw Error("duplicate name '"+_a.name+"' in "+this);for(var _c=_b.nestedArray,_d=0;_d<_c.length;++_d)_a.add(_c[_d]);this.remove(_b),this.nested||(this.nested={}),_a.setOptions(_b.options,!0)}}else this.nested={};return(this.nested[_a.name]=_a).onAdd(this),_l(this)},_k.prototype.remove=function(_a){if(!(_a instanceof _d))throw TypeError("object must be a ReflectionObject");if(_a.parent!==this)throw Error(_a+" is not a member of "+this);return delete this.nested[_a.name],Object.keys(this.nested).length||(this.nested=undefined),_a.onRemove(this),_l(this)},_k.prototype.define=function(_a,_b){if(_i.isString(_a))_a=_a.split(".");else if(!Array.isArray(_a))throw TypeError("illegal path");if(_a&&_a.length&&""===_a[0])throw Error("path must be relative");for(var _c=this;0<_a.length;){var _d=_a.shift();if(_c.nested&&_c.nested[_d]){if(!((_c=_c.nested[_d])instanceof _k))throw Error("path conflicts with non-namespace objects")}else _c.add(_c=new _k(_d))}return _b&&_c.addJSON(_b),_c},_k.prototype.resolveAll=function(){for(var _a=this.nestedArray,_b=0;_b<_a.length;)_a[_b]instanceof _k?_a[_b++].resolveAll():_a[_b++].resolve();return this.resolve()},_k.prototype.lookup=function(_a,_b,_c){if("boolean"==typeof _b?(_c=_b,_b=undefined):_b&&!Array.isArray(_b)&&(_b=[_b]),_i.isString(_a)&&_a.length){if("."===_a)return this.root;_a=_a.split(".")}else if(!_a.length)return this;if(""===_a[0])return this.root.lookup(_a.slice(1),_b);var _d=this.get(_a[0]);if(_d){if(1===_a.length){if(!_b||-1<_b.indexOf(_d.constructor))return _d}else if(_d instanceof _k&&(_d=_d.lookup(_a.slice(1),_b,!0)))return _d}else for(var _e=0;_e<this.nestedArray.length;++_e)if(this._nestedArray[_e]instanceof _k&&(_d=this._nestedArray[_e].lookup(_a,_b,!0)))return _d;return null===this.parent||_c?null:this.parent.lookup(_a,_b)},_k.prototype.lookupType=function(_a){var _b=this.lookup(_a,[_e]);if(!_b)throw Error("no such type: "+_a);return _b},_k.prototype.lookupEnum=function(_a){var _b=this.lookup(_a,[_g]);if(!_b)throw Error("no such Enum '"+_a+"' in "+this);return _b},_k.prototype.lookupTypeOrEnum=function(_a){var _b=this.lookup(_a,[_e,_g]);if(!_b)throw Error("no such Type or Enum '"+_a+"' in "+this);return _b},_k.prototype.lookupService=function(_a){var _b=this.lookup(_a,[_f]);if(!_b)throw Error("no such Service '"+_a+"' in "+this);return _b},_k._configure=function(_a,_b,_c){_e=_a,_f=_b,_g=_c}},{16:16,24:24,37:37}],24:[function(_a,_b,_c){(_b.exports=_f).className="ReflectionObject";var _d,_e=_a(37);function _f(_a,_b){if(!_e.isString(_a))throw TypeError("name must be a string");if(_b&&!_e.isObject(_b))throw TypeError("options must be an object");this.options=_b,this.name=_a,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(_f.prototype,{root:{get:function(){for(var _a=this;null!==_a.parent;)_a=_a.parent;return _a}},fullName:{get:function(){for(var _a=[this.name],_b=this.parent;_b;)_a.unshift(_b.name),_b=_b.parent;return _a.join(".")}}}),_f.prototype.toJSON=function(){throw Error()},_f.prototype.onAdd=function(_a){this.parent&&this.parent!==_a&&this.parent.remove(this),this.parent=_a,this.resolved=!1;var _b=_a.root;_b instanceof _d&&_b._handleAdd(this)},_f.prototype.onRemove=function(_a){var _b=_a.root;_b instanceof _d&&_b._handleRemove(this),this.parent=null,this.resolved=!1},_f.prototype.resolve=function(){return this.resolved||this.root instanceof _d&&(this.resolved=!0),this},_f.prototype.getOption=function(_a){return this.options?this.options[_a]:undefined},_f.prototype.setOption=function(_a,_b,_c){return _c&&this.options&&this.options[_a]!==undefined||((this.options||(this.options={}))[_a]=_b),this},_f.prototype.setOptions=function(_a,_b){if(_a)for(var _c=Object.keys(_a),_d=0;_d<_c.length;++_d)this.setOption(_c[_d],_a[_c[_d]],_b);return this},_f.prototype.toString=function(){var _a=this.constructor.className,_b=this.fullName;return _b.length?_a+" "+_b:_a},_f._configure=function(_a){_d=_a}},{37:37}],25:[function(_a,_b,_c){_b.exports=_g;var _e=_a(24);((_g.prototype=Object.create(_e.prototype)).constructor=_g).className="OneOf";var _d=_a(16),_f=_a(37);function _g(_a,_b,_c,_d){if(Array.isArray(_b)||(_c=_b,_b=undefined),_e.call(this,_a,_c),_b!==undefined&&!Array.isArray(_b))throw TypeError("fieldNames must be an Array");this.oneof=_b||[],this.fieldsArray=[],this.comment=_d}function _h(_a){if(_a.parent)for(var _b=0;_b<_a.fieldsArray.length;++_b)_a.fieldsArray[_b].parent||_a.parent.add(_a.fieldsArray[_b])}_g.fromJSON=function(_a,_b){return new _g(_a,_b.oneof,_b.options,_b.comment)},_g.prototype.toJSON=function(_a){var _b=!!_a&&Boolean(_a.keepComments);return _f.toObject(["options",this.options,"oneof",this.oneof,"comment",_b?this.comment:undefined])},_g.prototype.add=function(_a){if(!(_a instanceof _d))throw TypeError("field must be a Field");return _a.parent&&_a.parent!==this.parent&&_a.parent.remove(_a),this.oneof.push(_a.name),this.fieldsArray.push(_a),_h(_a.partOf=this),this},_g.prototype.remove=function(_a){if(!(_a instanceof _d))throw TypeError("field must be a Field");var _b=this.fieldsArray.indexOf(_a);if(_b<0)throw Error(_a+" is not a member of "+this);return this.fieldsArray.splice(_b,1),-1<(_b=this.oneof.indexOf(_a.name))&&this.oneof.splice(_b,1),_a.partOf=null,this},_g.prototype.onAdd=function(_a){_e.prototype.onAdd.call(this,_a);for(var _b=0;_b<this.oneof.length;++_b){var _c=_a.get(this.oneof[_b]);_c&&!_c.partOf&&(_c.partOf=this).fieldsArray.push(_c)}_h(this)},_g.prototype.onRemove=function(_a){for(var _b,_c=0;_c<this.fieldsArray.length;++_c)(_b=this.fieldsArray[_c]).parent&&_b.parent.remove(_b);_e.prototype.onRemove.call(this,_a)},_g.d=function(){for(var _c=new Array(arguments.length),_a=0;_a<arguments.length;)_c[_a]=arguments[_a++];return function(_a,_b){_f.decorateType(_a.constructor).add(new _g(_b,_c)),Object.defineProperty(_a,_b,{get:_f.oneOfGetter(_c),set:_f.oneOfSetter(_c)})}}},{16:16,24:24,37:37}],26:[function(_a,_b,_c){(_b.exports=__).filename=null,__.defaults={keepCase:!1};var _G=_a(34),_H=_a(29),_I=_a(35),_J=_a(16),_K=_a(20),_L=_a(25),_M=_a(15),_N=_a(33),_O=_a(22),_P=_a(36),_Q=_a(37),_R=/^[1-9][0-9]*$/,_S=/^-?[1-9][0-9]*$/,_T=/^0[x][0-9a-fA-F]+$/,_U=/^-?0[x][0-9a-fA-F]+$/,_V=/^0[0-7]+$/,_W=/^-?0[0-7]+$/,_X=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,_Y=/^[a-zA-Z_][a-zA-Z_0-9]*$/,_Z=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,_$=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function __(_a,_b,_c){_b instanceof _H||(_c=_b,_b=new _H),_c||(_c=__.defaults);var _d,_e,_f,_g,_h,_i=_G(_a,_c.alternateCommentMode||!1),_k=_i.next,_j=_i.push,_l=_i.peek,_m=_i.skip,_n=_i.cmnt,_o=!0,_p=!1,_q=_b,_r=_c.keepCase?function(_a){return _a}:_Q.camelCase;function _s(_a,_b,_c){var _d=__.filename;return _c||(__.filename=null),Error("illegal "+(_b||"token")+" '"+_a+"' ("+(_d?_d+", ":"")+"line "+_i.line+")")}function _t(){var _a,_b=[];do{if('"'!==(_a=_k())&&"'"!==_a)throw _s(_a);_b.push(_k()),_m(_a),_a=_l()}while('"'===_a||"'"===_a);return _b.join("")}function _u(_b){var _c=_k();switch(_c){case"'":case'"':return _j(_c),_t();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(_a,_b){var _c=1;"-"===_a.charAt(0)&&(_c=-1,_a=_a.substring(1));switch(_a){case"inf":case"INF":case"Inf":return _c*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(_R.test(_a))return _c*parseInt(_a,10);if(_T.test(_a))return _c*parseInt(_a,16);if(_V.test(_a))return _c*parseInt(_a,8);if(_X.test(_a))return _c*parseFloat(_a);throw _s(_a,"number",_b)}(_c,!0)}catch(_a){if(_b&&_Z.test(_c))return _c;throw _s(_c,"value")}}function _v(_a,_b){for(var _c,_d;!_b||'"'!==(_c=_l())&&"'"!==_c?_a.push([_d=_w(_k()),_m("to",!0)?_w(_k()):_d]):_a.push(_t()),_m(",",!0););_m(";")}function _w(_a,_b){switch(_a){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!_b&&"-"===_a.charAt(0))throw _s(_a,"id");if(_S.test(_a))return parseInt(_a,10);if(_U.test(_a))return parseInt(_a,16);if(_W.test(_a))return parseInt(_a,8);throw _s(_a,"id")}function _x(){if(_d!==undefined)throw _s("package");if(_d=_k(),!_Z.test(_d))throw _s(_d,"name");_q=_q.define(_d),_m(";")}function _y(){var _a,_b=_l();switch(_b){case"weak":_a=_f||(_f=[]),_k();break;case"public":_k();default:_a=_e||(_e=[])}_b=_t(),_m(";"),_a.push(_b)}function _z(){if(_m("="),_g=_t(),!(_p="proto3"===_g)&&"proto2"!==_g)throw _s(_g,"syntax");_m(";")}function _A(_a,_b){switch(_b){case"option":return _D(_a,_b),_m(";"),!0;case"message":return function(_a,_b){if(!_Y.test(_b=_k()))throw _s(_b,"type name");var _c=new _I(_b);_B(_c,function(_a){if(!_A(_c,_a))switch(_a){case"map":!function(_a){_m("<");var _b=_k();if(_P.mapKey[_b]===undefined)throw _s(_b,"type");_m(",");var _c=_k();if(!_Z.test(_c))throw _s(_c,"type");_m(">");var _d=_k();if(!_Y.test(_d))throw _s(_d,"name");_m("=");var _e=new _K(_r(_d),_w(_k()),_b,_c);_B(_e,function(_a){if("option"!==_a)throw _s(_a);_D(_e,_a),_m(";")},function(){_F(_e)}),_a.add(_e)}(_c);break;case"required":case"optional":case"repeated":_C(_c,_a);break;case"oneof":!function(_a,_b){if(!_Y.test(_b=_k()))throw _s(_b,"name");var _c=new _L(_r(_b));_B(_c,function(_a){"option"===_a?(_D(_c,_a),_m(";")):(_j(_a),_C(_c,"optional"))}),_a.add(_c)}(_c,_a);break;case"extensions":_v(_c.extensions||(_c.extensions=[]));break;case"reserved":_v(_c.reserved||(_c.reserved=[]),!0);break;default:if(!_p||!_Z.test(_a))throw _s(_a);_j(_a),_C(_c,"optional")}}),_a.add(_c)}(_a,_b),!0;case"enum":return function(_a,_b){if(!_Y.test(_b=_k()))throw _s(_b,"name");var _c=new _M(_b);_B(_c,function(_a){switch(_a){case"option":_D(_c,_a),_m(";");break;case"reserved":_v(_c.reserved||(_c.reserved=[]),!0);break;default:!function(_a,_b){if(!_Y.test(_b))throw _s(_b,"name");_m("=");var _c=_w(_k(),!0),_d={};_B(_d,function(_a){if("option"!==_a)throw _s(_a);_D(_d,_a),_m(";")},function(){_F(_d)}),_a.add(_b,_c,_d.comment)}(_c,_a)}}),_a.add(_c)}(_a,_b),!0;case"service":return function(_a,_b){if(!_Y.test(_b=_k()))throw _s(_b,"service name");var _c=new _N(_b);_B(_c,function(_a){if(!_A(_c,_a)){if("rpc"!==_a)throw _s(_a);!function(_a,_b){var _c=_n(),_d=_b;if(!_Y.test(_b=_k()))throw _s(_b,"name");var _e,_f,_g,_h,_i=_b;_m("("),_m("stream",!0)&&(_f=!0);if(!_Z.test(_b=_k()))throw _s(_b);_e=_b,_m(")"),_m("returns"),_m("("),_m("stream",!0)&&(_h=!0);if(!_Z.test(_b=_k()))throw _s(_b);_g=_b,_m(")");var _j=new _O(_i,_d,_e,_g,_f,_h);_j.comment=_c,_B(_j,function(_a){if("option"!==_a)throw _s(_a);_D(_j,_a),_m(";")}),_a.add(_j)}(_c,_a)}}),_a.add(_c)}(_a,_b),!0;case"extend":return function(_b,_a){if(!_Z.test(_a=_k()))throw _s(_a,"reference");var _c=_a;_B(null,function(_a){switch(_a){case"required":case"repeated":case"optional":_C(_b,_a,_c);break;default:if(!_p||!_Z.test(_a))throw _s(_a);_j(_a),_C(_b,"optional",_c)}})}(_a,_b),!0}return!1}function _B(_a,_b,_c){var _d=_i.line;if(_a&&("string"!=typeof _a.comment&&(_a.comment=_n()),_a.filename=__.filename),_m("{",!0)){for(var _e;"}"!==(_e=_k());)_b(_e);_m(";",!0)}else _c&&_c(),_m(";"),_a&&"string"!=typeof _a.comment&&(_a.comment=_n(_d))}function _C(_a,_b,_c){var _d=_k();if("group"!==_d){if(!_Z.test(_d))throw _s(_d,"type");var _e=_k();if(!_Y.test(_e))throw _s(_e,"name");_e=_r(_e),_m("=");var _f=new _J(_e,_w(_k()),_d,_b,_c);_B(_f,function(_a){if("option"!==_a)throw _s(_a);_D(_f,_a),_m(";")},function(){_F(_f)}),_a.add(_f),_p||!_f.repeated||_P.packed[_d]===undefined&&_P.basic[_d]!==undefined||_f.setOption("packed",!1,!0)}else!function(_a,_b){var _c=_k();if(!_Y.test(_c))throw _s(_c,"name");var _d=_Q.lcFirst(_c);_c===_d&&(_c=_Q.ucFirst(_c));_m("=");var _e=_w(_k()),_f=new _I(_c);_f.group=!0;var _g=new _J(_d,_e,_c,_b);_g.filename=__.filename,_B(_f,function(_a){switch(_a){case"option":_D(_f,_a),_m(";");break;case"required":case"optional":case"repeated":_C(_f,_a);break;default:throw _s(_a)}}),_a.add(_f).add(_g)}(_a,_b)}function _D(_a,_b){var _c=_m("(",!0);if(!_Z.test(_b=_k()))throw _s(_b,"name");var _d=_b;_c&&(_m(")"),_d="("+_d+")",_b=_l(),_$.test(_b)&&(_d+=_b,_k())),_m("="),function _a(_b,_c){if(_m("{",!0))do{if(!_Y.test(_h=_k()))throw _s(_h,"name");"{"===_l()?_a(_b,_c+"."+_h):(_m(":"),"{"===_l()?_a(_b,_c+"."+_h):_E(_b,_c+"."+_h,_u(!0))),_m(",",!0)}while(!_m("}",!0));else _E(_b,_c,_u(!0))}(_a,_d)}function _E(_a,_b,_c){_a.setOption&&_a.setOption(_b,_c)}function _F(_a){if(_m("[",!0)){for(;_D(_a,"option"),_m(",",!0););_m("]")}return _a}for(;null!==(_h=_k());)switch(_h){case"package":if(!_o)throw _s(_h);_x();break;case"import":if(!_o)throw _s(_h);_y();break;case"syntax":if(!_o)throw _s(_h);_z();break;case"option":_D(_q,_h),_m(";");break;default:if(_A(_q,_h)){_o=!1;continue}throw _s(_h)}return __.filename=null,{package:_d,imports:_e,weakImports:_f,syntax:_g,root:_b}}},{15:15,16:16,20:20,22:22,25:25,29:29,33:33,34:34,35:35,36:36,37:37}],27:[function(_a,_b,_c){_b.exports=_i;var _d,_e=_a(39),_f=_e.LongBits,_g=_e.utf8;function _h(_a,_b){return RangeError("index out of range: "+_a.pos+" + "+(_b||1)+" > "+_a.len)}function _i(_a){this.buf=_a,this.pos=0,this.len=_a.length}function _j(){return _e.Buffer?function(_a){return(_i.create=function(_a){return _e.Buffer.isBuffer(_a)?new _d(_a):_l(_a)})(_a)}:_l}var _k,_l="undefined"!=typeof Uint8Array?function(_a){if(_a instanceof Uint8Array||Array.isArray(_a))return new _i(_a);throw Error("illegal buffer")}:function(_a){if(Array.isArray(_a))return new _i(_a);throw Error("illegal buffer")};function _m(){var _a=new _f(0,0),_b=0;if(!(4<this.len-this.pos)){for(;_b<3;++_b){if(this.pos>=this.len)throw _h(this);if(_a.lo=(_a.lo|(127&this.buf[this.pos])<<7*_b)>>>0,this.buf[this.pos++]<128)return _a}return _a.lo=(_a.lo|(127&this.buf[this.pos++])<<7*_b)>>>0,_a}for(;_b<4;++_b)if(_a.lo=(_a.lo|(127&this.buf[this.pos])<<7*_b)>>>0,this.buf[this.pos++]<128)return _a;if(_a.lo=(_a.lo|(127&this.buf[this.pos])<<28)>>>0,_a.hi=(_a.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return _a;if(_b=0,4<this.len-this.pos){for(;_b<5;++_b)if(_a.hi=(_a.hi|(127&this.buf[this.pos])<<7*_b+3)>>>0,this.buf[this.pos++]<128)return _a}else for(;_b<5;++_b){if(this.pos>=this.len)throw _h(this);if(_a.hi=(_a.hi|(127&this.buf[this.pos])<<7*_b+3)>>>0,this.buf[this.pos++]<128)return _a}throw Error("invalid varint encoding")}function _n(_a,_b){return(_a[_b-4]|_a[_b-3]<<8|_a[_b-2]<<16|_a[_b-1]<<24)>>>0}function _o(){if(this.pos+8>this.len)throw _h(this,8);return new _f(_n(this.buf,this.pos+=4),_n(this.buf,this.pos+=4))}_i.create=_j(),_i.prototype._slice=_e.Array.prototype.subarray||_e.Array.prototype.slice,_i.prototype.uint32=(_k=4294967295,function(){if(_k=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return _k;if(_k=(_k|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return _k;if(_k=(_k|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return _k;if(_k=(_k|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return _k;if(_k=(_k|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return _k;if((this.pos+=5)>this.len)throw this.pos=this.len,_h(this,10);return _k}),_i.prototype.int32=function(){return 0|this.uint32()},_i.prototype.sint32=function(){var _a=this.uint32();return _a>>>1^-(1&_a)|0},_i.prototype.bool=function(){return 0!==this.uint32()},_i.prototype.fixed32=function(){if(this.pos+4>this.len)throw _h(this,4);return _n(this.buf,this.pos+=4)},_i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw _h(this,4);return 0|_n(this.buf,this.pos+=4)},_i.prototype.uint64=function(){if(this.pos+1>this.len)throw _h(this,1);var _a=0,_b=this.buf[this.pos];switch(_b>>4){case 0:if(this.pos+5>this.len)throw _h(this,5);_a=_e.float.readFloatLE(this.buf,this.pos+1),this.pos+=5;break;case 1:if(this.pos+9>this.len)throw _h(this,9);_a=_e.float.readDoubleLE(this.buf,this.pos+1),this.pos+=9;break;case 2:case 7:_a=15&_b,this.pos+=1;break;case 3:case 8:if(this.pos+2>this.len)throw _h(this,2);_a=this.buf[this.pos+1],this.pos+=2;break;case 4:case 9:if(this.pos+3>this.len)throw _h(this,3);_a=(this.buf[this.pos+2]<<8|this.buf[this.pos+1])>>>0,this.pos+=3;break;case 5:case 10:if(this.pos+5>this.len)throw _h(this,5);_a=Math.floor(16777216*this.buf[this.pos+4]+65536*this.buf[this.pos+3]+256*this.buf[this.pos+2]+this.buf[this.pos+1]),this.pos+=5;break;case 6:case 11:if(this.pos+9>this.len)throw _h(this,9);var _c=Math.floor(16777216*this.buf[this.pos+4]+65536*this.buf[this.pos+3]+256*this.buf[this.pos+2]+this.buf[this.pos+1]),_d=Math.floor(16777216*this.buf[this.pos+8]+65536*this.buf[this.pos+7]+256*this.buf[this.pos+6]+this.buf[this.pos+5]);_a=Math.floor(4294967296*_d+_c),this.pos+=9}return 7<=_b>>4&&(_a=-_a),_a},_i.prototype.float=function(){if(this.pos+4>this.len)throw _h(this,4);var _a=_e.float.readFloatLE(this.buf,this.pos);return this.pos+=4,_a},_i.prototype.double=function(){if(this.pos+8>this.len)throw _h(this,4);var _a=_e.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,_a},_i.prototype.bytes=function(){var _a=this.uint32(),_b=this.pos,_c=this.pos+_a;if(_c>this.len)throw _h(this,_a);return this.pos+=_a,Array.isArray(this.buf)?this.buf.slice(_b,_c):_b===_c?new this.buf.constructor(0):this._slice.call(this.buf,_b,_c)},_i.prototype.string=function(){var _a=this.bytes();return _g.read(_a,0,_a.length)},_i.prototype.skip=function(_a){if("number"==typeof _a){if(this.pos+_a>this.len)throw _h(this,_a);this.pos+=_a}else do{if(this.pos>=this.len)throw _h(this)}while(128&this.buf[this.pos++]);return this},_i.prototype.skipType=function(_a){switch(_a){case 0:this.skip();break;case 4:var _b=this.buf[this.pos]>>4,_c=0;0==_b?_c=5:1==_b?_c=9:2==_b||7==_b?_c=1:3==_b||8==_b?_c=2:4==_b||9==_b?_c=3:5==_b||10==_b?_c=5:6!=_b&&11!=_b||(_c=9),this.skip(_c);break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(_a=7&this.uint32());)this.skipType(_a);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+_a+" at offset "+this.pos)}return this},_i._configure=function(_a){_d=_a,_i.create=_j(),_d._configure();var _b=_e.Long?"toLong":"toNumber";_e.merge(_i.prototype,{int64:function(){return _m.call(this)[_b](!1)},sint64:function(){return _m.call(this).zzDecode()[_b](!1)},fixed64:function(){return _o.call(this)[_b](!0)},sfixed64:function(){return _o.call(this)[_b](!1)}})}},{39:39}],28:[function(_a,_b,_c){_b.exports=_f;var _d=_a(27);(_f.prototype=Object.create(_d.prototype)).constructor=_f;var _e=_a(39);function _f(_a){_d.call(this,_a)}_f._configure=function(){_e.Buffer&&(_f.prototype._slice=_e.Buffer.prototype.slice)},_f.prototype.string=function(){var _a=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+_a,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+_a,this.len))},_f._configure()},{27:27,39:39}],29:[function(_a,_b,_c){_b.exports=_i;var _d=_a(23);((_i.prototype=Object.create(_d.prototype)).constructor=_i).className="Root";var _e,_n,_o,_f=_a(16),_g=_a(15),_h=_a(25),_p=_a(37);function _i(_a){_d.call(this,"",_a),this.deferred=[],this.files=[]}function _q(){}_i.fromJSON=function(_a,_b){return _b||(_b=new _i),_a.options&&_b.setOptions(_a.options),_b.addJSON(_a.nested)},_i.prototype.resolvePath=_p.path.resolve,_i.prototype.load=function _a(_b,_f,_e){"function"==typeof _f&&(_e=_f,_f=undefined);var _g=this;if(!_e)return _p.asPromise(_a,_g,_b,_f);var _h=_e===_q;function _i(_a,_b){if(_e){var _c=_e;if(_e=null,_h)throw _a;_c(_a,_b)}}function _j(_a){var _b=_a.lastIndexOf("google/protobuf/");if(-1<_b){var _c=_a.substring(_b);if(_c in _o)return _c}return null}function _k(_a,_b){try{if(_p.isString(_b)&&"{"===_b.charAt(0)&&(_b=JSON.parse(_b)),_p.isString(_b)){_n.filename=_a;var _c,_d=_n(_b,_g,_f),_e=0;if(_d.imports)for(;_e<_d.imports.length;++_e)(_c=_j(_d.imports[_e])||_g.resolvePath(_a,_d.imports[_e]))&&_l(_c);if(_d.weakImports)for(_e=0;_e<_d.weakImports.length;++_e)(_c=_j(_d.weakImports[_e])||_g.resolvePath(_a,_d.weakImports[_e]))&&_l(_c,!0)}else _g.setOptions(_b.options).addJSON(_b.nested)}catch(_a){_i(_a)}_h||_m||_i(null,_g)}function _l(_c,_d){if(!(-1<_g.files.indexOf(_c)))if(_g.files.push(_c),_c in _o)_h?_k(_c,_o[_c]):(++_m,setTimeout(function(){--_m,_k(_c,_o[_c])}));else if(_h){var _a;try{_a=_p.fs.readFileSync(_c).toString("utf8")}catch(_a){return void(_d||_i(_a))}_k(_c,_a)}else++_m,_p.fetch(_c,function(_a,_b){--_m,_e&&(_a?_d?_m||_i(null,_g):_i(_a):_k(_c,_b))})}var _m=0;_p.isString(_b)&&(_b=[_b]);for(var _c,_d=0;_d<_b.length;++_d)(_c=_g.resolvePath("",_b[_d]))&&_l(_c);return _h?_g:(_m||_i(null,_g),undefined)},_i.prototype.loadSync=function(_a,_b){if(!_p.isNode)throw Error("not supported");return this.load(_a,_b,_q)},_i.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(_a){return"'extend "+_a.extend+"' in "+_a.parent.fullName}).join(", "));return _d.prototype.resolveAll.call(this)};var _j=/^[A-Z]/;function _k(_a,_b){var _c=_b.parent.lookup(_b.extend);if(_c){var _d=new _f(_b.fullName,_b.id,_b.type,_b.rule,undefined,_b.options);return(_d.declaringField=_b).extensionField=_d,_c.add(_d),!0}return!1}_i.prototype._handleAdd=function(_a){if(_a instanceof _f)_a.extend===undefined||_a.extensionField||_k(0,_a)||this.deferred.push(_a);else if(_a instanceof _g)_j.test(_a.name)&&(_a.parent[_a.name]=_a.values);else if(!(_a instanceof _h)){if(_a instanceof _e)for(var _b=0;_b<this.deferred.length;)_k(0,this.deferred[_b])?this.deferred.splice(_b,1):++_b;for(var _c=0;_c<_a.nestedArray.length;++_c)this._handleAdd(_a._nestedArray[_c]);_j.test(_a.name)&&(_a.parent[_a.name]=_a)}},_i.prototype._handleRemove=function(_a){if(_a instanceof _f){if(_a.extend!==undefined)if(_a.extensionField)_a.extensionField.parent.remove(_a.extensionField),_a.extensionField=null;else{var _b=this.deferred.indexOf(_a);-1<_b&&this.deferred.splice(_b,1)}}else if(_a instanceof _g)_j.test(_a.name)&&delete _a.parent[_a.name];else if(_a instanceof _d){for(var _c=0;_c<_a.nestedArray.length;++_c)this._handleRemove(_a._nestedArray[_c]);_j.test(_a.name)&&delete _a.parent[_a.name]}},_i._configure=function(_a,_b,_c){_e=_a,_n=_b,_o=_c}},{15:15,16:16,23:23,25:25,37:37}],30:[function(_a,_b,_c){_b.exports={}},{}],31:[function(_a,_b,_c){_c.Service=_a(32)},{32:32}],32:[function(_a,_b,_c){_b.exports=_d;var _h=_a(39);function _d(_a,_b,_c){if("function"!=typeof _a)throw TypeError("rpcImpl must be a function");_h.EventEmitter.call(this),this.rpcImpl=_a,this.requestDelimited=Boolean(_b),this.responseDelimited=Boolean(_c)}((_d.prototype=Object.create(_h.EventEmitter.prototype)).constructor=_d).prototype.rpcCall=function _a(_c,_b,_d,_e,_f){if(!_e)throw TypeError("request must be specified");var _g=this;if(!_f)return _h.asPromise(_a,_g,_c,_b,_d,_e);if(!_g.rpcImpl)return setTimeout(function(){_f(Error("already ended"))},0),undefined;try{return _g.rpcImpl(_c,_b[_g.requestDelimited?"encodeDelimited":"encode"](_e).finish(),function(_a,_b){if(_a)return _g.emit("error",_a,_c),_f(_a);if(null===_b)return _g.end(!0),undefined;if(!(_b instanceof _d))try{_b=_d[_g.responseDelimited?"decodeDelimited":"decode"](_b)}catch(_a){return _g.emit("error",_a,_c),_f(_a)}return _g.emit("data",_b,_c),_f(null,_b)})}catch(_a){return _g.emit("error",_a,_c),setTimeout(function(){_f(_a)},0),undefined}},_d.prototype.end=function(_a){return this.rpcImpl&&(_a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{39:39}],33:[function(_a,_b,_c){_b.exports=_g;var _d=_a(23);((_g.prototype=Object.create(_d.prototype)).constructor=_g).className="Service";var _f=_a(22),_h=_a(37),_i=_a(31);function _g(_a,_b){_d.call(this,_a,_b),this.methods={},this._methodsArray=null}function _e(_a){return _a._methodsArray=null,_a}_g.fromJSON=function(_a,_b){var _c=new _g(_a,_b.options);if(_b.methods)for(var _d=Object.keys(_b.methods),_e=0;_e<_d.length;++_e)_c.add(_f.fromJSON(_d[_e],_b.methods[_d[_e]]));return _b.nested&&_c.addJSON(_b.nested),_c.comment=_b.comment,_c},_g.prototype.toJSON=function(_a){var _b=_d.prototype.toJSON.call(this,_a),_c=!!_a&&Boolean(_a.keepComments);return _h.toObject(["options",_b&&_b.options||undefined,"methods",_d.arrayToJSON(this.methodsArray,_a)||{},"nested",_b&&_b.nested||undefined,"comment",_c?this.comment:undefined])},Object.defineProperty(_g.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=_h.toArray(this.methods))}}),_g.prototype.get=function(_a){return this.methods[_a]||_d.prototype.get.call(this,_a)},_g.prototype.resolveAll=function(){for(var _a=this.methodsArray,_b=0;_b<_a.length;++_b)_a[_b].resolve();return _d.prototype.resolve.call(this)},_g.prototype.add=function(_a){if(this.get(_a.name))throw Error("duplicate name '"+_a.name+"' in "+this);return _a instanceof _f?_e((this.methods[_a.name]=_a).parent=this):_d.prototype.add.call(this,_a)},_g.prototype.remove=function(_a){if(_a instanceof _f){if(this.methods[_a.name]!==_a)throw Error(_a+" is not a member of "+this);return delete this.methods[_a.name],_a.parent=null,_e(this)}return _d.prototype.remove.call(this,_a)},_g.prototype.create=function(_a,_b,_c){for(var _d,_e=new _i.Service(_a,_b,_c),_f=0;_f<this.methodsArray.length;++_f){var _g=_h.lcFirst((_d=this._methodsArray[_f]).resolve().name).replace(/[^$\w_]/g,"");_e[_g]=_h.codegen(["r","c"],_h.isReserved(_g)?_g+"_":_g)("return this.rpcCall(m,q,s,r,c)")({m:_d,q:_d.resolvedRequestType.ctor,s:_d.resolvedResponseType.ctor})}return _e}},{22:22,23:23,31:31,37:37}],34:[function(_a,_b,_c){_b.exports=_f;var _x=/[\s{}=;:[\],'"()<>]/g,_y=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,_z=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,_A=/^ *[*/]+ */,_B=/^\s*\*?\/*/,_C=/\n/g,_D=/\s/,_d=/\\(.?)/g,_e={0:"\0",r:"\r",n:"\n",t:"\t"};function _E(_a){return _a.replace(_d,function(_a,_b){switch(_b){case"\\":case"":return _b;default:return _e[_b]||""}})}function _f(_h,_i){_h=_h.toString();var _j=0,_k=_h.length,_l=1,_g=null,_m=null,_n=0,_o=!1,_p=[],_q=null;function _r(_a){return Error("illegal "+_a+" (line "+_l+")")}function _s(_a){return _h.charAt(_a)}function _t(_a,_b){_g=_h.charAt(_a++),_n=_l,_o=!1;var _c,_d=_a-(_i?2:3);do{if(--_d<0||"\n"===(_c=_h.charAt(_d))){_o=!0;break}}while(" "===_c||"\t"===_c);for(var _e=_h.substring(_a,_b).split(_C),_f=0;_f<_e.length;++_f)_e[_f]=_e[_f].replace(_i?_B:_A,"").trim();_m=_e.join("\n").trim()}function _u(_a){var _b=_v(_a),_c=_h.substring(_a,_b);return/^\s*\/{1,2}/.test(_c)}function _v(_a){for(var _b=_a;_b<_k&&"\n"!==_s(_b);)_b++;return _b}function _d(){if(0<_p.length)return _p.shift();if(_q)return function(){var _a="'"===_q?_z:_y;_a.lastIndex=_j-1;var _b=_a.exec(_h);if(!_b)throw _r("string");return _j=_a.lastIndex,_w(_q),_q=null,_E(_b[1])}();var _a,_b,_c,_d,_e;do{if(_j===_k)return null;for(_a=!1;_D.test(_c=_s(_j));)if("\n"===_c&&++_l,++_j===_k)return null;if("/"===_s(_j)){if(++_j===_k)throw _r("comment");if("/"===_s(_j))if(_i){if(_e=!1,_u(_d=_j)){_e=!0;do{if((_j=_v(_j))===_k)break;_j++}while(_u(_j))}else _j=Math.min(_k,_v(_j)+1);_e&&_t(_d,_j),_l++,_a=!0}else{for(_e="/"===_s(_d=_j+1);"\n"!==_s(++_j);)if(_j===_k)return null;++_j,_e&&_t(_d,_j-1),++_l,_a=!0}else{if("*"!==(_c=_s(_j)))return"/";_d=_j+1,_e=_i||"*"===_s(_d);do{if("\n"===_c&&++_l,++_j===_k)throw _r("comment");_b=_c,_c=_s(_j)}while("*"!==_b||"/"!==_c);++_j,_e&&_t(_d,_j-2),_a=!0}}}while(_a);var _f=_j;if(_x.lastIndex=0,!_x.test(_s(_f++)))for(;_f<_k&&!_x.test(_s(_f));)++_f;var _g=_h.substring(_j,_j=_f);return'"'!==_g&&"'"!==_g||(_q=_g),_g}function _w(_a){_p.push(_a)}function _e(){if(!_p.length){var _a=_d();if(null===_a)return null;_w(_a)}return _p[0]}return Object.defineProperty({next:_d,peek:_e,push:_w,skip:function(_a,_b){var _c=_e();if(_c===_a)return _d(),!0;if(!_b)throw _r("token '"+_c+"', '"+_a+"' expected");return!1},cmnt:function(_a){var _b=null;return _a===undefined?_n===_l-1&&(_i||"*"===_g||_o)&&(_b=_m):(_n<_a&&_e(),_n!==_a||_o||!_i&&"/"!==_g||(_b=_m)),_b}},"line",{get:function(){return _l}})}_f.unescape=_E},{}],35:[function(_a,_b,_c){_b.exports=_t;var _g=_a(23);((_t.prototype=Object.create(_g.prototype)).constructor=_t).className="Type";var _h=_a(15),_i=_a(25),_j=_a(16),_k=_a(20),_l=_a(33),_e=_a(21),_f=_a(27),_m=_a(42),_n=_a(37),_o=_a(14),_p=_a(13),_q=_a(40),_r=_a(12),_s=_a(41);function _t(_a,_b){_g.call(this,_a,_b),this.fields={},this.oneofs=undefined,this.extensions=undefined,this.reserved=undefined,this.group=undefined,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _d(_a){return _a._fieldsById=_a._fieldsArray=_a._oneofsArray=null,delete _a.encode,delete _a.decode,delete _a.verify,_a}Object.defineProperties(_t.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var _a=Object.keys(this.fields),_b=0;_b<_a.length;++_b){var _c=this.fields[_a[_b]],_d=_c.id;if(this._fieldsById[_d])throw Error("duplicate id "+_d+" in "+this);this._fieldsById[_d]=_c}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=_n.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=_n.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=_t.generateConstructor(this)())},set:function(_a){var _b=_a.prototype;_b instanceof _e||((_a.prototype=new _e).constructor=_a,_n.merge(_a.prototype,_b)),_a.$type=_a.prototype.$type=this,_n.merge(_a,_e,!0),this._ctor=_a;for(var _c=0;_c<this.fieldsArray.length;++_c)this._fieldsArray[_c].resolve();var _d={};for(_c=0;_c<this.oneofsArray.length;++_c)_d[this._oneofsArray[_c].resolve().name]={get:_n.oneOfGetter(this._oneofsArray[_c].oneof),set:_n.oneOfSetter(this._oneofsArray[_c].oneof)};_c&&Object.defineProperties(_a.prototype,_d)}}}),_t.generateConstructor=function(_a){for(var _b,_c=_n.codegen(["p"],_a.name),_d=0;_d<_a.fieldsArray.length;++_d)(_b=_a._fieldsArray[_d]).map?_c("this%s={}",_n.safeProp(_b.name)):_b.repeated&&_c("this%s=[]",_n.safeProp(_b.name));return _c("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},_t.fromJSON=function(_a,_b){var _c=new _t(_a,_b.options);_c.extensions=_b.extensions,_c.reserved=_b.reserved;for(var _d=Object.keys(_b.fields),_e=0;_e<_d.length;++_e)_c.add((void 0!==_b.fields[_d[_e]].keyType?_k.fromJSON:_j.fromJSON)(_d[_e],_b.fields[_d[_e]]));if(_b.oneofs)for(_d=Object.keys(_b.oneofs),_e=0;_e<_d.length;++_e)_c.add(_i.fromJSON(_d[_e],_b.oneofs[_d[_e]]));if(_b.nested)for(_d=Object.keys(_b.nested),_e=0;_e<_d.length;++_e){var _f=_b.nested[_d[_e]];_c.add((_f.id!==undefined?_j.fromJSON:_f.fields!==undefined?_t.fromJSON:_f.values!==undefined?_h.fromJSON:_f.methods!==undefined?_l.fromJSON:_g.fromJSON)(_d[_e],_f))}return _b.extensions&&_b.extensions.length&&(_c.extensions=_b.extensions),_b.reserved&&_b.reserved.length&&(_c.reserved=_b.reserved),_b.group&&(_c.group=!0),_b.comment&&(_c.comment=_b.comment),_c},_t.prototype.toJSON=function(_a){var _b=_g.prototype.toJSON.call(this,_a),_c=!!_a&&Boolean(_a.keepComments);return _n.toObject(["options",_b&&_b.options||undefined,"oneofs",_g.arrayToJSON(this.oneofsArray,_a),"fields",_g.arrayToJSON(this.fieldsArray.filter(function(_a){return!_a.declaringField}),_a)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined,"group",this.group||undefined,"nested",_b&&_b.nested||undefined,"comment",_c?this.comment:undefined])},_t.prototype.resolveAll=function(){for(var _a=this.fieldsArray,_b=0;_b<_a.length;)_a[_b++].resolve();var _c=this.oneofsArray;for(_b=0;_b<_c.length;)_c[_b++].resolve();return _g.prototype.resolveAll.call(this)},_t.prototype.get=function(_a){return this.fields[_a]||this.oneofs&&this.oneofs[_a]||this.nested&&this.nested[_a]||null},_t.prototype.add=function(_a){if(this.get(_a.name))throw Error("duplicate name '"+_a.name+"' in "+this);if(_a instanceof _j&&_a.extend===undefined){if(this._fieldsById?this._fieldsById[_a.id]:this.fieldsById[_a.id])throw Error("duplicate id "+_a.id+" in "+this);if(this.isReservedId(_a.id))throw Error("id "+_a.id+" is reserved in "+this);if(this.isReservedName(_a.name))throw Error("name '"+_a.name+"' is reserved in "+this);return _a.parent&&_a.parent.remove(_a),(this.fields[_a.name]=_a).message=this,_a.onAdd(this),_d(this)}return _a instanceof _i?(this.oneofs||(this.oneofs={}),(this.oneofs[_a.name]=_a).onAdd(this),_d(this)):_g.prototype.add.call(this,_a)},_t.prototype.remove=function(_a){if(_a instanceof _j&&_a.extend===undefined){if(!this.fields||this.fields[_a.name]!==_a)throw Error(_a+" is not a member of "+this);return delete this.fields[_a.name],_a.parent=null,_a.onRemove(this),_d(this)}if(_a instanceof _i){if(!this.oneofs||this.oneofs[_a.name]!==_a)throw Error(_a+" is not a member of "+this);return delete this.oneofs[_a.name],_a.parent=null,_a.onRemove(this),_d(this)}return _g.prototype.remove.call(this,_a)},_t.prototype.isReservedId=function(_a){return _g.isReservedId(this.reserved,_a)},_t.prototype.isReservedName=function(_a){return _g.isReservedName(this.reserved,_a)},_t.prototype.create=function(_a){return new this.ctor(_a)},_t.prototype.setup=function(){for(var _a=this.fullName,_b=[],_c=0;_c<this.fieldsArray.length;++_c)_b.push(this._fieldsArray[_c].resolve().resolvedType);this.encode=_o(this)({Writer:_m,types:_b,util:_n}),this.decode=_p(this)({Reader:_f,types:_b,util:_n}),this.verify=_q(this)({types:_b,util:_n}),this.fromObject=_r.fromObject(this)({types:_b,util:_n}),this.toObject=_r.toObject(this)({types:_b,util:_n});var _d=_s[_a];if(_d){var _e=Object.create(this);_e.fromObject=this.fromObject,this.fromObject=_d.fromObject.bind(_e),_e.toObject=this.toObject,this.toObject=_d.toObject.bind(_e)}return this},_t.prototype.encode=function(_a,_b){return this.setup().encode(_a,_b)},_t.prototype.encodeDelimited=function(_a,_b){return this.encode(_a,_b&&_b.len?_b.fork():_b).ldelim()},_t.prototype.decode=function(_a,_b){return this.setup().decode(_a,_b)},_t.prototype.decodeDelimited=function(_a){return _a instanceof _f||(_a=_f.create(_a)),this.decode(_a,_a.uint32())},_t.prototype.verify=function(_a){return this.setup().verify(_a)},_t.prototype.fromObject=function(_a){return this.setup().fromObject(_a)},_t.prototype.toObject=function(_a,_b){return this.setup().toObject(_a,_b)},_t.d=function(_b){return function(_a){_n.decorateType(_a,_b)}}},{12:12,13:13,14:14,15:15,16:16,20:20,21:21,23:23,25:25,27:27,33:33,37:37,40:40,41:41,42:42}],36:[function(_a,_b,_c){var _d=_c,_e=_a(37),_f=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function _g(_a,_b){var _c=0,_d={};for(_b|=0;_c<_a.length;)_d[_f[_c+_b]]=_a[_c++];return _d}_d.basic=_g([1,5,0,0,0,5,5,0,4,0,1,1,0,2,2]),_d.defaults=_g([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",_e.emptyArray,null]),_d.long=_g([0,0,0,1,1],7),_d.mapKey=_g([0,0,0,5,5,0,4,0,1,1,0,2],2),_d.packed=_g([1,5,0,0,0,5,5,0,4,0,1,1,0])},{37:37}],37:[function(_d,_a,_b){var _e,_c,_f=_a.exports=_d(39),_g=_d(30);_f.codegen=_d(3),_f.fetch=_d(5),_f.path=_d(8),_f.fs=_f.inquire("fs"),_f.toArray=function(_a){if(_a){for(var _b=Object.keys(_a),_c=new Array(_b.length),_d=0;_d<_b.length;)_c[_d]=_a[_b[_d++]];return _c}return[]},_f.toObject=function(_a){for(var _b={},_c=0;_c<_a.length;){var _d=_a[_c++],_e=_a[_c++];_e!==undefined&&(_b[_d]=_e)}return _b};var _h=/\\/g,_i=/"/g;_f.isReserved=function(_a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(_a)},_f.safeProp=function(_a){return!/^[$\w_]+$/.test(_a)||_f.isReserved(_a)?'["'+_a.replace(_h,"\\\\").replace(_i,'\\"')+'"]':"."+_a},_f.ucFirst=function(_a){return _a.charAt(0).toUpperCase()+_a.substring(1)};var _j=/_([a-z])/g;_f.camelCase=function(_a){return _a.substring(0,1)+_a.substring(1).replace(_j,function(_a,_b){return _b.toUpperCase()})},_f.compareFieldsById=function(_a,_b){return _a.id-_b.id},_f.decorateType=function(_a,_b){if(_a.$type)return _b&&_a.$type.name!==_b&&(_f.decorateRoot.remove(_a.$type),_a.$type.name=_b,_f.decorateRoot.add(_a.$type)),_a.$type;_e||(_e=_d(35));var _c=new _e(_b||_a.name);return _f.decorateRoot.add(_c),_c.ctor=_a,Object.defineProperty(_a,"$type",{value:_c,enumerable:!1}),Object.defineProperty(_a.prototype,"$type",{value:_c,enumerable:!1}),_c};var _k=0;_f.decorateEnum=function(_a){if(_a.$type)return _a.$type;_c||(_c=_d(15));var _b=new _c("Enum"+_k++,_a);return _f.decorateRoot.add(_b),Object.defineProperty(_a,"$type",{value:_b,enumerable:!1}),_b},Object.defineProperty(_f,"decorateRoot",{get:function(){return _g.decorated||(_g.decorated=new(_d(29)))}})},{15:15,29:29,3:3,30:30,35:35,39:39,5:5,8:8}],38:[function(_a,_b,_c){_b.exports=_e;var _d=_a(39);function _e(_a,_b){this.lo=_a>>>0,this.hi=_b>>>0}var _f=_e.zero=new _e(0,0);_f.toNumber=function(){return 0},_f.zzEncode=_f.zzDecode=function(){return this},_f.length=function(){return 1};var _g=_e.zeroHash="\0\0\0\0\0\0\0\0";_e.fromNumber=function(_a){if(0===_a)return _f;var _b=_a<0;_b&&(_a=-_a);var _c=_a>>>0,_d=(_a-_c)/4294967296>>>0;return _b&&(_d=~_d>>>0,_c=~_c>>>0,4294967295<++_c&&(_c=0,4294967295<++_d&&(_d=0))),new _e(_c,_d)},_e.from=function(_a){if("number"==typeof _a)return _e.fromNumber(_a);if(_d.isString(_a)){if(!_d.Long)return _e.fromNumber(parseInt(_a,10));_a=_d.Long.fromString(_a)}return _a.low||_a.high?new _e(_a.low>>>0,_a.high>>>0):_f},_e.prototype.toNumber=function(_a){if(!_a&&this.hi>>>31){var _b=1+~this.lo>>>0,_c=~this.hi>>>0;return _b||(_c=_c+1>>>0),-(_b+4294967296*_c)}return this.lo+4294967296*this.hi},_e.prototype.toLong=function(_a){return _d.Long?new _d.Long(0|this.lo,0|this.hi,Boolean(_a)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(_a)}};var _h=String.prototype.charCodeAt;_e.fromHash=function(_a){return _a===_g?_f:new _e((_h.call(_a,0)|_h.call(_a,1)<<8|_h.call(_a,2)<<16|_h.call(_a,3)<<24)>>>0,(_h.call(_a,4)|_h.call(_a,5)<<8|_h.call(_a,6)<<16|_h.call(_a,7)<<24)>>>0)},_e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},_e.prototype.zzEncode=function(){var _a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^_a)>>>0,this.lo=(this.lo<<1^_a)>>>0,this},_e.prototype.zzDecode=function(){var _a=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^_a)>>>0,this.hi=(this.hi>>>1^_a)>>>0,this},_e.prototype.length=function(){var _a=this.lo,_b=(this.lo>>>28|this.hi<<4)>>>0,_c=this.hi>>>24;return 0==_c?0==_b?_a<16384?_a<128?1:2:_a<2097152?3:4:_b<16384?_b<128?5:6:_b<2097152?7:8:_c<128?9:10}},{39:39}],39:[function(_a,_b,_c){var _d=_c;function _e(_a,_b,_c){for(var _d=Object.keys(_b),_e=0;_e<_d.length;++_e)_a[_d[_e]]!==undefined&&_c||(_a[_d[_e]]=_b[_d[_e]]);return _a}function _f(_a){function _c(_a,_b){if(!(this instanceof _c))return new _c(_a,_b);Object.defineProperty(this,"message",{get:function(){return _a}}),Error.captureStackTrace?Error.captureStackTrace(this,_c):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),_b&&_e(this,_b)}return(_c.prototype=Object.create(Error.prototype)).constructor=_c,Object.defineProperty(_c.prototype,"name",{get:function(){return _a}}),_c.prototype.toString=function(){return this.name+": "+this.message},_c}_d.asPromise=_a(1),_d.base64=_a(2),_d.EventEmitter=_a(4),_d.float=_a(6),_d.inquire=_a(7),_d.utf8=_a(10),_d.pool=_a(9),_d.LongBits=_a(38),_d.global="undefined"!=typeof window&&window||"undefined"!=typeof global&&global||"undefined"!=typeof self&&self||this,_d.emptyArray=Object.freeze?Object.freeze([]):[],_d.emptyObject=Object.freeze?Object.freeze({}):{},_d.isNode=Boolean(_d.global.process&&_d.global.process.versions&&_d.global.process.versions.node),_d.isInteger=Number.isInteger||function(_a){return"number"==typeof _a&&isFinite(_a)&&Math.floor(_a)===_a},_d.isString=function(_a){return"string"==typeof _a||_a instanceof String},_d.isObject=function(_a){return _a&&"object"==typeof _a},_d.isset=_d.isSet=function(_a,_b){var _c=_a[_b];return!(null==_c||!_a.hasOwnProperty(_b))&&("object"!=typeof _c||0<(Array.isArray(_c)?_c.length:Object.keys(_c).length))},_d.Buffer=function(){try{var _a=_d.inquire("buffer").Buffer;return _a.prototype.utf8Write?_a:null}catch(_a){return null}}(),_d._Buffer_from=null,_d._Buffer_allocUnsafe=null,_d.newBuffer=function(_a){return"number"==typeof _a?_d.Buffer?_d._Buffer_allocUnsafe(_a):new _d.Array(_a):_d.Buffer?_d._Buffer_from(_a):"undefined"==typeof Uint8Array?_a:new Uint8Array(_a)},_d.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,_d.Long=_d.global.dcodeIO&&_d.global.dcodeIO.Long||_d.global.Long||_d.inquire("long"),_d.key2Re=/^true|false|0|1$/,_d.key32Re=/^-?(?:0|[1-9][0-9]*)$/,_d.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,_d.longToHash=function(_a){return _a?_d.LongBits.from(_a).toHash():_d.LongBits.zeroHash},_d.longFromHash=function(_a,_b){var _c=_d.LongBits.fromHash(_a);return _d.Long?_d.Long.fromBits(_c.lo,_c.hi,_b):_c.toNumber(Boolean(_b))},_d.merge=_e,_d.lcFirst=function(_a){return _a.charAt(0).toLowerCase()+_a.substring(1)},_d.newError=_f,_d.ProtocolError=_f("ProtocolError"),_d.oneOfGetter=function(_a){for(var _c={},_b=0;_b<_a.length;++_b)_c[_a[_b]]=1;return function(){for(var _a=Object.keys(this),_b=_a.length-1;-1<_b;--_b)if(1===_c[_a[_b]]&&this[_a[_b]]!==undefined&&null!==this[_a[_b]])return _a[_b]}},_d.oneOfSetter=function(_c){return function(_a){for(var _b=0;_b<_c.length;++_b)_c[_b]!==_a&&delete this[_c[_b]]}},_d.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},_d._configure=function(){var _c=_d.Buffer;_c?(_d._Buffer_from=_c.from!==Uint8Array.from&&_c.from||function(_a,_b){return new _c(_a,_b)},_d._Buffer_allocUnsafe=_c.allocUnsafe||function(_a){return new _c(_a)}):_d._Buffer_from=_d._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,38:38,4:4,6:6,7:7,9:9}],40:[function(_a,_b,_c){_b.exports=function(_a){var _b=_i.codegen(["m"],_a.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),_c=_a.oneofsArray,_d={};_c.length&&_b("var p={}");for(var _e=0;_e<_a.fieldsArray.length;++_e){var _f=_a._fieldsArray[_e].resolve(),_g="m"+_i.safeProp(_f.name);if(_f.optional&&_b("if(%s!=null&&m.hasOwnProperty(%j)){",_g,_f.name),_f.map)_b("if(!util.isObject(%s))",_g)("return%j",_j(_f,"object"))("var k=Object.keys(%s)",_g)("for(var i=0;i<k.length;++i){"),_l(_b,_f,"k[i]"),_k(_b,_f,_e,_g+"[k[i]]")("}");else if(_f.repeated)_b("if(!Array.isArray(%s))",_g)("return%j",_j(_f,"array"))("for(var i=0;i<%s.length;++i){",_g),_k(_b,_f,_e,_g+"[i]")("}");else{if(_f.partOf){var _h=_i.safeProp(_f.partOf.name);1===_d[_f.partOf.name]&&_b("if(p%s===1)",_h)("return%j",_f.partOf.name+": multiple values"),_d[_f.partOf.name]=1,_b("p%s=1",_h)}_k(_b,_f,_e,_g)}_f.optional&&_b("}")}return _b("return null")};var _g=_a(15),_i=_a(37);function _j(_a,_b){return _a.name+": "+_b+(_a.repeated&&"array"!==_b?"[]":_a.map&&"object"!==_b?"{k:"+_a.keyType+"}":"")+" expected"}function _k(_a,_b,_c,_d){if(_b.resolvedType)if(_b.resolvedType instanceof _g){_a("switch(%s){",_d)("default:")("return%j",_j(_b,"enum value"));for(var _e=Object.keys(_b.resolvedType.values),_f=0;_f<_e.length;++_f)_a("case %i:",_b.resolvedType.values[_e[_f]]);_a("break")("}")}else _a("{")("var e=types[%i].verify(%s);",_c,_d)("if(e)")("return%j+e",_b.name+".")("}");else switch(_b.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":_a("if(!util.isInteger(%s))",_d)("return%j",_j(_b,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":_a("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",_d,_d,_d,_d)("return%j",_j(_b,"integer|Long"));break;case"float":case"double":_a('if(typeof %s!=="number")',_d)("return%j",_j(_b,"number"));break;case"bool":_a('if(typeof %s!=="boolean")',_d)("return%j",_j(_b,"boolean"));break;case"string":_a("if(!util.isString(%s))",_d)("return%j",_j(_b,"string"));break;case"bytes":_a('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',_d,_d,_d)("return%j",_j(_b,"buffer"))}return _a}function _l(_a,_b,_c){switch(_b.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":_a("if(!util.key32Re.test(%s))",_c)("return%j",_j(_b,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":_a("if(!util.key64Re.test(%s))",_c)("return%j",_j(_b,"integer|Long key"));break;case"bool":_a("if(!util.key2Re.test(%s))",_c)("return%j",_j(_b,"boolean key"))}return _a}},{15:15,37:37}],41:[function(_a,_b,_c){var _d=_c,_f=_a(21);_d[".google.protobuf.Any"]={fromObject:function(_a){if(_a&&_a["@type"]){var _b=this.lookup(_a["@type"]);if(_b){var _c="."===_a["@type"].charAt(0)?_a["@type"].substr(1):_a["@type"];return this.create({type_url:"/"+_c,value:_b.encode(_b.fromObject(_a)).finish()})}}return this.fromObject(_a)},toObject:function(_a,_b){if(_b&&_b.json&&_a.type_url&&_a.value){var _c=_a.type_url.substring(_a.type_url.lastIndexOf("/")+1),_d=this.lookup(_c);_d&&(_a=_d.decode(_a.value))}if(_a instanceof this.ctor||!(_a instanceof _f))return this.toObject(_a,_b);var _e=_a.$type.toObject(_a,_b);return _e["@type"]=_a.$type.fullName,_e}}},{21:21}],42:[function(_a,_b,_c){_b.exports=_l;var _d,_e=_a(39),_f=_e.LongBits,_g=_e.base64,_h=_e.utf8;function _i(_a,_b,_c){this.fn=_a,this.len=_b,this.next=undefined,this.val=_c}function _j(){}function _k(_a){this.head=_a.head,this.tail=_a.tail,this.len=_a.len,this.next=_a.states}function _l(){this.len=0,this.head=new _i(_j,0,0),this.tail=this.head,this.states=null}function _m(){return _e.Buffer?function(){return(_l.create=function(){return new _d})()}:function(){return new _l}}function _n(_a,_b,_c){_b[_c]=255&_a}function _o(_a,_b){this.len=_a,this.next=undefined,this.val=_b}function _p(_a,_b,_c){for(;_a.hi;)_b[_c++]=127&_a.lo|128,_a.lo=(_a.lo>>>7|_a.hi<<25)>>>0,_a.hi>>>=7;for(;127<_a.lo;)_b[_c++]=127&_a.lo|128,_a.lo=_a.lo>>>7;_b[_c++]=_a.lo}function _q(_a,_b,_c){_b[_c++]=0,_e.float.writeFloatLE(_a,_b,_c)}function _r(_a,_b,_c){_b[_c++]=16,_e.float.writeDoubleLE(_a,_b,_c)}function _s(_a,_b,_c){_b[_c++]=0<=_a?32|_a:112|-_a}function _t(_a,_b,_c){0<=_a?(_b[_c++]=48,_b[_c++]=_a):(_b[_c++]=128,_b[_c++]=-_a)}function _u(_a,_b,_c){0<=_a?_b[_c++]=64:(_b[_c++]=144,_a=-_a),_b[_c++]=255&_a,_b[_c++]=_a>>>8}function _v(_a,_b,_c){_b[_c++]=255&_a,_b[_c++]=_a>>8&255,_b[_c++]=_a>>16&255,_b[_c++]=_a/16777216&255}function _w(_a,_b,_c){0<=_a?_b[_c++]=80:(_b[_c++]=160,_a=-_a),_v(_a,_b,_c)}function _x(_a,_b,_c){0<=_a?_b[_c++]=96:(_b[_c++]=176,_a=-_a);var _d=Math.floor(_a/4294967296);_v(_a-4294967296*_d,_b,_c),_v(_d,_b,_c+4)}function _y(_a,_b,_c){_b[_c]=255&_a,_b[_c+1]=_a>>>8&255,_b[_c+2]=_a>>>16&255,_b[_c+3]=_a>>>24}_l.create=_m(),_l.alloc=function(_a){return new _e.Array(_a)},_e.Array!==Array&&(_l.alloc=_e.pool(_l.alloc,_e.Array.prototype.subarray)),_l.prototype._push=function(_a,_b,_c){return this.tail=this.tail.next=new _i(_a,_b,_c),this.len+=_b,this},(_o.prototype=Object.create(_i.prototype)).fn=function(_a,_b,_c){for(;127<_a;)_b[_c++]=127&_a|128,_a>>>=7;_b[_c]=_a},_l.prototype.uint32=function(_a){return this.len+=(this.tail=this.tail.next=new _o((_a>>>=0)<128?1:_a<16384?2:_a<2097152?3:_a<268435456?4:5,_a)).len,this},_l.prototype.int32=function(_a){return _a<0?this._push(_p,10,_f.fromNumber(_a)):this.uint32(_a)},_l.prototype.sint32=function(_a){return this.uint32((_a<<1^_a>>31)>>>0)},_l.prototype.int64=_l.prototype.uint64=function(_a){if(Number.isSafeInteger(_a)){var _b=0<=_a?_a:-_a;return _b<16?this._push(_s,1,_a):_b<256?this._push(_t,2,_a):_b<65536?this._push(_u,3,_a):_b<4294967296?this._push(_w,5,_a):this._push(_x,9,_a)}return-99999<_a&&_a<99999?this._push(_q,5,_a):this._push(_r,9,_a)},_l.prototype.sint64=function(_a){var _b=_f.from(_a).zzEncode();return this._push(_p,_b.length(),_b)},_l.prototype.bool=function(_a){return this._push(_n,1,_a?1:0)},_l.prototype.sfixed32=_l.prototype.fixed32=function(_a){return this._push(_y,4,_a>>>0)},_l.prototype.sfixed64=_l.prototype.fixed64=function(_a){var _b=_f.from(_a);return this._push(_y,4,_b.lo)._push(_y,4,_b.hi)},_l.prototype.float=function(_a){return this._push(_e.float.writeFloatLE,4,_a)},_l.prototype.double=function(_a){return this._push(_e.float.writeDoubleLE,8,_a)};var _z=_e.Array.prototype.set?function(_a,_b,_c){_b.set(_a,_c)}:function(_a,_b,_c){for(var _d=0;_d<_a.length;++_d)_b[_c+_d]=_a[_d]};_l.prototype.bytes=function(_a){var _b=_a.length>>>0;if(!_b)return this._push(_n,1,0);if(_e.isString(_a)){var _c=_l.alloc(_b=_g.length(_a));_g.decode(_a,_c,0),_a=_c}return this.uint32(_b)._push(_z,_b,_a)},_l.prototype.string=function(_a){var _b=_h.length(_a);return _b?this.uint32(_b)._push(_h.write,_b,_a):this._push(_n,1,0)},_l.prototype.fork=function(){return this.states=new _k(this),this.head=this.tail=new _i(_j,0,0),this.len=0,this},_l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new _i(_j,0,0),this.len=0),this},_l.prototype.ldelim=function(){var _a=this.head,_b=this.tail,_c=this.len;return this.reset().uint32(_c),_c&&(this.tail.next=_a.next,this.tail=_b,this.len+=_c),this},_l.prototype.finish=function(){for(var _a=this.head.next,_b=this.constructor.alloc(this.len),_c=0;_a;)_a.fn(_a.val,_b,_c),_c+=_a.len,_a=_a.next;return _b},_l._configure=function(_a){_d=_a,_l.create=_m(),_d._configure()}},{39:39}],43:[function(_a,_b,_c){_b.exports=_f;var _d=_a(42);(_f.prototype=Object.create(_d.prototype)).constructor=_f;var _e=_a(39);function _f(){_d.call(this)}function _g(_a,_b,_c){_a.length<40?_e.utf8.write(_a,_b,_c):_b.utf8Write?_b.utf8Write(_a,_c):_b.write(_a,_c)}_f._configure=function(){_f.alloc=_e._Buffer_allocUnsafe,_f.writeBytesBuffer=_e.Buffer&&_e.Buffer.prototype instanceof Uint8Array&&"set"===_e.Buffer.prototype.set.name?function(_a,_b,_c){_b.set(_a,_c)}:function(_a,_b,_c){if(_a.copy)_a.copy(_b,_c,0,_a.length);else for(var _d=0;_d<_a.length;)_b[_c++]=_a[_d++]}},_f.prototype.bytes=function(_a){_e.isString(_a)&&(_a=_e._Buffer_from(_a,"base64"));var _b=_a.length>>>0;return this.uint32(_b),_b&&this._push(_f.writeBytesBuffer,_b,_a),this},_f.prototype.string=function(_a){var _b=_e.Buffer.byteLength(_a);return this.uint32(_b),_b&&this._push(_g,_b,_a),this},_f._configure()},{39:39,42:42}]},_Uyd={},_Vyd=[19],_Xyd=function _a(_b){var _c=_Uyd[_b];return _c||_Tyd[_b][0].call(_c=_Uyd[_b]={exports:{}},_a,_c,_c.exports),_c.exports}(_Vyd[0]),_Xyd.util.global.protobuf=_Xyd,"function"==typeof define&&define.amd&&define(["long"],function(_a){return _a&&_a.isLong&&(_Xyd.util.Long=_a,_Xyd.configure()),_Xyd}),"object"==typeof module&&module&&module.exports&&(module.exports=_Xyd)}();