<!DOCTYPE html>
<html>

<head id="head">
    <title>H5仙侠</title>
    <meta name='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'
    />
    <meta name='renderer' content='webkit'>
    <meta name='apple-mobile-web-app-capable' content='yes' />
    <meta name='full-screen' content='true' />
    <meta name='x5-fullscreen' content='true' />
    <meta name='laya' screenorientation='portrait' />
    <meta charset='utf-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />
    <meta http-equiv='Cache-Control' content='no-siteapp' />
    <meta http-equiv='expires' content='0' />

    <meta name="x5-orientation" content="portrait">
    <meta name="x5-page-mode" content="app">
    <link rel="icon" href="">

    <style>
        html {
            width: 100%;
            height: 100%;
            background-color: black;
            background-size: contain;
            background-image: url("login_init/init_0.png");
            background-repeat: no-repeat;
            background-position: center;
            margin: 0px;
        }

        body {
            width: 100%;
            height: 100%;
            font-family: '黑体';
        }

        .loading-bounce {
            width: 200px;
            height: 140px;
            margin: auto;
            position: relative;
            top: 50%;
            margin-top: -40px;
            visibility: hidden;
        }

        .circle-bounce {
            width: 80px;
            height: 80px;
            margin: auto;
            position: relative;
            top: 0;
            margin-top: 0px;
        }

        .label-bounce {
            width: 100%;
            height: 20px;
            margin: auto;
            position: relative;
            top: 20px;
            font-size: 14px;
            color: lightcyan;
            text-align: center;
        }

        .circle-bounce .child {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .circle-bounce .child:before {
            content: "";
            display: block;
            margin: 0 auto;
            width: 15%;
            height: 15%;
            background-color: lightcyan;
            border-radius: 100%;
            animation: circle-bounce 1.2s infinite ease-in-out;
        }

        .circle-bounce .circle-2 {
            transform: rotate(30deg);
        }

        .circle-bounce .circle-2:before {
            animation-delay: -1.1s;
        }

        .circle-bounce .circle-3 {
            transform: rotate(60deg);
        }

        .circle-bounce .circle-3:before {
            animation-delay: -1.0s;
        }

        .circle-bounce .circle-4 {
            transform: rotate(90deg);
        }

        .circle-bounce .circle-4:before {
            animation-delay: -0.9s;
        }

        .circle-bounce .circle-5 {
            transform: rotate(120deg);
        }

        .circle-bounce .circle-5:before {
            animation-delay: -0.8s;
        }

        .circle-bounce .circle-6 {
            transform: rotate(150deg);
        }

        .circle-bounce .circle-6:before {
            animation-delay: -0.7s;
        }

        .circle-bounce .circle-7 {
            transform: rotate(180deg);
        }

        .circle-bounce .circle-7:before {
            animation-delay: -0.6s;
        }

        .circle-bounce .circle-8 {
            transform: rotate(210deg);
        }

        .circle-bounce .circle-8:before {
            animation-delay: -0.5s;
        }

        .circle-bounce .circle-9 {
            transform: rotate(240deg);
        }

        .circle-bounce .circle-9:before {
            animation-delay: -0.4s;
        }

        .circle-bounce .circle-10 {
            transform: rotate(270deg);
        }

        .circle-bounce .circle-10:before {
            animation-delay: -0.3s;
        }

        .circle-bounce .circle-11 {
            transform: rotate(300deg);
        }

        .circle-bounce .circle-11:before {
            animation-delay: -0.2s;
        }

        .circle-bounce .circle-12 {
            transform: rotate(330deg);
        }

        .circle-bounce .circle-12:before {
            animation-delay: -0.1s;
        }

        @keyframes circle-bounce {
            0% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }

            80% {
                transform: scale(0);
            }

            100% {
                transform: scale(0);
            }
        }
    </style>
</head>

<body id="body">
    <div id="loadingCircle" class="loading-bounce" style="visibility:false">
        <div class="circle-bounce">
            <div class="child circle-1"></div>
            <div class="child circle-2"></div>
            <div class="child circle-3"></div>
            <div class="child circle-4"></div>
            <div class="child circle-5"></div>
            <div class="child circle-6"></div>
            <div class="child circle-7"></div>
            <div class="child circle-8"></div>
            <div class="child circle-9"></div>
            <div class="child circle-10"></div>
            <div class="child circle-11"></div>
            <div class="child circle-12"></div>
        </div>
        <div id="loadingTxt" class="label-bounce"></div>
    </div>


    <script type="text/javascript">
        "use strict";
        var PLATFORM = 0; //0主干版本、1微信版本、2QQ版本，在config.js里配置
        var ENV = 0; //0浏览器，1微信小游戏环境（IDE和手机运行时），2QQ小游戏环境
        var DEBUG = true;
        var PF_INFO = {};
        var PACK = true;
        var WSS = false;
        var lastVersion = 0;
        var configs = {};
        var versions = {};
    </script>
    <script type="text/javascript" src="vconsole.min.js"></script>
    <script type="text/javascript" src="md5.min.js"></script>
    <script type="application/javascript">
        "use strict";

        var encode_url = (typeof utf8_to_b64 != 'undefined' && typeof utf8_to_b64 == 'function' ? utf8_to_b64 : function (str) { return window.btoa(unescape(encodeURIComponent(str))) });
        var lc_href = window.location.href;
        var pf_info = {};
        if (lc_href.indexOf("?") != -1) {
            var lc_strs = lc_href.substr(lc_href.indexOf("?") + 1).split("&");
            for (var i = 0; i < lc_strs.length; i++) {
                var lc_arr = lc_strs[i].split("=");
                if (lc_arr.length == 2) {
                    pf_info[lc_arr[0]] = decodeURI(lc_arr[1]);
                }
            }
            lc_href = lc_href.slice(0, lc_href.indexOf("?"));
        }


        PF_INFO.channel = pf_info['channel'];
        PF_INFO.partnerId = pf_info['partner_id'];
        PF_INFO.userId = pf_info['uid'];
        PF_INFO.account = pf_info['uid'];
        PF_INFO.version = pf_info['version'];
        PF_INFO.pkgName = pf_info['gamepkg'];
        PF_INFO.device = pf_info['device'];
        PF_INFO.channelNum = parseInt(pf_info['channel_num']);
        PF_INFO.tick = parseInt(pf_info['tick']);
        PF_INFO.package = parseInt(pf_info['package']);
        PF_INFO.newRegister = parseInt(pf_info['newregister']);
        PF_INFO.selectedServer = JSON.parse(pf_info['selected_server']);
        PF_INFO.sign = pf_info['sign'];

        PF_INFO.callback = "http://172.16.70.43/api/sdk/game.php/";       //游戏内的请求地址
        PF_INFO.cdn = lc_href.slice(0, lc_href.lastIndexOf("/") + 1);
        PF_INFO.mac = 0;
        PF_INFO.serverList = {};
        PF_INFO.showLogo = true;
        PF_INFO.debugUsers = "39927500|";

        // if(!DEBUG) var vConsole = new VConsole();

        var loadingStatus = 0; //0:未加载；1:加载中；2:已加载
        var serverStatus = 0;
        var isCheckBan = false;
        var bEnterGame = false;

        var pf_9130 = '9130';
        var platform = PF_INFO.channel;
        var onMemoryWarningCallBack = null;

        showCircleLoading();
        showTxtLoading("正在初始化SDK");

        if (platform == pf_9130) {  // 9130平台
            var sdk = window.document.createElement("script");
            sdk.language = "JavaScript";
            sdk.type = "text/javascript";
            sdk.onload = sdkOnInited;
            var sdkUrl = window.location.protocol === "https:" ? "https://static.sh9130.com/js/aksdk.js" : "http://static.sh9130.com/js/aksdk.js";
            requestJS(url, "text", function (req) {
                sdk.text = req.response;
            });
            document.head.appendChild(sdk);
        } else {
            PF_INFO.selectedServer.cdn = PF_INFO.cdn;
            sdkOnInited();
        }


        function createScriptElement(url, v, onComplete, onError) {
            v = v ? v : (configs[url] ? configs[url] : Date.now()); //正式服版本号走configs，debug用当前时间
            var script = window.document.createElement("script");
            script.type = "text/javascript";
            var url = PF_INFO.cdn + url + "?v=" + v;
            var _self = this;
            requestJS(url, "text", function (req) {
                script.text = req.response;
                if (req.response) onComplete.call(_self);
                else if (onError) onError.call(_self);
                else onComplete.call(_self);
            });
            document.body.appendChild(script);
        }

        function sdkOnInited() {
            showTxtLoading("正在登录账号");
            if (platform === pf_9130) {
                AKSDK.login(sdkOnLogin);
            } else {
                initComplete();
            }
        }
        function sdkOnLogin(status, data) {
            showTxtLoading("正在验证账号");
            if (status === 0) {
                PF_INFO.cpopenid = data.cp_openid;
                PF_INFO.cpopenkey = data.cp_openkey;
                PF_INFO.cppf = data.cp_pf;
                // 拿到平台信息后去校验
                var str = window.btoa("9130Check/run/" + data.account + "/" + data.userid + "/" + data.token + "/" + PF_INFO.package + "/" + PF_INFO.version);
                send(PF_INFO.callback + str, null, onUserLogin);
            } else {
                alert("登录失败");
            }
        }
        function onUserLogin(response) {
            if (!response) return;
            if (response.state === 1) {
                var data = response.data;
                var server = data.s;
                PF_INFO.channel = data.channel;
                PF_INFO.userId = data.user.openId;
                PF_INFO.account = data.user.openId;
                PF_INFO.newRegister = parseInt(data.newregister);
                PF_INFO.package = parseInt(data.package);
                PF_INFO.sign = data.sign;
                PF_INFO.channelNum = parseInt(server.channel_num);

                showTxtLoading("正在获取实名认证信息");
                if (platform === pf_9130) {
                    AKSDK.realName(sdkOnRealName);
                } else {
                    sdkOnRealName({ state: 1, data: { isTruename: 1, isAutoRole: 1, truename: "名字", idno: "123456", status: "1" } });
                }

                // 测试环境
                showTxtLoading("正在获取服务器信息");
                onUserLoginDefaultServers(server);
            } else {
                alert(value.msg);
            }
        }
        function sdkOnRealName(data) {
            if (data && data.data) {
                PF_INFO.isTrueNameAutoRole = (data.data.isAutoRole == 1);
            }

            // 正式环境是在此处请求 defualtServer 接口
            // onUserLoginDefaultServers();
        }

        function onUserLoginDefaultServers(response) {
            PF_INFO.selectedServer = {
                'server_id': response.server_id,
                'server_name': response.name,
                'entry_ip': response.server_addr,
                'entry_port': parseInt(response.server_port),
                'status': parseInt(response.status),
                'cdn': '',
            };
            initComplete();
        }

        // 初始化完成
        function initComplete() {
            req_pkg_options();
            loadVersionConfig();
        }
        // 加载version_config版本文件，
        function loadVersionConfig() {
            showTxtLoading("正在获取版本信息");
            var cdnVersion = Date.now();  //外网在getCdnVersion接口返回后赋值

            createScriptElement("version_config.js", cdnVersion, function (e) {
                if (platform === pf_9130) {
                    AKSDK.onLogout(logoutCallBack);
                } else {
                }
                if (PF_INFO.newRegister == 1) {  //新用户加载Loading和背景
                    var status = PF_INFO.selectedServer.status;
                    if (status === -1 || status === 0) {
                        alert(status === -1 ? "当前服务器在维护中" : "当前服务器尚未开启，敬请期待");
                    } else {
                        req_server_check_ban(0, PF_INFO.selectedServer.server_id);
                    }
                    preloadLoading();
                } else {
                    preloadServer(); //老用户加载选服和背景
                }
            });
        }

        // 预加载选服和背景
        function preloadServer() {
            if (serverStatus > 0) return;
            serverStatus = 1;
            showTxtLoading("正在加载选服界面");
            createScriptElement("init.js", null, function (e) {
                serverStatus = 2;
                if (window.initPanel) {
                    window.initPanel.preload();
                    gotoSelectServer(); //内网或老用户
                }
            });
        }
        // 预加载loading和背景
        function preloadLoading() {
            if (loadingStatus > 0) return;
            loadingStatus = 1;
            showTxtLoading("正在加载Loading界面");
            createScriptElement("wait.js", null, function (e) {
                loadingStatus = 2;
                if (window.watPanel) {
                    window.watPanel.preload();
                    if (isCheckBan) checkBanSuccess(); //验证比加载js快
                }
            });
        }

        // 校验完成（封号、禁言）
        function checkBanSuccess() {
            isCheckBan = true;
            if (loadingStatus == 2) {
                gotoLoading();
            } else {
                preloadLoading();
            }
        }
        // 进入选服
        function gotoSelectServer() {
            if (window.initPanel) {
                removeCircleLoading();
                window.initPanel.openPanel();
            }
        }
        // 进入loading界面
        function gotoLoading() {
            if (window.watPanel && !bEnterGame) {
                if (window.initPanel) {
                    window.initPanel.closePanel();
                }
                removeCircleLoading();
                enterGame();
                bEnterGame = true;
            }
        }


        // 显示圆形loading
        function showCircleLoading() {
            var loadingCircle = document.getElementById("loadingCircle");
            if (loadingCircle) {
                loadingCircle.style.cssText = "visibility:visible";
            }
        }
        // 隐藏圆形loading
        function removeCircleLoading() {
            var loadingCircle = document.getElementById("loadingCircle");
            if (loadingCircle) {
                document.body.removeChild(loadingCircle);
            }
        }
        function showTxtLoading(value) {
            var loadingTxt = document.getElementById("loadingTxt");
            if (loadingTxt) {
                loadingTxt.innerText = value;
            }
        }


        function toPay(roleId, roleName, roleLevel, roleCareer, productId, price, productName, productDesc) {
            var str = encode_url("local/Order/" + PF_INFO.selectedServer.server_id + "/" + PF_INFO.channel + "/" + roleId + "/" + roleName + "/" + productId + "/" + PF_INFO.account + "/" + roleLevel + "/" + price + "/" + PF_INFO.package + "/" + roleCareer + "/" + PF_INFO.sign + "/" + PF_INFO.os);
            send(PF_INFO.callback + str, null, askPayCallBack);
        }

        function askPayCallBack(data) {
            if (!data) return;
            if (data && data.errCode === 200 && platform === pf_9130) {
                AKSDK.pay(data.data, platformPayCallBack);
            } else {
                alert(data.errCode);
            }
        }

        function platformPayCallBack(status, data) {
            var _alert = tparams.gameAlert ? tparams.gameAlert : alert;
            if (status === 0) {
                alert("支付成功");
            } else if (status === 1) {		// 失败
                _alert.alert("提示", "支付失败");
            } else if (status === 2) {		// 取消
                _alert.alert("提示", "支付取消");
            }
        }

        // function logout() {
        //     if (platform === pf_9130) {
        //         AKSDK.logout(logoutCallBack);
        //     }
        // }

        // function logoutCallBack(status) {
        //     alert(status);
        // }

        function loadCreateRole() {
            if (platform === pf_9130) {
                AKSDK.logLoadingFinish();
            }
        }

        function toCreate(role_id, role_name, role_level, role_occ, role_createTime) {
            if (platform === pf_9130) {
                AKSDK.logCreateRole(PF_INFO.selectedServer.server_id, PF_INFO.selectedServer.server_name, role_id, role_name, role_level, role_occ, role_createTime);
            }
        }

        function toLogin(role_id, role_name, role_level, role_occ, role_era, role_createTime, role_fight, role_gold, role_era_ad, role_eraLv) {
            if (platform === pf_9130) {
                AKSDK.logEnterGame(PF_INFO.selectedServer.server_id, PF_INFO.selectedServer.server_name, role_id, role_name, role_level, role_occ, role_era, role_createTime, role_fight, role_gold, role_era_ad, role_eraLv);
            }
        }

        // 后台角色升级
        function toLevelUp(role_id, role_name, role_level, role_occ, role_era, role_createTime, role_fight, role_gold, role_era_ad, role_eraLv) {
            if (platform === pf_9130) {
                AKSDK.logRoleUpLevel(PF_INFO.selectedServer.server_id, PF_INFO.selectedServer.server_name, role_id, role_name, role_level, role_occ, role_era, role_createTime, role_fight, role_gold, role_era_ad, role_eraLv);
            }
        }

        //实名认证(新)
        function toTrueName() {
            if (platform === "local") {//内网测试用
                console.log("sdk发起实名认证");
            } else if (platform === pf_9130) {
                AKSDK.openIdCheck();
            } else {

            }
        }
        //获取实名认证状态（新）
        function getTrueNameState(callback) {
            if (platform === "local") {//内网测试用
                callback({
                    state: 1,
                    data: { isTruename: 1, isAutoRole: 1, truename: "名字", idno: "123456", status: "1" }
                });
            } else if (platform === pf_9130) {
                AKSDK.realName(callback);
            } else {

            }
        }
        //微端引导
        function microPortGuide() {
            if (platform === "local") {//内网测试用
                console.log("sdk发起微端引导跳转--------");
            } else {
                AKSDK.weiduanHelper();
            }
        }
        //调起分享（微信）
        function openShare(callback) {
            if (platform === "local") {//内网测试用
                console.log("调起分享（微信）成功...................")
            } else {
                AKSDK.share(function (data) {
                    callback(data);
                });
            }

        }
        //微信获取玩家邀请人信息（小程序）
        function reqPlayerAskInfo(packageName, role_id, serverId, callBack) {
            var url = "https://sd.sh9130.com/game/?ct=min&ac=getinviter";
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 301)) {
                    if (xhr.responseType == "") //IE下json为空
                        callBack(JSON.parse(xhr.response));
                    else
                        callBack(xhr.response);
                }
            };
            xhr.open("GET", url);
            xhr.responseType = "json";
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(packageName, role_id, serverId);
        }
        //调起客服
        function openService() {
            if (platform === "local") {//内网测试用
                console.log("调起客服 成功...................")
            } else {
                AKSDK.openService();
            }
        }
        //收藏
        function onShow(callback) {
            if (platform === "local") {//内网测试用
                callback({ scene: "1023" });
            } else {
                callback(data);
            }
        }
        //微信订阅(内网测试用)
        function openSubscribeMsg(ids, callback) {
            console.log("弹出活动订阅", ids);
            callback([
                [1, 2], [2, 3],
            ]);
        }
        //微信获取电池电量
        function getBatteryInfo(callback) {
            console.log("调用获取电池信息");
            callback(true, "100", false);
        }
        //疯狂h5渠道-获取svip信息
        function getCrazySvipInfo(data, callback) {
            if (platform === "local") {//内网测试用
                callback({
                    "errMsg": "success",
                    "buttonIcon": "top_left_and_right_atlas/btn_main_fksvip.png",
                    "primaryGiftImg": "",
                    "advancedGiftImg": "",
                    "isCps": true,
                    "isShow": true,
                });
            } else {
                AKSDK.getSvipInfo(data, callback);
            }
        }
        //萌蛋添加桌面
        function saveAppToDesktop() {
            if (platform === "local") {//内网测试用
                console.log("添加桌面 成功...................")
            } else {
                AKSDK.saveAppToDesktop(
                    {
                        success: function () {

                        },
                        fail: function () {

                        }
                    }
                );
            }
        }
        //萌蛋发送邀请好友卡片
        function shareInvite() {
            if (platform === "local") {//内网测试用
                console.log("发送邀请好友卡片 成功...................")
            } else {
                AKSDK.shareInvite(
                    {
                        success: function () {

                        },
                        fail: function () {

                        }
                    }
                );
            }
        }
        //疯狂h5渠道-打开svip界面
        function openCrazySvipPanel() {
            if (platform === "local") {//内网测试用
                console.log("Open crazy svip panel.");
            } else {
                AKSDK.svipInterfc();
            }
        }
        //疯狂h5渠道-获取关注信息
        function getCrazyFollowInfo(data, callback) {
            if (platform === "local") {//内网测试用
                callback(1);//0不显示(已关注)，1显示（未关注）
            } else {
                AKSDK.follow(data, callback);
            }
        }
        //爱微游渠道-分享功能
        function microGameShare(data, callback) {
            if (platform === "local") {//内网测试用
                callback(0);//0成功 1失败
            } else {
                AKSDK.share(data, callback);
            }
        }

        //陌陌获取消息盒子状态
        function momo_getNoticeStatus(data, callback) {
            console.log("调用陌陌消息盒子状态")
            if (platform === "local") {//内网测试用
                callback(1);//0不接受消息，1接收消息
            } else {
                AKSDK.getNoticeStatus(data, callback)
            }
        }

        //陌陌开关消息盒子
        function momo_toggleNotice(data, callback) {
            console.log("调用陌陌开关消息盒子")
            if (platform === "local") {//内网测试用
                callback(1);//0拒绝，1接收
            } else {
                AKSDK.toggleNotice(data, callback)
            }
        }

        //绑定有礼请求短信验证码
        function reqSMSCode(phone, role_id, uid, game_pkg, partner_id, sign, callback, server_id) {
            if (platform !== null && platform !== "local") {
                var str = "game/getCode/" + phone + "/" + role_id + "/" + uid + "/" + game_pkg + "/" + partner_id + "/" + sign + "/" + server_id;
                str = encode_url(str);
                send(PF_INFO.callback + str, null, callback);
            } else {
                callback(JSON.parse(`{
                    "state": "success",
                    "code": "0",
                    "info": "发送成功",                    
                    "data": {
                        "code": "1"
                    }
                }`))
            }
        }
        //跳转QQ游戏活动
        function goToQQAct(type) {
            if (platform === "local") {//内网测试用
                console.log("goToQQAct:", type);
            } else {
                //调用qq接口
            }
        }

        //调起蓝钻
        function openQQBlueVip() {
            if (platform === "local") {//内网测试用
                console.log("调起蓝钻充值............");
            } else {
                let data = {
                    "service_type": 3,
                }
                AKSDK.openVip(data, function (status) {
                    if (status == 1) {
                        console.log("调起蓝钻充值成功............");
                    }else{
                        console.log("调起蓝钻充值失败............");
                    }
                });
            }
        }

        function msgCheck(value, callback) {
            if (platform === pf_9130) {
                AKSDK.checkWord(value, function (status, words) {
                    if (status == 0) { //没有敏感词
                        callback(true);
                    } else if (status == 1) { //存在敏感词
                        callback(false);
                    } else { //未知异常
                        console.log("msgCheck:" + value + ", status:" + status + ", words:" + words);
                    }
                });
            } else {
                callback(true);
            }
        }
        function msgCheck37(value, callback) {
            console.info(JSON.stringify(value));
            callback({ state: 1, display: 0, msg: "不能发言" }); //state：0-不能发言（display：0-不展示发言，1-展示发言），1-可以发言
        }

        function toLogout(callback) {
            if (platform === pf_9130) {
                AKSDK.logout(callback);
            } else {
                callback();
            }
        }

        function send(url, data, callBack) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 301)) {
                    if (callBack) {
                        if (xhr.responseType == "") //IE下json为空
                            callBack(JSON.parse(xhr.response));
                        else
                            callBack(xhr.response);
                    }
                }
            };
            xhr.open("GET", url);
            xhr.responseType = "json";
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(data);       //暂时关闭
        }

        function load(url, type, callBack) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 301)) {
                    if (callBack) {
                        callBack(xhr.response);
                    }
                }
            };
            xhr.open("GET", url);
            xhr.responseType = type;
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send();
        }

        function requestJS(url, type, onComplete) {
            var _this = this;
            var request = new XMLHttpRequest();
            request.onreadystatechange = function () {
                if (request.readyState != 4) {
                    return;
                }
                if (request.status == 200 || (request.status == 0 && request.response != null && request.response.byteLength > 0)) {
                    onComplete.call(_this, request);
                }
                else {
                    onComplete.call(_this, request);
                }
            };
            request.open("GET", url);
            request.responseType = type;
            request.send();
            return request;
        }

        // 平台行为记录
        function onRoleRecordStep(step, role_id) {
            if (PF_INFO.channel != null && PF_INFO.package != null) {
                var serverTmpId = 0;
                var str;
                if (PF_INFO.selectedServer) {
                    serverTmpId = PF_INFO.selectedServer.server_id;
                }
                str = encode_url("game/node/" + PF_INFO.channel + "/" + serverTmpId + "/" + PF_INFO.package + "/" + step + "/" + PF_INFO.account + "/" + PF_INFO.sign + "/" + role_id + "/" + PF_INFO.mac);
                send(PF_INFO.callback + str, null, null);
            }
        }
        // 上报错误
        function reqRecordError(value) {

        }

        function req_server_group(step) {
            if (platform !== null) {
                var str = "game/getServerGroup/" + PF_INFO.channel + "/" + PF_INFO.package + "/" + PF_INFO.account + "/" + PF_INFO.sign;
                str = encode_url(str);
                send(PF_INFO.callback + str, null, reqServerGroupCallBack);
            } else {
                reqServerGroupCallBack(JSON.parse(pf_info['server_group']));
            }
        }
        function reqServerGroupCallBack(data) {
            // alert("reqServerGroupCallBack " + data);
            if (data.state === "success" && data.data) {
                data.data.unshift({ 'id': -2, 'name': "最新服" });
                data.data.unshift({ 'id': -1, 'name': "已有角色" });
                PF_INFO.groupList = data.data;
                window.initPanel.showGroupList();
            } else {
                PF_INFO.hasGroupReq = false;
                alert("reqServerGroupCallBack " + data.state);
            }
        }

        function req_server_owner(step) {
            if (platform !== null) {
                var str = "game/getServerLogged/" + PF_INFO.channel + "/" + PF_INFO.package + "/" + PF_INFO.account + "/" + PF_INFO.sign;
                // alert("req_server_owner............." + step + "   " + str);
                str = encode_url(str);
                send(PF_INFO.callback + str, null, reqServerOwnerCallBack);
            } else {
                reqServerOwnerCallBack(JSON.parse(pf_info['server_owner']));
            }
        }
        function reqServerOwnerCallBack(data) {
            // alert("reqServerOwnerCallBack " + data);
            PF_INFO.hasServerReq = false;
            if (data.state === "success" && data.data) {
                PF_INFO.serverList[-1] = changeServerName(data.data);
                window.initPanel.showServerList(-1);
            } else {
                alert("reqServerOwnerCallBack " + data.state);
            }
        }
        function req_server_owner_status(callback) {
            if (platform !== null) {
                var str = "game/getServerLogged/" + PF_INFO.channel + "/" + PF_INFO.package + "/" + PF_INFO.account + "/" + PF_INFO.sign;
                // alert("req_server_owner............." + step + "   " + str);
                str = encode_url(str);
                send(PF_INFO.callback + str, null, callback);
            } else {
                callback(JSON.parse(pf_info['server_owner']));
            }
        }

        function req_server_list(step, group_id) {
            if (platform !== null) {
                var str = "game/getServerByGroup/" + PF_INFO.channel + "/" + PF_INFO.package + "/" + PF_INFO.account + "/" + group_id + "/" + PF_INFO.sign;
                // alert("req_server_list............." + step + "   " + str);
                str = encode_url(str);
                send(PF_INFO.callback + str, null, reqServerListCallBack);
            } else {
                var data = JSON.parse(pf_info['server_data']);
                data.server_group_id = group_id;
                reqServerListCallBack(data);
            }
        }
        function reqServerListCallBack(data) {
            // alert("reqServerListCallBack " + data);
            PF_INFO.hasServerReq = false;
            if (data.state === "success" && data.data) {
                var groupid = data.data.server_group_id;
                PF_INFO.serverList[groupid] = changeServerName(data.data.data);
                window.initPanel.showServerList(groupid);
            } else {
                alert("reqServerListCallBack " + data.state);
            }
        }
        //获取最新服务(推荐服列表)
        function req_recommend_server_list(step) {
            PF_INFO.hasServerReq = false;
            PF_INFO.serverList[-2] = [];
            window.initPanel.showServerList(-2);
        }
        function reqServerRecommendCallBack(data) {
            PF_INFO.hasServerReq = false;
            if (data.state === "success" && data.data) {
                for (var i = 0; i < data.data.length; i++) {
                    data.data[i].status = get_status(data.data[i]);
                }
                PF_INFO.serverList[-2] = changeServerName(data.data);
                window.initPanel.showServerList(-2);
            } else {
                alert("reqServerRecommendCallBack " + data.state);
            }
        }
        //在推荐服的服务器名字前加上 推荐
        function changeServerName(lst) {
            if (!lst && lst.length <= 0) return lst;
            for (var i = 0; i < lst.length; i++) {
                if (lst[i].is_recommend && lst[i].is_recommend == 1) {
                    lst[i].server_name += "(推荐)";
                }
            }
            return lst;
        }
        // 请求刷新推荐服
        function req_refresh_default_server(callback) {
            if (callback) {
                callback();
            }
        }

        // 请求校验（封号、禁言），获取详细信息
        function req_server_check_ban(step, server_id) {
            if (platform !== null) {
                var str = "game/serverCheckBan/" + PF_INFO.channel + "/" + PF_INFO.package + "/" + PF_INFO.account + "/" + server_id + "/" + PF_INFO.sign
                // alert("req_server_check_ban............." + step + "   " + str);
                str = encode_url(str);
                send(PF_INFO.callback + str, null, reqServerCheckBanCallBack);
            } else {
                reqServerCheckBanCallBack(JSON.parse(pf_info['server_ban']));
            }
        }
        function reqServerCheckBanCallBack(data) {
            if (data.state === "success" && data.data) {
                var server = PF_INFO.selectedServer;
                server.channel_num = PF_INFO.channelNum;
                server.sign = data.data.login_sign;
                server.tick = parseInt(data.data.time);
                server.server_num = parseInt(data.data.server_num);
                server.is_domain = 0;
                server.cdn = PF_INFO.cdn;
                var v = data.data.cdn_version;
                PF_INFO.lastVersion = (v != "" && v != "0" && v != 0 ? v : configs["lastVersion"]);
                var ser_options = data.data.server_options;
                server.server_options = ser_options ? ser_options : {};

                // alert("reqServerCheckBanCallBack "+ JSON.stringify(data.data));
                createScriptElement("versions/version__" + PF_INFO.lastVersion + ".js", PF_INFO.lastVersion, function (e) {
                    checkBanSuccess();
                }, function (e) {
                    alert("版本文件不存在：" + PF_INFO.lastVersion);
                });
            } else {
                alert("reqServerCheckBanCallBack " + data.state);
            }
        }

        // 请求公告
        function req_server_notice(server_id, callback) {
            server_id = server_id || PF_INFO.selectedServer.server_id;
            var str = "game/getNotice/" + server_id;
            // alert("req_server_notice............." + step + "   " + str);
            str = encode_url(str);
            send(PF_INFO.callback + str, null, callback);
        }
        //请求多标签页的公告
        function req_multi_server_notice(type, pkgName, serId, callback) {
            // callback({
            //     "state": "success",
            //     "data": {
            //         "0": {
            //             "title": "标题3",
            //             "content": "内容3",
            //             "end_time": 9999999999,
            //             "pop_type": 2,
            //             "key": 3,
            //             "login_id": 3,
            //         },
            //         "1": {
            //             "title": "标题1",
            //             "content": "内容1",
            //             "end_time": 9999999999,
            //             "pop_type": 1,
            //             "key": 1,
            //             "login_id": 1,
            //         },
            //         "2": {
            //             "title": "标题2",
            //             "content": "内容2",
            //             "end_time": 9999999999,
            //             "pop_type": 1,
            //             "key": 2,
            //             "login_id": 2,
            //         },
            //     }
            // });
        }


        // 请求隐私、超级VIP、微信公众号信息、新公众号信息
        function req_pkg_options() {
            reqPkgOptionsCallBack({
                state: "success",
                data: {
                    pkg_protocol: {
                        title: "隐私政策",
                        url: "http://172.16.70.43/options/pkg_protocol.txt",
                        jump_url: "http://172.16.70.43/index.html",
                    },
                    wechat_subscription: {
                        url: "http://172.16.70.43/options/wechat.jpg",
                    },
                    super_vip: {
                        qq: "2468180666",
                        image: "http://172.16.70.43/options/super_vip.jpg",
                    },
                    newSubscription: {
                        iconUrl: "http://172.16.70.43/options/wechat.jpg",
                        wxName: "zxfddfff",
                        reward: "[120253011#0#10元宝],[120252011#0#20元宝],[13260004#0#30元宝],[19440001#0#40元宝],[13260004#0#30元宝],[19440001#0#40元宝]",
                        noticeStr: "是兄弟就来砍我",
                        qrCode: "http://172.16.70.43/options/wechat.jpg",
                    },
                    wechat_shared: 1,
                    wechat_service: 1,
                    wechat_collect: 1,
                    wechat_luckdraw: 1,
                    wechat_helper: 1,
                    micro_port_welfare_pkg: 1,
                    turn_port_welfare_pkg: 1,
                    game_view_type_pkg: 0,
                    server_sel_pkg: 1,
                    wx_search_enter_sign_imgs_pkg: "http://172.16.70.43/options/wechat.jpg,http://172.16.70.43/options/super_vip.jpg,http://172.16.70.43/options/wechat.jpg",
                    wx_invite_pkg: 1,
                    is_msg_check_pkg: 1,
                    account_conflict_exit_pkg: 0,
                    bind_pkg: 1,
                }
            });
        }
        function reqPkgOptionsCallBack(data) {
            if (data.state === "success" && data.data) {
                for (var k in data.data) {
                    console.log(k + "--------" + data.data[k])
                    PF_INFO[k] = data.data[k];
                }
            } else {
                alert("reqPkgOptionsCallBack " + data.state);
            }
        }
    </script>
</body>

</html>